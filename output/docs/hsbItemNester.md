# hsbItemNester.mcr

## Overview
This script optimizes material usage by automatically arranging (nesting) selected timber item clones onto a defined raw material sheet. It generates a cutting layout that accounts for grain direction, saw kerf gaps, and panel dimensions.

## Usage Environment
| Space | Supported | Notes |
|-------|-----------|-------|
| Model Space | Yes | The script creates geometry (polylines, text) and transforms items in 3D model space. |
| Paper Space | No | This script does not function in layout views. |
| Shop Drawing | No | This is a production/modeling tool, not a drawing generator. |

## Prerequisites
- **Required Entities**: `TslInst` entities generated by the `Hsb_ItemClone` script.
- **Minimum Beam Count**: 0 (This script works with TSL instances, not structural beams).
- **Required Settings**: `hsbItemClone.xml` (Optional; if missing, internal defaults are used).

## Usage Steps

### Step 1: Launch Script
**Command**: `TSLINSERT`
1. Browse and select `hsbItemNester.mcr`.
2. Click **Open**.

### Step 2: Configure Properties
**Action**: The Properties Palette (OPM) will open automatically upon insertion.
1. Review the default settings (Length, Width, Gap, Grain Direction).
2. Adjust values to match your raw material stock (e.g., change Length to `6000` for a 6m board).
3. Keep the palette open or click in the drawing area to proceed.

### Step 3: Select Items
**Command Line**: `Select item clone(s)`
**Action**: Click on the timber item clones (TslInst) you wish to nest onto the sheet.
1. Press **Enter** to confirm selection.
   *Note: The script automatically filters out invalid entities.*

### Step 4: Place Master Sheet
**Command Line**: `[Select insertion point]`
**Action**: Click in the Model Space to define the bottom-left corner of the raw material sheet.
1. The script will generate the rectangle outline.
2. The items will automatically move and rotate to their calculated nested positions.

## Properties Panel Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| **Grain Direction** | dropdown | Lengthwise | Constrains how items can be rotated. *Isotropic* allows 90Â° rotation (best for sheet goods); *Lengthwise* keeps items aligned with the board length. |
| **Length** | number | 5000 mm | The total length of the raw material (master board). |
| **Width** | number | 2000 mm | The total width of the raw material. |
| **Oversize Format Cut** | number | 0 mm | A safety margin subtracted from the outer edge of the master sheet (e.g., for saw trims). |
| **Top Face Alignment** | dropdown | Unchanged | Controls orientation of the "Top" face. Use to ensure the finished side remains facing up. |
| **Gap** | number | 0 mm | The spacing between individual items. Typically set to the saw blade thickness (kerf). |
| **Format** | text | Project info | Defines the label text displayed on the drawing (e.g., ElementNumber, ProjectName). Separate lines with `\P`. |
| **DimStyle** | dropdown | *Current* | Sets the visual style (arrows, text size) for dimensions. |
| **Text Height** | number | 0 | Sets the height for labels. `0` uses the default defined in the DimStyle. |

## Right-Click Menu Options

| Menu Item | Description |
|-----------|-------------|
| None | No custom context menu items are defined for this script. Use the Properties Palette to modify settings. |

## Settings Files
- **Filename**: `hsbItemClone.xml`
- **Location**: `\\TSL\Settings` (Company or Install path)
- **Purpose**: Provides default values for display settings (like DimStyle and Text Height) so they are consistent across the project.

## Tips
- **Recycling Space**: If your selected items do not fit on the first sheet, the script automatically creates a second (or third) sheet next to the first one to fit the leftovers.
- **Oversized Items**: If an item is physically larger than the defined Master Length/Width, the script will move it to a "graveyard" position above the sheet and display a warning. Increase the Length/Width properties to accommodate it.
- **Adjusting Layout**: If you change the *Length*, *Width*, or *Gap* in the Properties Palette, the script immediately erases the old layout and recalculates the nest.
- **Moving the Group**: You can use the standard AutoCAD **Move** command on the master sheet polyline (insertion point), and the nested items will move with it.

## FAQ
- **Q: Why did my items disappear?**
  A: They have been moved to the nested position on the master sheet. If you cannot see them, they might have been nested, or if the nesting failed, they may be placed in a "graveyard" location above the sheet.
- **Q: What does "Isotropic" mean?**
  A: It means the material has no grain direction constraint (like OSB or particle board). This allows the script to rotate items 90 degrees to pack them more tightly.
- **Q: How do I account for saw blade width?**
  A: Set the **Gap** property to the width of your saw blade (e.g., 4mm or 5mm). This adds space between parts so they aren't cut directly touching each other.