# hsbViewRequest.mcr

## Overview
This script acts as a rendering engine that automatically transfers dimension lines, text labels, and hatching from 3D model elements onto 2D sections or layout views. It filters these annotations based on view directions and painter definitions to ensure only relevant information is displayed.

## Usage Environment
| Space | Supported | Notes |
|-------|-----------|-------|
| Model Space | Yes | Used when attached to a Section2d entity in the model. |
| Paper Space | Yes | Processes requests and transforms them to layout viewports. |
| Shop Drawing | Yes | Specifically designed for generating 2D annotation details. |

## Prerequisites
- **Required Entities**: Must be associated with a `Section2d` entity (section cut) or a construction element (GenBeam/Element).
- **Minimum Beam Count**: 0.
- **Required Settings**: 
  - `PainterDefinitions` (specifically those starting with 'Dimension\') must exist in the drawing or catalog.
  - `DimStyles` must be available in the current CAD file.

## Usage Steps

### Step 1: Launch Script
**Command:** `TSLINSERT`
**Action:** Select `hsbViewRequest.mcr` from the list of available scripts.

### Step 2: Select Parent Entity
**Command Line:** `Select Section/Element:`
**Action:** Click on the `Section2d` (section cut) or the construction element (Beam/Panel) you wish to annotate.
*Note: The script will attempt to automatically detect the coordinate system and scale from this entity.*

### Step 3: Configure Filters (Properties Palette)
**Action:** The Properties Palette will open automatically upon insertion.
1. **Filter (`sPainter`)**: Select the Painter Definition (e.g., `Dimension\Standard`) that groups the annotations you want to see.
2. **Exclude Filter (`sExcludePainter`)**: Select a Painter if you want to hide specific types of annotations (e.g., `Machining`).
3. **DimStyle**: Choose the desired visual style for dimensions (arrows, font, etc.).
4. **Text Height**: Enter a value in mm to force a specific text size, or leave as `0` to use the default sizes.

### Step 4: View Results
**Action:** The script will scan the model, find valid annotation requests, and draw the text, lines, and hatching in the current view.

## Properties Panel Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| **Filter** (`sPainter`) | Dropdown | `<Disabled>` | Selects which group of annotation requests (Painter) to display. Only requests matching this filter are drawn. |
| **Exclude Filter** (`sExcludePainter`) | Dropdown | `<Disabled>` | Selects a Painter to suppress annotations generated by specific TSL scripts (e.g., remove machining labels). |
| **DimStyle** (`sDimStyle`) | Dropdown | `<Default>` | Sets the graphical style (font, arrows, line type) for the drawn dimensions. |
| **Text Height** (`dTextHeight`) | Number | `0` | Overrides the text height. Set to `0` to use the height defined in the model request; set > 0 to force a specific height (in mm). |

## Right-Click Menu Options

| Menu Item | Description |
|-----------|-------------|
| **Recalculate** | Refreshes the annotations based on the current model state, viewport settings, and property filters. |

## Settings Files
- **Filename**: Painter Definitions (Embedded or `.xml`)
- **Location**: hsbCAD Catalog or Drawing internal dictionary
- **Purpose**: Stores the logic for which annotations belong to which "Painter" or filter group (e.g., Dimension, Elevation, Plan).

## Tips
- **Dynamic Updates**: You do not need to delete and re-insert the script. Simply change the **Filter** or **DimStyle** in the Properties Palette, and the drawing will update automatically.
- **View Specifics**: This script checks the "Allowed View" vector stored in the annotation request. If a dimension is meant for a "Plan" view, it will not appear in an "Elevation" view unless the vectors align.
- **Troubleshooting**: If you see the message "No display requests could be found" in debug mode, ensure the parent beams/elements have TSL scripts attached that actually generate `DimRequest` data.
- **Text Scaling**: If your annotations look too small or too large in Paper Space, try adjusting the `dTextHeight` parameter. Setting it to match your text style standard (e.g., 2.5mm) usually yields the best results for plotted drawings.

## FAQ
- **Q: Why don't I see any dimensions after inserting?**
  - A: Ensure the parent entity has other TSL scripts attached (like connection or generation scripts) that create dimension requests. Also, check if your **Filter** (`sPainter`) is set correctly; setting it to `<Disabled>` might hide everything depending on your setup.
- **Q: How do I hide specific labels (like drill holes) but keep dimensions?**
  - A: Use the **Exclude Filter** (`sExcludePainter`) property. Select the Painter Definition that corresponds to the labels you want to hide.
- **Q: The text is upside down or unreadable.**
  - A: The script attempts to orient text based on view direction. If issues persist, check the underlying `DimStyle` settings or the text orientation vectors in the generating script.