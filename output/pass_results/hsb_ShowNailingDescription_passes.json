{
  "filename": "hsb_ShowNailingDescription.mcr",
  "status": "completed",
  "total_tokens": 33860,
  "processing_time": 245.82838368415833,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "14.10.2009",
            "author": null,
            "changes": "First Release"
          },
          {
            "version": "1.1",
            "date": "29.03.2010",
            "author": null,
            "changes": "Add the Option to show the Nail Type"
          },
          {
            "version": "1.2",
            "date": "29.03.2010",
            "author": null,
            "changes": "Remove the Nail Type if there is no nail type available."
          },
          {
            "version": "1.3",
            "date": "11.05.2011",
            "author": null,
            "changes": "Remove the Nail Type if there is no nail type available."
          },
          {
            "version": "1.5",
            "date": "06.02.2013",
            "author": null,
            "changes": "Remove the filter of the TSL name to get the nailing information."
          },
          {
            "version": "1.6",
            "date": "26.09.2013",
            "author": null,
            "changes": "Add property for text height."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4433,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script prompts user to select a viewport using _Viewport.append(getViewport(...)). It validates _Viewport.length() and erases the instance if 0. It retrieves the Element from the Viewport (vp.element()) and calculates Model Space to Paper Space transformations (ms2ps = vp.coordSys())."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Paper Space containing a Viewport showing an Element",
          "requiredSettings": []
        }
      },
      "tokens_used": 4203,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Pick a Point To Locate the Description",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "showDialogOnce() on Insert",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nZone",
            "type": "PropInt",
            "displayName": "Nailing Zone",
            "defaultValue": "0",
            "inputType": "dropdown",
            "options": [
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "10"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimLayout",
            "type": "PropString",
            "displayName": "Dim Style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dNewTextHeight",
            "type": "PropDouble",
            "displayName": "Text Height",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "-1 will use default text height"
          },
          {
            "index": 0,
            "variable": "dOffsetBetweenLn",
            "type": "PropDouble",
            "displayName": "Offset Between Text Lines",
            "defaultValue": "U(5)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sYesNoNailingType",
            "type": "PropString",
            "displayName": "Show Nailing Type",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sPrefix",
            "type": "PropString",
            "displayName": "Nailing Description Prefix",
            "defaultValue": "Cladding Nailing: ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6086,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates annotation text in Paper Space displaying calculated nailing schedules (spacing and nail type) derived from engineering data attached to a wall or floor element.",
          "category": "ShopDrawing",
          "typicalUseCase": "A detailer places this label on a layout to display the required perimeter and field nailing spacing for a specific wall panel, ensuring the construction crew knows the fastener requirements."
        },
        "parameters": [
          {
            "name": "nZone",
            "technicalDefault": "0",
            "businessMeaning": "Specifies which nailing zone or schedule index to retrieve data for. In complex panels, different zones (e.g., top plate, bottom plate, edges) may have different nailing requirements.",
            "validRange": "1 - 10",
            "unit": "count",
            "affectsOutput": "Selects the specific data keys (Perimeter, Intermediate, NailType) to read from the element's NailingInfo map; incorrect selection may result in 'N/A' or incorrect values."
          },
          {
            "name": "sDimLayout",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Determines the graphical appearance of the text (font, line type, arrow style) to ensure the annotation complies with office drafting standards.",
            "validRange": "Any valid Dimension Style name in the drawing",
            "unit": "string",
            "affectsOutput": "Updates the font and style attributes of the generated text entities."
          },
          {
            "name": "dNewTextHeight",
            "technicalDefault": "-1",
            "businessMeaning": "Controls the size of the annotation text. A value of -1 respects the default size defined in the selected Dimension Style.",
            "validRange": "-1 (Default) or > 1.5mm",
            "unit": "mm",
            "affectsOutput": "Scales the text height up or down; ensures readability on the printed drawing."
          },
          {
            "name": "dOffsetBetweenLn",
            "technicalDefault": "U(5)",
            "businessMeaning": "The vertical spacing distance between the primary nailing description and the secondary 'Nail Type' description.",
            "validRange": "2mm - 20mm",
            "unit": "mm",
            "affectsOutput": "Adjusts the vertical gap between lines of text to prevent overlapping or excessive whitespace."
          },
          {
            "name": "sYesNoNailingType",
            "technicalDefault": "No",
            "businessMeaning": "Toggle to enable or disable the display of the specific nail brand/size code.",
            "validRange": "Yes, No",
            "unit": "boolean",
            "affectsOutput": "If 'No', only spacing is shown. If 'Yes', a second line of text is generated showing the Nail Type."
          },
          {
            "name": "sPrefix",
            "technicalDefault": "Cladding Nailing: ",
            "businessMeaning": "A custom label identifying the material layer or construction phase (e.g., 'Cladding Nailing:', 'Sheathing Nailing:', 'Decking:').",
            "validRange": "Short text string (10-30 chars)",
            "unit": "string",
            "affectsOutput": "Prepends the specified text to the spacing values in the drawing."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sYesNoNailingType is set to 'Yes'",
            "effect": "The 'dOffsetBetweenLn' parameter becomes active in determining the position of the second line of text.",
            "cascade": [
              "dOffsetBetweenLn"
            ]
          },
          {
            "trigger": "dNewTextHeight is set to '-1'",
            "effect": "The text size is dictated by the 'sDimLayout' selection instead of an explicit value.",
            "cascade": [
              "sDimLayout"
            ]
          },
          {
            "trigger": "nZone selection",
            "effect": "The script looks for specific map keys (e.g., 'nZone1', 'dPerimeter1') in the attached TSL data. If the source data does not contain the selected zone, the output may be blank.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Text",
            "description": "Paper Space annotation displaying nailing spacing (Perimeter / Intermediate) and optionally the Nail Type.",
            "appliedTo": "Paper Space (relative to a selected Viewport)"
          }
        ]
      },
      "tokens_used": 6175,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched (Insert or Recalculation)",
          "[Insert Only] Check insertCycleCount > 1",
          "[Insert Only] If cycle count > 1, erase instance and exit",
          "[Insert Only] Prompt user to pick a point in Paper Space for the description location",
          "[Insert Only] Prompt user to select a Viewport",
          "[Insert Only] Show Dynamic Dialog for property configuration",
          "[Insert/Recalc] Check if _Viewport list is empty",
          "[Insert/Recalc] If Viewport list empty, erase instance and exit",
          "[Insert/Recalc] Retrieve the first Viewport from the list",
          "[Insert/Recalc] Retrieve the associated Element and its Coordinate System",
          "[Insert/Recalc] Check if Element is valid; exit if invalid",
          "[Insert/Recalc] Retrieve all Beams and Sheets from the Element",
          "[Insert/Recalc] Initialize Display properties based on Dim Style and Text Height properties",
          "[Insert/Recalc] Iterate through all attached TSL instances on the Element",
          "[Insert/Recalc] Look for 'NailingInfo' map within TSL instances",
          "[Insert/Recalc] Extract Zone, Perimeter Spacing, Intermediate Spacing, and Nail Type based on the 'nZone' property",
          "[Insert/Recalc] Calculate text position (taking offset between lines into account)",
          "[Insert/Recalc] Check if Element contains Sheets",
          "[Insert/Recalc] If no Sheets, draw 'Cladding Nailing: N/A'",
          "[Insert/Recalc] If Sheets exist, draw Prefix + Spacing text at the selected point",
          "[Insert/Recalc] Check if 'Show Nailing Type' property is Yes and extracted Nail Type is not empty",
          "[Insert/Recalc] If condition met, draw 'Nail Type: [Type]' text below the main description"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion cycle check",
            "path1": {
              "name": "First Cycle",
              "steps": [
                "Prompt for point",
                "Prompt for Viewport",
                "Show Dialog"
              ]
            },
            "path2": {
              "name": "Subsequent Cycle",
              "steps": [
                "Erase Instance",
                "Exit Script"
              ]
            }
          },
          {
            "condition": "Viewport availability",
            "path1": {
              "name": "Viewport Selected",
              "steps": [
                "Get Viewport Coordinate System",
                "Get Element",
                "Proceed to data extraction"
              ]
            },
            "path2": {
              "name": "No Viewport",
              "steps": [
                "Erase Instance",
                "Exit Script"
              ]
            }
          },
          {
            "condition": "Element Sheet content",
            "path1": {
              "name": "Sheets Present",
              "steps": [
                "Draw formatted string: [Prefix] Perimeter [Val]mm / Intermediate [Val]mm"
              ]
            },
            "path2": {
              "name": "No Sheets",
              "steps": [
                "Draw string: 'Cladding Nailing: N/A'"
              ]
            }
          },
          {
            "condition": "Nail Type Visibility",
            "path1": {
              "name": "Show Type (Yes & String Not Empty)",
              "steps": [
                "Calculate offset point",
                "Draw string: 'Nail Type: [Type]'"
              ]
            },
            "path2": {
              "name": "Hide Type (No or String Empty)",
              "steps": [
                "Skip drawing Nail Type line"
              ]
            }
          },
          {
            "condition": "Text Height Setting",
            "path1": {
              "name": "Custom Height",
              "steps": [
                "Use dNewTextHeight property value"
              ]
            },
            "path2": {
              "name": "Default Height (-1)",
              "steps": [
                "Use height defined in sDimLayout"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "Implicit (Script erases self)",
            "recovery": "User must re-insert and select a valid viewport."
          },
          {
            "check": "Element Validity",
            "errorMessage": "None (Script exits silently)",
            "recovery": "Ensure Viewport points to a valid Element."
          },
          {
            "check": "Minimum Beams",
            "errorMessage": "None (Script exits silently)",
            "recovery": "Ensure Element contains construction geometry."
          },
          {
            "check": "Nailing Data Availability",
            "errorMessage": "Values may display as 0 or 'N/A' if map keys are missing.",
            "recovery": "Ensure parent Element has TSL attached with valid 'NailingInfo' map and correct 'nZone' index."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Nailing Zone",
            "how": "OPM Property (Dropdown)",
            "effect": "Updates the spacing values to reflect the data stored in the new zone index (1-10)."
          },
          {
            "action": "Toggle Nail Type Visibility",
            "how": "OPM Property (Dropdown)",
            "effect": "Shows or hides the second line of text indicating the specific nail type."
          },
          {
            "action": "Adjust Text Height",
            "how": "OPM Property (Number)",
            "effect": "Resizes the annotation text. Setting to -1 reverts to the Dim Style default."
          },
          {
            "action": "Move Text",
            "how": "Grip Edit (Pt0)",
            "effect": "Relocates the entire text block in Paper Space."
          },
          {
            "action": "Change Dim Style",
            "how": "OPM Property (Dropdown)",
            "effect": "Updates the font and text attributes to match the selected CAD dimension style."
          }
        ]
      },
      "tokens_used": 6447,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ShowNailingDescription\n\n## Overview\nGenerates annotation text in Paper Space that displays calculated nailing schedules (spacing and nail type) derived from engineering data attached to a wall or floor element. This script is typically used to label construction drawings with fastener requirements for sheathing or cladding.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | The script requires selecting a Viewport to identify the target Element. |\n| Paper Space | Yes | The script is designed to be inserted directly onto layouts. |\n| Shop Drawing | Yes | Primarily used for annotating production or layout drawings. |\n\n## Prerequisites\n- **Required Entities**: A Viewport in Paper Space that is currently displaying a valid Element (e.g., a Wall or Floor).\n- **Element Data**: The Element displayed in the viewport must have engineering data (NailingInfo maps) attached to it, usually by other TSL scripts (like Wall Generators).\n- **Minimum Beam Count**: The Element must exist (the script will erase itself if the viewport is invalid).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_ShowNailingDescription.mcr`\n\n### Step 2: Select Location Point\n```\nCommand Line: Pick a Point To Locate the Description\nAction: Click anywhere in Paper Space where you want the nailing label to appear.\n```\n\n### Step 3: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click the border of the viewport that shows the element you wish to annotate.\n```\n\n### Step 4: Configure Properties\n```\nDialog: Dynamic Properties Dialog\nAction: Adjust settings such as the Nailing Zone, Text Height, and Prefix. Click OK to generate the text.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Nailing Zone | dropdown | 0 | Selects which nailing zone (1-10) to display. Ensure the engineer has defined data for the selected zone. |\n| Dim Style | dropdown | _DimStyles | Selects the Dimension Style to control the text font and appearance. |\n| Text Height | number | -1 | Sets the height of the text. Set to `-1` to use the default height defined in the selected Dim Style. |\n| Offset Between Text Lines | number | U(5) | The vertical distance (in mm) between the main nailing description and the Nail Type line. |\n| Show Nailing Type | dropdown | No | Set to `Yes` to display a second line of text showing the specific nail brand/size. |\n| Nailing Description Prefix | text | Cladding Nailing: | The custom label that appears before the spacing values (e.g., \"Sheathing Nailing: \"). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add custom items to the right-click context menu. Use the Properties palette to modify settings. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on data attached directly to the Element (NailingInfo maps) rather than external settings files.\n\n## Tips\n- **Data Availability**: If the label shows \"N/A\" or zero values, check if the Element in the viewport actually contains sheathing/sheets and if the generating TSL provided nailing data.\n- **Zone Selection**: If you see \"N/A\" but data exists, try changing the **Nailing Zone** property (1-10). Different parts of a wall (edges vs. field) are often stored in different zones.\n- **Text Standards**: For consistent office standards, leave **Text Height** set to `-1` and control the size via the **Dim Style** property.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the viewport?**\n  **A:** The script erases itself if it cannot find a valid Element within the selected Viewport. Ensure the viewport is active and showing a wall or floor.\n- **Q: How do I display the specific nail size (e.g., \"3.1x75\")?**\n  **A:** Change the **Show Nailing Type** property to `Yes` in the Properties Palette.\n- **Q: Can I move the text after inserting it?**\n  **A:** Yes, select the script instance in Paper Space and use the grip point (Pt0) to drag the text to a new location."
      },
      "tokens_used": 6516,
      "error": null
    }
  }
}