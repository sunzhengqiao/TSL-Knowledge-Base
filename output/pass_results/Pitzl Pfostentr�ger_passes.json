{
  "filename": "Pitzl Pfostentr�ger.mcr",
  "status": "completed",
  "total_tokens": 53323,
  "processing_time": 502.75606083869934,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.6",
            "date": "29.11.2022",
            "author": "Marsel Nakuci",
            "changes": "Fix bug at direction vectors"
          },
          {
            "version": "1.5",
            "date": "08.11.2022",
            "author": "Marsel Nakuci",
            "changes": "Introduce xml structure; add 10920.1390 and 10920.1490"
          },
          {
            "version": "1.4",
            "date": "20oct17",
            "author": "florian.wuermseer@hsbcad.com",
            "changes": "heavy duty models with squared top plate added (10930.1xxx and 10931.1xxx)"
          },
          {
            "version": "1.3",
            "date": "03feb16",
            "author": "florian.wuermseer@hsbcad.com",
            "changes": "oversize for drill diameters added"
          },
          {
            "version": "1.2",
            "date": "25november15",
            "author": "florian.wuermseer@hsbcad.com",
            "changes": "additional drill for welding added"
          },
          {
            "version": "1.1",
            "date": "25november15",
            "author": "florian.wuermseer@hsbcad.com",
            "changes": "vectors corrected, standard rotation method supported, insertion not possible for horizontal beams"
          },
          {
            "version": "1.0",
            "date": "25november15",
            "author": "florian.wuermseer@hsbcad.com",
            "changes": "initial version"
          }
        ],
        "settingsFiles": [
          "Pitzl Pfostenträger.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 8888,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates on GenBeam entities using 3D operations (Point3d, Vector3d, Body, Drill, Cut, BeamCut). It modifies beam geometry via addTool and creates HardWrComp (hardware components). There are no references to _Viewport, _kPaperSpace, #Type E, or sd_ prefixes typically found in shop drawing or layout scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D environment)",
          "requiredSettings": [
            "Pitzl Pfostenträger.xml"
          ]
        }
      },
      "tokens_used": 7609,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getGenBeam",
              "promptOriginal": "Select beam(s)",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Point for insertion (Optional)",
              "condition": "_bOnInsert",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sFamily",
            "type": "PropString",
            "displayName": "Type",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "10930",
              "10931"
            ],
            "category": "Category",
            "description": "Type:\n 10930 = Plane pipe\n 10930 = Threaded pipe"
          },
          {
            "index": 1,
            "variable": "sArticle",
            "type": "PropString",
            "displayName": "Article",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": "Category",
            "description": "Article:\n 1000 = 170 - 285mm\n 1100 = 195 - 310mm\n 1200 = 255 - 370mm\n 1300 = 285 - 400mm\n 1600 = 110 - 200mm\n 1005 = 170 - 285mm\n 1082 = 150 - 250mm\n 1003 = 195 - 285mm (HeavyDuty)\n 1006 = 205 - 300mm (HeavyDuty)\n 1106 = 230 - 325mm (HeavyDuty)\n 1206 = 290 - 385mm (HeavyDuty)\n 1306 = 320 - 415mm (HeavyDuty)"
          },
          {
            "index": 2,
            "variable": "sMill",
            "type": "PropString",
            "displayName": "Milled",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Tooling",
            "description": null
          },
          {
            "index": 0,
            "variable": "dMillDepth",
            "type": "PropDouble",
            "displayName": "Additional mill depth",
            "defaultValue": 8.0,
            "inputType": "number",
            "options": [],
            "category": "Tooling",
            "description": null
          },
          {
            "index": 1,
            "variable": "dDrillDiaOversize",
            "type": "PropDouble",
            "displayName": "Oversize drill",
            "defaultValue": 2.0,
            "inputType": "number",
            "options": [],
            "category": "Tooling",
            "description": null
          },
          {
            "index": 3,
            "variable": "sCoverHull",
            "type": "PropString",
            "displayName": "Cover hull",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Accessories",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Set to standard height",
            "handler": "Set to standard height",
            "action": "Resets the post base height to the midpoint of the allowed range.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Rotate post base",
            "handler": "Rotate post base",
            "action": "Rotates the post base 90 degrees.",
            "alsoTriggeredBy": "TslDoubleClick"
          }
        ],
        "settingsFiles": [
          {
            "filename": "Pitzl Pfostenträger.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings\\",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings\\"
            ],
            "purpose": "Provides manufacturer data, family configurations (e.g., 10930, 10931), and article specifications (dimensions, drill sizes, etc.).",
            "required": true
          }
        ]
      },
      "tokens_used": 8709,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates Pitzl post base connectors (Type 10930 or 10931) on timber beams, creating the necessary steel hardware model and associated machining (cuts and drills) for installation.",
          "category": "Hardware",
          "typicalUseCase": "Attaching a wooden post to a concrete foundation or floor slab using an adjustable steel post base anchor."
        },
        "parameters": [
          {
            "name": "sFamily",
            "technicalDefault": "10930",
            "businessMeaning": "Selects the product family/type of the post base. 10930 is a 'Plane pipe' model, while 10931 is a 'Threaded pipe' model, differing in the rod connection mechanism.",
            "validRange": "10930, 10931",
            "unit": "Selection",
            "affectsOutput": "Determines the specific hardware geometry generated and the drill diameter used in the beam (42.5mm vs 43.5mm)."
          },
          {
            "name": "sArticle",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific article number based on the required height adjustment range and load capacity (e.g., Heavy Duty). This controls the dimensions of the top plate, rod length, and screw nut sizes.",
            "validRange": "1000, 1100, 1200, 1300, 1600, 1005, 1082, 1003, 1006, 1106, 1206, 1306",
            "unit": "Selection",
            "affectsOutput": "Sets the physical dimensions of the hardware components (top plate size, rod length/width, bottom plate dimensions) and the valid height range."
          },
          {
            "name": "sMill",
            "technicalDefault": "No",
            "businessMeaning": "Determines if a milling operation (recess) should be performed on the timber beam to allow the top plate of the post base to sit flush or recessed into the wood.",
            "validRange": "Yes, No",
            "unit": "Selection",
            "affectsOutput": "If 'Yes', adds a Drill or BeamCut tool to recess the top plate area into the beam bottom. Also modifies the drilling depth for the vertical pipe."
          },
          {
            "name": "dMillDepth",
            "technicalDefault": "8.0",
            "businessMeaning": "The additional depth to mill into the beam beyond the thickness of the top plate, allowing for tolerances or air gaps.",
            "validRange": "0 - 20",
            "unit": "mm",
            "affectsOutput": "Increases the depth of the recess milling operation and the length of the central drill hole."
          },
          {
            "name": "dDrillDiaOversize",
            "technicalDefault": "2.0",
            "businessMeaning": "Increases the diameter of the drilled holes in the timber to ensure easy assembly, accommodating manufacturing tolerances and paint/coating thicknesses.",
            "validRange": "0 - 5",
            "unit": "mm",
            "affectsOutput": "Expands the diameter of the central vertical hole (for the rod) and the top plate recess."
          },
          {
            "name": "sCoverHull",
            "technicalDefault": "No",
            "businessMeaning": "Specifies whether to include a protective cover (hull) around the steel rod of the post base.",
            "validRange": "Yes, No",
            "unit": "Selection",
            "affectsOutput": "Adds a cylindrical Body representation around the threaded rod and creates a corresponding HardWrComp entry."
          },
          {
            "name": "Height",
            "technicalDefault": "Calculated Midpoint",
            "businessMeaning": "The installation height of the post base, measured from the reference point of the beam insertion to the bottom of the base.",
            "validRange": "Dependent on selected Article (e.g., 170-285mm for article 1000)",
            "unit": "mm",
            "affectsOutput": "Moves the entire post base geometry relative to the beam and determines the position of the cut/machining on the beam end."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing sFamily or sArticle",
            "effect": "Resets the 'Height' parameter to the midpoint of the new article's valid range.",
            "cascade": [
              "Height"
            ]
          },
          {
            "trigger": "Selecting 'Set to standard height' context menu",
            "effect": "Recalculates 'Height' to the midpoint of the current article's range.",
            "cascade": [
              "Height"
            ]
          },
          {
            "trigger": "Changing sArticle",
            "effect": "Updates the internal dimensions (rod diameter, plate sizes, nut sizes) used to generate the hardware and machining.",
            "cascade": [
              "Hardware Geometry",
              "Drill Diameter",
              "Plate Dimensions"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "HardWrComp (Hardware Component)",
            "description": "Creates a bill of materials entry for the Pitzl Post Base, including the main assembly, screws, and optional cover hull.",
            "appliedTo": "N/A (Reported in BOM)"
          },
          {
            "type": "Body (Visual Representation)",
            "description": "Draws a 3D representation of the post base (bottom plate, rod, top plate, nuts) for visualization in the model.",
            "appliedTo": "Graphical overlay on the selected beam"
          },
          {
            "type": "Cut (Beam End Cut)",
            "description": "Cuts the beam to the specified height to accept the post base.",
            "appliedTo": "Selected Beam"
          },
          {
            "type": "Drill (Vertical Hole)",
            "description": "Drills a central hole in the beam to accommodate the vertical rod/pipe of the post base.",
            "appliedTo": "Selected Beam"
          },
          {
            "type": "Drill/BeamCut (Recess)",
            "description": "Creates a recess at the bottom of the beam to allow the top plate of the post base to be countersunk (if 'Milled' is Yes).",
            "appliedTo": "Selected Beam"
          },
          {
            "type": "Drill (Welding Access)",
            "description": "Creates an oversized hole near the top of the rod drill to allow access for welding the nut (if 'Milled' is Yes, this is deeper).",
            "appliedTo": "Selected Beam"
          }
        ]
      },
      "tokens_used": 10223,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script",
          "Initialize Settings & Properties",
          "Prompt: Select Beam(s) (Required)",
          "Prompt: Select Point for insertion (Optional)",
          "Validate Beam Orientation (Reject if Horizontal)",
          "Determine Insertion Point (Project point or use Bottom of vertical beam)",
          "Load Configuration from XML based on sFamily and sArticle",
          "Validate and Clamp Height Parameter",
          "Apply Beam End Cut at calculated Height",
          "[Branch] Apply Machining (Drills/Milling) based on sMill",
          "Construct Hardware Body (Plates, Rod, Nuts)",
          "[Branch] Apply Geometry Rotation (if rotated)",
          "Generate BOM Entries (HardWrComp)",
          "Draw Visual Representation",
          "Save Instance State"
        ],
        "conditionalBranches": [
          {
            "condition": "User selects an insertion point",
            "path1": {
              "name": "Point Selection Mode",
              "steps": [
                "Point is projected onto the Beam's local X-axis",
                "Defines the reference point for the post base bottom",
                "Allows insertion on sloped beams and upside-down orientation"
              ]
            },
            "path2": {
              "name": "Default Mode (No Point)",
              "steps": [
                "Script uses the bottom point of the beam",
                "Only valid for vertical beams pointing downwards",
                "Forces specific orientation"
              ]
            }
          },
          {
            "condition": "sMill (Milled) Property",
            "path1": {
              "name": "Milled = Yes",
              "steps": [
                "Add recess tool (Drill or BeamCut) for Top Plate",
                "Depth = Top Plate Thickness + Additional Mill Depth",
                "Increase welding drill depth (Plate + Mill + 7mm)",
                "Increase main vertical drill depth"
              ]
            },
            "path2": {
              "name": "Milled = No",
              "steps": [
                "No top plate recess created",
                "Standard shallow welding drill (7mm)",
                "Standard main drill depth"
              ]
            }
          },
          {
            "condition": "Beam Orientation Check",
            "path1": {
              "name": "Horizontal Beam",
              "steps": [
                "Report Error: 'Insertion not possible for horizontal beams'",
                "Abort script execution"
              ]
            },
            "path2": {
              "name": "Vertical or Sloped Beam",
              "steps": [
                "Continue with geometry generation"
              ]
            }
          },
          {
            "condition": "Context Menu Trigger 'Rotate post base'",
            "path1": {
              "name": "Rotation Enabled (True)",
              "steps": [
                "Swap Local Y and Z axes",
                "Render hardware rotated 90° around Beam X-axis"
              ]
            },
            "path2": {
              "name": "Rotation Disabled (False)",
              "steps": [
                "Render hardware with default orientation"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Horizontal",
            "errorMessage": "Insertion not possible for horizontal beams",
            "recovery": "User must select a vertical or sloped beam"
          },
          {
            "check": "Height vs Article Range",
            "errorMessage": "Height [value] out of range  -->  value corrected to [Min/Max]",
            "recovery": "Script automatically clamps the value to the nearest allowed limit (Min or Max)"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Height",
            "how": "OPM (Properties Palette)",
            "effect": "Moves the cut plane and hardware along the beam axis. Auto-clamped to range."
          },
          {
            "action": "Change Article/Family",
            "how": "OPM Dropdown",
            "effect": "Updates dimensions/drills. Resets Height to standard midpoint."
          },
          {
            "action": "Toggle Milling",
            "how": "OPM Dropdown",
            "effect": "Adds or removes top plate recess and adjusts drill depths."
          },
          {
            "action": "Rotate Post Base",
            "how": "Context Menu 'Rotate post base' or Double-Click",
            "effect": "Toggles hardware orientation 90 degrees around the beam."
          },
          {
            "action": "Reset Height",
            "how": "Context Menu 'Set to standard height'",
            "effect": "Sets Height to the arithmetic midpoint of the current Article's range."
          }
        ]
      },
      "tokens_used": 11176,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Pitzl Pfostenträger (Post Base)\n\n## Overview\nThis script generates Pitzl post base connectors (Type 10930 or 10931) on timber beams. It creates the necessary 3D steel hardware model and applies machining (cuts and drills) to the beam for installation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used for generating 3D hardware and machining on beams. |\n| Paper Space | No | Not supported in layout views. |\n| Shop Drawing | No | Does not generate 2D drawings directly. |\n\n## Prerequisites\n- **Required Entities**: `GenBeam` (Timber Beam)\n- **Minimum Beam Count**: 1\n- **Required Settings Files**: `Pitzl Pfostenträger.xml` (Must be located in the Company or Install `TSL\\Settings` folder)\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `Pitzl Pfostenträger.mcr`\n\n### Step 2: Select Beam(s)\n```\nCommand Line: Select beam(s)\nAction: Click on the vertical or sloped timber beam you wish to equip with the post base.\n```\n*Note: The script will reject horizontal beams.*\n\n### Step 3: Define Insertion Point\n```\nCommand Line: Point for insertion (Optional)\nAction: Click a point in the model to define the height/location, or press Enter to use the beam's bottom point automatically.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | dropdown | 10930 | Selects the product family: **10930** (Plane pipe) or **10931** (Threaded pipe). |\n| Article | dropdown | (varies) | Selects the specific size and height adjustment range (e.g., 1000, 1100, 1200, etc.). |\n| Milled | dropdown | No | Set to **Yes** to create a recess in the beam so the top plate sits flush. |\n| Additional mill depth | number | 8.0 mm | Extra depth for the milling operation (added to the plate thickness). |\n| Oversize drill | number | 2.0 mm | Diameter increase for drilled holes to allow for tolerances/coatings. |\n| Cover hull | dropdown | No | Set to **Yes** to include a protective cover cylinder around the rod. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Set to standard height | Resets the installation height to the midpoint of the current Article's allowed range. |\n| Rotate post base | Rotates the hardware 90 degrees around the beam axis. (Also triggered by double-clicking the script instance). |\n\n## Settings Files\n- **Filename**: `Pitzl Pfostenträger.xml`\n- **Location**: `_kPathHsbCompany\\TSL\\Settings\\` or `_kPathHsbInstall\\Content\\General\\TSL\\Settings\\`\n- **Purpose**: Contains manufacturer data, dimensions, drill sizes, and valid height ranges for the various Articles (e.g., 10930 vs 10931).\n\n## Tips\n- **Horizontal Beams**: The script will report an error if you try to insert it on a horizontal beam. Ensure the beam is vertical or sloped.\n- **Rotation**: You can quickly rotate the post base orientation by double-clicking the script instance in the model.\n- **Height Validation**: If you manually enter a height that is outside the range of the selected Article, the script will automatically correct (clamp) it to the nearest valid limit.\n\n## FAQ\n- **Q: I get an error \"Insertion not possible for horizontal beams\". Why?**\n  A: This hardware is designed for vertical posts. You must select a beam that is vertical or sloped.\n- **Q: Why did the Height value change when I selected a different Article?**\n  A: The script automatically resets the height to the standard midpoint of the new Article's adjustment range to ensure it fits.\n- **Q: What is the difference between Type 10930 and 10931?**\n  A: 10930 uses a plane pipe connection, while 10931 uses a threaded pipe connection for the vertical rod."
      },
      "tokens_used": 6718,
      "error": null
    }
  }
}