{
  "filename": "HSB_E-SetGrainDirection.mcr",
  "status": "completed",
  "total_tokens": 35072,
  "processing_time": 313.86638879776,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl sets the grain direction of sheets. The grain direction is attached as property set.",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "06.01.2017",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "04.08.2017",
            "author": "RP",
            "changes": "Add option to flip z axis"
          },
          {
            "version": "1.02",
            "date": "18.09.2017",
            "author": "RP",
            "changes": "Set isotrpic propertie to new sheet"
          },
          {
            "version": "1.03",
            "date": "10.11.2017",
            "author": "RP",
            "changes": "Element insert"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "HSB_G-FilterGenBeams"
        ]
      },
      "tokens_used": 6285,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses `_kModelSpace` explicitly in the `dbCreate` call when inserting satellite instances. It directly manipulates `Sheet` and `Element` entities using `dbCreate` and `dbErase`, which are 3D model operations. There is no usage of `sd_` prefixes, `_Viewport`, or `#Type E` declarations typical of Paper Space or Shop Drawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Sheet"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "HSB_G-FilterGenBeams",
            "hsbGeometryData"
          ]
        }
      },
      "tokens_used": 3467,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity (Select Elements)",
              "promptOriginal": "T(\"|Select one or more elements|\") + T(\" <|Right click to select sheets|>\")",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity (Select Sheets)",
              "promptOriginal": "T(\"|Select sheets|\")",
              "condition": "_bOnInsert && Element selection empty",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDialog",
            "trigger": "On Insert (if no execute key is provided)",
            "title": null,
            "dataSource": "PropDefinitions",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "filterDefinition",
            "type": "PropString",
            "displayName": "|Filter definition sheets|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "Dynamic list from catalog HSB_G-FilterGenBeams"
            ],
            "category": "|Filter|",
            "description": "|Filter definition for sheets.| + TN(|Use| ) + filterDefinitionTslName + T(\" |to define the filters|\")"
          },
          {
            "index": 1,
            "variable": "alignGrainDirectionWith",
            "type": "PropString",
            "displayName": "|Align grain direction|",
            "defaultValue": "|None|",
            "inputType": "dropdown",
            "options": [
              "|None|",
              "|Element| X",
              "|Element| Y",
              "|Sheet| X",
              "|Sheet| Y"
            ],
            "category": "|Grain direction|",
            "description": "|The grain direction will be aligned with the selected vector|"
          },
          {
            "index": 2,
            "variable": "setZaxis",
            "type": "PropString",
            "displayName": "|Set Z axis from Element|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Grain direction|",
            "description": "|Set Z axis from Element, z will be iligned with viewside|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6189,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically sets the grain direction property of sheet materials (like CLT or plywood) based on their alignment relative to elements or the sheet's own local axes. It can also flip the sheet's normal vector to match the element's view direction.",
          "category": "Data/Properties",
          "typicalUseCase": "Used during design or detailing to ensure grain direction information is correctly attached to sheets for manufacturing lists, export (e.g., to BTL or production machines), or graphical display, specifically when using structural timber elements or CLT panels."
        },
        "parameters": [
          {
            "name": "filterDefinition",
            "technicalDefault": "",
            "businessMeaning": "Specifies a filter preset to determine which sheets within the selected elements are processed. This allows selective application of grain direction settings (e.g., only to specific sheet types or layers).",
            "validRange": "List of entries from 'HSB_G-FilterGenBeams' catalog",
            "unit": "N/A (Selection)",
            "affectsOutput": "Determines the subset of sheets that will receive updated properties. If empty, implies no specific filtering logic applied (though the script depends on the filter script execution)."
          },
          {
            "name": "alignGrainDirectionWith",
            "technicalDefault": "|None|",
            "businessMeaning": "Defines the reference vector used to determine the grain direction. It sets whether the grain follows the global X/Y direction of the parent Element or the local X/Y direction of the Sheet itself.",
            "validRange": "None, Element X, Element Y, Sheet X, Sheet Y",
            "unit": "N/A (Directional Logic)",
            "affectsOutput": "Updates the 'GrainDirection' integer property (0=None, 1=along Sheet X, 2=along Sheet Y) in the 'hsbGeometryData' property set attached to the sheet."
          },
          {
            "name": "setZaxis",
            "technicalDefault": "|No|",
            "businessMeaning": "Controls whether the sheet's orientation (Z-axis/normal) is flipped to align with the Element's Z-axis (view side). This ensures the sheet 'faces' the same way as the element definition.",
            "validRange": "Yes, No",
            "unit": "N/A (Boolean)",
            "affectsOutput": "If Yes, the sheet geometry is physically recreated with an inverted Z-axis if it opposes the Element's Z-axis. This affects machining sides and face orientation in drawings/exports."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "alignGrainDirectionWith is set to Element X or Element Y",
            "effect": "The script requires the selected sheets to be associated with a valid Element. If a sheet has no element, the property update fails for that specific sheet.",
            "cascade": [
              "Element validity check"
            ]
          },
          {
            "trigger": "setZaxis is set to Yes",
            "effect": "The script temporarily erases and recreates the sheet geometry to flip the normal vector. This operation effectively resets the sheet entity ID, which might affect external links or scripts referencing the specific sheet handle.",
            "cascade": [
              "Sheet Geometry Regeneration"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Property Set (hsbGeometryData)",
            "description": "Attaches or updates the property set containing the 'GrainDirection' integer (0, 1, or 2) to the sheet entities.",
            "appliedTo": "Selected Sheets (filtered by Filter definition)"
          },
          {
            "type": "Sheet Geometry",
            "description": "Potentially recreates the sheet with an inverted Z-axis vector if 'setZaxis' is Yes and the original orientation opposes the element's Z-axis.",
            "appliedTo": "Selected Sheets where Z-axis alignment is required"
          }
        ]
      },
      "tokens_used": 5561,
      "error": null
    },
    "5": {
      "success": true,
      "data": {},
      "tokens_used": 8778,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-SetGrainDirection.mcr\n\n## Overview\nThis script assigns a grain direction property to sheet materials (such as CLT or plywood) based on their alignment to elements or local axes. It also provides an option to flip the sheet's Z-axis orientation to match the element's view direction.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D model elements and sheets. |\n| Paper Space | No | Not designed for layout or detailing views. |\n| Shop Drawing | No | Not designed for manufacturing drawings directly. |\n\n## Prerequisites\n- **Required Entities**: Elements (e.g., walls, floors) or individual Sheets.\n- **Minimum Beam Count**: 0.\n- **Required Settings**: Access to the `HSB_G-FilterGenBeams` catalog to use filtering options.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_E-SetGrainDirection.mcr` from the list.\n\n### Step 2: Select Elements or Switch to Sheet Selection\n```\nCommand Line: Select one or more elements <Right click to select sheets>\nAction: \n- Click on one or more Elements in the model if you want to process all sheets within them.\n- OR Right-click immediately if you prefer to select specific individual sheets.\n```\n\n### Step 3: Select Sheets (If applicable)\n```\nCommand Line: Select sheets\nAction: Click on the specific sheets you wish to modify. Press Enter or Right-click to confirm selection.\n```\n\n### Step 4: Configure Properties\nAfter selection, the script inserts an instance. Open the **Properties Palette** (Ctrl+1) to configure the grain direction and alignment settings for the selected sheets.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Filter definition sheets** | dropdown | (Empty) | Select a preset filter to determine which specific sheets within the element are processed. This relies on entries from the `HSB_G-FilterGenBeams` catalog. |\n| **Align grain direction** | dropdown | None | Determines the vector used for the grain direction. Options include alignment with the Element's X or Y axis, or the Sheet's local X or Y axis. |\n| **Set Z axis from Element** | dropdown | No | If set to \"Yes\", the sheet geometry is recreated so its Z-axis (normal vector) aligns with the Element's Z-axis (view side). |\n\n## Right-Click Menu Options\nNo specific custom context menu options are defined for this script. Standard hsbCAD update options apply.\n\n## Settings Files\n- **Filename**: `HSB_G-FilterGenBeams` (Catalog)\n- **Location**: hsbCAD Company or Installation path\n- **Purpose**: Provides the list of filter definitions available in the \"Filter definition sheets\" property, allowing users to target specific sheet types or layers.\n\n## Tips\n- **Element vs. Sheet Alignment**: Use \"Element X/Y\" if the grain direction depends on the main wall or floor axis. Use \"Sheet X/Y\" if it depends on the specific rotation of the sheet panel itself.\n- **Flipping Sheets**: The \"Set Z axis from Element\" option is useful for ensuring machining sides or textures face the correct way relative to the element definition. Note that this physically recreates the sheet entity, which may affect handles or linked data.\n\n## FAQ\n- **Q: Can I run this on a single sheet without selecting the whole wall?**\n  **A:** Yes. During the insertion prompts, Right-click to skip element selection, and then manually pick the specific sheets you want to modify.\n\n- **Q: What does the \"None\" option do for grain direction?**\n  **A:** It leaves the grain direction property unset or unchanged, effectively skipping that specific update logic while still processing other settings like the Z-axis."
      },
      "tokens_used": 4792,
      "error": null
    }
  }
}