{
  "filename": "NA_BUNDLE_PANEL_BLANK.mcr",
  "status": "completed",
  "total_tokens": 29735,
  "processing_time": 156.34602904319763,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3825,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No usage of _Viewport, sd_ prefixes, or #Type E found. Script creates geometry directly using Body and PLine objects based on _Pt0 insertion point and coordinate vectors _XW/_YW/_ZW, which is characteristic of ModelSpace insertion scripts."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "ModelSpace (3D)",
          "requiredSettings": [
            "mpStackLocation (Map) - Optional, used to auto-generate Stack ID"
          ]
        }
      },
      "tokens_used": 2414,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Select an insertion point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strDimStyle",
            "type": "PropString",
            "displayName": "DimStyle",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": null,
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "strStack",
            "type": "PropString",
            "displayName": "Stack Id",
            "defaultValue": "X-999-999-999",
            "inputType": "text",
            "options": null,
            "category": null,
            "description": "Read-Only"
          },
          {
            "index": 2,
            "variable": "strShowHeight",
            "type": "PropString",
            "displayName": "Show Panel Sizes",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dPanelThickness",
            "type": "PropDouble",
            "displayName": "Thickness",
            "defaultValue": "U(127,5)",
            "inputType": "number",
            "options": null,
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dPanelLength",
            "type": "PropDouble",
            "displayName": "Length",
            "defaultValue": "U(1000,48)",
            "inputType": "number",
            "options": null,
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dPanelDepth",
            "type": "PropDouble",
            "displayName": "Depth (Solid)",
            "defaultValue": "U(3000,108)",
            "inputType": "number",
            "options": null,
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5180,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a parametric representation of a raw panel blank for stacker lists, automatically generating a Stack ID based on project location maps.",
          "category": "Representation/Reporting",
          "typicalUseCase": "Used to model generic or filler panels in a 3D model that need to be counted and labeled in production/export lists (bills of materials) but do not require specific machining."
        },
        "parameters": [
          {
            "name": "strDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Selects the dimension style format (e.g., decimal, fractional) used to display the panel's length in the label.",
            "validRange": "Any valid dimension style string defined in the hsbCAD project.",
            "unit": "N/A",
            "affectsOutput": "Alters the text format of the length label displayed at the center of the panel."
          },
          {
            "name": "strStack",
            "technicalDefault": "X-999-999-999",
            "businessMeaning": "A unique identifier combining Prefix, Stack Number, Row, and Place, auto-calculated from the 'mpStackLocation' map to track where this panel belongs in the production sequence.",
            "validRange": "Formatted string 'Prefix-Stack-Row-Place' (e.g., 'A-001-002-003').",
            "unit": "N/A",
            "affectsOutput": "Sets the read-only property used for filtering and sorting in export reports. Does not change geometry."
          },
          {
            "name": "strShowHeight",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggle to show or hide the size label on the panel in the 3D model.",
            "validRange": "\"Yes\", \"No\"",
            "unit": "N/A",
            "affectsOutput": "Controls visibility of the text label indicating the panel length (Note: The actual text drawing call is commented out in the snippet, but this property is designed to control it)."
          },
          {
            "name": "dPanelThickness",
            "technicalDefault": "U(127,5)",
            "businessMeaning": "The thickness of the timber panel (cross-section width).",
            "validRange": "12mm to 300mm (typical plywood/LVL/CLT ranges).",
            "unit": "mm/inch",
            "affectsOutput": "Changes the width of the rectangular profile. Scales the text height (to 50% of thickness, max 4mm). Updates the PLine and 3D Body geometry."
          },
          {
            "name": "dPanelLength",
            "technicalDefault": "U(1000,48)",
            "businessMeaning": "The horizontal length of the panel.",
            "validRange": "300mm to 12000mm (transport constraints).",
            "unit": "mm/inch",
            "affectsOutput": "Resizes the rectangular profile length along the local X-axis. Updates the text label content."
          },
          {
            "name": "dPanelDepth",
            "technicalDefault": "U(3000,108)",
            "businessMeaning": "The vertical height/depth of the 3D panel representation.",
            "validRange": "0mm to 6000mm.",
            "unit": "mm/inch",
            "affectsOutput": "Controls the extrusion height of the 3D Body. If set to 0, only the 2D outline is drawn."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User moves Grip Points 0-4",
            "effect": "Recalculates the Insertion Point (_Pt0), which effectively updates dPanelLength and dPanelThickness to match the new grip positions.",
            "cascade": [
              "dPanelLength",
              "dPanelThickness",
              "_Pt0"
            ]
          },
          {
            "trigger": "User moves Grip Point 5",
            "effect": "Calculates the distance between the grip and the insertion point to update dPanelThickness.",
            "cascade": [
              "dPanelThickness"
            ]
          },
          {
            "trigger": "dPanelThickness changes",
            "effect": "Dynamically adjusts the text height for the label (Text Height = Thickness * 0.5).",
            "cascade": [
              "dp.textHeight"
            ]
          },
          {
            "trigger": "Script Insertion",
            "effect": "Reads 'mpStackLocation' map to generate the Stack ID string.",
            "cascade": [
              "strStack"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (3D Solid)",
            "description": "A rectangular solid representing the panel volume, extruded perpendicular to the insertion plane by the 'Depth' parameter.",
            "appliedTo": "New Element Instance"
          },
          {
            "type": "PLine (2D Geometry)",
            "description": "A rectangle with cross-lines drawn on the face of the body to represent the panel surface.",
            "appliedTo": "Model Space"
          },
          {
            "type": "Map (mpStackChildPanel)",
            "description": "A data structure attached to the element storing geometric references and the Stack ID for use by other scripts or export routines.",
            "appliedTo": "Script Instance"
          },
          {
            "type": "Group (X - STACKER)",
            "description": "Adds the element to a specific group named 'X - STACKER' designated for export/delivery lists.",
            "appliedTo": "Script Instance"
          }
        ]
      },
      "tokens_used": 5192,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Initiated",
          "Check for 'mpStackLocation' Map in Project",
          "[Condition] If Map exists: Read Prefix, Stack, Row, and Place; Format them into 'Prefix-Stack-Row-Place' ID; Assign to 'strStack' property.",
          "[Condition] If Map missing: 'strStack' retains default value 'X-999-999-999'.",
          "Set 'strStack' property to Read-Only.",
          "[Condition] If _bOnInsert is TRUE (Insertion Phase): Prompt user for insertion point via getPoint.",
          "[Condition] If _bOnInsert is FALSE (Update/Recalc Phase): Skip point prompt.",
          "Join 'X - STACKER' Group (create group if it does not exist). Mark group as Deliverable Container.",
          "[Condition] Check if Grip Points (_PtG[0-5]) were modified (_kNameLastChangedProp check).",
          "[Condition] If Grip Modified: Update Insertion Point (_Pt0) and/or 'dPanelThickness' based on specific grip moved and projected plane.",
          "Update/Reset Grip Point visual positions based on current Dimensions and _Pt0.",
          "Calculate Text Height (Thickness * 0.5, capped at 4mm).",
          "Generate 2D Geometry (PLine Rectangle and cross-lines plL, plR, plGrip).",
          "[Condition] If 'dPanelDepth' > 0: Create 3D Body extruding the rectangle by 'dPanelDepth'.",
          "[Condition] If 'dPanelDepth' <= 0: Skip 3D Body creation (2D representation only).",
          "[Condition] If 'strShowHeight' == 'Yes': Prepare Text String 'Blank [Length]' (Actual draw call is commented out in code, but logic implies visibility).",
          "Update 'mpStackChildPanel' Map with current geometric properties (Ref Point, Length, Thickness, Grip Points, PLine)."
        ],
        "conditionalBranches": [
          {
            "condition": "Existence of 'mpStackLocation' Map",
            "path1": {
              "name": "Auto-ID Generation",
              "steps": [
                "Retrieve integer values for Stack, Row, Place.",
                "Pad integers with zeros (e.g., 1 becomes '001').",
                "Concatenate into 'strStack'."
              ]
            },
            "path2": {
              "name": "Default ID",
              "steps": [
                "Assign default 'X-999-999-999' to 'strStack'."
              ]
            }
          },
          {
            "condition": "Insertion vs. Modification (_bOnInsert)",
            "path1": {
              "name": "Initial Insertion",
              "steps": [
                "Execute getPoint('Select an insertion point').",
                "Wait for user input."
              ]
            },
            "path2": {
              "name": "Recalculation/Edit",
              "steps": [
                "Skip getPoint.",
                "Execute Grip logic and Geometry updates."
              ]
            }
          },
          {
            "condition": "Grip Point Moved (_kNameLastChangedProp)",
            "path1": {
              "name": "Move Corner Grips (0-4)",
              "steps": [
                "Project grip to 'pnSetTop' plane.",
                "Recalculate _Pt0 based on relative offset.",
                "Update length/thickness implicitly via _Pt0 shift."
              ]
            },
            "path2": {
              "name": "Move Thickness Grip (5)",
              "steps": [
                "Measure distance between Grip 5 and _Pt0 along Y-axis.",
                "Update 'dPanelThickness' property."
              ]
            },
            "path3": {
              "name": "No Grip Move",
              "steps": [
                "Reset Grips to match current _Pt0 and Dimensions."
              ]
            }
          },
          {
            "condition": "Panel Depth (dPanelDepth)",
            "path1": {
              "name": "3D Representation",
              "steps": [
                "Create Body from PLine extruded by dPanelDepth.",
                "Draw Body."
              ]
            },
            "path2": {
              "name": "2D Representation",
              "steps": [
                "Skip Body creation.",
                "Draw only PLines."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Input from getPoint",
            "errorMessage": "None explicit in script.",
            "recovery": "Script terminates insertion if point is not provided (standard CAD behavior)."
          },
          {
            "check": "Grip Projection",
            "errorMessage": "None explicit.",
            "recovery": "Grips are forced to project to 'pnSetTop' plane (Z=0, Normal=ZW) to ensure they remain coplanar with the insertion plane."
          },
          {
            "check": "Map Data Integrity",
            "errorMessage": "None explicit.",
            "recovery": "If iStack/iRow/iPlace are missing or invalid type in map, script defaults to '999' logic or results in string conversion error (not handled)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions (Length/Thickness)",
            "how": "Grip Edit (Points 0-4 for position/length, Point 5 for thickness) or OPM Property change",
            "effect": "Updates PLine geometry, 3D Body extrusion, and Map data. Thickness changes affect text height."
          },
          {
            "action": "Change Depth",
            "how": "OPM Property 'Depth (Solid)'",
            "effect": "Toggles between 2D PLine only and 3D extruded solid. Updates Map."
          },
          {
            "action": "Toggle Dimension Visibility",
            "how": "OPM Property 'Show Panel Sizes'",
            "effect": "Controls logic to prepare/display size label (Note: actual draw command is commented out in provided snippet)."
          }
        ]
      },
      "tokens_used": 6607,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# NA_BUNDLE_PANEL_BLANK.mcr\n\n## Overview\nCreates a parametric representation of a raw timber panel blank used for stacker lists and production reports. It automatically generates a unique Stack ID based on your project location settings and allows for quick resizing using on-screen grips or the Properties panel.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script creates 3D geometry and 2D outlines directly in the model. |\n| Paper Space | No | Not designed for Paper Space or layout views. |\n| Shop Drawing | No | This is a modeling/production script, not a detailing tool. |\n\n## Prerequisites\n- **Required Entities:** None.\n- **Minimum Beam Count:** 0.\n- **Required Settings:**\n  - **mpStackLocation (Map):** Optional but recommended. This project map stores the Prefix, Stack Number, Row, and Place information. If present, the script uses this to auto-generate the \"Stack Id\" property. If missing, the ID defaults to \"X-999-999-999\".\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `NA_BUNDLE_PANEL_BLANK.mcr` from the list.\n\n### Step 2: Select Insertion Point\n```\nCommand Line: Select an insertion point\nAction: Click in the Model Space to place the panel.\n```\n*Once placed, the panel is initialized with default dimensions and added to the \"X - STACKER\" group.*\n\n### Step 3: Adjust Dimensions\nYou can now modify the panel using either the on-screen Grips or the Properties panel.\n- **Grips:** Select the panel to see blue square grips.\n    - **Corner Grips (0-4):** Drag to move the panel or adjust its length/position.\n    - **Side Grip (5):** Drag to visually adjust the panel thickness.\n- **Properties:** Select the panel and press `Ctrl+1` to open the Properties Palette. Enter exact values for Length, Thickness, and Depth.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| DimStyle | dropdown | _DimStyles | Selects the dimension style format (e.g., decimal, architectural) used for the panel label. |\n| Stack Id | text | X-999-999-999 | **Read-Only.** Displays the generated ID. If \"X-999-999-999\" appears, check your `mpStackLocation` map settings. |\n| Show Panel Sizes | dropdown | Yes | Toggles the visibility of the text label displaying the panel length on the model. |\n| Thickness | number | 127.5 mm | The width of the panel (cross-section). Changing this also scales the label text height. |\n| Length | number | 1000.48 mm | The horizontal length of the panel. |\n| Depth (Solid) | number | 3000.108 mm | The vertical height/extrusion of the panel. Set to `0` if you only require a 2D representation. |\n\n## Right-Click Menu Options\nThis script does not add custom items to the right-click context menu. Use standard AutoCAD grips and the Properties palette for modifications.\n\n## Settings Files\n- **Filename:** `mpStackLocation` (Project Map)\n- **Location:** Project Data / Model Space\n- **Purpose:** Stores the logical location data (Prefix, Stack, Row, Place) to automatically generate unique Stack IDs for production lists.\n\n## Tips\n- **Quick Thickness Adjust:** Use Grip Point 5 to quickly drag the thickness to match another element visually.\n- **2D Mode:** For large floor plans where 3D solids slow down performance, set the **Depth (Solid)** property to `0`. The script will draw only the 2D outline and cross-lines.\n- **Text Scaling:** The size of the dimension label is automatically tied to the panel Thickness (50% of thickness, capped at 4mm). If the text is too small, increase the panel thickness.\n\n## FAQ\n- **Q: Why is my Stack ID \"X-999-999-999\"?**\n  **A:** The script cannot find the `mpStackLocation` map in your project, or the map is missing the required keys. Check with your project manager to ensure the stack location setup has been run.\n- **Q: Can I change the Stack ID manually?**\n  **A:** No, this property is Read-Only to maintain data integrity with the production lists. You must update the project Map or use a different location to change the ID.\n- **Q: How do I hide the dimension text?**\n  **A:** Select the panel, open the Properties palette (`Ctrl+1`), and change **Show Panel Sizes** to \"No\"."
      },
      "tokens_used": 6517,
      "error": null
    }
  }
}