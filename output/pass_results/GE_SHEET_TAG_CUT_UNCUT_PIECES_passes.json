{
  "filename": "GE_SHEET_TAG_CUT_UNCUT_PIECES.mcr",
  "status": "completed",
  "total_tokens": 33558,
  "processing_time": 352.48345017433167,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.2",
            "date": "13.ago.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Description added\nThumbnail added"
          },
          {
            "version": "1.1",
            "date": "04-may-2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Works with xRefs also"
          },
          {
            "version": "1.0",
            "date": "27-apr-2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4791,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select 'Sheet' entities and performs 3D geometric calculations (solidLength, solidWidth, area, plEnvelope). It interacts directly with the 3D model entities to set labels and draw text relative to the sheet coordinates. No ShopDrawing (sd_) or PaperSpace (_Viewport) specific APIs are used."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sheet"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Sheet elements",
          "requiredSettings": []
        }
      },
      "tokens_used": 4349,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity.go\",\n        \"promptOriginal\": \"\\n\" + T(\"|Select sheeting|\"+\"(s)\"),\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"ShowDynamicDialog\",\n      \"trigger\": \"_bOnInsert && insertCycleCount() <= 1\",\n      \"title\": null,\n      \"dataSource\": \"Script properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sChoice\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Tag on|\",\n      \"defaultValue\": \"|CUT|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|CUT|\",\n        \"|UNCUT|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"nStartNum\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Start count on|\",\n      \"defaultValue\": 1,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sPrefix\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Prefix|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"nColor\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Color|\",\n      \"defaultValue\": 1,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sDimstyle\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Dimstyle|\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": \"_DimStyles\",\n      \"category\": null,\n      \"description\": null\n    }\n  ],\n  \"contextMenu\": [],\n  \"settingsFiles\": []\n}\n```"
      },
      "tokens_used": 4379,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Identifies, filters, and labels sheathing panels (plywood/OSB) by distinguishing between standard full sheets (4'x8') and custom cut pieces.",
          "category": "Framing/Sheathing",
          "typicalUseCase": "Tagging a wall or roof assembly to create production lists, separating 'Uncut' (full order sheets) from 'Cut' (custom fabrication pieces) for material takeoff and shop labeling."
        },
        "parameters": [
          {
            "name": "sChoice",
            "technicalDefault": "|CUT|",
            "businessMeaning": "Determines which subset of sheets to process and label. 'Uncut' identifies standard 4'x8' sheets, while 'Cut' identifies all other sheets (trimmed, partial, or non-standard sizes).",
            "validRange": "|CUT|, |UNCUT|",
            "unit": "List",
            "affectsOutput": "Filters the selection; tags are only applied to sheets matching the chosen criteria."
          },
          {
            "name": "nStartNum",
            "technicalDefault": "1",
            "businessMeaning": "The starting integer for the numbering sequence.",
            "validRange": "1 to 999999",
            "unit": "Count",
            "affectsOutput": "Sets the numerical part of the label for the first piece in the sorted sequence (e.g., if set to 10, labels are 10, 11, 12...)."
          },
          {
            "name": "sPrefix",
            "technicalDefault": "",
            "businessMeaning": "A text string prepended to the numerical tag to identify a specific group, floor, or elevation.",
            "validRange": "Text string",
            "unit": "Text",
            "affectsOutput": "Modifies the label content (e.g., prefix 'A-' + number '1' becomes 'A-1')."
          },
          {
            "name": "nColor",
            "technicalDefault": "1",
            "businessMeaning": "The CAD Color Index (ACI) used to draw the tag text in the model space.",
            "validRange": "1 to 255",
            "unit": "Color Index",
            "affectsOutput": "Changes the visual color of the label on screen."
          },
          {
            "name": "sDimstyle",
            "technicalDefault": "Current Dimstyle",
            "businessMeaning": "Selects the Dimension Style from the drawing to control the text height, font, and appearance of the tag.",
            "validRange": "Existing Dimension Styles in the drawing",
            "unit": "Style Name",
            "affectsOutput": "Determines the size and font of the displayed label text."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change in sChoice, nStartNum, or sPrefix",
            "effect": "Forces a full recalculation of the sheet sorting and labeling sequence.",
            "cascade": [
              "ExecutionMode"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Sheet Label",
            "description": "Sets the Entity Label property of the Sheet object to the generated string (Prefix + Number).",
            "appliedTo": "Selected Sheet entities (filtered by Cut/Uncut status)."
          },
          {
            "type": "Text Annotation",
            "description": "Draws visual 3D text at the center of the sheet indicating the tag number.",
            "appliedTo": "Model Space (at sheet coordinates)."
          }
        ]
      },
      "tokens_used": 6635,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script: User executes the script from the hsbCAD menu or command line.",
          "2. Insertion Cycle Check: Script checks if it is a re-insertion cycle. If yes, execution stops to prevent duplicate processing.",
          "3. Properties Dialog: 'ShowDynamicDialog' displays the Properties Palette (OPM) for user configuration (Prefix, Start Num, Color, etc.).",
          "4. Entity Selection: Command line prompts 'Select sheeting(s)'. User selects one or more Sheet entities (nested/xRefs allowed).",
          "5. Selection Validation: Script checks if any sheets were actually selected.",
          "6. [Conditional] Empty Selection Handling: If selection is empty, the script erases itself and exits. If valid, proceed.",
          "7. Filtering & Classification: Script calculates dimensions and area of all selected sheets to classify them as 'CUT' (custom size) or 'UNCUT' (standard 4'x8').",
          "8. [Conditional] Mode Application: Depending on the 'Tag on' property (CUT or UNCUT), the script creates a working array of only the relevant sheets.",
          "9. Geometric Sorting: The script sorts the filtered sheets spatially into rows and columns based on their center points and envelope bodies.",
          "10. Label Assignment: A unique tag (Prefix + Number) is generated sequentially, assigned to the Sheet entity Label property, and stored in memory.",
          "11. Visual Output: Text tags are drawn in Model Space at the calculated offset position on each sheet using the specified Color and Dimstyle."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count > 1",
            "path1": {
              "name": "Early Exit",
              "steps": [
                "Erase current script instance",
                "Halt execution"
              ]
            },
            "path2": {
              "name": "Normal Execution",
              "steps": [
                "Show Properties Dialog",
                "Prompt for Entity Selection"
              ]
            }
          },
          {
            "condition": "Number of Selected Sheets == 0",
            "path1": {
              "name": "Self-Destruct",
              "steps": [
                "Erase script instance",
                "Exit (No sheets to process)"
              ]
            },
            "path2": {
              "name": "Process",
              "steps": [
                "Proceed to Filtering and Sorting logic"
              ]
            }
          },
          {
            "condition": "ExecutionMode (State Map)",
            "path1": {
              "name": "Calculation Mode (0)",
              "steps": [
                "Filter Cut/Uncut based on dimensions (96\"x48\")",
                "Sort spatially (Rows/Columns)",
                "Generate Labels",
                "Store coordinates for text",
                "Switch Mode to Display (1)"
              ]
            },
            "path2": {
              "name": "Display Mode (1)",
              "steps": [
                "Draw text at stored coordinates",
                "Skip calculation logic"
              ]
            }
          },
          {
            "condition": "Property 'Tag on' (sChoice)",
            "path1": {
              "name": "CUT",
              "steps": [
                "Filter logic excludes sheets matching 4'x8' within tolerance",
                "Process only custom-sized sheets"
              ]
            },
            "path2": {
              "name": "UNCUT",
              "steps": [
                "Filter logic includes only sheets matching 4'x8' (96x48) within tolerance",
                "Process only full sheets"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Selection",
            "errorMessage": "(None - Silent failure)",
            "recovery": "The script detects if _Sheet.length() is 0 immediately after selection. If so, it runs eraseInstance(), effectively canceling the operation. User must re-run the command and select entities."
          },
          {
            "check": "Sheet Validity (bIsValid)",
            "errorMessage": "(None)",
            "recovery": "During iteration, if a sheet is invalid, it is skipped via 'continue' without halting the script."
          },
          {
            "check": "Dimensional Tolerance",
            "errorMessage": "(None)",
            "recovery": "Determines Cut vs Uncut status. If Area is 32sqft AND dimensions are 96x48 inches (+/- 0.01 inch tolerance), it is 'Uncut'. Otherwise, it is 'Cut'."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Properties (OPM)",
            "how": "Select script instance in AutoCAD -> Properties Palette",
            "effect": "Changing 'Tag on', 'Start count on', or 'Prefix' resets ExecutionMode to 0, triggering a full re-sort and re-label. Changing 'Color' or 'Dimstyle' only triggers a visual redraw of the text."
          },
          {
            "action": "Move/Rotate Sheets",
            "how": "Standard AutoCAD Move/Rotate commands on the sheet entities",
            "effect": "Triggers _bOnRecalc. Script resets ExecutionMode to 0. The spatial sorting algorithm runs again to update the sequence and the text positions update to follow the sheets."
          },
          {
            "action": "Delete Sheets",
            "how": "Erase specific Sheet entities",
            "effect": "Triggers recalculation. Script filters out the deleted entities, re-sorts the remaining valid sheets, and updates the labels (numbers will shift to fill gaps)."
          }
        ]
      },
      "tokens_used": 7347,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_SHEET_TAG_CUT_UNCUT_PIECES.mcr\n\n## Overview\nThis script automates the tagging and labeling of sheathing panels (such as plywood or OSB) by distinguishing between standard full sheets (4'x8') and custom cut pieces. It is used to organize production lists and shop labeling by applying unique sequential tags to either the cut pieces or the full sheets based on your selection.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in Model Space where Sheet entities exist. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required entities**: Sheet (Sheathing) elements must exist in the model.\n- **Minimum sheet count**: 1 or more.\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_SHEET_TAG_CUT_UNCUT_PIECES.mcr`\n\n### Step 2: Configure Properties\nUpon insertion, the Properties Palette will display.\n**Action:** Adjust the settings before selecting entities if needed.\n- Set **Tag on** to `|CUT|` for partial sheets or `|UNCUT|` for full 4'x8' sheets.\n- Enter a **Prefix** (e.g., \"WALL-\") and **Start count on** number.\n- Select the desired **Color** and **Dimstyle** for the text tags.\n\n### Step 3: Select Sheeting\n```\nCommand Line: Select sheeting(s)\nAction: Click on the sheet entities you wish to process. You can select multiple sheets or use a window selection.\n```\n**Action:** Press `Enter` to confirm selection.\n\n### Step 4: Processing\nThe script will automatically filter the selected sheets based on the \"Tag on\" setting, sort them spatially, and apply the labels. Text tags will appear at the center of the qualifying sheets.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Tag on | dropdown | |CUT| | Determines which subset of sheets to process. Choose `|CUT|` for custom-sized pieces or `|UNCUT|` for standard full sheets (4'x8'). |\n| Start count on | number | 1 | The starting integer for the numbering sequence (e.g., set to 10 to start numbering at 10, 11, 12...). |\n| Prefix | text | | A text string added to the beginning of the label (e.g., if Prefix is \"A\" and Start is 1, the label reads \"A1\"). |\n| Color | number | 1 | The AutoCAD Color Index (ACI) used for the text tag (1 = Red, etc.). |\n| Dimstyle | dropdown | *Current* | Selects the Dimension Style from the drawing to control the text height and font of the tag. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are added by this script. Use the Properties Palette to modify settings. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Standard Size Definition**: The script defines an \"Uncut\" sheet as a piece with an area of 32 sq.ft. and dimensions of exactly 96\" x 48\" (within a small tolerance). Any sheet deviating from this (even slightly) is considered \"Cut\".\n- **Updating Tags**: If you move or rotate the sheets after tagging, the script will automatically recalculate. The text tags will move with the sheets, and the numbering order will update based on the new spatial arrangement.\n- **Re-ordering**: If you change the \"Start count on\" or \"Prefix\" in the Properties Palette, the script will immediately re-sequence and redraw all labels.\n- **Selection**: If you select nothing during the prompt, the script instance will erase itself automatically.\n\n## FAQ\n- **Q: Why are my full 4'x8' sheets not showing up when I select \"UNCUT\"?**\n  A: Check your dimensions. The script uses a strict tolerance of +/- 0.01 inches. If your sheet is modeled as 95.99\" or 48.01\", it may be classified as \"Cut\".\n- **Q: What happens if I delete a sheet that has been tagged?**\n  A: The script will detect the deletion and automatically renumber the remaining sheets to close the gap in the sequence.\n- **Q: Can I tag both cut and uncut sheets at the same time?**\n  A: No, you must run the script once for \"CUT\" pieces and once for \"UNCUT\" pieces (or insert two instances of the script with different settings)."
      },
      "tokens_used": 6057,
      "error": null
    }
  }
}