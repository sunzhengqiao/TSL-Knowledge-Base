{
  "filename": "hsbItemClone.mcr",
  "status": "completed",
  "total_tokens": 49863,
  "processing_time": 373.99165534973145,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9283,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit use of _kModelSpace in dbCreate() and collectEntities(). No #Type E entity array found in signature or _Viewport usage. Script generates a flattened layout of 'clones' in the 3D model using calculated coordinates (ptPlan, ptRow) and executes eraseInstance() upon completion."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Sheet",
            "Beam",
            "Sip",
            "TslInst"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbItemClone.xml"
          ]
        }
      },
      "tokens_used": 7823,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 3,
            "variable": "sRule",
            "type": "PropString",
            "displayName": "Rule",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "<Disabled>",
              "<Dynamic list from FilterRule[]>"
            ],
            "category": "Item",
            "description": "Specifies a filter rule."
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "hsbItemClone.xml",
            "searchPaths": [
              "%hsbCompany%\\TSL\\Settings"
            ],
            "purpose": "Stores configuration for filter rules, sorting logic, display parameters (dimensions, colors, linetypes), and layout settings (MaxRowLength, Interdistance).",
            "required": false
          }
        ]
      },
      "tokens_used": 8318,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a flattened 2D overview layout of timber elements (beams, panels) sorted by specific criteria for production planning or verification.",
          "category": "Production/ShopDrawing",
          "typicalUseCase": "Creating a 'bill of materials' visual layout in model space to check part dimensions, counts, and grain direction before manufacturing or exporting."
        },
        "parameters": [
          {
            "name": "sRule",
            "technicalDefault": "\"<Disabled>\"",
            "businessMeaning": "Selects a specific filter configuration to determine which elements from the 3D model are included in the cloned layout (e.g., 'Floor 1 Walls', 'Roof Beams').",
            "validRange": "List of strings defined in hsbItemClone.xml",
            "unit": "String",
            "affectsOutput": "Filters the input set of entities, determining which items get cloned and displayed in the layout."
          },
          {
            "name": "dMaxRowLength",
            "technicalDefault": "U(25000)",
            "businessMeaning": "Defines the maximum width of a single row in the layout. Items exceeding this length wrap to the next row.",
            "validRange": "1000 - 100000 (depending on project size)",
            "unit": "mm",
            "affectsOutput": "Controls the wrapping logic of the layout grid, affecting the total bounding box and row count of the generated overview."
          },
          {
            "name": "dDistToNext",
            "technicalDefault": "U(500)",
            "businessMeaning": "Sets the spacing (gap) between individual cloned items in the layout.",
            "validRange": "10 - 2000",
            "unit": "mm",
            "affectsOutput": "Adjusts the horizontal and vertical spacing between parts, affecting the readability and total spread of the layout."
          },
          {
            "name": "nDisplayMode",
            "technicalDefault": "0",
            "businessMeaning": "Toggles the geometric detail level of the cloned items. 0 typically shows the envelope (outline), while 1 shows the real body (includes machining/holes).",
            "validRange": "0 - 1",
            "unit": "Integer",
            "affectsOutput": "Switches the visual representation between simple bounding boxes and detailed geometry with all cuts and drillings visible."
          },
          {
            "name": "bIsBaufritz",
            "technicalDefault": "false (derived from ProjectSpecial)",
            "businessMeaning": "Flag indicating if the project uses specific Baufritz construction standards, enabling special grain direction checking logic.",
            "validRange": "true / false",
            "unit": "Boolean",
            "affectsOutput": "Activates specific grain direction symbol logic and coloring rules for panels if set to true."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sRule changes",
            "effect": "The collection of entities passed to the cloning function changes, resulting in a different set of items in the layout.",
            "cascade": [
              "dMaxRowLength",
              "Layout Row Count"
            ]
          },
          {
            "trigger": "dMaxRowLength decreases",
            "effect": "Items wrap to new rows more frequently, increasing the vertical height of the layout.",
            "cascade": [
              "Layout Bounding Box",
              "Row Count"
            ]
          },
          {
            "trigger": "nDisplayMode changes to 1",
            "effect": "The script uses realBody() instead of envelopeBody(), increasing calculation time and visual detail.",
            "cascade": [
              "Visual Complexity"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TslInst",
            "description": "Instances of the hsbItemClone script representing individual flattened items.",
            "appliedTo": "Model Space (Layout location)"
          },
          {
            "type": "PlaneProfile",
            "description": "2D geometric representations of the timber elements (shadows) drawn by the clone instances.",
            "appliedTo": "Each TslInst clone"
          },
          {
            "type": "Vector3d (Grain Arrow)",
            "description": "Visual indicators showing the wood grain direction for sheets and SIPs.",
            "appliedTo": "Sheet and Sip clones (if enabled)"
          }
        ]
      },
      "tokens_used": 9228,
      "error": null
    },
    "5": {
      "success": true,
      "data": {},
      "tokens_used": 10701,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbItemClone.mcr\n\n## Overview\nGenerates a 2D flattened layout of timber elements (beams, sheets, panels) directly in Model Space. This tool is used to create a visual overview or \"bill of materials\" layout for production planning, allowing you to verify dimensions, counts, and grain direction.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The layout is generated here. |\n| Paper Space | No | Not designed for Paper Space layout. |\n| Shop Drawing | No | This is a Model Space production tool. |\n\n## Prerequisites\n- **Required Entities**: At least one structural element (GenBeam, Sheet, Beam, Sip, or TslInst) must exist in the model.\n- **Minimum Beam Count**: 1\n- **Required Settings Files**: `hsbItemClone.xml` (Must be located in `%hsbCompany%\\TSL\\Settings`).\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Select `hsbItemClone.mcr` from the list.\n3. Click in the Model Space to insert the script instance.\n\n### Step 2: Configure Layout\n1. With the script instance selected, open the **Properties Palette** (Ctrl+1).\n2. Locate the **Item** category.\n3. Set the **Rule** (`sRule`) parameter to the desired filter (e.g., \"Floor 1 Walls\", \"Roof Beams\").\n4. Adjust layout parameters like **MaxRowLength** or **Distance to Next** as needed.\n   - *Note: The script will automatically execute the layout generation once parameters are changed.*\n\n### Step 3: Review Result\n1. The script will generate the cloned layout in the model.\n2. The original script instance will automatically delete itself (`eraseInstance`) upon completion.\n3. Navigate to the generated layout to verify the elements.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Rule | dropdown | \\<Disabled\\> | Selects a filter configuration (defined in XML) to determine which elements are included in the layout. |\n| dMaxRowLength | number | 25000 mm | Sets the maximum width of a row. Items will wrap to the next line if the row exceeds this length. |\n| dDistToNext | number | 500 mm | Defines the spacing (gap) between cloned items in the layout. |\n| nDisplayMode | integer | 0 | **0**: Shows simple outline (Envelope). **1**: Shows detailed geometry with cuts and holes (Real Body). |\n| bIsBaufritz | boolean | false | Enables special grain direction logic and coloring for Baufritz construction standards. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| (None detected) | This script executes automatically based on property changes and does not use custom context menu triggers. |\n\n## Settings Files\n- **Filename**: `hsbItemClone.xml`\n- **Location**: `%hsbCompany%\\TSL\\Settings`\n- **Purpose**: Stores the configuration for filter rules, sorting logic, display parameters (dimensions, colors, linetypes), and layout settings.\n\n## Tips\n- **Visual Verification**: Set `nDisplayMode` to **1** if you need to check for specific machining details or holes on the flattened parts.\n- **Optimizing Layout**: If your layout is too spread out vertically, decrease `dMaxRowLength`. If items are overlapping, increase `dDistToNext`.\n- **Grain Direction**: Ensure `bIsBaufritz` is checked correctly for your project standards to ensure the grain arrows on sheets/SIPs are accurate.\n\n## FAQ\n- **Q: Where did the script go after I changed the properties?**\n  **A:** This script is designed to run once (\"fire and forget\"). It generates the layout and then deletes the original script instance automatically to keep your drawing clean.\n- **Q: The \"Rule\" dropdown is empty or shows `<Disabled>` only.**\n  **A:** Check that `hsbItemClone.xml` exists in your company TSL folder and contains valid rule definitions.\n- **Q: How do I update the layout if I change the model?**\n  **A:** Insert the script again and re-run the process with the desired settings."
      },
      "tokens_used": 4510,
      "error": null
    }
  }
}