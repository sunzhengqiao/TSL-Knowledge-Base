{
  "filename": "GE_WALL_SPLICING.mcr",
  "status": "completed",
  "total_tokens": 53960,
  "processing_time": 560.8624320030212,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7472,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script selects ElementWallSF entities using PrEntity and modifies the 3D geometry database via Wall.dbSplit(). It uses Display(12) for drawing. No ShopDrawing (#Type E) or Viewport constructs are found."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF",
            "Wall"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Single Frame Wall elements",
          "requiredSettings": []
        }
      },
      "tokens_used": 7528,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"\\nSelect a set of elements\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"\\nSelect a distribution point\",\n        \"condition\": \"_bOnInsert AND strSide == 'Pick Point'\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"stEmpty1\",\n      \"type\": \"PropString\",\n      \"displayName\": \"BREAK PROPERTIES\",\n      \"defaultValue\": \"- - - - - - - - - - - - - - - -\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": \"Read-only header\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"pdMaxLength\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Max Wall Length\",\n      \"defaultValue\": 144.0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"strSide\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Starting Side\",\n      \"defaultValue\": \"Left\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Left\",\n        \"Right\",\n        \"Left on Zone\",\n        \"Right on Zone\",\n        \"Pick Point\",\n        \"Left - Right\",\n        \"Left - Right on  Zone\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"iZone\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"Zone Index\",\n      \"defaultValue\": 5,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        -5,\n        -4,\n        -3,\n        -2,\n        -1,\n        1,\n        2,\n        3,\n        4,\n        5\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"strWallSides\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Wall Sides\",\n      \"defaultValue\": \"Yes\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Yes\",\n        \"No\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"strWallCenters\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Wall Centerlines\",\n      \"defaultValue\": \"Yes\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Yes\",\n        \"No\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"strOpes\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Openings\",\n      \"defaultValue\": \"Sides\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Sides\",\n        \"In From Last Kings\",\n        \"None\"\n      ],\n      \"category\": null,\n      \"description\": null\n    }\n  ],\n  \"contextMenu\": [\n    {\n      \"menuItem\": \"Do The Splits\",\n      \"handler\": \"strSlip\",\n      \"action\": \"Splits the wall at the calculated or user-defined points (Wall.dbSplit). Erases the script instance afterwards.\",\n      \"alsoTriggeredBy\": null\n    },\n    {\n      \"menuItem\": \"Reset Split"
      },
      "tokens_used": 10628,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically calculates and visualizes split points for long walls to meet manufacturing or transport length constraints, and executes the splits upon command.",
          "category": "Framing / Manufacturing",
          "typicalUseCase": "When a designed wall exceeds the maximum transportable length (e.g., 60ft) or manufacturing bed length, this tool determines where to cut the wall into manageable segments (e.g., 12ft panels) while respecting openings and layer offsets."
        },
        "parameters": [
          {
            "name": "pdMaxLength",
            "technicalDefault": "144.0",
            "businessMeaning": "The maximum allowed length for a single wall segment or panel. Walls longer than this will be flagged for splitting.",
            "validRange": "120.0 to 780.0 (10ft to 65ft depending on transport/bed limits)",
            "unit": "inches",
            "affectsOutput": "Determines the interval at which split points are calculated along the wall length."
          },
          {
            "name": "strSide",
            "technicalDefault": "\"Left\"",
            "businessMeaning": "Defines the anchor point and direction of the splitting sequence. Controls whether splitting starts from the left, right, a specific wall layer, or a user-picked point.",
            "validRange": "List options: Left, Right, Left on Zone, Right on Zone, Pick Point, Left - Right, Left - Right on Zone",
            "unit": "N/A",
            "affectsOutput": "Determines the offset of the first split and the direction of subsequent splits. 'Left - Right' modes split from both ends towards the center."
          },
          {
            "name": "iZone",
            "technicalDefault": "5",
            "businessMeaning": "Identifies a specific wall layer (zone) to use as the geometric reference for splitting when 'Starting Side' is set to a zone-based option. Ensures splits align across multiple layers.",
            "validRange": "-5 to 5 (Integer)",
            "unit": "Index",
            "affectsOutput": "Shifts the reference start point to the boundary of the specified zone (e.g., inner leaf vs outer leaf)."
          },
          {
            "name": "strWallSides",
            "technicalDefault": "\"Yes\"",
            "businessMeaning": "Toggles the visualization of the wall's outer boundary lines.",
            "validRange": "Yes, No",
            "unit": "N/A",
            "affectsOutput": "Visual only. Hides or shows the outer profile lines in the model view."
          },
          {
            "name": "strWallCenters",
            "technicalDefault": "\"Yes\"",
            "businessMeaning": "Toggles the visualization of the wall's centerline.",
            "validRange": "Yes, No",
            "unit": "N/A",
            "affectsOutput": "Visual only. Hides or shows the centerline in the model view."
          },
          {
            "name": "strOpes",
            "technicalDefault": "\"Sides\"",
            "businessMeaning": "Strategy for handling wall openings (windows/doors) during the split calculation. Ensures splits occur at logical positions relative to rough openings.",
            "validRange": "Sides, In From Last Kings, None",
            "unit": "N/A",
            "affectsOutput": "Adds split points at the sides of openings or relative to the last 'king' stud. 'None' ignores openings."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "strSide is set to 'Left on Zone' or 'Right on Zone'",
            "effect": "The script uses the iZone parameter to find the reference edge.",
            "cascade": [
              "iZone"
            ]
          },
          {
            "trigger": "strSide is set to 'Pick Point'",
            "effect": "The user is prompted via command line to select a point in 3D space.",
            "cascade": []
          },
          {
            "trigger": "strOpes is set to 'Sides' or 'In From Last Kings'",
            "effect": "The script scans the wall for Opening entities to calculate additional split points.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Model Graphics",
            "description": "Temporary visualization lines (red/overlay) and text labels indicating split locations and distances.",
            "appliedTo": "Screen / Model Space (Non-destructive until executed)"
          },
          {
            "type": "Split Wall Elements",
            "description": "Upon executing 'Do The Splits', the original ElementWallSF is physically broken into multiple ElementWallSF instances at the calculated points.",
            "appliedTo": "Selected ElementWallSF"
          }
        ]
      },
      "tokens_used": 10629,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User launches script GE_WALL_SPLICING.mcr",
          "2. Script checks if running in Insert Mode (_bOnInsert)",
          "3. Dialog prompts for Initial Properties (via showDialogOnce)",
          "4. User selects a set of ElementWallSF entities (PrEntity)",
          "5. Script filters selection: keeps only walls longer than 'Max Wall Length'",
          "6. [Conditional] If 'Starting Side' is 'Pick Point', prompt user to select a distribution point",
          "7. Script clones itself onto each valid wall element, passing properties and map data",
          "8. Original script instance erases itself",
          "9. Cloned instances initialize: attach to element, calculate geometry",
          "10. Script validates wall outline; if wall length <= MaxLength, script erases itself (no split needed)",
          "11. Script determines 'Starting Side' logic to calculate automatic split points",
          "12. [Conditional] If 'Openings' != 'None', script adds split points at opening sides",
          "13. Script filters out invalid split points (inside openings or outside wall bounds)",
          "14. Script draws visualization (lines, markers, text) showing split locations and distances",
          "15. User can interactively add/remove split points or change reference point via context menu",
          "16. User executes 'Do The Splits' from context menu",
          "17. Script performs physical split (Wall.dbSplit) at valid points",
          "18. Script erases itself; wall is now divided into multiple elements"
        ],
        "conditionalBranches": [
          {
            "condition": "User selection during PrEntity",
            "path1": {
              "name": "Valid Long Wall Selected",
              "steps": [
                "Wall length > Max Wall Length",
                "Script clones onto wall",
                "Visualization shown"
              ]
            },
            "path2": {
              "name": "No Valid Wall Selected",
              "steps": [
                "Wall length <= Max Wall Length or wrong type",
                "Script erases itself",
                "No further action"
              ]
            }
          },
          {
            "condition": "Starting Side Property",
            "path1": {
              "name": "Pick Point Mode",
              "steps": [
                "Prompt getPoint appears on command line",
                "User selects point in 3D",
                "Reference point stored in Map"
              ]
            },
            "path2": {
              "name": "Automatic Modes (Left, Right, Zones, etc.)",
              "steps": [
                "Script calculates reference point based on wall geometry or Zone profile",
                "No user input required for reference point"
              ]
            }
          },
          {
            "condition": "Starting Side Strategy",
            "path1": {
              "name": "Left - Right / Zone",
              "steps": [
                "Calculates points from both ends towards center",
                "Points added at Max Length intervals from Left and Right simultaneously"
              ]
            },
            "path2": {
              "name": "Directional (Left, Right, Zones)",
              "steps": [
                "Calculates points from Start side only",
                "Points added at Max Length intervals sequentially"
              ]
            }
          },
          {
            "condition": "Do The Splits Execution",
            "path1": {
              "name": "Standard Split",
              "steps": [
                "Iterate through split points",
                "Execute Wall.dbSplit",
                "Append new element to list"
              ]
            },
            "path2": {
              "name": "Left - Right Split",
              "steps": [
                "Execute Standard Split",
                "Identify furthest right wall segment",
                "Set distribution type to 6 on that segment"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Wall Length vs Max Length",
            "errorMessage": "None explicit (Silent failure)",
            "recovery": "Script self-erases if wall is too short. User must select a longer wall or decrease 'Max Wall Length'."
          },
          {
            "check": "Element Validity",
            "errorMessage": "None explicit",
            "recovery": "Script erases if ElementWallSF is invalid. User must check wall integrity."
          },
          {
            "check": "Split Point Location",
            "errorMessage": "None explicit",
            "recovery": "Script automatically removes points that fall inside openings or outside the wall start/end bounds."
          },
          {
            "check": "Zone Existence",
            "errorMessage": "None explicit",
            "recovery": "If a specific Zone is requested but does not exist (returns 0 points), script defaults to the overall wall start/end points."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Add Split Point",
            "how": "Context Menu: 'Add Spliting Point'",
            "effect": "Prompts for point; adds to split calculation; updates visualization."
          },
          {
            "action": "Set Distribution Point",
            "how": "Context Menu: 'Set Distibution Point'",
            "effect": "Sets 'Starting Side' to 'Pick Point' and prompts for new location; recalculates all split points."
          },
          {
            "action": "Reset Split Points",
            "how": "Context Menu: 'Reset Splitable Points'",
            "effect": "Clears user-added points and recalculates based on current properties (Max Length, etc.)."
          },
          {
            "action": "Modify Properties",
            "how": "OPM / Properties Palette",
            "effect": "Changing Max Length, Side, or Zone triggers automatic recalculation of split points and redraws visualization."
          },
          {
            "action": "Execute Split",
            "how": "Context Menu: 'Do The Splits'",
            "effect": "Performs physical geometry modification (dbSplit), creates new wall elements, and removes the script instance."
          }
        ]
      },
      "tokens_used": 10666,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_WALL_SPLICING.mcr\n\n## Overview\nThis tool calculates and visualizes split points for long walls to meet manufacturing or transport length constraints. It allows you to preview where walls will be cut, manually adjust split locations, and then execute the breaks to create separate wall elements.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D Single Frame Wall elements. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Does not generate 2D drawing views. |\n\n## Prerequisites\n- **Required Entities**: `ElementWallSF` (Single Frame Wall).\n- **Minimum Count**: 1 wall element (walls shorter than the max length will be ignored automatically).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `GE_WALL_SPLICING.mcr`\n\n### Step 2: Select Walls\n```\nCommand Line: Select a set of elements\nAction: Click on the wall(s) you wish to check for splicing and press Enter.\n```\n*Note: The script will automatically ignore walls that are already shorter than the defined 'Max Wall Length'.*\n\n### Step 3: Review Visualization\nThe script will attach to the wall and draw red overlay lines and markers indicating where the wall will be split.\n\n### Step 4: Adjust Configuration (Optional)\nSelect the wall (the script instance is attached to it) and open the **Properties Palette** (Ctrl+1). Adjust parameters like *Max Wall Length* or *Starting Side* to see the split points update automatically.\n\n### Step 5: Modify Split Points (Optional)\nRight-click on the wall to access context menu options:\n- Select **Set Distibution Point** if you want to define a custom start location in the model.\n- Select **Add Spliting Point** to manually insert a split where the automatic logic did not place one.\n- Select **Reset Splitable Points** to clear all manual changes and revert to the automatic calculation.\n\n### Step 6: Execute Splits\n```\nAction: Right-click the wall → Select \"Do The Splits\"\n```\nThe wall will be physically broken into separate elements at the calculated points, and the script instance will remove itself.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| BREAK PROPERTIES | Header | - | Visual separator only. |\n| Max Wall Length | Number | 144.0 | The maximum allowed length for a single wall segment (in inches). Walls longer than this will be split. |\n| Starting Side | Dropdown | Left | Determines the anchor and direction of splitting. Options include Left, Right, Left on Zone, Right on Zone, Pick Point, or Left - Right (splits from both ends towards center). |\n| Zone Index | Dropdown | 5 | Specifies which wall layer (zone) to use as the geometric reference when \"Starting Side\" is set to a Zone option. |\n| Wall Sides | Dropdown | Yes | Toggles the visibility of the wall's outer boundary lines in the visualization. |\n| Wall Centerlines | Dropdown | Yes | Toggles the visibility of the wall's centerline in the visualization. |\n| Openings | Dropdown | Sides | Strategy for handling windows/doors. \"Sides\" adds splits at opening edges; \"In From Last Kings\" offsets from trimmers; \"None\" ignores openings. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Do The Splits | Executes the physical split operation at the calculated points. The script instance is deleted after this action. |\n| Reset Splitable Points | Removes any manually added split points and recalculates the layout based on current properties. |\n| Add Spliting Point | Prompts you to click a location on the wall to manually add a specific split point. |\n| Set Distibution Point | Changes the \"Starting Side\" mode to \"Pick Point\" and prompts you to select a new 3D reference point for the split calculation. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies entirely on Properties Palette inputs; no external settings files are required.\n\n## Tips\n- **Visualization Clutter**: If the model view becomes too cluttered, set the *Wall Sides* and *Wall Centerlines* properties to \"No\" to show only the split markers.\n- **Long Walls**: For very long walls, use the \"Left - Right\" mode under *Starting Side*. This calculates splits from both ends of the wall towards the center, which is often structurally preferable.\n- **Double Stud Walls**: If working with double walls, use the *Zone Index* property to ensure splits align with a specific leaf (e.g., the inner or outer layer) rather than the centerline.\n- **Undo**: You can use the standard AutoCAD `UNDO` command immediately after executing \"Do The Splits\" if the result is not as expected.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the wall?**\n  **A**: This happens if the selected wall's length is less than or equal to the *Max Wall Length*. The script determines no split is needed and removes itself to save resources. Try decreasing the *Max Wall Length* property before running the script.\n  \n- **Q: Can I undo the split operation?**\n  **A**: Yes. Immediately after running \"Do The Splits\", you can use the standard `UNDO` command in AutoCAD to revert the wall to its original single piece.\n\n- **Q: How do I make sure the split doesn't cut through a window?**\n  **A**: Set the *Openings* property to \"Sides\". This forces the script to calculate split points at the sides of openings (windows/doors) rather than allowing a split line to intersect them."
      },
      "tokens_used": 7037,
      "error": null
    }
  }
}