{
  "filename": "hsbCLT-Presorter.mcr",
  "status": "completed",
  "total_tokens": 39275,
  "processing_time": 1291.248475074768,
  "passes": {
    "1": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "API error 429: {\"error\":{\"code\":\"1302\",\"message\":\"您的账户已达到速率限制，请您控制请求频率\"}}"
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit creation of TSL instances using _kModelSpace in dbCreate(). Script operates on ChildPanel entities within the 3D model, performs geometric rotations and transformations (CoordSys, transformBy), and handles 3D realBody coordinates."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "ChildPanel"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbCLT-MasterPanelManager",
            "TslUtilities.dll"
          ]
        }
      },
      "tokens_used": 6574,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select child panels to trace|, |<Enter> = all|\",\n        \"condition\": \"_bOnRecalc && (_kExecuteKey=='../|Show Dependencies|' || _kExecuteKey=='TslDoubleClick')\",\n        \"required\": false\n      },\n      {\n        \"step\": 2,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select child panels|\",\n        \"condition\": \"_bOnRecalc && (Rotate/Flip Triggers)\",\n        \"required\": false\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"bDebug\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"bDebug\",\n      \"defaultValue\": \"1\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sFaceAlignment\",\n      \"type\": \"PropString\",\n      \"displayName\": \"sFaceAlignment\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"sPropOptionsAlignment\"\n      ],\n      \"category\": \"|Alignment|\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sChildProperties\",\n      \"type\": \"PropString\",\n      \"displayName\": \"sChildProperties\",\n      \"defaultValue\": \"|All|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"sPropOptionsChildProperties\"\n      ],\n      \"category\": \"|Childpanel|\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sRule\",\n      \"type\": \"PropString\",\n      \"displayName\": \"sRule\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"|Catalog Entries|\",\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sSortingDir\",\n      \"type\": \"PropString\",\n      \"displayName\": \"sSortingDir\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"sPropOptionsSorting\"\n      ],\n      \"category\": \"|Sorting|\",\n      \"description\": null\n    }\n  ],\n  \"contextMenu\": [\n    {\n      \"menuItem\": \"../|Show Dependencies|\",\n      \"handler\": \"../|Show Dependencies|\",\n      \"action\": \"Toggles the display of trace lines connecting child panels to their parent elements\",\n      \"alsoTriggeredBy\": \"TslDoubleClick\"\n    },\n    {\n      \"menuItem\": \"../|Hide Dependencies|\",\n      \"handler\": \"../|Hide Dependencies|\",\n      \"action\": \"Hides the trace lines connecting child panels to their parent elements\",\n      \"alsoTriggeredBy\": null\n    },\n    {\n      \"menuItem\": \"../|Rotate All 90°|\",\n      \"handler\": \"../|Rotate All 90°|\",\n      \"action\": \"Rotates all associated child panels 90 degrees around the script's Z-axis\",\n      \"alsoTriggeredBy\": null\n    },\n    {\n      \"menuItem\": \"../|Rotate 90°|\",\n      \"handler\": \"../|Rotate 90°|\",\n      \"action\": \"Prompts user to select child panels and rotates them 90 degrees\",\n      \"alsoTriggeredBy\": null\n    },\n    {\n      \"menuItem\": \"../|Rotate 180°|\",\n      \"handler\": \"../|Rotate 180°|\",\n      \"action\": \"Prompts user to select child panels and rotates them 180 degrees\",\n      \"alsoTriggeredBy\": null\n    },\n    {\n      \"menuItem\": \"../|Flip + Rotate Child|\",\n      \"handler\": \"../|Flip + Rotate Child|\",\n      \"action\": \"Prompts user to select child panels, flips them, and rotates"
      },
      "tokens_used": 9768,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Organizes CLT child panels into logical groups (packages) for production, applies sorting rules, displays group information labels, and prepares data for the nesting optimization process.",
          "category": "Data Management / Pre-Production",
          "typicalUseCase": "Used after generating CLT wall/floor panels to group them by properties like width, material, or surface quality before running the MasterPanelManager for layout optimization."
        },
        "parameters": [
          {
            "name": "bDebug",
            "technicalDefault": "1",
            "businessMeaning": "Enables developer mode to visualize calculations and debug information in the drawing.",
            "validRange": "0 (Off) or 1 (On)",
            "unit": "Boolean",
            "affectsOutput": "Displays additional geometry or text overlays in the 3D model for troubleshooting."
          },
          {
            "name": "sFaceAlignment",
            "technicalDefault": "",
            "businessMeaning": "Determines the side relative to the panels where the group header text is displayed.",
            "validRange": "Left / Right (Defined in sPropOptionsAlignment)",
            "unit": "Orientation",
            "affectsOutput": "Moves the informational text label to the left or right side of the grouped panels."
          },
          {
            "name": "sChildProperties",
            "technicalDefault": "|All|",
            "businessMeaning": "Filters which property values are displayed in the group header label (e.g., Material, Thickness, Grade).",
            "validRange": "Any valid panel property string (e.g., 'Material,Grade,Length')",
            "unit": "Text",
            "affectsOutput": "Changes the content of the text label displayed above the grouped panels."
          },
          {
            "name": "sRule",
            "technicalDefault": "",
            "businessMeaning": "Specifies the sorting or grouping criteria to apply, referencing rules defined in the external 'hsbCLT-MasterPanelManager' settings.",
            "validRange": "Any rule name defined in MasterPanelManager settings (e.g., 'SortByWidthRange', 'SortByMaterial')",
            "unit": "String",
            "affectsOutput": "Determines which panels are grouped together and how they are ordered within the 3D model."
          },
          {
            "name": "sSortingDir",
            "technicalDefault": "",
            "businessMeaning": "Sets the direction of the sorting order (Ascending or Descending).",
            "validRange": "Ascending / Descending",
            "unit": "Sequence",
            "affectsOutput": "Reverses the order of child panels within the group layout."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Rotation/Flip Commands (Context Menu)",
            "effect": "Updates the geometric position of Child Panels and forces a script refresh.",
            "cascade": [
              "UpdateLocation"
            ]
          },
          {
            "trigger": "sRule Change",
            "effect": "Re-evaluates group membership based on external MasterPanelManager settings.",
            "cascade": [
              "Group Membership",
              "Header Text"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Group Header Text",
            "description": "Visual annotation displaying properties like dimensions, material, or grade for the specific group of panels.",
            "appliedTo": "Model Space (above grouped ChildPanels)"
          },
          {
            "type": "ChildPanel Modification",
            "description": "Geometric transformations (Rotation/Flip) applied to CLT panels to align them for nesting.",
            "appliedTo": "Selected ChildPanel Entities"
          },
          {
            "type": "MapX Data",
            "description": "Embeds grouping tags (presorter) and default width data into the panel entities for use by downstream scripts.",
            "appliedTo": "ChildPanel Entities"
          }
        ]
      },
      "tokens_used": 9411,
      "error": null
    },
    "5": {
      "success": true,
      "data": {},
      "tokens_used": 8282,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-Presorter.mcr\n\n## Overview\nThis script organizes CLT child panels into logical groups for production, applies sorting rules, and displays group information labels. It prepares panel data for nesting optimization by allowing manual rotation, flipping, and property visualization.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for 3D model manipulation of CLT panels. |\n| Paper Space | No | Not applicable. |\n| Shop Drawing | No | Not applicable. |\n\n## Prerequisites\n- **Required Entities**: CLT Elements and ChildPanels must exist in the model.\n- **Required Settings**: `hsbCLT-MasterPanelManager` (defines sorting rules).\n- **External Libraries**: `TslUtilities.dll` (for dialog utilities).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsbCLT-Presorter.mcr`\n\n### Step 2: Select Panels\n```\nCommand Line: Select child panels to trace\nAction: Click on the specific CLT child panels you want to include in the sorting group. Press Enter to select all visible child panels.\n```\n\n### Step 3: Configure Properties\nAfter insertion, select the script instance in the model and open the **Properties Palette** (Ctrl+1) to set sorting rules and label preferences.\n\n### Step 4: Run Sorting\nOnce properties are set, the script will automatically group the panels and update the display labels in the 3D model.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| bDebug | number | 1 | Enables debug mode to show calculation details and geometry overlays. Set to 0 to hide. |\n| sFaceAlignment | dropdown | (Empty) | Sets the alignment of the group header text relative to the panels (e.g., Left or Right). |\n| sChildProperties | dropdown | \\|All\\| | Determines which properties are displayed in the group header label (e.g., Material, Grade, Dimensions). |\n| sRule | text | (Empty) | Specifies the sorting rule name defined in the hsbCLT-MasterPanelManager (e.g., 'SortByWidth'). |\n| sSortingDir | dropdown | (Empty) | Sets the sorting direction order (Ascending or Descending). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Show Dependencies | Toggles the display of trace lines connecting child panels to their parent elements. |\n| Hide Dependencies | Hides the trace lines connecting child panels to their parent elements. |\n| Rotate All 90° | Rotates all associated child panels 90 degrees around the script's Z-axis instantly. |\n| Rotate 90° | Prompts you to select specific child panels and rotates them 90 degrees. |\n| Rotate 180° | Prompts you to select specific child panels and rotates them 180 degrees. |\n| Flip + Rotate Child | Prompts you to select specific child panels, flips them, and applies rotation. |\n\n## Settings Files\n- **Filename**: `hsbCLT-MasterPanelManager`\n- **Location**: Company standard or hsbCAD install path.\n- **Purpose**: Contains the definitions for sorting rules referenced by the `sRule` parameter (e.g., grouping logic, default widths).\n\n## Tips\n- Use the **Rotate All 90°** context menu option to quickly adjust all panels in a group to fit a specific production layout.\n- Double-clicking the script instance triggers the \"Show Dependencies\" command, allowing you to quickly verify which parent elements are associated with the sorted panels.\n- Ensure your `sRule` parameter exactly matches the name defined in your MasterPanelManager settings to avoid grouping errors.\n\n## FAQ\n- Q: How do I change what information is shown on the group label?\n- A: Select the script instance, open Properties (Ctrl+1), and change the **sChildProperties** dropdown from \"All\" to a specific subset like \"Material\" or \"Length\".\n- Q: Why aren't my panels sorting correctly?\n- A: Verify that the **sRule** property matches a rule name defined in your `hsbCLT-MasterPanelManager` settings file.\n- Q: Can I rotate just one panel instead of the whole group?\n- A: Yes, right-click the script instance and select **Rotate 90°** or **Rotate 180°**, then click only the specific panel you wish to modify."
      },
      "tokens_used": 5240,
      "error": null
    }
  }
}