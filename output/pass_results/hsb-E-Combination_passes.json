{
  "filename": "hsb-E-Combination.mcr",
  "status": "completed",
  "total_tokens": 49730,
  "processing_time": 282.4709429740906,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9136,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script primarily generates geometry and tools (GenBeam/Element operations) in ModelSpace, indicated by variable usage like `mo` (MapObject) and interaction with `_Pt0`. It utilizes DisplayPrimitives (`dpPlanMillimeter`, `dpPlanElectrical`, `dpElement`) which render to Paper Space or Element drawings, indicating Paper Space support. It lacks the `#Type E` / `_Entity[]` signature typical of ShopDrawing scripts or `Multipage*` prefixes."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element",
            "Body"
          ],
          "minimumBeams": 0,
          "requiredSpace": "hsbCAD environment with access to specific file directories.",
          "requiredSettings": [
            "Block definitions in <hsbCompany>\\Block\\Electrical",
            "hsbInstallationPoint.mcr",
            "<hsbCAD>\\custom\\hsbElectricalTsl.dll",
            "XML Settings file in <company>\\tsl\\settings (optional for import/export triggers)"
          ]
        }
      },
      "tokens_used": 5681,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": [],
          "interactions": [
            {
              "function": "getString",
              "promptOriginal": "|Are you sure to overwrite existing settings?| [|No|]/[|Yes|]",
              "condition": "Export Settings trigger selected and file exists",
              "purpose": "Confirm overwriting existing XML settings file"
            }
          ]
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [
          {
            "menuItem": "|Hide Leader| / |Show Leader|",
            "handler": "showLeader",
            "action": "Toggles the visibility of the leader line in the plan annotation.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Import Settings|",
            "handler": "sTriggerImportSettings",
            "action": "Imports script configuration from an external XML file located at the specified settings path.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Export Settings|",
            "handler": "sTriggerExportSettings",
            "action": "Exports the current script configuration to an external XML file.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "XML Configuration File (Variable: sFullPath)",
            "searchPaths": [
              "<hsbCompany>\\tsl\\settings",
              "<custom_path_defined_by_script>"
            ],
            "purpose": "Storage for Import/Export of script configuration settings (MapObject mapSetting).",
            "required": false
          }
        ]
      },
      "tokens_used": 8860,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Generates electrical installation combinations (e.g., sockets, switches, junction boxes) including 2D symbols, 3D solid machining (drilling/milling), and detailed annotations for plans and shop drawings.\",\n    \"category\": \"Electrical/Mechanical Installation\",\n    \"typicalUseCase\": \"Placing a electrical switch or socket box into a timber wall, defining its height and position, and ensuring the CNC machine cuts the correct hole while the floor plan displays the correct symbol and elevation.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"showLeader\",\n      \"technicalDefault\": \"true (1)\",\n      \"businessMeaning\": \"Toggles the visibility of the leader line connecting the electrical symbol/text annotation to the actual insertion point in the drawing.\",\n      \"validRange\": \"Boolean (0 or 1)\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"In Plan and Element views, adds or removes a polyline leader pointing from the text block to the component location.\"\n    },\n    {\n      \"name\": \"mapSetting\",\n      \"technicalDefault\": \"Empty Map\",\n      \"businessMeaning\": \"Container for the script's configuration including block definitions, machining depths, offsets, and text styles. It is saved/loaded via XML.\",\n      \"validRange\": \"Valid XML Structure / File Path\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"Alters the entire behavior of the instance: changes the symbol used, text height, drilling diameter, milling depth, and material clearances.\"\n    },\n    {\n      \"name\": \"sDesc1\",\n      \"technicalDefault\": \"Empty String \\\"\\\"\",\n      \"businessMeaning\": \"First line of custom user description or note added to the annotation label (e.g., 'Living Room').\",\n      \"validRange\": \"Text String\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Appends an extra line of text to the annotation in both Plan (Millimeter/Electrical) and Element views.\"\n    },\n    {\n      \"name\": \"sDesc2\",\n      \"technicalDefault\": \"Empty String \\\"\\\"\",\n      \"businessMeaning\": \"Second line of custom user description or note added to the annotation label (e.g., 'Circuit A1').\",\n      \"validRange\": \"Text String\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Appends a second extra line of text to the annotation in both Plan (Millimeter/Electrical) and Element views.\"\n    },\n    {\n      \"name\": \"ElevationTextMM\",\n      \"technicalDefault\": \"Derived from parent map\",\n      \"businessMeaning\": \"The installation height of the combination relative to the project zero, formatted in millimeters (e.g., '+1050').\",\n      \"validRange\": \"Numeric String\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Updates the elevation line displayed in the Plan Millimeter view.\"\n    },\n    {\n      \"name\": \"ElevationTextM\",\n      \"technicalDefault\": \"Derived from parent map\",\n      \"businessMeaning\": \"The installation height of the combination relative to the project zero, formatted in meters (e.g., '+1.050').\",\n      \"validRange\": \"Numeric String\",\n      \"unit\": \"m\",\n      \"affectsOutput\": \"Updates the elevation line displayed in the Plan Meter view (if active).\"\n    },\n    {\n      \"name\": \"nProjectSpecial\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"A project-specific flag that determines if dual-unit (Meter and Millimeter) annotations are required.\",\n      \"validRange\": \"Integer (0 or 1)\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"If set to 1, enables the rendering of the 'Plan Meter' text annotation alongside the standard Millimeter text.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"Context Menu: |Import Settings|\",\n      \"effect\": \"Overwrites the current instance configuration with data from an external XML file.\",\n      \"cascade\": [\n        \"mapSetting\",\n        \"Milling parameters\",\n        \"Text styles\",\n        \"Block references\"\n      ]\n    },\n    {\n      \"trigger\": \"Context Menu: |Export Settings|\",\n      \"effect\": \"Writes the current instance configuration to an external XML file.\",\n      \"cascade\": [\n        \"mapSetting\"\n      ]\n    },\n    {\n      \"trigger\": \"Context Menu: |Hide Leader| / |Show Leader|\",\n      \"effect\": \"Toggles the 'showLeader' state variable in the Map.\",\n      \"cascade\": [\n        \"showLeader\",\n        \"Leader Line visibility\"\n      ]\n    }\n  ],\n  \"outputEntities\": [\n    {\n      \"type\": \"2D Annotation (Text)\",\n      \"description\": \"Text lines displaying Elevation, Parent Description, and Custom User Descriptions.\",\n      \"ap"
      },
      "tokens_used": 9861,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Initialization: Determine execution context (Insert vs. Recalculation).\",\n    \"2. Configuration Loading: Attempt to retrieve settings from MapObject (mo). If invalid or missing, load local defaults or create new MapObject.\",\n    \"3. Path Resolution: Resolve the full file path (sFullPath) for the XML settings file located in <company>\\\\tsl\\\\settings.\",\n    \"4. Geometry Processing: Detect structural elements (GenBeams/Walls) and calculate intersection points (ptInt) and frame profile (plFrame) relative to insertion point (_Pt0).\",\n    \"5. Annotation Generation (Plan/Element Views):\",\n    \"   a. Determine text content (Elevation, Parent Desc, sDesc1, sDesc2) based on view mode (Plan vs Element).\",\n    \"   b. Calculate text position (ptTxt) and Leader line geometry (ptStart, ptEnd).\",\n    \"   c. Render text and polylines to respective DisplayPrimitives (dpPlanMillimeter, dpPlanElectrical, dpElement, dpPlanMeter).\",\n    \"6. Internal Data Update: Write the script's Handle/ID to InternalMapX.\",\n    \"7. Context Menu Registration: Add triggers for Leader visibility and Settings Import/Export based on current state and file existence.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Existence of XML Settings File (Import)\",\n      \"path1\": {\n        \"name\": \"File Exists\",\n        \"steps\": [\n          \"addRecalcTrigger creates '|Import Settings|' menu item.\",\n          \"User selects item -> mapSetting.readFromXmlFile(sFullPath) executes.\",\n          \"MapObject is updated and script recalculates.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"File Not Found\",\n        \"steps\": [\n         "
      },
      "tokens_used": 11031,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb-E-Combination\n\n## Overview\nThis script inserts electrical installation combinations (such as sockets, switches, or junction boxes) into your timber model. It automatically generates 3D machining (drilling/milling) on structural elements and produces detailed 2D annotations, including elevation heights and custom text, for floor plans and element drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script is inserted and creates 3D machining here. |\n| Paper Space | Yes | 2D symbols and annotations are rendered via Display Primitives. |\n| Shop Drawing | No | This is a model-space script, though it annotates element views. |\n\n## Prerequisites\n- **Required Entities**: GenBeams, Elements, or Bodies to machine into.\n- **Minimum Beams**: 0 (Script detects existing beams automatically).\n- **Required Settings**:\n  - Block definitions located in `<hsbCompany>\\Block\\Electrical`.\n  - `hsbElectricalTsl.dll` located in `<hsbCAD>\\custom\\`.\n  - `hsbInstallationPoint.mcr` (likely dependency).\n\n## Usage Steps\n\n### Step 1: Launch Script\n```\nCommand: TSLINSERT\nAction: Select hsb-E-Combination.mcr from the file list.\n```\n\n### Step 2: Insert and Locate\n```\nCommand Line: [Insertion point prompt varies based on hsbCAD configuration]\nAction: Click in the drawing to place the electrical combination. The script will automatically detect intersecting structural elements (walls/floors) to apply machining.\n```\n\n### Step 3: Configure Properties\nAfter insertion, select the script instance and open the **Properties Palette** (Ctrl+1) to adjust text descriptions and visibility settings.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **showLeader** | Boolean | 1 (True) | Toggles the visibility of the leader line connecting the text annotation to the insertion point. |\n| **sDesc1** | String | \"\" | First line of custom description text (e.g., \"Living Room\"). |\n| **sDesc2** | String | \"\" | Second line of custom description text (e.g., \"Circuit A1\"). |\n| **ElevationTextMM** | String | Derived | The installation height relative to project zero, displayed in millimeters (e.g., \"+1050\"). |\n| **ElevationTextM** | String | Derived | The installation height relative to project zero, displayed in meters (e.g., \"+1.050\"). |\n| **nProjectSpecial** | Integer | 0 | Set to 1 to enable dual-unit annotations (showing both Millimeter and Meter heights simultaneously). |\n| **mapSetting** | Map | Empty | Internal configuration container for block names, machining depths, and styles. This is primarily managed via Import/Export context menus. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Hide Leader / Show Leader** | Toggles the visibility of the leader line in the plan annotation without opening the properties palette. |\n| **Import Settings** | Loads configuration data (blocks, text styles, dimensions) from an external XML file located in the company settings folder. |\n| **Export Settings** | Saves the current instance configuration to an external XML file. Useful for backing up settings or sharing them with other users. |\n\n## Settings Files\n- **Filename**: `XML Configuration File` (Variable: `sFullPath`)\n- **Location**: `<hsbCompany>\\tsl\\settings`\n- **Purpose**: Stores the script configuration (MapObject `mapSetting`) including machining depths, block references, and text styles. This allows for standardizing electrical setups across a project.\n\n## Tips\n- **Standardization**: Configure one electrical combination exactly as needed (correct height, symbol, and text style), use the **Export Settings** context menu to save it, and then use **Import Settings** on other instances to ensure consistency.\n- **Annotation Control**: Use the `nProjectSpecial` property if your architectural plans require elevations in both Meters and Millimeters.\n- **Clarity**: If plan views become too cluttered, use the **Hide Leader** context menu option to remove the leader lines while keeping the text labels.\n\n## FAQ\n- **Q: The leader line is pointing in the wrong direction. How do I fix it?**\n  **A:** Currently, this script toggles leader visibility but does not provide a grip to rotate the leader direction in the Properties Palette. You may need to adjust the insertion point or check the block definition behavior.\n- **Q: Can I change the symbol used for the socket?**\n  **A:** The symbol is determined by the `mapSetting`. You should configure the appropriate block reference within the settings or Import Settings from a preset configuration that uses the desired symbol."
      },
      "tokens_used": 5161,
      "error": null
    }
  }
}