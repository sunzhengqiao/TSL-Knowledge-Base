{
  "filename": "GE_PLOT_A4_LAYOUT.mcr",
  "status": "completed",
  "total_tokens": 55424,
  "processing_time": 537.8717648983002,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "15.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Copied from hsb_A4 Layout, to keep US content folder naming standards\n- Thumbnail added"
          },
          {
            "version": "1.56",
            "date": "15.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Version control from 1.0 to 1.56, to keep updated with hsb_A4 Layout"
          },
          {
            "version": "1.57",
            "date": "24.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Option to show vertical dimline names: \"Blocking\", \"Opening\", \"Wall height\" (No/Yes)\n- Option to move vertical blocking dimline to left/right side of element \n- Offset from element for vertical blocking dimline (when at left side)\n- Option to define dimpoints for blocking dimension line (bottom, center or top of blocking)"
          },
          {
            "version": "1.58",
            "date": "26.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Bugfix: Dimensioning of opening was not OK, corrected to be size of rough opening.\n- Applied dimstyle to opening dimensioning (when text on center of opening)\t"
          },
          {
            "version": "1.59",
            "date": "07.apr.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Dimline for openings now split: one delta and one cummulus\n- PropDouble \"Offset for cummulative opening dimension\" added (separate 2 resulting dimlines from item before)\n- Added _kSFVeryTopPlate type to nBmTypeValidForConvex array"
          },
          {
            "version": "1.60",
            "date": "09.oct.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Running dimension values now is offset from _Pt0 instead from element's origin\n- Running dimension lines now is offset from _Pt0 instead from element's origin\n- Added \"Show Delta Opening Dimension\" (yes/no) property"
          },
          {
            "version": "1.61",
            "date": "11.oct.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Added \"Show Element Dimension\" (Yes/No) property\n- Show jacks length at side of beam center\n- Applied formatUnit jacks length\n- Applied formatUnit rough opening size\n- Applied formatUnit header/sill length"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 9276,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": false,
          "detectionEvidence": "Script filename and content indicate it is an A4 Layout generator. Uses 'Paper Space' vs 'Shopdraw multipage' selection (PropString sSpace). Contains `dp.draw` calls for dimensions and text which implies drawing generation logic. The filename suffix '_LAYOUT' and property 'Drawing space' confirm it targets Layout/Shopdrawing environments."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam",
            "Sheet"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Paper Space or Shopdraw multipage (Layout context)",
          "requiredSettings": []
        }
      },
      "tokens_used": 6515,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10881,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a detailed 2D A4 layout shop drawing for timber wall elements, including automated dimensioning, material lists, and sheathing outlines in PaperSpace.",
          "category": "ShopDrawing",
          "typicalUseCase": "Creating production-ready layout drawings for wall panels where the user needs to control exactly which dimensions (openings, blocking, overall length) are displayed and where."
        },
        "parameters": [
          {
            "name": "sSpace",
            "technicalDefault": "\"|paper space|\"",
            "businessMeaning": "Selects the destination environment for the generated drawing entities.",
            "validRange": "Paper Space, Shopdraw multipage",
            "unit": "enum",
            "affectsOutput": "Determines the coordinate transformation and layer assignment strategy for the drawing output."
          },
          {
            "name": "dFactor",
            "technicalDefault": "450",
            "businessMeaning": "The density of the timber material used to calculate the total weight of the wall element displayed on the drawing.",
            "validRange": "350 - 800",
            "unit": "kg/m³",
            "affectsOutput": "Updates the weight text label in the drawing header/body."
          },
          {
            "name": "sYesNoHeadBinder",
            "technicalDefault": "No",
            "businessMeaning": "Controls whether horizontal blocking (headbinders) above openings are included in the bottom linear dimension string.",
            "validRange": "Yes, No",
            "unit": "enum",
            "affectsOutput": "Toggles the inclusion of header lengths in the running dimensions along the bottom of the wall."
          },
          {
            "name": "strShowElementDimLine",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the overall length dimension of the entire wall element.",
            "validRange": "Yes, No",
            "unit": "enum",
            "affectsOutput": "Shows or hides the primary dimension indicating the total wall width."
          },
          {
            "name": "sMode",
            "technicalDefault": "Line and Text",
            "businessMeaning": "Defines the visual style of the running dimensions (either individual markers with text or a continuous architectural dimension line).",
            "validRange": "Line and Text, Dimension Line",
            "unit": "enum",
            "affectsOutput": "Changes the graphical representation of the bottom stud/beam dimensions."
          },
          {
            "name": "sFilterBMC",
            "technicalDefault": "\"\"",
            "businessMeaning": "Filters specific beam types (by their BeamCode) to be included in the dimensioning.",
            "validRange": "BeamCode strings (e.g., 'STUD', 'PLT')",
            "unit": "string",
            "affectsOutput": "Restricts dimensioning to only the beam types specified; other beams are ignored by the dimension logic."
          },
          {
            "name": "strYesNoDim",
            "technicalDefault": "Yes",
            "businessMeaning": "Displays the diagonal length of the wall element.",
            "validRange": "Yes, No, As Text on Top",
            "unit": "enum",
            "affectsOutput": "Adds a diagonal dimension line or text label indicating the hypotenuse of the wall."
          },
          {
            "name": "strYesNoSheetVis",
            "technicalDefault": "No",
            "businessMeaning": "Toggles the visibility of the sheathing/sheet material outlines on the drawing.",
            "validRange": "Yes, No",
            "unit": "enum",
            "affectsOutput": "Draws or hides the polyline representing the outer boundary of sheet goods (OSB/Plywood)."
          },
          {
            "name": "dOffsetFromEl",
            "technicalDefault": "150 mm",
            "businessMeaning": "The distance between the wall geometry and the first row of dimensions or text.",
            "validRange": "50 - 300",
            "unit": "mm",
            "affectsOutput": "Moves all dimensions and annotations closer to or further from the wall."
          },
          {
            "name": "strDimOpLocVer",
            "technicalDefault": "Right Side",
            "businessMeaning": "Specifies the vertical placement of window/door opening dimensions.",
            "validRange": "Right Side, Center of Opening, Left Side, None",
            "unit": "enum",
            "affectsOutput": "Moves the vertical dimension strings for openings to the left, right, or center."
          },
          {
            "name": "strDimOpCummulative",
            "technicalDefault": "No",
            "businessMeaning": "Toggles 'running' dimensions for openings (e.g., distance from start of wall to window, plus window width).",
            "validRange": "Yes, No",
            "unit": "enum",
            "affectsOutput": "Adds cumulative dimension strings alongside the specific opening widths."
          },
          {
            "name": "sYesNoBlocking",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the dimensioning of blocking members within the wall.",
            "validRange": "Yes, No",
            "unit": "enum",
            "affectsOutput": "Shows or hides dimensions for short blocking/bridging pieces."
          },
          {
            "name": "sBlockingDimToBottomCenterTop",
            "technicalDefault": "Top",
            "businessMeaning": "Defines which point of the blocking member is used for the dimension extension line (bottom, center, or top surface).",
            "validRange": "Bottom, Center, Top",
            "unit": "enum",
            "affectsOutput": "Adjusts the vertical position of the blocking dimension lines relative to the block height."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sFilterExcludeBMC is set",
            "effect": "Overrides sFilterBMC to remove specific beams from the dimension list.",
            "cascade": [
              "sFilterBMC"
            ]
          },
          {
            "trigger": "strDimOpCummulative is set to 'Yes'",
            "effect": "Activates the offset parameter (dOffsetCummulativeOpeningDimension) to separate the cumulative dim from the delta dim.",
            "cascade": [
              "dOffsetCummulativeOpeningDimension"
            ]
          },
          {
            "trigger": "sYesNoVerticalDimName is set to 'Yes'",
            "effect": "Enables text labels ('Blocking', 'Opening') on vertical dimensions.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Dimension Lines",
            "description": "AutoCAD Dimension entities indicating lengths of studs, plates, openings, and overall wall width.",
            "appliedTo": "Element, GenBeam, Opening"
          },
          {
            "type": "Text Labels",
            "description": "Single-line text entities for material lists, weights, and beam codes.",
            "appliedTo": "General Layout"
          },
          {
            "type": "Polylines",
            "description": "2D outlines representing sheathing/sheet material if visibility is enabled.",
            "appliedTo": "Sheet material"
          }
        ]
      },
      "tokens_used": 10018,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User executes the GE_PLOT_A4_LAYOUT.mcr script from the hsbCAD menu or toolbar.",
          "Script prompts user to select a wall Element (or GenBeams) if an element is not currently selected (based on prerequisites).",
          "User configures visualization settings via the AutoCAD Properties Palette (OPM).",
          "Script calculates geometry: Reads Element coordinates, collects Beams, Openings, and Sheets.",
          "Script applies Beam Filtering: Includes beams matching 'sFilterBMC' and excludes those matching 'sFilterExcludeBMC'.",
          "Script generates running dimensions: Calculates stud/plate spacing and positions bottom dimensions based on 'sMode'.",
          "Script processes Angled Geometry: Identifies angled top/bottom plates and perpendicular beams with T-connections.",
          "Script dimensions angled components: Based on property 'nYesNoBm' (Dimension Lines vs Text Only) and 'nYesNoAngle'.",
          "Script generates Sheet outlines: Draws polylines for sheathing if 'strYesNoSheetVis' is Yes.",
          "Script places Lists: Generates material lists and weight info based on 'dFactor' and 'nColumn' settings.",
          "Drawing entities are generated in the target space defined by 'sSpace' (Paper Space or Shopdraw Multipage)."
        ],
        "conditionalBranches": [
          {
            "condition": "Property 'nYesNoBm' (Dimension Angled Beams Mode)",
            "path1": {
              "name": "Dimension Lines",
              "steps": [
                "Identify beams with T-connections to female beams.",
                "Calculate extreme vertices and project points.",
                "Create DimLine and Dim entities.",
                "Draw dimensions to drawing palette."
              ]
            },
            "path2": {
              "name": "Text Only",
              "steps": [
                "Identify beams with T-connections to female beams.",
                "Calculate beam length.",
                "Format length string to text.",
                "Draw text label at beam center."
              ]
            }
          },
          {
            "condition": "Property 'sSpace' (Drawing Space)",
            "path1": {
              "name": "Paper Space",
              "steps": [
                "Use Paper Space transformation matrix (ms2ps).",
                "Draw entities directly in Layout."
              ]
            },
            "path2": {
              "name": "Shopdraw Multipage",
              "steps": [
                "Use Shopdraw context.",
                "Handle page layout logic differently if applicable."
              ]
            }
          },
          {
            "condition": "Angled Plate Detection (Beam Type)",
            "path1": {
              "name": "Left Angled Plate",
              "steps": [
                "Detect beam type '_kSFAngledTPLeft'.",
                "Calculate vector direction relative to global X.",
                "Dimension length perpendicular to plate slope."
              ]
            },
            "path2": {
              "name": "Right Angled Plate",
              "steps": [
                "Detect beam type '_kSFAngledTPRight'.",
                "Calculate vector direction relative to global X.",
                "Dimension length perpendicular to plate slope."
              ]
            }
          },
          {
            "condition": "Property 'strShowElementDimLine' (Show Overall Dimension)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Calculate total wall element width.",
                "Draw primary dimension line indicating overall length."
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skip drawing overall element dimension."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Geometry Validity",
            "errorMessage": "N/A (Internal Skip)",
            "recovery": "Script checks `if (ptExt.length()<3)` and `if (ptUp.length()>1)`. If geometry is insufficient (too few points), the specific beam is skipped without crashing."
          },
          {
            "check": "Beam Connectivity (T-Connection)",
            "errorMessage": "N/A (Filter)",
            "recovery": "Script validates `bmAll[i].hasTConnection(bmFemale[j], 0.1, TRUE)`. Beams without valid T-connections to female beams are excluded from angled dimensioning."
          },
          {
            "check": "Sheet Zone Selection",
            "errorMessage": "N/A",
            "recovery": "Validates 'sZones' index. If index > 0, maps to `nRealZones`. Defaults to -1 if invalid."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Layout Settings",
            "how": "Properties Palette (OPM)",
            "effect": "Changing properties like 'dOffsetFromEl', 'dFactor', or visibility flags triggers a recalculation (`generateLayout`) to immediately update the drawing dimensions and lists."
          },
          {
            "action": "Change Dimension Style",
            "how": "Properties Palette -> 'Dim Style' / 'Dim Style Studs Only'",
            "effect": "Regenerates all dimension entities using the selected AutoCAD DimStyle."
          },
          {
            "action": "Filter Content",
            "how": "Properties Palette -> 'Include Beam With BeamCode' / 'Exclude Beam With BeamCode'",
            "effect": "Re-evaluates the list of beams to dimension, adding or removing specific members based on the code string provided."
          }
        ]
      },
      "tokens_used": 11466,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_PLOT_A4_LAYOUT.mcr\n\n## Overview\nThis script generates a detailed 2D shop drawing layout for timber wall elements within an A4 Paper Space environment. It automates the creation of dimension lines, material lists, sheathing outlines, and weight calculations based on the selected wall geometry.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | The script is designed to output to Layouts. |\n| Paper Space | Yes | Primary environment for generating the A4 layout. |\n| Shop Drawing | Yes | Supports \"Shopdraw multipage\" mode. |\n\n## Prerequisites\n- **Required Entities**: A Timber Wall Element (or collection of GenBeams).\n- **Minimum Beam Count**: 1 (though typically used on full wall assemblies).\n- **Required Settings**: None (uses standard hsbCAD entity data).\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the AutoCAD command line.\n2.  Navigate to the location of `GE_PLOT_A4_LAYOUT.mcr` and select it.\n\n### Step 2: Select Wall Element\n```\nCommand Line: Select element:\nAction: Click on the timber wall element in Model Space you wish to layout.\n```\n*Note: If an element is already selected before running the script, this step may be skipped.*\n\n### Step 3: Configure Layout\nOnce inserted, the script generates an initial layout. To customize it:\n1.  Select the layout drawing entity (or the script anchor if visible).\n2.  Open the **Properties Palette** (Ctrl+1).\n3.  Adjust parameters (e.g., dimension offsets, visibility of sheathing, beam filters) as described below.\n4.  The drawing will update automatically to reflect changes.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Drawing space | Dropdown | Paper Space | Choose between \"Paper Space\" or \"Shopdraw multipage\". |\n| Timber density | Number | 450 kg/m³ | Density of material used to calculate total weight displayed on the drawing. |\n| Dimension headers | Dropdown | No | If Yes, includes horizontal blocking (headbinders) in the bottom running dimensions. |\n| Show Element Dimension | Dropdown | Yes | Toggles the overall width dimension of the entire wall element. |\n| Dimension Mode | Dropdown | Line and Text | Sets the visual style for running dimensions: \"Line and Text\" or \"Dimension Line\". |\n| Include Beam With BeamCode | String | (Empty) | Filters which beams are dimensioned based on their BeamCode (e.g., type 'STUD' to only dimension studs). |\n| Show Diagonal Dimension | Dropdown | Yes | Displays the diagonal length (hypotenuse) of the wall. Options: Yes, No, or \"As Text on Top\". |\n| Show Sheathing Outlines | Dropdown | No | Toggles the visibility of the sheathing/sheet material polylines (OSB/Plywood). |\n| Offset from Element | Number | 150 mm | Sets the distance between the wall geometry and the first row of dimensions. |\n| Opening Dim Location | Dropdown | Right Side | Specifies where vertical dimensions for windows/doors are placed (Left, Right, Center, or None). |\n| Show Cumulative Opening Dims | Dropdown | No | If Yes, adds running dimensions for openings (e.g., distance from wall start to window). |\n| Show Blocking Dims | Dropdown | Yes | Toggles the dimensioning of blocking/bridging members within the wall. |\n| Blocking Dim Point | Dropdown | Top | Defines the reference point for blocking dimensions: Top, Center, or Bottom of the blocking member. |\n| Show Delta Opening Dimension | Dropdown | Yes | Toggles the specific dimension indicating the width of the individual opening. |\n| Offset for cumulative... | Number | 0 mm | Distance separating the cumulative opening dimension from the delta dimension. |\n\n## Settings Files\n- No external settings files are required. The script relies on entity properties and script-embedded logic.\n\n## Tips\n- **Filtering Content**: Use the *Include Beam With BeamCode* property to dimension only studs or plates, hiding other members like cripples or trimmers from the dimension string.\n- **Clarity**: For complex walls, turn *Show Sheathing Outlines* to \"No\" to reduce visual clutter in the layout.\n- **Spacing**: If dimensions overlap with the wall geometry, increase the *Offset from Element* value.\n- ** angled Walls**: The script automatically detects angled plates and dimensions them correctly relative to their slope.\n\n## FAQ\n- **Q: How is the wall weight calculated?**\n  - A: The weight is calculated using the volume of timber in the element multiplied by the *Timber density* (dFactor) property.\n- **Q: Can I place dimensions on both sides of the wall?**\n  - A: This script specifically handles bottom running dimensions and vertical opening dimensions. Side placement is determined by the *Opening Dim Location* property.\n- **Q: Why are some beams not dimensioned?**\n  - A: Check the *Include Beam With BeamCode* property. If it is not empty, only beams matching that code will be dimensioned."
      },
      "tokens_used": 7268,
      "error": null
    }
  }
}