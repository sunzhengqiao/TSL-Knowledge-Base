{
  "filename": "HSB_E-AngleIron.mcr",
  "status": "completed",
  "total_tokens": 38231,
  "processing_time": 498.0801546573639,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 6773,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly creates instances using `tsl.dbCreate(..., _kModelSpace, ...)` in the `_bOnInsert` block. It generates 3D geometry using `Body` objects and creates hardware components (`HardWrComp`) for export. There are no `sd_` prefixes, `_Viewport` checks, or `#Type E` entity declarations associated with shop drawings."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 4465,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Select first beam(s)\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getBeam\",\n        \"promptOriginal\": \"Select second beam\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"dMPLength1\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Length 1\",\n      \"defaultValue\": \"U(100)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Angle Iron\",\n      \"description\": \"Sets the length of the angle along the male beam.\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dMPLength2\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Length 2\",\n      \"defaultValue\": \"U(100)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Angle Iron\",\n      \"description\": \"Sets the length of the angle along the female beam.\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dMPWidth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Width\",\n      \"defaultValue\": \"U(50)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Angle Iron\",\n      \"description\": \"Sets the width of the angle.\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"dMPThickness\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Thickness\",\n      \"defaultValue\": \"U(8)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Angle Iron\",\n      \"description\": \"Sets the thickness of the angle.\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"dXRod\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Position rod\",\n      \"defaultValue\": \"U(50)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Rod\",\n      \"description\": \"Sets the position of the rod.\"\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"dDiamRod\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Diameter rod\",\n      \"defaultValue\": \"U(10)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Rod\",\n      \"description\": \"Sets the diamter of the rod.\\nZero means no rod"
      },
      "tokens_used": 7475,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 7798,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched",
          "Check if _bOnInsert is true (Insertion Mode)",
          "Check insertCycleCount(); if > 1, erase instance and exit",
          "Check if _kExecuteKey (Catalog) is provided and valid",
          "[Conditional] If Catalog Key valid: Load properties from Catalog. Else: Show Dialog",
          "Prompt for first beam(s) (PrEntity) - Multiple selection allowed",
          "Prompt for second beam (getBeam) - Single selection only",
          "Iterate through all selected first beams (Male beams)",
          "For each Male beam, create a new script instance (Satellite) in ModelSpace",
          "Erase the initial temporary instance",
          "[Satellite Instance] Initialize properties from 'MasterToSatellite' map",
          "[Satellite Instance] Check 'Add to element' setting and assign to Element Group if enabled",
          "[Satellite Instance] Calculate Coordinate System based on Beam geometry and 'Flip side' property",
          "[Satellite Instance] Construct Angle Iron Body (L-shape) based on Length 1, Length 2, Width, Thickness",
          "[Satellite Instance] Check Rod Diameter; if > 0, construct cylindrical Rod body and attach",
          "[Satellite Instance] Check Hardware creation triggers (DbCreated, Empty, or Property Change)",
          "[Satellite Instance] Create Hardware Component (HardWrComp) with Article/Description/Material data",
          "Script finished"
        ],
        "conditionalBranches": [
          {
            "condition": "Duplicate Insertion Check",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase instance immediately",
                "Exit script"
              ]
            },
            "path2": {
              "name": "Cycle = 1",
              "steps": [
                "Proceed to input prompts"
              ]
            }
          },
          {
            "condition": "Catalog/Execute Key usage",
            "path1": {
              "name": "Valid Key provided",
              "steps": [
                "Load properties from catalog",
                "Skip dialog"
              ]
            },
            "path2": {
              "name": "No/Invalid Key",
              "steps": [
                "Show selection dialog",
                "User confirms settings",
                "Proceed"
              ]
            }
          },
          {
            "condition": "Add to Element Visualisation",
            "path1": {
              "name": "Property set to Yes",
              "steps": [
                "Retrieve Element from Beam",
                "Assign script to Element Group with specified Zone/Layer"
              ]
            },
            "path2": {
              "name": "Property set to No",
              "steps": [
                "Skip Element Group assignment"
              ]
            }
          },
          {
            "condition": "Rod Configuration",
            "path1": {
              "name": "Diameter > 0",
              "steps": [
                "Calculate rod position",
                "Create rod body",
                "Union rod with angle body"
              ]
            },
            "path2": {
              "name": "Diameter == 0",
              "steps": [
                "Skip rod creation"
              ]
            }
          },
          {
            "condition": "Hardware Export Update",
            "path1": {
              "name": "Trigger detected",
              "steps": [
                "Construct HardWrComp object",
                "Update Article/Material/Description",
                "Write to _ThisInst"
              ]
            },
            "path2": {
              "name": "No trigger",
              "steps": [
                "Retain existing Hardware Component data"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Number of Male Beams selected",
            "errorMessage": "Implicit: PrEntity must return a valid beam set to proceed.",
            "recovery": "Select at least one beam when prompted 'Select first beam(s)'."
          },
          {
            "check": "Female Beam Selection",
            "errorMessage": "Implicit: getBeam must return a valid beam to proceed.",
            "recovery": "Select a valid beam when prompted 'Select second beam'."
          },
          {
            "check": "Catalog Key Existence",
            "errorMessage": "'Catalog key [Key] not found!'",
            "recovery": "Check spelling of the execute key or create the catalog entry, or run without key to use dialog."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Resize Angle Iron",
            "how": "OPM Properties Palette (Angle Iron category)",
            "effect": "Updates dMPLength1, dMPLength2, dMPWidth, or dMPThickness, regenerating the Body geometry immediately."
          },
          {
            "action": "Flip Side",
            "how": "OPM Property 'Flip side' (Position category)",
            "effect": "Toggles the angle iron to the opposite side of the connection using vector multiplication (nSide)."
          },
          {
            "action": "Adjust Rod",
            "how": "OPM Properties (Rod category)",
            "effect": "Updates position (dXRod) or Diameter (dDiamRod); setting Diameter to 0 removes the rod."
          },
          {
            "action": "Update Export Data",
            "how": "OPM Properties (Export data category)",
            "effect": "Changes Article Number, Description, or Material strings, triggering a Hardware Component update."
          },
          {
            "action": "Move/Grips",
            "how": "CAD Grip Edit",
            "effect": "Script uses Beam references (_Beam0, _Beam1) and insertion point (_Pt0), so moving beams updates the position automatically."
          }
        ]
      },
      "tokens_used": 6014,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-AngleIron.mcr\n\n## Overview\nThis script generates a custom angle iron connection between multiple primary beams and a single secondary beam. It creates 3D geometry for the angle iron and an optional rod, with configurable properties for dimensions, positioning, and hardware export data.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script creates 3D `Body` objects and hardware components in the model. |\n| Paper Space | No | This script does not function in Paper Space or Shop Drawings. |\n| Shop Drawing | No | This is a detailing/modeling script only. |\n\n## Prerequisites\n- **Required Entities**: Beams (GenBeam).\n- **Minimum Beam Count**: 2 (One or more beams for the first selection, and one beam for the second selection).\n- **Required Settings**: None strictly required, though a Catalog entry can be used for predefined configurations.\n\n## Usage Steps\n\n### Step 1: Launch Script\nExecute the command `TSLINSERT` and select `HSB_E-AngleIron.mcr` from the list.\n\n### Step 2: Configuration Dialog (If applicable)\nIf the script is run without a specific Catalog Key, a configuration dialog may appear allowing you to preset the Angle Iron and Rod dimensions.\n\n### Step 3: Select First Beams\n```\nCommand Line: Select first beam(s)\nAction: Click on one or multiple beams in the model that represent the primary side of the connection. Press Enter to confirm selection.\n```\n\n### Step 4: Select Second Beam\n```\nCommand Line: Select second beam\nAction: Click on the single beam that represents the secondary side of the connection.\n```\n\n### Step 5: Automatic Generation\nThe script will automatically generate an angle iron instance for every beam selected in Step 3, connecting them to the beam selected in Step 4.\n\n## Properties Panel Parameters\n\nThese parameters can be edited in the AutoCAD Properties Palette (OPM) after selecting the generated script instance.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Length 1** | Number | 100 mm | Sets the length of the angle along the first (male) beam. |\n| **Length 2** | Number | 100 mm | Sets the length of the angle along the second (female) beam. |\n| **Width** | Number | 50 mm | Sets the width (leg size) of the angle iron. |\n| **Thickness** | Number | 8 mm | Sets the material thickness of the angle iron. |\n| **Position rod** | Number | 50 mm | Sets the offset position of the rod relative to the angle origin. |\n| **Diameter rod** | Number | 10 mm | Sets the diameter of the rod. Set to **0** to omit the rod entirely. |\n| **Flip side** | Boolean/Option | - | Toggles the angle iron to the opposite side of the connection point. |\n| **Add to element** | Boolean | - | If Yes, assigns the hardware to the Element Group of the associated beam. |\n| **Article** | String | - | Defines the Article Number for hardware export/listings. |\n| **Description** | String | - | Defines the Description text for the hardware component. |\n| **Material** | String | - | Defines the Material code for the hardware component. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Refreshes the script geometry to reflect changes in beam positions or property values. |\n\n## Settings Files\n- **Catalog Entries**: The script supports execution via Catalog Keys. If a catalog is used, default values for dimensions and material are loaded from the relevant catalog entry.\n\n## Tips\n- **Multiple Connections**: You can connect multiple beams to a single secondary beam in one operation by selecting all the primary beams during the \"Select first beam(s)\" prompt.\n- **Removing the Rod**: If you only need the angle iron plate, simply set the **Diameter rod** property to `0`.\n- **Flipping**: If the angle iron is generated on the wrong side of the beams, select the script instance and change the **Flip side** property in the Properties palette.\n\n## FAQ\n- **Q: I selected multiple beams, but nothing happened?**\n  **A**: Ensure you select the \"first\" beams (multiple allowed), press Enter, and *then* select a valid \"second\" beam (single). The script requires both sets of inputs to generate geometry.\n\n- **Q: How do I change the size after insertion?**\n  **A**: Select the angle iron object in the model, open the Properties palette (Ctrl+1), and modify the **Length 1**, **Length 2**, **Width**, or **Thickness** values. The 3D model will update automatically.\n\n- **Q: Why is there no rod in my model?**\n  **A**: Check the **Diameter rod** property in the Properties palette. If it is set to 0, the rod is suppressed. Increase the value to generate the rod geometry."
      },
      "tokens_used": 5706,
      "error": null
    }
  }
}