{
  "filename": "GE_PLOT_LOAD_BEARING_WALL.mcr",
  "status": "completed",
  "total_tokens": 35927,
  "processing_time": 764.6675918102264,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.4",
            "date": "25.jul.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Thumbnail added"
          },
          {
            "version": "1.3",
            "date": "25.jul.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Version update"
          },
          {
            "version": "1.2",
            "date": "08.feb.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Messages added to guide user on insertion"
          },
          {
            "version": "1.1",
            "date": "24.jan.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Filter load bearing walls by ElementWallSF property loadBearing()."
          },
          {
            "version": "1.0",
            "date": "12.dec.2011",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5934,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "Both",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "PropString sSpace explicitly offers options for 'paper space' and 'shopdraw multipage'. The script contains distinct logic blocks for _Viewport (getViewport) and _Entity (getShopDrawView/ShopDrawView cast). It performs coordinate system transformations (ms2ps) typical of 2D generation scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "ElementWall",
            "Viewport",
            "ShopDrawView"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be inserted into a Paper Space Layout with an active Viewport, or into a Shopdrawing environment with a selected ShopDrawView.",
          "requiredSettings": []
        }
      },
      "tokens_used": 4240,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select viewport",
              "condition": "sSpace == sPaperSpace && _bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getShopDrawView",
              "promptOriginal": "Select ShopDrawView",
              "condition": "sSpace == sShopdrawSpace && _bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "showDialogOnce() called during _bOnInsert",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSpace",
            "type": "PropString",
            "displayName": "|Drawing space|",
            "defaultValue": "|paper space|",
            "inputType": "dropdown",
            "options": [
              "|paper space|",
              "|shopdraw multipage|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sEmpty",
            "type": "PropString",
            "displayName": " ",
            "defaultValue": " ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sWDp",
            "type": "PropString",
            "displayName": "|Load bearing walls display|",
            "defaultValue": "|solid hatch|",
            "inputType": "dropdown",
            "options": [
              "|solid hatch|",
              "|cross hatch|",
              "|no display|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dWlHatchPtnr",
            "type": "PropDouble",
            "displayName": "|Load bearing walls pattern|",
            "defaultValue": "U(25,1)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nWColor",
            "type": "PropInt",
            "displayName": "|Load bearing walls color|",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sEmpty2",
            "type": "PropString",
            "displayName": "",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sBmDp",
            "type": "PropString",
            "displayName": "|Structural wood beam display|",
            "defaultValue": "|single line hatch|",
            "inputType": "dropdown",
            "options": [
              "|single line hatch|",
              "|no display|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dBmHatchPtnr",
            "type": "PropDouble",
            "displayName": "|Structural wood beam pattern|",
            "defaultValue": "U(25,1)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nBmColor",
            "type": "PropInt",
            "displayName": "|Structural wood beam color| ",
            "defaultValue": 3,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5194,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates 2D graphical representations of load-bearing walls and structural headers in Paper Space or Shop Drawings, applying specific hatching and colors to differentiate structural elements.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used by detailers to automatically overlay structural information on floor plans, highlighting which walls carry loads using solid or cross-hatching."
        },
        "parameters": [
          {
            "name": "sSpace",
            "technicalDefault": "\"|paper space|\"",
            "businessMeaning": "Specifies the target environment for the overlay generation—either directly in a CAD viewport layout or within the hsbCAD shopdrawing module.",
            "validRange": "Dropdown: |paper space|, |shopdraw multipage|",
            "unit": "N/A",
            "affectsOutput": "Switches the script logic between selecting a Viewport (CAD) and a ShopDrawView (hsbCAD) and changes the coordinate transformation method used."
          },
          {
            "name": "sWDp",
            "technicalDefault": "\"|solid hatch|\"",
            "businessMeaning": "Determines the visual style used to indicate load-bearing walls.",
            "validRange": "|solid hatch|, |cross hatch|, |no display|",
            "unit": "N/A",
            "affectsOutput": "If set to solid or cross, it draws the wall outline and fills it; if 'no display', walls are skipped."
          },
          {
            "name": "dWlHatchPtnr",
            "technicalDefault": "U(25,1)",
            "businessMeaning": "Controls the density or scale of the hatch pattern applied to the walls.",
            "validRange": "5 to 100 (Typical architectural hatch scales)",
            "unit": "mm",
            "affectsOutput": "Adjusts the spacing of the hatch lines/pattern inside the wall profile."
          },
          {
            "name": "nWColor",
            "technicalDefault": "1",
            "businessMeaning": "Sets the display color (AutoCAD Color Index) for the load-bearing wall graphics.",
            "validRange": "1 to 255",
            "unit": "ACI",
            "affectsOutput": "Changes the color of the wall outline and hatch fill."
          },
          {
            "name": "sBmDp",
            "technicalDefault": "\"|single line hatch|\"",
            "businessMeaning": "Determines how structural wood beams (headers) within the walls are displayed.",
            "validRange": "|single line hatch|, |no display|",
            "unit": "N/A",
            "affectsOutput": "If active, it overlays the cross-section of headers found within the load-bearing walls."
          },
          {
            "name": "dBmHatchPtnr",
            "technicalDefault": "U(25,1)",
            "businessMeaning": "Controls the density of the hatch pattern for the structural beams.",
            "validRange": "1 to 50",
            "unit": "mm",
            "affectsOutput": "Adjusts the line spacing within the beam hatch (multiplied by 10 in the script logic)."
          },
          {
            "name": "nBmColor",
            "technicalDefault": "3",
            "businessMeaning": "Sets the display color for the structural wood beams.",
            "validRange": "1 to 255",
            "unit": "ACI",
            "affectsOutput": "Changes the color of the header outlines and hatch."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sWDp == '|no display|'",
            "effect": "Wall graphics are not generated, rendering wall parameters inactive.",
            "cascade": [
              "dWlHatchPtnr",
              "nWColor"
            ]
          },
          {
            "trigger": "sBmDp == '|no display|'",
            "effect": "Beam graphics are not generated, rendering beam parameters inactive.",
            "cascade": [
              "dBmHatchPtnr",
              "nBmColor"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "PLine / Polyline",
            "description": "2D outlines of walls and beam projections transformed from Model Space to Paper/Shopdraw Space.",
            "appliedTo": "ElementWalls flagged as loadBearing and Beams of type Header within those walls."
          },
          {
            "type": "Hatch",
            "description": "Graphic fill patterns (SOLID, NET, or LINE) applied to the projected profiles.",
            "appliedTo": "PlaneProfiles generated from wall and beam geometry."
          }
        ]
      },
      "tokens_used": 5923,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Insertion Started",
          "Check Insert Cycle (prevent re-entrance on double click)",
          "Show Dynamic Dialog (Properties Palette)",
          "Branch on 'Drawing space' Property (User Selection)",
          "[Paper Space] Prompt: Select Viewport",
          "[Shopdraw Space] Prompt: Select ShopDrawView",
          "Report Message: 'Go to your hsbConsole and select any element in the target group'",
          "Script Paused (Instance exists, waiting for external trigger)",
          "User selects Element in hsbCAD Console",
          "Script Recalculation Triggered",
          "Branch on 'Drawing space' Property (Execution Logic)",
          "[Paper Space] Validate Viewport, get CoordSys, get Element",
          "[Shopdraw Space] Validate ShopDrawView, find ViewData, get CoordSys/Element",
          "Lock 'Drawing space' Property (Read Only)",
          "Collect all ElementWalls from the Element's Group (including subgroups)",
          "Iterate through collected Wall Entities",
          "Filter: Check if Wall is Load Bearing (ElementWallSF)",
          "[False] Skip to next Wall",
          "[True] Get Wall Outline, Transform to Paper/View Space",
          "Branch on 'Load bearing walls display' Property",
          "[Solid/Cross Hatch] Draw Wall PLine and Apply Hatch",
          "[No Display] Skip Wall Graphics",
          "Branch on 'Structural wood beam display' Property",
          "[No Display] Skip Beam Logic",
          "[Single Line Hatch] Iterate Beams within the Wall",
          "Filter Beam: Check if Type == 18 (Header)",
          "[True] Project Beam Envelope, Transform, Apply Line Hatch",
          "Loop Complete / Script Finish"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Phase (User Input)",
            "path1": {
              "name": "Paper Space Workflow",
              "steps": [
                "User sets sSpace to '|paper space|'",
                "Command Line: getViewport() prompts user",
                "User clicks a Layout Viewport",
                "Viewport stored in _Viewport array"
              ]
            },
            "path2": {
              "name": "Shopdraw Multipage Workflow",
              "steps": [
                "User sets sSpace to '|shopdraw multipage|'",
                "Command Line: getShopDrawView() prompts user",
                "User clicks a ShopDrawView entity",
                "Entity stored in _Entity array"
              ]
            }
          },
          {
            "condition": "Execution Phase (Coordinate System)",
            "path1": {
              "name": "Paper Space Processing",
              "steps": [
                "Retrieve Viewport from _Viewport array",
                "Get Element directly from Viewport",
                "Calculate ms2ps transform from Viewport.coordSys()"
              ]
            },
            "path2": {
              "name": "Shopdraw Processing",
              "steps": [
                "Cast _Entity to ShopDrawView",
                "Parse ViewData from internal _Map",
                "Match ViewData to selected ShopDrawView",
                "Calculate ms2ps transform from ViewData.coordSys()"
              ]
            }
          },
          {
            "condition": "Wall Structural Property (loadBearing)",
            "path1": {
              "name": "Load Bearing",
              "steps": [
                "ElementWallSF reports TRUE",
                "Generate geometry (PLine/PlaneProfile)",
                "Apply graphical styles defined in OPM"
              ]
            },
            "path2": {
              "name": "Non-Load Bearing",
              "steps": [
                "ElementWallSF reports FALSE",
                "Continue loop to next entity",
                "No graphics generated"
              ]
            }
          },
          {
            "condition": "Beam Type Filter",
            "path1": {
              "name": "Structural Header",
              "steps": [
                "bm.type() returns 18",
                "Generate shadow profile of envelope",
                "Draw with beam color and hatch pattern"
              ]
            },
            "path2": {
              "name": "Other Beam Type",
              "steps": [
                "bm.type() is not 18",
                "Skip drawing",
                "Check next beam"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection (Paper Space)",
            "errorMessage": "Implicit (Script returns/erases)",
            "recovery": "User must run script again and select a valid viewport."
          },
          {
            "check": "Viewport Data Integrity",
            "errorMessage": "None",
            "recovery": "Viewport must contain a valid hsbCAD Element reference."
          },
          {
            "check": "ShopDrawView Selection (Shopdraw Space)",
            "errorMessage": "Implicit (Script returns/erases)",
            "recovery": "User must run script again and select a valid ShopDrawView entity."
          },
          {
            "check": "ViewData Existence",
            "errorMessage": "None",
            "recovery": "Ensure the ShopDrawView corresponds to a valid dataset in the _Map."
          },
          {
            "check": "Console Selection",
            "errorMessage": "None",
            "recovery": "User must select an element belonging to the same group/model as the target drawing."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Display Style (Walls)",
            "how": "OPM Properties (sWDp)",
            "effect": "Toggles between Solid Hatch, Cross Hatch, or No Display."
          },
          {
            "action": "Update Display Style (Beams)",
            "how": "OPM Properties (sBmDp)",
            "effect": "Toggles between Single Line Hatch or No Display for headers."
          },
          {
            "action": "Adjust Pattern Density",
            "how": "OPM Properties (dWlHatchPtnr, dBmHatchPtnr)",
            "effect": "Modifies the scaling of the hatch patterns."
          },
          {
            "action": "Change Colors",
            "how": "OPM Properties (nWColor, nBmColor)",
            "effect": "Changes the AutoCAD Color Index for walls and beams."
          },
          {
            "action": "Target Different Model Group",
            "how": "Console Selection",
            "effect": "Selecting an element from a different group clears the current instance and regenerates graphics for the new group."
          }
        ]
      },
      "tokens_used": 7483,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_PLOT_LOAD_BEARING_WALL\n\n## Overview\nGenerates 2D graphical representations in Paper Space or Shop Drawings to highlight load-bearing walls and structural headers. It applies specific hatching and colors to differentiate structural elements on floor plans.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script generates 2D output specifically for layouts. |\n| Paper Space | Yes | Select a Viewport to map the structural data. |\n| Shop Drawing | Yes | Select a ShopDrawView for multi-page layouts. |\n\n## Prerequisites\n- **Required Entities**: A Viewport (for Paper Space) or a ShopDrawView (for Shop Drawings) linked to an hsbCAD Element.\n- **Minimum beam count**: 0.\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `GE_PLOT_LOAD_BEARING_WALL.mcr`\n\n### Step 2: Configure Properties\n1.  Open the **Properties Palette** (Ctrl+1).\n2.  Locate the **Drawing space** parameter.\n3.  Choose either `|paper space|` or `|shopdraw multipage|` depending on your current layout.\n\n### Step 3: Select Target View\n**If using Paper Space:**\n```\nCommand Line: Select viewport\nAction: Click on the layout viewport that displays the model you wish to annotate.\n```\n\n**If using Shop Drawings:**\n```\nCommand Line: Select ShopDrawView\nAction: Click on the ShopDrawView entity in the drawing.\n```\n\n### Step 4: Trigger Generation\n```\nCommand Line: Go to your hsbConsole and select any element in the target group\nAction: \n1. Open the hsbCAD Console (Project Tree).\n2. Select any Element (e.g., a wall or floor) belonging to the house or group you want to process.\n```\n*Note: The script will automatically recalculate and draw the load bearing elements once you select an item in the console.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Drawing space | dropdown | \\|paper space\\| | Selects the target environment: Viewport (Paper Space) or ShopDrawView (Shop Drawings). |\n| Load bearing walls display | dropdown | \\|solid hatch\\| | Visual style for walls: Solid fill, Cross hatch, or hidden. |\n| Load bearing walls pattern | number | U(25,1) | Scale/density of the wall hatch pattern. |\n| Load bearing walls color | number | 1 | AutoCAD Color Index (ACI) for wall outlines and hatch. |\n| Structural wood beam display | dropdown | \\|single line hatch\\| | Visual style for headers (beams): Single line hatch or hidden. |\n| Structural wood beam pattern | number | U(25,1) | Scale/density of the beam hatch pattern. |\n| Structural wood beam color | number | 3 | AutoCAD Color Index (ACI) for beam outlines and hatch. |\n\n## Right-Click Menu Options\nNone. The script updates automatically when properties change or a new element is selected in the hsbCAD Console.\n\n## Settings Files\nNone required.\n\n## Tips\n- **Quick Toggle:** To temporarily hide the structural layer without deleting the script, set the **Load bearing walls display** and **Structural wood beam display** properties to `|no display|`.\n- **Color Coding:** Use distinct colors (e.g., Red for walls, Green for beams) to make the structural plan easier to read at a glance.\n- **Console Trigger:** If you modify the model walls, simply re-select the element in the hsbCAD Console to refresh the overlay.\n\n## FAQ\n- **Q: I inserted the script, but nothing happened.**\n- **A:** You must complete the workflow by selecting an element in the **hsbCAD Console** (Project Tree). This selection triggers the calculation and drawing of the walls.\n- **Q: Can I use this in Model Space to see the walls in 3D?**\n- **A:** No, this script is designed specifically for generating 2D annotations in Paper Space or Shop Drawings.\n- **Q: Why are some walls not showing up?**\n- **A:** The script filters walls based on the `loadBearing` property assigned in the ElementWallSF. Ensure the walls are defined as \"Load Bearing\" in the wall settings."
      },
      "tokens_used": 7153,
      "error": null
    }
  }
}