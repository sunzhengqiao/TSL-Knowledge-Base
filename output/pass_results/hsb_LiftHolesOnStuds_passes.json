{
  "filename": "hsb_LiftHolesOnStuds.mcr",
  "status": "completed",
  "total_tokens": 27290,
  "processing_time": 580.901022195816,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "18.08.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4015,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates on `Element` objects selected via `PrEntity`. It processes `Beam` collections within these elements (`el.beam()`) to add drills. There is no usage of ShopDrawing specific prefixes (sd_), #Type E declarations, _Viewport references, or `_Entity[]` arrays which are indicative of Paper Space/ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Elements with beams classified as Top Plates (_kSFTopPlate, etc.) and Studs (_kStud).",
          "requiredSettings": []
        }
      },
      "tokens_used": 2366,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Please select Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialogOnce",
            "trigger": "On Insert (_bOnInsert) when _kExecuteKey is empty",
            "title": null,
            "dataSource": "Script Properties (PropDouble)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dDrillDiameter",
            "type": "PropDouble",
            "displayName": "Drill Diameter",
            "defaultValue": "U(25)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dOffsetTop",
            "type": "PropDouble",
            "displayName": "Offset from Top of the panel",
            "defaultValue": "U(276)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dSpacing",
            "type": "PropDouble",
            "displayName": "Distance between Drills on Top",
            "defaultValue": "U(74)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5953,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically adds lifting holes and clearance drills to top plates and vertical studs in timber wall panels to facilitate crane lifting.",
          "category": "Manufacturing/Handling",
          "typicalUseCase": "Used when detailing prefabricated wall panels to insert standardized machining for lifting straps, chains, or pins."
        },
        "parameters": [
          {
            "name": "dDrillDiameter",
            "technicalDefault": "U(25)",
            "businessMeaning": "Diameter of the lifting hole through the stud and the corresponding clearance holes in the top plate.",
            "validRange": "16 - 50",
            "unit": "mm",
            "affectsOutput": "Adjusts the bore size of all drills created. Too large weakens the stud; too small prevents hardware insertion."
          },
          {
            "name": "dOffsetTop",
            "technicalDefault": "U(276)",
            "businessMeaning": "Vertical distance from the top surface of the panel down to the centerline of the lifting hole.",
            "validRange": "200 - 600",
            "unit": "mm",
            "affectsOutput": "Moves the lifting hole up or down the vertical stud to accommodate lifting hardware geometry and balance the panel center of gravity."
          },
          {
            "name": "dSpacing",
            "technicalDefault": "U(74)",
            "businessMeaning": "The horizontal spacing between the two clearance holes on the top plate, centered on the lifting point.",
            "validRange": "50 - 150",
            "unit": "mm",
            "affectsOutput": "Changes the separation distance of the two top plate holes to allow the sling or shackle width to pass through unobstructed."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dDrillDiameter increase",
            "effect": "May require increasing dSpacing to prevent the top plate holes from merging or breaking the web of the top plate.",
            "cascade": [
              "dSpacing"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Drill",
            "description": "Vertical hole through the stud intended for the lifting pin or bail.",
            "appliedTo": "Vertical studs (Studs) that T-connect into Top Plates near panel ends."
          },
          {
            "type": "Drill",
            "description": "Pair of vertical clearance holes in the top plate to allow lifting chains/straps to pass through.",
            "appliedTo": "Top Plates (TopPlate, AngledTPLeft, AngledTPRight) where they intersect the valid lifting studs."
          }
        ]
      },
      "tokens_used": 3723,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts/inserted",
          "Check: Is this the first insertion cycle? (insertCycleCount>1)",
          "[If not first cycle] Erase instance and exit immediately",
          "[If first cycle] Check: Is _kExecuteKey empty? (Manual insert vs catalog preset)",
          "[If key empty] Show properties dialog (Drill Diameter, Offset, Spacing)",
          "Prompt user to select Elements (PrEntity)",
          "[If user cancels selection] Erase instance and exit",
          "[If user selects] Parse selected entities into _Element array",
          "Check: Does _Element array contain elements?",
          "[If empty] Erase instance and exit",
          "Loop through each selected Element",
          "Establish Element Coordinate System (csEl, vx, vy, vz)",
          "Retrieve all Beams within the Element (el.beam())",
          "Categorize beams into Top Plates (bmFemale), Vertical Studs (bmMale), Left Stud (ptLeft), and Right Stud (ptRight)",
          "Filter vertical studs for those perpendicular to the Element X-axis (vx)",
          "Check: Is the element length > 1000mm? (Distance between first and last vertical stud)",
          "[If length > 1000mm] Check if valid studs are within 700mm of Left/Right Studs",
          "[If length <= 1000mm] Automatically select the first vertical stud",
          "Compile list of bmValid (studs to receive lift holes)",
          "Loop through each Top Plate (bmFemale)",
          "Find intersecting Valid Studs (bmToDrill)",
          "Loop through each intersecting Stud",
          "Check: Does the Stud have a T-Connection to the Top Plate?",
          "[If T-Connection exists] Calculate intersection point",
          "Create vertical Drill in Stud (Offset from top, calculated via dOffsetTop)",
          "Create pair of vertical Drills in Top Plate (Spaced via dSpacing)",
          "Add tools to Beams (addToolStatic)",
          "End Loops",
          "Erase instance",
          "Exit"
        ],
        "conditionalBranches": [
          {
            "condition": "Element Length (X-axis span of studs) > 1000mm",
            "path1": {
              "name": "Long Panel (>1000mm)",
              "steps": [
                "Identify first and last vertical studs in the sorted list",
                "Measure distance from these studs to the designated Left Stud and Right Stud edges",
                "If distance < 700mm, add the respective outer stud to the valid list",
                "Studs in the middle are ignored for lifting points"
              ]
            },
            "path2": {
              "name": "Short Panel (<=1000mm)",
              "steps": [
                "Automatically select the first vertical stud in the sorted list",
                "Add it to the valid list for lifting",
                "Distance checks are skipped"
              ]
            }
          },
          {
            "condition": "Beam-Beam Intersection Type",
            "path1": {
              "name": "T-Connection Detected",
              "steps": [
                "Calculate intersection centerline",
                "Apply offset logic (vy * -dOffsetTop)",
                "Generate 1 drill in Stud and 2 drills in Top Plate",
                "Write tools to entity"
              ]
            },
            "path2": {
              "name": "No T-Connection",
              "steps": [
                "Drill generation skipped for this specific beam pair",
                "Continue to next beam"
              ]
            }
          },
          {
            "condition": "insertCycleCount() > 1",
            "path1": {
              "name": "Re-insertion / Duplicate cycle",
              "steps": [
                "Erase instance immediately",
                "Return"
              ]
            },
            "path2": {
              "name": "Fresh Insertion",
              "steps": [
                "Continue to execute key and selection logic"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element selection count",
            "errorMessage": "None explicit (Script exits silently)",
            "recovery": "User must re-run script and select at least one Element."
          },
          {
            "check": "Presence of Top Plate and Stud types",
            "errorMessage": "None explicit",
            "recovery": "Script requires Elements with specific beam types (_kSFTopPlate, _kStud) to function; otherwise no tools are generated."
          },
          {
            "check": "Beam Orientation (Stud perpendicular to X-axis)",
            "errorMessage": "None explicit",
            "recovery": "Only beams meeting the geometric criteria (perpendicular to Element X-axis) are processed."
          },
          {
            "check": "Proximity of lifting studs to edges (for long panels)",
            "errorMessage": "None explicit",
            "recovery": "If the outer studs are too far (>700mm) from the Left/Right markers, they are ignored as lifting points."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Drill Dimensions (Diameter, Spacing, Offset)",
            "how": "Object Properties Palette (OPM)",
            "effect": "Requires manual script re-execution or recalculation logic (not explicitly present in provided code for auto-update, but properties are exposed). Note: The script calls `eraseInstance()` at the end, implying it is a generator script that removes its TSL instance after processing, leaving only the generated Drills on the beams."
          },
          {
            "action": "Delete Generated Drills",
            "how": "Standard CAD Delete command on the Drills",
            "effect": "Removes the machining from the Beams."
          },
          {
            "action": "Re-run script",
            "how": "Insert TSL command",
            "effect": "Regenerates holes based on current property values. Since previous instances are erased, this effectively replaces the machining."
          }
        ]
      },
      "tokens_used": 5702,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_LiftHolesOnStuds.mcr\n\n## Overview\nThis script automates the creation of lifting holes for crane operations on timber wall panels. It drills a vertical lifting hole in specific wall studs and adds two matching clearance holes in the top plate to allow lifting straps or chains to pass through.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be run in the model where wall panels (Elements) are located. |\n| Paper Space | No | Not designed for Shop Drawings or layout views. |\n| Shop Drawing | No | Does not generate 2D annotations or view-specific details. |\n\n## Prerequisites\n- **Required Entities**: You must have **Elements** (wall panels) present in the drawing containing beams classified as **Top Plates** (e.g., `_kSFTopPlate`) and **Studs** (e.g., `_kStud`).\n- **Minimum Requirements**: The script processes elements based on their internal beam structure. Select at least one valid wall element during execution.\n- **Required Settings**: None. The script uses internal defaults that can be adjusted via the Properties Palette before execution.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Browse to select `hsb_LiftHolesOnStuds.mcr` and click **Open**.\n\n### Step 2: Configure Properties\n*   A dialog will appear automatically upon first insertion.\n*   **Action**: Adjust the drilling dimensions (Diameter, Offset, Spacing) if the default values do not suit your lifting hardware. Click **OK** to confirm.\n\n### Step 3: Select Wall Panels\n```\nCommand Line: Please select Elements\nAction: Click on the wall panels (Elements) you wish to modify. Press Enter to confirm selection.\n```\n*   *Note*: The script will analyze the selected panels and automatically identify the correct studs based on panel length (end studs for long panels, first stud for short panels).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Drill Diameter | Number | 25 | Diameter of the vertical hole drilled through the stud (mm). Ensure this matches your lifting pin diameter. |\n| Offset from Top of the panel | Number | 276 | Vertical distance from the top surface of the wall panel down to the center of the lifting hole (mm). Adjust based on lifting hardware geometry. |\n| Distance between Drills on Top | Number | 74 | Horizontal spacing between the two clearance holes drilled into the top plate (mm). Increase this if using wide slings or shackles. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script runs once and erases its instance. It does not attach a persistent context menu to the elements. |\n\n## Settings Files\n- None used.\n\n## Tips\n- **Panel Length Logic**:\n    - **Long Panels (>1000mm)**: The script places holes only in the end studs (studs within 700mm of the left/right edges). Intermediate studs are ignored.\n    - **Short Panels (<=1000mm)**: The script automatically selects the first vertical stud found in the element.\n- **Stud Orientation**: The script only processes studs that are perpendicular to the wall's main axis (Element X-axis). Ensure your wall elements are constructed correctly.\n- **Re-running**: The script deletes its own reference block after running. To change hole locations or sizes, you must delete the existing drills manually and run the script again.\n\n## FAQ\n- **Q: Why didn't the script drill holes in the middle of my long wall?**\n  - A: For structural balance and typical lifting setups, the script is designed to lift long panels from the ends only. It ignores studs that are more than 700mm away from the left or right boundaries.\n- **Q: What happens if my drill diameter is too large for the spacing?**\n  - A: The two clearance holes in the top plate might merge into one large slot or weaken the plate. If using a large diameter (e.g., 50mm), ensure you increase the **Distance between Drills on Top** parameter accordingly.\n- **Q: Can I undo the changes?**\n  - A: Yes, use the standard AutoCAD **Undo** command immediately after running the script, or manually select and delete the generated drill holes."
      },
      "tokens_used": 5531,
      "error": null
    }
  }
}