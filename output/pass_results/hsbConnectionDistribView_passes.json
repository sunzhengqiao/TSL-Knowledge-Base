{
  "filename": "hsbConnectionDistribView.mcr",
  "status": "completed",
  "total_tokens": 53570,
  "processing_time": 317.2698464393616,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.10",
            "date": "24may20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-7510: write in hardware note cd-ref-cd-ref-nr"
          },
          {
            "version": "1.9",
            "date": "13may20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-7510: fix bug -Line 1159 (cannot access last element of an empty array) and write CD-Ref Number into hardware Infos"
          },
          {
            "version": "1.8",
            "date": "13may20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-7510: result of calcDistance and nr shown in separated properties"
          },
          {
            "version": "1.7",
            "date": "07may20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-7510: fix bug, write mapX, add line for insert by points"
          },
          {
            "version": "1.6",
            "date": "29apr20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-7405: add property project number"
          },
          {
            "version": "1.5",
            "date": "27apr20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-7405: add grip poins at start and end"
          },
          {
            "version": "1.4",
            "date": "13apr20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-7124: change name to hsbConnectionDistribView"
          },
          {
            "version": "1.3",
            "date": "06apr20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-7124: set the _Pt0"
          },
          {
            "version": "1.2",
            "date": "06apr20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-7124: change name to hsb-ConnectionDistribView"
          },
          {
            "version": "1.1",
            "date": "04apr20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-7124: support normal, parallel and arbitrary connections"
          },
          {
            "version": "1.0",
            "date": "27mar20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-7124: initial"
          }
        ],
        "settingsFiles": [
          "hsbExcel2Xml.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 8488,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates HardWrComp components and handles 3D geometry logic without ShopDrawing API (sd_*) calls. It uses Unit conversion U(1,'mm') and interacts with GenBeam/Element objects in the model environment. The script focuses on calculating connector distribution positions in 3D space."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbExcel2Xml.xml"
          ]
        }
      },
      "tokens_used": 7033,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sProject\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Loaded Project|\",\n      \"defaultValue\": \"Value from XML (Project Name)\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the Project|\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sManufacturer\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Manufacturer|\",\n      \"defaultValue\": \"---\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Populated from XML (Manufacturer[])\"\n      ],\n      \"category\": \"|Component|\",\n      \"description\": \"|Defines the Manufacturer|\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sModel\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Model|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"|Component|\",\n      \"description\": \"|Defines the Model|\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sArticle\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Article|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"|Component|\",\n      \"description\": \"|Defines the Article|\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sCDREf\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|CD-Ref|\",\n      \"defaultValue\": \"Populated from XML (Code[])\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Populated from XML (Code[])\"\n      ],\n      \"category\": \"|Code|\",\n      \"description\": \"|Defines the CDREf|\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"nNumber\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|CD"
      },
      "tokens_used": 10081,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "This script allows users to define, visualize, and calculate the distribution of mechanical connectors (like screws, nails, or plates) along a connection between two timber panels, supporting normal, parallel, and arbitrary joint angles.",
          "category": "Hardware",
          "typicalUseCase": "Used during detailing to specify exactly how many fasteners are needed, their spacing, and margins for a specific joint, then generating the corresponding hardware list for production."
        },
        "parameters": [
          {
            "name": "sProject",
            "technicalDefault": "Value from XML (Project Name)",
            "businessMeaning": "Associates the connection with a specific project name for reporting and material list organization.",
            "validRange": "Any string (typically read-only from settings)",
            "unit": "String",
            "affectsOutput": "Metadata only; tags the generated hardware with the project name."
          },
          {
            "name": "sManufacturer",
            "technicalDefault": "---",
            "businessMeaning": "Selects the hardware vendor (e.g., Simpson, Mitek) to determine which product catalogs are available for selection.",
            "validRange": "Manufacturers defined in 'hsbExcel2Xml.xml'",
            "unit": "String (Dropdown)",
            "affectsOutput": "Filters the available 'Model' and 'Article' options."
          },
          {
            "name": "sModel",
            "technicalDefault": "",
            "businessMeaning": "Selects the product family or series (e.g., a specific hanger or screw type series) from the chosen manufacturer.",
            "validRange": "Models defined under the selected Manufacturer in XML",
            "unit": "String (Dropdown)",
            "affectsOutput": "Filters the available 'Article' options."
          },
          {
            "name": "sArticle",
            "technicalDefault": "",
            "businessMeaning": "Selects the exact product SKU or part number (e.g., 'HUS24' or '5x90mm Screw') to be used in the connection.",
            "validRange": "Articles defined under the selected Model in XML",
            "unit": "String (Dropdown)",
            "affectsOutput": "Determines the geometry, dimensions, and cost of the hardware components generated."
          },
          {
            "name": "sCDREf",
            "technicalDefault": "Populated from XML (Code[])",
            "businessMeaning": "Connection Design Reference code identifying the type of joint or design standard (e.g., 'C1', 'Screw-Joint-A').",
            "validRange": "Codes defined in XML settings",
            "unit": "String (Dropdown)",
            "affectsOutput": "Used to load specific configuration rules and is written into hardware notes for reports."
          },
          {
            "name": "nNumber",
            "technicalDefault": "0",
            "businessMeaning": "An index or variant number for the specific connection design code, allowing multiple variations of the same CD-Ref.",
            "validRange": "Integer >= 0",
            "unit": "Count",
            "affectsOutput": "Appended to hardware notes (e.g., 'CD-Ref-1')."
          },
          {
            "name": "dDistanceBottom",
            "technicalDefault": "U(0)",
            "businessMeaning": "The margin distance from the start (bottom or left) of the connection to the first connector.",
            "validRange": "0mm to Connection Length",
            "unit": "mm",
            "affectsOutput": "Shifts the distribution pattern, reducing the effective length for spacing."
          },
          {
            "name": "dDistanceTop",
            "technicalDefault": "U(0)",
            "businessMeaning": "The margin distance from the end (top or right) of the connection to the last connector.",
            "validRange": "0mm to Connection Length",
            "unit": "mm",
            "affectsOutput": "Shifts the distribution pattern, reducing the effective length for spacing."
          },
          {
            "name": "dDistanceBetween",
            "technicalDefault": "U(5)",
            "businessMeaning": "Defines the spacing strategy: A positive value sets the fixed spacing between connectors (center-to-center). A negative value represents the desired total *quantity* of parts.",
            "validRange": "Positive (spacing): >0mm; Negative (count): e.g., -5 for 5 parts",
            "unit": "mm (Spacing) / Count (Quantity)",
            "affectsOutput": "Determines 'nNrResult' and 'dDistanceBetweenResult'. If positive, calculates max count; if negative, calculates exact spacing."
          },
          {
            "name": "dDistanceBetweenResult",
            "technicalDefault": "U(0)",
            "businessMeaning": "The calculated center-to-center distance between connectors based on the input parameters.",
            "validRange": "Read-only",
            "unit": "mm",
            "affectsOutput": "Visual representation of connector placement."
          },
          {
            "name": "nNrResult",
            "technicalDefault": "0",
            "businessMeaning": "The total calculated number of connectors that fit within the defined area.",
            "validRange": "Read-only",
            "unit": "Count",
            "affectsOutput": "Determines the total quantity in the material list."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sManufacturer changes",
            "effect": "Updates the list of available Models to those belonging to the new Manufacturer.",
            "cascade": [
              "sModel",
              "sArticle"
            ]
          },
          {
            "trigger": "sModel changes",
            "effect": "Updates the list of available Articles to those belonging to the new Model.",
            "cascade": [
              "sArticle"
            ]
          },
          {
            "trigger": "dDistanceBetween is changed from Positive to Negative",
            "effect": "Switches logic from 'Calculate Quantity based on Spacing' to 'Calculate Spacing based on Quantity'.",
            "cascade": [
              "nNrResult",
              "dDistanceBetweenResult"
            ]
          },
          {
            "trigger": "dDistanceBottom or dDistanceTop increases",
            "effect": "Reduces the effective available length for the distribution.",
            "cascade": [
              "nNrResult",
              "dDistanceBetweenResult"
            ]
          },
          {
            "trigger": "sCDREf changes",
            "effect": "Updates the sub-component references (SubA, SubB) based on the mapping in the XML configuration.",
            "cascade": [
              "Hardware Notes",
              "Sub-component Generation"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "HardWrComp",
            "description": "3D representation of the selected connector distributed along the joint.",
            "appliedTo": "The connection segment defined by the script insertion location."
          },
          {
            "type": "Sub-components (HardWrComp)",
            "description": "Additional hardware items (e.g., nails for a hanger) defined in the XML sub-mapping (SubA, SubB, etc.).",
            "appliedTo": "The connection segment, grouped with the main component."
          }
        ]
      },
      "tokens_used": 9366,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Initialization: Load constants, unit settings (mm), and debug flags.",
          "2. Settings Loading: Attempt to read 'hsbExcel2Xml' configuration from MapObject or XML file.",
          "3. Validation: Check if XML data is valid and loaded. If not, report error and abort insertion.",
          "4. User Input (Insert Only): Prompt user to select the first element (GenBeam or Element).",
          "5. User Input (Insert Only): Prompt user to select the second element (GenBeam or Element).",
          "6. User Input (Insert Only): Prompt user to define the start point of the connection distribution.",
          "7. User Input (Insert Only): Prompt user to define the end point of the connection distribution.",
          "8. Geometry Analysis: Calculate intersection planes and determine the connection length based on selected points.",
          "9. Catalog Lookup: Retrieve available Manufacturers, Models, and Articles from the loaded settings based on current property values.",
          "10. Distribution Calculation: Calculate effective length (Total Length - Margins).",
          "11. Branch Logic: Evaluate 'Distance between / Nr.' property to determine calculation mode (Fixed Spacing vs Fixed Quantity).",
          "12. Component Generation: Generate coordinate points for connectors and look up dimensions for the selected Article.",
          "13. Sub-component Processing: Check for associated sub-components (e.g., nails for a hanger) in the XML and generate them.",
          "14. Output Creation: Instantiate HardWrComp entities, apply materials, notes, and grouping.",
          "15. Final Update: Write CD-Ref notes into hardware info and update read-only result properties (Calculated Distance, Quantity)."
        ],
        "conditionalBranches": [
          {
            "condition": "Configuration Data Source",
            "path1": {
              "name": "MapObject Valid",
              "steps": [
                "Read configuration directly from the in-memory MapObject.",
                "Skip XML file parsing."
              ]
            },
            "path2": {
              "name": "MapObject Invalid",
              "steps": [
                "Search for 'hsbExcel2Xml.xml' in hsbCompany/TSL/Settings.",
                "Parse XML file.",
                "Create and store new MapObject for future runs."
              ]
            }
          },
          {
            "condition": "Distribution Input Mode (dDistanceBetween)",
            "path1": {
              "name": "Fixed Quantity Mode (Negative Input)",
              "steps": [
                "Interpret the absolute value of 'dDistanceBetween' as the desired number of parts.",
                "Calculate 'dDistanceBetweenResult' = Available Length / (Nr of parts - 1)."
              ]
            },
            "path2": {
              "name": "Fixed Spacing Mode (Positive Input)",
              "steps": [
                "Use 'dDistanceBetween' as the center-to-center spacing.",
                "Calculate 'nNrResult' = floor(Available Length / Spacing) + 1."
              ]
            }
          },
          {
            "condition": "Entity Selection Types",
            "path1": {
              "name": "Beam-Beam",
              "steps": [
                "Extract centerline/plane data from first GenBeam.",
                "Extract centerline/plane data from second GenBeam.",
                "Calculate intersection logic for beams."
              ]
            },
            "path2": {
              "name": "Element-Element / Mixed",
              "steps": [
                "Extract shell/plane data from Elements.",
                "Calculate intersection logic for panels or mixed geometries.",
                "Handle arbitrary connections."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of Settings File",
            "errorMessage": "no xml for screws found or wrong definition of the xml file 1001",
            "recovery": "Ensure 'hsbExcel2Xml.xml' exists in the 'hsbCompany\\TSL\\Settings' folder and contains valid Manufacturer/Model/Article data."
          },
          {
            "check": "Entity Selection during Insert",
            "errorMessage": "Script instance erased if selection is cancelled",
            "recovery": "User must select valid GenBeam or Element entities when prompted during the command insertion."
          },
          {
            "check": "Manufacturer/Model/Article Availability",
            "errorMessage": "Dropdowns empty or properties invalid",
            "recovery": "Select a valid Manufacturer to populate Models, then a valid Model to populate Articles. Ensure strings in properties match XML definitions."
          },
          {
            "check": "Geometric Constraints",
            "errorMessage": "Connectors generated at incorrect locations or floating in space",
            "recovery": "Ensure the selected start and end points lie on the valid intersection of the two selected structural elements."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Connection Length",
            "how": "Grip Edit (Start/End points)",
            "effect": "Modifies the calculation length, immediately recalculating 'nNrResult' and 'dDistanceBetweenResult', and visually updates connector distribution."
          },
          {
            "action": "Change Hardware Specification",
            "how": "OPM Properties Palette (Dropdowns)",
            "effect": "Changing 'Manufacturer' updates 'Model' list. Changing 'Model' updates 'Article' list. Changing 'Article' updates the geometry and metadata of the generated hardware."
          },
          {
            "action": "Modify Distribution Spacing",
            "how": "OPM Properties Palette (Numeric Input)",
            "effect": "Changing 'Distance between / Nr.' toggles between fixed spacing and fixed quantity logic. Changing 'Distance Bottom/Top' shifts the pattern."
          },
          {
            "action": "Update Reference Data",
            "how": "OPM Properties Palette",
            "effect": "Changing 'CD-Ref' or 'CD-Ref Number' updates the hardware notes and tags in the production lists."
          }
        ]
      },
      "tokens_used": 11414,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbConnectionDistribView\n\n## Overview\nThis script allows users to define, visualize, and calculate the distribution of mechanical connectors (such as screws, nails, or plates) along a connection between two timber panels or beams. It supports normal, parallel, and arbitrary joint angles and generates the corresponding hardware components for production lists.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates in the 3D model to create hardware components. |\n| Paper Space | No | Not designed for 2D drawing views. |\n| Shop Drawing | No | Does not process Shop Drawing layouts. |\n\n## Prerequisites\n- **Required Entities**: Two structural elements (GenBeam or Element) to form the connection.\n- **Minimum Beam Count**: 2 (or two Elements).\n- **Required Settings Files**: `hsbExcel2Xml.xml` located in the `hsbCompany\\TSL\\Settings` folder.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT`\n**Action**: Select `hsbConnectionDistribView.mcr` from the list and click OK.\n\n### Step 2: Select First Element\n```\nCommand Line: Select Element/Beam 1:\nAction: Click on the first timber beam or wall element.\n```\n\n### Step 3: Select Second Element\n```\nCommand Line: Select Element/Beam 2:\nAction: Click on the second timber beam or wall element that connects to the first.\n```\n\n### Step 4: Define Start Point\n```\nCommand Line: Specify start point of distribution:\nAction: Click on the intersection or surface where the connector distribution should begin.\n```\n\n### Step 5: Define End Point\n```\nCommand Line: Specify end point of distribution:\nAction: Click on the intersection or surface where the connector distribution should end.\n```\n\n### Step 6: Configure Properties\nAfter insertion, select the script instance and open the **Properties Palette** (Ctrl+1) to define the hardware manufacturer, model, and spacing logic.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Loaded Project** | String | Value from XML | The project name associated with the connection (read-only from settings). |\n| **Manufacturer** | Dropdown | --- | Select the hardware vendor (e.g., Simpson, Mitek). This filters the Model list. |\n| **Model** | Dropdown | *Empty* | Select the product series (e.g., specific hanger type). This filters the Article list. |\n| **Article** | Dropdown | *Empty* | Select the exact product SKU or part number. |\n| **CD-Ref** | Dropdown | *From XML* | Connection Design Reference code identifying the joint type. |\n| **CD-Ref Number** | Integer | 0 | An index or variant number for the specific CD-Ref. |\n| **Distance Bottom** | Double (mm) | 0 | Margin distance from the start (bottom/left) of the connection to the first connector. |\n| **Distance Top** | Double (mm) | 0 | Margin distance from the end (top/right) of the connection to the last connector. |\n| **Distance between / Nr.** | Double | 5 (mm) | **Spacing Logic**: <br>• **Positive Value**: Fixed spacing between connectors (mm). <br>• **Negative Value**: Fixed quantity of connectors (e.g., enter -5 to place 5 items). |\n| **Distance between Result** | Double (mm) | 0 | Read-only. Shows the calculated center-to-center spacing. |\n| **NrResult** | Integer | 0 | Read-only. Shows the total calculated number of connectors. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *Recalculate* | Updates the connector distribution based on current property values or geometry changes. |\n\n## Settings Files\n- **Filename**: `hsbExcel2Xml.xml`\n- **Location**: `hsbCompany\\TSL\\Settings`\n- **Purpose**: This file contains the catalog of Manufacturers, Models, Articles, and CD-Ref codes. Without this file, the dropdowns will be empty, and the script cannot function.\n\n## Tips\n- **Quick Spacing Adjustment**: To get an evenly distributed number of screws, simply enter a negative number in the **Distance between / Nr.** property (e.g., type `-10` to get 10 screws evenly spaced).\n- **Margin Control**: Increase **Distance Bottom** or **Distance Top** if you need to keep screws away from the edges of the timber.\n- **Visual Updates**: The script provides grip points at the start and end of the connection. Drag these grips in the model to adjust the length of the distribution area visually.\n- **Selection Logic**: You can mix Element types (e.g., select a Wall Element and a Beam Element); the script will calculate the intersection.\n\n## FAQ\n- **Q: Why are the Manufacturer, Model, and Article dropdowns empty?**\n  **A**: The script cannot find the `hsbExcel2Xml.xml` file, or the file is empty/corrupt. Ensure the file exists in your company settings folder.\n- **Q: I changed the spacing, but the connectors didn't move.**\n  **A**: Select the script instance and right-click -> **Recalculate**, or simply click in the **Distance between / Nr.** field and press Enter to force a refresh.\n- **Q: Can I use this for non-rectangular connections?**\n  **A**: Yes, the script supports normal, parallel, and arbitrary connection angles defined by the two selected elements and the points you pick."
      },
      "tokens_used": 7188,
      "error": null
    }
  }
}