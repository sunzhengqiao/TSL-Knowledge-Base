{
  "filename": "GE_PLOT_BEAM_SHOW_VERY_TOP_PLATES.mcr",
  "status": "completed",
  "total_tokens": 25935,
  "processing_time": 1067.2858102321625,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "v1.0",
            "date": "04.sep.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3595,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "getViewport() used during _bOnInsert, _Viewport array storage and retrieval, vp.element() usage, Display dp(4) for drawing. The script relies on the Paper Space Viewport context to access the Element geometry."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be inserted/executed in a Paper Space Layout context where a Viewport can be selected. The selected Viewport must be linked to a valid hsbCAD Element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 2943,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select the viewport from which the element is taken",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sTitle",
            "type": "PropString",
            "displayName": "|Hatch|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Read-only header property"
          },
          {
            "index": 1,
            "variable": "sDisplayHatch",
            "type": "PropString",
            "displayName": "     |Display Hatch|",
            "defaultValue": "|Yes|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sHatchPattern",
            "type": "PropString",
            "displayName": "     |Pattern|",
            "defaultValue": "DOTS",
            "inputType": "dropdown",
            "options": "_HatchPatterns",
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dHatchScale",
            "type": "PropDouble",
            "displayName": "     |Scale|",
            "defaultValue": "U(10,.5)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5184,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 2D drawing representation of the top wall plates in a Paper Space viewport, allowing the user to highlight them with specific hatch patterns.",
          "category": "ShopDrawing/Detailing",
          "typicalUseCase": "Creating a layout or detail view where the top plates of a wall need to be distinctly identified or hatched for production or presentation purposes."
        },
        "parameters": [
          {
            "name": "sDisplayHatch",
            "technicalDefault": "|Yes|",
            "businessMeaning": "Toggles whether the top plates are filled with a hatch pattern or outlined only.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If 'No', only the outline of the top plates is drawn. If 'Yes', the area is filled with the specified pattern."
          },
          {
            "name": "sHatchPattern",
            "technicalDefault": "DOTS",
            "businessMeaning": "Selects the visual texture or pattern used to fill the top plate areas.",
            "validRange": "Standard CAD hatch patterns (e.g., SOLID, ANSI31, DOTS, NET)",
            "unit": "N/A",
            "affectsOutput": "Changes the graphic appearance of the hatch applied to the top plates."
          },
          {
            "name": "dHatchScale",
            "technicalDefault": "U(10,.5)",
            "businessMeaning": "Adjusts the density or size of the hatch pattern.",
            "validRange": "1.0 to 100.0 (depending on pattern and drawing scale)",
            "unit": "mm / inch (Drawing Units)",
            "affectsOutput": "Higher values make the pattern appear more sparse/larger; lower values make it denser/smaller."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sDisplayHatch is set to |No|",
            "effect": "The visual output ignores the pattern and scale settings.",
            "cascade": [
              "sHatchPattern",
              "dHatchScale"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "2D Geometry (Polyline & Hatch)",
            "description": "Projects the envelope body of top plates onto the 2D plane and draws them. Optionally applies a hatch pattern.",
            "appliedTo": "Beams classified as _kSFVeryTopPlate or _kSFVeryTopSlopedPlate within the selected Element."
          }
        ]
      },
      "tokens_used": 4146,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script execution initiated (Insert or Recalculation).",
          "2. [Conditional: Insertion Phase] Check if insertCycleCount > 1. If true, erase instance and exit.",
          "3. [Conditional: Insertion Phase] Prompt user to select a Viewport on the command line.",
          "4. [Conditional: Insertion Phase] Store selected Viewport in global array. Set default hatch pattern to 'DOTS'.",
          "5. Retrieve the stored Viewport and associated hsbCAD Element.",
          "6. Validate that the Viewport has a valid hsbCAD Element link.",
          "7. [Validation Failure] If Element link is invalid, stop execution.",
          "8. Retrieve the Element's outline and transform it to the Viewport's Coordinate System.",
          "9. Draw the Element outline in Paper Space.",
          "10. Iterate through all Beams contained within the Element.",
          "11. [Conditional: Beam Type] Check if Beam type is 'Very Top Plate' or 'Very Top Sloped Plate'.",
          "12. [Branch: Skip] If beam type does not match, move to next beam.",
          "13. [Branch: Process] If match found, generate envelope body and calculate shadow profile (2D projection).",
          "14. Draw the beam outline.",
          "15. [Conditional: Display Hatch] Check 'sDisplayHatch' property.",
          "16. [Branch: No] If 'No', finish drawing beam.",
          "17. [Branch: Yes] If 'Yes', apply hatch pattern using 'sHatchPattern' and 'dHatchScale' settings.",
          "18. Script finishes processing."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count Check",
            "path1": {
              "name": "Preview/Drag Cycle",
              "steps": [
                "insertCycleCount is greater than 1",
                "eraseInstance() is called",
                "Script exits immediately"
              ]
            },
            "path2": {
              "name": "Final Placement",
              "steps": [
                "insertCycleCount is 1",
                "Proceed to Viewport selection prompt"
              ]
            }
          },
          {
            "condition": "Beam Classification Filter",
            "path1": {
              "name": "Top Plate Detected",
              "steps": [
                "Beam type matches _kSFVeryTopPlate or _kSFVeryTopSlopedPlate",
                "Extract envelope body",
                "Project to 2D profile",
                "Draw outline",
                "Apply hatch (if enabled)"
              ]
            },
            "path2": {
              "name": "Other Beam Type",
              "steps": [
                "Beam type does not match criteria",
                "Ignore beam",
                "Continue loop to next beam"
              ]
            }
          },
          {
            "condition": "Hatch Display Toggle",
            "path1": {
              "name": "Hatch Enabled (sDisplayHatch == |Yes|)",
              "steps": [
                "dp.draw(ppBm, hatch) is called",
                "Pattern from sHatchPattern and Scale from dHatchScale are applied"
              ]
            },
            "path2": {
              "name": "Hatch Disabled (sDisplayHatch == |No|)",
              "steps": [
                "Hatch function is skipped",
                "Only the polyline outline (ppBm) remains visible"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Element Link",
            "errorMessage": "No specific message shown to user, script simply exits.",
            "recovery": "Ensure the selected Viewport in Paper Space is linked to a valid hsbCAD Model Space Element (right-click viewport > Select Element or ensure viewport was created from an hsbCAD drawing)."
          },
          {
            "check": "Global _Viewport Array",
            "errorMessage": "None (Silent Exit)",
            "recovery": "Re-insert the script to ensure a viewport is selected and stored."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Hatch Appearance",
            "how": "Select the generated script instance in Paper Space and change properties in the Object Properties Palette (OPM).",
            "effect": "Changing 'Display Hatch' toggles the fill. Changing 'Pattern' or 'Scale' immediately updates the texture of the top plates."
          },
          {
            "action": "Regenerate after Model Changes",
            "how": "Update the 3D model or use hsbCAD update commands.",
            "effect": "The script will re-execute (recalculate), fetching the latest geometry from the linked Element and redrawing the top plates based on the new wall shape."
          }
        ]
      },
      "tokens_used": 5128,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_PLOT_BEAM_SHOW_VERY_TOP_PLATES.mcr\n\n## Overview\nThis script generates a 2D representation of the top wall plates (very top plates) in a Paper Space layout. It allows you to visually identify and hatch these specific plates within a selected viewport for detailing or presentation purposes.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for Paper Space layouts. |\n| Paper Space | Yes | Required. You must select a viewport to execute. |\n| Shop Drawing | No | This is a detailing/layout visualization tool. |\n\n## Prerequisites\n- **Required Entities**: A Layout tab with a Viewport.\n- **Minimum Beam Count**: 0.\n- **Required Settings**: The selected Viewport must be linked to a valid hsbCAD Element containing beams classified as \"Very Top Plate\" or \"Very Top Sloped Plate\".\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_PLOT_BEAM_SHOW_VERY_TOP_PLATES.mcr` from the file dialog.\n\n### Step 2: Select Viewport\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click on the viewport border inside your Layout tab that displays the wall you wish to detail.\n```\n\n### Step 3: Adjust Appearance (Optional)\nAfter insertion, select the script object (if visible or selectable) and modify the hatch settings in the Properties Palette to suit your plotting style.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| \\|Hatch\\| | Header | N/A | Read-only category header. |\n| Display Hatch | dropdown | \\|Yes\\| | Toggles the hatch fill on or off. If set to \"\\|No\\|\", only the outline of the top plates is drawn. |\n| Pattern | dropdown | DOTS | Selects the CAD hatch pattern to fill the top plates (e.g., SOLID, ANSI31, NET). |\n| Scale | number | U(10,.5) | Adjusts the scale/density of the selected hatch pattern. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are added by this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not use external settings files.\n\n## Tips\n- **Viewport Link**: Ensure the viewport you select is actually looking at an hsbCAD Element. If the viewport is not linked to an element, the script will not generate any geometry.\n- **Beam Classification**: This script specifically looks for beams classified as *Very Top Plate* or *Very Top Sloped Plate*. If your wall generation uses different naming, the script may not display anything.\n- **Updates**: If you modify the 3D model (e.g., change wall height or plate size), the script will automatically update the next time the drawing is recalculated or regenerated.\n\n## FAQ\n- **Q: I ran the script, but nothing happened.**\n- **A:** Ensure the selected viewport is linked to an element. Also, verify that the wall actually contains beams with the specific \"Very Top Plate\" classification.\n- **Q: How do I change the color of the hatch?**\n- **A:** The hatch color is usually controlled by the AutoCAD Layer settings (Layer 0 or current layer) or the script's display properties. You can select the generated hatch and change its color via the standard AutoCAD Properties palette.\n- **Q: Can I use this in Model Space?**\n- **A:** No, this script is designed explicitly for Paper Space viewports to create 2D layout details."
      },
      "tokens_used": 4939,
      "error": null
    }
  }
}