{
  "filename": "HSB_G-ToolingInformation.mcr",
  "status": "completed",
  "total_tokens": 44301,
  "processing_time": 772.8718018531799,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "10.07.2014",
            "author": "AS",
            "changes": "Pilot version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7610,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses `Group().collectEntities(true, Element(), _kModelSpace);` to retrieve project data. It does not contain `sd_` prefix, `#Type E` declarations, or `_Viewport` logic. Drawing occurs relative to `_Pt0` using standard Display objects."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "NailLine"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space with Elements containing NailLines",
          "requiredSettings": []
        }
      },
      "tokens_used": 6020,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 2,\n      \"variable\": \"sSeparatorContent\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Content\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sContent\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     Content\",\n      \"defaultValue\": \"Per element\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Per element\",\n        \"Entire project\"\n      ],\n      \"category\": null,\n      \"description\": \"Sets the breakdown of the table.\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"sSeparatorStyle\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Style\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sDimStyle\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     Dimension style\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"_DimStyles\"\n      ],\n      \"category\": null,\n      \"description\": \"Sets the dimension style.\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"dTextSize\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"     Text size\",\n      \"defaultValue\": \"-U(1)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": \"Sets the text size. The text size specified in the dimension style is used if the text size is set to zero or less.\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"nLineColor\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"     Line color\",\n      \"defaultValue\": \"1\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": \"Sets the color of the lines.\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"nTextColor\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"     Text color\",\n      \"defaultValue\": \"1\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": \"Sets the color of the text.\"\n    }\n  ],\n  \"contextMenu"
      },
      "tokens_used": 8600,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 2D schedule (table) summarizing the total count and types of nails used across the project or per individual element based on NailLine data.",
          "category": "ShopDrawing / Reporting",
          "typicalUseCase": "Creating a nail take-off report for material estimation or procurement, placed in the model space or on a drawing layout."
        },
        "parameters": [
          {
            "name": "sContent",
            "technicalDefault": "Per element",
            "businessMeaning": "Determines the granularity of the nail schedule. 'Per element' breaks down the nail usage by each specific wall/floor element, while 'Entire project' provides a single aggregated total for all elements.",
            "validRange": "Dropdown: 'Per element', 'Entire project'",
            "unit": "Selection",
            "affectsOutput": "Changes the table structure from a list of subsections (one per element) to a single summary table. Affects the total length/height of the generated table."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "Selects the CAD dimension style to control the font and text formatting standards for the schedule.",
            "validRange": "Any existing Dimension Style in the drawing",
            "unit": "String",
            "affectsOutput": "Affects the font, arrow style (if applicable), and default text height if the specific text size property is not overridden."
          },
          {
            "name": "dTextSize",
            "technicalDefault": "-1",
            "businessMeaning": "Explicitly sets the height of the text in the schedule. A value of zero or negative ignores this setting and uses the text height defined in the Dimension Style.",
            "validRange": "0 to 10 mm (Typically 2.5 - 5 mm for readability)",
            "unit": "Length (mm)",
            "affectsOutput": "Directly scales the text height. Increasing this value increases the row height of the table, making the schedule larger."
          },
          {
            "name": "nLineColor",
            "technicalDefault": "1",
            "businessMeaning": "Sets the CAD color index for the grid lines and borders of the table.",
            "validRange": "1 to 255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the visual color of the table lines. Default is usually Red (1) in hsbCAD, but users often change to White/Black or specific layer colors."
          },
          {
            "name": "nTextColor",
            "technicalDefault": "1",
            "businessMeaning": "Sets the CAD color index for the text content within the table.",
            "validRange": "1 to 255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the visual color of the labels and numerical data."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dTextSize <= 0",
            "effect": "The script ignores dTextSize and calculates row height based on the text height defined in sDimStyle.",
            "cascade": [
              "sDimStyle"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "2D Geometry (Lines and Text)",
            "description": "A tabulated schedule drawn at the insertion point (_Pt0). Contains columns for Nail Index, Nail Type (e.g., A-38, A-47), and calculated Amount (Quantity).",
            "appliedTo": "Model Space (placed at coordinate _Pt0)"
          }
        ]
      },
      "tokens_used": 7027,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User inserts script into Model Space.",
          "Script reads OPM Properties (sContent, sDimStyle, dTextSize, nLineColor, nTextColor).",
          "Script collects all Elements from Model Space.",
          "Script iterates through each Element and scans NailLines on layers -5 to 5.",
          "Script calculates nail quantity per NailLine (Path Length / Spacing) and groups by Tool Index.",
          "Script configures Display objects (Text, Lines) based on Color and Dimension properties.",
          "Script calculates Table Geometry (Row Height, Column Width) based on Text Size.",
          "Script draws Project Header (Project Number and Name) at insertion point (_Pt0).",
          "[Conditional Branch] Check sContent Property.",
          "If 'Per element': Draw sub-table for each element showing its specific nail usage.",
          "If 'Entire project': Accumulate data silently during iteration.",
          "Script completes iteration.",
          "[Conditional Branch] Check sContent Property again.",
          "If 'Entire project': Draw Summary Table with aggregated nail counts for the whole project.",
          "Script execution finishes."
        ],
        "conditionalBranches": [
          {
            "condition": "sContent Property Selection",
            "path1": {
              "name": "Per Element",
              "steps": [
                "Loop through collected Elements.",
                "Draw Element Number row.",
                "Draw 'Nails' sub-header row.",
                "Draw 'Index/Type/Amount' column headers.",
                "Loop through nails specific to this element.",
                "Draw individual nail rows.",
                "Continue to next Element.",
                "Skip Project Summary table drawing."
              ]
            },
            "path2": {
              "name": "Entire Project",
              "steps": [
                "Loop through collected Elements.",
                "Skip Element drawing.",
                "Skip per-element nail drawing.",
                "Accumulate nail counts into project totals arrays.",
                "Continue to next Element.",
                "Draw Project 'Nails' header.",
                "Draw 'Index/Type/Amount' column headers.",
                "Draw rows for aggregated project totals."
              ]
            }
          },
          {
            "condition": "dTextSize Property Value",
            "path1": {
              "name": "Explicit Size (> 0)",
              "steps": [
                "Set Display Text Height to dTextValue.",
                "Calculate Row Height (dHRow) as 2 * dTextSize."
              ]
            },
            "path2": {
              "name": "Style Based (<= 0)",
              "steps": [
                "Set Display Text Height based on sDimStyle (via textHeightForStyle).",
                "Calculate Row Height (dHRow) based on the Style's text height."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Unknown Nail Tool Index",
            "errorMessage": "(No error shown)",
            "recovery": "If a NailLine has a toolIndex not defined in the internal 'arNNailIndex' array, the script defaults the Type string to 'Unknown' to prevent crashing."
          },
          {
            "check": "Empty Model Space / No Elements",
            "errorMessage": "(No error shown)",
            "recovery": "Script draws the Project Name header but draws no data rows."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Content Breakdown",
            "how": "OPM (Properties Palette) -> sContent dropdown",
            "effect": "Switches the view between a detailed list per element and a single aggregated summary table."
          },
          {
            "action": "Adjust Visual Style",
            "how": "OPM -> sDimStyle, dTextSize, nLineColor, nTextColor",
            "effect": "Updates the text font, height, and line colors of the table immediately."
          }
        ]
      },
      "tokens_used": 9080,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-ToolingInformation.mcr\n\n## Overview\nThis script generates a 2D schedule (table) summarizing the total count and types of nails (tooling) used in your project. It calculates quantities based on NailLines found in your Elements and displays the results either broken down by each Element or as a single summary for the entire project.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be inserted into the Model Space to collect Element data. |\n| Paper Space | No | This script does not function in Paper Space. |\n| Shop Drawing | No | This is not a shop drawing generation script. |\n\n## Prerequisites\n- **Required Entities**: Elements (Walls/Floors) containing NailLines.\n- **Minimum Beam Count**: 0 (Based on Element data).\n- **Required Settings**: Dimension Styles (must exist in the drawing to use the `sDimStyle` parameter effectively).\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Browse and select `HSB_G-ToolingInformation.mcr`.\n3.  Click in the Model Space to set the insertion point (`_Pt0`) for the top-left corner of the table.\n\n### Step 2: Configure Properties\n1.  Select the script object in the drawing.\n2.  Open the **Properties Palette** (Ctrl+1).\n3.  Adjust parameters (see below) to change the report scope (Per element vs. Entire project) and visual styles.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Content | Dropdown | Per element | Determines the report structure. Choose **\"Per element\"** for a detailed list for each wall/floor, or **\"Entire project\"** for a single aggregated total. |\n| Dimension style | Dropdown | (Current) | Selects the CAD Dimension Style to control text font and formatting standards. |\n| Text size | Number | -1 | Sets the text height. If set to 0 or negative (default), the height defined in the selected Dimension Style is used. |\n| Line color | Number | 1 | Sets the CAD Color Index (1-255) for the table grid lines. |\n| Text color | Number | 1 | Sets the CAD Color Index (1-255) for the table text content. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Refreshes the table data if the model (NailLines/Elements) has changed. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on internal logic and standard CAD Dimension Styles; no external settings files are required.\n\n## Tips\n- **Formatting Control**: To ensure the table matches your drawing standards, create a specific Dimension Style (e.g., \"Annotation\") before inserting the script, then select it in the `Dimension style` property.\n- **Scaling**: If the text appears too small or too large, adjust the `Text size` property. Set it to `0` to revert to the Dimension Style's default text height.\n- **Data Accuracy**: Ensure your NailLines are correctly assigned to Elements (typically on layers -5 to 5). If a nail type shows as \"Unknown,\" the tool index used in the NailLine is not defined in the script's internal lookup list.\n- **Placement**: Place the script in an open area of Model Space, as the table height will grow depending on the number of nails found.\n\n## FAQ\n- **Q: Why is my table empty?**\n  **A:** The script searches for NailLines within Elements. Ensure Elements exist in the model and that NailLines are generated/visible on the correct layers.\n- **Q: How do I switch between a detailed list and a summary?**\n  **A:** Select the table, open the Properties Palette, and change the **Content** dropdown from \"Per element\" to \"Entire project\".\n- **Q: What does the default Text size of -1 do?**\n  **A:** It tells the script to ignore the manual size setting and instead use the text height defined inside the selected Dimension Style."
      },
      "tokens_used": 5964,
      "error": null
    }
  }
}