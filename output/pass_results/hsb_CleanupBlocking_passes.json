{
  "filename": "hsb_CleanupBlocking.mcr",
  "status": "completed",
  "total_tokens": 23360,
  "processing_time": 140.4468114376068,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "07.05.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "21.05.2010",
            "author": null,
            "changes": "Implement sequence number"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3864,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity with ElementWallSF() to select Elements in the model. It performs 3D geometric operations using PlaneProfile.extractContactFaceInPlane(), bm.stretchStaticTo(), and realBody/envelopeBody manipulation. There are no references to ShopDrawing APIs (sd_*) or Viewports."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space. The script requires the user to select one or more Elements (Walls) via the PrEntity prompt.",
          "requiredSettings": []
        }
      },
      "tokens_used": 2217,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one or More Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Unknown",
            "trigger": "On Insert if _kExecuteKey is empty",
            "title": null,
            "dataSource": "showDialogOnce() function (external)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2820,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically detects and adjusts blocking beams within a wall to fit correctly against angled top plates, resolving geometric overlaps.",
          "category": "Framing",
          "typicalUseCase": "Used when a wall contains an angled top plate (e.g., for vaulted ceilings or roof pitch changes) and standard blocking has been generated. The script ensures the blocking does not physically conflict with the angled plate by stretching/trimming the blocking to match the angle."
        },
        "parameters": [],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "Geometric Modification",
            "description": "The length and end angle of Blocking beams are modified using 'stretchStaticTo' to align exactly with the Angled Top Plate, provided the intersecting area is greater than 5 mm².",
            "appliedTo": "Beams classified as '_kSFBlocking' within the selected Wall Elements."
          }
        ]
      },
      "tokens_used": 5461,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Execution Starts (Insert/Run)",
          "2. Check insert cycle count; exit if cycle > 1 (prevents re-entry)",
          "3. If triggered without execution key, show setup dialog (showDialogOnce)",
          "4. Prompt user to select one or more Wall Elements (ElementWallSF)",
          "5. If selection is successful, iterate through each selected Element",
          "6. For each Element, spawn a new instance of the script (dbCreate) attached to that Element",
          "7. Parent instance erases itself",
          "8. Child instance retrieves assigned Element and validates it",
          "9. Child instance filters Element beams into 'Angled Top Plates' and 'Blocking' lists",
          "10. Child instance calculates geometric intersections between every Angled Plate and Blocking beam",
          "11. If intersection area > 5mm², stretch Blocking beam to match Angled Plate geometry",
          "12. Child instance erases itself (transient operation)"
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count Check",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase Instance",
                "Return (Stop)"
              ]
            },
            "path2": {
              "name": "Cycle = 1",
              "steps": [
                "Proceed to Dialog and Selection Prompt"
              ]
            }
          },
          {
            "condition": "Geometric Intersection Area",
            "path1": {
              "name": "Area > 5mm²",
              "steps": [
                "Identify conflict",
                "Execute stretchStaticTo on Blocking beam",
                "Align Blocking to Angled Plate"
              ]
            },
            "path2": {
              "name": "Area <= 5mm²",
              "steps": [
                "Ignore specific pair",
                "No modification made to beam"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Validity",
            "errorMessage": "None (Silent Failure)",
            "recovery": "Script erases instance if selected Element is invalid or missing."
          },
          {
            "check": "Entity Selection",
            "errorMessage": "None (Standard Cancel)",
            "recovery": "User must select valid Element entities. If selection is empty or cancelled, script exits."
          },
          {
            "check": "Intersection Threshold",
            "errorMessage": "None",
            "recovery": "Only blocking with significant overlap (> 5mm²) is modified to prevent micro-adjustments on barely touching beams."
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 5265,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_CleanupBlocking.mcr\n\n## Overview\nThis script automatically detects and adjusts blocking beams within wall elements to resolve geometric overlaps with angled top plates. It ensures that blocking fits correctly against angled surfaces (such as those found in vaulted ceilings or roof pitch changes).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the model environment. |\n| Paper Space | No | Not supported in layouts or viewports. |\n| Shop Drawing | No | Not intended for shop drawing creation. |\n\n## Prerequisites\n- **Required Entities**: Wall Elements (`ElementWallSF`).\n- **Minimum Beams**: None, but the selected walls must contain both Blocking beams (`_kSFBlocking`) and Angled Top Plates.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n```\nCommand Line: TSLINSERT\nAction: Browse to and select the file hsb_CleanupBlocking.mcr.\n```\n\n### Step 2: Select Wall Elements\n```\nCommand Line: Select one or More Elements\nAction: Click on the wall elements in the drawing that contain the blocking you wish to adjust.\n```\n\n### Step 3: Execute\n```\nAction: Press Enter or Right-Click to confirm selection.\nNote: The script will automatically process the walls, adjust the blocking geometry where overlaps are detected, and then finish.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| N/A | N/A | N/A | This script runs transiently and does not expose parameters in the Properties Palette. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| N/A | This script does not add specific options to the entity right-click menu. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Batch Processing**: You can select multiple wall elements in a single selection to process an entire floor or section at once.\n- **Intersection Threshold**: The script only modifies blocking if the overlap area with the top plate is greater than 5 mm². Small incidental touches may be ignored.\n- **Model Space Only**: Ensure you are working in Model Space; attempting to run this in a Paper Space viewport will not function as intended.\n- **Transient Tool**: This script does not leave a permanent script object attached to the wall after it finishes; it is a \"run once\" cleanup tool.\n\n## FAQ\n- **Q: Why did some of my blocking not change?**\n  **A:** The script only modifies blocking beams where the geometric intersection with an angled top plate is significant (area > 5mm²). If the overlap is very minor, the script preserves the original geometry.\n- **Q: Can I use this on individual beams?**\n  **A:** No, this tool is designed to work specifically on hsbCAD Wall Elements. It searches inside the element for the relevant blocking and top plates.\n- **Q: Does this script work for roof planes?**\n  **A:** It is designed for Wall Elements that contain angled top plates (e.g., a wall with an attic truss or a rake wall). It does not generate new roof geometry but cleans up the framing inside the wall."
      },
      "tokens_used": 3733,
      "error": null
    }
  }
}