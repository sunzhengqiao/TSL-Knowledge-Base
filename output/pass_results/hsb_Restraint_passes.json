{
  "filename": "hsb_Restraint.mcr",
  "status": "completed",
  "total_tokens": 33597,
  "processing_time": 392.15879225730896,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 1,
          "implInsert": 1
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "25.06.2008",
            "author": "Alberto Jena",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "10.11.2008",
            "author": "Alberto Jena",
            "changes": "Addition of Restraint types"
          },
          {
            "version": "1.2",
            "date": "10.05.2010",
            "author": "",
            "changes": "Change the Table and some small fixes on export"
          },
          {
            "version": "1.3",
            "date": "03.09.2010",
            "author": "",
            "changes": "Add Properties for other restraint type so the customer can define it"
          },
          {
            "version": "1.4",
            "date": "11.02.2011",
            "author": "",
            "changes": "Add group for the new data base"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5307,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getBeam and getPoint during _bOnInsert, creates 3D Body objects derived from GenBeam vectors, uses assignToGroups, and contains no sd_ functions, _Viewport references, or 2D drawing generation logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 3458,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialogOnce",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Pick a Point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getBeam",
              "promptOriginal": "Select a Beam",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dTh",
            "type": "PropDouble",
            "displayName": "Thickness",
            "defaultValue": "U(2)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dWi",
            "type": "PropDouble",
            "displayName": "Width",
            "defaultValue": "U(36)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dLe",
            "type": "PropDouble",
            "displayName": "Length",
            "defaultValue": "U(100)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nQty",
            "type": "PropInt",
            "displayName": "Quantity",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDispRep",
            "type": "PropString",
            "displayName": "Show in Disp Rep",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sModel",
            "type": "PropString",
            "displayName": "Model Type",
            "defaultValue": "ST-PFS-50",
            "inputType": "dropdown",
            "options": [
              "Other Model Type",
              "ST-PFS-50",
              "ST-PFS-75",
              "ST-PFS-100",
              "ST-PFS-50-M",
              "ST-PFS-75-M",
              "ST-PFS-100-M",
              "RE240",
              "RE90"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strCustomRestraintModel",
            "type": "PropString",
            "displayName": "Other Restraint Type",
            "defaultValue": "**Other Type**",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Please fill this value if you choose 'Other Model Type' above"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6112,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts a parametric L-shaped metal restraint or bracket (generic folded plate) attached to a selected timber element.",
          "category": "Hardware / Connectors",
          "typicalUseCase": "Modeling hold-downs, tension straps, or custom metal brackets where specific geometry is required for visualization and BOM export, but standard catalog parts are not applicable."
        },
        "parameters": [
          {
            "name": "dTh",
            "technicalDefault": "U(2)",
            "businessMeaning": "Material thickness of the metal plate/bracket.",
            "validRange": "2mm - 20mm (Standard steel plate gauges)",
            "unit": "mm",
            "affectsOutput": "Extrusion depth of both bodies of the L-bracket."
          },
          {
            "name": "dWi",
            "technicalDefault": "U(36)",
            "businessMeaning": "The width (or breadth) of the bracket legs.",
            "validRange": "30mm - 300mm",
            "unit": "mm",
            "affectsOutput": "Defines the lateral dimension along the beam's X-axis for both plates."
          },
          {
            "name": "dLe",
            "technicalDefault": "U(100)",
            "businessMeaning": "The length of the bracket legs extending from the insertion point.",
            "validRange": "50mm - 600mm",
            "unit": "mm",
            "affectsOutput": "Defines the extension of the vertical and horizontal legs of the bracket."
          },
          {
            "name": "nQty",
            "technicalDefault": "1",
            "businessMeaning": "Count of this specific restraint instance required at this location for material lists.",
            "validRange": "1 - 10",
            "unit": "count",
            "affectsOutput": "Does not change 3D geometry; updates the 'U_QUANTITY' data export and BOM entry."
          },
          {
            "name": "sDispRep",
            "technicalDefault": "",
            "businessMeaning": "Controls in which display representations (views) the restraint is visible.",
            "validRange": "Any valid Display Representation name (e.g., '3D', 'Plan', 'Elevation')",
            "unit": "string",
            "affectsOutput": "Hides the geometry in views unless the display representation matches this string."
          },
          {
            "name": "sModel",
            "technicalDefault": "ST-PFS-50",
            "businessMeaning": "Catalog or Product Model number used for data export and shop drawing labels.",
            "validRange": "Dropdown list (ST-PFS-50, RE240, etc.) or 'Other Model Type'",
            "unit": "string",
            "affectsOutput": "Updates the 'U_MODEL' export property and the BOM name; does not geometrically alter the plate unless mapped to specific dimensions in external catalogs."
          },
          {
            "name": "strCustomRestraintModel",
            "technicalDefault": "**Other Type**",
            "businessMeaning": "User-defined product code for non-standard restraints.",
            "validRange": "Free text",
            "unit": "string",
            "affectsOutput": "Used as the 'U_MODEL' and BOM Name when 'sModel' is set to 'Other Model Type'."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User selects 'Other Model Type' in sModel",
            "effect": "The value of 'strCustomRestraintModel' is used for export and BOM instead of the dropdown selection.",
            "cascade": [
              "strCustomRestraintModel"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (Metal Plate)",
            "description": "First leg of the L-shaped bracket, extruded perpendicular to the beam's Y-axis.",
            "appliedTo": "Insertion Point (_Pt0) on selected Beam"
          },
          {
            "type": "Body (Metal Plate)",
            "description": "Second leg of the L-shaped bracket, extruded perpendicular to the beam's Z-axis.",
            "appliedTo": "Insertion Point (_Pt0) on selected Beam"
          },
          {
            "type": "Data Export (DXI/BOM)",
            "description": "Exports Model Type (U_MODEL), Quantity (U_QUANTITY), and Grouping info.",
            "appliedTo": "Production Lists / CAM"
          }
        ]
      },
      "tokens_used": 6286,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script initialization: Properties are declared (Thickness, Width, Length, Quantity, Model Type, Custom Model).",
          "2. Catalog check: If _bOnDbCreated is true, properties are updated from the catalog using the execute key.",
          "3. Model String logic: Determines the final sRestraintModel. If sModel is 'Other Model Type', it uses strCustomRestraintModel; otherwise, it uses the selected sModel.",
          "4. Insertion Phase: Enters _bOnInsert block.",
          "5. Duplicate Prevention: Checks insertCycleCount(). If > 1, erases the instance and exits.",
          "6. Dialog: Calls showDialogOnce().",
          "7. Point Input: Prompts user to 'Pick a Point' and stores it in _Pt0.",
          "8. Beam Selection: Prompts user to 'Select a Beam' and appends it to the _Beam array.",
          "9. Calculation Phase (Execution):",
          "10. Validation: Checks if _Beam has at least one element. If not, erases instance and exits.",
          "11. Coordinate System Setup: Attempts to retrieve vx, vy, vz from _Map. If missing (first run), defaults to the selected Beam's local axes (Beam X, Z, Y).",
          "12. Dependency: Sets dependency on the selected beam and assigns the script to the beam's groups.",
          "13. Visualization: Draws temporary vectors at _Pt0.",
          "14. Geometry Creation: Constructs two PLine profiles and extrudes them into Body objects (L-shaped bracket) based on dWi, dLe, and dTh.",
          "15. Display Logic: Applies Display Representation filter (sDispRep) if specified.",
          "16. Data Export: Sets the Compare Key, exports U_MODEL and U_QUANTITY to DXI, and updates the internal BOM Map."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "First Cycle",
              "steps": [
                "Continue execution",
                "Show Dialog",
                "Get Point",
                "Get Beam"
              ]
            },
            "path2": {
              "name": "Subsequent Cycle",
              "steps": [
                "Erase Instance",
                "Return (Stop)"
              ]
            }
          },
          {
            "condition": "Model Type Selection",
            "path1": {
              "name": "Standard Model",
              "steps": [
                "sRestraintModel assigned value of sModel dropdown"
              ]
            },
            "path2": {
              "name": "Other Model Type",
              "steps": [
                "sRestraintModel assigned value of strCustomRestraintModel property"
              ]
            }
          },
          {
            "condition": "Vector Data Source (Recalculation vs Insertion)",
            "path1": {
              "name": "Map Data Exists (Recalculation)",
              "steps": [
                "Load vx, vy, vz from _Map",
                "Use stored orientation regardless of current beam axes"
              ]
            },
            "path2": {
              "name": "No Map Data (Initial Insertion)",
              "steps": [
                "Derive vx, vy, vz from _Beam[0] (vecX, vecZ, vecY)",
                "Store vectors in _Map for future reference"
              ]
            }
          },
          {
            "condition": "Beam Existence",
            "path1": {
              "name": "Beam Attached",
              "steps": [
                "Generate Geometry",
                "Export Data"
              ]
            },
            "path2": {
              "name": "No Beam",
              "steps": [
                "Erase Instance",
                "Return (Stop)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None",
            "recovery": "Script automatically removes duplicate instances triggered by the same insert event."
          },
          {
            "check": "Beam Presence",
            "errorMessage": "None",
            "recovery": "If the script runs without a valid beam selection, it erases itself to prevent errors."
          },
          {
            "check": "Point Input",
            "errorMessage": "Command line prompt",
            "recovery": "User must provide a point to proceed."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Resize Bracket",
            "how": "OPM (Properties Palette) - edit Width, Length, Thickness",
            "effect": "Geometry updates immediately to new dimensions."
          },
          {
            "action": "Change Product Info",
            "how": "OPM - Change Model Type or Custom Model Type",
            "effect": "Updates Export data (U_MODEL) and BOM Name; geometry unchanged."
          },
          {
            "action": "Update Quantity",
            "how": "OPM - edit Quantity",
            "effect": "Updates U_QUANTITY export and BOM count."
          },
          {
            "action": "Control Visibility",
            "how": "OPM - edit 'Show in Disp Rep'",
            "effect": "Hides/Shows the bracket in specific view configurations."
          },
          {
            "action": "Move Parent Beam",
            "how": "AutoCAD Move / Grips",
            "effect": "The restraint position updates based on the new beam location. Note: Orientation is fixed to the vectors stored in the Map at insertion, not the beam's current dynamic axes."
          }
        ]
      },
      "tokens_used": 6167,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_Restraint.mcr\n\n## Overview\nInserts a parametric L-shaped metal restraint or bracket (generic folded plate) attached to a selected timber element. It allows for the definition of dimensions, product codes, and quantities for BOM export and visualization.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the 3D model. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Generates 3D bodies only. |\n\n## Prerequisites\n- **Required entities**: At least one Timber Beam (GenBeam).\n- **Minimum beam count**: 1\n- **Required settings files**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_Restraint.mcr`\n\n### Step 2: Configure Initial Settings\n```\nDialog: Initial Configuration (if applicable)\nAction: Verify or modify default settings in the dialog, then click OK.\n```\n\n### Step 3: Define Insertion Point\n```\nCommand Line: Pick a Point\nAction: Click in the model space to specify the location where the restraint will be anchored.\n```\n\n### Step 4: Select Host Element\n```\nCommand Line: Select a Beam\nAction: Click on the timber beam to which the restraint will be attached.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Thickness | Number | 2 mm | Material thickness of the metal plate. |\n| Width | Number | 36 mm | The lateral dimension (width) of the bracket legs. |\n| Length | Number | 100 mm | The length of the bracket legs extending from the insertion point. |\n| Quantity | Number | 1 | The count of this restraint instance for material lists/BOM. |\n| Show in Disp Rep | Text | [Empty] | Specifies in which Display Representation (e.g., 3D, Plan) the object is visible. |\n| Model Type | Dropdown | ST-PFS-50 | The catalog product model code (e.g., ST-PFS-50, RE240). |\n| Other Restraint Type | Text | **Other Type** | Custom product code used only when \"Other Model Type\" is selected above. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom right-click menu options are defined for this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Quick Editing**: After insertion, select the restraint and use the Properties Palette (Ctrl+1) to quickly adjust dimensions (Thickness, Width, Length) without re-running the script.\n- **Visibility Control**: Use the **Show in Disp Rep** property to hide the restraint in specific views (like floor plans) while keeping it visible in 3D views.\n- **Custom Products**: If your specific bracket is not in the \"Model Type\" dropdown, select \"Other Model Type\" and enter your product code in the \"Other Restraint Type\" field.\n\n## FAQ\n- **Q: How do I change the quantity for the BOM without drawing multiple brackets?**\n  - A: Select the single bracket instance and change the \"Quantity\" property in the Properties Palette. This updates the BOM export without adding extra geometry.\n- **Q: Can I rotate the bracket after inserting it?**\n  - A: The orientation is locked to the beam's local axes at the moment of insertion. To change orientation, you typically must delete and reinsert the script, or adjust the rotation of the host beam if applicable.\n- **Q: Why did my bracket disappear?**\n  - A: Check the \"Show in Disp Rep\" property. It may be set to a display representation that is currently not active (e.g., set to \"Elevation\" while you are in \"3D\" view)."
      },
      "tokens_used": 6267,
      "error": null
    }
  }
}