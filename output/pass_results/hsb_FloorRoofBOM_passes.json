{
  "filename": "hsb_FloorRoofBOM.mcr",
  "status": "completed",
  "total_tokens": 49016,
  "processing_time": 414.66599106788635,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "28.08.2009",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "01.09.2009",
            "author": "",
            "changes": "Order reset to include Locating plate"
          },
          {
            "version": "1.2",
            "date": "14.09.2009",
            "author": "",
            "changes": "Add the option to filter materials"
          },
          {
            "version": "1.3",
            "date": "01.10.2009",
            "author": "",
            "changes": "Sort the timbers by length and height"
          },
          {
            "version": "1.4",
            "date": "29.10.2009",
            "author": "",
            "changes": "Add the Grade Column"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8782,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script prompts for 'Viewport from which the element is taken' using getViewport(). It uses Display dp for drawing and coordinates the Viewport to ModelSpace transformation (ms2ps). Although it requests an insertion point via getPoint (Model Space), it relies on a viewport selection to access the construction data."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Requires a Viewport linked to a valid Element to generate the BOM table.",
          "requiredSettings": []
        }
      },
      "tokens_used": 6276,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Pick the Insertion Point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select the viewport from which the element is taken",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dim Style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 3,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "strMaterial",
            "type": "PropString",
            "displayName": "Materials to exclude from the BOM",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Please fill the materials that you dont need to be list on the BOM, use ';' if you want to filter more that 1 material"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7293,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a formatted Bill of Materials (BOM) table in 2D Paper Space, categorizing timber members (studs, plates, lintels) and sheathing materials by size, grade, and quantity derived from a selected 3D model element.",
          "category": "ShopDrawing",
          "typicalUseCase": "Creating a material take-off or cutting list on a drawing layout to accompany floor plans or elevation views for fabrication or ordering."
        },
        "parameters": [
          {
            "name": "_Pt0",
            "technicalDefault": "User Selected",
            "businessMeaning": "The insertion point for the top-left corner of the BOM table on the drawing sheet.",
            "validRange": "Any coordinate within the Paper Space limits",
            "unit": "mm",
            "affectsOutput": "Determines the spatial location of the generated table on the layout."
          },
          {
            "name": "_Viewport",
            "technicalDefault": "User Selected",
            "businessMeaning": "The viewport that links the 2D drawing to the specific 3D element (floor or roof) to be analyzed.",
            "validRange": "Any active viewport displaying a valid hsbCAD Element",
            "unit": "N/A",
            "affectsOutput": "Filters the source data; only beams and sheets belonging to the selected Element are listed."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "\"\" (Empty)",
            "businessMeaning": "The text style definition (font, height) used for the content and headers of the BOM table.",
            "validRange": "Any existing Dimension Style or Text Style defined in the AutoCAD drawing",
            "unit": "N/A",
            "affectsOutput": "Controls the font size and text height of the table, which dynamically adjusts column widths and overall table size to maintain readability."
          },
          {
            "name": "nColor",
            "technicalDefault": "3",
            "businessMeaning": "The display color index for the text and lines generated in the BOM.",
            "validRange": "0 to 255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the visual color of the BOM text drawn in Paper Space (e.g., to distinguish it from dimensions or notes)."
          },
          {
            "name": "strMaterial",
            "technicalDefault": "\"\"",
            "businessMeaning": "A filter list of sheathing/wallboard material names to exclude from the 'Wallboard' section of the BOM.",
            "validRange": "Text string (e.g., 'OSB;GYPBOARD;PLYWOOD')",
            "unit": "String",
            "affectsOutput": "Removes specific sheeting materials from the bottom section of the report, reducing clutter for non-structural or temporary materials."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing sDimStyle",
            "effect": "Recalculates the width of table columns based on the new text metrics defined in the style.",
            "cascade": [
              "Column Widths",
              "Total Table Width"
            ]
          },
          {
            "trigger": "Changing strMaterial",
            "effect": "Re-evaluates the list of sheets; items matching the excluded list are omitted from the Wallboard section.",
            "cascade": [
              "Wallboard Section Row Count",
              "Total Table Height"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text/Table",
            "description": "A grouped list of construction materials. The top section lists Timber elements categorized by function (Locating Plate, Bottom Plate, Top Plate, Stud, Transom, Lintel, Blocking) with columns for Ref, Dimension (W x H), Length, Angle (Cut N - Cut P), Amount, Material, and Grade. The bottom section lists Sheet elements (Wallboard) with columns for Ref, Dimension (W x L), Thickness, and Amount.",
            "appliedTo": "Paper Space (Layout)"
          }
        ]
      },
      "tokens_used": 10519,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script initialization: Parse user properties (Dimension Style, Color, Material Exclusion List)",
          "[Conditional] Check Insertion Flag (_bOnInsert)",
          "   [True] Prompt user for 'Pick the Insertion Point'",
          "   [True] Prompt user for 'Select the viewport from which the element is taken'",
          "   [True] Store data, set calculation flag, and Exit",
          "   [False] Retrieve the last used Viewport and coordinate system",
          "   [False] Validate that the Viewport contains a valid hsbCAD Element",
          "   [False] Retrieve all Beams from the Element",
          "   [False] Loop through Beams to categorize (Skip 'Blocking', Map specific types to groups like 'Stud' or 'Plate', or 'Generic')",
          "   [False] Sort Beams within each group (Ascending by Length, then Height)",
          "   [False] Draw Timber BOM Section (Headers for Ref, Dim, Length, Angle, Amount, Material, Grade)",
          "   [False] Retrieve all Sheets from the Element",
          "   [False] Filter Sheets based on 'Materials to exclude' property",
          "   [False] Draw Wallboard BOM Section (Headers for Ref, Dim, Thickness, Amount)",
          "Script Completion"
        ],
        "conditionalBranches": [
          {
            "condition": "Script Execution Mode",
            "path1": {
              "name": "Insertion Mode",
              "steps": [
                "Prompt for insertion point",
                "Prompt for viewport selection",
                "Stop script execution"
              ]
            },
            "path2": {
              "name": "Calculation/Redraw Mode",
              "steps": [
                "Read stored properties and viewport",
                "Regenerate BOM tables based on current model data and properties"
              ]
            }
          },
          {
            "condition": "Element Validity Check",
            "path1": {
              "name": "Valid Element Found",
              "steps": [
                "Proceed to extract Beams and Sheets",
                "Generate Geometry"
              ]
            },
            "path2": {
              "name": "Invalid/No Element",
              "steps": [
                "Script terminates immediately",
                "No output generated"
              ]
            }
          },
          {
            "condition": "Sheet Material Filter",
            "path1": {
              "name": "Material NOT in exclusion list",
              "steps": [
                "Include sheet in Wallboard BOM calculation",
                "Draw row in table"
              ]
            },
            "path2": {
              "name": "Material IS in exclusion list",
              "steps": [
                "Skip sheet",
                "Do not display in Wallboard BOM"
              ]
            }
          },
          {
            "condition": "Beam Type Classification",
            "path1": {
              "name": "Specific Structural Types (Stud, Plate, Lintel, etc.)",
              "steps": [
                "Assign to specific category group (e.g., 'Stud', 'Top Plate')",
                "Sort and list under that category header"
              ]
            },
            "path2": {
              "name": "Blocking or Generic",
              "steps": [
                "If Blocking: Skip/Exclude from BOM",
                "If Generic: Group into 'Generic' category"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport array (_Viewport) has elements",
            "errorMessage": "(None - Silent failure)",
            "recovery": "User must insert the script again or ensure a viewport was selected during initial setup."
          },
          {
            "check": "Viewport contains a valid hsbCAD Element (vp.element().bIsValid())",
            "errorMessage": "(None - Silent failure)",
            "recovery": "User must select a viewport that is linked to a 3D Element or ensure the Element is not corrupted."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Materials to exclude from the BOM",
            "how": "Edit 'Materials to exclude from the BOM' property in the Properties Palette (OPM)",
            "effect": "Re-evaluates the 'Wallboard' section; rows containing materials matching the input string are removed, and the table is redrawn."
          },
          {
            "action": "Change Dimension Style",
            "how": "Edit 'Dim Style' property in the Properties Palette (OPM)",
            "effect": "Redraws the entire BOM using the new text style (font, height). Column widths and overall table size adjust to fit the new text metrics."
          },
          {
            "action": "Change Color",
            "how": "Edit 'Color' property in the Properties Palette (OPM)",
            "effect": "Updates the AutoCAD color index for all generated text and lines in the BOM."
          }
        ]
      },
      "tokens_used": 10520,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_FloorRoofBOM.mcr\n\n## Overview\nGenerates a detailed Bill of Materials (BOM) table in Paper Space. It lists timber members (categorized by type like studs, plates, and lintels) and sheathing materials, including dimensions, lengths, grades, and quantities, based on a selected 3D model element.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | The script generates 2D output on layout sheets. |\n| Paper Space | Yes | The table is inserted directly onto the layout. |\n| Shop Drawing | No | This is a general drafting utility. |\n\n## Prerequisites\n- **Required Entities:** A viewport linked to a valid hsbCAD Element (Floor or Roof).\n- **Minimum beam count:** 0\n- **Required settings files:** None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_FloorRoofBOM.mcr`\n\n### Step 2: Define Insertion Point\n```\nCommand Line: Pick the Insertion Point\nAction: Click anywhere in the Paper Space layout to define the top-left corner of the BOM table.\n```\n\n### Step 3: Select Source Viewport\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click on the border of a viewport that displays the 3D element (Floor/Roof) you wish to analyze.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dim Style | dropdown | (Current Dim Style) | Select the text style to be used for the table content. Changing this automatically adjusts column widths to fit the text. |\n| Color | number | 3 | Sets the AutoCAD Color Index for the table text and lines (e.g., 3 is Green). |\n| Materials to exclude from the BOM | text | (Empty) | Enter material names to omit from the sheathing list. Separate multiple materials with a semicolon (e.g., `OSB;GYPBOARD`). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not use custom right-click menu options. Modify parameters via the Properties Palette to trigger updates. |\n\n## Settings Files\n- **Filename**: N/A\n- **Location**: N/A\n- **Purpose**: No external settings files are used.\n\n## Tips\n- **Filtering Materials:** If you want to list structural timber but exclude temporary sheathing (like bracing), add the material name of the sheathing to the \"Materials to exclude\" property.\n- **Table Sizing:** If the text looks cramped or too spread out, change the **Dim Style** property to a style with larger or smaller text height. The table will automatically resize.\n- **Sorting:** Timbers are automatically sorted by length and height within their specific categories (e.g., all Studs are grouped together and sorted).\n\n## FAQ\n- **Q: Why did the table not appear after I selected the viewport?**\n  - **A:** Ensure the selected viewport is linked to a valid hsbCAD Element. If the viewport shows a standard AutoCAD drawing or an empty element, the script will not generate data.\n- **Q: How do I remove a specific type of board from the bottom of the list?**\n  - **A:** Select the generated BOM, open the Properties Palette, find \"Materials to exclude from the BOM\", and type the name of the material exactly as it appears in your model.\n- **Q: Can I change the text color?**\n  - **A:** Yes. Select the BOM table and change the \"Color\" property in the Properties Palette to any valid AutoCAD color index number."
      },
      "tokens_used": 5626,
      "error": null
    }
  }
}