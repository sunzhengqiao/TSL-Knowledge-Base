{
  "filename": "Floor - Vertical and Horizontal Bridging.mcr",
  "status": "completed",
  "total_tokens": 53502,
  "processing_time": 192.93409824371338,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7763,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates Beam entities using dbCreate and interacts with ElementRoof and ElementWall entities via PrEntity prompts. It does not contain ShopDrawing specific functions (sd_*), Sheet objects, Viewport checks, or #Type E declarations."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementRoof",
            "ElementWall",
            "Beam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space containing Floor or Wall elements, or at least two Beams for manual selection.",
          "requiredSettings": []
        }
      },
      "tokens_used": 7235,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Please Select Floor Elements or Enter to Select Individual Beams",
              "condition": "_bOnInsert && nInsMode==0",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select two beams",
              "condition": "_bOnInsert && nInsMode==0 && _Element.length() < 1",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "Select first point of Bridging Line",
              "condition": "_bOnInsert && nInsMode==0",
              "required": true
            },
            {
              "step": 4,
              "function": "PrPoint",
              "promptOriginal": "\nSelect next point",
              "condition": "_bOnInsert && nInsMode==0",
              "required": true
            },
            {
              "step": 5,
              "function": "PrEntity",
              "promptOriginal": "Please Select Floor Elements",
              "condition": "_bOnInsert && nInsMode>=1",
              "required": true
            },
            {
              "step": 6,
              "function": "PrEntity",
              "promptOriginal": "Please Select Wall Elements",
              "condition": "_bOnInsert && nInsMode>=1",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "insertCycleCount() <= 1 during _bOnInsert",
            "title": null,
            "dataSource": "Script Properties (sInsMode, sType, etc.)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "Type",
            "defaultValue": "|Noggin/Dwang|",
            "inputType": "dropdown",
            "options": [
              "|Noggin/Dwang|",
              "|Extrusion Profile|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sInsMode",
            "type": "PropString",
            "displayName": "Insertion Mode",
            "defaultValue": "|Select Walls|",
            "inputType": "dropdown",
            "options": [
              "|Draw Line|",
              "|Select Walls|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "Width of Bridging",
            "defaultValue": 44,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dHeight",
            "type": "PropDouble",
            "displayName": "Height of Bridging",
            "defaultValue": 222,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dDistribution",
            "type": "PropDouble",
            "displayName": "Bridging Centers",
            "defaultValue": 400,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sProfile",
            "type": "PropString",
            "displayName": "|Extrusion profile name|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 12,
            "variable": "sName",
            "type": "PropString",
            "displayName": "Name",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sMaterial",
            "type": "PropString",
            "displayName": "Material",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sGrade",
            "type": "PropString",
            "displayName": "Grade",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 13,
            "variable": "sLabel",
            "type": "PropString",
            "displayName": "Label",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 14,
            "variable": "sBeamCode",
            "type": "PropString",
            "displayName": "Beam Code",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sJustification",
            "type": "PropString",
            "displayName": "|Vertical Justification|",
            "defaultValue": "|Top|",
            "inputType": "dropdown",
            "options": [
              "|Top|",
              "|Center|",
              "|Bottom|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 11,
            "variable": "sHJustification",
            "type": "PropString",
            "displayName": "|Horizontal Justification|",
            "defaultValue": "|Left|",
            "inputType": "dropdown",
            "options": [
              "|Left|",
              "|Center|",
              "|Right|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sDouble",
            "type": "PropString",
            "displayName": "|Double Bridging|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "|Color|",
            "defaultValue": 7,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "sMetalClips",
            "type": "PropString",
            "displayName": "Insert Metal Part",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "sPlateType",
            "type": "PropString",
            "displayName": "Connector",
            "defaultValue": "UZ38",
            "inputType": "dropdown",
            "options": [
              "UZ38"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 10,
            "variable": "sPlateModel",
            "type": "PropString",
            "displayName": "|Hanger Model|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Regenerate Beams",
            "handler": "Regenerate Beams",
            "action": "Erases existing beam entities and recreates them based on current settings.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 10207,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 9919,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Start: Initialize properties (sType, sInsMode, Dimensions, Material, etc.)",
          "2. On Insert: Check if 'showDialogOnce' is triggered to display input dialog",
          "3. User sets properties including 'Insertion Mode' (Draw Line or Select Walls)",
          "4. [Branch] Insertion Mode: Draw Line (nInsMode==0)",
          "   4a. Prompt: Select Floor Elements (Optional)",
          "   4b. [Condition] If no Floor Elements selected -> Prompt: Select two Beams",
          "   4c. Prompt: Select first point of Bridging Line (_Pt0)",
          "   4d. Prompt: Select next point of Bridging Line (_PtG)",
          "   4e. [Validation] Check distance between points",
          "5. [Branch] Insertion Mode: Select Walls (nInsMode>=1)",
          "   5a. Prompt: Select Floor Elements (ElementRoof)",
          "   5b. Prompt: Select Wall Elements (ElementWall)",
          "6. Set ExecutionMode to Insert (0) and Pause (return)",
          "7. Script Recalculation/Execution begins",
          "8. Identify Target Geometry:",
          "   8a. If Elements exist: Generate PlaneProfiles from Walls and Floors, collect Joists",
          "   8b. If No Elements (Manual): Use selected Beams (_Beam0, _Beam1) and drawn line points",
          "9. Generate Bridging Beams:",
          "   9a. If 'Regenerate Beams' triggered or Inserting: Erase existing mapped beams",
          "   9b. Calculate intersection regions and spacing based on 'Bridging Centers'",
          "   9c. Create Beam entities (dbCreate) with specified dimensions and profiles",
          "   9d. Stretch beams to intersect with Joists or limit to manual line",
          "   9e. Assign attributes (Material, Grade, Name, Code)",
          "10. Visualization: Draw markers at beam centers"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Mode Property (sInsMode)",
            "path1": {
              "name": "Draw Line Mode",
              "steps": [
                "Prompt for Floor Elements (Optional)",
                "If skipped, Prompt for 2 Beams",
                "Get Start Point",
                "Get End Point",
                "Calculate bridging along the line defined by points relative to the selected Beams"
              ]
            },
            "path2": {
              "name": "Select Walls Mode",
              "steps": [
                "Prompt for Floor Elements (ElementRoof)",
                "Prompt for Wall Elements (ElementWall)",
                "Generate bridging based on intersection of Wall/Floor profiles with Floor Joists"
              ]
            }
          },
          {
            "condition": "Element Selection during Draw Line Mode",
            "path1": {
              "name": "Floor Elements Selected",
              "steps": [
                "Populate _Element array",
                "Script proceeds to Wall/Floor intersection logic using these elements"
              ]
            },
            "path2": {
              "name": "No Floor Elements (Manual Beam Selection)",
              "steps": [
                "Populate _Beam array (Requires 2 beams)",
                "Script proceeds to Manual Line/Beam intersection logic"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Distance between Bridging Line points (_Pt0 and _PtG[0])",
            "errorMessage": "Two points are on the same spot",
            "recovery": "Script erases instance and exits; user must restart command and pick distinct points."
          },
          {
            "check": "Number of selected Beams (when Floor Elements are skipped in Draw Line mode)",
            "errorMessage": "There has been no Elements or Beams Selected. Please restart command and make your Selection. Thank you.",
            "recovery": "Script erases instance and exits; user must restart and ensure at least 2 beams are selected."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties (OPM)",
            "how": "AutoCAD Properties Palette",
            "effect": "Changing properties (Width, Height, Distribution, Justification, etc.) triggers script recalc and updates geometry immediately. Insertion Mode becomes read-only."
          },
          {
            "action": "Regenerate Beams",
            "how": "Right-click Context Menu -> 'Regenerate Beams'",
            "effect": "Erases all existing bridging beams created by this instance and recreates them based on current geometry and settings."
          }
        ]
      },
      "tokens_used": 11798,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Floor - Vertical and Horizontal Bridging\n\n## Overview\nThis script automates the generation of bridging (nogging/dwang) or herringbone strutting between floor joists. It supports two workflows: manually drawing a bridging line between beams, or automatically generating bridging based on selected floor and wall elements.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Primary usage environment. |\n| Paper Space | No | Not supported for this script. |\n| Shop Drawing | No | This script generates model geometry only. |\n\n## Prerequisites\n- **Required Entities:** Floor elements (`ElementRoof`), Wall elements (`ElementWall`), or structural `Beam` entities.\n- **Minimum Beam Count:** 2 beams (if using \"Draw Line\" mode without floor elements selected).\n- **Required Settings:** None (uses internal script properties).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Floor - Vertical and Horizontal Bridging.mcr`\n\n### Step 2: Configuration Dialog\nUpon launching, a dialog will appear allowing you to set the initial parameters.\n- **Action:** Set the **Insertion Mode** (Draw Line or Select Walls).\n- **Action:** Define dimensions (**Width**, **Height**) and **Bridging Centers** (spacing).\n- **Action:** Choose the **Type** (Noggin/Dwang or Extrusion Profile).\n- **Action:** Click OK to proceed.\n\n### Step 3: Define Geometry (Based on Insertion Mode)\n\n**Option A: Draw Line Mode**\n1. **Command Line:** `Please Select Floor Elements or Enter to Select Individual Beams`\n   - **Action:** Select floor elements if available, OR press Enter to select beams manually.\n2. **(If Enter pressed)** **Command Line:** `Select two beams`\n   - **Action:** Select the two joists/beams between which you want to insert bridging.\n3. **Command Line:** `Select first point of Bridging Line`\n   - **Action:** Click the start point for the bridging run.\n4. **Command Line:** `Select next point`\n   - **Action:** Click the end point. Ensure this point is not identical to the start point.\n\n**Option B: Select Walls Mode**\n1. **Command Line:** `Please Select Floor Elements`\n   - **Action:** Select the floor elements (ElementRoof) containing the joists.\n2. **Command Line:** `Please Select Wall Elements`\n   - **Action:** Select the wall elements (ElementWall) that define the boundaries for the bridging.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | dropdown | Noggin/Dwang | Choose between standard timber nogging or a specific extrusion profile. |\n| Insertion Mode | dropdown | Select Walls | Choose \"Draw Line\" to define path manually, or \"Select Walls\" for automatic generation. (Read-only after insertion). |\n| Width of Bridging | number | 44 | The width (thickness) of the bridging timber. |\n| Height of Bridging | number | 222 | The depth (height) of the bridging timber. |\n| Bridging Centers | number | 400 | The spacing (center-to-center) between each bridging piece. |\n| Extrusion profile name | dropdown | (empty) | Select the profile to use if Type is set to \"Extrusion Profile\". |\n| Name | text | (empty) | Assign a specific name to the generated beams. |\n| Material | text | (empty) | Specify the material code. |\n| Grade | text | (empty) | Specify the timber grade. |\n| Label | text | (empty) | Add a label text. |\n| Beam Code | text | (empty) | Assign a specific beam code. |\n| Vertical Justification | dropdown | Top | Align bridging to the Top, Center, or Bottom of the joist. |\n| Horizontal Justification | dropdown | Left | Align bridging to the Left, Center, or Right of the insertion line. |\n| Double Bridging | dropdown | No | Set to \"Yes\" to install double nogging. |\n| Dimstyle | dropdown | (empty) | Select the dimension style for annotations. |\n| Color | number | 7 | Set the color index for the generated beams. |\n| Insert Metal Part | dropdown | Yes | Enable or disable insertion of metal connecting clips. |\n| Connector | dropdown | UZ38 | Select the type of metal connector/clip (e.g., UZ38). |\n| Hanger Model | text | (empty) | Specify the model name for hangers if applicable. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Regenerate Beams | Deletes all bridging beams currently generated by this instance and recreates them based on the current geometry and property settings. Useful if you modified the surrounding structure. |\n\n## Settings Files\n- No external settings files are required for this script.\n\n## Tips\n- **Distinct Points:** When using \"Draw Line\" mode, ensure your start and end points are not at the exact same location, or the script will exit and delete the instance.\n- **Manual Selection:** If you do not have floor elements available in the model, you must select exactly two beams manually to define the boundaries for \"Draw Line\" mode.\n- **Adjusting Spacing:** You can change the \"Bridging Centers\" property in the Properties Palette after insertion to instantly update the spacing of the bridging.\n- **Justification:** Use \"Vertical Justification\" set to \"Center\" if you want the bridging to float in the middle of the joist depth, rather than sitting at the top or bottom.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I picked points?**\n  - **A:** You likely picked two points that are in the exact same spot, or you failed to select the required beams/elements. Restart the command and ensure your selection is valid.\n- **Q: Can I change the insertion mode after placing the bridging?**\n  - **A:** No, the \"Insertion Mode\" property becomes read-only once the script is inserted into the drawing. You must delete the instance and re-insert it to switch between \"Draw Line\" and \"Select Walls\" modes.\n- **Q: How do I add metal clips to the bridging?**\n  - **A:** Set \"Insert Metal Part\" to \"Yes\" and select the desired \"Connector\" type (e.g., UZ38) in the Properties Palette before or after insertion."
      },
      "tokens_used": 6580,
      "error": null
    }
  }
}