{
  "filename": "HSB_G-ElementInformation.mcr",
  "status": "completed",
  "total_tokens": 24612,
  "processing_time": 539.6915218830109,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "17.06.2016",
            "author": "AS",
            "changes": "Pilot version."
          },
          {
            "version": "1.01",
            "date": "26.09.2016",
            "author": "AS",
            "changes": "Store information in _Map for dxf output."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4150,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly creates instances in _kModelSpace via 'tslNew.dbCreate(..., _kModelSpace, mapTsl)'. It targets Element entities and calculates geometry relative to the element's 3D coordinate system (CoordSys). There is no usage of _Viewport, _kPaperSpace, or sd_* prefixes associated with Paper Space or Shop Drawing environments."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (_kModelSpace)",
          "requiredSettings": []
        }
      },
      "tokens_used": 2253,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Properties Dialog (showDialog)",
            "trigger": "On Insert (if _kExecuteKey is empty or not found in catalog)",
            "title": "Properties of HSB_G-ElementInformation",
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 1,
            "variable": "showInDisplayRepresentation",
            "type": "PropString",
            "displayName": "|Show in display representation|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_ThisInst.dispRepNames()"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "elementOutlineColor",
            "type": "PropInt",
            "displayName": "|Color element outline|",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": "|Outline|",
            "description": null
          },
          {
            "index": 0,
            "variable": "elementNumberDimStyle",
            "type": "PropString",
            "displayName": "|Dimension style element number|",
            "defaultValue": "0",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": "|Element number|",
            "description": null
          },
          {
            "index": 1,
            "variable": "elementNumberColor",
            "type": "PropInt",
            "displayName": "|Color element number|",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": "|Element number|",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3494,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a graphical overlay of Element information, specifically the outline and element number, which is visible in specific display representations and can be exported to DXF.",
          "category": "Annotation/Documentation",
          "typicalUseCase": "When the user needs to visualize element outlines or numbers in specific model views (e.g., for layout plans or export to production software) without altering the physical geometry of the timber."
        },
        "parameters": [
          {
            "name": "showInDisplayRepresentation",
            "technicalDefault": "",
            "businessMeaning": "Determines which display representation (view style) will show the generated outline and element number. This allows the annotation to be visible only in specific plans (e.g., Floor Plans) but hidden in others (e.g., 3D views).",
            "validRange": "List of available display representations in the project (e.g., 'Model', 'Plan', 'Section')",
            "unit": "N/A (Selection)",
            "affectsOutput": "Visibility of the drawn outline and text entity in the CAD interface."
          },
          {
            "name": "elementOutlineColor",
            "technicalDefault": "1",
            "businessMeaning": "Sets the color of the graphical line representing the element's gross outline.",
            "validRange": "1-255 (Standard AutoCAD color index)",
            "unit": "Color Index",
            "affectsOutput": "Color of the element boundary line."
          },
          {
            "name": "elementNumberDimStyle",
            "technicalDefault": "0",
            "businessMeaning": "Selects the dimension style to apply to the element number text, controlling font size, arrowheads, and text formatting.",
            "validRange": "List of dimension styles defined in the drawing template.",
            "unit": "N/A (Selection)",
            "affectsOutput": "Text appearance (height, font, etc.) of the element number."
          },
          {
            "name": "elementNumberColor",
            "technicalDefault": "1",
            "businessMeaning": "Sets the color of the element number text.",
            "validRange": "1-255 (Standard AutoCAD color index)",
            "unit": "Color Index",
            "affectsOutput": "Color of the element number text."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "showInDisplayRepresentation is set to a non-existent or empty representation",
            "effect": "The outline and number may not display in any view, or default to active view behavior depending on system settings.",
            "cascade": [
              "elementOutlineColor",
              "elementNumberDimStyle",
              "elementNumberColor"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Graphical Annotation (PLine/Text)",
            "description": "Creates a non-destructive visual representation of the Element's profile (PLine) and its unique identifier (Text). This data is also stored in a Map for potential DXF export.",
            "appliedTo": "Selected hsbCAD Element"
          }
        ]
      },
      "tokens_used": 3914,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User launches script HSB_G-ElementInformation.",
          "2. Script checks if insertCycleCount > 1 (prevents loops).",
          "3. Script checks if a valid Execute Key (Catalog Entry) was used.",
          "4. [Conditional] If no Execute Key or invalid key, open Properties Dialog for user configuration.",
          "5. Save current configuration to the '_LastInserted' catalog.",
          "6. Prompt user to select Elements (PrEntity).",
          "7. If selection confirmed, iterate through all selected Elements.",
          "8. For each Element, create a new instance in ModelSpace with the 'ManualInserted' flag set to true in the Map.",
          "9. Erase the initial 'Master' instance and exit.",
          "10. [New Instance Start] Verify attached Element is valid.",
          "11. [Conditional] If 'ManualInserted' flag is true, load properties from '_LastInserted' catalog.",
          "12. Retrieve Element coordinate system and gross profile (profBrutto).",
          "13. Calculate position for the Element Number text.",
          "14. Generate graphical display: PLine for outline and Text for number.",
          "15. Store PLine and Text data into the instance Map under key 'Dxf' for export.",
          "16. Finish execution."
        ],
        "conditionalBranches": [
          {
            "condition": "Usage of Execute Key during Insertion",
            "path1": {
              "name": "Catalog Mode",
              "steps": [
                "Script detects valid _kExecuteKey",
                "Properties loaded automatically from catalog",
                "Properties Dialog skipped",
                "Proceed to entity selection"
              ]
            },
            "path2": {
              "name": "Manual Mode",
              "steps": [
                "Script detects empty or invalid _kExecuteKey",
                "Properties Dialog pops up",
                "User adjusts settings (Display Rep, Colors, etc.)",
                "User confirms settings",
                "Proceed to entity selection"
              ]
            }
          },
          {
            "condition": "Text Position Calculation Geometry",
            "path1": {
              "name": "Calculated Center",
              "steps": [
                "Get ordered vertices on X and Y axes",
                "Calculate midpoint between X extremes",
                "Project midpoint onto Y-axis average",
                "Position text at calculated intersection"
              ]
            },
            "path2": {
              "name": "Geometric Average",
              "steps": [
                "Calculate average of all outline vertices",
                "Position text at average point"
              ]
            }
          },
          {
            "condition": "Post-Creation Validation",
            "path1": {
              "name": "Valid State",
              "steps": [
                "Element reference is found",
                "Geometry and text are drawn",
                "Map data is updated"
              ]
            },
            "path2": {
              "name": "Error State",
              "steps": [
                "Element reference is missing/invalid",
                "Report warning to user",
                "Instance is erased"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None (Silent fail)",
            "recovery": "Script erases self immediately to prevent recursive loops."
          },
          {
            "check": "Element Availability",
            "errorMessage": "invalid or no element selected.",
            "recovery": "The script instance is erased. User must re-insert or ensure the element is not deleted."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Appearance",
            "how": "Properties Palette (OPM)",
            "effect": "Updating 'Color element outline', 'Color element number', or 'Dimension style' immediately redraws the graphics. Updating 'Show in display representation' changes visibility in different viewports."
          },
          {
            "action": "Update Element Geometry",
            "how": "Modify the parent hsbCAD Element (e.g., change size/shape)",
            "effect": "Script recalculates on next rebuild/update, resizing the outline and repositioning the element number text automatically."
          }
        ]
      },
      "tokens_used": 5782,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-ElementInformation\n\n## Overview\nThis script generates a graphical overlay displaying the outline and element number of selected hsbCAD Elements. It allows users to visualize specific element information in designated display representations (e.g., floor plans) and prepares data for DXF export.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in Model Space and creates visual references there. |\n| Paper Space | No | This script does not function in Paper Space. |\n| Shop Drawing | No | This script is not intended for Shop Drawing layouts. |\n\n## Prerequisites\n- **Required Entities**: At least one existing hsbCAD Element (e.g., a wall or floor assembly).\n- **Minimum Beam Count**: 0 (Attaches to Elements, not individual beams).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Browse and select `HSB_G-ElementInformation.mcr`.\n\n### Step 2: Configure Settings (If applicable)\n- If you are running the script manually without a predefined catalog entry, a **Properties Dialog** will appear.\n- Set the desired Display Representation, Colors, and Dimension Style.\n- Click **OK** to confirm.\n\n### Step 3: Select Elements\n```\nCommand Line: Select elements\nAction: Click on the hsbCAD Elements (walls/roofs) you want to annotate. Press Enter to confirm selection.\n```\n*The script will automatically attach the annotation to the selected elements.*\n\n## Properties Panel Parameters\n\nThese parameters can be edited via the AutoCAD Properties Palette (Ctrl+1) after insertion.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Show in display representation | dropdown | *Project Default* | Determines which view style (e.g., Model, Plan, Section) will display the outline and number. |\n| Color element outline | number | 1 | Sets the color index (1-255) for the line drawn around the element's gross profile. |\n| Dimension style element number | dropdown | 0 | Selects the text style (font, size) used for the element number label. |\n| Color element number | number | 1 | Sets the color index (1-255) for the element number text. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are added by this script. Use standard Properties to modify. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **View Control**: Use the *Show in display representation* property to ensure annotations only appear in 2D plans while remaining hidden in 3D views to keep the model clean.\n- **Automatic Updates**: If you modify the geometry of the parent Element (e.g., change its length or height), the outline and text position will update automatically.\n- **DXF Export**: This script stores data in an internal map specifically for DXF output, ensuring that element outlines and numbers are correctly transferred to production software.\n\n## FAQ\n- **Q: Why did the text/outline disappear from my model?**\n  - A: Check the *Show in display representation* property. It may be set to a display representation that is currently not active in your viewport.\n- **Q: What happens if I delete the Element the script is attached to?**\n  - A: The script instance will detect that the Element is invalid and automatically erase itself to prevent errors."
      },
      "tokens_used": 5019,
      "error": null
    }
  }
}