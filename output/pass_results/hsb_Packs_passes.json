{
  "filename": "hsb_Packs.mcr",
  "status": "completed",
  "total_tokens": 53275,
  "processing_time": 421.84374022483826,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "06.08.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.2",
            "date": "11.08.2010",
            "author": null,
            "changes": "Add plate Height as a property"
          },
          {
            "version": "1.3",
            "date": "19.11.2010",
            "author": null,
            "changes": "Add the beams to the group of the main beam and also add the option to select ultiple beams in one go"
          },
          {
            "version": "1.4",
            "date": "04.04.2011",
            "author": null,
            "changes": "Add the option to have a center orientation when the packs are not in the extreme of the joist"
          },
          {
            "version": "1.5",
            "date": "21.04.2011",
            "author": null,
            "changes": "Changed multiple insert instances to single instances for flexibility of grip points.  Changed edge and mid insert for multiple instances"
          },
          {
            "version": "1.6",
            "date": "21.07.2011",
            "author": null,
            "changes": "Add beam Code P to the new beams"
          },
          {
            "version": "1.9",
            "date": "21.04.2020",
            "author": null,
            "changes": "Backer blocs are automatically integrated tools"
          }
        ],
        "settingsFiles": [
          "\\Abbund\\Materials.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 7129,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script filename 'hsb_Packs.mcr' does not use 'sd_' or 'Multipage' prefixes. The logic involves interactive selection of 3D beams using getBeam() and getPoint(), creates 3D Body objects, and generates new Beam entities via dbCreate(). It applies BeamCut tools to the selected beam. There are no references to _Viewport, shop drawing entities, or 2D detailing functions."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D BIM environment)",
          "requiredSettings": [
            "_kPathHsbCompany\\Abbund\\Materials.xml"
          ]
        }
      },
      "tokens_used": 6550,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getBeam\",\n        \"promptOriginal\": \"Select Male Beam\",\n        \"condition\": \"Insertion Mode is 'Single Instance'\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"Please select a point where you need the Packers\",\n        \"condition\": \"Insertion Mode is 'Single Instance'\",\n        \"required\": true\n      },\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"\\nSelect a set of beams\",\n        \"condition\": \"Insertion Mode is 'Multiple Instance'\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"Please select a point that define the side of the beam to inser the packs\",\n        \"condition\": \"Insertion Mode is 'Multiple Instance'\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"Property Dialog\",\n      \"trigger\": \"Initial Insertion (_bOnInsert)\",\n      \"title\": \"hsb_Packs Properties\",\n      \"dataSource\": \"Internal Property Declarations\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    },\n    {\n      \"type\": \"ShowNotice\",\n      \"trigger\": \"Error: Materials.xml not found or empty\",\n      \"title\": \"Notice\",\n      \"dataSource\": \"Static String\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 4,\n      \"variable\": \"sMode\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Insertion Mode\",\n      \"defaultValue\": \"Single Instance\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Single Instance\",\n        \"Multiple Instance\"\n      ],\n      \"category\": 0,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"dPlateWidth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Backer Block Width\",\n      \"defaultValue\": 80.0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": 0,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dPlateHeight\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Backer Block Height\",\n      \"defaultValue\": 150.0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": 0,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dBackerThickness\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Backer Block Thickness\",\n      \"defaultValue\": 15.0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": 0,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"dPlateThickness\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Squeeze Block Thickness\",\n      \""
      },
      "tokens_used": 9659,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts Backer Blocks (stiffeners) and/or Squash Blocks (load packers) onto a beam to support joists or transfer loads, typically used in timber floor or roof framing.",
          "category": "Framing",
          "typicalUseCase": "When installing joists into a supporting beam, packers are required between joist webs (Backers) or under the joist bottom chord (Squash) to prevent rotation and transfer loads."
        },
        "parameters": [
          {
            "name": "sMode",
            "technicalDefault": "Single Instance",
            "businessMeaning": "Selects the operational mode: creating packs for one specific beam or processing a batch of multiple beams at once.",
            "validRange": "Single Instance, Multiple Instance",
            "unit": "Enum",
            "affectsOutput": "Determines the user prompts (Single/Multiple selection) and whether a single script instance or multiple individual instances are created."
          },
          {
            "name": "dPlateWidth",
            "technicalDefault": 80.0,
            "businessMeaning": "The width (length along the beam axis) of the packer blocks.",
            "validRange": "40.0 - 200.0",
            "unit": "mm",
            "affectsOutput": "Defines the length of the new packer beams."
          },
          {
            "name": "dPlateHeight",
            "technicalDefault": 150.0,
            "businessMeaning": "The vertical height of the Backer Block (stiffener).",
            "validRange": "50.0 - 300.0",
            "unit": "mm",
            "affectsOutput": "Defines the vertical size of the Backer Block."
          },
          {
            "name": "dBackerThickness",
            "technicalDefault": 15.0,
            "businessMeaning": "The thickness (depth) of the Backer Block perpendicular to the supporting beam.",
            "validRange": "15.0 - 45.0",
            "unit": "mm",
            "affectsOutput": "Defines the width of the Backer Block and the size of the pocket cut into the main beam."
          },
          {
            "name": "dPlateThickness",
            "technicalDefault": 15.0,
            "businessMeaning": "The thickness (depth) of the Squash Block.",
            "validRange": "15.0 - 45.0",
            "unit": "mm",
            "affectsOutput": "Defines the width of the Squash Block."
          },
          {
            "name": "sShape",
            "technicalDefault": "Left",
            "businessMeaning": "Specifies the position of the packers relative to the selection point or beam end.",
            "validRange": "Left, Right, Both",
            "unit": "Enum",
            "affectsOutput": "Controls whether the packer is generated on one side or both sides of the reference point."
          },
          {
            "name": "sBeams",
            "technicalDefault": "Backer Block",
            "businessMeaning": "Selects the type of packer to generate.",
            "validRange": "Backer Block, Squash Block, Both",
            "unit": "Enum",
            "affectsOutput": "Filters geometry creation to generate vertical stiffeners, flat load-bearing blocks, or both simultaneously."
          },
          {
            "name": "sNameBacker",
            "technicalDefault": "Backer Block",
            "businessMeaning": "The name assigned to the Backer Block entity in the model.",
            "validRange": "String",
            "unit": "Text",
            "affectsOutput": "Sets the Entity Name for BIM data and lists."
          },
          {
            "name": "sNameSqueeze",
            "technicalDefault": "Squash Block",
            "businessMeaning": "The name assigned to the Squash Block entity in the model.",
            "validRange": "String",
            "unit": "Text",
            "affectsOutput": "Sets the Entity Name for BIM data and lists."
          },
          {
            "name": "sBeamMaterial",
            "technicalDefault": "Default from XML",
            "businessMeaning": "The material grade of the timber used for the packers.",
            "validRange": "C14, C24, GL24h, etc.",
            "unit": "Text",
            "affectsOutput": "Assigns physical material properties to the new beams."
          },
          {
            "name": "sBeamLabel",
            "technicalDefault": "",
            "businessMeaning": "Custom label text for the packers.",
            "validRange": "String",
            "unit": "Text",
            "affectsOutput": "Updates the Label property for labeling."
          },
          {
            "name": "sBeamInformation",
            "technicalDefault": "",
            "businessMeaning": "Additional information or comments for the packers.",
            "validRange": "String",
            "unit": "Text",
            "affectsOutput": "Updates the Information property."
          },
          {
            "name": "sBackerCode",
            "technicalDefault": "",
            "businessMeaning": "Production or assembly code for the Backer Block.",
            "validRange": "String (e.g. 'P')",
            "unit": "Text",
            "affectsOutput": "Sets the BeamCode property."
          },
          {
            "name": "sSquashCode",
            "technicalDefault": "",
            "businessMeaning": "Production or assembly code for the Squash Block.",
            "validRange": "String (e.g. 'P')",
            "unit": "Text",
            "affectsOutput": "Sets the BeamCode property."
          },
          {
            "name": "nColor",
            "technicalDefault": -1,
            "businessMeaning": "The color used to display the packers in the CAD model.",
            "validRange": "0-255, -1 (ByLayer)",
            "unit": "Index",
            "affectsOutput": "Visual appearance of the new beams."
          },
          {
            "name": "nZones",
            "technicalDefault": 1,
            "businessMeaning": "The construction zone or phase the packer belongs to.",
            "validRange": "1, 2, 3, 4, 5, 0, -1, -2, -3, -4, -5",
            "unit": "Index",
            "affectsOutput": "Assigns the element to a specific zone in the Element Group."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sBeams selection",
            "effect": "Activates or ignores specific dimension parameters based on the chosen type.",
            "cascade": [
              "dPlateHeight",
              "dBackerThickness",
              "dPlateThickness"
            ]
          },
          {
            "trigger": "sMode = Multiple Instance",
            "effect": "Converts the selection to a batch of 'Single Instance' scripts and erases the parent instance.",
            "cascade": [
              "sMode",
              "_Beam"
            ]
          },
          {
            "trigger": "User Point Location relative to Beam Ends",
            "effect": "Determines the offset calculation (End vs Center) for the packer placement.",
            "cascade": [
              "nOffset"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam",
            "description": "Creates 'Backer Block' or 'Squash Block' beams based on the Type parameter (EWP_Back_Block or EWP_Squash_Block).",
            "appliedTo": "Model Space (relative to the selected 'Male Beam')."
          },
          {
            "type": "BeamCut",
            "description": "Adds a machining operation to the selected main beam to cut a recess for the Backer Block, ensuring it sits flush with or within the beam volume.",
            "appliedTo": "The selected 'Male Beam'."
          },
          {
            "type": "ElementGroup",
            "description": "Links the newly created packer beams to the main beam's element group for data management.",
            "appliedTo": "Selected Main Beam and new Packer Beams."
          }
        ]
      },
      "tokens_used": 9608,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Execution: Start\",\n    \"2. Environment Check: Validate Materials.xml exists at _kPathHsbCompany\\\\Abbund\\\\Materials.xml\",\n    \"3. Data Loading: Parse XML for Material list\",\n    \"4. [Validation] Check Material List: If empty, report error and exit\",\n    \"5. [Insertion] Trigger Property Dialog (ShowDialogOnce)\",\n    \"6. Determine Insertion Mode (sMode)\",\n    \"7. [Branch: Single Instance] User selects 1 Male Beam\",\n    \"8. [Branch: Single Instance] User selects Insertion Point on Beam\",\n    \"9. [Branch: Multiple Instance] User selects Set of Beams\",\n    \"10. [Branch: Multiple Instance] User selects Side Definition Point\",\n    \"11. [Branch: Multiple Instance] Script loops through selected beams\",\n    \"12. [Branch: Multiple Instance] For each beam, insert a new 'Single Instance' script instance with current properties\",\n    \"13. [Branch: Multiple Instance] Erase the parent 'Multiple Instance' script\",\n    \"14. Geometry Calculation: Project User Point to Beam Centerline\",\n    \"15. Logic Check: Determine if Point is at 'Extreme' (End) or 'Mid-Span' (Center) based on distance to ends (tolerance 5mm)\",\n    \"16. [Conditional] Calculate Packer coordinates (End snap vs Projected point)\",\n    \"17. Geometry Generation: Create Bodies based on Shape (Left/Right/Both) and Type (Backer/Squash/Both)\",\n    \"18. Entity Creation: Generate GenBeams (Packer/Squash) and assign Material/Name/Code\",\n    \"19. Machining: Apply BeamCut to Main Beam for Backer Blocks only\",\n    \"20. Grouping: Assign new beams to Main Beam's Element Group\",\n    \"21. Visualization: Draw Bodies and Point Indicators\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Insertion Mode (sMode)\",\n      \"path1\": {\n        \"name\": \"Single Instance\",\n        \"steps\": [\n          \"Prompts user for single Beam selection\",\n          \"Prompts user for specific Packers location point\",\n          \"Calculates and generates geometry immediately within the active instance\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Multiple Instance\",\n        \"steps\": [\n          \"Prompts user for multiple Beam selection (PrEntity)\",\n          \"Prompts user for side definition point\",\n          \"Iterates selection: Creates a new Single Instance script for every beam found\",\n          \"Transfers properties (Dimensions, Shape, Type) to child instances\",\n          \"Erases self (eraseInstance) - does not create geometry itself\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Point Location Logic (Distance to Beam Ends)\",\n      \"path1\": {\n        \"name\": \"Mid-Span (Interior)\",\n        \"steps\": [\n          \"Condition: Distance to Left End > 5mm AND Distance to Right End > 5mm\",\n          \"Sets nOffset = 0 (Center Orientation)\",\n          \"Uses exact user projection on centerline for placement\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Extreme Ends\",\n        \"steps\": [\n          \"Condition: Distance to Left End <= 5mm OR Distance to Right End <= 5mm\",\n          \"Sets nOffset = -1 (End Orientation)\",\n          \"Snaps insertion point to nearest beam end (Left or Right)\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Location Property (sShape)\",\n      \"path1\": {\n        \"name\": \"Left\",\n        \"steps\": [\n          \"Calculates geometry on +Y side of insertion point (relative to beam system)\",\n          \"Generates beams if Type matches\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Right\",\n        \"steps\": [\n          \"Calculates geometry on -Y side of insertion point\",\n          \"Generates beams if Type matches\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"Both\",\n        \"steps\": [\n          \"Executes calculation for Left side\",\n          \"Executes calculation for Right side\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Type Property (sBeams)\",\n      \"path1\": {\n        \"name\": \"Backer Block\",\n        \"steps\": [\n          \"Creates Body using dPlateWidth, dPlateHeight, dBackerThickness\",\n          \"Creates Beam of type _kEWPBacker_Block\",\n          \"Adds BeamCut tool to Main Beam to recess the backer\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Squash Block\",\n        \"steps\": [\n          \"Creates Body using dPlateWidth, Main Beam Height (dHBm), dPlateThickness\",\n          \"Creates Beam of type _kEWPSquash_Block\",\n          \"No machining applied to Main Beam\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"Both\",\n        \"steps\": [\n          \"Creates Backer Block Body and Beam\",\n          \"Creates Squash Block Body and Beam\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \""
      },
      "tokens_used": 11856,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_Packs.mcr\n\n## Overview\nInserts Backer Blocks (stiffeners) and/or Squash Blocks (load packers) onto a supporting beam to stabilize joists or transfer loads, commonly used in timber floor and roof framing.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used for 3D detailing and BIM modeling. |\n| Paper Space | No | Not applicable for 2D drawings. |\n| Shop Drawing | No | Not a shop drawing generation script. |\n\n## Prerequisites\n- **Required Entities**: At least one `GenBeam` (supporting beam) must exist in the model.\n- **Minimum Beam Count**: 1.\n- **Required Settings**: The file `Materials.xml` must exist in your company folder structure (`...\\Abbund\\Materials.xml`) to provide material grades.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_Packs.mcr` from the list.\n*The Properties palette will open to allow configuration before insertion.*\n\n### Step 2: Configure Properties\nIn the Properties palette (OPM), set the desired dimensions and types:\n- Choose **Insertion Mode** (Single or Multiple).\n- Set dimensions for **Backer Block Width/Height/Thickness** and **Squash Block Thickness**.\n- Select **Type** (Backer Block, Squash Block, or Both).\n- Select **Shape** (Left, Right, or Both sides relative to the point).\n- Set **Material** and **Names** as required.\n\n### Step 3: Select Beam(s)\nThe command line prompt depends on the Insertion Mode selected in properties.\n\n**If Mode = Single Instance:**\n```\nCommand Line: Select Male Beam\nAction: Click on the single beam where you want to add packers.\n```\n\n**If Mode = Multiple Instance:**\n```\nCommand Line: Select a set of beams\nAction: Select multiple beams in the drawing (e.g., using a window or crossing selection) and press Enter.\n```\n\n### Step 4: Define Location\n**If Mode = Single Instance:**\n```\nCommand Line: Please select a point where you need the Packers\nAction: Click on the selected beam to place the packers.\n```\n*Note: If you click near the end of the beam (within 5mm), the packer snaps to the end. If you click in the middle, it centers at that location.*\n\n**If Mode = Multiple Instance:**\n```\nCommand Line: Please select a point that define the side of the beam to insert the packs\nAction: Click a point in the model to define which side (Left or Right) the packers will be applied to for all selected beams.\n```\n\n### Step 5: Completion\n- **Single Mode**: The script generates the packer beams and applies cuts (if Backer Blocks are used) immediately.\n- **Multiple Mode**: The script creates individual script instances for each selected beam and erases the parent \"Multiple\" instance. You can then grip-edit individual instances later.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Insertion Mode | dropdown | Single Instance | Sets whether to process one beam or a batch of beams at once. |\n| Backer Block Width | number | 80.0 | The length of the packer block measured along the beam axis (mm). |\n| Backer Block Height | number | 150.0 | The vertical height of the Backer Block (mm). |\n| Backer Block Thickness | number | 15.0 | The thickness (depth into the beam) of the Backer Block (mm). |\n| Squash Block Thickness | number | 15.0 | The thickness (depth) of the Squash Block (mm). |\n| Shape | dropdown | Left | Determines if the packer is placed on the Left, Right, or Both sides of the selection point. |\n| Type | dropdown | Backer Block | Selects which component to create: Backer Block, Squash Block, or Both. |\n| Name Backer | text | Backer Block | The entity name assigned to created Backer Blocks for lists and BIM data. |\n| Name Squash | text | Squash Block | The entity name assigned to created Squash Blocks. |\n| Material | dropdown | Default | The timber material grade (e.g., C24, GL24h) read from Materials.xml. |\n| Label | text | (Empty) | Custom label text for the packers. |\n| Information | text | (Empty) | Additional comments or information. |\n| Code Backer | text | (Empty) | Production/assembly code for the Backer Block. |\n| Code Squash | text | (Empty) | Production/assembly code for the Squash Block. |\n| Color | number | ByLayer | The color index for displaying the new beams. |\n| Zones | number | 1 | The construction zone or phase assignment. |\n\n## Right-Click Menu Options\nThe standard TSL context menu options apply to the script instance after insertion:\n- **Erase Instance**: Removes the script and deletes the associated packer beams.\n- **Show Dynamic Dialog**: Re-opens the properties dialog for quick changes.\n\n## Settings Files\n- **Filename**: `Materials.xml`\n- **Location**: `_kPathHsbCompany\\Abbund\\`\n- **Purpose**: Provides the list of available timber material grades used for the **Material** property.\n\n## Tips\n- **Mid-Span vs. Ends**: When using Single Instance mode, click precisely on the beam end if you want the packer exactly at the end. The script detects if you are within 5mm of the end. Otherwise, it places the packer centered on your clicked point.\n- **Multiple Mode Flexibility**: After using Multiple Instance mode, the script converts the batch into individual Single Instances. This allows you to select and move specific packers later using grip points without affecting the others.\n- **Backer vs. Squash**: Remember that **Backer Blocks** cut a pocket into the main beam (machining), while **Squash Blocks** are simply placed against the beam without cutting it.\n\n## FAQ\n- **Q: What is the difference between a Backer Block and a Squash Block?**\n  - **A:** A *Backer Block* is a vertical stiffener placed between joist webs to prevent rotation (usually requires a pocket cut in the main beam). A *Squash Block* is a block placed under a joist bottom chord to transfer vertical loads to the main beam below (does not cut the main beam).\n- **Q: Why did my script disappear after selecting multiple beams?**\n  - **A:** This is normal behavior for \"Multiple Instance\" mode. The parent script spawns individual scripts for every beam you selected and then deletes itself to keep the model lightweight.\n- **Q: Can I change the size of the packer after inserting?**\n  - **A:** Yes. Select the packer beam (or the script instance grip), open the Properties palette, and modify the dimension parameters (e.g., `dPlateWidth`). The model will update automatically."
      },
      "tokens_used": 8473,
      "error": null
    }
  }
}