{
  "filename": "instaCombination.mcr",
  "status": "completed",
  "total_tokens": 51764,
  "processing_time": 356.6111936569214,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"3.8\",\n      \"date\": \"17.01.2024\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-20506 layer assignment on zone 0 = Z-Layer\"\n    },\n    {\n      \"version\": \"3.7\",\n      \"date\": \"06.09.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-16090 centered anchoring of combination supported, new property to toggle available anchor nodes\"\n    },\n    {\n      \"version\": \"3.6\",\n      \"date\": \"06.09.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-16089 new command to list full syntax of available commands in report dialog, formatting dialog added\"\n    },\n    {\n      \"version\": \"3.5\",\n      \"date\": \"03.08.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-16091 relevant face terminology unified\"\n    },\n    {\n      \"version\": \"3.4\",\n      \"date\": \"01.08"
      },
      "tokens_used": 9113,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Usage of _kModelSpace in tslDialog.dbCreate calls, implementation of _bOnJig for insertion, description 'Select a panel and an insertion point', absence of _Viewport or _kPaperSpace references, absence of sd_ or Multipage prefix."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "instaCombination"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": [
            "instaCell TSL",
            "instaConduit TSL",
            "Conduit Catalog",
            "hsbTSLDebugController (Optional)"
          ]
        }
      },
      "tokens_used": 7361,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10200,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts and manages complex electrical installation combinations (groups of sockets, switches, and conduits) into timber elements, controlling cutouts, 3D placement, and symbol representation.",
          "category": "Electrical/Installation",
          "typicalUseCase": "Placing a grouped set of electrical sockets or a combined light/switch unit in a wall panel during the design phase to ensure cutouts and symbols are correctly generated."
        },
        "parameters": [
          {
            "name": "nFace",
            "technicalDefault": "1",
            "businessMeaning": "Determines which side of the panel/element the installation is applied to (e.g., Left vs Right, Interior vs Exterior).",
            "validRange": "Integer (1 or 2)",
            "unit": "Index",
            "affectsOutput": "Flips the visual symbol color (Green/Cyan in preview) and determines the direction in which sub-components (cells) are oriented."
          },
          {
            "name": "dElevation",
            "technicalDefault": "0.0",
            "businessMeaning": "The vertical height of the combination relative to the insertion point or reference line.",
            "validRange": "0.0 to Wall Height",
            "unit": "mm",
            "affectsOutput": "Moves the entire combination group up or down along the element's Y-axis during placement."
          },
          {
            "name": "ConduitCatalog",
            "technicalDefault": "Empty String",
            "businessMeaning": "Specifies the predefined profile catalog to be used for generating conduits (pipes/channels) linking the installation to the element edge.",
            "validRange": "Valid Catalog Name in hsbCAD",
            "unit": "String",
            "affectsOutput": "Enables the generation of 3D conduit geometry and cutouts if the name matches an existing 'instaConduit' catalog."
          },
          {
            "name": "bIsCourseElevation",
            "technicalDefault": "0",
            "businessMeaning": "Specific to Log Wall construction. If active, the vertical position is determined by counting log courses rather than absolute millimeters.",
            "validRange": "0 (No), 1 (Yes)",
            "unit": "Boolean",
            "affectsOutput": "Changes the calculation of 'dElevation' to snap to the height of individual timber logs/courses."
          },
          {
            "name": "AnchorMode",
            "technicalDefault": "<|Default|>",
            "businessMeaning": "Controls how the combination snaps to the element during insertion. 'Cells' restricts to grid points, 'Combination' centers the group, 'Default' allows free movement.",
            "validRange": "<|Default|>, |Cells|, |Combination|",
            "unit": "Enum",
            "affectsOutput": "Modifies the available grip points and snapping behavior during the insertion jig."
          },
          {
            "name": "TextHeightElement / ScaleElement",
            "technicalDefault": "User/Settings Defined",
            "businessMeaning": "Visual properties controlling the size of the 2D symbol representation in Element Views.",
            "validRange": "Scale > 0, Text Height > 0",
            "unit": "Scale / mm",
            "affectsOutput": "Resizes the 2D CAD symbol and associated text dimensions without changing the physical cutout size."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Element Construction Type (Log Wall)",
            "effect": "Enables the 'Log Wall Settings' context menu and relevant parameters like 'bIsCourseElevation'.",
            "cascade": [
              "bIsCourseElevation"
            ]
          },
          {
            "trigger": "Selection of Conduit Catalog",
            "effect": "Activates the logic to generate 'instaConduit' instances linked to the combination.",
            "cascade": [
              "ConduitMode"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "instaCell",
            "description": "Sub-TSL instances representing individual units (e.g., a single socket or switch) contained within the combination.",
            "appliedTo": "The parent Element or GenBeam selected during insertion."
          },
          {
            "type": "instaConduit",
            "description": "Sub-TSL instances representing the routing channels or pipes for electrical wiring.",
            "appliedTo": "The parent Element, connecting the cells to the edge."
          },
          {
            "type": "Machining/Cutouts",
            "description": "Physical voids or cutouts generated by the sub-cells (instaCell) to accommodate the boxes.",
            "appliedTo": "Specific beams or panels within the element."
          },
          {
            "type": "2D Symbol",
            "description": "Plan view and elevation view representations of the electrical group.",
            "appliedTo": "Model Space / Drawing Sheets."
          }
        ]
      },
      "tokens_used": 9141,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Execution Started",
          "Insertion Phase: User selects 'Catalog Entry', 'Rule', or 'Default' via Dialog",
          "Insertion Phase: User selects Target Element (Panel/GenBeam) in Model Space",
          "Dynamic Jig Phase: User moves cursor to position combination",
          "Jig Validation: System checks if cursor is within Element Contour",
          "Jig Preview: System displays 2D Symbol, 3D Preview, and optional Conduit path",
          "User confirms placement (Click)",
          "Generation: Script creates 'instaCell' sub-instances for individual sockets/units",
          "Generation: Script creates 'instaConduit' sub-instances if catalog is specified",
          "Finish: Entity is added to drawing with properties exposed in OPM"
        ],
        "conditionalBranches": [
          {
            "condition": "Anchor Mode Property during Jig",
            "path1": {
              "name": "Cells Mode",
              "steps": [
                "Script calculates snap nodes based on cell dimensions",
                "Cursor snaps specifically to these grid nodes",
                "Ensures cells align perfectly with structural grid"
              ]
            },
            "path2": {
              "name": "Combination Mode",
              "steps": [
                "Script ignores individual cell nodes",
                "Cursor snaps to the center of the combination group",
                "Allows free placement relative to grid"
              ]
            }
          },
          {
            "condition": "Conduit Catalog Property",
            "path1": {
              "name": "Catalog Specified",
              "steps": [
                "Script reads profile dimensions from 'instaConduit' catalog",
                "Jig displays a preview line (Green) from combo to element edge",
                "On placement, a physical 'instaConduit' TSL is generated"
              ]
            },
            "path2": {
              "name": "Empty/Default",
              "steps": [
                "No conduit preview is shown during Jig",
                "No conduit TSL is generated",
                "Only the combination cells are created"
              ]
            }
          },
          {
            "condition": "Element Type (Log Wall Detection)",
            "path1": {
              "name": "Log Wall",
              "steps": [
                "Context Menu adds 'Log Wall Settings' option",
                "User can toggle 'IsCourseElevation'",
                "Vertical position snaps to log course heights instead of mm"
              ]
            },
            "path2": {
              "name": "Standard/Stick Frame",
              "steps": [
                "Log Wall Settings are hidden",
                "Vertical positioning uses absolute Elevation (mm)"
              ]
            }
          },
          {
            "condition": "Jig Validation (Cursor Position)",
            "path1": {
              "name": "Inside Contour",
              "steps": [
                "Preview symbol displays in Green (Face 1) or Cyan (Face 2)",
                "Placement is permitted"
              ]
            },
            "path2": {
              "name": "Outside Contour",
              "steps": [
                "Preview symbol displays Red/Orange 'X' error marker",
                "System indicates invalid placement geometry",
                "Placement is blocked or marked as error"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insertion Point inside Element Contour",
            "errorMessage": "Visual Red/Orange X marker appears at cursor location during Jig",
            "recovery": "Move cursor back inside the panel outline or select a valid panel."
          },
          {
            "check": "Conduit Catalog Existence",
            "errorMessage": "N/A (Silent fail or default dimensions if missing in provided snippet, typically implies catalog lookup error)",
            "recovery": "Ensure the selected 'ConduitCatalog' name exists in the hsbCAD catalogs."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Flip Face",
            "how": "Context Menu / Right-Click -> '|Flip Face|'",
            "effect": "Toggles the installation side (e.g., Interior vs Exterior), updating nFace property and symbol color."
          },
          {
            "action": "Save Configuration as Rule",
            "how": "Context Menu -> '|Save as rule|'",
            "effect": "Prompts for a name and saves the current set of properties (cells, offsets, catalogs) to the Catalog for reuse."
          },
          {
            "action": "Modify Visual Representation",
            "how": "Context Menu -> '|Plan view settings|' or '|Element view settings|'",
            "effect": "Opens dialog to change colors, scales, text heights, and symbol offsets for 2D drawings."
          },
          {
            "action": "Adjust Vertical Offset",
            "how": "Context Menu -> '|Specify vertical cell offset|'",
            "effect": "Applies a vertical shift to the cells within the combination (useful for long vertical stacks)."
          },
          {
            "action": "Toggle CNC Visibility",
            "how": "Context Menu -> '|Hide Tools|' / '|Show Tools|'",
            "effect": "Toggles the 'bShowTools' property to show or hide machining toolpaths in the model."
          },
          {
            "action": "Grip Edit",
            "how": "Select Combination -> Drag Grip Points",
            "effect": "Invokes the Jig logic (_bOnJig), allowing dynamic repositioning along the element with live validation and snapping."
          }
        ]
      },
      "tokens_used": 9957,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# instaCombination.mcr\n\n## Overview\nThis script inserts and manages complex electrical installation combinations (groups of sockets, switches, and conduits) into timber elements. It handles the automatic generation of cutouts, 3D placement of components, and symbol representation for electrical planning.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for 3D placement and machining |\n| Paper Space | No | Not supported |\n| Shop Drawing | No | Not supported |\n\n## Prerequisites\n- **Required Entities**: An Element (Panel/GenBeam) must exist in the model.\n- **Minimum Beam Count**: 0 (Works on single panels or assemblies).\n- **Required Settings**:\n    - `instaCell TSL` (Sub-script for individual units)\n    - `instaConduit TSL` (Sub-script for wiring channels)\n    - Conduit Catalog (Profile definitions for pipes/channels)\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Select `instaCombination.mcr` from the file dialog.\n\n### Step 2: Select Configuration\n```\nCommand Line: Select Catalog Entry, Rule, or Default.\nAction: A dialog appears. Select the predefined electrical group (e.g., \"Switch Group A\") or \"Default\" to start manually.\n```\n\n### Step 3: Select Target Element\n```\nCommand Line: Select element:\nAction: Click on the timber wall panel or beam where you want to install the electrical combination.\n```\n\n### Step 4: Position Combination\n```\nCommand Line: Specify insertion point:\nAction: Move your cursor over the element.\n- A Green/Cyan symbol indicates a valid position (Face 1 or Face 2).\n- A Red/Orange 'X' indicates the cursor is outside the element boundary.\n- Click to place the combination.\n```\n*Note: You can change the Anchor Mode on the command line or properties to snap to specific grid points (`Cells`) or the center of the group (`Combination`).*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **nFace** | Integer | 1 | Determines which side of the panel the installation is applied to (e.g., Interior vs. Exterior). |\n| **dElevation** | Double | 0.0 | The vertical height (mm) of the combination relative to the insertion reference. |\n| **ConduitCatalog** | String | Empty | The name of the profile catalog used to generate conduits (pipes/channels). If empty, no conduits are created. |\n| **bIsCourseElevation** | Boolean | 0 | **Log Wall Only**: If set to 1, vertical positioning snaps to the height of log courses instead of absolute millimeters. |\n| **AnchorMode** | Enum | \\|Default\\| | Controls snapping behavior during insertion. Options: `<|Default|>`, `|Cells|` (Snap to grid), or `|Combination|` (Snap to group center). |\n| **ScaleElement** | Double | User Defined | Scales the size of the 2D symbol in Element Views without changing the physical cutout size. |\n| **TextHeightElement** | Double | User Defined | Sets the text height for labels in Element Views. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **\\|Flip Face\\|** | Toggles the installation side (e.g., from Interior to Exterior). Updates the `nFace` property and symbol color. |\n| **\\|Save as rule\\|** | Saves the current configuration (cell types, offsets, catalogs) as a new entry in the Catalog for future use. |\n| **\\|Plan view settings\\|** | Opens a dialog to adjust colors, line types, and scales for the 2D symbol in Plan views. |\n| **\\|Element view settings\\|** | Opens a dialog to adjust visual representation settings for Elevations/Sections. |\n| **\\|Specify vertical cell offset\\|** | Applies a vertical shift to the cells within the combination (useful for aligning vertical stacks). |\n| **\\|Hide Tools\\| / \\|Show Tools\\|** | Toggles the visibility of CNC toolpaths/machining in the model view. |\n| **\\|Log Wall Settings\\|** | *Only visible for Log Walls*. Opens options specific to log construction, such as course snapping. |\n\n## Settings Files\n- **Filename**: `instaConduit` (Catalog Name defined in properties)\n- **Location**: `...\\hsbCompany\\Tsl\\Catalogs` (or hsbCAD install path)\n- **Purpose**: Defines the geometric profiles (width, height) for the conduits/pipes connecting the electrical units to the edge of the element.\n\n## Tips\n- **Snapping**: Use the `|Cells|` Anchor Mode when installing sockets in a regular grid (e.g., standard stud spacing). Use `|Combination|` mode if you want to freely center a group of switches.\n- **Visual Feedback**: If you see a Red 'X' while moving the cursor, check if you are clicking on the correct face (Front/Back) of the wall or if you are outside the panel's geometry.\n- **Conduits**: To see the pipe routing, ensure the `ConduitCatalog` property matches an existing catalog name in your database.\n\n## FAQ\n- **Q: Why can't I place the combination on my wall?**\n  A: Ensure your cursor is inside the contour of the element. If the preview shows a Red 'X', you are trying to place it in an empty space or outside the panel bounds.\n- **Q: How do I switch the installation to the other side of the wall?**\n  A: Select the placed combination, right-click, and choose `|Flip Face|`. The symbol color will change (Green to Cyan or vice versa).\n- **Q: Can I save my current setup for another project?**\n  A: Yes. Right-click the combination and select `|Save as rule|`. Give it a name, and it will be available in the insertion dialog next time you run the script."
      },
      "tokens_used": 5992,
      "error": null
    }
  }
}