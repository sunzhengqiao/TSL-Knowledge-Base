{
  "filename": "hsbInsulationHatch.mcr",
  "status": "completed",
  "total_tokens": 34701,
  "processing_time": 231.10316348075867,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.3",
            "date": "30.11.2009",
            "author": "th@hsbCAD.de",
            "changes": "new property 'Linetype'. NOTE: certain linetypes can slow down the calculation time new property 'side' extents toggle of side to properties. the user can use both, either the property or the context command to toggle the side"
          },
          {
            "version": "1.2",
            "date": "30.11.2009",
            "author": "th@hsbCAD.de",
            "changes": "new context command 'flip side' toggles the side of the insulation"
          },
          {
            "version": "",
            "date": "26.03.07",
            "author": "th@hsbCAD.de",
            "changes": "minor enhancements"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6213,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses interactive input methods (getPoint, getEntPLine) within _bOnInsert, which is characteristic of ModelSpace detailing scripts. There is no viewport detection (_Viewport.length()) or sd_ prefix. The script relies on Display class for output and handles graphic trimming manually."
        },
        "prerequisites": {
          "requiredEntities": [
            "EntPline"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5068,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select base point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrPoint (getPoint)",
              "promptOriginal": "Next point (Defines Direction)",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 4,
              "function": "getEntPLine",
              "promptOriginal": "Select the bounding polyline",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Script Insert",
            "title": null,
            "dataSource": "Properties (Width, Side, Linetype, Color)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "Width of Insulation",
            "defaultValue": "100",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Sets the width of the insulation. If the insulation intersects the bounding polyline it will be trimmed to the contour"
          },
          {
            "index": 1,
            "variable": "sSide",
            "type": "PropString",
            "displayName": "Side",
            "defaultValue": "Right",
            "inputType": "dropdown",
            "options": [
              "Left",
              "Right"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sLinetype",
            "type": "PropString",
            "displayName": "Linetypes",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": "_LineTypes",
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 134,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Flip Side",
            "handler": "sTrigger[0] (String: Flip Side)",
            "action": "Toggles the side of the insulation relative to the grip points. Updates the 'Side' property value between Left and Right.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 4775,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 2D graphical representation of insulation hatching (zig-zag pattern) in cross-sections or elevations, trimmed to a specific boundary contour.",
          "category": "Detailing/Annotation",
          "typicalUseCase": "Showing the location and thickness of insulation wool or batts in wall cross-sections or roof details."
        },
        "parameters": [
          {
            "name": "dWidth",
            "technicalDefault": "100",
            "businessMeaning": "The physical thickness (depth) of the insulation material being represented.",
            "validRange": "50 to 300 (Standard industry widths usually include 50, 75, 100, 140, 150, 200, 240)",
            "unit": "mm",
            "affectsOutput": "Controls the spacing and amplitude of the zig-zag hatch pattern and the total width of the insulation strip drawn."
          },
          {
            "name": "sSide",
            "technicalDefault": "Right",
            "businessMeaning": "Determines which side of the reference line (defined by the two grip points) the insulation is drawn on.",
            "validRange": "Left, Right",
            "unit": "Enum",
            "affectsOutput": "Flips the insulation vector 180 degrees relative to the insertion path."
          },
          {
            "name": "sLinetype",
            "technicalDefault": "System Dependent",
            "businessMeaning": "The visual line style used to draw the insulation hatch edges (e.g., Continuous, Hidden).",
            "validRange": "Any loaded AutoCAD linetype",
            "unit": "String",
            "affectsOutput": "Changes the visual appearance (dash/dot pattern) of the drawn lines."
          },
          {
            "name": "nColor",
            "technicalDefault": "134",
            "businessMeaning": "The display color of the insulation hatch in the CAD model.",
            "validRange": "0 to 255 (AutoCAD Color Index)",
            "unit": "ACI",
            "affectsOutput": "Changes the color of the generated graphical entities."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User executes 'Flip Side' command",
            "effect": "The value of 'sSide' property is inverted (Left becomes Right, Right becomes Left).",
            "cascade": [
              "sSide"
            ]
          },
          {
            "trigger": "Change in 'dWidth'",
            "effect": "Re-scales the insulation pattern geometry.",
            "cascade": [
              "Geometry"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "2D Geometry / Graphics",
            "description": "A zig-zag polyline pattern representing the insulation, trimmed to fit inside the selected bounding polyline.",
            "appliedTo": "Model Space (Visual representation only)"
          }
        ]
      },
      "tokens_used": 5690,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Execution Started",
          "Check Insertion State (_bOnInsert)",
          "[Insert Mode] Verify Cycle Count (prevent duplicate inserts)",
          "[Insert Mode] Show Dynamic Dialog (configure properties)",
          "[Insert Mode] Prompt for Base Point (getPoint)",
          "[Insert Mode] Prompt for Next Point to define Direction (PrPoint)",
          "[Insert Mode] Validate Second Point Selection",
          "[Insert Mode] Prompt for Bounding Polyline (getEntPLine)",
          "[Insert Mode] Store Polyline Entity and Terminate",
          "[Calculation Mode] Determine Side Direction based on Property 'Side'",
          "[Calculation Mode] Check for Context Command 'Flip Side' Trigger",
          "[Calculation Mode] Retrieve and Validate Bounding Polyline from _Entity",
          "[Calculation Mode] Establish Coordinate System (Origin, Vx, Vy, Vz)",
          "[Calculation Mode] Create PlaneProfile from Bounding Polyline for Clipping",
          "[Calculation Mode] Calculate Height of Insulation Zone based on Polyline Extent",
          "[Calculation Mode] Generate Insulation Pattern Geometry (Zig-Zag Points)",
          "[Calculation Mode] Initialize Display Settings (Color, Linetype)",
          "[Calculation Mode] Enter Generation Loop (Repeat pattern along Vy axis)",
          "[Calculation Mode] [Loop] Check if Pattern Start Point is beyond Insulation Height",
          "[Calculation Mode] [Loop] Process Pattern Segments (Triangulation check)",
          "[Calculation Mode] [Loop] Segment Processing: Check if Vertices are inside Clipping Profile",
          "[Calculation Mode] [Loop] Segment Processing: If Inside, Draw Segment",
          "[Calculation Mode] [Loop] Segment Processing: If Straddling Boundary, Calculate Intersections and Trim",
          "[Calculation Mode] [Loop] Increment Pattern Origin to Next Cycle",
          "[Calculation Mode] [Loop Exit] Script Execution Complete"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "First Insertion Cycle",
              "steps": [
                "Proceed with Insertion Workflow"
              ]
            },
            "path2": {
              "name": "Duplicate Cycle Detected (insertCycleCount > 1)",
              "steps": [
                "Erase Instance",
                "Return/Exit Script"
              ]
            }
          },
          {
            "condition": "Second Point Selection (Direction)",
            "path1": {
              "name": "Point Selected Successfully",
              "steps": [
                "Store Point in _PtG",
                "Continue to Polyline Selection"
              ]
            },
            "path2": {
              "name": "Selection Failed / Escaped",
              "steps": [
                "Check _PtG Length",
                "If < 1, Erase Instance and Return"
              ]
            }
          },
          {
            "condition": "Context Command Triggered ('Flip Side') on Recalc",
            "path1": {
              "name": "Flip Side Command Executed",
              "steps": [
                "Invert nSide multiplier (-1 to 1 or 1 to -1)",
                "Update sSide Property String ('Left' to 'Right' or vice versa)"
              ]
            },
            "path2": {
              "name": "Standard Recalc / No Command",
              "steps": [
                "Keep existing nSide and sSide values"
              ]
            }
          },
          {
            "condition": "Pattern Segment Location vs Clipping Profile",
            "path1": {
              "name": "Segment Completely Outside",
              "steps": [
                "Set bOk = FALSE",
                "Skip Drawing"
              ]
            },
            "path2": {
              "name": "Segment Completely Inside",
              "steps": [
                "Draw Segment Directly",
                "Set bOk = TRUE"
              ]
            },
            "path3": {
              "name": "Segment Straddling Boundary (Intersects)",
              "steps": [
                "Convert to Linear Approximation",
                "Find Intersection Points with Bounding Polyline",
                "Draw Line only between valid points (Inside to Intersection or Intersection to Inside)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Bounding Polyline Existence",
            "errorMessage": "Implicit (Script exits/fails gracefully if no entity)",
            "recovery": "User must select a valid Polyline during insertion."
          },
          {
            "check": "Point Definition (Base and Direction)",
            "errorMessage": "Implicit (Instance erased if direction point is missing)",
            "recovery": "User must provide both base point and direction point during insertion."
          },
          {
            "check": "Polyline Closure/Validity",
            "errorMessage": "Implicit (Calculations based on PlaneProfile)",
            "recovery": "Ensure the selected polyline forms a closed region for proper clipping."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Insulation Width",
            "how": "OPM (Object Properties Manager) - Change 'Width of Insulation'",
            "effect": "Re-calculates the scale of the zig-zag pattern and the total thickness. Re-trims to the bounding polyline."
          },
          {
            "action": "Toggle Side",
            "how": "Context Menu (Right-Click 'Flip Side') OR OPM (Change 'Side' Property)",
            "effect": "Flips the insulation 180 degrees relative to the start point direction vector. Updates property to reflect new state."
          },
          {
            "action": "Change Appearance",
            "how": "OPM - Change 'Color' or 'Linetypes'",
            "effect": "Updates the color and line style of the drawn hatch geometry immediately."
          },
          {
            "action": "Adjust Location/Length",
            "how": "Grip Edit (Move Start Point or End Point)",
            "effect": "Updates the vector direction and start position. Re-calculates clipping against the bounding polyline."
          },
          {
            "action": "Modify Boundary",
            "how": "Modify the selected Bounding Polyline geometry in CAD",
            "effect": "Script detects dependency change, recalculates clipping, and trims insulation to new shape."
          }
        ]
      },
      "tokens_used": 6974,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbInsulationHatch.mcr\n\n## Overview\nGenerates a 2D graphical representation of insulation hatching (zig-zag pattern) in Model Space. The insulation is automatically trimmed to fit inside a selected bounding polyline (e.g., a wall or roof cross-section).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script is designed for detailing 3D models or sections in Model Space. |\n| Paper Space | No | Not supported for layout viewports. |\n| Shop Drawing | No | Not intended for manufacturing outputs. |\n\n## Prerequisites\n- **Required Entities**: A closed **Polyline** (existing in the drawing) that will act as the boundary/mask for the insulation.\n- **Minimum Beam Count**: 0 (This script works independently of structural beams).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or your company's custom script insert command) â†’ Select `hsbInsulationHatch.mcr`.\n\n### Step 2: Configure Properties (Dialog)\nA dialog will appear automatically upon insertion.\n- **Action**: Set the desired **Width**, **Side**, **Linetype**, and **Color**.\n- **Action**: Click **OK** to confirm.\n\n### Step 3: Set Base Point\n```\nCommand Line: Select base point\nAction: Click in the drawing to set the starting corner of the insulation area.\n```\n\n### Step 4: Set Direction\n```\nCommand Line: Next point (Defines Direction)\nAction: Click a second point to define the length and angle of the insulation strip.\n```\n\n### Step 5: Select Boundary\n```\nCommand Line: Select the bounding polyline\nAction: Click on the closed polyline (e.g., the wall outline) that defines the area where the insulation should be visible. The hatch will be clipped to this shape.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Width of Insulation | Number | 100 | Sets the physical thickness/width of the insulation strip. If the insulation extends beyond the bounding polyline, it is trimmed. |\n| Side | Dropdown | Right | Determines which side of the direction line (defined by the two grip points) the insulation is drawn on. Options: Left, Right. |\n| Linetypes | Dropdown | *System Default* | Sets the visual line style for the hatch edges (e.g., Continuous, Hidden). |\n| Color | Number | 134 | Sets the AutoCAD color index (ACI) for the insulation pattern. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip Side | Toggles the insulation to the opposite side of the grip line (switches between Left and Right). This also updates the 'Side' property automatically. |\n\n## Settings Files\n- None used by this script.\n\n## Tips\n- **Grip Editing**: You can select the insulation and drag the blue grip points to adjust the start position, length, or direction. The hatch will automatically recalculate.\n- **Dynamic Updates**: If you modify the geometry of the selected bounding polyline, the insulation hatch will automatically update to match the new shape.\n- **Performance**: Using complex custom linetypes for the insulation pattern may slow down calculation time. For large projects, stick to standard linetypes like \"Continuous\".\n\n## FAQ\n- **Q: Why is my insulation not showing up?**\n  **A**: Ensure that the area defined by your width and direction points actually intersects with the bounding polyline you selected. If the insulation area is completely outside the polyline, it will be clipped entirely.\n- **Q: How do I make the insulation thicker?**\n  **A**: Select the insulation, open the **Properties** palette (Ctrl+1), and increase the value for \"Width of Insulation\".\n- **Q: Can I change the side after inserting?**\n  **A**: Yes. You can either right-click the insulation and select \"Flip Side\", or change the \"Side\" property in the Properties palette."
      },
      "tokens_used": 5981,
      "error": null
    }
  }
}