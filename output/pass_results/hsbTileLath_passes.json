{
  "filename": "hsbTileLath.mcr",
  "status": "completed",
  "total_tokens": 53040,
  "processing_time": 240.29858231544495,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": null,\n  \"versionHistory\": [\n    {\n      \"version\": \"1.7\",\n      \"date\": \"05apr19\",\n      \"author\": \"nils.gregor@hsbcad.com\",\n      \"changes\": \"The positioning height of the edge laths is now taken from the hsbTileHipRidge instance\"\n    },\n    {\n      \"version\": \"1.6\",\n      \"date\": \"13aug2018\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"RS-125, no ridge battens for shed roofs\"\n    },\n    {\n      \"version\": \"1.5\",\n      \"date\": \"03aug2018\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"RS-125, creating hip and ridge battens\"\n    },\n    {\n      \"version\": \"1.4\",\n      \"date\": \"20jul2018\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"RS-141\"\n    },\n    {\n      \"version\": \"1.3\",\n      \"date\": \"11jul2018\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"RS-123, RS-119\"\n    },\n    {\n      \"version\": \"1.2\",\n      \"date\": \"06jul2018\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"RS-121, RS-120, RS-119, RS-122\"\n    },\n    {\n      \"version\": \"1.1\",\n      \"date\": \"22may2018\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"reporting if lath definition is missing\"\n    },\n    {\n      \"version\": \"1.0\",\n      \"date\": \"18jan2018\",\n      \"author\": \"th"
      },
      "tokens_used": 9459,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses `dbCreate(..., _kModelSpace, ...)` to generate new TSL instances. It collects beams using `Group().collectEntities(..., _kModelSpace)`. It creates 3D `Beam` objects with `bm.dbCreate(...)`. There are no references to Paper Space, Viewports, or Shop Drawing entities (Sheet/Elayout)."
        },
        "prerequisites": {
          "requiredEntities": [
            "ERoofPlane"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Roofplane containing 'Hsb_TileExportData' submap (includes VerticalDistribution points and ppRoof)",
            "Roofplane containing 'Hsb_RoofEdgeTileData' submap",
            "Valid Extrusion Profiles in the catalog",
            "hsbTileHipRidge instance attached to roofplane (optional but used for elevation)"
          ]
        }
      },
      "tokens_used": 7565,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select roofplane(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select lath(s)|<Enter> = all",
              "condition": "_bOnInsert && (bErase || bSplit)",
              "required": false
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "|Select point|",
              "condition": "_bOnInsert && bSplit",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "PropertyDialog",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sMaterial",
            "type": "PropString",
            "displayName": "|Material|",
            "defaultValue": "C24",
            "inputType": "text",
            "options": [],
            "category": "|General|",
            "description": "|Defines the Material|"
          },
          {
            "index": 1,
            "variable": "dVergeOffset",
            "type": "PropDouble",
            "displayName": "|X-Offset|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Verge|",
            "description": "|Defines the Verge Offset|"
          },
          {
            "index": 2,
            "variable": "sProfile",
            "type": "PropString",
            "displayName": "|Extrusion Profile| |Override|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Derived from ExtrusionProfile catalog (excluding 'Round')"
            ],
            "category": "|Eave|",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "ERASELATH",
            "handler": "ERASELATH",
            "action": "Erases existing laths associated with selected roofplanes",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "SPLITLATH",
            "handler": "SPLITLATH",
            "action": "Prompts for points to split existing laths",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Catalog Entries",
            "handler": "Catalog Name",
            "action": "Sets properties based on selected catalog entry",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8000,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates and manages tile lath battens (roofing battens) on roof planes, calculating positions for standard, eave, hip, and ridge laths based on tile manufacturer data.",
          "category": "Framing",
          "typicalUseCase": "Used during the structural design phase to automatically layout the wooden battens required to support roof tiles or slates, ensuring they align correctly with roof edges, openings, and tile geometry."
        },
        "parameters": [
          {
            "name": "sMaterial",
            "technicalDefault": "C24",
            "businessMeaning": "Defines the timber strength class or material grade to be used for the battens.",
            "validRange": "Standard timber grades (e.g., C14, C16, C18, C24, C30, GL24h)",
            "unit": "String (Catalog Code)",
            "affectsOutput": "Sets the material property on the generated Beam entities, influencing structural analysis data and Bill of Materials."
          },
          {
            "name": "dVergeOffset",
            "technicalDefault": "0",
            "businessMeaning": "Adjusts the horizontal start position of the lathing grid relative to the verge (gable end) of the roof.",
            "validRange": "-500.0 to 500.0 mm (Typical use: 0 to 100mm)",
            "unit": "mm",
            "affectsOutput": "Shifts the array of standard laths along the roof X-axis. Used to control tile overhang at the gable wall or to align with specific tile courses."
          },
          {
            "name": "sProfile",
            "technicalDefault": "null (Derived from catalog)",
            "businessMeaning": "Selects a specific cross-sectional profile from the Extrusion catalog to be used specifically for the first (eave) row of laths.",
            "validRange": "Available Extrusion Profile names (excluding 'Round')",
            "unit": "String (Catalog Name)",
            "affectsOutput": "Overrides the default rectangular cross-section of the eave lath with the selected complex profile geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "hsbTileHipRidge instance attached to the ERoofPlane",
            "effect": "If present, the script reads the positioning height from this instance to determine the correct Z-elevation for hip and ridge laths.",
            "cascade": [
              "Hip Lath Elevation",
              "Ridge Lath Elevation"
            ]
          },
          {
            "trigger": "Roofplane SubMaps ('Hsb_TileExportData', 'Hsb_RoofEdgeTileData')",
            "effect": "These maps contain the tile geometry, spacing, and vertical distribution points required to calculate the layout, width, and height of the laths.",
            "cascade": [
              "Lath Spacing",
              "Lath Width",
              "Lath Height",
              "Eave Offset"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam (Standard Lath)",
            "description": "Rectangular battens laid across the roof slope to support tiles.",
            "appliedTo": "Interior of the roof plane (defined by VerticalDistribution points)."
          },
          {
            "type": "Beam (Eave Lath)",
            "description": "The first row of battens at the bottom of the roof. May use a specific Extrusion Profile.",
            "appliedTo": "Roof eave edge."
          },
          {
            "type": "Beam (Ridge Lath)",
            "description": "Battens located at the ridge peak. Not created for shed roofs.",
            "appliedTo": "Roof ridge edge."
          },
          {
            "type": "Beam (Hip Lath)",
            "description": "Battens located along hip intersections.",
            "appliedTo": "Roof hip edges."
          }
        ]
      },
      "tokens_used": 8637,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User executes script (hsbTileLath)",
          "2. Script checks _kExecuteKey for specific modes (ERASELATH, SPLITLATH, or Catalog Entry)",
          "3. [Condition: If no specific key] Show Property Dialog (Material, Offset, Profile)",
          "4. Prompt user to select ERoofPlane(s)",
          "5. [Condition: If Erase or Split mode] Prompt user to select existing Beam(s) (Laths) or <Enter> for All",
          "6. [Condition: If Split mode] Loop: Prompt user to select Point(s) to split selected laths",
          "7. Script creates a temporary TSL instance attached to the selected Roofplane(s) via dbCreate",
          "8. User's initiating script instance erases itself",
          "9. Attached TSL instance executes calculation logic (OnInsert=false)",
          "10. Attached TSL validates Roofplane for 'Hsb_TileExportData' and 'Hsb_RoofEdgeTileData'",
          "11. Attached TSL retrieves attached 'hsbTileHipRidge' instance (if any) for elevations",
          "12. Attached TSL calculates geometry for Standard, Eave, Hip, and Ridge laths",
          "13. Attached TSL generates Beam entities in ModelSpace",
          "14. Attached TSL erases itself, leaving only the generated Beams"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Key (_kExecuteKey) contains 'ERASELATH'",
            "path1": {
              "name": "Erase Mode",
              "steps": [
                "Prompt for Roofplane(s)",
                "Prompt for Lath(s) (optional)",
                "Filter selected laths by subLabel2 (must match Roofplane handle)",
                "dbErase matching laths",
                "Create temporary TSL on Roofplane to refresh/recalculate (if needed by design, though usually just erases)",
                "Exit"
              ]
            }
          },
          {
            "condition": "Execution Key (_kExecuteKey) contains 'SPLITLATH'",
            "path1": {
              "name": "Split Mode",
              "steps": [
                "Prompt for Roofplane(s)",
                "Prompt for Lath(s) (optional)",
                "Loop: Prompt for Split Point",
                "Calculate intersection of Split Point with Lath local coordinates",
                "Execute dbSplit on Laths",
                "Exit"
              ]
            }
          },
          {
            "condition": "Checking Ridge Definition availability",
            "path1": {
              "name": "Found Locally",
              "steps": [
                "Retrieve RidgeDefinition from current Roofplane submap",
                "Continue generation"
              ]
            },
            "path2": {
              "name": "Missing Local Definition",
              "steps": [
                "Iterate partner roofplanes via edgeTileTopology",
                "Scan partners for valid RidgeDefinition",
                "Use first valid definition found",
                "If none found, skip Ridge Lath generation"
              ]
            }
          },
          {
            "condition": "Lath Generation Type (Eave vs Standard)",
            "path1": {
              "name": "Eave Lath",
              "steps": [
                "Check if 'sProfile' property is set",
                "If Yes: Set Beam Extrusion Profile and transform origin to match profile dimensions",
                "If No: Use rectangular geometry (Width/Height from Tile Data)",
                "Subtract Eave area from Standard Lath grid (ppTileRoof.joinRing subtract)"
              ]
            },
            "path2": {
              "name": "Standard Lath",
              "steps": [
                "Calculate length based on intersection with Roof Plane Profile",
                "Use rectangular geometry (Width/Height from Tile Data)",
                "Create Beam"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Roofplane SubMaps",
            "errorMessage": "hsbTileLath: invalid selection set.",
            "recovery": "User must select a valid ERoofPlane that contains 'Hsb_TileExportData'. This data is usually generated by a Roof Tile configuration script."
          },
          {
            "check": "Lath Dimensions",
            "errorMessage": "(Implicit) No laths created if dimensions are zero.",
            "recovery": "Verify Tile definitions (Width/Height/Offset) in the roof configuration are valid (non-zero)."
          },
          {
            "check": "Split Point Validity",
            "errorMessage": "None (Silent ignore)",
            "recovery": "If split point is projected outside the lath length, the specific lath is skipped for that split operation."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Generated Laths",
            "how": "Standard AutoCAD/hsbCAD grips and properties",
            "effect": "Direct modification of beam geometry. Note: Re-running the script on the same roofplane will overwrite these changes unless the old laths are manually erased or the script is run in 'Erase' mode first."
          },
          {
            "action": "Update Configuration",
            "how": "Re-run script via Catalog Entry or Command",
            "effect": "Since the script erases itself after running, re-running it effectively starts fresh. It will typically try to create new laths. Users should use the 'ERASELATH' context menu option or manually delete beams before re-running to avoid duplicates, or rely on the script's logic to handle existing entities if it supports 'replace' behavior (though this script specifically has an ERASELATH mode, implying manual cleanup or specific mode usage is required for updates)."
          },
          {
            "action": "Split Laths",
            "how": "Right-click Context Menu -> SPLITLATH",
            "effect": "Enters Split mode allowing the user to cut existing laths at specific points."
          }
        ]
      },
      "tokens_used": 11201,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbTileLath.mcr\n\n## Overview\nGenerates and manages tile lath battens (roofing battens) on roof planes. It automatically calculates and positions standard, eave, hip, and ridge laths based on tile manufacturer data stored on the roof plane.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model to generate structural battens. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities:** `ERoofPlane`.\n- **Required Data:** The selected Roofplane must contain the `Hsb_TileExportData` and `Hsb_RoofEdgeTileData` submaps. These are typically generated by a Roof Tile configuration script.\n- **Catalog:** Valid Extrusion Profiles must exist in the catalog.\n- **Optional:** An `hsbTileHipRidge` instance attached to the roofplane is recommended to determine correct elevations for hip and ridge laths.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbTileLath.mcr`\n*(Alternatively, select the script from your hsbCAD Catalog).*\n\n### Step 2: Configure Properties\n```\nDialog: Properties Palette (OPM)\nAction: Adjust the following parameters before selecting the roof:\n- Material: Set the timber grade (e.g., C24).\n- X-Offset: Set the verge offset (default 0).\n- Extrusion Profile Override: Optionally select a specific profile for the eave lath.\n```\n\n### Step 3: Select Roofplane\n```\nCommand Line: Select roofplane(s)\nAction: Click on the Roofplane entity(s) in the model where you want to generate laths.\n```\n*The script will then calculate the geometry, generate the laths, and automatically erase the script instance, leaving only the beams.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Material | String | C24 | Defines the timber grade for the battens. |\n| X-Offset | Number | 0 | Adjusts the horizontal start position of the lathing grid relative to the verge (gable end). Use this to control tile overhang or alignment. |\n| Extrusion Profile Override | Dropdown | Derived | Selects a specific cross-sectional profile from the Extrusion catalog for the first (eave) row of laths. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| ERASELATH | Erases existing laths associated with the selected roofplanes. Prompts for specific laths or uses `<Enter>` to select all. |\n| SPLITLATH | Splits existing laths at specific points. Prompts for laths and then points to split them. |\n| Catalog Entries | Allows loading property presets from the catalog. |\n\n## Settings Files\n- **Configuration Source:** Roofplane Entity\n- **Purpose:** This script does not use a separate settings file. It reads configuration directly from the selected Roofplane's submaps (`Hsb_TileExportData` and `Hsb_RoofEdgeTileData`). Ensure these are populated by your preliminary roof design tools.\n\n## Tips\n- **Avoiding Duplicates:** If you run the script multiple times on the same roof, it may create duplicate laths. Use the **ERASELATH** function or manually delete existing laths before re-running the generation script.\n- **Shed Roofs:** The script automatically detects shed roofs and will not create ridge battens (as per version 1.6 logic).\n- **Verge Alignment:** Use the **X-Offset** property to fine-tune the position of the first full batten rather than moving individual beams manually.\n- **Hip Heights:** If your hip/ridge laths are at the wrong height, ensure an `hsbTileHipRidge` instance is attached to the roofplane to provide the correct elevation data.\n\n## FAQ\n- **Q: I get the error \"hsbTileLath: invalid selection set.\" What is wrong?**\n  A: The Roofplane you selected is missing the necessary data. Ensure the Roofplane has been processed by a tile configuration tool to generate the `Hsb_TileExportData`.\n\n- **Q: The laths are not aligning with my tiles.**\n  A: Check the **X-Offset** in the properties. Also, verify that the `VerticalDistribution` points in the roofplane data match your tile dimensions.\n\n- **Q: Why is there no ridge batten on my roof?**\n  A: The roof is likely identified as a \"Shed Roof\" (single slope). The script suppresses ridge battens for this roof type (RS-125).\n\n- **Q: Can I change the profile of just the bottom row (eave)?**\n  A: Yes. Use the **Extrusion Profile Override** property to select a specific profile (e.g., a ventilation batten) for the eave row. The rest will use the standard rectangular profile defined in the tile data."
      },
      "tokens_used": 8178,
      "error": null
    }
  }
}