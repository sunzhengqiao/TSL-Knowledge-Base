{
  "filename": "HSB_G-BillOfMaterial.mcr",
  "status": "completed",
  "total_tokens": 55469,
  "processing_time": 779.621604681015,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9675,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Comment 'The tsl has to be added to a viewport.' and History 2.06 note 'Draw scriptname if viewport doesn't contain hsbCAD data' indicate operation within a Paper Space viewport. The filename 'HSB_G-BillOfMaterial.mcr' uses the 'G-' prefix (General), not 'sd-' (ShopDrawing). The script generates 2D tables (lines and text) which is characteristic of Paper Space annotation scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Sheeting",
            "Tsl"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Viewport",
          "requiredSettings": [
            "Group names (populated dynamically from Group().allExistingGroups())"
          ]
        }
      },
      "tokens_used": 8483,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10416,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a configurable Bill of Materials (BOM) table in Paper Space viewports, listing structural entities like beams and sheeting with user-defined properties, dimensions, and quantities.",
          "category": "Annotation",
          "typicalUseCase": "Creating material lists, production summaries, or inventory tables on drawing layouts to quantify timber parts, sheathing, and components visible in a specific viewport."
        },
        "parameters": [
          {
            "name": "sInExcludeFilters",
            "technicalDefault": "|Include|",
            "businessMeaning": "Determines if filter criteria select items to keep (Include) or remove (Exclude) from the list.",
            "validRange": "Include, Exclude",
            "unit": "enum",
            "affectsOutput": "Inverts the logic of the material filtering, drastically changing the content of the table."
          },
          {
            "name": "sFilterBC",
            "technicalDefault": "",
            "businessMeaning": "Filters structural members based on their BeamCode (e.g., 'WAL', 'FLR', 'RFT'). Supports wildcards.",
            "validRange": "String text",
            "unit": "text",
            "affectsOutput": "Restricts the table to only show beams matching specific function codes."
          },
          {
            "name": "sFilterLabel",
            "technicalDefault": "",
            "businessMeaning": "Filters entities based on a specific user-assigned label property.",
            "validRange": "String text",
            "unit": "text",
            "affectsOutput": "Limits content to entities carrying a specific label tag."
          },
          {
            "name": "sFilterMaterial",
            "technicalDefault": "",
            "businessMeaning": "Filters entities by their material grade (e.g., 'C24', 'GL24h').",
            "validRange": "String text",
            "unit": "text",
            "affectsOutput": "Segregates the list to show only items of a specific wood grade or material type."
          },
          {
            "name": "sFilterName",
            "technicalDefault": "",
            "businessMeaning": "Filters entities based on their entity name property.",
            "validRange": "String text",
            "unit": "text",
            "affectsOutput": "Excludes entities whose names do not match the filter string."
          },
          {
            "name": "sUseGroupSelection",
            "technicalDefault": "|No|",
            "businessMeaning": "Toggles the data source between the entire viewport content or a specific predefined Group of elements.",
            "validRange": "Yes, No",
            "unit": "enum",
            "affectsOutput": "Switches the BOM scope from a general view of the model to a specific assembly or sub-assembly."
          },
          {
            "name": "sGroupName",
            "technicalDefault": "",
            "businessMeaning": "Specifies the hsbCAD Group to analyze when 'Use group selection box' is active.",
            "validRange": "Existing Group names",
            "unit": "text",
            "affectsOutput": "Defines the exact set of elements included in the BOM when Group mode is enabled."
          },
          {
            "name": "sShowBeams",
            "technicalDefault": "|Show|",
            "businessMeaning": "Visibility toggle for timber beams/columns in the list.",
            "validRange": "Show, Hide",
            "unit": "enum",
            "affectsOutput": "Removes or adds structural timber rows to the table."
          },
          {
            "name": "sShowZn1 through sShowZn9",
            "technicalDefault": "|Show|",
            "businessMeaning": "Visibility toggles for sheathing or cladding elements assigned to specific logical zones (1-9).",
            "validRange": "Show, Hide",
            "unit": "enum",
            "affectsOutput": "Filters out sheathing materials that are not in the active zones."
          },
          {
            "name": "dTextSize",
            "technicalDefault": "2.5",
            "businessMeaning": "The height of the text characters in the table.",
            "validRange": "1.5 - 10.0",
            "unit": "mm",
            "affectsOutput": "Scales the text legibility and overall size of the table."
          },
          {
            "name": "dMargin",
            "technicalDefault": "2.0",
            "businessMeaning": "Padding space between text and cell borders.",
            "validRange": "0.0 - 10.0",
            "unit": "mm",
            "affectsOutput": "Increases column width to ensure text does not touch grid lines."
          },
          {
            "name": "nPrecision",
            "technicalDefault": "0",
            "businessMeaning": "Number of decimal places for dimension values.",
            "validRange": "0, 1, 2, 3",
            "unit": "count",
            "affectsOutput": "Formats dimensions as integers (e.g., 5000) or decimals (e.g., 5000.00)."
          },
          {
            "name": "sTableTitle",
            "technicalDefault": "",
            "businessMeaning": "Custom header text displayed above the table grid.",
            "validRange": "String text",
            "unit": "text",
            "affectsOutput": "Adds a descriptive title row (e.g., 'Floor 1 Material List')."
          },
          {
            "name": "dRowHeight",
            "technicalDefault": "6.0",
            "businessMeaning": "Vertical distance between horizontal grid lines.",
            "validRange": "4.0 - 20.0",
            "unit": "mm",
            "affectsOutput": "Stretches the table vertically to improve readability."
          },
          {
            "name": "sReferencePoint",
            "technicalDefault": "|Top-Left|",
            "businessMeaning": "The specific corner of the table that locks to the insertion point.",
            "validRange": "Top-Left, Top-Right, Bottom-Left, Bottom-Right",
            "unit": "enum",
            "affectsOutput": "Determines in which direction the table grows from the clicked point."
          },
          {
            "name": "dRotation",
            "technicalDefault": "0.0",
            "businessMeaning": "Angle of rotation for the entire table.",
            "validRange": "0.0 - 360.0",
            "unit": "degrees",
            "affectsOutput": "Rotates the table to align with drawing edges or viewport angles."
          },
          {
            "name": "sSortKey1 through sSortKey4",
            "technicalDefault": "0 (Number)",
            "businessMeaning": "Primary through Quaternary attributes used to order the list (e.g., Material, then Length).",
            "validRange": "Number, Zone index, Name, Beamcode, Width, Height, Length, etc.",
            "unit": "enum",
            "affectsOutput": "Reorders rows to group similar items (like all 6000mm studs together)."
          },
          {
            "name": "sSortMode",
            "technicalDefault": "|Ascending|",
            "businessMeaning": "Direction of the sorting logic.",
            "validRange": "Ascending, Descending",
            "unit": "enum",
            "affectsOutput": "Reverses the order of sorted items (e.g., Largest to Smallest)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sUseGroupSelection set to 'Yes'",
            "effect": "Activates the sGroupName parameter to filter the data source. Filters may apply only within that group.",
            "cascade": [
              "sGroupName"
            ]
          },
          {
            "trigger": "sShowBeams set to 'Hide'",
            "effect": "Beam-specific properties (Beamcode, Grade) will have no visible effect in the output.",
            "cascade": [
              "sFilterBC",
              "sFilterMaterial",
              "sFilterGrade"
            ]
          },
          {
            "trigger": "sTableTitle is populated",
            "effect": "The overall vertical size of the table increases by one row height.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "2D Geometry (PLine)",
            "description": "Grid lines and borders defining the table structure.",
            "appliedTo": "Paper Space"
          },
          {
            "type": "Text Entity",
            "description": "Data strings representing dimensions, quantities, and attributes.",
            "appliedTo": "Paper Space"
          }
        ]
      },
      "tokens_used": 9643,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User adds script to a Paper Space viewport.",
          "Script initializes properties (Filters, Content, Layout, Sorting) to defaults.",
          "User selects an insertion point within the viewport.",
          "[Conditional] If 'Use group selection box' is 'Yes', script uses 'Group' property to find elements; otherwise, it scans all elements in the viewport.",
          "Script iterates through visible GenBeams, Sheeting, and TSL instances.",
          "[Filtering] Each entity is checked against active filters: BeamCode, Material, Label, Name, Zone (1-9), and Include/Exclude logic.",
          "[Validation] Invalid or deleted entities are skipped (History v1.14, v2.30).",
          "Script extracts entity attributes (Dimensions, Material, Grade, Position, Quantity) based on visible columns.",
          "Data is sorted based on Primary, Secondary, Tertiary, and Quaternary sort keys.",
          "[Conditional] If 'Table title' is set, header space is adjusted (v2.27).",
          "Script calculates table geometry based on Row Height, Column Widths, Text Size, and Margin.",
          "Table geometry is transformed based on Rotation and Reference Point (Top-Left, etc.).",
          "2D Geometry (PLine grid) and Text entities are drawn in Paper Space.",
          "[Conditional] If no entities match criteria and headers are enabled, headers are shown (v1.11).",
          "[Conditional] If viewport contains no hsbCAD data, the script name is drawn (v2.06)."
        ],
        "conditionalBranches": [
          {
            "condition": "Data Source Selection (sUseGroupSelection)",
            "path1": {
              "name": "Group Mode",
              "steps": [
                "Script reads 'Group' property value.",
                "Retrieves the specific Group object.",
                "Filters and lists only elements belonging to that Group."
              ]
            },
            "path2": {
              "name": "Viewport Mode",
              "steps": [
                "Script ignores 'Group' property.",
                "Scans all elements visible in the current viewport.",
                "Filters and lists all found elements."
              ]
            }
          },
          {
            "condition": "Filter Logic (sInExcludeFilters)",
            "path1": {
              "name": "Include Mode",
              "steps": [
                "Entities MUST match the filter criteria (BeamCode, Material, etc.).",
                "Non-matching entities are excluded from the BOM."
              ]
            },
            "path2": {
              "name": "Exclude Mode",
              "steps": [
                "Entities MUST NOT match the filter criteria.",
                "Matching entities are removed from the BOM list."
              ]
            }
          },
          {
            "condition": "Table Visibility (sShowBeams, sShowZn1-9)",
            "path1": {
              "name": "Show Category",
              "steps": [
                "Script iterates through entities of this type.",
                "Extracts dimensions and attributes.",
                "Adds rows to the BOM."
              ]
            },
            "path2": {
              "name": "Hide Category",
              "steps": [
                "Script skips iteration for this entity type.",
                "No rows are generated for this category."
              ]
            }
          },
          {
            "condition": "Viewport Data Availability",
            "path1": {
              "name": "Data Present",
              "steps": [
                "Standard BOM generation proceeds.",
                "Table is drawn with content."
              ]
            },
            "path2": {
              "name": "No Data",
              "steps": [
                "Script detects absence of hsbCAD entities.",
                "Draws the script filename 'HSB_G-BillOfMaterial.mcr' as a placeholder."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Validity",
            "errorMessage": "None (Silent skip)",
            "recovery": "Script automatically ignores invalid or deleted beams/sheets to prevent crashes (v1.14)."
          },
          {
            "check": "Group Existence",
            "errorMessage": "None (Silent fallback)",
            "recovery": "If 'Use group selection' is Yes but the group is empty or invalid, headers may still be shown or 'No Content' displayed."
          },
          {
            "check": "Viewport Selection",
            "errorMessage": "Script context error",
            "recovery": "User must ensure the script is inserted into a valid Paper Space viewport."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Table",
            "how": "Grip Edit (Drag script element)",
            "effect": "Changes the insertion point of the BOM table without changing script properties."
          },
          {
            "action": "Reset Location",
            "how": "Context Menu (Right-click) -> Reset Location",
            "effect": "Snaps the table reference point back to the original insertion coordinates."
          },
          {
            "action": "Modify Filters/Layout",
            "how": "Object Properties Palette (OPM)",
            "effect": "Immediately updates table content, sorting, and formatting upon recalculation."
          },
          {
            "action": "Change Reference Point",
            "how": "Object Properties Palette (sReferencePoint)",
            "effect": "Changes the anchor corner (e.g., from Top-Left to Bottom-Right), shifting the table's growth direction relative to the insertion point."
          }
        ]
      },
      "tokens_used": 10098,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-BillOfMaterial.mcr\n\n## Overview\nGenerates a configurable Bill of Materials (BOM) table in Paper Space viewports. The script lists structural entities (beams, sheeting) with user-defined properties, dimensions, and quantities to create material lists and production summaries on drawing layouts.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | Script is designed for 2D annotation. |\n| Paper Space | Yes | The script must be added to a viewport. |\n| Shop Drawing | No | This is a General (G-) script, not a Shop Drawing (sd-) script. |\n\n## Prerequisites\n- **Required Entities**: GenBeam, Sheeting, or other TSL instances visible in the viewport.\n- **Minimum Beam Count**: 0 (Script will run and display headers or script name if empty).\n- **Required Settings**: None (Uses hsbCAD internal Groups dynamically).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or select from hsbCAD Catalog)\nAction: Browse and select `HSB_G-BillOfMaterial.mcr`.\n\n### Step 2: Select Viewport and Insertion Point\n```\nCommand Line: Select insertion point:\nAction: Click inside the desired Paper Space viewport where you want the BOM table to appear.\n```\n\n### Step 3: Configure Table\nAction: Press `Esc` to end the insertion command. Select the newly created script object and open the **Properties Palette** (Ctrl+1) to adjust filters, layout, and sorting options.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Filter Logic** |\n| `sInExcludeFilters` | Enum | Include | Determines if filters select items to keep (Include) or remove (Exclude). |\n| `sFilterBC` | String | *Empty* | Filters structural members by BeamCode (e.g., 'WAL', 'FLR'). Supports wildcards. |\n| `sFilterLabel` | String | *Empty* | Filters entities based on a specific user-assigned label property. |\n| `sFilterMaterial` | String | *Empty* | Filters entities by material grade (e.g., 'C24', 'GL24h'). |\n| `sFilterName` | String | *Empty* | Filters entities based on their entity name property. |\n| **Data Source** |\n| `sUseGroupSelection` | Enum | No | Toggles between analyzing the whole viewport or a specific predefined Group. |\n| `sGroupName` | String | *Empty* | Specifies the hsbCAD Group name to analyze when Group selection is Yes. |\n| **Content Visibility** |\n| `sShowBeams` | Enum | Show | Toggles the visibility of timber beams/columns in the list. |\n| `sShowZn1` through `sShowZn9` | Enum | Show | Toggles visibility of sheathing/cladding elements for specific zones (1-9). |\n| **Layout & Formatting** |\n| `dTextSize` | Double | 2.5 mm | Sets the height of the text characters in the table. |\n| `dMargin` | Double | 2.0 mm | Sets the padding space between text and cell borders. |\n| `nPrecision` | Integer | 0 | Number of decimal places for dimension values (0-3). |\n| `sTableTitle` | String | *Empty* | Custom header text displayed above the table grid. |\n| `dRowHeight` | Double | 6.0 mm | Vertical distance between horizontal grid lines. |\n| `sReferencePoint` | Enum | Top-Left | The corner of the table that locks to the insertion point (affects growth direction). |\n| `dRotation` | Double | 0.0 deg | Rotation angle of the entire table. |\n| **Sorting** |\n| `sSortKey1` through `sSortKey4` | Enum | Number | Attributes (e.g., Length, Material, Name) used to order the list rows. |\n| `sSortMode` | Enum | Ascending | Direction of the sorting logic (Ascending or Descending). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Reset Location** | Snaps the table reference point back to the original insertion coordinates. |\n| **Recalculate** | Refreshes the table content based on current model data and property settings. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not use external XML files for configuration; it relies on hsbCAD internal Groups.\n\n## Tips\n- **Table Growth**: Use the `sReferencePoint` property (e.g., Bottom-Right) if you want the table to expand upwards or leftwards from your insertion point, preventing overlap with other drawings.\n- **Empty Viewports**: If the viewport contains no hsbCAD data, the script will simply draw its filename (`HSB_G-BillOfMaterial.mcr`) as a placeholder.\n- **Filtering**: Use `sFilterMaterial` set to \"C24\" and `sInExcludeFilters` set to \"Include\" to create a list of only C24 graded timber.\n- **Sorting**: Set `sSortKey1` to *Length* and `sSortKey2` to *Material* to group similar materials together, ordered by size.\n\n## FAQ\n- **Q: Why is my table empty?**\n  **A:** Check your Filters (`sFilterBC`, `sFilterMaterial`) and Visibility settings (`sShowBeams`). Ensure `sInExcludeFilters` is set correctly (Include vs Exclude). Also, verify that the viewport actually contains hsbCAD entities.\n- **Q: How do I change the number of decimal places?**\n  **A:** Modify the `nPrecision` property in the Properties Palette (0 = integers, 1 = one decimal place, etc.).\n- **Q: Can I list only specific sheathing zones?**\n  **A:** Yes. Set `sShowBeams` to Hide, and set the desired `sShowZn` (e.g., `sShowZn1`) to Show while setting others to Hide.\n- **Q: The text is too small to read.**\n  **A:** Increase the `dTextSize` property. You may also need to increase `dMargin` and `dRowHeight` to prevent text overlap."
      },
      "tokens_used": 7154,
      "error": null
    }
  }
}