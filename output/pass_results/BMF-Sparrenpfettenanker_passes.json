{
  "filename": "BMF-Sparrenpfettenanker.mcr",
  "status": "completed",
  "total_tokens": 39009,
  "processing_time": 425.26667618751526,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4786,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script constructs 3D geometry using Body objects (bd1, bd2), utilizes Vector3d and CoordSys for spatial calculations, and calls model() and Hardware() functions. It interacts with the user via getBeam() and shows no specific ShopDrawing patterns (sd_ prefix, #Type E, _Viewport usage) or Paper Space logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 4744,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 7991,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Inserts a specific BMF brand metal purlin anchor (Sparrenpfettenanker) to connect two beams (typically a rafter and a purlin) with options for nail configuration and plate orientation.\",\n    \"category\": \"Hardware/Metalpart\",\n    \"typicalUseCase\": \"A user needs to securely attach a purlin to a rafter using a specific stamped metal bracket, requiring the plate geometry to be generated and the correct nails to be added to the BOM.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sType\",\n      \"technicalDefault\": \"170 BMF-Sparrenpfettenanker\",\n      \"businessMeaning\": \"The specific product model and size of the anchor plate. Selecting this sets the physical dimensions (length, width, thickness) of the plate.\",\n      \"validRange\": \"Dropdown list (e.g., 170, 210, 250, UNI 170, etc.)\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Controls the geometry size of the metal plates (bd1, bd2) and the text label.\"\n    },\n    {\n      \"name\": \"sArt1\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Manufacturer Article Number for the purlin anchor plate.\",\n      \"validRange\": \"Alphanumeric string\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Updates the BOM/Properties data for the metal part.\"\n    },\n    {\n      \"name\": \"sMat1\",\n      \"technicalDefault\": \"Stahl, feuerverzinkt\",\n      \"businessMeaning\": \"Material specification of the anchor plate (e.g., galvanized steel).\",\n      \"validRange\": \"Material names defined in catalog\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Updates the material properties and BOM data.\"\n    },\n    {\n      \"name\": \"sMod2\",\n      \"technicalDefault\": \"Kammnagel\",\n      \"businessMeaning\": \"The specific model or type of nail/fastener used.\",\n      \"validRange\": \"Fastener model names\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Updates the BOM data for the hardware.\"\n    },\n    {\n      \"name\": \"sArt2\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Manufacturer Article Number for the nails.\",\n      \"validRange\": \"Alphanumeric string\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Updates the BOM data.\"\n    },\n    {\n      \"name\": \"sMat2\",\n      \"technicalDefault\": \"Stahl, verzinkt\",\n      \"businessMeaning\": \"Material specification of the nails.\",\n      \"validRange\": \"Material names defined in catalog\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Updates the BOM data.\"\n    },\n    {\n      \"name\": \"dDia\",\n      \"technicalDefault\": \"4.0\",\n      \"businessMeaning\": \"Diameter of the nails.\",\n      \"validRange\": \"3.0 - 6.0\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Updates the BOM/Hardware specification.\"\n    },\n    {\n      \"name\": \"dLen2\",\n      \"technicalDefault\": \"40.0\",\n      \"businessMeaning\": \"Length of the nails.\",\n      \"validRange\": \"30 - 150\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Updates the BOM/Hardware specification.\"\n    },\n    {\n      \"name\": \"nNail\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Total quantity of nails used for the connection.\",\n      \"validRange\": \"0 - 20\",\n      \"unit\": \"Count\",\n      \"affectsOutput\": \"If > 0, creates a Hardware entry in the BOM; otherwise, no hardware is listed.\"\n    },\n    {\n      \"name\": \"dOffsetF\",\n      \"technicalDefault\": \"0.0\",\n      \"businessMeaning\": \"Vertical offset of the 'Front' anchor plate relative to the beam intersection.\",\n      \"validRange\": \"-50.0 - 50.0\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Moves the insertion point (ptInsert1) along the beam's Z-axis.\"\n    },\n    {\n      \"name\": \"dOffsetB\",\n      \"technicalDefault\": \"0.0\",\n      \"businessMeaning\": \"Vertical offset of the 'Back' anchor plate relative to the beam intersection.\",\n      \"validRange\": \"-50.0 - 50.0\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Moves the insertion point (ptInsert2) along the beam's Z-axis.\"\n    },\n    {\n      \"name\": \"sSide\",\n      \"technicalDefault\": \"Front\",\n      \"businessMeaning\": \"Selects which side of the beam connection the anchor is applied to when 'On One Side' is active.\",\n      \"validRange\": \"Front / Back\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Determines which body (bd1 or bd2) is mirrored or kept when using single-sided configuration.\"\n    },\n    {\n      \"name\": \"sOneSide\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Determines if the anchor is applied to both sides of the connection (standard) or just one side.\",\n      \"validRange\": \"Yes / No\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"If Yes, mirrors one plate to match the other, effectively removing one plate from the geometry.\"\n    },\n    {\n      \"name\": \"sSwitch\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Flips the orientation of the anchor plates (Left/Right switch).\",\n      \"validRange\": \"Yes / No\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Mirrors the bodies (bd1, bd2) across the X-axis plane.\"\n    },\n    {\n      \"name\": \"sFour\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Enables 'Four-sided' configuration, adding a second"
      },
      "tokens_used": 7571,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch / Recalculation Triggered",
          "Read Properties (sType, sOneSide, sSwitch, sFour, etc.)",
          "Check Insertion Flag (_bOnInsert)",
          "[Insertion Path] Prompt user to Select First Beam (getBeam)",
          "[Insertion Path] Prompt user to Select Second Beam (getBeam)",
          "[Insertion Path] Validation: Check if 2 beams selected. If < 2, Exit Script",
          "[Insertion Path] Show Properties Dialog (showDialog)",
          "[Insertion Path] Exit Script (Wait for Properties Change)",
          "[Calculation Path] Retrieve Selected Beams (bm1, bm2)",
          "Calculate Local Coordinate Systems (cs, vectors vx, vy, vz)",
          "Determine Anchor Index (f) based on selected sType",
          "Calculate Geometry Dimensions (dLength, dWidth, dThick)",
          "Calculate Insertion Points (ptInsert1, ptInsert2) considering Offsets",
          "Generate Anchor Body Geometry (bd1, bd2) using primitive operations",
          "Apply Geometric Transformations (Mirroring) based on Configuration",
          "Update Grippoint Position (_PtG) if undefined",
          "Display Visuals (3D Body, Text Label, Leader Line) based on sDescription",
          "Assign Model Data (Model Name, Material)",
          "Add Hardware/Nails to BOM if nNail > 0",
          "Set Compare Key for Change Detection"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Mode (Insert vs. Update)",
            "path1": {
              "name": "Insert Mode",
              "steps": [
                "Prompt for Beams",
                "Show Dialog",
                "Exit"
              ]
            },
            "path2": {
              "name": "Update Mode",
              "steps": [
                "Read Beams from _Beam list",
                "Recalculate Geometry",
                "Draw"
              ]
            }
          },
          {
            "condition": "Configuration Priority (Switch vs OneSide vs Four)",
            "path1": {
              "name": "Switch Enabled (Yes)",
              "steps": [
                "Mirror bd1 and bd2 across X-axis (Plane pnX1)",
                "Set Side Type Label to 'Left'"
              ]
            },
            "path2": {
              "name": "One Side Enabled (Yes)",
              "steps": [
                "If Side='Front': Mirror bd2 across Y-axis",
                "If Side='Back': Mirror bd1 across Y-axis",
                "Set Side Type Label to 'Right+Left'"
              ]
            },
            "path3": {
              "name": "Four Sides Enabled (Yes)",
              "steps": [
                "Create temp copies (bd3, bd4)",
                "Mirror bd1, bd2 across X-axis",
                "Union original and mirrored bodies",
                "Set Body Count to 4",
                "Set Side Type Label to 'Right+Left'"
              ]
            },
            "path4": {
              "name": "Standard Configuration (All No)",
              "steps": [
                "Use default body geometry",
                "Set Side Type Label to 'Right'"
              ]
            }
          },
          {
            "condition": "Show Description Property",
            "path1": {
              "name": "Description Hidden (No)",
              "steps": [
                "Suppress text output",
                "Suppress leader line"
              ]
            },
            "path2": {
              "name": "Description Visible (Yes)",
              "steps": [
                "Check Grip/Flag orientation",
                "Draw Model Name Text",
                "Draw Type Size Text",
                "Draw Leader Line if Flag > 0"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection Count",
            "errorMessage": "(Implicit) Script terminates without error message if beam count < 2.",
            "recovery": "User must run the script again and select valid beams."
          },
          {
            "check": "Property Initialization",
            "errorMessage": "N/A (Handled by TSL/hsbCAD default property mechanisms)",
            "recovery": "N/A"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Anchor Type",
            "how": "Properties Palette (sType)",
            "effect": "Updates dimensions (Length/Width/Thickness) and Model Name."
          },
          {
            "action": "Adjust Position",
            "how": "Properties Palette (dOffsetF, dOffsetB)",
            "effect": "Moves the anchor plates along the beam Z-axis."
          },
          {
            "action": "Toggle One-Sided/Four-Sided",
            "how": "Properties Palette (sOneSide, sFour, sSwitch)",
            "effect": "Mirrors bodies to create symmetric or single-sided configurations."
          },
          {
            "action": "Move Label/Flag",
            "how": "Grip Edit (_PtG) or Properties (dxFlag, dyFlag)",
            "effect": "Relocates the text description and leader line endpoint."
          },
          {
            "action": "Update Nail Info",
            "how": "Properties Palette (nNail, dLen2, sMod2, etc.)",
            "effect": "Adds, removes, or modifies the hardware entry in the BOM."
          }
        ]
      },
      "tokens_used": 7274,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# BMF-Sparrenpfettenanker.mcr\n\n## Overview\nThis script inserts a BMF brand metal purlin anchor (Sparrenpfettenanker) to connect two beams, typically a rafter and a purlin. It generates the 3D geometry for the metal plate(s) and optionally adds nails to the Bill of Materials (BOM).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates in 3D model space to construct geometry. |\n| Paper Space | No | Not designed for layout or detailing views. |\n| Shop Drawing | No | This is a modeling/connection script. |\n\n## Prerequisites\n- **Required Entities**: 2 `GenBeam` elements (e.g., a Rafter and a Purlin).\n- **Minimum Beam Count**: 2 Beams must be selected during insertion.\n- **Required Settings**: None specific (uses standard material catalogs).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `BMF-Sparrenpfettenanker.mcr` from the list.\n\n### Step 2: Select First Beam\n```\nCommand Line: Select beam:\nAction: Click on the first beam (e.g., the purlin).\n```\n\n### Step 3: Select Second Beam\n```\nCommand Line: Select beam:\nAction: Click on the second beam (e.g., the rafter) that intersects or meets the first beam.\n```\n\n### Step 4: Configuration\n```\nAction: The script will initialize the anchor at the intersection. Use the Properties Palette (Ctrl+1) to adjust dimensions, materials, and nail configurations as required.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sType | dropdown | 170 BMF-Sparrenpfettenanker | Selects the product model and size. This updates the physical dimensions of the plate. |\n| sOneSide | dropdown | No | If \"Yes\", applies the anchor to only one side of the connection. |\n| sSide | dropdown | Front | Determines which side (Front/Back) the anchor is applied to when \"One Side\" is active. |\n| sSwitch | dropdown | No | Flips the orientation of the anchor plates (Left/Right switch). |\n| sFour | dropdown | No | Enables a \"Four-sided\" configuration, adding anchors to all sides of the connection. |\n| dOffsetF | number | 0.0 mm | Vertical offset for the Front anchor plate relative to the beam intersection. |\n| dOffsetB | number | 0.0 mm | Vertical offset for the Back anchor plate relative to the beam intersection. |\n| sArt1 | text | | Manufacturer Article Number for the anchor plate. |\n| sMat1 | text | Stahl, feuerverzinkt | Material specification for the anchor plate (e.g., galvanized steel). |\n| nNail | integer | 0 | Total quantity of nails. Set to > 0 to include hardware in the BOM. |\n| sMod2 | text | Kammnagel | Model or type of nail/fastener used. |\n| sArt2 | text | | Manufacturer Article Number for the nails. |\n| sMat2 | text | Stahl, verzinkt | Material specification for the nails. |\n| dDia | number | 4.0 mm | Diameter of the nails. |\n| dLen2 | number | 40.0 mm | Length of the nails. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Properties | Opens the AutoCAD Properties Palette to edit the parameters listed above. |\n| Update/Refresh | Recalculates the script geometry based on current beam positions. |\n\n## Settings Files\n- **Filename**: N/A (Internal Script)\n- **Location**: N/A\n- **Purpose**: This script relies on internal geometry definitions and standard hsbCAD material catalogs rather than external XML settings files.\n\n## Tips\n- **Nail Visibility**: Nails will not appear in the BOM or manufacturing data unless the `nNail` property is set to a value greater than 0.\n- **Adjusting Position**: If the plate does not sit exactly where you want it relative to the beam intersection, use the `dOffsetF` and `dOffsetB` properties to slide it vertically along the beam.\n- **Orientation**: Use the `sSwitch` property if the anchor is installed on the wrong side of the beam (mirroring the geometry).\n\n## FAQ\n- **Q: Why are no nails showing up in my list?**\n  **A:** Check the `nNail` property in the Properties Palette. It defaults to 0. Increment this number to the required quantity of fasteners.\n  \n- **Q: Can I use this on non-standard beams?**\n  **A:** The script requires two `GenBeam` entities. As long as the beams exist in the model space, the script will attempt to calculate the intersection, though physical fit depends on the specific geometry.\n\n- **Q: How do I create a double-sided connection?**\n  **A:** Ensure `sOneSide` is set to \"No\" and `sFour` is set to \"No\". This generates the standard configuration (usually one plate on each side).\n\n- **Q: The text label is in the wrong place. How do I move it?**\n  **A:** Select the script instance in the model. You should see a grip point (usually a small cross or square) associated with the label. Click and drag this grip to move the text and leader line."
      },
      "tokens_used": 6643,
      "error": null
    }
  }
}