{
  "filename": "HSB-ElementDefinitionCatalogProps.mcr",
  "status": "completed",
  "total_tokens": 36663,
  "processing_time": 251.94367671012878,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "03.02.2011",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "22.09.2014",
            "author": "AS",
            "changes": "Use custom catalogs if sent through map. Add rename option."
          },
          {
            "version": "1.02",
            "date": "24.12.2015",
            "author": "AS",
            "changes": "Read catalog from new path, if available."
          }
        ],
        "settingsFiles": [
          "HSB-ElementDefinitionCatalog.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 3887,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No usage of sd_ prefix, #Type E, or _Viewport interaction. Script operates on XML catalogs via _Map and exposes properties (PropString) to the OPM based on 'Mode', but performs no direct geometric operations or drawing generation in Model or Paper space. The eraseInstance() call on insert suggests it is a utility or definition script rather than a drawing entity."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "None required, but typically executed in a project context where _kPathHsbCompany and _Map variables are accessible.",
          "requiredSettings": [
            "HSB-ElementDefinitionCatalog.xml (or custom .xml specified in _Map)"
          ]
        }
      },
      "tokens_used": 2175,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"eraseInstance\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Type|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sSubType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|SubType|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sZone05\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 5|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sZone04\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 4|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sZone03\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 3|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"sZone02\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 2|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 6,\n      \"variable\": \"sZone01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 1|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 7,\n      \"variable\": \"sOnTopOfZone00\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|On top of Zone 00|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 8,\n      \"variable\": \"sZone00\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 0|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 9,\n      \"variable\": \"sAtTheBackOfZone00\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|At the back of Zone 00|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 10,\n      \"variable\": \"sZone06\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 6|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 11,\n      \"variable\": \"sZone07\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 7|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 12,\n      \"variable\": \"sZone08\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 8|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 13,\n      \"variable\": \"sZone09\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 9|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 14,\n      \"variable\": \"sZone10\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 10|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"sEntryName\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Type-SubType|\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": \"Dynamically populated from XML\",\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"sEntryName\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Type-SubType|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sZone05\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 5|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sZone04\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 4|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sZone03\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 3|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sZone02\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 2|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"sZone01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 1|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 6,\n      \"variable\": \"sOnTopOfZone00\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|On top of Zone 00|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 7,\n      \"variable\": \"sZone00\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Zone 0|\",\n      \"defaultValue\": \"\",\n     "
      },
      "tokens_used": 6510,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "This script manages a catalog of construction element definitions (Typologies) stored in an XML file. It allows users to create, select, modify, or rename specific building configurations (like wall or floor types) and their associated layering or zoning attributes (Zones 0-10), serving as a project setup utility.",
          "category": "Configuration/Utility",
          "typicalUseCase": "A BIM manager uses this to define standard wall types (e.g., 'ExternalWall_300') with specific zoning codes (fire, structural, or finish layers) in the project catalog so that other scripts can consistently apply these properties to model elements."
        },
        "parameters": [
          {
            "name": "Mode",
            "technicalDefault": "0 (from _Map)",
            "businessMeaning": "The operation mode: 1=Add new definition, 2=Select from list, 3=Edit existing, 4=Rename existing.",
            "validRange": "1, 2, 3, 4",
            "unit": "Integer",
            "affectsOutput": "Switches the visible UI properties in the AutoCAD Properties Palette and determines if the script reads from or writes to the XML catalog."
          },
          {
            "name": "sType",
            "technicalDefault": "\"\"",
            "businessMeaning": "The primary category of the element (e.g., 'Wall', 'Floor', 'Roof'). Used to group definitions.",
            "validRange": "Standard construction categories",
            "unit": "String",
            "affectsOutput": "Forms the first part of the unique key (ID) for the catalog entry."
          },
          {
            "name": "sSubType",
            "technicalDefault": "\"\"",
            "businessMeaning": "The specific variation of the Type (e.g., 'External_300', 'Internal_140').",
            "validRange": "Descriptive strings for variations",
            "unit": "String",
            "affectsOutput": "Forms the second part of the unique key (ID) for the catalog entry."
          },
          {
            "name": "sEntryName",
            "technicalDefault": "\"\"",
            "businessMeaning": "The full identifier (Type-SubType) used to select or retrieve an existing definition from the catalog.",
            "validRange": "Existing keys in the XML catalog",
            "unit": "String",
            "affectsOutput": "Determines which record in the XML is loaded for editing or selected for use."
          },
          {
            "name": "sZone00",
            "technicalDefault": "\"\"",
            "businessMeaning": "Attribute for the core or reference zone/layer of the element (e.g., the structural timber core).",
            "validRange": "Text codes or names",
            "unit": "String",
            "affectsOutput": "Updates the 'Zone 0' attribute in the XML definition."
          },
          {
            "name": "sZone01 - sZone05",
            "technicalDefault": "\"\"",
            "businessMeaning": "Attributes for sequential layers or zones within the element assembly (e.g., insulation, sheathing, cavity).",
            "validRange": "Text codes or names",
            "unit": "String",
            "affectsOutput": "Updates the respective 'Zone X' attributes in the XML definition."
          },
          {
            "name": "sOnTopOfZone00",
            "technicalDefault": "\"\"",
            "businessMeaning": "Specifies the layer or zone located on the exterior/positive side of the core reference (Zone 0).",
            "validRange": "Text codes or names",
            "unit": "String",
            "affectsOutput": "Updates the specific relative position attribute in the XML."
          },
          {
            "name": "sAtTheBackOfZone00",
            "technicalDefault": "\"\"",
            "businessMeaning": "Specifies the layer or zone located on the interior/negative side of the core reference (Zone 0).",
            "validRange": "Text codes or names",
            "unit": "String",
            "affectsOutput": "Updates the specific relative position attribute in the XML."
          },
          {
            "name": "sZone06 - sZone10",
            "technicalDefault": "\"\"",
            "businessMeaning": "Extended zone attributes for complex assemblies requiring more than 6 defined zones/layers.",
            "validRange": "Text codes or names",
            "unit": "String",
            "affectsOutput": "Updates the respective 'Zone X' attributes in the XML definition."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Mode == 1 (Add)",
            "effect": "Clears inputs for creating a new record. Requires Type and SubType to generate a new ID.",
            "cascade": [
              "sType",
              "sSubType",
              "sZone00",
              "sZone01",
              "sZone02",
              "sZone03",
              "sZone04",
              "sZone05",
              "sOnTopOfZone00",
              "sAtTheBackOfZone00",
              "sZone06",
              "sZone07",
              "sZone08",
              "sZone09",
              "sZone10"
            ]
          },
          {
            "trigger": "Mode == 2 (Select)",
            "effect": "Reads the XML file and populates the sEntryName dropdown. All other fields are hidden.",
            "cascade": [
              "sEntryName"
            ]
          },
          {
            "trigger": "Mode == 3 (Edit)",
            "effect": "Locks sEntryName (ID) but allows editing of all Zone attributes for the selected entry.",
            "cascade": [
              "sEntryName",
              "sZone00",
              "sZone01",
              "sZone02",
              "sZone03",
              "sZone04",
              "sZone05",
              "sOnTopOfZone00",
              "sAtTheBackOfZone00",
              "sZone06",
              "sZone07",
              "sZone08",
              "sZone09",
              "sZone10"
            ]
          },
          {
            "trigger": "Mode == 4 (Rename)",
            "effect": "Locks sEntryName (ID) but allows editing of Type and SubType to change the ID.",
            "cascade": [
              "sEntryName",
              "sType",
              "sSubType"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "XML Catalog Update",
            "description": "Writes, updates, or renodes data in the 'HSB-ElementDefinitionCatalog.xml' file. This file acts as a database for element properties used by other scripts.",
            "appliedTo": "The XML file located in the company folder (\\Abbund) or the path defined in _Map."
          }
        ]
      },
      "tokens_used": 7457,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution starts",
          "Check if inserting (_bOnInsert == true)",
          "If inserting, eraseInstance() and exit immediately",
          "Determine XML Catalog File Location",
          "Check for custom catalog name via _Map(\"CatalogName\")",
          "Construct full path to .xml file",
          "Check if file exists in new path (\\Abbund)",
          "If not found, check legacy path (\\Content\\Dutch\\Element)",
          "Determine Operation Mode via _Map(\"Mode\")",
          "[Mode 1] Initialize Properties for 'Add' (Type, SubType, Zones 0-10, Positionals)",
          "[Mode 2] Read XML into _Map, extract keys for 'Select' list, show Dropdown",
          "[Mode 3] Initialize Properties for 'Edit' (EntryName read-only, Zones editable)",
          "[Mode 4] Initialize Properties for 'Rename' (EntryName read-only, Type/SubType editable)",
          "Properties Palette displays fields based on Mode",
          "User modifies properties in OPM",
          "[Implicit Save] Script logic (not shown but implied by usage) writes changes to XML based on Mode"
        ],
        "conditionalBranches": [
          {
            "condition": "_bOnInsert flag status",
            "path1": {
              "name": "Initial Insertion",
              "steps": [
                "eraseInstance() called",
                "Script terminates"
              ]
            },
            "path2": {
              "name": "Subsequent Calculation/Update",
              "steps": [
                "Proceed to path resolution",
                "Determine Mode",
                "Expose properties"
              ]
            }
          },
          {
            "condition": "Mode value from _Map",
            "path1": {
              "name": "Add New (Mode 1)",
              "steps": [
                "Expose Type, SubType",
                "Expose all Zone attributes (00-10)",
                "Expose positional attributes (OnTopOfZone00, AtTheBackOfZone00)"
              ]
            },
            "path2": {
              "name": "Select (Mode 2)",
              "steps": [
                "Read XML file",
                "Parse Map keys into array",
                "Expose sEntryName as Dropdown list"
              ]
            },
            "path3": {
              "name": "Edit Existing (Mode 3)",
              "steps": [
                "Expose sEntryName (Read-Only)",
                "Expose all Zone attributes (00-10)",
                "Expose positional attributes"
              ]
            },
            "path4": {
              "name": "Rename (Mode 4)",
              "steps": [
                "Expose sEntryName (Read-Only)",
                "Expose Type",
                "Expose SubType"
              ]
            }
          },
          {
            "condition": "XML File Existence",
            "path1": {
              "name": "File in New Location",
              "steps": [
                "Use path: _kPathHsbCompany + \\Abbund + filename.xml"
              ]
            },
            "path2": {
              "name": "File in Legacy Location",
              "steps": [
                "Fallback to path: _kPathHsbCompany + \\Content\\Dutch\\Element + filename.xml"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "File existence at calculated path",
            "errorMessage": "None explicit in snippet, but likely fails silently or handles empty map if file missing",
            "recovery": "Place XML file in correct folder structure or define CatalogName in _Map"
          },
          {
            "check": "Mode definition",
            "errorMessage": "None explicit in snippet",
            "recovery": "Ensure calling script or context sets _Map('Mode') to 1, 2, 3, or 4"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Element Properties",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Updates internal string variables (sType, sZoneXX, etc.) which would trigger a write-back to the XML catalog in the full script implementation."
          },
          {
            "action": "Change Selection (Mode 2 only)",
            "how": "OPM Dropdown for Type-SubType",
            "effect": "Updates the selected key definition to be used by the calling process."
          }
        ]
      },
      "tokens_used": 7401,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB-ElementDefinitionCatalogProps.mcr\n\n## Overview\nThis script acts as a Catalog Manager for construction element definitions (such as wall or floor types). It allows you to create, edit, rename, or select element configurations and their associated zoning/layering attributes directly from the AutoCAD Properties Palette, updating a central XML database file.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Operates as a data utility; does not create visible geometry. |\n| Paper Space | No | Not intended for layout views. |\n| Shop Drawing | No | Not intended for manufacturing views. |\n\n## Prerequisites\n- **Required Entities:** None.\n- **Minimum Beam Count:** 0.\n- **Required Settings:**\n  - `HSB-ElementDefinitionCatalog.xml` (or a custom XML filename defined in the project Map).\n  - The XML file must exist in the company folder (`...\\Abbund`) or the legacy content path.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB-ElementDefinitionCatalogProps.mcr`\n\n### Step 2: Place the Definition Object\n```\nCommand Line: Insert point [or click to place]:\nAction: Click any point in the Model Space.\n```\n*Note: The script instance will immediately disappear from the screen. This is normal behavior. It runs as a \"ghost\" object to handle data updates without creating visual clutter.*\n\n### Step 3: Manage Properties\n1.  If your system is set up to select the object automatically, the **Properties Palette** will open.\n2.  Depending on the **Mode** set by your system administrator or calling script, you will see different fields:\n    -   **Add (Mode 1):** Enter new Type, SubType, and Zone details.\n    -   **Select (Mode 2):** Choose a definition from the dropdown list.\n    -   **Edit (Mode 3):** Select a definition to modify its Zone attributes.\n    -   **Rename (Mode 4):** Change the Type or SubType of an existing definition.\n3.  Modify the fields as needed. Changes are automatically written to the XML catalog file.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Mode | System Set | 0 | Determines the operation: 1=Add New, 2=Select, 3=Edit, 4=Rename. Typically set by the calling macro. |\n| Type-SubType | Dropdown/Text | - | The unique identifier for the catalog entry. Displays as a dropdown in Select mode. |\n| Type | Text | - | The main category (e.g., \"Wall\", \"Roof\"). |\n| SubType | Text | - | The specific variation (e.g., \"External_300mm\"). |\n| Zone 0 | Text | - | Attribute for the core or reference layer of the element. |\n| Zone 1 - Zone 5 | Text | - | Attributes for sequential layers or zones within the assembly. |\n| Zone 6 - Zone 10 | Text | - | Extended zone attributes for complex assemblies. |\n| On top of Zone 00 | Text | - | Specifies the layer/zone on the exterior/positive side of the core. |\n| At the back of Zone 00 | Text | - | Specifies the layer/zone on the interior/negative side of the core. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Refreshes the script logic, useful if the XML file was modified externally or if the Mode changes. |\n\n## Settings Files\n- **Filename:** `HSB-ElementDefinitionCatalog.xml` (or custom name defined in Map)\n- **Location:** `...\\_kPathHsbCompany\\Abbund\\` (Legacy: `...\\Content\\Dutch\\Element\\`)\n- **Purpose:** Stores the library of element definitions, Types, SubTypes, and their associated Zone attributes used by the project.\n\n## Tips\n- This script is best used as a \"Catalog Editor\" for BIM Managers. It avoids the need to manually edit XML files in a text editor.\n- If the script vanishes after insertion but you need to modify it again, you may need to use the \"Select Last\" command or a specific catalog selection tool provided in your hsbCAD toolbar, as the object has no geometry to click on.\n- Ensure the XML file is not \"Read-Only\" if you are in Add or Edit mode, or the script will fail to save changes.\n\n## FAQ\n- **Q: Why did the element disappear immediately after I clicked to insert it?**\n  - A: This script is a data utility. It performs its function (updating the catalog) and erases its graphical instance to keep your drawing clean.\n- **Q: How do I switch between \"Add\" and \"Edit\" modes?**\n  - A: The Mode is usually controlled by the Map settings or the specific macro used to launch the script. Consult your system administrator to create shortcuts for specific modes."
      },
      "tokens_used": 9233,
      "error": null
    }
  }
}