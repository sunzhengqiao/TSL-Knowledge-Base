{
  "filename": "HSB_SF_E-GridTooling.mcr",
  "status": "completed",
  "total_tokens": 50784,
  "processing_time": 283.38972067832947,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "Applies Service/Trumpet holes based on a grid on Steel Frame Elements. (Can be hidden turning off 'Tooling' layer group)",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "20.09.2017",
            "author": "DR",
            "changes": "Release"
          },
          {
            "version": "1.01",
            "date": "29.09.2017",
            "author": "DR",
            "changes": "All default scenarios defined. Added contextual menus to add/remove positions (vertical/horizontal) and also to erase instance and tubes"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7153,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of `_kModelSpace` in `dbCreate` calls (tslNew.dbCreate(..., _kModelSpace, ...)). The script attaches to `Element` entities and utilizes `Display` objects with `elemZone` and `addViewDirection` for 3D visualization in the model."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Dependent TSL script 'HSB_SF_E-InstallationTube' must be available"
          ]
        }
      },
      "tokens_used": 6331,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"\\nSelect several walls to use default distributions or one single wall to customize (you have the option to use default distributions on single selection too.)\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \""
      },
      "tokens_used": 9550,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automatically distributes service holes (trumpet holes) across Steel Frame walls using a calculated grid or manual points to facilitate MEP installations.\",\n    \"category\": \"Tooling / Manufacturing Prep\",\n    \"typicalUseCase\": \"When detailing a steel frame wall that requires evenly spaced electrical or service penetrations, ensuring consistent placement without conflicting with studs.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"dVerticalSpacing\",\n      \"technicalDefault\": \"600\",\n      \"businessMeaning\": \"The distance between vertical grid lines along the length of the wall. These lines determine where columns of service holes will be placed.\",\n      \"validRange\": \"400 - 1200\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Increases or decreases the number of vertical rows of service holes.\"\n    },\n    {\n      \"name\": \"sDefaultVerticalOption\",\n      \"technicalDefault\": \"0 (Spacing)\",\n      \"businessMeaning\": \"Determines the calculation method for placing the vertical grid lines.\",\n      \"validRange\": \"Spacing | Between studs | Manual input | None\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Switches between fixed spacing, stud-aware placement, or user-defined specific locations.\"\n    },\n    {\n      \"name\": \"dEndOffsetLeft\",\n      \"technicalDefault\": \"160.25\",\n      \"businessMeaning\": \"The clear distance from the left edge of the wall where the first vertical grid line (and holes) is allowed.\",\n      \"validRange\": \"0 - 300\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Shifts the start of the grid pattern horizontally.\"\n    },\n    {\n      \"name\": \"dEndOffsetRight\",\n      \"technicalDefault\": \"160.25\",\n      \"businessMeaning\": \"The clear distance from the right edge of the wall where the last vertical grid line (and holes) is allowed.\",\n      \"validRange\": \"0 - 300\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Shifts the end of the grid pattern horizontally.\"\n    },\n    {\n      \"name\": \"dMinDistanceBetweenStuds\",\n      \"technicalDefault\": \"100\",\n      \"businessMeaning\": \"When using 'Between studs' mode, this defines the minimum gap required between studs to place a hole, avoiding structural conflicts.\",\n      \"validRange\": \"50 - 200\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Filters out potential hole locations if the cavity is too narrow.\"\n    },\n    {\n      \"name\": \"sVerticalPlanePositions\",\n      \"technicalDefault\": \"100;500;1000\",\n      \"businessMeaning\": \"A semicolon-separated list of specific distances from the wall's origin to manually place vertical grid lines.\",\n      \"validRange\": \"0 - WallLength\",\n      \"unit\": \"mm (list)\",\n      \"affectsOutput\": \"Overrides automatic spacing with precise user-defined locations.\"\n    },\n    {\n      \"name\": \"dHorizontalSpacing\",\n      \"technicalDefault\": \"200\",\n      \"businessMeaning\": \"The vertical distance between horizontal grid lines (rows) along the height of the wall.\",\n      \"validRange\": \"100 - 600\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Increases or decreases the number of horizontal rows of service holes.\"\n    },\n    {\n      \"name\": \"sDefaultHorizontalOption\",\n      \"technicalDefault\": \"1 (Top-Bottom-Center)\",\n      \"businessMeaning\": \"Determines the calculation method for placing the horizontal grid lines (heights).\",\n      \"validRange\": \"Spacing | Top-Bottom-Center | Manual input | None\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Switches between fixed vertical spacing, specific floor/ceiling zones, or manual input.\"\n    },\n    {\n      \"name\": \"dEndOffsetBottom\",\n      \"technicalDefault\": \"200\",\n      \"businessMeaning\": \"The clear distance from the bottom track/sill where holes can start.\",\n      \"validRange\": \"0 - 400\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Prevents holes near the floor plate.\"\n    },\n    {\n      \"name\": \"dEndOffsetTop\",\n      \"technicalDefault\": \"200\",\n      \"businessMeaning\": \"The clear distance from the top track/header where holes can start.\",\n      \"validRange\": \"0 - 400\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Prevents holes near the ceiling plate.\"\n    },\n    {\n      \"name\": \"nBottomHorizontalPositions\",\n      \"technicalDefault\": \"3\",\n      \"businessMeaning\": \"The specific number of hole rows to generate in the bottom zone of the wall.\",\n      \"validRange\": \"1 - 10\",\n      \"unit\": \"count\",\n      \"affectsOutput\": \"Controls density of service holes near the floor.\"\n    },\n    {\n      \"name\": \"nTopHorizontalPositions\",\n      \"technicalDefault\": \"3\",\n      \"businessMeaning\": \"The specific number of hole rows to generate in the top zone of the wall.\",\n      \"validRange\": \"1 - 10\",\n      \"unit\": \"count\",\n      \"affectsOutput\": \"Controls density of service holes near the ceiling.\"\n    },\n    {\n      \"name\": \"sHorizontalPlanePositions\",\n      \"technicalDefault\": \"200;500;700\",\n      \"businessMeaning\": \"A semicolon-separated list of specific heights from the wall's origin to manually place horizontal grid lines.\",\n      \"validRange\": \"0 - WallHeight\",\n      \"unit\": \"mm (list)\",\n      \"affectsOutput\": \"Overrides automatic vertical spacing with precise user-defined heights.\"\n    },\n    {\n      \"name\": \"sTubeCatalog\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Selects the specific catalog entry defining the geometry and properties of the service hole (trumpet hole) to be generated.\",\n      \"validRange\": \"Catalog Entries\",\n      \"unit\": \"CatalogRef\",\n      \"affectsOutput\": \"Changes the diameter, shape, and machining parameters of the actual holes.\"\n    },\n    {\n      \"name\": \"dMinimalDistance\",\n      \"technicalDefault\": \"150\",\n      \"businessMeaning\": \"The minimum allowed distance between any two generated tubes to maintain structural integrity.\",\n      \"validRange\": \"100 - 300\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Suppresses holes that would be too close together.\"\n    },\n    {\n      \"name\": \"sFilterType\",\n      \"technicalDefault\": \"|Include|\",\n      \"businessMeaning\": \"Determines if the 'Filter BeamCode' acts as a whitelist (only apply to these beams) or blacklist (ignore these beams).\",\n      \"validRange\": \"Include | Exclude\",\n      \""
      },
      "tokens_used": 9253,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script invoked via command or catalog",
          "2. Check for Execute Key; if not set, show Settings Dialog",
          "3. Prompt user to select Element(s) (Walls)",
          "4. Evaluate Selection Count (Single vs Multiple)",
          "5. [Branch] If Single Element: Interactive Loop for Vertical Points (PrPoint)",
          "6. [Branch] If Single Element: Interactive Loop for Horizontal Points (PrPoint)",
          "7. [Branch] If Multiple Elements: Skip interactive point selection",
          "8. Store configuration and points in internal Map",
          "9. Attach TSL instance to selected Element(s)",
          "10. Load Properties and Map data",
          "11. Calculate Element Geometry (Origin, X/Y Vectors)",
          "12. Check Property Changed Events (Grip Dragging)",
          "13. Update internal coordinate arrays based on Grip movement",
          "14. Refresh Map and Display Grip Points (_PtG)",
          "15. Construct Grid Intersections",
          "16. Erase all existing 'HSB_SF_E-InstallationTube' instances",
          "17. Insert new 'HSB_SF_E-InstallationTube' at grid points",
          "18. Draw Grid Visuals and Symbols"
        ],
        "conditionalBranches": [
          {
            "condition": "Number of Elements selected at Insertion",
            "path1": {
              "name": "Single Element",
              "steps": [
                "Prompt user to pick Vertical grid points (Enter to finish)",
                "Prompt user to pick Horizontal grid points (Enter to finish)",
                "Override default property spacing with picked points"
              ]
            },
            "path2": {
              "name": "Multiple Elements",
              "steps": [
                "Skip point picking prompts",
                "Apply default property settings (Spacing/Offsets) to all elements"
              ]
            }
          },
          {
            "condition": "Interaction Mode (Grip Edit vs Property Edit)",
            "path1": {
              "name": "Grip Drag",
              "steps": [
                "Detect '_PtG' property change",
                "Calculate offset from reference point",
                "Update specific index in horizontal or vertical position array"
              ]
            },
            "path2": {
              "name": "Property Change",
              "steps": [
                "Detect change in Spacing/Offset/Option properties",
                "Regenerate entire grid array based on new formula"
              ]
            }
          },
          {
            "condition": "Context Menu Trigger",
            "path1": {
              "name": "Remove instance and tubes",
              "steps": [
                "Set eraseInstance flag to true",
                "Loop through attached TSLs",
                "Erase all tubes",
                "Erase self"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Geometry / Beam Intersections",
            "errorMessage": "(Implicit) Script returns early if beam intersection points (arPtBmX, arPtBmY) are zero",
            "recovery": "Ensure Element contains structural beams (studs/tracks) that form a valid area"
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Script auto-erases)",
            "recovery": "None (Prevents duplicate instances on same insert action)"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Grid Geometry",
            "how": "Drag blue square grip points in 3D model",
            "effect": "Moves the specific grid line (Vertical or Horizontal) and updates associated tube positions"
          },
          {
            "action": "Modify Spacing/Layout",
            "how": "Edit 'Vertical positions' or 'Horizontal positions' properties in AutoCAD Properties Palette",
            "effect": "Recalculates grid based on selected method (Spacing, Between Studs, or Manual list)"
          },
          {
            "action": "Filter Beams",
            "how": "Set 'Filter type' and 'Filter beams with beamcode' properties",
            "effect": "Restricts or excludes holes on specific structural elements"
          },
          {
            "action": "Delete Tooling",
            "how": "Right-click script instance -> Select 'Remove instance and tubes'",
            "effect": "Removes the grid script and all generated service holes from the element"
          }
        ]
      },
      "tokens_used": 10528,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "```json\n{\n  \"markdown_content\": \"# HSB_SF_E-GridTooling\\n\\n## Overview\\nAutomatically distributes service holes (trumpet holes) across Steel Frame walls using a calculated grid or manual points to facilitate MEP (Mechanical, Electrical, Plumbing) installations.\\n\\n## Usage Environment\\n| Space | Supported | Notes |\\n|-------|-----------|-------|\\n| Model Space | Yes | Required for 3D visualization and attachment to elements. |\\n| Paper Space | No | Not supported. |\\n| Shop Drawing | No | Not supported. |\\n\\n## Prerequisites\\n- **Required Entities**: `Element` (Steel Frame Wall).\\n- **Minimum Beam Count**: 1 (Element must contain structural beams).\\n- **Required Settings**: Dependent TSL script `HSB_SF_E-InstallationTube` must be available in the search path to generate the actual hole geometry.\\n\\n## Usage Steps\\n\\n### Step 1: Launch Script\\nCommand: `TSLINSERT` \\nSelect `HSB_SF_E-GridTooling.mcr` from the file dialog.\\n\\n### Step 2: Select Walls\\n```\\nCommand Line: Select several walls to use default distributions or one single wall to customize (you have the option to use default distributions on single selection too.)\\n```\\n**Action:** Click on the desired Element(s) in the model.\\n- **Multiple Elements:** Applies default distribution settings to all selected walls immediately.\\n- **Single Element:** Proceeds to Step 3 for customization.\\n\\n### Step 3: Define Vertical Grid (Single Wall Only)\\n```\\nCommand Line: (Implicit prompt for vertical points)\\n```\\n**Action:** Click points along the length of the wall to define where the vertical columns of holes should be placed. Press **Enter** to finish.\\n\\n### Step 4: Define Horizontal Grid (Single Wall Only)\\n```\\nCommand Line: (Implicit prompt for horizontal points)\\n```\\n**Action:** Click points along the height of the wall to define where the horizontal rows of holes should be placed. Press **Enter** to finish.\\n\\n## Properties Panel Parameters\\n\\n### Vertical Grid Settings\\n| Parameter | Type | Default | Description |\\n|-----------|------|---------|-------------|\\n| Vertical Option | dropdown | Spacing | Choose calculation method: Spacing, Between studs, Manual input, or None. |\\n| Vertical Spacing | number | 600 mm | Distance between vertical grid lines. |\\n| End Offset Left | number | 160.25 mm | Distance from the left wall edge to the first hole. |\\n| End Offset Right | number | 160.25 mm | Distance from the right wall edge to the last hole. |\\n| Min Distance Between Studs | number | 100 mm | Minimum gap required between studs to place a hole (if 'Between studs' is selected). |\\n| Vertical Plane Positions | text | 100;500;1000 | Semicolon-separated list of specific distances for Manual mode. |\\n\\n### Horizontal Grid Settings\\n| Parameter | Type | Default | Description |\\n|-----------|------|---------|-------------|\\n| Horizontal Option | dropdown | Top-Bottom-Center | Choose calculation method: Spacing, Top-Bottom-Center, Manual input, or None. |\\n| Horizontal Spacing | number | 200 mm | Distance between horizontal grid lines. |\\n| End Offset Bottom | number | 200 mm | Distance from the bottom track to the first hole. |\\n| End Offset Top | number | 200 mm | Distance from the top track to the first hole. |\\n| Bottom Horizontal Positions | number | 3 | Number of hole rows in the bottom zone (if 'Top-Bottom-Center' is selected). |\\n| Top Horizontal Positions | number | 3 | Number of hole rows in the top zone (if 'Top-Bottom-Center' is selected). |\\n| Horizontal Plane Positions | text | 200;500;700 | Semicolon-separated list of specific heights for Manual mode. |\\n\\n### Hole & Filter Settings\\n| Parameter | Type | Default | Description |\\n|-----------|------|---------|-------------|\\n| Tube Catalog | dropdown | 0 | Selects the specific catalog entry for the trumpet hole geometry. |\\n| Minimal Distance | number | 150 mm | Minimum allowed distance between any two holes. |\\n| Filter Type | dropdown | Include | Filters beams by BeamCode: Include (whitelist) or Exclude (blacklist). |\\n| Filter Beams with Beamcode | text | | The specific BeamCode string to filter by. |\\n\\n## Right-Click Menu Options\\n\\n| Menu Item | Description |\\n|-----------|-------------|\\n| Remove instance and tubes | Deletes the grid script instance and all generated service holes from the element. |\\n| Add/Remove Positions | (Contextual options available in specific versions) Manually modify grid points. |\\n\\n## Settings Files\\n- **Filename**: None specified (Script relies on internal logic and `sTubeCatalog` references).\\n- **Location**: N/A\\n- **Purpose**: N/A\\n\\n## Tips\\n- **Visual Control:** The holes are generated on a 'Tooling' layer group. You can hide these in Layer Properties Manager to declutter your view without deleting the data.\\n- **Interactive Editing:** After insertion, you can drag the **blue square grip points** in the 3D model to adjust grid lines instead of typing coordinates.\\n- **Batch Processing:** Select multiple walls at Step 2 to apply standard spacing rules quickly across a large floor plan.\\n- **Conflict Avoidance:** Use the 'Between studs' option in Vertical Settings to ensure holes are only cut in the open bays, avoiding structural studs.\\n\\n## FAQ\\n\\n**Q: Why are no holes showing up even though I see the grips?**\\nA: Ensure the 'Tooling' layer group is turned ON. Also, verify that the dependent script `HSB_SF_E-InstallationTube` is accessible and that the `Tube Catalog` property points to a valid catalog entry.\\n\\n**Q: How do I move just one row of holes?**\\nA: Select the wall, click and drag the blue square grip corresponding to that specific grid line in the 3D model.\\n\\n**Q: Can I prevent holes from appearing in specific structural beams?**\\nA: Yes. Set the `Filter Type` to 'Exclude' and enter the `BeamCode` of the studs you want to protect in the `Filter Beams with Beamcode` property.\\n\"\n}\n```"
      },
      "tokens_used": 7969,
      "error": null
    }
  }
}