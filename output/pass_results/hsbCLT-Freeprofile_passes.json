{
  "filename": "hsbCLT-Freeprofile.mcr",
  "status": "completed",
  "total_tokens": 49953,
  "processing_time": 828.0264210700989,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": \"\",\n    \"numBeamsReq\": 0,\n    \"keywords\": [],\n    \"majorVersion\": 0,\n    \"minorVersion\": 0,\n    \"dxaOut\": 0,\n    \"implInsert\": 0\n  },\n  \"description\": \"This tsl creates a freeprofile tool based on a selected polyline and one or multiple panels\",\n  \"versionHistory\": [\n    {\n      \"version\": \"2.5\",\n      \"date\": \"27.02.2023\",\n      \"author\": \"Thor"
      },
      "tokens_used": 8919,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _kModelSpace in tslDialog.dbCreate calls. No sd_ prefix or #Type E detected. No Paper Space specific functions like _Viewport used. Focus is on GenBeam (panels) and geometric tools in 3D space."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Polyline"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space. Requires selection of one or multiple GenBeam entities (panels) and a polyline.",
          "requiredSettings": [
            "XML Settings file: hsbCLT-Freeprofile.xml (optional but searched for in _kPathHsbCompany\\TSL\\Settings or _kPathHsbInstall\\Content\\General\\TSL\\Settings)",
            "Catalog entry for Tool specification (if 'SpecifyTool' mode is used)"
          ]
        }
      },
      "tokens_used": 5515,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 9831,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates complex CNC free-profile milling operations on CLT panels based on a selected polyline path, utilizing either XML settings or catalog tool definitions.",
          "category": "Machining/CNC",
          "typicalUseCase": "Creating custom shapes, slots, or non-rectangular cutouts in Cross Laminated Timber (CLT) panels where a standard rectangular cut is insufficient."
        },
        "parameters": [
          {
            "name": "nMode",
            "technicalDefault": "0",
            "businessMeaning": "Switches the method of defining tool dimensions. 0 uses internal/XML settings (saved with script), 1 uses Catalog/OPM properties (saved in element properties).",
            "validRange": "0, 1",
            "unit": "Mode",
            "affectsOutput": "Determines where the tool diameter and length are sourced from and how they are persisted in the project."
          },
          {
            "name": "dDiameter",
            "technicalDefault": "0 (from map or catalog)",
            "businessMeaning": "The diameter of the milling cutter. The script offsets the selected polyline by half this value to calculate the tool path center.",
            "validRange": "6mm to 300mm",
            "unit": "mm",
            "affectsOutput": "Directly changes the volume of material removed. A larger diameter creates a wider cut and offsets the toolpath further from the original polyline."
          },
          {
            "name": "dLength",
            "technicalDefault": "0 (from map or catalog)",
            "businessMeaning": "The functional cutting length of the tool bit.",
            "validRange": "20mm to 1000mm",
            "unit": "mm",
            "affectsOutput": "Crucial for CNC data generation to ensure the tool can reach the required depth without colliding with the tool holder or spindle."
          },
          {
            "name": "nToolindex",
            "technicalDefault": "0",
            "businessMeaning": "The identifier corresponding to a specific tool slot in the CNC machine's magazine.",
            "validRange": "1 to 999",
            "unit": "Integer",
            "affectsOutput": "Determines which tool the CNC machine controller selects automatically during production."
          },
          {
            "name": "sToolname",
            "technicalDefault": "\"\"",
            "businessMeaning": "Descriptive name of the tooling configuration.",
            "validRange": "String (e.g., 'Cutter 20mm', 'Groover')",
            "unit": "Text",
            "affectsOutput": "Used to identify and manage tool settings within the XML configuration or Catalog."
          },
          {
            "name": "nColor / nColor2 / nColor3",
            "technicalDefault": "7",
            "businessMeaning": "Visual representation color for the preview bodies in Model Space.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "ACI",
            "affectsOutput": "Visual only. Changes the color of the Display, Extrusion, or Contour visualization to help distinguish operations."
          },
          {
            "name": "nTransparency / nTransparency2 / nTransparency3",
            "technicalDefault": "50",
            "businessMeaning": "Opacity of the 3D preview bodies.",
            "validRange": "0 (Opaque) to 100 (Invisible)",
            "unit": "Percent",
            "affectsOutput": "Visual only. Helps user see the panel underneath the tool preview."
          },
          {
            "name": "sDimStyle / sDimStyle2 / sDimStyle3",
            "technicalDefault": "_DimStyles.sorted()",
            "businessMeaning": "The drafting standard used for dimensions displayed in the model.",
            "validRange": "Existing Dimension Styles",
            "unit": "Style Name",
            "affectsOutput": "Visual only. Affects the arrowheads, text size, and format of dimension labels if dimensions are generated."
          },
          {
            "name": "dTextHeight / dTextHeight2 / dTextHeight3",
            "technicalDefault": "0",
            "businessMeaning": "Height of text labels (if any) generated for the profile.",
            "validRange": "1.5mm to 25mm",
            "unit": "mm",
            "affectsOutput": "Visual only. Controls the readability of annotations in the 3D model or shop drawings."
          },
          {
            "name": "dLineApproxAccuracy",
            "technicalDefault": "0.1",
            "businessMeaning": "Chordal tolerance used to convert curved polyline segments (arcs) into linear segments for the CNC machine.",
            "validRange": "0.01mm (High precision) to 5.0mm (Rough)",
            "unit": "mm",
            "affectsOutput": "Lower values produce smoother curves but significantly increase the size of the CNC export file (more G-Code points)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "nMode set to 1",
            "effect": "Activates OPM (Object Property Model) properties, allowing tool data to be edited directly in the Properties Palette instead of via XML settings.",
            "cascade": [
              "sToolname",
              "dDiameter",
              "dLength",
              "nToolindex"
            ]
          },
          {
            "trigger": "Right-click 'Configure Display'",
            "effect": "Opens a specific dialog to modify the 'Display', 'Extrusion', and 'Contour' visualization settings in the XML map.",
            "cascade": [
              "nColor",
              "nColor2",
              "nColor3",
              "nTransparency",
              "nTransparency2",
              "nTransparency3",
              "sDimStyle",
              "dTextHeight"
            ]
          },
          {
            "trigger": "Right-click 'Configure Tool'",
            "effect": "Opens a dialog to save or update tool parameters (Diameter, Length, etc.) into the XML settings file.",
            "cascade": [
              "dDiameter",
              "dLength",
              "nToolindex",
              "dLineApproxAccuracy"
            ]
          },
          {
            "trigger": "Right-click 'Import/Export Settings'",
            "effect": "Reads from or writes to the physical XML file located in the Company or Install path.",
            "cascade": [
              "All mapSetting variables"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "FreeProfile / Milling",
            "description": "A complex 3D subtraction volume representing the material removed by the milling tool following the polyline path.",
            "appliedTo": "Selected GenBeam entities (CLT Panels)."
          },
          {
            "type": "Preview Body",
            "description": "A visual representation (often red or user-defined color) showing the exact location and volume of the cut.",
            "appliedTo": "Model Space (temporary visualization)."
          }
        ]
      },
      "tokens_used": 8087,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Initialization: Script locates 'hsbCLT-Freeprofile.xml' in Company or Install paths, or retrieves 'MapObject' from dictionary 'hsbTSL'.",
          "2. Mode Evaluation: Checks the 'nMode' property (stored in _Map).",
          "3. [Branch 1] If nMode == 1: Sets OPM key to 'SpecifyTool' and exposes properties (Toolname, Diameter, Length, Index) to the Properties Palette. Execution halts to await user input via palette.",
          "4. [Branch 1] If nMode != 1: Checks 'nDialogMode' (set by context menu triggers).",
          "5. [Branch 2] If nDialogMode == 1: Sets OPM key to 'Display' and exposes visualization properties (Color, Transparency, DimStyle). Execution halts.",
          "6. [Branch 2] If nDialogMode == 2: Sets OPM key to 'Tool' and exposes configuration properties (Diameter, CNC Mode, Accuracy). Execution halts.",
          "7. Trigger Evaluation: Checks if the script is recalculating due to a specific Context Menu trigger ('_kExecuteKey').",
          "8. [Branch 3] If Trigger == 'Configure Display': Opens dialog to modify Display/Extrusion/Contour visual settings, updates MapObject/MapSetting, and forces a second execution loop.",
          "9. [Branch 3] If Trigger == 'Configure Tool': Opens dialog to modify Tool settings, updates MapObject/MapSetting, and forces a second execution loop.",
          "10. [Branch 3] If Trigger == 'Import Settings': Reloads configuration from XML file and updates MapObject.",
          "11. [Branch 3] If Trigger == 'Export Settings': Prompts user for overwrite confirmation, writes current MapSetting to XML file.",
          "12. Main Execution (Implicit): If no triggers/modes matched, script proceeds to select GenBeams and Polylines, then generates the CNC FreeProfile operation based on the resolved settings."
        ],
        "conditionalBranches": [
          {
            "condition": "Value of 'nMode' (0 vs 1)",
            "path1": {
              "name": "OPM / Catalog Mode (1)",
              "steps": [
                "Script sets OPM key to 'SpecifyTool'.",
                "Properties (Diameter, Length, etc.) are read from individual element properties.",
                "Settings are NOT stored in the central XML map."
              ]
            },
            "path2": {
              "name": "XML Settings Mode (0/Default)",
              "steps": [
                "Script attempts to load settings from 'hsbCLT-Freeprofile.xml'.",
                "Properties are managed via Context Menu 'Configure' commands.",
                "Settings are stored in a central MapObject shared across instances."
              ]
            }
          },
          {
            "condition": "Configuration Trigger execution (nDialogMode)",
            "path1": {
              "name": "Display Configuration",
              "steps": [
                "User selects 'Configure Display' from context menu.",
                "Script sets 'nDialogMode' to 1 and restarts.",
                "Properties palette shows Color/Transparency options.",
                "User edits palette -> Script updates 'Display' map in memory."
              ]
            },
            "path2": {
              "name": "Tool Configuration",
              "steps": [
                "User selects 'Configure Tool' from context menu.",
                "Script sets 'nDialogMode' to 2 and restarts.",
                "Properties palette shows Diameter/Length/Accuracy options.",
                "User edits palette -> Script updates 'Tool' map in memory."
              ]
            }
          },
          {
            "condition": "Settings File Location",
            "path1": {
              "name": "Company Path",
              "steps": [
                "Script looks in _kPathHsbCompany\\TSL\\Settings.",
                "Priority location for user-specific configurations."
              ]
            },
            "path2": {
              "name": "Installation Path",
              "steps": [
                "Script looks in _kPathHsbInstall\\Content\\General\\TSL\\Settings.",
                "Fallback location for default configurations."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Settings Folder Existence",
            "errorMessage": "None (handled silently)",
            "recovery": "Script automatically creates the '\\Settings' folder in the Company path if it does not exist during insert."
          },
          {
            "check": "XML Overwrite",
            "errorMessage": "Prompt: 'Are you sure to overwrite existing settings? [No/Yes]'",
            "recovery": "User must explicitly confirm 'Yes' to overwrite the existing XML file; otherwise, the export action is cancelled."
          },
          {
            "check": "MapObject Integrity",
            "errorMessage": "None (Code assumes valid MapObject if mo.bIsValid is true)",
            "recovery": "If MapObject is invalid, script falls back to reading directly from XML or creates a new MapObject."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Tool Parameters",
            "how": "Properties Palette (if nMode=1) or Right-click -> Configure Tool (if nMode=0)",
            "effect": "Updates the diameter, length, or index of the milling cutter, triggering a recalculation of the tool path."
          },
          {
            "action": "Adjust Visualization",
            "how": "Right-click -> Configure Display",
            "effect": "Opens a dialog to change colors, transparency, and dimension styles for the preview bodies."
          },
          {
            "action": "Manage Settings File",
            "how": "Right-click -> Import/Export Settings",
            "effect": "Reloads settings from disk or saves current configuration to XML for project sharing."
          },
          {
            "action": "Flip Side",
            "how": "Right-click -> Flip Side (Command defined in header)",
            "effect": "Likely inverts the tool application side relative to the panel surface (requires script implementation in truncated section)."
          },
          {
            "action": "Edit Geometry",
            "how": "Grip Edit / AutoCAD Modify commands",
            "effect": "Modifying the source polyline or panel geometry forces a recalculation of the freeprofile operation to match the new geometry."
          }
        ]
      },
      "tokens_used": 10857,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-Freeprofile\n\n## Overview\nThis script generates CNC free-profile milling operations on CLT panels based on a selected polyline path. It supports tool definition either via an internal XML configuration file or directly through the AutoCAD Properties Palette.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D GenBeam entities and polylines. |\n| Paper Space | No | Not designed for layout or sheet generation. |\n| Shop Drawing | No | Machining operations are applied in the model environment. |\n\n## Prerequisites\n- **Required Entities**: At least one GenBeam (CLT Panel) and one Polyline (defining the tool path).\n- **Minimum Beam Count**: 1\n- **Required Settings**:\n  - XML Settings file (`hsbCLT-Freeprofile.xml`) is optional but recommended for saving standard configurations.\n  - Catalog entry (if using `nMode=1` to specify tools from a catalog).\n\n## Usage Steps\n\n### Step 1: Launch Script\n```\nCommand: TSLINSERT\nAction: Select the file \"hsbCLT-Freeprofile.mcr\" from the file browser.\n```\n\n### Step 2: Select Panels\n```\nCommand Line: Select beams/panels:\nAction: Click on one or multiple CLT panels (GenBeams) you wish to machine. Press Enter to confirm selection.\n```\n\n### Step 3: Select Polyline\n```\nCommand Line: Select polyline:\nAction: Click on the polyline that defines the shape of the free-profile cut.\n```\n\n### Step 4: Configure Tool\n*(This step varies depending on the `nMode` property)*\n- **If nMode = 0 (Default/XML Mode)**: The script uses default settings. To modify them, right-click the script instance in the model and select **Configure Tool**.\n- **If nMode = 1 (Catalog Mode)**: Select the script instance and open the **Properties Palette** (Ctrl+1). Modify the Tool Diameter, Length, and Index directly in the palette.\n\n### Step 5: Verify Visualization\n- Check the generated colored preview bodies on the panel.\n- If adjustments to color or transparency are needed, right-click and select **Configure Display**.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **nMode** | Integer | 0 | **Operation Mode**: 0 = Use XML Settings (saved with script); 1 = Use OPM Properties (saved in element). |\n| **sToolname** | String | \"\" | Name of the tool (e.g., \"Cutter 20mm\"). Used for identification in lists/Catalog. |\n| **dDiameter** | Double | 0 | Diameter of the milling cutter (mm). The polyline will be offset by half this value. |\n| **dLength** | Double | 0 | Functional cutting length of the tool (mm). |\n| **nToolindex** | Integer | 0 | Magazine slot number on the CNC machine. |\n| **dLineApproxAccuracy** | Double | 0.1 | Chordal tolerance for converting curves to linear segments (mm). Lower = smoother curves, larger file size. |\n| **nColor** | Integer | 7 | Visual color for the \"Display\" preview body (AutoCAD Color Index). |\n| **nColor2** | Integer | 7 | Visual color for the \"Extrusion\" preview body. |\n| **nColor3** | Integer | 7 | Visual color for the \"Contour\" preview body. |\n| **nTransparency** | Integer | 50 | Transparency level (0-100) for the preview body. |\n| **sDimStyle** | String | *Current* | Dimension style used for generated labels. |\n| **dTextHeight** | Double | 0 | Height of text annotations (mm). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Configure Display** | Opens a dialog (or swaps Properties Palette view) to modify visualization settings like Color, Transparency, and Dimension Styles for the preview bodies. |\n| **Configure Tool** | Opens a dialog to modify machining parameters (Diameter, Length, CNC Mode, Accuracy) and save them to the internal XML map. |\n| **Import Settings** | Reloads the configuration from the `hsbCLT-Freeprofile.xml` file, overwriting current memory settings. |\n| **Export Settings** | Saves the current tool and display configuration to the `hsbCLT-Freeprofile.xml` file for use in other projects. |\n| **Flip Side** | Inverts the side of the panel where the tool is applied (Top/Bottom or Left/Right). |\n\n## Settings Files\n- **Filename**: `hsbCLT-Freeprofile.xml`\n- **Location**:\n  - Priority: `_kPathHsbCompany\\TSL\\Settings`\n  - Fallback: `_kPathHsbInstall\\Content\\General\\TSL\\Settings`\n- **Purpose**: Stores tool dimensions, CNC parameters, and display preferences. This allows standard configurations to be shared across a project or company without re-entering data for every instance.\n\n## Tips\n- **Project vs. Element Settings**: Use `nMode = 0` if you want to update the tool size once and have it apply to all instances using that XML configuration. Use `nMode = 1` if you need unique tool settings for specific panels.\n- **Export Settings**: After setting up your perfect tool configuration, use the **Export Settings** right-click option to back it up to the XML file.\n- **CNC Data**: Ensure the `dLineApproxAccuracy` is set appropriately. For high-quality curved cuts, set this lower (e.g., 0.5mm or less), but be aware it increases the G-Code file size.\n\n## FAQ\n- **Q: I changed the diameter in the Properties Palette, but nothing happened.**\n  - **A**: Check your `nMode` property. If it is set to `0` (XML Mode), the script reads from the XML map, not the individual properties. Change `nMode` to `1` to enable direct editing in the palette, or use the \"Configure Tool\" right-click menu.\n- **Q: How is the tool path calculated relative to my polyline?**\n  - **A**: The script calculates the center of the tool path. The final cut on the panel will be offset from your selected polyline by half of the `dDiameter` value.\n- **Q: Where do I put the XML file so the script finds it?**\n  - **A**: Place it in your company folder under `...\\TSL\\Settings`. If the script cannot find it there, it will look in the hsbCAD installation directory."
      },
      "tokens_used": 6744,
      "error": null
    }
  }
}