{
  "filename": "GE_HDWR_ITW_TDS.mcr",
  "status": "completed",
  "total_tokens": 56899,
  "processing_time": 453.20668625831604,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 6,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.6",
            "date": "03.nov.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Stickframe path added to mapIn when calling dll"
          },
          {
            "version": "1.5",
            "date": "01.apr.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Integrated manual insertion and construction directive insertion - Props values, read only, and hidden upon construction directive info provided"
          },
          {
            "version": "1.4",
            "date": "01.apr.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Prop. names updated - TSL won't be erased if inserted manually"
          },
          {
            "version": "1.3",
            "date": "31.oct.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Color set to white"
          },
          {
            "version": "1.2",
            "date": "10.oct.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Added code to avoid error on insertion when user had wrong pre-set values loaded"
          },
          {
            "version": "1.1",
            "date": "09.oct.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Exporting to _Map values to be consumed by Revit"
          },
          {
            "version": "1.0",
            "date": "06.oct.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7980,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script executes on _bOnInsert, uses PrEntity to select ElementWall entities, and generates 3D Body geometry (rods, nuts, washers, couplers, etc.) using Display.draw(). It lacks Paper Space indicators (_Viewport, sd_ prefix) and operates directly on construction elements."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Wall elements",
          "requiredSettings": [
            "hsbFramingDefaults.Inventory.dll",
            "hsbCAD Company and Installation Paths",
            "Map entries for construction directives (if not manually inserted)"
          ]
        }
      },
      "tokens_used": 7561,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\\n|Select walls|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "showDialog",
              "promptOriginal": "Properties",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Called via showDialog() on Insert",
            "title": "Properties",
            "dataSource": "OPM Properties (sType, sBmLumberItem, etc.)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "|System type|",
            "defaultValue": "5/8",
            "inputType": "dropdown",
            "options": [
              "5/8",
              "1/2",
              "7/8"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sBmLumberItem",
            "type": "PropString",
            "displayName": "|Stud type|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "sLumberItemNames (from DLL)"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sStudsLeft",
            "type": "PropString",
            "displayName": "|Studs at left|",
            "defaultValue": "0",
            "inputType": "dropdown",
            "options": [
              "0",
              "1",
              "2",
              "3",
              "4",
              "5"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sStudsRight",
            "type": "PropString",
            "displayName": "|Studs at right|",
            "defaultValue": "0",
            "inputType": "dropdown",
            "options": [
              "0",
              "1",
              "2",
              "3",
              "4",
              "5"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sFloorSystemBlocking",
            "type": "PropString",
            "displayName": "|Floor system blocking|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sStrapsOnBlocking",
            "type": "PropString",
            "displayName": "     -|Straps on blocking|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sRunStart",
            "type": "PropString",
            "displayName": "|Run Start Options|",
            "defaultValue": "|Concrete|",
            "inputType": "dropdown",
            "options": [
              "|Concrete|",
              "|Wood beam|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sRunEnd",
            "type": "PropString",
            "displayName": "|Run Termination|",
            "defaultValue": "|Top plates|",
            "inputType": "dropdown",
            "options": [
              "|Top plates|",
              "|Compression Bridge|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dRodEmbedment",
            "type": "PropDouble",
            "displayName": "|Anchor bolt Embedment|",
            "defaultValue": "200 (mm) / 8 (in)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dRodExtension",
            "type": "PropDouble",
            "displayName": "|Rod Extension|",
            "defaultValue": "75 (mm) / 3 (in)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dFirstLevelCouplerHeight",
            "type": "PropDouble",
            "displayName": "|First Level Coupler Height|",
            "defaultValue": "300 (mm) / 12 (in)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dOtherLevelsCouplerHeight",
            "type": "PropDouble",
            "displayName": "|Other Levels Coupler Height|",
            "defaultValue": "300 (mm) / 12 (in)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dClearDistance",
            "type": "PropDouble",
            "displayName": "|Clear distance between posts|",
            "defaultValue": "150 (mm) / 6 (in)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "\\Utilities\\hsbFramingDefaultsEditor\\hsbFramingDefaults.Inventory.dll",
            "searchPaths": [
              "_kPathHsbInstall"
            ],
            "purpose": "Provides list of Lumber Items for Stud Type property",
            "required": true
          }
        ]
      },
      "tokens_used": 9240,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates and models a Continuous Rod Tie-Down System (TDS) for timber framing, representing ITW-style hardware including rods, couplers, take-up devices (TUDs), and bearing plates across multiple wall panels.",
          "category": "Hardware / Connection Design",
          "typicalUseCase": "Used by engineers or designers to model continuous rod systems (often Simpson Strong-Tie or ITW equivalent) that tie down multi-story wall stacks to the foundation, calculating rod lengths and placement of couplers and tensioning devices."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "5/8",
            "businessMeaning": "The nominal diameter of the threaded rod used in the tie-down system.",
            "validRange": "1/2\" to 1\" (Standard thread diameters)",
            "unit": "inches (nominal)",
            "affectsOutput": "Controls the diameter of the drawn 3D rods and the size of associated hardware (nuts/washers)."
          },
          {
            "name": "sBmLumberItem",
            "technicalDefault": "<from DLL>",
            "businessMeaning": "The specific lumber grade or species of the wall studs.",
            "validRange": "N/A (Dependent on Inventory Configuration)",
            "unit": "String",
            "affectsOutput": "Used primarily for material reporting and engineering validation to ensure the timber strength is compatible with the rod design."
          },
          {
            "name": "sStudsLeft",
            "technicalDefault": "0",
            "businessMeaning": "The number of reinforced studs packed at the left end of the wall run.",
            "validRange": "0 to 5",
            "unit": "count",
            "affectsOutput": "Modifies the wall framing layout locally at the start of the run to accommodate the tension load from the rod."
          },
          {
            "name": "sStudsRight",
            "technicalDefault": "0",
            "businessMeaning": "The number of reinforced studs packed at the right end of the wall run.",
            "validRange": "0 to 5",
            "unit": "count",
            "affectsOutput": "Modifies the wall framing layout locally at the end of the run to accommodate the tension load."
          },
          {
            "name": "sFloorSystemBlocking",
            "technicalDefault": "|No|",
            "businessMeaning": "Specifies if wood blocking is added between floor joists to secure the rod system.",
            "validRange": "Yes/No",
            "unit": "boolean",
            "affectsOutput": "Controls the generation of blocking bodies (implied) and determines if straps are placed."
          },
          {
            "name": "sStrapsOnBlocking",
            "technicalDefault": "|No|",
            "businessMeaning": "Specifies if metal tension straps are applied over the floor blocking.",
            "validRange": "Yes/No",
            "unit": "boolean",
            "affectsOutput": "Generates 3D rectangular strap geometry connecting the blocking to the tie-down system."
          },
          {
            "name": "sRunStart",
            "technicalDefault": "|Concrete|",
            "businessMeaning": "Defines the anchorage condition at the bottom of the continuous rod run.",
            "validRange": "Concrete, Wood beam",
            "unit": "enum",
            "affectsOutput": "Determines the geometry of the bottom end of the rod (embedment into concrete vs. bearing on wood)."
          },
          {
            "name": "sRunEnd",
            "technicalDefault": "|Top plates|",
            "businessMeaning": "Defines the termination condition at the top of the continuous rod run.",
            "validRange": "Top plates, Compression Bridge",
            "unit": "enum",
            "affectsOutput": "Determines the hardware placement at the top (standard nut/washer on plates vs. specialized compression bridge hardware)."
          },
          {
            "name": "dRodEmbedment",
            "technicalDefault": "200mm (8\")",
            "businessMeaning": "The depth the anchor rod extends into the concrete foundation.",
            "validRange": "150mm - 600mm (6\" - 24\")",
            "unit": "length (mm/in)",
            "affectsOutput": "Lengthens the bottom segment of the rod model below the sill plate."
          },
          {
            "name": "dRodExtension",
            "technicalDefault": "75mm (3\")",
            "businessMeaning": "The length of rod projecting past the nut/washer for threading.",
            "validRange": "50mm - 100mm (2\" - 4\")",
            "unit": "length (mm/in)",
            "affectsOutput": "Extends the physical rod length beyond termination points."
          },
          {
            "name": "dFirstLevelCouplerHeight",
            "technicalDefault": "300mm (12\")",
            "businessMeaning": "Vertical distance from the bottom of the wall to the center of the first rod coupler.",
            "validRange": "100mm - 600mm",
            "unit": "length (mm/in)",
            "affectsOutput": "Positions the first coupler (splice) geometry vertically."
          },
          {
            "name": "dOtherLevelsCouplerHeight",
            "technicalDefault": "300mm (12\")",
            "businessMeaning": "Vertical distance for couplers on subsequent levels/stories.",
            "validRange": "100mm - 600mm",
            "unit": "length (mm/in)",
            "affectsOutput": "Positions couplers for upper floor levels."
          },
          {
            "name": "dClearDistance",
            "technicalDefault": "150mm (6\")",
            "businessMeaning": "Required clearance spacing between posts or hardware elements.",
            "validRange": "100mm - 300mm",
            "unit": "length (mm/in)",
            "affectsOutput": "Spacing logic for placing multiple tie-down rods or hardware components."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sType changes",
            "effect": "Updates the internal rod diameter variable used for geometry generation.",
            "cascade": [
              "dRodDiameter"
            ]
          },
          {
            "trigger": "sFloorSystemBlocking set to |No|",
            "effect": "Disables or hides the option to place straps on blocking.",
            "cascade": [
              "sStrapsOnBlocking"
            ]
          },
          {
            "trigger": "sRunStart changes to |Wood beam|",
            "effect": "Rod Embedment parameter becomes less relevant as the rod bears on wood rather than casting into concrete.",
            "cascade": [
              "dRodEmbedment"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Body (Rod)",
            "description": "Cylindrical geometry representing the continuous threaded rod running vertically through the walls.",
            "appliedTo": "Wall Assembly (Centered or offset based on design)"
          },
          {
            "type": "3D Body (Nut)",
            "description": "Hexagonal prism geometry representing heavy hex nuts.",
            "appliedTo": "Rod termination points (Top/Bottom and couplers)"
          },
          {
            "type": "3D Body (Square Washer/Plate)",
            "description": "Square prism geometry representing bearing plates or washers.",
            "appliedTo": "Top and Bottom of rod runs"
          },
          {
            "type": "3D Body (Coupler)",
            "description": "Hexagonal sleeve geometry used to splice two rods together.",
            "appliedTo": "Vertical splice points (calculated by height parameters)"
          },
          {
            "type": "3D Body (TUD - Take Up Device)",
            "description": "Short cylindrical or mechanical device body used to tension the rod after concrete curing.",
            "appliedTo": "Rod run (typically at the top or intermediate levels)"
          },
          {
            "type": "3D Body (Strap)",
            "description": "Flat rectangular steel plates connecting blocking to the structure.",
            "appliedTo": "Floor blocking area"
          }
        ]
      },
      "tokens_used": 11238,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Check execution context (_bOnInsert).",
          "2. Data Initialization: Call hsbFramingDefaults.Inventory.dll to retrieve Lumber Items list and store in _Map.",
          "3. Property Declaration: Define PropString and PropDouble variables (System type, Studs, Rod dimensions, etc.).",
          "4. Mode Check: Verify if the script was Manually Inserted or generated via Construction Directive (_Map.getInt).",
          "5. Property Override (Directive Mode only): If Construction Directive, lock all properties Read-Only and populate values from _Map.",
          "6. User Interaction (Manual Insertion only):",
          "   a. Prompt user to select Walls (ElementWall).",
          "   b. Prompt user for Insertion Point.",
          "   c. Show Dialog (Properties Palette) for user configuration.",
          "7. Wall Filtering Logic:",
          "   a. Create a vertical search body at the insertion point.",
          "   b. Identify a Reference Wall intersecting the search body.",
          "   c. Filter the initial selection to keep only walls intersecting the Reference Wall.",
          "8. Dependency Setup: Establish dependencies on the filtered wall list.",
          "9. Calculation (Inferred): Calculate rod paths, coupler positions, and hardware coordinates. Store coordinates in _Map arrays.",
          "10. Geometry Generation: Retrieve coordinate arrays from _Map and generate 3D Bodies (Rods, Nuts, Washers, Couplers, TUDs, Straps)."
        ],
        "conditionalBranches": [
          {
            "condition": "Check Insertion Cycle",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Execute eraseInstance()",
                "Return immediately"
              ]
            },
            "path2": {
              "name": "First Cycle",
              "steps": [
                "Proceed to Entity Selection"
              ]
            }
          },
          {
            "condition": "Manual Insertion vs. Construction Directive",
            "path1": {
              "name": "Manual Insertion",
              "steps": [
                "Enable Property Editing",
                "Execute PrEntity (Select Walls)",
                "Execute getPoint (Insertion Point)",
                "Execute showDialog"
              ]
            },
            "path2": {
              "name": "Construction Directive",
              "steps": [
                "Set all Properties to Read-Only",
                "Populate Property values from _Map",
                "Skip User Prompts"
              ]
            }
          },
          {
            "condition": "Reference Element Found",
            "path1": {
              "name": "Reference Found",
              "steps": [
                "Filter walls intersecting Reference Body",
                "Proceed to Calculation"
              ]
            },
            "path2": {
              "name": "Reference Not Found",
              "steps": [
                "Report Error Message",
                "Return (Stop Execution)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insert Cycle Count",
            "errorMessage": null,
            "recovery": "Automatic (Script erases self if cycle > 1)"
          },
          {
            "check": "Element Selection Count",
            "errorMessage": null,
            "recovery": "Automatic (Script erases self if no walls selected)"
          },
          {
            "check": "Reference Wall Intersection",
            "errorMessage": "Message from [Script Name] TSL: Reference element not found, TSL will be erased.",
            "recovery": "User must ensure insertion point is within a valid wall boundary and re-run."
          },
          {
            "check": "Filtered Wall List Count",
            "errorMessage": "Message from [Script Name] TSL: No walls left after filter by location, TSL will be erased.",
            "recovery": "User must ensure selected walls align vertically or horizontally with the insertion point."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties",
            "how": "Object Properties Palette (OPM)",
            "effect": "Updates 'ExecutionMode', triggers Recalc, and updates rod/hardware geometry (e.g., changing coupler height or rod diameter)."
          },
          {
            "action": "Modify Associated Walls",
            "how": "Standard CAD Edit (Move, Stretch, Modify Wall Properties)",
            "effect": "Triggers script recalculation via dependencies to update rod location and length to match new wall geometry."
          },
          {
            "action": "Delete Associated Wall",
            "how": "Erase Command",
            "effect": "If script detects dependency deletion (in Construction Directive mode), it executes eraseInstance()."
          }
        ]
      },
      "tokens_used": 12450,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_ITW_TDS.mcr\n\n## Overview\nGenerates a 3D model of a Continuous Rod Tie-Down System (ITW style) for timber frame walls. This script calculates and places threaded rods, couplers, take-up devices, bearing plates, and associated reinforcement based on the selected wall geometry.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be inserted in the model where wall elements exist. |\n| Paper Space | No | Not designed for shop drawing layouts. |\n| Shop Drawing | No | Generates 3D model geometry only. |\n\n## Prerequisites\n- **Required Entities**: `ElementWall` entities (wall panels) must exist in the drawing.\n- **Minimum beam count**: 0 (This script works with Walls, not Beams).\n- **Required settings files**: `hsbFramingDefaults.Inventory.dll` (Must be present in the hsbCAD installation path to populate the Stud Type list).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_HDWR_ITW_TDS.mcr` from the list.\n\n### Step 2: Select Walls\n```\nCommand Line: Select walls\nAction: Select the wall panels or entire wall assembly that requires the tie-down system. Press Enter to confirm selection.\n```\n\n### Step 3: Specify Insertion Point\n```\nCommand Line: Point\nAction: Click a point within the wall run. This point determines the vertical location of the rod run relative to the wall reference.\n```\n\n### Step 4: Configure Properties\n```\nAction: The Properties Palette will open automatically. Adjust the System Type, Stud reinforcement, and Rod dimensions as required. The 3D preview will update based on these settings.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| System type | dropdown | 5/8 | Diameter of the continuous rod (e.g., 5/8\", 1/2\", 7/8\"). |\n| Stud type | dropdown | *From DLL* | Specifies the lumber grade/species for the studs (retrieved from Inventory settings). |\n| Studs at left | dropdown | 0 | Number of reinforced studs to pack at the start of the wall run (0-5). |\n| Studs at right | dropdown | 0 | Number of reinforced studs to pack at the end of the wall run (0-5). |\n| Floor system blocking | dropdown | No | Enables or disables wood blocking between floor joists. |\n| Straps on blocking | dropdown | No | Enables metal tension straps over the floor blocking (requires Blocking to be Yes). |\n| Run Start Options | dropdown | Concrete | Anchorage condition at the bottom (Concrete or Wood beam). |\n| Run Termination | dropdown | Top plates | Termination condition at the top (Top plates or Compression Bridge). |\n| Anchor bolt Embedment | number | 200 mm / 8 in | Depth the rod extends into the concrete foundation (if Start is Concrete). |\n| Rod Extension | number | 75 mm / 3 in | Length of rod projecting past the nut/washer for threading. |\n| First Level Coupler Height | number | 300 mm / 12 in | Vertical distance from the bottom to the center of the first coupler. |\n| Other Levels Coupler Height | number | 300 mm / 12 in | Vertical distance to couplers on subsequent floor levels. |\n| Clear distance between posts | number | 150 mm / 6 in | Required spacing clearance between posts or hardware elements. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Erase | Removes the TSL instance and generated 3D bodies from the drawing. |\n| Recalculate | Updates the geometry if associated walls are modified or properties change (also available via property updates). |\n\n## Settings Files\n- **Filename**: `hsbFramingDefaults.Inventory.dll`\n- **Location**: `...\\Utilities\\hsbFramingDefaultsEditor\\` (hsbCAD Install path)\n- **Purpose**: Provides the list of available lumber items for the \"Stud type\" dropdown property.\n\n## Tips\n- **Insertion Point Matters**: Ensure you click the insertion point inside the bounds of the wall elements. If the point is outside, the script will fail to find a reference and erase itself.\n- **Automatic Updates**: If you stretch or move the associated walls, the tie-down rods and couplers will automatically recalculate their length and position.\n- **Top Termination**: Use the \"Compression Bridge\" option if your design requires a specialized bridge termination rather than standard bearing on top plates.\n\n## FAQ\n- **Q: Why did the script disappear immediately after insertion?**\n  **A:** The insertion point was likely outside the physical boundary of the selected walls, or the selected walls did not align correctly. Verify your selection and click inside the wall area.\n- **Q: Can I use this for a single story or multi-story walls?**\n  **A:** This script is designed to handle continuous runs. It calculates coupler heights for the first level and subsequent levels differently, making it suitable for multi-story stacks.\n- **Q: What happens if I change the \"System type\" to a larger diameter?**\n  **A:** The 3D geometry of the rods, nuts, and washers will update to reflect the new size. Ensure your wall framing has sufficient space for the larger hardware."
      },
      "tokens_used": 8430,
      "error": null
    }
  }
}