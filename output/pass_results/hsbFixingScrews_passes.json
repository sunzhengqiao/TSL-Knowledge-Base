{
  "filename": "hsbFixingScrews.mcr",
  "status": "completed",
  "total_tokens": 52387,
  "processing_time": 471.90348410606384,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9008,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script operates on GenBeam entities to add tools (Drill) and Hardware, and explicitly passes _kModelSpace to tslNew.dbCreate(). It lacks paper space indicators (sd_, _Viewport, Sheet) and focuses on 3D geometry manipulation."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "ModelSpace",
          "requiredSettings": [
            "ScrewCatalog.xml"
          ]
        }
      },
      "tokens_used": 6575,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 1,\n      \"variable\": \"sManufacturer\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Manufacturer\",\n      \"defaultValue\": \"---\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"---\"\n      ],\n      \"category\": \"Component\",\n      \"description\": \"Defines the Manufacturer\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sFamily\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Family\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"---\"\n      ],\n      \"category\": \"Component\",\n      \"description\": \"Defines the Family\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sProduct\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Product\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"---\"\n      ],\n      \"category\": \"Component\",\n      \"description\": \"Defines the Product\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sAlignment\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Alignment\",\n      \"defaultValue\": \"+X\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"+X\",\n        \"-X\",\n        \"+Y\",\n        \"-Y\",\n        \"+Z\",\n        \"-Z\"\n      ],\n      \"category\": \"Alignment\",\n      \"description\": \"Defines the face of the Genbeam where the nails will be placed\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dAngle\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Angle\",\n      \"defaultValue\": 30,\n      \"inputType\": \"number\",\n      \"category\": \"Alignment\",\n      \"description\": \"Defines the inclination angle of the Nail. Rotation axis is defined from the direction of distribution\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dGapNail\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Offset from Plate\",\n      \"defaultValue\": 13,\n      \"inputType\": \"number\",\n      \"category\": \"Alignment\",\n      \"description\": \"Defines the position of Start (Head) of Nail. Value represents distance from the Face\"\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"sModeDistribution\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Mode of Distribution\",\n      \"defaultValue\": \"Even\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Even\",\n        \"Fixed\"\n      ],\n      \"category\": \"Distribution\",\n      \"description\": \"Defines the Mode of Distribution\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"dDistanceBottom\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Start Distance\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"category\": \"Distribution\",\n      \"description\": \"Defines the Distance at the Start\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"dDistanceTop\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"End Distance\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"category\": \"Distribution\",\n      \"description\": \"Defines the Distance at the End\"\n    },\n    {\n"
      },
      "tokens_used": 9690,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the insertion of structural fixing screws or nails into timber elements (beams/walls) based on a configurable manufacturer catalog, calculating positions for distribution, inclination, and offset.",
          "category": "Hardware/Machining",
          "typicalUseCase": "Applying diagonal timber screws for wall bracing, attaching steel plates via through-screws, or distributing fixings along a beam for connection."
        },
        "parameters": [
          {
            "name": "sManufacturer",
            "technicalDefault": "---",
            "businessMeaning": "Selects the brand of the fixing (e.g., SFS, SPASS, Rothoblaas) from the loaded ScrewCatalog.xml.",
            "validRange": "List populated by XML",
            "unit": "Text",
            "affectsOutput": "Filters the available Families and Products; sets the Manufacturer field in the BOM (Bill of Materials)."
          },
          {
            "name": "sFamily",
            "technicalDefault": "---",
            "businessMeaning": "Selects the specific product family or series (e.g., 'Self-tapping screw', 'Ring nail').",
            "validRange": "List populated by XML based on Manufacturer",
            "unit": "Text",
            "affectsOutput": "Filters the available Products; defines the generic shape and article number logic."
          },
          {
            "name": "sProduct",
            "technicalDefault": "---",
            "businessMeaning": "Selects the specific screw size and model (e.g., 8x200mm) which determines physical geometry and article number.",
            "validRange": "List populated by XML based on Family",
            "unit": "Text",
            "affectsOutput": "Determines the screw length (`dLengthScrew`), diameter (`dDiameterThread`), drill diameter, and article number for BOM."
          },
          {
            "name": "sAlignment",
            "technicalDefault": "+X",
            "businessMeaning": "Specifies the face of the timber element where the screw head is placed and the direction of entry.",
            "validRange": "+X, -X, +Y, -Y, +Z, -Z",
            "unit": "Direction",
            "affectsOutput": "Rotates the coordinate system for the screw; determines which side of the beam the machining and visual representation start from."
          },
          {
            "name": "dAngle",
            "technicalDefault": 30,
            "businessMeaning": "The inclination angle of the screw relative to the distribution axis (e.g., beam length). 0 degrees is parallel to the beam axis.",
            "validRange": "0 to 90 degrees",
            "unit": "Degrees",
            "affectsOutput": "Rotates the screw geometry and drill path. Affects the effective depth and exit point."
          },
          {
            "name": "dGapNail",
            "technicalDefault": 13,
            "businessMeaning": "The offset distance from the beam surface to the screw head start point. Commonly used to account for steel plate thickness.",
            "validRange": "0 to 100 mm",
            "unit": "mm",
            "affectsOutput": "Shifts the screw model and drill start point away from the beam face."
          },
          {
            "name": "sModeDistribution",
            "technicalDefault": "Even",
            "businessMeaning": "Algorithm used to space multiple screws along the beam.",
            "validRange": "Even, Fixed",
            "unit": "Enum",
            "affectsOutput": "'Even': Divides available space by max distance. 'Fixed': Uses exact specified spacing."
          },
          {
            "name": "dDistanceBottom",
            "technicalDefault": 0,
            "businessMeaning": "Setback distance from the start of the beam/element to the first screw.",
            "validRange": "0 to Beam Length",
            "unit": "mm",
            "affectsOutput": "Moves the first screw position towards the end of the beam."
          },
          {
            "name": "dDistanceTop",
            "technicalDefault": 0,
            "businessMeaning": "Setback distance from the end of the beam/element to the last screw.",
            "validRange": "0 to Beam Length",
            "unit": "mm",
            "affectsOutput": "Moves the last screw position towards the start of the beam."
          },
          {
            "name": "dDistanceBetween",
            "technicalDefault": 500,
            "businessMeaning": "In 'Even' mode: Maximum allowed spacing. In 'Fixed' mode: The exact spacing. If negative, the absolute value is interpreted as the exact number of screws to place.",
            "validRange": "-100 (Count) to 2000 mm (Spacing)",
            "unit": "mm or Count",
            "affectsOutput": "Calculates the 'Real Distance between' and the total 'Nr.' of screws generated."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing sManufacturer",
            "effect": "Filters the list of available Families in the dropdown.",
            "cascade": [
              "sFamily",
              "sProduct"
            ]
          },
          {
            "trigger": "Changing sFamily",
            "effect": "Filters the list of available Products in the dropdown.",
            "cascade": [
              "sProduct"
            ]
          },
          {
            "trigger": "Changing sProduct",
            "effect": "Updates internal screw dimensions (Length/Diameter) and BOM Article Number.",
            "cascade": []
          },
          {
            "trigger": "Changing dDistanceBetween or sModeDistribution",
            "effect": "Recalculates the number of screws and exact spacing.",
            "cascade": [
              "nNrResult",
              "dDistanceBetweenResult"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "HardWrComp",
            "description": "Hardware component entry for the BOM (Bill of Materials) representing the specific screw product.",
            "appliedTo": "The selected GenBeam(s)"
          },
          {
            "type": "Drill",
            "description": "Machining operation (drill hole) representing the shaft of the screw penetrating the timber.",
            "appliedTo": "The selected GenBeam(s)"
          },
          {
            "type": "Body (Visual)",
            "description": "3D graphical representation of the screw (thread, head, point) for visualization in the model.",
            "appliedTo": "ModelSpace (linked to GenBeam)"
          }
        ]
      },
      "tokens_used": 9450,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization",
          "2. Load Settings & Catalog (ScrewCatalog.xml)",
          "3. [Validation] Verify Manufacturer Data Existence",
          "4. Define Properties (Manufacturer, Family, Product, Alignment, Distribution, etc.)",
          "5. Bind to Entity (GenBeam or Wall) via Selection or Name",
          "6. User Configures Properties via OPM (AutoCAD Properties Palette)",
          "7. Script Filters Families/Products based on User Selection",
          "8. Retrieve Screw Dimensions (Diameter, Length, ArticleNr) from Catalog",
          "9. Calculate Distribution Points based on Mode (Even/Fixed) and Distances",
          "10. Generate Visuals and Add Drill Tools to Beam(s)",
          "11. Create/Update Hardware Component (BOM) with Quantity",
          "12. [Optional] User executes 'generate Single Instances' Context Menu Command"
        ],
        "conditionalBranches": [
          {
            "condition": "Catalog Data Availability",
            "path1": {
              "name": "Valid Catalog",
              "steps": [
                "Load ScrewCatalog.xml",
                "Populate Manufacturer Dropdown",
                "Proceed to Entity Selection"
              ]
            },
            "path2": {
              "name": "Missing/Invalid Catalog",
              "steps": [
                "Report Error Message",
                "Erase Script Instance",
                "Exit Workflow"
              ]
            }
          },
          {
            "condition": "Number of Selected Beams",
            "path1": {
              "name": "Single Beam",
              "steps": [
                "Calculate Drill Depth based on screw length and offset",
                "Add Drill tool to primary beam"
              ]
            },
            "path2": {
              "name": "Two Beams",
              "steps": [
                "Calculate Drill Depth",
                "Add Drill tool to primary beam",
                "If screw length is sufficient, add Drill tool to secondary beam (through-drilling)"
              ]
            }
          },
          {
            "condition": "Distribution Mode Selection",
            "path1": {
              "name": "Even Mode",
              "steps": [
                "Calculate available length (Total - StartDist - EndDist)",
                "Divide by Max Distance to determine count",
                "Space screws evenly"
              ]
            },
            "path2": {
              "name": "Fixed Mode",
              "steps": [
                "Use 'Distance Between' value as exact spacing",
                "If value is negative, interpret absolute value as exact count of screws"
              ]
            }
          },
          {
            "condition": "Context Menu Command 'generate Single Instances'",
            "path1": {
              "name": "Execute Explode",
              "steps": [
                "Loop through calculated screw positions",
                "Create individual TSL script instance at each position",
                "Transfer specific properties (Angle, Offset, Product) to new instances",
                "Erase Parent Aggregate Script"
              ]
            },
            "path2": {
              "name": "Standard Recalc",
              "steps": [
                "Maintain single script instance",
                "Update geometry and hardware for the whole group"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "ScrewCatalog.xml contains Manufacturer data",
            "errorMessage": "[ScriptName]: Could not find manufacturer data. Tool will be deleted.",
            "recovery": "Ensure ScrewCatalog.xml exists in the Company or Install 'Settings' folder and contains valid 'Manufacturer' entries."
          },
          {
            "check": "Calculated distribution points fall within beam geometry",
            "errorMessage": "distribution outside the genbeam",
            "recovery": "Adjust 'Start Distance', 'End Distance', or 'Max Distance' properties so screws fit within the beam length."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry Parameters",
            "how": "OPM (Object Properties Manager)",
            "effect": "Recalculates screw positions, updates drill depths, and refreshes the BOM quantity immediately."
          },
          {
            "action": "Change Screw Specification",
            "how": "OPM Dropdowns (Manufacturer -> Family -> Product)",
            "effect": "Updates physical dimensions (diameter/length) of the drill and visual representation, and updates the Article Number in the BOM."
          },
          {
            "action": "Generate Single Instances",
            "how": "Right-click Context Menu -> generate Single Instances",
            "effect": "Replaces the single parametric script with multiple independent scripts, one for each screw position, allowing individual manipulation."
          },
          {
            "action": "Move/Rotate Script",
            "how": "Grip Edit",
            "effect": "Updates the coordinate origin and recalculates screw positions relative to the beam's local coordinate system."
          }
        ]
      },
      "tokens_used": 10742,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbFixingScrews.mcr\n\n## Overview\nAutomates the insertion of structural fixing screws or nails into timber elements (GenBeams) based on a configurable manufacturer catalog. It calculates positions for distribution, inclination, and offset, creating both the physical drill holes and the hardware BOM entries.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D beam geometry. |\n| Paper Space | No | Not intended for shop drawings or layouts. |\n| Shop Drawing | No | Geometry manipulation happens in the model. |\n\n## Prerequisites\n- **Required Entities**: At least one `GenBeam` (Timber Beam) or Wall element.\n- **Minimum Beam Count**: 1 (supports secondary beams for through-drilling).\n- **Required Settings**: `ScrewCatalog.xml` must be present in the Company or Install 'Settings' folder.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbFixingScrews.mcr`\n\n### Step 2: Select Element\n```\nCommand Line: Select Beam:\nAction: Click on the timber beam or wall element where you want to apply the screws.\n```\n\n### Step 3: Configure Properties\n```\nAction: Press Ctrl+1 to open the Properties Palette if not already visible.\nAction: Select the Manufacturer, Family, and Product from the dropdown menus.\nAction: Adjust Alignment, Angle, and Distribution settings as required.\n```\n*Note: The script will automatically update the geometry and BOM as you change properties.*\n\n## Properties Panel Parameters\n\n### Component Settings\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Manufacturer | dropdown | --- | Select the screw brand (e.g., SFS, Rothoblaas). Populated from catalog. |\n| Family | dropdown | --- | Select the product series (e.g., Self-tapping screw). Filters based on Manufacturer. |\n| Product | dropdown | --- | Select specific size/model (e.g., 8x200mm). Determines geometry and Article Number. |\n\n### Alignment Settings\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Alignment | dropdown | +X | Defines which face of the beam the screws are placed on (+X, -X, +Y, -Y, +Z, -Z). |\n| Angle | number | 30 | Inclination angle of the screw in degrees (0 is parallel to the beam axis). |\n| Offset from Plate | number | 13 | Distance from the beam face to the screw head. Use to account for steel plate thickness (mm). |\n\n### Distribution Settings\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Mode of Distribution | dropdown | Even | `Even`: Divides space by max distance. `Fixed`: Uses exact spacing. |\n| Start Distance | number | 0 | Setback distance from the start of the beam to the first screw (mm). |\n| End Distance | number | 0 | Setback distance from the end of the beam to the last screw (mm). |\n| Distance Between | number | 500 | In 'Even' mode: Max spacing. In 'Fixed' mode: Exact spacing. Negative value = Exact count of screws. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| generate Single Instances | Replaces the single parametric script with multiple independent scripts, one for each screw position. This allows for individual manipulation of screws later. |\n\n## Settings Files\n- **Filename**: `ScrewCatalog.xml`\n- **Location**: Company or Install 'Settings' folder\n- **Purpose**: Provides the hierarchical data (Manufacturer > Family > Product), including screw dimensions (diameter/length) and Article Numbers used for the BOM.\n\n## Tips\n- **Specifying Screw Count**: To place exactly 10 screws evenly, set \"Mode of Distribution\" to `Fixed` and \"Distance Between\" to `-10`.\n- **Steel Plate Connections**: Use the \"Offset from Plate\" property to shift the screw head away from the timber face, simulating the thickness of a connecting steel plate.\n- **Angle Calculation**: The \"Angle\" property rotates the screw around the distribution axis. For diagonal bracing, ensure the Alignment face corresponds to the direction of the force.\n- **Visualization**: If screws are not visible, check your 3D display settings or verify that the Product selection in the catalog has valid geometry data.\n\n## FAQ\n- **Q: Why did the script disappear immediately after insertion?**\n  A: The script could not find `ScrewCatalog.xml` or the file is empty/corrupted. Check your hsbCAD Settings folder and ensure the XML file exists and contains valid Manufacturer data.\n  \n- **Q: What does \"distribution outside the genbeam\" mean?**\n  A: The calculated screw positions fall beyond the physical length of the beam. Increase the \"Start Distance\" and \"End Distance\", or decrease the \"Distance Between\" value.\n  \n- **Q: Can I use this for through-drilling two beams?**\n  A: Yes. If you select a secondary beam (or the script detects a connected beam) and the screw length is sufficient, it will generate drill holes in both beams."
      },
      "tokens_used": 6922,
      "error": null
    }
  }
}