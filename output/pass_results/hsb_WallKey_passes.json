{
  "filename": "hsb_WallKey.mcr",
  "status": "completed",
  "total_tokens": 33044,
  "processing_time": 202.6050260066986,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "07.02.2013",
            "author": "Chirag Sawjani",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "27.11.2014",
            "author": "Chirag Sawjani",
            "changes": "Change planeprofile to pline as union/joinring failed"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5453,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "Both",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "PropString sSpace allows selection between 'paper space' and 'shopdraw multipage'. Script logic branches based on _Viewport (Paper Space) or _Entity containing ShopDrawView (Shopdrawing). Uses _kOnGenerateShopDrawing key for ViewData processing. Implements 'ms2ps' (Model Space to Paper Space) coordinate transformation."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "ShopDrawView",
            "Element",
            "ElementWall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be inserted in Paper Space (Layout) or generated within a Shopdrawing (Multipage). Requires a selection of a Viewport (Paper Space) or ShopDrawView (Shopdrawing) that is linked to a valid Element in Model Space containing ElementWall entities within the same House or Floor group.",
          "requiredSettings": []
        }
      },
      "tokens_used": 4918,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select the viewport from which the element is taken",
              "condition": "sSpace == sPaperSpace",
              "required": true
            },
            {
              "step": 1,
              "function": "getShopDrawView",
              "promptOriginal": "Select the view entity from which the module is taken",
              "condition": "sSpace == sShopdrawSpace",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Pick Bottom Left Point of Key",
              "condition": null,
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "Pick Top RIght Point of the Key",
              "condition": null,
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDrawElementInGroup",
            "type": "PropString",
            "displayName": "Draw elements in group",
            "defaultValue": "House",
            "inputType": "dropdown",
            "options": [
              "House",
              "Floor"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sSpace",
            "type": "PropString",
            "displayName": "Drawing space",
            "defaultValue": "paper space",
            "inputType": "dropdown",
            "options": [
              "paper space",
              "shopdraw multipage"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6895,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a 2D 'key plan' or location indicator in drawings to show the position of the current element within the context of the entire house or floor layout.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used by draftsmen to place a 'You are here' bird's-eye view on wall details or assembly sheets to help builders locate the specific wall module on the construction site."
        },
        "parameters": [
          {
            "name": "sSpace",
            "technicalDefault": "\"paper space\"",
            "businessMeaning": "Selects the drawing environment where the key plan is placed, determining how the script links the 2D view back to the 3D model.",
            "validRange": "paper space, shopdraw multipage",
            "unit": "Enum",
            "affectsOutput": "Switches input prompts between Viewport (Paper Space) and ShopDrawView (Shopdrawing) and changes the coordinate transformation logic used to project the model geometry."
          },
          {
            "name": "sDrawElementInGroup",
            "technicalDefault": "\"House\"",
            "businessMeaning": "Defines the scope of the surrounding walls to be drawn in the key plan, either showing the whole project or just the current floor.",
            "validRange": "House, Floor",
            "unit": "Enum",
            "affectsOutput": "Determines which walls are collected from the model structure. 'House' collects all walls in the project, 'Floor' collects only walls on the same level as the current element."
          },
          {
            "name": "_Pt0",
            "technicalDefault": "User Input",
            "businessMeaning": "The bottom-left insertion point of the key plan frame on the drawing sheet.",
            "validRange": "Anywhere on the drawing canvas",
            "unit": "Coordinates (mm)",
            "affectsOutput": "Sets the origin for the projected geometry of the key plan."
          },
          {
            "name": "_PtG",
            "technicalDefault": "User Input",
            "businessMeaning": "The top-right boundary point defining the size of the box allocated for the key plan.",
            "validRange": "Anywhere on the drawing canvas (must form rectangle with _Pt0)",
            "unit": "Coordinates (mm)",
            "affectsOutput": "Calculates the automatic scale factor required to squeeze the entire floor plan geometry into the user-defined box."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sSpace == \"paper space\"",
            "effect": "Enables Viewport selection logic and sets coordinate system based on Viewport properties.",
            "cascade": []
          },
          {
            "trigger": "sSpace == \"shopdraw multipage\"",
            "effect": "Enables ShopDrawView selection logic and retrieves ViewData/Entity mapping for shopdrawing generation.",
            "cascade": []
          },
          {
            "trigger": "sDrawElementInGroup == \"House\"",
            "effect": "Searches for ElementWall entities in the root 'House' group.",
            "cascade": []
          },
          {
            "trigger": "sDrawElementInGroup == \"Floor\"",
            "effect": "Searches for ElementWall entities in the specific 'Floor' sub-group.",
            "cascade": []
          },
          {
            "trigger": "_Pt0 and _PtG input",
            "effect": "Computes 'ms2ps' transformation matrix to scale and fit the wall outlines into the specified area.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "2D Geometry (PLine)",
            "description": "Polylines representing the outlines of all walls in the selected group (House or Floor), scaled to fit the user-defined box.",
            "appliedTo": "Paper Space or Shopdrawing Sheet"
          },
          {
            "type": "2D Symbol (Hatch)",
            "description": "A solid-hatched arrow pointing to the location of the specific element within the key plan.",
            "appliedTo": "Paper Space or Shopdrawing Sheet"
          }
        ]
      },
      "tokens_used": 5175,
      "error": null
    },
    "5": {
      "success": true,
      "data": {},
      "tokens_used": 5646,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_WallKey.mcr\n\n## Overview\nThis script creates a 2D \"key plan\" or location indicator on drawings to show the position of the current element within the context of the entire house or floor layout. It automatically projects and scales the relevant wall outlines to fit a user-defined area on the sheet.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | Reads data from Model Space, but output is placed in other contexts. |\n| Paper Space | Yes | Selects a Viewport to link the 2D key to the 3D model. |\n| Shop Drawing | Yes | Selects a ShopDrawView to generate the key within a multipage layout. |\n\n## Prerequisites\n- **Required Entities**: An existing Element in the model containing `ElementWall` entities.\n- **Minimum Beam Count**: 0\n- **Required Settings**: None\n- **Setup**: The drawing must contain a Viewport (Paper Space) or a ShopDrawView (Shopdrawing) that is linked to a valid element.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_WallKey.mcr`\n\n### Step 2: Configure Properties (Optional)\nBefore inserting, you can change the **Drawing Space** and **Draw elements in group** options in the Properties palette (Ctrl+1) if the defaults do not match your current task.\n\n### Step 3: Select Source View\nDepending on your **Drawing Space** property:\n\n*If using Paper Space:*\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click on the viewport in your layout that displays the 3D element you want to locate.\n```\n\n*If using Shopdraw Multipage:*\n```\nCommand Line: Select the view entity from which the module is taken\nAction: Click on the ShopDrawView entity associated with the element.\n```\n\n### Step 4: Define Key Plan Location\n```\nCommand Line: Pick Bottom Left Point of Key\nAction: Click on the sheet to place the bottom-left corner of the key plan frame.\n```\n\n### Step 5: Define Key Plan Size\n```\nCommand Line: Pick Top Right Point of the Key\nAction: Click to place the top-right corner of the frame. The script will automatically scale the plan to fit inside this box.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Drawing space | dropdown | paper space | Determines the working environment. Choose between \"paper space\" or \"shopdraw multipage\". |\n| Draw elements in group | dropdown | House | Sets the scope of the key plan. Choose \"House\" to show all walls, or \"Floor\" to show only walls on the current level. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are available for this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not rely on external settings files.\n\n## Tips\n- **Scaling Accuracy**: The size of your key plan is determined entirely by the box you draw in Steps 4 and 5. Draw a larger box for a more detailed view, or a smaller box for a compact indicator.\n- **Context Switching**: If you are detailing a specific wall but need to show where it sits on the entire floor plan, set **Draw elements in group** to \"Floor\". If you need to show its location within the full building project, set it to \"House\".\n\n## FAQ\n- **Q: Why did the script fail to find walls?**\n  **A:** Ensure the Viewport or ShopDrawView you selected is actually linked to a valid Element in the model that contains wall data.\n- **Q: Can I change the scale of the key plan manually?**\n  **A:** No, the scale is calculated automatically based on the two points you pick to define the frame. To change the scale, erase the key and pick the points again at a different distance.\n- **Q: What does the \"arrow\" in the drawing represent?**\n  **A:** The script generates a hatched symbol indicating the specific location of the selected element within the larger floor plan."
      },
      "tokens_used": 4957,
      "error": null
    }
  }
}