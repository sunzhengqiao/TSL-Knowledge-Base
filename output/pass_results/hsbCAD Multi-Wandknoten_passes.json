{
  "filename": "hsbCAD Multi-Wandknoten.mcr",
  "status": "completed",
  "total_tokens": 50029,
  "processing_time": 151.34341669082642,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7363,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity to select Element entities, retrieves GenBeam objects to apply Cut tools, and manipulates 3D geometry using CoordSys and Vector3d calculations. It casts entities to ElementWallSF for detail assignment. No Paper Space logic, Viewport handling, or SD prefixes are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "ElementWallSF",
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 7877,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "select two elements",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "select additional elements (optional)",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 3,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "During script insertion (_bOnInsert)",
            "title": null,
            "dataSource": "Script Properties (PropString, PropInt)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 1,
            "variable": "sDet0",
            "type": "PropString",
            "displayName": "Detail Element 1",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sDet1",
            "type": "PropString",
            "displayName": "Detail Element 2",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sDet2",
            "type": "PropString",
            "displayName": "Detail Element 3",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sDet3",
            "type": "PropString",
            "displayName": "Detail Element 4",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "171",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8143,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the configuration of timber frame wall connections (joints) by detecting geometric relationships between walls and assigning specific construction details or performing cuts.",
          "category": "Framing/Connection",
          "typicalUseCase": "Used when connecting multiple timber frame walls (e.g., at corners or T-junctions) to ensure the correct joinery details (like H-codes for intersecting walls) are applied to the elements based on their orientation and codes."
        },
        "parameters": [
          {
            "name": "sDet0",
            "technicalDefault": "\"\"",
            "businessMeaning": "Allows manual override of the construction detail code for the first primary wall (Element 0). If empty, the script generates a code automatically based on the wall codes and geometric configuration (e.g., 'W1H1BW2').",
            "validRange": "Any valid construction detail code string existing in the hsbCAD database.",
            "unit": "String",
            "affectsOutput": "Determines the sub-assemblies, machining, and material properties applied to the specified side of the first wall."
          },
          {
            "name": "sDet1",
            "technicalDefault": "\"\"",
            "businessMeaning": "Allows manual override of the construction detail code for the second primary wall (Element 1).",
            "validRange": "Any valid construction detail code string existing in the hsbCAD database.",
            "unit": "String",
            "affectsOutput": "Determines the sub-assemblies, machining, and material properties applied to the specified side of the second wall."
          },
          {
            "name": "sDet2",
            "technicalDefault": "\"\"",
            "businessMeaning": "Allows manual override of the construction detail code for a third wall (Element 2), if present, which intersects with the primary corner.",
            "validRange": "Any valid construction detail code string existing in the hsbCAD database.",
            "unit": "String",
            "affectsOutput": "Determines the sub-assemblies, machining, and material properties applied to the third wall."
          },
          {
            "name": "sDet3",
            "technicalDefault": "\"\"",
            "businessMeaning": "Allows manual override of the construction detail code for a fourth wall (Element 3), if present.",
            "validRange": "Any valid construction detail code string existing in the hsbCAD database.",
            "unit": "String",
            "affectsOutput": "Determines the sub-assemblies, machining, and material properties applied to the fourth wall."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "\"\"",
            "businessMeaning": "Selects the visual style (text size, arrows, units) for any dimensions or markers the script generates in the drawing.",
            "validRange": "List of available Dimension Styles in the current CAD project.",
            "unit": "String (Enum)",
            "affectsOutput": "Visual appearance of generated dimensions in the CAD workspace."
          },
          {
            "name": "nColor",
            "technicalDefault": "171",
            "businessMeaning": "Sets the color index for debugging vectors and lines that the script draws temporarily to visualize wall orientations and intersections.",
            "validRange": "0-255 (Standard AutoCAD Color Index).",
            "unit": "Integer",
            "affectsOutput": "Visual feedback color during script execution; does not affect physical geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sDet0, sDet1, sDet2, or sDet3 are left empty",
            "effect": "The script calculates the detail code automatically based on the Element Codes and the geometric joint type (e.g., 'H1', 'H2', 'E1M').",
            "cascade": [
              "sDet0",
              "sDet1",
              "sDet2",
              "sDet3"
            ]
          },
          {
            "trigger": "Geometric relationship between selected walls (perpendicular, parallel, offset)",
            "effect": "Determines the internal connection type (nType 0-4) which dictates the suffix of the auto-generated detail names.",
            "cascade": [
              "sDet0",
              "sDet1",
              "sDet2",
              "sDet3"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "ConstructionDetail",
            "description": "Assigns specific joinery details (e.g., 'W1H1BW2') to the left or right side of the selected wall elements (ElementWallSF).",
            "appliedTo": "Selected Wall Elements (Element 0, 1, 2, 3)."
          },
          {
            "type": "Cut",
            "description": "Applies geometric cuts to the studs (GenBeams) of the 3rd and 4th walls to resolve physical intersections with the main corner walls.",
            "appliedTo": "Internal GenBeams of Element 2 and Element 3."
          },
          {
            "type": "Visualization",
            "description": "Draws coordinate system vectors and wall outlines temporarily to assist the user in verifying the connection logic.",
            "appliedTo": "Model Space (Visual only)."
          }
        ]
      },
      "tokens_used": 9416,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Start: Initialize units (mm) and declare properties (sDet0-3, sDimStyle, nColor).",
          "Insertion Phase (_bOnInsert): Prompt user to select two primary elements.",
          "Selection Step 1: User picks 2 Elements. Script stores them in _Element[0] and _Element[1].",
          "Selection Step 2: Prompt user to select additional elements (optional).",
          "Optional Selection: If user selects, script appends them to _Element array.",
          "Configuration: Open Dialog (ShowDynamicDialog) to allow editing of properties (Detail codes, color, dimstyle).",
          "Calculation Phase (Run 2): Retrieve element geometry (CoordSys, Outline, Points).",
          "Geometric Analysis: Determine intersection points and relative angles between primary elements (El0 and El1).",
          "Type Determination: Classify connection type (0=Corner, 1=Offset Corner, 2=Miter, 3=In-line, 4=No Contact).",
          "Detail Generation (Primary): Calculate detail names (e.g., W1H1BW2) or use manual overrides (sDet0/sDet1) based on Type (0-4) and side (Left/Right).",
          "Secondary Element Check: Verify if Element 2 exists.",
          "Secondary Processing (El 2): Determine contact with El0/El1, create Cuts on GenBeams to resolve intersections, assign Detail (sDet2).",
          "Tertiary Element Check: Verify if Element 3 exists.",
          "Tertiary Processing (El 3): Determine contact with El0/El1, create Cuts on GenBeams to resolve intersections, assign Detail (sDet3).",
          "Finalization: Apply calculated or manual details to the Left or Right side of all Elements based on 'bIsLeft' orientation.",
          "Script End: Draw visualization vectors and exit."
        ],
        "conditionalBranches": [
          {
            "condition": "User interaction during initial selection",
            "path1": {
              "name": "Minimum Selection",
              "steps": [
                "Select exactly 2 elements.",
                "Skip optional selection.",
                "Proceed to Dialog."
              ]
            },
            "path2": {
              "name": "Extended Selection",
              "steps": [
                "Select 2 elements.",
                "Select additional elements (3rd, 4th, etc.).",
                "Proceed to Dialog."
              ]
            }
          },
          {
            "condition": "Connection Type between Element 0 and Element 1",
            "path1": {
              "name": "Type 0 (Perpendicular Corner)",
              "steps": [
                "Analyze vector directions (bNY, bGU).",
                "Generate H-codes (H1, H2, H3, H4).",
                "Assign details (sCode + Hx + 'B'/'A' + sCode)."
              ]
            },
            "path2": {
              "name": "Type 3 (Parallel/In-line)",
              "steps": [
                "Draw dimension line between contacts.",
                "Generate E1M/E1P codes.",
                "Assign details (sCode + 'E1M' / 'E1P')."
              ]
            },
            "path3": {
              "name": "Types 1, 2, 4 (Offset/Miter/No Contact)",
              "steps": [
                "Skip complex orientation logic.",
                "Generate default 'O0' code.",
                "Assign details (sCode + 'O0')."
              ]
            }
          },
          {
            "condition": "Detail Property Usage",
            "path1": {
              "name": "Automatic Calculation",
              "steps": [
                "Check if sDetX is empty.",
                "Build string from Element Codes and calculated Geometry."
              ]
            },
            "path2": {
              "name": "Manual Override",
              "steps": [
                "Check if sDetX is not empty.",
                "Use the string provided in property sDetX."
              ]
            }
          },
          {
            "condition": "Processing of Secondary Walls (Element 2 and 3)",
            "path1": {
              "name": "Contact Found",
              "steps": [
                "Calculate intersection plane.",
                "Create Cut tool at contact point.",
                "Apply Cut to all GenBeams of the wall."
              ]
            },
            "path2": {
              "name": "No Contact",
              "steps": [
                "Assign Detail code (O0).",
                "Skip Cut generation.",
                "Output debug notice if enabled."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element count (minimum 2)",
            "errorMessage": "Silent return (Script exits).",
            "recovery": "Re-insert script and select at least 2 valid elements."
          },
          {
            "check": "Element Type",
            "errorMessage": "Silent return (Script exits).",
            "recovery": "Ensure selected elements can be cast to 'ElementWallSF'."
          },
          {
            "check": "Color Index Range",
            "errorMessage": "Silent correction (Property resets to 171).",
            "recovery": "N/A (Automatic)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Detail Codes",
            "how": "OPM Properties (sDet0, sDet1, sDet2, sDet3)",
            "effect": "Updates the construction detail applied to the specific element sides without changing geometry calculations."
          },
          {
            "action": "Change Visual Settings",
            "how": "OPM Properties (sDimStyle, nColor)",
            "effect": "Updates dimension style or debug vector colors upon next recalculation."
          },
          {
            "action": "Regenerate Geometry",
            "how": "Update command / Context menu (implied by TSL behavior)",
            "effect": "Re-runs geometric analysis and cuts if wall positions changed."
          }
        ]
      },
      "tokens_used": 10677,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCAD Multi-Wandknoten\n\n## Overview\nThis script automates the configuration of timber frame wall connections (joints) by detecting geometric relationships between walls and assigning specific construction details or performing cuts. It allows for the connection of up to four walls, automatically calculating joinery codes based on wall positions or allowing manual overrides.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D Elements and GenBeams. |\n| Paper Space | No | Not designed for 2D layout or Shop Drawing views. |\n| Shop Drawing | No | Does not generate shop drawings directly. |\n\n## Prerequisites\n- **Required Entities**: At least 2 Elements (typically Timber Frame Walls).\n- **Minimum beam count**: 2 Elements (supports up to 4).\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCAD Multi-Wandknoten.mcr`\n\n### Step 2: Select Primary Elements\n```\nCommand Line: select two elements\nAction: Click on the two main walls that form the primary connection (e.g., the corner or T-junction).\n```\n\n### Step 3: Select Additional Elements (Optional)\n```\nCommand Line: select additional elements (optional)\nAction: If additional walls intersect this group (e.g., a stub wall or fourth side), select them now. Press Enter to finish selection if no more walls are needed.\n```\n\n### Step 4: Configure Properties\n```\nAction: A dynamic dialog appears. Verify or modify the Detail codes (sDet0-3) or visual settings. Click OK to apply.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Detail Element 1 (sDet0) | Text | \"\" | Manual override for the construction detail code on the first primary wall. Leave empty to let the script auto-calculate based on geometry. |\n| Detail Element 2 (sDet1) | Text | \"\" | Manual override for the construction detail code on the second primary wall. Leave empty to let the script auto-calculate. |\n| Detail Element 3 (sDet2) | Text | \"\" | Manual override for the construction detail code on the third wall (if selected). |\n| Detail Element 4 (sDet3) | Text | \"\" | Manual override for the construction detail code on the fourth wall (if selected). |\n| Dimstyle (sDimStyle) | Dropdown | \"_DimStyles\" | Selects the visual style for dimensions or markers generated by the script. |\n| Color (nColor) | Number | 171 | Sets the color index for debugging vectors and lines drawn by the script. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (Standard TSL Menu) | Standard options like Update or Properties are available via the TSL entity context menu. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on internal logic and Element codes; no external settings file is required.\n\n## Tips\n- **Automatic Calculation**: If you leave the \"Detail Element\" properties empty, the script analyzes the wall angles (Corner, T-junction, Parallel) to generate the correct H-code (e.g., W1H1BW2).\n- **Manual Override**: If the automatic calculation doesn't match your specific construction method, simply type the correct detail code into the `sDet` properties in the palette.\n- **Visualizing Geometry**: The script draws temporary vectors in the color specified by `nColor` (default 171) to help you visualize how it is interpreting the wall directions and intersections.\n\n## FAQ\n- **Q: The script didn't cut the studs in my third wall.**\n  A: Ensure the third wall was selected during the \"select additional elements\" prompt. The script only applies geometric cuts to the 3rd and 4th elements if they are physically selected during insertion.\n  \n- **Q: How do I change the detail after the script is already inserted?**\n  A: Select the script instance in the model, open the Properties palette (Ctrl+1), and modify the `sDet` values. Run an Update or recalculation to apply changes.\n\n- **Q: What does the Color property do?**\n  A: It controls the color of the helper lines the script draws to show you the intersection points. It does not change the color of your actual wood or beams."
      },
      "tokens_used": 6553,
      "error": null
    }
  }
}