{
  "filename": "hsb_Inv-AssignSheetItemToArea.mcr",
  "status": "completed",
  "total_tokens": 32064,
  "processing_time": 582.7246141433716,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "08.09.2015",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3861,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses generic entity selection (getEntPLine) and Display without 'sd_' prefix, '_Viewport' checks, or '#Type E' declarations. Defaults to Model Space behavior."
        },
        "prerequisites": {
          "requiredEntities": [
            "EntPLine"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Current active space (Polylines must exist)",
          "requiredSettings": [
            "hsbLooseMaterialsUI.dll",
            "Inventory Database with Sheet items"
          ]
        }
      },
      "tokens_used": 3620,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getEntPLine",
              "promptOriginal": "Select main poliline",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select opening polilines or ENTER to ignore",
              "condition": "_bOnInsert",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sItem",
            "type": "PropString",
            "displayName": "Choose Sheet for this area",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "Dynamic list from Inventory Database (Sheet items)"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "Current Drawing Dimension Styles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Text Color",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dArea",
            "type": "PropDouble",
            "displayName": "Area:",
            "defaultValue": "0",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Read-only property displaying total area"
          },
          {
            "index": 1,
            "variable": "dNetArea",
            "type": "PropDouble",
            "displayName": "Net Area:",
            "defaultValue": "0",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Read-only property displaying net area (minus openings)"
          },
          {
            "index": 2,
            "variable": "dPerimeter",
            "type": "PropDouble",
            "displayName": "Perimeter:",
            "defaultValue": "0",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Read-only property displaying perimeter length"
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "hsbLooseMaterialsUI.dll",
            "searchPaths": [
              "%hsbInstall%\\Utilities\\hsbLooseMaterials\\"
            ],
            "purpose": "Connects to the Inventory database to retrieve the list of available Sheet items",
            "required": true
          }
        ]
      },
      "tokens_used": 5768,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Assigns a specific sheet material (e.g., plywood, OSB) from an inventory database to a user-defined area, calculating required quantities (gross/net area) for material takeoffs.",
          "category": "Inventory / MaterialTakeoff",
          "typicalUseCase": "Estimating the amount of sheathing or boarding needed for a wall or floor section defined by polylines, subtracting openings for doors or windows."
        },
        "parameters": [
          {
            "name": "sItem",
            "technicalDefault": "",
            "businessMeaning": "The specific material stock code or description selected from the inventory database to be applied to this area.",
            "validRange": "Any valid 'Sheet' item defined in the hsbLooseMaterials database.",
            "unit": "Text",
            "affectsOutput": "Updates the visual label text and the data map sent to external lists/reports."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "The drafting standard used to define the font, size, and appearance of the area label in the drawing.",
            "validRange": "Any Dimension Style currently loaded in the drawing.",
            "unit": "Text",
            "affectsOutput": "Visual style of the text label displaying the sheet item."
          },
          {
            "name": "nColor",
            "technicalDefault": "-1",
            "businessMeaning": "The display color of the text label.",
            "validRange": "AutoCAD Color Index (0-255) or -1 (ByLayer).",
            "unit": "Index",
            "affectsOutput": "Visual color of the text label."
          },
          {
            "name": "dArea",
            "technicalDefault": "0",
            "businessMeaning": "The total gross area of the selected boundary polyline, representing the total surface coverage before deductions.",
            "validRange": "Greater than 0",
            "unit": "Area (e.g., m² or ft²)",
            "affectsOutput": "Read-only data field; updates the internal data map for reporting."
          },
          {
            "name": "dNetArea",
            "technicalDefault": "0",
            "businessMeaning": "The usable area of the sheet material, calculated as the Gross Area minus the area of any opening polylines selected.",
            "validRange": "Greater than or equal to 0",
            "unit": "Area (e.g., m² or ft²)",
            "affectsOutput": "Read-only data field; crucial for accurate material cost estimation."
          },
          {
            "name": "dPerimeter",
            "technicalDefault": "0",
            "businessMeaning": "The total length of the outer boundary polyline, often used for edge trimming or banding calculations.",
            "validRange": "Greater than 0",
            "unit": "Length (e.g., m or ft)",
            "affectsOutput": "Read-only data field; updates the internal data map."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Selection of Main Polyline (Entity[0])",
            "effect": "Calculates geometric properties based on the enclosed shape.",
            "cascade": [
              "dArea",
              "dPerimeter",
              "dNetArea",
              "_Pt0 (Label Position)"
            ]
          },
          {
            "trigger": "Selection of Opening Polylines (Entity[1..n])",
            "effect": "Subtracts the area of openings from the main area.",
            "cascade": [
              "dNetArea"
            ]
          },
          {
            "trigger": "Change of sItem",
            "effect": "Updates the internal Map structure with the new selected Item ID and Description.",
            "cascade": [
              "_Map",
              "Display Text"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TextLabel (Display)",
            "description": "A text element drawn at the centroid of the main polyline displaying the name of the selected sheet item.",
            "appliedTo": "Model Space (at the calculated centroid of the selected polylines)"
          },
          {
            "type": "Data Map (_Map)",
            "description": "Invisible data object containing the selected Inventory Item details and calculated geometric properties (Area, Net Area, Perimeter) for export to production lists or Excel.",
            "appliedTo": "Internal Script Instance / hsbData Export"
          }
        ]
      },
      "tokens_used": 5460,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Define path to hsbLooseMaterialsUI.dll.",
          "2. Prerequisite Check: Verify existence of the DLL file.",
          "3. Database Query: Call .NET function 'GetItems' to retrieve 'Sheet' items from the Inventory database.",
          "4. Data Validation: Check if the database returned any Sheet items.",
          "5. Property Initialization: Populate OPM properties (Item list, Dimension styles, Geometry fields).",
          "6. [Insertion Mode] Execute Key Check: If run directly, show the initial properties dialog.",
          "7. [Insertion Mode] Input 1: Prompt user to select a Main Boundary Polyline.",
          "8. [Insertion Mode] Input 2: Prompt user to select Opening Polylines (or press Enter to skip).",
          "9. [Calculation Mode] Dependency Setup: Link script lifecycle to the selected polylines.",
          "10. Geometry Processing: Calculate Gross Area and Perimeter of the main polyline.",
          "11. Area Subtraction: Join opening polylines as holes to calculate Net Area.",
          "12. Positioning: Calculate the centroid (average of vertices) of the main polyline for label placement.",
          "13. Data Mapping: Find the selected Item ID and construct the _Map with geometric data.",
          "14. Visualization: Draw the text label (Item name) at the calculated centroid."
        ],
        "conditionalBranches": [
          {
            "condition": "DLL File Found",
            "path1": {
              "name": "Proceed",
              "steps": [
                "Connect to database",
                "Fetch items"
              ]
            },
            "path2": {
              "name": "Abort",
              "steps": [
                "Report notice: 'dll not found'",
                "Erase script instance",
                "Stop execution"
              ]
            }
          },
          {
            "condition": "Inventory Items Available",
            "path1": {
              "name": "Proceed",
              "steps": [
                "Populate dropdown list",
                "Continue to insertion prompts"
              ]
            },
            "path2": {
              "name": "Abort",
              "steps": [
                "Report notice: 'No Sheet items available'",
                "Erase script instance",
                "Stop execution"
              ]
            }
          },
          {
            "condition": "Insertion Cycle Status",
            "path1": {
              "name": "First Cycle (insertCycleCount <= 1)",
              "steps": [
                "Show dialog",
                "Execute Entity Prompts (Main Polyline + Openings)"
              ]
            },
            "path2": {
              "name": "Subsequent Cycle",
              "steps": [
                "Erase instance (prevent duplication)",
                "Stop execution"
              ]
            }
          },
          {
            "condition": "Opening Polyline Selection",
            "path1": {
              "name": "Openings Selected",
              "steps": [
                "Append entities to array",
                "Subtract opening area from Net Area"
              ]
            },
            "path2": {
              "name": "ENTER Pressed (Ignore)",
              "steps": [
                "Skip opening collection",
                "Net Area equals Gross Area"
              ]
            }
          },
          {
            "condition": "Entity Existence on Recalc",
            "path1": {
              "name": "Entities Found",
              "steps": [
                "Re-calculate geometry",
                "Update label position"
              ]
            },
            "path2": {
              "name": "Entities Missing",
              "steps": [
                "Erase instance",
                "Stop execution"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "File existence check for %hsbInstall%\\Utilities\\hsbLooseMaterials\\hsbLooseMaterialsUI.dll",
            "errorMessage": "dll not found, please contact you local support team",
            "recovery": "Ensure hsbCAD is installed correctly and the Utilities module is present."
          },
          {
            "check": "Database content for 'Sheet' items (MinorGroupName='Sheet')",
            "errorMessage": "No Sheet items available in database, please check your Inventory",
            "recovery": "Add Sheet items to the hsbLooseMaterials Inventory database."
          },
          {
            "check": "User selection of Main Polyline",
            "errorMessage": "Implicit failure (Script waits for input or erases if invalid)",
            "recovery": "User must select a valid closed PLine."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Assigned Item",
            "how": "OPM Property 'Choose Sheet for this area'",
            "effect": "Updates the internal Data Map with the new Item ID and changes the Display Text label."
          },
          {
            "action": "Modify Geometry (Stretch/Move Polyline)",
            "how": "AutoCAD Grip Edits on the polylines",
            "effect": "Triggers a recalculation; updates Area, Net Area, Perimeter, Centroid position, and moves the Text Label to the new center."
          },
          {
            "action": "Change Visual Style",
            "how": "OPM Properties 'Dimension style' or 'Text Color'",
            "effect": "Updates the font/size or color of the displayed label immediately."
          }
        ]
      },
      "tokens_used": 7034,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_Inv-AssignSheetItemToArea.mcr\n\n## Overview\nThis script assigns a specific sheet material (e.g., plywood or OSB) from your inventory database to an area defined by polylines. It automatically calculates the gross and net area (accounting for openings) for material estimation and places a label in the drawing.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script is designed to run in the 3D model or 2D layout. |\n| Paper Space | No | Not supported for layout viewports. |\n| Shop Drawing | No | Not intended for generation of shop drawings. |\n\n## Prerequisites\n- **Required Entities**: At least one closed Polyline representing the main boundary. Optional Polylines representing openings (holes).\n- **Required Settings**: `hsbLooseMaterialsUI.dll` must be installed. The Inventory database must contain items classified as \"Sheet\" (MinorGroupName='Sheet').\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsb_Inv-AssignSheetItemToArea.mcr`\n\n### Step 2: Select Boundary\n```\nCommand Line: Select main poliline\nAction: Click the closed polyline that defines the outer edge of the sheet area (e.g., the wall face).\n```\n\n### Step 3: Select Openings\n```\nCommand Line: Select opening polilines or ENTER to ignore\nAction: Select polylines that represent holes or windows within the boundary. \nNote: Press ENTER if there are no openings.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Choose Sheet for this area | dropdown | (Dynamic) | Select the material stock code (e.g., \"OSB 18mm\") from your Inventory database. |\n| Dimension style | dropdown | (Current) | Select the dimension style to control the font and size of the label text. |\n| Text Color | number | -1 | Set the color of the label text. (-1 = ByLayer). |\n| Area: | text (Read-only) | 0 | Displays the total gross surface area of the boundary. |\n| Net Area: | text (Read-only) | 0 | Displays the usable area (Gross Area minus openings). |\n| Perimeter: | text (Read-only) | 0 | Displays the total length of the outer boundary. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the area and label position if the source polylines have been modified. |\n\n## Settings Files\n- **Filename**: `hsbLooseMaterialsUI.dll`\n- **Location**: `%hsbInstall%\\Utilities\\hsbLooseMaterials\\`\n- **Purpose**: Required to connect to the Inventory database and retrieve the list of available Sheet items.\n\n## Tips\n- **Automatic Updates**: If you stretch or move the main boundary polyline using AutoCAD grips, the script will automatically recalculate the Area, Perimeter, and move the label to the new centroid.\n- **Visual Consistency**: Set the \"Text Color\" to -1 so the label adopts the color of the layer it is placed on, making layer management easier.\n- **Inventory Setup**: If the script fails to load, check your hsbLooseMaterials settings to ensure you have items defined with the Group \"Sheet\".\n\n## FAQ\n- **Q: Why does the script say \"No Sheet items available\"?**\n  **A:** The script cannot find any items in your Inventory database categorized as \"Sheet\". You need to add materials to your Inventory database and assign them to the \"Sheet\" group.\n- **Q: Can I change the assigned material after inserting?**\n  **A:** Yes. Select the script instance in the drawing, open the Properties palette (Ctrl+1), and choose a different item from the \"Choose Sheet for this area\" dropdown.\n- **Q: What is the difference between Area and Net Area?**\n  **A:** \"Area\" is the total size of the boundary you selected. \"Net Area\" is the Area minus the size of any opening polylines you selected in Step 3. Use Net Area for estimating actual material usage."
      },
      "tokens_used": 6321,
      "error": null
    }
  }
}