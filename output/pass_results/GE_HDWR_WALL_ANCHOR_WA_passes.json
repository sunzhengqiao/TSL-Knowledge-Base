{
  "filename": "GE_HDWR_WALL_ANCHOR_WA.mcr",
  "status": "completed",
  "total_tokens": 33984,
  "processing_time": 1385.9455592632294,
  "passes": {
    "1": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "Request timeout after retries"
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates 3D geometry using PLine and Body objects (bdPlate, bdDrilled) and draws them to Display dp. Uses interactive PrEntity to select Beams and getPoint for reference location. No 'sd_' API calls, _Viewport usage, or ShopDrawing #Type definitions found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space (requires interactive insertion point and beam selection)",
          "requiredSettings": [
            "\\TSL\\Catalog\\TSL_HARDWARE_FAMILY_LIST.dxx",
            "\\Utilities\\TslCustomSettings\\TSL_Read_Metalpart_Family_Props.dll",
            "Anchor sub-scripts (e.g., GE_HDWR_ANCHOR_J-BOLT.mcr)",
            "Family catalog TXT files for 'WA' family"
          ]
        }
      },
      "tokens_used": 5020,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Select stud(s)\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"\\nSelect reference point: hangers will be inserted at closest end and closer face of members\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"SelectFromList\",\n      \"trigger\": \"On Insert (_bOnInsert) or Context Menu 'Change type'\",\n      \"title\": null,\n      \"dataSource\": \"TSL_Read_Metalpart_Family_Props.dll via TSL_HARDWARE_FAMILY_LIST.dxx\",\n      \"features\": {\n        \"searchable\": true,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Type\",\n      \"defaultValue\": \"WA\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"dClearWidth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Clear width\",\n      \"defaultValue\": \"U(70,2.625)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dOverallDepth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Overall depth\",\n      \"defaultValue\": \"U(560,22)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dOverallHeight\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Overall height\",\n      \"defaultValue\": \"U(50,2)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    }\n  ],\n  \"contextMenu\": [\n    {\n      \"menuItem\": \"Change type\",\n      \"handler\": \"sChangeType\",\n      \"action\": \"Re-invokes the catalog selection dialog to change the hardware type\",\n      \"alsoTriggeredBy\": null\n    },\n    {\n      \"menuItem\": \"Help\",\n      \"handler\": \"sHelp\",\n      \"action\": \"Displays a usage message via reportNotice\",\n      \"alsoTriggeredBy\": null\n    }\n  ],\n  \"settingsFiles\": [\n    {\n      \"filename\": \"TSL_HARDWARE_FAMILY_LIST.dxx\",\n      \"searchPaths\": [\n        \"_kPathHsbCompany\\\\TSL\\\\Catalog\\\\\"\n      ],\n      \"purpose\": \"Master catalog list defining available hardware families\",\n      \"required\": true\n    },\n    {\n      \"filename\": \"TSL"
      },
      "tokens_used": 8030,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 8428,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script: User starts GE_HDWR_WALL_ANCHOR_WA.mcr.",
          "2. Check Context: Script determines execution mode: Insert (_bOnInsert), Recalc (_bOnRecalc), or Context Menu Trigger (_kExecuteKey).",
          "3. Catalog Interaction (Insert or Change Type):",
          "   - Initializes Map with Family Name 'WA' and Catalog path.",
          "   - Calls DotNet function (TSL_Read_Metalpart_Family_Props.dll) to fetch hardware data.",
          "   - Displays selection dialog to user.",
          "   - If user cancels or selection is empty on Insert, script erases instance and exits.",
          "   - Updates internal _Map with selected properties (Type, Dimensions, Anchor details).",
          "4. Entity Selection (Insert Only):",
          "   - Prompts 'Select stud(s)' using PrEntity.",
          "   - Validates selection: if _Beam.length() == 0, instance is erased.",
          "5. Reference Point Selection (Insert Only):",
          "   - Prompts 'Select reference point' using getPoint.",
          "   - Analyzes selected beams to find the closest vertical beam to the reference point.",
          "   - Determines directional vectors based on this closest beam.",
          "6. Instance Generation (Insert Only):",
          "   - Iterates through all valid vertical beams found.",
          "   - Calculates local insertion point for each beam (closest end to reference point).",
          "   - Executes dbCreate for each beam to spawn a separate instance of the script.",
          "   - Passes the catalog Map to new instances.",
          "   - Erases the original 'Master' instance.",
          "7. Instance Initialization (Recalc/Spawned):",
          "   - Retrieves beam reference (if missing/invalid, erases instance).",
          "   - Updates OPM properties (sType, dClearWidth, etc.) from _Map.",
          "8. Positioning Logic:",
          "   - Recalculates local coordinate system (vx, vy, vz) based on beam center and original insertion point.",
          "   - Snaps _Pt0 to the closest face and end of the beam.",
          "9. Geometry Generation:",
          "   - Draws Base Plate (PLine + extrude).",
          "   - Draws Drilled Plate (PLine + extrude).",
          "   - Subtracts drill hole (Cylinder body).",
          "10. Anchor Insertion:",
          "   - Checks _Map for 'InsertedAnchor' flag.",
          "   - Determines Anchor Model (J-Bolt, Adhesive, Screw, Embedded).",
          "   - Constructs coordinate map for anchor.",
          "   - Calls dbCreate for specific anchor sub-script (e.g., GE_HDWR_ANCHOR_J-BOLT).",
          "11. Finalize: Drawing completes; object is visible in 3D model."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Phase",
            "path1": {
              "name": "Initial Insertion",
              "steps": [
                "Load Catalog (DotNet).",
                "Select Studs (PrEntity).",
                "Select Reference Point (getPoint).",
                "Loop & Spawn Instances.",
                "Erase Master."
              ]
            },
            "path2": {
              "name": "Recalc or Update",
              "steps": [
                "Use existing _Map data.",
                "Skip user prompts.",
                "Re-draw geometry based on current beam location."
              ]
            }
          },
          {
            "condition": "Anchor Model Definition",
            "path1": {
              "name": "J-Bolt",
              "steps": [
                "ScriptName = 'GE_HDWR_ANCHOR_J-BOLT'",
                "Insert Anchor."
              ]
            },
            "path2": {
              "name": "Adhesive Anchor",
              "steps": [
                "ScriptName = 'GE_HDWR_ANCHOR_ADHESIVE'",
                "Insert Anchor."
              ]
            },
            "path3": {
              "name": "Screw/Embedded",
              "steps": [
                "ScriptName = 'GE_HDWR_ANCHOR_SCREW' or 'GE_HDWR_ANCHOR_EMBEDDED'",
                "Insert Anchor."
              ]
            },
            "path4": {
              "name": "None/Undefined",
              "steps": [
                "Skip anchor insertion logic."
              ]
            }
          },
          {
            "condition": "Beam Selection Filter",
            "path1": {
              "name": "Vertical Beams",
              "steps": [
                "Included in processing loop.",
                "Used to calculate insertion geometry."
              ]
            },
            "path2": {
              "name": "Non-Vertical Beams",
              "steps": [
                "Ignored during loop.",
                "Only vertical beams (parallel to Z) trigger instance creation."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Catalog Selection",
            "errorMessage": "(None explicit, code erases instance).",
            "recovery": "User must select a valid entry from the catalog dialog."
          },
          {
            "check": "Beam Selection Count",
            "errorMessage": "(None explicit, code erases instance).",
            "recovery": "User must select at least one beam when prompted."
          },
          {
            "check": "Beam Validity",
            "errorMessage": "(None explicit, code erases instance).",
            "recovery": "Ensure the beam associated with the connector still exists in the model."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Grip Edit (Move)",
            "how": "Click and drag the insertion point grip.",
            "effect": "The script recalculates the position relative to the closest end and face of the attached beam, effectively 'snapping' the hardware along the beam's surface."
          },
          {
            "action": "Change Hardware Type",
            "how": "Right-click -> 'Change type'.",
            "effect": "Reopens the catalog dialog, allowing the user to switch the hardware family or size, triggering a redraw."
          },
          {
            "action": "View Help",
            "how": "Right-click -> 'Help'.",
            "effect": "Displays a reportNotice with usage instructions."
          },
          {
            "action": "Beam Deletion",
            "how": "Delete the host beam.",
            "effect": "The script detects element deletion (_bOnElementDeleted) and erases the hardware instance."
          }
        ]
      },
      "tokens_used": 6969,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_WALL_ANCHOR_WA.mcr\n\n## Overview\nThis script inserts Wall Anchor (WA) hardware onto vertical timber studs. It allows you to select a hardware configuration from a catalog, automatically generates the required plate geometry and drill holes, and attaches the appropriate anchor bolts based on the selected type.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | 3D insertion only. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: GenBeam (Vertical studs).\n- **Minimum Beam Count**: 1.\n- **Required Settings**:\n  - `\\TSL\\Catalog\\TSL_HARDWARE_FAMILY_LIST.dxx` (Master catalog list).\n  - `TSL_Read_Metalpart_Family_Props.dll` (Required for reading catalog data).\n  - Family catalog TXT files for the 'WA' family.\n  - Anchor sub-scripts (e.g., GE_HDWR_ANCHOR_J-BOLT.mcr).\n\n## Usage Steps\n\n### Step 1: Launch Script\nRun the command `TSLINSERT` and select `GE_HDWR_WALL_ANCHOR_WA.mcr`.\n\n### Step 2: Select Hardware Type\n```\nDialog: Wall Anchor Selection\nAction: A dialog box appears automatically. Search or select the specific Wall Anchor configuration (e.g., dimensions and load capacity) from the list and click OK.\n```\n\n### Step 3: Select Studs\n```\nCommand Line: Select stud(s)\nAction: Click on the vertical timber beams (studs) in the model where you want to install the anchors. Press Enter to confirm selection.\n```\n\n### Step 4: Select Reference Point\n```\nCommand Line: Select reference point: hangers will be inserted at closest end and closer face of members\nAction: Click in the drawing area near the selected studs. The script will calculate the position based on this point relative to the beams.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | Text | WA | The hardware family or type identifier. |\n| Clear width | Number | 70 (2.625\") | The clear opening width of the hardware. |\n| Overall depth | Number | 560 (22\") | The total length/depth of the anchor plate. |\n| Overall height | Number | 50 (2\") | The vertical height/thickness of the plate. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change type | Re-opens the hardware catalog dialog, allowing you to swap the current anchor for a different size or configuration. |\n| Help | Displays a brief usage message on the command line. |\n\n## Settings Files\n- **Filename**: `TSL_HARDWARE_FAMILY_LIST.dxx`\n  - **Location**: `_kPathHsbCompany\\TSL\\Catalog\\`\n  - **Purpose**: Defines the list of available hardware families (ensures 'WA' is available).\n\n- **Filename**: `TSL_Read_Metalpart_Family_Props.dll`\n  - **Location**: hsbCAD Utilities folder\n  - **Purpose**: Handles the logic to read specific dimensions and properties from the catalog text files.\n\n- **Filename**: `*.txt` (Family Catalogs)\n  - **Location**: `_kPathHsbCompany\\TSL\\Catalog\\`\n  - **Purpose**: Contains the specific geometric data (drill patterns, plate sizes) for the selected Wall Anchor.\n\n## Tips\n- **Vertical Beams Only**: The script automatically filters and only processes beams that are vertical (parallel to the Z-axis). Horizontal beams selected in Step 3 will be ignored.\n- **Positioning**: The \"Reference Point\" determines which end of the stud the anchor attaches to. Click closer to the top or bottom of the stud to control placement.\n- **Modification**: You can move the anchor by dragging its grip point. It will automatically snap to the nearest face of the beam.\n- **Beam Deletion**: If you delete the host stud, the anchor hardware will also be automatically removed.\n\n## FAQ\n- **Q: Why didn't the anchor appear on my selected beam?**\n  **A**: Ensure the beam is strictly vertical. This script is designed for wall studs and ignores horizontal or inclined members.\n- **Q: Can I change the anchor size after inserting it?**\n  **A**: Yes. Select the anchor, right-click, and choose \"Change type\" to select a different model from the catalog, or manually edit the dimension properties in the Properties Palette if not locked by the catalog.\n- **Q: What happens if I select multiple studs?**\n  **A**: The script will insert an instance of the anchor on each valid vertical stud selected, positioning them individually based on their geometry relative to your reference point."
      },
      "tokens_used": 5537,
      "error": null
    }
  }
}