{
  "filename": "sdUK_SIPShowEdgeDirections.mcr",
  "status": "completed",
  "total_tokens": 29878,
  "processing_time": 289.4164938926697,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.2",
            "date": "21.01.2021",
            "author": null,
            "changes": "HSB-10404 accepts alos panels which are not linked to an element"
          },
          {
            "version": "1.0",
            "date": "13.07.2012",
            "author": "Chirag Sawjani",
            "changes": "Release"
          },
          {
            "version": "1.1",
            "date": "11.06.2015",
            "author": "Chirag Sawjani",
            "changes": "Modified coordsys due to change in Sip coordsys from 19.1.104"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5112,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": false,
          "detectionEvidence": "Filename prefix 'sd_', explicit check of '_Entity[]' with comment 'when the shopdraw engine calls this Tsl', casting to 'Sip' class, and use of 'addDimRequest' for creating annotations in generated views."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Must be assigned to a Sip in a ShopDrawing style",
          "requiredSettings": []
        }
      },
      "tokens_used": 4506,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4192,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 6868,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution begins",
          "Attempt to assign Sip object from _Sip[0] array",
          "Check if Sip is invalid; if so, attempt fallback to _Entity[0] cast to Sip",
          "Validate if a valid Sip object was obtained",
          "If validation fails, report error and erase instance",
          "Extract geometric data from valid Sip (Vectors X/Y/Z, Center, Height, Openings)",
          "Check if Sip belongs to a valid Element and extract Element vectors if true",
          "Iterate through 3 predefined viewing directions",
          "Construct coordinate system for the current view (vecXView, vecYView, vecZView)",
          "Check if the view is 'Normal' (vecZView is parallel to Sip Z vector)",
          "If Normal: Retrieve all SipEdges associated with the Sip",
          "Iterate through each SipEdge",
          "Calculate edge geometry (Midpoint, Normal, Vertex vector)",
          "Calculate Bevel Angle relative to the Sip surface normal",
          "Determine text offset distance based on Bevel Angle and Recess Depth",
          "Create a shadow profile of the Sip body on the view plane",
          "Check if the calculated leader point lies inside the Sip profile",
          "Adjust leader point direction if outside profile",
          "Create and add DimRequestText for Edge Label (e.g., 'E1')",
          "Create and add PLine geometry for a directional arrow marker",
          "Proceed to next edge or next view upon completion",
          "Script finishes (generates annotations for shop drawing views)"
        ],
        "conditionalBranches": [
          {
            "condition": "Sip Object Source",
            "path1": {
              "name": "Found in _Sip array",
              "steps": [
                "Assign sip = _Sip[0]",
                "Proceed to validation"
              ]
            },
            "path2": {
              "name": "Found in _Entity array (ShopDraw context)",
              "steps": [
                "Assign sip = (Sip)_Entity[0]",
                "Proceed to validation"
              ]
            }
          },
          {
            "condition": "Sip Validation",
            "path1": {
              "name": "Valid Sip",
              "steps": [
                "Extract geometry",
                "Execute loop logic"
              ]
            },
            "path2": {
              "name": "Invalid Sip",
              "steps": [
                "Display error message: 'No Sip found. Instance erased.'",
                "Execute eraseInstance()",
                "Return (stop script)"
              ]
            }
          },
          {
            "condition": "Element Linkage",
            "path1": {
              "name": "Element is Valid",
              "steps": [
                "Calculate Element coordinate vectors",
                "Store in local variables (Note: not actively used in subsequent logic in this snippet)"
              ]
            },
            "path2": {
              "name": "Element is Invalid",
              "steps": [
                "Skip Element vector extraction",
                "Continue using Sip coordinates"
              ]
            }
          },
          {
            "condition": "View Type Check (bIsNormal)",
            "path1": {
              "name": "View is Normal (Parallel to Z)",
              "steps": [
                "Process Edges",
                "Generate dimensions and arrows"
              ]
            },
            "path2": {
              "name": "View is not Normal",
              "steps": [
                "Skip annotation generation",
                "Continue to next view iteration"
              ]
            }
          },
          {
            "condition": "Bevel Angle Calculation",
            "path1": {
              "name": "Angle > 90 and <= 180",
              "steps": [
                "Set dBevelAngleQ1 = 90 - abs(dBevelAngle - 180)"
              ]
            },
            "path2": {
              "name": "Angle <= 90",
              "steps": [
                "Set dBevelAngleQ1 = 90 - abs(dBevelAngle)"
              ]
            }
          },
          {
            "condition": "Offset Distance Calculation",
            "path1": {
              "name": "Significant Bevel (0.2 < Q1 < 89.9)",
              "steps": [
                "Set dOffsetDistance = dZ * tan(dBevelAngleQ1)"
              ]
            },
            "path2": {
              "name": "Square Edge (approx 90 deg)",
              "steps": [
                "Set dOffsetDistance = edge.dRecessDepth() + 70mm"
              ]
            }
          },
          {
            "condition": "Leader Position Profile Check",
            "path1": {
              "name": "Calculated point is Outside Profile",
              "steps": [
                "Invert offset vector",
                "Place detail on opposite side of edge"
              ]
            },
            "path2": {
              "name": "Calculated point is Inside Profile",
              "steps": [
                "Use standard calculated position"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of a valid Sip entity in _Sip or _Entity arrays",
            "errorMessage": "\n[ScriptName]: |No Sip found. Instance erased.|",
            "recovery": "User must ensure the script is executed in a context where a Sip is selected or the script is attached to a valid Sip entity in the Shop Drawing engine."
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 5021,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# sdUK_SIPShowEdgeDirections.mcr\n\n## Overview\nThis script is an automated shop drawing utility for Structural Insulated Panels (SIPs). It detects and annotates panel edges in generated views, adding labels (e.g., \"E1\") and directional arrows to clearly indicate edge orientation and bevel angles.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script does not run manually in model space. |\n| Paper Space | Yes | It runs automatically when shop drawing layouts are generated. |\n| Shop Drawing | Yes | This script must be assigned to a Sip entity within a Shop Drawing Style. |\n\n## Prerequisites\n- **Required Entities**: Sip (Structural Insulated Panel).\n- **Minimum Beam Count**: 1 SIP.\n- **Required Settings**: The script must be assigned to the desired entity in the Shop Drawing Style configuration.\n\n## Usage Steps\n\n### Step 1: Configure Shop Drawing Style\n1. Open the **Shop Drawing Style** editor in hsbCAD.\n2. Navigate to the entity mapping or TSL assignment section for **Sip** entities.\n3. Add `sdUK_SIPShowEdgeDirections.mcr` to the list of scripts to run for the Sip.\n\n### Step 2: Generate Shop Drawing\n1. Run the **Generate Shop Drawing** command (usually via the hsbCAD toolbar).\n2. Select the desired SIPs or the entire model.\n3. The script will execute automatically during the view generation process.\n\n### Step 3: Review Annotations\n1. Open the generated layout in Paper Space.\n2. Inspect the views of the SIPs.\n3. You will see edge labels and directional arrows placed on the panel edges in Normal (perpendicular) views.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| N/A | N/A | N/A | This script does not expose any user-editable parameters in the Properties Palette. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| N/A | This script does not add specific items to the entity right-click menu. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: The script operates entirely based on the geometry of the selected SIP and does not require external XML configuration files.\n\n## Tips\n- **View Orientation**: The script is designed to annotate \"Normal\" views (views looking perpendicularly at the panel surface). Edge labels may not appear in section or elevation cuts.\n- **Text Placement**: The script automatically calculates the position of the label. If the calculated position falls inside the panel profile, it will automatically flip the leader and text to the outside to ensure legibility.\n- **Unlinked Panels**: You can use this script on standalone panels that are not linked to a larger wall element.\n\n## FAQ\n- **Q: Why don't I see edge labels on my drawing?**\n  - A: Ensure that the view showing the panel is a \"Normal\" view (Top or Bottom view relative to the panel plane). The script skips non-normal views to avoid clutter.\n- **Q: Can I change the text size or arrow style?**\n  - A: This script uses fixed internal settings for geometry. To change styles, you would need to modify the script source code or adjust the CAD layer settings for the generated entities.\n- **Q: Does this work for curved walls?**\n  - A: The script processes standard SIP geometry. Results on complex or highly curved geometry may vary based on the specific edge definitions."
      },
      "tokens_used": 4179,
      "error": null
    }
  }
}