{
  "filename": "hsb_BoxBlock.mcr",
  "status": "completed",
  "total_tokens": 25127,
  "processing_time": 196.66909265518188,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.01",
            "date": "21.07.2009",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.2",
            "date": "30.06.2010",
            "author": "",
            "changes": "Allow it to run from the wall details on generation"
          },
          {
            "version": "1.3",
            "date": "01.07.2010",
            "author": "",
            "changes": "Assign _KLog to set BeamType Name"
          },
          {
            "version": "1.4",
            "date": "01.09.2010",
            "author": "",
            "changes": "Set the beams as modules"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4269,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script interacts with 3D entities (Element, Beam, Body, PlaneProfile, Point3d) and performs geometric operations (dbSplit, dbCreate). No usage of 'sd_' or Multipage prefixes. No usage of _Viewport. No '#Type E' or _Entity[] specific to shop drawings."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Elements with Beams having beamCode 'BOXBLOCK'",
          "requiredSettings": []
        }
      },
      "tokens_used": 2433,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Please select Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3147,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 6479,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Set units to mm and define default constants (Length=200mm, Name='Box Block', Material='CLS', Grade='C16').",
          "2. Property Loading: If _bOnDbCreated is true, load property values from the catalog using the execute key.",
          "3. Insertion Cycle Check: If _bOnInsert is true and insertCycleCount() > 1, erase the script instance and exit.",
          "4. User Selection: Prompt user to select Elements ('Please select Elements').",
          "5. Selection Validation: If selection is successful, store elements in _Element array. If _Element is empty, erase instance and exit.",
          "6. Element Loop: Iterate through each selected Element to extract coordinate system (X, Y, Z vectors).",
          "7. Beam Filtering: Retrieve all beams in the element. Filter the list to only include beams where the first token of the beamCode (uppercase) is 'BOXBLOCK'.",
          "8. Processing Loop: Iterate through each filtered beam.",
          "9. Orientation Check: Verify if the beam's X-axis is parallel to the element's Y-axis (dot product >= 0.99). If not, skip the beam.",
          "10. Split Point Calculation: Calculate Top and Bottom split points using the beam's shadow profile on the element's Z-plane, offset by the default length (200mm).",
          "11. Beam Splitting: Execute dbSplit on the original beam. The order of split points depends on the directional alignment of the beam.",
          "12. Spacing Calculation: Calculate the distance between split points and derive the offset distance for the new blocks: (Distance - 100mm) / 3.",
          "13. Top Block Creation: Create a new beam at the top location using dbCreate. Set name, material, grade, color, module, and assign to the element group. Set type to _kLog.",
          "14. Bottom Block Creation: Create a new beam at the bottom location using dbCreate. Set name, material, grade, color, module, and assign to the element group. Set type to _kLog.",
          "15. Finalize: If _bOnElementConstructed is true, erase the script instance."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase Instance",
                "Return"
              ]
            },
            "path2": {
              "name": "Cycle == 1",
              "steps": [
                "Execute Entity Selection Prompt"
              ]
            }
          },
          {
            "condition": "Entity Selection",
            "path1": {
              "name": "Valid Selection",
              "steps": [
                "Populate _Element Array",
                "Process Elements"
              ]
            },
            "path2": {
              "name": "Empty/Cancelled",
              "steps": [
                "Erase Instance",
                "Return"
              ]
            }
          },
          {
            "condition": "Beam BeamCode Match",
            "path1": {
              "name": "Match 'BOXBLOCK'",
              "steps": [
                "Check Orientation",
                "Execute Split Logic"
              ]
            },
            "path2": {
              "name": "No Match",
              "steps": [
                "Skip Beam"
              ]
            }
          },
          {
            "condition": "Beam Orientation (dot product of Beam VecX and Element VecY)",
            "path1": {
              "name": "Parallel (>= 0.99)",
              "steps": [
                "Calculate Split Points",
                "Create Top/Bottom Blocks"
              ]
            },
            "path2": {
              "name": "Not Parallel (< 0.99)",
              "steps": [
                "Continue to Next Beam"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Array Length",
            "errorMessage": "(Implicit) Script deletes self if no elements are found.",
            "recovery": "User must re-run script and select at least one Element."
          },
          {
            "check": "Beam BeamCode",
            "errorMessage": "None. Beams not matching 'BOXBLOCK' are ignored.",
            "recovery": "User must ensure target beams have the beamCode set to 'BOXBLOCK'."
          },
          {
            "check": "Beam Alignment",
            "errorMessage": "None. Beams not parallel to Element Y-axis are ignored.",
            "recovery": "User must rotate beams or ensure they align with the Element's local Y-axis."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Generated Beams",
            "how": "Standard AutoCAD/hsbCAD Entity Editing",
            "effect": "The script instance erases itself after execution. The resulting Box Block beams become standard entities and can be moved/edited individually, but the script relationship is lost."
          }
        ]
      },
      "tokens_used": 4443,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_BoxBlock.mcr\n\n## Overview\nThis script automates the creation of box blocks within timber wall elements. It identifies specific beams marked as \"BOXBLOCK\", splits them, and inserts new top and bottom block components with predefined material properties.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the 3D model. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities:** At least one hsbCAD Element containing Beams.\n- **Beam Configuration:** Beams intended for box block generation must have the `beamCode` property starting with \"BOXBLOCK\".\n- **Orientation:** The target beams must be aligned parallel to the Element's local Y-axis.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_BoxBlock.mcr` from the file browser.\n\n### Step 2: Select Elements\n```\nCommand Line: Please select Elements\nAction: Click on the wall elements (or use a crossing window) that contain the beams marked \"BOXBLOCK\". Press Enter to confirm selection.\n```\n\n### Step 3: Automatic Processing\nOnce elements are selected, the script automatically:\n1. Filters beams for the code \"BOXBLOCK\".\n2. Calculates split points and block spacing.\n3. Splits the original beams.\n4. Creates new Top and Bottom box block beams.\n5. Erases itself from the drawing.\n\n## Properties Panel Parameters\nThis script does not expose editable parameters in the Properties Palette. It uses internal constants (Length: 200mm, Material: CLS, Grade: C16).\n\n## Right-Click Menu Options\nThis script does not add custom options to the right-click menu. Since it erases itself after execution, standard hsbCAD entity editing options apply to the resulting beams only.\n\n## Settings Files\nNo external settings files are required for this script.\n\n## Tips\n- **Beam Code:** Ensure the beams you wish to modify are strictly named with the prefix \"BOXBLOCK\" (case-insensitive check).\n- **Orientation:** Verify that the beams run parallel to the element's local Y-axis. Beams running in other directions will be ignored by the script.\n- **Script Removal:** The script instance deletes itself immediately after generating the blocks. If you need to make changes, you must undo (Ctrl+Z) and re-run the script.\n\n## FAQ\n**Q: The script ran but didn't create any blocks. Why?**\nA: Check that the target beams have the correct `beamCode` (\"BOXBLOCK\") and that they are oriented correctly relative to the element (Beam X-axis parallel to Element Y-axis).\n\n**Q: Can I edit the length of the blocks after the script runs?**\nA: Yes. The resulting box blocks are standard beams. You can select them and manually adjust their geometry or properties in the Properties Palette.\n\n**Q: Where did the script instance go after I ran it?**\nA: By design, this script erases itself after processing to clean up the drawing. The generated blocks remain as independent entities."
      },
      "tokens_used": 4356,
      "error": null
    }
  }
}