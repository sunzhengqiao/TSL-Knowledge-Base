{
  "filename": "SIP_Element_Dimensions_PS.mcr",
  "status": "completed",
  "total_tokens": 54841,
  "processing_time": 293.66151547431946,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7493,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script prompts for a viewport selection using getViewport() on insertion and erases itself if _Viewport.length() is 0. It calculates coordinate system transformations between Model Space and Paper Space (ms2ps). The filename suffix '_PS' also indicates Paper Space usage."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "Sip"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space (AutoCAD Layout) containing a Viewport with an assigned hsbCAD Element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 7563,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Pick a point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strDimBP",
            "type": "PropString",
            "displayName": "Dim Pressure Plate",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "strShowDiagonal",
            "type": "PropString",
            "displayName": "Show Diagonal",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "strShowDescription",
            "type": "PropString",
            "displayName": "Show Dim Description",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Offset of the DimLines",
            "defaultValue": 1000,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dOffsetText",
            "type": "PropDouble",
            "displayName": "Offset of the Text Description",
            "defaultValue": 100,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dOffsetSplay",
            "type": "PropDouble",
            "displayName": "Offset for Splay Angles",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColorSp",
            "type": "PropInt",
            "displayName": "Dim Panel Color",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColorOp",
            "type": "PropInt",
            "displayName": "Dim Opening Color",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "nColorEl",
            "type": "PropInt",
            "displayName": "Dim Element Color",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "nColorDp",
            "type": "PropInt",
            "displayName": "Text Color",
            "defaultValue": 3,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dTextHeight",
            "type": "PropDouble",
            "displayName": "Panel Text Height",
            "defaultValue": 20,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dSplayTextHeight",
            "type": "PropDouble",
            "displayName": "Splay Text Height",
            "defaultValue": 20,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strDisplay",
            "type": "PropString",
            "displayName": "Show Text",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sDisplayModeDelta",
            "type": "PropString",
            "displayName": "Display mode Delta",
            "defaultValue": "Parallel",
            "inputType": "dropdown",
            "options": [
              "Parallel",
              "Perpendicular",
              "None"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sDisplayModeChain",
            "type": "PropString",
            "displayName": "Display mode Chain",
            "defaultValue": "Parallel",
            "inputType": "dropdown",
            "options": [
              "Parallel",
              "Perpendicular",
              "None"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9103,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automates the generation of 2D shop drawings for Structural Insulated Panel (SIP) elements in Paper Space, including overall dimensions, panel spacing, openings, and edge splay angles.\",\n    \"category\": \"ShopDrawing\",\n    \"typicalUseCase\": \"Creating production layout drawings or installation plans where precise dimensions of SIP walls/floors, openings, and bevel angles are required without manual drafting.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"strDimBP\",\n      \"technicalDefault\": \"Yes\",\n      \"businessMeaning\": \"Toggles whether to include the bottom pressure plate (timber sole plate) in the overall vertical element dimension.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"enum\",\n      \"affectsOutput\": \"If 'Yes', the vertical dimension line extends to the bottom of the timber plate; if 'No', it measures only to the bottom of the SIP panel.\"\n    },\n    {\n      \"name\": \"strShowDiagonal\",\n      \"technicalDefault\": \"Yes\",\n      \"businessMeaning\": \"Toggles the display of the diagonal measurement from bottom-left to top-right of the element.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"enum\",\n      \"affectsOutput\": \"Hides or shows the diagonal length text label used for checking squareness.\"\n    },\n    {\n      \"name\": \"strShowDescription\",\n      \"technicalDefault\": \"Yes\",\n      \"businessMeaning\": \"Toggles the visibility of descriptive text labels (e.g., 'Panel', 'Element', 'Opening') next to dimension lines.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"enum\",\n      \"affectsOutput\": \"Adds or removes text identifiers above dimension lines to clarify what is being measured.\"\n    },\n    {\n      \"name\": \"dOffset\",\n      \"technicalDefault\": \"1000\",\n      \"businessMeaning\": \"The distance from the element envelope to the first dimension line, serving as the base spacing for subsequent staggered dimension lines.\",\n      \"validRange\": \"500 - 2000 (depending on drawing scale)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Moves all dimension lines closer to or further from the element geometry.\"\n    },\n    {\n      \"name\": \"dOffsetText\",\n      \"technicalDefault\": \"100\",\n      \"businessMeaning\": \"The vertical gap between the dimension line and its associated description text.\",\n      \"validRange\": \"50 - 500\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Moves the label text (like 'Panel') up or down relative to the dimension line.\"\n    },\n    {\n      \"name\": \"dOffsetSplay\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"The radial offset distance for edge labels (Detail Codes and Splay Angles) from the center of the SIP edge.\",\n      \"validRange\": \"0 - 500\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Moves splay angle labels away from the panel edge to prevent overlapping with the drawing geometry.\"\n    },\n    {\n      \"name\": \"sDimStyle\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Specifies the AutoCAD Dimension Style (DimStyle) to be applied to the generated dimensions.\",\n      \"validRange\": \"Any valid DimStyle name in the drawing\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Changes the appearance (arrowheads, tick marks, text font) of the dimension lines.\"\n    },\n    {\n      \"name\": \"nColorSp\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"Sets the CAD color index for dimensions related to the SIP panels.\",\n      \"validRange\": \"0 - 255\",\n      \"unit\": \"ACI\",\n      \"affectsOutput\": \"Changes the color of panel-specific dimension lines and labels.\"\n    },\n    {\n      \"name\": \"nColorOp\",\n      \"technicalDefault\": \"2\",\n      \"businessMeaning\": \"Sets the CAD color index for dimensions"
      },
      "tokens_used": 11447,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Execution / Recalculation Triggered",
          "2. Check if Insert Mode (_bOnInsert)",
          "3. [Insert Mode] Prompt user for insertion point (_Pt0)",
          "4. [Insert Mode] Prompt user to select a Viewport",
          "5. [Insert Mode] Save state and Exit",
          "6. [Recalc Mode] Validate selected Viewport exists (erase and exit if missing)",
          "7. Validate Viewport contains valid hsb Element (exit if invalid)",
          "8. Retrieve Element coordinate system and calculate Model-to-Paper-Space transformation",
          "9. Iterate all Beams and SIPs to determine absolute element envelope (Top, Bottom, Left, Right extremes)",
          "10. Partition SIPs and Openings into 4 spatial zones based on the element center",
          "11. Initialize Display objects (colors, dimstyles, text heights) based on properties",
          "12. Generate Horizontal Dimensions for Zones 2 & 4 (Panels then Openings)",
          "13. Generate Vertical Dimensions for Zones 3 & 4 (Panels then Openings)",
          "14. Generate Overall Vertical Element Dimension (Top, Bottom-SIP, Bottom-BP)",
          "15. Generate Diagonal Dimension Text at insertion point",
          "16. Loop through all SIP Edges to generate Detail Code and Bevel Angle labels",
          "17. Visualize element corner points",
          "18. End"
        ],
        "conditionalBranches": [
          {
            "condition": "Element Height Dimension Configuration",
            "path1": {
              "name": "Full Dimension (SIP + BP)",
              "steps": [
                "Add Top point",
                "Add Bottom SIP point (if SIPs exist)",
                "Add Bottom Beam point (if strDimBP is Yes)",
                "Draw dimension chain covering both materials"
              ],
              "trigger": "strDimBP = 'Yes' AND Element contains SIPs"
            },
            "path2": {
              "name": "SIP Only Dimension",
              "steps": [
                "Add Top point",
                "Add Bottom SIP point (if SIPs exist)",
                "Omit Bottom Beam point",
                "Draw dimension chain covering SIP height only"
              ],
              "trigger": "strDimBP = 'No' OR Element contains no SIPs"
            }
          },
          {
            "condition": "Bevel Angle Text Positioning",
            "path1": {
              "name": "Offset Position",
              "steps": [
                "Calculate vector from edge to SIP center",
                "Project normal vector to element plane",
                "Offset text position by dOffsetSplay along projected normal",
                "Draw text at offset location"
              ],
              "trigger": "Edge angle is not orthogonal (not 0, 90, or 180 degrees)"
            },
            "path2": {
              "name": "Midpoint Position",
              "steps": [
                "Identify edge midpoint",
                "Draw text exactly at edge midpoint"
              ],
              "trigger": "Edge angle is orthogonal (0, 90, or 180 degrees)"
            }
          },
          {
            "condition": "Dimension Display Modes (Delta/Chain)",
            "path1": {
              "name": "Parallel Mode",
              "steps": [
                "Set internal display flag to _kDimPar",
                "Render dimension lines parallel to the measured segment"
              ],
              "trigger": "sDisplayModeDelta/Chain = 'Parallel'"
            },
            "path2": {
              "name": "Perpendicular Mode",
              "steps": [
                "Set internal display flag to _kDimPerp",
                "Render dimension lines perpendicular to the measured segment"
              ],
              "trigger": "sDisplayModeDelta/Chain = 'Perpendicular'"
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport assigned to script instance",
            "errorMessage": "(Silent) Script instance is erased.",
            "recovery": "Re-insert the script and ensure a viewport is selected."
          },
          {
            "check": "Viewport contains valid hsb Element data",
            "errorMessage": "(Silent) Script execution halts.",
            "recovery": "Select a viewport that contains an exported hsbCAD Element/Model."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Dimension Offsets",
            "how": "OPM (Properties Palette)",
            "effect": "Updates dOffset, dOffsetText, and dOffsetSplay variables to shift dimension lines, text, and edge labels closer/further from geometry."
          },
          {
            "action": "Toggle Visibility Options",
            "how": "OPM (Properties Palette)",
            "effect": "Toggles strDimBP, strShowDiagonal, strShowDescription, and strDisplay to show/hide Pressure Plate dims, Diagonal text, descriptions, and edge labels."
          },
          {
            "action": "Change Dimension Modes",
            "how": "OPM (Properties Palette)",
            "effect": "Changes sDisplayModeDelta and sDisplayModeChain to switch between Parallel and Perpendicular dimension line styles."
          },
          {
            "action": "Update Styles and Colors",
            "how": "OPM (Properties Palette)",
            "effect": "Modifies DimStyle (sDimStyle), Text Heights, and ACI Colors (nColor*) for Panels, Openings, Element, and Text."
          }
        ]
      },
      "tokens_used": 12390,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# SIP_Element_Dimensions_PS.mcr\n\n## Overview\nThis script automatically generates detailed 2D dimension drawings for Structural Insulated Panel (SIP) elements directly in Paper Space. It calculates and labels overall dimensions, individual panel sizes, openings, and bevel angles based on a selected viewport.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script operates in Paper Space only. |\n| Paper Space | Yes | Script must be inserted into a Layout tab. |\n| Shop Drawing | N/A | This is a dimensioning tool for production layouts. |\n\n## Prerequisites\n- **Required Entities**: A Viewport in a Paper Space layout that is displaying a valid hsbCAD Element (containing SIPs).\n- **Minimum Beam Count**: 0 (Works with SIP geometry).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Browse and select `SIP_Element_Dimensions_PS.mcr`.\n\n### Step 2: Pick Insertion Point\n```\nCommand Line: Pick a point\nAction: Click anywhere in the Paper Space layout where you want the script anchor to be located.\n```\n\n### Step 3: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the viewport frame that shows the Element/Model you wish to dimension.\n```\n*Note: Once the viewport is selected, the script will immediately generate the dimensions.*\n\n## Properties Panel Parameters\nSelect the script instance in Paper Space and press `Ctrl+1` to open the Properties Palette and adjust these parameters.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Dim Pressure Plate** | dropdown | Yes | Includes the bottom timber plate in the vertical overall dimension. |\n| **Show Diagonal** | dropdown | Yes | Shows the diagonal length measurement of the element. |\n| **Show Dim Description** | dropdown | Yes | Adds text labels (e.g., \"Panel\", \"Opening\") above dimension lines. |\n| **Offset of the DimLines** | number | 1000 | Distance (mm) from the element to the first dimension line. |\n| **Offset of the Text Description** | number | 100 | Vertical gap (mm) between the dimension line and the label text. |\n| **Offset for Splay Angles** | number | 0 | Radial offset (mm) for edge labels/angles from the panel edge. |\n| **Dimstyle** | dropdown | [Empty] | Select an AutoCAD Dimension Style to apply to the generated lines. |\n| **Dim Panel Color** | number | 1 | AutoCAD Color Index (ACI) for panel dimensions. |\n| **Dim Opening Color** | number | 2 | AutoCAD Color Index (ACI) for opening dimensions. |\n| **Dim Element Color** | number | 0 | AutoCAD Color Index (ACI) for overall element dimensions. |\n| **Text Color** | number | 3 | AutoCAD Color Index (ACI) for all text labels. |\n| **Panel Text Height** | number | 20 | Text height for panel descriptions (mm). |\n| **Splay Text Height** | number | 20 | Text height for bevel angle labels (mm). |\n| **Show Text** | dropdown | Yes | Master toggle to hide/show all text labels. |\n| **Display mode Delta** | dropdown | Parallel | Sets orientation of delta dimensions (Parallel, Perpendicular, or None). |\n| **Display mode Chain** | dropdown | Parallel | Sets orientation of chain dimensions (Parallel, Perpendicular, or None). |\n\n## Right-Click Menu Options\nNone defined. All interactions are handled via the Properties Palette.\n\n## Settings Files\nNone required.\n\n## Tips\n- **Adjusting Scale**: If dimension lines overlap the drawing, increase the **Offset of the DimLines**. If they are too far away, decrease it.\n- **Cleaning Up**: If the drawing looks too cluttered, set **Show Dim Description** to \"No\" to remove the text labels, or set **Show Diagonal** to \"No\".\n- **Edge Labels**: If bevel angle text overlaps the panel geometry, increase the **Offset for Splay Angles** to push the labels outward.\n- **Organization**: Use different **Dim Color** settings to visually separate Panel dimensions from Opening dimensions for easier reading.\n\n## FAQ\n- **Q: Why did the script disappear after I inserted it?**\n  - A: The script will automatically erase itself if it detects an invalid viewport or if the viewport is not linked to an hsbCAD Element. Ensure you select a viewport with an active model.\n- **Q: How do I exclude the bottom plate from the height dimension?**\n  - A: Change the **Dim Pressure Plate** property to \"No\" in the Properties Palette.\n- **Q: The text size is wrong for my plot scale.**\n  - A: Adjust the **Panel Text Height** and **Splay Text Height** values in the Properties Palette. These are typically in model units (mm)."
      },
      "tokens_used": 6845,
      "error": null
    }
  }
}