{
  "filename": "hsb_DoubleTennonAtBeamEnd.mcr",
  "status": "completed",
  "total_tokens": 31588,
  "processing_time": 185.25891208648682,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3331,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses standard model-space variables (_Pt0, _X0, _Y0, _Z0), adds 3D tools (Mortise) to GenBeams, and utilizes Display dp(-1). It does not contain Paper Space specific patterns like Viewport checks, sd_ prefixes, or _Entity array usage."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 3,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 3751,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getBeam",
              "promptOriginal": "|Select male beam|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select female beam(s)|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "_bOnInsert (if _kExecuteKey is empty)",
            "title": null,
            "dataSource": "Properties (Width, Depth, Length, Offsets, Shape)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": "40",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "|Depth|",
            "defaultValue": "50",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dLength",
            "type": "PropDouble",
            "displayName": "|Length|",
            "defaultValue": "50",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "dOffAxis",
            "type": "PropDouble",
            "displayName": "|Offset from axis|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dGap",
            "type": "PropDouble",
            "displayName": "|Tolerance depth|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "dGapLength",
            "type": "PropDouble",
            "displayName": "|Gap on Length|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sShape",
            "type": "PropString",
            "displayName": "|Shape|",
            "defaultValue": "|Rectangular|",
            "inputType": "dropdown",
            "options": [
              "|Rectangular|",
              "|Round|",
              "|Rounded|"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4440,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a double tenon connection where one 'male' beam connects to two 'female' beams simultaneously, creating a through-joint or cross-joint with customizable dimensions and tolerances.",
          "category": "Joinery/Framing",
          "typicalUseCase": "Creating cross-joints in timber framing where a main beam passes through or terminates into secondary beams (e.g., column to beam intersections or purlin to rafter connections) requiring a solid mechanical connection."
        },
        "parameters": [
          {
            "name": "dWidth",
            "technicalDefault": "U(40)",
            "businessMeaning": "The lateral width of the tenon (perpendicular to its length), typically matching the width of the timber or the desired shoulder width.",
            "validRange": "20 mm - 400 mm",
            "unit": "mm",
            "affectsOutput": "Changes the width of the tenon protrusion on the male beam and the width of the mortise slot on the female beams."
          },
          {
            "name": "dDepth",
            "technicalDefault": "U(50)",
            "businessMeaning": "The vertical thickness (height) of the tenon. This determines how much material is removed from the top and bottom faces of the male beam.",
            "validRange": "10 mm - 300 mm",
            "unit": "mm",
            "affectsOutput": "Defines the height of the tenon. On the female beams, the mortise height is calculated as this value plus the Tolerance depth."
          },
          {
            "name": "dLength",
            "technicalDefault": "U(50)",
            "businessMeaning": "The penetration length of the tenon, i.e., how far it extends into the female beams.",
            "validRange": "10 mm - 500 mm",
            "unit": "mm",
            "affectsOutput": "Determines how deep the cut goes into the female beams and how long the protruding tenon is on the male beam."
          },
          {
            "name": "dOffAxis",
            "technicalDefault": "0",
            "businessMeaning": "Offsets the entire connection geometry (tenon and mortises) along the axis of the tenon from the insertion point.",
            "validRange": "-500 mm - 500 mm",
            "unit": "mm",
            "affectsOutput": "Slides the connection forwards or backwards along the beam axis without changing dimensions."
          },
          {
            "name": "dGap",
            "technicalDefault": "0",
            "businessMeaning": "Tolerance (clearance) added to the depth (thickness) of the female mortise to ensure the tenon fits loosely.",
            "validRange": "0 mm - 5 mm",
            "unit": "mm",
            "affectsOutput": "Increases the height of the mortise slot on the female beams only. Does not change the male tenon size."
          },
          {
            "name": "dGapLength",
            "technicalDefault": "0",
            "businessMeaning": "Tolerance (clearance) added to the length of the female mortise to allow for longitudinal movement or easier assembly.",
            "validRange": "0 mm - 10 mm",
            "unit": "mm",
            "affectsOutput": "Increases the length of the mortise slot on the female beams only. Does not change the male tenon size."
          },
          {
            "name": "sShape",
            "technicalDefault": "|Rectangular|",
            "businessMeaning": "The profile of the tenon corners, affecting the machining operation and aesthetics.",
            "validRange": "Rectangular / Round / Rounded",
            "unit": "enum",
            "affectsOutput": "Rectangular creates sharp corners; Round creates a full dowel/tongue; Rounded creates filleted corners on the tenon and mortise."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing dGap",
            "effect": "Increases the Female Mortise Depth (Height) to be dDepth + dGap.",
            "cascade": [
              "msFemale.dDepth",
              "msFemale2.dDepth"
            ]
          },
          {
            "trigger": "Changing dGapLength",
            "effect": "Increases the Female Mortise Length to be dLength + dGapLength.",
            "cascade": [
              "msFemale.dLength",
              "msFemale2.dLength"
            ]
          },
          {
            "trigger": "Changing sShape",
            "effect": "Applies the rounding type to both the Male Tenon and Female Mortises simultaneously.",
            "cascade": [
              "ms.RoundType",
              "msFemale.RoundType",
              "ms2.RoundType",
              "msFemale2.RoundType"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Tenon (Positive Material / Solid)",
            "description": "A protruding solid shape on the male beam designed to insert into the female beams.",
            "appliedTo": "Beam[0] (Male Beam)"
          },
          {
            "type": "Mortise (Negative Material / Cutout)",
            "description": "A slot cut into the female beams to receive the tenon, sized with additional gaps based on tolerance settings.",
            "appliedTo": "Beam[1] and Beam[2] (Female Beams)"
          }
        ]
      },
      "tokens_used": 6854,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches script (hsb_DoubleTennonAtBeamEnd.mcr)",
          "[System] Initializes Properties (Width, Depth, Length, OffAxis, Gap, GapLength, Shape) with defaults",
          "[Conditional] Check if script is running in Insert Mode (_bOnInsert)",
          "[Conditional Insert] Check if execution loop count > 1",
          "[Path Fail] Erase instance and exit (prevents duplicate processing)",
          "[Path Success] Check if _kExecuteKey (Catalog Key) is empty",
          "[Path No Catalog] Show Properties Dialog to user for manual input",
          "[Path Catalog] Load properties from Catalog entry automatically",
          "Prompt: Select male beam (Beam[0])",
          "Prompt: Select female beam(s) (Beam[1] & Beam[2]) via PrEntity",
          "Append selected beams to _Beam collection and Exit Insert Mode",
          "Calculate Local Coordinate Systems (vx, vy, vz) for Male Beam",
          "Calculate Local Coordinate Systems (vx2, vy2, vz2) for Female Beam",
          "[Conditional] Check Alignment (nAlign) for coordinate system rotation (Fixed to 0 in current code)",
          "Calculate Tenon Insertion Point (ptTennon) based on Offset from Axis and 25% beam depth offset",
          "Calculate Second Tenon Insertion Point (ptTennon2)",
          "Generate Male Tenon 1 (ms) with setRoundType, add to Male Beam",
          "Generate Female Mortise 1 (msFemale) with added Gaps (dGap, dGapLength), add to Female Beam 1",
          "Generate Male Tenon 2 (ms2), add to Male Beam",
          "Generate Female Mortise 2 (msFemale2), add to Female Beam 2",
          "Draw visual representation (Lines) in Display -1",
          "Script completes, beams updated in model"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution State (_bOnInsert)",
            "path1": {
              "name": "Insertion Mode",
              "steps": [
                "Check loop count",
                "Handle Catalog/Dialog Input",
                "Select Beams",
                "Set Coordinates",
                "Apply Tools"
              ]
            },
            "path2": {
              "name": "Recalculation Mode (Edit)",
              "steps": [
                "Fetch updated Properties",
                "Set Coordinates",
                "Apply Tools",
                "Update Display"
              ]
            }
          },
          {
            "condition": "Catalog Usage (_kExecuteKey)",
            "path1": {
              "name": "Manual Input",
              "steps": [
                "Execute showDialog()",
                "User inputs Width/Depth/Length/etc.",
                "Proceed to Beam Selection"
              ]
            },
            "path2": {
              "name": "Catalog Input",
              "steps": [
                "Execute setPropValuesFromCatalog()",
                "Load predefined values",
                "Proceed to Beam Selection"
              ]
            }
          },
          {
            "condition": "Female Beam Selection (PrEntity)",
            "path1": {
              "name": "Selection Successful",
              "steps": [
                "Assign selected beam(s) to bmFemale array",
                "Append to _Beam collection",
                "Generate Geometry"
              ]
            },
            "path2": {
              "name": "Selection Cancelled/Failed",
              "steps": [
                "Script likely exits or waits (default PrEntity behavior)",
                "No geometry generated"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Count",
            "errorMessage": "Implicit Error: Script expects indices _Beam[0], _Beam[1], _Beam[2].",
            "recovery": "User must select exactly 1 Male beam and at least 2 Female beams (or the logic expects a specific setup). The code accesses _Beam[2] directly without check."
          },
          {
            "check": "Insertion Loop Count",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script erases instance if insertCycleCount() > 1. User must re-insert the script."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions",
            "how": "OPM (Object Properties Palette)",
            "effect": "Updating Width, Depth, or Length recalculates and regenerates the Tenon and Mortise sizes instantly."
          },
          {
            "action": "Adjust Tolerances",
            "how": "OPM (Properties Palette)",
            "effect": "Changing 'Tolerance depth' (dGap) or 'Gap on Length' (dGapLength) enlarges the female mortises specifically, without changing the male tenon."
          },
          {
            "action": "Move Joint",
            "how": "OPM 'Offset from axis'",
            "effect": "Slides the tenon and mortises along the beam's axis vector (positive or negative) relative to the insertion point."
          },
          {
            "action": "Change Shape",
            "how": "OPM 'Shape' Dropdown",
            "effect": "Toggles the corner geometry between Rectangular, Round (Full circle), and Rounded (Fillets) for both Tenon and Mortises."
          },
          {
            "action": "Move Script Instance",
            "how": "Grip Edit (Moving the insertion point / _Pt0)",
            "effect": "The entire connection geometry (Tenons and Mortises) translates to the new location relative to the beams."
          }
        ]
      },
      "tokens_used": 6821,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_DoubleTennonAtBeamEnd.mcr\n\n## Overview\nThis script generates a double tenon connection where one \"male\" beam connects to two \"female\" beams simultaneously. It is designed to create cross-joints with customizable dimensions, tolerances, and tenon shapes for timber framing.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in 3D model environment. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | Not a drawing generation script. |\n\n## Prerequisites\n- **Required Entities:** 3 `GenBeam` entities (1 Male beam and 2 Female beams).\n- **Minimum Beam Count:** 3\n- **Required Settings:** None specific (defaults are used).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Browse and select `hsb_DoubleTennonAtBeamEnd.mcr`\n\n### Step 2: Configure Dimensions (Optional)\nIf a catalog entry is not pre-selected, a Properties dialog will appear automatically.\n- **Action:** Review and adjust parameters like Width, Depth, and Length. Click OK to confirm.\n\n### Step 3: Select Male Beam\n```\nCommand Line: Select male beam\nAction: Click on the main beam (the one that will have the tenons sticking out).\n```\n\n### Step 4: Select Female Beams\n```\nCommand Line: Select female beam(s)\nAction: Click on the two beams that will receive the tenons (have the mortises).\n```\n\n### Step 5: Completion\n- **Action:** The script automatically calculates the geometry, creates the tenon on the male beam, and cuts mortises in the female beams.\n\n## Properties Panel Parameters\n\nAfter insertion, select the script instance in the model to edit these parameters in the Properties Palette.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Width | Number | 40 | The lateral width of the tenon. |\n| Depth | Number | 50 | The vertical thickness (height) of the tenon. |\n| Length | Number | 50 | The penetration length of the tenon into the female beams. |\n| Offset from axis | Number | 0 | Slides the entire connection geometry forwards or backwards along the beam axis. |\n| Tolerance depth | Number | 0 | Extra clearance added to the *height* of the female mortise only (does not change tenon size). |\n| Gap on Length | Number | 0 | Extra clearance added to the *length* of the female mortise only (allows for longitudinal movement). |\n| Shape | Dropdown | Rectangular | The profile of the tenon corners. Options: Rectangular, Round, Rounded. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific context menu items are defined for this script. Use the Properties Palette for edits. |\n\n## Settings Files\n- **Filename:** None\n- **Location:** N/A\n- **Purpose:** N/A\n\n## Tips\n- **Tolerance Control:** Use `Tolerance depth` and `Gap on Length` if you need a loose fit for the male tenon inside the female mortises. This ensures the tenon remains standard size while the holes are larger.\n- **Moving the Joint:** If you need to move the connection to a different spot along the beam, use the `Offset from axis` property or move the script insertion point (grip edit) rather than re-creating it.\n- **Shape Selection:** Select `Rounded` or `Round` shapes if you are using CNC tooling that prefers radiused corners over sharp 90-degree angles.\n\n## FAQ\n- **Q: Why are my mortises bigger than my tenon?**\n- **A:** You likely have a value greater than 0 in the `Tolerance depth` or `Gap on Length` properties. These parameters are designed to add clearance specifically to the female beams.\n\n- **Q: Can I connect to only one beam?**\n- **A:** No, this script is designed specifically for a \"Double\" connection. It requires exactly one male beam and two female beams to generate the geometry correctly."
      },
      "tokens_used": 6391,
      "error": null
    }
  }
}