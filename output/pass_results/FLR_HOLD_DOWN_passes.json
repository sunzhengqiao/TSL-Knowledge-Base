{
  "filename": "FLR_HOLD_DOWN.mcr",
  "status": "completed",
  "total_tokens": 34707,
  "processing_time": 221.60457110404968,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4083,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates 3D geometry (Body) based on Beam or TrussEntity coordinates and uses HardWrComp. Uses _bOnInsert for initial entity selection. No 'sd_' functions, '_Viewport', or layout generation logic found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam",
            "TrussEntity"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "_kPathHsbCompany\\Abbund\\holdowns.dxx"
          ]
        }
      },
      "tokens_used": 4254,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity.go",
              "promptOriginal": "\\n Select beam or truss entity to attach to",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "\\n Select end point of the beam",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Property Dialog",
            "trigger": "_bOnInsert (via showDialogOnce)",
            "title": "Properties",
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "prHoldDown",
            "type": "PropString",
            "displayName": "Hold Down",
            "defaultValue": "DTT2Z-SDS2.5 SIMPSON",
            "inputType": "dropdown",
            "options": [
              "DTT2Z-SDS2.5 SIMPSON",
              "HDU4-SDS2.5 SIMPSON",
              "HDU8-SDS2.5 SIMPSON"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "prPosition",
            "type": "PropString",
            "displayName": "Beam side",
            "defaultValue": "Left",
            "inputType": "dropdown",
            "options": [
              "Left",
              "Right"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "prShopInstall",
            "type": "PropString",
            "displayName": "Shop Installed",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "prDoffsetLdir",
            "type": "PropDouble",
            "displayName": "End Offset",
            "defaultValue": "U(6)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "prDoffsetHdir",
            "type": "PropDouble",
            "displayName": "Center Offset",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "holdowns.dxx",
            "searchPaths": [
              "_kPathHsbCompany\\Abbund\\"
            ],
            "purpose": "Provides 3D geometry (Body) for the selected hold-down connector type.",
            "required": true
          }
        ]
      },
      "tokens_used": 6761,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts and configures a Simpson Strong-Tie hold-down connector (like a hurricane tie) onto a beam or truss bottom chord to resist uplift forces.",
          "category": "Hardware",
          "typicalUseCase": "An engineer or detailer uses this to specify hold-downs at the ends of shear walls or critical roof truss connections where wind uplift is a concern."
        },
        "parameters": [
          {
            "name": "prHoldDown",
            "technicalDefault": "DTT2Z-SDS2.5 SIMPSON",
            "businessMeaning": "Selects the specific model of the hold-down hardware (connector type) to be used.",
            "validRange": "Restricted to available models in dropdown (DTT2Z, HDU4, HDU8)",
            "unit": "Enum (String)",
            "affectsOutput": "Changes the 3D geometry (size/shape) of the connector body, the number and type of fasteners reported in BOM/schedules, and the DXA output data."
          },
          {
            "name": "prPosition",
            "technicalDefault": "Left",
            "businessMeaning": "Determines which side of the beam (relative to its length axis and element Z-axis) the hold-down is attached to.",
            "validRange": "Left, Right",
            "unit": "Enum (Direction)",
            "affectsOutput": "Mirrors the connector placement horizontally across the beam centerline."
          },
          {
            "name": "prShopInstall",
            "technicalDefault": "Yes",
            "businessMeaning": "Specifies if the connector is installed in the shop (pre-installed) or on the job site (loose/field install).",
            "validRange": "Yes, No",
            "unit": "Enum (Boolean)",
            "affectsOutput": "Controls whether the connector geometry is added to the Shop Drawing representation and sets the 'HOLDDOWN_LOOSE' flag for scheduling and logistics."
          },
          {
            "name": "prDoffsetLdir",
            "technicalDefault": "U(6)",
            "businessMeaning": "Sets the distance from the end of the beam (based on the selected grip point) to the center of the hold-down.",
            "validRange": "0 to Beam Length - Connector Depth (typically 0\" to 24\")",
            "unit": "Length (Inch/mm)",
            "affectsOutput": "Slides the connector along the length of the beam towards or away from the selected end point."
          },
          {
            "name": "prDoffsetHdir",
            "technicalDefault": "U(0)",
            "businessMeaning": "Adjusts the vertical (height) offset of the connector relative to the beam's vertical center or bottom face.",
            "validRange": "Negative (lower) to Positive (higher), typically constrained by plate depth.",
            "unit": "Length (Inch/mm)",
            "affectsOutput": "Moves the connector vertically along the beam's side face."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "prHoldDown selection",
            "effect": "Updates the BOM data for fasteners (quantity and type) and the physical dimensions of the 3D body loaded from the .dxx file.",
            "cascade": [
              "arNFastenerNum",
              "arStFastenerType",
              "arDx/arDy/arDz (Dimensions)",
              "BOM/HardWrComp"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (3D Solid)",
            "description": "The physical representation of the metal hold-down connector, loaded from 'holdowns.dxx'.",
            "appliedTo": "Attached to the selected Beam or TrussEntity."
          },
          {
            "type": "HardWrComp (Hardware Component)",
            "description": "Data entity for the Bill of Materials (BOM), tracking the hold-down itself and associated screws/nails.",
            "appliedTo": "Element Group (X-Hardware/X-Hold Down Connectors)."
          },
          {
            "type": "Map Data",
            "description": "Exports attributes like 'HOLDDOWN_SCHEDULE', 'HOLDDOWN_POINT', 'HOLDDOWN_MODEL', 'HOLDDOWN_LOOSE', and 'HOLDDOWN_FASTENERS' for labeling and scheduling.",
            "appliedTo": "Script Instance."
          },
          {
            "type": "PlaneProfile (Shop Drawing)",
            "description": "If Shop Installed is 'Yes', a 2D profile of the connector is projected onto the beam plane for visibility in layout drawings.",
            "appliedTo": "Shop Drawing Display Representation 'HoldDown'."
          }
        ]
      },
      "tokens_used": 5883,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch: Triggered by user command.",
          "Initial Checks: Validate if inserting for the first time. If 'insertCycleCount > 1', script stops and erases instance.",
          "Input - Entity Selection: Prompt user to select a Beam or TrussEntity to attach the hold-down to.",
          "Input - Point Selection: Prompt user to select the end point of the beam (defines insertion reference).",
          "Entity Validation: Check if selected entity is valid. If not, erase instance.",
          "Element Assignment: Assign script instance to the element group of the selected entity (Category: X-Hold Down Connectors).",
          "Geometry Extraction: Determine center point, vectors (X, Y, Z), and dimensions (L, W, H) of the host entity.",
          "Grip Adjustment: Snap user point to the nearest point on the beam centerline.",
          "Orientation Calculation: Calculate local coordinate system for the connector based on Beam orientation and 'prPosition' (Left/Right).",
          "Connector Placement: Calculate final insertion point 'ptHoldDown' using offsets (prDoffsetLdir, prDoffsetHdir).",
          "Data Mapping: Set Map attributes (HOLDDOWN_MODEL, HOLDDOWN_LOOSE, etc.) for scheduling/labeling.",
          "Geometry Generation: Load 3D body of the specific hold-down from 'holdowns.dxx' and transform to calculated position.",
          "Display & Shop Drawing: Configure display representation and create 2D shadow profile if 'Shop Installed' is Yes.",
          "BOM Creation: Generate Hardware Components (HoldDown part + Fasteners) based on selection.",
          "Finalize: Export DXI data and complete script execution."
        ],
        "conditionalBranches": [
          {
            "condition": "Type of Selected Entity",
            "path1": {
              "name": "Beam",
              "steps": [
                "Cast entity to Beam object.",
                "Extract properties directly (ptCen, vecX, dL, etc.).",
                "Set panhand to element."
              ]
            },
            "path2": {
              "name": "TrussEntity",
              "steps": [
                "Cast entity to TrussEntity.",
                "Extract definition and content map.",
                "Calculate center point relative to Truss Coordinate System origin.",
                "Derive vectors and dimensions from map content."
              ]
            }
          },
          {
            "condition": "Selection Validity",
            "path1": {
              "name": "Valid Entity",
              "steps": [
                "Proceed with geometry extraction and placement."
              ]
            },
            "path2": {
              "name": "Invalid/Empty Entity",
              "steps": [
                "Execute 'eraseInstance()'.",
                "Terminate script immediately."
              ]
            }
          },
          {
            "condition": "prPosition Property",
            "path1": {
              "name": "Left",
              "steps": [
                "Calculate 'entY' vector as elZ crossProduct(entX)."
              ]
            },
            "path2": {
              "name": "Right",
              "steps": [
                "Invert 'entY' vector (-entY)."
              ]
            }
          },
          {
            "condition": "prShopInstall Property",
            "path1": {
              "name": "Yes (Shop Installed)",
              "steps": [
                "Create 2D shadow profile (PlaneProfile) on element plane.",
                "Draw profile lines in specific Display Representation for shop drawings."
              ]
            },
            "path2": {
              "name": "No (Field Installed)",
              "steps": [
                "Skip 2D shadow profile creation.",
                "Map flag 'HOLDDOWN_LOOSE' set to True."
              ]
            }
          },
          {
            "condition": "prHoldDown Selection (Index)",
            "path1": {
              "name": "Valid Index Found",
              "steps": [
                "Retrieve specific dimensions (Dx, Dy, Dz).",
                "Retrieve specific fastener count and type.",
                "Populate BOM with specific hardware data."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Duplicate Insertion Cycle",
            "errorMessage": "(None shown, silent failure)",
            "recovery": "User attempts insert again; script ensures clean state via eraseInstance."
          },
          {
            "check": "Entity Selection",
            "errorMessage": "(None shown, script exits)",
            "recovery": "User must run the command again and select a valid Beam or TrussEntity."
          },
          {
            "check": "Point Selection",
            "errorMessage": "(None shown, if omitted _PtG logic might fail or default to 0,0,0)",
            "recovery": "User provides a point at the command line."
          },
          {
            "check": "Settings File Existence",
            "errorMessage": "Script failure likely (No body generated)",
            "recovery": "Ensure 'holdowns.dxx' exists in '_kPathHsbCompany\\Abbund\\' folder."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify HoldDown Model",
            "how": "OPM Property Palette (Drop-down)",
            "effect": "Swaps 3D geometry size/shape and updates BOM fastener quantities."
          },
          {
            "action": "Adjust Position (Side)",
            "how": "OPM Property Palette (Drop-down: Left/Right)",
            "effect": "Mirrors the connector to the other side of the beam centerline."
          },
          {
            "action": "Adjust Offsets",
            "how": "OPM Property Palette (End Offset, Center Offset)",
            "effect": "Moves the connector along the beam length (End Offset) or vertically (Center Offset)."
          },
          {
            "action": "Toggle Shop Install",
            "how": "OPM Property Palette (Yes/No)",
            "effect": "Adds or removes the 2D shop drawing representation and updates the 'LOOSE' flag."
          },
          {
            "action": "Grip Edit",
            "how": "Select Script Instance -> Drag Grip",
            "effect": "Updates '_PtG' (Reference Point). Script logic calculates new 'ptHoldDown' based on grip movement relative to centerline, effectively sliding the connector."
          },
          {
            "action": "Move/Rotate Host",
            "how": "Standard AutoCAD move/rotate on the Beam/Truss",
            "effect": "Script instance updates its position automatically because it is assigned to the Element."
          }
        ]
      },
      "tokens_used": 7647,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# FLR_HOLD_DOWN.mcr\n\n## Overview\nThis script inserts a Simpson Strong-Tie hold-down connector (such as a hurricane tie) onto a beam or truss. It allows for detailed configuration of the hardware model, positioning, and installation method for both 3D modeling and shop drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in 3D model space to attach to beams. |\n| Paper Space | No | Not supported for layout generation. |\n| Shop Drawing | Yes | Generates 2D profiles if \"Shop Installed\" is set to Yes. |\n\n## Prerequisites\n- **Required Entities**: A single Beam or TrussEntity.\n- **Minimum Beam Count**: 1 (You must select a beam to attach the hold-down).\n- **Required Settings Files**: `holdowns.dxx` must exist in the `..\\Abbund\\` folder within your hsbCompany directory to provide the 3D connector geometry.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Browse and select `FLR_HOLD_DOWN.mcr`.\n\n### Step 2: Select Host Entity\n```\nCommand Line: Select beam or truss entity to attach to\nAction: Click on the Beam or Truss bottom chord where you want the hold-down placed.\n```\n\n### Step 3: Define Reference Point\n```\nCommand Line: Select end point of the beam\nAction: Click near the end of the selected beam. This determines which end the \"End Offset\" is measured from.\n```\n\n### Step 4: Configure Properties\n1.  After insertion, the script instance is selected.\n2.  Open the **Properties Palette** (Ctrl+1).\n3.  Adjust parameters like **Hold Down** model, **Beam side**, and **Offsets** as needed.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Hold Down | dropdown | DTT2Z-SDS2.5 SIMPSON | Select the specific model of the hold-down hardware (e.g., DTT2Z, HDU4, HDU8). |\n| Beam side | dropdown | Left | Determines which side of the beam centerline the connector is attached to. Options: Left, Right. |\n| Shop Installed | dropdown | Yes | If \"Yes\", includes the connector in shop drawings. If \"No\", it is treated as loose hardware for field installation. |\n| End Offset | number | 6\" (U(6)) | The distance from the selected beam end point to the center of the hold-down. |\n| Center Offset | number | 0\" (U(0)) | The vertical offset of the connector relative to the beam's vertical center. |\n\n## Right-Click Menu Options\nThis script does not add custom items to the right-click context menu. Editing is done via the Properties Palette or using grips.\n\n| Menu Item | Description |\n|-----------|-------------|\n| Properties | Opens the AutoCAD Properties palette to modify connector parameters. |\n| Move Grip | Select the script instance and drag the square grip to slide the connector along the beam. |\n\n## Settings Files\n- **Filename**: `holdowns.dxx`\n- **Location**: `_kPathHsbCompany\\Abbund\\`\n- **Purpose**: Contains the 3D body definitions for the different hold-down types. Without this file, the script cannot generate the visible geometry.\n\n## Tips\n- **Grip Editing**: Instead of calculating exact offset numbers, select the hold-down and drag the blue grip along the beam to slide it to the desired position quickly.\n- **Shop Drawings**: If the hold-down does not appear in your 2D shop drawings, check the **Shop Installed** property. It must be set to \"Yes\" to generate the 2D shadow/profile.\n- **BOM Output**: The script automatically generates hardware components for the Bill of Materials based on the selected hold-down model, including the required fasteners.\n\n## FAQ\n- **Q: Why did the script disappear immediately after running?**\n  A: This usually happens if you did not select a valid Beam or TrussEntity, or if the settings file `holdowns.dxx` is missing from your company folder.\n- **Q: How do I switch the connector to the other side of the wall?**\n  A: Select the connector, open the Properties (Ctrl+1), and change **Beam side** from \"Left\" to \"Right\".\n- **Q: Can I use this on regular lines or polylines?**\n  A: No, you must select a valid hsbCAD Beam or Truss Entity."
      },
      "tokens_used": 6079,
      "error": null
    }
  }
}