{
  "filename": "GE_HDWR_WALL_ANCHOR.mcr",
  "status": "completed",
  "total_tokens": 64483,
  "processing_time": 331.6244351863861,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 9768,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates and manipulates 3D geometry (Body objects like bdRod1), sets model/material properties, and utilizes hardware component generation (_ThisInst.setHardWrComps). No Paper Space logic, _Viewport usage, or sd_ prefix found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D environment)",
          "requiredSettings": []
        }
      },
      "tokens_used": 8665,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"strEmpty1\",\n      \"type\": \"PropString\",\n      \"displayName\": \"==================================================================\",\n      \"defaultValue\": \"==================================================================\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"General Properties\",\n      \"description\": null,\n      \"readOnly\": true\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"strRod\",\n      \"type\": \"PropString\",\n      \"displayName\": \"  Hardware Type\",\n      \"defaultValue\": \"1/2\\\" All Thread\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"1/2\\\" All Thread\",\n        \"5/8\\\" All Thread\",\n        \"3/4\\\" All Thread\",\n        \"1/2\\\" Wedge Anchor\",\n        \"5/8\\\" Wedge Anchor\",\n        \"3/4\\\" Wedge Anchor\",\n        \"1/2\\\" x 6\\\" Titen Screw Anchor\",\n        \"5/8\\\" x 6\\\" Titen Screw Anchor\",\n        \"3/4\\\" x 6\\\" Titen Screw Anchor\",\n        \"1/2\\\" x 6\\\" J-Bolt\",\n        \"1/2\\\" x 8\\\" J-Bolt\",\n        \"1/2\\\" x 10\\\" J-Bolt\",\n        \"5/8\\\" x 6\\\" J-Bolt\",\n        \"5/8\\\" x 8\\\" J-Bolt\",\n        \"5/8\\\" x 10\\\" J-Bolt\",\n        \"5/8\\\" SSTB16\",\n        \"1/2\\\" PAB4\",\n        \"5/8\\\" PAB5\",\n        \"3/4\\\" PAB6\",\n        \"7/8\\\" PAB7\",\n        \"1\\\" All Thread\",\n        \"3/4\\\" x 6\\\" J-Bolt\",\n        \"ATS-RTUD4D\",\n        \"ATS-RTUD5D\",\n        \"ATS-RTUD6D\",\n        \"ATUD5\",\n        \"ATUD6-2\",\n        \"ATUD9\",\n        \"ATUD9-2\",\n        \"ATUD14\",\n        \"TUD10\",\n        \"ATS-R3\",\n        \"ATS-R4\",\n        \"ATS-R5\",\n        \"ATS-R6\",\n        \"ATS-R7\",\n        \"ATS-R8\",\n        \"ATS-R9\",\n        \"ATS-R10\",\n        \"ATS-R11\",\n        \"ATS-R12\",\n        \"ATS-R14\",\n        \"ATS-R16\",\n        \"ATS-HSR4\",\n        \"ATS-HSR5\",\n        \"ATS-HSR6\",\n        \"ATS-HSR7\",\n        \"ATS-HSR8\",\n        \"ATS-HSR9\",\n        \"ATS-HSR10\",\n        \"ATS-HSR11\",\n        \"ATS-HSR12\",\n        \"ATS-HSR14\",\n        \"ATS-HSR16\",\n"
      },
      "tokens_used": 11964,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Generates and configures hold-down anchors (rod tie-downs) for timber frame walls, including drilling holes in plates, modeling washers/nuts, and exporting BOM data.\",\n    \"category\": \"Hardware\",\n    \"typicalUseCase\": \"Inserting a wall anchor (like a Simpson Strong-Tie SSTB or a generic All-Thread rod) into a wall panel to resist uplift forces, ensuring correct embedment depths and plate drilling.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"strRod\",\n      \"technicalDefault\": \"\\\"1/2\\\\\\\" All Thread\\\"\",\n      \"businessMeaning\": \"Selects the specific hardware catalog item to be used. This determines the rod diameter, material type (e.g., Wedge Anchor vs. All Thread), and standard attributes.\",\n      \"validRange\": \"Dropdown list of approx. 50+ hardware types including All Thread, Wedge Anchors, Titen Screws, J-Bolts, SSTB, PAB, and ATS series.\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"Controls rod diameter (`arRodSize`), drill hole size (`arDrillSize`), embedment depth, default washer sizes, and the BOM material description.\"\n    },\n    {\n      \"name\": \"strEmbed\",\n      \"technicalDefault\": \"\\\"Concrete\\\"\",\n      \"businessMeaning\": \"Specifies the substrate material the anchor is embedded into, which dictates the required minimum embedment length.\",\n      \"validRange\": \"Concrete, Masonry\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"Swaps the calculation for required rod embedment depth (e.g., 4\\\" for concrete vs 8\\\" for masonry) and affects BOM length calculations.\"\n    },\n    {\n      \"name\": \"strDrill\",\n      \"technicalDefault\": \"\\\"Yes\\\"\",\n      \"businessMeaning\": \"Toggle to enable or disable the automatic drilling of holes through the wall plates (bottom/top plates) for the anchor rod.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"If 'Yes', generates cylindrical drill operations in the assigned GenBeams/Elements. If 'No', the geometry is purely visual or for BOM.\"\n    },\n    {\n      \"name\": \"strCoupler\",\n      \"technicalDefault\": \"\\\"In floor\\\"\",\n      \"businessMeaning\": \"Determines the location of the rod splice/coupler relative to the concrete floor or upper wall sections.\",\n      \"validRange\": \"In floor, In Upper Wall\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"Alters the vertical placement of the coupler geometry and affects how the rod length is segmented for BOM reporting.\"\n    },\n    {\n      \"name\": \"strCouplerAtBase\",\n      \"technicalDefault\": \"\\\"Yes\\\"\",\n      \"businessMeaning\": \"Forces the placement of a coupler at the very bottom of the anchor run, overriding automatic positioning.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"Adds a coupler component at the base and creates a separate BOM line item for the lower rod segment.\"\n    },\n    {\n      \"name\": \"strForceNuts\",\n      \"technicalDefault\": \"\\\"Yes\\\"\",\n      \"businessMeaning\": \"Ensures that nuts and washers are placed on the bottom plate, even if the geometric logic might otherwise omit them.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"Controls the generation of nut/washer geometry at the bottom plate intersection.\"\n    },\n    {\n      \"name\": \"strWasherTop\",\n      \"technicalDefault\": \"\\\"Default\\\"\",\n      \"businessMeaning\": \"Specifies the size and type of the plate washer to be used on the tension side (top) of the anchor.\",\n      \"validRange\": \"Default, 3\\\"x3\\\"x1/8\\\", 2\\\"x2\\\"x1/8\\\", 3\\\"x3\\\"x1/4\\\", None, 1 1/2\\\" Round, 3\\\"x5\\\"x1/4\\\"\",\n      \"unit\": \"inches\",\n      \"affectsOutput\": \"Changes the dimensions and shape (square vs round) of the 3D washer body and the BOM description.\"\n    },\n    {\n      \"name\": \"strWasherBot\",\n      \"technicalDefault\": \"\\\"Default\\\"\",\n      \"businessMeaning\": \"Specifies the size and type of the plate washer to be used on the compression side (bottom) of the anchor.\",\n      \"validRange\": \"Default, 3\\\"x3\\\"x1/8\\\", 2\\\"x2\\\"x1/8\\\", 3\\\"x3\\\"x1/4\\\", None, 1 1/2\\\" Round, 3\\\"x5\\\"x1/4\\\"\",\n      \"unit\": \"inches\",\n      \"affectsOutput\": \"Changes the dimensions and shape of the bottom washer body and BOM description.\"\n    },\n    {\n      \"name\": \"strCanBeMoved\",\n      \"technicalDefault\": \"\\\"Yes\\\"\",\n      \"businessMeaning\": \"Allows the user to freely drag and reposition the anchor along the wall in the CAD model without being locked to a specific stud spacing logic.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"Modifies the constraint logic of the script instance in the CAD environment.\"\n    },\n    {\n      \"name\": \"dDistFromStud\",\n      \"technicalDefault\": \"U(2)\",\n      \"businessMeaning\": \"Defines the minimum required edge distance between the center of the anchor rod and the nearest stud to prevent wood splitting.\",\n      \"validRange\": \"1.5\\\" to 12\\\" (Typically 1.5\\\" - 3\\\" for standard construction)\",\n      \"unit\": \"inches\",\n      \"affectsOutput\": \"Controls automatic placement logic to avoid collision with studs and influences clearance checks.\"\n    },\n    {\n      \"name\": \"dDistFromRod\",\n      \"technicalDefault\": \"U(3)\",\n      \"businessMeaning\": \"Defines the minimum spacing required between this anchor and adjacent anchors.\",\n      \"validRange\": \"3\\\" to 24\\\"\",\n      \"unit\": \"inches\",\n      \"affectsOutput\": \"Used for collision detection and spacing cleanup logic.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"Change 'Hardware Type' (strRod)\",\n      \"effect\": \"Updates internal indices for rod diameter, drill size, and default washer settings.\",\n      \"cascade\": [\n        \"strWasherTop\",\n        \"strWasherBot\",\n        \"arRodSize\",\n        \"arDrillSize\"\n      ]\n    },\n    {\n      \"trigger\": \"Change 'Embedment' (strEmbed)\",\n      \"effect\": \"Switches the lookup table for required rod depth.\",\n      \"cascade\": [\n        \"arEmbedConcrete\",\n        \"arEmbedMasonry\",\n        \"Calculated Rod Length\"\n      ]\n    },\n    {\n      \"trigger\": \"Set 'Drill Plates' (strDrill) to No\",\n      \"effect\": \"Suppresses all machining operations on the timber elements.\",\n      \"cascade\": [\n        \"Element Drills\",\n        \"GenBeam Drills\"\n      ]\n    }\n  ],\n  \"outputEntities\": [\n    {\n      \"type\": \"Drill\",\n      \"description\": \"Through holes in the bottom and top plates corresponding"
      },
      "tokens_used": 12318,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Execute Script: User runs the command to insert a wall anchor.",
          "2. Select Host Entity: User selects the wall Element or specific GenBeam (plate) to attach the anchor to.",
          "3. Define Location: User specifies the insertion point (Pt0) for the anchor, potentially constrained by stud spacing if 'Free Placement' is disabled.",
          "4. Configure Properties (OPM): User sets parameters via Properties Palette (Hardware Type, Embedment, Washer Sizes, etc.).",
          "5. Calculate Dimensions: Script determines rod diameter, drill size, embedment depth (based on substrate), and total rod length.",
          "6. Generate Geometry: Script creates 3D visualization (Donut, Circle, or Square) and physical hardware bodies (Rods, Washers, Nuts, Couplers).",
          "7. Generate Drills: If 'Drill Plates' is Yes, script creates cylindrical drill operations in the assigned timber elements.",
          "8. Export Data: Script calculates BOM lengths, formats material strings, generates DXA attributes, and sets Hardware Components."
        ],
        "conditionalBranches": [
          {
            "condition": "Hardware Type Selection (strRod)",
            "path1": {
              "name": "All-Thread Rod",
              "steps": [
                "Use standard rod diameter and linear length calculation.",
                "Display as Circle or Sliced Circle (based on arDisplayType).",
                "BOM output uses 'Diameter x Length' format."
              ]
            },
            "path2": {
              "name": "Anchor (Wedge/J-Bolt/SSTB/PAB)",
              "steps": [
                "Lookup specific embedment depth and display type (often Square).",
                "If J-Bolt, apply arJBoltJog offset.",
                "BOM output uses specific catalog codes or 'Diameter x Length' with specific material descriptions.",
                "If PAB/SSTB, specific washers/plates are applied."
              ]
            }
          },
          {
            "condition": "Embedment Substrate (strEmbed)",
            "path1": {
              "name": "Concrete",
              "steps": [
                "Retrieve embedment depth from 'arEmbedConcrete' array.",
                "Typically results in shorter embedment depths (e.g., 4\", 6\")."
              ]
            },
            "path2": {
              "name": "Masonry",
              "steps": [
                "Retrieve embedment depth from 'arEmbedMasonry' array.",
                "Typically results in longer embedment depths (e.g., 8\", 12\") to meet code."
              ]
            }
          },
          {
            "condition": "Drill Plates Toggle (strDrill)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Script identifies the intersection point with bottom/top plates.",
                "Generates a Drill operation (cylinder) in the GenBeam/Element.",
                "Adjusts drill size based on 'arDrillSize' (usually Rod Diameter + tolerance)."
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skips generation of Drill operations in timber.",
                "Only generates the 3D representation of the rod and hardware."
              ]
            }
          },
          {
            "condition": "Coupler Configuration (strCouplerAtBase)",
            "path1": {
              "name": "Yes (Force at Base)",
              "steps": [
                "Calculates a separate rod segment length (Embed + Plate Thickness + 2\").",
                "Adds 'Coupler' to BOM.",
                "Exports 'Acrylic Tie Adhesive' volume.",
                "Exports two separate rod line items to BOM."
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Calculates total rod length as a single value.",
                "Exports single rod line item to BOM.",
                "No coupler geometry added at the base."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Hardware Selection Validity",
            "errorMessage": "Implicitly handled by dropdown, but if index is out of bounds, default values (0) may cause dimension errors.",
            "recovery": "Select a valid hardware type from the OPM dropdown list."
          },
          {
            "check": "Host Element Availability",
            "errorMessage": "Script requires a valid Element or GenBeam to calculate plate heights and generate drills.",
            "recovery": "Ensure a valid wall element or beam is selected before/during insertion."
          },
          {
            "check": "Rod Length Thresholds",
            "errorMessage": "None shown, but logic determines if length exceeds standard cuts (e.g., >96' triggers 8'-0' BOM string).",
            "recovery": "Logic automatically handles length binning for BOM output."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Hardware Configuration",
            "how": "Properties Palette (OPM)",
            "effect": "Changing 'Hardware Type', 'Embedment', or 'Washers' updates the 3D model size, drill hole size, and BOM description."
          },
          {
            "action": "Toggle Drilling",
            "how": "Properties Palette ('Drill Plates')",
            "effect": "Switching from 'Yes' to 'No' removes drill holes from the timber elements; switching to 'Yes' adds them."
          },
          {
            "action": "Adjust Position",
            "how": "Grip Edit or Context Menu Move",
            "effect": "If 'Free Placement' is Yes, user can drag the anchor. If No, position is calculated relative to studs/rods based on 'Minimum distance' settings."
          },
          {
            "action": "Refresh Data",
            "how": "Context Menu Recalculate",
            "effect": "Forces the script to re-evaluate geometry and BOM data based on current property values."
          }
        ]
      },
      "tokens_used": 14149,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_WALL_ANCHOR.mcr\n\n## Overview\nThis script inserts and configures hold-down anchors (rod tie-downs) for timber frame walls. It automatically handles drilling holes in wall plates, models washers and nuts, and generates accurate BOM data based on the selected hardware type and embedment requirements.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script creates 3D geometry (rods, washers) and modifies beam/element data. |\n| Paper Space | No | This script does not generate 2D shop drawings or viewports. |\n| Shop Drawing | No | Processing happens in the 3D model; output is visible in model space and BOM lists. |\n\n## Prerequisites\n- **Required Entities**: A wall **Element** or a specific **GenBeam** (plate) to act as the host.\n- **Minimum Beam Count**: 1 (The host plate).\n- **Required Settings**: None required (uses internal property settings).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `GE_HDWR_WALL_ANCHOR.mcr` from the script list.\n\n### Step 2: Select Host Entity\nCommand Line: `Select Element/Beam:`\nAction: Click on the wall Element or the specific GenBeam (bottom plate) where the anchor will be placed.\n\n### Step 3: Define Location\nCommand Line: `Specify insertion point:`\nAction: Click in the model to place the anchor. \n*Note: If \"Free Placement\" is set to \"No\" in properties, the script may attempt to snap to a valid stud bay automatically.*\n\n### Step 4: Configure Properties\nAction: With the anchor selected, open the **Properties Palette** (Ctrl+1) to adjust hardware type, washer sizes, and embedment settings. The 3D model and drill holes will update automatically.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Hardware Type | Dropdown | 1/2\" All Thread | Selects the specific hardware catalog item (e.g., All Thread, Wedge Anchor, SSTB, PAB). This determines diameter, drill size, and embedment logic. |\n| Embedment | Dropdown | Concrete | Sets the substrate material. \"Concrete\" typically requires shorter embedment than \"Masonry\". |\n| Drill Plates | Dropdown | Yes | If \"Yes\", the script creates cylindrical drill holes in the assigned plates. If \"No\", it only generates the 3D hardware representation. |\n| Coupler | Dropdown | In floor | Determines if the rod splice/coupler is located in the floor system or the upper wall section. |\n| Coupler at Base | Dropdown | Yes | Forces a coupler at the very bottom of the anchor run. This creates a separate BOM line item for the lower rod segment. |\n| Force Nuts | Dropdown | Yes | Ensures nuts and washers are placed on the bottom plate, even if logic might otherwise omit them. |\n| Washer Top | Dropdown | Default | Selects the plate washer type for the top (tension) side. Options include specific dimensions or \"None\". |\n| Washer Bot | Dropdown | Default | Selects the plate washer type for the bottom (compression) side. |\n| Can Be Moved | Dropdown | Yes | Allows the user to drag the anchor freely. If \"No\", placement is constrained by stud spacing logic. |\n| Distance from Stud | Number | 2\" | The minimum edge distance required between the anchor center and the nearest stud. |\n| Distance from Rod | Number | 3\" | The minimum spacing required between this anchor and adjacent anchors. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Forces the script to re-evaluate geometry, drill holes, and BOM data based on current property values. Useful if manual edits or underlying wall geometry changed. |\n\n## Settings Files\n- **Filename**: None specified\n- **Location**: N/A\n- **Purpose**: This script relies on internal hardcoded arrays and OPM properties; no external XML settings file is required.\n\n## Tips\n- **BOM Accuracy**: The script automatically calculates rod lengths. If you change the **Embedment** from Concrete to Masonry, the rod length will increase significantly to meet code requirements.\n- **Visualization**: Different hardware types may display differently (e.g., some anchors show as squares, others as circles) to represent the actual hardware profile.\n- **Drilling**: If you see the anchor rod but no hole in your plate, check the **Drill Plates** property. If it is set to \"No\", the hole will not be machined into the timber.\n- **Couplers**: Use the **Coupler at Base** option when you need a break in the rod right at the foundation level, often used for ease of installation or specific epoxy requirements.\n\n## FAQ\n- **Q: Why is my rod length longer than expected?**\n  **A:** Check the **Embedment** property. If it is set to \"Masonry\", the embedment depth is calculated deeper than standard concrete requirements.\n  \n- **Q: The hole in the plate disappeared after I changed properties.**\n  **A:** You likely toggled **Drill Plates** to \"No\". Switch it back to \"Yes\" and Recalculate the script.\n\n- **Q: Can I move the anchor after placing it?**\n  **A:** Yes, provided **Can Be Moved** is set to \"Yes\". You can use grip points to drag it along the wall. If set to \"No\", you must change the property to \"Yes\" first to unlock the position."
      },
      "tokens_used": 7619,
      "error": null
    }
  }
}