{
  "filename": "hsb_DrawOutline.mcr",
  "status": "completed",
  "total_tokens": 54500,
  "processing_time": 404.57340836524963,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9305,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select physical model entities (ElementWall, Beam, Sheet) and processes their realBody() and coordSys(). It draws geometry using dp.draw() relative to model coordinates. There is no usage of _Viewport, _kPaperSpace, or sd- prefixes, and the script inserts itself into the model database rather than a drawing view."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall",
            "Beam",
            "ElementRoof",
            "Sheet"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbCAD LineTypes (_LineTypes)",
            "Hatch Patterns (_HatchPatterns)",
            "Dimension Styles (_DimStyles)"
          ]
        }
      },
      "tokens_used": 7262,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10045,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Generates a 2D CAD outline of selected structural elements (walls, beams, floors, or sheets) with automatic hatching and coloring based on element type codes.\",\n    \"category\": \"Visualization / Layout Generation\",\n    \"typicalUseCase\": \"Creating 2D floor plans, foundation plans, or approval drawings from the 3D model where different wall types (e.g., External vs. Internal) need distinct visual representations.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sMode\",\n      \"technicalDefault\": \"\\\"Walls\\\"\",\n      \"businessMeaning\": \"Selects the type of structural element to process and outline.\",\n      \"validRange\": \"Walls, Beams, Floors, Sheets\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Determines which entity selection dialog appears and which geometric calculation logic (wall aggregate vs. beam shadow vs. floor profile) is executed.\"\n    },\n    {\n      \"name\": \"sLineType\",\n      \"technicalDefault\": \"_LineTypes\",\n      \"businessMeaning\": \"The CAD line type (e.g., Continuous, Dashed) used to draw the outline geometry.\",\n      \"validRange\": \"Any loaded AutoCAD line type\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Changes the visual line style of the generated outline in the drawing.\"\n    },\n    {\n      \"name\": \"psExtType\",\n      \"technicalDefault\": \"\\\"A;B;\\\"\",\n      \"businessMeaning\": \"List of wall codes (separated by semicolons) that define which walls are classified as 'External'.\",\n      \"validRange\": \"String matching project wall naming codes (e.g., 'EXT;OUT;')\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"If a selected wall's code matches this list, it is drawn with the 'External' specific hatch and color settings.\"\n    },\n    {\n      \"name\": \"sHatchExt\",\n      \"technicalDefault\": \"_HatchPatterns\",\n      \"businessMeaning\": \"The hatch pattern applied to walls identified as External.\",\n      \"validRange\": \"Any loaded AutoCAD hatch pattern or 'None'\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Fills the External wall outline with the specified pattern.\"\n    },\n    {\n      \"name\": \"nColorExt\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"The CAD color index for the outline line of External walls.\",\n      \"validRange\": \"1-255 (AutoCAD Index Colors)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Changes the color of the outline lines for External walls.\"\n    },\n    {\n      \"name\": \"nColorHatchExternal\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"The CAD color index for the hatch pattern of External walls.\",\n      \"validRange\": \"1-255 (AutoCAD Index Colors)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Changes the color of the hatch fill inside External walls.\"\n    },\n    {\n      \"name\": \"psPartyType\",\n      \"technicalDefault\": \"\\\"\\\"\",\n      \"businessMeaning\": \"List of wall codes that define 'Party' (fire/compartment) walls.\",\n      \"validRange\": \"String matching project wall naming codes\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Assigns Party wall specific hatch and color settings to matching walls.\"\n    },\n    {\n      \"name\": \"sHatchParty\",\n      \"technicalDefault\": \"_HatchPatterns\",\n      \"businessMeaning\": \"The hatch pattern applied to Party walls.\",\n      \"validRange\": \"Any loaded AutoCAD hatch pattern or 'None'\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Fills the Party wall outline with the specified pattern.\"\n    },\n    {\n      \"name\": \"nColorParty\",\n      \"technicalDefault\": \"3\",\n      \"businessMeaning\": \"The outline color for Party walls.\",\n      \"validRange\": \"1-255\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Sets the line color for Party wall outlines.\"\n    },\n    {\n      \"name\": \"nColorHatchParty\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"The hatch color for Party walls.\",\n      \"validRange\": \"1-255\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Sets the hatch color for Party walls.\"\n    },\n    {\n      \"name\": \"psLoadBearingType\",\n      \"technicalDefault\": \"\\\"A;B;\\\"\",\n      \"businessMeaning\": \"List of wall codes that define Load Bearing walls.\",\n      \"validRange\": \"String matching project wall naming codes\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Assigns Load Bearing specific hatch and color settings to matching walls.\"\n    },\n    {\n      \"name\": \"sHatchLoadBearing\",\n      \"technicalDefault\": \"_HatchPatterns\",\n      \"businessMeaning\": \"The hatch pattern for Load Bearing walls.\",\n      \"validRange\": \"Any loaded AutoCAD hatch pattern or 'None'\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Fills Load Bearing walls with the specified pattern.\"\n    },\n    {\n      \"name\": \"nColorLoadBearing\",\n      \"technicalDefault\": \"4\",\n      \"businessMeaning\": \"The outline color for Load Bearing walls.\",\n      \"validRange\": \"1-255\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Sets the line color for Load Bearing wall outlines.\"\n    },\n    {\n      \"name\": \"nColorHatchBearing\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"The hatch color for Load Bearing walls.\",\n      \"validRange\": \"1-255\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Sets the hatch color for Load Bearing walls.\"\n    },\n    {\n      \"name\": \"psIntType\",\n      \"technicalDefault\": \"\\\"D;E;\\\"\",\n      \"businessMeaning\": \"List of wall codes that define Internal (non-load-bearing) walls.\",\n      \"validRange\": \"String matching project wall naming codes\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Assigns Internal wall specific hatch and color settings to matching walls.\"\n    },\n    {\n      \"name\": \"sHatchInt\",\n      \"technicalDefault\": \"_HatchPatterns\",\n      \"businessMeaning\": \"The hatch pattern for Internal walls.\",\n      \"validRange\": \"Any loaded AutoCAD hatch pattern or 'None'\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Fills Internal walls with the specified pattern.\"\n    },\n    {\n      \"name\": \"nColorInt\",\n      \"technicalDefault\": \"2\",\n      \"businessMeaning\": \"The outline color for Internal walls.\",\n      \"validRange\": \"1-255\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Sets the line color for Internal wall outlines.\"\n    },\n    {\n      \"name\": \"nColorHatchInternal\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"The hatch color for Internal walls.\",\n      \"validRange\": \"1-255\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Sets the hatch color for Internal walls.\"\n    },\n    {\n      \"name\": \"sHatch\",\n      \"technicalDefault\": \"_HatchPatterns\",\n      \"businessMeaning\": \"The default hatch pattern for walls that do not match any specific code (Other).\",\n      \"validRange\": \"Any loaded AutoCAD hatch pattern or 'None'\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Fills uncategorized walls with this pattern.\"\n    },\n    {\n      \"name\": \"nColor\",\n      \"technicalDefault\": \"3\",\n      \"businessMeaning\": \"The default outline color for uncategorized walls.\",\n      \"validRange\": \"1-255\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Sets the line color for uncategorized wall outlines.\"\n    },\n    {\n      \"name\": \"nColorHatch\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"The default hatch color for uncategorized walls.\",\n      \"validRange\": \"1-255\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Sets the hatch color for uncategorized walls.\"\n    },\n    {\n      \"name\": \"sGr"
      },
      "tokens_used": 9625,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Initialization\",\n    \"2. Load Property Values from Catalog (if available)\",\n    \"3. User Input Phase (If _bOnInsert):\",\n    \"   3a. Determine Execution Mode (Walls, Beams, Floors, or Sheets)\",\n    \"   3b. Prompt User to Select Entities (PrEntity dialog) based on Mode\",\n    \"   3c. Store selected entities in internal array (_Element, _Beam, or _Sheet)\",\n    \"4. Validation Phase:\",\n    \"   4a. Check if any entities were selected\",\n    \"   4b. If 0 entities selected: Report Error, Erase Instance, Exit\",\n    \"5. Geometry Processing Phase (Every Recalculation):\",\n    \"   5a. Calculate collective geometry (Shadow profiles, RealBodies, or Display outlines)\",\n    \"   5b. Determine Coordinate System and Orientation\",\n    \"   5c. Calculate Translation Vector (if Script Instance or Origin Point has moved)\",\n    \"6. Classification & Styling Phase:\",\n    \"   6a. For each element, retrieve its Code\",\n    \"   6b. Compare Code against User Defined Lists (External, Party, LoadBearing, Internal)\",\n    \"   6c. Assign LineType, Color, and Hatch Pattern based on classification match or Default\",\n    \"7. Drawing Phase:\",\n    \"   7a. Transform geometry if translation is required\",\n    \"   7b. Draw Hatch patterns (if enabled)\",\n    \"   7c. Draw Outline lines\",\n    \"   7d. Draw Dimension labels and Openings (for Walls mode if enabled)\",\n    \"   7e. Draw Element Number (for Floors mode)\",\n    \"8. Organization Phase:\",\n    \"   8a. Assign Script Instance to specified Groups (House Level / Floor Level)\",\n    \"   8b. Update Map Points to lock geometry origin\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Script Execution Mode (sMode)\",\n      \"path1\": {\n        \"name\": \"Walls (Mode 0)\",\n        \"steps\": [\n          \"Select ElementWall entities\",\n          \"Classify Wall Code\",\n          \"Apply specific Wall Type Hatch/Color\",\n          \"Draw Outline + Openings + Labels\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Beams (Mode 1)\",\n        \"steps\": [\n          \"Select Beam entities\",\n          \"Calculate Shadow Profile on XY Plane\",\n          \"Apply generic Beam Hatch/Color\",\n          \"Add 'Add/Remove Beams' Context Menu Items\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"Floors (Mode 2)\",\n        \"steps\": [\n          \"Select ElementRoof entities\",\n          \"Merge all beams/sheets into one Floor Body\",\n          \"Draw Outer Boundary/Hide Display lines\",\n          \"Label Element Number at Centroid\"\n        ]\n      },\n      \"path4\": {\n        \"name\": \"Sheets (Mode 3)\",\n        \"steps\": [\n          \"Select Sheet entities\",\n          \"Calculate Shadow Profile\",\n          \"Apply generic Sheet Hatch/Color\",\n          \"Add 'Add/Remove Sheets' Context Menu Items\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Wall Code Classification (Only for Walls Mode)\",\n      \"path1\": {\n        \"name\": \"Matched Specific Code\",\n        \"steps\": [\n          \"Check if Code is in 'External' List -> Apply Ext Settings\",\n          \"Else Check if Code is in 'Party' List -> Apply Party Settings\",\n          \"Else Check if"
      },
      "tokens_used": 11706,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_DrawOutline.mcr\n\n## Overview\nGenerates a 2D CAD outline of selected structural elements (walls, beams, floors, or sheets) with automatic hatching and coloring based on element type codes.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script generates geometry in the 3D model, typically on the XY plane. |\n| Paper Space | No | |\n| Shop Drawing | No | This script is for model layouts, not production drawings. |\n\n## Prerequisites\n- **Required Entities**: ElementWall, Beam, ElementRoof, or Sheet (depending on selected mode).\n- **Minimum Count**: At least 1 entity must be selected.\n- **Required Settings**:\n    - hsbCAD Line Types (`_LineTypes`)\n    - Hatch Patterns (`_HatchPatterns`)\n    - Dimension Styles (`_DimStyles`)\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_DrawOutline.mcr` from the list.\n\n### Step 2: Select Execution Mode\n```\nDialog Box/Command Line: Select Mode\nAction: Choose the type of element to outline (Walls, Beams, Floors, or Sheets).\n```\n\n### Step 3: Select Elements\n```\nPrompt: Select [Element Type]\nAction: Select the desired walls, beams, floors, or sheets from the model view. Press Enter to confirm selection.\n```\n\n### Step 4: Insertion\n```\nPrompt: Specify insertion point\nAction: Click in the model to place the script instance. The 2D outline will be generated based on the selected elements.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **sMode** | Enum | Walls | Selects the type of structural element to process (Walls, Beams, Floors, Sheets). |\n| **sLineType** | String | _LineTypes | The CAD line type (e.g., Continuous) used for the outline geometry. |\n| **Wall Classification (External)** | | | |\n| psExtType | String | A;B; | List of wall codes (separated by semicolons) defining External walls. |\n| sHatchExt | String | _HatchPatterns | Hatch pattern applied to External walls. |\n| nColorExt | Index | 1 | Outline color index for External walls. |\n| nColorHatchExternal | Index | 1 | Hatch color index for External walls. |\n| **Wall Classification (Party)** | | | |\n| psPartyType | String | | List of wall codes defining Party (fire/compartment) walls. |\n| sHatchParty | String | _HatchPatterns | Hatch pattern applied to Party walls. |\n| nColorParty | Index | 3 | Outline color index for Party walls. |\n| nColorHatchParty | Index | 1 | Hatch color index for Party walls. |\n| **Wall Classification (Load Bearing)** | | | |\n| psLoadBearingType | String | A;B; | List of wall codes defining Load Bearing walls. |\n| sHatchLoadBearing | String | _HatchPatterns | Hatch pattern applied to Load Bearing walls. |\n| nColorLoadBearing | Index | 4 | Outline color index for Load Bearing walls. |\n| nColorHatchBearing | Index | 1 | Hatch color index for Load Bearing walls. |\n| **Wall Classification (Internal)** | | | |\n| psIntType | String | D;E; | List of wall codes defining Internal (non-load-bearing) walls. |\n| sHatchInt | String | _HatchPatterns | Hatch pattern applied to Internal walls. |\n| nColorInt | Index | 2 | Outline color index for Internal walls. |\n| nColorHatchInternal | Index | 1 | Hatch color index for Internal walls. |\n| **Default Settings (Other)** | | | |\n| sHatch | String | _HatchPatterns | Default hatch pattern for uncategorized walls. |\n| nColor | Index | 3 | Default outline color for uncategorized walls. |\n| nColorHatch | Index | 1 | Default hatch color for uncategorized walls. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add/Remove Beams | (Beams Mode) Opens the selection dialog to add or remove beams from the outline set. |\n| Add/Remove Sheets | (Sheets Mode) Opens the selection dialog to add or remove sheets from the outline set. |\n| Recalculate | Refreshes the geometry if elements have moved or properties have changed. |\n\n## Settings Files\n- **LineTypes**: Managed via standard hsbCAD `_LineTypes` catalog.\n- **Hatch Patterns**: Managed via standard hsbCAD `_HatchPatterns` catalog.\n- **Purpose**: These define the visual styles available in the Properties Panel dropdowns.\n\n## Tips\n- **Coding Strategy**: Ensure your Wall Names in the model (e.g., `Wall_Ext_200`) contain the specific codes defined in the properties (e.g., `Ext`) to trigger the correct hatching automatically.\n- **Floors Mode**: When using Floors mode, the script merges all selected elements into a single body and labels it with the Element Number at the centroid.\n- **Organization**: The script automatically assigns itself to House Level and Floor Level groups for better model organization.\n\n## FAQ\n- Q: Why are my walls not hatching?\n- A: Check that the **Code** in the wall's properties matches one of the lists in the script properties (e.g., `psExtType`). Ensure the semicolons are used correctly as separators.\n- Q: How do I change the color of all external walls at once?\n- A: Select the script instance, open the Properties Palette, and change the `nColorExt` value.\n- Q: Can I use this for roof plans?\n- A: Yes, select \"Floors\" or \"Beams\" mode to generate a top-down shadow/profile of roof elements."
      },
      "tokens_used": 6557,
      "error": null
    }
  }
}