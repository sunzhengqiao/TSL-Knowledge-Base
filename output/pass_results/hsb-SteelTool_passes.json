{
  "filename": "hsb-SteelTool.mcr",
  "status": "completed",
  "total_tokens": 53681,
  "processing_time": 272.2168574333191,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9765,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getBeam(), Beam, Element, Body, addTool(), and assigns to Element Groups. Logic handles 3D geometric operations (envelopeBody, intersections, Drill, BeamCut). No _Viewport, sd_ prefix, Multipage, or #Type E found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space (beams must exist and be selected)",
          "requiredSettings": []
        }
      },
      "tokens_used": 7144,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getBeam\",\n        \"promptOriginal\": \"Select the male beam\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getBeam\",\n        \"promptOriginal\": \"Select the famale beam\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"ShowDynamicDialog\",\n      \"trigger\": \"On Insert if _kExecuteKey is empty\",\n      \"title\": \"hsb-SteelTool Properties\",\n      \"dataSource\": \"TSL Instance Properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sSeperator01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Properties\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sCatName\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Use properties from catalog\",\n      \"defaultValue\": \"Manual\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Manual\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sSeperator02\",\n      \"type\": \"PropString\",\n      \"displayName"
      },
      "tokens_used": 10457,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Generates machining operations (drills, cuts, swages, dimples) for connections between two structural beams, typically for light gauge steel or timber-to-steel connections.\",\n    \"category\": \"Connection / Machining\",\n    \"typicalUseCase\": \"Connecting two beams (e.g., C-sections or timber beams) where specific prep work like notching, swaging, or drilling is required to accommodate the connection geometry.\"\n  },\n  \"parameters\": [\n    {\n      \"name\":"
      },
      "tokens_used": 10489,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Define properties (Separators, Tooling options, Zones, Visualization, Chamfer settings).",
          "2. Database Creation: Set properties from catalog if _kExecuteKey is provided.",
          "3. Insert Phase (_bOnInsert): Prompt user to Select Male Beam.",
          "4. Insert Phase: Prompt user to Select Female Beam.",
          "5. Validation: Check if Male beam belongs to a valid Element.",
          "   [Branch] -> Invalid: Report 'No valid element found', erase instance, exit.",
          "   [Branch] -> Valid: Continue.",
          "6. Logic: Check Element for existing hsb-SteelTool instances connecting the same two beams.",
          "   [Branch] -> Duplicate found: Erase the old instance.",
          "7. UI: Show Dynamic Dialog if _kExecuteKey is empty.",
          "8. Execution Phase: Check if _Beam array length equals 2.",
          "   [Branch] -> Not 2: Report 'Two beams are required!', erase instance, exit.",
          "9. Logic: Assign Male and Female beams, generate envelope bodies, and assign instance to Element Group.",
          "10. Logic: Parse 'Zones for applying no nail areas' string into integer array.",
          "11. Logic: Map Property selections (Service hole, Web notch, etc.) to Tool Code arrays for Male and Female beams.",
          "12. Geometry: Calculate intersection points, vectors, and connection angles.",
          "13. Processing: Iterate through Male Tool Codes.",
          "   [Branch] -> Tool Code 0 (Service Hole): Create Drill.",
          "   [Branch] -> Tool Code 1 (Web Notch): Create BeamCut (adjusts gap if angled).",
          "   [Branch] -> Tool Code 2 (Lip Notch): Create BeamCut.",
          "   [Branch] -> Tool Code 3 (Web Hole): Create Drill.",
          "   [Branch] -> Tool Code 4 (Dimple): Create Drill.",
          "   [Branch] -> Tool Code 5 (Swage): Calculate Swage size.",
          "   [Branch] -> Tool Code 8 (End Chamfer): Calculate static cuts based on beam angle (Shallow vs Standard).",
          "14. CNC Export: Map tool attributes (Position, Code, Size, Flag) to CNC Export object for Male.",
          "15. Processing: Iterate through Female Tool Codes (same logic as Male).",
          "16. Completion: Finish script execution."
        ],
        "conditionalBranches": [
          {
            "condition": "Element Validation during Insert",
            "path1": {
              "name": "Element Valid",
              "steps": [
                "Retrieve existing TSLs from Element",
                "Check for duplicates",
                "Show Dialog"
              ]
            },
            "path2": {
              "name": "Element Invalid",
              "steps": [
                "Report Error Message",
                "Erase Instance",
                "Exit Script"
              ]
            }
          },
          {
            "condition": "Beam Count Check on Recalculation",
            "path1": {
              "name": "Valid (2 Beams)",
              "steps": [
                "Calculate geometry",
                "Apply tools"
              ]
            },
            "path2": {
              "name": "Invalid (!= 2 Beams)",
              "steps": [
                "Report 'Two beams are required!'",
                "Erase Instance"
              ]
            }
          },
          {
            "condition": "Tool Application Target (Property Value)",
            "path1": {
              "name": "Male Only",
              "steps": [
                "Add Tool Code to Male Array",
                "Skip Female Array"
              ]
            },
            "path2": {
              "name": "Both",
              "steps": [
                "Add Tool Code to Male Array",
                "Add Tool Code to Female Array"
              ]
            }
          },
          {
            "condition": "Connection Angle (Web Notch/Lip Cut)",
            "path1": {
              "name": "Perpendicular (~90 deg)",
              "steps": [
                "Use standard Gap (dGapWebNotch/dGapLipCut)"
              ]
            },
            "path2": {
              "name": "Angled (!= 90 deg)",
              "steps": [
                "Multiply Gap by 3 for clearance"
              ]
            }
          },
          {
            "condition": "End Chamfer Calculation",
            "path1": {
              "name": "Shallow Angle (< 45 or > 135)",
              "steps": [
                "Calculate specific intersection vectors based on rotation factor -1",
                "Define Cut planes using specific offset logic"
              ]
            },
            "path2": {
              "name": "Standard Angle (45 - 135)",
              "steps": [
                "Calculate standard intersection vectors",
                "Define Cut planes using half-width logic"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element attached to Male Beam",
            "errorMessage": "No valid element found during insert",
            "recovery": "Ensure the selected beam is part of a valid hsbCAD Element and re-insert."
          },
          {
            "check": "Number of assigned beams",
            "errorMessage": "Two beams are required!",
            "recovery": "Ensure the script instance is linked to exactly two beams. If a beam was deleted, the instance is erased automatically."
          },
          {
            "check": "Unknown Tool Code",
            "errorMessage": "Unknowm tool found!",
            "recovery": "Internal check; report to developer if generated in log."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Tooling Configuration",
            "how": "OPM Properties Palette (Tooling Group)",
            "effect": "Changes which tools (Service Hole, Notch, Swage, etc.) are generated on Male/Female/Both beams. Triggers recalculation."
          },
          {
            "action": "Adjust Dimensions",
            "how": "OPM Properties Palette (Chamfer/Visualization Group)",
            "effect": "Updates 'Flat end length', 'Text size', or 'No nail area size'. Recalculates geometry."
          },
          {
            "action": "Catalog Selection",
            "how": "OPM Properties Palette (Use properties from catalog)",
            "effect": "Loads a predefined set of properties from a catalog entry."
          }
        ]
      },
      "tokens_used": 10196,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb-SteelTool.mcr\n\n## Overview\nThis script automates the creation of machining operations (such as drilling, notching, swaging, and dimpling) for connections between two structural beams. It is typically used for light gauge steel or timber-to-steel connections to prepare beams for assembly.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be inserted in the 3D model. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | This is a model generation tool, not a drawing annotation tool. |\n\n## Prerequisites\n- **Required Entities**: Two `GenBeam` entities (beams) existing in the model.\n- **Minimum Beam Count**: 2 (One Male, One Female).\n- **Required Settings**: The Male beam must belong to a valid hsbCAD Element.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsb-SteelTool.mcr`\n\n### Step 2: Select the Male Beam\n```\nCommand Line: Select the male beam\nAction: Click on the primary beam (usually the beam being cut or modified to receive the other).\n```\n\n### Step 3: Select the Female Beam\n```\nCommand Line: Select the famale beam\nAction: Click on the secondary beam (the intersecting beam).\n```\n\n### Step 4: Configure Properties\nAfter selection, the script validates the beams and Element. If successful, the **Properties Palette** will display the \"hsb-SteelTool Properties\" dialog. Adjust tooling options (holes, notches, etc.) and click **Apply** or **OK** to generate the geometry.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Use properties from catalog | dropdown | Manual | Select a predefined configuration from the catalog if available. |\n| Properties (Seperator) | - | - | Visual separator for the tooling section. |\n| Service hole | Option | - | If enabled, creates a service hole on the selected beam. |\n| Web notch | Option | - | If enabled, creates a notch in the web of the beam. |\n| Lip notch | Option | - | If enabled, cuts the lip (flange edge) of the section. |\n| Web hole | Option | - | If enabled, creates a specific hole in the web. |\n| Dimple | Option | - | If enabled, creates a dimple depression. |\n| Swage | Option | - | If enabled, creates a swage (indentation) in the beam. |\n| End Chamfer | Option | - | If enabled, applies a chamfer to the beam end. |\n| Flat end length | Number | - | Defines the length of the flat portion at the end of the beam before cuts. |\n| Zones for applying no nail areas | Text | - | Integer string defining zones for no-nail areas. |\n| Text size | Number | - | Adjusts the size of visualization text/labels. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Re-runs the script logic to update machining based on current property values or beam geometry changes. |\n| Erase | Removes the script instance and the associated machining. |\n\n## Settings Files\n- **Filename**: Catalog files (XML structure, specific name depends on `sCatName` mapping).\n- **Location**: Company or hsbCAD Install path.\n- **Purpose**: Stores predefined sets of properties (tool codes and dimensions) to standardize connections.\n\n## Tips\n- **Angle Handling**: If beams are connected at an angle (not 90°), the script automatically increases the gap for Web Notches and Lip Cuts (multiplies gap by 3) to ensure fit.\n- **Duplicate Handling**: If you run the script on the same two beams again, it will automatically erase the old instance to prevent conflicts.\n- **Element Validation**: Ensure the first beam (Male) is part of an Element. If you see \"No valid element found,\" check your beam structure.\n- **CNC Data**: This script maps tool attributes to the CNC Export object, ensuring machining data is available for production.\n\n## FAQ\n- Q: I got the error \"Two beams are required!\"\n- A: The script instance has lost its link to one or both beams (perhaps one was deleted). Erase the instance and re-run the command.\n- Q: What is the difference between Male and Female beams?\n- A: In this context, the Male beam is usually the primary member (the one you select first) that receives the machining or features to accommodate the Female (second) beam.\n- Q: Can I apply tools to both beams?\n- A: Yes, depending on the specific property configuration (Tool Codes), tools can be applied to the Male beam only, the Female beam only, or both."
      },
      "tokens_used": 5630,
      "error": null
    }
  }
}