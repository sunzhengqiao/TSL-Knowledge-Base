{
  "filename": "GenericHangerExcelImporter.mcr",
  "status": "completed",
  "total_tokens": 45684,
  "processing_time": 402.27601432800293,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.9",
            "date": "05.02.2025",
            "author": "Thorsten Huck",
            "changes": "HSB-23100 version distinction .net8 added"
          },
          {
            "version": "1.8",
            "date": "17.03.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-14929 multiple block overrides added (i.e. SDE)"
          },
          {
            "version": "1.7",
            "date": "16.03.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-14929 numeric fixture article numbers supported"
          },
          {
            "version": "1.6",
            "date": "15.03.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-14929 Fixture import added"
          },
          {
            "version": "1.5",
            "date": "25.02.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-14805 bugfix writing map key"
          },
          {
            "version": "1.4",
            "date": "25.02.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-14805 now supporting individual files for localisation"
          },
          {
            "version": "1.3",
            "date": "21.02.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-14639 supporting adjustable straps"
          },
          {
            "version": "1.2",
            "date": "21.02.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-14324 bugfix writing new manufacturer"
          },
          {
            "version": "1.1",
            "date": "04.02.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-14324 joist and alpha ranges added"
          },
          {
            "version": "1.0",
            "date": "02.02.2020",
            "author": "",
            "changes": "HSB-14324 initial version"
          }
        ],
        "settingsFiles": [
          "GenericHanger.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 8761,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No usage of _Viewport, _kPaperSpace, sd_*, or Multipage* prefixes. The script interacts with MapObjects, XML files, and .NET assemblies (hsbExcelToMap) for importing hanger data. It contains no geometric construction logic (Body/GenBeam) or drawing generation that would place it in Paper Space or Shop Drawing contexts."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "None (Script runs as a utility/tool import)",
          "requiredSettings": [
            "GenericHanger.xml",
            "hsbExcelToMap.dll or hsbExcelToMap.exe"
          ]
        }
      },
      "tokens_used": 5799,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Excel File Dialog",
            "trigger": "Script Insert (_bOnInsert)",
            "title": "Select xlsx file",
            "dataSource": "External .NET assembly 'hsbExcelToMap' (hsbExcelToMap.dll or hsbExcelToMap.exe)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sLastPath",
            "type": "PropString",
            "displayName": "|Path|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|General|",
            "description": "|Defines the last used path|"
          },
          {
            "index": 1,
            "variable": "sImport",
            "type": "PropString",
            "displayName": "|Sheet Import|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "<|All Sheets|>"
            ],
            "category": "|General|",
            "description": "|Defines the Import|"
          },
          {
            "index": 2,
            "variable": "sImportMode",
            "type": "PropString",
            "displayName": "|Import Mode|",
            "defaultValue": "|Drawing|",
            "inputType": "dropdown",
            "options": [
              "|Drawing|",
              "|Drawing + Company XML|"
            ],
            "category": "|General|",
            "description": "|Defines the ImportMode|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "GenericHanger.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings\\"
            ],
            "purpose": "Stores version information, default manufacturers, and configuration settings.",
            "required": true
          },
          {
            "filename": "[ManufacturerName].xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings"
            ],
            "purpose": "Exports imported manufacturer data and fixtures if Import Mode is set to 'Drawing + Company XML'.",
            "required": false
          }
        ]
      },
      "tokens_used": 7100,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Imports manufacturer hanger data, dimensions, and fixture configurations from Excel spreadsheets into the hsbCAD database to automate the creation of hanger libraries.",
          "category": "Data Import/Configuration",
          "typicalUseCase": "Used when updating or creating a library of timber hangers (e.g., Simpson Strong-Tie) from manufacturer Excel catalogs, allowing hangers to be automatically applied to beams without manual entry."
        },
        "parameters": [
          {
            "name": "sLastPath",
            "technicalDefault": "\"\"",
            "businessMeaning": "Stores the directory path of the most recently used Excel import file to facilitate quicker re-imports.",
            "validRange": "Valid local or network file path (e.g., C:\\Projects\\Hangers\\Simpson.xlsx)",
            "unit": "String (Path)",
            "affectsOutput": "Workflow efficiency only; no impact on physical geometry or data."
          },
          {
            "name": "sImport",
            "technicalDefault": "\"<|All Sheets|>\"",
            "businessMeaning": "Specifies which worksheet tab from the Excel file to import. It lists only tabs containing valid hanger data headers.",
            "validRange": "Specific sheet name (e.g., \"HUS-26\") or \"<|All Sheets|>\"",
            "unit": "String",
            "affectsOutput": "Filters the specific dataset (manufacturer/series) written to the hsbCAD database."
          },
          {
            "name": "sImportMode",
            "technicalDefault": "\"|Drawing|\"",
            "businessMeaning": "Controls the persistence of the imported data. 'Drawing' restricts data to the current project, while 'Drawing + Company XML' exports the data to a shared settings file for use across all projects.",
            "validRange": "\"|Drawing|\", \"|Drawing + Company XML|\"",
            "unit": "Enumeration",
            "affectsOutput": "Determines whether the imported hanger definitions are saved locally or globally to the company standards folder."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User selects Excel file on Insert",
            "effect": "Script parses the file to find valid worksheets. The 'sImport' dropdown list is dynamically populated with the names of these sheets.",
            "cascade": [
              "sImport"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "MapObject / XML Data",
            "description": "Database entries defining hanger properties (Product, Family, Dimensions A-P, Heights, Joist widths, associated Fixtures/Blocks). These are non-geometric definitions used by other scripts to generate physical hangers.",
            "appliedTo": "hsbCAD Dictionary (Project or Company level)"
          }
        ]
      },
      "tokens_used": 7380,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User inserts script (via command TSLCONTENT)",
          "2. Script checks for duplicate insert cycles; erases instance if detected",
          "3. Retrieve 'sLastPath' property (default empty)",
          "4. Call external .NET assembly (hsbExcelToMap) to parse Excel file",
          "5. External .NET tool displays 'Select xlsx file' dialog",
          "6. User selects Excel source file",
          "7. .NET tool returns Map data containing sheet names and content to script",
          "8. Script iterates through returned sheets to validate data (checks for Manufacturer, Family, Article columns)",
          "9. Populate 'sImport' property dropdown with valid sheet names and '<|All Sheets|>'",
          "10. User modifies 'sImport' (Sheet) or 'sImportMode' properties via OPM (Properties Palette)",
          "11. Property modification triggers script recalculation",
          "12. Script iterates through rows of selected sheet(s)",
          "13. For each row: Extract dimensions (A-P, t), Joist ranges, Alpha values, and Fixture references",
          "14. Construct MapObject entry for the Hanger (key: GenericHanger_[Manufacturer])",
          "15. Update Database: Create new or overwrite existing MapObject entry",
          "16. Check 'sImportMode': If 'Drawing + Company XML' (Index 1), export Map to XML file in Company Settings",
          "17. Update 'GenericHanger.xml' settings file with new manufacturer if added",
          "18. Report number of articles imported and export status to command line",
          "19. If not in Debug mode, erase script instance from drawing"
        ],
        "conditionalBranches": [
          {
            "condition": "Cycle Check (Is this a re-calculation immediately after insert?)",
            "path1": {
              "name": "Subsequent Cycle",
              "steps": [
                "Erase instance and exit (prevents loops)"
              ]
            },
            "path2": {
              "name": "First Cycle",
              "steps": [
                "Continue to file processing"
              ]
            }
          },
          {
            "condition": "Sheet Data Validation",
            "path1": {
              "name": "Valid Headers Found",
              "steps": [
                "Add sheet name to import list",
                "Process data"
              ]
            },
            "path2": {
              "name": "Invalid/Empty Sheet",
              "steps": [
                "Skip sheet",
                "If no valid sheets exist, report error and erase instance"
              ]
            }
          },
          {
            "condition": "Fixture Assignment",
            "path1": {
              "name": "Valid Fixture",
              "steps": [
                "Add fixture to product Map"
              ]
            },
            "path2": {
              "name": "Invalid Fixture",
              "steps": [
                "Report warning ('key [Fixture] not found')",
                "Skip specific fixture assignment"
              ]
            }
          },
          {
            "condition": "Import Mode Property",
            "path1": {
              "name": "Drawing (Index 0)",
              "steps": [
                "Save data to current project database only"
              ]
            },
            "path2": {
              "name": "Drawing + Company XML (Index 1)",
              "steps": [
                "Save data to current project",
                "Write XML file to _kPathHsbCompany\\TSL\\Settings"
              ]
            }
          },
          {
            "condition": "Debug State",
            "path1": {
              "name": "Debug = False (Default)",
              "steps": [
                "Erase instance after completion"
              ]
            },
            "path2": {
              "name": "Debug = True",
              "steps": [
                "Keep instance in drawing for inspection"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Excel File Selection",
            "errorMessage": "Implicit failure in .NET tool if canceled/invalid",
            "recovery": "User must select a valid Excel file in the dialog."
          },
          {
            "check": "Data Headers",
            "errorMessage": "\"Could not find any data in [Path]\"",
            "recovery": "User must ensure Excel file contains required columns (Manufacturer, Family, Article) and re-run script."
          },
          {
            "check": "Fixture Reference",
            "errorMessage": "\"key [FixtureKey] not found in [FixtureList]\"",
            "recovery": "User must define the fixture in the Excel 'Fixture' sheet or ensure correct spelling."
          },
          {
            "check": "Manufacturer Registration",
            "errorMessage": "None explicit, but logic handles duplicate checks.",
            "recovery": "N/A - Script appends new manufacturers automatically to settings."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Import Source/Mode",
            "how": "OPM Properties (Sheet Import / Import Mode)",
            "effect": "Triggers re-import process. Note: Script typically erases itself, so re-editing usually requires re-insertion unless Debug mode is active."
          },
          {
            "action": "Access Imported Hangers",
            "how": "Generic Hanger Script (Separate tool)",
            "effect": "Uses the imported MapObjects to place physical hanger geometry on beams."
          }
        ]
      },
      "tokens_used": 8877,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GenericHangerExcelImporter.mcr\n\n## Overview\nImports manufacturer hanger data (dimensions, heights, fixtures) from Excel spreadsheets into the hsbCAD database. This script automates the creation of hanger libraries so that physical hangers can be applied to beams using the Generic Hanger tool.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This is a utility script that updates the database and runs in the model environment. |\n| Paper Space | No | Not applicable. |\n| Shop Drawing | No | Not applicable. |\n\n## Prerequisites\n- **Required entities:** None.\n- **Minimum beam count:** 0.\n- **Required settings files:**\n  - `GenericHanger.xml` (Must be located in `_kPathHsbCompany\\TSL\\Settings` or the Install path).\n  - `hsbExcelToMap.dll` or `hsbExcelToMap.exe` (External .NET tool used to parse Excel files).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or `TSLCONTENT`)\nAction: Select `GenericHangerExcelImporter.mcr` from the file browser and click **Open**.\n\n### Step 2: Select Excel File\n```\nDialog: Select xlsx file\nAction: Navigate to the manufacturer's Excel file and select it.\n```\n*Note: This dialog is provided by the external hsbExcelToMap tool. The script will automatically parse the file to find valid worksheets containing the required headers (Manufacturer, Family, Article).*\n\n### Step 3: Complete Import\nAction: Once the file is selected, the script automatically imports the data into the current project's dictionary (MapObjects).\n*Note: The script instance will automatically erase itself from the drawing after the import is complete to keep the drawing clean.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Path | text | (empty) | Stores the directory path of the last used Excel file. |\n| Sheet Import | dropdown | <All Sheets> | Specifies which worksheet tab to import. Options are populated dynamically after the file is scanned. |\n| Import Mode | dropdown | Drawing | Determines where the data is saved.<br>**Drawing**: Saves hangers only for the current project.<br>**Drawing + Company XML**: Saves to the project AND exports an XML file to the Company Standards folder (`_kPathHsbCompany\\TSL\\Settings`) for use in all projects. |\n\n## Right-Click Menu Options\n*No specific context menu items are defined for this script.*\n\n## Settings Files\n- **Filename:** `GenericHanger.xml`\n- **Location:** `_kPathHsbCompany\\TSL\\Settings` or Install folder.\n- **Purpose:** Stores default manufacturer configurations and version information. It is updated automatically if a new manufacturer is detected during import.\n\n- **Filename:** `[ManufacturerName].xml` (e.g., `Simpson.xml`)\n- **Location:** `_kPathHsbCompany\\TSL\\Settings`\n- **Purpose:** If \"Import Mode\" is set to \"Drawing + Company XML\", this file is created/updated to export the imported hanger definitions as a company-wide standard.\n\n## Tips\n- **Excel Format:** Ensure your Excel file contains the required header columns (e.g., Manufacturer, Family, Article, Dimensions A-P). If these are missing, the script will report \"Could not find any data.\"\n- **Company Standards:** To make imported hangers available to all projects, change the **Import Mode** to \"Drawing + Company XML\". *Note: You may need to modify this property immediately upon insertion before the script finishes processing, depending on your specific setup.*\n- **Updating Data:** You can run this script multiple times. If a hanger with the same Article number already exists, it will be overwritten with the new data from Excel.\n- **Verification:** After running the script, use the Generic Hanger tool to place a hanger and verify that the new products appear in the selection list.\n\n## FAQ\n- **Q: The script disappeared immediately after I selected the file. Is that normal?**\n  - A: Yes. This is a \"fire-and-forget\" utility script. It updates the database and erases itself from the drawing to prevent clutter.\n  \n- **Q: I got an error \"Could not find any data\". What does this mean?**\n  - A: The script could not find the required column headers (like \"Manufacturer\" or \"Article\") in the selected Excel sheet. Check that the Excel file format matches the required template.\n\n- **Q: How do I import fixtures or hardware along with the hangers?**\n  - A: The script supports fixtures if they are defined in the Excel data (e.g., in a specific \"Fixture\" sheet). Ensure the fixture references in the main hanger sheet match the keys defined in the fixture list."
      },
      "tokens_used": 7767,
      "error": null
    }
  }
}