{
  "filename": "hsbCLT-Hilti.mcr",
  "status": "completed",
  "total_tokens": 55104,
  "processing_time": 304.34478425979614,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.10",
            "date": "30.10.2025",
            "author": "Marsel Nakuci",
            "changes": "Fix to allow insertion at multiple female-male connections HSB-24843"
          },
          {
            "version": "1.9",
            "date": "12.12.2024",
            "author": "Nils Gregor",
            "changes": "Added missing hanger bolt HSB-19771"
          },
          {
            "version": "1.8",
            "date": "10.12.2024",
            "author": "Nils Gregor",
            "changes": "Changed TSL to the requirements of Hilti HSB-19771"
          },
          {
            "version": "1.7",
            "date": "29.11.2024",
            "author": "Marsel Nakuci",
            "changes": "Fix when drawing symbol 20241129"
          },
          {
            "version": "1.6",
            "date": "08.10.2024",
            "author": "Marsel Nakuci",
            "changes": "Change TSL image HSB-19771"
          },
          {
            "version": "1.5",
            "date": "24.09.2024",
            "author": "Marsel Nakuci",
            "changes": "Fix drilling position (apply Z-offset) for the hanger bolt/Concrete fastener (Stockschraube/Bolzenanker) HSB-19771"
          },
          {
            "version": "1.4",
            "date": "20.09.2024",
            "author": "Marsel Nakuci",
            "changes": "Fix when identifying male and female panel at \"distinguishMaleFemaleFrom2Sips\" HSB-19771"
          },
          {
            "version": "1.3",
            "date": "13.09.2024",
            "author": "Marsel Nakuci",
            "changes": "Fix when calculating the distribution line of a male-female panel HSB-19771"
          },
          {
            "version": "1.2",
            "date": "22/08/2024",
            "author": "Marsel Nakuci",
            "changes": "Enable insertion of one sigle connector by point HSB-19771"
          },
          {
            "version": "1.1",
            "date": "19/06/2024",
            "author": "Marsel Nakuci",
            "changes": "Initial: Add block display of the connectors HSB-22250"
          },
          {
            "version": "1.0",
            "date": "18/06/2024",
            "author": "Marsel Nakuci",
            "changes": "Initial HSB-22250"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 9444,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates on Sip entities (Structural Insulated Panels), performing 3D geometric calculations (Vector3d, PlaneProfile, shadowProfile, envelopeBody). It generates tooling (doToolingAtPanels) and 3D Blocks. There are no references to ShopDrawing patterns (sd_*, #Type E), Viewport usage, or Paper Space specific functions. It searches for block files in _kPathHsbCompany."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip"
          ],
          "minimumBeams": 1,
          "requiredSpace": "The script requires at least one Sip panel in the model to operate (in single connector mode) or typically two Sip panels (for connection mode).",
          "requiredSettings": [
            "Block definition: HCWL.dwg located in the Company Block folder (_kPathHsbCompany + '\\\\Block').",
            "Valid Hardware definitions (Hilti HSW) for the main connector and fasteners referenced by 'getHardwareDefinitionHSW'."
          ]
        }
      },
      "tokens_used": 6714,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sConnectionType",
            "type": "PropString",
            "displayName": "Connection Type",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|Connect all panels|",
              "|Connect single|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDistribution",
            "type": "PropString",
            "displayName": "Distribution",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|Center|",
              "|Ends|",
              "|Equidistant|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dOffsetBottom",
            "type": "PropDouble",
            "displayName": "Offset Bottom",
            "defaultValue": 500,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dOffsetTop",
            "type": "PropDouble",
            "displayName": "Offset Top",
            "defaultValue": 500,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dOffsetBetween",
            "type": "PropDouble",
            "displayName": "Offset Between",
            "defaultValue": 600,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "nFastener",
            "type": "PropInt",
            "displayName": "Fastener Type",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sFastener",
            "type": "PropString",
            "displayName": "Fastener",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "dOffsetY",
            "type": "PropDouble",
            "displayName": "OffsetY",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "dOffsetZ",
            "type": "PropDouble",
            "displayName": "OffsetZ",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "Depth",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Flip Side|",
            "handler": "|Flip Side|",
            "action": "Inverts the side of the panel where the connector is attached (switches between vecZ and -vecZ direction).",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8521,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the layout and insertion of Hilti HCWL connectors for connecting perpendicular CLT/SIP panels, calculating positions, generating tooling, and managing hardware data.",
          "category": "Hardware",
          "typicalUseCase": "Used by detailers to efficiently apply standard Hilti angle brackets or screws at wall-to-wall or floor-to-wall intersections, ensuring correct spacing and machining for the connections."
        },
        "parameters": [
          {
            "name": "sConnectionType",
            "technicalDefault": null,
            "businessMeaning": "Defines whether the script runs in batch mode (finding all intersections between selected panels) or single mode (placing one connector at a user-selected point on a specific panel edge).",
            "validRange": "Connect all panels, Connect single",
            "unit": "List",
            "affectsOutput": "Determines the execution path (mode 101 vs 102). In 'Connect single', distribution parameters (Bottom/Top/Between offsets) are hidden as they are irrelevant."
          },
          {
            "name": "sDistribution",
            "technicalDefault": null,
            "businessMeaning": "Specifies the pattern for arranging multiple connectors along the height of the wall panel.",
            "validRange": "Center, Ends, Equidistant",
            "unit": "List",
            "affectsOutput": "Calculates the specific coordinates (pts array) where tooling and hardware are placed. 'Center' uses one point; 'Ends' uses two; 'Equidistant' fills the height based on offset limits."
          },
          {
            "name": "dOffsetBottom",
            "technicalDefault": "500",
            "businessMeaning": "The minimum required clearance from the bottom of the panel to the first connector center.",
            "validRange": "50 - 1000 mm",
            "unit": "mm",
            "affectsOutput": "Constraints the calculation of connector positions, ensuring no connector is placed below this height. Directly affects the start of the distribution line."
          },
          {
            "name": "dOffsetTop",
            "technicalDefault": "500",
            "businessMeaning": "The minimum required clearance from the top of the panel to the last connector center.",
            "validRange": "50 - 1000 mm",
            "unit": "mm",
            "affectsOutput": "Constraints the calculation of connector positions, ensuring no connector is placed above this height. Directly affects the end of the distribution line."
          },
          {
            "name": "dOffsetBetween",
            "technicalDefault": "600",
            "businessMeaning": "The maximum allowed spacing between connector centers when using the Equidistant distribution pattern.",
            "validRange": "300 - 1500 mm",
            "unit": "mm",
            "affectsOutput": "Determines how many connectors are generated along the panel height (Calculated as (Height - TopOffset - BottomOffset) / OffsetBetween)."
          },
          {
            "name": "nFastener",
            "technicalDefault": "1",
            "businessMeaning": "Index to select the specific Hilti fastener catalog entry (e.g., HST, SMD) associated with the connector.",
            "validRange": "1 - N (Dependent on catalog content)",
            "unit": "Integer",
            "affectsOutput": "Selects the specific hardware string (sFastener) and dimensions (sFastenersLength) used to generate the HSW (Hardware) component for BOMs and labels."
          },
          {
            "name": "sFastener",
            "technicalDefault": "",
            "businessMeaning": "The catalog name or article number of the fastener being used (e.g., 'SMD-FR 8x80').",
            "validRange": "String (Catalog Item Name)",
            "unit": "Text",
            "affectsOutput": "Passed to the HSW component generation; updates the material list and property palette information."
          },
          {
            "name": "dOffsetY",
            "technicalDefault": "0",
            "businessMeaning": "Adjustment perpendicular to the panel edge (along the width), shifting the connector into or away from the joint.",
            "validRange": "-100 to 100 mm",
            "unit": "mm",
            "affectsOutput": "Shifts the drilling position, symbol, and block representation along the Y-axis (relative to the panel edge)."
          },
          {
            "name": "dOffsetZ",
            "technicalDefault": "0",
            "businessMeaning": "Vertical adjustment applied to the calculated insertion point, useful for aligning with specific plate heights or avoiding obstructions.",
            "validRange": "-500 to 500 mm",
            "unit": "mm",
            "affectsOutput": "Adds a constant Z-value to all generated connector points, moving the holes, blocks, and symbols up or down."
          },
          {
            "name": "dDepth",
            "technicalDefault": "0",
            "businessMeaning": "Controls the drilling depth for the fastener hole.",
            "validRange": "0 - Panel Thickness (mm)",
            "unit": "mm",
            "affectsOutput": "Passed to the tooling generation function to set the Z-depth of the drill operation."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sConnectionType changes to 'Connect single'",
            "effect": "Hides distribution parameters as they are calculated manually via point selection.",
            "cascade": [
              "sDistribution",
              "dOffsetBottom",
              "dOffsetTop",
              "dOffsetBetween"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Tooling (Drilling)",
            "description": "Generates drill holes or slots in the panel geometry for the Hilti fasteners.",
            "appliedTo": "Selected Sip panels (Female and Male sides)."
          },
          {
            "type": "Hardware Component (HSW)",
            "description": "Creates BOM entries linked to the panels representing the Hilti connectors and fasteners.",
            "appliedTo": "The TSL Instance (mapped to specific Element groups)."
          },
          {
            "type": "3D Block",
            "description": "Inserts 'HCWL.dwg' blocks visually representing the connector assembly in the 3D model.",
            "appliedTo": "Model Space at connector insertion points."
          },
          {
            "type": "Symbol",
            "description": "Draws 2D markers on the panel to indicate connector locations for production drawings.",
            "appliedTo": "Selected Sip panels."
          }
        ]
      },
      "tokens_used": 10204,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Load constants, verify 'HCWL.dwg' block existence in Company folder.",
          "2. Determine Mode: Check 'sConnectionType' property to decide between 'Connect all panels' (Mode 101) or 'Connect single' (Mode 102).",
          "3. Entity Selection:",
          "   - Mode 101: User selects multiple Sip panels.",
          "   - Mode 102: User selects one Sip panel and specifies an insertion point (_Pt0).",
          "4. Geometry Processing:",
          "   - Mode 101: Iterate through panel pairs to find perpendicular intersections. Use 'distinguishMaleFemaleFrom2Sips' to assign roles.",
          "   - Mode 102: Identify the nearest panel edge to _Pt0. Determine 'Side' (VecZ/-VecZ) based on user state.",
          "5. Position Calculation:",
          "   - Mode 101: Calculate connector points based on 'sDistribution' ('Center', 'Ends', or 'Equidistant') and offset parameters.",
          "   - Mode 102: Project _Pt0 onto the identified edge line.",
          "6. Generation: Execute tooling (drilling) via 'doToolingAtPanels', create Hardware components (HSW), and insert 3D Blocks.",
          "7. Finalization: Update Instance properties and link hardware to the Element group."
        ],
        "conditionalBranches": [
          {
            "condition": "Value of property 'sConnectionType'",
            "path1": {
              "name": "Connect all panels (Mode 101)",
              "steps": [
                "Validate at least 2 panels are selected.",
                "Run 'getSipConnections' to find all male-female couples.",
                "For each valid couple, calculate distribution points based on 'sDistribution'.",
                "Apply tooling and hardware to both Male and Female panels.",
                "Properties 'dOffsetBottom', 'dOffsetTop', 'dOffsetBetween' are active."
              ]
            },
            "path2": {
              "name": "Connect single (Mode 102)",
              "steps": [
                "Validate 1 panel and 1 point are selected.",
                "Hide distribution properties ('dOffsetBottom', etc.) as they are irrelevant.",
                "Determine closest edge to insertion point.",
                "Apply tooling and hardware to the single panel.",
                "Use 'Flip Side' context menu to toggle side (VecZ or -VecZ)."
              ]
            }
          },
          {
            "condition": "Value of property 'sDistribution' (Mode 101 only)",
            "path1": {
              "name": "Center",
              "steps": [
                "Calculate one point in the middle of the vertical effective range."
              ]
            },
            "path2": {
              "name": "Ends",
              "steps": [
                "Calculate two points, constrained by 'dOffsetBottom' and 'dOffsetTop'."
              ]
            },
            "path3": {
              "name": "Equidistant",
              "steps": [
                "Fill vertical range with points spaced by 'dOffsetBetween', respecting top/bottom limits."
              ]
            }
          },
          {
            "condition": "Context Menu Trigger 'Flip Side' (Mode 102 only)",
            "path1": {
              "name": "Side 1",
              "steps": [
                "Connector attaches to side defined by -VecZ (Default)."
              ]
            },
            "path2": {
              "name": "Side -1",
              "steps": [
                "Connector attaches to side defined by VecZ (Flipped)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Number of selected Sip entities in 'Connect all panels' mode.",
            "errorMessage": "At least 2 panels needed",
            "recovery": "Select additional Sip panels and retry insertion."
          },
          {
            "check": "Valid panel found in 'Connect single' mode.",
            "errorMessage": "No male panel found",
            "recovery": "Ensure a Sip panel is selected before inserting or pick a valid panel."
          },
          {
            "check": "Block file existence.",
            "errorMessage": "Block 'HCWL.dwg' not found in Company Block folder.",
            "recovery": "Ensure the required block definition is present in the hsbCAD Company structure."
          },
          {
            "check": "Perpendicularity of panels (Mode 101).",
            "errorMessage": "(Internal) Panels not perpendicular, skipping connection.",
            "recovery": "Rotate panels to be perpendicular (90 degrees) to each other."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Connector Positioning",
            "how": "OPM Properties (AutoCAD Properties Palette)",
            "effect": "Changing 'sDistribution', 'dOffsetBottom', 'dOffsetTop', or 'dOffsetBetween' recalculates the positions of all connectors in Mode 101. Changing 'dOffsetY', 'dOffsetZ', or 'dDepth' adjusts drilling and block location."
          },
          {
            "action": "Flip Connector Side",
            "how": "Right-click Context Menu -> 'Flip Side'",
            "effect": "In Mode 102, this toggles the connector to the opposite side of the panel (Switches between VecZ and -VecZ) and updates the visual Block and Tooling."
          },
          {
            "action": "Update Hardware Specification",
            "how": "OPM Properties",
            "effect": "Changing 'nFastener' or 'sFastener' updates the hardware definition (HSW) and BOM data for the instance."
          }
        ]
      },
      "tokens_used": 12417,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-Hilti.mcr\n\n## Overview\nAutomates the layout and insertion of Hilti HCWL connectors for connecting perpendicular CLT or SIP panels. It calculates connector positions, generates drilling tooling, and manages hardware data for BOMs.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for 3D operations and panel selection. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: Sip (Structural Insulated Panel) entities.\n- **Minimum Beam Count**: \n    - **Connect all panels mode**: At least 2 panels.\n    - **Connect single mode**: 1 panel.\n- **Required Settings**: \n    - Block file `HCWL.dwg` must exist in the Company Block folder (`_kPathHsbCompany\\Block`).\n    - Valid Hilti Hardware definitions (HSW).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: Run the script via the `TSLINSERT` command or the hsbCAD toolbar.\n\n### Step 2: Configure Connection Type\nBefore or after selecting entities, open the **Properties Palette (Ctrl+1)**. Set the **Connection Type** property to one of the following:\n- **Connect all panels**: Automatically finds perpendicular intersections between selected panels.\n- **Connect single**: Allows manual placement of a single connector at a specific point.\n\n### Step 3: Select Panels and Place\nDepending on the Connection Type selected:\n\n**If \"Connect all panels\" is selected:**\n```\nCommand Line: Select Sip entities:\nAction: Select all Sip panels that form perpendicular connections (e.g., wall-to-floor). Press Enter to confirm.\n```\n\n**If \"Connect single\" is selected:**\n```\nCommand Line: Select Sip entity:\nAction: Click on the single Sip panel where the connector should be applied.\nCommand Line: Specify insertion point:\nAction: Click on the edge of the panel where you want the connector to be placed.\n```\n\n### Step 4: Adjust Distribution (If applicable)\nIf using \"Connect all panels\" mode, adjust the **Distribution** property (Center, Ends, or Equidistant) in the Properties Palette to update the layout automatically.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Connection Type | dropdown | Connect all panels | Determines if the script connects all selected panel intersections or places a single connector manually. |\n| Distribution | dropdown | Center | Defines the pattern for arranging multiple connectors (Center, Ends, Equidistant). Only used in \"Connect all panels\" mode. |\n| Offset Bottom | number | 500 | Minimum distance from the bottom of the panel to the first connector. |\n| Offset Top | number | 500 | Minimum distance from the top of the panel to the last connector. |\n| Offset Between | number | 600 | Maximum spacing between connectors when using the \"Equidistant\" distribution pattern. |\n| Fastener Type | number | 1 | Index to select the specific Hilti fastener catalog entry. |\n| Fastener | text | | The catalog name or article number of the fastener (e.g., 'SMD-FR 8x80'). |\n| OffsetY | number | 0 | Adjusts the connector position along the width of the panel (perpendicular to the edge). |\n| OffsetZ | number | 0 | Vertical adjustment applied to the calculated insertion point. |\n| Depth | number | 0 | Controls the drilling depth for the fastener hole (0 = automatic/through). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip Side | Switches the connector to the opposite side of the panel. Useful if the connector is initially pointing in the wrong direction. |\n\n## Settings Files\n- **Filename**: `HCWL.dwg`\n- **Location**: `_kPathHsbCompany\\Block` (Company Folder)\n- **Purpose**: Provides the 3D block geometry used to visually represent the Hilti connector in the model.\n\n## Tips\n- Use the **Flip Side** context menu option if the connector generates on the interior face instead of the exterior face (or vice versa).\n- When using **Equidistant** distribution, the script calculates the number of connectors based on the panel height minus the top and bottom offsets.\n- Ensure your Sip panels are perfectly perpendicular (90 degrees) to each other for the \"Connect all panels\" mode to detect the connection correctly.\n\n## FAQ\n- **Q: Why are the Offset properties grayed out?**\n  - A: These properties are only active when \"Connection Type\" is set to \"Connect all panels\". In \"Connect single\" mode, the position is determined by the clicked point and the OffsetY/OffsetZ values.\n- **Q: The script says \"No male panel found\" in single mode.**\n  - A: Ensure you have selected a valid Sip panel entity before picking the insertion point.\n- **Q: How do I update the fastener size after insertion?**\n  - A: Select the connector instance, open the Properties Palette, and change the \"Fastener Type\" index or \"Fastener\" string to update the BOM data."
      },
      "tokens_used": 7804,
      "error": null
    }
  }
}