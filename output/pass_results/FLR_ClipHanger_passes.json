{
  "filename": "FLR_ClipHanger.mcr",
  "status": "completed",
  "total_tokens": 40040,
  "processing_time": 143.95574498176575,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6153,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly creates TSL instances using `tslNew.dbCreate(..., _kModelSpace, ...)` and generates `MetalPart` entities. It performs geometric intersections on `Beam` and `Element` objects. No Paper Space specific functions (sd_*, _Viewport) or ShopDrawing patterns (#Type E with _Entity usage for detailing) are detected."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space containing at least one element and two intersecting beams.",
          "requiredSettings": []
        }
      },
      "tokens_used": 4741,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity (beam selection)",
              "promptOriginal": "|Select male beam(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getBeam",
              "promptOriginal": "|Select female beam|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "psClipName",
            "type": "PropString",
            "displayName": "|Clip|",
            "defaultValue": "1.5x1.5x5",
            "inputType": "dropdown",
            "options": [
              "1.5x1.5x5",
              "1.5x1.5x6",
              "1.5x1.5x8",
              "1.5x4x6",
              "SJC8.25"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "psFace",
            "type": "PropString",
            "displayName": "|Attachment Face|",
            "defaultValue": "|Outside|",
            "inputType": "dropdown",
            "options": [
              "|Outside|",
              "|Inside|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "pdLeg1",
            "type": "PropDouble",
            "displayName": "|Leg 1|",
            "defaultValue": "1.5",
            "inputType": "number",
            "options": [],
            "category": "|Clip Geometry|",
            "description": null
          },
          {
            "index": 1,
            "variable": "pdLeg2",
            "type": "PropDouble",
            "displayName": "|Leg 2|",
            "defaultValue": "1.5",
            "inputType": "number",
            "options": [],
            "category": "|Clip Geometry|",
            "description": null
          },
          {
            "index": 2,
            "variable": "pdWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": "5",
            "inputType": "number",
            "options": [],
            "category": "|Clip Geometry|",
            "description": null
          },
          {
            "index": 1,
            "variable": "psType",
            "type": "PropString",
            "displayName": "|Type|",
            "defaultValue": "|Clip|",
            "inputType": "text",
            "options": [],
            "category": "|Clip Geometry|",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6312,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates parametric metal clips or hangers to connect a 'male' beam (e.g., joist) to a 'female' beam (e.g., rim band or top plate) based on standard catalog sizes.",
          "category": "Hardware",
          "typicalUseCase": "Connecting floor joists or rafters to supporting beams or wall plates using Simpson Strong-Tie style hardware."
        },
        "parameters": [
          {
            "name": "psClipName",
            "technicalDefault": "1.5x1.5x5",
            "businessMeaning": "Selects the specific hardware profile from a predefined catalog (e.g., Simpson Strong-Tie H2.5A, H1, etc.). The name encodes the dimensions (Leg1 x Leg2 x Width).",
            "validRange": "List constrained: '1.5x1.5x5', '1.5x1.5x6', '1.5x1.5x8', '1.5x4x6', 'SJC8.25'",
            "unit": "N/A (Selection)",
            "affectsOutput": "Drives the geometry of the metal part. Automatically updates Leg 1, Leg 2, Width, and Type properties."
          },
          {
            "name": "psFace",
            "technicalDefault": "|Outside|",
            "businessMeaning": "Specifies the side of the female beam where the clip attaches relative to the male beam's direction.",
            "validRange": "|Outside|, |Inside|",
            "unit": "N/A (Selection)",
            "affectsOutput": "Flips the attachment point of the clip on the female beam web. 'Outside' places it on the face the male beam points towards; 'Inside' places it on the opposite face."
          },
          {
            "name": "pdLeg1",
            "technicalDefault": "1.5",
            "businessMeaning": "The vertical height (or depth along the male beam) of the metal connector.",
            "validRange": "1.0 to 12.0 (typically based on the clip selected)",
            "unit": "inches",
            "affectsOutput": "Determines the height of the 3D MetalPart. Read-only; controlled by psClipName."
          },
          {
            "name": "pdLeg2",
            "technicalDefault": "1.5",
            "businessMeaning": "The horizontal width (or depth into the female beam) of the metal connector.",
            "validRange": "1.0 to 12.0 (typically based on the clip selected)",
            "unit": "inches",
            "affectsOutput": "Determines how far the clip extends into the female beam. Read-only; controlled by psClipName."
          },
          {
            "name": "pdWidth",
            "technicalDefault": "5",
            "businessMeaning": "The gauge width of the metal connector (perpendicular to the web).",
            "validRange": "3 to 12 (typically based on the clip selected)",
            "unit": "inches",
            "affectsOutput": "Determines the width of the 3D MetalPart. Read-only; controlled by psClipName."
          },
          {
            "name": "psType",
            "technicalDefault": "|Clip|",
            "businessMeaning": "Classification of the hardware for reporting purposes (e.g., distinguishing between a face-mounted clip and a top-flange hanger).",
            "validRange": "|Clip|, |Hanger|",
            "unit": "N/A (String)",
            "affectsOutput": "Used primarily for scheduling data (Map entry 'HANGER_MODEL'). Read-only; controlled by psClipName."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "psClipName change",
            "effect": "Updates the geometric and type parameters to match the selected catalog item.",
            "cascade": [
              "pdLeg1",
              "pdLeg2",
              "pdWidth",
              "psType"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "MetalPart",
            "description": "A 3D L-shaped metal plate representing the clip or hanger, consisting of two perpendicular legs (Leg1 and Leg2) with a specified width.",
            "appliedTo": "Created in Model Space at the intersection of the male and female beams."
          }
        ]
      },
      "tokens_used": 7188,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch: User executes the script or a master script calls it.",
          "2. Map I/O Check: If _bOnMapIO is true, the script erases itself and exits (internal usage).",
          "3. Insertion Phase Check: If _bOnInsert is true, enter insertion workflow; otherwise, enter calculation workflow.",
          "4. Insertion Workflow: Prompt user to select male beam(s).",
          "5. Insertion Workflow: Validate male beam selection; if empty, erase instance and exit.",
          "6. Insertion Workflow: Prompt user to select a single female beam.",
          "7. Insertion Workflow: Validate female beam; if invalid, erase instance and exit.",
          "8. Insertion Workflow: Verify female beam belongs to a valid Element; if not, erase instance and exit.",
          "9. Insertion Workflow: Iterate through selected male beams and create a new TSL instance for each.",
          "10. Insertion Workflow: Erase the original 'seed' instance and exit.",
          "11. Calculation Workflow: Check for 'mpMasterInstructions' (passed from calling scripts like FLR_LadderCFS) to auto-set properties.",
          "12. Calculation Workflow: Update read-only geometric properties (pdLeg1, pdLeg2, pdWidth, psType) based on the selected psClipName.",
          "13. Calculation Workflow: Validate Data Structure. Check if _Entity array is empty.",
          "14. Calculation Workflow (Legacy Branch): If _Entity is empty but 2 beams exist, attempt to clone the instance to the new data structure (referencing Element) and erase the old one.",
          "15. Calculation Workflow (Validation): Verify the Element exists and is valid; erase instance if not.",
          "16. Calculation Workflow (Validation): Verify at least one beam exists in _Beam array; erase instance if not.",
          "17. Calculation Workflow (Validation): Verify the Male Beam (_Beam[0]) is valid; erase instance if not.",
          "18. Calculation Workflow: Check _bOnElementConstructed flag.",
          "19. Calculation Workflow: If flag is true, search for the female beam by filtering intersecting beams within the element.",
          "20. Calculation Workflow: If female beam found, append it to _Beam; ensure _Beam[1] is valid.",
          "21. Calculation Workflow: Calculate geometric vectors (X, Y, Z) for male and female beams.",
          "22. Calculation Workflow: Determine intersection geometry using envelope bodies.",
          "23. Calculation Workflow: Determine 'Outside' vs 'Inside' based on psFace property.",
          "24. Calculation Workflow: Generate MetalPart geometry (Leg1 and Leg2) at calculated position.",
          "25. Calculation Workflow: Update Schedule Data in _Map (HANGER_MODEL, QTY, etc.).",
          "26. End: Script waits for next event or modification."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Context",
            "path1": {
              "name": "Map IO",
              "steps": [
                "Erase Instance",
                "Exit"
              ]
            },
            "path2": {
              "name": "Insertion",
              "steps": [
                "Select Beams",
                "Create Child TSLs",
                "Erase Instance"
              ]
            },
            "path3": {
              "name": "Calculation/Update",
              "steps": [
                "Validate References",
                "Calculate Geometry",
                "Draw MetalPart"
              ]
            }
          },
          {
            "condition": "Data Structure Version",
            "path1": {
              "name": "Modern (Element Present)",
              "steps": [
                "Assign to Element Group",
                "Proceed with Beam Validation"
              ]
            },
            "path2": {
              "name": "Legacy (Element Missing)",
              "steps": [
                "Validate Legacy 2-Beam Format",
                "Clone to New Instance",
                "Transfer Properties",
                "Delete Old Instance"
              ]
            }
          },
          {
            "condition": "Female Beam Acquisition",
            "path1": {
              "name": "Dynamic Search (_bOnElementConstructed)",
              "steps": [
                "Get Element Beams",
                "Filter Intersections",
                "Set Female Beam"
              ]
            },
            "path2": {
              "name": "Static Reference",
              "steps": [
                "Use existing _Beam[1] reference"
              ]
            }
          },
          {
            "condition": "Attachment Face Property (psFace)",
            "path1": {
              "name": "Outside",
              "steps": [
                "Locate Male Outside face",
                "Orient clip towards web"
              ]
            },
            "path2": {
              "name": "Inside",
              "steps": [
                "Locate Male Inside face",
                "Orient clip away from web"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Male Beam Selection",
            "errorMessage": "(No explicit message, just erasure)",
            "recovery": "User must re-run script and select at least one beam."
          },
          {
            "check": "Female Beam Validity",
            "errorMessage": "N/A (Script erases silently)",
            "recovery": "User must select a valid beam during insertion."
          },
          {
            "check": "Element Membership",
            "errorMessage": "has been deleted because female beam does not belong to a valid element",
            "recovery": "Ensure selected beam is part of a valid hsbCAD Element (Wall/Floor)."
          },
          {
            "check": "Legacy Structure Integrity",
            "errorMessage": "has been deleted because there was not a valid entity and 2 beams",
            "recovery": "Ensure the old script instance had valid beams assigned."
          },
          {
            "check": "Male Beam Reference (Calculation)",
            "errorMessage": "has been deleted because male beam is not valid",
            "recovery": "Restore the deleted beam or fix the reference."
          },
          {
            "check": "Geometric Analysis",
            "errorMessage": "ClipHanger cannot analyze male geometry, self destructing",
            "recovery": "Occurs if male beam is symmetric or intersection logic fails; modify beam geometry."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Hardware Type",
            "how": "OPM Property 'Clip' (Dropdown)",
            "effect": "Updates psClipName, which cascades to update pdLeg1, pdLeg2, pdWidth, and psType. MetalPart geometry rebuilds to new dimensions."
          },
          {
            "action": "Flip Clip Side",
            "how": "OPM Property 'Attachment Face' (Dropdown)",
            "effect": "Toggles between 'Outside' and 'Inside'. This flips the calculation of the attachment point relative to the male beam's centerline."
          },
          {
            "action": "Dynamic Beam Updates",
            "how": "Moving/Modifying connected beams in model",
            "effect": "If the element is updated (_bOnElementConstructed), the script attempts to rediscover the female beam. It always recalculates intersection geometry and updates the MetalPart position."
          },
          {
            "action": "Property Read-Only Override",
            "how": "OPM Properties 'Leg 1', 'Leg 2', 'Width'",
            "effect": "These are set to Read-Only. User changes are ignored; they are driven strictly by the 'Clip' catalog selection."
          }
        ]
      },
      "tokens_used": 9354,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# FLR_ClipHanger.mcr\n\n## Overview\nGenerates parametric metal clips or hangers to connect a \"male\" beam (e.g., a joist or rafter) to a \"female\" beam (e.g., a rim band or top plate) using standard catalog sizes.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script creates 3D MetalPart entities at beam intersections. |\n| Paper Space | No | Not intended for 2D detailing or view generation. |\n| Shop Drawing | No | Generates model content only. |\n\n## Prerequisites\n- **Required Entities**: `GenBeam`, `Element` (Wall or Floor).\n- **Minimum Beam Count**: 2 (One male beam to be supported, one female supporting beam).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT`\n**Action:** Browse and select `FLR_ClipHanger.mcr`, then click Open.\n\n### Step 2: Select Male Beam(s)\n```\nCommand Line: Select male beam(s)\n```\n**Action:** Click on the joist(s) or beam(s) that need to be supported.\n- *Note:* You can select multiple beams. Press **Enter** to confirm your selection.\n\n### Step 3: Select Female Beam\n```\nCommand Line: Select female beam\n```\n**Action:** Click on the single supporting beam (e.g., the rim joist or ledger) that the male beams intersect.\n- *Result:* The script will generate clip instances at all valid intersections between the selected male beams and the female beam.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Clip | dropdown | 1.5x1.5x5 | Selects the hardware profile from the catalog (e.g., 1.5x1.5x5). Changing this updates all dimensions automatically. |\n| Attachment Face | dropdown | Outside | Sets which side of the female beam the clip attaches to. Options: `Outside`, `Inside`. |\n| Leg 1 | number | 1.5 | The vertical height/depth of the connector along the male beam. (Read-only) |\n| Leg 2 | number | 1.5 | The horizontal width/depth into the female beam. (Read-only) |\n| Width | number | 5 | The gauge width of the metal connector. (Read-only) |\n| Type | text | Clip | Classification of the hardware for reports/scheduling. (Read-only) |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script uses standard OPM (Object Property Model) properties. No custom context menu items are added. |\n\n## Settings Files\n- **Filename:** None\n- **Location:** N/A\n- **Purpose:** N/A (All settings are embedded in the script properties).\n\n## Tips\n- **Bulk Selection:** You can select multiple joists in Step 2 to install hangers on an entire row at once.\n- **Flipping Orientation:** Use the **Attachment Face** property in the Properties Palette to toggle the clip between \"Outside\" and \"Inside\" without re-running the command.\n- **Auto-Update:** If you move or modify the connected beams, the clip geometry will automatically update to match the new intersection.\n- **Read-Only Dimensions:** Do not try to manually type values for Leg 1, Leg 2, or Width. Instead, select a different **Clip** size from the dropdown to change dimensions.\n\n## FAQ\n\n- **Q: Why did my clip disappear from the model?**\n  **A:** The script will erase the clip instance if the connected beams are deleted, if the beams no longer intersect properly, or if the female beam is removed from its Element (Wall/Floor).\n\n- **Q: Can I create a custom size clip not in the dropdown list?**\n  **A:** No. The script uses a predefined catalog. You must select one of the available options (e.g., 1.5x1.5x5) which sets the geometry.\n\n- **Q: The \"Leg\" and \"Width\" fields are greyed out. How do I change them?**\n  **A:** These are calculated automatically based on the **Clip** property. Change the \"Clip\" selection to the desired catalog part, and these values will update accordingly."
      },
      "tokens_used": 6292,
      "error": null
    }
  }
}