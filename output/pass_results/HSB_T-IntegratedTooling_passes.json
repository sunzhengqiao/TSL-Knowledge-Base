{
  "filename": "HSB_T-IntegratedTooling.mcr",
  "status": "completed",
  "total_tokens": 49253,
  "processing_time": 297.9556665420532,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": 1,\n    \"minorVersion\": 7,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.7\",\n      \"date\": \"01.05.2020\",\n      \"author\": \"robert.pol@hsbcad.com\",\n      \"changes\": \"initial\"\n    },\n    {\n      \"version\": \"1.00\",\n      \"date\": \"25.02.2019\",\n      \"author\": \"RVW\",\n      \"changes\": \"Pilot version.\"\n    },\n    {\n      \"version\": \"1.01\",\n      \"date\": \"16.04.2019\",\n      \"author\": \"RVW\",\n      \"changes\": \"Add choice for intersection of beams from male PtCenter or PtCenterSolid.\"\n    },\n    {\n      \"version\": \"1.02\",\n      \"date\": \"11.03.2020\",\n      \"author\": \"RP\",\n      \"changes\": \"Add option to remove male and make a it a static tool\"\n    },\n    {\n      \"version\": \"1.03\",\n      \"date\": \"11.03."
      },
      "tokens_used": 7565,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script performs 3D geometric operations on GenBeam and Body objects (vecX, ptCen, solidWidth). It applies tooling using BeamCut, addToolStatic, and addMeToGenBeamsIntersect, which are strictly Model Space operations. No ShopDrawing (sd_) or Paper Space specific keywords (_Viewport) were found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Beam",
            "Body"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space (3D environment)",
          "requiredSettings": [
            "HSB_T-SquareBeamCut (Required if using the 'Convert to static tool' and 'Make beamcut square' options)"
          ]
        }
      },
      "tokens_used": 6007,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select a set of female beam(s)|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select a set of male beam(s)|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 5,\n      \"variable\": \"sChoicePtCen\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Intersection at centerPoint or SolidCenterPoint|.\",\n      \"defaultValue\": \"|PtCenter|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|PtCenter|\",\n        \"|PtCenterSolid|\"\n      ],\n      \"category\": null,\n      \"description\": \"|Choose from where the intersection has to be calculated. From the certerPoint or the SolidCenterPoint of the male beam|.\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"dAdditionalWidth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Additional width|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dAdditionalHeight\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Additional height|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"sJustificationChoice\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Justification point|\",\n      \"defaultValue\": \"|Center|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Center|\",\n        \"|Top|\",\n        \"|Top-Left|\",\n        \"|Top-Right|\",\n        \"|Left|\",\n        \"|Right|\",\n        \"|Bottom|\",\n        \"|Bottom-Left|\",\n        \"|Bottom-Right|\"\n      ],\n      \"category\": \"|Geometry|\",\n      \"description\": \"|Sets the justification point for the additional width/ height|.\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dOffsetDirX\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Offset in X direction|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"dOffsetDirY\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Offset in Y direction|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"dOffsetDirZ\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Offset in Z direction|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"dNegFrontOffset\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Negative front offset|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 6,\n      \"variable\": \"dPosFrontOffset\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Positive front offset|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sModifyForCNC\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Modify section for CNC|\",\n      \"defaultValue\": \"|No|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Yes|\",\n        \"|No|\"\n      ],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sConvertToDummy\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Convert to Dummy|\",\n      \"defaultValue\": \"|No|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Yes|\",\n        \"|No|\"\n      ],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sConvertToStatic\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Convert to static tool|\",\n      \"defaultValue\": \"|No|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Yes|\",\n        \"|No|"
      },
      "tokens_used": 8639,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a machining tool (cut/pocket) on 'female' beams based on the geometry of selected 'male' beams, effectively using one beam to cut another.",
          "category": "Joinery/CAM",
          "typicalUseCase": "Creating custom intersections, housings, or notches where a secondary beam (male) needs to cut into primary structural members (female), or defining complex voids using auxiliary geometry."
        },
        "parameters": [
          {
            "name": "sChoicePtCen",
            "technicalDefault": "PtCenter",
            "businessMeaning": "Determines the reference origin for the intersection calculation relative to the male beam's alignment.",
            "validRange": "PtCenter, PtCenterSolid",
            "unit": "Enum",
            "affectsOutput": "Switches the calculation origin between the beam's theoretical axis (Reference Line) and its physical center (Solid). Crucial for asymmetric beams."
          },
          {
            "name": "dAdditionalWidth",
            "technicalDefault": "0",
            "businessMeaning": "Expands or contracts the width of the cut applied to the female beam.",
            "validRange": "-100.0 to 100.0",
            "unit": "mm (or current length unit)",
            "affectsOutput": "Widens the slot or cut. A positive value adds clearance (play), a negative value creates a tighter interference."
          },
          {
            "name": "dAdditionalHeight",
            "technicalDefault": "0",
            "businessMeaning": "Expands or contracts the height (depth) of the cut applied to the female beam.",
            "validRange": "-100.0 to 100.0",
            "unit": "mm (or current length unit)",
            "affectsOutput": "Deepens or shallows the cut on the female beam."
          },
          {
            "name": "sJustificationChoice",
            "technicalDefault": "Center",
            "businessMeaning": "Controls the direction in which the 'Additional Width' and 'Additional Height' are applied.",
            "validRange": "Center, Top, Bottom, Left, Right, Corners",
            "unit": "Enum",
            "affectsOutput": "If 'Additional Width' is 10mm and Justification is 'Left', the cut expands 10mm to the left side only. If 'Center', it expands 5mm on both sides."
          },
          {
            "name": "dOffsetDirX",
            "technicalDefault": "0",
            "businessMeaning": "Slides the entire cutting tool along the length of the male beam.",
            "validRange": "-2000.0 to 2000.0",
            "unit": "mm (or current length unit)",
            "affectsOutput": "Shifts the start and end position of the cut longitudinally."
          },
          {
            "name": "dOffsetDirY",
            "technicalDefault": "0",
            "businessMeaning": "Slides the entire cutting tool sideways (perpendicular to the male beam's web).",
            "validRange": "-500.0 to 500.0",
            "unit": "mm (or current length unit)",
            "affectsOutput": "Shifts the cut position laterally relative to the male beam."
          },
          {
            "name": "dOffsetDirZ",
            "technicalDefault": "0",
            "businessMeaning": "Slides the entire cutting tool vertically.",
            "validRange": "-500.0 to 500.0",
            "unit": "mm (or current length unit)",
            "affectsOutput": "Shifts the cut position vertically relative to the male beam."
          },
          {
            "name": "dNegFrontOffset",
            "technicalDefault": "0",
            "businessMeaning": "Trims the cutting tool from the start of the male beam.",
            "validRange": "0 to 2000.0",
            "unit": "mm (or current length unit)",
            "affectsOutput": "Shortens the cut length from the male beam's negative X direction."
          },
          {
            "name": "dPosFrontOffset",
            "technicalDefault": "0",
            "businessMeaning": "Trims the cutting tool from the end of the male beam.",
            "validRange": "0 to 2000.0",
            "unit": "mm (or current length unit)",
            "affectsOutput": "Shortens the cut length from the male beam's positive X direction."
          },
          {
            "name": "sModifyForCNC",
            "technicalDefault": "No",
            "businessMeaning": "Updates the sectional view properties of the beam to reflect the material removal for manufacturing output.",
            "validRange": "Yes, No",
            "unit": "Enum",
            "affectsOutput": "CAM/NC data and Shop Drawing detailing."
          },
          {
            "name": "sConvertToDummy",
            "technicalDefault": "No",
            "businessMeaning": "Hides the male beam from model views and reports while keeping the cut active.",
            "validRange": "Yes, No",
            "unit": "Enum",
            "affectsOutput": "Visual representation of the male beam (it becomes invisible/auxiliary)."
          },
          {
            "name": "sConvertToStatic",
            "technicalDefault": "No",
            "businessMeaning": "Permanently applies the cut to the female beams and removes the script dependency.",
            "validRange": "Yes, No",
            "unit": "Enum",
            "affectsOutput": "The dynamic link is broken. The cut becomes a permanent static feature; moving the original male beam afterwards will not update the cut."
          },
          {
            "name": "sConvertToSquare",
            "technicalDefault": "No",
            "businessMeaning": "Forces the resulting cut to be orthogonal (squared off) rather than following the exact shape of the male beam.",
            "validRange": "Yes, No",
            "unit": "Enum",
            "affectsOutput": "Geometry of the female beam cut. Requires 'HSB_T-SquareBeamCut'."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sJustificationChoice",
            "effect": "Determines how dAdditionalWidth and dAdditionalHeight are distributed relative to the center point.",
            "cascade": [
              "dAdditionalWidth",
              "dAdditionalHeight"
            ]
          },
          {
            "trigger": "sConvertToStatic",
            "effect": "If 'Yes', the script self-destructs after applying the tool. It also enables the logic for sConvertToSquare.",
            "cascade": [
              "sConvertToSquare"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "BeamCut",
            "description": "A subtractive volume (void) applied to the female beams based on the geometry of the male beam.",
            "appliedTo": "The set of selected female beams."
          }
        ]
      },
      "tokens_used": 8897,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script 'HSB_T-IntegratedTooling'",
          "2. [Conditional] Check for Execution Key (Catalog/Silent): If Key exists, load properties; else, show Properties Dialog.",
          "3. Prompt User to select a set of Female beams (targets for the cut).",
          "4. Prompt User to select a set of Male beams (source of the cut geometry).",
          "5. [Validation] Iterate through Male beams and check for physical intersection with Female beams.",
          "6. [Generation] For every valid Male/Female intersection pair, spawn a new Script Instance (Worker) linked to those specific beams.",
          "7. [Cleanup] Delete the original insertion instance.",
          "8. [Worker Instance Execution] Calculate cut geometry based on OPM properties (Offsets, Justification, Dimensions).",
          "9. [Branching] Apply Cut: Either as a Dynamic Tool (update on move) or Static Tool (fixed geometry).",
          "10. [Post-Process] Handle Male beam visibility (Dummy) or deletion (Static)."
        ],
        "conditionalBranches": [
          {
            "condition": "sConvertToStatic Property (Dynamic vs Static Workflow)",
            "path1": {
              "name": "Dynamic Tool (Default)",
              "steps": [
                "Script establishes dependency on Male beam.",
                "BeamCut applied using 'addMeToGenBeamsIntersect'.",
                "Moving Male beam updates the cut on Female beams automatically.",
                "Male beam visibility updated based on 'sConvertToDummy'."
              ]
            },
            "path2": {
              "name": "Static Tool (One-time operation)",
              "steps": [
                "Dependency on Male beam is NOT set.",
                "BeamCut applied using 'addToolStatic'.",
                "[Sub-branch] If 'sConvertToSquare' is Yes, call external script 'HSB_T-SquareBeamCut'.",
                "Delete the Male beam entity from the drawing.",
                "Delete the Script Instance (Self-destruct)."
              ]
            }
          },
          {
            "condition": "Intersection Validation during Insertion",
            "path1": {
              "name": "Intersection Detected",
              "steps": [
                "Geometry is valid.",
                "Worker Script Instance is created.",
                "Proceeds to execute tooling logic."
              ]
            },
            "path2": {
              "name": "No Intersection",
              "steps": [
                "System silently skips this specific Male/Female combination.",
                "No Script Instance is generated for the pair.",
                "Insertion continues to next pair or completes."
              ]
            }
          },
          {
            "condition": "Beam Count Validation (Worker Execution)",
            "path1": {
              "name": "Valid Count (>= 2 beams)",
              "steps": [
                "Script proceeds to calculate geometry.",
                "Tooling is applied."
              ]
            },
            "path2": {
              "name": "Invalid Count (< 2 beams)",
              "steps": [
                "Script detects missing beams (likely deleted by user).",
                "Script executes 'eraseInstance'.",
                "Tooling is removed."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Minimum GenBeam count",
            "errorMessage": "(Implicit - No message shown, instance disappears)",
            "recovery": "User must re-run the tool or undo the deletion of beams."
          },
          {
            "check": "Geometric Intersection (Insertion Phase)",
            "errorMessage": "(Implicit - Non-intersecting pairs are ignored)",
            "recovery": "User must ensure beams physically touch or overlap in 3D space."
          },
          {
            "check": "HSB_T-SquareBeamCut availability",
            "errorMessage": "|Beams could not be analysed!| |Make sure that the tsl| HSB_T-SquareBeamCut |is loaded in the drawing|.",
            "recovery": "Load the required script 'HSB_T-SquareBeamCut.mcr' into the drawing and retry."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Add Female Beam",
            "how": "Right-click Context Menu -> '|Add beam|'",
            "effect": "Prompts user to select beams; selected beams are added to the list of beams receiving the cut."
          },
          {
            "action": "Remove Female Beam",
            "how": "Right-click Context Menu -> '|Remove beam|'",
            "effect": "Prompts user to select beams; selected beams are removed from the cut list and restore their original geometry."
          },
          {
            "action": "Modify Geometry",
            "how": "Properties Palette (OPM)",
            "effect": "Changing Width, Height, Offsets, or Justification updates the cut volume in real-time (Dynamic mode)."
          },
          {
            "action": "Delete Male Beam",
            "how": "Standard AutoCAD Erase / Set 'Convert to static' to Yes",
            "effect": "If 'Convert to static' is Yes, the male beam is deleted and the cut becomes permanent. If No, erasing the male beam usually triggers an error or update in dependent scripts."
          }
        ]
      },
      "tokens_used": 9930,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_T-IntegratedTooling\n\n## Overview\nThis script allows you to use one or more \"male\" beams to cut volumes (tooling) into one or more \"female\" beams. It is useful for creating complex intersections, housings, or notches where the geometry of the cut is defined by an existing beam, rather than by manual dimensioning.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D GenBeam entities. |\n| Paper Space | No | 3D geometry operations cannot be performed in Paper Space. |\n| Shop Drawing | No | This is a model generation tool, not a detailing tool. |\n\n## Prerequisites\n- **Required Entities**: At least two GenBeams (one \"Female\" target and one \"Male\" cutter).\n- **Minimum Beam Count**: 2 (must physically intersect).\n- **Required Scripts**: \n  - `HSB_T-SquareBeamCut.mcr` (Only required if you intend to use the **Convert to static tool** and **Make beamcut square** options simultaneously).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_T-IntegratedTooling.mcr`\n\n### Step 2: Select Female Beams\n```\nCommand Line: Select a set of female beam(s)\nAction: Click on the beam(s) you want to cut into. Press Enter to confirm.\n```\n\n### Step 3: Select Male Beams\n```\nCommand Line: Select a set of male beam(s)\nAction: Click on the beam(s) that will define the shape of the cut. Press Enter to confirm.\n```\n*Note: The script will automatically verify if the selected male and female beams physically intersect. If they do not touch in 3D space, no tooling will be created for that specific pair.*\n\n### Step 4: Configure Properties\nAfter selection, the script creates the tooling instance. You can immediately adjust the cut dimensions and behavior using the **Properties Palette** (Ctrl+1).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Intersection at centerPoint or SolidCenterPoint | Dropdown | PtCenter | Determines where the intersection is calculated from. **PtCenter** uses the beam's reference line (axis). **PtCenterSolid** uses the physical center of the solid (useful for asymmetric beams like I-beams or profiles with offsets). |\n| Additional width | Number | 0 | Expands or contracts the width of the cut. Use negative values to tighten the fit or positive values to add clearance. |\n| Additional height | Number | 0 | Expands or contracts the height of the cut. |\n| Justification point | Dropdown | Center | Determines the direction in which \"Additional Width\" and \"Additional Height\" are applied (e.g., Left, Right, Top, Center). |\n| Offset in X direction | Number | 0 | Slides the cut along the length of the male beam. |\n| Offset in Y direction | Number | 0 | Slides the cut perpendicular to the male beam's web. |\n| Offset in Z direction | Number | 0 | Slides the cut vertically. |\n| Negative front offset | Number | 0 | Shortens the cutting tool starting from the negative end of the male beam. |\n| Positive front offset | Number | 0 | Shortens the cutting tool starting from the positive end of the male beam. |\n| Modify section for CNC | Dropdown | No | If set to Yes, updates the beam's sectional properties to reflect the material removal for manufacturing/CAM output. |\n| Convert to Dummy | Dropdown | No | If set to Yes, the male beam is hidden from the model (becomes a dummy) but the cut remains visible. |\n| Convert to static tool | Dropdown | No | If set to Yes, the cut is permanently applied to the female beams and the link to the male beam is broken. The script instance deletes itself. |\n| Make beamcut square | Dropdown | No | If set to Yes, forces the cut to be orthogonal (squared off) rather than following the exact profile of the male beam. (Requires `HSB_T-SquareBeamCut`). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add beam | Prompts you to select additional female beams to add to the existing tooling operation. |\n| Remove beam | Prompts you to select female beams to remove from the tooling operation, restoring their original geometry. |\n\n## Settings Files\n*No specific XML settings files are used by this script. However, ensure the dependency script `HSB_T-SquareBeamCut.mcr` is loaded in your drawing if you plan to use the squaring functionality.*\n\n## Tips\n- **Dynamic vs Static**: By default, the tool is \"Dynamic.\" If you move the male beam, the cut on the female beam updates automatically. If you want to lock the cut in place and stop it from updating, set **Convert to static tool** to **Yes**.\n- **Clearance Control**: Use the **Justification point** combined with **Additional width/height** to create specific overlaps. For example, set Justification to **Left** and Additional Width to **20mm** to extend the cut 20mm to the left only.\n- **Asymmetric Profiles**: If you are cutting with an I-beam or a profile where the web is not centered, check if the cut aligns correctly with the **PtCenter** setting. If the cut looks offset, switch to **PtCenterSolid**.\n\n## FAQ\n- **Q: I selected my beams, but nothing happened. Why?**\n  - A: The beams likely do not physically intersect in 3D space. The script requires a volumetric overlap to calculate the tool. Check that your beams are actually touching or crossing each other.\n- **Q: What happens if I delete the male beam?**\n  - A: In standard (Dynamic) mode, deleting the male beam will usually cause the script to error or remove the tooling. If you want to remove the male beam while keeping the hole, use the **Convert to static tool** option.\n- **Q: The cut shape is weird/diagonal. How do I make it square?**\n  - A: Set **Make beamcut square** to **Yes**. Ensure the script `HSB_T-SquareBeamCut` is loaded in your drawing, or this feature will fail."
      },
      "tokens_used": 8215,
      "error": null
    }
  }
}