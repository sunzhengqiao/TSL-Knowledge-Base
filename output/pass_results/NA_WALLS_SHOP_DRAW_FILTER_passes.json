{
  "filename": "NA_WALLS_SHOP_DRAW_FILTER.mcr",
  "status": "completed",
  "total_tokens": 21226,
  "processing_time": 551.1852869987488,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 4740,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity to select TslInst instances (typically Model Space elements), lacks sd_ prefix or Viewport logic, acts as a utility to filter elements based on mpElementShop map data."
        },
        "prerequisites": {
          "requiredEntities": [
            "TslInst"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing wall group TSL instances",
          "requiredSettings": [
            "mpElementShop map containing 'walls' entity array"
          ]
        }
      },
      "tokens_used": 3067,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\n Select wall group tsls",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2872,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Validates and filters a selection of wall group TSL instances, retaining only those that contain actual wall geometry data within their shop drawing map.",
          "category": "Utility / Data Processing",
          "typicalUseCase": "Preparing a selection of walls for export or downstream processing steps to ensure only valid, populated wall groups are included."
        },
        "parameters": [
          {
            "name": "ssE",
            "technicalDefault": "User Input Selection",
            "businessMeaning": "The set of wall group TSL instances selected by the user to be checked for validity.",
            "validRange": "1 to N TSL Instances (GenBeam or Element groups)",
            "unit": "Selection Set",
            "affectsOutput": "Determines the pool of entities; the script filters this list in memory to keep only wall groups that contain valid 'walls' data in their 'mpElementShop' map."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User selects TSL Instances via command line",
            "effect": "Script inspects the 'mpElementShop' map of each selected instance.",
            "cascade": [
              "_Entity"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TslInst (Filter/Reference)",
            "description": "The script updates the internal _Entity list to contain only valid wall groups. It does not create physical geometry but filters the selection.",
            "appliedTo": "Model Space TSL Instances representing wall groups."
          }
        ]
      },
      "tokens_used": 3015,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script insertion triggered (_bOnInsert = true)",
          "Check insert cycle count (prevent re-runs)",
          "Prompt user to select wall group TSL instances",
          "Store selection in internal _Entity list",
          "Loop through _Entity list in reverse order",
          "Access 'mpElementShop' sub-map for each entity",
          "Check if 'walls' entity array exists and contains data",
          "Remove entity from _Entity list if data is missing",
          "Check if _Entity list is empty after filtering",
          "Script ends (filtered list remains in memory)"
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase current script instance",
                "Terminate execution immediately"
              ]
            },
            "path2": {
              "name": "Cycle == 1",
              "steps": [
                "Proceed to entity selection prompt"
              ]
            }
          },
          {
            "condition": "Map Data Validation ('mpElementShop')",
            "path1": {
              "name": "Valid Data Found",
              "steps": [
                "Map length > 0 AND 'walls' array length > 0",
                "Retain entity in _Entity list"
              ]
            },
            "path2": {
              "name": "Invalid/Missing Data",
              "steps": [
                "Map missing, empty, or 'walls' array empty",
                "Remove entity from _Entity list at current index"
              ]
            }
          },
          {
            "condition": "Final Entity Count",
            "path1": {
              "name": "Entities Remaining",
              "steps": [
                "_Entity.length > 0",
                "Script completes successfully (retaining filtered list)"
              ]
            },
            "path2": {
              "name": "No Entities Remaining",
              "steps": [
                "_Entity.length == 0",
                "Script terminates without further action"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Presence of 'mpElementShop' Sub-Map",
            "errorMessage": "None (Silent removal)",
            "recovery": "N/A - Entity is automatically removed from the selection set."
          },
          {
            "check": "Population of 'walls' Entity Array within Map",
            "errorMessage": "None (Silent removal)",
            "recovery": "N/A - Entity is automatically removed from the selection set if array length is 0."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None",
            "how": "N/A",
            "effect": "The script functions as a command-line utility filter. Once execution finishes, there are no OPM properties or context menus to modify the instance."
          }
        ]
      },
      "tokens_used": 3423,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# NA_WALLS_SHOP_DRAW_FILTER\n\n## Overview\nThis script is a utility tool that filters a selection of wall group TSL instances. It validates each selected group and retains only those that contain valid wall geometry data, ensuring empty or uncalculated groups are excluded from downstream processes.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in Model Space where wall group TSL instances are located. |\n| Paper Space | No | Not supported for Paper Space layouts. |\n| Shop Drawing | No | This is a utility script that processes shop drawing data but is run in the Model environment. |\n\n## Prerequisites\n- **Required Entities:** Wall group TSL instances (TslInst) must exist in the drawing.\n- **Minimum Beam Count:** 0\n- **Required Settings:** The selected wall groups must have internal map data (`mpElementShop`) populated with wall geometry (`walls` array) to be retained.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT` â†’ Select `NA_WALLS_SHOP_DRAW_FILTER.mcr`\n1.  Type `TSLINSERT` in the command line and press Enter.\n2.  In the file dialog, locate and select `NA_WALLS_SHOP_DRAW_FILTER.mcr`.\n\n### Step 2: Select Wall Groups\n```\nCommand Line: Select wall group tsls\nAction: Click on the wall group TSL instances you wish to validate/filter, then press Enter.\n```\n*Note: The script will automatically check the selected groups and remove any that do not contain valid shop drawing data.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| None | N/A | N/A | This script does not expose editable properties in the Properties Palette. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are added by this script. |\n\n## Settings Files\n- **Filename:** None\n- **Location:** N/A\n- **Purpose:** N/A (Script relies on internal entity map data).\n\n## Tips\n- **Automatic Cleanup:** The script instance will automatically erase itself from the drawing immediately after execution. This is normal behavior.\n- **Selection Logic:** Use this script before running an export or CAM generation process to ensure you do not process empty wall shells.\n- **Visual Feedback:** The script runs silently. If the selection set becomes empty, it means none of the selected groups contained valid wall data.\n\n## FAQ\n- **Q: Why did the script icon disappear immediately after I selected the walls?**\n  - A: The script is designed to run only once per insertion. It performs the filter, updates the internal selection list, and then automatically erases the script instance from the drawing.\n- **Q: How do I know if a wall was filtered out?**\n  - A: The script does not provide a visual warning for specific items. However, if you are running this as part of a larger workflow, the subsequent steps will only process the valid walls that passed the filter.\n- **Q: Can I run this on individual beams?**\n  - A: No, this script is designed specifically to filter \"Wall Group\" TSL instances, not individual timber beams."
      },
      "tokens_used": 4109,
      "error": null
    }
  }
}