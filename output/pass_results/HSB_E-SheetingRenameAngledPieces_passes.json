{
  "filename": "HSB_E-SheetingRenameAngledPieces.mcr",
  "status": "completed",
  "total_tokens": 33711,
  "processing_time": 341.61191177368164,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "03.05.2017",
            "author": "DR",
            "changes": "Copied from LP-R-AngledTileLath.mcr - Release"
          },
          {
            "version": "1.01",
            "date": "09.06.2017",
            "author": "DR",
            "changes": "Values exposed as properties"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5289,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly creates new instances in `_kModelSpace` using `dbCreate`. It processes `Sheet` objects retrieved from an `Element` using `el.sheet(nZoneIndex)`, which are 3D model entities. There are no `sd_` prefixes, `_Viewport` references, or `_kPaperSpace` usage."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3523,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDialog",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nZone",
            "type": "PropInt",
            "displayName": "Zone",
            "defaultValue": 5,
            "inputType": "dropdown",
            "options": [
              "0",
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "10"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sName",
            "type": "PropString",
            "displayName": "Name",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sMaterial",
            "type": "PropString",
            "displayName": "Material",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sGrade",
            "type": "PropString",
            "displayName": "Grade",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sInformation",
            "type": "PropString",
            "displayName": "Information",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sLabel",
            "type": "PropString",
            "displayName": "Label",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sSubLabel",
            "type": "PropString",
            "displayName": "SubLabel",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sSubLabel2",
            "type": "PropString",
            "displayName": "SubLabel2",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sBeamCode",
            "type": "PropString",
            "displayName": "Beam code",
            "defaultValue": "PANLATS",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 82,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6404,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Identifies and renames rectangular sheeting panels within a specific construction zone that are installed at an angle (non-orthogonal to the element axes) to standardize naming and material properties for angled panels.",
          "category": "DataManagement/Sheeting",
          "typicalUseCase": "Used after placing roof or wall sheeting where some panels are skewed or rotated relative to the main element, allowing the user to batch-update these specific panels with a specific material code (e.g., 'PANLATS') and color."
        },
        "parameters": [
          {
            "name": "nZone",
            "technicalDefault": 5,
            "businessMeaning": "Specifies the construction zone index within the element to search for sheeting panels. In hsbCAD, elements can have multiple zones (e.g., different layers or regions of a wall/roof).",
            "validRange": "0 to 10",
            "unit": "count",
            "affectsOutput": "Determines which set of sheeting panels are evaluated. If the wrong zone is selected, the script will find no panels to rename."
          },
          {
            "name": "sName",
            "technicalDefault": "",
            "businessMeaning": "The new Name attribute assigned to angled sheets.",
            "validRange": "Any text string",
            "unit": "text",
            "affectsOutput": "Updates the 'Name' property in the element list and data export for identified angled sheets."
          },
          {
            "name": "sMaterial",
            "technicalDefault": "",
            "businessMeaning": "The material designation (e.g., 'OSB', 'PLYWOOD') assigned to angled sheets.",
            "validRange": "Any valid material string from the project database",
            "unit": "text",
            "affectsOutput": "Updates the material property, potentially affecting reports and material take-offs."
          },
          {
            "name": "sGrade",
            "technicalDefault": "",
            "businessMeaning": "The structural grade or quality class of the sheeting material.",
            "validRange": "Any valid grade string (e.g., 'C24', 'OSB/3')",
            "unit": "text",
            "affectsOutput": "Updates the grade property for engineering calculations or reports."
          },
          {
            "name": "sInformation",
            "technicalDefault": "",
            "businessMeaning": "Additional descriptive text or comments regarding the specific angled sheets.",
            "validRange": "Any text string",
            "unit": "text",
            "affectsOutput": "Updates the 'Information' field on the sheet entity."
          },
          {
            "name": "sLabel",
            "technicalDefault": "",
            "businessMeaning": "The primary label text assigned to the angled sheets (often used for shop drawings or labeling).",
            "validRange": "Any text string",
            "unit": "text",
            "affectsOutput": "Updates the Label displayed in drawings and lists."
          },
          {
            "name": "sSubLabel",
            "technicalDefault": "",
            "businessMeaning": "The secondary label text assigned to the angled sheets.",
            "validRange": "Any text string",
            "unit": "text",
            "affectsOutput": "Updates the SubLabel field in drawings and lists."
          },
          {
            "name": "sSubLabel2",
            "technicalDefault": "",
            "businessMeaning": "A tertiary label or designation for the angled sheets.",
            "validRange": "Any text string",
            "unit": "text",
            "affectsOutput": "Updates the SubLabel2 field."
          },
          {
            "name": "sBeamCode",
            "technicalDefault": "PANLATS",
            "businessMeaning": "A specific code identifying the type of element (e.g., 'Panels Lats' or special angled cladding), often used for filtering in production lists or CNC exports.",
            "validRange": "Any alphanumeric code",
            "unit": "text",
            "affectsOutput": "Overwrites the beam code. Note: The script hardcodes 'PANLATS' in the logic (`sh.setBeamCode(\"PANLATS\")`), ignoring the property value during execution."
          },
          {
            "name": "nColor",
            "technicalDefault": 82,
            "businessMeaning": "The CAD display color index for the angled sheets, used to visually distinguish them from standard sheets in the model.",
            "validRange": "0 to 255 (AutoCAD Color Index)",
            "unit": "index",
            "affectsOutput": "Changes the visual color of the identified angled sheets in the 3D model and 2D drawings."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "nZone",
            "effect": "Determines the scope of entities searched; no other parameters function if the zone contains no entities.",
            "cascade": [
              "sName",
              "sMaterial",
              "sGrade",
              "sInformation",
              "sLabel",
              "sSubLabel",
              "sSubLabel2",
              "sBeamCode",
              "nColor"
            ]
          },
          {
            "trigger": "Script Execution Logic",
            "effect": "The `sBeamCode` parameter is ignored by the script's logic, which forces the value 'PANLATS' regardless of user input.",
            "cascade": [
              "sBeamCode"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Sheet",
            "description": "Existing sheeting entities that are rectangular but aligned non-orthogonally (angled) relative to the element's coordinate system are modified. Specifically, sheets parallel to the element's X-axis but with corners having internal angles not equal to 90 degrees are targeted.",
            "appliedTo": "Sheets within the selected `nZone` of the selected Element(s)."
          }
        ]
      },
      "tokens_used": 5580,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts execution.",
          "Check if running in insert mode (_bOnInsert).",
          "[Insert Mode] Verify insert cycle count is not greater than 1.",
          "[Insert Mode] Check if an execute key was provided via command line.",
          "[Insert Mode] If no execute key or invalid key, display the Properties Dialog (ShowDialog).",
          "[Insert Mode] Save current property values to the '_LastInserted' catalog.",
          "[Insert Mode] Prompt user to select one or more Elements using PrEntity.",
          "[Insert Mode] Iterate through the selected Elements.",
          "[Insert Mode] For each valid Element, create a new instance of the script attached to that Element in ModelSpace using dbCreate.",
          "[Insert Mode] Erase the temporary insertion instance and exit.",
          "[Calculation Mode] Load property values from the '_LastInserted' catalog.",
          "[Calculation Mode] Calculate the specific zone index based on the user selection (handling indices > 5).",
          "[Calculation Mode] Validate that at least one Element is attached to the script instance.",
          "[Calculation Mode] Retrieve the coordinate system of the attached Element.",
          "[Calculation Mode] Retrieve all Sheet entities within the calculated zone index.",
          "[Calculation Mode] Filter sheets to find those aligned with the Element's X-axis (perpendicular to Y-axis).",
          "[Calculation Mode] Iterate through aligned sheets.",
          "[Calculation Mode] Validate the sheet geometry is a quadrilateral (4 vertices).",
          "[Calculation Mode] Calculate internal angles at each vertex.",
          "[Calculation Mode] Check if any internal angle deviates from 90 degrees (within tolerance).",
          "[Calculation Mode - Angled Detected] Apply updates to Name, Material, Grade, Information, Label, SubLabel, SubLabel2.",
          "[Calculation Mode - Angled Detected] Hardcode BeamCode to 'PANLATS' and apply Color.",
          "[Calculation Mode] Report the Zone Index processed.",
          "[Calculation Mode] Erase the script instance and exit."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "Cycle Count > 1",
              "steps": [
                "Erase instance",
                "Exit script"
              ]
            },
            "path2": {
              "name": "Cycle Count = 1",
              "steps": [
                "Proceed with insertion flow"
              ]
            }
          },
          {
            "condition": "Execute Key Usage",
            "path1": {
              "name": "Execute Key Provided and Valid",
              "steps": [
                "Load properties from catalog",
                "Skip Dialog"
              ]
            },
            "path2": {
              "name": "No Execute Key or Invalid",
              "steps": [
                "Show Dialog",
                "Load properties from dialog"
              ]
            }
          },
          {
            "condition": "Element Selection",
            "path1": {
              "name": "User Cancels PrEntity",
              "steps": [
                "Erase instance",
                "Exit script"
              ]
            },
            "path2": {
              "name": "User Selects Elements",
              "steps": [
                "Process each element",
                "Create persistent instances"
              ]
            }
          },
          {
            "condition": "Attached Element Validation (Calculation Mode)",
            "path1": {
              "name": "No Attached Element",
              "steps": [
                "Report Warning: 'invalid or no element selected.'",
                "Erase instance",
                "Exit"
              ]
            },
            "path2": {
              "name": "Valid Attached Element",
              "steps": [
                "Process sheets in zone"
              ]
            }
          },
          {
            "condition": "Sheet Vertex Count",
            "path1": {
              "name": "Vertices != 4",
              "steps": [
                "Skip sheet (not a simple quadrilateral)"
              ]
            },
            "path2": {
              "name": "Vertices == 4",
              "steps": [
                "Check internal angles"
              ]
            }
          },
          {
            "condition": "Internal Angle Check",
            "path1": {
              "name": "Angles deviate from 90 degrees",
              "steps": [
                "Identify as 'Angled'",
                "Rename and update properties",
                "Apply color"
              ]
            },
            "path2": {
              "name": "Angles are 90 degrees (Rectangular/Orthogonal)",
              "steps": [
                "Ignore sheet"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Attached Element Validity",
            "errorMessage": "invalid or no element selected.",
            "recovery": "Ensure the script instance is correctly linked to a valid Element entity in the model."
          },
          {
            "check": "Sheet Geometry (Vertex Count)",
            "errorMessage": "None (Silent fail)",
            "recovery": "Script ignores sheets with complex geometry (more/less than 4 vertices)."
          },
          {
            "check": "Internal Angle Orthogonality",
            "errorMessage": "None (Implicit filter)",
            "recovery": "Script implicitly treats orthogonal sheets as 'standard' and does not modify them."
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 6430,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-SheetingRenameAngledPieces.mcr\n\n## Overview\nThis script identifies rectangular sheeting panels within a specific construction zone that are installed at an angle (non-orthogonal). It automatically renames these angled panels and updates their material properties, labels, and visual color to distinguish them from standard sheeting.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script processes 3D Element entities and their sheets. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Not designed for generating 2D drawings directly. |\n\n## Prerequisites\n- **Required Entities**: An Element (e.g., a wall or roof) containing sheeting.\n- **Minimum Beam Count**: 0 (Script acts on sheets attached to elements).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Browse and select `HSB_E-SheetingRenameAngledPieces.mcr`.\n\n### Step 2: Configure Properties\n1. The **Properties** dialog (or palette) will appear automatically.\n2. Set the **Zone** number to match the layer index where your sheeting is located (default is 5).\n3. Enter the desired **Name**, **Material**, **Grade**, and **Labels** you want applied to the angled pieces.\n4. (Optional) Change the **Color** to make modified pieces visually distinct.\n5. Click **OK** to proceed.\n\n### Step 3: Select Elements\n```\nCommand Line: Select elements\nAction: Click on the Element(s) (e.g., Roof or Wall) containing the sheeting you wish to process. Press Enter to confirm selection.\n```\n*The script will automatically scan the chosen zone of the selected elements, identify angled panels, and update their properties.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Zone | dropdown | 5 | The construction zone index within the element to search for sheeting (Range 0-10). |\n| Name | text | | The new Name attribute assigned to angled sheets. |\n| Material | text | | The material designation (e.g., 'OSB', 'PLYWOOD'). |\n| Grade | text | | The structural grade or quality class of the sheeting. |\n| Information | text | | Additional descriptive text or comments. |\n| Label | text | | The primary label text for drawings. |\n| SubLabel | text | | The secondary label text. |\n| SubLabel2 | text | | The tertiary label text. |\n| Beam code | text | PANLATS | A code for production lists. **Note:** This value is hardcoded to \"PANLATS\" by the script logic, regardless of user input. |\n| Color | number | 82 | The CAD display color index (0-255) used to visually highlight angled sheets. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | No custom context menu items are added by this script. Standard TSL recalculation applies. |\n\n## Settings Files\n- None required.\n\n## Tips\n- **Zone Selection**: If the script seems to do nothing, verify that your sheeting is actually in the **Zone** specified in the properties. Many elements use Zone 0 or Zone 5 by default.\n- **Visual Verification**: Set the **Color** to a bright color (like Red or Magenta) initially. This allows you to instantly see which panels were identified as \"angled\" in the 3D model.\n- **Beam Code Limitation**: Do not rely on the **Beam code** property to change the code; the script is designed to force the code \"PANLATS\" for all detected angled pieces.\n\n## FAQ\n- **Q: Why didn't my standard rectangular sheets get renamed?**\n  A: The script specifically targets \"angled\" pieces. It calculates the internal angles of the sheets; if all corners are 90 degrees, the sheet is considered standard and ignored.\n- **Q: Why is the Beam Code always \"PANLATS\" even if I type something else?**\n  A: The script logic contains a hardcoded command to set the Beam Code to \"PANLATS\" for any piece it identifies as angled. This overrides any value you type in the properties panel."
      },
      "tokens_used": 6485,
      "error": null
    }
  }
}