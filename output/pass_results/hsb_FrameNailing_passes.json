{
  "filename": "hsb_FrameNailing.mcr",
  "status": "completed",
  "total_tokens": 40870,
  "processing_time": 824.9054386615753,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.17\",\n      \"date\": \"02.11.2022\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"HSB-16838: Use plane profiles from ExtrProfile instead of realBody\"\n    },\n    {\n      \"version\": \"1.0\",\n      \"date\": \"15.03.2012\",\n      \"author\": \"Chirag Sawjani\",\n      \"changes\": \"Release Version\"\n    },\n    {\n      \"version\": \"1.1\",\n      \"date\": \"22.05.2012\",\n      \"author\": null,\n      \"changes\": \"Bugfix with the floor trimmers benn nail\"\n    },\n    {\n      \"version\": \"1.2\",\n      \"date\": \"24.05.2012\",\n      \"author\": null,\n      \"changes\": \"Reduced size of planeprofile around opening when finding module stud and added opening array for finding the relevant module\"\n    },\n    {\n      \"version\": \"1.3\",\n      \"date\": \"28.05.2012\",\n      \"author\": null,\n      \"changes\": \"Added check for nails on headers (without jacks) or brace so that no double nail hits the right nail if it happens to be = centres.  Fixed points on spandrels\"\n    },\n    {\n      \"version\": \"1.4\",\n      \"date\": \"29.05.2012\",\n      \"author\": null,\n      \"changes\": \"Removed nailing for the brace when there are no jacks and added sill to opening array\"\n    },\n"
      },
      "tokens_used": 9560,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script selects `Element` objects during insertion and processes `GenBeam` entities contained within them. It utilizes 3D geometry methods such as `realBody()`, `ExtrProfile`, and `PlaneProfile`. There are no references to `_Viewport`, `_kPaperSpace`, or `sd_` prefixes. The script spawns child instances (`hsb_FrameNail`) to apply nailing details directly to the structural model."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": [
            "hsb_FrameNail.mcr (Referenced script for creating individual nails)",
            "Catalog entries for default properties (dIndex0, etc.)"
          ]
        }
      },
      "tokens_used": 7977,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one, or more elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "psViewDirection",
            "type": "PropString",
            "displayName": "|View Direction|",
            "defaultValue": "|Outside|",
            "inputType": "dropdown",
            "options": [
              "|Outside|",
              "|Inside|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dIndex0",
            "type": "PropDouble",
            "displayName": "Index 1 Position",
            "defaultValue": 20,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dIndex1",
            "type": "PropDouble",
            "displayName": "Index 2 Position",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dIndex2",
            "type": "PropDouble",
            "displayName": "Index 3 Position",
            "defaultValue": 60,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dIndex3",
            "type": "PropDouble",
            "displayName": "Index 4 Position",
            "defaultValue": 100,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dHeadBraceSpacing",
            "type": "PropDouble",
            "displayName": "Header/Brace Nail Spacing",
            "defaultValue": 600,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Reapply Frame Nails",
            "handler": "Reapply Frame Nails",
            "action": "Resets internal map ExecutionMode to 0 to trigger recalculation of nail positions.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7884,
      "error": null
    },
    "4": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "Request timeout after retries"
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"Script Start / Insertion Trigger\",\n    \"Show Properties Dialog (if no execute key provided)\",\n    \"Prompt User to Select Element(s) via PrEntity\",\n    \"Validate Selection (Cancel script if no elements selected)\",\n    \"Spawn Child Instance for each selected Element (passing properties and ExecutionMode=0)\",\n    \"Erase Parent Instance\",\n    \"Child Instance Start: Validate Element Reference (Erase self if element is deleted)\",\n    \"Add Context Menu Item: 'Reapply Frame Nails'\",\n    \"Check Execution Mode (Default 1, set to 0 on Insert or Recalc)\",\n    \"Initialize Geometry: Get Element Coordinate System and Envelope\",\n    \"Clean up existing Child Nails (erase all attached hsb_FrameNail instances)\",\n    \"Determine Element Type (Wall vs Floor)\",\n    \"Branch Process: Categorize Beams (Wall) OR Sort Beams (Floor)\",\n    \"Calculate Intersection Points and Nail Indexes based on View Direction and Beam Geometry\",\n    \"Spawn Child Nails (hsb_FrameNail) at calculated coordinates\",\n    \"Update Execution Mode to 1 (Completed)\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Element Construction Type\",\n      \"path1\": {\n        \"name\": \"Wall (ElementWallSF)\",\n        \"steps\": [\n          \"Categorize beams into Top Plates, Bottom Plates, Studs, Headers, Jacks, Braces, and Openings\",\n          \"Filter 'No Nailing' beams\",\n          \"Match Studs to Top/Bottom Plates based on vertical position\",\n          \"Process Headers: Find intersecting studs, apply 'Header/Brace Nail Spacing'\",\n          \"Process Braces: Only nail braces if Jacks exist adjacent to them\",\n          \"Determine Nail Index (1-4) by checking profile intersection at Index Positions\"\n        ]\n      },\n      \"path2\": {\n        \""
      },
      "tokens_used": 10926,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_FrameNailing.mcr\n\n## Overview\nThis script automatically calculates and generates nailing details for timber frame walls and floors. It identifies structural components (studs, plates, headers, etc.) and places nail instances based on configurable spacing and profile positions.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates on 3D Elements and their geometry. |\n| Paper Space | No | |\n| Shop Drawing | No | This is a detailing/modeling script, not a 2D drawing generator. |\n\n## Prerequisites\n- **Required Entities**: At least one structural `Element` (Wall or Floor) must be present in the model.\n- **Minimum Beam Count**: 0 (The script scans the entire element).\n- **Required Settings Files**:\n  - `hsb_FrameNail.mcr`: This referenced script is required to generate the individual nail objects.\n  - Catalog entries for default material/nail properties (handled by the child script).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Browse and select `hsb_FrameNailing.mcr`\n\n### Step 2: Select Elements\n```\nCommand Line: Select one, or more elements\nAction: Click on the wall or floor elements you wish to apply nailing to. Press Enter to confirm selection.\n```\n\n### Step 3: Adjust Properties (Optional)\nAfter insertion, select the script instance (usually located near the element origin or selectable via Quick Select) to modify nailing parameters in the Properties Palette.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| View Direction | Dropdown | Outside | Determines which side of the wall/floor to apply nails (Inside or Outside). |\n| Index 1 Position | Number | 20 | Vertical position offset for the first nail row relative to the beam profile. |\n| Index 2 Position | Number | 0 | Vertical position offset for the second nail row. |\n| Index 3 Position | Number | 60 | Vertical position offset for the third nail row. |\n| Index 4 Position | Number | 100 | Vertical position offset for the fourth nail row. |\n| Header/Brace Nail Spacing | Number | 600 | The maximum spacing (in mm) between nails along headers and braces. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Reapply Frame Nails | Deletes all existing nails generated by this instance and recalculates them based on the current geometry and property settings. |\n\n## Settings Files\n- **Filename**: `hsb_FrameNail.mcr`\n- **Location**: TSL Search Path (Company or hsbCAD Install path)\n- **Purpose**: This child script is spawned dynamically by the main script to create the actual nail geometry at the calculated coordinates.\n\n## Tips\n- **Updating Nails**: If you modify the wall geometry (e.g., move a window or add an opening), right-click the script instance and select **Reapply Frame Nails** to update the pattern.\n- **Visualizing Nails**: Ensure your layer settings allow you to see the entities generated by the `hsb_FrameNail` script.\n- **Floor Trimmers**: The script includes logic to handle floor trimmers and prevents double nailing on headers or braces when spacing aligns exactly.\n\n## FAQ\n- **Q: Why don't I see any nails after running the script?**\n  - A: Ensure that `hsb_FrameNail.mcr` exists in your TSL search path. Also, check the **View Direction** property; you may be looking at the wrong side of the wall.\n- **Q: How are the \"Index\" positions used?**\n  - A: These values determine where the nails are placed vertically across the width of a stud or plate. They are checked against the beam's profile geometry to find valid nailing points.\n- **Q: Does this work for both walls and floors?**\n  - A: Yes, the script detects whether the selected element is a Wall or a Floor and applies the appropriate logic for beam categorization and nailing."
      },
      "tokens_used": 4523,
      "error": null
    }
  }
}