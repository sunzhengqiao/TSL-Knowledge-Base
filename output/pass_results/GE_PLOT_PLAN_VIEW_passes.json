{
  "filename": "GE_PLOT_PLAN_VIEW.mcr",
  "status": "completed",
  "total_tokens": 51286,
  "processing_time": 540.3646864891052,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "v1.1",
            "date": "20.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Name on prop. changed from \"Sill\" to \"Window Sill\""
          },
          {
            "version": "v1.0",
            "date": "28.jun.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Made a copy of Albert's hsb_LayoutPlanSection (v2.0: 07.06.2012)\n- Added pre-defined values for individual customization for every beam type\n- Added special treatment for vertical/horizontal blocking"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7415,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": false,
          "detectionEvidence": "PropString sSpace allows selection between 'paper space' and 'shopdraw multipage'. Logic checks _Viewport.length() > 0 for Paper Space execution and _Entity[0].bIsKindOf(ShopDrawView) for Shop Drawing execution."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "ShopDrawView"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be inserted into Paper Space (selecting a Viewport linked to an Element) or Shop Drawing Space (selecting a ShopDrawView).",
          "requiredSettings": []
        }
      },
      "tokens_used": 4900,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getViewport\",\n        \"promptOriginal\": \"Select the viewport from which the element is taken\",\n        \"condition\": \"sSpace == sPaperSpace\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"getShopDrawView\",\n        \"promptOriginal\": \"|Select the view entity from which the module is taken|\",\n        \"condition\": \"sSpace == sShopdrawSpace\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"showDialog\",\n      \"trigger\": \"Insertion (_bOnInsert)\",\n      \"title\": null,\n      \"dataSource\": \"OPM Properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 1,\n      \"variable\": \"sSpace\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Drawing space|\",\n      \"defaultValue\": \"|paper space|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|paper space|\",\n        \"|shopdraw multipage|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sbmName00\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Jack Over Opening\",\n      \"defaultValue\": \"|No display|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No display|\",\n        \"O\",\n        \"/\",\n        \"\\\\\",\n        \"X\",\n        \"|Outline only|\",\n        \"|Center line trough timber|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sbmName01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Jack Under Opening\",\n      \"defaultValue\": \"|No display|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No display|\",\n        \"O\",\n        \"/\",\n        \"\\\\\",\n        \"X\",\n        \"|Outline only|\",\n        \"|Center line trough timber|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"sbmName02\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Cripple Stud\",\n      \"defaultValue\": \"|No display|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No display|\",\n        \"O\",\n        \"/\",\n        \"\\\\\",\n        \"X\",\n        \"|Outline only|\",\n        \"|Center line trough timber|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 6,\n      \"variable\": \"sbmName03\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Transom\",\n      \"defaultValue\": \"|No display|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No display|\",\n        \"O\",\n        \"/\",\n        \"\\\\\",\n        \"X\",\n        \"|Outline only|\",\n        \"|Center line trough timber|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 7,\n      \"variable\": \"sbmName04\",\n      \"type\": \"PropString\",\n      \"displayName\": \"King Stud\",\n      \"defaultValue\": \"|No display|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No display|\",\n        \"O\",\n        \"/\",\n        \"\\\\\",\n        \"X\",\n        \"|Outline only|\",\n        \"|Center line trough timber|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 8,\n      \"variable\": \"sbmName05\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Window Sill\",\n      \"defaultValue\": \"|No display|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No display|\",\n        \"O\",\n        \"/\",\n        \"\\\\\",\n        \"X\",\n        \"|Outline only|\",\n        \"|Center line trough timber|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 9,\n      \"variable\": \"sbmName06\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Angled TopPlate Left\",\n      \"defaultValue\": \"|No display|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No display|\",\n        \"O\",\n        \"/\",\n        \"\\\\\",\n        \"X\",\n        \"|Outline only|\",\n        \"|Center line trough timber|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 10,\n      \"variable\": \"sbmName07\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Angled TopPlate Right\",\n      \"defaultValue\": \"|No display|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No display|\",\n        \"O\",\n        \"/\",\n        \"\\\\\",\n        \"X\",\n        \"|Outline only|\",\n        \"|Center line trough timber|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 11,\n      \"variable\": \"sbmName08\",\n      \"type\": \"PropString\",\n      \"displayName\": \"TopPlate\",\n      \"defaultValue\": \"|No display|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No display|\",\n        \"O\",\n        \"/\",\n        \"\\\\\",\n        \"X\",\n        \"|Outline only|\",\n        \"|Center line trough timber|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 12,\n      \"variable\": \"sbmName09\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Bottom Plate\",\n      \"defaultValue\": \"|No display|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n       "
      },
      "tokens_used": 9252,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Generates 2D construction symbols (hatching, circles, crosses) for timber frame members in Plan or Elevation views based on their specific beam type, replacing standard 3D projections with customized drafting representations.\",\n    \"category\": \"ShopDrawing / Visualization\",\n    \"typicalUseCase\": \"Used when generating detailed floor plans or wall layouts where specific timber components (like Jack Studs, King Studs, or Blocking) need to be clearly distinguished by standard architectural symbols rather than just outlines.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sSpace\",\n      \"technicalDefault\": \"|paper space|\",\n      \"businessMeaning\": \"Selects the drawing environment where the symbols will be generated.\",\n      \"validRange\": \"|paper space|, |shopdraw multipage|\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Switches the script logic to accept either a Layout Viewport (Paper Space) or a ShopDrawView entity (Shopdraw) as the source for geometry.\"\n    },\n    {\n      \"name\": \"sbmName00\",\n      \"technicalDefault\": \"|No display|\",\n      \"businessMeaning\": \"Defines the 2D symbol for 'Jack Over Opening' beams.\",\n      \"validRange\": \"No display, O, /, \\\\, X, Outline only, Center line trough timber\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Draws the selected symbol (e.g., Circle 'O', Cross 'X') on beams identified as Jack Over Openings.\"\n    },\n    {\n      \"name\": \"sbmName01\",\n      \"technicalDefault\": \"|No display|\",\n      \"businessMeaning\": \"Defines the 2D symbol for 'Jack Under Opening' beams.\",\n      \"validRange\": \"No display, O, /, \\\\, X, Outline only, Center line trough timber\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Draws the selected symbol on beams identified as Jack Under Openings.\"\n    },\n    {\n      \"name\": \"sbmName02\",\n      \"technicalDefault\": \"|No display|\",\n      \"businessMeaning\": \"Defines the 2D symbol for 'Cripple Stud' beams.\",\n      \"validRange\": \"No display, O, /, \\\\, X, Outline only, Center line trough timber\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Draws the selected symbol on beams identified as Cripple Studs.\"\n    },\n    {\n      \"name\": \"sbmName03\",\n      \"technicalDefault\": \"|No display|\",\n      \"businessMeaning\": \"Defines the 2D symbol for 'Transom' beams.\",\n      \"validRange\": \"No display, O, /, \\\\, X, Outline only, Center line trough timber\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Draws the selected symbol on beams identified as Transoms.\"\n    },\n    {\n      \"name\": \"sbmName04\",\n      \"technicalDefault\": \"|No display|\",\n      \"businessMeaning\": \"Defines the 2D symbol for 'King Stud' beams.\",\n      \"validRange\": \"No display, O, /, \\\\, X, Outline only, Center line trough timber\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Draws the selected symbol on beams identified as King Studs.\"\n    },\n    {\n      \"name\": \"sbmName05\",\n      \"technicalDefault\": \"|No display|\",\n      \"businessMeaning\": \"Defines the 2D symbol for 'Window Sill' beams.\",\n      \"validRange\": \"No display, O, /, \\\\, X, Outline only, Center line trough timber\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Draws the selected symbol on beams identified as Window Sills.\"\n    },\n    {\n      \"name\": \"sbmName06\",\n      \"technicalDefault\": \"|No display|\",\n      \"businessMeaning\": \"Defines the 2D symbol for 'Angled TopPlate Left' beams.\",\n      \"validRange\": \"No display, O, /, \\\\, X, Outline only, Center line trough timber\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Draws the selected symbol on beams identified as Angled TopPlate Left.\"\n    },\n    {\n      \"name\": \"sbmName07\",\n      \"technicalDefault\": \"|No display|\",\n      \"businessMeaning\": \"Defines the 2D symbol for 'Angled TopPlate Right' beams.\",\n      \"validRange\": \"No display, O, /, \\\\, X, Outline only, Center line trough timber\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Draws the selected symbol on beams identified as Angled TopPlate Right.\"\n    },\n    {\n      \"name\": \"sbmName08\",\n      \"technicalDefault\": \"|No display|\",\n      \"businessMeaning\": \"Defines the 2D symbol for 'TopPlate' beams.\",\n      \"validRange\": \"No display, O, /, \\\\, X, Outline only, Center line trough timber\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Draws the selected symbol on beams identified as TopPlates.\"\n    },\n    {\n      \"name\": \"sbmName09\",\n      \"technicalDefault\": \"|No display|\",\n      \"businessMeaning\": \"Defines the 2D symbol for 'Bottom Plate' beams.\",\n      \"validRange\": \"No display, O, /, \\\\, X, Outline only, Center line trough timber\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Draws the selected symbol on beams identified as Bottom Plates.\"\n    },\n    {\n      \"name\": \"sbmName10\",\n      \"technicalDefault\": \"|No display|\",\n      \"businessMeaning\": \"Defines the 2D symbol for 'Blocking'. Note: In Paper Space, the script automatically overrides this with a slash '/' for horizontal blocks in horizontal views to ensure clarity.\",\n      \"validRange\": \"No display, O, /, \\\\, X, Outline only, Center line trough timber\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Draws the selected symbol on beams identified as Blocking.\"\n    },\n    {\n      \"name\":"
      },
      "tokens_used": 10519,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Insertion: User launches the TSL.",
          "2. Duplicate Check: Script checks `insertCycleCount`. If > 1, instance is erased to prevent duplicates.",
          "3. Property Dialog: `showDialog()` opens the OPM (Object Properties Manager).",
          "4. User Configuration: User selects 'Drawing Space' (Paper/Shopdraw) and sets symbol styles (e.g., 'O', 'X', '/') for specific beam types.",
          "5. Entity Selection Prompt:",
          "   - IF 'paper space': User selects a Viewport linked to an Element.",
          "   - IF 'shopdraw multipage': User selects a ShopDrawView entity.",
          "6. Geometry Extraction: Script extracts the Element and all Beams from the selected object.",
          "7. Coordinate Transformation: Beam coordinates are transformed to the 2D plane of the view.",
          "8. Beam Processing Loop: For every beam in the element:",
          "   - Identifies beam type.",
          "   - Checks for special Blocking overrides (Horizontal vs Vertical).",
          "   - Retrieves the symbol configuration.",
          "   - Draws the 2D symbol (Shadow, Cross, Circle, Line).",
          "9. Fallback: If Paper Space and no symbols were drawn, displays 'This tsl need to be customized' text."
        ],
        "conditionalBranches": [
          {
            "condition": "Selection of 'Drawing space' property during insertion",
            "path1": {
              "name": "Paper Space Mode",
              "steps": [
                "Prompts user: 'Select the viewport from which the element is taken'",
                "Links script instance to Viewport",
                "Reads Element from Viewport",
                "Enables special Blocking orientation logic"
              ]
            },
            "path2": {
              "name": "Shopdraw Multipage Mode",
              "steps": [
                "Prompts user: 'Select the view entity from which the module is taken'",
                "Links script instance to ShopDrawView",
                "Retrieves Element and ViewData from internal Map",
                "Does not apply special Blocking orientation logic"
              ]
            }
          },
          {
            "condition": "Blocking Beam Orientation Check (Paper Space only)",
            "path1": {
              "name": "Override Active",
              "steps": [
                "Detected Beam type is Blocking",
                "Beam X-vector is perpendicular to World Z (Horizontal) AND View is Horizontal display",
                "OR Beam X-vector is NOT perpendicular (Vertical) AND View is Vertical display",
                "Forces symbol to '/' (slash) regardless of OPM setting"
              ]
            },
            "path2": {
              "name": "Standard Symbol",
              "steps": [
                "Condition not met",
                "Uses the symbol defined in the OPM property (e.g., 'X', 'O')"
              ]
            }
          },
          {
            "condition": "Beam Type Recognition",
            "path1": {
              "name": "Known Type",
              "steps": [
                "Beam type matches an entry in the internal `nBmType` array",
                "Retrieves corresponding symbol from `arCross` array",
                "Draws symbol"
              ]
            },
            "path2": {
              "name": "Unknown Type",
              "steps": [
                "Beam type not found in array",
                "Skips drawing for this specific beam"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Data Integrity",
            "errorMessage": "(Silent failure)",
            "recovery": "Ensure selected Viewport is linked to a valid hsbCAD Element."
          },
          {
            "check": "ShopDrawView Validity",
            "errorMessage": "(Silent failure)",
            "recovery": "Ensure a valid ShopDrawView is selected."
          },
          {
            "check": "ViewData Existence",
            "errorMessage": "(Silent failure)",
            "recovery": "Ensure the ShopDrawView has valid ViewData associated with it in the drawing map."
          },
          {
            "check": "Configuration Status",
            "errorMessage": "Text displayed: 'This tsl need to be customized'",
            "recovery": "User must change the properties for specific beam types from 'No display' to a valid symbol (e.g., 'O', 'X')."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Beam Symbols",
            "how": "Properties Palette (OPM)",
            "effect": "Changing any `sbmName` property immediately recalculates and updates the drawing symbols for the corresponding beam types."
          },
          {
            "action": "Change Drawing Context",
            "how": "Properties Palette (OPM) - Note: `sSpace` is set to Read-Only after initial insertion, so this effectively requires re-insertion or modifying the underlying entity context.",
            "effect": "Switches logic between Paper Space and Shopdraw processing."
          },
          {
            "action": "Geometry Updates",
            "how": "Grip edits / Model Changes",
            "effect": "If the Wall/Element geometry changes or beams are added/removed, the script automatically updates the projection and symbols on the next recalculation."
          }
        ]
      },
      "tokens_used": 10967,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_PLOT_PLAN_VIEW.mcr\n\n## Overview\nThis script generates 2D architectural symbols (such as circles, crosses, or hatching) for timber frame members within plan views or shop drawings. It replaces standard 3D projections with specific 2D representations based on the beam type (e.g., Jack Stud, King Stud, Top Plate).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is intended for detailing in 2D layouts. |\n| Paper Space | Yes | Select a Viewport linked to an Element to generate symbols over the view. |\n| Shop Drawing | Yes | Select a ShopDrawView entity within the multipage environment. |\n\n## Prerequisites\n- **Required Entities**: A Layout Viewport (linked to an hsbCAD Element) OR a ShopDrawView entity.\n- **Minimum Beam Count**: 0 (The script processes whatever beams exist in the selected Element).\n- **Required Settings**: None required, but beam types must be assigned in the model for the script to identify them correctly.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_PLOT_PLAN_VIEW.mcr`\n\n### Step 2: Configure Properties\n1. The **Properties Palette** will open automatically upon insertion.\n2. Under **Drawing space**, select either `paper space` or `shopdraw multipage`.\n3. Scroll down to the beam type properties (e.g., *Jack Over Opening*, *King Stud*, *TopPlate*).\n4. Change the value from `No display` to a desired symbol (e.g., `O`, `X`, `/`, `\\`).\n\n### Step 3: Select View Entity\nDepending on your selection in Step 2, the command line will prompt for an entity:\n\n**If \"paper space\" was selected:**\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click on the layout viewport that displays the wall/floor you want to detail.\n```\n\n**If \"shopdraw multipage\" was selected:**\n```\nCommand Line: Select the view entity from which the module is taken\nAction: Click on the ShopDrawView frame in the drawing.\n```\n\n### Step 4: Generation\nThe script will automatically project the beams and draw the configured symbols onto the view.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Drawing space** | dropdown | paper space | Determines if the script targets a Layout Viewport or a ShopDrawView. |\n| **Jack Over Opening** | dropdown | No display | Symbol style for jack studs located above openings. |\n| **Jack Under Opening** | dropdown | No display | Symbol style for jack studs located below openings. |\n| **Cripple Stud** | dropdown | No display | Symbol style for cripple studs. |\n| **Transom** | dropdown | No display | Symbol style for transom beams. |\n| **King Stud** | dropdown | No display | Symbol style for king studs. |\n| **Window Sill** | dropdown | No display | Symbol style for window sill beams. |\n| **Angled TopPlate Left** | dropdown | No display | Symbol style for left-angled top plates. |\n| **Angled TopPlate Right** | dropdown | No display | Symbol style for right-angled top plates. |\n| **TopPlate** | dropdown | No display | Symbol style for standard top plates. |\n| **Bottom Plate** | dropdown | No display | Symbol style for bottom plates. |\n| **Blocking** | dropdown | No display | Symbol style for blocking members. |\n\n**Symbol Options:**\n- `O`: Draws a circle.\n- `X`: Draws a cross.\n- `/` or `\\`: Draws diagonal lines.\n- `Outline only`: Hides internal lines, keeping only the contour.\n- `Center line trough timber`: Draws a center line through the beam.\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Erase** | Removes the script instance and the generated symbols from the drawing. |\n| **Properties** | Re-opens the Properties Palette to change beam symbols or settings. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies entirely on Properties Palette inputs and does not use external settings files.\n\n## Tips\n- **Automatic Blocking Overrides**: When working in Paper Space, the script automatically detects horizontal blocking in horizontal views and forces the symbol to be a slash (`/`), overriding the property setting. This ensures clarity in standard framing plans.\n- **Initial Setup**: By default, all beam types are set to \"No display\". You must actively select symbols for the beams you wish to visualize.\n- **Visibility**: If you see the text \"This tsl need to be customized\" in your drawing, it means no symbols were generated. Check your properties to ensure at least one beam type is set to a visible symbol.\n\n## FAQ\n- **Q: I inserted the script, but I don't see any symbols?**\n  A: The default setting for all beam types is \"No display\". Select the script, open the Properties palette, and change specific beam types (like TopPlate or King Stud) to symbols like 'X' or 'O'.\n  \n- **Q: Can I use this on a 3D Model Space view?**\n  A: No. This script is designed for 2D output in Paper Space layouts or Shop Drawing pages. It flattens the 3D geometry into 2D symbols."
      },
      "tokens_used": 8233,
      "error": null
    }
  }
}