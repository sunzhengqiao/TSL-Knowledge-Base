{
  "filename": "GE_HDWR_STRAP_TSA_ENHANCED.mcr",
  "status": "completed",
  "total_tokens": 46537,
  "processing_time": 293.00703525543213,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6476,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates 3D geometry using Body objects (bdStrap), generates physical beams in the model (bm.dbCreate for blocking), and instantiates Hardware components (HardWrComp). It uses Display representations for 'Engineering Components'. There are no references to Viewports, Paper Space entities, or Shop Drawing generation logic (sd_ prefixes, #Type E)."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam",
            "TrussEntity"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model space requiring at least one Beam or TrussEntity to determine anchor position and orientation. Optional selection of Element/ElementWall is available for display assignment and blocking generation.",
          "requiredSettings": []
        }
      },
      "tokens_used": 6337,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\\nSelect a Beam or a Truss",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getDouble",
              "promptOriginal": "\\nStrap Length",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "\\nSelect insertion Point (Center of Strap)",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 4,
              "function": "PrEntity",
              "promptOriginal": "Select an Entities or Elements to attach Display to (Optional)",
              "condition": "_bOnInsert",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "pBmQty",
            "type": "PropString",
            "displayName": "Number of Beams",
            "defaultValue": "1 Selected",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dL",
            "type": "PropDouble",
            "displayName": "MSTA Length",
            "defaultValue": "9",
            "inputType": "dropdown",
            "options": [
              "9",
              "12",
              "15",
              "18",
              "21",
              "24",
              "30",
              "36"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nFace",
            "type": "PropInt",
            "displayName": "Face",
            "defaultValue": 1,
            "inputType": "dropdown",
            "options": [
              "1",
              "2",
              "3",
              "4"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dOffFace",
            "type": "PropDouble",
            "displayName": "Face Offset",
            "defaultValue": "0.4375",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dOffSide",
            "type": "PropDouble",
            "displayName": "Lateral Offset",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "strEmpty",
            "type": "PropString",
            "displayName": "CS16 PROPERTIES",
            "defaultValue": " ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strForceCs16",
            "type": "PropString",
            "displayName": "     Force to a CS16",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dCS16Lgt",
            "type": "PropDouble",
            "displayName": "     Length if CS16",
            "defaultValue": "36",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "stExport",
            "type": "PropString",
            "displayName": "Strap Item",
            "defaultValue": "Strap",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Set Reference Beam",
            "handler": "strSetReferenceBm",
            "action": "Prompts user to select a new reference beam to define anchor position and orientation.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Add wall(s) to the display",
            "handler": "strAddWalls",
            "action": "Prompts user to select Elements or Walls to attach the display representation and blocking generation to.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Create blocking",
            "handler": "strCreateBlocking",
            "action": "Manually triggers the generation of blocking pieces within the associated wall element.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8093,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts and configures a metal flat strap (MSTA or custom CS16) connected to a beam or truss, with optional automated blocking generation within the host wall structure.",
          "category": "Hardware",
          "typicalUseCase": "Connecting trusses or beams to wall top plates using a Simpson Strong-Tie style flat strap, providing a hold-down tension connection while automatically generating wood blocking behind the strap if required."
        },
        "parameters": [
          {
            "name": "pBmQty",
            "technicalDefault": "\"1 Selected\"",
            "businessMeaning": "Informational field displaying the count of beams currently selected as the reference anchor.",
            "validRange": "Read-only",
            "unit": "count",
            "affectsOutput": "Does not physically alter geometry; indicates selection state."
          },
          {
            "name": "dL",
            "technicalDefault": "9",
            "businessMeaning": "The standard stock length of the Simpson MSTA (Flat Strap) hardware.",
            "validRange": "9, 12, 15, 18, 21, 24, 30, 36",
            "unit": "inch",
            "affectsOutput": "Defines the total length of the 3D strap body and the pattern of holes along its length."
          },
          {
            "name": "nFace",
            "technicalDefault": "1",
            "businessMeaning": "Selects the specific face of the reference beam (1-4) to which the strap is applied.",
            "validRange": "1, 2, 3, 4",
            "unit": "index",
            "affectsOutput": "Determines the side of the beam the strap attaches to. Automatically locked if a wall element is selected to ensure the strap faces the wall."
          },
          {
            "name": "dOffFace",
            "technicalDefault": "0.4375",
            "businessMeaning": "The offset distance from the face of the beam to the centerline of the strap (standoff).",
            "validRange": "0.0 - 2.0",
            "unit": "inch",
            "affectsOutput": "Moves the strap perpendicular to the beam surface (e.g., to account for sheathing thickness)."
          },
          {
            "name": "dOffSide",
            "technicalDefault": "0",
            "businessMeaning": "Lateral offset sliding the strap along the width of the beam face.",
            "validRange": "-24.0 to 24.0",
            "unit": "inch",
            "affectsOutput": "Shifts the strap position perpendicular to the beam's length axis."
          },
          {
            "name": "strEmpty",
            "technicalDefault": "\" \"",
            "businessMeaning": "Visual separator/label in the properties palette.",
            "validRange": "N/A",
            "unit": "text",
            "affectsOutput": "None."
          },
          {
            "name": "strForceCs16",
            "technicalDefault": "\"Yes\"",
            "businessMeaning": "Toggles the use of a custom strap length (CS16 logic) versus standard MSTA lengths.",
            "validRange": "Yes, No",
            "unit": "boolean",
            "affectsOutput": "If Yes, uses the 'Length if CS16' parameter. If No, uses the standard 'MSTA Length' dropdown."
          },
          {
            "name": "dCS16Lgt",
            "technicalDefault": "36",
            "businessMeaning": "The custom length of the strap when standard sizes are not used.",
            "validRange": "Any positive value",
            "unit": "inch",
            "affectsOutput": "Sets the physical length of the strap geometry when 'Force to a CS16' is active."
          },
          {
            "name": "stExport",
            "technicalDefault": "\"Strap\"",
            "businessMeaning": "The resulting material code or item name generated for reports and production.",
            "validRange": "Text (Read-only)",
            "unit": "text",
            "affectsOutput": "Updates the label seen in BOMs and CNC exports (e.g., 'MSTA-24')."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User inputs a non-standard length at command line during insertion",
            "effect": "Script automatically switches to Custom Mode, sets 'Force to a CS16' to Yes, and updates 'Length if CS16' to the input value.",
            "cascade": [
              "strForceCs16",
              "dCS16Lgt"
            ]
          },
          {
            "trigger": "Wall/Element is associated with the strap",
            "effect": "Script automatically flips the 'Face' parameter (nFace) so the strap orients correctly towards the wall volume and locks it.",
            "cascade": [
              "nFace"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Body",
            "description": "The physical representation of the metal strap with drilled holes for nails/fasteners.",
            "appliedTo": "Model Space (referenced to Beam/Truss)."
          },
          {
            "type": "Hardware Component",
            "description": "Data entity for BOM and Production reports (e.g., Simpson MSTA-24).",
            "appliedTo": "Script Instance."
          },
          {
            "type": "Beam (Blocking)",
            "description": "Solid wood blocking pieces generated inside the wall to provide a backup nailing surface for the strap.",
            "appliedTo": "Host Element/Wall."
          }
        ]
      },
      "tokens_used": 8505,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script initializes properties, sets units to inches, and retrieves state map.",
          "Prompt: User selects a Beam or Truss entity to serve as the anchor.",
          "Prompt: User inputs numeric Strap Length.",
          "Check: Does input length match standard MSTA array (9, 12, 15...)?",
          "If Yes: Property 'MSTA Length' is set to the value.",
          "If No: Property 'Force to a CS16' sets to 'Yes', and 'Length if CS16' is set to the custom value.",
          "Prompt: User selects Insertion Point (Center of Strap).",
          "Prompt: User optionally selects Entities or Elements (Walls) to attach display to.",
          "Check: Anchor Body construction.",
          "Validation: Is calculated Anchor Body volume > 1 unit?",
          "If No: Report error 'No proper reference member found' and erase instance.",
          "If Yes: Proceed to geometry generation.",
          "Check: Is an Element/Wall associated?",
          "If Yes: Calculate vector to Wall Origin. If Face offset points away, flip 'Face' vector (vOff) and lock 'Face' property. Set Level name.",
          "Construct Strap Body based on Length, Width, Thickness, Face, and Offsets.",
          "Generate Nail Holes: Create holes at ends, then loop every 3 inches along length.",
          "Draw Strap Body and Holes in 3D and Engineering Components display reps.",
          "Check: Is blocking creation valid? (Host Element exists, beams exist, Strap parallel to wall).",
          "If Yes: Calculate void in wall around strap, subtract beams and ends. Create 'Blocking' beams in remaining voids.",
          "Create Hardware Component (HardWrComp) for BOM with Article Number derived from Type + Length.",
          "Assign instance to 'X - Hardware' and 'X-Flat Straps' groups.",
          "Save reference point and vector to Map for future beam detection."
        ],
        "conditionalBranches": [
          {
            "condition": "User inputs non-standard Strap Length during insertion",
            "path1": {
              "name": "Standard Mode",
              "steps": [
                "Input matches predefined array (9, 12, 15...)",
                "'MSTA Length' property updated.",
                "'Force to a CS16' property remains unchanged."
              ]
            },
            "path2": {
              "name": "Custom/CS16 Mode",
              "steps": [
                "Input not in array",
                "'Force to a CS16' set to 'Yes'.",
                "'Length if CS16' property set to user input.",
                "Hardware type string changes to 'CS16-'."
              ]
            }
          },
          {
            "condition": "Anchor Entity Type",
            "path1": {
              "name": "Beam Selection",
              "steps": [
                "User selects Beam.",
                "Script uses Beam.envelopeBody() as Anchor.",
                "Coordinate System derived directly from Beam."
              ]
            },
            "path2": {
              "name": "Truss Selection",
              "steps": [
                "User selects TrussEntity.",
                "Script extracts TrussDefinition.",
                "Analyzes GenBeams within Truss to find top chord.",
                "Projects points to base plane to generate a virtual Anchor Body and Coordinate System."
              ]
            }
          },
          {
            "condition": "Reference Retrieval (On Re-calc/Update)",
            "path1": {
              "name": "Explicit Reference",
              "steps": [
                "User triggered 'Set Reference Beam'.",
                "Script prompts for new Beam selection.",
                "Anchor updated immediately."
              ]
            },
            "path2": {
              "name": "Implicit Auto-Detection",
              "steps": [
                "Triggered when _Beam array is empty but _Element exists.",
                "Script iterates all beams in Element.",
                "Finds beam closest to saved Map Point with parallel Vector.",
                "Sets found beam as new reference."
              ]
            }
          },
          {
            "condition": "Element/Wall Association",
            "path1": {
              "name": "Floating (No Wall)",
              "steps": [
                "No Element selected.",
                "'Face' property is unlocked and user-editable (1-4).",
                "No blocking generated."
              ]
            },
            "path2": {
              "name": "Wall Attached",
              "steps": [
                "Element/Wall selected.",
                "'Face' property automatically flips to face wall volume and is set Read-Only.",
                "Display assigned to Wall.",
                "Blocking generated inside wall."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Anchor Body Volume",
            "errorMessage": "\\nNo proper reference member found",
            "recovery": "Script executes eraseInstance(). User must insert script again and select a valid beam/truss."
          },
          {
            "check": "Element List Integrity",
            "errorMessage": "None (Silent)",
            "recovery": "Script checks validity of associated walls on modification. If a wall splits or moves such that the strap center is outside its length, it is removed from the list. If 0 elements remain, instance is erased."
          },
          {
            "check": "Blocking Minimum Length",
            "errorMessage": "None",
            "recovery": "Blocking pieces are only generated if the calculated void length is greater than dMinBlk (1.55 inches)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions/Offsets",
            "how": "OPM Properties Palette",
            "effect": "Changes to 'MSTA Length', 'Length if CS16', 'Face', 'Face Offset', or 'Lateral Offset' trigger script re-calculation, updating strap geometry and hole positions immediately."
          },
          {
            "action": "Move Strap Center",
            "how": "Grip Edit (Drag _Pt0)",
            "effect": "Moves the strap along the beam. Updates blocking location if 'Create blocking' is triggered subsequently."
          },
          {
            "action": "Change Reference Beam",
            "how": "Right-click Context Menu > 'Set Reference Beam'",
            "effect": "Opens selection prompt. Re-assigns the primary beam anchor. Clears existing beam list and appends new selection."
          },
          {
            "action": "Add Walls",
            "how": "Right-click Context Menu > 'Add wall(s) to the display'",
            "effect": "Opens selection prompt for Entities/Walls. Adds them to the internal list. Triggers face locking logic and potentially blocking generation."
          },
          {
            "action": "Regenerate Blocking",
            "how": "Right-click Context Menu > 'Create blocking'",
            "effect": "Forces the blocking generation logic to run. Calculates voids in the wall and creates physical Beam entities set as Type 'Blocking' and Material 'SPF2'."
          }
        ]
      },
      "tokens_used": 9983,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_STRAP_TSA_ENHANCED.mcr\n\n## Overview\nThis script inserts a metal flat strap (Simpson Strong-Tie MSTA style or custom CS16) onto beams or trusses. It supports automatic blocking generation within wall elements and manages display representations for engineering outputs.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script creates 3D geometry and hardware components. |\n| Paper Space | No | Not supported for layout generation. |\n| Shop Drawing | No | Intended for 3D model detailing and BOM generation. |\n\n## Prerequisites\n- **Required Entities:** At least one Beam or TrussEntity must be present to serve as the anchor.\n- **Minimum Beam Count:** 1.\n- **Required Settings Files:** None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_HDWR_STRAP_TSA_ENHANCED.mcr` from the list.\n\n### Step 2: Select Anchor Member\n```\nCommand Line: Select a Beam or a Truss\nAction: Click on a beam or truss in the model where you want the strap to connect.\n```\n\n### Step 3: Specify Strap Length\n```\nCommand Line: Strap Length\nAction: Enter a numeric value (in inches).\nNote: If you enter a standard size (9, 12, 15, 18, 21, 24, 30, 36), standard mode is used. Any other number automatically enables \"Custom Mode\".\n```\n\n### Step 4: Position Strap\n```\nCommand Line: Select insertion Point (Center of Strap)\nAction: Click in the model to place the center point of the strap along the beam.\n```\n\n### Step 5: Attach to Wall (Optional)\n```\nCommand Line: Select an Entities or Elements to attach Display to (Optional)\nAction: Select a Wall or Element if you want to generate blocking inside the wall and link the display to the wall structure. Press Enter to skip if placing on a standalone beam.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Number of Beams** | Text | 1 Selected | Displays the count of currently selected reference beams (Read-only). |\n| **MSTA Length** | Dropdown | 9 | Selects the standard stock length (in inches) for the strap. Options: 9, 12, 15, 18, 21, 24, 30, 36. |\n| **Face** | Dropdown | 1 | Selects which side of the beam the strap attaches to (1-4). *Note: This becomes locked if a wall element is attached.* |\n| **Face Offset** | Number | 0.4375 | Sets the distance (standoff) from the beam face to the centerline of the strap (in inches). |\n| **Lateral Offset** | Number | 0 | Slides the strap along the width of the beam face (in inches). |\n| **CS16 PROPERTIES** | Text | [Space] | Visual separator only. |\n| **Force to a CS16** | Dropdown | Yes | Toggles Custom Mode. Select \"No\" to use standard MSTA lengths, or \"Yes\" to define a custom length below. |\n| **Length if CS16** | Number | 36 | Defines the custom strap length (in inches) when \"Force to a CS16\" is set to \"Yes\". |\n| **Strap Item** | Text | Strap | The material code or item name for reports (e.g., MSTA-24). Read-only. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Set Reference Beam** | Prompts you to select a new beam or truss. This updates the anchor point and orientation if the original member was deleted or moved. |\n| **Add wall(s) to the display** | Allows you to select additional Walls or Elements to attach the strap to. Useful for adding the strap to multiple wall layers or updating the host after design changes. |\n| **Create blocking** | Manually triggers the generation of wood blocking pieces inside the associated wall element. This is required to fill the void behind the strap for nailing. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: All parameters are stored within the script instance properties.\n\n## Tips\n- **Custom Lengths:** If you need a length not found in the standard dropdown (e.g., 14 inches), simply type that value during the command line insertion. The script will automatically switch to \"Custom Mode\" and populate the \"Length if CS16\" field.\n- **Wall Association:** When attaching to a wall, the script automatically detects which side the wall is on and flips the \"Face\" property to match. This prevents the strap from being embedded backward in the wall.\n- **Blocking Generation:** Blocking is not created automatically upon every move to save processing time. Use the \"Create blocking\" right-click option after finalizing the strap position to generate the wood pieces.\n\n## FAQ\n- **Q: Why can't I change the \"Face\" number (1-4)?**\n- **A:** You likely have a Wall or Element attached to the strap. The script locks this property to ensure the strap always faces the correct side of the wall volume. Detach the wall or edit the selection to unlock it.\n- **Q: How do I switch from a standard size (e.g., 24\") to a custom size?**\n- **A:** Set \"Force to a CS16\" to \"Yes\" in the properties palette, then type your desired length in the \"Length if CS16\" field.\n- **Q: My strap disappeared after I deleted the beam.**\n- **A:** The script requires a valid reference beam. Use the right-click option \"Set Reference Beam\" to select a new beam and restore the geometry."
      },
      "tokens_used": 7143,
      "error": null
    }
  }
}