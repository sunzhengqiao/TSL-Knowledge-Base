{
  "filename": "hsb_SetEntitiesProperties.mcr",
  "status": "completed",
  "total_tokens": 30057,
  "processing_time": 317.73298478126526,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "28.02.2019",
            "author": "Alberto Jena",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "15/02/2022",
            "author": "Robert Pol",
            "changes": "Add more props"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4727,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Standard script structure using `_bOnInsert` and `eraseInstance` (action script). Modifies intrinsic GenBeam properties (Name, Material, Grade, Color) belonging to the 3D model. No ShopDrawing specific prefixes (`sd_`), `#Type E` declarations, or Paper Space logic (`_Viewport`) found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D environment)",
          "requiredSettings": []
        }
      },
      "tokens_used": 3280,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 6494,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A batch utility tool to modify or standardize common attributes (Name, Material, Grade, Labels, etc.) across multiple selected timber beams or sheets.",
          "category": "Utility / Data Management",
          "typicalUseCase": "Used when a designer needs to re-classify a group of elements (e.g., setting all studs in a wall to Grade C24) or update naming conventions for production lists without editing each beam individually."
        },
        "parameters": [
          {
            "name": "sName",
            "technicalDefault": "\"\"",
            "businessMeaning": "The logical name or description of the entity used for identification in model browsers and schedules.",
            "validRange": "Alphanumeric string (System Name)",
            "unit": "Text",
            "affectsOutput": "Updates the 'Name' property in the element's data structure and project lists."
          },
          {
            "name": "sMaterial",
            "technicalDefault": "\"\"",
            "businessMeaning": "Defines the specific timber material profile (e.g., species, dimensions) to be applied to the entity.",
            "validRange": "String matching a valid Material Name in the hsbCAD catalog",
            "unit": "Text",
            "affectsOutput": "Updates the physical material definition, potentially affecting weight, cost, and CNC machining strategies."
          },
          {
            "name": "nColor",
            "technicalDefault": "-1",
            "businessMeaning": "The visual display color of the entity in the CAD model.",
            "validRange": "Integer (AutoCAD Color Index 1-255) or -1 to retain existing color.",
            "unit": "Index",
            "affectsOutput": "Changes the visual appearance of the beam in the 3D model and 2D drawings; does not affect physical geometry."
          },
          {
            "name": "sGrade",
            "technicalDefault": "\"\"",
            "businessMeaning": "The structural strength grade of the timber (e.g., C24, GL24h).",
            "validRange": "String matching a valid Grade in the hsbCAD catalog",
            "unit": "Text",
            "affectsOutput": "Updates structural calculation properties and material reporting."
          },
          {
            "name": "sInformation",
            "technicalDefault": "\"\"",
            "businessMeaning": "A free-text field for additional user-defined comments or specific instructions attached to the entity.",
            "validRange": "Text string",
            "unit": "Text",
            "affectsOutput": "Populates the 'Information' field for reports and labels."
          },
          {
            "name": "sLabel",
            "technicalDefault": "\"\"",
            "businessMeaning": "The primary part mark or identifier used for drawings, shipping labels, and assembly.",
            "validRange": "Text string (often generated by numbering systems)",
            "unit": "Text",
            "affectsOutput": "Overwrites the main part mark displayed on drawings and production tags."
          },
          {
            "name": "sSublabel",
            "technicalDefault": "\"\"",
            "businessMeaning": "A secondary classification or part mark, often used for grouping or phase identification.",
            "validRange": "Text string",
            "unit": "Text",
            "affectsOutput": "Updates the Sublabel field used for sorting and filtering in lists."
          },
          {
            "name": "sSublabel2",
            "technicalDefault": "\"\"",
            "businessMeaning": "A tertiary classification or part mark for extended data management.",
            "validRange": "Text string",
            "unit": "Text",
            "affectsOutput": "Updates the Sublabel2 field used for sorting and filtering."
          },
          {
            "name": "sBeamcode",
            "technicalDefault": "\"\"",
            "businessMeaning": "A functional code classifying the type of element (e.g., 'Stud', 'Plate', 'Rafter'), often used to determine machining or export rules.",
            "validRange": "Text string",
            "unit": "Text",
            "affectsOutput": "Updates the Beamcode property, which may trigger specific automation rules or CNC export mappings."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Parameter value is empty (\"\") or -1 for Color",
            "effect": "The existing property of the beam is preserved (unchanged).",
            "cascade": [
              "sName",
              "sMaterial",
              "sGrade",
              "sInformation",
              "sLabel",
              "sSublabel",
              "sSublabel2",
              "sBeamcode",
              "nColor"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Property Modification",
            "description": "Updates intrinsic data fields of existing timber elements without creating new geometry.",
            "appliedTo": "User-selected GenBeam (Beams/Sheets/Columns)"
          }
        ]
      },
      "tokens_used": 5037,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch: User executes the TSL command.",
          "Cycle Check: Script checks if insertCycleCount() > 1. If true, the script instance is erased and execution stops.",
          "Entity Selection: User is prompted to select beams or sheets (PrEntity selection set).",
          "Execution Mode Check: Script checks if an execution key (_kExecuteKey) is present.",
          "Branch A (Silent/Catalog Mode): If a key exists, the script attempts to load properties from a matching catalog entry.",
          "Branch B (Interactive Mode): If no key exists, a dialog (showDialog) is displayed to the user to input property values.",
          "Catalog Update: Property values are saved to the '_LastInserted' catalog entry.",
          "Selection Confirmation: User confirms the selection of entities in the CAD model.",
          "Entity Filtering: The script iterates through the selected entities and filters for valid GenBeam objects, appending them to the internal _Entity array.",
          "Script Execution Pause: The script terminates the insertion phase to let the hsbCAD kernel process the entities.",
          "Property Application Loop: The script iterates through the collected valid GenBeams.",
          "Conditional Property Update: For each beam, the script checks if properties (Name, Material, Color, etc.) are set (non-empty or not -1).",
          "Entity Modification: If conditions are met, specific properties on the GenBeam are updated (e.g., gb.setName()).",
          "Cleanup: The script instance is erased from the drawing."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "Subsequent Cycle",
              "steps": [
                "Erase Instance",
                "Return"
              ]
            },
            "path2": {
              "name": "First Cycle",
              "steps": [
                "Proceed to Entity Selection"
              ]
            }
          },
          {
            "condition": "Execution Key (_kExecuteKey) presence",
            "path1": {
              "name": "Catalog Mode (Silent)",
              "steps": [
                "Get list of catalog names",
                "Search for matching key (case-insensitive)",
                "Load properties from catalog (setPropValuesFromCatalog)",
                "Update '_LastInserted' catalog"
              ]
            },
            "path2": {
              "name": "Interactive Mode",
              "steps": [
                "Show Dialog (showDialog)",
                "Update '_LastInserted' catalog"
              ]
            }
          },
          {
            "condition": "Entity Selection (PrEntity)",
            "path1": {
              "name": "Valid Selection",
              "steps": [
                "Process entities into array",
                "Continue to Property Application"
              ]
            },
            "path2": {
              "name": "Empty/Cancelled Selection",
              "steps": [
                "Entity array remains empty",
                "Instance Erasure Triggered"
              ]
            }
          },
          {
            "condition": "Property Value State (Per Beam)",
            "path1": {
              "name": "Value is Set",
              "steps": [
                "Update specific beam property (e.g., setName, setMaterial)"
              ]
            },
            "path2": {
              "name": "Value is Default/Empty",
              "steps": [
                "Preserve existing beam property (No change)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity validity (_Entity array length > 0)",
            "errorMessage": "None (Script fails silently by erasing itself)",
            "recovery": "User must re-run the script and select at least one valid GenBeam."
          },
          {
            "check": "Individual Entity Validity (gb.bIsValid())",
            "errorMessage": "None (Invalid entities are skipped in the loop)",
            "recovery": "Ensure selected objects are valid hsbCAD GenBeams or Sheets."
          },
          {
            "check": "Catalog Key Match",
            "errorMessage": "None (If key is not found in list, logic falls through to load properties anyway based on provided key name, though logic suggests 'else' block might be a fallback)",
            "recovery": "Ensure the execution key passed matches a valid catalog name if intended."
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 4854,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SetEntitiesProperties.mcr\n\n## Overview\nA batch utility tool to modify or standardize common attributes (Name, Material, Grade, Labels, etc.) across multiple selected timber beams or sheets in one operation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D model elements (GenBeams/Sheets). |\n| Paper Space | No | Not applicable for 2D drawings or layouts. |\n| Shop Drawing | No | This is an action script for the 3D model, not shop drawing generation. |\n\n## Prerequisites\n- **Required Entities**: GenBeam (Beams, Sheets, or Columns).\n- **Minimum Beam Count**: 1 (You must select at least one valid element).\n- **Required Settings**: None (Script includes internal logic to save last used settings).\n\n## Usage Steps\n\n### Step 1: Launch Script\n```\nCommand: TSLINSERT\nAction: Select 'hsb_SetEntitiesProperties.mcr' from the file list and click Open.\n```\n\n### Step 2: Configure Properties\n```\nInterface: Dynamic Dialog\nAction: A dialog box appears. Enter the values you wish to apply to the selected elements.\nNote: Leave a field empty to keep the existing value of the element for that specific property.\n```\n*   **Name**: Update the element name.\n*   **Material**: Change the material profile.\n*   **Color**: Change the display color (Enter -1 to keep current color).\n*   **Grade**: Update the structural grade.\n*   **Information**: Add specific comments or notes.\n*   **Label / Sublabel / Sublabel2**: Update part marks and identifiers.\n*   **Beamcode**: Change the functional classification code.\n\n### Step 3: Select Entities\n```\nCommand Line: Select entities\nAction: Click on individual beams or use a window selection to choose multiple beams/sheets. Press Enter to confirm selection.\n```\n\n### Step 4: Application\n```\nSystem Action: The script automatically updates the properties of all selected elements and then removes itself from the drawing.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sName | Text | \"\" | The logical name or description of the entity. Leave blank to keep existing. |\n| sMaterial | Text | \"\" | The timber material profile to apply. Leave blank to keep existing. |\n| nColor | Number | -1 | The visual color index (1-255). Use -1 to keep the existing color. |\n| sGrade | Text | \"\" | The structural strength grade (e.g., C24). Leave blank to keep existing. |\n| sInformation | Text | \"\" | User-defined comments or instructions. Leave blank to keep existing. |\n| sLabel | Text | \"\" | The primary part mark for drawings and production. Leave blank to keep existing. |\n| sSublabel | Text | \"\" | A secondary classification or part mark. Leave blank to keep existing. |\n| sSublabel2 | Text | \"\" | A tertiary classification or part mark. Leave blank to keep existing. |\n| sBeamcode | Text | \"\" | Functional code classifying the element type (e.g., Stud, Plate). Leave blank to keep existing. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| None | This is an Action Script. It executes once and erases itself; it does not persist in the model to offer right-click context menu options. |\n\n## Settings Files\n- **Internal Catalog**: `_LastInserted`\n- **Location**: Internal hsbCAD Catalog memory.\n- **Purpose**: Remembers the properties used in the last run so they are pre-filled the next time the script is executed.\n\n## Tips\n- **Partial Updates**: You do not need to fill in every field. Only fields with data entered will be updated on the selected beams. Fields left empty will preserve the beam's current data.\n- **Color Reset**: If you want to reset the visual color of beams to their default layer color, type `0` in the Color field (or check specific hsbCAD behavior for color index 0/ByBlock).\n- **Batch Selection**: You can select hundreds of beams at once using a crossing window to update properties for an entire wall or floor assembly in one click.\n\n## FAQ\n- **Q: What happens if I leave the Material field blank?**\n  - A: The script will ignore the material property, and the selected beams will retain their currently assigned material.\n- **Q: Does this script change the physical size of the beam?**\n  - A: No, it only changes data attributes (Name, Grade, Labels). However, if you change the *Material* to one with different dimensions, you may need to update the beam geometry separately using standard hsbCAD tools.\n- **Q: I ran the script but nothing happened.**\n  - A: Ensure you selected at least one valid GenBeam. If no valid beams were selected, the script finishes silently. Also, ensure you actually typed values into the dialog fields; if all fields were empty, the script has nothing to change."
      },
      "tokens_used": 5665,
      "error": null
    }
  }
}