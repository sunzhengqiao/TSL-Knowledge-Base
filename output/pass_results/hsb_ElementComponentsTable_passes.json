{
  "filename": "hsb_ElementComponentsTable.mcr",
  "status": "completed",
  "total_tokens": 31302,
  "processing_time": 714.2753348350525,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "10.07.2013",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "13.05.2021",
            "author": "",
            "changes": "Added the name of the insulation"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5412,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Viewport vp = getViewport(\"Select the viewport...\"); _Viewport.append(vp); if (_Viewport.length()==0) eraseInstance(); Element el = vp.element(); CoordSys ms2ps = vp.coordSys();"
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "A Viewport on a layout that contains a valid hsbCAD Element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 5256,
      "error": null
    },
    "3": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "Request timeout after retries"
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a material schedule (table) in PaperSpace that lists the build-up of a timber element (Materials and Heights) organized by Construction Zone, based on the element shown in a selected viewport.",
          "category": "ShopDrawing / Scheduling",
          "typicalUseCase": "Creating a wall component summary or 'build-up' table on a drawing layout to detail the layers (e.g., Stud, Insulation, Cladding) and their thicknesses for a specific wall or floor element."
        },
        "parameters": [
          {
            "name": "sTitle",
            "technicalDefault": "\"Element Components\"",
            "businessMeaning": "The main header label displayed at the top of the generated table.",
            "validRange": "Any text string (e.g., 'Wall Schedule', 'External Finish Specs')",
            "unit": "Text",
            "affectsOutput": "Updates the main title text centered above the table columns."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "The text style definition (Font, Width Factor) used for all text within the table.",
            "validRange": "Valid AutoCAD/hsbCAD DimStyle names present in the drawing.",
            "unit": "Style Name",
            "affectsOutput": "Changes the font appearance and text width, which also dynamically recalculates the column widths to fit the text content."
          },
          {
            "name": "dScale",
            "technicalDefault": "1",
            "businessMeaning": "A visual scaling multiplier to increase or decrease the overall size of the table text and geometry.",
            "validRange": "0.5 to 2.0",
            "unit": "Factor",
            "affectsOutput": "Multiplies the base character height, resulting in larger text, taller rows, and wider columns."
          },
          {
            "name": "dPropCharSize",
            "technicalDefault": "U(17)",
            "businessMeaning": "The base text height for the table content before the scale factor is applied.",
            "validRange": "2.5 to 25.0",
            "unit": "mm (drawing units)",
            "affectsOutput": "Directly sets the text size. Higher values increase row height and column width."
          },
          {
            "name": "nColor",
            "technicalDefault": "1",
            "businessMeaning": "The AutoCAD Color Index (ACI) for the data rows (Zone, Material, Height values).",
            "validRange": "1 to 255",
            "unit": "Index",
            "affectsOutput": "Changes the color of the main body text."
          },
          {
            "name": "nTitleColor",
            "technicalDefault": "1",
            "businessMeaning": "The AutoCAD Color Index (ACI) for the main Table Title (e.g., 'Element Components').",
            "validRange": "1 to 255",
            "unit": "Index",
            "affectsOutput": "Changes the color of the large header text."
          },
          {
            "name": "nHeaderColor",
            "technicalDefault": "1",
            "businessMeaning": "The AutoCAD Color Index (ACI) for the column headers (Zone, Material, Height).",
            "validRange": "1 to 255",
            "unit": "Index",
            "affectsOutput": "Changes the color of the row identifying the columns."
          },
          {
            "name": "nLineColor",
            "technicalDefault": "1",
            "businessMeaning": "The AutoCAD Color Index (ACI) for the grid lines and borders of the table.",
            "validRange": "1 to 255",
            "unit": "Index",
            "affectsOutput": "Changes the color of the lines outlining the table and separating rows."
          },
          {
            "name": "_Pt0",
            "technicalDefault": "User Input",
            "businessMeaning": "The insertion point (top-left origin) for the table in PaperSpace.",
            "validRange": "Any point on the active Layout",
            "unit": "Coordinates (X,Y)",
            "affectsOutput": "Determines the physical location of the table on the sheet."
          },
          {
            "name": "_Viewport",
            "technicalDefault": "User Input",
            "businessMeaning": "The link to the specific Viewport containing the Element to be analyzed.",
            "validRange": "Valid PaperSpace Viewport",
            "unit": "Entity",
            "affectsOutput": "Determines which Element's data (Zones, Materials, Heights) is read and displayed."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dPropCharSize or dScale changes",
            "effect": "The calculated character height changes, which forces a recalculation of Row Height and Column Widths to ensure text fits.",
            "cascade": [
              "dCharSize",
              "dRowHeight",
              "dColumnWidth"
            ]
          },
          {
            "trigger": "sDimStyle changes",
            "effect": "Text width calculations change, causing the table columns to resize (expand or shrink) based on the new font metrics.",
            "cascade": [
              "dColumnWidth"
            ]
          },
          {
            "trigger": "Content in Element changes (Material/Height)",
            "effect": "The number of rows and text content in the table updates to reflect the model.",
            "cascade": [
              "nNrOfRows",
              "sMaterials",
              "sHeights",
              "dColumnWidth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text",
            "description": "Formatted text strings for Title, Headers, and Data Rows (Zone, Material Name, Height).",
            "appliedTo": "PaperSpace Layout"
          },
          {
            "type": "Line / PLine",
            "description": "Grid lines and outer border forming the table structure.",
            "appliedTo": "PaperSpace Layout"
          }
        ]
      },
      "tokens_used": 6990,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched via command or catalog insertion.",
          "Check if Inserting: If yes, check for multi-insert cycle.",
          "[Insert Branch - Cycle > 1]: Erase current instance and return.",
          "[Insert Branch - Cycle = 1]: Check execution key.",
          "If key is empty, show property dialog once.",
          "Prompt user to select a PaperSpace point for table location (_Pt0).",
          "Prompt user to select a Viewport (_Viewport).",
          "Save state and exit (return).",
          "Post-Insert Execution: Check if _Viewport array is populated.",
          "[Error Branch - No Viewport]: Erase instance and return.",
          "Retrieve the last Viewport from the array and validate.",
          "[Error Branch - Invalid Element]: Erase instance and return.",
          "Calculate Character Size based on dPropCharSize * dScale.",
          "Initialize temporary arrays for Zones, Materials, and Heights.",
          "Loop through Construction Zones (index 10 down to -10).",
          "For each Zone, collect all GenBeams.",
          "Process each Beam: Extract Height and Material Name.",
          "[Logic Branch - Insulation]: If material is 'INSULATION', prefix with 'Insulation: ' and append Beam Name.",
          "[Logic Branch - Duplicate Material]: If Material already exists in current Zone list, ignore (do not add duplicate line).",
          "Format valid Zone data into combined strings (handling multi-materials with '/').",
          "Append data to main display arrays (sZones, sMaterials, sHeights).",
          "Calculate Table Geometry: Row Height based on font metrics.",
          "Calculate Table Geometry: Iterate data to determine required Column Widths.",
          "Draw Table Structure: Title line, Title text.",
          "Draw Table Structure: Header row lines, Header text (Zone, Material, Height).",
          "Loop through data arrays to draw rows.",
          "[Logic Branch - Zone Merge]: If current Zone equals previous Zone, leave the Zone text cell blank to visually merge rows.",
          "Draw Data Row text and border lines.",
          "Close table with bottom border.",
          "Draw crosshairs at insertion point (_Pt0) for visual reference."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Check (insertCycleCount()>1)",
            "path1": {
              "name": "Multiple Insertion",
              "steps": [
                "Erase the current script instance.",
                "Terminate script execution immediately."
              ]
            },
            "path2": {
              "name": "First Insertion",
              "steps": [
                "Check execution key.",
                "Show Dialog if needed.",
                "Prompt for Point.",
                "Prompt for Viewport."
              ]
            }
          },
          {
            "condition": "Viewport Validation (_Viewport.length()==0)",
            "path1": {
              "name": "No Viewport Linked",
              "steps": [
                "Execute eraseInstance().",
                "Stop script execution."
              ]
            },
            "path2": {
              "name": "Viewport Found",
              "steps": [
                "Retrieve Viewport entity.",
                "Check for valid hsb Element."
              ]
            }
          },
          {
            "condition": "Material Type Check (String Comparison)",
            "path1": {
              "name": "Insulation Detected",
              "steps": [
                "Rename material to 'INSULATION: [BeamName]'.",
                "Process normally."
              ]
            },
            "path2": {
              "name": "Standard Material",
              "steps": [
                "Use raw material name.",
                "Trim whitespace.",
                "Convert to Uppercase."
              ]
            }
          },
          {
            "condition": "Duplicate Material in Same Zone",
            "path1": {
              "name": "Duplicate Found",
              "steps": [
                "Skip adding entry to list (Unique constraint)."
              ]
            },
            "path2": {
              "name": "Unique Material",
              "steps": [
                "Append Material Name and Height to Zone list."
              ]
            }
          },
          {
            "condition": "Consecutive Zone Text (Visual Merging)",
            "path1": {
              "name": "Same Zone as Previous Row",
              "steps": [
                "Set Flag to FALSE.",
                "Do NOT draw Zone Text for current row."
              ]
            },
            "path2": {
              "name": "New Zone",
              "steps": [
                "Set Flag to TRUE.",
                "Draw Zone Text for current row."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection (during insert)",
            "errorMessage": "None explicit in code, but if no viewport selected, script erases itself silently.",
            "recovery": "User must re-insert the script and ensure a viewport is selected."
          },
          {
            "check": "Element Validity (hsb data inside Viewport)",
            "errorMessage": "None explicit. Script returns silently if element is invalid.",
            "recovery": "Ensure the selected viewport contains a valid hsbCAD Element (Wall/Floor/Roof)."
          },
          {
            "check": "DimStyle Existence",
            "errorMessage": "None explicit in TSL, but AutoCAD may error if 'sDimStyle' does not exist.",
            "recovery": "Set 'sDimStyle' property to a valid Text/Dim style in the drawing."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Table",
            "how": "Grip Edit (Drag insertion point grip)",
            "effect": "Relocates the entire table geometry relative to the new _Pt0."
          },
          {
            "action": "Update Content",
            "how": "Element Model Update (e.g., changing layers in hsbCAD)",
            "effect": "Script recalculates zones, materials, and heights on next update, adding/removing rows as needed."
          },
          {
            "action": "Change Scale",
            "how": "OPM Property Palette (Change 'Scale' or 'character size')",
            "effect": "Table redraws with new text height, row height, and column widths."
          },
          {
            "action": "Change Colors",
            "how": "OPM Property Palette (Change 'Table Text Color', 'Line Color', etc.)",
            "effect": "Redraws specific table elements (Title, Header, Body, Grid) with new AutoCAD Color Index."
          },
          {
            "action": "Change Title",
            "how": "OPM Property Palette (Edit 'Table Title')",
            "effect": "Updates the header text string."
          }
        ]
      },
      "tokens_used": 7674,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ElementComponentsTable\n\n## Overview\nThis script automatically generates a material schedule table in Paper Space. It reads the construction layers (Zones, Materials, and Heights) of a timber element displayed in a selected viewport and creates a formatted list detailing the build-up.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for layouts. |\n| Paper Space | Yes | The script must be inserted onto a layout containing a viewport. |\n| Shop Drawing | No | Used primarily for general layout documentation. |\n\n## Prerequisites\n- **Required Entities**: A Layout (Paper Space) with at least one Viewport.\n- **Model Content**: The selected Viewport must contain a valid hsbCAD Element (e.g., a Wall, Floor, or Roof) with assigned construction layers.\n- **Settings**: None required (uses standard Text/Dim styles from the drawing).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or your company's custom insert command) â†’ Select `hsb_ElementComponentsTable.mcr`\n\n### Step 2: Select Insertion Point\n```\nCommand Line: Select insertion point:\nAction: Click in the Paper Space layout where you want the top-left corner of the table to be placed.\n```\n\n### Step 3: Select Viewport\n```\nCommand Line: Select the viewport...\nAction: Click on the viewport border that displays the element you wish to schedule.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Table Title** | String | Element Components | The main header text displayed at the top of the table. |\n| **Dim Style** | String | _DimStyles | The text style used for the table content. Changing this updates the font and automatically adjusts column widths. |\n| **Scale** | Double | 1.0 | A multiplier to resize the entire table. Increase to make text and lines larger; decrease to make them smaller. |\n| **character size** | Double | 17.0 | The base text height (in drawing units) for the table content. |\n| **Table Text Color** | Integer | 1 (Red) | The AutoCAD color index for the main data rows (Zone, Material, Height). |\n| **Title Text Color** | Integer | 1 (Red) | The AutoCAD color index for the main Table Title. |\n| **Header Text Color** | Integer | 1 (Red) | The AutoCAD color index for the column headers (Zone, Material, Height). |\n| **Line Color** | Integer | 1 (Red) | The AutoCAD color index for the grid lines and table borders. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Update** | Recalculates the table based on changes to the model (e.g., added layers) or property changes. |\n| **Erase** | Removes the script and the generated table from the drawing. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on standard AutoCAD/hsbCAD entities and does not require external XML settings files.\n\n## Tips\n- **Move the Table**: Select the table and use the grip edit point at the top-left corner to move it to a new location.\n- **Adjusting Size**: Instead of changing the `character size` directly, try using the `Scale` property to quickly enlarge or shrink the entire table proportionally.\n- **Visual Grouping**: The script automatically groups rows by \"Zone\". If two consecutive rows belong to the same zone, the Zone name is only displayed once for the first row to keep the table clean.\n- **Insulation Naming**: If the element contains insulation, the script will label it specifically as \"INSULATION\" followed by the beam name for clarity.\n\n## FAQ\n- **Q: Why did the script disappear immediately after insertion?**\n  A: This usually happens if you canceled the Viewport selection or if the selected Viewport does not contain a valid hsbCAD Element. Ensure you click a viewport with an active wall/floor/roof.\n- **Q: The table text is too small/large for my sheet.**\n  A: Select the script, open the Properties Palette, and change the `Scale` factor (e.g., set to 1.5 for larger text).\n- **Q: How do I change the font?**\n  A: Change the `Dim Style` property to a different Text Style defined in your AutoCAD drawing. The table will automatically resize its columns to fit the new font."
      },
      "tokens_used": 5970,
      "error": null
    }
  }
}