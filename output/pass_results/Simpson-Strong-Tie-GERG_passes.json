{
  "filename": "Simpson-Strong-Tie-GERG.mcr",
  "status": "completed",
  "total_tokens": 48613,
  "processing_time": 183.44999718666077,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.2",
            "date": "17.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "add picture"
          },
          {
            "version": "1.1",
            "date": "15mai2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "cosmetic"
          },
          {
            "version": "1.0",
            "date": "18apr2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "initial version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8033,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script performs 3D geometric calculations (Point3d, Vector3d, Body, PlaneProfile) and constructs 3D geometry using TSL Body creation and PLine extrusion. It uses 'PrEntity' to select 'Beam' objects and 'GenBeam' specific methods like 'envelopeBody'. There are no references to Viewport entities, sd_ prefixes, or 2D ShopDrawing specific constructs like #Type E + _Entity[] or sdPageSetup."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model space with valid beam elements to connect.",
          "requiredSettings": []
        }
      },
      "tokens_used": 6200,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select beam(s)",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert (unless executing via command key or catalog entry)",
            "title": "---",
            "dataSource": "Internal Properties (sType, dGap, sNailPattern, sNail)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "Type",
            "defaultValue": "Automatic",
            "inputType": "dropdown",
            "options": [
              "Automatic",
              "GERG120/180-B",
              "GERG120/200-B",
              "GERG140/200-B",
              "GERG120/220-B",
              "GERG140/220-B",
              "GERG160/220-B",
              "GERG120/240-B",
              "GERG140/240-B",
              "GERG160/240-B",
              "GERG120/260-B",
              "GERG140/260-B",
              "GERG160/260-B"
            ],
            "category": "General",
            "description": "Defines the model of the connector"
          },
          {
            "index": 0,
            "variable": "dGap",
            "type": "PropDouble",
            "displayName": "Gap",
            "defaultValue": "10.0",
            "inputType": "number",
            "options": [],
            "category": "General",
            "description": "Defines the Gap"
          },
          {
            "index": 1,
            "variable": "sNailPattern",
            "type": "PropString",
            "displayName": "Nailing Pattern",
            "defaultValue": "Full Nailing",
            "inputType": "dropdown",
            "options": [
              "Full Nailing",
              "Part Nailing"
            ],
            "category": "Nailing",
            "description": "Defines the nail pattern"
          },
          {
            "index": 2,
            "variable": "sNail",
            "type": "PropString",
            "displayName": "Nail type",
            "defaultValue": "CNA4,0xl Kammnageln",
            "inputType": "dropdown",
            "options": [
              "CNA4,0xl Kammnageln",
              "CSA5,0xl Schrauben"
            ],
            "category": "Nailing",
            "description": "Defines the Nail type"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Swap X-(-X)",
            "handler": "Swap X-(-X)",
            "action": "Swaps the vector X of connection with -X and mirrors the connection to the YZ plane",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7876,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates 3D geometry and hardware data for Simpson Strong-Tie GERG Gerber joist hangers to connect two continuous beams with a butt joint.",
          "category": "Hardware",
          "typicalUseCase": "Used in timber framing to structurally join two timber beams end-to-end (Gerber joint) using a specific steel bracket, automatically selecting the correct size based on beam geometry or user input."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "Automatic",
            "businessMeaning": "Selects the specific part number/model of the Simpson Strong-Tie GERG connector. 'Automatic' allows the script to choose the model based on the beam dimensions (height/width) encountered.",
            "validRange": "List of specific manufacturer codes (GERG120/180-B through GERG160/260-B)",
            "unit": "String",
            "affectsOutput": "Determines the 3D geometry size (Height A, Width C, Thickness), the number of pre-punched holes, the default nail count, and the hardware Bill of Materials (BOM)."
          },
          {
            "name": "dGap",
            "technicalDefault": "10.0",
            "businessMeaning": "The physical spacing distance between the two adjoining timber beams. This is the opening size that the connector bridges.",
            "validRange": "0.0 to 50.0 (typically 5-20mm for construction tolerances)",
            "unit": "mm",
            "affectsOutput": "Controls the placement of the connector relative to the beam ends. Visually separates the beam ends. Adjusts the location of the cuts applied to the beams."
          },
          {
            "name": "sNailPattern",
            "technicalDefault": "Full Nailing",
            "businessMeaning": "Defines the density of fasteners used to attach the connector to the timber beams.",
            "validRange": "Full Nailing, Part Nailing",
            "unit": "String",
            "affectsOutput": "Alters the calculated quantity of nails added to the BOM. Does not change the geometry of the metal plate itself (holes are implicit), but affects the reported hardware list."
          },
          {
            "name": "sNail",
            "technicalDefault": "CNA4,0xl Kammnageln",
            "businessMeaning": "Specifies the exact fastener product to be used for the connection (e.g., specific nail or screw type).",
            "validRange": "List of compatible Simpson fasteners (CNA4.0xl, CSA5.0xl)",
            "unit": "String",
            "affectsOutput": "Updates the BOM description and material properties of the hardware item. May influence implied drill geometry if the script modeled exact hole sizes (though here holes are standard)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sType set to Automatic",
            "effect": "The script calculates the beam height (dD(vecZ)) and selects the corresponding GERG model index to match the timber dimensions.",
            "cascade": [
              "sType"
            ]
          },
          {
            "trigger": "sNailPattern change",
            "effect": "The quantity calculation in the Hardware section switches between the nFullNumAs/nFullNumCs arrays and the nHalfNumAs array.",
            "cascade": [
              "HardWrComp Quantity"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Body (Metal Plate)",
            "description": "A parametric 3D solid representing the GERG bracket, generated based on the selected type (A, B, C, T dimensions). Includes the main hanger plates and bottom stiffeners.",
            "appliedTo": "Model Space (positioned at the beam joint)"
          },
          {
            "type": "Cut",
            "description": "Operation to trim the ends of the selected timber beams to accommodate the dGap and the connector thickness.",
            "appliedTo": "Selected Beams (bm0, bm1)"
          },
          {
            "type": "HardWrComp (Hardware)",
            "description": "BOM entries generated for the main connector plate and the associated fasteners (nails/screws). Includes Manufacturer, Model, and Quantity.",
            "appliedTo": "Script Instance / Element"
          }
        ]
      },
      "tokens_used": 8647,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script starts execution (Insert or Recalc)",
          "2. [Insert Mode] Check if insertCycleCount > 1; if true, erase instance and exit.",
          "3. [Insert Mode] Check Execution Key (_kExecuteKey).",
          "   - If Key matches Catalog Entry -> Load properties from Catalog.",
          "   - Else -> Load properties from '_LastInserted' or show Dialog ('---').",
          "4. [Insert Mode] Prompt user to Select Beams (PrEntity).",
          "5. [Insert Mode] Validate selection (Minimum 1 beam required).",
          "6. [Insert Mode] Iterate through selected beams to find valid pairs (bm0, bm1).",
          "   - Check Parallelism (vecX || vecX1).",
          "   - Check Collinearity (Y/Z alignment).",
          "   - Check Section Equality (Height/Width match).",
          "7. [Insert Mode] For every valid pair found:",
          "   - Calculate connection point and vectors.",
          "   - Create new TSL instance (tslNew) for that specific connection.",
          "   - Assign beams (bm0, bm1) and properties to the new instance.",
          "   - Set tool mode to 'mode'=1.",
          "8. [Insert Mode] Erase the parent 'batch' script instance.",
          "9. [Calculation Mode - Spawned Instance] Retrieve properties and assigned beams (bm0, bm1).",
          "10. [Calculation Mode] Determine Connector Type (sType).",
          "    - If 'Automatic', calculate beam height and match against dAs array.",
          "    - Else use user-specified model.",
          "11. [Calculation Mode] Construct Geometry (PLine shapes for plates).",
          "    - Generate Side Plates (Left/Right).",
          "    - Generate Bottom Plate.",
          "    - Generate Back Stiffener.",
          "12. [Calculation Mode] Handle 'Swap X' transformation (Mirror if required).",
          "13. [Calculation Mode] Add 3D Bodies to Display.",
          "14. [Calculation Mode] Apply Cuts to source beams (bm0, bm1) at gap location.",
          "15. [Calculation Mode] Generate Hardware (BOM).",
          "    - Add Main Connector.",
          "    - Add Nails (Quantity based on 'Full Nailing' vs 'Part Nailing').",
          "16. Update drawing and BOM."
        ],
        "conditionalBranches": [
          {
            "condition": "sType property value",
            "path1": {
              "name": "Automatic Selection",
              "steps": [
                "Script calculates beam height (dD(vecZ)).",
                "Compares height against internal array of dimensions (dAs).",
                "Selects index of the nearest matching standard size."
              ]
            },
            "path2": {
              "name": "Manual Selection",
              "steps": [
                "Script uses the explicit string value (e.g., 'GERG120/180-B').",
                "Dimensions retrieved directly from internal arrays using the fixed index."
              ]
            }
          },
          {
            "condition": "Beam Pair Validation",
            "path1": {
              "name": "Valid Pair Found",
              "steps": [
                "Calculate connection point.",
                "Spawn specific TSL instance.",
                "Mark beams as processed."
              ]
            },
            "path2": {
              "name": "Invalid Pair",
              "steps": [
                "Report error to debug/reportMessage if enabled.",
                "Skip current combination.",
                "Continue loop to next beam."
              ]
            }
          },
          {
            "condition": "Nailing Pattern (sNailPattern)",
            "path1": {
              "name": "Full Nailing",
              "steps": [
                "Calculate quantity = nFullNumAs[nType] + nFullNumCs[nType]."
              ]
            },
            "path2": {
              "name": "Part Nailing",
              "steps": [
                "Calculate quantity = nHalfNumAs[nType]."
              ]
            }
          },
          {
            "condition": "Swap X Command / State",
            "path1": {
              "name": "Swapped",
              "steps": [
                "Apply Mirroring CoordinateSystem to the Total Body.",
                "Effectively flips the connector orientation 180 degrees along YZ plane."
              ]
            },
            "path2": {
              "name": "Standard",
              "steps": [
                "Construct geometry normally without mirroring."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Minimum Beam Selection",
            "errorMessage": "Select at least one beam",
            "recovery": "User must restart script and select beams."
          },
          {
            "check": "Beam Parallelism",
            "errorMessage": "Beams are not parallel",
            "recovery": "Script skips this pair. User must select properly aligned beams."
          },
          {
            "check": "Beam Alignment (Collinearity)",
            "errorMessage": "Beams are not on the same axis",
            "recovery": "Script skips this pair. User must ensure beams are end-to-end in a straight line."
          },
          {
            "check": "Beam Section Dimensions",
            "errorMessage": "Beams are not of same section",
            "recovery": "Script skips this pair. User must ensure connecting beams have identical width and height."
          },
          {
            "check": "Geometric Intersection/Gap",
            "errorMessage": "Unexpected error (1-4)",
            "recovery": "Indicates complex geometry or invalid solids. Script stops or skips."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Connector Model (sType)",
            "how": "OPM Properties Palette",
            "effect": "Updates dimensions (A, B, C), number of holes, and cuts the beams to match the new plate size."
          },
          {
            "action": "Adjust Gap (dGap)",
            "how": "OPM Properties Palette",
            "effect": "Moves the connector and the beam cuts further apart or closer together."
          },
          {
            "action": "Move Connector Location",
            "how": "Grip Edit (Point _Pt0)",
            "effect": "Slides the connector along the beam axis. The cuts on the beams stretch/move with the connector."
          },
          {
            "action": "Swap Orientation",
            "how": "Context Menu (Right-click) -> Swap X-(-X)",
            "effect": "Mirrors the connector geometry 180 degrees. Useful if the 'back' or specific side of the bracket needs to face the other direction."
          },
          {
            "action": "Update Nailing",
            "how": "OPM Properties Palette (Nailing Pattern / Nail type)",
            "effect": "Updates the Bill of Materials (BOM) quantity and description for the fasteners."
          }
        ]
      },
      "tokens_used": 11594,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Simpson Strong Tie GERG\n\n## Overview\nThis script generates the 3D geometry and hardware data for Simpson Strong-Tie GERG Gerber joist hangers. It is designed to structurally connect two timber beams end-to-end (butt joint) by automatically selecting the correct bracket size based on the beam dimensions or user specifications.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script performs 3D operations and creates solid bodies. |\n| Paper Space | No | Not designed for 2D layout or detailing views. |\n| Shop Drawing | No | This is a model generation script, not a 2D processing script. |\n\n## Prerequisites\n- **Required Entities**: At least two Timber Beams (`GenBeam`) to connect.\n- **Minimum Beam Count**: 2 (must be parallel, collinear, and have the same cross-section).\n- **Required Settings**: None (uses internal dimension tables for Simpson Strong-Tie parts).\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Browse and select `Simpson-Strong-Tie-GERG.mcr`.\n\n### Step 2: Configure Properties (Dialog)\nUpon launching, a dynamic dialog will appear automatically (unless run from a specific catalog entry).\n-   **Type**: Select the specific connector model (e.g., `GERG120/180-B`) or leave as `Automatic` to let the script decide based on beam height.\n-   **Gap**: Define the distance (mm) between the two beam ends (default is 10.0mm).\n-   **Nailing**: Select the nailing pattern (`Full Nailing` or `Part Nailing`) and the nail type (`CNA4.0xl` or `CSA5.0xl`).\n-   Click **OK** to proceed.\n\n### Step 3: Select Beams\n```\nCommand Line: Select beam(s)\nAction: Click on the first beam, then the second beam you wish to connect. Press Enter to confirm selection.\n```\n**Note**: Ensure the two beams are perfectly aligned in a straight line and have the same width and height. If they are not parallel or aligned, the script will skip the connection.\n\n### Step 4: Completion\nThe script will generate the steel hanger body, apply cuts to the timber beams to accommodate the gap, and add the hardware to the Bill of Materials (BOM).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Type** | Dropdown | `Automatic` | Selects the Simpson Strong-Tie model number. Choose 'Automatic' to match the beam height, or select a specific code (e.g., GERG120/180-B). |\n| **Gap** | Number | `10.0` | Sets the physical gap between the two beam ends in millimeters. |\n| **Nailing Pattern** | Dropdown | `Full Nailing` | Determines the quantity of fasteners calculated in the BOM. 'Full' uses all holes; 'Part' uses a reduced quantity. |\n| **Nail type** | Dropdown | `CNA4,0xl Kammnageln` | Specifies the fastener product (e.g., nails or screws) to be reported in the BOM. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Swap X-(-X)** | Flips the connector orientation 180 degrees. This is useful if you need the specific face of the bracket to point in the opposite direction along the beam axis. |\n\n## Settings Files\n- **Filename**: None used.\n- **Note**: This script relies on internal hard-coded dimension arrays for the Simpson Strong-Tie product range. It does not require external XML configuration files.\n\n## Tips\n- **Automatic Mode**: For the fastest workflow, keep the Type set to `Automatic`. This ensures the hanger size updates instantly if you change the timber beam size later.\n- **Grip Editing**: You can click on the inserted connector and drag the grip point (`_Pt0`) to slide the joint along the beams. The cuts and hardware will follow.\n- **Validation**: If the connector does not appear, check the Properties Palette for errors or ensure your selected beams have the exact same Height and Width properties.\n\n## FAQ\n- **Q: The script skips my beams and doesn't create a connector. Why?**\n  A: The beams must be parallel, lie on the same centerline (collinear), and have identical cross-section dimensions. If they are slightly rotated or different sizes, the script will reject the pair.\n  \n- **Q: How do I change the nail size without deleting the connector?**\n  A: Select the connector in the model, open the Properties Palette (Ctrl+1), and change the \"Nail type\" dropdown. The BOM will update automatically.\n\n- **Q: Can I use this for non-Simpson brackets?**\n  A: No, the geometry and dimensions are specifically coded for the Simpson Strong-Tie GERG series. Using it for other brands would result in incorrect geometry."
      },
      "tokens_used": 6263,
      "error": null
    }
  }
}