{
  "filename": "HSB_E-ProfilingBeamCut.mcr",
  "status": "completed",
  "total_tokens": 32042,
  "processing_time": 231.00771856307983,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 6345,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses `_kModelSpace` in the `dbCreate` method. It operates on GenBeam objects within an Element to apply physical modifications (BeamCut), which is a 3D modeling task. There are no indicators of ShopDrawing usage (no sd_ prefix, no #Type E)."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Elements with beams.",
          "requiredSettings": [
            "HSB_G-FilterGenBeams TSL script must be loaded in the drawing to define beam filters."
          ]
        }
      },
      "tokens_used": 2716,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDialog",
            "trigger": "On Insert (if no execution key provided)",
            "title": "Default Properties Dialog",
            "dataSource": "Properties Palette Configuration",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "filterDefinition",
            "type": "PropString",
            "displayName": "|Filter definition beams|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": "|Position|",
            "description": "|Filter definition for beams.| + |Use| HSB_G-FilterGenBeams |to define the filters|."
          },
          {
            "index": 2,
            "variable": "frontBackProp",
            "type": "PropString",
            "displayName": "Milling side",
            "defaultValue": "|Front|",
            "inputType": "dropdown",
            "options": [
              "|Front|",
              "|Back|"
            ],
            "category": "|Position|",
            "description": "|Specifies whether the milling is applied to the front or the back of the element.| + |Front| : |Zone 1 to 5| + |Back| : |Zone 6 to 10|"
          },
          {
            "index": 3,
            "variable": "insideOutsideProp",
            "type": "PropString",
            "displayName": "|Side relative to element center|",
            "defaultValue": "Outside",
            "inputType": "dropdown",
            "options": [
              "Outside",
              "Inside"
            ],
            "category": "|Position|",
            "description": "|Specifies whether the tool is applied to the inside or outside of the selected beams.| + |Inside and outside is reletive to the element center.|"
          },
          {
            "index": 0,
            "variable": "beamCutY",
            "type": "PropDouble",
            "displayName": "|Width beam cut|",
            "defaultValue": "10",
            "inputType": "number",
            "options": [],
            "category": "|Size|",
            "description": "|Sets the width of the beam cut.|"
          },
          {
            "index": 1,
            "variable": "beamCutZ",
            "type": "PropDouble",
            "displayName": "|Depth beam cut|",
            "defaultValue": "10",
            "inputType": "number",
            "options": [],
            "category": "|Size|",
            "description": "|Sets the depth of the beam cut.|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4286,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 7298,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched via Insert command or Execute Key.",
          "Check Insert Cycle Count. If > 1, script erases self and exits immediately.",
          "Check for valid Execute Key.",
          "[Branch] If Execute Key is valid, load properties from Catalog.",
          "[Branch] If Execute Key is invalid or empty, display Properties Dialog to user.",
          "Save current property values to '_LastInserted' catalog.",
          "Prompt user to select Elements using PrEntity.",
          "[Branch] If user cancels selection or selects no elements, script exits.",
          "Loop through each selected Element and spawn a new sub-instance via dbCreate into Model Space.",
          "Erase the original (host) script instance.",
          "[Sub-Instance Lifecycle] On database creation, restore properties from '_LastInserted' catalog.",
          "Validate associated Element count (must be 1). If invalid, report warning and erase.",
          "Retrieve all Beams from the Element.",
          "Execute 'HSB_G-FilterGenBeams' TSL to filter the list of beams based on 'Filter definition' property.",
          "[Branch] If filtering fails (TSL missing or error), report warning and erase.",
          "Loop through each filtered beam.",
          "Calculate coordinate system and vectors for the cut (Beam X/Y/Z).",
          "Determine cut direction relative to Element profile (Inside/Outside).",
          "Calculate BeamCut origin and dimensions (Width/Depth).",
          "Add BeamCut tool to the beam (static modification).",
          "Erase the sub-instance."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count check",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase Instance",
                "Exit"
              ]
            },
            "path2": {
              "name": "Cycle == 1",
              "steps": [
                "Proceed to Input Logic"
              ]
            }
          },
          {
            "condition": "Execution Key Input",
            "path1": {
              "name": "Valid Catalog Key Found",
              "steps": [
                "Load Properties from Catalog",
                "Skip Dialog"
              ]
            },
            "path2": {
              "name": "No Catalog Key",
              "steps": [
                "Show Properties Dialog",
                "Wait for User Input"
              ]
            }
          },
          {
            "condition": "User Selection (PrEntity)",
            "path1": {
              "name": "Selection Successful",
              "steps": [
                "Process Selected Elements",
                "Spawn Sub-instances"
              ]
            },
            "path2": {
              "name": "Selection Cancelled/Empty",
              "steps": [
                "Erase Instance",
                "Exit"
              ]
            }
          },
          {
            "condition": "Filter Execution",
            "path1": {
              "name": "Filter Success",
              "steps": [
                "Retrieve Filtered Beam List",
                "Apply BeamCut"
              ]
            },
            "path2": {
              "name": "Filter Failure",
              "steps": [
                "Report Warning ('Beams could not be filtered!')",
                "Erase Instance",
                "Exit"
              ]
            }
          },
          {
            "condition": "Cut Orientation Logic",
            "path1": {
              "name": "Direction Point Inside Profile",
              "steps": [
                "Invert Beam X and Y vectors",
                "Apply Cut in inverted direction"
              ]
            },
            "path2": {
              "name": "Direction Point Outside Profile",
              "steps": [
                "Keep standard vectors",
                "Apply Cut"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Associated Element Count",
            "errorMessage": "|No element selected!|",
            "recovery": "Script only runs when spawned with a valid single Element context."
          },
          {
            "check": "Filter TSL Availability",
            "errorMessage": "|Beams could not be filtered!| + |Make sure that the tsl| HSB_G-FilterGenBeams |is loaded in the drawing|.",
            "recovery": "Load the 'HSB_G-FilterGenBeams' TSL into the drawing and define the required filter."
          },
          {
            "check": "Insert Cycle",
            "errorMessage": "(Silent)",
            "recovery": "None, script suppresses duplicate execution during the same insert cycle."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None",
            "how": "N/A",
            "effect": "The script is an immediate execution script that erases itself after applying the BeamCut. The changes are static modifications to the beam geometry; the script instance does not persist in the element tree for later editing."
          }
        ]
      },
      "tokens_used": 6601,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-ProfilingBeamCut\n\n## Overview\nThis script applies a rectangular cut (BeamCut) to specific beams within a selected Element based on a predefined filter. It allows you to define the size of the cut and the specific side (Front/Back, Inside/Outside) relative to the element's geometry.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model environment. |\n| Paper Space | No | |\n| Shop Drawing | No | This is a modeling script, not a detailing script. |\n\n## Prerequisites\n- **Entities:** An existing Element containing GenBeams.\n- **Required Script:** The `HSB_G-FilterGenBeams` TSL script must be loaded in the drawing to define which beams are affected.\n- **Filters:** You must have a beam filter defined in `HSB_G-FilterGenBeams` to select the target beams.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_E-ProfilingBeamCut.mcr`\n\n### Step 2: Configure Properties\nA dialog will appear automatically (or you can set these in the Properties Palette before insertion).\n- Set the **Filter definition** to match a filter created in `HSB_G-FilterGenBeams`.\n- Set the **Width** and **Depth** of the cut.\n- Select the **Milling side** (Front or Back).\n- Select the **Side relative to element center** (Inside or Outside).\n\n### Step 3: Select Elements\n```\nCommand Line: Select elements\nAction: Click on the Element(s) in the model that contain the beams you wish to modify. Press Enter to confirm selection.\n```\n\n### Step 4: Execution\nThe script will process the selected elements, apply the cuts to the filtered beams, and then automatically erase itself from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Filter definition beams | dropdown | (empty) | Select the beam filter to use. This must be defined using the HSB_G-FilterGenBeams script. |\n| Milling side | dropdown | Front | Determines which side of the element the milling is applied to. **Front**: Zone 1 to 5, **Back**: Zone 6 to 10. |\n| Side relative to element center | dropdown | Outside | Applies the tool to the inside or outside of the selected beams, relative to the element's center. |\n| Width beam cut | number | 10 | Sets the width (Y-axis) of the beam cut. |\n| Depth beam cut | number | 10 | Sets the depth (Z-axis) of the beam cut. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script runs once and erases itself; there are no persistent right-click options. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not use external settings files. Configuration is done via the Properties Palette.\n\n## Tips\n- **Prepare Filters First:** Ensure you have loaded `HSB_G-FilterGenBeams` and created a valid filter before running this script. If the filter cannot be found, the script will fail and erase itself.\n- **Single-Use Script:** This is an \"Execution\" script. Once it runs, it deletes itself from the element tree. The cuts applied become permanent modifications to the beam geometry. To change the cuts later, you must undo the operation or manually edit the beam.\n- **Understand Orientation:** \"Inside\" and \"Outside\" are calculated relative to the element's center profile. Check your element orientation if the cut appears on the wrong side.\n\n## FAQ\n- **Q: The script disappeared immediately after I ran it. Is that normal?**\n  - A: Yes. This is a \"fire and forget\" script designed to apply a modification and then remove itself to keep the drawing clean.\n- **Q: Why did I get an error \"Beams could not be filtered!\"?**\n  - A: Ensure the script `HSB_G-FilterGenBeams` is loaded in your drawing and that the name you entered in \"Filter definition beams\" matches a filter defined in that script exactly.\n- **Q: Can I edit the cut dimensions after inserting?**\n  - A: No. Because the script erases itself after execution, you cannot simply double-click it to change dimensions. You must use the Undo command (Ctrl+Z) and run the script again with new values."
      },
      "tokens_used": 4796,
      "error": null
    }
  }
}