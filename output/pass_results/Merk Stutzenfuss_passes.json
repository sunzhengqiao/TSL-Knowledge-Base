{
  "filename": "Merk Stutzenfuss.mcr",
  "status": "completed",
  "total_tokens": 35434,
  "processing_time": 297.175829410553,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 6756,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses GenBeam (_Beam0) references, MetalPart, Cut, and Drill operations to generate and modify 3D geometry. There are no references to sd_*, Multipage*, _Viewport, or #Type E. The script executes insertion logic with getBeam() and modifies the 3D beam entity."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 4405,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getBeam",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Insertion",
            "title": null,
            "dataSource": "script instance properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dH1",
            "type": "PropDouble",
            "displayName": "Height",
            "defaultValue": "200",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dBohrDM",
            "type": "PropDouble",
            "displayName": "Diameter",
            "defaultValue": "40",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dBasisHoehe",
            "type": "PropDouble",
            "displayName": "Base Height",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dExtraTiefe",
            "type": "PropDouble",
            "displayName": "Extra Drilling Depth",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dEinsetzTiefe",
            "type": "PropDouble",
            "displayName": "Depth Drill Housing",
            "defaultValue": "20",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sLayerGroup",
            "type": "PropString",
            "displayName": "|Group, Layername or Zone Character|",
            "defaultValue": "Z",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "This property enables a fleible group or layer control of the tsl"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4537,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 'Merk' column foot connection (hardware + machining) consisting of a steel base plate, a cylindrical tube, a pressure plate, and a hex nut, along with the necessary drilling into the timber column.",
          "category": "Hardware",
          "typicalUseCase": "Used when anchoring a timber column to a foundation or floor using the specific Merk K1/K2 column base system."
        },
        "parameters": [
          {
            "name": "dH1",
            "technicalDefault": "200",
            "businessMeaning": "The height of the pressure plate (or the top of the cylindrical tube) relative to the base point on the column. It defines where the hardware connection extends to.",
            "validRange": "0 - 500 (Dependent on dH2 logic)",
            "unit": "mm",
            "affectsOutput": "Determines the position of the pressure plate and the length of the cylindrical tube. Also influences the selection of the 'Artikel' (product code) based on height thresholds."
          },
          {
            "name": "dBohrDM",
            "technicalDefault": "40",
            "businessMeaning": "Diameter of the main central bore hole in the timber column.",
            "validRange": "20 - 100",
            "unit": "mm",
            "affectsOutput": "Adjusts the size of the Drill operation 'Bohrung' created in the column."
          },
          {
            "name": "dBasisHoehe",
            "technicalDefault": "0",
            "businessMeaning": "Vertical offset (height) of the base plate relative to the insertion point (beam reference line). Allows the connection to be positioned higher or lower on the column bottom.",
            "validRange": "0 - 100",
            "unit": "mm",
            "affectsOutput": "Shifts all hardware components (Base Plate, Cylinder, Pressure Plate) and associated drilling up or down the column Z-axis."
          },
          {
            "name": "dExtraTiefe",
            "technicalDefault": "0",
            "businessMeaning": "Additional depth for the main bore hole beyond the calculated point p2.",
            "validRange": "0 - 50",
            "unit": "mm",
            "affectsOutput": "Extends the length of the main drill 'Bohrung' further into the column."
          },
          {
            "name": "dEinsetzTiefe",
            "technicalDefault": "20",
            "businessMeaning": "Depth of the 'Insert Drill' (housing for the pressure plate mechanism) and the starting position of the pressure plate itself.",
            "validRange": "10 - 50",
            "unit": "mm",
            "affectsOutput": "Determines how deep the wide 'EinsetzBohrung' goes and where the pressure plate sits relative to the top of the cylinder."
          },
          {
            "name": "sLayerGroup",
            "technicalDefault": "Z",
            "businessMeaning": "Controls the CAD layer or group assignment for the generated elements. Used for organizing the model or filtering production data.",
            "validRange": "Valid Group Name, Layer Name, or Zone Character (C,I,J,T,Z)",
            "unit": "string",
            "affectsOutput": "Changes the layer/group property of the TSL instance in the CAD model."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dH1 changes",
            "effect": "Calculates the variable dH2 (Total Cylinder Height) and the article index i based on thresholds (<=210, <=310, >310).",
            "cascade": [
              "dH2",
              "i",
              "Cylinder Length (mpZylinder)",
              "Article Code"
            ]
          },
          {
            "trigger": "dBasisHoehe changes",
            "effect": "Shifts the origin point p0 for the base plate, which cascades to all other points (p1, p2, pdr).",
            "cascade": [
              "p0",
              "p1",
              "p2",
              "All Drills",
              "All MetalParts"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "MetalPart",
            "description": "Base plate (200x100x4) with 4 anchor holes.",
            "appliedTo": "Inserted into the model at point p0."
          },
          {
            "type": "MetalPart",
            "description": "Pressure plate (50x50x4).",
            "appliedTo": "Inserted into the model at point p3."
          },
          {
            "type": "MetalPart",
            "description": "Cylindrical tube connecting base and pressure plates.",
            "appliedTo": "Inserted into the model from p0 to p2."
          },
          {
            "type": "MetalPart",
            "description": "Hexagon Nut.",
            "appliedTo": "Inserted into the model near p3."
          },
          {
            "type": "Drill",
            "description": "Central bore hole for the connection mechanism.",
            "appliedTo": "_Beam0 (The selected column)."
          },
          {
            "type": "Drill",
            "description": "Wider 'insertion' bore hole near the top.",
            "appliedTo": "_Beam0 (The selected column)."
          },
          {
            "type": "Drill",
            "description": "4 small anchor holes (fixed diameter 6) in the base area.",
            "appliedTo": "mpGrundplatte (The Base Plate MetalPart)."
          },
          {
            "type": "Cut",
            "description": "End cut of the column at height H1.",
            "appliedTo": "_Beam0 (The selected column)."
          }
        ]
      },
      "tokens_used": 6060,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches script (Insert TSL)",
          "User selects a single GenBeam (Column) via getBeam()",
          "ShowDynamicDialog displays properties for Height (dH1), Diameter (dBohrDM), Base Height (dBasisHoehe), Extra Drilling Depth (dExtraTiefe), Depth Drill Housing (dEinsetzTiefe), and Group/Layer (sLayerGroup)",
          "User modifies values in the dialog and confirms",
          "Script calculates internal variables: dH2 (Total Cylinder Height) and i (Article Index) based on dH1 threshold logic (<=210, <=310, >310)",
          "Script calculates geometry points: p0 (Base), p1 (Top/Pressure Plate), p2 (Cylinder End), p3 (Insert Depth), and drilling offsets (pdr1-4)",
          "Script generates a Cut at p1 on the beam",
          "Script generates 4 small anchor drills in the base plate (defined but applied to mpGrundplatte)",
          "Script generates the Main Bore Hole ('Bohrung') from p1 to p2 plus extra depth",
          "Script generates the Insert Bore Hole ('EinsetzBohrung') from p1 downwards",
          "Script generates MetalPart 1 (Base Plate 'mpGrundplatte') at p0",
          "Script applies the 4 small anchor drills to the Base Plate",
          "Script generates MetalPart 2 (Pressure Plate 'mpDruckplatte') at p3",
          "Script generates MetalPart 3 (Cylinder 'mpZylinder') from p0 to p2",
          "Script generates MetalPart 4 (Hex Nut 'A_MP') at p3 via PLine sweep",
          "Script assigns Model Number ('118' + ArticleList[i]) and Material ('Steel, zinced')",
          "Script evaluates Layer/Group property (sLayerGroup): Checks for matching Group Name, checks for Zone Character (T,I,J,Z,C), or assigns to specific Layer Name",
          "Construction complete"
        ],
        "conditionalBranches": [
          {
            "condition": "Evaluation of Height (dH1) during geometry calculation",
            "path1": {
              "name": "Short Configuration (K1-A 150)",
              "steps": [
                "Trigger: dH1 <= 210mm",
                "Set dH2 (Cylinder Height) = 300mm",
                "Set i (Article Index) = 0",
                "Article Code becomes 118 150"
              ]
            },
            "path2": {
              "name": "Medium Configuration (K1-A 250)",
              "steps": [
                "Trigger: dH1 > 210mm AND dH1 <= 310mm",
                "Set dH2 (Cylinder Height) = 400mm",
                "Set i (Article Index) = 1",
                "Article Code becomes 118 250"
              ]
            },
            "path3": {
              "name": "Long Configuration (K1-A 450)",
              "steps": [
                "Trigger: dH1 > 310mm",
                "Set dH2 (Cylinder Height) = 620mm",
                "Set i (Article Index) = 2",
                "Article Code becomes 118 450"
              ]
            }
          },
          {
            "condition": "Evaluation of sLayerGroup property",
            "path1": {
              "name": "Group Assignment",
              "steps": [
                "Trigger: sLayerGroup matches an existing Group name in the model",
                "Assign TSL instance to that Group with Zone 'T'"
              ]
            },
            "path2": {
              "name": "Zone Assignment",
              "steps": [
                "Trigger: sLayerGroup is a single character 'T', 'I', 'J', 'Z', or 'C' and is NOT a Group Name",
                "Find Groups assigned to the Beam entity",
                "Assign TSL instance to those Groups with the specific Zone character"
              ]
            },
            "path3": {
              "name": "Layer Assignment",
              "steps": [
                "Trigger: sLayerGroup is neither a valid Group name nor a Zone character",
                "Assign TSL instance to a new or existing Layer with the name specified in sLayerGroup"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection",
            "errorMessage": "Implicitly handled by getBeam(). Script expects a valid beam.",
            "recovery": "Select a valid GenBeam."
          },
          {
            "check": "Geometric constraints (Height vs Cylinder Length)",
            "errorMessage": "None explicitly scripted. Logic relies on fixed dH2 values (300, 400, 620) derived from dH1.",
            "recovery": "User must ensure 'Height' (dH1) is physically possible within the column height and 'Base Height' (dBasisHoehe) allows space for the base plate."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Dimensions",
            "how": "OPM (Object Properties Palette)",
            "effect": "Modifying dH1 triggers recalculation of Article Code, Cylinder Height, Cut position, and Drill positions. Modifying dBasisHoehe shifts the entire assembly vertically. Modifying dBohrDM changes the main drill diameter."
          },
          {
            "action": "Change Layer/Group",
            "how": "OPM (Object Properties Palette)",
            "effect": "Updating sLayerGroup re-evaluates the assignment logic (Group vs Zone vs Layer) and moves the TSL instance accordingly."
          }
        ]
      },
      "tokens_used": 7206,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Merk Stutzenfuss\n\n## Overview\nThis script generates a \"Merk\" column foot connection, including steel hardware (base plate, cylindrical tube, pressure plate, and hex nut) and the necessary timber machining (drilling and end-cutting) to anchor a timber column to a foundation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script is designed for 3D model generation. |\n| Paper Space | No | Not supported for 2D layouts. |\n| Shop Drawing | No | Not a shop drawing script. |\n\n## Prerequisites\n- **Required Entities:** A single GenBeam (Column).\n- **Minimum Beam Count:** 1\n- **Required Settings:** None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `Merk Stutzenfuss.mcr` from the list.\n\n### Step 2: Select Column\n```\nCommand Line: Select beam:\nAction: Click on the timber column (GenBeam) where you want to install the column foot.\n```\n\n### Step 3: Configure Properties\n```\nAction: A properties dialog appears automatically upon insertion. Adjust the dimensions (Height, Diameter, Offsets) as needed and click OK.\n```\n\n### Step 4: Completion\n```\nAction: The script inserts the steel parts (Base Plate, Cylinder, Pressure Plate, Nut) and applies the machining (Drills and Cut) to the selected column.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Height | Number | 200 | The height of the pressure plate connection relative to the base. This value determines the article code and cylinder length (see Tips). |\n| Diameter | Number | 40 | The diameter of the main central bore hole drilled into the timber. |\n| Base Height | Number | 0 | Vertical offset of the base plate. Use this to shift the entire connection up or down relative to the column's reference line. |\n| Extra Drilling Depth | Number | 0 | Additional depth for the main bore hole beyond the standard calculation. |\n| Depth Drill Housing | Number | 20 | The depth of the wider \"housing\" drill near the top of the connection where the pressure plate sits. |\n| \\|Group, Layername or Zone Character\\| | Text | Z | Determines the layer or group assignment. Enter a Group Name, a Zone Character (T, I, J, Z, C), or a specific Layer Name. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific custom items to the right-click context menu. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Automatic Hardware Selection:** The script automatically selects the correct cylinder length and article code based on the **Height** parameter:\n  - **Height ≤ 210 mm:** Uses Cylinder 300mm (Art 118 150).\n  - **210 < Height ≤ 310 mm:** Uses Cylinder 400mm (Art 118 250).\n  - **Height > 310 mm:** Uses Cylinder 620mm (Art 118 450).\n- **Vertical Adjustment:** Use the **Base Height** parameter if you need to raise the base plate off the floor level or adjust for specific foundation details.\n- **Layer Organization:** The **Group/Layer** property is flexible. If you type \"Z\", it assigns to the Zone. If you type an existing Group name, it adds to that Group. Otherwise, it creates a new Layer.\n\n## FAQ\n- **Q: Why did the cylinder size change when I only updated the Height?**\n  - A: The script has built-in logic to switch hardware (Article 150, 250, or 450) depending on the height thresholds (210mm and 310mm).\n- **Q: How do I move the entire assembly up the column?**\n  - A: Modify the **Base Height** property in the Properties Palette. Increasing this value moves the base plate and all associated drilling upwards.\n- **Q: The drill holes are in the wrong layer. How do I fix this?**\n  - A: Change the **\\|Group, Layername or Zone Character\\|** property. If you want it on a specific layer, type the exact layer name there."
      },
      "tokens_used": 6470,
      "error": null
    }
  }
}