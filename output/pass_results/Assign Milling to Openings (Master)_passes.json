{
  "filename": "Assign Milling to Openings (Master).mcr",
  "status": "completed",
  "total_tokens": 41657,
  "processing_time": 527.33882188797,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5729,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity to select Element objects and calls tsl.dbCreate to attach slave scripts to these elements. It does not use sd_ variables, _Viewport, or #Type E definitions, and it operates on the 3D model entities."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D Model)",
          "requiredSettings": [
            "Assign Milling to Openings (Slave).mcr"
          ]
        }
      },
      "tokens_used": 3721,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialogOnce",
            "trigger": "After selecting elements during insertion",
            "title": null,
            "dataSource": "Internal script properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 12,
            "variable": "sMode",
            "type": "PropString",
            "displayName": "Milling mode",
            "defaultValue": "Opening",
            "inputType": "dropdown",
            "options": [
              "Opening",
              "Opening where sheets intersect"
            ],
            "category": "Milling data",
            "description": null
          },
          {
            "index": 0,
            "variable": "nZone",
            "type": "PropInt",
            "displayName": "Zone",
            "defaultValue": 5,
            "inputType": "dropdown",
            "options": [
              -5,
              -4,
              -3,
              -2,
              -1,
              1,
              2,
              3,
              4,
              5
            ],
            "category": "Milling data",
            "description": null
          },
          {
            "index": 1,
            "variable": "nToolingIndex",
            "type": "PropInt",
            "displayName": "Tooling index",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": "Milling data",
            "description": null
          },
          {
            "index": 0,
            "variable": "strSide",
            "type": "PropString",
            "displayName": "Side",
            "defaultValue": "Right",
            "inputType": "dropdown",
            "options": [
              "Right",
              "Left"
            ],
            "category": "Milling data",
            "description": null
          },
          {
            "index": 1,
            "variable": "strTurn",
            "type": "PropString",
            "displayName": "Turning direction",
            "defaultValue": "With course",
            "inputType": "dropdown",
            "options": [
              "Against course",
              "With course"
            ],
            "category": "Milling data",
            "description": null
          },
          {
            "index": 2,
            "variable": "strOShoot",
            "type": "PropString",
            "displayName": "Overshoot",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Milling data",
            "description": null
          },
          {
            "index": 3,
            "variable": "strVacuum",
            "type": "PropString",
            "displayName": "Vacuum",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Milling data",
            "description": null
          },
          {
            "index": 0,
            "variable": "millDepth",
            "type": "PropDouble",
            "displayName": "Milling Depth",
            "defaultValue": 14.29,
            "inputType": "number",
            "options": [],
            "category": "Dimensions",
            "description": null
          },
          {
            "index": 1,
            "variable": "dOffsetOpening",
            "type": "PropDouble",
            "displayName": "Offset milling around opening",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": "Dimensions",
            "description": null
          },
          {
            "index": 2,
            "variable": "dOffsetTop",
            "type": "PropDouble",
            "displayName": "Offset milling panel top",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": "Dimensions",
            "description": null
          },
          {
            "index": 3,
            "variable": "dOffsetSide",
            "type": "PropDouble",
            "displayName": "Offset milling panel sides",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": "Dimensions",
            "description": null
          },
          {
            "index": 4,
            "variable": "dEdgeOffsetFromHole",
            "type": "PropDouble",
            "displayName": "Offset from hole edge",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": "Dimensions",
            "description": null
          },
          {
            "index": 4,
            "variable": "sMillingOnTop",
            "type": "PropString",
            "displayName": "Milling on top",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "Locations",
            "description": null
          },
          {
            "index": 5,
            "variable": "sMillingOnTopLeft",
            "type": "PropString",
            "displayName": "Milling on top-left",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "Locations",
            "description": null
          },
          {
            "index": 6,
            "variable": "sMillingOnLeft",
            "type": "PropString",
            "displayName": "Milling on left",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "Locations",
            "description": null
          },
          {
            "index": 7,
            "variable": "sMillingOnBottomLeft",
            "type": "PropString",
            "displayName": "Milling on bottom-left",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "Locations",
            "description": null
          },
          {
            "index": 8,
            "variable": "sMillingOnBottom",
            "type": "PropString",
            "displayName": "Milling on bottom",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "Locations",
            "description": null
          },
          {
            "index": 9,
            "variable": "sMillingOnBottomRight",
            "type": "PropString",
            "displayName": "Milling on bottom-right",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "Locations",
            "description": null
          },
          {
            "index": 10,
            "variable": "sMillingOnRight",
            "type": "PropString",
            "displayName": "Milling on right",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "Locations",
            "description": null
          },
          {
            "index": 11,
            "variable": "sMillingOnTopRight",
            "type": "PropString",
            "displayName": "Milling on top-right",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "Locations",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6472,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the attachment of CNC milling operations to wall or floor elements, specifically targeting areas around window and door openings.",
          "category": "Machining / Manufacturing",
          "typicalUseCase": "Creating dados or recesses for drywall returns, plaster stops, or flashing installation on prefabricated timber panels around openings."
        },
        "parameters": [
          {
            "name": "sMode",
            "technicalDefault": "Opening",
            "businessMeaning": "Determines the geometric logic used to calculate the milling path. 'Opening' uses the raw element sub-entity, while 'Opening where sheets intersect' calculates the path based on where sheathing materials meet the opening.",
            "validRange": "Dropdown: Opening, Opening where sheets intersect",
            "unit": "enum",
            "affectsOutput": "Changes the shape and position of the generated milling rectangle relative to the element."
          },
          {
            "name": "nZone",
            "technicalDefault": "5",
            "businessMeaning": "Assigns the machining operation to a specific fabrication layer or priority level. This controls the order of operations or filters the machining for specific machine setups.",
            "validRange": "-5 to 5",
            "unit": "Integer (Priority/Layer)",
            "affectsOutput": "CNC scheduling and layer management in production reports."
          },
          {
            "name": "nToolingIndex",
            "technicalDefault": "1",
            "businessMeaning": "Identifies which specific cutter (tool number) from the CNC machine's magazine should be used for this operation.",
            "validRange": "1 to 99 (Typical machine tool limits)",
            "unit": "Integer (Tool ID)",
            "affectsOutput": "Physical tool selection and resulting cut width/profile."
          },
          {
            "name": "strSide",
            "technicalDefault": "Right",
            "businessMeaning": "Specifies which face of the wall/panel element (Right or Left relative to the construction line) the milling is applied to.",
            "validRange": "Right, Left",
            "unit": "enum",
            "affectsOutput": "Location of the machining on the 3D geometry (Face A vs Face B)."
          },
          {
            "name": "strTurn",
            "technicalDefault": "With course",
            "businessMeaning": "Defines the cutter's feed direction relative to the material rotation. 'With course' is typically Climb Milling, 'Against course' is Conventional Milling.",
            "validRange": "Against course, With course",
            "unit": "enum",
            "affectsOutput": "Surface finish quality and tool wear on the CNC machine."
          },
          {
            "name": "strOShoot",
            "technicalDefault": "No",
            "businessMeaning": "Enables an 'overcut' or cleanup cut where the tool extends slightly beyond the corner intersection to ensure a sharp, clean corner.",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "Corner sharpness and potential for slight breakout at corners."
          },
          {
            "name": "strVacuum",
            "technicalDefault": "Yes",
            "businessMeaning": "Controls the CNC machine's vacuum hold-down system. If 'No', vacuum is released over the milled area (preventing suction loss if cutting through).",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "Machine table suction behavior and workpiece stability during cutting."
          },
          {
            "name": "millDepth",
            "technicalDefault": "14.29",
            "businessMeaning": "The depth of the cut into the timber material. This usually defines the depth of a reveal or groove for finishing materials.",
            "validRange": "0.0 to Material Thickness (e.g., 0 - 300mm)",
            "unit": "mm",
            "affectsOutput": "The Z-depth of the milling pocket/groove."
          },
          {
            "name": "dOffsetOpening",
            "technicalDefault": "0.0",
            "businessMeaning": "A clearance distance added around the entire perimeter of the opening. Used to create a gap between the frame and the milled groove.",
            "validRange": "-50 to +50 mm",
            "unit": "mm",
            "affectsOutput": "Expands or shrinks the milling loop relative to the rough opening."
          },
          {
            "name": "dOffsetTop",
            "technicalDefault": "0.0",
            "businessMeaning": "Shifts the top edge of the milling path vertically independent of other sides.",
            "validRange": "-200 to +200 mm",
            "unit": "mm",
            "affectsOutput": "Vertical position of the top milling segment."
          },
          {
            "name": "dOffsetSide",
            "technicalDefault": "0.0",
            "businessMeaning": "Shifts the side edges of the milling path horizontally.",
            "validRange": "-200 to +200 mm",
            "unit": "mm",
            "affectsOutput": "Horizontal position of the left/right milling segments."
          },
          {
            "name": "dEdgeOffsetFromHole",
            "technicalDefault": "0.0",
            "businessMeaning": "A specific offset applied when the milling interacts with a 'hole' sub-element rather than the main opening perimeter.",
            "validRange": "0 to 100 mm",
            "unit": "mm",
            "affectsOutput": "Clearance around circular or irregular penetrations."
          },
          {
            "name": "sMillingOnTop/Left/Right/Bottom/...",
            "technicalDefault": "Yes",
            "businessMeaning": "Granular control to enable or disable the milling on specific sides of the opening (including corner radii). Allows creating 'U-shaped' or 'J-shaped' grooves.",
            "validRange": "Yes, No",
            "unit": "enum",
            "affectsOutput": "Presence or absence of machining on specific segments of the opening perimeter."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sMode",
            "effect": "Determines the base geometry used by all Offset parameters.",
            "cascade": [
              "dOffsetOpening",
              "dOffsetTop",
              "dOffsetSide",
              "dEdgeOffsetFromHole"
            ]
          },
          {
            "trigger": "strVacuum",
            "effect": "Maps a string value to an internal integer flag required by the database.",
            "cascade": [
              "nVacuum"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TslInst (Script Instance)",
            "description": "An instance of 'Assign Milling to Openings (Slave).mcr' is attached to the selected Elements. The Slave script subsequently generates the physical Milling/Machining visualisation and data.",
            "appliedTo": "Selected Wall or Floor Elements"
          }
        ]
      },
      "tokens_used": 8315,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Insertion: User executes command to run script",
          "2. Command Line Prompt: '\nSelect a set of elements'",
          "3. [Conditional] User Selection Action",
          "4. Configuration Dialog: 'showDialogOnce' displays Properties Palette or Dialog for parameters",
          "5. Parameter Input: User sets Milling mode, Tooling index, Offsets, etc.",
          "6. Initialization: Script compiles properties into local arrays (Int, Double, String)",
          "7. Validation Check: Verifies elements exist in _Element array",
          "8. Loop Start: Iterate through each selected Element",
          "9. Inspection: Check attached scripts on current Element",
          "10. [Conditional] Existing Slave Detection",
          "11. Action: Create new Slave instance ('Assign Milling to Openings (Slave)')",
          "12. Data Transfer: Pass Master properties to Slave instance",
          "13. Loop End: Repeat for next Element",
          "14. Clean Up: Erase Master Script instance from drawing"
        ],
        "conditionalBranches": [
          {
            "condition": "User Response to Selection Prompt (ssE.go)",
            "path1": {
              "name": "Selection Successful",
              "steps": [
                "Entities are retrieved",
                "Entities are cast to Elements",
                "Elements appended to _Element array",
                "Proceed to Configuration Dialog"
              ]
            },
            "path2": {
              "name": "Selection Cancelled/Empty",
              "steps": [
                "User presses Esc or Enter without selection",
                "_Element array remains empty",
                "Script exits _bOnInsert block",
                "Validation fails (_Element.length() == 0)",
                "eraseInstance() is called"
              ]
            }
          },
          {
            "condition": "Slave Script Existence on Element",
            "path1": {
              "name": "Existing Slave Found",
              "steps": [
                "Script identifies existing TslInst with name 'Assign Milling to Openings (Slave)'",
                "Existing instance is deleted via dbErase()",
                "New instance is created to replace it"
              ]
            },
            "path2": {
              "name": "No Existing Slave",
              "steps": [
                "Script finds no matching TslInst",
                "New instance is created immediately"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Type",
            "errorMessage": "Implicit (PrEntity filter prevents selection of non-Elements)",
            "recovery": "User must select a valid hsbCAD Element (Wall or Floor)"
          },
          {
            "check": "Array Population",
            "errorMessage": "None (Silent failure)",
            "recovery": "User must re-run script and ensure at least one element is selected"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Parameters",
            "how": "Since the Master erases itself, modification is done by editing the generated 'Slave' script instances directly via the Properties Palette (OPM)",
            "effect": "Updates the milling geometry on specific elements without re-running the Master"
          },
          {
            "action": "Global Update",
            "how": "Re-run the Master script and select the same elements again",
            "effect": "The Master detects and deletes the old Slave instances and replaces them with new ones reflecting the updated Master parameters"
          }
        ]
      },
      "tokens_used": 9446,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Assign Milling to Openings (Master).mcr\n\n## Overview\nThis script automates the attachment of CNC milling operations to wall or floor elements, specifically targeting areas around window and door openings. It is used to create dados or recesses for drywall returns, plaster stops, or flashing installation on prefabricated timber panels.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Operates on 3D Element objects (Walls/Floors). |\n| Paper Space | No | Not designed for 2D layout views. |\n| Shop Drawing | No | Does not generate views or dimensions. |\n\n## Prerequisites\n- **Required Entities**: Element (Wall or Floor).\n- **Minimum Beams**: 0.\n- **Required Settings Files**: `Assign Milling to Openings (Slave).mcr` (Must be in the TSL search path).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Assign Milling to Openings (Master).mcr`\n\n### Step 2: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the desired Wall or Floor elements in the 3D model. Press Enter to confirm selection.\n```\n\n### Step 3: Configure Milling Parameters\nAfter selecting elements, the Properties Palette (or a dynamic dialog) will display.\nAction: Adjust the milling settings (Depth, Tooling, Offsets, Side) as required for the production.\n*Note: Changes made here will be applied to all selected elements.*\n\n### Step 4: Generate Milling\nThe script automatically attaches a \"Slave\" script instance to each selected element with the defined parameters and then erases itself from the drawing.\n\n## Properties Panel Parameters\n\n### Milling Data\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Milling mode | dropdown | Opening | Determines the geometry logic. Choose 'Opening' for raw sub-entities or 'Opening where sheets intersect' for sheathing-based paths. |\n| Zone | dropdown | 5 | Assigns the operation to a specific fabrication layer or priority level (-5 to 5). |\n| Tooling index | number | 1 | The cutter number from the CNC machine magazine to use. |\n| Side | dropdown | Right | The face of the panel to mill (Right or Left relative to the construction line). |\n| Turning direction | dropdown | With course | Cutter feed direction: 'With course' (Climb) or 'Against course' (Conventional). |\n| Overshoot | dropdown | No | Enables an overcut at corners to ensure a sharp finish. |\n| Vacuum | dropdown | Yes | Controls machine vacuum hold-down (No releases suction to prevent loss if cutting through). |\n\n### Dimensions\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Milling Depth | number | 14.29 | The depth of the cut into the timber material (mm). |\n| Offset milling around opening | number | 0.0 | Clearance distance added around the entire perimeter of the opening (mm). |\n| Offset milling panel top | number | 0.0 | Shifts the top edge of the milling path vertically (mm). |\n| Offset milling panel sides | number | 0.0 | Shifts the side edges of the milling path horizontally (mm). |\n| Offset from hole edge | number | 0.0 | Specific clearance offset applied around hole sub-elements (mm). |\n\n### Locations\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Milling on top | dropdown | Yes | Enables or disables milling on the top edge of the opening. |\n| Milling on top-left | dropdown | Yes | Enables or disables milling on the top-left corner radius. |\n| Milling on left | dropdown | Yes | Enables or disables milling on the left edge. |\n| Milling on bottom-left | dropdown | Yes | Enables or disables milling on the bottom-left corner radius. |\n| Milling on bottom | dropdown | Yes | Enables or disables milling on the bottom edge. |\n| Milling on bottom-right | dropdown | Yes | Enables or disables milling on the bottom-right corner radius. |\n| Milling on right | dropdown | Yes | Enables or disables milling on the right edge. |\n| Milling on top-right | dropdown | Yes | Enables or disables milling on the top-right corner radius. |\n\n## Right-Click Menu Options\n*None. The Master script erases itself after execution. Modifications are made via the Properties Palette on the generated Slave instances.*\n\n## Settings Files\n- **Filename**: `Assign Milling to Openings (Slave).mcr`\n- **Location**: TSL Search Path (Company or Install folder).\n- **Purpose**: This script is instantiated on the elements by the Master. It calculates the geometry and visualizes the actual milling.\n\n## Tips\n- **Disappearing Script**: Do not be alarmed if the Master script instance vanishes from the drawing immediately after running. This is intended behavior; it passes the data to the Slave scripts attached to the elements.\n- **Modifying Specific Elements**: To change the milling depth or offset for a single wall, select the wall, open the Properties Palette, and find the entry labeled **Assign Milling to Openings (Slave)** to edit its properties.\n- **Global Updates**: To change settings for multiple elements at once, simply re-run the Master script and re-select the elements. It will detect the old Slave instances, replace them, and apply the new settings.\n\n## FAQ\n- **Q: Where did the script go after I ran it?**\n  A: The \"Master\" script is a one-time configuration tool. It creates \"Slave\" scripts on the elements to handle the actual geometry and deletes itself to keep the drawing clean.\n- **Q: How do I create a U-shaped groove instead of a full rectangle?**\n  A: In the Properties palette under the **Locations** category, set the specific sides you do *not* want to mill (e.g., the \"Milling on bottom\") to \"No\".\n- **Q: What is the difference between 'Opening' and 'Opening where sheets intersect'?**\n  A: \"Opening\" uses the exact wall opening geometry. \"Opening where sheets intersect\" calculates the path based on where the outer sheathing (like OSB) meets the opening, which is useful for specific detailing conditions."
      },
      "tokens_used": 7974,
      "error": null
    }
  }
}