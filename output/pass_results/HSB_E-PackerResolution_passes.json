{
  "filename": "HSB_E-PackerResolution.mcr",
  "status": "completed",
  "total_tokens": 32779,
  "processing_time": 341.726598739624,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3596,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script creates a physical GenBeam object (`Beam newBeam = leftBeam.dbCopy();`) and modifies its geometry (`setD`, `transformBy`) to insert a 'Packer' into the model. It uses `eraseInstance()` after generation, which is typical for model-generation scripts. There are no references to `_Viewport`, `sd_` functions, or `_Entity` annotations, and it prompts for `getElement()` and `getPoint()`, which are interactions associated with 3D modeling."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Beams (studs) within the Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3765,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getElement",
              "promptOriginal": "Select element",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Specify point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Script Insert (if no Execute Key) or MapIO",
            "title": "HSB_E-PackerResolution",
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "minimumGap",
            "type": "PropDouble",
            "displayName": "Minimum Gap",
            "defaultValue": 0.1,
            "inputType": "number",
            "options": [],
            "category": "Tolerance",
            "description": null
          },
          {
            "index": 1,
            "variable": "maximumGap",
            "type": "PropDouble",
            "displayName": "Maximum Gap",
            "defaultValue": 200.0,
            "inputType": "number",
            "options": [],
            "category": "Tolerance",
            "description": null
          },
          {
            "index": 0,
            "variable": "name",
            "type": "PropString",
            "displayName": "Packer Name",
            "defaultValue": "Packer",
            "inputType": "text",
            "options": [],
            "category": "Properties",
            "description": null
          },
          {
            "index": 1,
            "variable": "material",
            "type": "PropString",
            "displayName": "Packer Material",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Properties",
            "description": null
          },
          {
            "index": 2,
            "variable": "beamType",
            "type": "PropString",
            "displayName": "Packer Type",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "_BeamTypes"
            ],
            "category": "Properties",
            "description": null
          },
          {
            "index": 0,
            "variable": "color",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 32,
            "inputType": "number",
            "options": [],
            "category": "Properties",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5910,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically calculates and inserts a timber packer (filler piece) between two adjacent studs in a wall element to fill a specific void.",
          "category": "Framing",
          "typicalUseCase": "Used during wall layout modification to fill non-standard gaps between studs, resolve spacing conflicts around openings, or ensure insulation continuity where stud spacing exceeds maximum allowable distances but doesn't require a full structural stud."
        },
        "parameters": [
          {
            "name": "minimumGap",
            "technicalDefault": "0.1",
            "businessMeaning": "The smallest void size considered manufacturable or worth filling. Gaps smaller than this threshold are ignored to prevent creating tiny slivers of wood that jam machinery.",
            "validRange": "5mm - 50mm",
            "unit": "mm",
            "affectsOutput": "Determines if the script runs or aborts with a 'Gap is to small' error if the detected void is too narrow."
          },
          {
            "name": "maximumGap",
            "technicalDefault": "200.0",
            "businessMeaning": "The largest void size permissible for a 'packer'. Gaps larger than this typically require a full structural stud rather than a filler piece.",
            "validRange": "200mm - 600mm",
            "unit": "mm",
            "affectsOutput": "Ideally prevents the script from creating oversized packers that should be treated as primary structural members (though code usage of this specific property is implicit in the parameter definition)."
          },
          {
            "name": "name",
            "technicalDefault": "\"Packer\"",
            "businessMeaning": "The identifier assigned to the generated beam for production lists and labeling.",
            "validRange": "Standard text strings (e.g., 'Packer', 'Filler', 'Spacer')",
            "unit": "text",
            "affectsOutput": "Updates the 'Name' attribute of the new GenBeam, filtering how it appears in BOMs and CAM lists."
          },
          {
            "name": "material",
            "technicalDefault": "\"\"",
            "businessMeaning": "The timber grade or material class to be used for the packer.",
            "validRange": "Valid material codes from the hsbCAD database (e.g., 'C24', 'GL24h')",
            "unit": "text",
            "affectsOutput": "Sets the material property of the new beam, affecting structural properties and machining optimization."
          },
          {
            "name": "beamType",
            "technicalDefault": "null",
            "businessMeaning": "The construction class or subtype of the beam (e.g., Standard, Solid Timber, CLT).",
            "validRange": "Available Beam Types in the project catalog",
            "unit": "enum",
            "affectsOutput": "Defines the logical behavior of the beam within the software (e.g., default layering, machining rules)."
          },
          {
            "name": "color",
            "technicalDefault": "32",
            "businessMeaning": "The visual color used to display the packer in the CAD model to distinguish it from standard framing.",
            "validRange": "AutoCAD Color Index (1-255)",
            "unit": "index",
            "affectsOutput": "Changes the display color of the generated beam entity."
          },
          {
            "name": "_Pt0 (Specify point)",
            "technicalDefault": "User Input",
            "businessMeaning": "The location clicked by the user within the wall element to identify which gap to fill.",
            "validRange": "Any point in 3D space between two studs",
            "unit": "coordinates",
            "affectsOutput": "Determines exactly which two studs (Left and Right) are identified as the boundaries for the packer calculation."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "_Pt0 (User click location)",
            "effect": "Identifies the nearest studs to the left and right to calculate width and position.",
            "cascade": [
              "packerWidth",
              "newBeamPosition"
            ]
          },
          {
            "trigger": "leftBeam (The first stud to the left of the click)",
            "effect": "Defines the initial geometry (Height, Depth, Orientation) of the new packer via dbCopy.",
            "cascade": [
              "newBeam.dY (Height)",
              "newBeam.dZ (Depth)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam",
            "description": "A timber beam element sized to exactly fit the gap between two adjacent studs. It inherits the height and depth of the left bounding stud but adopts a new width equal to the gap distance.",
            "appliedTo": "The selected Wall Element."
          }
        ]
      },
      "tokens_used": 6290,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization",
          "2. Check for MapIO or Execute Key triggers",
          "3. [Conditional] Load Properties from Catalog OR Show Properties Dialog",
          "4. Prompt User to select Element (Wall/Floor)",
          "5. Prompt User to specify Point (Gap location)",
          "6. Script Recalculation Triggered",
          "7. Validate Element Reference exists",
          "8. Retrieve and Filter Beams (Identify studs vs plates)",
          "9. Find nearest studs to the left and right of the specified point",
          "10. [Conditional] Check if neighboring studs are found",
          "11. Calculate gap width (distance between studs)",
          "12. [Conditional] Check if gap width is greater than tolerance (0.1mm)",
          "13. Duplicate Left Stud geometry to create new Packer",
          "14. Resize Packer width to match calculated gap",
          "15. Apply Packer properties (Name, Material, Color, Type)",
          "16. Erase Script Instance (Self-destruct)"
        ],
        "conditionalBranches": [
          {
            "condition": "Execute Key (_kExecuteKey) Presence",
            "path1": {
              "name": "Automated/Keyed Insert",
              "steps": [
                "Detect Execute Key",
                "Load property presets from Catalog matching Key name",
                "Skip Dialog",
                "Proceed to User Prompts"
              ]
            },
            "path2": {
              "name": "Manual Insert",
              "steps": [
                "No Execute Key found",
                "Open Properties Dialog (ShowDynamicDialog)",
                "User inputs properties (Gap tolerances, Name, Material)",
                "Save settings to 'LastInserted' catalog",
                "Proceed to User Prompts"
              ]
            }
          },
          {
            "condition": "Nearest Stud Detection",
            "path1": {
              "name": "Success",
              "steps": [
                "Identifies Left Beam",
                "Identifies Right Beam",
                "Calculate midpoint and width"
              ]
            },
            "path2": {
              "name": "Failure",
              "steps": [
                "BeamsLeft array is empty OR BeamsRight array is empty",
                "Report Message: 'Cannot identify nearest studs'",
                "Erase Script Instance",
                "Abort"
              ]
            }
          },
          {
            "condition": "Gap Width Validation",
            "path1": {
              "name": "Valid Gap",
              "steps": [
                "Width > 0.1mm",
                "Create GenBeam",
                "Transform to midpoint",
                "Set width (dX)"
              ]
            },
            "path2": {
              "name": "Invalid Gap",
              "steps": [
                "Width <= 0.1mm",
                "Report Message: 'Gap is to small'",
                "Erase Script Instance",
                "Abort"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Reference",
            "errorMessage": "Element reference not found.",
            "recovery": "Select the script again and ensure a valid Element is selected during the getElement prompt."
          },
          {
            "check": "Bounding Studs Existence",
            "errorMessage": "Cannot identify nearest studs",
            "recovery": "Ensure the selected point is actually between two studs (beams perpendicular to element X-axis) and not at the end of the wall or overlapping a plate."
          },
          {
            "check": "Gap Size Tolerance",
            "errorMessage": "Gap is to small",
            "recovery": "Select a point where the gap between studs is larger than 0.1mm. If studs are touching, no packer is needed."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Packer Geometry",
            "how": "Standard AutoCAD Grips / GenBeam Properties",
            "effect": "The script self-erases after generation. The resulting 'Packer' is a standard GenBeam. Modifying it does not trigger the script again; it behaves like any other manually drawn beam."
          }
        ]
      },
      "tokens_used": 7461,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-PackerResolution.mcr\n\n## Overview\nAutomatically calculates and inserts a timber packer (filler piece) between two adjacent studs in a wall element to fill a specific void. This tool is useful for resolving spacing conflicts around openings or ensuring insulation continuity where stud spacing is non-standard.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be run in the 3D model to interact with wall elements. |\n| Paper Space | No | Not designed for layout views or shop drawings. |\n| Shop Drawing | No | This is a modeling tool only. |\n\n## Prerequisites\n- **Required Entities**: A Wall Element containing existing studs/beams.\n- **Minimum Beam Count**: The wall must have at least two parallel studs to define a gap.\n- **Required Settings**: None. The script uses standard project catalogs for beam types and materials.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_E-PackerResolution.mcr`\n\n### Step 2: Configuration\nIf no Execute Key is preset, a **Properties Dialog** will appear automatically.\n- **Action**: Adjust the *Minimum Gap* and *Maximum Gap* tolerances, or set the desired *Packer Name* and *Material*. Click OK.\n\n### Step 3: Select Element\n```\nCommand Line: Select element\nAction: Click on the Wall Element (or floor) where the gap exists.\n```\n\n### Step 4: Specify Point\n```\nCommand Line: Specify point\nAction: Click inside the gap between two studs where you want the packer inserted.\n```\n*The script will automatically detect the nearest studs to the left and right of your click, calculate the distance, and insert the packer. The script instance will then erase itself, leaving only the new timber beam.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Minimum Gap** | Number | 0.1 mm | The smallest void size considered manufacturable. Gaps smaller than this value will trigger an error (\"Gap is to small\"). |\n| **Maximum Gap** | Number | 200.0 mm | The largest void size allowed for a packer. Gaps larger than this typically require a full structural stud. |\n| **Packer Name** | Text | Packer | The identifier assigned to the generated beam (e.g., for BOMs and labels). |\n| **Packer Material** | Text | *Project Default* | The timber grade or material class for the packer (e.g., C24). |\n| **Packer Type** | Dropdown | *Project Default* | The construction class of the beam (Standard, Solid Timber, etc.). |\n| **Color** | Number | 32 | The AutoCAD color index used to display the packer in the model. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add custom options to the right-click context menu after insertion. |\n\n## Settings Files\n- **Filename**: *None specific*\n- **Location**: N/A\n- **Purpose**: The script saves user settings to the 'LastInserted' catalog in hsbCAD but does not rely on external XML configuration files.\n\n## Tips\n- **Click Precisely**: Ensure you click clearly between two studs. If you click too close to a plate or the end of the wall, the script may not find bounding studs.\n- **Self-Cleaning**: The script instance removes itself from the drawing immediately after creating the packer. Do not look for the script origin point afterwards.\n- **Editing**: The resulting packer is a standard GenBeam. You can modify its dimensions or properties later using normal AutoCAD grips or the Properties palette.\n\n## FAQ\n\n**Q: Why does the script say \"Cannot identify nearest studs\"?**\nA: This happens if the point you clicked is not between two parallel beams (studs) within the selected element. Ensure you are clicking in a valid gap between vertical studs and not overlapping a plate.\n\n**Q: Why does the script say \"Gap is to small\"?**\nA: The distance between the two studs is less than the *Minimum Gap* setting (default 0.1mm). The studs might be touching or overlapping slightly. Adjust the *Minimum Gap* property or move the studs further apart.\n\n**Q: Can I use this to fill large gaps (e.g., 500mm)?**\nA: While technically possible, the *Maximum Gap* setting (default 200mm) is intended to prevent using this tool where a structural stud is required. You can increase the *Maximum Gap* parameter in the Properties Panel if necessary, but ensure structural integrity is maintained."
      },
      "tokens_used": 5757,
      "error": null
    }
  }
}