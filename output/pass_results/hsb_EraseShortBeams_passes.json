{
  "filename": "hsb_EraseShortBeams.mcr",
  "status": "completed",
  "total_tokens": 22269,
  "processing_time": 453.85522842407227,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "07.05.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3799,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script prompts for selection of Elements using PrEntity and manipulates Beams via dbErase and setColor. It lacks 'sd_' prefixes, Viewport handling, or drawing generation logic, indicating it operates directly on the 3D model."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D environment)",
          "requiredSettings": []
        }
      },
      "tokens_used": 2817,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one or More Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDialogOnce",
            "trigger": "On Insert (if _kExecuteKey is empty)",
            "title": null,
            "dataSource": "Script default properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sMode",
            "type": "PropString",
            "displayName": "Action",
            "defaultValue": "Delete",
            "inputType": "dropdown",
            "options": [
              "Delete",
              "Change Color"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dMinLength",
            "type": "PropDouble",
            "displayName": "Minimum beam length",
            "defaultValue": "50.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2506,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Identifies and processes beams within selected elements that are shorter than a specified threshold, either deleting them as manufacturing waste or highlighting them for review.",
          "category": "Model Cleanup / Data Management",
          "typicalUseCase": "Removing tiny geometry fragments (offcuts) generated by complex wall intersections or automated layouts that are too small to be physically machined or handled in production."
        },
        "parameters": [
          {
            "name": "sMode",
            "technicalDefault": "Delete",
            "businessMeaning": "Defines the operation to perform on detected short beams. 'Delete' removes them from the BOM and model, while 'Change Color' flags them visually for manual verification.",
            "validRange": "Delete, Change Color",
            "unit": "List",
            "affectsOutput": "Determines whether the script permanently modifies the geometry (deletion) or only modifies visual attributes (color)."
          },
          {
            "name": "dMinLength",
            "technicalDefault": "50.0",
            "businessMeaning": "The physical length threshold defining a 'short beam'. Any beam with a solid length below this value is considered an offcut or error.",
            "validRange": "10.0 - 500.0",
            "unit": "mm",
            "affectsOutput": "Filters which beams are selected for deletion or color change. Smaller values affect fewer beams; larger values clean up more aggressively."
          },
          {
            "name": "nColor",
            "technicalDefault": "1",
            "businessMeaning": "The AutoCAD color index used to highlight beams that fall below the minimum length when 'Change Color' mode is active.",
            "validRange": "1 - 255",
            "unit": "AutoCAD Color Index",
            "affectsOutput": "Only changes the visual display color of the beams; does not alter geometry or nesting data."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sMode is set to 'Delete'",
            "effect": "The nColor parameter is ignored as the beams are removed from the drawing.",
            "cascade": [
              "nColor"
            ]
          },
          {
            "trigger": "sMode is set to 'Change Color'",
            "effect": "The nColor parameter determines the resulting appearance of the short beams.",
            "cascade": [
              "nColor"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam",
            "description": "Deletion from the model database or modification of the Color property.",
            "appliedTo": "Beams within selected Elements where solidLength < dMinLength."
          }
        ]
      },
      "tokens_used": 3862,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Loads properties (sMode, dMinLength, nColor) and checks execution context.",
          "2. Database Creation Check: If (_bOnDbCreated), script retrieves property values from catalog based on _kExecuteKey.",
          "3. Insertion Phase Check: Determines if the script is being inserted (_bOnInsert).",
          "4. Insertion Cycle Check: If insertion is in a repeat cycle (>1), the instance is erased immediately to prevent duplication.",
          "5. Dialog/Property Configuration: If _kExecuteKey is empty, the default properties dialog (ShowDialogOnce) is displayed.",
          "6. Entity Selection: User is prompted to select one or more Elements (PrEntity).",
          "7. Selection Validation: If elements are successfully selected, they are appended to the _Element list; otherwise, the script awaits input or times out.",
          "8. Initial Exit: Script returns after selection to process data in the next run (non-insertion mode).",
          "9. Post-Insertion Execution: Script runs again (non-insertion). Checks if _Element list is empty.",
          "10. Empty List Handling: If no elements are present, the script instance erases itself.",
          "11. Element Iteration: Loops through each selected Element.",
          "12. Beam Collection: Retrieves all Beams within the current Element.",
          "13. Beam Iteration & Logic Check: Loops through each Beam.",
          "14. Length Comparison: Checks if the Beam's solidLength is less than dMinLength.",
          "15. Action Execution:",
          "   - If sMode is 'Delete' (nMode==0): Calls dbErase() on the Beam.",
          "   - If sMode is 'Change Color': Calls setColor(nColor) on the Beam.",
          "16. Flag Update: Sets nErase flag to true if any beams were processed.",
          "17. Completion Check: If beams were processed or element construction is detected, the script instance erases itself."
        ],
        "conditionalBranches": [
          {
            "condition": "Check for Insertion Cycle (_bOnInsert && insertCycleCount() > 1)",
            "path1": {
              "name": "Duplicate Insertion Detected",
              "steps": [
                "Erase Script Instance",
                "Return (Stop Execution)"
              ]
            },
            "path2": {
              "name": "First Insertion",
              "steps": [
                "Check Execute Key",
                "Proceed to User Input"
              ]
            }
          },
          {
            "condition": "Execution Key Check (_bOnInsert && _kExecuteKey == \"\")",
            "path1": {
              "name": "Manual Launch / No Key",
              "steps": [
                "Show Properties Dialog (ShowDialogOnce)",
                "Prompt for Element Selection (PrEntity)"
              ]
            },
            "path2": {
              "name": "Catalog / Key Launch",
              "steps": [
                "Skip Dialog",
                "Prompt for Element Selection (PrEntity)"
              ]
            }
          },
          {
            "condition": "Element List Validation (!_bOnInsert && _Element.length() == 0)",
            "path1": {
              "name": "No Elements Selected",
              "steps": [
                "Erase Script Instance",
                "Return (Stop Execution)"
              ]
            },
            "path2": {
              "name": "Elements Available",
              "steps": [
                "Begin Element Processing Loop"
              ]
            }
          },
          {
            "condition": "Short Beam Detected (bm.solidLength() < dMinLength)",
            "path1": {
              "name": "Action: Delete (sMode == 'Delete')",
              "steps": [
                "Execute dbErase() on Beam",
                "Beam removed from Database"
              ]
            },
            "path2": {
              "name": "Action: Change Color (sMode == 'Change Color')",
              "steps": [
                "Execute setColor(nColor) on Beam",
                "Beam visually updated"
              ]
            },
            "path3": {
              "name": "Beam is Long Enough",
              "steps": [
                "Skip Beam (No Action)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection during Insert",
            "errorMessage": "None explicitly thrown via MessageBox, but empty selection leads to erasure in the next cycle.",
            "recovery": "User must re-run the script and ensure elements are selected during the PrEntity prompt."
          },
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None",
            "recovery": "Script handles this automatically by erasing duplicate instances."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Threshold/Action (Not Supported)",
            "how": "None (Script self-erases immediately after processing)",
            "effect": "The script instance does not persist in the drawing after processing the selected elements."
          }
        ]
      },
      "tokens_used": 4399,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_EraseShortBeams\n\n## Overview\nIdentifies and processes beams within selected elements that are shorter than a specified length threshold. It allows you to either delete these small offcuts (waste) or highlight them by changing their color for manual verification.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates directly on 3D model elements. |\n| Paper Space | No | Not designed for layout or drawing views. |\n| Shop Drawing | No | Not intended for generating manufacturing drawings. |\n\n## Prerequisites\n- **Required Entities**: Elements (e.g., walls, roofs) containing Beams must exist in the model.\n- **Minimum Beam Count**: None required (script processes all beams found in selected elements).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the AutoCAD command line.\n2.  Browse and select `hsb_EraseShortBeams.mcr`.\n\n### Step 2: Configure Settings\nUpon launching, a properties dialog will appear automatically. Set your desired criteria:\n- **Action**: Choose whether to delete the beams or just change their color.\n- **Minimum beam length**: Enter the cutoff length (in mm). Any beam shorter than this will be affected.\n- **Color**: If \"Change Color\" is selected, pick the color index to use (e.g., 1 for Red).\n*Click OK to proceed.*\n\n### Step 3: Select Elements\n```\nCommand Line: Select one or More Elements\nAction: Click on the desired Elements (Walls, Roofs, etc.) in the model view. Press Enter to confirm selection.\n```\n\n### Step 4: Processing\nThe script will automatically scan the selected elements. It will either delete the short beams or change their color based on your settings. The script instance will then remove itself from the drawing automatically.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Action | dropdown | Delete | Determines what happens to short beams. Choose \"Delete\" to remove them, or \"Change Color\" to flag them visually. |\n| Minimum beam length | number | 50.0 | The length threshold (in mm). Beams with a solid length shorter than this value are targeted. |\n| Color | number | 1 | The AutoCAD color index applied to short beams when the Action is set to \"Change Color\". |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add specific options to the entity right-click menu. |\n\n## Settings Files\n- **Filename**: None required\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Verify Before Deleting**: If you are unsure which beams will be affected, set the **Action** to \"Change Color\" (e.g., Red) first. Run the script to visually identify the offcuts, then undo and run again with \"Delete\" if the results are correct.\n- **Undo Function**: You can use the standard AutoCAD `UNDO` command immediately after running the script to restore beams if you accidentally delete too much.\n- **Unit System**: The script calculates length based on the internal model units (typically mm). Ensure your `dMinLength` value is appropriate for your project scale.\n\n## FAQ\n- **Q: Can I select individual beams instead of whole Elements?**\n- A: No, this script requires you to select the parent Element (like a wall). It will then check every beam inside that element.\n- **Q: What happens if I select an element with no short beams?**\n- A: The script will simply process the element, find no beams matching the criteria, and finish without making changes.\n- **Q: Why did the script disappear from my drawing after running?**\n- A: This is intended behavior. The script instance automatically erases itself once it has finished processing the selected elements to keep your drawing clean."
      },
      "tokens_used": 4886,
      "error": null
    }
  }
}