{
  "filename": "hsbTileMaster.mcr",
  "status": "completed",
  "total_tokens": 56811,
  "processing_time": 246.2805299758911,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "2.5",
            "date": "25.05.2009",
            "author": "th@hsbCAD.de",
            "changes": "Translation issue fixed"
          },
          {
            "version": "2.4",
            "date": "24.03.2009",
            "author": "th@hsbCAD.de",
            "changes": "bugfix orientation DE   bugFix Dachelementkontur EN   bugFix contour detection of complex roof elements"
          },
          {
            "version": "2.2",
            "date": "31.10.2007",
            "author": "th@hsbCAD.de",
            "changes": "- neue Option 'Auto-Update nach nderungen' erhht Leistung wenn deaktiviert - Gruppenindex der einzelnen Dachflchen beginnt mit 1"
          },
          {
            "version": "2.1",
            "date": "15.10.2007",
            "author": "th@hsbCAD.de",
            "changes": "29.08.07 th@hsbCAD.de detection of laths which are closed to the ridge with a large offset to the roofplane enhanced 11.10.07 th@hsbCAD.de roofelements which are parallel but not in the same plane do not mix up lath assignment anymore 15.10.07 th@hsbCAD.de 2.1 project name and number dispalyed in header 31.10.07 th@hsbCAD.de 2.1 setExecutionLoops on add/delete/modify optional 1 or 2 Autogrouping starts with index 1 30.11.07 th@hsbCAD.de bugFix contour detection of complex roof elements"
          }
        ],
        "settingsFiles": [
          "hsbTileCatalog.xml"
        ],
        "dependencies": [
          "hsbTileSingle",
          "hsbTileEdge"
        ]
      },
      "tokens_used": 9619,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script interacts with ERoofPlane entities and places a schedule/table of tile information using Display dp() which defaults to drawing in the current context, typically Model Space for TSL scripts unless specifically assigned to a viewport. No usage of #Type E, _Viewport, sd_*, or Multipage prefixes. The script calculates geometry and places a graphical table (schedule) in the 3D model environment."
        },
        "prerequisites": {
          "requiredEntities": [
            "ERoofPlane"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Requires roofplanes to calculate tile distribution. The script inserts a graphical schedule (table) of the tile counts.",
          "requiredSettings": [
            "<hsbCompany>\\Abbund\\hsbTileCatalog.xml"
          ]
        }
      },
      "tokens_used": 6571,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && insertCycleCount() == 1",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity.go",
              "promptOriginal": "Select roofplanes and (optional) tsl instances to delete",
              "condition": "_bOnInsert && insertCycleCount() == 1",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "Insertion point of table",
              "condition": "_bOnInsert && insertCycleCount() == 1",
              "required": true
            }
          ],
          "keywordOptions": [
            {
              "prompt": "Select roofplanes",
              "options": []
            }
          ]
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 2,
            "variable": "sTileProduct",
            "type": "PropString",
            "displayName": "Supplier / Product",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sGroup",
            "type": "PropString",
            "displayName": "Auto group analysis BOM (seperate Level by '\\')",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Determines the second level group of the tsl (seperate level by '\\')"
          },
          {
            "index": 0,
            "variable": "dDeltaL",
            "type": "PropDouble",
            "displayName": "Offset left",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Determines the offset of the lath contour to the roof outline"
          },
          {
            "index": 1,
            "variable": "dDeltaR",
            "type": "PropDouble",
            "displayName": "Offset right",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Determines the offset of the lath contour to the roof outline"
          },
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sAutoUpdate",
            "type": "PropString",
            "displayName": "Auto update after changes",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": "This option triggers the automatic update after modifications through the context menu. If set to NO the performace will increase but one has to fire the update or hsb_Recalc on the instance."
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 252,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Update|",
            "handler": "T(|Update|)",
            "action": "Recalculates the schedule and updates the display.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|append roofplanes|",
            "handler": "T(\"|append roofplanes|\")",
            "action": "Allows adding additional roofplanes to the existing calculation.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|create Tiles|",
            "handler": "T(\"|create Tiles|\")",
            "action": "Generates the physical tile elements (hsbTileSingle/hsbTileEdge) on the roof.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "_________________",
            "handler": "_________________",
            "action": "Menu separator",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Delete tiles|",
            "handler": "T(\"|Delete tiles|\")",
            "action": "Deletes the generated tile elements.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Add tiles|",
            "handler": "T(\"|Add tiles|\")",
            "action": "Adds tile elements (likely based on current settings).",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Modify tile|",
            "handler": "T(\"|Modify tile|\")",
            "action": "Modifies existing tile elements.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "________________",
            "handler": "________________",
            "action": "Menu separator",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|append roof edge|",
            "handler": "T(\"|append roof edge|\")",
            "action": "Appends roof edges for calculation.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|read catalog|",
            "handler": "T(\"|read catalog|\")",
            "action": "Reloads the tile catalog data from the XML file.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "hsbTileCatalog.xml",
            "searchPaths": [
              "<hsbCompany>\\Abbund\\"
            ],
            "purpose": "Contains tile definitions, dimensions, and article data for 'Area' and 'Ridge/Hip' tiles.",
            "required": true
          }
        ]
      },
      "tokens_used": 9498,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Calculates tile distribution, quantities, and waste factors for selected roof planes based on a specific tile profile from a catalog, and generates a graphical material schedule.",
          "category": "Material Planning / Estimation",
          "typicalUseCase": "Used during the detailing phase to generate a bill of materials (BOM) for roof covering, visualize tile counts per roof slope, and prepare for the physical generation of 3D tiles."
        },
        "parameters": [
          {
            "name": "sTileProduct",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific manufacturer and tile profile (e.g., 'Brahas;Monier') to be used for calculations. This loads the specific dimensions and waste allowances from the tile catalog.",
            "validRange": "Dependent on entries in 'hsbTileCatalog.xml'",
            "unit": "N/A (Selection)",
            "affectsOutput": "Determines which tile dimensions and waste factors are used for area calculation and quantity estimation. Alters the content of the generated schedule."
          },
          {
            "name": "sGroup",
            "technicalDefault": "",
            "businessMeaning": "Defines the BOM (Bill of Materials) grouping hierarchy for this schedule element.",
            "validRange": "String (Group path)",
            "unit": "N/A",
            "affectsOutput": "Organizes the resulting data in project reports or BOM exports; does not affect geometric calculation."
          },
          {
            "name": "dDeltaL",
            "technicalDefault": "0",
            "businessMeaning": "Offset or setback of the lath (batten) contour relative to the roof outline on the 'left' side. Used to exclude areas like fascia boards or large overhangs from the tiling calculation.",
            "validRange": "0.0 to 500.0",
            "unit": "mm",
            "affectsOutput": "Reduces the effective roof area calculated for tiles, potentially reducing the total quantity."
          },
          {
            "name": "dDeltaR",
            "technicalDefault": "0",
            "businessMeaning": "Offset or setback of the lath (batten) contour relative to the roof outline on the 'right' side. Used to exclude areas like fascia boards or large overhangs from the tiling calculation.",
            "validRange": "0.0 to 500.0",
            "unit": "mm",
            "affectsOutput": "Reduces the effective roof area calculated for tiles, potentially reducing the total quantity."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "Selects the CAD dimension style to be used for the text in the generated schedule table.",
            "validRange": "Existing Dimension Styles in the drawing",
            "unit": "N/A (Selection)",
            "affectsOutput": "Controls the font, height, and appearance of text in the graphical schedule."
          },
          {
            "name": "sAutoUpdate",
            "technicalDefault": "|No|",
            "businessMeaning": "Toggles whether the schedule automatically recalculates when the roof geometry changes.",
            "validRange": "|No|, |Yes|",
            "unit": "N/A",
            "affectsOutput": "If 'Yes', ensures data is always current but may slow down modeling. If 'No', improves performance but requires manual update via context menu to see changes."
          },
          {
            "name": "nColor",
            "technicalDefault": "252",
            "businessMeaning": "Sets the display color index for the lines and text of the generated schedule table.",
            "validRange": "1 to 255 (AutoCAD Color Index)",
            "unit": "Color Index",
            "affectsOutput": "Visual presentation of the schedule in the model space."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change in 'sTileProduct'",
            "effect": "Loads new dimension and waste data from 'hsbTileCatalog.xml'. Updates the internal maps 'mapTileArea' and 'mapTileRidge'.",
            "cascade": [
              "Calculated Quantities",
              "Schedule Data"
            ]
          },
          {
            "trigger": "Change in 'dDeltaL' or 'dDeltaR'",
            "effect": "Modifies the calculation boundary (PLine) used for the roof area.",
            "cascade": [
              "Tile Quantities"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Graphical Schedule (Table)",
            "description": "A 2D representation of the tile counts, article numbers, and waste factors drawn in Model Space at the insertion point.",
            "appliedTo": "None (Standalone entity in Model Space)"
          },
          {
            "type": "TSL Instances (Indirect)",
            "description": "Manages the creation, modification, and deletion of 'hsbTileSingle' and 'hsbTileEdge' instances which represent the physical 3D tiles.",
            "appliedTo": "ERoofPlane (associated)"
          }
        ]
      },
      "tokens_used": 10580,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"User launches script hsbTileMaster\",\n    \"Initial dialog/property palette appears (showDialog)\",\n    \"Command line prompt: Select roofplanes and (optional) TSL instances to delete\",\n    \"Entity Processing Loop: Separate roofplanes (to keep) from TSL instances (to delete)\",\n    \"Store valid ERoofPlane entities in internal Map (_Map)\",\n    \"Delete existing hsbTileMaster, hsbTileSingle, or hsbTileEdge instances if selected\",\n    \"Command line prompt: Insertion point of table\",\n    \"Store insertion point (_Pt0) in Map\",\n    \"Calculate Geometry: Extract CoordSys, Vectors, and Envelopes from selected roofplanes\",\n    \"Load Tile Data: Retrieve dimensions and waste factors from XML catalog based on Supplier/Product\",\n    \"Validate Data: Check if WMin and WMax values from XML are greater than 0\",\n    \"Calculate tile distribution and quantities for roof area and ridges\",\n    \"Draw Graphical Schedule: Generate table with Project Info, Tile List, and Roof Sketches in Model Space\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Type of entity selected during insertion\",\n      \"path1\": {\n        \"name\": \"ERoofPlane Selected\",\n        \"steps\": [\n          \"Entity is cast to ERoofPlane\",\n          \"Entity reference stored in _Map with key 'er' + index\",\n          \"Included in subsequent tile calculation\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"TSL Instance Selected\",\n        \"steps\": [\n          \"Entity is cast to TslInst\",\n          \"Script name is checked (case-insensitive) against 'HSBTILEMASTER', 'HSBTILESINGLE', 'HSBTILEEDGE'\",\n          \"Entity is permanently erased from drawing (dbErase)\",\n          \"Excluded from calculation\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Tile Catalog Data Validity (Post-Load)\",\n      \"path1\": {\n        \"name\": \"Valid Data\",\n        \"steps\": [\n          \"Proceed with tile area calculation\",\n          \"Generate and draw the schedule table\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Invalid Data (WMin <= 0 or WMax <= 0)\",\n        \"steps\": [\n          \"Schedule drawing is aborted\",\n          \"Error text 'Note: ... contains invalid values' is drawn at insertion point\",\n          \"Path to XML file is displayed\",\n          \"Script execution halts (return)\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Data Source for Tile Parameters\",\n      \"path1\": {\n        \"name\": \"Load from XML\",\n        \"steps\": [\n          \"Triggered on first run or if 'read catalog' context menu is used\",\n          \"Reads hsbTileCatalog.xml\",\n          \"Updates _Map with new mapTileArea and mapTileRidge\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Load from Internal Map\",\n        \"steps\": [\n          \"Triggered on standard Recalc/Update\",\n          \"Retrieves mapTileArea and mapTileRidge from saved _Map state\",\n          \"Faster performance as disk read is skipped\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Tile Catalog XML parameters (WMin and WMax)\",\n      \"errorMessage\": \"Note: [ScriptName] [Path to XML] contains invalid values. Please verify the parameters stored in this file.\",\n      \"recovery\": \"User must edit the hsbTileCatalog.xml file to ensure valid width values are present for the selected product, then use 'read catalog' context menu or update the instance.\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Update Schedule\",\n      \"how\": \"Context Menu -> |Update|\",\n      \"effect\": \"Forces a recalculation of the tile quantities and redraws the table. Also triggered automatically if 'Auto update' is set to Yes.\"\n    },\n    {\n      \"action\": \"Append Roofplanes\",\n      \"how\": \"Context Menu -> |append roofplanes|\",\n      \"effect\": \"Validates existing roofplanes in the list (removing deleted ones) and prompts user to select additional roofplanes to add to the current calculation.\"\n    },\n    {\n      \"action\": \"Reload Catalog Data\",\n      \"how\": \"Context Menu -> |read catalog|\",\n      \"effect\": \"Clears current internal map data and reloads dimensions and waste factors from the XML file. Necessary if XML was externally modified.\"\n    },\n    {\n      \"action\": \"Create Physical Tiles\",\n      \"how\": \"Context Menu -> |create Tiles|\",\n      \"effect\": \"Inserts 'hsbTileSingle' and 'hsbTileEdge' TSL instances into the drawing to physically represent the calculated tiles.\"\n    },\n    {\n      \"action\": \"Manage Physical Tiles\",\n      \"how\": \"Context Menu -> |Delete tiles| / |Add tiles| / |Modify tile|\",\n      \"effect\": \"Bulk deletes, adds, or modifies the physical TSL instances generated by the 'create Tiles' command.\"\n    },\n    {\n      \"action\": \"Change Tile Product\",\n      \"how\": \"OPM (Properties Palette) ->"
      },
      "tokens_used": 12894,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbTileMaster\n\n## Overview\nCalculates roof tile quantities, waste factors, and distribution based on selected roof planes and a tile catalog. It generates a graphical material schedule (table) in Model Space and provides options to create physical 3D tile elements.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The schedule is drawn and inserted into the 3D model. |\n| Paper Space | No | Not designed for use in Layouts. |\n| Shop Drawing | No | This is a detailing/planning tool, not a drawing generator. |\n\n## Prerequisites\n- **Required Entities**: `ERoofPlane` (Roof Planes) must exist in the model.\n- **Minimum Beam Count**: 0.\n- **Required Settings**: `hsbTileCatalog.xml` must be present in the `<hsbCompany>\\Abbund\\` directory.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbTileMaster.mcr` from the list.\n\n### Step 2: Select Roof Planes\n```\nCommand Line: Select roofplanes and (optional) tsl instances to delete\nAction: Click on the roof planes you wish to include in the calculation. You may also select existing tile instances (hsbTileSingle/hsbTileEdge) to delete and replace them. Press Enter to confirm.\n```\n\n### Step 3: Place Schedule\n```\nCommand Line: Insertion point of table\nAction: Click in the Model Space to define where the top-left corner of the schedule table should be placed.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Supplier / Product (`sTileProduct`) | dropdown | | Selects the manufacturer and tile profile (e.g., 'Brahas;Monier'). This loads dimensions and waste data from the catalog. |\n| Auto group analysis BOM (`sGroup`) | text | | Defines the grouping hierarchy for the Bill of Materials (use `\\` to separate levels). |\n| Offset left (`dDeltaL`) | number | 0 | Setback distance (in mm) from the left roof outline to the lath contour. Used to exclude fascia/overhangs. |\n| Offset right (`dDeltaR`) | number | 0 | Setback distance (in mm) from the right roof outline to the lath contour. |\n| Dimstyle (`sDimStyle`) | dropdown | | Selects the dimension style to control the text appearance in the schedule. |\n| Auto update after changes (`sAutoUpdate`) | dropdown | \\|No\\| | If set to \\|Yes\\|, the schedule recalculates automatically on geometry changes. If \\|No\\|, performance increases but requires manual updates. |\n| Color (`nColor`) | number | 252 | The AutoCAD color index for the schedule lines and text. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| \\|Update\\| | Recalculates all tile quantities and redraws the schedule table. |\n| \\|append roofplanes\\| | Adds new roof planes to the existing calculation without deleting the current setup. |\n| \\|create Tiles\\| | Generates the physical 3D tile elements (hsbTileSingle/hsbTileEdge) on the roof. |\n| \\|Delete tiles\\| | Removes all generated 3D tile elements associated with this schedule. |\n| \\|Add tiles\\| | Adds tile elements based on current settings to the roof. |\n| \\|Modify tile\\| | Updates existing tile elements to match current parameters. |\n| \\|append roof edge\\| | Adds roof edges to the calculation context. |\n| \\|read catalog\\| | Reloads the tile data from `hsbTileCatalog.xml`. Use this if you manually edited the XML file. |\n\n## Settings Files\n- **Filename**: `hsbTileCatalog.xml`\n- **Location**: `<hsbCompany>\\Abbund\\`\n- **Purpose**: Contains definitions for tile profiles, including dimensions (widths), waste factors, and article numbers for both area tiles and ridge/hip tiles.\n\n## Tips\n- **Performance**: For large projects, set **Auto update after changes** to `|No|` to prevent lag while modeling. Update manually via the right-click menu when needed.\n- **Offsets**: Use the **Offset left** and **Offset right** properties to precisely define the tiling area, excluding large overhangs or specific architectural features.\n- **Error Handling**: If the schedule displays an error about \"invalid values,\" check your `hsbTileCatalog.xml` to ensure the `WMin` and `WMax` values for the selected product are greater than 0.\n\n## FAQ\n- **Q: The schedule table is empty or shows an error about invalid values.**\n  **A:** The script detected missing or corrupt data in `hsbTileCatalog.xml`. Ensure the selected product has valid width parameters defined in the XML file, then right-click and select `|read catalog|`.\n\n- **Q: How do I visualize the actual tiles in 3D?**\n  **A:** After generating the schedule, right-click the instance and choose `|create Tiles|`. This will place the physical `hsbTileSingle` and `hsbTileEdge` elements on the roof planes.\n\n- **Q: Can I add more roof planes later?**\n  **A:** Yes. Right-click the schedule instance and select `|append roofplanes|`. You can then select additional planes to add to the calculation."
      },
      "tokens_used": 7649,
      "error": null
    }
  }
}