{
  "filename": "HSB_T-SetBeamUcs.mcr",
  "status": "completed",
  "total_tokens": 26752,
  "processing_time": 299.250607252121,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "Description",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "14-01-2019",
            "author": "RP",
            "changes": "Pilot version."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4640,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No sd_ or Multipage prefix, no #Type E declaration, and no _Viewport usage. The script uses standard getPoint prompts and manipulates Beam entities directly, indicating a 3D modeling environment."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space with existing Beams.",
          "requiredSettings": []
        }
      },
      "tokens_used": 1896,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity.go",
              "promptOriginal": "|Select beam(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select base point|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "|Select point for X-axis|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 4,
              "function": "getString",
              "promptOriginal": "|<Enter> to select point for Y-Axis| |<Z> to select Z-axis|",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 5,
              "function": "getPoint",
              "promptOriginal": "|Select point for Y-axis|",
              "condition": "_bOnInsert (if Step 4 is empty)",
              "required": false
            },
            {
              "step": 6,
              "function": "getPoint",
              "promptOriginal": "|Select point for Z-axis|",
              "condition": "_bOnInsert (if Step 4 is 'Z')",
              "required": false
            }
          ],
          "keywordOptions": [
            {
              "prompt": "|<Enter> to select point for Y-Axis| |<Z> to select Z-axis|",
              "options": [
                "<Enter>",
                "<Z>"
              ]
            }
          ]
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3010,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Re-defines the local coordinate system (UCS) orientation of selected beams based on three points picked in 3D space.\",\n    \"category\": \"Geometry Modification\",\n    \"typicalUseCase\": \"Correcting the orientation of imported beams or beams modeled with incorrect local axes (e.g., ensuring the 'Top' face is correctly identified for machining or material mapping).\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"ents (Beam Selection)\",\n      \"technicalDefault\": \"None\",\n      \"businessMeaning\": \"The target structural beam(s) that require reorientation.\",\n      \"validRange\": \"Existing Beam entities in Model Space\",\n      \"unit\": \"Entity\",\n      \"affectsOutput\": \"Determines which beams are deleted and replaced with reoriented versions.\"\n    },\n    {\n      \"name\": \"Origin (_Pt0)\",\n      \"technicalDefault\": \"User Defined Point\",\n      \"businessMeaning\": \"The spatial reference point (0,0,0) for the beam's new local coordinate system.\",\n      \"validRange\": \"Any 3D coordinate in Model Space\",\n      \"unit\": \"Coordinates (x,y,z)\",\n      \"affectsOutput\": \"Sets the insertion point or origin reference for the beam's internal coordinate system.\"\n    },\n    {\n      \"name\": \"Xaxis (Point)\",\n      \"technicalDefault\": \"User Defined Point\",\n      \"businessMeaning\": \"A point defining the direction of the beam's length (Local X-Axis).\",\n      \"validRange\": \"Any 3D coordinate not coincident with Origin\",\n      \"unit\": \"Coordinates (x,y,z)\",\n      \"affectsOutput\": \"Aligns the longitudinal axis of the beam.\"\n    },\n    {\n      \"name\": \"Yaxis (Point)\",\n      \"technicalDefault\": \"User Defined Point\",\n      \"businessMeaning\": \"A point defining the direction of the beam's cross-section (Local Y-Axis), often the 'face' or 'depth' side.\",\n      \"validRange\": \"Any 3D coordinate not collinear with Origin-Xaxis\",\n      \"unit\": \"Coordinates (x,y,z)\",\n      \"affectsOutput\": \"Sets the rotation of the beam profile around the X-axis; the Z-axis is calculated automatically.\"\n    },\n    {\n      \"name\": \"Zaxis (Point)\",\n      \"technicalDefault\": \"User Defined Point\",\n      \"businessMeaning\": \"A point defining the 'Top' or 'Width' direction (Local Z-Axis), typically used when defining vertical orientation.\",\n      \"validRange\": \"Any 3D coordinate not collinear with Origin-Xaxis\",\n      \"unit\": \"Coordinates (x,y,z)\",\n      \"affectsOutput\": \"Sets the rotation of the beam profile; the Y-axis is calculated automatically.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"Selection of X-axis point\",\n      \"effect\": \"Establishes the primary direction vector.\",\n      \"cascade\": []\n    },\n    {\n      \"trigger\": \"User selects Y-axis point\",\n      \"effect\": \"Calculates Z-axis automatically using Right-Hand Rule (X cross Y).\",\n      \"cascade\": [\"Zaxis\"]\n    },\n    {\n      \"trigger\": \"User selects Z-axis point (via <Z> keyword)\",\n      \"effect\": \"Calculates Y"
      },
      "tokens_used": 6282,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script (HSB_T-SetBeamUcs)",
          "2. Prompt: Select beam(s) to modify (PrEntity selection).",
          "3. Prompt: Select base point (Origin of new UCS).",
          "4. Prompt: Select point for X-axis (defines beam length direction).",
          "5. Prompt: Decision - Press <Enter> to pick Y-axis OR type <Z> to pick Z-axis.",
          "6. Branch: If <Enter>, prompt: Select point for Y-axis.",
          "7. Branch: If <Z>, prompt: Select point for Z-axis.",
          "8. System: Retrieves stored points from Map.",
          "9. System: Iterates through selected beams.",
          "10. Logic: Calculates coordinate vectors (X, Y, Z).",
          "11. System: Creates new Beam entity using original body but new coordinate system.",
          "12. System: Copies attributes (Code, Layer, Material, etc.) from old beam to new beam.",
          "13. System: Deletes original beam.",
          "14. System: Erases script instance from model.",
          "15. End."
        ],
        "conditionalBranches": [
          {
            "condition": "User choice at Axis Definition prompt (Step 5)",
            "path1": {
              "name": "Define Y-Axis (Default)",
              "trigger": "User presses <Enter>",
              "steps": [
                "Prompt: Select point for Y-axis",
                "Script stores 'Yaxis' in Map",
                "Z-axis is calculated automatically (X cross Y)"
              ]
            },
            "path2": {
              "name": "Define Z-Axis",
              "trigger": "User types <Z> (or any non-empty string)",
              "steps": [
                "Prompt: Select point for Z-axis",
                "Script stores 'Zaxis' in Map",
                "Y-axis is calculated automatically (X cross Z)"
              ]
            }
          },
          {
            "condition": "Post-Calculation Validation",
            "path1": {
              "name": "Valid Axis Data",
              "trigger": "Map contains 'Yaxis' OR 'Zaxis'",
              "steps": [
                "Execute beam recreation",
                "Delete original beam"
              ]
            },
            "path2": {
              "name": "Invalid Axis Data",
              "trigger": "Map contains neither 'Yaxis' nor 'Zaxis'",
              "steps": [
                "Erase script instance",
                "Abort operation without modifying beams"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Presence of Axis Points",
            "errorMessage": "(None - script aborts silently)",
            "recovery": "User must re-run the script and ensure they select a point for the Y or Z axis."
          },
          {
            "check": "Entity Selection",
            "errorMessage": "(None - implicit)",
            "recovery": "If no beams are selected, the loop (beams.length) is 0, and no changes are made, though the instance may still be erased."
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 5674,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_T-SetBeamUcs.mcr\n\n## Overview\nThis script re-defines the local coordinate system (UCS) orientation of selected beams based on three points picked in 3D space. It is typically used to correct the orientation of imported beams or to ensure the correct local faces (Top/Side) are aligned for machining and material mapping.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in 3D Model Space. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required entities**: At least one existing Beam.\n- **Minimum beam count**: 1.\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_T-SetBeamUcs.mcr`\n\n### Step 2: Select Beams\n```\nCommand Line: Select beam(s)\nAction: Click on the beam(s) you wish to reorient and press Enter.\n```\n\n### Step 3: Define Origin\n```\nCommand Line: Select base point\nAction: Pick a point in 3D space to serve as the Origin (0,0,0) for the new local system.\nNote: This defines the reference point for the axes calculation.\n```\n\n### Step 4: Define X-Axis\n```\nCommand Line: Select point for X-axis\nAction: Pick a second point. The vector from the Origin to this point defines the new Local X-Axis (usually the length direction).\n```\n\n### Step 5: Choose Axis Definition Method\n```\nCommand Line: <Enter> to select point for Y-Axis | <Z> to select Z-axis\nAction: Make a choice on the command line:\n- Press Enter to define the Y-Axis (Cross-section/Depth).\n- Type Z and press Enter to define the Z-Axis (Top/Width).\n```\n\n### Step 6A: Define Y-Axis (If you pressed Enter)\n```\nCommand Line: Select point for Y-axis\nAction: Pick a point. This defines the Local Y-Axis. The Z-Axis will be calculated automatically.\n```\n\n### Step 6B: Define Z-Axis (If you typed Z)\n```\nCommand Line: Select point for Z-axis\nAction: Pick a point. This defines the Local Z-Axis. The Y-Axis will be calculated automatically.\n```\n\n### Step 7: Completion\nThe script will automatically replace the original beams with new entities having the calculated orientation. The script instance then erases itself.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| N/A | N/A | N/A | This script does not expose any parameters to the Properties Palette. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| N/A | This script has no custom context menu options. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Reorientation vs. Movement**: This script changes the *orientation* of the beam's local axes (rolling/pitching the profile) rather than moving the beam in world space.\n- **Defining \"Top\"**: If you specifically need to tell the system which face is the \"Top\" face, use the **<Z>** option in Step 5. This is common for correcting beams where the top is rotated 90 degrees.\n- **Right-Hand Rule**: The script calculates the third axis automatically using the Right-Hand Rule.\n- **Entity Replacement**: The script technically deletes the old beam and creates a new one. Ensure your update/rename rules are active if you rely on specific element names persisting.\n\n## FAQ\n- **Q: Why did my beam change names or lose specific data?**\n  **A:** The script works by deleting the original beam and creating a new one with the correct orientation. Most standard attributes (Material, Layer) are copied, but custom internal links or IDs might need to be reassigned depending on your hsbCAD configuration.\n- **Q: Can I use this to straighten a crooked beam?**\n  **A:** No. This script changes the local coordinate system (rotation of the cross-section), not the geometry (centerline) of the beam.\n- **Q: What happens if I only select one point for the X-axis?**\n  **A:** The script requires a valid definition of at least two axes to calculate the orientation. If the process is aborted before the Y or Z axis is defined, no changes will be made."
      },
      "tokens_used": 5250,
      "error": null
    }
  }
}