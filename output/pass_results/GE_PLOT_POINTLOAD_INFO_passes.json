{
  "filename": "GE_PLOT_POINTLOAD_INFO.mcr",
  "status": "completed",
  "total_tokens": 37247,
  "processing_time": 472.3774585723877,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 6526,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script utilizes getPoint() and getEntity() for insertion directly into the model. It creates a Display object and draws geometry (lines, text, hatch) based on coordinate vectors (_XW, _YW, _ZW) relative to the selected ElementWall or TrussEntity. It uses dp.showInDispRep('Wall Layout Items'). There are no references to _Viewport, _kPaperSpace, or sd_ prefixes."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall",
            "TrussEntity"
          ],
          "minimumBeams": 0,
          "requiredSpace": "AutoCAD Model Space",
          "requiredSettings": [
            "_DimStyles catalog"
          ]
        }
      },
      "tokens_used": 4249,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getEntity",
              "promptOriginal": "|Select wall or truss|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nBeams",
            "type": "PropInt",
            "displayName": "|Beams|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nFloorToFloorStraps",
            "type": "PropInt",
            "displayName": "|Floor to floor straps|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dFloorToFloorStrapLength",
            "type": "PropDouble",
            "displayName": "|Strap length|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sFloorToFloorStrapForcedToCS16",
            "type": "PropString",
            "displayName": "|Strap forced to CS16|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sHoldDown",
            "type": "PropString",
            "displayName": "|Hold down|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sConnectionAtTruss",
            "type": "PropString",
            "displayName": "|Connection at truss|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "nConnectionsAtTruss",
            "type": "PropInt",
            "displayName": "|Number of metal parts for connection at truss|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sDimstyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "|Color|",
            "defaultValue": "2",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6453,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a 2D graphical annotation in the model to indicate point loads, reinforcement requirements (studs, straps), or hardware connections (hold-downs) at specific locations on walls or trusses.",
          "category": "Annotation/Layout",
          "typicalUseCase": "Used during layout design or engineering to visually mark locations where a wall requires extra studs for point loads, or where specific metal hardware (straps, hold-downs, truss hangers) is required, ensuring these details appear on wall layout drawings."
        },
        "parameters": [
          {
            "name": "nBeams",
            "technicalDefault": "0",
            "businessMeaning": "Specifies the number of studs required at the marked location to support a point load.",
            "validRange": "0 - 10",
            "unit": "count",
            "affectsOutput": "Displays 'X STUDS' in the top half of the annotation box if > 0."
          },
          {
            "name": "nFloorToFloorStraps",
            "technicalDefault": "0",
            "businessMeaning": "Specifies the quantity of floor-to-floor tension straps required at this location.",
            "validRange": "0 - 10",
            "unit": "count",
            "affectsOutput": "Displays the strap quantity and type code in the bottom half of the annotation box if > 0. Overrides the Hold Down text."
          },
          {
            "name": "dFloorToFloorStrapLength",
            "technicalDefault": "0",
            "businessMeaning": "Defines the physical length of the floor-to-floor strap needed.",
            "validRange": "0 - 3000",
            "unit": "mm",
            "affectsOutput": "Appends the length value to the strap text code (e.g., 'MSTA1200')."
          },
          {
            "name": "sFloorToFloorStrapForcedToCS16",
            "technicalDefault": "|No|",
            "businessMeaning": "Determines the specific hardware type/standard for the strap. Selecting 'Yes' forces the designation to CS16, otherwise defaults to MSTA.",
            "validRange": "|No|, |Yes|",
            "unit": "enum",
            "affectsOutput": "Switches the text prefix between 'MSTA' (No) and 'CS16-' (Yes)."
          },
          {
            "name": "sHoldDown",
            "technicalDefault": "",
            "businessMeaning": "Text description or code for the hold-down hardware (e.g., 'HD5A', 'Simpson H1').",
            "validRange": "String (Part codes)",
            "unit": "text",
            "affectsOutput": "Displays this text in the bottom half of the annotation box, provided floor-to-floor strap count is 0."
          },
          {
            "name": "sConnectionAtTruss",
            "technicalDefault": "",
            "businessMeaning": "Text description of the metal connecting hardware at the truss location (e.g., 'H2.5A', 'MSTC48').",
            "validRange": "String (Part codes)",
            "unit": "text",
            "affectsOutput": "Displays this text alongside the quantity next to the truss pointer arrow."
          },
          {
            "name": "nConnectionsAtTruss",
            "technicalDefault": "0",
            "businessMeaning": "Number of metal parts required for the truss connection.",
            "validRange": "0 - 5",
            "unit": "count",
            "affectsOutput": "Prepends the count to the connection text (e.g., '2 H2.5A')."
          },
          {
            "name": "sDimstyle",
            "technicalDefault": "",
            "businessMeaning": "Selects the CAD dimension style to control text height and font for the annotation.",
            "validRange": "Available DimStyles in catalog",
            "unit": "style",
            "affectsOutput": "Resizes the text box and text height to match the chosen style."
          },
          {
            "name": "nColor",
            "technicalDefault": "2",
            "businessMeaning": "Sets the display color of the annotation (lines, text, and arrow fill).",
            "validRange": "0 - 255 (AutoCAD Color Index)",
            "unit": "color index",
            "affectsOutput": "Changes the visual color of the generated annotation geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "nBeams, nFloorToFloorStraps, and sHoldDown are all default/empty",
            "effect": "The script erases the annotation instance as there is nothing to display.",
            "cascade": []
          },
          {
            "trigger": "nFloorToFloorStraps > 0",
            "effect": "Displays Strap info in the bottom box and hides the Hold Down info, even if 'sHoldDown' has a value.",
            "cascade": [
              "sHoldDown"
            ]
          },
          {
            "trigger": "nFloorToFloorStraps == 0",
            "effect": "Hides Strap info and allows Hold Down text to display in the bottom box.",
            "cascade": [
              "dFloorToFloorStrapLength",
              "sFloorToFloorStrapForcedToCS16"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Display Object (Annotation)",
            "description": "Generates 2D geometry including a pointer line, a rectangle (for walls) or filled arrow (for trusses), and text labels. It does not create physical timber or metal parts.",
            "appliedTo": "Wall Layout Items (Visual representation only)"
          }
        ]
      },
      "tokens_used": 7159,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched via insertion command",
          "Check Insertion Cycle (Pass 1 vs Pass 2)",
          "[Pass 2] Prompt user for insertion point (_Pt0) via getPoint()",
          "[Pass 2] Prompt user to select Wall or Truss entity via getEntity()",
          "[Pass 2] Store property values to catalog '_LastInserted' and return",
          "[Pass 3 onwards] Retrieve attached Entity from _Entity list",
          "Verify if Entity is an ElementWall or TrussEntity",
          "Determine Wall Path or Truss Path based on Entity type",
          "[Wall Path] Validate content (Beams, Straps, or HoldDown required)",
          "[Wall Path] Calculate Grip Point relative to coordinate system",
          "[Wall Path] Generate Geometry (Pointer line, Rectangle, Text)",
          "[Truss Path] Calculate Grip Point relative to coordinate system",
          "[Truss Path] Generate Geometry (Pointer line, Solid Arrow, Text)",
          "Generate Display Object in 'Wall Layout Items' representation"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Check",
            "path1": {
              "name": "Cycle > 1 (Copy/Paste/etc.)",
              "steps": [
                "Erase Instance immediately",
                "Return"
              ]
            },
            "path2": {
              "name": "Cycle 1 (Initial Insertion)",
              "steps": [
                "Prompt for Point",
                "Prompt for Entity",
                "Save Catalog",
                "Return"
              ]
            }
          },
          {
            "condition": "Entity Type Detection",
            "path1": {
              "name": "ElementWall Detected",
              "steps": [
                "Cast to ElementWall",
                "Enable Wall Logic Branch",
                "Check for Erasure Condition (Empty props)"
              ]
            },
            "path2": {
              "name": "TrussEntity Detected",
              "steps": [
                "Cast to TrussEntity",
                "Enable Truss Logic Branch",
                "Render Truss Arrow and Connection Text"
              ]
            }
          },
          {
            "condition": "Wall Content Display (Bottom Rectangle)",
            "path1": {
              "name": "Straps Active",
              "steps": [
                "Check nFloorToFloorStraps > 0",
                "Format Strap Code (MSTA vs CS16)",
                "Draw Strap Text",
                "Ignore HoldDown property"
              ]
            },
            "path2": {
              "name": "No Straps",
              "steps": [
                "Check nFloorToFloorStraps == 0",
                "Draw sHoldDown Text if not empty"
              ]
            }
          },
          {
            "condition": "Strap Type Selection",
            "path1": {
              "name": "Standard Strap",
              "steps": [
                "Check sFloorToFloorStrapForcedToCS16 == No",
                "Prefix text with ' MSTA'"
              ]
            },
            "path2": {
              "name": "CS16 Forced",
              "steps": [
                "Check sFloorToFloorStrapForcedToCS16 == Yes",
                "Prefix text with ' CS16-'"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Selection (Post-Insert)",
            "errorMessage": "None (Silent failure)",
            "recovery": "If _Entity is empty or not a Wall/Truss, the script executes eraseInstance(). User must ensure the correct wall or truss is selected during insertion."
          },
          {
            "check": "Wall Property Content",
            "errorMessage": "None (Silent failure)",
            "recovery": "If nBeams=0, nFloorToFloorStraps=0, and sHoldDown is empty, the script executes eraseInstance(). User must input values in the Properties Palette to make the annotation visible."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Annotation Properties",
            "how": "OPM (AutoCAD Properties Palette)",
            "effect": "Changing nBeams, nFloorToFloorStraps, or HoldDown text immediately updates the geometry. Setting all to empty erases the instance."
          },
          {
            "action": "Change Dimension Style",
            "how": "OPM (Property 'Dimstyle')",
            "effect": "Recalculates text height and rectangle width to match the selected style."
          },
          {
            "action": "Change Display Color",
            "how": "OPM (Property 'Color')",
            "effect": "Updates the color index of the Display object."
          },
          {
            "action": "Grip Edit",
            "how": "Grip Point (_PtG)",
            "effect": "The script sets a grip point. Moving this grip likely updates the base position of the annotation geometry relative to the wall/truss."
          }
        ]
      },
      "tokens_used": 6778,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_PLOT_POINTLOAD_INFO\n\n## Overview\nThis script creates a 2D graphical annotation in Model Space to indicate point loads, reinforcement requirements (studs, straps), or hardware connections (hold-downs) at specific locations on walls or trusses. It is typically used during layout design to visually mark where engineering details are required.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates directly in the 3D model to create 2D layout annotations. |\n| Paper Space | No | Not designed for Paper Space viewport insertion. |\n| Shop Drawing | No | This is a layout/modeling tool, not a manufacturing output script. |\n\n## Prerequisites\n- **Required Entities**: An `ElementWall` or `TrussEntity` must exist in the model to attach the annotation to.\n- **Minimum Beam Count**: 0 (Not applicable).\n- **Required Settings**: The `_DimStyles` catalog must be available in the project to control text sizing.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_PLOT_POINTLOAD_INFO.mcr` from the file browser.\n\n### Step 2: Specify Location\n```\nCommand Line: [No prompt displayed]\nAction: Click in the drawing to specify the insertion point for the annotation marker.\n```\n\n### Step 3: Select Structural Element\n```\nCommand Line: |Select wall or truss|\nAction: Click on the desired Wall or Truss entity that the point load or connection applies to.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Beams | number | 0 | Number of studs required at this location (e.g., type \"3\" for \"3 STUDS\"). |\n| Floor to floor straps | number | 0 | Quantity of floor-to-floor tension straps required. |\n| Strap length | number | 0 | Physical length of the strap in millimeters (e.g., 1200). |\n| Strap forced to CS16 | dropdown | |No| | Select \"|Yes|\" to force the designation to CS16 standard; otherwise, it defaults to MSTA. |\n| Hold down | text | | Part code or description for hold-down hardware (e.g., \"HD5A\"). This is hidden if Floor to floor straps > 0. |\n| Connection at truss | text | | Part code for metal connecting hardware at the truss (e.g., \"H2.5A\"). |\n| Number of metal parts for connection at truss | number | 0 | Quantity of metal parts for the truss connection. |\n| Dimstyle | dropdown | | Selects the dimension style to control text height and font for the annotation. |\n| Color | number | 2 | Sets the AutoCAD color index for the annotation lines and text. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add custom items to the right-click context menu. |\n\n## Settings Files\n- **Filename**: None specific (Script relies on system catalogs).\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Visibility**: If the annotation disappears after insertion, check the Properties palette. If \"Beams\", \"Floor to floor straps\", and \"Hold down\" are all set to 0 or empty, the script erases itself automatically.\n- **Straps vs. Hold Downs**: The script prioritizes Strap information. If you enter a value for \"Floor to floor straps\", the \"Hold down\" field will be ignored in the display.\n- **Text Sizing**: To adjust the size of the annotation box and text, change the \"Dimstyle\" property in the palette rather than manually scaling the object.\n- **Grip Editing**: You can click the grip point on the annotation to move it relative to the wall or truss it is attached to.\n\n## FAQ\n- **Q: Why did the annotation disappear immediately after I selected the wall?**\n  A: This happens if the default properties are all zero/empty and the script detects nothing to display. Select the object (or re-insert) and use the Properties Palette (Ctrl+1) to enter values for \"Beams\", \"Straps\", or \"Hold down\".\n- **Q: Can I use this on a beam?**\n  A: No, this script is designed specifically to attach to `ElementWall` or `TrussEntity` types.\n- **Q: How do I display a specific strap code like CS16-1200?**\n  A: Set \"Floor to floor straps\" to at least 1, set \"Strap length\" to 1200, and change \"Strap forced to CS16\" to \"|Yes|\"."
      },
      "tokens_used": 6082,
      "error": null
    }
  }
}