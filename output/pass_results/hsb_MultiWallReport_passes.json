{
  "filename": "hsb_MultiWallReport.mcr",
  "status": "completed",
  "total_tokens": 21274,
  "processing_time": 179.71830916404724,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "22.08.2012",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "First version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3472,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No 'sd_' or 'Multipage' prefix, no '#Type E' declaration, and no usage of '_Viewport'. The script uses PrEntity to select 'Element' entities from the model and creates a 'Display dp(-1)' which draws on screen, typically in the model context."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Elements with 'hsb_Multiwall' sub-maps.",
          "requiredSettings": []
        }
      },
      "tokens_used": 1619,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one or More Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3802,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates an on-screen visual report that maps individual Element numbers to their parent MultiWall group IDs found within the selected elements.",
          "category": "Reporting/Verification",
          "typicalUseCase": "Used by a detailer to verify the composition of specific MultiWall groupings (e.g., checking which shop drawings belong to 'MW-01') directly in the CAD model before export or manufacturing."
        },
        "parameters": [
          {
            "name": "ssE",
            "technicalDefault": "Element()",
            "businessMeaning": "The selection set of timber wall elements (Elements) to be analyzed for MultiWall grouping data.",
            "validRange": "1 or more Elements containing 'hsb_Multiwall' data",
            "unit": "Count (Entities)",
            "affectsOutput": "Determines the content of the report. Only elements that possess the 'hsb_Multiwall' sub-map with a 'Number' attribute will generate a line item in the output display."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Selection of Elements (ssE)",
            "effect": "Reads the 'hsb_Multiwall' sub-map from each selected Element.",
            "cascade": [
              "sMultiwalls",
              "sSingleElements"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Visual Display (Text)",
            "description": "A text-based table drawn in ModelSpace using the Display class. Column 1 lists the MultiWall Number, Column 2 lists the concatenated Element Numbers (separated by ' - ') that belong to that MultiWall.",
            "appliedTo": "ModelSpace (drawn relative to script insertion point _Pt0)"
          }
        ]
      },
      "tokens_used": 4150,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User launches script (hsb_MultiWallReport.mcr) from CAD command line.",
          "2. System checks insertion state: _bOnInsert is true.",
          "3. System checks if insertCycleCount() > 1 (preventing duplicate execution loops).",
          "4. [Condition] If insert cycle > 1, script erases current instance and terminates (return).",
          "5. [Condition] If insert cycle is 1, system executes PrEntity prompt.",
          "6. User selects one or more 'Element' entities from the model.",
          "7. System stores selected elements into the internal _Element list.",
          "8. Script insertion phase ends (return), triggering the recalculation phase.",
          "9. System initializes arrays (elNumber, mwNumber, nSequence) to store extracted data.",
          "10. System iterates through the _Element list.",
          "11. For each element, system attempts to retrieve the 'hsb_Multiwall' sub-map.",
          "12. [Condition] If map exists and contains 'Number': Element Number, MultiWall Number, and Sequence are stored in arrays.",
          "13. [Condition] If map or 'Number' is missing: Element is skipped (ignored).",
          "14. System initializes reporting arrays (sMultiwalls, sSingleElements).",
          "15. System iterates through collected data to group elements by MultiWall Number.",
          "16. [Condition] If MultiWall Number already exists in sMultiwalls: System locates index and appends current Element Number to the corresponding string (separated by ' - ').",
          "17. [Condition] If MultiWall Number is new: System appends MultiWall Number to sMultiwalls and Element Number to sSingleElements.",
          "18. System initializes Display(-1) for on-screen drawing.",
          "19. System iterates through grouped data to generate the visual report.",
          "20. System draws MultiWall Number in Column 1.",
          "21. System draws a separator '|'.",
          "22. System draws concatenated Element Numbers in Column 2.",
          "23. Script execution completes."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count Check (Duplicate Run Prevention)",
            "path1": {
              "name": "Repeat Run Detected",
              "steps": [
                "Check if insertCycleCount() > 1",
                "Execute eraseInstance()",
                "Return (Terminate Script)"
              ]
            },
            "path2": {
              "name": "Fresh Insertion",
              "steps": [
                "Proceed to PrEntity Prompt",
                "Wait for User Selection"
              ]
            }
          },
          {
            "condition": "Sub-map Data Validity",
            "path1": {
              "name": "Valid Data Found",
              "steps": [
                "Access subMapX('hsb_Multiwall')",
                "Verify mp.hasString('Number')",
                "Populate elNumber, mwNumber, nSequence arrays"
              ]
            },
            "path2": {
              "name": "Invalid/Missing Data",
              "steps": [
                "Map returns empty or 'Number' missing",
                "Skip current iteration",
                "Proceed to next Element"
              ]
            }
          },
          {
            "condition": "MultiWall Grouping Logic",
            "path1": {
              "name": "Existing Group",
              "steps": [
                "Find existing MultiWall Number index in sMultiwalls",
                "Append Element Number to existing string in sSingleElements[index] with ' - ' separator"
              ]
            },
            "path2": {
              "name": "New Group",
              "steps": [
                "Append new MultiWall Number to sMultiwalls",
                "Append current Element Number to sSingleElements"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "User selects at least one Element.",
            "errorMessage": "None (Script exits silently if no selection is made or user cancels).",
            "recovery": "User must run the script again and ensure a selection is made."
          },
          {
            "check": "Selected Elements contain 'hsb_Multiwall' sub-map with 'Number' attribute.",
            "errorMessage": "None (Elements without data are skipped, resulting in no output for them).",
            "recovery": "User must verify Element properties contain the required hsb_Multiwall data."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Report Data",
            "how": "No native update mechanism available. User must erase and re-insert script.",
            "effect": "Regenerates report based on current model state and Element properties."
          },
          {
            "action": "Move Report",
            "how": "Standard CAD Move command or Grip edit.",
            "effect": "Relocates the visual text output relative to the insertion point."
          }
        ]
      },
      "tokens_used": 3923,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_MultiWallReport.mcr\n\n## Overview\nThis script generates a visual on-screen report that maps individual Element numbers to their parent MultiWall group IDs. It is used to verify which shop drawings or wall elements belong to specific MultiWall configurations directly within the CAD model.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be run in the model space where Elements are located. |\n| Paper Space | No | Not supported for Paper Space usage. |\n| Shop Drawing | No | This is a model-level reporting script, not a shop drawing annotation. |\n\n## Prerequisites\n- **Required Entities**: One or more `Element` entities (typically walls).\n- **Data Requirement**: Selected Elements must contain the `hsb_Multiwall` sub-map with a valid 'Number' attribute. Elements without this data will be skipped.\n- **Minimum Beam Count**: N/A (Script operates on Elements, not individual beams).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse to the location of `hsb_MultiWallReport.mcr`, select the file, and click **Open**.\n\n### Step 2: Select Elements\n```\nCommand Line: Select one or More Elements\nAction: Click on the timber wall Elements you wish to analyze.\n```\nAction: After selecting the desired Elements, press **Enter** or right-click to confirm selection.\n\n### Step 3: View Report\nThe script will immediately generate a text table at your cursor location (or the script's insertion point).\n- **Column 1**: Displays the MultiWall Number.\n- **Column 2**: Displays the Element Numbers that belong to that MultiWall group.\n\n## Properties Panel Parameters\nNone. This script does not expose editable parameters in the Properties Palette.\n\n## Right-Click Menu Options\nNone. The script does not add specific commands to the entity context menu.\n\n## Settings Files\n- **Filename**: N/A\n- **Location**: N/A\n- **Purpose**: No external settings files are required for this script.\n\n## Tips\n- **Moving the Report**: The report text behaves like standard CAD text. You can select it and use the **Move** command or drag the grip point to relocate it for better visibility.\n- **Updating Data**: The report is a static snapshot of the data at the time of insertion. If you modify Element properties or MultiWall groupings, you must delete the existing report and run the script again to see the updated information.\n- **Data Verification**: If the report appears empty for selected elements, check if those elements actually have the `hsb_Multiwall` data assigned to them.\n\n## FAQ\n- **Q: Why did the script not display any text for some of the walls I selected?**\n  A: The script only lists Elements that have valid `hsb_Multiwall` data. If an Element was selected but does not belong to a MultiWall group or is missing the specific data attribute, it will be ignored.\n\n- **Q: How do I refresh the report after changing wall assignments?**\n  A: You must erase the current text report instance and insert the script again. The report does not automatically update when model changes occur.\n\n- **Q: Can I use this in a layout view?**\n  A: No, this script is designed to read entity data from Model Space only."
      },
      "tokens_used": 4308,
      "error": null
    }
  }
}