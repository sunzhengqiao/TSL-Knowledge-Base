{
  "filename": "SplitBeamByType.mcr",
  "status": "completed",
  "total_tokens": 57482,
  "processing_time": 280.92771673202515,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.5",
            "date": "20/05/2025",
            "author": "Marsel Nakuci",
            "changes": "HSB-23423: use body without extrusion to avoid extra static beamcuts when creating from body"
          },
          {
            "version": "1.4",
            "date": "06.02.2025",
            "author": "Marsel Nakuci",
            "changes": "HSB-23423: Fix extra static tool at female beam"
          },
          {
            "version": "1.3",
            "date": "30.06.2023",
            "author": "Marsel Nakuci",
            "changes": "HSB-19243: on insert, shorten the list of beam types by only showing types of existing beams"
          },
          {
            "version": "1.2",
            "date": "19.04.2023",
            "author": "Marsel Nakuci",
            "changes": "HSB-18227: Fix when getting properties on mapio"
          },
          {
            "version": "1.1",
            "date": "19.04.2023",
            "author": "Marsel Nakuci",
            "changes": "HSB-18227: Support 8 type definitions"
          },
          {
            "version": "1.0",
            "date": "17.04.2023",
            "author": "Marsel Nakuci",
            "changes": "HSB-18227: Initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8933,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly uses _kModelSpace in Group().collectEntities() calls (e.g., `entsQty = Group().collectEntities(true, Beam(), _kModelSpace);`). It performs 3D geometric operations like `envelopeBody`, `intersectWith`, and `decomposeIntoLumps` on Beams. No ShopDrawing patterns (sd_ prefix, _Viewport, #Type E) found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 7142,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getGenBeam\",\n        \"promptOriginal\": \"|Select beam|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sTypePriority1\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Type 1|\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": [\"<Dynamic Beam Types>\", \"|Disabled|\"],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the priority for type 1.| |Higher priorities are split when intersected with lower ones.|\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"nTypePriorityValue1\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Priority value type 1|\",\n      \"defaultValue\": \"0\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the priority value for type 1.|\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sTypePriority2\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Type 2|\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": [\"<Dynamic Beam Types>\", \"|Disabled|\"],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the priority for type 2.| |Higher priorities are split when intersected with lower ones.|\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"nTypePriorityValue2\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Priority value type 2|\",\n      \"defaultValue\": \"0\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the priority value for type 2.|\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sTypePriority3\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Type 3|\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": [\"<Dynamic Beam Types>\", \"|Disabled|\"],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the priority for type 3.| |Higher priorities are split when intersected with lower ones.|\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"nTypePriorityValue3\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Priority value type 3|\",\n      \"defaultValue\": \"0\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the priority value for type 3.|\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sTypePriority4\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Type 4|\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": [\"<Dynamic Beam Types>\", \"|Disabled|\"],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the priority for type 4.| |Higher priorities are split when intersected with lower ones.|\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"nTypePriorityValue4\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Priority value type 4|\",\n      \"defaultValue\": \"0\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the priority value for type 4.|\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sTypePriority5\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Type 5|\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": [\"<Dynamic Beam Types>\", \"|Disabled|\"],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the priority for type 5.| |Higher priorities are split when intersected with lower ones.|\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"nTypePriorityValue5\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Priority value type 5|\",\n      \"defaultValue\": \"0\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the priority value for type 5.|\"\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"sTypePriority6\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Type 6|\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options"
      },
      "tokens_used": 10060,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automatically resolves beam intersections by splitting beams based on a user-defined hierarchy of beam types and priorities (e.g., ensuring Purlins remain continuous over Rafters).\",\n    \"category\": \"Framing/Automation\",\n    \"typicalUseCase\": \"Processing a timber frame model to apply consistent connection rules where specific structural members (like plates or joists) must remain uncut (Male) while intersecting members (like studs) are cut (Female) based on their type.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sTypePriority1\",\n      \"technicalDefault\": \"null (dynamic)\",\n      \"businessMeaning\": \"Selects the first beam type (e.g., 'Rafter', 'Stud') to be governed by the priority rules.\",\n      \"validRange\": \"List of all Beam Types in the project catalog plus 'Disabled'.\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Identifies which beams in the model correspond to this specific priority tier.\"\n    },\n    {\n      \"name\": \"nTypePriorityValue1\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Sets the hierarchical rank for Type 1. A lower value (e.g., 0) makes the beam 'dominant' (it cuts through others), while a higher value makes it 'recessive' (it gets cut by others).\",\n      \"validRange\": \"Integer (0, 1, 2...)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Determines if beams of Type 1 are physically split or remain continuous at intersections.\"\n    },\n    {\n      \"name\": \"sTypePriority2\",\n      \"technicalDefault\": \"null (dynamic)\",\n      \"businessMeaning\": \"Selects the second beam type to be governed by the priority rules.\",\n      \"validRange\": \"List of all Beam Types in the project catalog plus 'Disabled'.\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Identifies which beams in the model correspond to this specific priority tier.\"\n    },\n    {\n      \"name\": \"nTypePriorityValue2\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Sets the hierarchical rank for Type 2. Lower numbers dominate higher numbers.\",\n      \"validRange\": \"Integer (0, 1, 2...)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Determines if beams of Type 2 are physically split or remain continuous at intersections.\"\n    },\n    {\n      \"name\": \"sTypePriority3\",\n      \"technicalDefault\": \"null (dynamic)\",\n      \"businessMeaning\": \"Selects the third beam type to be governed by the priority rules.\",\n      \"validRange\": \"List of all Beam Types in the project catalog plus 'Disabled'.\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Identifies which beams in the model correspond to this specific priority tier.\"\n    },\n    {\n      \"name\": \"nTypePriorityValue3\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Sets the hierarchical rank for Type 3. Lower numbers dominate higher numbers.\",\n      \"validRange\": \"Integer (0, 1, 2...)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Determines if beams of Type 3 are physically split or remain continuous at intersections.\"\n    },\n    {\n      \"name\": \"sTypePriority4\",\n      \"technicalDefault\": \"null (dynamic)\",\n      \"businessMeaning\": \"Selects the fourth beam type to be governed by the priority rules.\",\n      \"validRange\": \"List of all Beam Types in the project catalog plus 'Disabled'.\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Identifies which beams in the model correspond to this specific priority tier.\"\n    },\n    {\n      \"name\": \"nTypePriorityValue4\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Sets the hierarchical rank for Type 4. Lower numbers dominate higher numbers.\",\n      \"validRange\": \"Integer (0, 1, 2...)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Determines if beams of Type 4 are physically split or remain continuous at intersections.\"\n    },\n    {\n      \"name\": \"sTypePriority5\",\n      \"technicalDefault\": \"null (dynamic)\",\n      \"businessMeaning\": \"Selects the fifth beam type to be governed by the priority rules.\",\n      \"validRange\": \"List of all Beam Types in the project catalog plus 'Disabled'.\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Identifies which beams in the model correspond to this specific priority tier.\"\n    },\n    {\n      \"name\": \"nTypePriorityValue5\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Sets the hierarchical rank for Type 5. Lower numbers dominate higher numbers.\",\n      \"validRange\": \"Integer (0, 1, 2...)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Determines if beams of Type 5 are physically split or remain continuous at intersections.\"\n    },\n    {\n      \"name\": \"sTypePriority6\",\n      \"technicalDefault\": \"null (dynamic)\",\n      \"businessMeaning\": \"Selects the sixth beam type to be governed by the priority rules.\",\n      \"validRange\": \"List of all Beam Types in the project catalog plus 'Disabled'.\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Identifies which beams in the model correspond to this specific priority tier.\"\n    },\n    {\n      \"name\": \"nTypePriorityValue6\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Sets the hierarchical rank for Type 6. Lower numbers dominate higher numbers.\",\n      \"validRange\": \"Integer (0, 1, 2...)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Determines if beams of Type 6 are physically split or remain continuous at intersections.\"\n    },\n    {\n      \"name\": \"sTypePriority7\",\n      \"technicalDefault\": \"null (dynamic)\",\n      \"businessMeaning\": \"Selects the seventh beam type to be governed by the priority rules.\",\n      \"validRange\": \"List of all Beam Types in the project catalog plus 'Disabled'.\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Identifies which beams in the model correspond to this specific priority tier.\"\n    },\n    {\n      \"name\": \"nTypePriorityValue7\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Sets the hierarchical rank for Type 7. Lower numbers dominate higher numbers.\",\n      \"validRange\": \"Integer (0, 1, 2...)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Determines if beams"
      },
      "tokens_used": 10925,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Initialization: Set units, collect catalog beam types, and declare properties (Priority Types 1-8).\",\n    \"2. Check Execution Context:\",\n    \"   - If MapIO: Import properties, show dialog, return map.\",\n    \"   - If Element Deletion: Erase script instance.\",\n    \"   - If Insert: Proceed to insertion workflow.\",\n    \"3. Insertion Workflow:\",\n    \"   - Safety check: Erase if insertCycleCount > 1.\",\n    \"   - Scan Model Space: Filter available beam types to only those present in the drawing + 'Disabled'.\",\n    \"   - Update Property lists with filtered types.\",\n    \"   - Show Properties Dialog (showDialog).\",\n    \"   - Prompt User: Select beam to attach to (getGenBeam).\",\n    \"   - Set anchor point and add 'TslDoubleClick' trigger.\",\n    \"   - Exit Insertion mode.\",\n    \"4. Recalculation/Execution Workflow:\",\n    \"   - Retrieve the attached beam (bm).\",\n    \"   - Validate: If beam invalid, report 'One beam needed', erase script, exit.\",\n    \"   - Collect user-defined types and priority values from properties.\",\n    \"   - Filter out 'Disabled' entries.\",\n    \"   - Validate: If no types defined, report 'No beam"
      },
      "tokens_used": 12561,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# SplitBeamByType.mcr\n\n## Overview\nAutomatically resolves beam intersections by splitting beams in Model Space based on a user-defined hierarchy of beam types. It ensures structural members with lower priority values (e.g., Top Plates) remain continuous (\"Male\"), while intersecting members with higher values (e.g., Studs) are cut (\"Female\").\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on all beams found in the 3D model. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | This script modifies model geometry, not drawing views. |\n\n## Prerequisites\n- **Required Entities**: Beams (GenBeam) must exist in the model.\n- **Minimum Beam Count**: At least 1 beam is required to select as an anchor during insertion.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `SplitBeamByType.mcr` from the file browser.\n\n### Step 2: Configure Priorities\n```\nDialog: Properties\nAction: Define the beam types and their hierarchy.\n1. Use the \"Type X\" dropdowns to select beam types (e.g., Rafter, Stud, Purlin).\n   Note: The list is filtered to show only types currently present in your drawing.\n2. Assign a \"Priority value type X\" to each.\n   - 0 = Dominant (Beam remains continuous/cuts others).\n   - 1, 2, 3... = Recessive (Beam gets cut by lower numbers).\n3. Set a Type to \"Disabled\" if you do not wish to use that priority slot.\n4. Click OK.\n```\n\n### Step 3: Select Anchor Beam\n```\nCommand Line: Select beam\nAction: Click on any beam in the model to attach the script instance.\nNote: Although you select one beam, the script will process intersections for all beams in the Model Space matching the configured types.\n```\n\n## Properties Panel Parameters\n\nThese parameters are available in the AutoCAD Properties Palette (OPM) after insertion.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type 1 | dropdown | Dynamic | Select the beam type for the 1st priority tier. |\n| Priority value type 1 | Integer | 0 | Rank for Type 1 (Lower numbers are dominant). |\n| Type 2 | dropdown | Dynamic | Select the beam type for the 2nd priority tier. |\n| Priority value type 2 | Integer | 0 | Rank for Type 2 (Lower numbers are dominant). |\n| Type 3 | dropdown | Dynamic | Select the beam type for the 3rd priority tier. |\n| Priority value type 3 | Integer | 0 | Rank for Type 3 (Lower numbers are dominant). |\n| Type 4 | dropdown | Dynamic | Select the beam type for the 4th priority tier. |\n| Priority value type 4 | Integer | 0 | Rank for Type 4 (Lower numbers are dominant). |\n| Type 5 | dropdown | Dynamic | Select the beam type for the 5th priority tier. |\n| Priority value type 5 | Integer | 0 | Rank for Type 5 (Lower numbers are dominant). |\n| Type 6 | dropdown | Dynamic | Select the beam type for the 6th priority tier. |\n| Priority value type 6 | Integer | 0 | Rank for Type 6 (Lower numbers are dominant). |\n| Type 7 | dropdown | Dynamic | Select the beam type for the 7th priority tier. |\n| Priority value type 7 | Integer | 0 | Rank for Type 7 (Lower numbers are dominant). |\n| Type 8 | dropdown | Dynamic | Select the beam type for the 8th priority tier. |\n| Priority value type 8 | Integer | 0 | Rank for Type 8 (Lower numbers are dominant). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Re-runs the intersection logic. Use this after changing beam types or priority values in the Properties palette. |\n| TslDoubleClick | Triggers the script to update the geometry, similar to Recalculate. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Dynamic Lists**: When first inserting the script, the \"Type\" dropdowns are smart-filtered to show only beam types that currently exist in your drawing, saving you time scrolling through unused catalogs.\n- **Hierarchy Logic**: You can skip numbers in the priority values (e.g., use 0, 5, and 10). The logic simply checks: *If Beam A Priority < Beam B Priority, Beam A cuts Beam B.*\n- **Safe Updates**: The script uses body geometry operations without extrusion to ensure that when it splits beams, it doesn't create unwanted static tooling or leftover cuts on the \"Female\" (cut) beams.\n\n## FAQ\n- **Q: The script didn't cut my beams. Why?**\n  **A:** Check that you have assigned different Priority Values to the intersecting beam types. If both types have a priority value of 0, neither will cut the other.\n- **Q: Can I use this for complex truss systems?**\n  **A:** Yes, but ensure your beam types are assigned correctly in the catalog before running the script.\n- **Q: What happens if I delete the beam I selected as the anchor?**\n  **A:** The script instance will detect the deletion and report that one beam is needed. You may need to delete the script instance and re-insert it or select a new anchor if supported by your workflow."
      },
      "tokens_used": 7861,
      "error": null
    }
  }
}