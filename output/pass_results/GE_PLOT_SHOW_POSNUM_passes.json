{
  "filename": "GE_PLOT_SHOW_POSNUM.mcr",
  "status": "completed",
  "total_tokens": 46853,
  "processing_time": 420.06157755851746,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "v0.0",
            "date": "19.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Copied from Numbers on Panels, to keep US content folder naming standards\n- Thumbnail added\n- _DimStyles array added at prop. selection"
          },
          {
            "version": "v1.0",
            "date": "19.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Version control from 0.0 to 1.0, to keep safe versioning"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7671,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Viewport prompt: getViewport(\"Select the viewport from which the element is taken\"); Viewport array usage: _Viewport.append(vp); Element extraction: Element el = vp.element(); Coordinate transformation: ms2ps = vp.coordSys(); Paper space context comment: // dimstyle was adjusted for display in paper space"
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "A Layout (Paper Space) containing a viewport with an associated hsb Element.",
          "requiredSettings": [
            "_DimStyles (global variable for dimension styles)",
            "hsbId mapping arrays (arHsbId, arCode)"
          ]
        }
      },
      "tokens_used": 6137,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Select upper left point of rectangle",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select the viewport from which the element is taken",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strDimStyle",
            "type": "PropString",
            "displayName": "Dim style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "propHeader",
            "type": "PropString",
            "displayName": "Table header",
            "defaultValue": "Text can be changed in the OPM",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColorIndex",
            "type": "PropInt",
            "displayName": "Header color",
            "defaultValue": 3,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "strTranslateId",
            "type": "PropString",
            "displayName": "Translate hsbId",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7626,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a drawing schedule (cut list/bill of materials) in Paper Space that lists beams from a selected viewport, assigning alpha-numeric labels to unique pieces.",
          "category": "ShopDrawing",
          "typicalUseCase": "Placing a material take-off or schedule table on a layout sheet to identify and quantify studs, plates, and beams within a wall or floor panel view."
        },
        "parameters": [
          {
            "name": "strDimStyle",
            "technicalDefault": "null",
            "businessMeaning": "Selects the dimension style (and associated text height/font) used to format the table text and on-beam labels. This determines the printed size of the characters.",
            "validRange": "Any valid Dimension Style name existing in the current AutoCAD drawing (e.g., 'STANDARD', 'TSL-2.5').",
            "unit": "Text Style",
            "affectsOutput": "Text height, text width, font style, and the overall geometric dimensions (width/height) of the schedule table and label markers."
          },
          {
            "name": "propHeader",
            "technicalDefault": "\"Text can be changed in the OPM\"",
            "businessMeaning": "The title text displayed at the top of the generated schedule table.",
            "validRange": "Any alphanumeric string.",
            "unit": "String",
            "affectsOutput": "The text drawn at the top of the table border. Also affects the minimum width of the table if the header text is longer than the column data."
          },
          {
            "name": "nColorIndex",
            "technicalDefault": "3",
            "businessMeaning": "The AutoCAD Color Index (ACI) used to draw the header text of the table.",
            "validRange": "0 to 256 (Standard AutoCAD colors, e.g., 1=Red, 2=Yellow, 3=Green, 7=White/Black).",
            "unit": "Color Index",
            "affectsOutput": "The color property of the header text entity in the drawing."
          },
          {
            "name": "strTranslateId",
            "technicalDefault": "null",
            "businessMeaning": "Determines whether to show the raw internal hsbID codes (e.g., '18') or the translated user-friendly names (e.g., 'Stud') in the schedule table.",
            "validRange": "\"Yes\", \"No\"",
            "unit": "Enumeration",
            "affectsOutput": "The content of the first column of the table ('HsbId' vs 'Name') and the mapping of beam types to rows."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "strDimStyle",
            "effect": "Changing the text style updates the calculated character height (dCH) and width (dCW), which resizes the table geometry.",
            "cascade": [
              "Table Width",
              "Table Height",
              "Label Marker Size"
            ]
          },
          {
            "trigger": "propHeader",
            "effect": "If the header text length exceeds the combined width of the data columns, the total table width expands to fit the header.",
            "cascade": [
              "Table Width"
            ]
          },
          {
            "trigger": "strTranslateId",
            "effect": "Switching to 'No' uses the raw hsbID for grouping and display; 'Yes' uses the mapped name.",
            "cascade": [
              "Table Row Content",
              "Grouping Logic (Name vs ID)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Annotation/Text",
            "description": "Alpha-numeric labels (e.g., A, B, C...) drawn near the centroid of beams in Paper Space, referencing the table rows.",
            "appliedTo": "Beams found within the selected Viewport's Element."
          },
          {
            "type": "Annotation/Text",
            "description": "A structured table in Paper Space listing Name/ID, Label, Quantity, Width, Height, Length, Cut Notches (CN/CP), and Shortened Length.",
            "appliedTo": "N/A (Schedule Table)"
          },
          {
            "type": "PLine",
            "description": "Rectangular borders drawn around the table header and potentially the labels (depending on code execution path).",
            "appliedTo": "Paper Space Layout."
          }
        ]
      },
      "tokens_used": 9021,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Execution: Initiated via command or toolbar.",
          "2. Insertion Phase (if _bOnInsert):",
          "   - User prompted to select upper-left point for the table origin (_Pt0).",
          "   - User prompted to select a Viewport containing the model element.",
          "   - Script stores Viewport reference and pauses/returns.",
          "3. Recalculation Phase:",
          "   - Script initializes Display properties (DimStyle, Color) based on Properties Palette.",
          "   - Script validates that a Viewport exists and contains a valid hsb Element.",
          "   - Script retrieves Beams from the Element.",
          "4. Data Processing Loop:",
          "   - Iterate through each Beam.",
          "   - Determine Name/ID (Translate hsbId check).",
          "   - Calculate Cut Angles and Shortened Length.",
          "   - Check if Beam properties match an existing group.",
          "   - [Conditional] Increment Group Count OR Create New Group (assign Label A, B, C...).",
          "5. Sorting Phase:",
          "   - Sort the grouped data array based on predefined Sort IDs.",
          "6. Geometry Calculation:",
          "   - Determine column widths based on string content.",
          "   - Calculate total table width and height based on character sizes.",
          "7. Annotation Loop:",
          "   - Iterate through every Beam instance again.",
          "   - Transform Model Space centroid to Paper Space coordinates.",
          "   - [Conditional] Check for label overlap with previously drawn labels.",
          "   - [Conditional] Adjust label position (Center -> Offset A -> Offset B) if overlap detected.",
          "   - Draw Label text at the calculated position.",
          "   - (Note: Table borders are calculated but drawing commands are commented out or missing in the provided snippet)."
        ],
        "conditionalBranches": [
          {
            "condition": "Translation of hsbId (strTranslateId property)",
            "path1": {
              "name": "Translate 'Yes'",
              "steps": [
                "Lookup beam hsbId in arHsbId array.",
                "Replace with corresponding name from arCode array (e.g., '18' becomes 'Stud').",
                "Use this Name for grouping and table display."
              ]
            },
            "path2": {
              "name": "Translate 'No'",
              "steps": [
                "Use raw hsbId (e.g., '18') directly.",
                "Use ID for grouping and table display."
              ]
            }
          },
          {
            "condition": "Beam Matching (Grouping)",
            "path1": {
              "name": "Match Found",
              "steps": [
                "Compare current beam W, H, L, PosNum, and Name/ID to existing list.",
                "If all equal: Increment count for that existing group.",
                "Assign existing group label to beam instance."
              ]
            },
            "path2": {
              "name": "New Item",
              "steps": [
                "No match found in existing list.",
                "Create new group entry.",
                "Calculate alpha-numeric label (A-Z, then AA-AZ).",
                "Initialize count to 1.",
                "Store dimensions, cut info, and shortened length."
              ]
            }
          },
          {
            "condition": "Label Overlap (Collision Detection)",
            "path1": {
              "name": "Clear (Primary Position)",
              "steps": [
                "Check distance from Beam Centroid to existing labels.",
                "If distance > 3x Character Height: Use Centroid position."
              ]
            },
            "path2": {
              "name": "Overlap (Secondary/Tertiary Position)",
              "steps": [
                "If distance < 3x Character Height: Try Offset A (PtCen + 1/4 Length).",
                "Check distance again.",
                "If still overlapping: Try Offset B (PtCen - 1/4 Length).",
                "Draw label at the first valid position found."
              ]
            }
          },
          {
            "condition": "Element Validity",
            "path1": {
              "name": "Valid",
              "steps": [
                "Viewport contains valid Element data.",
                "Proceed to beam extraction."
              ]
            },
            "path2": {
              "name": "Invalid",
              "steps": [
                "Viewport is empty or Element is invalid.",
                "Script terminates immediately (return)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "None explicitly prompted, but script fails silently or does nothing.",
            "recovery": "User must select a viewport during the insertion getViewport prompt."
          },
          {
            "check": "Element Data Presence",
            "errorMessage": "None shown to user.",
            "recovery": "Ensure the selected viewport is looking at an hsbCAD Element (Wall/Floor), not just plain AutoCAD geometry."
          },
          {
            "check": "hsbId Mapping",
            "errorMessage": "Potential crash/empty output if strTranslateId is 'Yes' but hsbId is not found in arHsbId array.",
            "recovery": "Ensure 'Translate hsbId' is set to 'No' for unmapped IDs, or update the script's arHsbId/arCode arrays."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Dimension Style",
            "how": "Properties Palette (OPM) -> Dim style",
            "effect": "Recalculates text height/width. Resizes the table geometry and label markers to match the new text size."
          },
          {
            "action": "Update Header Text",
            "how": "Properties Palette (OPM) -> Table header",
            "effect": "Changes the title string of the schedule table."
          },
          {
            "action": "Toggle ID Translation",
            "how": "Properties Palette (OPM) -> Translate hsbId",
            "effect": "Switches between showing raw codes (e.g., '32') and readable names (e.g., 'Bottom Plate') in the table and regroups the list accordingly."
          },
          {
            "action": "Move Insertion Point",
            "how": "Grip Edit _Pt0",
            "effect": "Moves the origin of the table and re-relativizes the label positions in Paper Space."
          }
        ]
      },
      "tokens_used": 10152,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_PLOT_SHOW_POSNUM.mcr\n\n## Overview\nThis script generates a material schedule (cut list) in Paper Space for beams within a selected viewport. It automatically groups identical beams, assigns alpha-numeric position labels (A, B, C...), and places a detailed table on the layout along with corresponding labels on the beams.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | Script must be inserted on a Layout tab. |\n| Paper Space | Yes | The script inserts the table and labels on the current layout. |\n| Shop Drawing | No | This is a detailing/scheduling tool, not a generator for shop drawings. |\n\n## Prerequisites\n- **Required Entities**: A Layout (Paper Space) containing a viewport. The viewport must be displaying a valid hsbCAD Element (e.g., a Wall or Floor panel).\n- **Minimum Beam Count**: 0 (The script will generate an empty table if no beams are found).\n- **Required Settings**: The drawing must have valid Dimension Styles defined (managed by the global `_DimStyles` variable) to control text size.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT` â†’ Select `GE_PLOT_SHOW_POSNUM.mcr`\n\n### Step 2: Select Insertion Point\n```\nCommand Line: Select upper left point of rectangle\nAction: Click in Paper Space where you want the top-left corner of the schedule table to be located.\n```\n\n### Step 3: Select Viewport\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click on the border of the viewport that displays the model/wall you want to schedule.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dim style | Dropdown | (From Global List) | Selects the text style used for the table and labels. Changing this resizes the table and marker text. |\n| Table header | String | \"Text can be changed in the OPM\" | The title text displayed at the top of the schedule table. |\n| Header color | Number | 3 (Green) | The AutoCAD color index used for the header text. |\n| Translate hsbId | Dropdown | Yes | If \"Yes\", shows readable names (e.g., \"Stud\"). If \"No\", shows raw internal codes (e.g., \"18\"). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are available for this script. |\n\n## Settings Files\n- **Filename**: None specific.\n- **Location**: N/A\n- **Purpose**: This script relies on the global `_DimStyles` variable configuration within the hsbCAD environment, not a specific external XML file.\n\n## Tips\n- **Label Placement**: The script includes collision detection. If a beam label would overlap with another, it automatically shifts its position along the beam to remain readable.\n- **Resizing**: To quickly change the size of the table and labels, simply change the \"Dim style\" property to a style with a different text height (e.g., switch from \"Standard\" to a larger architectural font).\n- **Moving the Table**: You can select the script object and use the grip edit point (the original insertion point) to move the table to a different location on the sheet.\n- **Data Grouping**: Beams are only grouped together if they have the exact same Width, Height, Length, and HsbId/Name.\n\n## FAQ\n- **Q: Why is the table empty?**\n  A: Ensure the viewport you selected is actually looking at an hsbCAD Element (Wall/Floor) and that the Element contains beams. The script cannot process plain AutoCAD lines or empty viewports.\n\n- **Q: I see numbers (e.g., \"18\") in the table instead of names (e.g., \"Stud\").**\n  A: Change the \"Translate hsbId\" property in the Properties Palette to \"Yes\". If names still do not appear, the specific beam code may not be mapped in the global hsbId configuration.\n\n- **Q: The labels are too small to read on the printed drawing.**\n  A: Select the script in Paper Space, open the Properties Palette, and change the \"Dim style\" to a style with a larger text height defined in your AutoCAD dimension styles."
      },
      "tokens_used": 6246,
      "error": null
    }
  }
}