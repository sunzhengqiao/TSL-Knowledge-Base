{
  "filename": "HSB_T-SquareBeamCut.mcr",
  "status": "completed",
  "total_tokens": 32152,
  "processing_time": 241.73340606689453,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "23.01.2013",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "07.04.2014",
            "author": "AS",
            "changes": "Check orientation of vyBmTool"
          },
          {
            "version": "1.02",
            "date": "14.04.2014",
            "author": "AS",
            "changes": "Add flag for x direction"
          },
          {
            "version": "2.00",
            "date": "25.01.2019",
            "author": "RP",
            "changes": "Use static tools"
          },
          {
            "version": "2.01",
            "date": "15.03.2019",
            "author": "RP",
            "changes": "Check on contactface and free direction to make it work in more general situations."
          },
          {
            "version": "2.02",
            "date": "15.03.2019",
            "author": "RP",
            "changes": "Make sure longest/ shortest side are correct."
          },
          {
            "version": "2.03",
            "date": "11.04.2019",
            "author": "RP",
            "changes": "Not working for all vectors"
          },
          {
            "version": "2.04",
            "date": "12.04.2019",
            "author": "RP",
            "changes": "Check on wrong vector"
          },
          {
            "version": "2.05",
            "date": "26.06.2019",
            "author": "RP",
            "changes": "Add the loop for rotation twice so the beamcut gets rotated twice."
          },
          {
            "version": "3.00",
            "date": "14.04.2020",
            "author": "RP",
            "changes": "Always on longest side"
          },
          {
            "version": "3.01",
            "date": "14.07.2020",
            "author": "RP",
            "changes": "Fix bug where beamcut is at the end of a beam"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6150,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select Beam() entities, accesses beam.realBody() for 3D geometry, and manipulates static tools using beam.getToolsStaticOfTypeBeamCut() and beam.addToolStatic(). There are no references to sd_ prefixes, Sheets, Viewports, or Paper Space entities."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "BeamCut"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D Model)",
          "requiredSettings": []
        }
      },
      "tokens_used": 4385,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select beam(s)|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3671,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Recalculates and standardizes existing static beam cuts to ensure they are orthogonal (squared) and correctly aligned with the beam's local coordinate system based on the longest intersecting side.",
          "category": "Processing / Data Cleanup",
          "typicalUseCase": "Used to fix or 'square up' beam cuts that were imported, manually created incorrectly, or generated by other scripts that resulted in non-orthogonal cutting bodies, ensuring clean manufacturing data."
        },
        "parameters": [
          {
            "name": "PrEntity (Select beam(s))",
            "technicalDefault": "None",
            "businessMeaning": "The structural timber members that contain static BeamCut tools which need to be recalculated or normalized.",
            "validRange": "One or multiple existing Beams",
            "unit": "Selection",
            "affectsOutput": "Determines the scope of the operation; only cuts attached to the selected beams will be processed and replaced."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "BeamCut (Static Tool)",
            "description": "A new static beam cutting tool that replaces the original. The geometry is recalculated to represent the intersection volume tightly, but re-oriented so its axes align with the beam's local system (aligned to the 'longest side').",
            "appliedTo": "The specific Beams selected by the user."
          }
        ]
      },
      "tokens_used": 5899,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script is launched via command or catalog.",
          "2. Check for Execution Key (_kExecuteKey) to load catalog properties (if applicable).",
          "3. Prompt user to select Beam(s) (PrEntity).",
          "4. User confirms selection.",
          "5. Selected entities are stored in internal Map.",
          "6. Script recalculation cycle begins.",
          "7. Retrieve Beams from Map.",
          "8. Iterate through each selected Beam.",
          "9. Iterate through each static BeamCut tool found on the Beam.",
          "10. Calculate intersection geometry between BeamCut and Beam envelope.",
          "11. Analyze cutting body vectors to determine orientation relative to Beam system.",
          "12. [Conditional] If vector alignment is not orthogonal or valid, calculate new orthogonal profile.",
          "13. Remove original BeamCut tool.",
          "14. Create new BeamCut tool with calculated orthogonal dimensions and origin.",
          "15. Add new tool to Beam.",
          "16. Script instance erases itself from drawing."
        ],
        "conditionalBranches": [
          {
            "condition": "User Input Selection (PrEntity)",
            "path1": {
              "name": "Valid Selection",
              "steps": [
                "Entities stored in Map.",
                "Processing loop executes."
              ]
            },
            "path2": {
              "name": "Canceled/Empty Selection",
              "steps": [
                "Script returns.",
                "No processing occurs.",
                "Instance likely remains or purges depending on context (here, returns without map data, effectively ending)."
              ]
            }
          },
          {
            "condition": "Vector Alignment Check (Dot Product)",
            "path1": {
              "name": "Already Aligned",
              "steps": [
                "Vector is within tolerance of Beam axis.",
                "Loop iteration continues (skips recalculation).",
                "Original BeamCut is preserved."
              ]
            },
            "path2": {
              "name": "Misaligned",
              "steps": [
                "Calculate most aligned Beam axis (X, Y, or Z).",
                "Proceed to profile calculation.",
                "Original BeamCut is replaced."
              ]
            }
          },
          {
            "condition": "Geometric Validity (Ray Intersection & Vertex Count)",
            "path1": {
              "name": "Valid Geometry",
              "steps": [
                "Ray intersects beam body.",
                "Sorted vertices >= 3.",
                "New tool is generated and applied."
              ]
            },
            "path2": {
              "name": "Invalid Geometry",
              "steps": [
                "Ray misses or insufficient vertices.",
                "Loop iteration continues.",
                "Original BeamCut is preserved (error safety)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Vector Alignment (Dot Product)",
            "errorMessage": "Internal logic failure: Vector misalignment or calculation error.",
            "recovery": "Skip replacement of the specific BeamCut to prevent data loss."
          },
          {
            "check": "Ray Intersection (beamBody.rayIntersection)",
            "errorMessage": "Internal logic failure: Calculated origin does not project onto beam body.",
            "recovery": "Skip replacement of the specific BeamCut."
          },
          {
            "check": "Vertex Count (sortedVertices.length())",
            "errorMessage": "Internal logic failure: Insufficient vertices to form a valid cutting profile.",
            "recovery": "Skip replacement of the specific BeamCut."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Script Instance Removal",
            "how": "Automatic (Internal Logic)",
            "effect": "The script instance erases itself (_bOnMapIO check) immediately after processing, leaving no interactive grips or OPM properties to edit."
          },
          {
            "action": "Direct Tool Manipulation",
            "how": "Selecting the Beam",
            "effect": "The user must modify the resulting BeamCut directly via the Beam's properties or by deleting/re-running the script."
          }
        ]
      },
      "tokens_used": 6469,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_T-SquareBeamCut.mcr\n\n## Overview\nThis script is a utility tool used to correct and standardize static beam cuts (BeamCut tools) on selected beams. It automatically recalculates the geometry of existing cuts to ensure they are orthogonal (squared) and properly aligned with the beam's local coordinate system based on the longest intersecting side.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model on standard beams. |\n| Paper Space | No | This script does not function in Paper Space or on 2D views. |\n| Shop Drawing | No | This script does not generate or modify shop drawing layouts. |\n\n## Prerequisites\n- **Required Entities**: At least one `GenBeam` (Beam) containing static `BeamCut` tools.\n- **Minimum Beam Count**: 1.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_T-SquareBeamCut.mcr` from the file dialog.\n\n### Step 2: Select Beam(s)\n```\nCommand Line: Select beam(s)\nAction: Click on one or multiple beams in the model that contain the beam cuts you wish to square/correct. Press Enter or Right-click to confirm selection.\n```\n\n### Step 3: Automatic Processing\nThe script will automatically iterate through the selected beams. It will find all static beam cuts, check their orientation, and replace any misaligned cuts with newly calculated orthogonal ones. The script instance will then delete itself from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| None | N/A | N/A | This script does not expose editable parameters in the Properties Palette. It runs as a one-time command. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | N/A | This script instance erases itself immediately after execution, so there are no context menu options available. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not rely on external XML settings files.\n\n## Tips\n- **Use for Cleanup**: This is ideal for fixing beam cuts that were imported from other files, manually created with errors, or generated by older scripts.\n- **Alignment**: The script forces the cut to align with the \"longest side\" relative to the beam's local system, ensuring consistent manufacturing data.\n- **Selection**: You can select multiple beams at once to process an entire frame or assembly quickly.\n- **Safety**: The script performs internal validation checks (Ray Intersection and Vertex Count). If a cut geometry is invalid or cannot be recalculated, the script will skip that specific cut to prevent data loss, leaving the original untouched.\n\n## FAQ\n- **Q: What exactly does \"Squaring\" a beam cut mean?**\n  **A**: It means recalculating the cutting volume so that its sides are perfectly perpendicular (90 degrees) to the beam's local axes, rather than being skewed or rotated arbitrarily.\n- **Q: Will this script delete my cuts if it fails?**\n  **A**: No. If the script encounters invalid geometry that it cannot process, it will preserve the original beam cut and move to the next one.\n- **Q: Why did the script disappear after I ran it?**\n  **A**: This is a \"command-style\" script. It performs its task once and then erases its own instance from the drawing to keep the project clean. To use it again, simply run `TSLINSERT` again."
      },
      "tokens_used": 5578,
      "error": null
    }
  }
}