{
  "filename": "hsb_NoToolArea.mcr",
  "status": "completed",
  "total_tokens": 31513,
  "processing_time": 164.7844226360321,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3837,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script interacts directly with 3D Elements using getElement() and modifies manufacturing properties via el.addTool() and ElemZone. No ShopDrawing (sd_) or Viewport references found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3940,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && _kExecuteKey==\"\"",
              "required": false
            },
            {
              "step": 2,
              "function": "getElement",
              "promptOriginal": "Select an Element",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getEntPLine",
              "promptOriginal": "Pick a polyline, or enter to pick a point",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 4,
              "function": "getPoint",
              "promptOriginal": "",
              "condition": "_bOnInsert && !pl.bIsValid()",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dHeight",
            "type": "PropDouble",
            "displayName": "Height",
            "defaultValue": "U(100)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "Length",
            "defaultValue": "U(100)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "psZones",
            "type": "PropString",
            "displayName": "Zones to apply no tool area",
            "defaultValue": "1;2",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Please type the number of the zones separate by ; (1-10)"
          },
          {
            "index": 0,
            "variable": "sOperationCNC",
            "type": "PropString",
            "displayName": "Exclusion Type",
            "defaultValue": "No Nail",
            "inputType": "dropdown",
            "options": [
              "No Nail",
              "No Glue",
              "No Nail and No Glue"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6852,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Defines specific areas on an element where CNC tools (nailing guns or glue applicators) are prohibited from operating, typically to prevent interference with fixtures or connections.",
          "category": "Manufacturing/CNC",
          "typicalUseCase": "Marking areas on a wall panel where mechanical fasteners or glue should not be applied, often near door openings, windows, or specific connection plates."
        },
        "parameters": [
          {
            "name": "dHeight",
            "technicalDefault": "U(100)",
            "businessMeaning": "The vertical dimension (height) of the rectangular area where tools are excluded. This defines how far up/down the restriction applies.",
            "validRange": "0 to Element Height",
            "unit": "mm",
            "affectsOutput": "Adjusts the vertical size of the 'No Tool' geometry projected onto the element surface."
          },
          {
            "name": "dWidth",
            "technicalDefault": "U(100)",
            "businessMeaning": "The horizontal dimension (length) of the rectangular area where tools are excluded. This defines the lateral extent of the restriction.",
            "validRange": "0 to Element Width/Length",
            "unit": "mm",
            "affectsOutput": "Adjusts the horizontal size of the 'No Tool' geometry projected onto the element surface."
          },
          {
            "name": "psZones",
            "technicalDefault": "1;2",
            "businessMeaning": "Identifies which specific element zones (surfaces or sides) the no-tool restriction applies to (e.g., Zone 1 might be the exterior face, Zone 2 the interior).",
            "validRange": "1-10 (depending on element complexity)",
            "unit": "count",
            "affectsOutput": "Determines on which face(s) of the element the exclusion area is created and active."
          },
          {
            "name": "sOperationCNC",
            "technicalDefault": "No Nail",
            "businessMeaning": "Specifies the type of manufacturing process to restrict within the defined area (Nailing, Gluing, or both).",
            "validRange": "No Nail, No Glue, No Nail and No Glue",
            "unit": "text",
            "affectsOutput": "Instructs the CNC machine to skip nailing operations, skip glue application, or skip both within the defined geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Selection of Polylines during insertion",
            "effect": "Overrides dHeight and dWidth dimensions based on the selected polyline geometry.",
            "cascade": [
              "dHeight",
              "dWidth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "ElemNoNail",
            "description": "A manufacturing constraint region placed on the element to instruct CNC machinery to avoid fastening in this specific area.",
            "appliedTo": "Selected Element Zones"
          },
          {
            "type": "Hsb_Tag",
            "description": "Metadata tags attached to the instance (NoNail, NoGlue) used for downstream data checks and export filters.",
            "appliedTo": "Script Instance"
          }
        ]
      },
      "tokens_used": 4566,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Inserted",
          "Check insertCycleCount to prevent recursive execution",
          "[Conditional] If _kExecuteKey is empty, display Property Dialog",
          "Prompt user to Select an Element",
          "[Conditional] Validate Element Selection: If empty, erase instance and exit",
          "Prompt user to Pick a Polyline, or press Enter to pick a Point",
          "[Branch A] If valid Polyline selected: Store Polyline geometry",
          "[Branch B] If no Polyline: Prompt user to select a Point",
          "End Insertion Phase",
          "[Recalculation/Execution Phase] Retrieve Element reference",
          "[Conditional] Validate Element: If invalid, erase instance and exit",
          "Parse 'psZones' string into array of valid Zone indices",
          "Loop through each defined Zone",
          "Determine geometry source based on stored entities (Polyline vs Point)",
          "[Branch A - Polyline] Project selected polyline onto the current Zone plane",
          "[Branch B - Point] Calculate rectangle based on dHeight/dWidth centered on the Point",
          "Remove old 'NoNail' and 'NoGlue' tags from instance",
          "Apply new tags based on 'sOperationCNC' property (No Nail, No Glue, or Both)",
          "Create ElemNoNail tool on the Element for the current Zone",
          "Store calculated geometry in Map for external reference",
          "Repeat for all Zones",
          "Script Update Complete"
        ],
        "conditionalBranches": [
          {
            "condition": "User input method during insertion (Polyline vs Point)",
            "path1": {
              "name": "Polyline Geometry",
              "steps": [
                "User selects a polyline",
                "Script stores polyline in _Entity",
                "On recalc, polyline is projected onto the Element Zone plane",
                "Tool area shape matches the polyline exactly"
              ]
            },
            "path2": {
              "name": "Point & Dimensions",
              "steps": [
                "User presses Enter (no polyline)",
                "User selects a center point",
                "Script stores point in _Pt0",
                "On recalc, rectangle is generated using dWidth and dHeight centered on _Pt0",
                "Tool area shape is a rectangle"
              ]
            }
          },
          {
            "condition": "Exclusion Type (sOperationCNC) Property",
            "path1": {
              "name": "No Nail",
              "steps": [
                "Index 0 selected",
                "Instance tagged with 'NoNail'",
                "Tag 'NoGlue' removed if present"
              ]
            },
            "path2": {
              "name": "No Glue",
              "steps": [
                "Index 1 selected",
                "Instance tagged with 'NoGlue'",
                "Tag 'NoNail' removed if present"
              ]
            },
            "path3": {
              "name": "No Nail and No Glue",
              "steps": [
                "Index 2 selected",
                "Instance tagged with both 'NoNail' and 'NoGlue'"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "(None - Script erases silently)",
            "recovery": "User must re-insert the script and ensure an Element is selected."
          },
          {
            "check": "Element Reference Validity",
            "errorMessage": "(None - Script erases silently)",
            "recovery": "Ensure the referenced Element exists in the model and has not been deleted."
          },
          {
            "check": "Zone String Format (psZones)",
            "errorMessage": "(None - Invalid tokens are ignored)",
            "recovery": "User must format the string using numbers 1-10 separated by semicolons (e.g., '1;3')."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions (dHeight, dWidth)",
            "how": "OPM (Object Properties Palette)",
            "effect": "Updates the size of the rectangular No Tool area. Only applies if the initial creation used the 'Point & Dimensions' method."
          },
          {
            "action": "Change Zones (psZones)",
            "how": "OPM",
            "effect": "Adds the No Tool area to newly added zones or removes it from deleted zones. Updates geometry on the Element immediately."
          },
          {
            "action": "Change Operation Type (sOperationCNC)",
            "how": "OPM",
            "effect": "Updates the instance tags ('NoNail', 'NoGlue') which determines which CNC operations are restricted."
          }
        ]
      },
      "tokens_used": 6928,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_NoToolArea.mcr\n\n## Overview\nThis script defines \"No Tool\" areas on an element to prevent CNC machinery (such as nailing guns or glue applicators) from operating in specific regions. It is commonly used to protect areas around door openings, windows, or connection plates during manufacturing.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Must be applied to a 3D Element (Wall, Floor, or Roof). |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | Does not generate 2D drawing views directly. |\n\n## Prerequisites\n- **Required Entities**: 1 Element (Wall, Floor, or Roof).\n- **Minimum Beam Count**: 0 (Operates on Elements).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_NoToolArea.mcr`\n\n### Step 2: Configure Options\nA dialog may appear upon insertion to set initial parameters (optional depending on execution method).\n\n### Step 3: Select Element\n```\nCommand Line: Select an Element\nAction: Click on the wall, floor, or roof element you wish to modify.\n```\n\n### Step 4: Define Geometry\n```\nCommand Line: Pick a polyline, or enter to pick a point\nAction:\nOption A: Click an existing closed polyline in the drawing to define the shape.\nOption B: Press Enter, then click a point to act as the center of the area.\n```\n\n### Step 5: Edit Properties (Optional)\nAfter insertion, select the script instance and press `Ctrl+1` to open the Properties Palette. Adjust dimensions or zones as needed.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Exclusion Type | dropdown | No Nail | Determines the CNC operation to restrict: \"No Nail\", \"No Glue\", or \"No Nail and No Glue\". |\n| Zones to apply no tool area | text | 1;2 | Specifies which element zones (faces) are affected. Separate zone numbers with a semicolon (e.g., 1;2). |\n| Height | number | 100 | The vertical height of the exclusion area. Only applies if defined by Point. |\n| Length | number | 100 | The horizontal length of the exclusion area. Only applies if defined by Point. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | No custom context menu items are defined for this script. Use the Properties Palette to modify settings. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Polyline vs. Point**: If you select a polyline during insertion, the \"Height\" and \"Length\" properties are ignored, as the shape is defined by the polyline. If you select a point, the script creates a rectangle based on the Height and Length properties centered on that point.\n- **Zone Identification**: If you are unsure which zone number corresponds to which face of the element, check your element documentation or use the script's feedback to identify the correct face numbers.\n- **Updating**: Changes made in the Properties Panel (like switching from \"No Nail\" to \"No Glue\") update the element immediately.\n\n## FAQ\n- **Q: How do I apply the \"No Tool\" area to both sides of a wall?**\n  **A:** In the Properties Palette, set `Zones to apply no tool area` to `1;2` (assuming 1 and 2 are the inner and outer faces).\n- **Q: Why can't I change the dimensions in the properties?**\n  **A:** This happens if the area was originally created using a Polyline. The script uses the polyline geometry exclusively. To use dimensions, erase the instance and re-insert it using the \"Point\" selection method.\n- **Q: What happens if I delete the element?**\n  **A:** The script instance detects that the element is invalid and will erase itself automatically."
      },
      "tokens_used": 5390,
      "error": null
    }
  }
}