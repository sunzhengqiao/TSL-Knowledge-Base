{
  "filename": "NA_WALL_BLOCKING_BY_STORY.mcr",
  "status": "completed",
  "total_tokens": 46366,
  "processing_time": 515.4594099521637,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5755,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses dbCreate to generate GenBeam entities (Blocking) and interacts with Element and Group structures (Equivalent Story). It lacks #Type E, _Viewport references, or sd_ prefixes typical of Paper Space or Shop Drawing scripts. Display logic uses a 3D display dp(-1) and constructs geometry in Model Space."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space with Walls organized in Groups (for Story selection) or available for manual selection.",
          "requiredSettings": []
        }
      },
      "tokens_used": 5238,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 9610,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automates the generation of wall blocking (bridging, fire stops, or nailing backers) based on selected equivalent stories or manual wall selection.\",\n    \"category\": \"Framing/Automation\",\n    \"typicalUseCase\": \"Applying fire blocking at specific heights, adding mid-height nailing backers for drywall, or creating staggered rows of blocking for bracing across a specific floor or entire building.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"piStory\",\n      \"technicalDefault\": \"-1\",\n      \"businessMeaning\": \"Selects the building level (Equivalent Story) to process. Setting this to -1 enables manual selection of specific walls.\",\n      \"validRange\": \"-1 (Manual) to Max Story Index\",\n      \"unit\": \"Integer (Index)\",\n      \"affectsOutput\": \"Filters which Element Groups/Walls are included in the generation process.\"\n    },\n    {\n      \"name\": \"pdMinLen\",\n      \"technicalDefault\": \"U(4) (4 inches)\",\n      \"businessMeaning\": \"The minimum length a piece of blocking must be to be generated. Prevents creating tiny unusable scraps in small gaps between studs.\",\n      \"validRange\": \"2 inches to 24 inches (typical)\",\n      \"unit\": \"Length\",\n      \"affectsOutput\": \"Filters out geometry candidates that are too short to be physically useful.\"\n    },\n    {\n      \"name\": \"psRemoveExisting\",\n      \"technicalDefault\": \"arYN[0] (Yes)\",\n      \"businessMeaning\": \"Toggle to delete previously generated blocking beams associated with these walls before creating new ones.\",\n      \"validRange\": \"Yes/No\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"If Yes, erases existing Blocking/SFBlocking beams to prevent duplicates or outdated geometry.\"\n    },\n    {\n      \"name\": \"piAmount (1-6)\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Number of rows of blocking to generate vertically at this specific configuration level.\",\n      \"validRange\": \"0 to 10\",\n      \"unit\": \"Count\",\n      \"affectsOutput\": \"Controls the quantity of beams generated; 0 skips this specific blocking configuration.\"\n    },\n    {\n      \"name\": \"pdHeightPos (1-6)\",\n      \"technicalDefault\": \"U(0)\",\n      \"businessMeaning\": \"The vertical elevation (from the bottom of the wall) where the *highest* row of blocking in this group is placed.\",\n      \"validRange\": \"0 to Wall Height\",\n      \"unit\": \"Length\",\n      \"affectsOutput\": \"Determines the Y-axis position of the blocking group. Subsequent rows stack downwards from this height.\"\n    },\n    {\n      \"name\": \"pdHeight (1-6)\",\n      \"technicalDefault\": \"U(0)\",\n      \"businessMeaning\": \"The vertical dimension (height) of the blocking board.\",\n      \"validRange\": \"3.5\\\" to 24\\\" (typical lumber sizes)\",\n      \"unit\": \"Length\",\n      \"affectsOutput\": \"Sets the Y-axis size of the generated beam.\"\n    },\n    {\n      \"name\": \"pdWidth (1-6)\",\n      \"technicalDefault\": \"U(0)\",\n      \"businessMeaning\": \"The depth/thickness of the blocking board (perpendicular to the wall face).\",\n      \"validRange\": \"1.5\\\" to Wall Thickness\",\n      \"unit\": \"Length\",\n      \"affectsOutput\": \"Sets the Z-axis size of the generated beam. If set larger than the wall, it is clamped to wall thickness.\"\n    },\n    {\n      \"name\": \"psFace (1-6)\",\n      \"technicalDefault\": \"arFaces[2] (Front and Back)\",\n      \"businessMeaning\": \"Specifies the location of the blocking relative to the wall center line (Front, Back, Both, or Centered).\",\n      \"validRange\": \"Front/Back/Front and Back/Middle\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Controls the lateral position (Z-axis offset) of the beam. 'Front and Back' creates double the beams.\"\n    },\n    {\n      \"name\": \"pdGap (1-6)\",\n      \"technicalDefault\": \"U(0)\",\n      \"businessMeaning\": \"Clearance cut from each end of the blocking (e.g., for dimensional tolerance or avoiding intersection with column flanges).\",\n      \"validRange\": \"0\\\" to 1.0\\\"\",\n      \"unit\": \"Length\",\n      \"affectsOutput\": \"Shortens the length of the beam on both ends (Total Length = Gap * 2).\"\n    },\n    {\n      \"name\": \"psStagger (1-6)\",\n      \"technicalDefault\": \"arStagger[0] (None)\",\n      \"businessMeaning\": \"Determines if blocking in adjacent openings is offset vertically to align with studs for easier nailing.\",\n"
      },
      "tokens_used": 9190,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Initialize: Detect available Equivalent Stories in the model and populate property lists.",
          "2. Insert: Check insert cycle count. If duplicate (>1), erase self and exit.",
          "3. Input: Display properties dialog to user.",
          "4. Branch Selection (piStory):",
          "   [Manual (-1)]: Prompt user to pick specific ElementWalls.",
          "   [Story (Index)]: Iterate model to find all walls in the specified Equivalent Story.",
          "5. Interaction: Prompt user for a text display location point (_Pt0).",
          "6. Validation: Check if any elements were selected. If list is empty, report error and erase instance.",
          "7. Existing Cleanup: If 'Remove Existing' is Yes, find existing blocking beams in selected walls and mark for deletion.",
          "8. Generation Loop (Executed on Create or 'Regenerate'):",
          "   a. Delete previously generated beams (managed by this script).",
          "   b. Iterate through 6 defined Blocking configurations.",
          "   c. For each active configuration (Amount > 0):",
          "      i. Iterate through selected Wall Elements.",
          "      ii. Calculate void profile (Wall shape minus Stud shapes).",
          "      iii. Slice profile at configured 'Height Position'.",
          "      iv. Filter segments: Remove segments shorter than 'Min Length' or outside stud vertical range.",
          "      v. Calculate beam geometry (Size, Face offset, Stagger offset).",
          "      vi. Create GenBeam entities.",
          "      vii. Handle 'Front and Back' face logic via mirroring if required.",
          "9. Finalize: Assign beams to wall groups and draw status text."
        ],
        "conditionalBranches": [
          {
            "condition": "Selection Mode (piStory property)",
            "path1": {
              "name": "Manual Mode (-1)",
              "steps": [
                "Prompt user with PrEntity to select walls.",
                "Append valid selections to _Element array."
              ]
            },
            "path2": {
              "name": "Story Mode (Index)",
              "steps": [
                "Iterate through all Element Groups.",
                "Check if group Equivalent Story ID matches piStory.",
                "Append linked Elements to _Element array."
              ]
            }
          },
          {
            "condition": "Wall Face Configuration (psFace property)",
            "path1": {
              "name": "Single Layer (Front, Back, Middle)",
              "steps": [
                "Calculate Z-offset based on single face selection.",
                "Create one beam per valid segment."
              ]
            },
            "path2": {
              "name": "Double Layer (Front and Back)",
              "steps": [
                "Create primary beam at calculated offset.",
                "Mirror primary beam across wall centerline.",
                "Create secondary beam (unless total width exceeds wall thickness, in which case defaults to Middle)."
              ]
            }
          },
          {
            "condition": "Dimensional Orientation (Height vs Width)",
            "path1": {
              "name": "Vertical (Height > Width)",
              "steps": [
                "Assign Height dimension to Wall Y-axis.",
                "Assign Width dimension to Wall Z-axis."
              ]
            },
            "path2": {
              "name": "Horizontal/Flat (Width > Height)",
              "steps": [
                "Swap dimensions: Assign Height to Wall Z-axis.",
                "Swap dimensions: Assign Width to Wall Y-axis."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None (Silent)",
            "recovery": "Script automatically erases the instance if insertCycleCount() > 1 to prevent duplicate logic execution during copy/paste operations."
          },
          {
            "check": "Element Availability",
            "errorMessage": "NA_WALL_BLOCKING_BY_STORY: No Element found. Erasing this instance.",
            "recovery": "Script instance is erased. User must ensure walls exist or the correct Story Index is selected."
          },
          {
            "check": "Segment Minimum Length",
            "errorMessage": "None (Silent)",
            "recovery": "Calculated blocking segments shorter than 'pdMinLen' (minus gaps) are discarded and not generated."
          },
          {
            "check": "Width Validity",
            "errorMessage": "None (Silent)",
            "recovery": "If width is 0 or smaller than shrinkage, it defaults to wall thickness. If 'Front and Back' combined width exceeds wall thickness, it reverts to 'Middle' alignment."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Regenerate Blocking Beams",
            "how": "Right-click Context Menu -> 'Regenerate Blocking Beams'",
            "effect": "Clears existing beams generated by this instance and runs the creation logic again using the current property values. Required for property changes to take effect."
          },
          {
            "action": "Update Configuration",
            "how": "Properties Palette (OPM)",
            "effect": "Modify dimensions, heights, or amounts. Changes are pending until 'Regenerate Blocking Beams' is triggered."
          },
          {
            "action": "Delete All",
            "how": "Right-click Context Menu -> 'Erase This Instance and Beams'",
            "effect": "Removes the TSL instance object and all generated blocking beams associated with it from the drawing."
          }
        ]
      },
      "tokens_used": 10254,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# NA_WALL_BLOCKING_BY_STORY\n\n## Overview\nAutomates the generation of wall blocking (such as bridging, fire stops, or nailing backers) based on selected building stories or manual wall selection. It allows for up to six unique blocking configurations with varying heights, sizes, and positions within a wall.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates directly on wall elements in 3D model space. |\n| Paper Space | No | Not designed for layout views or 2D drawings. |\n| Shop Drawing | No | Does not generate shop drawing annotations. |\n\n## Prerequisites\n- **Required Entities**: ElementWall entities must exist in the model.\n- **Group Structure**: Walls must be organized in Groups (assigned to an Equivalent Story) to use the Story selection mode.\n- **Minimum Beams**: None (Script creates beams, does not require pre-existing ones).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT` â†’ Select `NA_WALL_BLOCKING_BY_STORY.mcr`\nThe script will load into the drawing.\n\n### Step 2: Configure Properties\n**Action**: Select the script instance and open the **Properties Palette** (Ctrl+1).\n**Action**: Set the **Story Index** property.\n- If you want to select specific walls manually, leave this at `-1`.\n- If you want to process an entire floor/story, select the corresponding Index number (e.g., 1 for Story 1).\n\n### Step 3: Select Walls (Manual Mode Only)\n*Skip this step if Story Index is set to a number greater than -1.*\n```\nCommand Line: Select ElementWall(s):\nAction: Click on the specific walls you want to add blocking to. Press Enter to confirm selection.\n```\n\n### Step 4: Place Text Label\n```\nCommand Line: Give point for text:\nAction: Click in the model space to define where the status text (displaying the script name and settings) will appear.\n```\n\n### Step 5: Review Generation\nThe script will automatically generate the blocking beams based on the default or modified configuration parameters. If you make changes later, see the Right-Click Menu options below.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Story Index** | Integer | -1 | Selects the building level (Equivalent Story) to process. Set to -1 to manually select walls. |\n| **Min Length** | Length | 4\" | The minimum length a piece of blocking must be. Segments shorter than this are ignored. |\n| **Remove Existing** | Yes/No | Yes | If \"Yes\", deletes previously generated blocking beams associated with these walls before creating new ones. |\n| **Amount (1-6)** | Integer | 0 | Number of rows of blocking to generate for this specific configuration group. |\n| **Height Pos (1-6)** | Length | 0\" | The vertical elevation (from the bottom of the wall) where the *highest* row of this group is placed. |\n| **Height (1-6)** | Length | 0\" | The vertical dimension (Y-axis) of the blocking board. |\n| **Width (1-6)** | Length | 0\" | The thickness (Z-axis) of the blocking board. |\n| **Face (1-6)** | Enum | Front/Back | Placement relative to the wall centerline: Front, Back, Middle, or both Front and Back. |\n| **Gap (1-6)** | Length | 0\" | Clearance cut from each end of the blocking (e.g., for dimensional tolerance). |\n| **Stagger (1-6)** | Enum | None | Offsets blocking in adjacent openings to align with studs for easier nailing. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Regenerate Blocking Beams** | Clears existing blocking created by this instance and runs the generation logic again. Use this after changing properties in the palette. |\n| **Erase This Instance and Beams** | Removes the TSL instance and all generated blocking beams associated with it from the drawing. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not rely on external XML settings files; all configuration is managed via the Properties Palette.\n\n## Tips\n- **Story Organization**: To utilize the Story Index effectively, ensure your Element Groups are assigned the correct \"Equivalent Story\" mapping in your project setup.\n- **Small Gaps**: If you see blocking missing in small gaps between studs, increase the **Min Length** property to a smaller value (e.g., 2\").\n- **Double Blocking**: Setting the **Face** property to \"Front and Back\" is useful for drywall backing where nailing surfaces are needed on both sides of the wall, but ensure your **Width** settings do not exceed the total wall thickness.\n\n## FAQ\n- **Q: I changed the Height properties, but the blocking didn't move.**\n  - A: Changes in the Properties Palette do not update automatically. You must Right-Click the script instance and select **Regenerate Blocking Beams**.\n- **Q: Why is no blocking generated?**\n  - A: Check the **Amount** property; if it is set to 0, no rows will be created. Also, verify that the **Height Pos** is actually within the vertical height of your wall.\n- **Q: Can I use this on curved walls?**\n  - A: The script is designed for ElementWalls. While it calculates geometry based on the wall profile, complex curves might result in blocking segments that are shorter than your **Min Length** setting.\n- **Q: What does \"Manual Mode\" (-1) do?**\n  - A: It allows you to pick and choose which walls get blocking, rather than applying it to every wall in a specific Story/Index."
      },
      "tokens_used": 6319,
      "error": null
    }
  }
}