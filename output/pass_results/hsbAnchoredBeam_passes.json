{
  "filename": "hsbAnchoredBeam.mcr",
  "status": "completed",
  "total_tokens": 51491,
  "processing_time": 258.32242584228516,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "26aug2020",
            "author": "geoffroy.cenni@hsbcad.com",
            "changes": " optimized for vertical joists "
          },
          {
            "version": "1.0",
            "date": "25may2020",
            "author": "geoffroy.cenni@hsbcad.com",
            "changes": " initial "
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8431,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No 'sd_' or 'Multipage' prefix found. No usage of '_Viewport'. No '#Type E' or '_Entity' arrays. Script interacts with GenBeam objects (joist, post) and performs 3D geometry operations (Cut, Slot, DoubleCut, Body intersection). The 'Hardware' region creates HardWrComp objects. All these indicate a 3D model generation context."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5806,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert && _kExecuteKey.length()==0\",\n        \"required\": false\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getBeam\",\n        \"promptOriginal\": \"|Please select joist|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"getBeam\",\n        \"promptOriginal\": \"|Please select post|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"dChamferWidth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Chamfer Width|\",\n      \"defaultValue\": 57.0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the Chamfer Width|\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dShoulder\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Shoulder Width|\",\n      \"defaultValue\": 30.0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the Shoulder Width|\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"nLocksAmount\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Amount|\",\n      \"defaultValue\": 1,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        1,\n        2,\n        3,\n        4\n      ],\n      \"category\": \"|Slot|\",\n      \"description\": \"|Defines the Amount|\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dLocksExtraDepth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Depth in Post|\",\n      \"defaultValue\": 10.0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Slot|\",\n      \"description\": \"|Defines the Depth in Post|\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"dLocksWidthHeight\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Width and Height|\",\n      \"defaultValue\": 40.0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Slot|\",\n      \"description\": \"|Defines the Width and Height|\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"dTenonHeight\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Height|\",\n      \"defaultValue\": 180.0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Tenon|\",\n      \"description\": \"|Defines the Height|\"\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"dTenonWidth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Width|\",\n      \"defaultValue\": 60.0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Tenon|\",\n      \"description\": \"|Defines the Width|\"\n    },\n    {\n      \"index\": 6,\n      \"variable\": \"dTenonLength\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Length|\",\n      \"defaultValue\": 360.0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Tenon|\",\n      \"description\": \"|Defines the Length|\"\n    },\n    {\n      \"index\": 7,\n      \"variable\": \"dTenonHeightExtra\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Height Tolerance|\",\n      \"defaultValue\": 2.0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Tenon|\",\n      \"description\": \"|Defines the Height Tolerance|\"\n    },\n    {\n      \"index\": 8,\n      \"variable\": \"dTenonWidthExtra\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Width Tolerance|\",\n      \""
      },
      "tokens_used": 10169,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Generates a timber connection consisting of a tenoned joist inserted into a post, featuring chamfered tenon tips, reinforcing dowel slots, and a corresponding mortise in the post.\",\n    \"category\": \"Joinery/TimberFrame\",\n    \"typicalUseCase\": \"Creating traditional or heavy timber beam-to-column connections where a joist meets a post perpendicularly, often using wooden dowels (locks) for shear resistance.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"dChamferWidth\",\n      \"technicalDefault\": 57.0,\n      \"businessMeaning\": \"The length of the 45-degree bevel cut at the top and bottom edges of the tenon tip.\",\n      \"validRange\": \"10mm to Joist Height/2\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Alters the geometry of the joist end, making assembly easier and reducing the risk of splintering on the tenon corners.\"\n    },\n    {\n      \"name\": \"dShoulder\",\n      \"technicalDefault\": 30.0,\n      \"businessMeaning\": \"The depth of the relief cut machined into the post face to accommodate the joist shoulder or connection zone.\",\n      \"validRange\": \"0mm to Post Depth\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Adjusts the position of a double-cut on the post, effectively creating a housing or recess for the joist connection.\"\n    },\n    {\n      \"name\": \"nLocksAmount\",\n      \"technicalDefault\": 1,\n      \"businessMeaning\": \"The number of reinforcing dowels (locks) to be cut through the tenon.\",\n      \"validRange\": \"1 to 4 (or as space permits)\",\n      \"unit\": \"count\",\n      \"affectsOutput\": \"Determines how many slot/cuts are made through the joist tenon and generates the corresponding hardware items for the BOM.\"\n    },\n    {\n      \"name\": \"dLocksExtraDepth\",\n      \"technicalDefault\": 10.0,\n      \"businessMeaning\": \"The additional depth of the dowel slots beyond the standard width/height, cutting into the face of the tenon.\",\n      \"validRange\": \"0mm to Joist Width/2\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Increases the length of the dowel slots in the joist, ensuring proper engagement or clearance for the dowel.\"\n    },\n    {\n      \"name\": \"dLocksWidthHeight\",\n      \"technicalDefault\": 40.0,\n      \"businessMeaning\": \"The diameter (width and height) of the round or square dowels being used.\",\n      \"validRange\": \"15mm to 80mm (common dowel sizes)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Scales the size of the slots cut in the joist and the holes required in the post.\"\n    },\n    {\n      \"name\": \"dTenonHeight\",\n      \"technicalDefault\": 180.0,\n      \"businessMeaning\": \"The vertical height of the tenon projection (the end of the beam that enters the post).\",\n      \"validRange\": \"Joist Height/3 to Joist"
      },
      "tokens_used": 10904,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script (hsbAnchoredBeam)",
          "Check for Catalog/Key Insert (_kExecuteKey)",
          "Show Property Dialog (if not using catalog/key)",
          "User Inputs: Chamfer Width, Shoulder Width, Slot Amount, Slot Depth, Slot Width/Height, Tenon Dimensions",
          "Prompt User: Select Joist (Beam 1)",
          "Prompt User: Select Post (Beam 2)",
          "Validate Beams: Check for Perpendicularity (Joist vs Post)",
          "Validate Alignment: Check for intersection between Joist and Post",
          "Calculate Geometry: Local Coordinate System, Vectors",
          "Apply Joist Modifications: Extend Joist, Cut Chamfers, Cut Tenon Sides/Height",
          "Apply Post Modifications: Shoulder DoubleCut, Mortise Slot",
          "Calculate and Cut Dowel Locks (Slots in Joist)",
          "Generate Hardware Components (BOM entries)",
          "Visualize Anchor Symbol"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Mode (Catalog vs Manual)",
            "path1": {
              "name": "Catalog/Key Insert",
              "steps": [
                "Check if _kExecuteKey is set",
                "Load properties from specified Catalog entry or Last Inserted",
                "Skip Dialog"
              ]
            },
            "path2": {
              "name": "Manual Insert",
              "steps": [
                "Execute showDialog()",
                "User inputs properties manually"
              ]
            }
          },
          {
            "condition": "Lock Amount Calculation",
            "path1": {
              "name": "User specified locks fit",
              "steps": [
                "Calculate distribution based on User Amount (nLocksAmount)",
                "Cut slots in Joist"
              ]
            },
            "path2": {
              "name": "Too many locks for Tenon Height",
              "steps": [
                "Calculate maximum physical locks (iMaxLock)",
                "If User Amount > Max Amount, Report Warning",
                "Auto-correct nLocksAmount to iMaxLock",
                "Re-run execution loops to update geometry"
              ]
            }
          },
          {
            "condition": "Tenon Height vs Joist Height",
            "path1": {
              "name": "Partial Tenon",
              "steps": [
                "dTenonHeight < dHeight",
                "Calculate Top/Bottom cuts for Tenon height"
              ]
            },
            "path2": {
              "name": "Full Tenon",
              "steps": [
                "dTenonHeight >= dHeight",
                "Set dTenonHeight to dHeight",
                "No vertical cuts needed for tenon reduction"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Joist and Post Perpendicularity",
            "errorMessage": "Selected post and joist are not perpendicular.",
            "recovery": "Select beams that are orthogonal (approx 90 degrees)."
          },
          {
            "check": "Beam Intersection (Envelope Check)",
            "errorMessage": "Selected bodies do not intersect fully.",
            "recovery": "Ensure the Joist is positioned correctly to penetrate the Post volume."
          },
          {
            "check": "Beam Intersection (General)",
            "errorMessage": "Selected bodies do not intersect.",
            "recovery": "Move Joist so it overlaps with the Post."
          },
          {
            "check": "Lock Capacity",
            "errorMessage": "Maximum allowed locks for current height is: [iMaxLock]",
            "recovery": "Script automatically reduces the amount. User can reduce Tenon Height or increase Lock Diameter manually via OPM if desired."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Parameters via OPM",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Updates Chamfer, Shoulder, Slot dimensions, and Tenon geometry immediately upon change."
          },
          {
            "action": "Stretch/Move Beam",
            "how": "Grip Edit / Move command",
            "effect": "If _kStretchOnToolChange is active (for extension), the tenon updates. If geometry alignment breaks, script may error."
          },
          {
            "action": "Update Hardware Quantity",
            "how": "Modify 'nLocksAmount' property",
            "effect": "Updates BOM quantity for the Lock component and adds/removes slot cuts in the model."
          }
        ]
      },
      "tokens_used": 9475,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbAnchoredBeam.mcr\n\n## Overview\nThis script automates the creation of a traditional timber frame connection between a joist and a post. It generates a tenoned joist with chamfered tips, reinforcing dowel slots (locks), and creates the corresponding mortise and shoulder cuts in the post.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script creates 3D geometry (cuts, bodies, and hardware). |\n| Paper Space | No | Not designed for 2D drawings. |\n| Shop Drawing | No | Not a shop drawing generation script. |\n\n## Prerequisites\n- **Required Entities:** Two GenBeam entities (one Joist and one Post).\n- **Minimum Beam Count:** 2\n- **Geometry Requirements:**\n  - The joist and post must be perpendicular (approximately 90 degrees).\n  - The joist and post must physically intersect in 3D space.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT`\n**Action:** Browse and select `hsbAnchoredBeam.mcr`.\n\n### Step 2: Configure Properties (Optional)\nIf running in manual mode (not from a catalog), a property dialog may appear, or you can rely on default settings.\n**Action:** Adjust settings like Chamfer Width, Tenon dimensions, or the number of dowel locks if necessary. You can also change these later in the Properties Palette.\n\n### Step 3: Select Joist\n```\nCommand Line: Please select joist\nAction: Click on the horizontal beam (the joist) that will be tenoned.\n```\n\n### Step 4: Select Post\n```\nCommand Line: Please select post\nAction: Click on the vertical beam (the post) that will receive the mortise.\n```\n\n### Step 5: Validation and Generation\n**Action:** The script checks if the beams are perpendicular and intersecting. If valid, it cuts the tenon into the joist, drills/mills the dowel slots, cuts the mortise into the post, and adds hardware to the BOM.\n\n## Properties Panel Parameters\n\n### General\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Chamfer Width | Number | 57.0 mm | Defines the length of the 45° bevel cut at the top and bottom of the tenon tip. |\n| Shoulder Width | Number | 30.0 mm | Defines the depth of the relief cut (housing) on the post face to accommodate the joist shoulder. |\n\n### Slot (Dowel Locks)\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Amount | Dropdown | 1 | The number of reinforcing dowels (locks) to cut through the tenon (Max 4). |\n| Depth in Post | Number | 10.0 mm | The additional depth of the dowel slots beyond the standard size, cutting into the face of the tenon. |\n| Width and Height | Number | 40.0 mm | The size (diameter) of the round or square dowels being used. |\n\n### Tenon\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Height | Number | 180.0 mm | The vertical height of the tenon projection. |\n| Width | Number | 60.0 mm | The horizontal width of the tenon. |\n| Length | Number | 360.0 mm | The length of the tenon (penetration depth into the post). |\n| Height Tolerance | Number | 2.0 mm | The vertical clearance/gap allowance for the tenon. |\n| Width Tolerance | Number | 2.0 mm | The horizontal clearance/gap allowance for the tenon. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Erase | Removes the script and attempts to repair the beams to their original state (if supported). |\n| Properties | Opens the AutoCAD Properties Palette to edit parameters. |\n\n## Settings Files\n- **Filename:** None detected.\n- **Location:** N/A\n- **Purpose:** This script appears to use internal default properties or OPM inputs rather than external XML settings files.\n\n## Tips\n- **Perpendicularity:** Ensure your joist is perfectly orthogonal (90°) to the post before running the script. If not, the script will report an error.\n- **Intersection:** The joist must physically overlap the post volume. If it is just touching the edge, the script may fail to detect the intersection.\n- **Lock Limits:** If you request more dowel locks than can physically fit in the tenon height, the script will automatically reduce the number to the maximum possible amount and issue a warning.\n- **Editing:** You can modify dimensions (like Tenon Height or Chamfer Width) via the Properties Palette (Ctrl+1) after insertion to tweak the connection.\n\n## FAQ\n- **Q: The script fails with \"Selected post and joist are not perpendicular.\"**\n  - **A:** Check your UCS or use the `LIST` command to verify the beams are at exactly 90 degrees to each other. Rotate one beam slightly to correct this.\n- **Q: The script fails with \"Selected bodies do not intersect.\"**\n  - **A:** The joist needs to be moved so it passes through the post. Use the `MOVE` command to slide the joist deeper into the post.\n- **Q: I asked for 4 locks, but only 2 were cut.**\n  - **A:** The tenon height is too small to fit 4 locks of the specified diameter. Reduce the `Width and Height` of the locks or increase the `Tenon Height`."
      },
      "tokens_used": 6706,
      "error": null
    }
  }
}