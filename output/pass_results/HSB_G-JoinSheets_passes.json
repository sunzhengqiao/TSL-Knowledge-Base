{
  "filename": "HSB_G-JoinSheets.mcr",
  "status": "completed",
  "total_tokens": 22641,
  "processing_time": 232.98405027389526,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "26.09.2016",
            "author": "",
            "changes": "Pilot version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4682,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity with Sheet() to select 3D construction entities. It performs geometric operations (intersect, union) on PlaneProfile and calls Sheet.dbJoin(). No usage of _Viewport, sd_ prefixes, or 2D drawing entities."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sheet"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space with at least two valid Sheet entities selected.",
          "requiredSettings": []
        }
      },
      "tokens_used": 1674,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && (no execute key or execute key not in catalog)",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select sheets|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Properties Dialog",
            "trigger": "Insertion (if not run via Execute Key)",
            "title": null,
            "dataSource": "Instance Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "joinTolerance",
            "type": "PropDouble",
            "displayName": "|Tolerance|",
            "defaultValue": "U(1)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2456,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Merges adjacent Sheet entities (e.g., CLT panels or sheathing) into single entities to close small gaps and unify production data.",
          "category": "Joining/Model Cleanup",
          "typicalUseCase": "Used when a floor or wall assembly is modeled with multiple separate pieces that represent a single physical panel, or when imported geometry contains small gaps that need to be eliminated for manufacturing."
        },
        "parameters": [
          {
            "name": "joinTolerance",
            "technicalDefault": "U(1)",
            "businessMeaning": "The maximum permissible distance between sheet edges for them to be considered joined. The script virtually expands the sheet profiles by this amount to detect if they should be treated as a single piece despite small modeling gaps.",
            "validRange": "0 mm to 20 mm",
            "unit": "mm",
            "affectsOutput": "Determines which sheets are merged. A higher value will bridge larger gaps between sheets, combining them into one entity. A lower value requires sheets to be touching or almost touching to join."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "Sheet (Modified)",
            "description": "The resulting Sheet entity is a geometric union of the original profiles, combining separate items into a single manufacturing unit.",
            "appliedTo": "The selected Sheet entities (the first valid sheet in a pair absorbs the geometry of the adjacent sheet)."
          }
        ]
      },
      "tokens_used": 4114,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Check if insertCycleCount > 1. If true, erase script and exit (safety mechanism).",
          "2. Property Configuration: Check for Execute Key. If present/valid, load settings; else, display Properties Dialog.",
          "3. Entity Selection: Prompt user to select Sheets using PrEntity.",
          "4. Validation: Check if any sheets were selected.",
          "5. Initialization: Set script insertion point to the center of the first selected sheet.",
          "6. Loop Iteration: Iterate through all selected sheets (s1). For each sheet, iterate through all subsequent sheets (s2) to find pairs.",
          "7. Geometric Validation: Verify if the pair (s1, s2) meets criteria: Parallel Z-vectors, Coplanar alignment, Equal thickness.",
          "8. Intersection Check: Check if expanded profiles (accounting for 'joinTolerance') intersect.",
          "9. Execution: If all checks pass, join Sheet s2 into Sheet s1 (merging geometry).",
          "10. Termination: Erase script instance from the drawing."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "Recursive Execution",
              "steps": [
                "Script detects insertCycleCount > 1",
                "Script calls eraseInstance()",
                "Script returns immediately"
              ]
            },
            "path2": {
              "name": "First Execution",
              "steps": [
                "Proceed to Property Configuration",
                "Check for Execute Key"
              ]
            }
          },
          {
            "condition": "Input Source",
            "path1": {
              "name": "Execute Key Used",
              "steps": [
                "Script finds execute key in catalog",
                "Properties loaded from catalog",
                "Dialog skipped"
              ]
            },
            "path2": {
              "name": "Manual Insert",
              "steps": [
                "No execute key found",
                "ShowDialog() is called",
                "User sets 'joinTolerance' manually"
              ]
            }
          },
          {
            "condition": "Selection Validation",
            "path1": {
              "name": "Invalid Selection",
              "steps": [
                "_Sheet array length is 0",
                "Report warning: 'invalid or no sheets selected.'",
                "Erase script instance"
              ]
            },
            "path2": {
              "name": "Valid Selection",
              "steps": [
                "Proceed to Looping Logic"
              ]
            }
          },
          {
            "condition": "Join Criteria (Inside Loop)",
            "path1": {
              "name": "Sheets Join",
              "steps": [
                "Vectors are Parallel",
                "Sheets are Coplanar (within tolerance)",
                "Thicknesses match",
                "Expanded profiles intersect",
                "Execute sh1.dbJoin(sh2)",
                "Update sh1 profile shape"
              ]
            },
            "path2": {
              "name": "Sheets Separate",
              "steps": [
                "Any geometric condition fails",
                "Continue to next pair (s2+1)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Count",
            "errorMessage": "|invalid or no sheets selected.|",
            "recovery": "User must re-run the script and ensure at least one Sheet entity is selected."
          },
          {
            "check": "Sheet Validity",
            "errorMessage": "None (Internal skip)",
            "recovery": "Script automatically skips sheets where bIsValid() returns false."
          },
          {
            "check": "Plane Parallelism",
            "errorMessage": "None (Internal skip)",
            "recovery": "Sheets must have parallel Z-vectors to be considered for joining."
          },
          {
            "check": "Coplanarity",
            "errorMessage": "None (Internal skip)",
            "recovery": "Sheets must lie in the same plane (within pointTolerance)."
          },
          {
            "check": "Thickness Consistency",
            "errorMessage": "None (Internal skip)",
            "recovery": "Sheets must have the same 'solidHeight' (within tolerance)."
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 5252,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-JoinSheets.mcr\n\n## Overview\nThis script merges adjacent Sheet entities (such as CLT panels or sheathing) into single entities. It is used to close small gaps and unify production data for floor or wall assemblies.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D construction entities. |\n| Paper Space | No | Not designed for 2D drawing views. |\n| Shop Drawing | No | Not designed for detailing views. |\n\n## Prerequisites\n- **Required Entities**: At least two Sheet entities selected.\n- **Minimum Count**: 2 Sheets.\n- **Required Settings**: None (uses internal tolerance parameters).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_G-JoinSheets.mcr`\n\n### Step 2: Set Properties (If applicable)\n```\nDialog: Properties Palette (or Insert Dialog)\nAction: Set the 'Tolerance' value if you need to bridge gaps larger than 1mm.\n```\n\n### Step 3: Select Sheets\n```\nCommand Line: |Select sheets|\nAction: Select the sheets you wish to merge and press Enter.\n```\n\n### Step 4: Automatic Processing\nThe script will automatically detect which sheets are parallel, coplanar, and within the specified tolerance distance. It will then merge them into single entities. The script instance will erase itself upon completion.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Tolerance | Number | 1 mm | The maximum permissible distance between sheet edges for them to be considered joined. The script virtually expands the sheet profiles by this amount to bridge gaps. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific items to the right-click context menu. |\n\n## Settings Files\nNone required. This script operates using standard instance properties.\n\n## Tips\n- **Check Thickness**: Ensure that the sheets you want to join have the same thickness. The script will not join sheets of different depths.\n- **Alignment**: Sheets must be parallel and lie in the same plane (flush) for the join to work.\n- **Tolerance Adjustment**: If you have small modeling gaps (e.g., 2mm gaps between panels), increase the `Tolerance` parameter to slightly more than the gap size before running the script.\n- **Selection Order**: The script iterates through selected pairs. It is generally best to select all sheets in the specific area you want to merge at once.\n\n## FAQ\n- **Q: Why did my sheets not merge?**\n  **A:** Check that the sheets are the same thickness, that their surfaces are flush (coplanar), and that the gap between them is smaller than the `Tolerance` setting.\n- **Q: What happens to the original sheets?**\n  **A:** The geometry of the second sheet is absorbed into the first sheet. The script instance deletes itself after running.\n- **Q: Can I use this to join floor panels to wall panels?**\n  **A:** No, the sheets must be parallel and coplanar (in the same plane)."
      },
      "tokens_used": 4463,
      "error": null
    }
  }
}