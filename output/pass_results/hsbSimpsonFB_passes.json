{
  "filename": "hsbSimpsonFB.mcr",
  "status": "completed",
  "total_tokens": 49340,
  "processing_time": 335.9011068344116,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "24/06/2024",
            "author": "Marsel Nakuci",
            "changes": "HSB-20925: Add offset below property; add text size property; support xml"
          },
          {
            "version": "1.0",
            "date": "24.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5442 initial"
          }
        ],
        "settingsFiles": [
          "hsbSimpsonFB.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 7747,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script collects entities from '_kModelSpace' in the 'getTslsByName' function and generates 3D geometry using 'Body' objects. Hardware components are attached to a 'GenBeam' entity. There is no usage of ShopDrawing specific prefixes like 'sd_*', viewport checks, or paper space entities."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbSimpsonFB.xml"
          ]
        }
      },
      "tokens_used": 5639,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sGroupAssignment",
            "type": "PropString",
            "displayName": "|Group Assignment|",
            "defaultValue": "<|Default|>",
            "inputType": "dropdown",
            "options": [
              "<|Default|>",
              "|No group assigment|"
            ],
            "category": "GlobalSettings",
            "description": "Defines to layer to assign the instance, <|Default|> = byEntity"
          },
          {
            "index": 1,
            "variable": "sProductCode",
            "type": "PropString",
            "displayName": "|Product Code|",
            "defaultValue": "FB",
            "inputType": "dropdown",
            "options": [
              "FB",
              "FB20A",
              "FB20S"
            ],
            "category": "|General|",
            "description": "Defines the ProductCode"
          },
          {
            "index": 0,
            "variable": "dLengthOverall",
            "type": "PropDouble",
            "displayName": "|Length Overall|",
            "defaultValue": "U(80)",
            "inputType": "number",
            "category": "|General|",
            "description": "Defines the Overall Length of the band"
          },
          {
            "index": 1,
            "variable": "dLengthBend",
            "type": "PropDouble",
            "displayName": "|Length Bend|",
            "defaultValue": "U(60)",
            "inputType": "number",
            "category": "|General|",
            "description": "Defines the bend Length at the bottom"
          },
          {
            "index": 2,
            "variable": "dOffsetBelow",
            "type": "PropDouble",
            "displayName": "|Offset Below|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "category": "|Position|",
            "description": "Defines the Offset below the wall"
          },
          {
            "index": 3,
            "variable": "dTextHeight",
            "type": "PropDouble",
            "displayName": "|Text Height|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "category": "|Display|",
            "description": "Defines the TextHeight"
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "hsbSimpsonFB.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings"
            ],
            "purpose": "Provides product configuration, fixture definitions, version control, and map settings.",
            "required": true
          }
        ]
      },
      "tokens_used": 9896,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 3D model and BOM entries for a Simpson Strong-Tie style Face Mount (FB) bracket, connecting a timber beam or stud to a floor/foundation.",
          "category": "Hardware",
          "typicalUseCase": "Anchoring the bottom of wall studs or columns to concrete foundations or sole plates to resist uplift and lateral loads."
        },
        "parameters": [
          {
            "name": "sGroupAssignment",
            "technicalDefault": "<|Default|>",
            "businessMeaning": "Determines the CAD layer management strategy for the instance, either inheriting from the attached entity or using a specific group.",
            "validRange": "<|Default|>, |No group assigment|",
            "unit": "String",
            "affectsOutput": "Layer and Group properties of the TSL instance in the CAD model."
          },
          {
            "name": "sProductCode",
            "technicalDefault": "FB",
            "businessMeaning": "Selects the specific bracket model and material finish (Galvanized vs Stainless).",
            "validRange": "FB, FB20A, FB20S",
            "unit": "String",
            "affectsOutput": "Geometry width, thickness, material type, and BOM description. 'FB' and 'FB20A' are Galvanized; 'FB20S' is Stainless Steel."
          },
          {
            "name": "dLengthOverall",
            "technicalDefault": "U(80)",
            "businessMeaning": "The total height of the bracket (vertical length + bend length).",
            "validRange": "60mm to 500mm",
            "unit": "mm",
            "affectsOutput": "Determines the height of the vertical leg of the bracket and the BOM length attribute."
          },
          {
            "name": "dLengthBend",
            "technicalDefault": "U(60)",
            "businessMeaning": "The length of the horizontal foot (flange) that sits on the floor or foundation.",
            "validRange": "40mm to 200mm",
            "unit": "mm",
            "affectsOutput": "Determines the length of the horizontal base plate geometry."
          },
          {
            "name": "dOffsetBelow",
            "technicalDefault": "U(0)",
            "businessMeaning": "Vertical adjustment to shift the bracket downwards relative to the insertion point on the beam.",
            "validRange": "-50mm to 200mm",
            "unit": "mm",
            "affectsOutput": "Vertical position of the 3D body relative to the host timber element."
          },
          {
            "name": "dTextHeight",
            "technicalDefault": "U(0)",
            "businessMeaning": "Controls the visibility and size of the text label displaying the Product Code.",
            "validRange": "0mm to 20mm (0 = disabled)",
            "unit": "mm",
            "affectsOutput": "Size of the text annotation in the 3D model and drawings."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change in dLengthOverall or dLengthBend",
            "effect": "The height of the vertical section is recalculated as (dLengthOverall - dLengthBend).",
            "cascade": [
              "Vertical Body Geometry"
            ]
          },
          {
            "trigger": "Change in sProductCode",
            "effect": "Updates width, thickness, and material properties for the 3D body and BOM entry.",
            "cascade": [
              "dWidth",
              "dThickness",
              "sMaterial"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "MetalPart",
            "description": "A folded L-shaped metal plate (Face Mount bracket) representing the Simpson FB profile, mirrored across the insertion plane.",
            "appliedTo": "ModelSpace (associated with a selected GenBeam)"
          },
          {
            "type": "Hardware",
            "description": "BOM entries for the main bracket, associated fixers (Nails, Anchors, Washers).",
            "appliedTo": "Associated GenBeam"
          },
          {
            "type": "TextAnnotation",
            "description": "Text label displaying the Product Code (if dTextHeight > 0).",
            "appliedTo": "ModelSpace"
          }
        ]
      },
      "tokens_used": 9399,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch / Recalc Triggered",
          "Check DialogMode (Property Palette Definition)",
          "If Insert Mode: Select GenBeam entity from Model Space",
          "If Insert Mode: Select insertion point/origin",
          "Validate attached GenBeam (Erase instance if invalid)",
          "Load Settings (hsbSimpsonFB.xml) or apply hardcoded defaults",
          "Determine Geometry Parameters (Width, Thickness) based on Product Code",
          "Calculate Local Coordinate System (Origin based on Offset, X/Y/Z vectors)",
          "Generate Horizontal Bottom Flange (Body)",
          "[Conditional] Generate Vertical Face Flange (Body) if height > 0",
          "Generate Mirrored Geometry for opposite side of beam",
          "[Conditional] Draw Product Code Text if Text Height > 0",
          "Construct Hardware BOM Entries (Main Bracket + Fixers: Nails, Anchors, Washers)",
          "Update 3D Visualization and BOM Lists"
        ],
        "conditionalBranches": [
          {
            "condition": "DialogMode equals 4",
            "path1": {
              "name": "Property Definition Mode",
              "steps": [
                "Define OPM properties (Group Assignment, Product Code, Dimensions)",
                "Return immediately (skip geometry generation)"
              ]
            },
            "path2": {
              "name": "Execution Mode",
              "steps": [
                "Proceed to Geometry Generation"
              ]
            }
          },
          {
            "condition": "Settings file availability (hsbSimpsonFB.xml)",
            "path1": {
              "name": "XML Configuration Found",
              "steps": [
                "Read Product Codes, Widths, and Thicknesses from XML Map",
                "Use 'DScaleY' and 'DScaleZ' from XML for geometry"
              ]
            },
            "path2": {
              "name": "XML Not Found (Hardcoded Fallback)",
              "steps": [
                "Use internal array defaults: dWidths=[20,20,20], dThicknesses=[0.9,0.9,1.0]",
                "Default Product Codes: FB, FB20A, FB20S"
              ]
            }
          },
          {
            "condition": "Vertical Height Calculation (dLengthOverall - dLengthBend) > 0",
            "path1": {
              "name": "Vertical Part Exists",
              "steps": [
                "Create Body for vertical face section",
                "Union with horizontal base body"
              ]
            },
            "path2": {
              "name": "No Vertical Part",
              "steps": [
                "Skip vertical body creation",
                "Proceed with only horizontal base geometry"
              ]
            }
          },
          {
            "condition": "Text Height (dTextHeight) > 0",
            "path1": {
              "name": "Text Visible",
              "steps": [
                "Calculate text position relative to bracket",
                "Display Product Code label in 3D"
              ]
            },
            "path2": {
              "name": "Text Hidden",
              "steps": [
                "Skip text generation"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Valid GenBeam attachment",
            "errorMessage": "Script erases instance silently",
            "recovery": "User must re-insert script and select a valid GenBeam/Structural member"
          },
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "Script erases instance if insertCycleCount > 1",
            "recovery": "Automatic cleanup mechanism, no user action required"
          },
          {
            "check": "Geometry dimensions",
            "errorMessage": "Vertical part disappears if (Length Overall <= Length Bend)",
            "recovery": "Increase 'Length Overall' or decrease 'Length Bend' via Properties"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions",
            "how": "OPM (Object Properties Model) / Properties Palette",
            "effect": "Updates 3D geometry size (Overall Length, Bend Length) and recalculates Body shape"
          },
          {
            "action": "Change Product Code",
            "how": "OPM Dropdown (FB, FB20A, FB20S)",
            "effect": "Updates Width, Thickness, Material (Galvanized/Stainless), and BOM description"
          },
          {
            "action": "Adjust Position",
            "how": "OPM Double (Offset Below)",
            "effect": "Moves the bracket vertically relative to the beam origin"
          },
          {
            "action": "Toggle Annotation",
            "how": "OPM Double (Text Height)",
            "effect": "Hides or Shows the Product Code text label in 3D"
          },
          {
            "action": "Host Beam Modification",
            "how": "Move/Rotate/Stretch the GenBeam",
            "effect": "Script automatically recalculates coordinate system and moves bracket to maintain relative position"
          }
        ]
      },
      "tokens_used": 10585,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbSimpsonFB.mcr\n\n## Overview\nGenerates a 3D model and BOM entries for a Simpson Strong-Tie style Face Mount (FB) bracket, typically used to anchor wall studs or columns to floor/foundation to resist uplift and lateral loads.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Generates 3D metal bodies and hardware. |\n| Paper Space | No | Not applicable for detailing views. |\n| Shop Drawing | No | Not configured for shop drawings. |\n\n## Prerequisites\n- **Required Entities**: A single `GenBeam` (e.g., Wall Stud, Beam, or Column).\n- **Minimum Beam Count**: 1.\n- **Required Settings**: `hsbSimpsonFB.xml` (Located in Company or Install TSL\\Settings folder).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbSimpsonFB.mcr` from the list.\n\n### Step 2: Select Host Element\n```\nCommand Line: Select element:\nAction: Click on the timber beam, stud, or column where you want to attach the bracket.\n```\n\n### Step 3: Define Insertion Point\n```\nCommand Line: Specify insertion point:\nAction: Click on the beam to define the origin location (usually the bottom corner or face).\n```\n\n### Step 4: Adjust Parameters\n1. Select the inserted TSL instance.\n2. Open the **Properties Palette** (Ctrl+1).\n3. Change the **Product Code**, **Length Overall**, or other dimensions to fit your specific connection requirements.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Group Assignment | dropdown | \\|Default\\| | Defines the layer for the instance. Select \"\\|No group assignment\\|\" to assign manually, or leave as \"\\|Default\\|\" to follow the host entity. |\n| Product Code | dropdown | FB | Selects the specific bracket model (FB, FB20A, FB20S). This affects width, thickness, and material (Galvanized vs Stainless). |\n| Length Overall | number | 80 mm | The total height of the bracket (Vertical height + Bend length). |\n| Length Bend | number | 60 mm | The length of the horizontal foot (flange) that sits on the floor/foundation. |\n| Offset Below | number | 0 mm | Moves the bracket vertically downwards relative to the insertion point. Useful for fine-tuning alignment with the foundation. |\n| Text Height | number | 0 mm | Controls the size of the Product Code label in the 3D model. Set to 0 to hide the text. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the geometry based on changes to the host beam or properties. |\n| Erase | Removes the TSL instance and associated 3D bodies. |\n\n## Settings Files\n- **Filename**: `hsbSimpsonFB.xml`\n- **Location**: `_kPathHsbCompany\\TSL\\Settings` or `_kPathHsbInstall\\Content\\General\\TSL\\Settings`\n- **Purpose**: Defines specific dimensions (width, thickness) and material mappings for the different Product Codes (e.g., differences between FB and FB20S). If missing, the script uses internal default values.\n\n## Tips\n- **Vertical Geometry**: Ensure the **Length Overall** is greater than the **Length Bend**. If they are equal, the vertical part of the bracket will not generate.\n- **Visibility**: Use the **Text Height** property to toggle the product label on or off. Set it to `0` for a clean 3D model view, or increase it (e.g., `10` mm) for clear identification in presentations.\n- **Material Selection**: Use the **Product Code** dropdown to switch materials. For example, selecting `FB20S` typically specifies Stainless Steel, while `FB` and `FB20A` are usually Galvanized.\n\n## FAQ\n- **Q: Why is my bracket just a flat plate without the vertical part?**\n  A: Check your properties. The **Length Overall** must be larger than the **Length Bend**. If `Length Overall` (e.g., 60) equals `Length Bend` (e.g., 60), there is no height left for the vertical face.\n- **Q: Can I move the bracket after inserting it?**\n  A: Yes. You can use the **Offset Below** property in the palette to move it vertically, or use standard AutoCAD Move commands on the TSL insertion point.\n- **Q: What happens if the XML file is missing?**\n  A: The script will fall back to internal hardcoded dimensions, but you may lose specific customization or updates intended by your company administrator. Ensure `hsbSimpsonFB.xml` is present in the correct Settings folder."
      },
      "tokens_used": 6074,
      "error": null
    }
  }
}