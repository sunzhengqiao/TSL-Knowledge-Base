{
  "filename": "hsbTranslatedText.mcr",
  "status": "completed",
  "total_tokens": 37138,
  "processing_time": 322.9153747558594,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 5951,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No 'sd_' or 'Multipage' prefix. The script uses getPoint() to select an insertion point and creates a new Display object (text) at that location. It does not iterate through _Entity[] or GenBeam arrays, nor does it use _Viewport.length() logic typically associated with Paper Space annotations."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": [
            "hsbMultiLanguage.mcr (for custom language functionality)",
            "MapObject 'hsbTSL' with key 'Languages' in the drawing dictionary"
          ]
        }
      },
      "tokens_used": 3597,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sTxt\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Text| (Embrace with || to translate)\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": null,\n      \"category\": \"|General|\",\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sPrefix\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Prefix|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": null,\n      \"category\": \"|General|\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sSuffix\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Suffix|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": null,\n      \"category\": \"|General|\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sHorAlignment\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Alignment|\",\n      \"defaultValue\": \"|Left|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Left|\",\n        \"|Center|\",\n        \"|Right|\"\n      ],\n      \"category\": \"|Alignment|\",\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sOrient\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|XY-Orientation|\",\n      \"defaultValue\": \"|Horizontal|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Horizontal|\",\n        \"|Vertical|\"\n      ],\n      \"category\": \"|Alignment|\",\n      \"description\": null\n    },\n    {\n      \"index\": 6,\n      \"variable\": \"sVerAlignment\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Vertical|\",\n      \"defaultValue"
      },
      "tokens_used": 6669,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts a multi-lingual text annotation into the 3D model that automatically translates specific keywords based on the active project language or custom language dictionaries.",
          "category": "Annotation",
          "typicalUseCase": "Adding fixed labels or notes to the model (e.g., '|Beam|', '|Wall|') that need to automatically update to 'Stab', 'Wand', etc., when the project language or export settings change."
        },
        "parameters": [
          {
            "name": "sTxt",
            "technicalDefault": "",
            "businessMeaning": "The primary text string to display. If wrapped in pipe characters (e.g., '|Beam|'), the script attempts to translate the keyword using the hsbCAD language database.",
            "validRange": "Any alphanumeric string; translation only works for keys defined in language dictionaries.",
            "unit": "text",
            "affectsOutput": "The visible content of the label. If translatable, it updates automatically when the drawing language changes."
          },
          {
            "name": "sPrefix",
            "technicalDefault": "",
            "businessMeaning": "Static text added before the main text, which is NOT translated.",
            "validRange": "Any string (e.g., 'Ref: ', 'ID: ').",
            "unit": "text",
            "affectsOutput": "Modifies the start of the final text string."
          },
          {
            "name": "sSuffix",
            "technicalDefault": "",
            "businessMeaning": "Static text added after the main text, which is NOT translated.",
            "validRange": "Any string (e.g., ' mm', ' pcs').",
            "unit": "text",
            "affectsOutput": "Modifies the end of the final text string."
          },
          {
            "name": "sHorAlignment",
            "technicalDefault": "|Left|",
            "businessMeaning": "Controls the horizontal justification of the text block relative to the insertion point.",
            "validRange": "Left, Center, Right",
            "unit": "enum",
            "affectsOutput": "Aligns the text so the insertion point is at the left edge, center, or right edge of the text."
          },
          {
            "name": "sOrient",
            "technicalDefault": "|Horizontal|",
            "businessMeaning": "Sets the primary rotation plane of the text relative to the insertion coordinate system.",
            "validRange": "Horizontal, Vertical",
            "unit": "enum",
            "affectsOutput": "If Vertical, rotates the text 90 degrees to read upwards/downwards."
          },
          {
            "name": "sVerAlignment",
            "technicalDefault": "|Center|",
            "businessMeaning": "Controls the vertical justification of the text block relative to the insertion point.",
            "validRange": "Bottom, Center, Top",
            "unit": "enum",
            "affectsOutput": "Aligns the text so the insertion point is at the baseline, middle, or cap height of the text."
          },
          {
            "name": "sLanguageMode",
            "technicalDefault": "|Current|",
            "businessMeaning": "Selects the source language dictionary for translation. Allows overriding the project language with custom definitions.",
            "validRange": "Current, Custom 1, Custom 2, Custom 1+2",
            "unit": "enum",
            "affectsOutput": "Determines which language the keyword portion (sTxt) is translated into. 'Custom 1+2' shows both languages separated by a slash."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "<First available DimStyle>",
            "businessMeaning": "Selects the visual style (font, line type) for the text from the CAD system's dimension styles.",
            "validRange": "List of DimStyles defined in the current drawing.",
            "unit": "enum",
            "affectsOutput": "Changes the font and visual appearance of the text."
          },
          {
            "name": "dTxtH",
            "technicalDefault": "U(20)",
            "businessMeaning": "The height of the text characters in model units.",
            "validRange": "5.0 to 500.0 mm (depending on model scale and visibility needs).",
            "unit": "mm",
            "affectsOutput": "Scales the size of the text entity."
          },
          {
            "name": "nColor",
            "technicalDefault": "251",
            "businessMeaning": "The AutoCAD color index (ACI) used to display the text.",
            "validRange": "1 to 255 (Standard CAD colors).",
            "unit": "index",
            "affectsOutput": "Changes the color of the text."
          },
          {
            "name": "Pt0",
            "technicalDefault": "<User Click>",
            "businessMeaning": "The 3D coordinate point where the text is inserted.",
            "validRange": "Any valid 3D coordinate in Model Space.",
            "unit": "coordinates",
            "affectsOutput": "Determines the spatial location of the label."
          },
          {
            "name": "XE / YE",
            "technicalDefault": "<Construction Planes / UCS>",
            "businessMeaning": "The vectors defining the local X and Y axes for text orientation at the insertion point.",
            "validRange": "Any orthogonal unit vectors.",
            "unit": "vector",
            "affectsOutput": "Controls the rotation and tilt of the text in 3D space."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sLanguageMode set to 'Custom 1', 'Custom 2', or 'Custom 1+2'",
            "effect": "Script relies on a MapObject 'hsbTSL' with key 'Languages' to retrieve custom language names.",
            "cascade": [
              "sTxt (Translation result)"
            ]
          },
          {
            "trigger": "sOrient set to '|Vertical|'",
            "effect": "Swaps the text drawing vectors (vxTxt becomes _YE, vyTxt becomes -_XE) to rotate the text 90 degrees.",
            "cascade": [
              "Text Rotation"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Display (Text)",
            "description": "A 3D text annotation displaying the processed string (Prefix + Translated Text + Suffix) at the specified point with the defined style and alignment.",
            "appliedTo": "Model Space (Annotation)"
          }
        ]
      },
      "tokens_used": 5673,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"Script launch initiated by user.\",\n    \"Check 'insertCycleCount': If count > 1, erase instance and exit to prevent duplicate processing.\",\n    \"Execute 'showDialog()' to display OPM properties for initial user input.\",\n    \"Prompt user 'Pick insertion point' via getPoint().\",\n    \"Capture coordinate system vectors (_XE, _YE) from current UCS (_XU, _YU).\",\n    \"Save instance state and complete insertion phase.\",\n    \"Read 'hsbTSL' MapObject to retrieve available custom languages (if any).\",\n    \"Evaluate 'sLanguageMode' property to determine translation logic.\",\n    \"Process text translation: Apply language dictionary or fallback to current language.\",\n    \"Construct final string: Prefix + Translated Text + Suffix.\",\n    \"Calculate alignment flags based on sHorAlignment and sVerAlignment.\",\n    \"Apply orientation vectors: Rotate 90 degrees if sOrient is 'Vertical'.\",\n    \"Draw/Update the Display entity (text) at Pt0.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Evaluation of 'sLanguageMode' property\",\n      \"path1\": {\n        \"name\": \"Current Language\",\n        \"steps\": [\n          \"Standard translation function T(sTxt) used.\",\n          \"Relies on hsbCAD project language settings.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Custom Language 1\",\n        \"steps\": [\n          \"Check if 'hsbTSL' MapObject contains language at index 0.\",\n          \"If valid, translate using T(sTxt, sLanguages[0]).\",\n          \"If invalid, fallback to Current Language.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Evaluation of 'sLanguageMode' property (continued)\",\n      \"path1\": {\n        \"name\": \"Custom Language 2\",\n        \"steps\": [\n          \"Check if 'hsbTSL' MapObject contains language at index 1.\",\n          \"If valid, translate using T(sTxt, sLanguages[1]).\",\n          \"If invalid, fallback to Current Language.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Custom Language 1+2\",\n        \"steps\": [\n          \"Check if 'hsbTSL' MapObject contains at least 2 languages.\",\n          \"If valid, translate both and concatenate with '/'.\",\n          \"If invalid, fallback to Current Language.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Evaluation of 'sOrient' property\",\n      \"path1\": {\n        \"name\": \"Horizontal\",\n        \"steps\": [\n          \"Use standard vectors (_XE, _YE) for text orientation.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Vertical\",\n        \"steps\": [\n          \"Swap vectors: vxTxt = _YE, vyTxt = -_XE.\",\n          \"Rotates text 90 degrees in the construction plane.\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"MapObject 'hsbTSL' existence\",\n      \"errorMessage\": \"No error message displayed.\",\n      \"recovery\": \"Script performs a silent fallback to the current project language if Custom Language mode is selected but the MapObject is missing or empty.\"\n    },\n    {\n      \"check\": \"Text Translation Syntax\",\n      \"errorMessage\": \"No error message displayed.\",\n      \"recovery\": \"If text is not enclosed in '||', the T() function returns the string as-is without attempting translation, displaying the raw input.\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Edit Text Content & Style\",\n      \"how\": \"AutoCAD Properties Palette (OPM)\",\n      \"effect\": \"Updates sTxt, Prefix, Suffix, Height, Color, or Alignment properties. Immediate recalculation updates the display.\"\n    },\n    {\n      \"action\": \"Change Language Source\",\n      \"how\": \"AutoCAD Properties Palette (OPM) - Select sLanguageMode\",\n      \"effect\": \"Switches the translation dictionary. Requires valid 'hsbTSL' MapObject for Custom modes.\"\n    },\n    {\n      \"action\": \"Move or Rotate Annotation\",\n      \"how\": \"Standard CAD Grips or Move/Rotate commands\",\n      \"effect\": \"Modifies the insertion point (Pt0) or coordinate system"
      },
      "tokens_used": 8304,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbTranslatedText.mcr\n\n## Overview\nThis script inserts a multi-lingual text annotation into the 3D model. It automatically translates keywords based on the active project language or custom language dictionaries, allowing for dynamic labels that update when language settings change.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Primary usage environment. |\n| Paper Space | No | Not designed for 2D layout views. |\n| Shop Drawing | No | Not intended for manufacturing drawings. |\n\n## Prerequisites\n- **Required Entities**: None.\n- **Minimum Beam Count**: 0.\n- **Required Settings**: \n  - MapObject `hsbTSL` with key `Languages` (required only if using \"Custom\" language modes).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Select `hsbTranslatedText.mcr` from the list and press Enter.\n\n### Step 2: Pick Insertion Point\n```\nCommand Line: Pick insertion point:\nAction: Click in the Model Space to place the text annotation.\n```\n\n### Step 3: Configure Text\nAction: Select the newly inserted text entity. Open the **Properties Palette** (Ctrl+1) to edit the text content, style, and translation settings.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Text | Text | | The main text to display. Enclose keywords in pipe characters (e.g., `|Beam|`) to enable automatic translation. |\n| Prefix | Text | | Static text added before the main text. This is not translated. |\n| Suffix | Text | | Static text added after the main text. This is not translated. |\n| Alignment | Dropdown | |Left| | Sets the horizontal justification (Left, Center, Right). |\n| Vertical | Dropdown | |Center| | Sets the vertical justification (Bottom, Center, Top). |\n| XY-Orientation | Dropdown | |Horizontal| | Sets the text direction. Select \"Vertical\" to rotate text 90 degrees. |\n| Language Mode | Dropdown | |Current| | Determines the translation source: Current project language, or Custom 1/2/1+2 (requires hsbTSL MapObject). |\n| DimStyle | Dropdown | <Active> | Selects the visual style (font, line type) from available dimension styles. |\n| Text Height | Number | U(20) | The height of the text characters in model units. |\n| Color | Number | 251 | The AutoCAD color index (ACI) for the text. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the text display if properties, language settings, or the text position have changed. |\n\n## Settings Files\n- **Filename**: `hsbTSL` (MapObject within drawing)\n- **Location**: Drawing Dictionary\n- **Purpose**: Stores the names and definitions of Custom Languages (Custom 1, Custom 2) used for the translation logic.\n\n## Tips\n- **Translation Syntax**: To use the translation feature, ensure the keyword in the \"Text\" property is wrapped in pipe characters (e.g., `|Wall|`). If you type plain text without pipes, it will display exactly as typed.\n- **Custom Languages**: If you select \"Custom 1\" or \"Custom 2\" but the text does not translate, ensure the drawing contains the `hsbTSL` MapObject with the correct language definitions.\n- **Orientation**: Use the \"XY-Orientation\" property to quickly flip text from horizontal to vertical without rotating the entire object manually.\n\n## FAQ\n- **Q: My text shows as `|Keyword|` instead of the translated word.**\n  - A: The keyword `|Keyword|` might not exist in your current project language dictionary. Check your standard language files or switch the \"Language Mode\" to \"Current\" to ensure you are using the correct dictionary.\n- **Q: How do I display two languages at once?**\n  - A: Set the \"Language Mode\" property to `|Custom 1+2|`. This will display the translation for Custom 1 and Custom 2 separated by a slash (e.g., `Stab / Wall`).\n- **Q: Can I add units that don't translate?**\n  - A: Yes. Type the unit in the \"Suffix\" property (e.g., \" mm\"). The suffix is added to the end of the translated text and remains static."
      },
      "tokens_used": 6944,
      "error": null
    }
  }
}