{
  "filename": "hsb_RemoveBattens.mcr",
  "status": "completed",
  "total_tokens": 27058,
  "processing_time": 185.52572965621948,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3500,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses `PrEntity` to select `Element` (specifically cast to `ElementWall`) during insertion. Manipulates `GenBeam` objects within wall zones using `dbErase()`. Contains logic for `_bOnElementConstructed`. Lacks `sd_` prefixes, `_Viewport` usage, or `#Type E` declaration."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing ElementWall entities with zone code 'HSB-PL09' (Vertical sheets) and associated GenBeams.",
          "requiredSettings": []
        }
      },
      "tokens_used": 3636,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dMinimumBattenLength",
            "type": "PropDouble",
            "displayName": "Minimum length of batten",
            "defaultValue": "600.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sYesNoRemoveBattenAtSheetSplit",
            "type": "PropString",
            "displayName": "Remove battens at sheet splits",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3285,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the cleanup of wall framing models by deleting battens that are too short for practical installation or nailing.",
          "category": "Optimization/Cleanup",
          "typicalUseCase": "After generating wall elements with vertical sheeting (HSB-PL09), the user runs this to remove small off-cut battens generated at sheet ends or openings, ensuring only usable timber remains for manufacturing or detailing."
        },
        "parameters": [
          {
            "name": "dMinimumBattenLength",
            "technicalDefault": "600.0",
            "businessMeaning": "Defines the threshold for 'waste' timber. Any batten shorter than this length is considered unusable because it lacks sufficient surface area for effective nailing or structural fixings.",
            "validRange": "100.0 - 1500.0",
            "unit": "mm",
            "affectsOutput": "Determines which GenBeam entities are erased. Lower values retain more small pieces; higher values remove more battens, potentially leaving gaps in nailing support if set too high."
          },
          {
            "name": "sYesNoRemoveBattenAtSheetSplit",
            "technicalDefault": "No",
            "businessMeaning": "Controls whether specific logic is applied to short battens located at the vertical joints (splits) of the sheathing sheets. When 'Yes', it removes short battens even if they are intended to support a sheet joint, provided they fall within the shadow of the structural member in the next zone.",
            "validRange": "Yes, No",
            "unit": "Boolean/String",
            "affectsOutput": "If 'Yes', performs a geometric check against adjacent zones to identify and delete short 'joint' battens that overlap with structural members. If 'No', relies solely on length threshold."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sYesNoRemoveBattenAtSheetSplit is set to 'Yes'",
            "effect": "Enables a geometric overlap check between battens in the current zone and GenBeams in the adjacent zone (nZone +/- 1). The deletion logic changes from a simple length check to a spatial containment check for short battens at splits.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam",
            "description": "Erased (Deleted) from model. The script removes entities rather than creating them.",
            "appliedTo": "ElementWall entities with distribution code 'HSB-PL09' (Vertical sheets)."
          }
        ]
      },
      "tokens_used": 5578,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Define properties (Minimum Length, Split Removal option) and set units to mm.",
          "2. User Interaction: Prompt user to select a set of Element entities (PrEntity).",
          "3. Validation: Check if elements were selected. If not, erase script instance.",
          "4. Iteration: Loop through each selected Element and predefined Real Zones (1 to 5, -1 to -5).",
          "5. Filter Zone: Check if Zone Distribution Code equals 'HSB-PL09'. If not, skip zone.",
          "6. Geometry Prep: Calculate shadow profiles (PlaneProfiles) of all GenBeams in the current zone projected onto the zone plane.",
          "7. Candidate Selection: Identify GenBeams shorter than 'dMinimumBattenLength' and add to removal list.",
          "8. Conditional Logic: Evaluate 'sYesNoRemoveBattenAtSheetSplit' property to determine deletion method.",
          "9. Execution: Perform deletion of GenBeams (Either all short battens or only those overlapping with the next zone).",
          "10. Cleanup: Erase script instance from model (Utility script behavior)."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Check",
            "path1": {
              "name": "Recursive/Multiple Call",
              "steps": [
                "Check if insertCycleCount() > 1",
                "Erase script instance immediately",
                "Return"
              ]
            },
            "path2": {
              "name": "Standard Insertion",
              "steps": [
                "Show Dialog (if manual run)",
                "Prompt for Entity Selection",
                "Proceed to Main Loop"
              ]
            }
          },
          {
            "condition": "Zone Distribution Code",
            "path1": {
              "name": "Vertical Sheets Zone",
              "steps": [
                "Code matches 'HSB-PL09'",
                "Process GenBeams within this zone"
              ]
            },
            "path2": {
              "name": "Other Zone Types",
              "steps": [
                "Code does not match 'HSB-PL09'",
                "Skip to next zone/element"
              ]
            }
          },
          {
            "condition": "Batten Length vs Threshold",
            "path1": {
              "name": "Long Batten",
              "steps": [
                "Beam length > dMinimumBattenLength",
                "Ignore beam (Retain in model)"
              ]
            },
            "path2": {
              "name": "Short Batten",
              "steps": [
                "Beam length <= dMinimumBattenLength",
                "Add to 'gbToRemove' list",
                "Proceed to Split Removal Logic"
              ]
            }
          },
          {
            "condition": "Remove Battens at Sheet Splits (sYesNoRemoveBattenAtSheetSplit)",
            "path1": {
              "name": "Yes (Smart Overlap Check)",
              "steps": [
                "Identify adjacent zone (nZone +/- 1)",
                "Get GenBeams and shadow profiles from adjacent zone",
                "For each short batten: Check if its profile is geometrically contained within a profile in the adjacent zone",
                "If contained: Execute dbErase()",
                "If not contained: Keep batten"
              ]
            },
            "path2": {
              "name": "No (Simple Length Check)",
              "steps": [
                "Iterate through all identified short battens",
                "Execute dbErase() on all items in list"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection Validity",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script checks _Element.length()==0. If empty, it erases itself. User must select elements and run again."
          },
          {
            "check": "Entity Type",
            "errorMessage": "None",
            "recovery": "Script casts selected entity to ElementWall. If invalid (bIsValid() is false), it continues to the next selected entity."
          },
          {
            "check": "Zone Compatibility",
            "errorMessage": "None",
            "recovery": "Script checks for distribution code 'HSB-PL09'. If missing, it skips that zone without processing."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Script Self-Deletion",
            "how": "Automatic",
            "effect": "The script calls eraseInstance() at the end of execution. It does not remain in the drawing for later editing. To change parameters, the user must insert the script again."
          }
        ]
      },
      "tokens_used": 6124,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_RemoveBattens.mcr\n\n## Overview\nThis script removes short battens from selected wall elements to clean up the model. It automatically deletes battens that are shorter than a specified length, ensuring only usable timber remains for manufacturing and detailing.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used on 3D wall elements containing vertical sheeting zones. |\n| Paper Space | No | Not applicable for 2D drawings. |\n| Shop Drawing | No | Not intended for generating shop drawings. |\n\n## Prerequisites\n- **Required Entities**: `ElementWall` with `GenBeam` battens assigned.\n- **Minimum Beam Count**: 0.\n- **Required Settings**: Wall elements must contain a zone with the distribution code **'HSB-PL09'** (Vertical sheets).\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Browse and select `hsb_RemoveBattens.mcr`.\n\n### Step 2: Configure Parameters (Optional)\n1.  Before proceeding, open the **Properties Palette** (Ctrl+1).\n2.  Adjust the `Minimum length of batten` or `Remove battens at sheet splits` settings if the defaults do not suit your current project requirements.\n\n### Step 3: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the desired wall elements or use a window selection to choose multiple elements. Press Enter to confirm.\n```\n\n### Step 4: Execution\n1.  The script processes the selected elements.\n2.  It identifies battens in 'HSB-PL09' zones that are shorter than the minimum length.\n3.  The script deletes the identified battens and automatically removes itself from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Minimum length of batten | Number | 600.0 | Defines the threshold length (in mm). Any batten shorter than this value will be removed. |\n| Remove battens at sheet splits | Dropdown | No | If set to 'Yes', the script checks if short battens at sheet joints are redundant (overlapping structural members in adjacent zones) and removes them. If 'No', only the length threshold is used. |\n\n## Right-Click Menu Options\n*This script does not add specific options to the entity right-click menu.*\n\n## Settings Files\n*No external settings files are required for this script.*\n\n## Tips\n- **Self-Deleting Script**: This script is a utility tool; it will automatically erase itself from the model after it finishes running. To run it again with different settings, you must insert it fresh.\n- **Zone Specific**: The script only targets zones with the code 'HSB-PL09'. Ensure your wall elements are correctly zoned if the script seems to have no effect.\n- **Conservative Threshold**: If you are unsure, start with a lower `Minimum length of batten` (e.g., 300mm) to ensure you don't delete pieces that might be useful for fixing, then increase the value in subsequent runs if necessary.\n- **Split Logic**: Use the `Remove battens at sheet splits` option only if your adjacent zones (e.g., structural studs) provide sufficient backing behind the sheet joints. This prevents large gaps in nailing support.\n\n## FAQ\n- **Q: Why did the script disappear immediately after running?**\n  - A: This is intended behavior. `hsb_RemoveBattens.mcr` is designed as a \"cleanup\" utility that executes once and deletes itself to keep the drawing clean.\n- **Q: The script didn't remove any battens, but I can see short ones.**\n  - A: Check that the battens are inside a zone with the distribution code **'HSB-PL09'**. Also, verify that the `Minimum length of batten` property is set lower than the length of the battens you want to remove.\n- **Q: What happens if I select an element that isn't a wall?**\n  - A: The script will skip the entity and continue processing other valid elements in your selection set."
      },
      "tokens_used": 4935,
      "error": null
    }
  }
}