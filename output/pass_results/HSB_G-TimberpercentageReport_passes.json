{
  "filename": "HSB_G-TimberpercentageReport.mcr",
  "status": "completed",
  "total_tokens": 44217,
  "processing_time": 397.59991574287415,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "03/12/2024",
            "author": "Robert Pol",
            "changes": "First version"
          },
          {
            "version": "1.4",
            "date": "19/09/2024",
            "author": "Robert Pol",
            "changes": "Always start with full width sheet"
          },
          {
            "version": "1.3",
            "date": "19/09/2024",
            "author": "Robert Pol",
            "changes": "Redo logic based on new saw"
          },
          {
            "version": "1.2",
            "date": "18/08/2021",
            "author": "Robert Pol",
            "changes": "Fix issue where lengthwise and last widthwise sheets had the same letter, make sure for each element the letter is set back to \"A\""
          },
          {
            "version": "1.1",
            "date": "18/08/2021",
            "author": "Robert Pol",
            "changes": "Split lengthwise sheets and add numbering"
          },
          {
            "version": "1.0",
            "date": "20/05/2021",
            "author": "Robert Pol",
            "changes": "Pilot version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7483,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _Viewport.append(getViewport()) to select an Element and explicitly checks if(_Viewport.length() < 1). It retrieves data via Element.beam() and draws geometry using the Display class (dpHeader.draw, dp.draw) at a user-selected Point3d (_Pt0). It does not use 'sd_' prefixes, '#Type E', or ShopDrawing specific entities like sd_Sheet."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "User must select a Viewport (Element) via prompt.",
          "requiredSettings": [
            "ExtendedProperties map 'TIMBERPERCENTAGE' on Element",
            "ExtendedProperties 'TimberPercentageArea' and 'TotalArea' on Beams"
          ]
        }
      },
      "tokens_used": 8196,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDialog",
            "trigger": "_bOnInsert (if no execute key provided)",
            "title": null,
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dimensionStyleHeader",
            "type": "PropString",
            "displayName": "Dimension Style Header",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": "Style",
            "description": null
          },
          {
            "index": 1,
            "variable": "dimensionStyle",
            "type": "PropString",
            "displayName": "Dimension Style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": "Style",
            "description": null
          },
          {
            "index": 0,
            "variable": "color",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": "Style",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5869,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 2D graphical report in the drawing displaying timber percentage calculations, area breakdowns, and beam quantities for a selected assembly element.",
          "category": "Reporting",
          "typicalUseCase": "Used to visualize and document timber volume or area statistics (likely for fire safety or thermal calculations) directly on a drawing layout after calculation properties have been assigned to the element and beams."
        },
        "parameters": [
          {
            "name": "dimensionStyleHeader",
            "technicalDefault": "",
            "businessMeaning": "Selects the CAD Dimension Style to control the text font, height, and appearance of the main report title.",
            "validRange": "Any Dimension Style name currently loaded in the drawing.",
            "unit": "String (Style Name)",
            "affectsOutput": "Changes the visual size and font of the header text 'Timberpercentage Calculation'."
          },
          {
            "name": "dimensionStyle",
            "technicalDefault": "",
            "businessMeaning": "Selects the CAD Dimension Style to control the text font, height, and appearance of the table headers and data rows.",
            "validRange": "Any Dimension Style name currently loaded in the drawing.",
            "unit": "String (Style Name)",
            "affectsOutput": "Changes the visual size and font of the table content, including column headers and beam data."
          },
          {
            "name": "color",
            "technicalDefault": -1,
            "businessMeaning": "Sets the AutoCAD color index for the report graphics. A value of -1 automatically cycles colors for different area sections; any other value sets a fixed color.",
            "validRange": "-1 (Automatic/Varying) or 1-255 (AutoCAD Color Index).",
            "unit": "Index",
            "affectsOutput": "Determines the display color of the text and lines drawn in the model/paper space."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "2D Geometry (Text & PLine)",
            "description": "A formatted table containing Position Numbers, Timber Areas, Total Areas, Quantities, and calculated Timber Percentage.",
            "appliedTo": "Model Space or Paper Space at the user-selected insertion point."
          }
        ]
      },
      "tokens_used": 7497,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"Script instance is created (Insert or Drag & Drop)\",\n    \"Check insert cycle count\",\n    \"Check for Execute Key (_kExecuteKey)\",\n    \"Set properties from Catalog or Show Properties Dialog\",\n    \"Update 'LastInserted' catalog\",\n    \"Prompt user to select a Viewport (Element)\",\n    \"Prompt user to select Insertion Point (Point3d)\",\n    \"Terminate insertion (Wait for Recalculate)\",\n    \"Validate Viewport selection (Count check)\",\n    \"Validate Element validity\",\n    \"Initialize Display for Header ('Timberpercentage Calculation')\",\n    \"Draw Header text and Underline\",\n    \"Iterate through Element Extended Properties\",\n    \"Check for 'TIMBERPERCENTAGE' key\",\n    \"Extract Area Data (Name, Area, Wood Area, Percentage)\",\n    \"Draw Area Section Header (e.g., 'Floor area : 50 m2')\",\n    \"Draw Table Column Headers (Posnum, Area, Total Area, Quantity)\",\n    \"Iterate through all Beams in the Element\",\n    \"Read Beam Extended Properties ('TimberPercentageArea' & 'TotalArea')\",\n    \"Check if Beam data matches existing entry in list (Posnum + Area)\",\n    \"Aggregate Data: Increment Quantity if match found, or Add new entry if not\",\n    \"Sort aggregated data by Posnum\",\n    \"Draw Table Rows for current Area section\",\n    \"Draw Summary for current Area (Total Wood Area, Calculation Formula)\",\n    \"Repeat for subsequent 'TIMBERPERCENTAGE' properties if present\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Insert Cycle Check\",\n      \"path1\": {\n        \"name\": \"Cycle > 1\",\n        \"steps\": [\n          \"Erase Instance\",\n          \"Exit Script\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Cycle = 1\",\n        \"steps\": [\n          \"Proceed to Execute Key check\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Execute Key Presence\",\n      \"path1\": {\n        \"name\": \"Execute Key Provided\",\n        \"steps\": [\n          \"Load Properties from Catalog\",\n          \"Skip Dialog\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No Execute Key\",\n        \"steps\": [\n          \"Show Properties Dialog\",\n          \"Wait for User Input\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Viewport Selection Validation\",\n      \"path1\": {\n        \"name\": \"Viewport Missing\",\n        \"steps\": [\n          \"Report Error: 'No viewport selected!'\",\n          \"Erase Instance\",\n          \"Exit\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Viewport Selected\",\n        \"steps\": [\n          \"Validate Element\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Element Validity Check\",\n      \"path1\": {\n        \"name\": \"Element Invalid\",\n        \"steps\": [\n          \"Report Error: 'Not a valid element'\",\n          \"Exit (No Erase)\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Element Valid\",\n        \"steps\": [\n          \"Proceed to Drawing Logic\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Extended Property Filter\",\n      \"path1\": {\n        \"name\": \"Key != 'TIMBERPERCENTAGE'\",\n        \"steps\": [\n          \"Skip this entry in loop\",\n          \"Continue to next property\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Key == 'TIMBERPERCENTAGE'\",\n       "
      },
      "tokens_used": 9603,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-TimberpercentageReport.mcr\n\n## Overview\nThis script generates a 2D graphical report in the drawing displaying timber percentage calculations, area breakdowns, and beam quantities for a selected assembly element. It reads data stored in Element and Beam Extended Properties and visualizes it as a formatted table at a user-selected location.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The report can be placed directly in the model. |\n| Paper Space | Yes | The report can be placed on layout sheets. |\n| Shop Drawing | No | This script does not generate shop drawings or layouts. |\n\n## Prerequisites\n- **Required Entities**: An Element (Assembly) containing Beams.\n- **Minimum Beam Count**: 0, but data is required to generate a meaningful report.\n- **Required Settings**:\n  - The selected Element must have an Extended Property map named **`TIMBERPERCENTAGE`** containing calculation data.\n  - The Beams within the Element must have Extended Properties named **`TimberPercentageArea`** and **`TotalArea`** (usually populated by a previous calculation script).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_G-TimberpercentageReport.mcr`\n\n### Step 2: Configure Properties\n- If the script is run manually (without a predefined execute key), the Properties Dialog will appear automatically.\n- Select the appropriate **Dimension Styles** for the header and table content.\n- Set the **Color** preference (default `-1` uses varying colors for different sections).\n\n### Step 3: Select Assembly\n```\nCommand Line: Select viewport (Element):\nAction: Click on the Element (Assembly) in the drawing or 3D model for which you want to generate the report.\n```\n\n### Step 4: Place Report\n```\nCommand Line: Insertion point:\nAction: Click in the drawing (Model or Paper Space) to specify where the top-left of the report table should be placed.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimension Style Header | dropdown | (Empty) | Selects the text style for the main title \"Timberpercentage Calculation\". This controls font and text size. |\n| Dimension Style | dropdown | (Empty) | Selects the text style for the table headers and data rows. |\n| Color | number | -1 | Sets the color of the report entities. Use `-1` to automatically cycle colors for different area sections, or enter a specific AutoCAD Color Index (1-255). |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not add specific items to the context menu. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: This script relies on Extended Properties attached to the Element and Beams rather than external XML settings files.\n\n## Tips\n- **Data Preparation**: Ensure you have run your calculation scripts (e.g., for fire safety or thermal analysis) before running this report. If the Extended Properties (`TIMBERPERCENTAGE`, `TimberPercentageArea`) are missing, the report will be empty.\n- **Visuals**: Use the `Color` property set to `-1` to easily distinguish between different area sections (e.g., different floors or zones) within the report.\n- **Text Size**: To adjust the size of the text in the report, do not scale the script instance. Instead, create or select Dimension Styles in AutoCAD with the desired text height and assign them in the properties panel.\n\n## FAQ\n- **Q: Why is the report empty or missing data?**\n  **A:** The script requires specific Extended Properties on the Element (`TIMBERPERCENTAGE`) and Beams (`TimberPercentageArea`, `TotalArea`). Verify that these have been calculated and assigned to the entities you selected.\n- **Q: Can I update the report if the design changes?**\n  **A:** Yes. If the underlying properties change, select the report instance and use the `TSLRECALC` command (or the Recalculate option) to refresh the table data.\n- **Q: How do I change the font size?**\n  **A:** Modify the text height in the Dimension Styles selected in the Properties Panel (`dimensionStyleHeader` and `dimensionStyle`)."
      },
      "tokens_used": 5569,
      "error": null
    }
  }
}