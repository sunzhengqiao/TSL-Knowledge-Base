{
  "filename": "hsb_SIP-EdgeBom.mcr",
  "status": "completed",
  "total_tokens": 48458,
  "processing_time": 194.81063556671143,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "11.08.2014",
            "author": "Chirag Sawjani",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "20.08.2014",
            "author": "Chirag Sawjani",
            "changes": "Added property for ofsetting text on edges towards the inside of the SIP"
          },
          {
            "version": "1.3",
            "date": "12.03.2015",
            "author": "Chirag Sawjani",
            "changes": "Added letters for edges"
          },
          {
            "version": "1.4",
            "date": "15.05.2015",
            "author": "Chirag Sawjani",
            "changes": "Added projection of pockets to table"
          },
          {
            "version": "1.5",
            "date": "20.05.2015",
            "author": "Chirag Sawjani",
            "changes": "Lengths are now rounded up to the next mm"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8628,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly prompts the user to select a viewport using `getViewport()` during insertion (`_bOnInsert`) and stores it in `_Viewport`. It relies on `vp.coordSys()` to calculate transformations between model and paper space (`ms2ps`). The script validates `if( _Viewport.length()==0 )` and processes the element contained within the viewport (`vp.element()`)."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element (SIP)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space with a Viewport containing a valid Element that has SIP data.",
          "requiredSettings": []
        }
      },
      "tokens_used": 6967,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Pick a point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dim Style",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sNumberingMode",
            "type": "PropString",
            "displayName": "Numbering mode",
            "defaultValue": "Numbers",
            "inputType": "dropdown",
            "options": [
              "Numbers",
              "Letters"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "3",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Edge Offset",
            "defaultValue": "60",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dEdgeTextHeight",
            "type": "PropDouble",
            "displayName": "Edge Text Height",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9093,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a Bill of Materials (BOM) table for SIP (Structural Insulated Panel) edges in Paper Space, including edge lengths, bevel angles, and projected pocket dimensions.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used during the detailing phase to create a cutting list or schedule for SIP edges on layout drawings."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Specifies the drafting standard (text style, arrow size, etc.) to be used for all text and dimensions in the generated table and edge labels.",
            "validRange": "Any existing Dimension Style in the current drawing.",
            "unit": "String",
            "affectsOutput": "Determines the font, size, and appearance of the text used in the table and edge markers."
          },
          {
            "name": "sNumberingMode",
            "technicalDefault": "Numbers",
            "businessMeaning": "Selects the labeling system used to identify edges in the drawing and the table.",
            "validRange": "Numbers, Letters",
            "unit": "Enumeration",
            "affectsOutput": "Switches edge identifiers between sequential integers (1, 2, 3) and letters (A, B, C) in both the drawing view and the BOM table."
          },
          {
            "name": "nColor",
            "technicalDefault": "3",
            "businessMeaning": "Sets the AutoCAD color index for the generated graphical output (table lines and edge labels).",
            "validRange": "1-255 (Standard AutoCAD colors)",
            "unit": "Index",
            "affectsOutput": "Changes the visual color of the generated table grid lines and the text labels placed on the panel edges."
          },
          {
            "name": "dOffset",
            "technicalDefault": "60",
            "businessMeaning": "Defines the distance from the physical panel edge to the center of the edge label text, pushing the label towards the inside of the panel.",
            "validRange": "10 mm - 500 mm (depending on panel size)",
            "unit": "mm",
            "affectsOutput": "Relocates the edge identifier text (number/letter) relative to the panel boundary to avoid overlap or improve visibility."
          },
          {
            "name": "dEdgeTextHeight",
            "technicalDefault": "0",
            "businessMeaning": "Overrides the text height specifically for the edge labels. A value of 0 uses the default height defined in the selected Dimension Style.",
            "validRange": "0 (Use Style Default) or > 0 (Custom height in mm)",
            "unit": "mm",
            "affectsOutput": "Scales the size of the numbers or letters placed directly on the drawing edges."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dEdgeTextHeight = 0",
            "effect": "The script ignores the manual height input and defers to the text height defined inside the selected sDimStyle.",
            "cascade": [
              "sDimStyle"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Annotation",
            "description": "Text labels (Numbers or Letters) placed at the center of each SIP edge to identify them.",
            "appliedTo": "Paper Space representation of SIP Edges"
          },
          {
            "type": "Table",
            "description": "A graphical table listing unique edge codes, their lengths, bevel angles, and lengths of projected pockets (if any).",
            "appliedTo": "Paper Space"
          }
        ]
      },
      "tokens_used": 7768,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch (User runs command or inserts TSL)",
          "[Conditional] Check Insertion State: Is _bOnInsert true?",
          "[True] Insertion Cycle Check: Is insertCycleCount > 1?",
          "[True > 1] Erase Instance and Exit (Prevent duplicate runs)",
          "[True = 1] Show Properties Dialog",
          "Prompt User: Pick a point for table location (getPoint)",
          "Prompt User: Select a viewport (getViewport)",
          "Store insertion point and viewport in script instance variables",
          "Exit (Wait for recalculation trigger)",
          "[False] Recalculation Phase: Read stored Viewport and Insertion Point",
          "[Conditional] Check Viewport: Does _Viewport have data?",
          "[False] Erase Instance and Exit (Missing input)",
          "[True] Retrieve Element from Viewport",
          "[Conditional] Check Element: Is element valid (bIsValid)?",
          "[False] Exit (Invalid Element)",
          "[True] Initialize Display Properties (Color, Dim Style)",
          "[Conditional] Check Text Height Override: Is dEdgeTextHeight > 0?",
          "[True] Apply custom text height to Display object",
          "[False] Use default text height from Dim Style",
          "Calculate Coordinate Transformations (Model Space to Paper Space)",
          "Retrieve SIP Data and Geometry from Element",
          "Iterate through SIPs and Edges",
          "Analyze CNC Envelope and Edge Segments",
          "Calculate Edge Midpoints, Lengths, and Bevel Angles",
          "[Conditional] Check for Projectable Segments: Are adjacent angles > 91 degrees?",
          "[True] Identify segments suitable for pocket projection",
          "[Conditional] Check for Pockets: Are there projected points on segment?",
          "[True] Calculate length of projected pocket segment",
          "[False] Assign 0 to projected length",
          "Generate Unique Edge Codes based on Length and Bevel Angle similarity",
          "[Conditional] Check Numbering Mode: Is sNumberingMode 'Numbers'?",
          "[True] Assign Numeric Codes (1, 2, 3...)",
          "[False] Assign Letter Codes (A, B, C...)",
          "Sort Edge Data by Code",
          "Draw Edge Labels on Drawing (Numbers or Letters)",
          "Generate Table Data (Headers and Rows)",
          "Draw Table Headers (Edge, Length, Bevel)",
          "Draw Main Table Rows (Unique Edges)",
          "[Conditional] Check for Projections: Are there projected lengths > 0?",
          "[True] Append Projection Rows to Table (Edge Code + Length)",
          "[False] End Table Drawing",
          "Script Completion"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Check",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase Instance",
                "Return"
              ]
            },
            "path2": {
              "name": "Cycle = 1",
              "steps": [
                "Show Dialog",
                "Get Point",
                "Get Viewport",
                "Return"
              ]
            }
          },
          {
            "condition": "Viewport Validity",
            "path1": {
              "name": "Invalid/Missing",
              "steps": [
                "Erase Instance",
                "Return"
              ]
            },
            "path2": {
              "name": "Valid",
              "steps": [
                "Process Element",
                "Generate Geometry"
              ]
            }
          },
          {
            "condition": "Numbering Mode (sNumberingMode)",
            "path1": {
              "name": "Numbers (Index 0)",
              "steps": [
                "Calculate Numeric Codes (1, 2, 3)",
                "Draw Numbers on Edges",
                "Populate Table with Numbers"
              ]
            },
            "path2": {
              "name": "Letters (Index 1)",
              "steps": [
                "Calculate Letter Codes (A, B, C)",
                "Draw Letters on Edges",
                "Populate Table with Letters"
              ]
            }
          },
          {
            "condition": "Pocket Projection Detection",
            "path1": {
              "name": "Projectable Segment Exists",
              "steps": [
                "Identify Adjacent Segments",
                "Calculate Intersection Points",
                "Determine Projected Length",
                "Add to Projection List"
              ]
            },
            "path2": {
              "name": "No Projectable Segment",
              "steps": [
                "Set Projected Length to 0",
                "Skip Projection Calculation"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport assigned during insertion",
            "errorMessage": "None (Script silently erases itself)",
            "recovery": "User must re-insert the script and select a valid viewport."
          },
          {
            "check": "Element within Viewport contains valid SIP data",
            "errorMessage": "None (Script exits silently via return)",
            "recovery": "User must select a viewport that contains a valid SIP element."
          },
          {
            "check": "CNC Envelope vertices exist",
            "errorMessage": "None (Loop continues to next SIP)",
            "recovery": "Ensure the SIP element has valid CNC shadow geometry."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Dimension Style",
            "how": "OPM Property 'Dim Style'",
            "effect": "Updates the font, size, and arrow style of all text and lines in the table and edge markers immediately upon recalculation."
          },
          {
            "action": "Switch Numbering Mode",
            "how": "OPM Property 'Numbering mode'",
            "effect": "Toggles edge labels and table codes between Numeric (1, 2) and Alpha (A, B) formats."
          },
          {
            "action": "Adjust Edge Offset",
            "how": "OPM Property 'Edge Offset'",
            "effect": "Moves the edge label text closer to or further from the panel edge."
          },
          {
            "action": "Override Text Height",
            "how": "OPM Property 'Edge Text Height'",
            "effect": "If set > 0, forces edge labels to specific size; if 0, respects Dim Style settings."
          },
          {
            "action": "Change Color",
            "how": "OPM Property 'Color'",
            "effect": "Changes the AutoCAD color index of the generated table and labels."
          },
          {
            "action": "Move Table",
            "how": "Grip Edit (Move) on the insertion point",
            "effect": "Relocates the entire generated table and edge labels to the new position."
          }
        ]
      },
      "tokens_used": 9800,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SIP-EdgeBom.mcr\n\n## Overview\nThis script automates the creation of a Bill of Materials (BOM) for SIP (Structural Insulated Panel) edges directly in Paper Space. It generates a detailed table listing edge lengths, bevel angles, and projected pocket dimensions, while simultaneously labeling the corresponding edges on the drawing view.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | The script operates in Paper Space by referencing a viewport. |\n| Paper Space | Yes | The script draws the BOM table and edge labels in the current layout. |\n| Shop Drawing | Yes | Designed for creating production lists and cutting schedules. |\n\n## Prerequisites\n- **Required Entities**: An Element containing SIP (Structural Insulated Panel) data.\n- **Minimum Beam Count**: 0 (This script works on Elements, not individual beams).\n- **Required Settings**: None required, but a Dimension Style must exist in the drawing.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_SIP-EdgeBom.mcr`\n\n### Step 2: Locate Table\n```\nCommand Line: Pick a point\nAction: Click in the Paper Space layout where you want the top-left corner of the BOM table to be placed.\n```\n\n### Step 3: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the viewport that displays the SIP Element you wish to annotate.\n```\n\n### Step 4: Adjust Configuration (Optional)\n1. Select the inserted script instance (the insertion point).\n2. Open the **Properties** palette (Ctrl+1).\n3. Adjust parameters such as numbering mode, color, or offsets as needed.\n4. The drawing and table will update automatically.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dim Style | dropdown | _DimStyles | Select the dimension style to control text font, size, and arrow style for the table and labels. |\n| Numbering mode | dropdown | Numbers | Choose between labeling edges with sequential Numbers (1, 2, 3) or Letters (A, B, C). |\n| Color | number | 3 | Set the AutoCAD Color Index (1-255) for the generated table lines and edge text. |\n| Edge Offset | number | 60 | Distance in mm from the panel edge to the center of the edge label text (moves label towards panel interior). |\n| Edge Text Height | number | 0 | Custom height for edge labels in mm. Enter 0 to use the text height defined in the selected Dim Style. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific custom items to the right-click context menu. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not rely on external XML settings files; it uses standard AutoCAD properties.\n\n## Tips\n- **Moving the Table**: You can select the script's insertion point (grip) and use the AutoCAD **Move** command to relocate the entire table and associated labels without re-running the script.\n- **Text Consistency**: Keep the **Edge Text Height** set to `0` to ensure your labels automatically scale if you change the Dim Style.\n- **Projection Data**: The script automatically detects and lists projected pocket lengths if the geometry allows (where adjacent angles are > 91 degrees).\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the viewport?**\n  - A: The script requires a valid SIP Element inside the selected viewport. If the viewport is empty or contains invalid data, the script will erase itself. Ensure you select a viewport showing a valid SIP.\n- **Q: Can I change the labels from Numbers to Letters after inserting?**\n  - A: Yes. Select the script, open the Properties palette, and change the **Numbering mode** property to \"Letters\". The table and drawing labels will update instantly.\n- **Q: How are lengths calculated?**\n  - A: Edge lengths are rounded up to the next millimeter for production accuracy."
      },
      "tokens_used": 6202,
      "error": null
    }
  }
}