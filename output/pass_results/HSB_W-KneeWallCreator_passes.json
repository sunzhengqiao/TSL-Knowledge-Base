{
  "filename": "HSB_W-KneeWallCreator.mcr",
  "status": "completed",
  "total_tokens": 44455,
  "processing_time": 518.1515083312988,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "04.04.2018",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "11.05.2018",
            "author": "AS",
            "changes": "Make walls meet the longest points of the top plate."
          },
          {
            "version": "1.02",
            "date": "26.09.2018",
            "author": "AS",
            "changes": "Set grouping data to linked elements."
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "HSB_G-FilterGenBeams"
        ]
      },
      "tokens_used": 6678,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of '_kModelSpace' in 'collectEntities' and 'dbCreate' calls. Script creates and manipulates 3D construction elements (ElementWallSF, GenBeam) rather than 2D annotations. Filename lacks 'sd_' or 'Multipage' prefixes."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element (User selected)",
            "ElementWallSF (Templates in source group)",
            "GenBeam (Top plates, Bottom plates, Studs, Zone 6)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing specific Element and Group structure",
          "requiredSettings": [
            "HSB_G-FilterGenBeams (TSL dependency)",
            "Floor Groups organized by namePart(1)",
            "Dummy Knee Wall group containing ElementWallSF templates"
          ]
        }
      },
      "tokens_used": 6033,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity/SelectElement",
              "promptOriginal": "|Select elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "propBeamCodesTopPlates",
            "type": "PropString",
            "displayName": "|Beam codes top plates|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "propBeamCodesBottomPlates",
            "type": "PropString",
            "displayName": "|Beam codes bottom plates|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "propBeamCodesStuds",
            "type": "PropString",
            "displayName": "|Beam codes studs|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "groupNameDummyKneeWalls",
            "type": "PropString",
            "displayName": "|Group name dummy knee walls|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "kneeWallType",
            "type": "PropString",
            "displayName": "|Knee wall type|",
            "defaultValue": "0",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "propBeamCodesZone6",
            "type": "PropString",
            "displayName": "|Beam codes zone| 6",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "groupNameKneeWalls",
            "type": "PropString",
            "displayName": "|Group name knee walls|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6230,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Converts loose construction beams (studs, top/bottom plates) located within a selected element into a formalized Knee Wall element. It automatically detects the wall geometry based on the top plate, applies cuts to the components, and assigns them to a new wall group.",
          "category": "Framing/Generation",
          "typicalUseCase": "Used when a roof or floor element contains preliminary or 'loose' framing for a vertical knee wall that needs to be converted into a distinct, manufacturable wall element with proper grouping and numbering."
        },
        "parameters": [
          {
            "name": "propBeamCodesTopPlates",
            "technicalDefault": "",
            "businessMeaning": "Specifies the beam codes (e.g., 'TP', 'RIM') used to identify which beams in the selection act as the top plate of the knee wall. These beams define the length and position of the wall.",
            "validRange": "Any string matching the beam codes present in the selected element",
            "unit": "String",
            "affectsOutput": "Determines the start and end points of the wall geometry. If incorrect, the wall length will be wrong, or the script will fail if no beams match."
          },
          {
            "name": "propBeamCodesBottomPlates",
            "technicalDefault": "",
            "businessMeaning": "Specifies the beam codes (e.g., 'BP', 'SOLE') used to identify the bottom plates. These beams will be cut to fit the new wall start/end and assigned to the wall element.",
            "validRange": "Any string matching the beam codes present in the selected element",
            "unit": "String",
            "affectsOutput": "Controls which loose beams are formally associated with the new wall as bottom plates. These beams will receive cuts at the wall ends."
          },
          {
            "name": "propBeamCodesStuds",
            "technicalDefault": "",
            "businessMeaning": "Specifies the beam codes (e.g., 'STUD', 'VERT') used to identify the vertical members. These beams will be cut to fit the new wall and assigned to the wall element.",
            "validRange": "Any string matching the beam codes present in the selected element",
            "unit": "String",
            "affectsOutput": "Controls which loose beams are assigned as studs. These beams will receive cuts at the wall ends."
          },
          {
            "name": "propBeamCodesZone6",
            "technicalDefault": "",
            "businessMeaning": "Specifies the beam codes for specific GenBeams (Zone 6) associated with the knee wall area (e.g., columns or special supports) that need to be linked to the new wall.",
            "validRange": "Any string matching the beam codes present in the selected element",
            "unit": "String",
            "affectsOutput": "Includes miscellaneous GenBeams in the grouping and cutting operations of the new wall."
          },
          {
            "name": "groupNameDummyKneeWalls",
            "technicalDefault": "",
            "businessMeaning": "Selects the source group (library) that contains template wall definitions (ElementWallSF). This group acts as a catalog of available wall types.",
            "validRange": "List of existing groups in the drawing",
            "unit": "String (Dropdown)",
            "affectsOutput": "Changes the available options for 'Knee wall type'. Defines where the script looks for wall templates."
          },
          {
            "name": "kneeWallType",
            "technicalDefault": "0",
            "businessMeaning": "Selects the specific wall construction template to generate (e.g., 'Internal-90', 'External-140'). This defines the wall's height, layer composition, and material properties.",
            "validRange": "List of ElementWallSF codes found in the 'Group name dummy knee walls'",
            "unit": "String (Dropdown)",
            "affectsOutput": "Determines the vertical height, construction layers, and general properties of the resulting wall."
          },
          {
            "name": "groupNameKneeWalls",
            "technicalDefault": "",
            "businessMeaning": "Selects the target group where the newly created knee wall element should be organized (e.g., '1st Floor', 'Roof').",
            "validRange": "List of existing groups in the drawing",
            "unit": "String (Dropdown)",
            "affectsOutput": "Sets the project grouping hierarchy for the generated wall."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing 'groupNameDummyKneeWalls'",
            "effect": "The script rescans the selected group to find available wall types, updating the options in 'kneeWallType'.",
            "cascade": [
              "kneeWallType"
            ]
          },
          {
            "trigger": "Invalid Beam Codes",
            "effect": "If the codes for Top Plates, Bottom Plates, or Studs do not match any beams in the selected element, the script reports a warning and aborts creation.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "ElementWallSF",
            "description": "A new wall element created at the calculated position, derived from the selected dummy template.",
            "appliedTo": "Model Space (placed into the target group specified by groupNameKneeWalls)"
          },
          {
            "type": "Cut (Start/End)",
            "description": "Orthogonal cuts applied to the start and end of the wall to trim the top plates, bottom plates, studs, and zone 6 items to the exact wall length.",
            "appliedTo": "Beams identified by the propBeamCodes properties (Top/Bottom/Studs/Zone6)"
          },
          {
            "type": "Group Assignment",
            "description": "The constituent beams (studs/plates) are assigned to the new ElementWallSF's element group.",
            "appliedTo": "Filtered GenBeams and Beams"
          },
          {
            "type": "Map/SubMap",
            "description": "Sets grouping data (ParentUID, Hsb_RoofWallChild) to link the new knee wall logically to the original parent element (e.g., the roof).",
            "appliedTo": "New ElementWallSF and Source Element"
          }
        ]
      },
      "tokens_used": 8324,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Start: Scan existing project groups to identify valid floor groups (name part checks).\",\n    \"2. Property Initialization: Populate dropdowns for 'Group name dummy knee walls' and 'Group name knee walls'. Define beam code properties.\",\n    \"3. [Check: Is _bOnInsert true?]\",\n    \"   - YES: Proceed to Insertion Workflow.\",\n    \"   - NO: Proceed to Execution Workflow.\",\n    \"4. Insertion Workflow: Check insertCycleCount; if > 1, erase instance to prevent loops.\",\n    \"5. Display Dialog: Prompt user to select 'Group name dummy knee walls' and 'Knee wall type'.\",\n    \"6. User Selection: Prompt user to select Source Elements (PrEntity).\",\n    \"7. Instance Spawning: Loop through selected elements and create a new script instance (dbCreate) for each, passing the element and a 'ManualInserted' flag.\",\n    \"8. Cleanup: Erase the original script instance.\",\n    \"9. Execution Workflow: Validate that exactly one Element was passed to the instance.\",\n    \"10. Property Refresh: Reload wall types from the specified Dummy Group (if manually inserted).\",\n    \"11. Map Cleanup: Iterate through internal Map and delete any previously existing 'KneeWall' entities.\",\n    \"12. Template Lookup: Retrieve the specific 'Dummy' Wall template based on 'Knee wall type'.\",\n    \"13. Geometry Collection: Collect all GenBeams from the selected Source Element.\",\n    \"14. Filtering Logic (Repeat for Top, Bottom, Studs, Zone 6): Call 'HSB_G-FilterGenBeams' TSL to separate beams by Beam Codes.\",\n    \"15. [Check: Filter Validation]\",\n    \"   - FAIL: Report error/notice and abort.\",\n    \"   - SUCCESS: Proceed.\",\n    \"16. Geometry Calculation: Calculate Wall Origin and End point by ordering vertices of the Top Plate beams.\",\n    \"17. Wall Generation: Copy the Dummy Wall, transform it to the calculated coordinate system, and set Start/End points.\",\n    \"18. Group Assignment: Rename the new Wall's element group to match the target 'Group name knee walls'.\",\n    \"19. Processing: Create orthogonal cuts at Start/End planes and apply them to all filtered beams (Top, Bottom, Studs, Zone 6).\",\n    \"20. Linking: Assign processed beams to the new Wall element. Update Grouping Data (ParentUID) linking Source Element and New Wall.\",\n    \"21. Termination: Erase the script instance.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Script State (_bOnInsert)\",\n      \"path1\": {\n        \"name\": \"Insertion Phase\",\n        \"steps\": [\n          \"Verify insertCycleCount is 1\",\n          \"Show Properties Dialog (unless Catalog Key is used)\",\n          \"Prompt for Element Selection\",\n          \"Spawn sub-instances via dbCreate\",\n          \"Erase self\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Execution Phase (Sub-instance)\",\n        \"steps\": [\n          \"Validate input Element\",\n          \"Filter beams and calculate geometry\",\n          \"Create/Modify Wall and Beams\",\n          \"Apply Cuts and Grouping\",\n          \"Erase self\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Beam Filtering Results (Top/Bottom/Studs)\",\n      \"path1\": {\n        \"name\": \"Beams Found\",\n        \"steps\": [\n          \"Store valid beam entities\",\n          \"Calculate Wall Length based on Top Plate vertices\",\n          \"Proceed to Wall creation\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No Beams Found / Filter Fail\",\n        \"steps\": [\n          \"Report Notice/Warning ('No top plates found!', etc.)\",\n          \"Erase Instance\",\n          \"Halt execution\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Selection Count\",\n      \"path1\": {\n        \"name\": \"Valid Single Element\",\n        \"steps\": [\n          \"Extract GenBeams\",\n          \"Begin filtering process"
      },
      "tokens_used": 10619,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_W-KneeWallCreator.mcr\n\n## Overview\nConverts loose construction beams (studs, top/bottom plates) located within a selected roof or floor element into a formalized Knee Wall element. It automatically detects the wall geometry based on the top plate, applies cuts to the components, and assigns them to a new wall group for manufacturing.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates exclusively in 3D Model Space to generate construction elements. |\n| Paper Space | No | Not designed for 2D layout or annotation. |\n| Shop Drawing | No | Not a drawing generation script. |\n\n## Prerequisites\n- **Required Entities**:\n  - A source Element (e.g., Roof or Floor) containing loose GenBeams representing the knee wall framing.\n  - A \"Dummy\" Group containing `ElementWallSF` templates to serve as the wall definition catalog.\n- **Dependencies**:\n  - `HSB_G-FilterGenBeams.tsl` must be available in the TSL search path.\n- **Project Structure**:\n  - Floor groups must be organized correctly (identified by name parts) for the script to detect valid target groups.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_W-KneeWallCreator.mcr`\n\n### Step 2: Configure Properties\nBefore selecting elements, open the **Properties Palette (Ctrl+1)** to configure the script parameters.\n1. Set the **Beam codes** to match the naming convention used in your project (e.g., \"TP\" for Top Plates, \"STUD\" for Studs).\n2. Select the **Group name dummy knee walls** to load available wall templates.\n3. Select the specific **Knee wall type** (template) you wish to generate.\n\n### Step 3: Select Source Elements\n```\nCommand Line: |Select elements|\nAction: Click on the main Element (e.g., Roof or Floor) that contains the loose knee wall beams you wish to convert.\n```\n*Note: The script will process the beams inside this element based on the codes defined in Step 2.*\n\n### Step 4: Automatic Processing\nThe script will automatically:\n1. Filter beams by the specified codes.\n2. Calculate the wall geometry based on the Top Plate locations.\n3. Create the new Wall element and assign the filtered beams to it.\n4. Apply orthogonal cuts to the start and end of the wall.\n5. Place the new wall in the specified target group.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Beam codes top plates | Text | \"\" | Enter the beam code (e.g., \"TP\") used to identify the top plates. These beams define the wall's length and position. |\n| Beam codes bottom plates | Text | \"\" | Enter the beam code (e.g., \"BP\") used to identify bottom plates to be included in the wall. |\n| Beam codes studs | Text | \"\" | Enter the beam code (e.g., \"STUD\") used to identify vertical studs to be included in the wall. |\n| Beam codes zone 6 | Text | \"\" | Enter the beam code for specific GenBeams (Zone 6) to be associated with the knee wall. |\n| Group name dummy knee walls | Dropdown | \"\" | Select the source group (library) containing your `ElementWallSF` wall templates. |\n| Knee wall type | Dropdown | \"0\" | Select the specific wall template (e.g., \"Internal-90\", \"External-140\") to generate. Options populate based on the Dummy Group selected. |\n| Group name knee walls | Dropdown | \"\" | Select the target group where the new knee wall element should be placed (e.g., \"1st Floor\"). |\n\n## Right-Click Menu Options\nNone defined. The script runs immediately upon insertion and entity selection.\n\n## Settings Files\n- **Dependency**: `HSB_G-FilterGenBeams.tsl`\n- **Location**: TSL Search Path (Company or Install folder)\n- **Purpose**: Filters the selected element's beams based on the specified beam codes.\n\n## Tips\n- **Beam Codes**: Ensure the codes entered in the properties match the actual codes of the loose beams in your element exactly. If the script creates nothing, check the spelling of these codes.\n- **Top Plate Continuity**: The script calculates the wall start and end points based on the vertices of the beams identified as \"Top Plates.\" Ensure these beams are placed accurately to define the correct wall length.\n- **Template Setup**: Before running the script, ensure your \"Dummy\" group contains valid `ElementWallSF` entities with the desired construction layers.\n\n## FAQ\n- **Q: The script erases itself immediately without creating a wall. Why?**\n  **A**: This usually happens if the script cannot find beams matching the specified \"Beam codes\" in the selected element. Check the Properties Palette to ensure the codes (e.g., for Top Plates) match the data in your model.\n- **Q: How do I change the height or layer makeup of the wall?**\n  **A**: The wall properties are derived from the \"Knee wall type\" template. You must modify the `ElementWallSF` template in the \"Dummy\" group or select a different template from the dropdown.\n- **Q: Can I process multiple elements at once?**\n  **A**: Yes, the script supports selecting multiple elements during the \"Select elements\" prompt. It will generate a knee wall for each valid selection."
      },
      "tokens_used": 6571,
      "error": null
    }
  }
}