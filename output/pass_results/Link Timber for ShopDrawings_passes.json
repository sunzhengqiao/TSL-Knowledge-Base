{
  "filename": "Link Timber for ShopDrawings.mcr",
  "status": "completed",
  "total_tokens": 35483,
  "processing_time": 244.687744140625,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "23.03.2023",
            "author": "Thorsten Huck",
            "changes": "HSB-18119 versioning added"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4649,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": true,
          "isMultipageScript": false,
          "detectionEvidence": "Display dp(-1); dp.showInTslInst(FALSE); dp.showInShopDraw(bm0); dp.addViewDirection(vecView); bm0.addTool(dt);"
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Script instance runs in Model Space attached to a beam to generate content in Shop Drawings.",
          "requiredSettings": []
        }
      },
      "tokens_used": 3766,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getBeam",
              "promptOriginal": "Select the primary beam for the shopdrawing",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "showDialogOnce",
              "promptOriginal": "Properties Palette",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrEntity",
              "promptOriginal": "Select a set of additional beams to be shown in the shopdrawing of the primary",
              "condition": "_bOnInsert",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "pTop",
            "type": "PropString",
            "displayName": "Show in Top",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "pBottom",
            "type": "PropString",
            "displayName": "Show in Bottom",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "pFront",
            "type": "PropString",
            "displayName": "Show in Front",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "pBack",
            "type": "PropString",
            "displayName": "Show in Back",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "pLeft",
            "type": "PropString",
            "displayName": "Show in Left",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "pRight",
            "type": "PropString",
            "displayName": "Show in Right",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "pIso",
            "type": "PropString",
            "displayName": "Show in Isometric",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "pDim",
            "type": "PropString",
            "displayName": "Turn on dimensioning",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "pTurnOff",
            "type": "PropString",
            "displayName": "Turn off",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5863,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Links secondary timber elements to a primary element so they appear in the primary element's shop drawings.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used when a detail view of a main timber element (e.g., a column) needs to show surrounding elements (e.g., braces, beams) to provide context for the fabrication drawing without those elements being part of the main piece."
        },
        "parameters": [
          {
            "name": "pTop",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the visibility of the linked beams in the Top view (Plan view) of the shop drawing.",
            "validRange": "Yes, No",
            "unit": "Enumeration",
            "affectsOutput": "Controls whether the projection of the linked beams is calculated and rendered when viewing the drawing from the top."
          },
          {
            "name": "pBottom",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the visibility of the linked beams in the Bottom view (or underside view) of the shop drawing.",
            "validRange": "Yes, No",
            "unit": "Enumeration",
            "affectsOutput": "Controls whether the projection of the linked beams is calculated and rendered when viewing the drawing from the bottom."
          },
          {
            "name": "pFront",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the visibility of the linked beams in the Front elevation view of the shop drawing.",
            "validRange": "Yes, No",
            "unit": "Enumeration",
            "affectsOutput": "Controls whether the projection of the linked beams is calculated and rendered when viewing the drawing from the front."
          },
          {
            "name": "pBack",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the visibility of the linked beams in the Back elevation view of the shop drawing.",
            "validRange": "Yes, No",
            "unit": "Enumeration",
            "affectsOutput": "Controls whether the projection of the linked beams is calculated and rendered when viewing the drawing from the back."
          },
          {
            "name": "pLeft",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the visibility of the linked beams in the Left side elevation view of the shop drawing.",
            "validRange": "Yes, No",
            "unit": "Enumeration",
            "affectsOutput": "Controls whether the projection of the linked beams is calculated and rendered when viewing the drawing from the left."
          },
          {
            "name": "pRight",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the visibility of the linked beams in the Right side elevation view of the shop drawing.",
            "validRange": "Yes, No",
            "unit": "Enumeration",
            "affectsOutput": "Controls whether the projection of the linked beams is calculated and rendered when viewing the drawing from the right."
          },
          {
            "name": "pIso",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the visibility of the linked beams in the 3D Isometric view of the shop drawing.",
            "validRange": "Yes, No",
            "unit": "Enumeration",
            "affectsOutput": "Controls whether the projection of the linked beams is calculated and rendered in the 3D view."
          },
          {
            "name": "pDim",
            "technicalDefault": "Yes",
            "businessMeaning": "Master switch to activate automatic dimensioning for the linked beams within the active views.",
            "validRange": "Yes, No",
            "unit": "Enumeration",
            "affectsOutput": "If Yes, dimension lines are generated for the linked beams in supported views (Top, Bottom, Front, Back). If No, the beams are drawn without dimensions."
          },
          {
            "name": "pTurnOff",
            "technicalDefault": "Yes",
            "businessMeaning": "Master switch to disable the entire link functionality without deleting the script instance.",
            "validRange": "Yes, No",
            "unit": "Enumeration",
            "affectsOutput": "If Yes, the script stops execution immediately, removing all linked beams and dimensions from the shop drawing. If No, normal processing occurs."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "pTurnOff is set to 'Yes'",
            "effect": "Overrides all other parameters. The script exits early and produces no geometry or dimensions.",
            "cascade": [
              "pTop",
              "pBottom",
              "pFront",
              "pBack",
              "pLeft",
              "pRight",
              "pIso",
              "pDim"
            ]
          },
          {
            "trigger": "pDim is set to 'Yes'",
            "effect": "Enables dimensioning, but dimensions are only actually generated if the specific view also allows it (Top, Bottom, Front, Back). Side and Iso views ignore the pDim setting.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "VisualRepresentation",
            "description": "Creates a 2D projection of the linked beams' bodies within the primary beam's drawing layout.",
            "appliedTo": "The Primary Beam's Shop Drawing."
          },
          {
            "type": "DimensionTool",
            "description": "Generates dimension lines representing the extreme points of the linked beams relative to the primary beam's coordinate system.",
            "appliedTo": "The Primary Beam's Shop Drawing (in Top, Bottom, Front, and Back views only)."
          }
        ]
      },
      "tokens_used": 6048,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script executed (Insert or Recalculate)",
          "2. Check if insertion mode (_bOnInsert) is active",
          "3. [Insertion Mode] Prompt user to select Primary Beam",
          "4. [Insertion Mode] Calculate insertion point on Primary Beam axis",
          "5. [Insertion Mode] Display initial Properties dialog",
          "6. [Insertion Mode] Prompt user to select set of Additional Beams",
          "7. [Insertion Mode] Filter selected beams to exclude the Primary Beam and add to list",
          "8. [Insertion Mode] Report count of linked beams",
          "9. [Insertion Mode] Check if any Additional Beams were successfully added",
          "10. [Insertion Mode] If links exist, scan Primary Beam for duplicate script instances and erase them",
          "11. [Insertion Mode] Finish insertion process",
          "12. [Recalculate Mode] Validate Primary Beam (_Beam0) exists and is valid",
          "13. [Recalculate Mode] Parse View Properties (Top, Bottom, Front, Back, Left, Right, Iso) to create active view list",
          "14. [Recalculate Mode] Draw small helper symbol in Model Space",
          "15. [Recalculate Mode] Evaluate 'Turn off' (pTurnOff) property",
          "16. [Recalculate Mode] Iterate through active view directions",
          "17. [Recalculate Mode] Create Display object for Shop Drawing context",
          "18. [Recalculate Mode] Iterate through linked Additional Beams",
          "19. [Recalculate Mode] Draw Body of linked beam in Shop Drawing",
          "20. [Recalculate Mode] Evaluate 'Turn on dimensioning' (pDim) and View compatibility",
          "21. [Recalculate Mode] If enabled, calculate extreme points and add DimTools to Primary Beam"
        ],
        "conditionalBranches": [
          {
            "condition": "User selects Additional Beams during insertion",
            "path1": {
              "name": "Beams Selected",
              "steps": [
                "PrEntity.go() returns true",
                "Loop through selection set",
                "Append non-primary beams to _Beam array",
                "Check for duplicate TSLs on Primary Beam",
                "Erase found duplicates to maintain uniqueness",
                "Report message confirming link count"
              ]
            },
            "path2": {
              "name": "No Selection / Cancel",
              "steps": [
                "PrEntity.go() returns false or selection is empty",
                "Skip beam append loop",
                "Skip duplicate check logic (since _Beam.length() is 1)",
                "Report message 'No beams selected to be shown is 0'",
                "Script continues with only Primary Beam reference"
              ]
            }
          },
          {
            "condition": "Primary Beam validity check on Recalculation",
            "path1": {
              "name": "Valid",
              "steps": [
                "_Beam0.bIsValid() is true",
                "Proceed to View generation logic"
              ]
            },
            "path2": {
              "name": "Invalid / Deleted",
              "steps": [
                "_Beam0.bIsValid() is false",
                "Execute eraseInstance()",
                "Script terminates immediately"
              ]
            }
          },
          {
            "condition": "Master Switch (pTurnOff) state",
            "path1": {
              "name": "Turned On (No)",
              "steps": [
                "pTurnOff != 'Yes'",
                "Execute Shop Drawing generation loop",
                "Draw bodies and dimensions"
              ]
            },
            "path2": {
              "name": "Turned Off (Yes)",
              "steps": [
                "pTurnOff == 'Yes'",
                "Skip Shop Drawing generation loop",
                "Script returns immediately (Model space helper remains)"
              ]
            }
          },
          {
            "condition": "Dimensioning Logic (Inside View Loop)",
            "path1": {
              "name": "Dimensions Allowed",
              "steps": [
                "pDim is 'Yes' AND View is Top/Bottom/Front/Back",
                "Calculate extreme vertices of linked beam",
                "Create DimTool and add to Primary Beam"
              ]
            },
            "path2": {
              "name": "Dimensions Suppressed",
              "steps": [
                "pDim is 'No' OR View is Left/Right/Iso",
                "Skip DimTool creation",
                "Continue drawing geometry only"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Primary Beam Integrity",
            "errorMessage": "None (Silent)",
            "recovery": "Script automatically erases itself if the primary beam it was attached to is deleted from the model."
          },
          {
            "check": "Duplicate Instance Prevention",
            "errorMessage": "None (Silent)",
            "recovery": "If a new TSL is inserted on a beam that already has this TSL attached, the script automatically finds and erases the older instance to ensure only one link definition exists per beam."
          },
          {
            "check": "Self-Selection Prevention",
            "errorMessage": "None (Logic Check)",
            "recovery": "If the user selects the Primary Beam again inside the 'Additional Beams' set, the script filters it out via the condition `if (bSet[b]!=_Beam[0])`."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Toggle Visibility in Views",
            "how": "OPM Properties (pTop, pBottom, pFront, pBack, pLeft, pRight, pIso)",
            "effect": "Adds or removes the projection of the linked beams from specific view directions in the Shop Drawing."
          },
          {
            "action": "Toggle Dimensioning",
            "how": "OPM Property (pDim)",
            "effect": "Adds or removes automatic dimension lines for the linked beams in supported views (Top, Bottom, Front, Back)."
          },
          {
            "action": "Disable Functionality",
            "how": "OPM Property (pTurnOff)",
            "effect": "Stops the script from generating any content in the Shop Drawing while keeping the instance attached to the beam."
          },
          {
            "action": "Move Primary Beam",
            "how": "Grip Edit / AutoCAD Move",
            "effect": "The script instance follows the beam. The linked geometry in the shop drawing updates relative to the new position."
          },
          {
            "action": "Delete Linked Beam",
            "how": "Erase Command",
            "effect": "The script recalculates. The reference to the deleted beam is effectively ignored or removed from the drawing loop, removing the geometry from the shop drawing."
          }
        ]
      },
      "tokens_used": 8202,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Link Timber for ShopDrawings.mcr\n\n## Overview\nThis script allows you to link secondary timber elements (like braces or connecting beams) to a primary element so they appear in the primary element's shop drawings. It provides context for fabrication by showing surrounding elements in plan, elevation, and 3D views without generating separate drawings for them.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script is inserted and attached to the primary beam here. |\n| Paper Space | No | Not applicable. |\n| Shop Drawing | Yes | The linked elements appear and are dimensioned here. |\n\n## Prerequisites\n- **Required entities**: One primary GenBeam (the main timber element).\n- **Minimum beam count**: 1 (Primary beam). Additional beams are optional during insertion.\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Link Timber for ShopDrawings.mcr`\n\n### Step 2: Select Primary Beam\n```\nCommand Line: Select the primary beam for the shopdrawing\nAction: Click on the main timber element you want to generate the shop drawing for.\n```\n\n### Step 3: Select Additional Beams\n```\nCommand Line: Select a set of additional beams to be shown in the shopdrawing of the primary\nAction: Select the surrounding beams, braces, or elements you want to include as reference. Press Enter when finished.\n```\n\n### Step 4: Configure Properties\nAfter selection, the script attaches to the beam. Use the **Properties Palette** (Ctrl+1) to adjust visibility and dimension settings as described below.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Show in Top | dropdown | Yes | Shows the linked beams in the Top view (Plan) of the shop drawing. |\n| Show in Bottom | dropdown | Yes | Shows the linked beams in the Bottom view of the shop drawing. |\n| Show in Front | dropdown | Yes | Shows the linked beams in the Front elevation view. |\n| Show in Back | dropdown | Yes | Shows the linked beams in the Back elevation view. |\n| Show in Left | dropdown | Yes | Shows the linked beams in the Left side elevation view. |\n| Show in Right | dropdown | Yes | Shows the linked beams in the Right side elevation view. |\n| Show in Isometric | dropdown | Yes | Shows the linked beams in the 3D Isometric view. |\n| Turn on dimensioning | dropdown | Yes | If set to Yes, dimensions are generated for linked beams in Top, Bottom, Front, and Back views. |\n| Turn off | dropdown | Yes | **Master Switch**: If set to \"Yes\", the script stops generating content in the shop drawing. Set to \"No\" to activate the link. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script uses standard TSL behavior. Modify settings via the Properties Palette. |\n\n## Settings Files\n- **Filename**: None required\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Duplicate Prevention**: If you insert this script on a beam that already has a link instance, the old instance is automatically removed to prevent conflicts.\n- **Dimension Limitations**: Dimensions are only created for the Top, Bottom, Front, and Back views. They are ignored in Left, Right, and Isometric views.\n- **Master Switch**: If your linked beams disappear, check the \"Turn off\" property in the palette. It defaults to \"Yes\" (disabled), so you must change it to \"No\" to see the links.\n- **Self-Selection**: You cannot select the primary beam as an additional beam; the script filters this out automatically.\n\n## FAQ\n- **Q: Why don't I see the linked beams in my shop drawing?**\n  - A: Check the **Turn off** property in the Properties Palette. It must be set to **No**. Also, verify that the specific view property (e.g., \"Show in Front\") is set to Yes.\n- **Q: Can I dimension the linked beams in the 3D view?**\n  - A: No, automatic dimensioning is only supported in 2D views (Top, Bottom, Front, Back).\n- **Q: What happens if I delete a linked beam from the model?**\n  - A: The script will automatically recalculate and remove the geometry/dimensions of that deleted beam from the shop drawing."
      },
      "tokens_used": 6955,
      "error": null
    }
  }
}