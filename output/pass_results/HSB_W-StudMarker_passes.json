{
  "filename": "HSB_W-StudMarker.mcr",
  "status": "completed",
  "total_tokens": 33365,
  "processing_time": 287.8767280578613,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "Tsl to create nail lines on specific zones",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "12.12.2012",
            "author": "",
            "changes": "Pilot version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4827,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses the constant '_kModelSpace' in the 'dbCreate' method (line 60) when creating satellite instances. It utilizes 'PrEntity' to select 'Element' objects and manipulates 3D properties using 'el.beam()', 'el.coordSys()', and 'el.addTool()'. There are no 'sd_' function prefixes, references to '_Viewport', or usage of '#Type E' with '_Entity[]' that would indicate Paper Space or Shop Drawing environments."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 4108,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "On Insert",
            "title": null,
            "dataSource": "TSL Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeperator01",
            "type": "PropString",
            "displayName": "|Selection|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sApplyToolingToElementType",
            "type": "PropString",
            "displayName": "     |Apply tooling to element type(s)|",
            "defaultValue": "|Roof|",
            "inputType": "dropdown",
            "options": [
              "|Roof|",
              "|Floor|",
              "|Wall|",
              "|Roof|;|Floor|",
              "|Roof|;|Wall|",
              "|Roof|;|Floor|;|Wall|",
              "|Floor|;|Wall|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sFilterBC",
            "type": "PropString",
            "displayName": "     Only mark beams with beamcode",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sSeperator02",
            "type": "PropString",
            "displayName": "|Tooling|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dMarkSize",
            "type": "PropDouble",
            "displayName": "     |Length markerline|",
            "defaultValue": "300",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sApplyToolingTo",
            "type": "PropString",
            "displayName": "     |Apply tooling to|",
            "defaultValue": "Zone 1",
            "inputType": "dropdown",
            "options": [
              "Zone 1",
              "Zone 2",
              "Zone 3",
              "Zone 4",
              "Zone 5",
              "Zone 6",
              "Zone 7",
              "Zone 8",
              "Zone 9",
              "Zone 10"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nToolingIndex",
            "type": "PropInt",
            "displayName": "     |Toolindex|",
            "defaultValue": "10",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4970,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of visual nailing lines (markers) on specific zones of timber elements (walls, floors, roofs) based on their type, assisting in on-site assembly or shop preparation.",
          "category": "Framing/Assembly",
          "typicalUseCase": "Used during the design phase to mark specific zones on timber elements where nailing or fastening is required, ensuring construction standards are met by visualizing these zones as lines."
        },
        "parameters": [
          {
            "name": "sApplyToolingToElementType",
            "technicalDefault": "|Roof|",
            "businessMeaning": "Filters which types of timber elements (Roof, Floor, or Wall) will receive the nailing line markers. This prevents applying floor nailing patterns to walls, etc.",
            "validRange": "Single or combined selections from Roof, Floor, Wall",
            "unit": "category",
            "affectsOutput": "Determines if the script runs on the selected element at all based on the element's geometric orientation relative to the world Z-axis."
          },
          {
            "name": "sFilterBC",
            "technicalDefault": "",
            "businessMeaning": "Restricts the tooling to only beams within the element that have specific Beam Codes. This allows targeting specific structural members (e.g., only studs or plates).",
            "validRange": "Any text string matching existing Beam Codes (semicolon-separated for multiple)",
            "unit": "text",
            "affectsOutput": "If specified, beams without matching codes are skipped, and no markers are generated on them."
          },
          {
            "name": "dMarkSize",
            "technicalDefault": "300",
            "businessMeaning": "The physical length of the nailing line marker drawn on the beam.",
            "validRange": "50 - 1000",
            "unit": "mm",
            "affectsOutput": "Visually changes the length of the line drawn on the timber surface. Longer lines are more visible from a distance."
          },
          {
            "name": "sApplyToolingTo",
            "technicalDefault": "Zone 1",
            "businessMeaning": "Selects the specific material zone (e.g., Zone 1 usually represents one face/side of the panel) where the markers should be applied.",
            "validRange": "Zone 1 through Zone 10",
            "unit": "zone",
            "affectsOutput": "Specifies which specific side or layer of the element receives the markers. Changing this moves the markers to a different face of the element."
          },
          {
            "name": "nToolingIndex",
            "technicalDefault": "10",
            "businessMeaning": "The identifier (index) used to group these markers. In production or CNC contexts, this can link the visual line to specific machine instructions or reporting categories.",
            "validRange": "0 - 1000",
            "unit": "index",
            "affectsOutput": "Assigns a specific ID to the generated ElemMarker objects. Does not change geometry, but affects data reporting and filtering."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Element Geometry",
            "effect": "Determines validity of 'sApplyToolingToElementType'",
            "cascade": [
              "sApplyToolingToElementType"
            ]
          },
          {
            "trigger": "sApplyToolingTo",
            "effect": "Determines the color and zone index of the output",
            "cascade": [
              "arNZone",
              "arNColorIndex"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "ElemMarker",
            "description": "A polyline (line) drawn on the element surface representing a nailing line. Two parallel lines are drawn on the top and bottom faces of vertical beams within the element relative to its coordinate system.",
            "appliedTo": "Vertical beams (Studs) inside the selected Element that match the Beam Code filter."
          }
        ]
      },
      "tokens_used": 5432,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Start (Master Instance): User executes command",
          "Show Dialog: User configures properties (Zones, Types, Mark Size)",
          "Prompt Selection: User selects target Elements",
          "Verify Selection: Did user select elements?",
          "Cleanup Phase: Iterate selected Elements to remove existing instances of this script matching the selected Zone (prevents duplicates)",
          "Satellite Creation: Create new satellite instance on each selected Element via dbCreate",
          "Master Termination: Erase master instance",
          "Satellite Initialization: Load properties from Master-to-Satellite map",
          "Determine Element Type: Calculate Element type (Wall, Floor, Roof) based on Z-vector dot product",
          "Validate Element Type: Check if Element Type matches user filter 'sApplyToolingToElementType'",
          "Process Beams: Collect all beams from the Element",
          "Filter Beams: Loop through beams to filter by Beam Code ('sFilterBC') and Orientation (Vertical check)",
          "Generate Markers: For valid vertical beams, calculate start/end points and create PLine markers",
          "Apply Tooling: Add ElemMarker objects to the Element"
        ],
        "conditionalBranches": [
          {
            "condition": "User Element Selection (ssE.go())",
            "path1": {
              "name": "Elements Selected",
              "steps": [
                "Loop through selected elements",
                "Erase old matching instances",
                "Create new satellite instances",
                "Erase master script"
              ]
            },
            "path2": {
              "name": "Selection Cancelled/Empty",
              "steps": [
                "Skip processing loop",
                "Erase master script"
              ]
            }
          },
          {
            "condition": "Element Type Validation (sApplyToolingToElementType)",
            "path1": {
              "name": "Type Matched",
              "steps": [
                "Proceed to beam collection and processing"
              ]
            },
            "path2": {
              "name": "Type Filtered Out",
              "steps": [
                "Report message: 'Element type filtered out'",
                "Erase satellite instance",
                "Stop execution"
              ]
            }
          },
          {
            "condition": "Beam Orientation Check (bm.vecX().isParallelTo(vyEl))",
            "path1": {
              "name": "Vertical Beam",
              "steps": [
                "Add beam to processing array",
                "Generate markers at beam ends"
              ]
            },
            "path2": {
              "name": "Non-Vertical Beam",
              "steps": [
                "Ignore beam (no markers added)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Attachment",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script erases itself if _Element array is empty"
          },
          {
            "check": "Element Type Compatibility",
            "errorMessage": "Element type filtered out: [Actual Type]",
            "recovery": "User must change 'Apply tooling to element type(s)' property to include the actual element type"
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None",
            "recovery": "Prevents recursive insertion by erasing instance if insertCycleCount > 1"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Marker Configuration",
            "how": "OPM (AutoCAD Properties Palette)",
            "effect": "Changing Zone, Element Type, Mark Size, or Tool Index triggers script recalculation. Markers are regenerated to reflect new size or position."
          },
          {
            "action": "Filter Beams",
            "how": "OPM - Edit 'Only mark beams with beamcode'",
            "effect": "Updates the beam filter. Markers are removed from beams that no longer match the code and added to those that do."
          },
          {
            "action": "Geometry Updates",
            "how": "Grip edit / Move Element",
            "effect": "Since the script runs in the context of the Element, markers will automatically update their position to follow changes in beam length or element position."
          },
          {
            "action": "Delete Script",
            "how": "Select Element -> Erase TSL Instance",
            "effect": "All generated nail lines (ElemMarkers) for this specific configuration are removed from the Element."
          }
        ]
      },
      "tokens_used": 7866,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_W-StudMarker.mcr\n\n## Overview\nThis script automates the creation of nailing lines (markers) on specific zones of timber elements (walls, floors, or roofs). It is used to visualize assembly or nailing zones on vertical studs within an element based on configurable properties.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script creates satellite instances on 3D Elements in the model. |\n| Paper Space | No | Not designed for 2D drawings or layouts. |\n| Shop Drawing | No | Not designed for Shop Drawing generation. |\n\n## Prerequisites\n- **Required entities**: At least one timber Element (Wall, Floor, or Roof).\n- **Minimum beam count**: 0 (Script processes existing beams; no new beams are created).\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n```\nCommand: TSLINSERT\nAction: Browse and select HSB_W-StudMarker.mcr\n```\n\n### Step 2: Configure Properties\n```\nAction: A property dialog appears. Adjust settings like Element Type, Zone, or Mark Size if necessary.\n```\n\n### Step 3: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the desired Wall, Floor, or Roof elements in the drawing and press Enter.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Apply tooling to element type(s) | dropdown | \\|Roof\\| | Filters which element types receive markers. Options include Roof, Floor, Wall, or combinations thereof. |\n| Only mark beams with beamcode | text | | Optional filter to mark only beams with a specific Beam Code (e.g., \"Stud\"). Leave empty to mark all vertical beams. |\n| Length markerline | number | 300 | The length of the nailing line drawn on the beam (in millimeters). |\n| Apply tooling to | dropdown | Zone 1 | Selects the specific Material Zone (1-10) on which the markers are drawn. |\n| Toolindex | number | 10 | The numeric identifier assigned to the marker for production or reporting purposes. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are defined for this script. Use standard AutoCAD properties to edit. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Vertical Detection**: The script automatically detects and marks only vertical beams (studs) within the element. Horizontal plates and headers are ignored.\n- **Beam Code Filtering**: Use the \"Only mark beams with beamcode\" property to exclude specific members, such as trimmer studs or jack studs, from the marking pattern.\n- **Zone Management**: Use different \"Apply tooling to\" zones to represent different assembly steps (e.g., Zone 1 for sheathing nailing, Zone 2 for drywall) without conflicts.\n- **Updates**: If you modify the element geometry (e.g., stretch a wall), the markers will automatically update their position to remain correct.\n\n## FAQ\n- **Q: I ran the script, but no lines appeared.**\n- **A:** Check the \"Apply tooling to element type(s)\" property. If you selected a Wall but the property is set to \"Roof\", the script will filter it out. Also, ensure the element contains vertical beams.\n- **Q: How do I remove the markers?**\n- **A:** Select the element, open the Properties palette, select the TSL instance entry, and press Delete. Alternatively, erase the specific satellite instance in the model."
      },
      "tokens_used": 6162,
      "error": null
    }
  }
}