{
  "filename": "hsbFillet.mcr",
  "status": "completed",
  "total_tokens": 47941,
  "processing_time": 580.3864185810089,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9204,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly inserts instances using tslNew.dbCreate into _kModelSpace. It prompts user selection using PrEntity for Beam() entities and adds PropellerSurfaceTool tools to beam geometry."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 6407,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select beam(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select first point on beam|",
              "condition": "Insertion Mode == Path",
              "required": true
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "\n|Select next point on same ring|",
              "condition": "Insertion Mode == Path",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "Insertion if _kExecuteKey is empty",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sMode",
            "type": "PropString",
            "displayName": "(A)   |Insertion Mode|",
            "defaultValue": "|Circumference|",
            "inputType": "dropdown",
            "options": [
              "|Circumference|",
              "|Path|"
            ],
            "category": "|General|",
            "description": "|Defines the Mode|"
          },
          {
            "index": 1,
            "variable": "sAlignment",
            "type": "PropString",
            "displayName": "(B)   |Alignment|",
            "defaultValue": "|Reference Side|",
            "inputType": "dropdown",
            "options": [
              "|Reference Side|",
              "|Opposite Side|",
              "|Both Sides|"
            ],
            "category": "|General|",
            "description": "|Defines the Alignment|"
          },
          {
            "index": 0,
            "variable": "dFilet",
            "type": "PropDouble",
            "displayName": "(C)  |Depth|",
            "defaultValue": "4",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the Depth|"
          },
          {
            "index": 0,
            "variable": "nToolIndex",
            "type": "PropInt",
            "displayName": "|ToolIndex|",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": "|Tool Settings|",
            "description": "|Defines the ToolIndex|"
          },
          {
            "index": 1,
            "variable": "dToolRadius",
            "type": "PropDouble",
            "displayName": "|Radius|",
            "defaultValue": "80",
            "inputType": "number",
            "options": [],
            "category": "|Tool Settings|",
            "description": "|Defines the tool radius|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8985,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a decorative or functional fillet (rounded edge) on timber beams, either around the entire circumference or along a specific user-defined path.",
          "category": "Machining/Finishing",
          "typicalUseCase": "Used to soften sharp edges for aesthetic purposes or safety, or to create specific architectural details on timber beams."
        },
        "parameters": [
          {
            "name": "sMode",
            "technicalDefault": "|Circumference|",
            "businessMeaning": "Defines the scope of the fillet application. It can either wrap around the entire beam cross-section or follow a specific linear path on the beam surface.",
            "validRange": "Circumference, Path",
            "unit": "Selection",
            "affectsOutput": "Switches the logic between applying the fillet to all faces of the beam cross-section versus generating the fillet only between two user-selected points on a specific face."
          },
          {
            "name": "sAlignment",
            "technicalDefault": "|Reference Side|",
            "businessMeaning": "Determines which face of the beam the fillet is applied relative to, or if it should be mirrored across the centerline.",
            "validRange": "Reference Side, Opposite Side, Both Sides",
            "unit": "Selection",
            "affectsOutput": "Controls the offset direction of the toolpath. 'Reference Side' offsets from the defined reference face, 'Opposite Side' offsets from the opposite face, and 'Both Sides' creates symmetric fillets."
          },
          {
            "name": "dFilet",
            "technicalDefault": "4",
            "businessMeaning": "The distance the fillet cuts into the material from the edge of the beam.",
            "validRange": "1 mm - 50 mm",
            "unit": "mm",
            "affectsOutput": "Directly changes the width of the cut geometry. Larger values remove more material from the beam corner."
          },
          {
            "name": "nToolIndex",
            "technicalDefault": "1",
            "businessMeaning": "The identifier for the specific CNC tool in the machine library to use for this operation.",
            "validRange": "1 - 99",
            "unit": "Integer ID",
            "affectsOutput": "Assigns the correct tooling logic for CNC exports; does not change geometry in the CAD model but impacts manufacturing data."
          },
          {
            "name": "dToolRadius",
            "technicalDefault": "80",
            "businessMeaning": "The physical radius of the milling cutter used to calculate the surface geometry of the fillet.",
            "validRange": "5 mm - 300 mm",
            "unit": "mm",
            "affectsOutput": "Determines the curvature of the fillet surface. The script calculates the cut surface based on sweeping this radius along the path."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sMode set to 'Path'",
            "effect": "Enables interactive point picking workflow during insertion.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "PropellerSurfaceTool",
            "description": "A 3D surface machining operation added to the beam, representing the material removal for the fillet.",
            "appliedTo": "Selected GenBeam entities"
          }
        ]
      },
      "tokens_used": 7532,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"Script execution starts (User launches command or inserts TSL)\",\n    \"Check for command key (_kExecuteKey) to load catalog presets\",\n    \"[Condition] If no command key -> Show Properties Dialog (Mode, Alignment, Depth, Tool Settings)\",\n    \"Prompt user to select beam(s) (PrEntity)\",\n    \"[Condition] Check Insertion Mode property (sMode)\",\n    \"[Branch: Circumference] Iterate through selected beams\",\n    \"[Branch: Circumference] Create new TSL instance on each beam center (dbCreate)\",\n    \"[Branch: Path] Focus on the first selected beam\",\n    \"[Branch: Path] Calculate reference geometry (Straight vs Curved beam logic)\",\n    \"Prompt user to select first point on beam (getPoint)\",\n    \"Prompt user to select second point on same ring (PrPoint)\",\n    \"Calculate path segments and vertices based on selected points\",\n    \"[Condition] Check Alignment property (sAlignment) to determine faces\",\n    \"Generate PropellerSurfaceTool geometry for the valid faces\",\n    \"Generate display representation (PLine/Symbols)\",\n    \"Script execution completes\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Insertion Mode (sMode) Property Value\",\n      \"path1\": {\n        \"name\": \"Circumference\",\n        \"steps\": [\n          \"User selects one or multiple beams\",\n          \"Script iterates through the selection set\",\n          \"A separate TSL instance is created and attached to every beam in the selection\",\n          \"Geometric processing (tool creation) is delegated to these new instances\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Path\",\n        \"steps\": [\n          \"User selects beams (only the first one is used)\",\n          \"Script determines if beam is curved or straight\",\n          \"User picks a start point on the beam surface\",\n          \"User picks an end point on the same ring/contour\",\n          \"Script calculates the specific path between points\",\n          \"Tool geometry is generated directly on the single beam instance\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Beam Geometry Type\",\n      \"path1\": {\n        \"name\":"
      },
      "tokens_used": 10833,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbFillet.mcr\n\n## Overview\nThis script creates decorative or functional fillets (rounded edges) on timber beams. It allows you to apply a fillet around the entire beam circumference or along a specific user-defined path on the beam surface.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script explicitly runs in Model Space. |\n| Paper Space | No | Not supported in layout views. |\n| Shop Drawing | No | This is a modeling/scripting tool, not a detailing tool. |\n\n## Prerequisites\n- **Required Entities:** At least one GenBeam (Timber Beam) must exist in the drawing.\n- **Minimum Beam Count:** 1.\n- **Required Settings:** None specific to external files.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbFillet.mcr` from the file dialog.\n\n### Step 2: Configure Insertion Mode\nA dialog will appear upon insertion (if no command key is preset). You can adjust the **Insertion Mode**, **Alignment**, and **Depth** here or later in the Properties Panel. Click OK to proceed.\n\n### Step 3: Select Beam(s)\n```\nCommand Line: Select beam(s)\nAction: Click on one or multiple beams in the model.\n```\n*Note: If in \"Path\" mode, only the first beam selected will be processed. If in \"Circumference\" mode, all selected beams will be processed.*\n\n### Step 4: Define Path (Path Mode Only)\n*If you selected **Circumference** mode, the script finishes automatically after selection. If you selected **Path** mode, proceed to the following prompts:*\n\n```\nCommand Line: Select first point on beam\nAction: Click a point on the beam surface where the fillet should start.\n```\n\n```\nCommand Line: Select next point on same ring\nAction: Click the end point on the same cross-sectional ring (contour) to define the length of the fillet.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| (A) Insertion Mode | dropdown | Circumference | Determines if the fillet is applied around the whole beam or along a specific path. Options: `Circumference`, `Path`. |\n| (B) Alignment | dropdown | Reference Side | Sets the side of the beam to apply the fillet relative to the reference face. Options: `Reference Side`, `Opposite Side`, `Both Sides`. |\n| (C) Depth | number | 4 | The distance the fillet cuts into the material from the edge (in mm). |\n| ToolIndex | number | 1 | The identifier for the CNC tool to be used for this operation. |\n| Radius | number | 80 | The physical radius of the milling cutter used to calculate the fillet curvature (in mm). |\n\n## Right-Click Menu Options\n*None specific to this script were detected in the analysis.*\n\n## Settings Files\n*No external settings files (XML) are required for this script.*\n\n## Tips\n- **Bulk Processing:** Use the **Circumference** mode if you need to round the edges of many beams at once. You can select multiple beams during the insertion prompt.\n- **Path Selection:** When using **Path** mode, ensure your two points are on the same \"ring\" (cross-section) for the best results. The script calculates the geometry based on the beam's reference system.\n- **CNC Data:** Ensure the **ToolIndex** matches your actual machine library to ensure the correct tool is selected during manufacturing.\n- **Visualizing Depth:** The **Depth** parameter controls how \"sharp\" or \"deep\" the roundover is. Larger values create a more aggressive cut.\n\n## FAQ\n- **Q: I selected multiple beams, but only the first one got a fillet. Why?**\n  **A:** You are likely using **Path** mode. In Path mode, the script only processes the single beam you are interacting with to define the start and end points. Switch to **Circumference** mode to process multiple beams simultaneously.\n- **Q: How do I round the bottom edge only?**\n  **A:** Set the **Alignment** property to `Reference Side` or `Opposite Side` depending on how your beam is constructed and which side you need. Use `Both Sides` to round symmetrical edges.\n- **Q: What does the Radius property actually do?**\n  **A:** It simulates the size of the cutter. A larger radius creates a gentler, shallower curve, while a smaller radius creates a tighter, more pronounced roundover."
      },
      "tokens_used": 4980,
      "error": null
    }
  }
}