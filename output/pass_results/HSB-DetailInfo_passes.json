{
  "filename": "HSB-DetailInfo.mcr",
  "status": "completed",
  "total_tokens": 54772,
  "processing_time": 329.64818024635315,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9215,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script operates on _Element and OpeningRoof entities found in _kModelSpace. Uses 3D geometric calculations (CoordSys, Plane, Vector3d) and assigns to element groups. No ShopDrawing types (#Type E) or sd_ prefixes found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "OpeningRoof"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Detail Catalog (referenced via map variable 'DspToTsl' or _kExecuteKey)"
          ]
        }
      },
      "tokens_used": 7081,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeperator01",
            "type": "PropString",
            "displayName": "Information",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Information",
            "description": null
          },
          {
            "index": 1,
            "variable": "sName",
            "type": "PropString",
            "displayName": "Detail name",
            "defaultValue": "Line A",
            "inputType": "text",
            "options": [],
            "category": "Information",
            "description": null
          },
          {
            "index": 2,
            "variable": "sDescription",
            "type": "PropString",
            "displayName": "Description",
            "defaultValue": "Line B",
            "inputType": "text",
            "options": [],
            "category": "Information",
            "description": null
          },
          {
            "index": 7,
            "variable": "sExtraDescription",
            "type": "PropString",
            "displayName": "Extra description",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Information",
            "description": null
          },
          {
            "index": 9,
            "variable": "sExtraDescription2",
            "type": "PropString",
            "displayName": "Extra description 2",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Information",
            "description": null
          },
          {
            "index": 10,
            "variable": "sExtraDescription3",
            "type": "PropString",
            "displayName": "Extra description 3",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Information",
            "description": null
          },
          {
            "index": 11,
            "variable": "sExtraDescription4",
            "type": "PropString",
            "displayName": "Extra description 4",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Information",
            "description": null
          },
          {
            "index": 13,
            "variable": "sExtraDescription5",
            "type": "PropString",
            "displayName": "Extra description 5",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Information",
            "description": null
          },
          {
            "index": 3,
            "variable": "sSeperator02",
            "type": "PropString",
            "displayName": "Presentation",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Presentation",
            "description": null
          },
          {
            "index": 4,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension style",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [],
            "category": "Presentation",
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": "Presentation",
            "description": null
          },
          {
            "index": 5,
            "variable": "sHorizontalTextAlignment",
            "type": "PropString",
            "displayName": "Horizontal text alignment",
            "defaultValue": "Left",
            "inputType": "dropdown",
            "options": [
              "Left",
              "Right",
              "Center"
            ],
            "category": "Presentation",
            "description": null
          },
          {
            "index": 0,
            "variable": "dxOffset",
            "type": "PropDouble",
            "displayName": "Horizontal text offset",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "Presentation",
            "description": null
          },
          {
            "index": 12,
            "variable": "sVisibleOnTopViewOnly",
            "type": "PropString",
            "displayName": "Visible on top view only",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Presentation",
            "description": null
          },
          {
            "index": 8,
            "variable": "sZoneLayer",
            "type": "PropString",
            "displayName": "Assign to layer",
            "defaultValue": "Tooling",
            "inputType": "dropdown",
            "options": [
              "Tooling",
              "Information",
              "Zone",
              "Element"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nZnIndex",
            "type": "PropInt",
            "displayName": "Zone index",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              0,
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8446,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the placement and configuration of construction detail labels on roof elements and openings, pulling text content from a predefined catalog based on the specific geometric context (e.g., eaves, verges, openings).",
          "category": "Annotation / Documentation",
          "typicalUseCase": "Used by the generator to automatically tag specific roof details with construction instructions defined in a detail catalog, ensuring consistent labeling on the model and in drawings."
        },
        "parameters": [
          {
            "name": "sSeperator01",
            "technicalDefault": "",
            "businessMeaning": "UI-only visual separator for the 'Information' property group. Has no effect on the model.",
            "validRange": "N/A",
            "unit": "String",
            "affectsOutput": "None"
          },
          {
            "name": "sName",
            "technicalDefault": "Line A",
            "businessMeaning": "The primary identifier or code for the detail (e.g., 'Detail A', 'Type 1'). This is the first line displayed in the label.",
            "validRange": "Short alphanumeric strings (standard detail codes)",
            "unit": "String",
            "affectsOutput": "Text content of the label and the 'DetailName' map entry for export."
          },
          {
            "name": "sDescription",
            "technicalDefault": "Line B",
            "businessMeaning": "The main descriptive line for the detail (e.g., 'Fascia & Soffit'). Provides specific info about the construction assembly.",
            "validRange": "Alphanumeric strings",
            "unit": "String",
            "affectsOutput": "Text content of the label (Line 2)."
          },
          {
            "name": "sExtraDescription",
            "technicalDefault": "",
            "businessMeaning": "Additional description line 1 for supplementary info (e.g., specific material notes).",
            "validRange": "Alphanumeric strings",
            "unit": "String",
            "affectsOutput": "Appends to the multi-line text label if present."
          },
          {
            "name": "sExtraDescription2",
            "technicalDefault": "",
            "businessMeaning": "Additional description line 2.",
            "validRange": "Alphanumeric strings",
            "unit": "String",
            "affectsOutput": "Appends to the multi-line text label if present."
          },
          {
            "name": "sExtraDescription3",
            "technicalDefault": "",
            "businessMeaning": "Additional description line 3.",
            "validRange": "Alphanumeric strings",
            "unit": "String",
            "affectsOutput": "Appends to the multi-line text label if present."
          },
          {
            "name": "sExtraDescription4",
            "technicalDefault": "",
            "businessMeaning": "Additional description line 4.",
            "validRange": "Alphanumeric strings",
            "unit": "String",
            "affectsOutput": "Appends to the multi-line text label if present."
          },
          {
            "name": "sExtraDescription5",
            "technicalDefault": "",
            "businessMeaning": "Additional description line 5.",
            "validRange": "Alphanumeric strings",
            "unit": "String",
            "affectsOutput": "Appends to the multi-line text label if present."
          },
          {
            "name": "sSeperator02",
            "technicalDefault": "",
            "businessMeaning": "UI-only visual separator for the 'Presentation' property group.",
            "validRange": "N/A",
            "unit": "String",
            "affectsOutput": "None"
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Specifies the dimension style (font, text height, arrows) to be used for the label text.",
            "validRange": "Names of existing Dimension Styles in the drawing template.",
            "unit": "String",
            "affectsOutput": "Visual appearance (font, size) of the text."
          },
          {
            "name": "nColor",
            "technicalDefault": -1,
            "businessMeaning": "Sets the color of the detail text. -1 uses the color of the assigned layer (ByLayer).",
            "validRange": "0-255 (AutoCAD Color Index) or -1 (ByLayer)",
            "unit": "Index",
            "affectsOutput": "Color of the text in the CAD view."
          },
          {
            "name": "sHorizontalTextAlignment",
            "technicalDefault": "Left",
            "businessMeaning": "Defines how the text block aligns relative to its insertion point. 'Left' draws text to the right, 'Right' draws to the left.",
            "validRange": "Left, Right, Center",
            "unit": "Enum",
            "affectsOutput": "Justification and position of the text label."
          },
          {
            "name": "dxOffset",
            "technicalDefault": 0,
            "businessMeaning": "Shifts the text horizontally away from the default insertion point along the detail line direction.",
            "validRange": "Typically -1000mm to 1000mm (depending on drawing scale and clutter).",
            "unit": "mm",
            "affectsOutput": "Horizontal position of the text label."
          },
          {
            "name": "sVisibleOnTopViewOnly",
            "technicalDefault": "No",
            "businessMeaning": "Restricts the text to be visible only in Plan (Top) views. If 'Yes', it is hidden in elevations, sections, and 3D views.",
            "validRange": "No, Yes",
            "unit": "Enum",
            "affectsOutput": "Visibility state in different viewports."
          },
          {
            "name": "sZoneLayer",
            "technicalDefault": "Tooling",
            "businessMeaning": "Assigns the text to a logical category (Zone/Element/Tooling/Information), often used to control layer mapping or data export filtering.",
            "validRange": "Tooling, Information, Zone, Element",
            "unit": "Enum",
            "affectsOutput": "Layer assignment and export categorization."
          },
          {
            "name": "nZnIndex",
            "technicalDefault": 0,
            "businessMeaning": "Specifies a sub-index for the Zone layer, allowing for finer granularity (e.g., Zone 0, Zone 1).",
            "validRange": "0-9",
            "unit": "Index",
            "affectsOutput": "Layer suffix or specific group assignment."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Catalog Loading (DspToTsl map variable)",
            "effect": "The script retrieves properties from the catalog specified in the map (or derived from the roof edge geometry), overwriting the default values for the text fields.",
            "cascade": [
              "sName",
              "sDescription",
              "sExtraDescription",
              "sExtraDescription2",
              "sExtraDescription3",
              "sExtraDescription4",
              "sExtraDescription5"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text Annotation",
            "description": "A multi-line text label constructed from the Name, Description, and Extra Description fields, positioned relative to the calculated detail line.",
            "appliedTo": "Parent Element (Roof/Wall) in Model Space."
          }
        ]
      },
      "tokens_used": 9955,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Execution Triggered\",\n    \"2. [Conditional] Check if '_bOnInsert' is true\",\n    \"3. Verify '_PtG' (Grip Points) exist\",\n    \"4. Synchronize Geometry: Restore 'PtG0/PtG1' from Map or calculate from Generator inputs\",\n    \"5. [Conditional] Analyze 'DspToTsl' Map Variable\",\n    \"6. Perform Geometric Analysis of Parent Element (Roof Edges, Openings, Supports)\",\n    \"7. [Conditional] Resolve Catalog Name using Geometry results if needed\",\n    \"8. Load Properties from Catalog\",\n    \"9. Calculate Text Orientation and Position\",\n    \"10. Generate Text Entity and Update Export Map\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Manual Insertion Detection (_bOnInsert)\",\n      \"path1\": {\n        \"name\": \"Manual Insertion\",\n        \"steps\": [\n          \"Show Property Dialog (showDialog)\",\n          \"Display Warning: 'This tsl should be attached to a DSP detail and cannot be inserted manually!'\",\n          \"Erase Script Instance\",\n          \"Stop Execution\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Generator Attachment\",\n        \"steps\": [\n          \"Skip Dialog\",\n          \"Continue to Grip Point Validation\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Point Initialization Source\",\n      \"path1\": {\n        \"name\": \"Map Exists (Regen/Update)\",\n        \"steps\": [\n          \"Check if 'PtG0' and 'PtG1' exist in _Map\",\n          \"Overwrite _PtG[0] and _PtG[1] with Map values\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Initial Placement\",\n        \"steps\": [\n          \"Calculate detail line from Generator inputs (_Pt0, _PtG)\",\n          \"Project points to detail line\",\n          \"Store calculated points to _Map as 'PtG0/PtG1'\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Catalog Resolution Strategy (DspToTsl)\",\n      \"path1\": {\n        \"name\": \"Variable Index (VAR)\",\n        \"steps\": [\n          \"Parse integer index from 'DspToTsl' string\",\n          \"Wait for geometric analysis to find 'DET' key\",\n          \"Parse 'DET' string using index to get final Catalog Name\",\n          \"Load Properties\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Direct Catalog Name\",\n        \"steps\": [\n          \"Use 'DspToTsl' string directly as Catalog Name\",\n          \"Load Properties immediately\",\n          \"Remove 'DspToTsl' from Map\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Element Type (Geometric Analysis)\",\n      \"path1\": {\n        \"name\": \"Roof Element\",\n        \"steps\": [\n          \"Cast to ElementRoof\",\n          \"Collect Roof Edges and Openings\",\n          \"Intersect script position with edges/openings to find 'DET' string\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Other Element\",\n        \"steps\": [\n          \"Skip complex geometric analysis\",\n          \"Proceed with existing/default catalog data\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Grip Points Availability\",\n      \"errorMessage\": \"No grippoints found. TSL Will be erased\",\n      \"recovery\": \"Ensure the generator provides valid coordinate inputs (_PtG) or check element selection.\"\n    },\n    {\n      \"check\": \"Catalog Name Existence (Direct)\",\n      \"errorMessage\": \"No catalogname specified\",\n      \"recovery\": \"Configure the DSP detail to pass a valid catalog name in the 'DspToTsl' argument.\"\n    },\n    {\n      \"check\": \"Variable Index Parsing (CODE/STRVAR)\",\n      \"errorMessage\": \"Catalog index not found or Catalogname not found\",\n      \"recovery\": \"Ensure the geometric 'DET' string contains the correct tokens for the variable index requested.\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Edit Text Properties\",\n      \"how\": \"OPM (AutoCAD Properties Palette)\",\n      \"effect\": \"Updates the label content (Name, Description, Extra lines) and"
      },
      "tokens_used": 12389,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB-DetailInfo.mcr\n\n## Overview\nAutomates the placement and configuration of construction detail labels on roof elements and openings. It pulls text content from a predefined catalog based on the specific geometric context (e.g., eaves, verges, openings) to ensure consistent labeling in the model.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates on 3D elements and assigns labels to element groups. |\n| Paper Space | No | Not designed for Paper Space directly. |\n| Shop Drawing | No | Does not generate shop drawings or views. |\n\n## Prerequisites\n- **Required Entities**: An existing Element (Wall/Roof) or OpeningRoof.\n- **Minimum Beam Count**: N/A (Operates on Elements).\n- **Required Settings**: A valid **Detail Catalog** must be configured and referenced by the generator.\n\n## Usage Steps\n\n### Step 1: Generate Model\n**Action**: Run a Roof or Wall generator that includes \"Detail\" or \"Info\" settings configured to use this script (HSB-DetailInfo).\n**Note**: This script is designed to be attached automatically by the generator. See the FAQ regarding manual insertion.\n\n### Step 2: Verify Placement\n**Action**: Once generation is complete, inspect the model. Text labels should appear at critical roof locations (eaves, ridges, openings) based on the catalog rules.\n\n### Step 3: Customize Properties (Optional)\n**Action**: If you need to modify the label for a specific instance:\n1. Select the detail label in the Model Space.\n2. Open the **Properties Palette** (Ctrl+1).\n3. Modify the text fields (Name, Description) or visual settings (Color, Layer) as described below.\n\n---\n\n## Properties Panel Parameters\n\n### Information\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sSeperator01 | String | - | *Visual Separator only.* |\n| Detail name | String | Line A | The primary identifier or code for the detail (e.g., \"Detail A\"). |\n| Description | String | Line B | The main descriptive text for the detail (e.g., \"Fascia & Soffit\"). |\n| Extra description | String | - | Additional description line 1. |\n| Extra description 2 | String | - | Additional description line 2. |\n| Extra description 3 | String | - | Additional description line 3. |\n| Extra description 4 | String | - | Additional description line 4. |\n| Extra description 5 | String | - | Additional description line 5. |\n\n### Presentation\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sSeperator02 | String | - | *Visual Separator only.* |\n| Dimension style | String | _DimStyles | Select the dimension style to control text font and height. |\n| Color | Integer | -1 | Sets the text color. Use `-1` for \"ByLayer\". |\n| Horizontal text alignment | Dropdown | Left | Sets text justification: **Left**, **Right**, or **Center**. |\n| Horizontal text offset | Double | 0 | Shifts the text horizontally from the insertion point (in mm). |\n| Visible on top view only | Dropdown | No | If set to **Yes**, the label is hidden in 3D views, sections, and elevations. |\n\n### Layering\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Assign to layer | Dropdown | Tooling | Assigns the label to a logical group: **Tooling**, **Information**, **Zone**, or **Element**. |\n| Zone index | Integer | 0 | Specifies a sub-index for the layer assignment (0-9). |\n\n---\n\n## Right-Click Menu Options\nThis script does not add custom options to the right-click context menu. Standard hsbCAD context options apply.\n\n## Settings Files\n- **Filename**: Defined by the `DspToTsl` map variable in the generator.\n- **Location**: Referenced within the Project or Catalog configuration.\n- **Purpose**: Provides the default text strings (Name, Description) based on the geometric location of the detail point.\n\n## Tips\n- **Cleaning up Views**: Set `Visible on top view only` to **Yes** if you want the labels to appear on your floor plans but not clutter your 3D model views or Section cuts.\n- **Avoiding Overlaps**: Use the `Horizontal text offset` property to nudge text away from geometry if it overlaps with beams or other annotations.\n- **Color Coding**: Change the `Color` property to make critical details (e.g., special structural connections) stand out from standard dimensions.\n\n## FAQ\n- **Q: I tried to insert this script manually, but it disappeared. Why?**\n  A: This script is designed to be attached to a \"DSP Detail\" point by a generator. If inserted manually via `TSLINSERT`, it detects it lacks the required geometry context, displays a warning, and erases itself to prevent errors.\n- **Q: How do I change the text for all details of a certain type?**\n  A: You should modify the source **Detail Catalog** used by your generator. Changing properties on individual instances in the model is usually for one-off exceptions.\n- **Q: What does the \"Zone index\" do?**\n  A: It acts as a suffix or subgroup for the layer assignment. This is useful if you want to export different groups of details to separate CAD layers or production reports."
      },
      "tokens_used": 7686,
      "error": null
    }
  }
}