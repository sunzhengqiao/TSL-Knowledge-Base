{
  "filename": "hsb_Vent.mcr",
  "status": "completed",
  "total_tokens": 54691,
  "processing_time": 252.45197558403015,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9134,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates in Model Space as evidenced by the usage of getPoint(), getGenBeam(), and direct 3D geometric manipulations (Body, PlaneProfile, Vector3d) within an Element context. There are no references to 'sd_' prefixes, 'Multipage', Viewport interaction, or ShopDrawing specific entities like #Type E with _Entity[]. The script interacts with Element, Sheet, and Beam entities to modify the 3D model."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Sheet",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "The script must be inserted into or interact with an existing hsbCAD Element (wall/roof). It modifies Sheets and creates/interacts with Beams (studs/battens) within that Element.",
          "requiredSettings": [
            "TslUtilities.dll (for standard interaction)",
            "hsb_ScriptInsert command context"
          ]
        }
      },
      "tokens_used": 5635,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "SelectOption",
            "trigger": "During script execution",
            "title": null,
            "dataSource": "Script internal logic (TslUtilities.dll)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 17,
            "variable": "sFormat",
            "type": "PropString",
            "displayName": "|Format Label|",
            "defaultValue": "|Vent|",
            "inputType": "text",
            "options": null,
            "category": "|Display|",
            "description": "|Defines the format of the description.|"
          },
          {
            "index": 12,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": "_DimStyles (System List)",
            "category": "|Display|",
            "description": null
          },
          {
            "index": 13,
            "variable": "sDispRep",
            "type": "PropString",
            "displayName": "Display Representation",
            "defaultValue": "",
            "inputType": "text",
            "options": null,
            "category": "|Display|",
            "description": null
          },
          {
            "index": 0,
            "variable": "dHeight",
            "type": "PropDouble",
            "displayName": "Height to underside of top timber",
            "defaultValue": "1250 mm",
            "inputType": "number",
            "options": null,
            "category": "|Location and size|",
            "description": null
          },
          {
            "index": 18,
            "variable": "sVentType",
            "type": "PropString",
            "displayName": "Vent Shape",
            "defaultValue": "Rectangular",
            "inputType": "dropdown",
            "options": [
              "Rectangular",
              "Round"
            ],
            "category": "|Location and size|",
            "description": null
          },
          {
            "index": 1,
            "variable": "dVentW",
            "type": "PropDouble",
            "displayName": "Width of vent",
            "defaultValue": "150 mm",
            "inputType": "number",
            "options": null,
            "category": "|Location and size|",
            "description": null
          },
          {
            "index": 2,
            "variable": "dVentH",
            "type": "PropDouble",
            "displayName": "Height of vent",
            "defaultValue": "150 mm",
            "inputType": "number",
            "options": null,
            "category": "|Location and size|",
            "description": null
          },
          {
            "index": 3,
            "variable": "dDiameter1",
            "type": "PropDouble",
            "displayName": "Diameter of Vent",
            "defaultValue": "150 mm",
            "inputType": "number",
            "options": null,
            "category": "|Location and size|",
            "description": null
          },
          {
            "index": 14,
            "variable": "sCreateVertical",
            "type": "PropString",
            "displayName": "Create Vertical Blocks",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "|Location and size|",
            "description": "This option allow you to create vertical beams around the vent"
          },
          {
            "index": 21,
            "variable": "sStretchOption",
            "type": "PropString",
            "displayName": "|Stretch vertical|",
            "defaultValue": "Do not stretch",
            "inputType": "dropdown",
            "options": [
              "Do not stretch",
              "Stretch left",
              "Stretch right",
              "Stretch both"
            ],
            "category": "|Location and size|",
            "description": "|Options for stretching the vertical beams around the vent|"
          },
          {
            "index": 16,
            "variable": "sCreateStuds",
            "type": "PropString",
            "displayName": "Snap to existing studs",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "|Location and size|",
            "description": "If the vent is not fixed this can allow the vent to be created next to existing studs."
          },
          {
            "index": 8,
            "variable": "sFixed",
            "type": "PropString",
            "displayName": "Fixed vent",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "|Location and size|",
            "description": "if fixed then it cannot move left and right"
          },
          {
            "index": 23,
            "variable": "sFreeze",
            "type": "PropString",
            "displayName": "Freeze vent",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "|Location and size|",
            "description": "It will freeze the beams creation so they can be manualy modified"
          },
          {
            "index": 26,
            "variable": "sStudExistingDelete",
            "type": "PropString",
            "displayName": "|Delete existing stud|",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "|If option yes is selected, then the existing stud that collides with vent will be deleted unless"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Add/Remove Format|",
            "handler": "|Add/Remove Format|",
            "action": "Recalculates script with key to Add/Remove Format",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Select tool|",
            "handler": "|Select tool|",
            "action": "Recalculates script with key to Select tool",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "TslDoubleClick",
            "handler": "TslDoubleClick",
            "action": "Double-click action to potentially open properties",
            "alsoTriggeredBy": "Double-click"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8768,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates ventilation openings (rectangular or round) in timber frame walls or roofs, including cutting the exterior sheeting and generating the necessary surrounding timber framing members.",
          "category": "Framing/Openings",
          "typicalUseCase": "Used during the design phase to add vents for air circulation, ensuring the structural integrity of the wall is maintained by adding cripple studs or noggings around the cutout."
        },
        "parameters": [
          {
            "name": "sFormat",
            "technicalDefault": "|Vent|",
            "businessMeaning": "The label or name assigned to the vent instance for production reports (BOM/CAM) and drawing labels.",
            "validRange": "Text string (e.g., 'Vent', 'AirBrick')",
            "unit": "String",
            "affectsOutput": "Modifies the label displayed in the model and exported data; does not change geometry."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles (System List)",
            "businessMeaning": "The CAD dimensioning standard used to display measurements if dimensions are enabled.",
            "validRange": "N/A (System defined styles)",
            "unit": "N/A",
            "affectsOutput": "Visual representation of dimensions in 2D drawings."
          },
          {
            "name": "sDispRep",
            "technicalDefault": "",
            "businessMeaning": "Controls the visibility and graphical representation of the vent script in different model views or display configurations.",
            "validRange": "N/A (System defined representations)",
            "unit": "N/A",
            "affectsOutput": "Visibility of the script object in various CAD viewports."
          },
          {
            "name": "dHeight",
            "technicalDefault": "1250 mm",
            "businessMeaning": "The vertical elevation of the vent, measured to the reference point (typically the underside of the vent or top timber) relative to the element's base.",
            "validRange": "0 mm to Wall Height",
            "unit": "mm",
            "affectsOutput": "Moves the cutout and framing up or down along the wall element."
          },
          {
            "name": "sVentType",
            "technicalDefault": "Rectangular",
            "businessMeaning": "Specifies the geometric shape of the ventilation opening.",
            "validRange": "Rectangular, Round",
            "unit": "Option",
            "affectsOutput": "Switches the geometric logic between creating a rectangular profile (using Width/Height) and a circular profile (using Diameter)."
          },
          {
            "name": "dVentW",
            "technicalDefault": "150 mm",
            "businessMeaning": "The horizontal clear width of a rectangular vent opening.",
            "validRange": "50 mm to 2000 mm",
            "unit": "mm",
            "affectsOutput": "Defines the X-axis size of the rectangular cutout in the sheeting and the spacing for surrounding studs."
          },
          {
            "name": "dVentH",
            "technicalDefault": "150 mm",
            "businessMeaning": "The vertical clear height of a rectangular vent opening.",
            "validRange": "50 mm to 2000 mm",
            "unit": "mm",
            "affectsOutput": "Defines the Y-axis size of the rectangular cutout in the sheeting and the spacing for surrounding studs."
          },
          {
            "name": "dDiameter1",
            "technicalDefault": "150 mm",
            "businessMeaning": "The diameter of a round vent opening.",
            "validRange": "50 mm to 1000 mm",
            "unit": "mm",
            "affectsOutput": "Defines the size of the circular cutout in the sheeting and the size of the surrounding frame."
          },
          {
            "name": "sCreateVertical",
            "technicalDefault": "Yes",
            "businessMeaning": "Determines whether the script automatically generates the vertical timber members (cripple studs/jacks) to frame the vent.",
            "validRange": "No, Yes",
            "unit": "Option",
            "affectsOutput": "If Yes, creates new Beam entities on the left and right of the vent. If No, only the hole is cut (relying on existing structure)."
          },
          {
            "name": "sStretchOption",
            "technicalDefault": "Do not stretch",
            "businessMeaning": "Defines how the vertical framing members behave vertically relative to the vent (e.g., extending full height between top and bottom plates).",
            "validRange": "Do not stretch, Stretch left, Stretch right, Stretch both",
            "unit": "Option",
            "affectsOutput": "Modifies the length and Z-position of the generated vertical beams. 'Stretch' typically extends them to top/bottom plates."
          },
          {
            "name": "sCreateStuds",
            "technicalDefault": "Yes",
            "businessMeaning": "Controls the automatic positioning logic to align the vent with existing wall studs to avoid unnecessary cuts.",
            "validRange": "No, Yes",
            "unit": "Option",
            "affectsOutput": "Moves the vent insertion point laterally to snap to the center or edge of nearby existing studs."
          },
          {
            "name": "sFixed",
            "technicalDefault": "No",
            "businessMeaning": "Locks the horizontal position of the vent, preventing the script from automatically moving it to suit stud spacing.",
            "validRange": "No, Yes",
            "unit": "Option",
            "affectsOutput": "Overrides 'Snap to existing studs'. If Yes, the vent stays exactly where placed, even if it cuts through an existing stud."
          },
          {
            "name": "sFreeze",
            "technicalDefault": "No",
            "businessMeaning": "Disconnects the generated framing beams from the script, allowing manual editing without the script overwriting changes on recalculation.",
            "validRange": "No, Yes",
            "unit": "Option",
            "affectsOutput": "Stops the regeneration of vertical beams. Existing beams become standard independent entities."
          },
          {
            "name": "sStudExistingDelete",
            "technicalDefault": "No",
            "businessMeaning": "Determines if an existing structural stud intersected by the vent opening should be automatically removed.",
            "validRange": "No, Yes",
            "unit": "Option",
            "affectsOutput": "If Yes, deletes colliding existing studs. If No, the vent might fail to generate or clash with the existing stud."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sVentType changes to 'Round'",
            "effect": "Disables Rectangular dimensions and enables Diameter.",
            "cascade": [
              "dVentW",
              "dVentH",
              "dDiameter1"
            ]
          },
          {
            "trigger": "sVentType changes to 'Rectangular'",
            "effect": "Enables Width/Height and disables Diameter.",
            "cascade": [
              "dVentW",
              "dVentH",
              "dDiameter1"
            ]
          },
          {
            "trigger": "sCreateVertical is set to 'No'",
            "effect": "Disables vertical framing options.",
            "cascade": [
              "sStretchOption"
            ]
          },
          {
            "trigger": "sFixed is set to 'Yes'",
            "effect": "Overrides automatic snapping logic.",
            "cascade": [
              "sCreateStuds"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Cutout/Contour",
            "description": "A void subtraction in the element's sheeting (cladding) to create the physical opening.",
            "appliedTo": "Sheet entities within the Element."
          },
          {
            "type": "Beam",
            "description": "Vertical timber members (studs/jacks) created to frame the opening, potentially extending to top/bottom plates based on stretch settings.",
            "appliedTo": "Element (as new GenBeams)."
          },
          {
            "type": "Machining/Cut",
            "description": "If 'Delete existing stud' is No, the existing stud may be cut to accommodate the vent (depending on specific logic not fully visible but implied by stud interaction).",
            "appliedTo": "Existing intersecting Beams."
          }
        ]
      },
      "tokens_used": 10851,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"User executes command to insert hsb_Vent script.\",\n    \"User selects a target Element (Wall or Roof) within the Model Space.\",\n    \"User specifies the insertion point for the vent on the Element face.\",\n    \"Script calculates the local coordinate system based on the Element's orientation.\",\n    \"Script evaluates 'Fixed vent' (sFixed) property to determine positioning logic.\",\n    \"If not fixed, script searches for existing studs to snap to (based on 'Snap to existing studs' sCreateStuds).\",\n    \"Script checks for collisions with existing studs at the calculated location.\",\n    \"If collision detected, script checks 'Delete existing stud' (sStudExistingDelete) to either remove the stud or handle the conflict.\",\n    \"Script generates the vent profile based on 'Vent Shape' (sVentType): Rectangular (Width/Height) or Round (Diameter).\",\n    \"Script executes Painter logic to cut the vent profile out of the Element's sheeting (cladding).\",\n    \"Script checks 'Create Vertical Blocks' (sCreateVertical) property.\",\n    \"If enabled, script generates vertical framing members (studs/jacks) around the opening.\",\n    \"Script applies 'Stretch vertical' (sStretchOption) logic to the new vertical beams to adjust their height/length.\",\n    \"Script generates display information (Text labels, DXA attributes) and finalizes the instance.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Vent Shape (sVentType)\",\n      \"path1\": {\n        \"name\": \"Rectangular\",\n        \"steps\": [\n          \"Uses dVentW and dVentH properties for geometry.\",\n          \"Creates a rectangular cutout in sheets.\",\n          \"Generates rectangular framing geometry.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Round\",\n        \"steps\": [\n          \"Uses dDiameter1 property for geometry.\",\n          \"Creates a circular cutout in sheets.\",\n          \"Generates circular framing geometry (or 4-sided approximation).\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Fixed Vent (sFixed)\",\n      \"path1\": {\n        \"name\": \"No\",\n        \"steps\": [\n          \"Script allows automatic positioning.\",\n          \"If 'Snap to existing studs' is Yes, position is adjusted to align with neighboring studs.\",\n          \"Vent may move if wall layout changes.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Yes\",\n        \"steps\": [\n          \"Script locks position to the exact picked point.\",\n          \"Overrides stud snapping logic.\",\n          \"Maintains absolute position regardless of wall layout changes.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Existing Stud Collision\",\n      \"path1\": {\n        \"name\": \"Delete Existing Stud = Yes\",\n        \"steps\": [\n          \""
      },
      "tokens_used": 12747,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_Vent\n\n## Overview\nThis script creates ventilation openings (rectangular or round) in timber frame walls or roofs. It automatically cuts the exterior sheeting and generates the necessary surrounding timber framing members (cripple studs/jacks) to maintain structural integrity.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Operates on 3D Elements (Walls/Roofs). |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: An existing hsbCAD Element (Wall or Roof) containing Sheets (cladding).\n- **Minimum Beams**: 0 (though existing studs are used for snapping).\n- **Required Settings**: TslUtilities.dll must be loaded (standard hsbCAD environment).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or `hsb_ScriptInsert`)\nAction: Select the `hsb_Vent.mcr` file from the file browser.\n\n### Step 2: Select Element\n```\nCommand Line: Select Element:\nAction: Click on the Wall or Roof element where you want to place the vent.\n```\n\n### Step 3: Specify Location\n```\nCommand Line: Specify insertion point:\nAction: Click on the face of the element to define the position of the vent.\n```\n\n### Step 4: Configure Properties\nAction: Press `Enter` or `Esc` to finish insertion. Select the script instance and adjust parameters in the **Properties Palette** (OPM) to define size, shape, and framing behavior.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Display** | | | |\n| Format Label | text | Vent | Defines the format of the description label (for production lists). |\n| Dimension style | dropdown | *Current* | Selects the CAD dimensioning style for the vent. |\n| Display Representation | text | | Controls the visibility/display of the vent in different views. |\n| **Location and size** | | | |\n| Height to underside of top timber | number | 1250 mm | The vertical elevation of the vent relative to the element base. |\n| Vent Shape | dropdown | Rectangular | Choose between **Rectangular** or **Round**. |\n| Width of vent | number | 150 mm | Horizontal width (used for Rectangular vents). |\n| Height of vent | number | 150 mm | Vertical height (used for Rectangular vents). |\n| Diameter of Vent | number | 150 mm | Diameter size (used for Round vents). |\n| Create Vertical Blocks | dropdown | Yes | If **Yes**, creates vertical timber members (studs) around the vent. |\n| Stretch vertical | dropdown | Do not stretch | Determines if vertical beams stretch to top/bottom plates (Do not stretch, Stretch left, Stretch right, Stretch both). |\n| Snap to existing studs | dropdown | Yes | If **Yes**, the vent position snaps to align with nearby existing studs. |\n| Fixed vent | dropdown | No | If **Yes**, locks the horizontal position so it does not snap to studs or move automatically. |\n| Freeze vent | dropdown | No | If **Yes**, stops automatic regeneration of beams, allowing manual editing. |\n| Delete existing stud | dropdown | No | If **Yes**, deletes an existing stud that collides with the vent opening. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add/Remove Format | Adds or removes the format label/mark from the model. |\n| Select tool | Selects the tool/script instance (useful for finding specific objects in a complex model). |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not use external XML settings files.\n\n## Tips\n- **Positioning**: If the vent keeps jumping to a location you didn't click, set **Fixed vent** to **Yes**. This overrides the automatic stud snapping feature.\n- **Manual Editing**: If you need to manually modify the generated cripple studs (e.g., adding specific notches or cuts), set **Freeze vent** to **Yes**. This prevents the script from overwriting your manual changes during the next recalculation.\n- **Round Vents**: When switching to **Round** vents, the Width and Height parameters are ignored, and the Diameter parameter is used instead.\n\n## FAQ\n- **Q: Why is there no hole in my sheeting?**\n  - A: Ensure the script is inserted into an Element that has Sheets assigned to it. The script cuts the Sheet based on the calculated profile.\n- **Q: The vent is cutting through an existing stud. What should I do?**\n  - A: You can set **Delete existing stud** to **Yes** to remove the interfering stud automatically. Alternatively, set **Fixed vent** to **No** and **Snap to existing studs** to **Yes** so the vent moves to a clear bay.\n- **Q: How do I create a rectangular vent that is taller than it is wide?**\n  - A: Set **Vent Shape** to **Rectangular**, then adjust the **Width of vent** and **Height of vent** values independently in the properties panel."
      },
      "tokens_used": 7556,
      "error": null
    }
  }
}