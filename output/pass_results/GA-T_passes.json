{
  "filename": "GA-T.mcr",
  "status": "completed",
  "total_tokens": 51957,
  "processing_time": 317.28801369667053,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9166,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script creates 3D geometry using Body and generates manufacturing data via HardWrComp. It interacts directly with GenBeam and Truss entities. Explicitly collects entities from _kModelSpace using Group().collectEntities(..., _kModelSpace). There is no usage of Viewport, _kPaperSpace, sd_ prefixes, or drawing generation logic typical of ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Truss"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space containing structural elements to connect.",
          "requiredSettings": [
            "GenericAngle.xml (Configuration file located in hsbCompany\\TSL\\Settings or hsbInstall\\Content\\General\\TSL\\Settings)",
            "Manufacturer XML definition files (AngleBracketCatalog structure)"
          ]
        }
      },
      "tokens_used": 7074,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sCatalogue\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Catalogue|\",\n      \"defaultValue\": \"|_Default|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|_Default|\",\n        \"|_LastInserted|\",\n        \"... (Dynamic list from XML)\"\n      ],\n      \"category\": \"|General|\",\n      \"description\": \"|Select the catalogue|\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"nSubtract\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Subtract|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No|\",\n        \"|Yes|\"\n      ],\n      \"category\": \"|General|\",\n      \"description\": \"|Enable/Disable subtractions|\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"nSide\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Side|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Left|\",\n        \"|Right|\"\n      ],\n      \"category\": \"|General|\",\n      \"description\": \"|Select the side of the beam|\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"nSideDetail\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|SideDetail|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Left|\",\n        \"|Right|\"\n      ],\n      \"category\": \"|General|\",\n      \"description\": \"|Select the side of the beam (Detail)|\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"nDisplay\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Display|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Body|\",\n        \"|Model|\",\n        \"|Symbol|\"\n      ],\n      \"category\": \"|General"
      },
      "tokens_used": 9923,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts manufacturer-specific metal angle brackets to connect timber beams or trusses, handling placement, collision detection, and material subtraction.",
          "category": "Hardware / Connection",
          "typicalUseCase": "Connecting joists to rim beams, securing trusses to top plates, or general timber-to-timber connections using standardized metal brackets (e.g., Simpson Strong-Tie, Würth)."
        },
        "parameters": [
          {
            "name": "sCatalogue",
            "technicalDefault": "|_Default|",
            "businessMeaning": "Selects the specific manufacturer and product family (e.g., Simpson, Würth) for the angle bracket. This loads the corresponding geometric dimensions, nail patterns, and article numbers from an external XML configuration.",
            "validRange": "List of available manufacturer XML files in the company or general settings folder",
            "unit": "String (Selection)",
            "affectsOutput": "Determines the 3D shape of the bracket, the quantity and type of fasteners (nails/screws), and manufacturing data (article numbers)."
          },
          {
            "name": "nSubtract",
            "technicalDefault": 0,
            "businessMeaning": "Controls whether the timber is milled to create a recess for the bracket. If enabled, the bracket sits flush with the timber surface; if disabled, it sits on top.",
            "validRange": "0 (No/Surface), 1 (Yes/Flush)",
            "unit": "Boolean",
            "affectsOutput": "Toggles the generation of material removal (milling/pocket) on the connected timber elements."
          },
          {
            "name": "nSide",
            "technicalDefault": 0,
            "businessMeaning": "Defines the placement side of the bracket relative to the primary beam's coordinate system (X-axis direction).",
            "validRange": "0 (Left), 1 (Right)",
            "unit": "Enumerated",
            "affectsOutput": "Mirrors the bracket geometry horizontally relative to the beam centerline."
          },
          {
            "name": "nSideDetail",
            "technicalDefault": 0,
            "businessMeaning": "Refines the side orientation, often used for specific detailing logic, secondary beam connection, or view generation representation.",
            "validRange": "0 (Left), 1 (Right)",
            "unit": "Enumerated",
            "affectsOutput": "Adjusts the geometric orientation of the bracket detail, potentially flipping which leg of the angle connects to which member."
          },
          {
            "name": "nDisplay",
            "technicalDefault": 0,
            "businessMeaning": "Controls the graphical representation and complexity of the bracket in the CAD model and drawings.",
            "validRange": "0 (Body/3D Solid), 1 (Model/Wireframe), 2 (Symbol)",
            "unit": "Enumerated",
            "affectsOutput": "Changes how the connector is visualized on screen and in exported views (e.g., realistic 3D body vs. simplified 2D symbol)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing 'sCatalogue'",
            "effect": "Reloads all geometric and material parameters from the selected XML file.",
            "cascade": [
              "Bracket Dimensions",
              "Fastener Types",
              "Article Numbers"
            ]
          },
          {
            "trigger": "Changing 'nSubtract' to Yes",
            "effect": "Enables material removal logic on the beam.",
            "cascade": [
              "Beam Machining",
              "Hardware Placement Depth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Hardware Component (Main)",
            "description": "The metal angle bracket itself (e.g., A35, LUS).",
            "appliedTo": "Model Space (linked to selected GenBeams/Trusses)."
          },
          {
            "type": "Hardware Component (Fasteners)",
            "description": "Nails or screws defined in the catalog XML (e.g., 10/30 - 3.0x30mm).",
            "appliedTo": "Model Space (associated with the bracket)."
          },
          {
            "type": "Machining (Subtract)",
            "description": "Milled pocket or surface plane cut to recess the bracket flush with the timber.",
            "appliedTo": "The connected GenBeam or Truss element (if nSubtract is enabled)."
          },
          {
            "type": "Collision Body",
            "description": "Internal geometry used to check for interference with other brackets.",
            "appliedTo": "Internal Script Logic."
          }
        ]
      },
      "tokens_used": 9380,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Load XML configuration files (AngleBracketCatalog, Manufacturer definitions) from Company or General settings.",
          "2. User Selection: User selects the primary entity (GenBeam or Truss) and defines the insertion point.",
          "3. Configuration: User selects the specific Manufacturer/Catalog and sets initial properties (Side, Subtract, Display) via dialog or Properties palette.",
          "4. Geometry Calculation: Script calculates the bracket dimensions and local coordinate system based on the selected entity and parameters.",
          "5. Smart Placement Attempt (Insert Only): Script checks if the bracket fits the current geometry.",
          "   - 5a. If Invalid: Automatically attempts to mirror the bracket placement.",
          "   - 5b. If still Invalid: Automatically attempts to rotate the bracket placement.",
          "   - 5c. If all attempts fail: The script instance is erased.",
          "6. Collision Detection: Script checks for intersections with other existing GA-T instances in the Model Space.",
          "7. Final Generation: If valid, the 3D Body, Machining (if Subtraction enabled), and Hardware data (BOM) are generated.",
          "8. Visualization: Display output is rendered based on 'nDisplay' setting (Body/Model/Symbol)."
        ],
        "conditionalBranches": [
          {
            "condition": "During Insertion - Bracket Fit Check",
            "path1": {
              "name": "Placement Successful",
              "steps": [
                "Create Bracket Body",
                "Assign to Groups",
                "Generate Output"
              ]
            },
            "path2": {
              "name": "Placement Failed",
              "steps": [
                "Try Mirrored Placement",
                "If Mirrored Fails -> Try Rotated Placement",
                "If Rotated Fails -> Erase Instance"
              ]
            }
          },
          {
            "condition": "Collision Detection (Recalc/Edit)",
            "path1": {
              "name": "Collision Detected",
              "steps": [
                "Draw 'Collision!!!' text at insertion point",
                "Halt geometry generation (Return)",
                "Script remains in model but shows error"
              ]
            },
            "path2": {
              "name": "No Collision",
              "steps": [
                "Proceed with Geometry and Hardware generation"
              ]
            }
          },
          {
            "condition": "Property 'nSubtract' (Subtract)",
            "path1": {
              "name": "Yes (1)",
              "steps": [
                "Generate Machining/Pocket on the beam",
                "Recess bracket into timber"
              ]
            },
            "path2": {
              "name": "No (0)",
              "steps": [
                "Place bracket on surface of timber",
                "No machining added"
              ]
            }
          },
          {
            "condition": "Post-Insertion Parameter Change",
            "path1": {
              "name": "Valid Configuration",
              "steps": [
                "Script recalculates geometry",
                "Updates 3D Model and BOM"
              ]
            },
            "path2": {
              "name": "Impossible Configuration",
              "steps": [
                "Script recalculates",
                "Displays 'not possible' text",
                "Geometry hidden/invalidated"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Bracket Coverage / Fit",
            "errorMessage": "Implicit (Erase on insert or 'not possible' on edit)",
            "recovery": "Move script to a location with sufficient beam width, change bracket size in catalog, or change beam dimensions."
          },
          {
            "check": "XML Version Conflict",
            "errorMessage": "Report message regarding XML version mismatch.",
            "recovery": "Update the XML definition file in the settings folder to match the script requirements."
          },
          {
            "check": "Manufacturer Definition Validity",
            "errorMessage": "Script catches 'invalid manufacturer definition' (v2.24).",
            "recovery": "Ensure the selected XML file contains valid map structures for dimensions and hardware."
          },
          {
            "check": "Collision with other GA-T Brackets",
            "errorMessage": "Text 'Collision!!!' displayed at insertion point.",
            "recovery": "Move the script, delete the conflicting bracket, or adjust the 'Side' or 'SideDetail' parameters to clear the interference."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry Parameters",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Updates Catalogue, Side (Left/Right), SideDetail, Subtract (Yes/No), and Display mode. Triggers immediate recalculation."
          },
          {
            "action": "Move Position",
            "how": "Grip Edit / Move Command",
            "effect": "Re-evaluates placement. If moved to an invalid spot, script displays 'not possible'."
          },
          {
            "action": "Flip Orientation",
            "how": "Context Menu (Right-click) -> 'Flip Y axis'",
            "effect": "Recalculates the script with a modified transformation key to flip the bracket vertical orientation."
          },
          {
            "action": "Swap Legs",
            "how": "Context Menu (Right-click) -> 'Swap legs'",
            "effect": "Swaps the connection logic/legs of the angle bracket."
          }
        ]
      },
      "tokens_used": 10525,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GA-T.mcr\n\n## Overview\nInserts manufacturer-specific metal angle brackets to connect timber beams or trusses. It handles automatic placement fitting, collision detection with other connectors, and optional material subtraction for flush mounting.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates exclusively in the 3D model. |\n| Paper Space | No | This script does not generate 2D drawings directly. |\n| Shop Drawing | No | This is a modeling/ detailing tool. |\n\n## Prerequisites\n- **Required Entities**: `GenBeam` or `Truss` elements.\n- **Minimum Beams**: 1 (primary element to connect).\n- **Required Settings**: \n  - `GenericAngle.xml` (Configuration file).\n  - Manufacturer definition files (e.g., Simpson Strong-Tie, Würth) located in `hsbCompany\\TSL\\Settings` or `hsbInstall\\Content\\General\\TSL\\Settings`.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `GA-T.mcr` from the list.\n\n### Step 2: Select Location\n```\nCommand Line: Select beam or truss:\nAction: Click on the timber element (beam or truss) where you want to place the bracket.\n```\n```\nCommand Line: Specify insertion point:\nAction: Click on the face or edge of the beam to define the exact position for the connector.\n```\n\n### Step 3: Configure Bracket\n- Upon insertion, a dialog may appear to select the **Catalogue** (Manufacturer).\n- Alternatively, select the script instance and modify settings in the **Properties Palette**.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Options | Description |\n|-----------|------|---------|---------|-------------|\n| **Catalogue** | dropdown | `_Default` | Manufacturer List | Select the specific manufacturer catalog (e.g., Simpson, Würth). This defines geometry, size, and nail patterns. |\n| **Subtract** | dropdown | No | Yes, No | If **Yes**, creates a recess/milling in the timber so the bracket sits flush. If **No**, the bracket sits on the surface. |\n| **Side** | dropdown | Left | Left, Right | Determines the horizontal side of the beam's centerline for placement. |\n| **SideDetail** | dropdown | Left | Left, Right | Refines the side orientation for specific detailing requirements or secondary connections. |\n| **Display** | dropdown | Body | Body, Model, Symbol | Controls how the bracket is visualized: **Body** (3D Solid), **Model** (Wireframe), or **Symbol** (2D Representation). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Flip Y axis** | Flips the vertical orientation of the bracket. |\n| **Swap legs** | Swaps the connection logic, effectively rotating the bracket 180 degrees or swapping which legs connect to which members. |\n\n## Settings Files\n- **Filenames**: `GenericAngle.xml` and Manufacturer XMLs (e.g., `Simpson.xml`, `Wuerth.xml`).\n- **Location**: \n  - `hsbCompany\\TSL\\Settings` (Custom company settings).\n  - `hsbInstall\\Content\\General\\TSL\\Settings` (Default hsbCAD settings).\n- **Purpose**: These files contain the geometric dimensions, article numbers, and fastener patterns for the angle brackets.\n\n## Tips\n- **Automatic Fitting**: If the bracket does not fit at the selected location upon insertion, the script will automatically attempt to mirror or rotate it to find a valid position. If it still fails, the instance will be erased.\n- **Collision Detection**: If you see the text **\"Collision!!!\"** at the insertion point, the new bracket overlaps with an existing one. Move the script or delete the conflicting bracket.\n- **Flush Mounting**: Use the **Subtract** property set to **Yes** when you need the metalwork to be recessed into the timber (e.g., for architectural requirements or cladding clearance).\n\n## FAQ\n- **Q: Why did the script disappear immediately after I placed it?**\n  **A:** The script could not find a valid geometric fit for the selected bracket size on that specific part of the beam, even after trying mirrored and rotated orientations. Try a different location or a smaller bracket.\n- **Q: How do I hide the bracket details in the model to improve performance?**\n  **A:** Select the bracket and change the **Display** property in the Properties Palette to **Symbol** or **Model**.\n- **Q: The text \"Collision!!!\" appeared. What should I do?**\n  **A:** This indicates the bracket is interfering with another connector. Move the script along the beam axis or adjust the **Side** parameter to shift it away from the obstacle."
      },
      "tokens_used": 5889,
      "error": null
    }
  }
}