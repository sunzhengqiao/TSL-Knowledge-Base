{
  "filename": "hsb_ShowSideDetails.mcr",
  "status": "completed",
  "total_tokens": 50093,
  "processing_time": 212.47936511039734,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6671,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "Both",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "PropString sSpace offers options for 'paper space' and 'shopdraw multipage'. _bOnInsert block contains conditional logic: getViewport() is called for Paper Space, and getShopDrawView() is called for Shopdraw Space. The script retrieves the Element from these view entities to extract GenBeams."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "ShopDrawView",
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space (with a Viewport linked to an Element) or Shopdraw Space (with a ShopDrawView containing an Element)",
          "requiredSettings": [
            "HSB_G-FilterGenBeams"
          ]
        }
      },
      "tokens_used": 6904,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"|Pick a point where details will be generated|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getViewport\",\n        \"promptOriginal\": \"Select the viewport from which the element is taken\",\n        \"condition\": \"sSpace == sPaperSpace\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"getShopDrawView\",\n        \"promptOriginal\": \"|Select the view entity from which the module is taken|\",\n        \"condition\": \"sSpace == sShopdrawSpace\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"Standard Property Dialog\",\n      \"trigger\": \"_bOnInsert (showDialog)\",\n      \"title\": \"Properties\",\n      \"dataSource\": \"Internal Properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sSpace\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Drawing space|\",\n      \"defaultValue\": \"|paper space|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|paper space|\",\n        \"|shopdraw multipage|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"genBeamFilterDefinition\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Filter definition for genbeams to display|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Dynamic (from catalog HSB_G-FilterGenBeams)\"\n      ],\n      \"category\": \"|Filter|\",\n      \"description\": \"|Filter definition for beams to nail.|Use| HSB_G-FilterGenBeams |to define the filters|.\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sDisplayModeChain\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Display mode chain|\",\n      \"defaultValue\": \"|Parallel|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Parallel|\",\n        \"|Perpendicular|\",\n        \"|None|\"\n      ],\n      \"category\": \"|Dimensions|\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sDimStyle\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Dimstyle\",\n      \"defaultValue\": \"Current Dimstyle\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"System DimStyles\"\n      ],\n      \"category\": \"|Dimensions|\",\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"dTextOffset\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Text offset|\",\n      \"defaultValue\": \"U(5)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Dimensions|\",\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dDimensionOffset\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Offset for dimension lines|\",\n      \"defaultValue\": \"U(5)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Dimensions|\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dDimensionAngledOffset\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Offset for angled dimension lines|\",\n      \"defaultValue\": \"U(5)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Dimensions|\",\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"nColumn\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"Number of Columns\",\n     "
      },
      "tokens_used": 9689,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates 2D detail drawings of non-rectangular beam cross-sections (cuts, notches, tenons) arranged in a grid with dimensions.",
          "category": "ShopDrawing",
          "typicalUseCase": "Creating a detail sheet or appendix in production drawings that visualizes specific machining details or complex connections for quality control or assembly."
        },
        "parameters": [
          {
            "name": "sSpace",
            "technicalDefault": "\"|paper space|\"",
            "businessMeaning": "Specifies the drawing environment where the details will be generated (Model/Sheet view).",
            "validRange": "Paper Space, Shopdraw Multipage",
            "unit": "Selection",
            "affectsOutput": "Determines the selection method for the source element (Viewport vs ShopDrawView) and the target coordinate system for drawing."
          },
          {
            "name": "genBeamFilterDefinition",
            "technicalDefault": "\"\"",
            "businessMeaning": "Selects a predefined filter to choose which beams or beam types require detailing.",
            "validRange": "N/A (Dependent on 'HSB_G-FilterGenBeams' catalog entries)",
            "unit": "Selection",
            "affectsOutput": "Filters the list of beams processed. Only beams matching the filter will have their details drawn."
          },
          {
            "name": "sDisplayModeChain",
            "technicalDefault": "\"|Parallel|\"",
            "businessMeaning": "Determines the orientation of dimension lines relative to the measured segment.",
            "validRange": "Parallel (follows angle), Perpendicular (orthogonal), None",
            "unit": "Selection",
            "affectsOutput": "Changes the visual orientation of dimension lines attached to angled cuts."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "\"Current Dimstyle\"",
            "businessMeaning": "Selects the CAD dimension style (text height, arrows, units) for the generated dimensions.",
            "validRange": "System DimStyles",
            "unit": "Selection",
            "affectsOutput": "Alters the appearance of dimensions (font size, arrowheads, tick marks) in the detail."
          },
          {
            "name": "dTextOffset",
            "technicalDefault": "U(5)",
            "businessMeaning": "Distance between the detail geometry and the text label (Position Number).",
            "validRange": "1 - 20 mm",
            "unit": "mm",
            "affectsOutput": "Moves the text label closer or further from the detail outline."
          },
          {
            "name": "dDimensionOffset",
            "technicalDefault": "U(5)",
            "businessMeaning": "Gap between the detail geometry and the horizontal/vertical dimension lines.",
            "validRange": "2 - 20 mm",
            "unit": "mm",
            "affectsOutput": "Pushes dimension lines outward from the part to avoid overlapping the geometry."
          },
          {
            "name": "dDimensionAngledOffset",
            "technicalDefault": "U(5)",
            "businessMeaning": "Gap between the detail geometry and the dimension lines for angled cuts.",
            "validRange": "2 - 20 mm",
            "unit": "mm",
            "affectsOutput": "Controls the spacing of dimensions specifically on sloped or chamfered edges."
          },
          {
            "name": "dDetailScale",
            "technicalDefault": "U(0.25)",
            "businessMeaning": "Scale factor for the generated detail geometry (1.0 = full size, 0.5 = half size).",
            "validRange": "0.1 - 2.0",
            "unit": "Factor",
            "affectsOutput": "Zooms the detail drawing in or out. A value < 1 reduces the size to fit more details on the page."
          },
          {
            "name": "dOffsetHorizontal",
            "technicalDefault": "U(30)",
            "businessMeaning": "Horizontal spacing between columns of details.",
            "validRange": "10 - 100 mm",
            "unit": "mm",
            "affectsOutput": "Increases or decreases the width of the grid layout."
          },
          {
            "name": "dOffsetVertical",
            "technicalDefault": "U(30)",
            "businessMeaning": "Vertical spacing between rows of details.",
            "validRange": "10 - 100 mm",
            "unit": "mm",
            "affectsOutput": "Increases or decreases the height of the grid layout."
          },
          {
            "name": "nColumn",
            "technicalDefault": "5",
            "businessMeaning": "Number of detail columns before wrapping to the next row.",
            "validRange": "1 - 10",
            "unit": "Count",
            "affectsOutput": "Controls the grid structure; higher numbers create wider rows."
          },
          {
            "name": "nColorDetail",
            "technicalDefault": "32",
            "businessMeaning": "CAD color index used for the outline of the detail.",
            "validRange": "0 - 255",
            "unit": "Index",
            "affectsOutput": "Changes the color of the drawn polyline profile."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing nColumn",
            "effect": "Alters the grid layout logic. Combined with dOffsetHorizontal, it determines the total width required.",
            "cascade": []
          },
          {
            "trigger": "Changing sSpace",
            "effect": "Switches input method between Viewport selection and ShopDrawView selection.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "2D Geometry (PLine)",
            "description": "Polylines representing the cross-section profile of the beam (Side/Top/Bottom views) where cuts are present.",
            "appliedTo": "Filtered GenBeams"
          },
          {
            "type": "Dimension (AutoCAD)",
            "description": "Linear and aligned dimensions indicating segment lengths and cut angles.",
            "appliedTo": "Generated Detail Geometry"
          },
          {
            "type": "Text",
            "description": "Label displaying the Position Number (PosNum) of the beam.",
            "appliedTo": "Generated Detail Geometry"
          }
        ]
      },
      "tokens_used": 10013,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched via command or palette.",
          "Properties dialog (OPM) opens for configuration (Space, Filter, Dimensions, Layout).",
          "User confirms properties (Enter/OK).",
          "Command Line Prompt: Pick a point where details will be generated (Origin of grid).",
          "Conditional Step: Select Viewport (Paper Space) OR Select ShopDrawView (Shopdraw Space).",
          "Script extracts Element from selected View entity.",
          "Script retrieves all GenBeams from the Element.",
          "Script applies Filter Definition (from HSB_G-FilterGenBeams) to GenBeams.",
          "Script groups remaining beams by Position Number (unique only).",
          "Loop starts for each unique Position Number.",
          "Loop starts for 3 orientations (Side, Top, Bottom relative to beam).",
          "Script creates a shadow profile of the beam body in current orientation.",
          "Script analyzes profile vertices to determine if geometry is non-rectangular.",
          "Conditional Step: If non-rectangular, generate detail; otherwise, skip.",
          "Transformation calculated based on Grid position (Row/Column) and Detail Scale.",
          "Dimensions generated (Horizontal, Vertical, and Angled) based on vertex extents.",
          "Detail Polyline (Color nColorDetail) and PosNum Label drawn at calculated location.",
          "Grid counter increments; Row increments if nColumn limit reached.",
          "Loop finishes.",
          "Script execution completes."
        ],
        "conditionalBranches": [
          {
            "condition": "User selection of 'Drawing space' (sSpace) property",
            "path1": {
              "name": "Paper Space",
              "steps": [
                "Prompt: Select the viewport from which the element is taken",
                "Get Viewport entity",
                "Extract Element from Viewport",
                "Calculate Model-to-Paper Space coordinate systems (ms2ps)"
              ]
            },
            "path2": {
              "name": "Shopdraw Multipage",
              "steps": [
                "Prompt: Select the view entity from which the module is taken",
                "Get ShopDrawView entity",
                "Lookup ViewData in _Map",
                "Extract Element from ViewData showSet",
                "Calculate Model-to-View Space coordinate systems"
              ]
            }
          },
          {
            "condition": "Beam Geometry Check (Shadow Profile Analysis)",
            "path1": {
              "name": "Rectangular (No Detail)",
              "steps": [
                "Profile has 4 vertices",
                "Opposite sides are parallel",
                "Angles are approx 90 deg",
                "Set 'Requires Detail' flag to FALSE",
                "Skip drawing loops for this orientation"
              ]
            },
            "path2": {
              "name": "Complex/Non-Rectangular (Detail Required)",
              "steps": [
                "Profile vertices != 4 OR sides non-parallel",
                "Set 'Requires Detail' flag to TRUE",
                "Construct PLine from profile vertices",
                "Calculate extents for dimension placement",
                "Draw Dimensions and PLine"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport selection contains valid hsb data",
            "errorMessage": "Implicit failure (Script returns/ends silently if Element is invalid).",
            "recovery": "Select a different Viewport that contains an Element."
          },
          {
            "check": "Filter TSL Availability (HSB_G-FilterGenBeams)",
            "errorMessage": "Beams could not be filtered! Make sure that the tsl HSB_G-FilterGenBeams is loaded in the drawing.",
            "recovery": "Load the specific TSL catalog or select empty filter."
          },
          {
            "check": "ShopDrawView ViewData Map",
            "errorMessage": "Implicit failure (Returns if nIndFound < 0).",
            "recovery": "Ensure ShopDrawView is valid and linked to valid ViewData."
          },
          {
            "check": "GenBeam Filter Results",
            "errorMessage": "If no beams pass filter, gbFiltered array is empty.",
            "recovery": "Adjust Filter Definition or ensure Element has GenBeams."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Configuration (Layout/Scale/Filter)",
            "how": "OPM (Object Properties Palette)",
            "effect": "Script recalculates; details redrawn at new scale/offsets or new beam selection."
          },
          {
            "action": "Move Origin",
            "how": "Grip Edit (Point grip)",
            "effect": "Translates the entire detail grid to the new point location."
          },
          {
            "action": "Delete Script",
            "how": "AutoCAD Erase command",
            "effect": "All generated geometry (details, dimensions, text) is removed."
          }
        ]
      },
      "tokens_used": 9657,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ShowSideDetails.mcr\n\n## Overview\nThis script automatically generates a grid of 2D detail drawings for beams with complex cuts or non-rectangular profiles. It is designed to create detailed cross-section views in Paper Space or Shopdraw Multipage layouts, complete with dimensions and position numbers.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | Details are generated in Paper Space or Shopdraw layouts. |\n| Paper Space | Yes | Requires selecting a Viewport linked to an Element. |\n| Shop Drawing | Yes | Requires selecting a Shopdraw View entity. |\n\n## Prerequisites\n- **Required Entities**: A Viewport (Paper Space) or ShopdrawView (Shopdraw Space) that is linked to a valid hsb Element containing GenBeams.\n- **Minimum Beam Count**: 0 (If no beams match the filter, nothing is drawn).\n- **Required Settings**: Access to the `HSB_G-FilterGenBeams` catalog entry to utilize beam filtering.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Select `hsb_ShowSideDetails.mcr` from the list.\n\n### Step 2: Configure Properties (Optional)\nThe Properties palette will appear upon insertion.\n- Set **Drawing space** (`sSpace`) to either \"Paper Space\" or \"Shopdraw multipage\".\n- Select a **Filter definition** if you only want to detail specific types of beams.\n- Adjust **Layout** parameters (Columns, Offsets) as needed.\n- Press **Enter** or click **Close** to confirm.\n\n### Step 3: Pick Insertion Point\n```\nCommand Line: Pick a point where details will be generated\nAction: Click anywhere in the drawing to set the origin (top-left corner) of the detail grid.\n```\n\n### Step 4: Select Source View\nDepending on your selection in Step 2, one of the following prompts will appear:\n\n**If Paper Space is selected:**\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click on the border of the viewport containing the element you wish to detail.\n```\n\n**If Shopdraw Multipage is selected:**\n```\nCommand Line: Select the view entity from which the module is taken\nAction: Click on the Shopdraw view entity.\n```\n\nThe script will now generate the details. It filters beams, analyzes their geometry, and draws only the non-rectangular profiles arranged in a grid.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Drawing space | dropdown | Paper Space | Sets the environment to retrieve the element from (Paper Space or Shopdraw). |\n| Filter definition for genbeams to display | dropdown | | Select a filter from `HSB_G-FilterGenBeams` to choose which beams to detail. |\n| Display mode chain | dropdown | Parallel | Sets the orientation of dimension lines (Parallel, Perpendicular, or None). |\n| Dimstyle | dropdown | Current Dimstyle | Selects the CAD dimension style (arrows, text size, etc.). |\n| Text offset | number | 5 mm | Distance between the detail geometry and the Position Number label. |\n| Offset for dimension lines | number | 5 mm | Gap between the geometry and standard dimension lines. |\n| Offset for angled dimension lines | number | 5 mm | Gap between the geometry and dimension lines for angled cuts. |\n| Detail scale | number | 0.25 | Scale factor for the details (e.g., 0.25 = 1/4 size). |\n| Offset horizontal | number | 30 mm | Horizontal spacing between columns in the grid. |\n| Offset vertical | number | 30 mm | Vertical spacing between rows in the grid. |\n| Number of Columns | number | 5 | Number of details per row before wrapping to the next line. |\n| Color detail | number | 32 | CAD color index for the detail outline polylines. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the details based on changes to the source beams or properties. |\n| Move Origin | Displays a grip point at the insertion point. Click and drag to move the entire grid to a new location. |\n| Properties | Opens the Properties palette to adjust filters, layout, and dimension settings. |\n\n## Settings Files\n- **Catalog**: `HSB_G-FilterGenBeams`\n- **Purpose**: Stores predefined filter rules to limit which beams are detailed (e.g., \"Only beams with tenons\" or \"Wall beams only\").\n\n## Tips\n- **Filtering is Key**: Use the **Filter definition** to avoid cluttering your drawing with details for simple, rectangular beams.\n- **Adjusting Layout**: If details overlap, increase the **Offset horizontal** or **Offset vertical** values in the properties.\n- **Scaling**: If details are too small or large to read, change the **Detail scale**. A lower value (e.g., 0.1) fits more details on a page.\n- **Moving the Grid**: You can quickly reposition the entire drawing by using the \"Move Origin\" grip option from the right-click menu instead of erasing and re-inserting.\n\n## FAQ\n- **Q: I ran the script, but nothing was drawn. Why?**\n- **A:** This usually means the beams in the selected element are perfectly rectangular (standard cuts only) or none of them passed the filter. Try selecting an empty filter to show all beams, or verify the selected Viewport contains complex geometry.\n\n- **Q: Can I change the number of columns after inserting?**\n- **A:** Yes. Select the script, open Properties, and change \"Number of Columns\". The grid will automatically rearrange when you recalculate.\n\n- **Q: What does \"Display mode chain\" do?**\n- **A:** It controls how dimensions align on angled cuts. \"Parallel\" places the dimension text along the cut angle, while \"Perpendicular\" forces it to align horizontally or vertically relative to the page."
      },
      "tokens_used": 7159,
      "error": null
    }
  }
}