{
  "filename": "hsb_CreateBlockingOnWallConnection.mcr",
  "status": "completed",
  "total_tokens": 34023,
  "processing_time": 165.77706146240234,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 7219,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No prefixes sd_ or Multipage*, no #Type E declarations, no _Viewport usage. Script interacts directly with ElementWall, Beam, and Sheet entities in the 3D model using methods like dbCreate and assignToElementGroup."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall",
            "Beam",
            "Sheet"
          ],
          "minimumBeams": 1,
          "requiredSpace": "The script must be run in the Model Space on ElementWall entities.",
          "requiredSettings": [
            "ElementWall with valid connected walls (codes matching sConnectingWalls property)",
            "Valid construction zones (if using batten zone logic)"
          ]
        }
      },
      "tokens_used": 3594,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sConnectingWalls",
            "type": "PropString",
            "displayName": "List of connecting wall codes",
            "defaultValue": "NB;LB;PA",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Code of the wall that will have a connection with the primary where the ladder will be created."
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5392,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates timber blocking beams or horizontal sheet battens at T-junctions between walls to provide structural backing and fixings.",
          "category": "Framing",
          "typicalUseCase": "Reinforcing intersections where a secondary wall meets a primary wall, typically at standard heights (600mm, 1200mm, 1800mm) to support drywall linings or prevent racking."
        },
        "parameters": [
          {
            "name": "sConnectingWalls",
            "technicalDefault": "NB;LB;PA",
            "businessMeaning": "A filter list specifying the wall types (defined by their 'Code' property in the catalog) that require blocking reinforcement when intersecting the selected primary wall.",
            "validRange": "Semicolon-separated string list of project-specific wall codes (e.g., \"NB;PA;Interior\")",
            "unit": "Text",
            "affectsOutput": "Determines which wall intersections trigger the generation of blocking. If a connected wall's code is not in this list, no blocking is created at that junction."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change in the 'Code' property of a wall connected to the target wall.",
            "effect": "The script will either generate or skip blocking at that specific connection depending on whether the new code matches the sConnectingWalls list.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Beam",
            "description": "Solid timber blocking members (Type: SFBlocking) generated at fixed heights of 600mm, 1200mm, and 1800mm from the bottom. They are sized to match the primary wall's timber width and height and stretch between the nearest perpendicular studs.",
            "appliedTo": "The selected primary ElementWall."
          },
          {
            "type": "Sheet",
            "description": "Horizontal battens (sheet material) generated at the same fixed heights (600mm, 1200mm, 1800mm) if the primary wall contains a construction zone with 'Vertical' distribution.",
            "appliedTo": "The specific construction zone (Zone index < 0) of the selected primary ElementWall."
          }
        ]
      },
      "tokens_used": 6032,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script execution initiated",
          "2. Check insertion cycle count (prevent multi-run loops)",
          "3. User selects ElementWall entities via PrEntity command prompt",
          "4. Parse 'sConnectingWalls' property into a list of valid codes",
          "5. Loop through selected elements",
          "6. Filter for valid ElementWall types",
          "7. Analyze Wall Geometry: Identify vertical studs and construction zones",
          "8. [Validation] Check if wall contains vertical beams",
          "9. Loop through connected elements (neighbors)",
          "10. [Validation] Check if connected wall code exists in valid list",
          "11. Calculate intersection point of walls",
          "12. [Branch] Determine construction output type (Battens vs Beams)",
          "13. [Branch] Filter out Corner connections (Distance check)",
          "14. [Branch] Check for Stud overlap (Shift position if necessary)",
          "15. Generate entities at standard heights (600, 1200, 1800mm)",
          "16. Stretch/Trim generated entities to fit geometry",
          "17. Erase script instance and finish"
        ],
        "conditionalBranches": [
          {
            "condition": "Check for Vertical Distribution Zone (Batten Logic)",
            "path1": {
              "name": "Generate Horizontal Battens",
              "steps": [
                "Identify specific construction zone (index < 0)",
                "Create PlaneProfile of existing sheets in zone",
                "Loop standard heights",
                "Check if height point overlaps existing sheet (Skip if yes)",
                "Create Sheet profile and subtract existing sheet geometry",
                "Create Sheet entity"
              ]
            },
            "path2": {
              "name": "Generate Timber Blocking",
              "steps": [
                "Determine timber width/height from primary wall",
                "Check if intersection point is within wall envelope",
                "Create Beam entity (Type: SFBlocking)",
                "Stretch beam to nearest perpendicular studs on left and right"
              ]
            }
          },
          {
            "condition": "Proximity to Wall Edge (Corner Detection)",
            "path1": {
              "name": "Corner Connection (Too close to edge)",
              "steps": [
                "Calculate distance from intersection to Left/Right wall extents",
                "Compare against connected wall width",
                "Skip generation (Exclude corners)"
              ]
            },
            "path2": {
              "name": "T-Junction Connection",
              "steps": [
                "Verify intersection is sufficiently far from edges",
                "Proceed to generation"
              ]
            }
          },
          {
            "condition": "Stud Collision (Blocking only)",
            "path1": {
              "name": "Intersects Existing Stud",
              "steps": [
                "Check if intersection point lies inside stud profile",
                "Find closest point on stud profile edge",
                "Re-calculate blocking position based on new edge point"
              ]
            },
            "path2": {
              "name": "Clear Opening",
              "steps": [
                "Use original calculated intersection point"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Presence of vertical beams (studs) in the selected wall",
            "errorMessage": "(Implicit) Script terminates silently if no perpendicular beams are found.",
            "recovery": "Ensure the selected wall has a generated or drawn framing layout with vertical studs."
          },
          {
            "check": "Connected Wall Code",
            "errorMessage": "(Implicit) Connection is skipped if the connected wall's 'Code' property does not match the semicolon-separated list in sConnectingWalls.",
            "recovery": "Update the 'List of connecting wall codes' property in the script properties or change the 'Code' property of the connected wall in the catalog."
          },
          {
            "check": "Element Selection",
            "errorMessage": "(Implicit) Script erases itself if no elements are selected.",
            "recovery": "Select valid ElementWall entities when prompted."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Generated Elements",
            "how": "Direct CAD Edit (Grips/Properties)",
            "effect": "Since the script instance erases itself upon completion, the blocking/sheets become standard database entities. Users can manually move, resize, or delete them."
          },
          {
            "action": "Regenerate Connection",
            "how": "Re-run Script",
            "effect": "Running the script again on the same wall will regenerate the blocking based on current geometry and properties, potentially overwriting manual edits (unless handled by entity tracking, which this specific script does not appear to do)."
          }
        ]
      },
      "tokens_used": 7392,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_CreateBlockingOnWallConnection\n\n## Overview\nThis script automatically generates timber blocking beams or horizontal sheet battens at T-junctions between walls. It creates these reinforcements at standard heights (600mm, 1200mm, and 1800mm) to provide structural backing for fixings, based on the wall types involved.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in the 3D Model Space on ElementWall entities. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | Not intended for generating 2D drawings directly. |\n\n## Prerequisites\n- **Required Entities**: At least one `ElementWall` in the model.\n- **Framing**: The selected wall must contain vertical studs (generated beams).\n- **Wall Codes**: Connected walls must have a specific \"Code\" property assigned (e.g., NB, LB) to match the script's filter list.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT`\n**Action**: Browse to the script location and select `hsb_CreateBlockingOnWallConnection.mcr`.\n\n### Step 2: Select Primary Walls\n```\nCommand Line: Select a set of elements\n```\n**Action**: Click on the primary wall(s) that intersect with other walls where you need blocking. Press **Enter** to confirm selection.\n*Note: The script will analyze connections to walls meeting this primary wall.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| List of connecting wall codes | Text | NB;LB;PA | Defines which wall types require blocking. Enter the \"Code\" property of intersecting walls separated by semicolons (e.g., \"NB;PA\"). If the connected wall's code is not in this list, no blocking is created. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script runs immediately upon insertion and does not add persistent right-click menu options. |\n\n## Settings Files\n- **None**: This script does not use external settings files.\n\n## Tips\n- **Corner Detection**: The script automatically skips intersections that are too close to the ends of the wall (corners), focusing only on T-junctions.\n- **Stud Collision**: If the intersection point falls exactly on an existing vertical stud, the script will shift the blocking to align with the edge of the stud automatically.\n- **Material Logic**: The script checks the primary wall's construction. If it contains a vertical sheet distribution zone, it creates horizontal battens; otherwise, it creates solid timber blocking beams (Type: SFBlocking).\n- **Re-running**: The script instance erases itself after generating the geometry. To update the blocking after wall changes, simply run the script again on the updated wall.\n\n## FAQ\n- **Q: Why did the script not create blocking at a specific intersection?**\n  **A**: Check the \"Code\" property of the connected wall. It must exactly match one of the entries in the \"List of connecting wall codes\" parameter. Also, ensure the intersection is not a corner (end of wall).\n\n- **Q: Can I change the heights where the blocking is placed?**\n  **A**: The heights are fixed at 600mm, 1200mm, and 1800mm. To change these, you would need to manually move the generated elements in the model or edit the script source code.\n\n- **Q: What happens if I move the wall after running the script?**\n  **A**: The generated blocking/sheets are static entities and will not update automatically. You must delete the old blocking and run the script again on the new wall position."
      },
      "tokens_used": 4394,
      "error": null
    }
  }
}