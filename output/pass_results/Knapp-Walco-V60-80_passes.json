{
  "filename": "Knapp-Walco-V60-80.mcr",
  "status": "completed",
  "total_tokens": 50826,
  "processing_time": 263.88925862312317,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 1,
          "dxaOut": 1,
          "implInsert": 1
        },
        "description": "This tsl defines a WALCO V Wall Connector with a KS screw. The user has to validate the engineering conditions.",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "17.08.2011",
            "author": "th@hsbCAD.de",
            "changes": "supports type 60 and 80"
          },
          {
            "version": "1.0",
            "date": "17.08.2011",
            "author": "th@hsbCAD.de",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8641,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses _kModelSpace in dbCreate(). Modifies GenBeam geometry with BeamCut and Drill. No references to _kPaperSpace, _Viewport, or ShopDrawing specific functions."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 7162,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getBeam",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getBeam",
              "promptOriginal": "Select second beam",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert && nQty <= 1",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Insertion Dialog",
            "trigger": "_bOnInsert && _kExecuteKey == \"\"",
            "title": null,
            "dataSource": "Script Properties (nQty, dOffsetBottom, dOffsetTop, sKSType, dGapWidth, dYOffset)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sKSType",
            "type": "PropString",
            "displayName": "Type",
            "defaultValue": "Walco V60",
            "inputType": "dropdown",
            "options": [
              "Walco V60",
              "Walco V80"
            ],
            "category": null,
            "description": "Select Type 60 or 80"
          },
          {
            "index": 0,
            "variable": "nQty",
            "type": "PropInt",
            "displayName": "Quantity",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Defines quantity of connectors to be distributed. A value <=1 prompts the user for the insertion point."
          },
          {
            "index": 2,
            "variable": "dOffsetBottom",
            "type": "PropDouble",
            "displayName": "Offset Bottom",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Defines offset from the lower edge"
          },
          {
            "index": 3,
            "variable": "dOffsetTop",
            "type": "PropDouble",
            "displayName": "Offset Top",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Defines offset from the upper edge"
          },
          {
            "index": 0,
            "variable": "dGapWidth",
            "type": "PropDouble",
            "displayName": "Width Gap",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Defines the gap in relation to the width of the connector"
          },
          {
            "index": 1,
            "variable": "dYOffset",
            "type": "PropDouble",
            "displayName": "Offset dY",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Defines an offset in Y-Direction of the connection"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Flip Side",
            "handler": "Flip Side",
            "action": "Swaps the connection side between the two beams",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7904,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts and calculates the machining for a Walco V60 or V80 shear wall connector between two parallel timber studs, including slotting, drilling, and BOM generation.",
          "category": "Hardware",
          "typicalUseCase": "Connecting prefabricated timber wall panels where shear loads require steel plate connectors (Walco V-type)."
        },
        "parameters": [
          {
            "name": "sKSType",
            "technicalDefault": "Walco V60",
            "businessMeaning": "Selects the connector model, which defines the plate dimensions (60x60 or 80x80mm), screw diameter, and load-bearing capacity.",
            "validRange": "Walco V60, Walco V80",
            "unit": "enum",
            "affectsOutput": "Determines connector geometry (dX, dY), screw dimensions (diameters, lengths), and the BOM article numbers generated for production."
          },
          {
            "name": "nQty",
            "technicalDefault": 1,
            "businessMeaning": "The number of connectors to distribute along the wall height.",
            "validRange": "1 to N (integer)",
            "unit": "count",
            "affectsOutput": "If <= 1, the user picks the exact spot. If > 1, the script distributes multiple instances equally spaced between the top and bottom offsets."
          },
          {
            "name": "dOffsetBottom",
            "technicalDefault": 0.0,
            "businessMeaning": "Distance from the bottom of the intersecting beams to the start of the connector distribution (or single connector location).",
            "validRange": "0 to Beam Height",
            "unit": "mm",
            "affectsOutput": "Pushes the first connector up from the bottom edge of the intersection."
          },
          {
            "name": "dOffsetTop",
            "technicalDefault": 0.0,
            "businessMeaning": "Distance from the top of the intersecting beams to the end of the connector distribution (or single connector location).",
            "validRange": "0 to Beam Height",
            "unit": "mm",
            "affectsOutput": "Pushes the last connector down from the top edge of the intersection."
          },
          {
            "name": "dGapWidth",
            "technicalDefault": 0.0,
            "businessMeaning": "Tolerance adjustment for the slot width in the beam. Increases or decreases the width of the cut made for the plate.",
            "validRange": "-2.0 to 5.0",
            "unit": "mm",
            "affectsOutput": "Widens or narrows the BeamCut (slot) in the beam holding the plate. A positive value makes the slot looser."
          },
          {
            "name": "dYOffset",
            "technicalDefault": 0.0,
            "businessMeaning": "Lateral shift of the connector along the width of the beam (face offset).",
            "validRange": "Â± Beam Width/2",
            "unit": "mm",
            "affectsOutput": "Moves the connector, slot, and drill hole laterally along the beam's Y-axis (width)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "nQty > 1",
            "effect": "Activates distribution logic. dOffsetBottom and dOffsetTop define the distribution range.",
            "cascade": [
              "dOffsetBottom",
              "dOffsetTop"
            ]
          },
          {
            "trigger": "Context Menu 'Flip Side'",
            "effect": "Swaps the roles of the two beams. The slot moves from Beam 0 to Beam 1, and the drill moves from Beam 1 to Beam 0.",
            "cascade": [
              "bFlip (internal)"
            ]
          },
          {
            "trigger": "Change dGapWidth or dYOffset",
            "effect": "Propagates the change to all other instances of this connector connecting the same two beams (Remote update).",
            "cascade": [
              "dGapWidth/dYOffset (on linked instances)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "BeamCut",
            "description": "A rectangular through-cut in the side of the beam to recess the steel connector.",
            "appliedTo": "Primary Beam (Beam 0, unless flipped)."
          },
          {
            "type": "Drill",
            "description": "A vertical through-hole and drilling into the mating beam for the KS screw.",
            "appliedTo": "Secondary Beam (Beam 1, unless flipped)."
          },
          {
            "type": "Visual Body",
            "description": "3D representation of the Walco V plate and the main KS screw.",
            "appliedTo": "Visuals assigned to Element Group 'E' of both beams."
          },
          {
            "type": "BOM Entry",
            "description": "Hardware components: 1x Walco Plate (K102 or K103) and 3x Hexagon Screws (Z550 or Z551).",
            "appliedTo": "Production Lists."
          }
        ]
      },
      "tokens_used": 9004,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Launch Script (TSL Insert)\",\n    \"2. Display Insertion Dialog (Catalog/Properties)\",\n    \"3. User inputs configuration (Type, Qty, Offsets)\",\n    \"4. Select first beam (getBeam)\",\n    \"5. Select second beam (getBeam)\",\n    \"6. Validate Beam Orientation (Must be parallel to Z-axis and each other)\",\n    \"7. [Conditional Branch: Distribution vs Single]\",\n    \"8. If Distribution (Qty > 1): Save offsets to Map and finish insert cycle.\",\n    \"9. If Single (Qty <= 1): Prompt user for Insertion Point (getPoint).\",\n    \"10. Create new script instance at insertion point via dbCreate.\",\n    \"11. Erase temporary insertion script.\",\n    \"12. Script Execution (Instance runs logic)\",\n    \"13. [Conditional Branch: Instance Role]\",\n    \"14. If Distributor (Map has Qty): Calculate positions, loop create 'nQty' single instances, erase self.\",\n    \"15. If Single Instance: Check 'Flip Side' state in Map.\",\n    \"16. Validate Intersection Area and Beam Width.\",\n    \"17. Validate Gap between beams.\",\n    \"18. Generate Machining (BeamCut on primary, Drill on secondary).\",\n    \"19. Generate Visuals and BOM.\",\n    \"20. [Conditional Branch: Remote Update]\",\n    \"21. If properties changed: Update properties of other connectors linking the same beams.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Quantity (nQty) > 1\",\n      \"path1\": {\n        \"name\": \"Distribution Mode\",\n        \"steps\": [\n          \"Store Qty, OffsetBottom, and OffsetTop in internal Map.\",\n          \"Script acts as a 'Distributor' instance.\",\n          \"Distributor calculates spacing based on intersection height.\",\n          \"Distributor spawns multiple single instances via dbCreate.\",\n          \"Distributor erases itself.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Single Insert Mode\",\n        \"steps\": [\n          \"Prompt user for exact insertion point on the beam.\",\n          \"Create one single instance immediately.\",\n          \"Insert script erases itself.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Context Menu 'Flip Side' executed\",\n      \"path1\": {\n        \"name\": \"Standard Orientation\",\n        \"steps\": [\n          \"Primary Beam (Index 0) receives the slot (BeamCut).\",\n          \"Secondary Beam (Index 1) receives the drill hole.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Flipped Orientation\",\n        \"steps\": [\n          \"Swap beams in array (bm.swap).\",\n          \"Primary Beam (Index 1) receives the slot.\",\n          \"Secondary Beam (Index 0) receives the drill hole.\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Minimum Beam Count\",\n      \"errorMessage\": \"Tool requires at least two beams\",\n      \"recovery\": \"Select two valid beams to run the script.\"\n    },\n    {\n      \"check\": \"Beam Orientation\",\n      \"errorMessage\": \"Beams must be parallel to each other and to world-Z\",\n      \"recovery\": \"Ensure both selected studs are vertical and parallel.\"\n    },\n    {\n      \"check\": \"Geometric Intersection\",\n      \"errorMessage\": \"Beams do not have a common intersection area\",\n      \"recovery\": \"Move beams so they overlap or touch in the projection plane.\"\n    },\n    {\n      \"check\": \"Intersection Width vs Connector Width\",\n      \"errorMessage\": \"None (Silent fail - Instance erased)\",\n      \"recovery\": \"Ensure beams are wide enough to accommodate the connector (60mm or 80mm).\"\n    },\n    {\n      \"check\": \"Gap Width\",\n      \"errorMessage\": \"Connection not possible\",\n      \"recovery\": \"Adjust gap between beams to be between 0mm and 15mm (Connector thickness).\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Flip Side\",\n      \"how\": \"Right-click Context Menu\",\n      \"effect\": \"Toggles the machining between the two beams (swaps slot and drill). Also updates the flip state of any other identical connectors attached to the same beam pair.\"\n    },\n    {\n      \"action\": \"Modify Connector Type\",\n      \"how\": \"OPM (Object Properties) > Type dropdown\",\n      \"effect\": \"Changes dimensions (60x60 vs 80x80), screw sizes, drill diameters, and BOM articles.\"\n    },\n    {\n      \"action\": \"Adjust Fit/Offset\",\n      \"how\": \"OPM > Width Gap / Offset dY\",\n      \"effect\": \"Adjusts the slot width tolerance or lateral position. Updates all other connectors linked to the same beams automatically.\"\n    },\n"
      },
      "tokens_used": 11849,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Knapp-Walco-V60-80.mcr\n\n## Overview\nInserts a Walco V60 or V80 shear wall connector with a KS screw between two parallel timber studs. The script automatically generates the required slotting, drilling, and Bill of Materials (BOM) entries for production.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script runs in 3D model environment. |\n| Paper Space | No | Not designed for 2D layouts. |\n| Shop Drawing | No | Machining is applied directly to the beams. |\n\n## Prerequisites\n- **Required Entities**: Two `GenBeam` entities (typically vertical studs or posts).\n- **Minimum Beam Count**: 2\n- **Beam Orientation**: Beams must be parallel to each other and vertical (parallel to the Z-axis).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Navigate to the folder containing `Knapp-Walco-V60-80.mcr` and select it.\n\n### Step 2: Configure Connector\nUpon selection, the Properties dialog appears. Configure the following before selecting beams:\n- **Type**: Choose \"Walco V60\" or \"Walco V80\".\n- **Quantity**: Enter the number of connectors.\n  - **Note**: If you enter `1`, you will be asked to pick an insertion point later. If you enter `>1`, the script will distribute them automatically.\n- **Offset Bottom/Top**: Define the allowed range for the connectors.\n\n### Step 3: Select Beams\n1. **Command Line**: `Select first beam`\n   - **Action**: Click on the first timber stud.\n2. **Command Line**: `Select second beam`\n   - **Action**: Click on the second parallel timber stud.\n\n### Step 4: Define Position\n- **If Quantity = 1**: \n  - **Command Line**: `Select insertion point`\n  - **Action**: Click on the intersection area where you want the connector placed.\n- **If Quantity > 1**:\n  - The script automatically calculates the spacing based on the top and bottom offsets and inserts the connectors immediately.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | Dropdown | Walco V60 | Selects the connector model (V60 is 60x60mm, V80 is 80x80mm). This updates dimensions, screw sizes, and BOM data. |\n| Quantity | Integer | 1 | Number of connectors to insert. Value > 1 triggers automatic distribution along the beam height. |\n| Offset Bottom | Number | 0.0 | Distance from the bottom edge of the beam intersection to the first connector. |\n| Offset Top | Number | 0.0 | Distance from the top edge of the beam intersection to the last connector. |\n| Width Gap | Number | 0.0 | Tolerance adjustment for the slot width. Positive values make the slot wider (looser fit). |\n| Offset dY | Number | 0.0 | Lateral offset of the connector along the width of the beam (Y-axis). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip Side | Swaps the machining between the two beams. The slot (BeamCut) moves to the other beam, and the drill hole moves to the first. This updates all connectors attached to the same beam pair. |\n\n## Settings Files\n- No specific settings files are required for this script.\n\n## Tips\n- **Distribution Logic**: To place multiple connectors evenly, set the **Quantity** to the desired number (e.g., 4). Use **Offset Bottom** and **Offset Top** to define the start and end boundaries of the distribution area.\n- **Remote Updates**: If you modify **Width Gap** or **Offset dY**, the script automatically updates all other connectors linking the same two beams to match the new setting.\n- **Beam Validation**: Ensure the beams are strictly vertical. If the script disappears immediately after insertion, check that the beams are parallel and have a valid geometric intersection area.\n\n## FAQ\n- **Q: Why did the connector disappear after I selected the beams?**\n  - **A**: The beams might not be parallel to the World Z-axis, or they might not overlap vertically. Ensure both studs are vertical and share a common height area.\n  \n- **Q: Can I move a single connector after insertion?**\n  - **A**: Yes. Use the standard AutoCAD `Move` command on the script instance (TSL entity), or modify the insertion point coordinates in the properties if available. For distributed connectors, modify the offsets.\n\n- **Q: What is the difference between V60 and V80?**\n  - **A**: The V60 uses a 60x60mm plate (Article K102) with specific screws, while the V80 uses an 80x80mm plate (Article K103) with larger screws for higher load capacity."
      },
      "tokens_used": 6266,
      "error": null
    }
  }
}