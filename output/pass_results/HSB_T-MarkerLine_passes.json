{
  "filename": "HSB_T-MarkerLine.mcr",
  "status": "completed",
  "total_tokens": 30733,
  "processing_time": 214.74421977996826,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": 1,
          "minorVersion": 2,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.00",
            "date": "01.12.2006",
            "author": "TH",
            "changes": "First revision"
          },
          {
            "version": "1.01",
            "date": "21.01.2014",
            "author": "AS",
            "changes": "Update for Dutch Content"
          },
          {
            "version": "1.02",
            "date": "21.01.2014",
            "author": "AS",
            "changes": "Add option set posnum of male beam (<OTHERPOS>)"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5010,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses standard beam selection via getBeam() and interacts with Beam objects directly. No PaperSpace/ShopDrawing specific keywords ('sd_', '#Type E', '_Viewport') were found. The script adds a Marking tool to the beam, which is a Model Space operation."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space (3D Model)",
          "requiredSettings": []
        }
      },
      "tokens_used": 1984,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getBeam\",\n        \"promptOriginal\": \"|Select male beam|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getBeam\",\n        \"promptOriginal\": \"|Select female beam|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sSeperator01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Marking properties|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sSide\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Side|\",\n      \"defaultValue\": \"|Contact face|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Contact face|\",\n        \"|Opposite contact face|\",\n        \"|Side| 1\",\n        \"|Side| 2\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sTxt\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Text|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sTextPosition\",\n      \"type\": \"PropString\",\n      \"displayName"
      },
      "tokens_used": 6376,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a marking line (and optional text) on the female beam of a T-connection to indicate the intersection location or identity of the male beam.",
          "category": "Machining/Marking",
          "typicalUseCase": "Used in fabrication preparation to mark where a perpendicular beam connects to a main beam, or to label the intersecting beam's ID on the surface."
        },
        "parameters": [
          {
            "name": "sSeperator01",
            "technicalDefault": "\"\"",
            "businessMeaning": "Visual separator label in the properties palette.",
            "validRange": "N/A (Static Label)",
            "unit": "N/A",
            "affectsOutput": "None (UI organization only)."
          },
          {
            "name": "sSide",
            "technicalDefault": "\"|Contact face|\"",
            "businessMeaning": "Determines which face of the female beam the marking is applied to, relative to the intersection.",
            "validRange": "Dropdown: |Contact face|, |Opposite contact face|, |Side| 1, |Side| 2",
            "unit": "N/A",
            "affectsOutput": "Moves the marking line and text to the specified face of the beam (Top, Bottom, Left, or Right relative to the T-junction)."
          },
          {
            "name": "sTxt",
            "technicalDefault": "\"\"",
            "businessMeaning": "The text content to be marked on the beam. Supports a dynamic tag to pull the male beam's position number.",
            "validRange": "Any alphanumeric string, or the specific keyword '<OTHERPOS>'",
            "unit": "N/A",
            "affectsOutput": "Updates the text annotation associated with the marker line. If '<OTHERPOS>' is used, it displays the Position Number of the selected male beam."
          },
          {
            "name": "sTextPosition",
            "technicalDefault": "\"|Center|\"",
            "businessMeaning": "Vertical placement of the text relative to the marker line.",
            "validRange": "Dropdown: |Bottom|, |Center|, |Top|",
            "unit": "N/A",
            "affectsOutput": "Offsets the text vertically so it sits below, centered on, or above the marking line."
          },
          {
            "name": "sTextAlignment",
            "technicalDefault": "\"|Center|\"",
            "businessMeaning": "Horizontal justification of the text relative to the marker line endpoints.",
            "validRange": "Dropdown: |Left|, |Center|, |Right|",
            "unit": "N/A",
            "affectsOutput": "Aligns the text to the start, middle, or end of the marking line."
          },
          {
            "name": "nDirection",
            "technicalDefault": "0",
            "businessMeaning": "Controls the text rotation/orientation for Hundegger CNC machines to ensure legibility during processing.",
            "validRange": "Integer (0 typically standard)",
            "unit": "Index",
            "affectsOutput": "Alters the rotation attribute of the marking entity for machine output."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User inputs '<OTHERPOS>' into sTxt",
            "effect": "The script queries the Male Beam's Position Number property to override the text value.",
            "cascade": [
              "sTxt"
            ]
          },
          {
            "trigger": "User changes sSide",
            "effect": "The script calculates the new normal vector and offset distance on the female beam's cross-section.",
            "cascade": [
              "Marking location (X/Y coordinates)",
              "Normal vector"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Mark",
            "description": "A marking consisting of two witness lines (representing the width of the male beam) and an associated text label.",
            "appliedTo": "Female Beam (The second beam selected)"
          }
        ]
      },
      "tokens_used": 5116,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution initiated (Insert).",
          "Properties Dialog displayed for initial configuration.",
          "Command line prompt: Select Male Beam.",
          "Command line prompt: Select Female Beam.",
          "Script validates that two beams exist in the internal list.",
          "Dependencies established on both selected beams.",
          "Calculate coordinate system intersection points.",
          "Determine face side and normal vector based on properties.",
          "Resolve marking text (Static literal or Dynamic Male Beam Position Number).",
          "Create Mark entity and apply to Female Beam.",
          "Generate preview graphics in model space."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Phase (_bOnInsert)",
            "path1": {
              "name": "Insertion Phase",
              "steps": [
                "Show Properties Dialog",
                "Prompt for Male Beam selection",
                "Prompt for Female Beam selection",
                "Exit script to wait for recalculation"
              ]
            },
            "path2": {
              "name": "Calculation Phase",
              "steps": [
                "Skip input prompts",
                "Retrieve beam objects from internal list",
                "Execute geometric logic"
              ]
            }
          },
          {
            "condition": "Beam Selection Validation",
            "path1": {
              "name": "Success (>= 2 Beams)",
              "steps": [
                "Set dependencies on entities",
                "Proceed to geometry calculation"
              ]
            },
            "path2": {
              "name": "Failure (< 2 Beams)",
              "steps": [
                "Execute eraseInstance()",
                "Remove script from model"
              ]
            }
          },
          {
            "condition": "Side Selection (sSide)",
            "path1": {
              "name": "Contact Face (Default)",
              "steps": [
                "Set Normal Vector to -X0 (Female Beam System)",
                "Set Offset to female beam width/depth logic"
              ]
            },
            "path2": {
              "name": "Opposite Contact Face",
              "steps": [
                "Set Normal Vector to X0",
                "Offset calculation using bm1.dD(_X0)"
              ]
            },
            "path3": {
              "name": "Side 1",
              "steps": [
                "Set Normal Vector to Y1"
              ]
            },
            "path4": {
              "name": "Side 2",
              "steps": [
                "Set Normal Vector to -Y1"
              ]
            }
          },
          {
            "condition": "Text Content (sTxt)",
            "path1": {
              "name": "Dynamic Position",
              "steps": [
                "Check if sTxt equals '<OTHERPOS>'",
                "Fetch string from bm0.posnum()",
                "Assign to Mark entity"
              ]
            },
            "path2": {
              "name": "Static Text",
              "steps": [
                "Use string value of sTxt directly",
                "Assign to Mark entity"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Internal Beam Array Count",
            "errorMessage": "None (Silent failure)",
            "recovery": "The script instance deletes itself automatically if the beam count drops below 2 (e.g., if a beam is deleted). User must re-insert the script."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Properties",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Changing 'Side', 'Text', or alignment properties triggers an immediate recalculation and moves/updates the mark on the beam."
          },
          {
            "action": "Modify Geometry",
            "how": "Grip edits or Move/Rotate commands on the beams",
            "effect": "The mark updates its position to maintain the correct intersection relationship because dependencies are set on the beam entities."
          },
          {
            "action": "Rename Male Beam",
            "how": "Update Position Number in Project Manager",
            "effect": "If the text is set to '<OTHERPOS>', the mark automatically updates to display the new position number."
          }
        ]
      },
      "tokens_used": 6630,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_T-MarkerLine.mcr\n\n## Overview\nThis script automatically creates a marking line (and optional text) on a \"female\" beam to indicate the exact intersection location or identity of a perpendicular \"male\" beam (T-connection). It is useful for fabrication preparation to visualize where cross-members connect.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used in the 3D model to visualize beam intersections. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Not designed for 2D drawing generation. |\n\n## Prerequisites\n- **Required Entities:** Two Beams (GenBeams).\n- **Minimum Beam Count:** 2\n- **Required Settings:** None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_T-MarkerLine.mcr` from the file list.\n\n### Step 2: Select Male Beam\n```\nCommand Line: Select male beam\nAction: Click on the beam that intersects (the cross-member).\n```\n\n### Step 3: Select Female Beam\n```\nCommand Line: Select female beam\nAction: Click on the main beam that the male beam connects into.\n```\n\n*Note: After selecting the beams, the script will generate the marking on the female beam. You can then modify the appearance via the Properties Palette.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Side** | Dropdown | Contact face | Determines which face of the female beam the marking is applied to. Options include the face touching the male beam, the opposite side, or the lateral sides. |\n| **Text** | Text | [Empty] | The text content to mark on the beam. Use `<OTHERPOS>` to automatically display the Position Number of the selected Male Beam. |\n| **Text Position** | Dropdown | Center | Controls vertical placement relative to the marker line (Bottom, Center, or Top). |\n| **Text Alignment** | Dropdown | Center | Controls horizontal justification relative to the line (Left, Center, or Right). |\n| **Direction** | Number | 0 | Controls text rotation/orientation for CNC machine output (Hundegger). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the mark position if you manually edit the geometry of the beams. |\n| Erase | Removes the script instance from the model. |\n\n## Settings Files\n- **Filename:** None\n- **Location:** N/A\n- **Purpose:** This script does not rely on external settings files.\n\n## Tips\n- **Dynamic Labeling:** Enter the exact string `<OTHERPOS>` (without quotes) into the **Text** property. The script will automatically read and display the Position Number of the Male Beam. If the Male Beam's number changes in the Project Manager, the mark will update automatically.\n- **Visual Clarity:** Use the **Side** property to move the mark to a visible face if the default contact face is obscured or already crowded with other marks.\n- **Auto-Cleanup:** If you delete one of the beams connected to this script, the script instance will automatically delete itself to prevent errors.\n\n## FAQ\n- **Q: How can I mark the beam with the name of the intersecting beam?**\n  - A: Select the script instance, open the Properties palette, and in the **Text** field, type `<OTHERPOS>`.\n- **Q: Can I move the mark to the other side of the beam?**\n  - A: Yes. Select the script instance, find the **Side** property in the Properties palette, and change it to \"Opposite contact face\" or \"Side 1/2\".\n- **Q: Why did the marking disappear?**\n  - A: This script requires both beams to exist. If you deleted either the Male or Female beam, the script will automatically remove itself. Re-run the command to recreate it."
      },
      "tokens_used": 5617,
      "error": null
    }
  }
}