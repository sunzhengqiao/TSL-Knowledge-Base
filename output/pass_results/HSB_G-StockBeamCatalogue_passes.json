{
  "filename": "HSB_G-StockBeamCatalogue.mcr",
  "status": "completed",
  "total_tokens": 34410,
  "processing_time": 765.721818447113,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "01.12.2015",
            "author": "AS",
            "changes": "Pilot version"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "HSB_G-StockBeamCatalogueProps.mcr"
        ]
      },
      "tokens_used": 5089,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script creates TslInst instances specifically in _kModelSpace (e.g., tsl.dbCreate(..., _kModelSpace, ...)). It relies on _PtW for insertion positioning and uses standard Model Space prompts (getPoint). There are no ShopDrawing entities (#Type E), sd_ prefixes, or _Viewport references that indicate Paper Space usage."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "HSB-StockBeamCatalogue.dxx (expected path: _kPathHsbCompany\\Abbund)",
            "HSB_G-StockBeamCatalogueProps.mcr (required dependency)"
          ]
        }
      },
      "tokens_used": 3041,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"|Select a  position|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"TslInst.showDialog\",\n      \"trigger\": \"During insertion (_bOnInsert)\",\n      \"title\": null,\n      \"dataSource\": \"Current Instance Properties (OPM)\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    },\n    {\n      \"type\": \"TslInst.showDialog\",\n      \"trigger\": \"Context menu 'Add an entry'\",\n      \"title\": null,\n      \"dataSource\": \"HSB_G-StockBeamCatalogueProps.mcr (Mode 1)\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    },\n    {\n      \"type\": \"TslInst.showDialog\",\n      \"trigger\": \"Context menu 'Edit an entry' or 'Remove an entry' (Selection Phase)\",\n      \"title\": null,\n      \"dataSource\": \"HSB_G-StockBeamCatalogueProps.mcr (Mode 2)\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    },\n    {\n      \"type\": \"TslInst.showDialog\",\n      \"trigger\": \"Context menu 'Edit an entry' (Editing Phase)\",\n      \"title\": null,\n      \"dataSource\": \"HSB_G-StockBeamCatalogueProps.mcr (Mode 3)\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"dTxtHeight\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Text size|\",\n      \"defaultValue\": \"U(50)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"sDimStyle\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Dimension style|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options"
      },
      "tokens_used": 7381,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a visual schedule of standard stock timber sections and available lengths in the model, and provides a management interface to add, edit, or remove these entries from a shared catalog file.",
          "category": "DataManagement / Scheduling",
          "typicalUseCase": "A project manager inserts this schedule in the model to view and manage the current inventory of stock beams (dimensions and lengths) to ensure designs align with available materials."
        },
        "parameters": [
          {
            "name": "dTxtHeight",
            "technicalDefault": "U(50)",
            "businessMeaning": "Controls the height of the text characters within the schedule table. This parameter effectively scales the entire table grid, as column widths and row heights are calculated as multiples of this value.",
            "validRange": "20mm to 150mm (depending on plotting scale)",
            "unit": "mm",
            "affectsOutput": "Increasing this value enlarges the text size, increases the spacing between rows (Row Height = 2 * Text Height), and widens the columns (Column Width = 10 * Text Height), making the catalog more legible but consuming more screen space."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "\"\"",
            "businessMeaning": "Selects the specific CAD dimension style (font, color, line type) to be applied to the text in the stock beam schedule.",
            "validRange": "Any valid dimension style name currently loaded in the drawing (e.g., STANDARD, ISO-25).",
            "unit": "string",
            "affectsOutput": "Changes the visual appearance (font, typeface) of the 'STOCK BEAMS' header and the list of sections/lengths without changing the layout geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User modifies 'Text size' (dTxtHeight)",
            "effect": "The internal grid layout variables (Row Height and Column Width) are recalculated, causing the entire schedule to expand or contract around the insertion point.",
            "cascade": [
              "Row Height",
              "Column Width",
              "Overall Schedule Footprint"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Annotation / Display",
            "description": "A visual table consisting of three columns (Stock Beams label, Section sizes, and Available Lengths) and multiple rows corresponding to the entries in the 'HSB-StockBeamCatalogue.dxx' file.",
            "appliedTo": "Model Space (inserted at the user-selected point _Pt0)"
          }
        ]
      },
      "tokens_used": 6842,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Triggered (Insert or Reload)",
          "[System Check] Verify insertCycleCount() == 1; if > 1, erase duplicate instance and exit",
          "Prompt User: 'Select a position' to place the schedule table",
          "Read Data: Load 'HSB-StockBeamCatalogue.dxx' into internal Map",
          "[Insert Only] Show Properties Dialog (for Text Size and Dimension Style)",
          "Generate Visuals: Draw grid header ('STOCK BEAMS', 'SECTION', 'LENGTHS') and rows based on Map data",
          "Script Idle / Display Complete"
        ],
        "conditionalBranches": [
          {
            "condition": "User executes Context Menu command: 'Add an entry'",
            "path1": {
              "name": "Standard Add",
              "steps": [
                "Script reads DXX file",
                "Launch temporary sub-script (HSB_G-StockBeamCatalogueProps) in 'Mode 1'",
                "User enters Width, Height, and list of Lengths",
                "Script parses Length string (splits by semicolon, converts to doubles)",
                "Construct Entry Key: 'Width x Height'",
                "Check if Key exists in Map",
                "If Unique: Add to Map and write to DXX file",
                "If Duplicate: Show Warning 'The catalogue already contains an entry...', abort add"
              ]
            }
          },
          {
            "condition": "User executes Context Menu command: 'Remove an entry'",
            "path1": {
              "name": "Remove Flow",
              "steps": [
                "Script reads DXX file",
                "Launch temporary sub-script (HSB_G-StockBeamCatalogueProps) in 'Mode 2' (Selection Mode)",
                "User selects an entry name from the list",
                "Script removes entry from Map",
                "Write updated Map to DXX file"
              ]
            }
          },
          {
            "condition": "User executes Context Menu command: 'Edit an entry'",
            "path1": {
              "name": "Edit Flow",
              "steps": [
                "Script reads DXX file",
                "Launch temporary sub-script (HSB_G-StockBeamCatalogueProps) in 'Mode 2' (Selection Mode)",
                "User selects an entry name from the list",
                "Retrieve existing Width, Height, and Lengths",
                "Launch temporary sub-script (HSB_G-StockBeamCatalogueProps) in 'Mode 3' (Edit Mode)",
                "User modifies the list of Lengths",
                "Update Map with new Lengths (preserving Width/Height)",
                "Write updated Map to DXX file"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Unique Entry Key",
            "errorMessage": "|The calalogue already contains an entry with this key.||Use the edit option to adjust this entry.|",
            "recovery": "User must cancel the 'Add' operation and instead use 'Edit an entry' from the context menu to modify the existing section."
          },
          {
            "check": "Numerical Input Parsing (Lengths)",
            "errorMessage": "(Implicit) Non-numeric tokens in the length list are ignored/treated as zero.",
            "recovery": "User must re-edit the entry via 'Edit an entry' and ensure the length list contains only valid numbers separated by semicolons."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Visual Style",
            "how": "OPM (Object Properties Palette)",
            "effect": "Modifying 'Text size' (dTxtHeight) recalculates row heights and column widths, scaling the entire schedule. Modifying 'Dimension style' changes font/color attributes."
          },
          {
            "action": "Manage Catalog Data",
            "how": "Right-Click Context Menu",
            "effect": "Triggering 'Add/Edit/Remove' updates the external DXX file, which immediately updates the visual schedule in the model (and any other instances linked to that file)."
          },
          {
            "action": "Relocate Schedule",
            "how": "Standard Grips / Move Command",
            "effect": "Moves the origin point (_Pt0), shifting the entire table to the new location."
          }
        ]
      },
      "tokens_used": 6946,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-StockBeamCatalogue.mcr\n\n## Overview\nThis script inserts a visual schedule (table) into the model that displays standard stock timber sections and their available lengths. It serves as both a display tool and a catalog manager, allowing you to add, edit, or remove inventory entries directly from the context menu.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The schedule is inserted at a user-selected point in the model. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | Not intended for manufacturing drawings. |\n\n## Prerequisites\n- **Required Entities**: None\n- **Minimum Beam Count**: 0\n- **Required Settings Files**:\n  - `HSB_G-StockBeamCatalogueProps.mcr` (Script dependency)\n  - `HSB-StockBeamCatalogue.dxx` (Expected location: `...\\hsbCompany\\Abbund`)\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT` â†’ Select `HSB_G-StockBeamCatalogue.mcr`\n\n### Step 2: Insert the Catalog\n```\nCommand Line: Select a position\nAction: Click anywhere in the Model Space to place the top-left corner of the stock beam table.\n```\n\n### Step 3: Configure Properties (Optional)\nOnce placed, the Properties Palette will appear automatically. You can adjust the text size or dimension style before the table finishes generating.\n\n### Step 4: View or Modify\nThe table will display the current contents of the catalog file. Right-click the table to Add, Edit, or Remove entries.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Text size** | Number | U(50) | Sets the height of the text characters. This also scales the grid (row height = 2x text size, column width = 10x text size). |\n| **Dimension style** | String | (Empty) | Selects the dimension style (font, color) to use for the table text and headers. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Add an entry** | Opens a dialog to create a new stock beam entry. You must input Width, Height, and a list of Lengths (separated by semicolons). |\n| **Edit an entry** | Allows you to modify the available lengths for an existing section. First, select the section from a list, then update the length string. |\n| **Remove an entry** | Deletes a section completely from the catalog. Select the section from the list to confirm removal. |\n\n## Settings Files\n- **Filename**: `HSB-StockBeamCatalogue.dxx`\n- **Location**: `_kPathHsbCompany\\Abbund`\n- **Purpose**: Stores the catalog data persistently. When you Add/Edit/Remove entries, this file is updated so the changes are visible across all drawings using this script.\n\n## Tips\n- **Formatting Lengths**: When adding or editing entries, separate multiple lengths with a semicolon (e.g., `2000;2400;3000`).\n- **Scaling**: If the table is too small to read, select it and increase the **Text size** property in the Properties Palette.\n- **Duplicate Checks**: The system prevents duplicate section sizes (Width x Height). If you try to add a size that already exists, use the **Edit an entry** option instead.\n\n## FAQ\n- **Q: I tried to add a beam but got a warning that it already exists. What do I do?**\n  A: This means the specific Width x Height combination is already in the catalog. Use the \"Edit an entry\" right-click option to modify the lengths for that existing size.\n- **Q: How do I move the table to a different spot?**\n  A: Use the standard AutoCAD `MOVE` command or drag the grip located at the insertion point (top-left of the table).\n- **Q: My text looks huge/tiny compared to the rest of the drawing.**\n  A: Select the schedule, open the Properties Palette (Ctrl+1), and change the **Text size** parameter to a value suitable for your plot scale."
      },
      "tokens_used": 5111,
      "error": null
    }
  }
}