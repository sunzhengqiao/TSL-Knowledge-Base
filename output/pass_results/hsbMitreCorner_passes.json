{
  "filename": "hsbMitreCorner.mcr",
  "status": "completed",
  "total_tokens": 26697,
  "processing_time": 192.12639021873474,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "This tsl creates a mitre or corner connection between two beams (optioanl with gap)",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "27sep13",
            "author": "th@hsbCAD.de",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4117,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Filename does not start with 'sd_' or 'Multipage'. No usage of '_Viewport', '_kPaperSpace', or '#Type E'. The script uses PrEntity to select 'Beam' objects and applies 'Cut' tools (3D operations) to geometry."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3103,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select 2 beams|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select second beam|",
              "condition": "_Beam.length()==1",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sToolType",
            "type": "PropString",
            "displayName": "|Tool Type|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "|Mitre|",
              "|Corner|"
            ],
            "category": null,
            "description": "|Defines the tool type| |Double Click to swap sides|"
          },
          {
            "index": 0,
            "variable": "dGap",
            "type": "PropDouble",
            "displayName": "|Gap|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Defines the gap|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "TslDoubleClick",
            "handler": "TslDoubleClick",
            "action": "Swaps beam 0 and beam 1 (and associated vectors)",
            "alsoTriggeredBy": "Double-click"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 5698,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a mitre (angled) or corner (90-degree) connection between two intersecting timber beams, optionally with a specified expansion gap.",
          "category": "Joinery/Framing",
          "typicalUseCase": "Creating precise intersections for wall corners, fascia connections, or roof structures where beams meet at an angle."
        },
        "parameters": [
          {
            "name": "sToolType",
            "technicalDefault": "|Mitre|",
            "businessMeaning": "Determines the geometry of the joint: 'Mitre' calculates a bisected angle cut between the two beams, while 'Corner' creates a 90-degree intersection where each beam is cut perpendicular to the other's centerline.",
            "validRange": "List selection: |Mitre|, |Corner|",
            "unit": "enum",
            "affectsOutput": "Switches the mathematical logic used to generate the cut planes. 'Mitre' creates a symmetrical angled joint; 'Corner' creates an orthogonal joint. In 'Corner' mode, it also enables beam swapping logic."
          },
          {
            "name": "dGap",
            "technicalDefault": "0",
            "businessMeaning": "Specifies the distance between the two cut faces of the beams, typically used to allow for expansion, sealant, or manufacturing tolerances.",
            "validRange": "0 mm to 20 mm",
            "unit": "mm",
            "affectsOutput": "Shifts the cut planes away from the theoretical intersection point. For mitres, it offsets along the bisector. For corners, it offsets one beam along its axis relative to the intersection."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sToolType is changed to |Corner|",
            "effect": "Enables the ability to swap beams (via Double Click), which changes which beam determines the cut orientation.",
            "cascade": [
              "beams array order"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Cut",
            "description": "Planar cuts applied to the ends or faces of the selected beams to create the joint.",
            "appliedTo": "The two beams selected by the user during insertion."
          }
        ]
      },
      "tokens_used": 3611,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched",
          "Check Insertion Cycle (if >1, erase instance and exit)",
          "Check Execution Key (MITRE, CORNER, or Catalog Key)",
          "Set Properties based on Key or Show Dialog",
          "Start Beam Selection Loop (Prompt: 'Select 2 beams')",
          "User selects Entity",
          "Validate Entity (Is it a Beam? Is it duplicate? Is it parallel?)",
          "[If Invalid] Show Error and repeat selection prompt",
          "[If Valid] Add to list",
          "[If 1 beam selected] Update prompt to 'Select second beam'",
          "[If 2 beams selected] Exit loop",
          "Determine Tool Type (Mitre or Corner)",
          "[If Mitre] Calculate bisecting cut planes with gap",
          "[If Corner] Check Swap Flag -> potentially swap beams -> calculate orthogonal cut planes with gap",
          "Apply Cut tools to Beams"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Execution Key",
            "path1": {
              "name": "Key is MITRE",
              "steps": [
                "Set sToolType to |Mitre|",
                "Set catalog from _LastInserted",
                "Proceed to selection"
              ]
            },
            "path2": {
              "name": "Key is CORNER",
              "steps": [
                "Set sToolType to |Corner|",
                "Set catalog from _LastInserted",
                "Proceed to selection"
              ]
            },
            "path3": {
              "name": "Other Key or None",
              "steps": [
                "Try setPropValuesFromCatalog",
                "If no key, call showDialog()",
                "Proceed to selection"
              ]
            }
          },
          {
            "condition": "Tool Type Property",
            "path1": {
              "name": "Mitre",
              "steps": [
                "Calculate cut normal to bisecting angle",
                "Offset cuts by +/- 0.5 * dGap",
                "Apply cuts"
              ]
            },
            "path2": {
              "name": "Corner",
              "steps": [
                "Check 'swap' flag in _Map",
                "[If Swap active] Swap Beam[0] and Beam[1]",
                "Calculate cut based on opposing beam vectors",
                "Apply cuts"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Duplicate Beam Selection",
            "errorMessage": "refused (Duplicate)",
            "recovery": "User must select a different beam"
          },
          {
            "check": "Parallel Beams",
            "errorMessage": "refused (parallel)",
            "recovery": "User must select a beam that is not parallel to the first beam"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Tool Type",
            "how": "OPM (Properties Palette) dropdown",
            "effect": "Switches geometry generation between Mitre (angled) and Corner (orthogonal). Resets/Swaps beams if needed."
          },
          {
            "action": "Modify Gap",
            "how": "OPM (Properties Palette) number field",
            "effect": "Adjusts the distance between the two cut faces. Updates immediately."
          },
          {
            "action": "Swap Sides",
            "how": "Double Click on script instance",
            "effect": "Swaps Beam 0 and Beam 1 indices. Only affects geometry if Tool Type is set to |Corner|."
          }
        ]
      },
      "tokens_used": 5828,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbMitreCorner.mcr\n\n## Overview\nThis script generates a mitre (angled) or corner (90-degree) connection between two intersecting timber beams. It supports an optional expansion gap to accommodate manufacturing tolerances or sealant.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in Model Space. |\n| Paper Space | No | Not supported in layout views. |\n| Shop Drawing | No | Not intended for generating shop drawing views directly. |\n\n## Prerequisites\n- **Required Entities:** Two (2) Beams.\n- **Minimum Beam Count:** 2 beams must be selected during insertion.\n- **Required Settings:** None specified; standard hsbCAD environment required.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbMitreCorner.mcr` from the file dialog.\n\n### Step 2: Select First Beam\n```\nCommand Line: Select 2 beams\nAction: Click on the first beam you wish to connect.\n```\n\n### Step 3: Select Second Beam\n```\nCommand Line: Select second beam\nAction: Click on the intersecting beam.\n```\n*Note: The beams cannot be parallel to each other, and you cannot select the same beam twice.*\n\n### Step 4: Configure Joint (Optional)\nOnce inserted, select the script instance in the drawing to modify its properties in the Properties Palette (OPM).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Tool Type | dropdown | | Defines the geometry of the joint. Select **Mitre** for a bisected angle cut or **Corner** for a 90-degree intersection. |\n| Gap | number | 0 | Defines the distance (gap) between the two cut faces. Enter 0 for a tight fit or a specific value for expansion tolerance. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| TslDoubleClick (Double Click) | Swaps Beam 1 and Beam 2. This changes the reference point for the cut, which is particularly useful in **Corner** mode to ensure the correct side is cut. |\n\n## Settings Files\n- **Filename**: N/A\n- **Location**: N/A\n- **Purpose**: No specific external settings file is required. The script may use standard catalog entries if invoked with specific execution keys (MITRE or CORNER).\n\n## Tips\n- **Correcting Cut Direction:** If a Corner connection cuts the wrong side of the beam, simply double-click the script instance in the model to swap the beam references.\n- **Avoid Errors:** Ensure the two beams are not parallel; the script will refuse to process parallel beams.\n- **Expansion:** Use the `Gap` property to leave room for glue, sealant, or wood movement.\n\n## FAQ\n- **Q: Why does the script fail when I select the beams?**\n  **A:** Ensure you are selecting two different beams and that they are not parallel to each other.\n- **Q: How do I change a joint from a straight cut to a 45-degree mitre?**\n  **A:** Select the script instance, open the Properties Palette, and change the \"Tool Type\" from \"Corner\" to \"Mitre\".\n- **Q: What happens if I double-click the script?**\n  **A:** It swaps the order of the selected beams. In \"Corner\" mode, this changes which beam dictates the perpendicular cut direction."
      },
      "tokens_used": 4340,
      "error": null
    }
  }
}