{
  "filename": "GE_FLOOR_HOLES.mcr",
  "status": "completed",
  "total_tokens": 50992,
  "processing_time": 433.2993538379669,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6549,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script executes user input prompts (getElementRoof, getPoint) during _bOnInsert, characteristic of ModelSpace insertion. It adds 3D manufacturing tools (ElemMill, Drill) to entities using el.addTool. It uses collectEntities with the _kModelSpace flag. It lacks ShopDrawing indicators such as 'sd_' prefix, '#Type E', or iteration through _Entity[] arrays derived from viewports."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Sheet"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 8198,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getElementRoof",
              "promptOriginal": "Select an floor element",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select insertion point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "showDialogOnce() during _bOnInsert",
            "title": null,
            "dataSource": "OPM Properties (sHoleName, pDirection, iRotation, strText, strDrill, dDrillDiam)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sHoleName",
            "type": "PropString",
            "displayName": "Hole type",
            "defaultValue": "2-1\"Drills Spaced at 3-3/4\"",
            "inputType": "dropdown",
            "options": [
              "2-1\"Drills Spaced at 3-3/4\"",
              "2-1\"Drills Spaced at 1-3/4\"",
              "2-1\"Drills Spaced at 3\"",
              "Circular Hole 1.25",
              "Circular Hole 1.5",
              "Circular Hole 4",
              "Circular Hole 5",
              "Circular Hole 6",
              "Circular Hole 9",
              "Circular Hole 10",
              "Ellipse 3x1",
              "Ellipse 3x2",
              "Ellipse 4x2",
              "Ellipse 4x1.5",
              "Diamond Hole 4 1/2",
              "Diamond Hole 5 1/2",
              "Diamond Hole 8",
              "Rectangle Hole 6X9",
              "Rectangle Hole 5.5x8",
              "Rectangle Hole 5.5x10",
              "Rectangle Hole 3.5x14.5",
              "Rectangle Hole 4.25x10.25",
              "Square Hole 5",
              "Square Hole 6",
              "Square Hole 8",
              "Square Hole 10",
              "Text"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "pDirection",
            "type": "PropString",
            "displayName": "Orientaion of Hole",
            "defaultValue": "Joist Direction",
            "inputType": "dropdown",
            "options": [
              "Joist Direction",
              "Perpendicular to Joist Direction"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "iRotation",
            "type": "PropInt",
            "displayName": "Additional Rotation",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strText",
            "type": "PropString",
            "displayName": "Text Output",
            "defaultValue": "TEXT",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "strDrill",
            "type": "PropString",
            "displayName": "Add Drill to Joist",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dDrillDiam",
            "type": "PropDouble",
            "displayName": "Drill Diameter",
            "defaultValue": "1.5",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8203,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates standardized floor penetrations (holes, chases, or text marks) and optionally drills through underlying floor joists at the selected location.",
          "category": "Manufacturing/Framing",
          "typicalUseCase": "Used during floor layout to insert HVAC chases, plumbing vents, or service penetrations, ensuring holes are aligned with joists and marked on shop drawings."
        },
        "parameters": [
          {
            "name": "sHoleName",
            "technicalDefault": "2-1\"Drills Spaced at 3-3/4\"",
            "businessMeaning": "Selects the predefined template for the floor opening. This determines the shape (circle, rectangle, ellipse, diamond), dimensions, and specific layout (e.g., double drills) in the floor sheathing/plates.",
            "validRange": "Predefined list (Dropdown)",
            "unit": "N/A",
            "affectsOutput": "Defines the geometry of the PLine used for milling (ElemMill) and the size of the visual mark. It sets the dimensions (X/Y) and spacing for the cutout."
          },
          {
            "name": "pDirection",
            "technicalDefault": "Joist Direction",
            "businessMeaning": "Sets the primary orientation of the hole relative to the floor's structure. It determines if the hole's length aligns with the joists or runs perpendicular to them.",
            "validRange": "\"Joist Direction\", \"Perpendicular to Joist Direction\"",
            "unit": "N/A",
            "affectsOutput": "Calculates the base rotation angle (90 degrees offset) for the hole's coordinate system before applying manual rotation."
          },
          {
            "name": "iRotation",
            "technicalDefault": "0",
            "businessMeaning": "Applies a manual fine-tuning rotation to the hole, allowing it to be angled to match specific piping or ductwork runs that are not perfectly grid-aligned.",
            "validRange": "0 - 360 (Integer)",
            "unit": "Degrees",
            "affectsOutput": "Adds to the base rotation defined by 'pDirection' to create the final orientation of the hole geometry."
          },
          {
            "name": "strText",
            "technicalDefault": "TEXT",
            "businessMeaning": "Custom text label to be associated with the hole, typically used to identify the purpose of the penetration (e.g., 'HVAC', 'DR', 'Vent') on drawings and exports.",
            "validRange": "String",
            "unit": "Text",
            "affectsOutput": "Updates the text displayed in the 3D model and on Layout Sheets (via Mark entity) and exports to DXI data."
          },
          {
            "name": "strDrill",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggle to enable or disable the drilling of the structural floor joists located underneath the selected hole position.",
            "validRange": "\"Yes\", \"No\"",
            "unit": "N/A",
            "affectsOutput": "If 'Yes', the script searches for a parallel joist (DakCenterJoist) under the point and adds a Drill operation to that specific beam."
          },
          {
            "name": "dDrillDiam",
            "technicalDefault": "1.5",
            "businessMeaning": "Specifies the diameter of the drill to be made in the underlying joist. This can be different from the hole size in the floor sheathing (e.g., a large chase for insulation with a small pipe hole through the joist).",
            "validRange": "Dependent on Joist Width (Typically 0.5\" - 4.0\")",
            "unit": "Inches",
            "affectsOutput": "Determines the diameter of the cylindrical Drill entity added to the joist beam."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sHoleName selection",
            "effect": "Determines the default text label and the geometry of the floor cut, but does not automatically update the joist drill diameter.",
            "cascade": [
              "strText",
              "Geometry"
            ]
          },
          {
            "trigger": "pDirection",
            "effect": "Sets the base rotation reference which is then modified by iRotation.",
            "cascade": [
              "iRotation"
            ]
          },
          {
            "trigger": "strDrill set to 'Yes'",
            "effect": "Activates the logic to use dDrillDiam to drill into the found joist.",
            "cascade": [
              "dDrillDiam"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "ElemMill",
            "description": "A milling tool that cuts the selected shape (Circle, Rect, Ellipse, etc.) through the floor element's sheets and plates.",
            "appliedTo": "The selected Floor Element (Sheets/Plates)"
          },
          {
            "type": "Drill",
            "description": "A cylindrical hole drilled through a specific structural joist found underneath the insertion point.",
            "appliedTo": "Internal Joist Beam (Type: DakCenterJoist)"
          },
          {
            "type": "Mark / Display",
            "description": "Visual text and geometry drawn in the model and on layout sheets to indicate the location and type of the hole.",
            "appliedTo": "Model Space and Layout Sheets"
          },
          {
            "type": "Map (DXI Export)",
            "description": "Exports the hole properties (text, point, vectors) to external manufacturing/CAM software via the Map structure.",
            "appliedTo": "Export Data"
          }
        ]
      },
      "tokens_used": 10028,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script",
          "Show Dialog (showDialogOnce)",
          "Select Floor Element (getElementRoof)",
          "Select Insertion Point (getPoint)",
          "Detect and Snap to Parallel Joist (if found within search radius)",
          "Generate Geometry based on Hole Type (Circle, Rect, Ellipse, Diamond, Text)",
          "Calculate Orientation (Joist Direction + Rotation)",
          "Generate Tooling (ElemMill for sheets, Drill for joists)",
          "Add Visual Displays (Model and Layout)",
          "Export to DXI/Map",
          "Completion"
        ],
        "conditionalBranches": [
          {
            "condition": "sHoleName Selection (Shape Type)",
            "path1": {
              "name": "Circular (Single)",
              "steps": [
                "Define Single Circle PLine",
                "Create single Drill Point",
                "Apply circular Milling/Drilling"
              ]
            },
            "path2": {
              "name": "Double Circles",
              "steps": [
                "Define Two Circle PLines (offset by spacing)",
                "Create two Drill Points",
                "Apply milling/Drilling to both locations"
              ]
            },
            "path3": {
              "name": "Ellipse",
              "steps": [
                "Construct Ellipse using Bulges and Vertices",
                "Apply Milling (No drilling tool generated for shape, relies on separate drill logic)"
              ]
            },
            "path4": {
              "name": "Rectangle / Square",
              "steps": [
                "Create Rectangular PLine",
                "Apply Milling"
              ]
            },
            "path5": {
              "name": "Diamond",
              "steps": [
                "Create Rectangular PLine",
                "Rotate PLine 45 degrees",
                "Apply Milling"
              ]
            },
            "path6": {
              "name": "Text Only",
              "steps": [
                "Skip Milling/Drilling Geometry generation",
                "Create Mark Entity for Layout",
                "Create ElemItem (Number + Text)",
                "Draw Text at insertion point"
              ]
            }
          },
          {
            "condition": "Joist Detection on Insert/Move",
            "path1": {
              "name": "Joist Found",
              "steps": [
                "Check intersection with 3D Body below point",
                "Check if Beam is parallel to Floor Y-Axis",
                "Snap insertion Point to Beam Centerline",
                "Reset Z elevation to Floor Element elevation"
              ]
            },
            "path2": {
              "name": "No Joist Found",
              "steps": [
                "Keep user selected insertion point",
                "Reset Z elevation to Floor Element elevation"
              ]
            }
          },
          {
            "condition": "Drill Joist Property (strDrill)",
            "path1": {
              "name": "Yes (Add Drill)",
              "steps": [
                "Search for beams under hole",
                "Filter for 'DakCenterJoist' type",
                "Filter for parallel alignment",
                "Calculate Drill position (Top of beam - offset)",
                "Add Drill tool to Joist Beam"
              ]
            },
            "path2": {
              "name": "No (Skip Drill)",
              "steps": [
                "Skip Joist Drilling Logic"
              ]
            }
          },
          {
            "condition": "Sheet Intersection Check",
            "path1": {
              "name": "Intersects Sheet(s)",
              "steps": [
                "Verify Mill Body intersects Sheet Envelope",
                "Add ElemMill to Floor Element",
                "Add Drill tool to individual Sheets",
                "Increment Counter"
              ]
            },
            "path2": {
              "name": "No Intersection / Outside Floor",
              "steps": [
                "Do not apply Tooling",
                "Do not increment Counter"
              ]
            }
          },
          {
            "condition": "Sheet Count (>1)",
            "path1": {
              "name": "Multi-Sheet Intersection",
              "steps": [
                "Display Warning Text: 'Move me from sheet edge. This location is not optimal!'"
              ]
            },
            "path2": {
              "name": "Single Sheet Intersection",
              "steps": [
                "No Warning displayed"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "Script terminates internally (eraseInstance) if _Element.length() == 0",
            "recovery": "User must ensure a Floor Element is selected during the getElementRoof prompt."
          },
          {
            "check": "Array Consistency (Internal)",
            "errorMessage": "None explicitly shown, but comment warns: 'Always make sure that array of names (sarHoleNames) and array of diameters (dHoleDiams) have the same number of elements'",
            "recovery": "Developer maintenance required. If mismatched, script will likely crash or access wrong dimensions."
          },
          {
            "check": "Valid Joist for Drilling",
            "errorMessage": "None displayed to user, but Logic: `bm.type() == _kDakCenterJoist` must be true.",
            "recovery": "Ensure the underlying joist is defined as type 'DakCenterJoist' and is parallel to the floor element."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Hole Type",
            "how": "OPM Property Palette (Hole type dropdown)",
            "effect": "Regenerates PLine geometry, updates dimensions, resets text label if applicable, and recalculates tooling."
          },
          {
            "action": "Relocate Hole",
            "how": "Grip Edit (Move _Pt0)",
            "effect": "Triggers '_kNameLastChangedProp == \"_Pt0\"' logic. Re-runs the Joist Snapping routine to snap to the nearest joist at the new location, then resets Z-elevation and regenerates tooling."
          },
          {
            "action": "Rotate Hole",
            "how": "OPM Property Palette (Orientation or Additional Rotation)",
            "effect": "Updates the transformation matrix (Rotation + Base Direction), re-orienting the hole geometry relative to the floor element."
          },
          {
            "action": "Toggle Drill",
            "how": "OPM Property Palette (Add Drill to Joist: Yes/No)",
            "effect": "If Yes: Searches for joist and adds Drill. If No: Removes Drill tool (by not adding it in the rebuild cycle)."
          },
          {
            "action": "Resize Drill Diameter",
            "how": "OPM Property Palette (Drill Diameter)",
            "effect": "Updates the radius of the Drill entity applied to the joist."
          },
          {
            "action": "Update Text Label",
            "how": "OPM Property Palette (Text Output)",
            "effect": "Updates the Mark entity and DXI export map with the new string."
          }
        ]
      },
      "tokens_used": 11018,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_FLOOR_HOLES.mcr\n\n## Overview\nThis script creates standardized floor penetrations, such as holes, chases, and service openings, within floor elements. It optionally generates drilling operations for structural joists located underneath the penetration and adds text labels for manufacturing identification.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Primary environment for inserting floor holes. |\n| Paper Space | No | Not intended for layout views directly. |\n| Shop Drawing | No | Generates tooling data used in shop drawings, but runs in Model Space. |\n\n## Prerequisites\n- **Required Entities**: A Floor Element (e.g., timber floor panels/sheathing).\n- **Structural Members**: Joists (specifically `DakCenterJoist` type) if drilling is required.\n- **Minimum Beam Count**: 0.\n- **Required Settings Files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_FLOOR_HOLES.mcr`\n\n### Step 2: Select Floor Element\n```\nCommand Line: Select an floor element\nAction: Click on the desired floor element or sheet layer where the hole will be cut.\n```\n\n### Step 3: Select Insertion Point\n```\nCommand Line: Select insertion point\nAction: Click in the model space to define the location of the hole.\nNote: The script will automatically snap to the centerline of a parallel joist if one is found nearby.\n```\n\n### Step 4: Configure Properties\n**Action:** The Properties Palette (OPM) will appear automatically. Adjust the \"Hole type\", \"Orientation\", and other settings as needed. See the *Properties Panel Parameters* section below for details.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Hole type | Dropdown | 2-1\"Drills Spaced at 3-3/4\" | Selects the shape and dimensions of the opening (e.g., Circular, Rectangle, Ellipse, Diamond, or Text-only marks). |\n| Orientaion of Hole | Dropdown | Joist Direction | Sets the alignment of the hole relative to the floor joists (Parallel or Perpendicular). |\n| Additional Rotation | Number | 0 | Applies a manual rotation angle (in degrees) to fine-tune the hole's orientation. |\n| Text Output | Text | TEXT | Defines the label text associated with the hole for drawings and exports (e.g., \"HVAC\", \"VENT\"). |\n| Add Drill to Joist | Dropdown | Yes | If \"Yes\", the script searches for a joist under the hole and adds a drilling operation. If \"No\", only the floor sheathing is cut. |\n| Drill Diameter | Number | 1.5 | Specifies the diameter (in inches) of the drill hole to be made in the underlying joist. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Properties | Opens the Properties Palette to edit Hole Type, Rotation, and Drill settings. |\n| Delete | Removes the hole instance and associated tooling. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Snapping**: If you move the hole using its grip after insertion, the script will attempt to re-snap the insertion point to the nearest parallel joist.\n- **Multi-Sheet Warning**: If a hole spans across multiple floor sheets (e.g., at a joint), a warning text \"Move me from sheet edge...\" may appear. Move the hole slightly away from the sheet boundary for optimal manufacturing.\n- **Text Only Mode**: Select \"Text\" from the *Hole type* dropdown to place a label or mark on the floor without creating a physical cut or drill.\n- **Drilling Logic**: Ensure the underlying structural beam is defined as a `DakCenterJoist` type for the automatic drilling function to work correctly.\n\n## FAQ\n- **Q: Why is the hole not drilling through the joist?**\n  **A:** Check that \"Add Drill to Joist\" is set to \"Yes\". Additionally, verify that the beam underneath the hole is a `DakCenterJoist` type and runs parallel to the hole orientation logic.\n  \n- **Q: Can I change the shape of the hole after I insert it?**\n  **A:** Yes. Select the hole in the model, open the Properties Palette, and change the \"Hole type\" dropdown. The geometry and tooling will update automatically.\n\n- **Q: How do I rotate the hole to match my ductwork?**\n  **A:** Set the \"Orientaion of Hole\" to \"Joist Direction\" or \"Perpendicular...\" as a base, then use the \"Additional Rotation\" parameter to type in a specific angle (e.g., 45) to align it precisely."
      },
      "tokens_used": 6996,
      "error": null
    }
  }
}