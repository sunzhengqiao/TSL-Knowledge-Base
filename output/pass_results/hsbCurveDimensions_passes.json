{
  "filename": "hsbCurveDimensions.mcr",
  "status": "completed",
  "total_tokens": 29421,
  "processing_time": 251.97207379341125,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "16apr13",
            "author": "th@hsbCAD.de",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4779,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _kModelSpace in dbCreate(). Collects entities using Group().collectEntities(true, Beam(), _kModelSpace). No sd_ prefix, #Type E, or _Viewport references found."
        },
        "prerequisites": {
          "requiredEntities": [
            "CurvedDescription"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 2772,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select curved description",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert && ents.length()==1",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "sArDimStyles (Sorted _DimStyles)",
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dTxtH",
            "type": "PropDouble",
            "displayName": "Text Height",
            "defaultValue": "40",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Defines the color of the schedule table"
          },
          {
            "index": 1,
            "variable": "sDisplayModeDelta",
            "type": "PropString",
            "displayName": "Delta Dimensioning",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "Parallel",
              "Perpendicular",
              "None"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sDisplayModeChain",
            "type": "PropString",
            "displayName": "Chain Dimensioning",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "Parallel",
              "Perpendicular",
              "None"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4245,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "This script automatically dimensions a flat span (developed) curved description and generates a schedule summary showing the quantity and material details of beams using that specific curved style.",
          "category": "ShopDrawing/Annotation",
          "typicalUseCase": "Used to annotate production drawings with precise geometry measurements for curved profiles and to provide a quick count of how many beams in the model share that specific curvature."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "Selects the visual standard (arrows, ticks, text font) for the dimension lines from the drawing's available dimension styles.",
            "validRange": "Any string matching a valid DimStyle in the current CAD session",
            "unit": "N/A",
            "affectsOutput": "Determines the visual appearance of the generated dimensions (e.g., architectural ticks vs. arrowheads)."
          },
          {
            "name": "dTxtH",
            "technicalDefault": "40",
            "businessMeaning": "Sets the plotted height of the dimension text and the accompanying schedule text.",
            "validRange": "15mm to 100mm (Typical text sizes depend on plot scale; 40mm is common for 1:50 or 1:100 details)",
            "unit": "mm",
            "affectsOutput": "Scales the size of the text characters proportionally."
          },
          {
            "name": "nColor",
            "technicalDefault": "1",
            "businessMeaning": "Assigns a CAD color index to the generated dimensions and text to control layer visibility or pen weight during plotting.",
            "validRange": "1 to 255 (AutoCAD Color Index)",
            "unit": "ACI",
            "affectsOutput": "Changes the color of all geometry and text created by this script."
          },
          {
            "name": "sDisplayModeDelta",
            "technicalDefault": "",
            "businessMeaning": "Controls the measurement method for the detailed dimensions between the curve's grip points (peaks/valleys).",
            "validRange": "Parallel (direct chord distance), Perpendicular (projected distance), None",
            "unit": "N/A",
            "affectsOutput": "Alters the numerical values displayed for the intermediate dimensions on the curve."
          },
          {
            "name": "sDisplayModeChain",
            "technicalDefault": "",
            "businessMeaning": "Controls the measurement method for the overall (outer) dimension lines representing the total span.",
            "validRange": "Parallel (direct chord distance), Perpendicular (projected distance), None",
            "unit": "N/A",
            "affectsOutput": "Alters the numerical values displayed for the total span dimensions."
          },
          {
            "name": "_Pt0",
            "technicalDefault": "User Click",
            "businessMeaning": "Defines the location for the schedule text block (count, style, material) when a single curve is selected; used as an anchor for cloning logic.",
            "validRange": "Any Point3d in Model Space",
            "unit": "mm",
            "affectsOutput": "Relocates the text block containing the beam count and material properties."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sDimStyle",
            "effect": "The script reads the text height defined in the chosen DimStyle to calculate a scaling factor for the dTxtH parameter.",
            "cascade": [
              "dTxtH"
            ]
          },
          {
            "trigger": "CurvedDescription Entity",
            "effect": "The script reads the associated 'CurvedStyle' to query the model for the number of beams ('nNumBeams') using it.",
            "cascade": [
              "Output Text Content (Count, Material, Info)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Dimension Lines",
            "description": "Generates multiple dimension lines relative to the curve's X-axis, detailing the positions of grip points and total span.",
            "appliedTo": "Model Space (Annotation layer)"
          },
          {
            "type": "Schedule Text",
            "description": "Draws a string of text reporting the total count of beams with this style, the Style Name, Material, Info, and Lamination thickness.",
            "appliedTo": "Model Space (at _Pt0 or curve origin)"
          }
        ]
      },
      "tokens_used": 5136,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User launches script 'hsbCurveDimensions.mcr'.",
          "2. 'showDialog()' displays Properties Palette for user configuration (Dimstyle, Text Height, Color, Display Modes).",
          "3. Script checks 'insertCycleCount()'; if greater than 1, the script terminates immediately to prevent loops.",
          "4. Command line prompts: 'Select curved description'. User selects one or more CurvedDescription entities.",
          "5. Conditional Branch: User selects exactly 1 entity vs Multiple entities.",
          "6. If single entity selected: Command line prompts for a point (getPoint) to place the schedule text.",
          "7. If multiple entities selected: Schedule text location is automatically set to the origin of each curve.",
          "8. Script iterates through selected entities and creates new TSL instances ('dbCreate') for each one, passing properties and the determined text location.",
          "9. The original 'template' instance erases itself.",
          "10. New instances execute: Validates that the attached entity is a valid CurvedDescription.",
          "11. Instance retrieves curve geometry (grips, coordinate system) and style properties.",
          "12. Instance scans ModelSpace to count all Beams matching the current curve's style name.",
          "13. Instance draws dimension lines (Delta and Chain) based on calculated grip points.",
          "14. Instance draws the schedule text (Count, Style, Material) at the designated point."
        ],
        "conditionalBranches": [
          {
            "condition": "Number of CurvedDescription entities selected during insertion",
            "path1": {
              "name": "Single Entity Selected",
              "steps": [
                "Execute 'getPoint()' to prompt user for text location.",
                "Assign user point to '_Pt0'."
              ]
            },
            "path2": {
              "name": "Multiple Entities Selected",
              "steps": [
                "Skip 'getPoint()' prompt.",
                "Calculate '_Pt0' using 'curve.coordSys().ptOrg()' for each entity."
              ]
            }
          },
          {
            "condition": "Validation of attached entity after insertion",
            "path1": {
              "name": "Valid CurvedDescription",
              "steps": [
                "Proceed to geometry calculation.",
                "Set dependency on entity for auto-update."
              ]
            },
            "path2": {
              "name": "Invalid Reference",
              "steps": [
                "Report error message: 'Invalid reference'.",
                "Erase current script instance."
              ]
            }
          },
          {
            "condition": "Beam Counting Logic (Internal)",
            "path1": {
              "name": "First Matching Beam Found",
              "steps": [
                "Extract 'Information' and 'Material' properties from this beam.",
                "Increment count."
              ]
            },
            "path2": {
              "name": "Subsequent Matching Beams",
              "steps": [
                "Increment count only.",
                "Do not overwrite Material/Info."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Checks if '_Entity[0]' exists and is of type 'CurvedDescription'.",
            "errorMessage": "\\nInvalid reference",
            "recovery": "User must select a valid CurvedDescription entity when running the script, or ensure the referenced entity is not deleted from the drawing."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties (OPM)",
            "how": "Change values in the Properties Palette (e.g., Text Height, Color, Display Modes).",
            "effect": "Script recalculates and redraws dimensions and text immediately with new settings."
          },
          {
            "action": "Move Schedule Text",
            "how": "Drag the '_Pt0' grip associated with the script instance.",
            "effect": "The text block (containing count, style, material) moves to the new grip location. Dimensions remain attached to curve geometry."
          },
          {
            "action": "Modify Geometry",
            "how": "Edit the geometry of the source CurvedDescription (e.g., move grips).",
            "effect": "Due to 'setDependencyOnEntity', the script detects the change, recalculates grip positions, and updates dimensions automatically."
          }
        ]
      },
      "tokens_used": 7019,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCurveDimensions.mcr\n\n## Overview\nThis script automatically dimensions a flat span (developed) curved description and generates a schedule summary showing the quantity and material details of all beams using that specific curved style.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be run in Model Space. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | This is a model annotation tool. |\n\n## Prerequisites\n- **Required Entities**: At least one `CurvedDescription` entity in the drawing.\n- **Minimum Beam Count**: 0 (Script works even if no beams are assigned to the curve yet).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCurveDimensions.mcr` from the file dialog.\n\n### Step 2: Select Curved Description\n```\nCommand Line: Select curved description\nAction: Click on one or more CurvedDescription entities in the model.\n```\n\n### Step 3: Place Schedule Text (Conditional)\n*If you selected exactly ONE curve:*\n```\nCommand Line: [Select Point]\nAction: Click in the model to place the schedule text block (containing count, style, and material).\n```\n\n*If you selected MULTIPLE curves:*\n```\nAction: The script automatically places the schedule text at the origin of each curve. No click is required.\n```\n\n### Step 4: Configuration\nThe Properties Palette will open automatically upon insertion, allowing you to adjust DimStyles, Text Height, and Colors before the script finalizes the geometry.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimstyle | Dropdown | *Current* | Selects the visual standard (arrows, ticks, font) from the drawing's available dimension styles. |\n| Text Height | Number | 40 | Sets the plotted height of the dimension text and schedule text (in mm). |\n| Color | Number | 1 | Defines the CAD color index (1-255) for the generated dimensions and text. |\n| Delta Dimensioning | Dropdown | None | Controls how intermediate dimensions (between grip points) are measured: **Parallel** (chord distance), **Perpendicular** (projected), or **None** (hidden). |\n| Chain Dimensioning | Dropdown | None | Controls how the total span dimension is measured: **Parallel**, **Perpendicular**, or **None**. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add specific custom items to the right-click context menu. Use the Properties Palette to modify settings. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Plot Scale**: The `Text Height` is in model units (mm). If you plot at 1:50 and want 2.5mm high text on paper, set this value to 125mm.\n- **Moving Text**: After insertion, select the script instance and drag the visible **Grip Point** (usually the text insertion point) to reposition the schedule summary without affecting the dimensions.\n- **Measurement Logic**: Use **Parallel** for direct chord measurements (useful for cutting lengths) or **Perpendicular** for projected widths/heights (useful for checking wall plates or roof spans).\n- **Auto-Update**: If you modify the geometry of the source `CurvedDescription` (e.g., drag its grips), the dimensions will automatically update to reflect the new shape.\n\n## FAQ\n- **Q: What does \"Invalid reference\" mean?**\n  A: This error appears if the selected entity is not a valid `CurvedDescription` or if the entity was deleted after the script was attached. Select a valid curved beam entity.\n  \n- **Q: Can I dimension multiple curves at once?**\n  A: Yes. During insertion, hold `Ctrl` or use a window selection to pick multiple CurvedDescriptions. The script will process all of them.\n\n- **Q: How do I change the arrow style?**\n  A: Change the `Dimstyle` property in the Properties Palette to a different style defined in your AutoCAD template (e.g., switching from \"Standard\" to \"Architectural\")."
      },
      "tokens_used": 5470,
      "error": null
    }
  }
}