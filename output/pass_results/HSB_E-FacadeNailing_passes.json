{
  "filename": "HSB_E-FacadeNailing.mcr",
  "status": "completed",
  "total_tokens": 64023,
  "processing_time": 602.0969035625458,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": 3,\n    \"minorVersion\": 4,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"This tsl adds nail-clusters to the element. The nail clusters are attached to a zone index. There are custom actions available to add and remove no nail areas. The areas are specified by a polyline. The tsl is dependent on this polyline. This means that if the polyline changes the tsl is recalculated.\",\n  \"versionHistory\": [\n    {\n      \"version\": \"2.00\",\n      \"date\": \"16.02.2011\",\n      \"author\": \"AS\",\n      \"changes\": \"Pilot version (base on tsl for Myresjohus)\"\n    },\n    {\n      \"version\": \"2.01\",\n      \"date\": \"16.02.2011\",\n      \"author\": \"AS\",\n      \"changes\": \"Add recalc trigger for recalc, add options to create an offset from one of the edges, or center line.\"\n    },\n    {\n      \"version\": \"2.02\",\n      \"date\": \"22.02.2011\",\n      \"author\": \"AS\",\n      \"changes\": \"Use referenceLine2 for zone 2\"\n    },\n    {\n      \"version\": \"2.03\",\n      \"date\": \"23.03.2011\",\n      \"author\": \"AS\",\n      \"changes\": \"Use solidWidth and -Length to calculate size\"\n    },\n    {\n      \"version\": \"2.04\",\n      \"date\": \"11.05.2011\",\n      \"author\": \"AS\",\n      \"changes\": \"Set up a nail area. Subtract openings and no nail areas from this area. Add the option to add and remove no nail areas by selecting plines. Set dependency on those selected plines.\"\n    },\n    {\n      \"version\": \"2.05\",\n      \"date\": \"29.09.2011\",\n      \"author\": \"AS\",\n      \"changes\": \"Assign to specific layer\"\n    },\n    {\n      \"version\": \"2.06\",\n      \"date\": \"23.11.2011\",\n      \"author\": \"AS\",\n      \"changes\": \"Add option to change the size of a brander at a sheet joint.\"\n    },\n    {\n      \"version\": \"2.07\",\n      \"date\": \"10.11.2014\",\n      \"author\": \"AS\",\n      \"changes\": \"Add branders to frame profile\"\n    },\n    {\n      \"version\": \"3.00\",\n      \"date\": \"22.04.2015\",\n      \"author\": \"AS\",\n      \"changes\": \"Add nailclusters per sheet.\"\n    },\n    {\n      \"version\": \"3.01\",\n      \"date\": \"17.12.2015\",\n      \"author\": \"AS\",\n      \"changes\": \"Add zone 0 as possible brander.\"\n    },\n    {\n      \"version\": \"3.02\",\n      \"date\": \"14.02.2019\",\n      \"author\": \"RP\",\n      \"changes\": \"Different check against the element, was causing issues on mirroring\"\n    },\n    {\n      \"version\": \"3.03\",\n      \"date\": \"25.06.2019\",\n      \"author\": \"RP\",\n      \"changes\": \"Wrong vector was copied with previous fix\"\n    },\n    {\n      \"version\": \"3.04\",\n      \"date\": \"25.06.2019\",\n      \"author\": \"AS\",\n      \"changes\": \"Correct vector again\"\n    }\n  ],\n  \"settings"
      },
      "tokens_used": 9382,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getElement() to select an element and casts it to ElementWallSF. It creates ElemNailCluster objects and adds them to the element via el.addTool(), which is a manufacturing/production operation. No usage of sd_ functions, _Viewport, or _kPaperSpace."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "ElementWallSF",
            "Sheet",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (Must be inserted on an ElementWallSF)",
          "requiredSettings": []
        }
      },
      "tokens_used": 7614,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getElement\",\n        \"promptOriginal\": \"Select an element\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sBranderZoneSeparator\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Brander\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Brander\",\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"nBranderZone\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Brander zone|\",\n      \"defaultValue\": 1,\n      \"inputType\": \"dropdown\",\n      \"options\": [\"4\", \"3\", \"2\", \"1\", \"6\", \"7\", \"8\", \"9\", \"0\"],\n      \"category\": \"Brander\",\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"dToEdgeBrander\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Distance to edge of branders\",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Brander\",\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sFacadeZone1Separator\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Facade zone 1\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Facade zone 1\",\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"nFacadeZone01\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Facade zone 1 (99 = no nail)|\",\n      \"defaultValue\": 2,\n      \"inputType\": \"dropdown\",\n      \"options\": [\"99\", \"5\", \"4\", \"3\", \"2\", \"7\", \"8\", \"9\"],\n      \"category\": \"Facade zone 1\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"nToolIndexFacade01\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Tool index facade 1|\",\n      \"defaultValue\": 4,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Facade zone 1\",\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dToEdgeFacade01\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Distance to edge of facade 1\",\n      \"defaultValue\": \"U(25)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Facade zone 1\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dDistBetweenNailsFacade01\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Distance between facade 1 nails (0 = 1 nail)\",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Facade zone 1\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sReferenceLineFacade01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Reference line facade 1|\",\n      \"defaultValue\": \"|Left (top for horizontal)|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\"|Left (top for horizontal)|\", \"|Center|\", \"|Right (bottom for horizontal)|\"],\n      \"category\": \"Facade zone 1\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"dReferenceDistanceFacade01\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Offset from reference line facade 1|\",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Facade zone 1\",\n      \"description\": null\n    },\n    {\n      \"index\": 7,\n      \"variable\": \"dChangeBranderSizeAtSheetJointTo\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Change brander size at sheet joint to|\",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Facade zone 1\",\n      \"description\": \"|Change the brander size at a sheet joint. Zero means that the brander size is not changed.|\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sFacadeZone02Separator\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Facade zone 2\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Facade zone 2\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"nFacadeZone02\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Facade zone 2 (99 = no nail)|\",\n      \"defaultValue\": 1,\n      \"inputType\": \"dropdown\",\n      \"options\": [\"99\", \"5\", \"4\", \"3\", \"2\", \"7\", \"8\", \"9\"],\n      \"category\": \"Facade zone 2\",\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"nToolIndexFacade02\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Tool index facade 2|\",\n      \"defaultValue\": 5,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Facade zone 2\",\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"dToEdgeFacade02\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Distance to edge of facade 2\",\n      \"defaultValue\": \"U(25)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Facade zone 2\",\n      \"description\": null\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"dDistBetweenNailsFacade02\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Distance between facade 2 nails (0 = 1 nail)\",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Facade zone 2\",\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sReferenceLineFacade02\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Reference line facade 2|\",\n      \"defaultValue\": \"|Left (top for horizontal)|\",\n      \"inputType\": \"dropdown\",\n     "
      },
      "tokens_used": 10991,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automates the calculation and placement of nail clusters (nailing patterns) on wall elements, attaching them to specific construction zones. It handles exclusions (no-nail areas) via polylines and allows manual nail addition/removal.\",\n    \"category\": \"Manufacturing/Production\",\n    \"typicalUseCase\": \"Used during detailing of prefabricated timber walls to define exactly where nail guns should attach sheathing or facade materials to the timber frame, ensuring nailing occurs at studs/plates while avoiding openings.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"nBranderZone\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"Identifies the 'Brander' (studs/intermediate columns) zone within the element construction. Nails or marks associated with this zone will target these structural members.\",\n      \"validRange\": \"0-9 (Integer)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Determines which structural members (GenBeams) are targeted as 'Brander' for nailing or visual representation.\"\n    },\n    {\n      \"name\": \"dToEdgeBrander\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Sets a fixed offset distance from the edge of the Brander (stud) where nailing is calculated or referenced from.\",\n      \"validRange\": \"0 - 200 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Adjusts the nailing position along the width of the stud relative to its edge.\"\n    },\n    {\n      \"name\": \"nFacadeZone01\",\n      \"technicalDefault\": \"2\",\n      \"businessMeaning\": \"Specifies the construction layer index for Facade Zone 1 (e.g., outer sheathing layer). Value 99 explicitly disables nailing for this zone.\",\n      \"validRange\": \"1-9 or 99\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Filters which sheets or layers in the wall element receive the 'Zone 1' nailing pattern.\"\n    },\n    {\n      \"name\": \"nToolIndexFacade01\",\n      \"technicalDefault\": \"4\",\n      \"businessMeaning\": \"Links the nail pattern to a specific manufacturing tool number (e.g., Nail Gun #4) in the production database/CAM machinery.\",\n      \"validRange\": \"1-99\",\n      \"unit\": \"ID\",\n      \"affectsOutput\": \"Determines which nail gun/tool is used for the nails generated in Facade Zone 1.\"\n    },\n    {\n      \"name\": \"dToEdgeFacade01\",\n      \"technicalDefault\": \"25\",\n      \"businessMeaning\": \"Defines the distance from the edge of the sheet or zone boundary where the first row of nails is placed.\",\n      \"validRange\": \"10 - 100 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Moves the nailing pattern closer to or further from the edges of the facade element.\"\n    },\n    {\n      \"name\": \"dDistBetweenNailsFacade01\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Sets the spacing between nails. A value of 0 indicates a single nail per stud/intersection rather than a pattern.\",\n      \"validRange\": \"0 (Single) or 50 - 600 mm (Spacing)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Changes the density of the nailing pattern. 0 results in one nail per target, >0 creates multiple nails along the member.\"\n    },\n    {\n      \"name\": \"sReferenceLineFacade01\",\n      \"technicalDefault\": \"Left (top for horizontal)\",\n      \"businessMeaning\": \"Selects the alignment reference for the nailing offset (e.g., align to left edge, center, or right edge of the element).\",\n      \"validRange\": \"Left, Center, Right\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Changes the starting side for the nailing offset calculation.\"\n    },\n    {\n      \"name\": \"dReferenceDistanceFacade01\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"An additional offset distance applied from the selected Reference Line.\",\n      \"validRange\": \"0 - 500 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Shifts the entire nailing grid or row by the specified amount.\"\n    },\n    {\n      \"name\": \"dChangeBranderSizeAtSheetJointTo\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Overrides the nailing configuration at sheet joints. If non-zero, it adjusts the brander/nailing width specifically where sheets meet.\",\n      \"validRange\": \"0 (Off) or 50 - 150 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Modifies nailing geometry at sheet boundaries to ensure secure connections at joints.\"\n    },\n    {\n      \"name\": \"nFacadeZone02\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"Specifies the construction layer index for Facade Zone 2 (e.g., inner sheathing or service cavity). Value 99 explicitly disables nailing for this zone.\",\n      \"validRange\": \"1-9 or 99\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Filters which sheets or layers in the wall element receive the 'Zone 2' nailing pattern.\"\n    },\n    {\n      \"name\": \"nToolIndexFacade02\",\n      \"technicalDefault\": \"5\",\n      \"businessMeaning\": \"Links the nail pattern to a specific manufacturing tool number (e.g., Nail Gun #5) for Facade Zone 2.\",\n      \"validRange\": \"1-99\",\n      \"unit\": \"ID\",\n      \"affectsOutput\": \"Determines which nail gun/tool is used for the nails generated in Facade Zone 2.\"\n    },\n    {\n      \"name\": \"dToEdgeFacade02\",\n      \"technicalDefault\": \"25\",\n      \"businessMeaning\": \"Defines the distance from the edge of the sheet/zone boundary for the first row of nails in Facade Zone 2.\",\n      \"validRange\": \"10 - 100 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Moves the Zone 2 nailing pattern relative to element edges.\"\n    },\n    {\n      \"name\": \"dDistBetweenNailsFacade02\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Sets the spacing between nails for Facade Zone 2. 0 implies a single nail per target.\",\n      \"validRange\": \"0 (Single) or 50 - 600 mm (Spacing)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Changes the density of the nailing pattern for Zone 2.\"\n    },\n    {\n      \"name\": \"sReferenceLineFacade02\",\n      \"technicalDefault\": \"Left (top for horizontal)\",\n      \"businessMeaning\": \"Selects the alignment reference for the nailing offset in Facade Zone 2.\",\n      \"validRange\": \"Left, Center, Right\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Changes the starting side for the Zone 2 nailing offset calculation.\"\n    },\n    {\n      \"name\": \"dReferenceDistanceFacade02\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"An additional offset distance applied from the selected Reference Line in Facade Zone 2.\",\n      \"validRange\": \"0 - 500 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Shifts the Zone 2 nailing grid by the specified amount.\"\n    },\n"
      },
      "tokens_used": 12375,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script is launched.",
          "Check if script is being inserted (_bOnInsert).",
          "Prompt user to 'Select an element'.",
          "Check if a catalog key is used (_kExecuteKey).",
          "If no catalog key, show the properties dialog (showDialog).",
          "Set 'ExecuteMode' to 1 and save to map, then return.",
          "On subsequent executions, check if Element is deleted or empty. If so, erase instance and exit.",
          "Verify Element is a valid ElementWallSF. If not, erase instance and exit.",
          "Determine coordinate system (csEl) and calculate adjusted Zone indices for Brander, Facade 1, and Facade 2.",
          "Parse Filter properties (Label, Material, BeamCode) into arrays.",
          "Check execution key to determine user action (Add/Remove No Nail Areas or Manual Nails).",
          "Execute specific logic for the selected action (Add Area, Remove Area, Add Nail, Remove Nail).",
          "Collect all GenBeams (studs/plates) and Sheets from the element.",
          "Filter beams based on Label, Material, and BeamCode properties.",
          "Filter sheets into Facade Zone 1 and Facade Zone 2 arrays based on zone index and additional filters.",
          "Calculate 'No Nail Areas' by subtracting element openings and user-defined polylines from the element envelope.",
          "Iterate through Brander beams to generate nail points.",
          "For each Brander, calculate start and end points based on reference line and offsets.",
          "Calculate specific nail points for Facade Zone 1 based on edge distance and nail spacing.",
          "Filter nails: Remove points inside 'No Nail Areas' and outside valid Nail Area profile.",
          "Repeat calculation and filtering for Facade Zone 2.",
          "If nails exist, display them as graphical points/grips in the CAD environment.",
          "Assign nails to Sheets: Group nails by specific Sheet objects they fall within.",
          "Create ElemNailCluster objects for each Sheet containing nails.",
          "Add ElemNailCluster tools to the Element."
        ],
        "conditionalBranches": [
          {
            "condition": "User selects 'Add no nail area to facade zone 1 or 2' via context menu",
            "path1": {
              "name": "Add No Nail Area Zone 1",
              "steps": [
                "Prompt 'Select a polyline'.",
                "Append polyline entity to script dependencies.",
                "Store polyline geometry in 'NoNailAreas' map tagged with Zone 1 index.",
                "Set ExecuteMode to 1 (Recalc)."
              ]
            },
            "path2": {
              "name": "Add No Nail Area Zone 2",
              "steps": [
                "Prompt 'Select a polyline'.",
                "Append polyline entity to script dependencies.",
                "Store polyline geometry in 'NoNailAreas' map tagged with Zone 2 index.",
                "Set ExecuteMode to 1 (Recalc)."
              ]
            }
          },
          {
            "condition": "User selects 'Remove no nail area' via context menu",
            "path1": {
              "name": "Remove Area",
              "steps": [
                "Prompt 'Select a point inside a no nail area'.",
                "Check point against all stored No Nail polylines.",
                "If point is inside a polyline, remove entry from map and delete polyline entity.",
                "Set ExecuteMode to 1 (Recalc)."
              ]
            }
          },
          {
            "condition": "Nail Spacing (dDistBetweenNailsFacade01/02) is greater than 0",
            "path1": {
              "name": "Pattern Nailing",
              "steps": [
                "Calculate start and end nail positions along the beam.",
                "Loop to generate multiple nail points at specified spacing intervals.",
                "Check every point against valid nail area and exclusions."
              ]
            },
            "path2": {
              "name": "Single Nail",
              "steps": [
                "Calculate a single nail position based on reference line and offset.",
                "Check point against valid nail area and exclusions."
              ]
            }
          },
          {
            "condition": "User uses 'Add nail to facade zone 1' or '2' context menu",
            "path1": {
              "name": "Manual Add Nail",
              "steps": [
                "Prompt user to select a point.",
                "Validate point is within the calculated valid nail area for that zone.",
                "If invalid, report warning 'There is no frame behind this nail.' and exit.",
                "If valid, add point to global point array (_PtG) and map with Zone index."
              ]
            }
          },
          {
            "condition": "User uses 'Remove nail' context menu",
            "path1": {
              "name": "Manual Remove Nail",
              "steps": [
                "Prompt user to select a point near a nail.",
                "Iterate through all existing nail points.",
                "Find point within 5mm tolerance of selection.",
                "Remove found point from array and update Map indices.",
                "Re-index remaining points to ensure Map keys match array indices."
              ]
            }
          },
          {
            "condition": "Change Brander Size at Sheet Joint is non-zero (dChangeBranderSizeAtSheetJointTo)",
            "path1": {
              "name": "Modify Brander Size at Joint",
              "steps": [
                "Check if current nail position is near a sheet joint.",
                "If near joint, use the specific size defined in 'dChangeBranderSizeAtSheetJointTo' for collision/area calculations instead of standard beam size."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element validity after selection",
            "errorMessage": "Implicitly handled. Script erases instance if element is invalid or deleted.",
            "recovery": "User must re-insert the script on a valid ElementWallSF."
          },
          {
            "check": "Manual nail location validity",
            "errorMessage": "There is no frame behind this nail.",
            "recovery": "User must select a point that lies within the calculated valid nailing area (which accounts for studs and excludes openings)."
          },
          {
            "check": "Zone Index Logic (nZn > 5)",
            "errorMessage": "None (Corrected internally)",
            "recovery": "N/A. Script automatically converts indices > 5 (e.g. 7, 8, 9) to negative equivalent or specific offset logic."
          },
          {
            "check": "Map and Point Array consistency",
            "errorMessage": "Internal error! Indexes don't match grippoints",
            "recovery": "Report Error. User likely needs to contact support or reset the script instance."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Add No Nail Area",
            "how": "Context Menu -> Select Polyline",
            "effect": "Adds the polyline as an exclusion zone. Recalculates nails to avoid this area. Sets dependency on the polyline."
          },
          {
            "action": "Remove No Nail Area",
            "how": "Context Menu -> Select Point inside area",
            "effect": "Removes the exclusion zone. Deletes the polyline entity. Recalculates nails."
          },
          {
            "action": "Add Nail (Manual)",
            "how": "Context Menu -> Select Point",
            "effect": "Adds a single nail at the specific location to the designated Facade Zone."
          },
          {
            "action": "Remove Nail",
            "how": "Context Menu -> Select Point near nail",
            "effect": "Removes the specific nail point from the element."
          },
          {
            "action": "Modify Properties",
            "how": "Properties Palette (OPM)",
            "effect": "Changing Zone indices, Tool indices, Offsets, or Spacing triggers a recalculation and updates the nail pattern."
          },
          {
            "action": "Filter Beams/Sheets",
            "how": "Properties Palette (Filter Label/Material/BeamCode)",
            "effect": "Restricts nailing to only beams/sheets matching the specified criteria."
          }
        ]
      },
      "tokens_used": 13594,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-FacadeNailing.mcr\n\n## Overview\nThis script automates the calculation and placement of nail clusters on timber wall elements based on specific construction zones (e.g., studs or sheathing layers). It handles automatic nailing patterns, allows for exclusion zones (no-nail areas) using polylines, and provides tools to manually add or remove individual nails.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Must be inserted on an ElementWallSF. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: An existing Wall Element (`ElementWallSF`) containing construction layers (Zones) and structural members (GenBeams).\n- **Minimum beam count**: 0 (Script runs on element validity, though nails require structural members).\n- **Required settings**: Standard hsbCAD environment with defined construction zones.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_E-FacadeNailing.mcr`\n\n### Step 2: Select Element\n```\nCommand Line: Select an element\nAction: Click on the desired wall element in the model to which you want to apply nailing.\n```\n\n### Step 3: Configure Properties\nAfter insertion, select the script instance in the model and open the **Properties Palette** to configure zones, spacing, and offsets.\n\n## Properties Panel Parameters\n\n### Brander Settings\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Brander zone | dropdown | 1 | Selects the construction zone index for studs/intermediate columns to be nailed. |\n| Distance to edge of branders | number | 0 mm | Sets the offset distance from the edge of the stud where the nail is calculated. |\n\n### Facade Zone 1 Settings\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Facade zone 1 (99 = no nail) | dropdown | 2 | Sets the construction layer index for the first facade layer. Set to 99 to disable nailing for this zone. |\n| Tool index facade 1 | number | 4 | Assigns the specific nail gun/tool ID from the production database for this zone. |\n| Distance to edge of facade 1 | number | 25 mm | Distance from the edge of the sheet/zone to the first row of nails. |\n| Distance between facade 1 nails | number | 0 mm | Spacing between nails. **0** places a single nail per stud; >0 creates a pattern. |\n| Reference line facade 1 | dropdown | Left (top for horizontal) | Aligns the nailing offset to the Left, Center, or Right (or Top/Bottom for horizontal). |\n| Offset from reference line facade 1 | number | 0 mm | Additional shift distance applied from the selected reference line. |\n| Change brander size at sheet joint to | number | 0 mm | If non-zero, overrides the stud width calculation specifically at sheet joints. |\n\n### Facade Zone 2 Settings\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Facade zone 2 (99 = no nail) | dropdown | 1 | Sets the construction layer index for the second facade layer. Set to 99 to disable. |\n| Tool index facade 2 | number | 5 | Assigns the nail gun/tool ID for the second facade zone. |\n| Distance to edge of facade 2 | number | 25 mm | Distance from the edge of the sheet/zone to the first row of nails. |\n| Distance between facade 2 nails | number | 0 mm | Spacing between nails (0 = single nail). |\n| Reference line facade 2 | dropdown | Left (top for horizontal) | Alignment reference for the nailing offset in Zone 2. |\n| Offset from reference line facade 2 | number | 0 mm | Additional shift distance from the reference line in Zone 2. |\n\n## Right-Click Menu Options\nSelect the script instance in the drawing and right-click to access these custom actions:\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add no nail area to facade zone 1 (or 2) | Prompts you to select a polyline. The script creates an exclusion zone inside this polyline where no nails will be placed. The nails will update automatically if the polyline is modified. |\n| Remove no nail area | Prompts you to select a point inside an existing exclusion area to remove it. |\n| Add nail to facade zone 1 (or 2) | Prompts you to click a specific point on the element to manually add a single nail to the designated zone. |\n| Remove nail | Prompts you to click near an existing nail to remove it. |\n\n## Settings Files\n- **Filename**: None specific (Uses Element Construction Data)\n- **Location**: N/A\n- **Purpose**: The script relies on the hsbCAD Element's construction setup (Zones) and standard material catalogs rather than an external settings file.\n\n## Tips\n- **Exclusion Zones**: Draw closed polylines around areas like openings or vents where nailing should be avoided, then use the \"Add no nail area\" right-click option.\n- **Single Nailing**: For simple connections, leave the \"Distance between nails\" parameter set to **0** to place exactly one nail per stud/intersection.\n- **Manual Override**: Use the right-click \"Add nail\" option if the automatic calculation misses a specific structural point that requires nailing.\n- **Sheet Joints**: Use the \"Change brander size at sheet joint to\" property to ensure nails are placed correctly where sheathing sheets meet.\n\n## FAQ\n- **Q: How do I stop nailing in a specific area, like around a window?**\n  - **A:** Draw a polyline around the window in the CAD model. Right-click the script instance, select \"Add no nail area,\" and pick that polyline.\n- **Q: What does the \"99\" value mean in the Facade Zone settings?**\n  - **A:** Setting the zone index to **99** effectively turns off nailing for that specific facade zone.\n- **Q: The script says \"There is no frame behind this nail\" when I try to add one manually. Why?**\n  - **A:** The point you clicked is outside the valid nailing area (e.g., over an opening or outside the sheet boundary). Ensure you click directly over a structural stud or valid sheet area."
      },
      "tokens_used": 10067,
      "error": null
    }
  }
}