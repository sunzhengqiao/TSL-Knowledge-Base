{
  "filename": "hsb_RemoveInsulation.mcr",
  "status": "completed",
  "total_tokens": 21105,
  "processing_time": 306.0133717060089,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "17.02.2011",
            "author": "Chirag Sawjani (csawjani@itw-industry.com)",
            "changes": "Release"
          },
          {
            "version": "1.1",
            "date": "08.08.2011",
            "author": "Chirag Sawjani (csawjani@itw-industry.com)",
            "changes": "Added Properties to select zone and deletion will only occur if material is called Insulation"
          },
          {
            "version": "1.2",
            "date": "08.08.2011",
            "author": "",
            "changes": "Bugfix with the zone"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3893,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity to select ElementWallSF, manipulates Element, Sheet, and TslInst objects directly via dbErase(). No usage of _Viewport, sd_*, or ShopDrawing specific prefixes (#Type E with _Entity[])."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D Model)",
          "requiredSettings": []
        }
      },
      "tokens_used": 1683,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one or More Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 1,
            "variable": "nZones",
            "type": "PropInt",
            "displayName": "Sheet Zone",
            "defaultValue": "9",
            "inputType": "dropdown",
            "options": [
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "10"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4006,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the removal of insulation materials and associated insulation scripts (TH_Insulation, hsb_Insulation) from specific wall elements within a designated sheet zone.",
          "category": "ModelMaintenance/Editing",
          "typicalUseCase": "A user needs to strip insulation layers or insulation-specific TSL instances from selected wall elements during the design phase, specifically targeting a predefined layer zone, without manually deleting every single sheet or script instance."
        },
        "parameters": [
          {
            "name": "nZones",
            "technicalDefault": "9",
            "businessMeaning": "Identifies the specific construction layer (Sheet Zone) within the wall element where the script should look for insulation to remove. In hsbCAD, sheet zones represent different layers of a wall assembly (e.g., interior finish, framing, exterior sheathing).",
            "validRange": "1 to 10",
            "unit": "Index (Integer)",
            "affectsOutput": "Determines which physical material layer is scanned. If the insulation exists in Zone 5 but the parameter is set to 9, the script will not find or delete it."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "The user selects a value for 'nZones'",
            "effect": "The script maps the UI selection (1-10) to the internal calculation logic (nRealZones) and targets only that specific layer during the deletion loop.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Deletion",
            "description": "Removes Sheet entities where the material is named exactly 'Insulation' and TslInst entities where the script name is 'TH_Insulation' or 'hsb_Insulation'.",
            "appliedTo": "Selected Wall Elements (ElementWallSF) within the specified Sheet Zone."
          }
        ]
      },
      "tokens_used": 2606,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script initialization and variable declaration",
          "Properties are defined (Sheet Zone with default 9)",
          "Check if instance is just created in DB (_bOnDbCreated): if true, load properties from catalog",
          "Check if script is in Insert mode (_bOnInsert)",
          "[Insert Mode Check] Is insertCycleCount > 1?",
          "[Yes] Path: Erase the duplicate instance and terminate immediately",
          "[No] Path: Show dialog, prompt user to select Elements (ElementWallSF)",
          "Store selected elements in internal array _Element",
          "Post-Insertion/Execution Phase: Check if _Element array is empty",
          "[Empty Check] Is _Element.length() == 0?",
          "[Yes] Path: Erase instance and terminate",
          "[No] Path: Iterate through each Element in _Element",
          "For each Element: Map 'nZones' selection (1-10) to internal 'nRealZones' index (1-5, -1 to -5)",
          "Retrieve all Sheets within the calculated Zone for the current Element",
          "Iterate through Sheets: check if Sheet material equals 'Insulation'",
          "Match found: Execute dbErase() on the Sheet",
          "Retrieve all TslInst (script instances) associated with the Element",
          "Iterate through TslInsts: check if ScriptName is 'TH_Insulation' or 'hsb_Insulation'",
          "Match found: Execute dbErase() on the TslInst",
          "Complete loop for all Elements",
          "Erase the script instance itself (cleanup)",
          "Execution finished"
        ],
        "conditionalBranches": [
          {
            "condition": "_bOnInsert is true (Script is being placed)",
            "path1": {
              "name": "Duplicate Insertion Cycle",
              "steps": [
                "Check if insertCycleCount() > 1",
                "Erase instance",
                "Return (Stop)"
              ]
            },
            "path2": {
              "name": "First Insertion Cycle",
              "steps": [
                "Show properties dialog",
                "Prompt user to select Elements (PrEntity)",
                "Store Elements in _Element",
                "Return (Stop)"
              ]
            }
          },
          {
            "condition": "_Element.length() == 0 (No elements selected)",
            "path1": {
              "name": "No Selection",
              "steps": [
                "Detect empty selection",
                "Erase instance",
                "Return (Stop)"
              ]
            },
            "path2": {
              "name": "Valid Selection",
              "steps": [
                "Loop through selected Elements",
                "Process insulation removal logic",
                "Erase instance on completion"
              ]
            }
          },
          {
            "condition": "Sheet found in specified Zone",
            "path1": {
              "name": "Insulation Material Match",
              "steps": [
                "Check if sh.material() == 'Insulation'",
                "Delete Sheet (dbErase)"
              ]
            },
            "path2": {
              "name": "Other Material",
              "steps": [
                "Skip Sheet",
                "Continue to next Sheet"
              ]
            }
          },
          {
            "condition": "TslInst found on Element",
            "path1": {
              "name": "Specific Insulation Script Match",
              "steps": [
                "Check if ScriptName is 'TH_Insulation' OR 'hsb_Insulation'",
                "Delete TslInst (dbErase)"
              ]
            },
            "path2": {
              "name": "Other Script",
              "steps": [
                "Skip TslInst",
                "Continue to next TslInst"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of selected Elements after PrEntity prompt",
            "errorMessage": "None explicit to user, but instance is deleted silently.",
            "recovery": "User must re-run the command and ensure at least one ElementWallSF is selected."
          },
          {
            "check": "Insertion cycle count",
            "errorMessage": "None explicit to user.",
            "recovery": "System automatically handles duplicate instances by erasing them."
          },
          {
            "check": "Element validity (el.bIsValid()) during iteration",
            "errorMessage": "None explicit to user.",
            "recovery": "Script skips invalid elements automatically using 'continue'."
          },
          {
            "check": "Material Name matching (Case Sensitive)",
            "errorMessage": "None explicit to user.",
            "recovery": "Insulation must be named exactly 'Insulation' (capital I) to be removed."
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 4192,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_RemoveInsulation.mcr\n\n## Overview\nAutomates the removal of insulation materials and associated insulation scripts (TH_Insulation, hsb_Insulation) from selected wall elements within a designated sheet zone.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for selecting wall elements. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required entities**: Wall Elements (ElementWallSF).\n- **Minimum beam count**: 0.\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_RemoveInsulation.mcr`\n\n### Step 2: Configure Sheet Zone\nBefore selecting elements, you may need to set the target layer.\n```\nCommand Line: [N/A]\nAction: If the Properties Palette does not open automatically, select the script instance in the model (if visible) or check the command line settings. In the Properties Palette, locate the \"Sheet Zone\" parameter and select the layer number (1-10) where the insulation is located.\n```\n\n### Step 3: Select Elements\n```\nCommand Line: Select one or More Elements\nAction: Click on the wall elements from which you want to remove insulation. Press Enter to confirm selection.\n```\n\n### Step 4: Execution\n```\nCommand Line: [N/A]\nAction: The script automatically scans the selected walls, removes the insulation materials/scripts in the specified zone, and then deletes itself from the drawing.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Sheet Zone | dropdown | 9 | Select the specific construction layer (Zone 1-10) within the wall assembly to scan for insulation. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom right-click menu options are defined for this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Material Name**: The script only removes sheets where the material name is exactly \"Insulation\" (case-sensitive). If your material is named \"Insul\" or \"Mineral Wool\", it will not be deleted.\n- **Self-Deleting**: This script acts as a \"command\" rather than a permanent object. It will automatically remove itself from the drawing after it finishes processing to keep your project clean.\n- **Zone Mapping**: The dropdown offers zones 1-10. These correspond to the construction layers defined in your wall catalogs (e.g., interior finish, framing, sheathing).\n\n## FAQ\n- **Q: I ran the script, but the insulation is still there. Why?**\n- **A:** Check two things: 1) Ensure the \"Sheet Zone\" property matches the actual layer where the insulation sheet is placed. 2) Ensure the material name of the sheet is spelled exactly \"Insulation\".\n- **Q: Where did the script icon go after I used it?**\n- **A:** The script is designed to delete itself immediately after execution. This is normal behavior. You do not need to delete it manually.\n- **Q: Does this work on beams?**\n- **A:** No, this script is designed specifically for Wall Elements (`ElementWallSF`)."
      },
      "tokens_used": 4725,
      "error": null
    }
  }
}