{
  "filename": "HSB_E-OpeningBlock.mcr",
  "status": "completed",
  "total_tokens": 30849,
  "processing_time": 265.88598823547363,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 3,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl inserts a block in an openingSF",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "27.09.2016",
            "author": null,
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "03.03.2017",
            "author": null,
            "changes": "Add option to specify a subfolder."
          },
          {
            "version": "1.02",
            "date": "03.03.2017",
            "author": null,
            "changes": "Add extension while searching for file."
          },
          {
            "version": "1.03",
            "date": "03.03.2017",
            "author": null,
            "changes": "Assign tsl to element and draw block on layer and zone."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4143,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly creates instances using _kModelSpace in dbCreate(). Uses assignToElementGroup() which is typical for Model Space visualization scripts. No usage of _Viewport or _kPaperSpace. No 'sd_' or 'Multipage' filename prefix. The script runs logic to draw blocks relative to Element coordinates in the model."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "OpeningSF"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "DWG block files located in _kPathDwg (drawing path) matching opening descriptions"
          ]
        }
      },
      "tokens_used": 4004,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select elements| |<Enter> to select openings|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select openings|",
              "condition": "selectedElements.length() < 1",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowPropertiesDialog",
            "trigger": "_bOnInsert && (_kExecuteKey == \"\" || catalogNames.find(_kExecuteKey) == -1)",
            "title": null,
            "dataSource": "Properties Palette",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "subFolderProp",
            "type": "PropString",
            "displayName": "|Drawing subfolder|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "|Specifies the subfolder of the drawing location.|This location is used to search for the opening blocks|"
          },
          {
            "index": 0,
            "variable": "zoneIndexProp",
            "type": "PropInt",
            "displayName": "|Zone index|",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              0,
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "zoneLayer",
            "type": "PropString",
            "displayName": "|Layer|",
            "defaultValue": "Tooling",
            "inputType": "dropdown",
            "options": [
              "Tooling",
              "Information",
              "Zone",
              "Element"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5721,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the insertion of detailed 2D symbols (CAD blocks) into wall or floor openings based on the opening's description code.",
          "category": "ShopDrawing / Annotation",
          "typicalUseCase": "Used during the detailing phase to automatically place specific window, door, or penetration symbols into 2D production drawings, ensuring they are on the correct layer and zone for filtering."
        },
        "parameters": [
          {
            "name": "subFolderProp",
            "technicalDefault": "",
            "businessMeaning": "Specifies a specific subdirectory within the project's drawing folder where the DWG symbol files are stored, allowing for organized file management.",
            "validRange": "Any valid folder name existing in the _kPathDwg directory (e.g., 'Windows', 'Doors')",
            "unit": "String",
            "affectsOutput": "Determines the file path searched for the matching block. If the path is incorrect, the script fails to find the block and displays an error text instead of the symbol."
          },
          {
            "name": "zoneIndexProp",
            "technicalDefault": 0,
            "businessMeaning": "Assigns the drawing symbol to a specific numerical 'Zone' used for controlling visibility in different drawing stages or views (e.g., Transport zone vs Assembly zone).",
            "validRange": "0 to 10",
            "unit": "Index",
            "affectsOutput": "Controls the entity group index. If the current drawing view or export filter excludes this zone index, the symbol will be hidden."
          },
          {
            "name": "zoneLayer",
            "technicalDefault": "Tooling",
            "businessMeaning": "Categorizes the symbol into a high-level functional layer, determining its display color and general purpose (e.g., Machining info vs General info).",
            "validRange": "Tooling, Information, Zone, Element",
            "unit": "Category",
            "affectsOutput": "Sets the Entity Group character code (T, I, Z, E) and visual properties (color/linetype) associated with that layer in the CAD environment."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Opening Description (OpeningSF)",
            "effect": "Determines which block file is loaded.",
            "cascade": [
              "Block Name",
              "File Path Resolution"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Graphical Block / Annotation",
            "description": "A 2D DWG block inserted at the bottom-left corner of the opening, oriented to match the element's coordinate system.",
            "appliedTo": "The parent Element (visualized in ModelSpace relative to the OpeningSF)."
          }
        ]
      },
      "tokens_used": 5388,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script is launched via insert command.",
          "2. Check if inserting via Execute Key (catalog). If not, show properties dialog.",
          "3. Prompt user to 'Select elements'.",
          "4. If Elements selected: Iterate through elements, collect all WallSF openings.",
          "5. If no Elements selected: Prompt user to 'Select openings' directly.",
          "6. Iterate through all collected Openings.",
          "7. For each opening: Create a new instance of the script attached to the Element and Opening.",
          "8. Original instance self-destructs (eraseInstance).",
          "9. New instance initializes: Validates it has exactly 2 entities (Element + Opening).",
          "10. Calculates coordinate system and Reference Point of the opening (bottom-left).",
          "11. Determines Block Name from Opening Description (token 0).",
          "12. Constructs full file path using _kPathDwg + optional subFolderProp + Block Name + '.dwg'.",
          "13. Checks if Block is already loaded in memory or if file exists on disk.",
          "14. Inserts Block at Reference Point (or error text) with Layer/Zone settings.",
          "15. Assigns visual properties to specific Element Group."
        ],
        "conditionalBranches": [
          {
            "condition": "Is this the initial insert cycle?",
            "path1": {
              "name": "Yes (Cycle Count <= 1)",
              "steps": [
                "Show Dialog (if no Execute Key)",
                "Prompt for Entities",
                "Generate Child Instances",
                "Erase Self"
              ]
            },
            "path2": {
              "name": "No (Cycle Count > 1)",
              "steps": [
                "Erase Instance immediately",
                "Return (Exit Script)"
              ]
            }
          },
          {
            "condition": "User Selection Method",
            "path1": {
              "name": "Elements Selected",
              "steps": [
                "Extract openings from selected WallSF elements",
                "Proceed to instance creation"
              ]
            },
            "path2": {
              "name": "No Elements Selected",
              "steps": [
                "Trigger second prompt: 'Select openings'",
                "Get explicit OpeningSF entities",
                "Proceed to instance creation"
              ]
            }
          },
          {
            "condition": "Block Availability Check",
            "path1": {
              "name": "Block Found (Memory or Disk)",
              "steps": [
                "Load Block definition",
                "Draw Block at calculated position",
                "Apply Zone/Layer settings"
              ]
            },
            "path2": {
              "name": "Block Not Found",
              "steps": [
                "Display Text: 'Cannot find [FilePath]'",
                "Apply Zone/Layer settings to Text"
              ]
            }
          },
          {
            "condition": "Entity Validation",
            "path1": {
              "name": "Valid (Element + Opening)",
              "steps": [
                "Continue processing geometry"
              ]
            },
            "path2": {
              "name": "Invalid Entity Count",
              "steps": [
                "Report Notice: 'Opening block cannot be inserted.'",
                "Erase Instance"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Set Count (_Entity.length)",
            "errorMessage": "Opening block cannot be inserted.",
            "recovery": "Ensure the script instance is correctly linked to both an Element and an OpeningSF entity. Check selection logic."
          },
          {
            "check": "OpeningSF Validity",
            "errorMessage": "Invalid opening selected.",
            "recovery": "Ensure the target opening exists and is valid in the model structure."
          },
          {
            "check": "DWG File Existence",
            "errorMessage": "Displays text: 'Cannot find [Path to File]'",
            "recovery": "Verify the opening description matches a DWG filename. Check subFolderProp property. Ensure file exists in _kPathDwg (and subfolder if specified)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Subfolder",
            "how": "OPM (Object Properties Palette)",
            "effect": "Updates the search path for the block, triggering a recalc to find the DWG in the new location."
          },
          {
            "action": "Change Layer/Zone",
            "how": "OPM",
            "effect": "Updates the Entity Group assignment, changing the visual layer (Color/Linetype) and export filter behavior."
          },
          {
            "action": "Refresh Geometry",
            "how": "Model Update / Recalculate",
            "effect": "Re-reads the Opening Description and file path. If the DWG file changed on disk or the opening description changed, the block will update."
          }
        ]
      },
      "tokens_used": 5596,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-OpeningBlock.mcr\n\n## Overview\nThis script automatically inserts 2D CAD blocks (symbols) into wall or floor openings (`OpeningSF`) based on the opening's description code. It is typically used to visualize specific symbols for windows, doors, or penetrations in the model on assigned layers and zones.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script inserts the block into the 3D model geometry relative to the element. |\n| Paper Space | No | Not designed for layout or sheet views. |\n| Shop Drawing | No | This is a model-space visualization tool, not a 2D shop drawing generator. |\n\n## Prerequisites\n- **Required Entities**: An `Element` (Wall or Floor) and an `OpeningSF` (Opening).\n- **External Files**: DWG block files must exist in the project's drawing path (`_kPathDwg`). The filename must match the opening's description.\n- **Minimum Beam Count**: 0.\n\n## Usage Steps\n\n### Step 1: Launch Script\nRun the command `TSLINSERT` in the command line and select `HSB_E-OpeningBlock.mcr` from the list.\n\n### Step 2: Configure Properties (Optional)\nIf the Properties Palette does not open automatically, double-click the script name or press `Enter` without selecting anything.\n- Set the **Drawing subfolder** if your blocks are organized in folders (e.g., \"Windows\").\n- Set the **Zone index** and **Layer** as required for your project standards.\n\n### Step 3: Select Elements or Openings\nThe command line will prompt:\n```\nSelect elements <Enter> to select openings:\n```\n**Option A:** Click on the Wall or Floor elements containing the openings you wish to process. The script will find all openings inside those elements.\n**Option B:** Press `Enter`. The prompt will change to:\n```\nSelect openings:\n```\nClick directly on the specific `OpeningSF` entities you want to tag. Press `Enter` to finish selection.\n\n### Step 4: Automatic Insertion\nThe script will automatically attach to the selected elements/openings and insert the corresponding block at the bottom-left corner of the opening.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Drawing subfolder | Text | \"\" | Specifies a subdirectory inside the project drawing folder (`_kPathDwg`) where the DWG files are stored (e.g., \"MySymbols\"). Leave empty if files are in the root drawing folder. |\n| Zone index | Number | 0 | Sets the zone index (0-10) for the symbol. Used to filter visibility in different views or export stages. |\n| Layer | Dropdown | Tooling | Sets the display category for the symbol. Options: Tooling, Information, Zone, Element. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add custom items to the right-click menu. Standard options like Erase or Recalculate are available. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A (Script relies on external DWG files found in `_kPathDwg`)\n\n## Tips\n- **Naming Convention**: Ensure the name of your DWG block file matches the *Description* field of your opening in hsbCAD. The script looks at the first part of the description to find the file.\n- **Troubleshooting Missing Blocks**: If the script displays text saying \"Cannot find [Path]\", check the file path in the properties, verify the DWG file exists, and ensure the file extension is lowercase `.dwg`.\n- **Bulk Processing**: You can select multiple walls/floors at once (Option A in Step 3) to apply symbols to all openings within them rapidly.\n- **Positioning**: The block is inserted at the bottom-left reference point of the opening, oriented to the element's coordinate system.\n\n## FAQ\n- **Q: Why do I see the text \"Cannot find...\" instead of my symbol?**\n  A: The script cannot locate the DWG file. Check that the filename matches the opening description exactly. If you used the \"Drawing subfolder\" property, ensure the folder name is spelled correctly and exists in your drawing path.\n\n- **Q: Can I rotate the block?**\n  A: The script orients the block based on the element's coordinate system. To change orientation, you would need to edit the source DWG block file or the element's rotation.\n\n- **Q: What happens if I change the Layer property?**\n  A: The symbol will move to the new entity group (e.g., from \"Tooling\" to \"Information\"), which may change its color and visibility depending on your layer filters."
      },
      "tokens_used": 5997,
      "error": null
    }
  }
}