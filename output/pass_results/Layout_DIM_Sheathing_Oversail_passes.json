{
  "filename": "Layout_DIM_Sheathing_Oversail.mcr",
  "status": "completed",
  "total_tokens": 34118,
  "processing_time": 218.4510064125061,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5274,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Viewport selection via getViewport(), usage of _Viewport array, explicit Coordinate System transformations between Model Space (ms2ps) and Paper Space (ps2ms), and dimension object transformation to Paper Space before drawing."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Sheet",
            "Beam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "A Paper Space Layout with an active Viewport linked to a Model Space Element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 4137,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select a viewport, you can add others later on with the HSB_LINKTOOLS command.",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strDir",
            "type": "PropString",
            "displayName": "Direction",
            "defaultValue": "Horizontal",
            "inputType": "dropdown",
            "options": [
              "Horizontal",
              "Vertical"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nZone",
            "type": "PropInt",
            "displayName": "Zone index",
            "defaultValue": 1,
            "inputType": "dropdown",
            "options": [
              -5,
              -4,
              -3,
              -2,
              -1,
              1,
              2,
              3,
              4,
              5
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension Style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sDeltaOnTop",
            "type": "PropString",
            "displayName": "Side of delta dimensioning",
            "defaultValue": "Above",
            "inputType": "dropdown",
            "options": [
              "Above",
              "Below"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffsetFromEl",
            "type": "PropDouble",
            "displayName": "Offset From Element",
            "defaultValue": "150 mm",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "strTextDirD",
            "type": "PropString",
            "displayName": "Delta text direction",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": [
              "None",
              "Parallel",
              "Perpendicular"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nDimColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6322,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the dimensioning of sheathing oversails in paper space layout views. It calculates and draws dimensions indicating how much sheathing material extends past the timber frame structure.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used during detailing or drawing creation to clearly annotate the overhang of wall/floor sheathing relative to the underlying timber frame in a specific view."
        },
        "parameters": [
          {
            "name": "strDir",
            "technicalDefault": "Horizontal",
            "businessMeaning": "Sets the orientation of the dimension line relative to the element coordinate system.",
            "validRange": "Horizontal, Vertical",
            "unit": "enum",
            "affectsOutput": "Switches the dimension line alignment between the element's X-axis (Horizontal) and Y-axis (Vertical)."
          },
          {
            "name": "nZone",
            "technicalDefault": "5",
            "businessMeaning": "Specifies the construction zone (layer) from which to retrieve the sheathing geometry for dimensioning.",
            "validRange": "-5 to 5",
            "unit": "index",
            "affectsOutput": "Determines which set of sheathing sheets are analyzed. Changing this may result in no dimensions being drawn if the zone contains no sheathing."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "null",
            "businessMeaning": "Selects the visual style (text height, arrow style, scale) for the dimension object.",
            "validRange": "Any standard AutoCAD dimension style defined in the drawing.",
            "unit": "string",
            "affectsOutput": "Changes the visual appearance of the dimension text and lines in the layout view."
          },
          {
            "name": "sDeltaOnTop",
            "technicalDefault": "Above",
            "businessMeaning": "Controls the vertical position of the dimension text relative to the dimension line (above or below).",
            "validRange": "Above, Below",
            "unit": "enum",
            "affectsOutput": "Moves the dimension text to the specified side of the dimension line."
          },
          {
            "name": "dOffsetFromEl",
            "technicalDefault": "150 mm",
            "businessMeaning": "Sets the distance between the structural element (frame) and the dimension line in the layout.",
            "validRange": "50 mm to 500 mm (depending on drawing scale and clutter)",
            "unit": "mm",
            "affectsOutput": "Moves the dimension line closer to or further from the element in Paper Space."
          },
          {
            "name": "strTextDirD",
            "technicalDefault": "None",
            "businessMeaning": "Defines the orientation of the dimension text (e.g., aligned with the dimension line or rotated 90 degrees).",
            "validRange": "None, Parallel, Perpendicular",
            "unit": "enum",
            "affectsOutput": "Rotates the text inside the dimension block."
          },
          {
            "name": "nDimColor",
            "technicalDefault": "1",
            "businessMeaning": "Sets the CAD color index for the dimension lines and text.",
            "validRange": "1 to 255 (Standard AutoCAD colors)",
            "unit": "index",
            "affectsOutput": "Changes the display color of the generated dimensions."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing strDir (Direction)",
            "effect": "Changes which element axis (X or Y) is used to calculate perpendicular beams and projection points.",
            "cascade": []
          },
          {
            "trigger": "Changing nZone (Zone index)",
            "effect": "Filters the element's sheets collection. If the zone has no sheets, dimensions disappear.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Dim (Dimension)",
            "description": "A dimension object drawn in Paper Space indicating the distance the sheathing extends past the start or end of the timber frame.",
            "appliedTo": "Paper Space Layout (associated with a specific Element/Viewport)"
          }
        ]
      },
      "tokens_used": 4931,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch: User inserts script into Paper Space.",
          "2. Initial Dialog: Property dialog displays once (showDialogOnce).",
          "3. Point Input: User selects an insertion point via getPoint().",
          "4. Viewport Selection: User selects a Viewport via getViewport().",
          "5. Initialization: Viewport is stored, and script performs initial calculation.",
          "6. Coordinate System Setup: Script calculates transformation matrices between Model Space (MS) and Paper Space (PS).",
          "7. Element Retrieval: Script validates the Viewport contains a valid hsbCAD Element.",
          "8. Dimension Line Definition: Based on 'Direction' (Horizontal/Vertical), the script defines the dimension line location (Offset from Element) and orientation in PS and MS.",
          "9. Frame Boundary Calculation: Script collects all beams, filters those perpendicular to the dimension line, and finds the start/end points of the structural frame.",
          "10. Sheathing Boundary Calculation: Script collects all sheets from the specified 'Zone index' and finds their start/end points projected onto the dimension line.",
          "11. Comparison: Script calculates the distance (vector) between the frame edges and sheathing edges at both start and end positions.",
          "12. Condition Check (Start): If sheathing extends past the frame start by > 1mm, a dimension is generated.",
          "13. Condition Check (End): If sheathing extends past the frame end by > 1mm, a dimension is generated.",
          "14. Rendering: Dimensions are transformed to Paper Space, assigned the specific style/color, and drawn."
        ],
        "conditionalBranches": [
          {
            "condition": "Value of property 'strDir' (Direction)",
            "path1": {
              "name": "Horizontal",
              "steps": [
                "Offset dimension point along the Paper Space Y-axis (-_YW).",
                "Align dimension line to Paper Space X-axis (_XW).",
                "Filter beams perpendicular to Element X-axis.",
                "Measure oversail along the Element X-axis."
              ]
            },
            "path2": {
              "name": "Vertical",
              "steps": [
                "Offset dimension point along the Paper Space X-axis (-_XW).",
                "Align dimension line to Paper Space Y-axis (_YW).",
                "Filter beams perpendicular to Element Y-axis.",
                "Measure oversail along the Element Y-axis."
              ]
            }
          },
          {
            "condition": "Oversail detection at Start Side",
            "path1": {
              "name": "Oversail Detected (> 1mm)",
              "steps": [
                "Calculate points: Frame Start and Sheathing Start.",
                "Create Dimension object in Model Space.",
                "Transform Dimension to Paper Space.",
                "Apply 'Delta text direction' and 'Side of delta dimensioning'.",
                "Draw dimension."
              ]
            },
            "path2": {
              "name": "No Oversail (< 1mm)",
              "steps": [
                "Skip drawing dimension for start side."
              ]
            }
          },
          {
            "condition": "Oversail detection at End Side",
            "path1": {
              "name": "Oversail Detected (> 1mm)",
              "steps": [
                "Calculate points: Frame End and Sheathing End.",
                "Create Dimension object in Model Space.",
                "Transform Dimension to Paper Space.",
                "Apply 'Delta text direction' and 'Side of delta dimensioning'.",
                "Draw dimension."
              ]
            },
            "path2": {
              "name": "No Oversail (< 1mm)",
              "steps": [
                "Skip drawing dimension for end side."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Array Initialization",
            "errorMessage": "None (Silent failure)",
            "recovery": "Ensure script is inserted correctly and context is valid. Script returns if _Viewport array is empty."
          },
          {
            "check": "Viewport Data Integrity",
            "errorMessage": "None (Silent failure)",
            "recovery": "Select a viewport that is linked to a valid hsbCAD Element (Model). Script returns if vp.element().bIsValid() is false."
          },
          {
            "check": "Structural Frame Availability",
            "errorMessage": "None (Silent failure)",
            "recovery": "Ensure the Element has beams perpendicular to the selected dimension direction. Script returns if no beam points are found."
          },
          {
            "check": "Sheathing Zone Availability",
            "errorMessage": "None (Silent failure)",
            "recovery": "Ensure the specified 'Zone index' contains sheets/sheathing. Script returns if no sheet points are found."
          },
          {
            "check": "Color Index Range",
            "errorMessage": "None (Auto-correction)",
            "recovery": "If 'Color' is set outside 0-255, script automatically resets it to 0."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Dimension Direction",
            "how": "OPM (Object Properties Manager) - Change 'Direction' property.",
            "effect": "Recalculates orientation to Horizontal or Vertical relative to the element. Redraws dimensions."
          },
          {
            "action": "Change Sheathing Zone",
            "how": "OPM - Change 'Zone index' property.",
            "effect": "Script reads geometry from a different construction zone. Dimensions update or disappear if zone is empty."
          },
          {
            "action": "Adjust Dimension Offset",
            "how": "OPM - Change 'Offset From Element' value.",
            "effect": "Moves the dimension line closer to or further from the element in Paper Space."
          },
          {
            "action": "Modify Dimension Style",
            "how": "OPM - Change 'Dimension Style' dropdown.",
            "effect": "Updates text height, arrows, and ticks based on the selected AutoCAD style."
          },
          {
            "action": "Toggle Text Position",
            "how": "OPM - Change 'Side of delta dimensioning' property.",
            "effect": "Moves the dimension text from above the line to below (or vice versa)."
          },
          {
            "action": "Rotate Text",
            "how": "OPM - Change 'Delta text direction' (None/Parallel/Perpendicular).",
            "effect": "Rotates the dimension text content inside the dimension block."
          },
          {
            "action": "Change Color",
            "how": "OPM - Change 'Color' index.",
            "effect": "Changes the color index of the dimension lines and text."
          }
        ]
      },
      "tokens_used": 7556,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Layout_DIM_Sheathing_Oversail.mcr\n\n## Overview\nAutomates the dimensioning of sheathing oversails in Paper Space layout views. It calculates and draws dimensions indicating how much sheathing material extends past the timber frame structure based on a selected viewport.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script operates in Layout tabs. |\n| Paper Space | Yes | This is the primary environment for the script. |\n| Shop Drawing | Yes | Used to annotate overhang details in production drawings. |\n\n## Prerequisites\n- **Required Entities**: An hsbCAD Element (e.g., Wall or Floor) containing both structural beams and sheathing sheets.\n- **Minimum Beam Count**: 1 (Though typically a frame with multiple beams is required to define a boundary).\n- **Required Settings**: A Paper Space Layout with an active Viewport that is linked to the Model Space Element.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Layout_DIM_Sheathing_Oversail.mcr`\n\n### Step 2: Specify Insertion Point\n```\nCommand Line: (Prompts for point)\nAction: Click anywhere in the Paper Space layout to define the script anchor point.\n```\n\n### Step 3: Select Viewport\n```\nCommand Line: Select a viewport, you can add others later on with the HSB_LINKTOOLS command.\nAction: Click the edge or inside of the viewport that displays the 3D model you wish to dimension.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Direction | dropdown | Horizontal | Sets the orientation of the dimension line (Horizontal or Vertical relative to the element). |\n| Zone index | dropdown | 1 | Selects the construction zone (layer) containing the sheathing sheets to measure (-5 to 5). |\n| Dimension Style | dropdown | (Current) | Selects the AutoCAD Dimension Style to control text height and arrow appearance. |\n| Side of delta dimensioning | dropdown | Above | Positions the dimension text either \"Above\" or \"Below\" the dimension line. |\n| Offset From Element | number | 150 mm | Sets the distance between the timber frame and the dimension line in Paper Space. |\n| Delta text direction | dropdown | None | Rotates the dimension text (None, Parallel, or Perpendicular to the line). |\n| Color | number | 1 | Sets the AutoCAD color index for the dimension lines and text. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not add custom items to the right-click context menu. Use the Properties Panel to modify settings. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not rely on external XML settings files.\n\n## Tips\n- **Missing Dimensions?**: If dimensions do not appear, verify that the **Zone index** matches the zone where your sheathing is applied, and ensure the sheathing actually extends past the frame by more than 1mm.\n- **Cluttered Drawings**: Use the **Offset From Element** property to move dimension lines away from dense structural details.\n- **Quick Orientation**: Switch between **Horizontal** and **Vertical** directions to quickly document oversails on different sides of the wall or floor.\n\n## FAQ\n- Q: Why are my dimensions showing the wrong scale?\n- A: Ensure the **Dimension Style** selected in the properties matches the scale of your viewport and drawing standards.\n- Q: Can I dimension multiple walls with one script instance?\n- A: No, one script instance is linked to a specific viewport and element. Insert the script again for additional elements or viewports.\n- Q: The script places dimensions in the wrong location.\n- A: Check the **Direction** property. If set to Horizontal, it measures along the element's X-axis. Change to Vertical to measure along the Y-axis."
      },
      "tokens_used": 5898,
      "error": null
    }
  }
}