{
  "filename": "SimpsonStrongTieNP.mcr",
  "status": "completed",
  "total_tokens": 61831,
  "processing_time": 322.8259997367859,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 11276,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script relies on 3D geometric entities (Body, Cut, Point3d) and beam referencing (_Beam[]). It does not use ShopDrawing specific APIs (sd_*), viewport interaction, or 2D layout commands typical of Paper Space scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 7569,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 11950,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Inserts Simpson Strong-Tie 'NP' series metal nail plates (perforated plates) to connect 2 or 3 timber beams, supporting both standard catalog types and custom dimensions.\",\n    \"category\": \"Hardware/Connection\",\n    \"typicalUseCase\": \"Reinforcing timber joints (splices or intersections) with nailed metal plates, typically for truss girder splices or beam-to-beam connections requiring structural transfer via nails.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sType\",\n      \"technicalDefault\": \"NP15/40/120\",\n      \"businessMeaning\": \"Selects the specific standard Simpson Strong-Tie NP product code (format: Thickness/Width/Length in mm, e.g., NP15/40/120 = 1.5mm thick, 40mm wide, 120mm long).\",\n      \"validRange\": \"Fixed list of ~109 manufacturer codes\",\n      \"unit\": \"String (Enum)\",\n      \"affectsOutput\": \"Determines the dimensions (dL, dW, dT) and visual representation of the plate. Overrides custom dimensions if 'Free Steel Plate' is disabled.\"\n    },\n    {\n      \"name\": \"sFreeSteelPlate\",\n      \"technicalDefault\": \"|No|\",\n      \"businessMeaning\": \"Toggle to switch between using the standard manufacturer catalog ('No') or defining a custom plate size ('Yes').\",\n      \"validRange\": \"Yes/No\",\n      \"unit\": \"Boolean (Enum)\",\n      \"affectsOutput\": \"Unlocks 'Length', 'Width', and 'Thickness' inputs for custom geometry generation.\"\n    },\n    {\n      \"name\": \"dLength\",\n      \"technicalDefault\": \"3000.0\",\n      \"businessMeaning\": \"The length of the custom metal plate (along the beam axis).\",\n      \"validRange\": \"10mm to Beam Length\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Geometry of the Body (plate) and position of nail holes.\"\n    },\n    {\n      \"name\": \"dWidth\",\n      \"technicalDefault\": \"1300.0\",\n      \"businessMeaning\": \"The width of the custom metal plate (perpendicular to beam axis).\",\n      \"validRange\": \"10mm to Beam Width\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Geometry of the Body (plate).\"\n    },\n    {\n      \"name\": \"dThickness\",\n      \"technicalDefault\": \"1.5\",\n      \"businessMeaning\": \"The thickness of the steel plate.\",\n      \"validRange\": \"1.5mm, 2.0mm, 2.5mm, 3.0mm (Standard gauges)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"3D geometry volume and nesting collision.\"\n    },\n    {\n      \"name\": \"sArticle1\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"ERP Article number/Order code for the metal plate itself.\",\n      \"validRange\": \"Alphanumeric string\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"BOM/Material List reporting (Hardware generation).\"\n    },\n    {\n      \"name\": \"sMaterial1\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Material specification for the plate (e.g., Galvanized, Stainless Steel).\",\n      \"validRange\": \"Material Codes\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"BOM/Material List reporting.\"\n    },\n    {\n      \"name\": \"sMod2\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Model or Type designation of the nails used for the plate.\",\n      \"validRange\": \"Manufacturer Nail Codes\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"BOM reporting and engineering calculations.\"\n    },\n    {\n      \"name\": \"sArticle2\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"ERP Article number for the nails.\",\n      \"validRange\": \"Alphanumeric string\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"BOM reporting.\"\n    },\n    {\n      \"name\": \"dLength2\",\n      \"technicalDefault\": \"0.0\",\n      \"businessMeaning\": \"Length of the nails.\",\n      \"validRange\": \"Typically 30mm - 150mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Hardware reporting, potential collision checks.\"\n    },\n    {\n      \"name\": \"dDiameter\",\n      \"technicalDefault\": \"0.0\",\n      \"businessMeaning\": \"Diameter of the nails.\",\n      \"validRange\": \"Typically 2.8mm - 6.0mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Hardware reporting.\"\n    },\n    {\n      \"name\": \"nNumNail\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Total quantity of nails required for the connection.\",\n      \"validRange\": \"Integer > 0\",\n      \"unit\": \"Count\",\n      \"affectsOutput\": \"BOM reporting. (Note: This is doubled automatically if Duplex mode is active).\"\n    },\n    {\n      \"name\": \"sSide\",\n      \"technicalDefault\": \"|Left|\",\n      \"businessMeaning\": \"Specifies which side of the beam intersection the plate is placed on (Left or Right relative to the secondary beam vector).\",\n      \"validRange\": \"Left/Right\",\n      \"unit\": \"Direction\",\n      \"affectsOutput\": \"Spatial position of the Body. Read-only if Duplex is enabled.\"\n    },\n    {\n      \"name\": \"sDuplex\",\n      \"technicalDefault\": \"|No|\",\n      \"businessMeaning\": \"Enables 'Double Plating' mode, placing a plate on both faces of the connection (sandwiching the beams).\",\n      \"validRange\": \"Yes/No\",\n      \"unit\": \"Boolean (Enum)\",\n      \"affectsOutput\": \"Generates two Bodies instead of one, doubles the nail count in BOM, and locks the 'Side' parameter.\"\n    },\n    {\n      \"name\": \"dOffset\",\n      \"technicalDefault\": \"0.0\",\n      \"businessMeaning\": \"Linear offset of the plate along the main beam axis.\",\n      \"validRange\": \"-BeamLength/2 to +BeamLength/2\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Shifts the insertion point of the plate along the beam.\"\n    },\n    {\n      \"name\": \"bStretch\",\n      \"technicalDefault\": \"true\",\n      \"businessMeaning\": \"Determines if the plate acts as a tool to cut/trim the beams ('Stretch' them) or if it sits on the surface without altering beam geometry.\",\n      \"validRange\": \"Yes/No\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"If Yes, adds Cut tools to the beams to create notches/housings. If No, beams remain visually solid.\"\n    },\n    {\n      \"name\": \"sDescription\",\n      \"technicalDefault\": \"|No|\",\n      \"businessMeaning\": \"Toggles the visibility of text labels and dimensions in the 3D model.\",\n      \"validRange\": \"Yes/No\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"Visual display of text (Plate Name and Dimensions) in the CAD viewport.\"\n    },\n    {\n      \"name\": \"nColor\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Display color index for the plate.\",\n      \"validRange\": \"CAD Color Index\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Visual color of the Body.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"sFreeSteelPlate set to Yes\",\n      \"effect\": \"Allows manual entry of dimensions; sType selection is effectively ignored for geometry.\",\n      \"cascade\": [\"dLength\", \"dWidth\", \"dThickness\"]\n    },\n    {\n      \"trigger\": \"sDuplex set to Yes\",\n      \"effect\": \"Doubles the nail quantity and locks the Side parameter.\",\n      \"cascade\": [\"nNumNail\", \"sSide\"]\n    },\n    {\n      \"trigger\": \"sType changed\",\n      \"effect\": \"Updates internal dLength, dWidth, and dThickness variables based on the lookup table.\",\n      \"cascade\": [\"dLength\", \"dWidth\", \"dThickness\"]\n    }\n"
      },
      "tokens_used": 11530,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script initializes properties (catalog types, dimensions, materials) and constants.",
          "2. If _bOnInsert is true (Script Insertion), prompt user to select Beam 1 (Primary) via getGenBeam.",
          "3. Prompt user to select Beam 2 (Secondary) via getGenBeam.",
          "4. Prompt user to optionally select Beam 3 via getGenBeam.",
          "5. Prompt user to specify the insertion point (intersection) via getPoint.",
          "6. Calculate geometric context: Determine beam vectors (vx, vy, vz) and intersection point (_Pt0).",
          "7. Determine Plate Dimensions: If 'sFreeSteelPlate' is No, lookup dimensions from 'sType' catalog arrays. If Yes, use 'dLength', 'dWidth', 'dThickness'.",
          "8. Check 'sDuplex' mode: If Yes, prepare for two mirrored plates. If No, prepare for one.",
          "9. Check 'bStretch' mode: If Yes, prepare to apply Cut tools to beams.",
          "10. Generate Geometry: Create Body objects for the plate(s) at calculated coordinates.",
          "11. Apply Cuts: If bStretch is Yes and geometry is valid, add Cut tools to the timber beams.",
          "12. Generate Hardware: Create Hardware entries for BOM (Plate material and Nail quantities).",
          "13. Visual Output: Draw the Body and optional text labels ('sDescription') to Model Space."
        ],
        "conditionalBranches": [
          {
            "condition": "Number of Selected Beams",
            "path1": {
              "name": "2 Beams",
              "steps": [
                "Calculates intersection based on bm1 and bm2 centerlines.",
                "Plate aligns primarily with bm1 vector.",
                "Cuts are applied to bm2 if bStretch is enabled.",
                "Duplex plates are placed on both sides of the connection relative to the main beam."
              ]
            },
            "path2": {
              "name": "3 Beams",
              "steps": [
                "Calculates centroid point between three intersecting beams.",
                "Plate alignment is derived from the planar intersection of the beams.",
                "Cuts are applied to bm1 and bm3 if bStretch is enabled.",
                "Duplex plates sandwich all three beams."
              ]
            }
          },
          {
            "condition": "sFreeSteelPlate (Catalog vs Custom)",
            "path1": {
              "name": "Catalog Mode (No)",
              "steps": [
                "Reads index from 'sType'.",
                "Retrieves Length, Width, Thickness from hardcoded arrays 'dLengths', 'dWidths', 'dThicknesses'.",
                "User cannot manually edit dimensions unless sFreeSteelPlate is changed."
              ]
            },
            "path2": {
              "name": "Custom Mode (Yes)",
              "steps": [
                "Disables catalog lookup.",
                "Reads user inputs from 'dLength', 'dWidth', 'dThickness'.",
                "Generates geometry based on these arbitrary values."
              ]
            }
          },
          {
            "condition": "sDuplex (Single vs Double)",
            "path1": {
              "name": "Single Plate (No)",
              "steps": [
                "Generates one Body object.",
                "Placement side is determined by 'sSide' (Left/Right).",
                "Nail count 'nNumNail' is used as is."
              ]
            },
            "path2": {
              "name": "Double Plate (Yes)",
              "steps": [
                "Generates two Body objects mirrored across the beam plane.",
                "Sets 'sSide' property to Read-Only.",
                "Multiplies nail count (nNumNail) and body count (nBd) by 2."
              ]
            }
          },
          {
            "condition": "bStretch (Cut vs No Cut)",
            "path1": {
              "name": "Stretch Yes",
              "steps": [
                "Instantiates Cut tools at plate location.",
                "Applies tools to beams using bm.addTool().",
                "Beams are visually shortened/notched."
              ]
            },
            "path2": {
              "name": "Stretch No",
              "steps": [
                "Skips Cut tool instantiation.",
                "Beams remain solid.",
                "Plate acts as a visual overlay or clash object."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection",
            "errorMessage": "Must select at least 2 beams.",
            "recovery": "Script prompts user again (getGenBeam) or fails gracefully."
          },
          {
            "check": "Geometry Validity",
            "errorMessage": "Intersection point cannot be determined or vectors are invalid.",
            "recovery": "Script uses projected points and vector normals, but invalid selections may result in misplacement."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Product Type",
            "how": "Properties Palette (OPM) - sType",
            "effect": "Updates dimensions and geometry to the new catalog standard."
          },
          {
            "action": "Resize Plate",
            "how": "Properties Palette (OPM) - sFreeSteelPlate toggle + dLength/dWidth inputs",
            "effect": "Switches to custom mode and updates body geometry to new size."
          },
          {
            "action": "Move Plate",
            "how": "Grip Point (_Pt0) drag",
            "effect": "Moves plate along beam axis; re-applies cuts if bStretch is active."
          },
          {
            "action": "Switch to Duplex",
            "how": "Properties Palette (OPM) - sDuplex",
            "effect": "Adds second plate, doubles BOM count, locks Side selection."
          },
          {
            "action": "Toggle Cutting",
            "how": "Properties Palette (OPM) - bStretch",
            "effect": "Adds or removes voids in the timber beams to accommodate plate thickness."
          },
          {
            "action": "Update Material Info",
            "how": "Properties Palette (OPM) - sArticle1, sMaterial1, etc.",
            "effect": "Updates reports/lists (BOM) without altering 3D geometry."
          }
        ]
      },
      "tokens_used": 12243,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# SimpsonStrongTieNP.mcr\n\n## Overview\nInserts Simpson Strong-Tie 'NP' series metal nail plates (perforated plates) to connect 2 or 3 timber beams. It supports both standard manufacturer catalog types and custom plate dimensions, including options for double plating and automatic beam trimming.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script is designed for 3D modeling and detailing. |\n| Paper Space | No | Does not support 2D layout or viewport interaction. |\n| Shop Drawing | No | Does not generate shop drawing views or labels directly. |\n\n## Prerequisites\n- **Required Entities**: 2 or 3 Timber Beams (`GenBeam`).\n- **Minimum Beam Count**: 2 (A third beam is optional).\n- **Required Settings**: None (uses internal catalog data).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `SimpsonStrongTieNP.mcr` from the file browser.\n\n### Step 2: Select Primary Beam\n```\nCommand Line: Select first beam:\nAction: Click on the primary timber beam (Beam 1) that the plate will align with.\n```\n\n### Step 3: Select Secondary Beam\n```\nCommand Line: Select second beam:\nAction: Click on the secondary timber beam (Beam 2) intersecting or meeting the first beam.\n```\n\n### Step 4: Select Optional Third Beam\n```\nCommand Line: Select third beam (press Enter to skip):\nAction: Click a third beam if connecting three members, or press Enter to proceed with only two.\n```\n\n### Step 5: Specify Insertion Point\n```\nCommand Line: Specify insertion point:\nAction: Click in the 3D model to define where the center of the plate will be located.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Geometry & Type** |\n| sType | Dropdown | NP15/40/120 | Selects the standard Simpson Strong-Tie product code (e.g., NP15/40/120). |\n| sFreeSteelPlate | Dropdown | No | Set to **Yes** to input custom dimensions; **No** uses the standard catalog. |\n| dLength | Number | 3000.0 | **Custom Mode Only**: Length of the plate (along the beam axis). |\n| dWidth | Number | 1300.0 | **Custom Mode Only**: Width of the plate (perpendicular to beam axis). |\n| dThickness | Number | 1.5 | Thickness of the steel plate (mm). |\n| **Placement** |\n| sSide | Dropdown | Left | Places the plate on the Left or Right side relative to the secondary beam. (Locked if Duplex is Yes). |\n| sDuplex | Dropdown | No | Set to **Yes** to create double plates (sandwiching the beams). Locks the Side property. |\n| dOffset | Number | 0.0 | Moves the plate along the main beam axis (+/-). |\n| **Function** |\n| bStretch | Boolean | Yes | If **Yes**, cuts a recess into the timber beams to fit the plate thickness. If **No**, beams remain solid. |\n| **Material & BOM** |\n| sArticle1 | String | *empty* | ERP Article number for the metal plate. |\n| sMaterial1 | String | *empty* | Material specification (e.g., Galvanized). |\n| sMod2 | String | *empty* | Model/Type code for the nails. |\n| sArticle2 | String | *empty* | ERP Article number for the nails. |\n| dLength2 | Number | 0.0 | Length of the nails (mm). |\n| dDiameter | Number | 0.0 | Diameter of the nails (mm). |\n| nNumNail | Integer | 0 | Total quantity of nails (doubled automatically if Duplex is Yes). |\n| **Display** |\n| sDescription | Boolean | No | Shows text labels (Name and Dimensions) in the 3D model. |\n| nColor | Integer | 0 | CAD Color Index for the plate body. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Properties | Opens the Properties Palette (OPM) to modify all parameters listed above. |\n| Recalculate | Refreshes the script geometry if manual parameter changes do not update automatically. |\n\n## Settings Files\n- **Internal Catalog**: The script contains an internal list of approximately 109 Simpson Strong-Tie NP types. No external XML file is required for standard operation.\n\n## Tips\n- **Switching Modes**: To create a custom size not in the catalog, set `sFreeSteelPlate` to **Yes**. This unlocks the `dLength`, `dWidth`, and `dThickness` fields.\n- **Double Plating**: Use `sDuplex` = **Yes** to automatically generate mirrored plates on both sides of the connection. This automatically calculates double the amount of nails in your BOM.\n- **Visual Clarity**: If the plate is obscuring your view of the beam joinery, set `bStretch` to **No**. This prevents the script from cutting holes in the beams, keeping them solid while the plate sits on top.\n\n## FAQ\n- **Q: How do I resize the plate to a non-standard size?**\n  - A: Change `sFreeSteelPlate` to **Yes** in the properties palette. Then enter your desired dimensions in `dLength`, `dWidth`, and `dThickness`.\n- **Q: Why are my beams being cut/notched when I insert the plate?**\n  - A: This is controlled by the `bStretch` property. Set it to **No** to stop the beams from being cut.\n- **Q: Can I use this for 3 beams?**\n  - A: Yes. During insertion, select a third beam when prompted. The script will calculate the intersection for all three members.\n- **Q: The \"Side\" option is greyed out.**\n  - A: This happens when `sDuplex` is set to **Yes**. Since plates are generated on both sides, a specific side selection is not applicable."
      },
      "tokens_used": 7263,
      "error": null
    }
  }
}