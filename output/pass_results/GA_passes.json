{
  "filename": "GA.mcr",
  "status": "completed",
  "total_tokens": 50746,
  "processing_time": 428.2905492782593,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9464,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script utilizes GenBeam entities, BeamCut tools for modifying geometry, and constructs 3D Body objects (bd0, bd1) with a Display index of 252. It lacks 'sd_' prefixes, '_Viewport' references, and '#Type E' logic, confirming it is a Model Space connection script that physically alters timber beams."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space",
          "requiredSettings": [
            "GenericAngle.xml",
            "hsbCompany\\TSL\\Settings folder"
          ]
        }
      },
      "tokens_used": 7298,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10178,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts a configurable metal angle bracket connection for one or two timber beams, handling automatic milling for material clearance.",
          "category": "Hardware",
          "typicalUseCase": "Creating structural connections between intersecting beams or fixing a beam to a support using manufacturer-specific angle brackets."
        },
        "parameters": [
          {
            "name": "sFamily",
            "technicalDefault": "\"AA\"",
            "businessMeaning": "The manufacturer family or series of the angle bracket (e.g., Simpson AA, AB).",
            "validRange": "Defined in XML (e.g., AA, AB, AN)",
            "unit": "String",
            "affectsOutput": "Determines available sizes (sProduct), default geometry, and manufacturer details."
          },
          {
            "name": "sProduct",
            "technicalDefault": "\"AA60280\"",
            "businessMeaning": "The specific article number or model code defining the bracket's dimensions.",
            "validRange": "Defined in XML for selected family",
            "unit": "String",
            "affectsOutput": "Sets the width (dB), depth (dA), and thickness (dt) of the bracket."
          },
          {
            "name": "Manufacturer",
            "technicalDefault": "From XML (e.g., \"Simpson\")",
            "businessMeaning": "The supplier/brand of the hardware.",
            "validRange": "Defined in XML catalog",
            "unit": "String",
            "affectsOutput": "Populates hardware properties in BOM/data export."
          },
          {
            "name": "bRotate180",
            "technicalDefault": "0 (false)",
            "businessMeaning": "Rotates the bracket 180 degrees around its vertical axis relative to the beam.",
            "validRange": "0/1 (No/Yes)",
            "unit": "Boolean",
            "affectsOutput": "Swaps the legs of the angle bracket or flips the orientation on the beam face."
          },
          {
            "name": "bSwapLegs",
            "technicalDefault": "0 (false)",
            "businessMeaning": "Swaps which side of the bracket attaches to the primary beam vs. the secondary beam.",
            "validRange": "0/1 (No/Yes)",
            "unit": "Boolean",
            "affectsOutput": "Exchanges the dimensions dA and dB in the connection logic."
          },
          {
            "name": "iMillingType",
            "technicalDefault": "1 (Rectangular pocket)",
            "businessMeaning": "The type of material removal required to fit the bracket flush.",
            "validRange": "0=None, 1=Rectangular, 2=One side, 3=Both sides",
            "unit": "Integer",
            "affectsOutput": "Geometry of the 'BeamCut' added to the timber (pocket, slot, or none)."
          },
          {
            "name": "dTolerance",
            "technicalDefault": "1.0",
            "businessMeaning": "Additional clearance around the bracket for easier assembly or swelling wood.",
            "validRange": "0.0 mm to 5.0 mm",
            "unit": "mm",
            "affectsOutput": "Expands the size of the milling pocket/cut."
          },
          {
            "name": "dB",
            "technicalDefault": "From Product XML",
            "businessMeaning": "The horizontal width of the bracket (leg width 1).",
            "validRange": "Typically 40mm - 200mm",
            "unit": "mm",
            "affectsOutput": "Width of the graphical body and the width of the cut."
          },
          {
            "name": "dA",
            "technicalDefault": "From Product XML",
            "businessMeaning": "The horizontal depth of the bracket (leg width 2).",
            "validRange": "Typically 40mm - 200mm",
            "unit": "mm",
            "affectsOutput": "Depth of the graphical body and the depth of the cut."
          },
          {
            "name": "dC",
            "technicalDefault": "From Product XML",
            "businessMeaning": "The vertical height of the bracket.",
            "validRange": "Typically 60mm - 400mm",
            "unit": "mm",
            "affectsOutput": "Height of the graphical body and the height of the cut."
          },
          {
            "name": "dt",
            "technicalDefault": "From Product XML",
            "businessMeaning": "The thickness of the steel material.",
            "validRange": "Typically 2mm - 10mm",
            "unit": "mm",
            "affectsOutput": "Depth of the milling (material removal) and representation of the steel plate."
          },
          {
            "name": "Nail/Screw info (mapDiameters)",
            "technicalDefault": "From Product XML",
            "businessMeaning": "Configuration of fasteners associated with the bracket.",
            "validRange": "Diameter and Quantity per XML",
            "unit": "Count / mm",
            "affectsOutput": "Generates 'Hardware' components in the BOM and can influence drilling if implemented (though only hardware component creation is visible here)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sFamily changes",
            "effect": "Updates the list of available sProduct options and sets the default Manufacturer.",
            "cascade": [
              "sProduct",
              "Manufacturer"
            ]
          },
          {
            "trigger": "sProduct changes",
            "effect": "Overwrites dimensions dA, dB, dC, dt, and fastener data with values from the catalog.",
            "cascade": [
              "dA",
              "dB",
              "dC",
              "dt",
              "mapDiameters"
            ]
          },
          {
            "trigger": "bSwapLegs is toggled",
            "effect": "Swaps the usage of dimensions dA and dB in the geometric calculation.",
            "cascade": [
              "dA",
              "dB"
            ]
          },
          {
            "trigger": "iMillingType changes",
            "effect": "Changes the calculation logic for BeamCut (depths/directions).",
            "cascade": [
              "BeamCut dimensions"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Body",
            "description": "Visual representation of the angle bracket (usually steel) embedded in the beam.",
            "appliedTo": "ModelSpace (Visual representation)"
          },
          {
            "type": "BeamCut",
            "description": "Material removal (pocket, slot, or rabbet) in the timber to allow the bracket to sit flush.",
            "appliedTo": "GenBeam[0] and GenBeam[1] (if two beams are selected)"
          },
          {
            "type": "Hardware Component",
            "description": "Data entry for BOM/CAM output representing the bracket and fasteners.",
            "appliedTo": "GenBeam[0] (Primary beam)"
          }
        ]
      },
      "tokens_used": 8726,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch & Initialization",
          "Load XML Configuration (Check Company folder, fallback to General Content)",
          "Prompt User Input: Select Beam(s) & Click Point (Insert Mode)",
          "Calculate Geometry: Determine Pt0 based on 1 or 2 beams (intersection or edge proximity)",
          "Read Catalog Data: Apply dimensions (dA, dB, dC, dt) from selected sProduct",
          "Generate 3D Bodies (bd0, bd1) representing the steel bracket",
          "Apply Milling (BeamCut): Calculate cuts based on iMillingType, bRotate180, and dTolerance",
          "Create Hardware Components: Link bracket and fasteners to GenBeam for BOM",
          "Finalize: Update _PtG for grip position and assign layer/groups"
        ],
        "conditionalBranches": [
          {
            "condition": "Number of Selected Beams",
            "path1": {
              "name": "2 Beams (Connection)",
              "steps": [
                "Calculate intersection line between beam planes",
                "Place bracket at intersection",
                "Apply cuts to both GenBeam[0] and GenBeam[1]",
                "Enable Double-Click trigger to flip beams"
              ]
            },
            "path2": {
              "name": "1 Beam (End/Side Fix)",
              "steps": [
                "Find closest edge to selected click point",
                "Determine primary plane based on proximity to grip",
                "Apply cuts only to GenBeam[0]"
              ]
            }
          },
          {
            "condition": "XML Source Location",
            "path1": {
              "name": "Company Settings",
              "steps": [
                "Check path: _kPathHsbCompany\\TSL\\Settings\\GenericAngle.xml",
                "Use this configuration if found"
              ]
            },
            "path2": {
              "name": "General Content Fallback",
              "steps": [
                "If Company XML missing, check _kPathHsbInstall\\Content\\General\\TSL\\Settings\\",
                "Load default configuration"
              ]
            }
          },
          {
            "condition": "Milling Type (iMillingType)",
            "path1": {
              "name": "Type 0 (None)",
              "steps": [
                "Generate visual body only",
                "No BeamCut operations"
              ]
            },
            "path2": {
              "name": "Type 1 (Rectangular Pocket)",
              "steps": [
                "Calculate pocket dimensions with tolerance",
                "Subtract volume from timber"
              ]
            },
            "path3": {
              "name": "Type 2 (One Side)",
              "steps": [
                "Mill only on specific side of the bracket leg"
              ]
            },
            "path4": {
              "name": "Type 3 (Both Sides)",
              "steps": [
                "Mill both sides of the bracket leg",
                "Includes logic for rotated geometry (bRotate180)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "XML File Availability",
            "errorMessage": "(Implicit) Default map used if XML not found",
            "recovery": "Script proceeds with hardcoded defaults or fails if critical geometry is missing."
          },
          {
            "check": "Beam Selection",
            "errorMessage": "(Implicit) TSL Prompt enforces selection",
            "recovery": "User must select at least one GenBeam via command line interface."
          },
          {
            "check": "Product/Family Mapping",
            "errorMessage": "Values in OPM might not update if XML map key is missing",
            "recovery": "Ensure sFamily and sProduct strings match XML keys exactly."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Bracket Family/Product",
            "how": "Properties Palette (OPM)",
            "effect": "Updates dimensions, fastener data, and visual model immediately upon recalculation."
          },
          {
            "action": "Swap Legs (bSwapLegs) or Rotate 180 (bRotate180)",
            "how": "Right-Click Context Menu (addRecalcTrigger)",
            "effect": "Swaps dimension usage (dA/dB) or flips the bracket orientation relative to the beam face."
          },
          {
            "action": "Move Connection",
            "how": "Grip Point (_PtG) Drag",
            "effect": "Relocates the bracket along the beam edge or intersection line; if 1 beam, moving grip closer to opposite face switches the attachment plane."
          },
          {
            "action": "Flip Beams",
            "how": "Double Click (if 2 beams connected)",
            "effect": "Switches GenBeam[0] and GenBeam[1], reversing the primary/secondary relationship."
          },
          {
            "action": "Adjust Tolerance/Milling",
            "how": "Properties Palette (OPM)",
            "effect": "Modifies the size of the BeamCut (pocket) without changing the bracket size."
          }
        ]
      },
      "tokens_used": 9330,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GA.mcr\n\n## Overview\nInserts a configurable metal angle bracket for single or double timber connections, automatically generating the necessary 3D representation and material milling (cutouts) for a flush installation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates in 3D to modify beams and generate hardware bodies. |\n| Paper Space | No | Not designed for 2D detailing or views. |\n| Shop Drawing | No | Does not generate shop drawing views directly. |\n\n## Prerequisites\n- **Required Entities**: At least one `GenBeam` (Timber Beam).\n- **Minimum Beam Count**: 1 (Supports 2 beams for connections).\n- **Required Settings**: `GenericAngle.xml` (Located in Company folder or default Install folder).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GA.mcr` from the list.\n\n### Step 2: Select Beams and Insert\n```\nCommand Line: Select beams:\nAction: Click on the primary beam. If connecting two beams, click the second intersecting beam.\n```\n```\nCommand Line: Specify insertion point:\nAction: Click near the end or intersection of the beam where the bracket should be placed.\n```\n\n### Step 3: Configure Bracket\n1.  Select the inserted script object (it may be represented by a grip point or the bracket body).\n2.  Open the **Properties Palette** (Ctrl+1).\n3.  Select the desired **Family** (e.g., Simpson AA).\n4.  Select the specific **Product** code (e.g., AA60280).\n5.  Adjust dimensions or milling settings if necessary.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sFamily | String | AA | The manufacturer series or family of the angle bracket. |\n| sProduct | String | AA60280 | The specific product code defining dimensions and fasteners. |\n| Manufacturer | String | (From XML) | The supplier/brand name for BOM export. |\n| bRotate180 | Boolean | 0 (No) | Rotates the bracket 180 degrees relative to the beam face. |\n| bSwapLegs | Boolean | 0 (No) | Swaps which leg attaches to the primary vs. secondary beam (swaps width/depth usage). |\n| iMillingType | Integer | 1 | Type of material removal: 0=None, 1=Rectangular Pocket, 2=One Side, 3=Both Sides. |\n| dTolerance | Double (mm) | 1.0 | Extra clearance added to the milling pocket for fit. |\n| dB | Double (mm) | (Product) | Horizontal width of the bracket (Leg 1). |\n| dA | Double (mm) | (Product) | Horizontal depth of the bracket (Leg 2). |\n| dC | Double (mm) | (Product) | Vertical height of the bracket. |\n| dt | Double (mm) | (Product) | Thickness of the steel material. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Swap Legs | Toggles the `bSwapLegs` property, switching the orientation of the bracket legs. |\n| Rotate 180 | Toggles the `bRotate180` property, flipping the bracket orientation. |\n| Update | Forces a recalculation of the script geometry. |\n\n## Settings Files\n- **Filename**: `GenericAngle.xml`\n- **Location**: `_kPathHsbCompany\\TSL\\Settings` (or fallback to `_kPathHsbInstall\\Content\\General\\TSL\\Settings`)\n- **Purpose**: Defines the catalog of available brackets, including dimensions (dA, dB, dC, dt), default part numbers, and associated fastener (nail/screw) configurations.\n\n## Tips\n- **Moving the Bracket**: Select the script and drag the **Grip Point** (blue square) to move the bracket along the beam.\n- **Connecting Two Beams**: If you select two beams, the script attempts to place the bracket at their intersection. Double-clicking the object can swap the primary and secondary beam roles.\n- **Face Selection (Single Beam)**: When inserting on a single beam, the bracket attaches to the face nearest to your click point.\n- **Tolerance Adjustment**: If the timber swells or for easier assembly, increase the `dTolerance` value to create a slightly larger pocket in the wood.\n\n## FAQ\n- **Q: Why is the bracket not cutting into the wood?**\n  A: Check the `iMillingType` property. If it is set to `0`, no cuts are generated. Set it to `1` (Rectangular Pocket) for standard inset applications.\n- **Q: How do I switch to a different manufacturer?**\n  A: Change the `sFamily` property in the dropdown menu. The `sProduct` list will update automatically to show available codes for that family.\n- **Q: The bracket is facing the wrong way.**\n  A: Use the Right-Click menu option **Rotate 180** or toggle the **bSwapLegs** property to flip the orientation."
      },
      "tokens_used": 5750,
      "error": null
    }
  }
}