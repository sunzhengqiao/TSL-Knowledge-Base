{
  "filename": "hsbRP_EaveArea.mcr",
  "status": "completed",
  "total_tokens": 48152,
  "processing_time": 430.9830663204193,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 8313,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getERoofPlane() to associate with a 3D entity and performs geometric operations (projections, area calculations) using ERoofPlane and PLine entities. No 'sd_' prefix, no '#Type E', and no _Viewport API usage found."
        },
        "prerequisites": {
          "requiredEntities": [
            "ERoofPlane"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (requires an existing Roof Plane)",
          "requiredSettings": []
        }
      },
      "tokens_used": 5728,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": "N/A",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getERoofPlane",
              "promptOriginal": "N/A",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "\\nselect points",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnInsert",
            "title": "Properties",
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sMat",
            "type": "PropString",
            "displayName": "Material",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sUnit",
            "type": "PropString",
            "displayName": "Unit",
            "defaultValue": "mm",
            "inputType": "dropdown",
            "options": [
              "mm",
              "cm",
              "m",
              "inch",
              "feet"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sGroup",
            "type": "PropString",
            "displayName": "Group (seperate Level by '\\')",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sRoof",
            "type": "PropString",
            "displayName": "Roof Name",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sHatch",
            "type": "PropString",
            "displayName": "Hatch pattern",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": "_HatchPatterns",
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sAreaType",
            "type": "PropString",
            "displayName": "Type of area",
            "defaultValue": "|Roof area|",
            "inputType": "dropdown",
            "options": [
              "|Roof area|",
              "|Eave area|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "dHatchScale",
            "type": "PropDouble",
            "displayName": "Hatch scale",
            "defaultValue": "30.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "93",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "nDecimals",
            "type": "PropInt",
            "displayName": "Decimals",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Add Point",
            "handler": "sTrigger[0]",
            "action": "Adds selected points to the polyline boundary.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Remove Point",
            "handler": "sTrigger[1]",
            "action": "Removes selected points from the polyline boundary.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Select polyline",
            "handler": "sTrigger[2]",
            "action": "Replaces the current boundary with a selected closed polyline.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Show edge description on/off|",
            "handler": "sTrigger[3]",
            "action": "Toggles the visibility of edge length labels.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7246,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Calculates and annotates the surface area of a specific boundary on a roof plane, displaying the result as text labels with optional hatching. It serves as a satellite tool for material estimation (roof tiles, insulation, fascia) by associating a user-defined polyline boundary with a roof entity.\",\n    \"category\": \"Calculation/Annotation\",\n    \"typicalUseCase\": \"Used during the design phase to calculate quantities for specific roof sections (e.g., calculating the total area of a specific roof slope for tiling, or defining the eave overhang area for metalwork ordering).\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sDimStyle\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Defines the visual appearance (font, text size, arrow style) of the dimension labels and area text generated on the drawing.\",\n      \"validRange\": \"Any existing Dimension Style in the current CAD drawing\",\n      \"unit\": \"Style Name\",\n      \"affectsOutput\": \"Changes the font, height, and style of the displayed area/length text.\"\n    },\n    {\n      \"name\": \"sMat\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"A user-defined text label describing the material to be used for this specific area (e.g., 'Terracotta Tiles', 'Zinc'). This is only displayed if the 'Type of area' is set to 'Eave area'.\",\n      \"validRange\": \"Any alphanumeric string (short material descriptions)\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Displays the material name in the text label if 'Eave area' mode is active; also exported to BOM data.\"\n    },\n    {\n      \"name\": \"sUnit\",\n      \"technicalDefault\": \"mm\",\n      \"businessMeaning \"unit of measurement\": \"used for displaying the calculated area and perimeter values in the text labels.\",\n      \"validRange\": \"mm, cm, m, inch, feet\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Scales the numerical values displayed (e.g., converting internal mm² to m²).\"\n    },\n    {\n      \"name\": \"sGroup\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Assigns the generated script instance to a specific CAD group or layer hierarchy. Used to organize drawing elements.\",\n      \"validRange\": \"Any valid group name path (e.g., 'Level 1\\\\Roof')\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Groups the boundary polyline and text in the CAD system for easy selection/isolation.\"\n    },\n    {\n      \"name\": \"sRoof\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"An identifier for the specific roof plane or zone this calculation belongs to, used for reporting and data export.\",\n      \"validRange\": \"Any alphanumeric string\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Written to the data export (DXA) to link the area calculation to a specific roof entity.\"\n    },\n    {\n      \"name\": \"sHatch\",\n      \"technicalDefault\": \"None\",\n      \"businessMeaning\": \"The pattern used to visually fill/hatch the calculated area on the roof plane.\",\n      \"validRange\": \"Any pattern name loaded in the CAD drawing (e.g., 'ANSI31', 'SOLID')\",\n      \"unit\": \"Pattern Name\",\n      \"affectsOutput\": \"Fills the calculated boundary with the selected pattern.\"\n    },\n    {\n      \"name\": \"sAreaType\",\n      \"technicalDefault\": \"|Roof area|\",\n      \"businessMeaning\": \"Determines the calculation logic and label format. 'Roof area' calculates Gross and Net area (subtracts openings). 'Eave area' focuses on the boundary area and displays the Material name.\",\n      \"validRange\": \"|Roof area|, |Eave area|\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Switches the text label between 'Brut/Net area' and 'Material/area' and determines if subtractions (openings) are highlighted.\"\n    },\n    {\n      \"name\": \"dHatchScale\",\n      \"technicalDefault\": \"30.0\",\n      \"businessMeaning\": \"Controls the density or size of the hatch pattern lines.\",\n      \"validRange\": \"Typically 1.0 to 100.0 depending on the pattern and drawing scale\",\n      \"unit\": \"Scale Factor\",\n      \"affectsOutput\": \"Makes the hatch pattern sparser or denser.\"\n    },\n    {\n      \"name\": \"nColor\",\n      \"technicalDefault\": \"93\",\n      \"businessMeaning\": \"The display color of the boundary lines and text labels.\",\n      \"validRange\": \"0-255 (AutoCAD Color Index) or -1 (ByLayer)\",\n      \"unit\": \"Color Index\",\n      \"affectsOutput\": \"Changes the visual color of the polyline and text.\"\n    },\n    {\n      \"name\": \"nDecimals\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"The precision of the numerical values displayed for area and length.\",\n      \"validRange\": \"0, 1, 2, 3, 4\",\n      \"unit\": \"Count\",\n      \"affectsOutput\": \"Rounds the displayed area and length numbers to the specified decimal places.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"sAreaType set to '|Eave area|'\",\n      \"effect\": \"The second line of the text label will display the 'sMat' property instead of the 'Net Area'.\",\n      \"cascade\": [\n        \"sMat\"\n      ]\n    },\n    {\n      \"trigger\": \"sUnit\",\n      \"effect\": \"The conversion factor for the displayed numerical area/length values changes (e.g., mm² to m²).\",\n      \"cascade\": [\n        \"nDecimals\"\n      ]\n    },\n    {\n      \"trigger\": \"sHatch set to 'None'\",\n      \"effect\": \"The visual hatch pattern is suppressed; only the boundary and text are drawn.\",\n      \"cascade\": [\n        \"dHatchScale\"\n      ]\n    }\n  ],\n  \"outputEntities\": [\n    {\n      \"type\": \"PLine (Polyline)\",\n      \"description\": \"A closed 2D polyline representing the user-defined boundary of the area, projected onto the roof plane.\",\n      \"appliedTo\": \"The specified ERoofPlane coordinate system.\"\n    },\n    {\n      \"type\": \"Text Labels\",\n      \"description\": \"Text entities displaying the calculated area (and perimeter or material) placed at the center of the boundary.\",\n      \"appliedTo\": \"The centroid of the calculated PLine.\"\n    },\n    {\n      \"type\": \"Hatch\",\n      \"description\": \"A planar hatch pattern filling the area defined by the PLine (optional, based on sHatch).\",\n      \"appliedTo\": \"The interior of the PLine.\"\n    },\n    {\n      \"type\": \"Data Export (TSLBOM/DXA)\",\n      \"description\": \"Exports calculated properties (Area, NetArea, Perimeter, Material) for use in reports or lists.\",\n      \"appliedTo\": \"External BOM or Analysis tools.\"\n    }\n  ]\n}\n```"
      },
      "tokens_used": 9123,
      "error": null
    },
    "5": {
      "success": true,
      "data": {},
      "tokens_used": 11482,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbRP_EaveArea.mcr\n\n## Overview\nThis script calculates and annotates the surface area of a specific boundary defined on a roof plane. It is used for material estimation (e.g., tiles, insulation, fascia) and supports displaying Gross/Net areas or Material names with optional hatching.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Requires selection of an existing Roof Plane entity. |\n| Paper Space | No | Not designed for Shop Drawings or layout views. |\n| Shop Drawing | No | Does not generate manufacturing details. |\n\n## Prerequisites\n- **Required Entities**: An existing `ERoofPlane` (Roof Plane) must exist in the model.\n- **Minimum Beam Count**: 0\n- **Required Settings**: None (uses standard CAD DimStyles and Hatch patterns).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsbRP_EaveArea.mcr`\n\n### Step 2: Configure Properties (Optional)\nA \"Properties\" dialog may appear automatically, or you can configure settings later in the Properties Palette (Ctrl+1). Set values like **DimStyle**, **Unit**, and **Type of area** as needed.\n\n### Step 3: Select Roof Plane\nAction: Click on the existing Roof Plane entity in the drawing where you want to calculate the area.\n\n### Step 4: Define Boundary\n```\nCommand Line: select points\nAction: Click points in the drawing to define the closed polyline boundary for the area calculation.\n```\n*Tip: Press Enter to finish the point selection.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimstyle | dropdown | *Current* | Sets the text style and height for the area labels. |\n| Material | text | | Name of the material (e.g., \"Zinc\"). Only displayed if \"Type of area\" is set to \"Eave area\". |\n| Unit | dropdown | mm | Unit of measurement for the displayed area (mm, cm, m, inch, feet). |\n| Group (seperate Level by '\\') | text | | Assigns the script to a specific group/layer hierarchy for organization. |\n| Roof Name | text | | Identifier for the roof plane, used for data export/reports. |\n| Hatch pattern | dropdown | None | Visual pattern to fill the calculated area (e.g., ANSI31, SOLID). |\n| Type of area | dropdown | \\|Roof area\\| | **Roof area**: Shows Gross/Net area (subtracts openings). **Eave area**: Shows Material name and area. |\n| Hatch scale | number | 30.0 | Scale factor for the hatch pattern density. |\n| Color | number | 93 | Color index for the boundary lines and text labels. |\n| Decimals | number | 0 | Number of decimal places for the displayed area and length values. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add Point | Adds new points to the current polyline boundary. |\n| Remove Point | Removes specific points from the polyline boundary. |\n| Select polyline | Replaces the current boundary by selecting an existing closed polyline in the drawing. |\n| Show edge description on/off | Toggles the visibility of the edge length labels. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Quick Boundary**: If you have already drawn a polyline representing the area (e.g., a fascia line), insert the script, then use the **Select polyline** right-click option to snap the calculation to that existing shape instead of picking points manually.\n- **Material Labels**: To see the Material name in the label, ensure **Type of area** is set to `|Eave area|` and fill in the **Material** property.\n- **Net Area Calculation**: If the roof has openings (skylights, chimneys), use the `|Roof area|` mode. The script will automatically calculate the Net area (Gross minus openings).\n\n## FAQ\n- **Q: Why is my area text showing \"0.00\"?**\n  A: Check the **Unit** property. If you are working in millimeters but displaying in meters, the number might look very small unless you adjust your decimals or unit settings.\n- **Q: How do I move the text label?**\n  A: The text is automatically placed at the centroid of the boundary. To move it, you must modify the boundary points so the centroid shifts, or explode the entity (not recommended if you want to keep it editable).\n- **Q: Can I use this on a flat floor?**\n  A: This script is designed specifically for `ERoofPlane` entities. For floors, use a floor-specific calculation script."
      },
      "tokens_used": 6260,
      "error": null
    }
  }
}