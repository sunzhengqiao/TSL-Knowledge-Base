{
  "filename": "hsb_DimensionWallLength.mcr",
  "status": "completed",
  "total_tokens": 28054,
  "processing_time": 178.87962794303894,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "08.03.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "15.03.2010",
            "author": "Jonathan Hand (jhand@itw-industry.com)",
            "changes": "Decimal Place removed from wall length"
          },
          {
            "version": "1.2",
            "date": "16.03.2010",
            "author": "Jonathan Hand (jhand@itw-industry.com)",
            "changes": "Assign the TSL to the element and to the display layer"
          },
          {
            "version": "1.3",
            "date": "24.03.2010",
            "author": "Jonathan Hand (jhand@itw-industry.com)",
            "changes": "This TSL wont be number anymore"
          },
          {
            "version": "1.5",
            "date": "23.05.2011",
            "author": "Jonathan Hand (jhand@itw-industry.com)",
            "changes": "Fix issue when the wall is split"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5506,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script casts _Element[0] to ElementWallSF and Wall types. It uses _bOnElementListModified to handle wall splitting logic, which is an event trigger for Model elements. No ShopDrawing specific entities (_Entity[]), sd_ prefixes, or Viewport interactions are found."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (Requires an Element to attach to)",
          "requiredSettings": []
        }
      },
      "tokens_used": 3804,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension Style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Offset",
            "defaultValue": "350",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDispRep",
            "type": "PropString",
            "displayName": "Show Dim in Disp Rep",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3507,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically labels the total length of a wall element in the 3D model, updating dynamically if the wall geometry changes or splits.",
          "category": "Annotation",
          "typicalUseCase": "Used during the design or detailing phase to clearly visualize and label the overall length of wall panels directly in the model view, ensuring the length information travels with the wall."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "(From CAD Standards)",
            "businessMeaning": "Selects the visual style of the dimension text (e.g., font size, arrow type, color) defined by the current CAD drafting standards.",
            "validRange": "List of available Dimension Styles in the project template",
            "unit": "String (Selection List)",
            "affectsOutput": "Changes the graphical appearance (font, color, arrows) of the length label text."
          },
          {
            "name": "dOffset",
            "technicalDefault": "350",
            "businessMeaning": "The distance the length label is placed away from the face of the wall (specifically the arrow side).",
            "validRange": "0 - 2000",
            "unit": "mm",
            "affectsOutput": "Moves the label text closer to or further from the wall surface to avoid clashes with other model elements."
          },
          {
            "name": "sDispRep",
            "technicalDefault": "(Empty)",
            "businessMeaning": "Restricts the label to appear only in specific display representations (e.g., 'Sketch', 'Model', 'Presentation'). If empty, it shows in all views.",
            "validRange": "Names of valid Display Representations in the project",
            "unit": "String",
            "affectsOutput": "Controls visibility of the dimension label in different CAD view states or detail levels."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User modifies 'sDimStyle'",
            "effect": "The text appearance updates immediately to match the selected standard.",
            "cascade": []
          },
          {
            "trigger": "User modifies 'sDispRep'",
            "effect": "The label may disappear from the current view if the current display representation does not match.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Text/Dimension",
            "description": "A text string displaying the wall length in parentheses, formatted to 0 decimal places (e.g., (5000)).",
            "appliedTo": "The specific Wall Element (ElementWallSF) selected by the user."
          }
        ]
      },
      "tokens_used": 3923,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script command launched",
          "2. System checks insert cycle count; aborts if > 1 to prevent loops",
          "3. System checks Execute Key; if empty, shows default property dialog",
          "4. User prompted to select elements (PrEntity)",
          "5. User confirms selection",
          "6. System iterates through selected elements",
          "7. For each element, a new instance of the script is generated (dbCreate)",
          "8. The original 'launcher' instance is erased",
          "9. [Runtime] Instance checks if element list is empty",
          "10. [Runtime] Instance checks if wall split occurred (_bOnElementListModified)",
          "11. [Runtime] Instance validates the attached element is a valid Wall (ElementWallSF)",
          "12. [Runtime] System calculates wall length and label position (including offset)",
          "13. [Runtime] System draws the dimension text on the calculated arrow side",
          "14. [Runtime] Script assigns itself to the element group"
        ],
        "conditionalBranches": [
          {
            "condition": "_bOnElementListModified is TRUE and _Element.length() > 1 (Wall Split Scenario)",
            "path1": {
              "name": "Relocate to Closest Segment",
              "steps": [
                "Iterate through all linked elements",
                "Project script anchor point (_Pt0) to each element's coordinate system",
                "Check if point is inside element envelope",
                "If outside, find closest point on envelope",
                "Calculate distance to anchor point",
                "Select the element with the minimum distance as the winner",
                "Replace index 0 of _Element array with the winner"
              ]
            },
            "path2": {
              "name": "Standard Attachment",
              "steps": [
                "Proceed with _Element[0] as the primary wall"
              ]
            }
          },
          {
            "condition": "Element Casting Validation",
            "path1": {
              "name": "Valid Wall",
              "steps": [
                "Cast _Element[0] to ElementWallSF succeeds",
                "Cast ElementWallSF to Wall succeeds",
                "Proceed to geometry calculation and drawing"
              ]
            },
            "path2": {
              "name": "Invalid Element",
              "steps": [
                "Cast fails (e.g., element deleted or wrong type)",
                "Script instance is erased immediately"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element array length",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script self-destructs if no elements are attached."
          },
          {
            "check": "Element Validity (ElementWallSF)",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script self-destructs if the attached element is not a valid Sandwich Wall."
          },
          {
            "check": "Wall Validity (Wall cast)",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script self-destructs if the element does not support Wall geometry methods."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Label Offset",
            "how": "OPM (Properties Palette) -> Modify 'Offset' (dOffset)",
            "effect": "The label moves closer to or further from the wall face along the normal vector."
          },
          {
            "action": "Change Dimension Style",
            "how": "OPM -> Modify 'Dimension Style' (sDimStyle)",
            "effect": "The font, color, and size of the length label update immediately."
          },
          {
            "action": "Control Visibility",
            "how": "OPM -> Modify 'Show Dim in Disp Rep' (sDispRep)",
            "effect": "The label is hidden or shown based on the current CAD display representation (e.g., Model vs Sketch)."
          },
          {
            "action": "Wall Modification (Stretch/Move)",
            "how": "CAD Modify commands on the Wall Element",
            "effect": "The length value and label position recalculate automatically to match the new geometry."
          },
          {
            "action": "Wall Splitting",
            "how": "CAD Split commands",
            "effect": "The script automatically detects the split, identifies the wall segment closest to its original position, re-attaches to that segment, and updates the length."
          }
        ]
      },
      "tokens_used": 6437,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_DimensionWallLength\n\n## Overview\nAutomatically labels the total length of a wall element in the 3D model view. The label updates dynamically if the wall geometry changes, is stretched, or is split.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script attaches to wall elements in the 3D model. |\n| Paper Space | No | Not intended for layout views. |\n| Shop Drawing | No | Not intended for manufacturing drawings. |\n\n## Prerequisites\n- **Required Entities:** ElementWallSF (Sandwich Wall)\n- **Minimum Beam Count:** 0\n- **Required Settings:** None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Browse and select `hsb_DimensionWallLength.mcr`\n\n### Step 2: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the Wall(s) you wish to label and press Enter.\n```\n*Note: The script will automatically create an instance on each selected wall and remove the initial \"launcher\" instance.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimension Style | dropdown | (From CAD Standards) | Selects the visual style (font, arrows, color) of the dimension text from your project standards. |\n| Offset | number | 350 | Sets the distance in millimeters (mm) that the label is placed away from the arrow side of the wall face. |\n| Show Dim in Disp Rep | text | (Empty) | Limits visibility to a specific Display Representation (e.g., \"Model\", \"Sketch\"). If left empty, the label is visible in all views. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific right-click menu options are added by this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Wall Splitting:** If you split a wall that has a label attached, this script will automatically detect the split and re-attach the label to the wall segment closest to its original position.\n- **Dynamic Updates:** You do not need to re-run the script if you change the wall length (e.g., by stretching or moving the wall). The dimension text updates automatically.\n- **Format:** The dimension text is displayed in parentheses with 0 decimal places (e.g., `(5000)`).\n- **Visibility Control:** Use the \"Show Dim in Disp Rep\" property to hide length labels during specific detailing phases (e.g., hide in \"Sketch\" mode but show in \"Presentation\" mode).\n\n## FAQ\n- **Q: Why did my label disappear?**\n  A: Check the \"Show Dim in Disp Rep\" property to ensure your current view mode matches the setting. Also, verify that the wall element has not been deleted.\n- **Q: Can I use this on floors or roofs?**\n  A: No, this script is designed specifically for `ElementWallSF` (Sandwich Wall) entities.\n- **Q: How do I change the text size or arrow style?**\n  A: Change the \"Dimension Style\" property in the Properties Palette to select a different standard style defined in your CAD template."
      },
      "tokens_used": 4877,
      "error": null
    }
  }
}