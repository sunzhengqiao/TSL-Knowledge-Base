{
  "filename": "hsbSplitSheets.mcr",
  "status": "completed",
  "total_tokens": 54194,
  "processing_time": 357.2340717315674,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.8\",\n      \"date\": \"19nov2018\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"minor bugfix\"\n    },\n    {\n      \"version\": \"1.7\",\n      \"date\": \"30may17\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"default value of width considers potential gap value in dialog preset\"\n    },\n    {\n      \"version\": \"1.6\",\n      \"date\": \"09dec15\",\n      \"author\": \"th@hsbCAD.de\",\n      \"changes\": \"properties categorized, splitted conversion results will create individual items, double click supported for conversion\"\n    },\n    {\n      \"version\": \"1.5\",\n      \"date\": \"25feb13\",\n      \"author\": \"th@hsbCAD.de\",\n      \"changes\": \"selection object changed to sheet, main property values taken from zone object, distribution from existing sheets enhanced\"\n    },\n    {\n      \"version\": \"1.4\",\n      \"date\": \"29.10.2010\",\n      \"author\": \"th@hsbCAD.de"
      },
      "tokens_used": 8972,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates and modifies 3D construction entities (Sheets and Beams) using dbCreate(). It retrieves Elements and Sheets via getSheet() and Element.append(). Logic relies on 3D PlaneProfile and Body operations. No viewport handling, Paper Space drawing calls, or ShopDrawing specific prefixes (#Type E, sd_) are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sheet",
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space with an existing Element containing Sheets",
          "requiredSettings": []
        }
      },
      "tokens_used": 6584,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getSheet\",\n        \"promptOriginal\": \"|Select a sheet of desired zone|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"|Select first distribution point|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"PrPoint (getPoint)\",\n        \"promptOriginal\": \"\\n|Select additional distribution point (optional)|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": false\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"ShowDialog\",\n      \"trigger\": \"After selecting points on insert\",\n      \"title\": \"Properties\",\n      \"dataSource\": \"Script Properties\",\n      \"features\": {}\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sComposeType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Source|\",\n      \"defaultValue\": \"|Zone contour|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Zone contour|\",\n        \"|Generated sheets|\"\n      ],\n      \"category\": \"|Compose Rule|\",\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dMergeGap\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Merge Gap|\",\n      \"defaultValue\": \"U(10)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Compose Rule|\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dWidth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Width|\",\n      \"defaultValue\": \"U(1250)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"dLength\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Length|\",\n      \"defaultValue\": \"U(3000)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"dThick\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Thickness|\",\n      \"defaultValue\": \"U(10)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"dGap\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Gap|\",\n      \"defaultValue\": \"U(10)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Geometry|\",\n      \"description\": null\n    },\n    {\n      \"index\": 6,\n      \"variable\": \"sMat\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Material|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"|Properties|\",\n      \"description\": null\n    },\n    {\n      \"index\": 7,\n      \"variable\": \"sLab\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Label|\",\n     "
      },
      "tokens_used": 10048,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically tiles an element zone (wall, floor, or roof) with rectangular panels, starting from a user-defined origin and distributing outwards to fill the shape.",
          "category": "Cladding / Framing",
          "typicalUseCase": "Generating floor decking (OSB/Plywood), CLT panels, or sheeting layers by filling a wall or floor contour with standard-sized sheets, cutting them around openings."
        },
        "parameters": [
          {
            "name": "sComposeType",
            "technicalDefault": "|Zone contour|",
            "businessMeaning": "Determines the boundary shape used for tiling. 'Zone contour' fills the entire element outline, while 'Generated sheets' only tiles areas where sheets currently exist (updating existing layouts).",
            "validRange": "Dropdown Selection",
            "unit": "Enum",
            "affectsOutput": "The total area covered by the new panels. Using 'Zone contour' fills holes, whereas 'Generated sheets' respects current placement."
          },
          {
            "name": "dMergeGap",
            "technicalDefault": "U(10)",
            "businessMeaning": "Tolerance distance used to merge adjacent profiles when the source is 'Generated sheets'. It effectively closes small gaps between existing sheets before calculating new tiles.",
            "validRange": "0 - 50 mm",
            "unit": "mm",
            "affectsOutput": "Prevents very thin slivers or gaps in the resulting tiling pattern when updating existing sheets."
          },
          {
            "name": "dWidth",
            "technicalDefault": "U(1250)",
            "businessMeaning": "The target width (nominal size) of the individual panels being generated along the element's X-axis.",
            "validRange": "100 - 3000 mm (depending on material)",
            "unit": "mm",
            "affectsOutput": "Sets the horizontal grid spacing for the tiling pattern."
          },
          {
            "name": "dLength",
            "technicalDefault": "U(3000)",
            "businessMeaning": "The target length (nominal size) of the individual panels being generated along the element's Y-axis.",
            "validRange": "100 - 12000 mm",
            "unit": "mm",
            "affectsOutput": "Sets the vertical grid spacing for the tiling pattern."
          },
          {
            "name": "dThick",
            "technicalDefault": "U(10)",
            "businessMeaning": "The material thickness of the panels to be generated.",
            "validRange": "6 - 300 mm",
            "unit": "mm",
            "affectsOutput": "The 3D depth of the generated Sheets or Beams."
          },
          {
            "name": "dGap",
            "technicalDefault": "U(10)",
            "businessMeaning": "The spacing (expansion gap) left between adjacent panels in the grid.",
            "validRange": "0 - 20 mm",
            "unit": "mm",
            "affectsOutput": "Physical separation between generated panels; higher values mean more, smaller panels to cover the same distance."
          },
          {
            "name": "sMat",
            "technicalDefault": "",
            "businessMeaning": "The material name/grade assigned to the generated panels.",
            "validRange": "Text (Catalog Name)",
            "unit": "String",
            "affectsOutput": "Material properties and hsbCAD catalog assignment."
          },
          {
            "name": "sLab",
            "technicalDefault": "",
            "businessMeaning": "The main label identifier for the panels.",
            "validRange": "Text",
            "unit": "String",
            "affectsOutput": "Reporting and labeling in drawings/lists."
          },
          {
            "name": "sSub",
            "technicalDefault": "",
            "businessMeaning": "The sub-label identifier for the panels.",
            "validRange": "Text",
            "unit": "String",
            "affectsOutput": "Detailed reporting and labeling."
          },
          {
            "name": "sGrade",
            "technicalDefault": "",
            "businessMeaning": "The structural grade or quality class of the material.",
            "validRange": "Text",
            "unit": "String",
            "affectsOutput": "Engineering properties and reporting."
          },
          {
            "name": "sConvertType",
            "technicalDefault": "|Beams|",
            "businessMeaning": "Specifies the type of CAD entity to create. 'Sheets' creates 2D contour objects with thickness, 'Beams' creates 3D volumetric bodies.",
            "validRange": "Dropdown Selection",
            "unit": "Enum",
            "affectsOutput": "Fundamental entity type in the CAD model (Sheet vs Beam)."
          },
          {
            "name": "nZone",
            "technicalDefault": "Index of selected sheet",
            "businessMeaning": "The specific construction layer (e.g., outer cladding, structure, inner lining) to generate panels within.",
            "validRange": "-5 to 5",
            "unit": "Index",
            "affectsOutput": "Determines the Z-height and layer assignment of the generated geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Script Insertion (reading Element Zone variables)",
            "effect": "Parameters are overwritten by values stored in the Element's Zone variables if they exist.",
            "cascade": [
              "nZone",
              "dThick",
              "dWidth",
              "dLength",
              "dGap",
              "sMat"
            ]
          },
          {
            "trigger": "Element Zone variable 'gap' exists",
            "effect": "The dWidth parameter is automatically calculated as (Zone Width - dGap) to ensure panels fit perfectly with the gap.",
            "cascade": [
              "dWidth",
              "dGap"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Sheet or Beam",
            "description": "Rectangular panels arranged in a grid, clipped to the zone contour and openings (windows/doors).",
            "appliedTo": "Selected Element and specific Zone."
          }
        ]
      },
      "tokens_used": 10443,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Insertion: Check for catalog usage to set initial properties.",
          "2. User Input: Prompt to select a reference Sheet to determine the target Element and Zone.",
          "3. Validation: Check if the selected Sheet belongs to a valid Element.",
          "4. User Input: Prompt to select the Origin Point (_Pt0) for distribution.",
          "5. User Input: Loop to select additional Split Points (_PtG) (optional, press Enter to finish).",
          "6. Property Initialization: Override script defaults with values from the Element Zone variables (Thickness, Width, Gap, Material).",
          "7. Adjustment: If Zone contains 'gap' and 'width', recalculate Width property (Width - Gap).",
          "8. User Interaction: Show Properties Dialog (OPM) for final adjustments.",
          "9. Visualization: Calculate the grid of rectangles based on properties and split points, clip them to the zone/profile, and display preview graphics.",
          "10. User Action: Edit properties, move grips (Origin/Split Points), or use Right-Click menu.",
          "11. Execution: Trigger 'Create' via Context Menu or Double-Click.",
          "12. Generation: Erase existing sheets in the zone (if non-debug) and generate new Sheets or Beams based on the calculated profile.",
          "13. Cleanup: Erase the script instance from the model."
        ],
        "conditionalBranches": [
          {
            "condition": "Selection of Source (sComposeType)",
            "path1": {
              "name": "Zone Contour",
              "steps": [
                "Fetch the Netto profile (gross outline minus openings) of the Element Zone.",
                "Use this profile to clip the generated grid."
              ]
            },
            "path2": {
              "name": "Generated Sheets",
              "steps": [
                "Find all existing sheets in the Element Zone.",
                "Merge (Union) their envelopes.",
                "Subtract their openings.",
                "Apply Merge Gap tolerance (shrink/expand) to clean small gaps.",
                "Use this composite profile to clip the generated grid."
              ]
            }
          },
          {
            "condition": "Selection of Target Object (sConvertType)",
            "path1": {
              "name": "Sheets",
              "steps": [
                "Iterate calculated profiles.",
                "Create Sheet entities using dbCreate (PlaneProfile).",
                "Assign material, label, and grade."
              ]
            },
            "path2": {
              "name": "Beams",
              "steps": [
                "Iterate calculated profiles.",
                "Create Body objects from profiles (extruded thickness).",
                "Create Beam entities using dbCreate.",
                "Assign material, label, and grade."
              ]
            }
          },
          {
            "condition": "Script Execution Mode",
            "path1": {
              "name": "Debug Mode",
              "steps": [
                "Visualize the calculated profiles and bodies.",
                "Skip actual creation (dbCreate) and erasure of entities.",
                "Skip erasure of the script instance."
              ]
            },
            "path2": {
              "name": "Production Mode",
              "steps": [
                "Erase existing sheets in the zone.",
                "Create new entities in the drawing.",
                "Erase the script instance after creation."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Selected Sheet belongs to a valid Element",
            "errorMessage": "|Sheet must belong to an element.| |Tool will be deleted.|",
            "recovery": "Script instance is erased immediately. User must select a sheet inside an hsbCAD Element."
          },
          {
            "check": "Element exists attached to script (Post-Insert)",
            "errorMessage": "None (Silent)",
            "recovery": "Script instance is erased immediately if the Element array is empty."
          },
          {
            "check": "Minimum Area/Volume",
            "errorMessage": "None (Silent filter)",
            "recovery": "Calculated profiles with area < 1mm^2 or Volume < 1mm^3 are skipped during generation to avoid invalid entities."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry Parameters",
            "how": "Properties Palette (OPM)",
            "effect": "Updating Width, Length, or Gap updates the grid preview immediately."
          },
          {
            "action": "Relocate Origin or Split Points",
            "how": "Grip Edit (Drag Points)",
            "effect": "The distribution grid recalculates starting from the new origin locations or stopping at new split points."
          },
          {
            "action": "Add more Split Points",
            "how": "Right-click Context Menu -> 'Add Split Points'",
            "effect": "Prompts user to select points which are added to the split list, creating new stopping/break lines in the grid."
          },
          {
            "action": "Generate Elements",
            "how": "Right-click Context Menu -> 'Create [Type]' or Double-Click",
            "effect": "Finalizes the script, erases old sheets, creates new Sheets/Beams, and removes the script."
          }
        ]
      },
      "tokens_used": 10780,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbSplitSheets.mcr\n\n## Overview\nThis script automatically tiles an element zone (wall, floor, or roof) with rectangular panels (sheets or beams). It allows you to fill a construction layer with standard-sized material starting from a user-defined origin, automatically cutting panels around openings and element boundaries.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D construction entities (Elements and Sheets). |\n| Paper Space | No | Not applicable for paper space layouts. |\n| Shop Drawing | No | This is a model generation tool, not a detailing tool. |\n\n## Prerequisites\n- **Required Entities**: An existing hsbCAD Element (Wall, Floor, or Roof) containing at least one Sheet.\n- **Minimum Beam Count**: 0.\n- **Required Settings**: None specific, though a Material Catalog is recommended for assigning properties.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbSplitSheets.mcr`\n\n### Step 2: Select Reference Sheet\n```\nCommand Line: |Select a sheet of desired zone|\nAction: Click on an existing sheet within the element/layer you wish to tile.\n```\n*This determines the target Element and the specific construction Zone (e.g., outer sheathing).*\n\n### Step 3: Define Origin Point\n```\nCommand Line: |Select first distribution point|\nAction: Click in the model to set where the tiling grid starts (usually a bottom corner).\n```\n\n### Step 4: Define Split Points (Optional)\n```\nCommand Line: |Select additional distribution point (optional)|\nAction: Click points to create \"stop lines\" for the tiling pattern, or press Enter to finish.\n```\n\n### Step 5: Configure Properties\n```\nAction: The Properties Palette (OPM) will open. Adjust panel size, gap, and material as needed.\n```\n*Note: Default values are automatically pulled from the Element's Zone properties if available.*\n\n### Step 6: Generate\n```\nAction: Double-click the script instance OR Right-click and select \"Create Sheets\" (or \"Create Beams\").\n```\n\n## Properties Panel Parameters\n\n### Compose Rule\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Source | dropdown | Zone contour | **Zone contour**: Fills the entire element outline.<br>**Generated sheets**: Only fills areas where sheets currently exist (updates layout). |\n| Merge Gap | number | 10 mm | Tolerance to merge adjacent profiles when updating existing sheets (closes small gaps). |\n\n### Geometry\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Width | number | 1250 mm | The target width of the panels along the element's X-axis. |\n| Length | number | 3000 mm | The target length of the panels along the element's Y-axis. |\n| Thickness | number | 10 mm | The material thickness of the panels. |\n| Gap | number | 10 mm | The spacing (expansion gap) left between adjacent panels. |\n\n### Properties\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Material | text | *empty* | The material name/grade assigned to the panels (from catalog). |\n| Label | text | *empty* | The main label identifier for the panels. |\n| Sub-label | text | *empty* | The sub-label identifier for the panels. |\n| Grade | text | *empty* | The structural grade or quality class. |\n\n### Output\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Convert Type | dropdown | Beams | **Sheets**: Creates 2D contour objects with thickness.<br>**Beams**: Creates 3D volumetric bodies. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Create Sheets / Create Beams | Finalizes the process, erases old sheets in the zone, and generates the new panels. |\n| Add Split Points | Allows you to select additional points to modify the grid layout after insertion. |\n| Erase | Removes the script instance without generating geometry. |\n\n## Settings Files\n- **Filename**: None specific (uses hsbCAD Catalogs).\n- **Location**: N/A\n- **Purpose**: Material properties are pulled from the standard hsbCAD Material Catalog.\n\n## Tips\n- **Updating Layouts**: If you have an existing sheet layout and want to modify it (e.g., change width), select **Source: \"Generated sheets\"**. The script will calculate the new layout based on where sheets currently exist rather than the whole wall contour.\n- **Gap Calculation**: If the Element Zone variables define a specific gap, the script will automatically calculate the `Width` property as `(Zone Width - Gap)` to ensure a perfect fit.\n- **Visual Feedback**: After insertion, you can drag the **Origin Point** and **Split Points** (grips) in the model to visually adjust the tiling pattern before creating it.\n- **Origin Point**: The first point you pick acts as the \"start\" corner. Ensure it is placed logically relative to how you want the sheets to run (e.g., bottom-left of a wall).\n\n## FAQ\n- **Q: What is the difference between creating Sheets vs Beams?**\n  - A: **Sheets** are typically used for 2D representations with thickness (like OSB or Plywood in plans). **Beams** are volumetric 3D objects (like CLT panels or Timber frames) that have true volume and may interact differently with other 3D operations.\n- **Q: Why did my script disappear after I clicked Create?**\n  - A: This is normal behavior. The script acts as a temporary \"calculator.\" Once you click \"Create,\" it produces the final geometry and removes itself from the model to prevent duplication.\n- **Q: Can I use this to floor a whole house?**\n  - A: Yes. Select the floor sheet, pick the origin, and ensure **Source** is set to \"Zone contour\" to fill the entire floor outline."
      },
      "tokens_used": 7367,
      "error": null
    }
  }
}