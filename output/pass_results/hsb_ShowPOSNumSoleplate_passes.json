{
  "filename": "hsb_ShowPOSNumSoleplate.mcr",
  "status": "completed",
  "total_tokens": 24435,
  "processing_time": 193.4300103187561,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "15.09.2009",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3852,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select beams directly from the model (_Beam.append(ssE.beamSet())) and manipulates geometry (Beam properties like ptCen, vecX, vecZ) in 3D. There are no sd_ prefixes, no Multipage references, and no interaction with _Viewport or Paper Space specific APIs. It draws geometry using the Display(dp) object in the 3D context."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 1770,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\\n|Select a set of beams|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialogOnce",
            "trigger": "Insertion (if _kExecuteKey is empty)",
            "title": null,
            "dataSource": "Internal Property Mapping",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dXOffset",
            "type": "PropDouble",
            "displayName": "X Offset",
            "defaultValue": "2 mm",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dYOffset",
            "type": "PropDouble",
            "displayName": "Y Offset",
            "defaultValue": "2 mm",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDispRep",
            "type": "PropString",
            "displayName": "Show in Disp Rep",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dim Style",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3070,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically annotates specific structural beams (Soleplates and Headbinders) with their Position Numbers (POS), wrapping the text in a Circle or Rectangle for clear visual identification.",
          "category": "Annotation / Labeling",
          "typicalUseCase": "Used during model detailing or drawing creation to visually mark specific wall plates or binders on the layout floor plan or 3D view to ensure they are easily distinguishable."
        },
        "parameters": [
          {
            "name": "dXOffset",
            "technicalDefault": "2 mm",
            "businessMeaning": "Displaces the label along the longitudinal axis (length) of the beam from its center point.",
            "validRange": "0 mm to 100 mm",
            "unit": "mm",
            "affectsOutput": "Shifts the text and surrounding shape (Circle/Rect) left or right along the beam."
          },
          {
            "name": "dYOffset",
            "technicalDefault": "2 mm",
            "businessMeaning": "Displaces the label vertically (relative to the beam height/width). Note: For Soleplates it moves in the positive Z direction; for Headbinders it moves in the negative Z direction.",
            "validRange": "-100 mm to 100 mm",
            "unit": "mm",
            "affectsOutput": "Shifts the text and surrounding shape up or down perpendicular to the beam's length."
          },
          {
            "name": "sDispRep",
            "technicalDefault": "",
            "businessMeaning": "Restricts the visibility of the labels to specific Display Representations (e.g., 'Presentation', 'Model', 'ShopDrawing').",
            "validRange": "Any valid Display Representation name in the drawing",
            "unit": "String",
            "affectsOutput": "Controls in which view modes or detailed drawing styles the labels appear."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Defines the font, size, and text style used for the Position Number.",
            "validRange": "Any valid Dimension Style name in the CAD template",
            "unit": "String",
            "affectsOutput": "Determines the text size. The script automatically scales the surrounding Circle (Soleplate) or Rectangle (Headbinder) to fit this text size (multiplied by 1.2)."
          },
          {
            "name": "nColor",
            "technicalDefault": "-1",
            "businessMeaning": "Sets the specific color for the text and the shape outline.",
            "validRange": "0-255 (AutoCAD Color Index), or -1 for ByBlock/Layer default",
            "unit": "Color Index",
            "affectsOutput": "Changes the color of the drawn text and geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change in sDimStyle (Text Height/Length)",
            "effect": "The size of the Circle (for Soleplates) or Rectangle (for Headbinders) automatically recalculates to be 1.2x the text size.",
            "cascade": [
              "Geometry Size"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Annotation Geometry",
            "description": "Text element (POS number) and a bounding shape: A Circle for elements named 'SOLEPLATE' and a Rectangle for elements named 'HEADBINDER'.",
            "appliedTo": "Selected GenBeams with the name 'SOLEPLATE' or 'HEADBINDER'."
          }
        ]
      },
      "tokens_used": 4619,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution initiated (On Insert or Recalc)",
          "Check insertCycleCount (Safety check for duplicate execution)",
          "Check if _kExecuteKey is empty (Determines if Catalog preset is used)",
          "If empty: Display Property Dialog (showDialogOnce) for user input",
          "Prompt user to select a set of beams via PrEntity",
          "Store selected beams in _Beam set",
          "Verify that _Beam set contains at least one beam",
          "Initialize Display object (dp) with Color, DimStyle, and DispRep settings",
          "Loop through each beam in the _Beam set",
          "Retrieve and sanitize beam name (Upper case, Trimmed)",
          "Check if beam has a valid Position Number (POS)",
          "Check beam name against recognized types ('SOLEPLATE', 'HEADBINDER')",
          "Calculate text dimensions and label position based on offsets",
          "Draw Text and bounding shape (Circle for Soleplate, Rect for Headbinder)",
          "Script finishes processing"
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count > 1",
            "path1": {
              "name": "Duplicate Execution",
              "steps": [
                "Erase current instance",
                "Return immediately (End Script)"
              ]
            },
            "path2": {
              "name": "First Execution",
              "steps": [
                "Continue to Execute Key check"
              ]
            }
          },
          {
            "condition": "Beam Name",
            "path1": {
              "name": "SOLEPLATE",
              "steps": [
                "Calculate size based on max Text Height/Length",
                "Calculate Center Position (+vecZ*YOffset)",
                "Create PLine Circle",
                "Draw Text and Circle"
              ]
            },
            "path2": {
              "name": "HEADBINDER",
              "steps": [
                "Calculate dimensions (1.2x Height/Length)",
                "Calculate Center Position (-vecZ*YOffset)",
                "Create PLine Rectangle",
                "Draw Text and Rectangle"
              ]
            },
            "path3": {
              "name": "Other/Unknown",
              "steps": [
                "Ignore beam (No drawing)"
              ]
            }
          },
          {
            "condition": "Beam Position Number (nPOS)",
            "path1": {
              "name": "Valid POS (Not -1)",
              "steps": [
                "Process beam for labeling"
              ]
            },
            "path2": {
              "name": "Invalid/No POS (-1)",
              "steps": [
                "Skip to next beam (Continue loop)"
              ]
            }
          },
          {
            "condition": "Selection Set Validity",
            "path1": {
              "name": "Empty Set (< 1 beam)",
              "steps": [
                "Erase Instance",
                "Return immediately"
              ]
            },
            "path2": {
              "name": "Valid Set (>= 1 beam)",
              "steps": [
                "Proceed to initialization and loop"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection Set Count",
            "errorMessage": "No error message shown to user.",
            "recovery": "If no beams are selected or appended during the PrEntity step, the script instance self-destructs (eraseInstance). The user must re-run the command and ensure they select at least one beam."
          },
          {
            "check": "Beam Name",
            "errorMessage": "No error message shown to user.",
            "recovery": "If the beam name does not exactly match 'SOLEPLATE' or 'HEADBINDER' (case-insensitive), it is ignored. The user must rename the element in the hsbCAD properties or select the correct elements."
          },
          {
            "check": "Position Number Assignment",
            "errorMessage": "No error message shown to user.",
            "recovery": "If bm.posnum() returns -1 (unassigned), the beam is skipped. The user must assign valid Position Numbers to the beams in the model."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify OPM Properties (Offsets, Style, Color)",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Script recalculates automatically. The text size, shape size (Circle/Rect), position offsets, and color update immediately for all linked beams."
          },
          {
            "action": "Change Beam Geometry/Name",
            "how": "hsbCAD Entity Edit / AutoCAD Grips",
            "effect": "If the center point (ptCen) or orientation changes, the label moves. If the name changes, the label shape might switch (Circle <-> Rect) or disappear."
          }
        ]
      },
      "tokens_used": 5615,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ShowPOSNumSoleplate.mcr\n\n## Overview\nThis script automatically annotates structural beams—specifically Soleplates and Headbinders—with their Position Numbers (POS). It draws the number inside a Circle (for Soleplates) or a Rectangle (for Headbinders) and allows for visual customization via the Properties Panel.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates directly on 3D beams in the model. |\n| Paper Space | No | Not designed for use in Layout tabs. |\n| Shop Drawing | No | Not intended for generation within shop drawing views. |\n\n## Prerequisites\n- **Required Entities**: Beams must exist in the model.\n- **Naming Convention**: Beams must be named exactly `SOLEPLATE` or `HEADBINDER` (case-insensitive) to be recognized.\n- **Position Numbers**: Selected beams must have a valid Position Number assigned (POS number cannot be -1).\n- **Minimum Beams**: You must select at least one beam during insertion.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the AutoCAD command line.\n2.  Select `hsb_ShowPOSNumSoleplate.mcr` from the file list.\n\n### Step 2: Configure Initial Settings\n1.  If no catalog preset is active, a dialog may appear to set initial properties (such as Offset, Color, etc.).\n2.  Adjust values if necessary and click OK.\n\n### Step 3: Select Beams\n```\nCommand Line: Select a set of beams\nAction: Click on the beams you wish to label (Soleplates or Headbinders) and press Enter.\n```\n*Note: The script will immediately filter the selection. Beams with incorrect names or missing POS numbers will be ignored.*\n\n### Step 4: Adjust Visuals (Optional)\n1.  Select the generated script instance in the drawing (if visible) or use Quick Select to find it.\n2.  Open the **Properties Palette** (Ctrl+1).\n3.  Modify `X Offset`, `Y Offset`, `Dim Style`, or `Color` to adjust the label appearance and location.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **X Offset** | Number | 2 mm | Moves the label along the length of the beam (longitudinal axis). |\n| **Y Offset** | Number | 2 mm | Moves the label perpendicular to the beam. <br>• **Soleplate**: Moves in positive Z direction (up).<br>• **Headbinder**: Moves in negative Z direction (down). |\n| **Show in Disp Rep** | Text | (Empty) | Limits label visibility to specific Display Representations (e.g., \"Presentation\"). Leave empty to show in all. |\n| **Dim Style** | Dropdown | _DimStyles | Sets the text style (font and size). <br>*Note: The Circle or Rectangle size automatically scales to 1.2x the text height defined in this style.* |\n| **Color** | Number | -1 | Sets the color of the text and outline shape. Use -1 for \"ByBlock\" (default layer color). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add custom items to the right-click context menu. Use the standard Properties Palette to modify parameters. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: This script relies on internal logic and standard AutoCAD Dimension Styles rather than external XML settings files.\n\n## Tips\n- **Label Shape**: The script automatically chooses the shape based on the beam name: **SOLEPLATE** gets a Circle, **HEADBINDER** gets a Rectangle.\n- **Sizing**: If the text looks too small or the surrounding shape is too tight, change the `Dim Style` property to a style with larger text height. The geometry will resize automatically.\n- **Direction**: Remember that the `Y Offset` behaves differently depending on whether the beam is a Soleplate or a Headbinder (Up vs. Down).\n- **Troubleshooting**: If the script seems to disappear immediately after running, it likely means no valid beams were found (wrong name or missing POS number).\n\n## FAQ\n- **Q: Why did the script not create any labels?**\n  **A:** Check the beam names. They must be exactly \"SOLEPLATE\" or \"HEADBINDER\". Also, ensure the beams have a Position Number assigned (not -1).\n- **Q: How do I change the size of the circle or rectangle?**\n  **A:** You cannot resize the shape directly. Change the `Dim Style` property to a style with a different text height. The label and its bounding shape will scale together.\n- **Q: The labels are appearing in the wrong view style.**\n  **A:** Enter a valid Display Representation name (e.g., \"Model\" or \"Presentation\") in the `Show in Disp Rep` property to restrict visibility."
      },
      "tokens_used": 5509,
      "error": null
    }
  }
}