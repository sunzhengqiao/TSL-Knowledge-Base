{
  "filename": "HSB_I-ShowElementInfo.mcr",
  "status": "completed",
  "total_tokens": 42983,
  "processing_time": 656.7386982440948,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "Displays element's basic info",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "15.05.2017",
            "author": "DR",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "18.05.2017",
            "author": "DR",
            "changes": "Added several props."
          },
          {
            "version": "1.02",
            "date": "18.05.2017",
            "author": "DR",
            "changes": "Element's basic measures valid for roof elements"
          },
          {
            "version": "1.03",
            "date": "13.06.2017",
            "author": "DR",
            "changes": "Added visibility on top view yes/no. Added new lines for tokens at custom text prop."
          },
          {
            "version": "1.04",
            "date": "13.03.2019",
            "author": "DR",
            "changes": "Element's type, code and number now can be turn on/off individually"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6392,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly creates instances in _kModelSpace during insertion logic (`tslNew.dbCreate(..., _kModelSpace, ...)`). Utilizes the Display class for drawing text and polylines directly. Contains no Shop Drawing specific functions (no `sd_` prefix, no `Sheet` usage, no `_Viewport` usage). Validates `_Element.length()` to ensure attachment to a single Element entity."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 4703,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select elements|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"showDialog\",\n      \"trigger\": \"_bOnInsert\",\n      \"title\": \"Properties\",\n      \"dataSource\": \"OPM Properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 7,\n      \"variable\": \"sShowType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Element"
      },
      "tokens_used": 7921,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Annotates Timber Elements (Walls/Roofs) in the 3D model with informational tags such as ID, dimensions, and user-defined notes.\",\n    \"category\": \"Information/Annotation\",\n    \"typicalUseCase\": \"Labeling structural elements in assembly views or plans to verify identification codes, types, and quantities without opening individual element properties.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sShowType\",\n      \"technicalDefault\": \"\\\"|Yes|\\\"\",\n      \"businessMeaning\": \"Controls the visibility of the Element's category (e.g., 'Wall', 'Roof', 'Floor') in the label.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Boolean/String\",\n      \"affectsOutput\": \"Hides or shows the first line of text indicating the element type.\"\n    },\n    {\n      \"name\": \"sShowCode\",\n      \"technicalDefault\": \"\\\"|Yes|\\\"\",\n      \"businessMeaning\": \"Controls the visibility of the Element Code (unique identifier) in the label.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Boolean/String\",\n      \"affectsOutput\": \"Adds the element code to the text string (usually hyphenated after the type).\"\n    },\n    {\n      \"name\": \"sShowNumber\",\n      \"technicalDefault\": \"\\\"|Yes|\\\"\",\n      \"businessMeaning\": \"Controls the visibility of the Element Number (sorting/sequence number) in the label.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Boolean/String\",\n      \"affectsOutput\": \"Adds the element number to the text string (usually hyphenated after the code).\"\n    },\n    {\n      \"name\": \"sCustomText\",\n      \"technicalDefault\": \"\\\"\\\"\",\n      \"businessMeaning \"Allows entry of specific notes or instructions (e.g., 'Crane required', 'Check height'). Multiple lines are supported by separating text with semicolons.\",\n      \"validRange\": \"Any ASCII string\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Displays additional lines of text below the standard element info.\"\n    },\n    {\n      \"name\": \"sShowDefinition\",\n      \"technicalDefault\": \"\\\"|No|\\\"\",\n      \"businessMeaning\": \"Toggles the display of the Element's internal construction definition name.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Boolean/String\",\n      \"affectsOutput\": \"Adds a line showing the specific definition name used to generate the element.\"\n    },\n    {\n      \"name\": \"sShowQuantity\",\n      \"technicalDefault\": \"\\\"|No|\\\"\",\n      \"businessMeaning\": \"Toggles the display of the Element's quantity.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Boolean/String\",\n      \"affectsOutput\": \"Adds a line showing the quantity of the element.\"\n    },\n    {\n      \"name\": \"sShowEnvelopeLines\",\n      \"technicalDefault\": \"\\\"|No|\\\"\",\n      \"businessMeaning\": \"Visualizes the physical bounding box (envelope) and outline of the element.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Boolean/String\",\n      \"affectsOutput\": \"Draws the geometry of the element's perimeter at its location.\"\n    },\n    {\n      \"name\": \"sShowPointer\",\n      \"technicalDefault\": \"\\\"|No|\\\"\",\n      \"businessMeaning\": \"Draws a leader line (pointer) connecting the text label to the element.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Boolean/String\",\n      \"affectsOutput\": \"Draws a polyline from the element center to the text location.\"\n    },\n    {\n      \"name\": \"sVisibleOnTopViewOnly\",\n      \"technicalDefault\": \"\\\"|No|\\\"\",\n      \"businessMeaning\": \"Restricts the visibility of the label to Plan (Top) views only.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Boolean/String\",\n      \"affectsOutput\": \"Hides the text and graphics if the view direction is not looking down the Z-axis.\"\n    },\n    {\n      \"name\": \"sInvertOrder\",\n      \"technicalDefault\": \"\\\"|No|\\\"\",\n      \"businessMeaning\": \"Reverses the vertical stacking order of the text lines.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Boolean/String\",\n      \"affectsOutput\": \"Text lines stack upwards instead of downwards relative to the insertion point.\"\n    },\n    {\n      \"name\": \"sAlignment\",\n      \"technicalDefault\": \"\\\"|Centered|\\\"\",\n      \"businessMeaning\": \"Sets the justification of the text block relative to the insertion grip point.\",\n      \"validRange\": \"Centered, Right, Left\",\n      \"unit\": \"Alignment\",\n      \"affectsOutput\": \"Text is aligned left, right, or centered around the text insertion point.\"\n    },\n    {\n      \"name\": \"dimStyle\",\n      \"technicalDefault\": \"\\\"\\\"\",\n      \"businessMeaning\": \"Selects the CAD Dimension Style to be used for the text font and appearance.\",\n      \"validRange\": \"Available DimStyles in drawing\",\n      \"unit\": \"Style\",\n      \"affectsOutput\": \"Changes the font and arrow style of the text.\"\n    },\n    {\n      \"name\": \"textSize\",\n      \"technicalDefault\": \"U(100)\",\n      \"businessMeaning\": \"Sets the height of the annotation text in model units.\",\n      \"validRange\": \"50 - 500 (depending on plot scale)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Scales the text height up or down.\"\n    },\n    {\n      \"name\": \"textColor\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Sets the CAD Color Index for the text and pointer lines.\",\n      \"validRange\": \"0 - 255\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Changes the color of the displayed annotation.\"\n    },\n    {\n      \"name\": \"_PtG\",\n      \"technicalDefault\": \"Computed (Element Center - Offset)\",\n      \"businessMeaning\": \"The location grip for the text label block.\",\n      \"validRange\": \"Any 3D Point\",\n      \"unit\": \"Coordinates\",\n      \"affectsOutput\": \"Moves the text label. The pointer line updates to connect to this point.\"\n    },\n    {\n      \"name\": \"_Pt0\",\n      \"technicalDefault\": \"Computed (Element Center)\",\n      \"businessMeaning\": \"The anchor point on the element where the pointer line starts.\",\n      \"validRange\": \"Any 3D Point\",\n      \"unit\": \"Coordinates\",\n      \"affectsOutput\": \"Moves the start point of the pointer line.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"Moving _PtG too close to _Pt0\",\n      \"effect\": \"The script automatically pushes _PtG further away to prevent overlap.\",\n      \"cascade\": [\"_PtG\"]\n    },\n    {\n      \"trigger\": \"Setting sInvertOrder to Yes\",\n      \"effect\": \"The vertical spacing multiplier changes sign,"
      },
      "tokens_used": 7720,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched",
          "Check for Execute Key and load catalog properties if present",
          "Enter Insertion Mode (_bOnInsert)",
          "Check insertCycleCount; exit if cycle > 1 to prevent duplicates",
          "Display Properties Dialog (showDialog) if no valid Execute Key is provided",
          "Prompt user to select Element(s) via command line (PrEntity)",
          "Iterate through selected elements",
          "For each element: Create a new TSL instance attached to that element in ModelSpace (dbCreate)",
          "Erase the original script instance",
          "Enter Instance Execution Mode (_bOnDbCreated / Update)",
          "Load properties from '_LastInserted' catalog if manually inserted",
          "Validate Attachment: Check if exactly 1 Element is linked",
          "Validate Entity: Check if the linked Element is valid (bIsValid)",
          "Calculate Element geometry (Center Point, Width, Height, Length, CoordSys)",
          "Initialize Text Position Grip (_PtG) if undefined (default offset)",
          "Initialize Anchor Point (_Pt0) on Insert/Update",
          "Configure Display object (Color, DimStyle, Text Size, View Direction)",
          "Construct Text String: Append Type, Code, and Number based on toggle properties",
          "Draw Main Text Label",
          "Process Custom Text: Split string by semicolons and draw multiple lines",
          "Draw Definition and Quantity if toggled on",
          "Draw Pointer Line if toggled on",
          "Draw Envelope/Outline polylines if toggled on",
          "Safety Check: Ensure _PtG and _Pt0 are not overlapping (move if distance < 1mm)"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase Instance",
                "Return (Exit)"
              ]
            },
            "path2": {
              "name": "Cycle = 1",
              "steps": [
                "Continue to Dialog or Selection"
              ]
            }
          },
          {
            "condition": "Execute Key Status",
            "path1": {
              "name": "Execute Key Found",
              "steps": [
                "Load props from catalog",
                "Skip Dialog"
              ]
            },
            "path2": {
              "name": "No Execute Key",
              "steps": [
                "Show Properties Dialog"
              ]
            }
          },
          {
            "condition": "Element Selection (PrEntity)",
            "path1": {
              "name": "User Cancels or Selects Nothing",
              "steps": [
                "Erase Instance",
                "Return"
              ]
            },
            "path2": {
              "name": "User Selects Elements",
              "steps": [
                "Loop through selection",
                "Create instances"
              ]
            }
          },
          {
            "condition": "Element Attachment Validation (_Element.length)",
            "path1": {
              "name": "Length != 1",
              "steps": [
                "Erase Instance",
                "Return (Error State)"
              ]
            },
            "path2": {
              "name": "Length == 1",
              "steps": [
                "Proceed to geometry calculation"
              ]
            }
          },
          {
            "condition": "View Visibility (sVisibleOnTopViewOnly)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Add View Direction Constraint (Top View only)"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Visible in all views"
              ]
            }
          },
          {
            "condition": "Element Type Classification",
            "path1": {
              "name": "ElementWall",
              "steps": [
                "Set text to 'Wall'"
              ]
            },
            "path2": {
              "name": "ElementRoof",
              "steps": [
                "Check if Floor or Roof",
                "Set text accordingly"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Attachment Count",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script erases itself if not attached to exactly one Element."
          },
          {
            "check": "Element Validity (bIsValid)",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script erases itself if the attached Element is deleted or invalid."
          },
          {
            "check": "Grip Proximity (_Pt0 vs _PtG)",
            "errorMessage": "None (Auto-correction)",
            "recovery": "Script automatically pushes _PtG 50 units away from _Pt0 if they are within 1mm of each other to prevent text overlap."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Text Label",
            "how": "Drag the _PtG (Text Location) grip",
            "effect": "Relocates the text block and updates the start point of the pointer line."
          },
          {
            "action": "Move Pointer Anchor",
            "how": "Drag the _Pt0 (Anchor) grip",
            "effect": "Moves the start point of the pointer line on the element."
          },
          {
            "action": "Toggle Visibility Options",
            "how": "OPM Properties (sShowType, sShowCode, sShowNumber, etc.)",
            "effect": "Dynamically adds or removes lines of text and graphics (Pointer/Envelope)."
          },
          {
            "action": "Modify Text Appearance",
            "how": "OPM Properties (textSize, textColor, dimStyle)",
            "effect": "Updates font size, color, and style immediately."
          },
          {
            "action": "Update Geometry",
            "how": "Modify the attached Element (e.g., stretch wall)",
            "effect": "Script recalculates center point, dimensions, and envelope lines automatically."
          }
        ]
      },
      "tokens_used": 8766,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_I-ShowElementInfo.mcr\n\n## Overview\nThis script creates informational labels for timber elements (Walls, Roofs, and Floors) directly in the 3D model. It displays data such as Element Type, Code, Number, Dimensions, and user-defined custom notes.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates within the 3D model environment. |\n| Paper Space | No | Not intended for 2D layout sheets. |\n| Shop Drawing | No | Not intended for manufacturing views. |\n\n## Prerequisites\n- **Required Entities**: An existing hsbCAD Element (Wall, Roof, or Floor).\n- **Minimum Beam Count**: None (Script attaches to Elements, not individual beams).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Select `HSB_I-ShowElementInfo.mcr` from the list.\n\n### Step 2: Configure Properties\n1. The **Properties** dialog (or the AutoCAD Properties Palette) will appear.\n2. Adjust settings such as **Text Size**, **Text Color**, and which information fields to display (Type, Code, Number).\n3. Click **OK** to confirm.\n\n### Step 3: Select Elements\n1. The command line will prompt: `Select elements`\n2. Click on the desired Wall, Roof, or Floor element in your drawing.\n3. Press **Enter** to confirm selection.\n\n### Step 4: Position Label\n1. The script will generate the text label at the element's center.\n2. Click the **Square Grip** (_PtG) on the text to drag it to a clear location.\n3. (Optional) If **Show Pointer** is enabled, a leader line will connect the text to the element.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Element Type | String (Yes/No) | Yes | Shows the category (e.g., Wall, Roof). |\n| Element Code | String (Yes/No) | Yes | Shows the unique Element Code. |\n| Element Number | String (Yes/No) | Yes | Shows the Element Number (sorting index). |\n| Custom Text | String | Empty | Allows user notes. Use a semicolon (;) to start a new line. |\n| Show Definition | String (Yes/No) | No | Shows the internal construction definition name. |\n| Show Quantity | String (Yes/No) | No | Shows the quantity of the element. |\n| Show Envelope | String (Yes/No) | No | Draws the physical bounding box outline of the element. |\n| Show Pointer | String (Yes/No) | No | Draws a leader line from the element to the text. |\n| Visible On Top View Only | String (Yes/No) | No | If Yes, hides the label when viewing in 3D or elevation. |\n| Invert Order | String (Yes/No) | No | Stacks text lines upwards instead of downwards. |\n| Alignment | String (Centered/Right/Left) | Centered | Sets the justification of the text block. |\n| DimStyle | String | Current | Selects the Dimension Style for font appearance. |\n| Text Size | Double | 100 | Sets the height of the text in model units. |\n| Text Color | Integer | 0 | Sets the CAD Color Index (0-255) for the text and lines. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the label to reflect changes in the Element's geometry or updated properties. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not require external settings files. It remembers the last used settings automatically via the `_LastInserted` catalog.\n\n## Tips\n- **Multi-line Notes**: To write multiple lines in the **Custom Text** property, type a semicolon `;` where you want the line break (e.g., `Check height;Crane required`).\n- **Moving Text**: Always use the square grip point on the text to move it. The leader line (if active) will automatically adjust.\n- **Plan Labels**: Set **Visible On Top View Only** to **Yes** if you only want these labels cluttering your plan views and not your 3D presentation views.\n- **Auto-Correction**: If you drag the text grip too close to the element center, the script will automatically push it away slightly to ensure readability.\n\n## FAQ\n- **Q: Why did my label disappear?**\n  - A: The script erases itself automatically if it is not attached to exactly one valid Element. Check if you deleted the element or if the selection filter picked up multiple objects during insertion.\n\n- **Q: How do I change the text size after inserting?**\n  - A: Select the text label, open the **Properties Palette** (Ctrl+1), and modify the **Text Size** value. Then run **Recalculate** from the right-click menu.\n\n- **Q: Can I use this for beams?**\n  - A: No, this script is designed specifically for hsbCAD Elements (Wall/Roof/Floor entities).\n\n- **Q: The text is too small in my plan view.**\n  - A: Increase the **Text Size** parameter. If your plan view uses a detail scale (e.g., 1:50), you may need to increase the text size significantly (e.g., to 200 or 500) to appear legibly when plotted."
      },
      "tokens_used": 7481,
      "error": null
    }
  }
}