{
  "filename": "hsbKingPostTenon.mcr",
  "status": "completed",
  "total_tokens": 52637,
  "processing_time": 220.64588284492493,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl creates a tenon connection between a joist and a post.\nWhen another joist is connected at the same level with the same tsl the intersecting part gets cut off by a 4mm tolerance.",
        "versionHistory": [
          {
            "version": "1.2",
            "date": "29Oct2020",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-9322: add properties nR drills, distance between drills"
          },
          {
            "version": "1.1",
            "date": "07Jul2020",
            "author": "geoffroy.cenni@hsbcad.com",
            "changes": "Added a heart offset for the drill & multi beam select"
          },
          {
            "version": "1.0",
            "date": "05Jun2020",
            "author": "geoffroy.cenni@hsbcad.com",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8682,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _kModelSpace explicitly in tslNew.dbCreate call. Logic focuses on 3D solid operations (Cut, Drill, Slot, DoubleCut) applied to GenBeam entities. No ShopDrawing (sd_*) API calls or #Type E Entity filters found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Requires selection of two intersecting beams (one identified as the post, typically vertical, and one as the joist) in Model Space.",
          "requiredSettings": []
        }
      },
      "tokens_used": 6111,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && _kExecuteKey.length() == 0",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select beams",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "Insertion (if no execute key provided)",
            "title": null,
            "dataSource": "Script Properties (Catalog/Defaults)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dShoulder",
            "type": "PropDouble",
            "displayName": "Width",
            "defaultValue": 30,
            "inputType": "number",
            "options": [],
            "category": "Shoulder",
            "description": "Defines the Width"
          },
          {
            "index": 1,
            "variable": "dPenDepth",
            "type": "PropDouble",
            "displayName": "Diameter",
            "defaultValue": 22,
            "inputType": "number",
            "options": [],
            "category": "Pen",
            "description": "Defines the Diameter"
          },
          {
            "index": 2,
            "variable": "dPenHeight",
            "type": "PropDouble",
            "displayName": "Height",
            "defaultValue": 90,
            "inputType": "number",
            "options": [],
            "category": "Pen",
            "description": "Defines the Height from bottom"
          },
          {
            "index": 3,
            "variable": "dPenHeartOffset",
            "type": "PropDouble",
            "displayName": "Heart Offset",
            "defaultValue": 10,
            "inputType": "number",
            "options": [],
            "category": "Pen",
            "description": "Defines the Heart Offset"
          },
          {
            "index": 0,
            "variable": "nNr",
            "type": "PropInt",
            "displayName": "Nr",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": "Pen",
            "description": "Defines the Nr"
          },
          {
            "index": 4,
            "variable": "dPenDistance",
            "type": "PropDouble",
            "displayName": "Distance",
            "defaultValue": 25,
            "inputType": "number",
            "options": [],
            "category": "Pen",
            "description": "Defines the Distance"
          },
          {
            "index": 5,
            "variable": "dTenonHeight",
            "type": "PropDouble",
            "displayName": "Height",
            "defaultValue": 180,
            "inputType": "number",
            "options": [],
            "category": "Tenon",
            "description": "Defines the Height"
          },
          {
            "index": 6,
            "variable": "dTenonHeightExtra",
            "type": "PropDouble",
            "displayName": "Height Tolerance",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": "Tenon",
            "description": "Defines the Height Tolerance"
          },
          {
            "index": 7,
            "variable": "dTenonLength",
            "type": "PropDouble",
            "displayName": "Length",
            "defaultValue": 100,
            "inputType": "number",
            "options": [],
            "category": "Tenon",
            "description": "Defines the Length"
          },
          {
            "index": 8,
            "variable": "dTenonLengthExtra",
            "type": "PropDouble",
            "displayName": "Length Tolerance",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": "Tenon",
            "description": "Defines the Length Tolerance"
          },
          {
            "index": 9,
            "variable": "dTenonWidth",
            "type": "PropDouble",
            "displayName": "Width",
            "defaultValue": 60,
            "inputType": "number",
            "options": [],
            "category": "Tenon",
            "description": "Defines the Width"
          },
          {
            "index": 10,
            "variable": "dTenonWidthExtra",
            "type": "PropDouble",
            "displayName": "Width Tolerance",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": "Tenon",
            "description": "Defines the Width Tolerance"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8598,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a traditional timber frame King Post tenon joint, cutting a tenon on the joist, a mortise slot in the post, and drilling holes for wooden dowels (pegs).",
          "category": "Joinery",
          "typicalUseCase": "Used to connect a horizontal beam (joist) to a vertical support (post) in timber framing, ensuring structural transfer of loads via a mortise and tenon connection secured by pegs."
        },
        "parameters": [
          {
            "name": "dShoulder",
            "technicalDefault": 30,
            "businessMeaning": "The depth of the horizontal cut (housing) on the post where the joist seats, measured from the post face.",
            "validRange": "10-100",
            "unit": "mm",
            "affectsOutput": "Determines how deep the joist sits into the post; cuts a rectangular recess on the post face."
          },
          {
            "name": "dPenDepth",
            "technicalDefault": 22,
            "businessMeaning": "The diameter of the wooden dowel (peg) used to fasten the joint.",
            "validRange": "12-36",
            "unit": "mm",
            "affectsOutput": "Sets the diameter of the drill hole passing through both the tenon and the post."
          },
          {
            "name": "dPenHeight",
            "technicalDefault": 90,
            "businessMeaning": "The vertical position of the dowel hole center measured from the bottom of the joist/tenon.",
            "validRange": "30-300",
            "unit": "mm",
            "affectsOutput": "Moves the drill hole up or down along the vertical axis of the tenon."
          },
          {
            "name": "dPenHeartOffset",
            "technicalDefault": 10,
            "businessMeaning": "The lateral offset of the dowel hole from the centerline (heart) of the tenon towards the face.",
            "validRange": "0-50",
            "unit": "mm",
            "affectsOutput": "Shifts the hole laterally; often used to avoid the heartwood or to place the peg in shear through the grain."
          },
          {
            "name": "nNr",
            "technicalDefault": 1,
            "businessMeaning": "The number of dowel (peg) holes to drill for the connection.",
            "validRange": "1-3",
            "unit": "count",
            "affectsOutput": "Creates multiple drilled holes distributed along the joint if greater than 1."
          },
          {
            "name": "dPenDistance",
            "technicalDefault": 25,
            "businessMeaning": "The center-to-center spacing between multiple dowel holes.",
            "validRange": "20-100",
            "unit": "mm",
            "affectsOutput": "Controls the gap between subsequent drill holes when nNr > 1."
          },
          {
            "name": "dTenonHeight",
            "technicalDefault": 180,
            "businessMeaning": "The vertical height of the tenon protruding from the joist.",
            "validRange": "50-400",
            "unit": "mm",
            "affectsOutput": "Defines the vertical cheeks cut on the joist and the height of the slot in the post."
          },
          {
            "name": "dTenonHeightExtra",
            "technicalDefault": 2,
            "businessMeaning": "The vertical clearance (gap) added to the mortise slot in the post to allow for easy insertion.",
            "validRange": "0-5",
            "unit": "mm",
            "affectsOutput": "Makes the slot in the post slightly taller than the tenon to prevent binding."
          },
          {
            "name": "dTenonLength",
            "technicalDefault": 100,
            "businessMeaning": "The depth that the tenon penetrates into the post.",
            "validRange": "50-300",
            "unit": "mm",
            "affectsOutput": "Determines the depth of the slot in the post and the length of the tenon projection."
          },
          {
            "name": "dTenonLengthExtra",
            "technicalDefault": 2,
            "businessMeaning": "The longitudinal clearance (gap) added to the mortise slot in the post.",
            "validRange": "0-5",
            "unit": "mm",
            "affectsOutput": "Ensures the tenon bottom does not bottom out in the slot."
          },
          {
            "name": "dTenonWidth",
            "technicalDefault": 60,
            "businessMeaning": "The width of the tenon (typically matching the joist width).",
            "validRange": "30-200",
            "unit": "mm",
            "affectsOutput": "Controls the width of the tenon reduction and the corresponding slot width in the post."
          },
          {
            "name": "dTenonWidthExtra",
            "technicalDefault": 2,
            "businessMeaning": "The lateral clearance (gap) added to the mortise slot in the post.",
            "validRange": "0-5",
            "unit": "mm",
            "affectsOutput": "Widens the slot slightly more than the tenon width to accommodate swelling or timber tolerances."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "nNr > 1",
            "effect": "Activates multi-drill mode; calculates offset start positions for holes based on dPenDistance.",
            "cascade": [
              "dPenDistance",
              "dPenHeartOffset"
            ]
          },
          {
            "trigger": "dTenonHeight > Joist Height",
            "effect": "Script clamps dTenonHeight to the physical height of the joist beam to prevent geometry errors.",
            "cascade": [
              "dTenonHeight"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Cut / DoubleCut",
            "description": "Shoulder and tenon cheek cuts on the joist to form the projecting tenon.",
            "appliedTo": "Joist (Beam 0)"
          },
          {
            "type": "Slot",
            "description": "Rectangular mortise pocket in the post to receive the tenon, including tolerances.",
            "appliedTo": "Post (Beam 1)"
          },
          {
            "type": "Drill",
            "description": "Through-hole(s) for the wooden dowels/pegs.",
            "appliedTo": "Joist and Post"
          },
          {
            "type": "Hardware Component",
            "description": "BOM entry for the wooden dowel/peg (Peg).",
            "appliedTo": "Script Instance (BOM)"
          }
        ]
      },
      "tokens_used": 10015,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"Launch Script from Catalog or Toolbar\",\n    \"[Conditional] Check for Execute Key\",\n    \"[Path A: Key Found] Load properties from Catalog entry or LastInserted values\",\n    \"[Path B: No Key] Show Properties Dialog for user input\",\n    \"Prompt User: 'Select beams' (Allow multi-select for batch processing)\",\n    \"Sort Selection: Identify vertical beam (Post) and horizontal beam(s) (Joist)\",\n    \"Swap vertical beam to index 1 in the beam array\",\n    \"Set internal mode to 1 (Propagation Mode) and re-trigger calculation\",\n    \"[Propagation] Iterate through selected beams: Create a new TSL instance for each beam relative to the identified post\",\n    \"Execute Instance Calculation (Mode 0): Retrieve Joist (Beam 0) and Post (Beam 1)\",\n    \"[Validation] Check geometric intersection between Joist and Post\",\n    \"[Validation] Check if intersection volumes match (Full alignment)\",\n    \"[Generation] Apply Cut tools to extend Joist\",\n    \"[Generation] Apply DoubleCut to Post for Shoulder\",\n    \"[Conditional] Check Tenon Height vs Joist Height\",\n    \"[Generation] Apply DoubleCut to Joist for Tenon Cheeks\",\n    \"[Generation] Apply Slot tool to Post for Mortise\",\n    \"[Generation] Apply Drill tools to Joist and Post for Peg(s)\",\n    \"[Generation] Add Hardware Component (Peg) to BOM\",\n    \"[Conditional] Check for intersecting TSLs (Miter cut logic)\",\n    \"Finish: Visualize anchor and complete execution\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Is _kExecuteKey defined during insertion?\",\n      \"path1\": {\n        \"name\": \"Catalog/Silent Load\",\n        \"steps\": [\n          \"Search for catalog entry matching _kExecuteKey\",\n          \"Load properties from catalog\",\n          \"Skip Dialog display\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Interactive Dialog\",\n        \"steps\": [\n          \"Execute showDialog()\",\n          \"User confirms or modifies properties\",\n          \"Proceed with selection\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Does dTenonHeight exceed physical Joist height?\",\n      \"path1\": {\n        \"name\": \"Standard Tenon\",\n        \"steps\": [\n          \"Calculate tenon top point based"
      },
      "tokens_used": 12623,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbKingPostTenon.mcr\n\n## Overview\nThis script generates a traditional timber frame connection, cutting a tenon on a joist and a corresponding mortise in a post. It automatically applies drilling operations for wooden dowels (pegs) and handles intersecting joists at the same level with a tolerance cut.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates in 3D model space to cut and drill beams. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | Does not generate 2D annotations directly. |\n\n## Prerequisites\n- **Required Entities**: Two GenBeam entities.\n- **Minimum Beam Count**: 2 beams (one vertical Post and one horizontal Joist).\n- **Required Settings**: None required; all dimensions are controlled via the Properties Palette.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbKingPostTenon.mcr`\n\n### Step 2: Configure Properties\n**Action**: The Properties Dialog appears on insertion.\n- Adjust the dimensions for the Tenon, Shoulder, and Pen (dowel) settings as needed.\n- Click **OK** to confirm.\n\n### Step 3: Select Beams\n```\nCommand Line: Select beams\nAction: Click the joist and the post. You can select multiple beams if they share the same post.\n```\n- **Note**: The script automatically detects which beam is the post (vertical) and which is the joist (horizontal), regardless of the selection order.\n\n### Step 4: Generation\nThe script automatically:\n1. Cuts the shoulder and tenon cheeks on the joist.\n2. Cuts the mortise slot in the post.\n3. Drills hole(s) for the dowels through both beams.\n4. Adds the wooden dowel (Peg) to the Bill of Materials (BOM).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Shoulder** | | | |\n| Width | Number | 30 | The depth of the horizontal housing cut on the post face (mm). |\n| **Pen** | | | |\n| Diameter | Number | 22 | Diameter of the wooden dowel/peg hole (mm). |\n| Height | Number | 90 | Vertical position of the dowel hole center from the bottom of the joist (mm). |\n| Heart Offset | Number | 10 | Lateral offset of the hole from the beam centerline towards the face (mm). |\n| Nr | Number | 1 | Number of dowel holes to drill (e.g., 1 or 2). |\n| Distance | Number | 25 | Center-to-center spacing between multiple dowel holes (mm). |\n| **Tenon** | | | |\n| Height | Number | 180 | Vertical height of the tenon (mm). |\n| Height Tolerance | Number | 2 | Vertical clearance added to the mortise slot in the post (mm). |\n| Length | Number | 100 | Depth the tenon penetrates into the post (mm). |\n| Length Tolerance | Number | 2 | Depth clearance added to the mortise slot (mm). |\n| Width | Number | 60 | Width of the tenon (typically matching joist width) (mm). |\n| Width Tolerance | Number | 2 | Lateral clearance added to the mortise slot width (mm). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are defined in this script version. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not use external settings files; all configuration is stored in the script properties.\n\n## Tips\n- **Beam Orientation**: You do not need to select the post first. The script analyzes the geometry to assign the vertical beam as the post and the horizontal as the joist.\n- **Multiple Joists**: You can select several joists and one post in a single operation; the script will propagate the connection to all selected pairs.\n- **Intersecting Joists**: If another joist using this script intersects at the same height, the script will automatically cut the intersecting part with a 4mm tolerance to prevent physical clashes.\n\n## FAQ\n- **Q: What happens if my Tenon Height is larger than my Joist height?**\n  **A:** The script automatically clamps the Tenon Height to the physical height of the joist to prevent invalid geometry.\n- **Q: How do I place the peg off-center?**\n  **A:** Use the **Pen > Heart Offset** property. A positive value moves the hole towards the face of the beam, which is common in traditional timber framing to draw the joint tight.\n- **Q: Can I use two pegs?**\n  **A:** Yes. Change the **Pen > Nr** property to `2` and adjust the **Pen > Distance** to set the spacing between the two holes."
      },
      "tokens_used": 6608,
      "error": null
    }
  }
}