{
  "filename": "hsbRoofData.mcr",
  "status": "completed",
  "total_tokens": 36092,
  "processing_time": 1238.0329222679138,
  "passes": {
    "1": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "API error 429: {\"error\":{\"code\":\"1302\",\"message\":\"您的账户已达到速率限制，请您控制请求频率\"}}"
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The function CollectERoofPlanes() explicitly executes Group().collectEntities(true, ERoofPlane(), _kModelSpace) to gather roof data. The script processes 3D roof planes (ERoofPlane) to calculate areas and draws geometry using DrawingPrimitives (dp), characteristic of model-space annotation and calculation scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "ERoofPlane"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Roof Planes",
          "requiredSettings": [
            "Catalog entries for EaveArea",
            "Catalog entries for InnerArea",
            "Catalog entries for RoofArea",
            "Catalog entries for Schedule"
          ]
        }
      },
      "tokens_used": 7248,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sEaveEntry",
            "type": "PropString",
            "displayName": "Eave Area",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Disabled",
              "_Default"
            ],
            "category": "Catalog Entries",
            "description": "Defines the catalog entry of this type"
          },
          {
            "index": 1,
            "variable": "sInnerEntry",
            "type": "PropString",
            "displayName": "Inner Area",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Disabled",
              "_Default"
            ],
            "category": "Catalog Entries",
            "description": "Defines the catalog entry of this type"
          },
          {
            "index": 2,
            "variable": "sRoofEntry",
            "type": "PropString",
            "displayName": "Roof Area",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Disabled",
              "_Default"
            ],
            "category": "Catalog Entries",
            "description": "Defines the catalog entry of this type"
          },
          {
            "index": 3,
            "variable": "sScheduleEntry",
            "type": "PropString",
            "displayName": "Schedule Table",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Disabled",
              "_Default"
            ],
            "category": "Catalog Entries",
            "description": "Defines the catalog entry of this type"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Add Point",
            "handler": null,
            "action": "Likely adds a grip point to the geometry.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Remove Point",
            "handler": null,
            "action": "Likely removes a grip point from the geometry.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Select polyline",
            "handler": null,
            "action": "Likely allows selecting a polyline to modify the area calculation.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Show edge description on/off",
            "handler": null,
            "action": "Toggles the visibility of edge descriptions.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7247,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Calculates specific construction areas (Eave, Inner, and Total Roof) derived from 3D roof planes, visualizes them with labels and hatching, and compiles the data into a schedule table.",
          "category": "Calculation & Annotation",
          "typicalUseCase": "Used to quantify roofing material requirements (e.g., tiles, insulation) and produce graphical labels or tables for construction documentation and estimating."
        },
        "parameters": [
          {
            "name": "sEaveEntry",
            "technicalDefault": "Disabled",
            "businessMeaning": "Selects the catalog definition for calculating and visualizing the Eave Area (the overhanging portion of the roof beyond the external wall).",
            "validRange": "Disabled, or specific catalog entry names from 'hsbRoofData-EaveArea'",
            "unit": "String (Enum)",
            "affectsOutput": "Enables/disables the calculation and visual display (hatch and text label) of the eave surface area. If 'Disabled', this specific area is ignored."
          },
          {
            "name": "sInnerEntry",
            "technicalDefault": "Disabled",
            "businessMeaning": "Selects the catalog definition for the Inner Area (the main roof surface area excluding overhangs, often aligned with the structural footprint).",
            "validRange": "Disabled, or specific catalog entry names from 'hsbRoofData-InnerArea'",
            "unit": "String (Enum)",
            "affectsOutput": "Determines if the main roof area is calculated, hatched, and labeled. This is critical for main material estimation."
          },
          {
            "name": "sRoofEntry",
            "technicalDefault": "Disabled",
            "businessMeaning": "Selects the catalog definition for the Total Roof Area (the complete geometric surface area of the roof plane).",
            "validRange": "Disabled, or specific catalog entry names from 'hsbRoofData-RoofArea'",
            "unit": "String (Enum)",
            "affectsOutput": "Controls the calculation and display of the total surface area of the specific roof plane. This represents the sum of all related roof surfaces."
          },
          {
            "name": "sScheduleEntry",
            "technicalDefault": "Disabled",
            "businessMeaning": "Selects the table configuration used to generate a Schedule (Bill of Quantities) summarizing the calculated roof areas.",
            "validRange": "Disabled, or specific catalog entry names from 'hsbRoofData-Schedule'",
            "unit": "String (Enum)",
            "affectsOutput": "If enabled, generates a schedule table entity in the drawing that lists the roof areas. This table updates when the roof geometry changes."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing sEaveEntry, sInnerEntry, or sRoofEntry",
            "effect": "Updates the geometric calculations and visual labels on the roof plane.",
            "cascade": [
              "Schedule Table content (if sScheduleEntry is active)"
            ]
          },
          {
            "trigger": "Modifying ERoofPlane Geometry",
            "effect": "Forces a recalculation of all active area parameters (Eave, Inner, Roof) to reflect the new roof dimensions or shape.",
            "cascade": [
              "sEaveEntry",
              "sInnerEntry",
              "sRoofEntry",
              "sScheduleEntry"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Graphic Annotation",
            "description": "Text labels displaying the calculated area (e.g., 'Roof Area: 120 m²') and associated leader lines or boxes placed on the roof plane.",
            "appliedTo": "Model Space geometry (projected onto ERoofPlane)."
          },
          {
            "type": "Hatching",
            "description": "Pattern fills applied to the specific regions (Eave, Inner, Roof) defined by the catalog entries to visually distinguish them.",
            "appliedTo": "Model Space regions on the ERoofPlane."
          },
          {
            "type": "Schedule Table",
            "description": "A drawing table listing the roof plane numbers and their corresponding calculated areas.",
            "appliedTo": "Model Space."
          },
          {
            "type": "Virtual Hardware Component",
            "description": "Non-physical data entities used to store area values for BOM export or data management.",
            "appliedTo": "The TSL Instance."
          }
        ]
      },
      "tokens_used": 8216,
      "error": null
    },
    "5": {
      "success": true,
      "data": {},
      "tokens_used": 8895,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbRoofData\n\n## Overview\nThis script automatically calculates specific construction areas (Eave, Inner, and Total Roof) based on 3D roof planes. It visualizes these calculations with hatching and labels and can generate a schedule table for documentation.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be inserted into Model Space where ERoofPlanes exist. |\n| Paper Space | No | Not supported for Paper Space layout. |\n| Shop Drawing | No | This is not a manufacturing/Shop Drawing script. |\n\n## Prerequisites\n- **Required Entities:** `ERoofPlane` entities must exist in the drawing.\n- **Minimum Beam Count:** 0 (This script relies on roof planes, not beams).\n- **Required Settings:**\n  - Catalog entries for `hsbRoofData-EaveArea`\n  - Catalog entries for `hsbRoofData-InnerArea`\n  - Catalog entries for `hsbRoofData-RoofArea`\n  - Catalog entries for `hsbRoofData-Schedule`\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or use the hsbCAD Insert Script tool) → Select `hsbRoofData.mcr`\n\n### Step 2: Insert Script Instance\n```\nCommand Line: Click to place script instance:\nAction: Click anywhere in the Model Space to insert the script. The script will automatically detect and process all Roof Planes in the model.\n```\n*(Note: There are no manual selection prompts or insertion points for specific geometry; the script scans the model automatically.)*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Eave Area | dropdown | Disabled | Selects the catalog entry to define the Eave Area (overhang). If \"Disabled\", this area is not calculated or displayed. |\n| Inner Area | dropdown | Disabled | Selects the catalog entry for the Inner Area (main roof surface). Enables calculation and display of the structural footprint area. |\n| Roof Area | dropdown | Disabled | Selects the catalog entry for the Total Roof Area (complete geometric surface). Calculates the sum of all roof surfaces. |\n| Schedule Table | dropdown | Disabled | Selects the catalog entry for the Schedule Table configuration. Generates a table listing all calculated roof areas. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add Point | Adds a grip point to the annotation geometry, allowing you to drag or reshape the label placement. |\n| Remove Point | Removes a specific grip point from the annotation geometry. |\n| Select polyline | Allows you to select a drawing polyline to define or modify the boundary for the area calculation. |\n| Show edge description on/off | Toggles the visibility of textual descriptions along the edges of the calculated areas. |\n\n## Settings Files\n- **Catalog Entries**: `hsbRoofData-EaveArea`, `hsbRoofData-InnerArea`, `hsbRoofData-RoofArea`, `hsbRoofData-Schedule`\n- **Location**: hsbCAD Catalog (Company or Installation path)\n- **Purpose**: These XML entries define the visual style (hatching patterns, text size, layer) and calculation logic for the different roof areas.\n\n## Tips\n- Ensure your ERoofPlanes are correctly defined in 3D before inserting the script, as it relies on their geometry.\n- If areas are not appearing, check the Properties Palette to ensure the relevant parameters are not set to \"Disabled\".\n- Use the \"Select polyline\" context menu option if you need to calculate areas for non-standard or complex roof shapes not fully defined by the automatic roof plane detection.\n\n## FAQ\n- **Q: Why do I see labels but no hatching?**\n  A: The hatching pattern is defined in the Catalog Entries. Check the specific catalog entry selected (e.g., for Inner Area) to ensure a hatch pattern is assigned.\n- **Q: Can I update the areas if I modify the roof design?**\n  A: Yes. The script listens to geometry changes. If you modify the ERoofPlanes, the calculations will automatically update.\n- **Q: Where does the Schedule Table appear?**\n  A: The schedule table is generated in the Model Space. Its insertion point and format are determined by the catalog entry selected in the \"Schedule Table\" property."
      },
      "tokens_used": 4486,
      "error": null
    }
  }
}