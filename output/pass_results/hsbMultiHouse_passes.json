{
  "filename": "hsbMultiHouse.mcr",
  "status": "completed",
  "total_tokens": 54234,
  "processing_time": 220.57024264335632,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"2.6\",\n      \"date\": \"01.04.2021\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-11440 housing tool will not be applied to male beams if set to not round and gap in width = 0\"\n    },\n    {\n      \"version\": \"2.5\",\n      \"date\": \"29nov18\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"bugfix endcut, supports angled connections\"\n    },\n    {\n      \"version\": \"2.4\",\n      \"date\": \"28nov18\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"revised, new properties to define individual offsets, base grip can be used to modify depth\"\n    },\n    {\n      \"version\": \"2.3\",\n      \"date\": \"14nov18\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"bugfix tool resolving\"\n    },\n    {\n      \"version\": \"2.2\",\n      \"date\": \"02dec15\",\n      \"author\": \"th@hsbCAD.de\",\n      \"changes\": \"bugfix gap depth\"\n    },\n    {\n      \"version\": \"2.1\",\n      \"date\": \"10feb15\",\n      \"author\": \"th@hsbCAD.de\",\n      \"changes\": \"detection of female beam intersection enhanced\"\n    },\n    {\n      \"version\": \"2.0\",\n      \"date\": \"16dec14\",\n      \"author\": \"th@hsbCAD.de\",\n      \"changes\": \"instance color set to green (3)\"\n    },\n    {\n      \"version\": \"1.9\",\n      \"date\": \"11dec14"
      },
      "tokens_used": 9501,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly inserts instances into '_kModelSpace' using tslNew.dbCreate(..., _kModelSpace, ...). No 'sd_*' or 'Multipage' prefixes are present. User interaction uses 'PrEntity' prompts for 3D selection (Beams/Elements). No '#Type E' or shopdrawing specific patterns found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam (Male)",
            "Beam (Female) or Element"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Requires selection of male beams and either female beams or an intersecting wall element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 6428,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select male beam(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select intersecting wall or female beam(s)|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "|Depth|",
            "defaultValue": "U(50)",
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": null
          },
          {
            "index": 0,
            "variable": "sRelief",
            "type": "PropString",
            "displayName": "|Relief|",
            "defaultValue": "|not rounded|",
            "inputType": "dropdown",
            "options": [
              "|not rounded|",
              "|round|",
              "|relief|",
              "|rounded with small diameter|",
              "|relief with small diameter|",
              "|rounded|"
            ],
            "category": "|Geometry|",
            "description": null
          },
          {
            "index": 1,
            "variable": "dGap",
            "type": "PropDouble",
            "displayName": "|Depth| ",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Gaps|",
            "description": null
          },
          {
            "index": 2,
            "variable": "dGapWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Gaps|",
            "description": null
          },
          {
            "index": 3,
            "variable": "dOffsetLeft",
            "type": "PropDouble",
            "displayName": "|Left|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Tool Offset|",
            "description": null
          },
          {
            "index": 4,
            "variable": "dOffsetTop",
            "type": "PropDouble",
            "displayName": "|Top|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Tool Offset|",
            "description": null
          },
          {
            "index": 5,
            "variable": "dOffsetRight",
            "type": "PropDouble",
            "displayName": "|Right|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Tool Offset|",
            "description": null
          },
          {
            "index": 6,
            "variable": "dOffsetBottom",
            "type": "PropDouble",
            "displayName": "|Bottom|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Tool Offset|",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 10654,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of a housed timber joinery (T-connection) where intersecting male beams are tenoned or cut to fit into a recess (housing) in female beams or wall elements.",
          "category": "Framing",
          "typicalUseCase": "Joining floor joists, roof purlins, or studs into main beams or log walls where a structural pocket or tenon connection is required."
        },
        "parameters": [
          {
            "name": "dDepth",
            "technicalDefault": "U(50)",
            "businessMeaning": "Defines the depth of the tenon on the male beam or the depth of the pocket cut into the female beam. This determines how far the male beam penetrates into the female component.",
            "validRange": "10mm to 300mm (typically 1/3 to 1/2 of female beam width)",
            "unit": "mm",
            "affectsOutput": "Directly changes the length of the tenon and the depth of the pocket. Can be visually adjusted using the grip point in the model."
          },
          {
            "name": "sRelief",
            "technicalDefault": "|not rounded|",
            "businessMeaning": "Specifies the contour type applied to the internal corners of the pocket and the edges of the tenon. This controls how the material is removed or shaped at the intersection.",
            "validRange": "Dropdown options: not rounded, round, relief (chamfer), rounded with small diameter, relief with small diameter, rounded",
            "unit": "N/A",
            "affectsOutput": "Modifies the geometry of the machining corners (sharp vs. rounded vs. chamfered), affecting assembly tolerances and stress distribution."
          },
          {
            "name": "dGap",
            "technicalDefault": "U(0)",
            "businessMeaning": "Specifies a clearance distance between the end of the male tenon and the bottom of the female pocket.",
            "validRange": "0mm to 20mm",
            "unit": "mm",
            "affectsOutput": "Shortens the male tenon relative to the pocket depth, ensuring the parts do not bottom out tight against the back of the housing."
          },
          {
            "name": "dGapWidth",
            "technicalDefault": "U(0)",
            "businessMeaning": "Defines a lateral clearance (play) between the sides of the male tenon and the walls of the female pocket.",
            "validRange": "0mm to 10mm",
            "unit": "mm",
            "affectsOutput": "Reduces the width of the male tenon or widens the female pocket to provide ease of assembly or accommodate timber swelling."
          },
          {
            "name": "dOffsetLeft",
            "technicalDefault": "U(0)",
            "businessMeaning": "Shifts the position of the housing tool along the local negative Y-axis (left side relative to beam direction).",
            "validRange": "-100mm to 100mm",
            "unit": "mm",
            "affectsOutput": "Moves the connection geometry laterally, allowing off-center placement of the tenon/pocket relative to the beam's centerline."
          },
          {
            "name": "dOffsetTop",
            "technicalDefault": "U(0)",
            "businessMeaning": "Shifts the position of the housing tool along the local positive Z-axis (top side relative to beam cross-section).",
            "validRange": "-100mm to 100mm",
            "unit": "mm",
            "affectsOutput": "Moves the connection geometry vertically, adjusting for irregular alignments or specific construction detailing."
          },
          {
            "name": "dOffsetRight",
            "technicalDefault": "U(0)",
            "businessMeaning": "Shifts the position of the housing tool along the local positive Y-axis (right side relative to beam direction).",
            "validRange": "-100mm to 100mm",
            "unit": "mm",
            "affectsOutput": "Moves the connection geometry laterally, complementing the Left offset to resize or shift the pocket asymmetrically."
          },
          {
            "name": "dOffsetBottom",
            "technicalDefault": "U(0)",
            "businessMeaning": "Shifts the position of the housing tool along the local negative Z-axis (bottom side relative to beam cross-section).",
            "validRange": "-100mm to 100mm",
            "unit": "mm",
            "affectsOutput": "Moves the connection geometry vertically, complementing the Top offset to resize or shift the pocket asymmetrically."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Condition: sRelief is '|not rounded|' AND dGapWidth is 0 AND (dOffsetLeft + dOffsetRight == 0)",
            "effect": "The script logic (bNoMaleHouse) suppresses the creation of the actual tenon/housing geometry on the male beams, treating them as simple cuts.",
            "cascade": [
              "dDepth",
              "sRelief"
            ]
          },
          {
            "trigger": "User interaction: Moving the base grip point (_Pt0)",
            "effect": "Recalculates the 'dDepth' property based on the new distance from the reference midpoint to the moved grip point.",
            "cascade": [
              "dDepth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "House Joinery",
            "description": "Creates a 'House' operation (pocket in female beams, tenon on male beams) based on the depth and relief settings.",
            "appliedTo": "Selected Male Beams (tenon/trim) and Female Beams/Elements (pocket)."
          },
          {
            "type": "Cut",
            "description": "Simple saw cuts applied to male beams that intersect the connection area but are not part of the primary housing logic (e.g., when bNoMaleHouse is true or for side trimming).",
            "appliedTo": "Selected Male Beams."
          }
        ]
      },
      "tokens_used": 9488,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch script via command or catalog",
          "Check '_bOnInsert' flag (Execution Mode)",
          "Insert Cycle Check: If cycle count > 1, erase instance and exit",
          "Properties Initialization: Show dialog or apply catalog key",
          "Selection Prompt 1: Select male beam(s)",
          "Validation 1: If no male beams selected, erase instance and exit",
          "Selection Prompt 2: Select intersecting wall element or female beam(s)",
          "Entity Classification: Parse selection into Element objects or Beam objects",
          "Beam Packing Algorithm: Group parallel and intersecting male beams into packs",
          "Loop through each male beam pack",
          "Check Female Source Type",
          "Conditional A (Element Source): If valid Element selected, use it as the female reference",
          "Conditional B (Beam Source): If no Element, filter selected female beams for non-parallel ones",
          "Instance Creation: Generate new TSL instance in ModelSpace for each pack/female combination",
          "Erase Master Instance: Delete the temporary instance used for insertion",
          "Script Execution (Instance Phase): Load saved Male/Female maps from memory",
          "Validation 2: If no male beams detected (reference lost), report error and erase instance",
          "Validation 3: If no female beams found (reference lost), report error and erase instance",
          "Coordinate System Calculation: Define tool reference plane based on female intersection",
          "Parameter Check: Calculate 'bNoMaleHouse' flag based on Relief, GapWidth, and Offsets",
          "Geometry Calculation: Determine tool dimensions (dYT, dZT, dXT) from intersections and offsets",
          "Grip Interaction Check: If '_Pt0' moved, update 'dDepth' property",
          "Filtering: Identify which male beams intersect the tool volume",
          "Tool Application Logic (Branching)",
          "Apply machining: Add 'Cut' or 'House' tools to male beams",
          "Apply machining: Add 'House' tool to female beams",
          "Visualization: Draw debug geometry/profiles"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Mode (Insert vs Update)",
            "path1": {
              "name": "Insert Mode",
              "steps": [
                "Check insert cycle",
                "Show dialog/Load catalog",
                "Prompt for selection (Male & Female)",
                "Pack male beams",
                "Create child instances",
                "Erase master"
              ]
            },
            "path2": {
              "name": "Update Mode (Recalc)",
              "steps": [
                "Restore references from Map",
                "Validate beams exist",
                "Calculate geometry",
                "Apply tools to beams"
              ]
            }
          },
          {
            "condition": "Female Component Selection Type",
            "path1": {
              "name": "Wall Element Selected",
              "steps": [
                "Use Element object for reference plane",
                "Derive female beams from Element.beam()",
                "Exclude male beams from female list"
              ]
            },
            "path2": {
              "name": "Individual Female Beams Selected",
              "steps": [
                "Use specific Beam objects",
                "Filter out beams parallel to male pack",
                "Use beams directly for machining"
              ]
            }
          },
          {
            "condition": "Machining Type (bNoMaleHouse flag)",
            "path1": {
              "name": "Simple Cut (No Male Housing)",
              "steps": [
                "Trigger: Relief is 'not rounded' AND GapWidth is 0 AND Lateral Offsets are 0",
                "Action: Apply 'Cut' tool (Plane) to male beams at intersection depth",
                "Action: Apply 'House' tool to female beams (Pocket only)"
              ]
            },
            "path2": {
              "name": "Full Housing Joinery",
              "steps": [
                "Trigger: Relief is rounded/chamfered OR GapWidth > 0 OR Offsets exist",
                "Action: Apply 'House' tool (Tenon) to male beams",
                "Action: Apply 'House' tool (Pocket) to female beams"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Male beam selection count",
            "errorMessage": "Erase instance if < 1 beam selected",
            "recovery": "User must select at least one male beam during insertion prompt."
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "Script self-terminates if cycle > 1",
            "recovery": "N/A (Internal mechanism to prevent infinite loops)."
          },
          {
            "check": "Map References (Update Mode)",
            "errorMessage": "Report 'no male beams detected' and erase instance",
            "recovery": "User must restore the deleted beams or undo the action; the TSL instance cannot function without its references."
          },
          {
            "check": "Female Beam Availability (Update Mode)",
            "errorMessage": "Report 'No female beams found' and erase instance",
            "recovery": "User must ensure the female wall element or beams exist in the model."
          },
          {
            "check": "Grip Depth Input",
            "errorMessage": "If new depth < Epsilon (near zero), reset execution loop (ignored)",
            "recovery": "User must drag the grip further away from the reference point to achieve a positive depth."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Joinery Depth",
            "how": "Drag the '_Pt0' grip point (visualized vector from reference plane)",
            "effect": "Updates the 'dDepth' property and recalculates the tenon length and pocket depth."
          },
          {
            "action": "Adjust Geometry Parameters",
            "how": "Edit OPM Properties (Depth, Relief, Gaps, Offsets)",
            "effect": "Regenerates the machining. Changing Relief or Offsets switches between Simple Cut and Full Housing logic. Offsets shift the tool laterally/vertically."
          },
          {
            "action": "Delete Beams",
            "how": "Erase Male or Female beams referenced by the script",
            "effect": "Script detects missing references, reports an error, and erases itself to prevent corruption."
          }
        ]
      },
      "tokens_used": 10975,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbMultiHouse.mcr\n\n## Overview\nAutomates the creation of housed timber joinery (T-connections) where intersecting male beams are tenoned or cut to fit into a recess in female beams or wall elements.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script runs in 3D model space to create and modify beams. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: Male beams (to be tenoned) and Female beams or a Wall Element (to receive the pocket).\n- **Minimum Beam Count**: 2 (at least one male and one female).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT` â†’ Select `hsbMultiHouse.mcr` from the file dialog.\n\n### Step 2: Select Male Beams\n```\nCommand Line: Select male beam(s)\nAction: Click on the beams that will be cut or tenoned (the intersecting beams).\n```\n*Note: You can select multiple beams.*\n\n### Step 3: Select Female Entity\n```\nCommand Line: Select intersecting wall or female beam(s)\nAction: Click on the main beam, log wall element, or collection of beams that form the receiving side of the connection.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Depth** | Number | 50 mm | Defines the depth of the tenon on the male beam and the pocket in the female beam. Can be adjusted using the grip point in the model. |\n| **Relief** | Dropdown | not rounded | Sets the corner style of the joinery. Options include: not rounded, round, relief (chamfer), rounded with small diameter, relief with small diameter, rounded. |\n| **Depth (Gap)** | Number | 0 mm | Clearance distance between the end of the male tenon and the bottom of the female pocket. |\n| **Width (Gap)** | Number | 0 mm | Lateral clearance between the sides of the tenon and the walls of the pocket. |\n| **Left (Offset)** | Number | 0 mm | Shifts the tool position to the left (negative Y-axis). |\n| **Top (Offset)** | Number | 0 mm | Shifts the tool position upwards (positive Z-axis). |\n| **Right (Offset)** | Number | 0 mm | Shifts the tool position to the right (positive Y-axis). |\n| **Bottom (Offset)** | Number | 0 mm | Shifts the tool position downwards (negative Z-axis). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (Standard Recalculate) | Updates the joinery based on property changes or beam movements. |\n\n## Settings Files\nNone required. The script uses internal parameters and manual property inputs.\n\n## Tips\n- **Adjusting Depth Quickly**: After insertion, select the script instance in the model. You will see a grip point (usually at the intersection face). Drag this grip to visually adjust the `Depth` property.\n- **Simple Cut vs. Full Housing**: If you set **Relief** to \"not rounded\", **Gap Width** to 0, and ensure all **Offsets** are 0, the script will switch to a \"Simple Cut\" mode for the male beams instead of creating a full tenon.\n- **Assembly Tolerances**: Use the **Gap Width** and **Gap (Depth)** properties to create play in the connection, ensuring parts fit together easily on site.\n\n## FAQ\n- **Q: Why is my male beam cut off flat instead of having a tenon?**\n  **A:** This happens if **Relief** is set to \"not rounded\", **Gap Width** is 0, and all **Offsets** are 0. Change the Relief to \"Round\" or \"Relief\" to enable the full tenon geometry.\n\n- **Q: Can I use this on log walls?**\n  **A:** Yes, you can select a wall element as the \"female\" component during the second prompt.\n\n- **Q: What happens if I delete a beam used by the script?**\n  **A:** The script detects that its reference is missing, displays an error (\"no male beams detected\" or \"No female beams found\"), and erases itself to prevent errors."
      },
      "tokens_used": 7188,
      "error": null
    }
  }
}