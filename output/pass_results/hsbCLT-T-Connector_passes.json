{
  "filename": "hsbCLT-T-Connector.mcr",
  "status": "completed",
  "total_tokens": 45565,
  "processing_time": 259.12968707084656,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "16sep14",
            "author": "th@hsbCAD.de",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6737,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script operates on Sip entities (CLT Panels), uses Vector3d for 3D calculations, creates Body/Slot/Drill entities, and calls sip0.stretchEdgeTo(). No sd_ prefixes, _Viewport usage, or #Type E declarations found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5408,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert && _kExecuteKey==\\\"\\\"\",\n        \"required\": false\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getSip\",\n        \"promptOriginal\": \"|Select male CLT Panel|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select female CLT Panel| (|optional|)\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": false\n      },\n      {\n        \"step\": 4,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"dLength\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"   Length\",\n      \"defaultValue\": \"U(300)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry\",\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dWidth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"   Width\",\n      \"defaultValue\": \"U(100)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dHeight\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"   Height\",\n      \"defaultValue\": \"U(215)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"dThickness\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"   Thickness\",\n      \"defaultValue\": \"U(10)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry\",\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"dEdgeOffset\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"   Edge Offset\",\n      \"defaultValue\": \"U(40)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Location\",\n      \"description\": null\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"dCenterOffset\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"   Center Offset\",\n      \"defaultValue\": \"U(0)\",\n"
      },
      "tokens_used": 8478,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a T-shaped steel connector plate for CLT panels, machining a slot and drill pattern into the timber to embed and fasten the plate.",
          "category": "Hardware",
          "typicalUseCase": "Connecting a CLT floor slab to a CLT wall (or vice versa) using a steel T-plate for structural rigidity, often where panels meet perpendicularly."
        },
        "parameters": [
          {
            "name": "dLength",
            "technicalDefault": "U(300)",
            "businessMeaning": "The length of the connector plate flange (the horizontal part of the 'T').",
            "validRange": "100 - 1000",
            "unit": "mm",
            "affectsOutput": "Changes the length of the steel Body and the corresponding slot width."
          },
          {
            "name": "dWidth",
            "technicalDefault": "U(100)",
            "businessMeaning": "The height of the connector plate flange (the vertical face visible after installation).",
            "validRange": "50 - 500",
            "unit": "mm",
            "affectsOutput": "Changes the vertical size of the steel Body flange."
          },
          {
            "name": "dHeight",
            "technicalDefault": "U(215)",
            "businessMeaning": "The depth of the connector plate web (the part that inserts into the CLT panel).",
            "validRange": "50 - 300",
            "unit": "mm",
            "affectsOutput": "Changes the depth of the slot cut into the timber and the web length of the plate."
          },
          {
            "name": "dThickness",
            "technicalDefault": "U(10)",
            "businessMeaning": "The material thickness of the steel plate.",
            "validRange": "5 - 20",
            "unit": "mm",
            "affectsOutput": "Changes the thickness of the steel Body and the width of the slot."
          },
          {
            "name": "dEdgeOffset",
            "technicalDefault": "U(40)",
            "businessMeaning": "The distance from the edge of the CLT panel to the start of the connector.",
            "validRange": "0 - Panel Thickness",
            "unit": "mm",
            "affectsOutput": "Moves the slot and connector closer to or further from the selected edge."
          },
          {
            "name": "dCenterOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "Vertical offset relative to the center of the panel thickness (useful for offsetting to specific layers).",
            "validRange": "-PanelThick/2 to PanelThick/2",
            "unit": "mm",
            "affectsOutput": "Shifts the connector up or down relative to the panel's center axis."
          },
          {
            "name": "dGapX",
            "technicalDefault": "U(10)",
            "businessMeaning": "Clearance gap along the length of the slot (allowing for tolerance).",
            "validRange": "1 - 10",
            "unit": "mm",
            "affectsOutput": "Slot Length = Plate Length + 2 * dGapX."
          },
          {
            "name": "dGapY",
            "technicalDefault": "U(1)",
            "businessMeaning": "Clearance gap along the height of the slot.",
            "validRange": "0 - 5",
            "unit": "mm",
            "affectsOutput": "Slot Height = Plate Height + dGapY."
          },
          {
            "name": "dGapZ",
            "technicalDefault": "U(1)",
            "businessMeaning": "Clearance gap for the thickness of the slot.",
            "validRange": "0 - 5",
            "unit": "mm",
            "affectsOutput": "Slot Thickness = Plate Thickness + 2 * dGapZ."
          },
          {
            "name": "dDiameter",
            "technicalDefault": "U(14)",
            "businessMeaning": "Diameter of the fastener holes (drills).",
            "validRange": "6 - 24",
            "unit": "mm",
            "affectsOutput": "Size of the Drill holes added to both the CLT panel and the steel body."
          },
          {
            "name": "nRows",
            "technicalDefault": "5",
            "businessMeaning": "Number of fastener holes in the vertical direction.",
            "validRange": "1 - 20",
            "unit": "count",
            "affectsOutput": "Number of drill holes generated vertically."
          },
          {
            "name": "dRowOffset",
            "technicalDefault": "U(42)",
            "businessMeaning": "Spacing between rows of fasteners (vertical pitch).",
            "validRange": "30 - 150",
            "unit": "mm",
            "affectsOutput": "Distance between drill holes along the Y-axis."
          },
          {
            "name": "nColumns",
            "technicalDefault": "5",
            "businessMeaning": "Number of fastener holes in the horizontal direction.",
            "validRange": "1 - 20",
            "unit": "count",
            "affectsOutput": "Number of drill holes generated horizontally."
          },
          {
            "name": "dColumnOffset",
            "technicalDefault": "U(42)",
            "businessMeaning": "Spacing between columns of fasteners (horizontal pitch).",
            "validRange": "30 - 150",
            "unit": "mm",
            "affectsOutput": "Distance between drill holes along the X-axis."
          },
          {
            "name": "sPatternMode",
            "technicalDefault": "|1 Pattern|",
            "businessMeaning": "Controls whether the drill pattern is single or mirrored (symmetrical) relative to the insertion point.",
            "validRange": "List: |1 Pattern|, |2 Patterns|",
            "unit": "enum",
            "affectsOutput": "If '2 Patterns' is selected, a second set of drills is generated mirrored across the X-axis based on offsets."
          },
          {
            "name": "dPatternOffsetX",
            "technicalDefault": "U(0)",
            "businessMeaning": "Horizontal shift of the drill pattern origin from the connector center.",
            "validRange": "0 - 500",
            "unit": "mm",
            "affectsOutput": "Shifts the entire grid of holes left or right."
          },
          {
            "name": "dPatternOffsetY",
            "technicalDefault": "U(0)",
            "businessMeaning": "Vertical shift of the drill pattern origin.",
            "validRange": "0 - 500",
            "unit": "mm",
            "affectsOutput": "Shifts the entire grid of holes up or down."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sPatternMode set to '|2 Patterns|'",
            "effect": "Script checks if dPatternOffsetX is sufficient to prevent overlap; if not, it auto-adjusts dPatternOffsetX to a minimum value based on column count and offset.",
            "cascade": [
              "dPatternOffsetX"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body",
            "description": "The visual representation of the steel T-connector (composed of a flange and a web).",
            "appliedTo": "Model Space"
          },
          {
            "type": "Slot",
            "description": "A rectangular pocket machined into the CLT panel to accept the web of the T-connector.",
            "appliedTo": "Primary CLT Panel (_Sip[0])"
          },
          {
            "type": "Drill",
            "description": "Through holes for fasteners (screws/bolts) that penetrate both the steel plate and the CLT panel.",
            "appliedTo": "Primary CLT Panel (_Sip[0]) and Body"
          }
        ]
      },
      "tokens_used": 8321,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch/Insert Command",
          "Check Insert Cycle (Erase if duplicate cycle)",
          "Load Properties (from Catalog key OR show Dialog)",
          "Prompt for Male CLT Panel (Sip)",
          "Prompt for Female CLT Panel (Optional)",
          "Prompt for Insertion Point on Male Panel Edge",
          "Calculate Geometry & Identify Closest Edge",
          "[Decision] Validate Edge Identification",
          "[Decision] Check for Stretching Conditions (Female Panel present + correct alignment)",
          "Apply Transformation (Stretch Edge OR Static Edge Offset)",
          "Create Slot in Male Panel (if dimensions valid)",
          "Create Steel T-Connector Body",
          "[Decision] Check Pattern Mode (Single vs Double)",
          "Auto-Correct Pattern Offset (if Double Mode enabled and overlap risk)",
          "Generate Drill Pattern (Single or Double loop)",
          "Add Tools to Panel and Body",
          "Visual Update"
        ],
        "conditionalBranches": [
          {
            "condition": "Female Panel Selected AND Alignment Valid for Stretching",
            "details": "Checks if female panel exists, is parallel to the edge normal, is on the positive side of the edge, and the edge isn't already stretched.",
            "path1": {
              "name": "Stretch Mode",
              "steps": [
                "Calculate intersection point with Female Panel plane",
                "Stretch Male Panel edge to intersection minus Edge Offset",
                "Update 'numEdge' in Instance Map to track stretched state"
              ]
            },
            "path2": {
              "name": "Standard Offset Mode",
              "steps": [
                "Apply static 'dEdgeOffset' from the edge",
                "Remove 'numEdge' from Instance Map (reset state)"
              ]
            }
          },
          {
            "condition": "Pattern Mode Property Setting",
            "details": "User selects '|1 Pattern|' (Index 0) or '|2 Patterns|' (Index 1).",
            "path1": {
              "name": "Single Pattern",
              "steps": [
                "Execute drill generation loop once (p=0)",
                "Generate one grid of holes based on Row/Column offsets"
              ]
            },
            "path2": {
              "name": "Double Pattern",
              "steps": [
                "Check dPatternOffsetX for overlap",
                "Auto-increase dPatternOffsetX if too small to fit two grids",
                "Execute drill generation loop twice (p=0, p=1)",
                "Mirror second set of holes across the X-axis"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Primary CLT Panel selection",
            "condition": "_Sip.length() < 1",
            "errorMessage": "None (Script terminates silently)",
            "recovery": "User must re-insert the script and select a valid panel."
          },
          {
            "check": "Nearest Edge Identification",
            "condition": "nNumEdge < 0 (No edge found near insertion point)",
            "errorMessage": "encountered an unexpected error. Please contact your local hsbCAD support.",
            "recovery": "Script instance is erased. User must re-insert and ensure point is clicked on or near a panel edge."
          },
          {
            "check": "Slot Dimensions Validity",
            "condition": "dX <= dEps || dY <= dEps || dZ <= dEps",
            "errorMessage": "None",
            "recovery": "Slot is not generated (skipped) if calculated dimensions are zero or negative."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Connector Geometry",
            "how": "OPM Properties Palette (Geometry Category)",
            "effect": "Updates dLength, dWidth, dHeight, dThickness. Resizes the Steel Body and Slot immediately."
          },
          {
            "action": "Adjust Position",
            "how": "OPM Properties Palette (Location Category) or Move Grip",
            "effect": "Changing Edge Offset or Center Offset moves the Slot/Body relative to the panel edge."
          },
          {
            "action": "Edit Drill Pattern",
            "how": "OPM Properties Palette (Drill Pattern Category)",
            "effect": "Changes hole count, diameter, spacing, or switches between 1 or 2 patterns."
          },
          {
            "action": "Delete Secondary Panel",
            "how": "AutoCAD Erase Command",
            "effect": "If the Female Panel used for stretching is deleted, the script detects `sip1` is invalid, removes the stretch logic, and reverts to the static 'Edge Offset' on the next recalculation."
          },
          {
            "action": "Move Insertion Point",
            "how": "Grip Edit on _Pt0",
            "effect": "Re-calculates the nearest edge. If moved to a different edge, the connector jumps to that new edge and re-orients."
          }
        ]
      },
      "tokens_used": 9341,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-T-Connector.mcr\n\n## Overview\nThis script generates a T-shaped steel connector plate designed for CLT (Cross Laminated Timber) panels. It creates the steel plate geometry, machines a slot into the timber to embed the plate, and applies a pattern of fastener holes through both the plate and the wood.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the 3D model on Sip entities. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | This is a model generation script, not a 2D detailing tool. |\n\n## Prerequisites\n- **Required Entities**: At least one CLT Panel (Sip entity).\n- **Minimum Beam Count**: 1 Panel (Primary).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCLT-T-Connector.mcr` from the list.\n\n### Step 2: Configure Properties\n```\nDialog Box: hsbCLT-T-Connector\nAction: If no catalog key is preset, a dialog appears. Adjust dimensions (Length, Width, Height, etc.) and click OK.\n```\n\n### Step 3: Select Male CLT Panel\n```\nCommand Line: Select male CLT Panel\nAction: Click on the CLT panel that will host the T-connector (the panel receiving the slot).\n```\n\n### Step 4: Select Female CLT Panel\n```\nCommand Line: Select female CLT Panel (optional)\nAction: Click the adjacent CLT panel if you want the script to automatically stretch the male panel edge to meet the female panel. Press Enter to skip this step.\n```\n\n### Step 5: Define Insertion Point\n```\nCommand Line: \nAction: Click on or near the edge of the Male CLT Panel where you want the connector to be placed. The script will snap to the nearest edge.\n```\n\n## Properties Panel Parameters\n\n### Geometry\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Length | Number | 300 | The horizontal length of the connector plate flange. |\n| Width | Number | 100 | The vertical height of the connector plate flange. |\n| Height | Number | 215 | The depth of the connector web (the part inserted into the wood). |\n| Thickness | Number | 10 | The material thickness of the steel plate. |\n\n### Location\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Edge Offset | Number | 40 | Distance from the edge of the panel to the start of the connector. |\n| Center Offset | Number | 0 | Vertical offset relative to the center of the panel thickness. |\n\n### Tolerances\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| GapX | Number | 10 | Horizontal clearance for the slot (Length + 2*GapX). |\n| GapY | Number | 1 | Vertical clearance for the slot. |\n| GapZ | Number | 1 | Thickness clearance for the slot (Thickness + 2*GapZ). |\n\n### Drill Pattern\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Diameter | Number | 14 | Diameter of the fastener holes. |\n| Rows | Number | 5 | Number of fastener holes in the vertical direction. |\n| Row Offset | Number | 42 | Spacing between rows of fasteners. |\n| Columns | Number | 5 | Number of fastener holes in the horizontal direction. |\n| Column Offset | Number | 42 | Spacing between columns of fasteners. |\n| PatternMode | Dropdown | \\|1 Pattern\\| | Selects between a single pattern or a mirrored double pattern. |\n| PatternOffsetX | Number | 0 | Horizontal shift of the drill pattern origin. |\n| PatternOffsetY | Number | 0 | Vertical shift of the drill pattern origin. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the connector geometry and machining based on current properties or entity movements. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script uses standard properties and does not require an external settings file.\n\n## Tips\n- **Automatic Stretching**: If you select a Female Panel in Step 4 that is perpendicular to the Male Panel, the script will automatically shorten (stretch) the Male Panel edge to meet the Female Panel, minus the specified Edge Offset.\n- **Grip Editing**: You can select the inserted connector and drag the insertion point grip to a different edge. The connector will automatically re-orient to the new edge.\n- **Double Pattern**: When using \"2 Patterns\" mode, the script automatically calculates the necessary horizontal offset (`PatternOffsetX`) to prevent the two drill grids from overlapping each other.\n\n## FAQ\n- **Q: Why did my connector disappear?**\n  - **A:** The script may have failed to find a valid edge near your insertion point. Ensure you click close to the edge of the CLT panel.\n- **Q: Can I use this to connect two walls?**\n  - **A:** Yes, by selecting the second wall as the \"Female Panel\", the script will adjust the length of the first wall to create a tight connection.\n- **Q: How do I change the hole spacing after insertion?**\n  - **A:** Select the connector, open the Properties palette (Ctrl+1), and modify the \"Row Offset\" or \"Column Offset\" values under the Drill Pattern section."
      },
      "tokens_used": 7280,
      "error": null
    }
  }
}