{
  "filename": "GE_HDWR_STUD_PLATE_TIE_SPT_TYPES_4_6_8.mcr",
  "status": "completed",
  "total_tokens": 46552,
  "processing_time": 527.4206948280334,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": 0,\n    \"keywords\": [],\n    \"majorVersion\": 0,\n    \"minorVersion\": 0,\n    \"dxaOut\": 0,\n    \"implInsert\": 0\n  },\n  \"description\": null,\n  \"versionHistory\": [\n    {\n      \"version\": \"1.1\",\n      \"date\": \"02.jun.2014\",\n      \"author\": \"David Rueda (dr@hsb-cad.com)\",\n      \"changes\": \"Added features to make possible reset TXT source file using GE_HDWR_RESET_CATALOG_ENTRY tsl\"\n    },\n    {\n      \"version\": \"1.0\",\n      \""
      },
      "tokens_used": 8426,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script constructs 3D Body geometry using PLine extrusions and Vector3d calculations. It prompts for entity selection (Beams) via PrEntity and generates physical hardware parts in the model. No sd_ (ShopDrawing) functions or _Viewport usage found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam (Vertical Studs)",
            "GenBeam (Bottom/Top Plates)"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Requires Model Space context with structural framing elements (studs and plates).",
          "requiredSettings": [
            "TSL_Read_Metalpart_Family_Props.dll (located in Utilities\\TslCustomSettings)",
            "TXT source file containing SPT family details"
          ]
        }
      },
      "tokens_used": 6103,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "callDotNetFunction2",
              "promptOriginal": "Select Type from Family",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select stud(s) and plate(s)",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "Pick a point to define on what face of studs place hardware",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "CustomDotNetDialog",
            "trigger": "On Insert, Recalc, or 'Change type' context menu",
            "title": "Hardware Type Selection",
            "dataSource": "TSL_Read_Metalpart_Family_Props.dll via fnReadFamilyPropsFromTXT",
            "features": {
              "searchable": true,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "Type",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dBeamWidth",
            "type": "PropDouble",
            "displayName": "Beam Width",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dHeightFromBase",
            "type": "PropDouble",
            "displayName": "Height from base",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "Width",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Change type",
            "handler": "_kExecuteKey == \"Change type\"",
            "action": "Re-invokes the DotNet dialog to allow changing the selected hardware type.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Help",
            "handler": "_kExecuteKey == \"Help\"",
            "action": "Displays usage information via reportNotice.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "TSL_HARDWARE_FAMILY_LIST.dxx",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Catalog\\"
            ],
            "purpose": "Master list of hardware families available in the catalog.",
            "required": true
          },
          {
            "filename": "TXT source file",
            "searchPaths": [
              "Prompted from user if not found"
            ],
            "purpose": "Contains specific dimensions and properties for the SPT_TYPES_4_6_8 family.",
            "required": true
          }
        ]
      },
      "tokens_used": 8969,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates 3D models of SPT (Stud Plate Tie) hardware, which connects vertical wall studs to top or bottom plates to resist uplift forces.",
          "category": "Hardware",
          "typicalUseCase": "Used when detailing timber framed walls to add structural hold-downs (similar to Simpson Strong-Tie SPH) that tie the studs to the plates to prevent wall racking or uplift."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "Derived from 'SELECTEDTYPE' key in Map via DotNet dialog",
            "businessMeaning": "The specific manufacturer model or catalog code of the stud plate tie (e.g., 'SPT4', 'SPT6').",
            "validRange": "Specific codes defined in 'SPT_TYPES_4_6_8' family TXT file",
            "unit": "String",
            "affectsOutput": "Updates all dimensions (width, height, thickness) and geometry of the metal part to match the catalog specifications."
          },
          {
            "name": "dBeamWidth",
            "technicalDefault": "115mm (if not provided by TXT)",
            "businessMeaning": "The depth of the timber stud that the hardware wraps around. Determines the 'throat' depth of the tie.",
            "validRange": "89mm to 140mm (Typical timber framing depths: 3x4, 4x4, 2x6, etc.)",
            "unit": "mm",
            "affectsOutput": "Controls the spacing between the front and back face plates of the hardware. If invalid, the default 115mm is used and the part is drawn in red to warn the user."
          },
          {
            "name": "dHeightFromBase",
            "technicalDefault": "29mm (if not provided by TXT)",
            "businessMeaning": "The vertical height of the upright legs of the tie extending from the base plate.",
            "validRange": "25mm to 100mm (Depends on specific hardware model and nailing requirements)",
            "unit": "mm",
            "affectsOutput": "Determines the vertical extrusion length of the front and back metal plates."
          },
          {
            "name": "dWidth",
            "technicalDefault": "35mm (if not provided by TXT)",
            "businessMeaning": "The horizontal width of the hardware (perpendicular to the wall face/stud length).",
            "validRange": "25mm to 75mm (Typically corresponds to the width of the plate or stud width)",
            "unit": "mm",
            "affectsOutput": "Defines the width of the base plate and the vertical plates."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User selects new Type via 'Change type' or initial Insertion",
            "effect": "The DotNet function reads a TXT catalog file and populates the Map with new 'Beam Width', 'Height from base', and 'WIDTH' values.",
            "cascade": [
              "dBeamWidth",
              "dHeightFromBase",
              "dWidth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (MetalPart)",
            "description": "A U-shaped strap bracket consisting of a base plate attached to the top/bottom plate and two vertical legs wrapping the side of the stud.",
            "appliedTo": "Generated as a 3D representation in Model Space, linked to the selected Stud and Plate entities. The script handles positioning by calculating the offset from the plate surface based on the presence of 'Very' plates (double plates)."
          }
        ]
      },
      "tokens_used": 7202,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts, checks execution trigger (Insert, Recalc, Change Type, Help).",
          "If 'Help', show report and exit. Otherwise, check insertCycleCount; if >1, erase duplicate and exit.",
          "Initialize DotNet parameters (Catalog Path, Family Name).",
          "Call 'TSL_Read_Metalpart_Family_Props.dll' to open Type Selection dialog.",
          "Validate output: If Insert mode and no type selected/returned, erase and exit.",
          "If Recalc or Change Type, update internal Map (_Map) with new properties.",
          "If Insert mode, prompt user to 'Select stud(s) and plate(s)' (PrEntity).",
          "Validate selection: If no beams selected, erase and exit.",
          "Prompt user to 'Pick a point' to define hardware face (getPoint).",
          "Sort selected beams into Verticals, Bottom Plates, Top Plates.",
          "Validate composition: Require at least 1 Vertical AND (1 Bottom OR 1 Top). If missing, report error and erase.",
          "Identify the closest vertical beam to the picked reference point.",
          "Loop through all valid vertical beams:",
          "Create a new script instance (TslInst) for each vertical beam.",
          "If Bottom Plates exist, create instance connecting Stud + Bottom Plates.",
          "If Top Plates exist, create instance connecting Stud + Top Plates.",
          "Pass current Map and Reference Point to new instances.",
          "Erase the original temporary insertion instance and exit.",
          "Child Instance Execution (bOnInsert=true in Map):",
          "Retrieve Stud (_Beam[0]) and Plates from arguments.",
          "Sort Plates into Bottom/Top and 'Very' (Double) variants.",
          "Calculate intersection points to determine the primary plate and any extra 'Very' plate relative to the stud.",
          "Determine local coordinate system (vx, vy, vz) based on stud and plate geometry.",
          "Relocate origin (_Pt0) to the correct face of the stud.",
          "Store calculated vectors and widths in Map.",
          "Set dependencies on Stud and Plates.",
          "Assign script to Element Group if applicable.",
          "Generate 3D Geometry:",
          "Check Map for valid dimensions (Beam Width, Height, Width).",
          "If invalid dimensions, set defaults (115mm, 29mm, 35mm) and set display color to Red.",
          "Check for duplicate TSL instances on the same stud; erase if found too close.",
          "Draw Front Plate (PLine extrusion).",
          "Draw Back Plate (Transformed Front Plate).",
          "Draw Base Plate (PLine extrusion).",
          "Finish."
        ],
        "conditionalBranches": [
          {
            "condition": "Script Trigger",
            "path1": {
              "name": "Help Context Menu",
              "steps": [
                "Display reportNotice with SPTH usage instructions.",
                "Terminate execution."
              ]
            },
            "path2": {
              "name": "Insert, Recalc, or Change Type",
              "steps": [
                "Proceed to DotNet Dialog and Geometry logic."
              ]
            }
          },
          {
            "condition": "Mode of Execution (Initial Insert vs Generated Child)",
            "path1": {
              "name": "Initial Insert (Manager Logic)",
              "steps": [
                "Prompt for Type Selection.",
                "Prompt for Beam Set (Studs + Plates).",
                "Prompt for Reference Point.",
                "Loop and spawn Child Instances (dbCreate) for each specific Stud/Plate connection.",
                "Erase self."
              ]
            },
            "path2": {
              "name": "Generated Child (Logic)",
              "steps": [
                "Receive specific Stud and Plate entities.",
                "Calculate precise local coordinates based on 'Very' plate offsets.",
                "Generate MetalPart Body geometry."
              ]
            }
          },
          {
            "condition": "Presence of 'Very' Plates (Double Top/Bottom)",
            "path1": {
              "name": "Standard Plate",
              "steps": [
                "Calculate Base Plate offset using standard Plate Width (dPlateWidth).",
                "Geometry flush against standard plate."
              ]
            },
            "path2": {
              "name": "Very Plate Present",
              "steps": [
                "Add 'Very' Plate width (dVeryPlateWidth) to the offset calculation.",
                "Geometry shifts to accommodate the extra plate thickness."
              ]
            }
          },
          {
            "condition": "Catalog Data Validity",
            "path1": {
              "name": "Valid Dimensions",
              "steps": [
                "Extract 'Beam Width', 'Height from base', 'WIDTH' from Map.",
                "Draw geometry in standard color."
              ]
            },
            "path2": {
              "name": "Invalid/Default Dimensions",
              "steps": [
                "Set default values (115mm x 29mm x 35mm).",
                "Set display color to Red (1) to indicate warning.",
                "Draw geometry."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "DotNet Dialog Selection",
            "errorMessage": "(Implicit) If insert mode and mapOut is empty, instance is erased silently or via lack of type.",
            "recovery": "User must select a valid type during the initial dialog."
          },
          {
            "check": "Beam Selection Count",
            "errorMessage": "User must select at least one vertical stud and one top or bottom plate.",
            "recovery": "Select correct beams and restart command."
          },
          {
            "check": "Plate Intersection Logic",
            "errorMessage": "If 'bmFirstPlate' is not found via ray intersection (e.g., plates don't touch stud), instance is erased.",
            "recovery": "Ensure plates physically intersect or touch the vertical studs in the model."
          },
          {
            "check": "Duplicate Detection",
            "errorMessage": "None displayed to user.",
            "recovery": "Script automatically erases any previous instance of itself on the same stud within 1mm distance."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Type",
            "how": "Right-click context menu -> 'Change type'",
            "effect": "Re-opens the DotNet Dialog. Selecting a new type updates the 'sType', 'dBeamWidth', 'dHeightFromBase', and 'dWidth' properties, triggering a geometry redraw."
          },
          {
            "action": "Relocate / Update",
            "how": "Standard AutoCAD grips or moving the connected Stud/Plate entities.",
            "effect": "Because dependencies (setDependencyOnEntity) are set, moving the stud or plates triggers a recalculation. The script re-evaluates its position relative to the plates (including 'Very' plates) and redraws the hardware at the new location."
          },
          {
            "action": "Reset Catalog Source",
            "how": "Run 'GE_HDWR_RESET_CATALOG_ENTRY' TSL (mentioned in header comments).",
            "effect": "Allows resetting the file path to the TXT source file if it was moved or lost."
          }
        ]
      },
      "tokens_used": 9427,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_STUD_PLATE_TIE_SPT_TYPES_4_6_8.mcr\n\n## Overview\nThis script generates 3D models of SPT (Stud Plate Tie) hardware, connecting vertical wall studs to top or bottom plates to resist uplift forces. It is designed to create structural hold-downs automatically based on a selectable catalog of types.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script creates 3D Body geometry. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | Does not generate 2D shop drawings directly. |\n\n## Prerequisites\n- **Required Entities**: \n  - GenBeam entities representing Vertical Studs.\n  - GenBeam entities representing Bottom or Top Plates.\n- **Minimum Beam Count**: At least 1 Stud and 1 Plate must be selected.\n- **Required Settings Files**: \n  - `TSL_Read_Metalpart_Family_Props.dll` (located in `Utilities\\TslCustomSettings`).\n  - A TXT source file containing dimensions for the SPT_TYPES_4_6_8 family.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT`\n**Action**: Browse and select `GE_HDWR_STUD_PLATE_TIE_SPT_TYPES_4_6_8.mcr`.\n\n### Step 2: Select Hardware Type\n**Command Line**: `Select Type from Family`\n**Action**: A dialog box will appear. Search for and select the specific hardware model (e.g., SPT4, SPT6) you wish to use. Click OK.\n\n### Step 3: Select Structural Elements\n**Command Line**: `Select stud(s) and plate(s)`\n**Action**: Click on the vertical studs and the top/bottom plates you want to connect. Press Enter when finished.\n\n### Step 4: Define Location\n**Command Line**: `Pick a point to define on what face of studs place hardware`\n**Action**: Click on the side face of a stud where you want the tie to be installed. The script will calculate connections for all selected studs relative to this face.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | Text | *From Catalog* | The manufacturer model or catalog code (e.g., 'SPT6'). Changing this reloads dimensions from the catalog. |\n| Beam Width | Number | 115mm | The depth of the timber stud (throat depth). If this defaults to red, check your catalog data. |\n| Height from base | Number | 29mm | The vertical height of the tie's legs extending from the plate. |\n| Width | Number | 35mm | The horizontal width of the hardware strap. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change type | Re-opens the hardware selection dialog, allowing you to switch to a different model code without re-inserting the script. |\n| Help | Displays a brief usage report in the command line. |\n\n## Settings Files\n- **Filename**: `TSL_HARDWARE_FAMILY_LIST.dxx`\n  - **Location**: `_kPathHsbCompany\\TSL\\Catalog\\`\n  - **Purpose**: Defines the master list of available hardware families.\n- **Filename**: TXT Source File (Specific to SPT family)\n  - **Location**: Prompted if not found in standard paths.\n  - **Purpose**: Contains the specific dimensions (width, height, thickness) for the different SPT types (4, 6, 8, etc.).\n\n## Tips\n- **Visual Warnings**: If the generated hardware appears in **Red**, the script could not find the specific dimension for the Beam Width in the catalog and used a default value (115mm). Update the `dBeamWidth` property manually or ensure the TXT catalog is correct.\n- **Double Plates**: The script automatically detects \"Very\" plates (double top/bottom plates) and adjusts the hardware offset accordingly.\n- **Automatic Updates**: If you move a stud or plate connected to the hardware, the tie will automatically update its position to maintain the connection.\n\n## FAQ\n- **Q: Why did the script fail to insert?**\n  - A: Ensure you selected at least one vertical stud and one plate (top or bottom). The script requires both to calculate the connection.\n- **Q: Can I update multiple existing connections at once?**\n  - A: No, the \"Change type\" option updates the specific instance you right-clicked. Use standard AutoCAD selection methods if you need to delete and regenerate multiple instances.\n- **Q: How do I fix the path if the TXT file is missing?**\n  - A: Use the `GE_HDWR_RESET_CATALOG_ENTRY` script to reset the file path to the correct TXT source location."
      },
      "tokens_used": 6425,
      "error": null
    }
  }
}