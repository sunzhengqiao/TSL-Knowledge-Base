{
  "filename": "HSB_E-ReferenceDrill.mcr",
  "status": "completed",
  "total_tokens": 49219,
  "processing_time": 295.1252634525299,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": \"\",\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": 1,\n    \"minorVersion\": 5,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"This tsl inserts drills as a reference position. The drills are placed along a vertical and/or horizontal line. This lines are offsetted from the element origin and can be moved with a grippoint afterwards. The drills are placed in the center of the beams.\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.00\",\n      \"date\": \"23.04.2014\",\n      \"author\": \"AS\",\n      \"changes\": \"Pilot version\"\n    },\n    {\n      \"version\": \"1.01\",\n      \"date\": \"20.06.2014\",\n      \"author\": \"AS\",\n      \"changes\": \"Drill smallest side\"\n    },\n    {\n      \"version\": \"1.02\",\n      \"date\": \"20.06.2014\",\n      \"author\": \"AS\",\n     "
      },
      "tokens_used": 9063,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No Paper Space or ShopDrawing detection patterns found (no sd_ prefix, no #Type E with _Entity, no _Viewport usage). The script explicitly uses _kModelSpace in the `dbCreate` call. The script logic processes GenBeams within an Element structure suitable for 3D model processing."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Elements with GenBeams.",
          "requiredSettings": []
        }
      },
      "tokens_used": 5661,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && (_kExecuteKey == \"\" || arSCatalogNames.find(_kExecuteKey) == -1)",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert if _kExecuteKey is empty or not found in catalog names",
            "title": null,
            "dataSource": "Properties defined in script (sFilterType, sFilterBC, etc.)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeperator01",
            "type": "PropString",
            "displayName": "|Selection|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sFilterType",
            "type": "PropString",
            "displayName": "     |Filter type|",
            "defaultValue": "|Include|",
            "inputType": "dropdown",
            "options": [
              "|Include|",
              "|Exclude|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sFilterBC",
            "type": "PropString",
            "displayName": "     |Filter beams with beamcode|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sSeperator02",
            "type": "PropString",
            "displayName": "|Position|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sHorizontalPlanePositions",
            "type": "PropString",
            "displayName": "     |Horizontal positions|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sVerticalPlanePositions",
            "type": "PropString",
            "displayName": "     |Vertical positions|",
            "defaultValue": "500",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sSeperator03",
            "type": "PropString",
            "displayName": "|Drill|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dDiameterDrill",
            "type": "PropDouble",
            "displayName": "     |Diameter|",
            "defaultValue": "U(18)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sSeperator04",
            "type": "PropString",
            "displayName": "|Visualisation|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "     |Color|",
            "defaultValue": 4,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dSymbolSize",
            "type": "PropDouble",
            "displayName": "     |Symbol size|",
            "defaultValue": "U(40)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "MasterToSatellite (Catalog Mapping)",
            "handler": "_Map.getInt(\"MasterToSatellite\")",
            "action": "Updates property values from the 'MasterToSatellite' catalog entry if the map flag exists.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "Catalog",
            "searchPaths": [
              "HSB_E-ReferenceDrill"
            ],
            "purpose": "Stores property presets for ExecuteKeys and MasterToSatellite mapping.",
            "required": false
          }
        ]
      },
      "tokens_used": 8241,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically creates reference drilling grids on multiple beams within an element. Drills are placed at specified intervals along vertical and horizontal axes relative to the element origin, often used for alignment marks or assembly reference points.",
          "category": "Machining",
          "typicalUseCase": "Creating alignment or reference holes on wall/floor elements during production or assembly to ensure components are positioned correctly relative to each other."
        },
        "parameters": [
          {
            "name": "sFilterType",
            "technicalDefault": "|Include|",
            "businessMeaning": "Determines if the beam code list acts as a whitelist (only drill these beams) or blacklist (drill everything except these).",
            "validRange": "|Include|, |Exclude|",
            "unit": "Selection",
            "affectsOutput": "Controls which specific beams within the selected element receive the reference drills based on their beam codes."
          },
          {
            "name": "sFilterBC",
            "technicalDefault": "",
            "businessMeaning": "List of beam codes (e.g., 'STU', 'RIE') used to filter which beams are drilled. Supports wildcards (e.g., '*STU*').",
            "validRange": "Any valid beam code string or wildcard pattern, separated by semicolons.",
            "unit": "String",
            "affectsOutput": "Restricts or includes beams for drilling operations based on their naming conventions or types."
          },
          {
            "name": "sHorizontalPlanePositions",
            "technicalDefault": "",
            "businessMeaning": "Distance(s) from the element origin along the element's Y-axis (horizontal in plan view) where vertical drilling planes are created.",
            "validRange": "0 to Element Width/Length",
            "unit": "mm",
            "affectsOutput": "Creates a line of drills running parallel to the element X-axis at these specific Y offsets."
          },
          {
            "name": "sVerticalPlanePositions",
            "technicalDefault": "500",
            "businessMeaning": "Distance(s) from the element origin along the element's X-axis (horizontal in elevation/width) where vertical drilling planes are created.",
            "validRange": "0 to Element Width/Length",
            "unit": "mm",
            "affectsOutput": "Creates a line of drills running parallel to the element Y-axis at these specific X offsets."
          },
          {
            "name": "dDiameterDrill",
            "technicalDefault": "U(18)",
            "businessMeaning": "The diameter of the reference hole to be drilled through the beam.",
            "validRange": "6mm to 50mm (typical reference hole sizes)",
            "unit": "mm",
            "affectsOutput": "Directly sets the diameter of the cylindrical void added to the beam."
          },
          {
            "name": "nColor",
            "technicalDefault": "4",
            "businessMeaning": "CAD color index used for the visualization symbols and grid lines in the model.",
            "validRange": "1 to 255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the visual appearance of the grid indicators and script markers in 3D views and drawings."
          },
          {
            "name": "dSymbolSize",
            "technicalDefault": "U(40)",
            "businessMeaning": "Size of the graphical symbol displayed in the model to indicate the presence and settings of the script.",
            "validRange": "10mm to 100mm",
            "unit": "mm",
            "affectsOutput": "Scales the non-geometric marker drawn at the element origin."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Moving a GripPoint (_PtG)",
            "effect": "Updates the specific offset in either the Horizontal or Vertical position string properties.",
            "cascade": [
              "sHorizontalPlanePositions",
              "sVerticalPlanePositions"
            ]
          },
          {
            "trigger": "Changing sFilterType",
            "effect": "Inverts the logic used when parsing sFilterBC.",
            "cascade": [
              "sFilterBC"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Drill",
            "description": "Through-holes placed at the intersection of the beam centerline and the defined vertical/horizontal reference planes.",
            "appliedTo": "Filtered GenBeams within the selected Element."
          },
          {
            "type": "PLine/Text",
            "description": "Visual indicators showing the grid origin and script name for identification in the model.",
            "appliedTo": "Element Origin (Visualization only)."
          }
        ]
      },
      "tokens_used": 8684,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts execution.",
          "Check if running on insert (_bOnInsert).",
          "[On Insert] Check if insertCycleCount > 1. If yes, erase current instance and exit (prevent duplicates).",
          "[On Insert] Check if _kExecuteKey is empty or not found in catalog names.",
          "[On Insert] If check passes, show dynamic dialog to configure properties (sFilterType, sFilterBC, Positions, Diameter, etc.).",
          "[On Insert] Prompt user to select a set of Elements (PrEntity).",
          "[On Insert] If selection successful, iterate through selected elements.",
          "[On Insert] For each element, erase any existing instances of HSB_E-ReferenceDrill.",
          "[On Insert] Create a new TslInst (Satellite) on each selected element with current properties and ExecuteMode=1.",
          "[On Insert] Erase the Master script instance and exit.",
          "[Recalculation] Check if Element exists. If not, erase and exit.",
          "[Recalculation] Get Element and assign to layer group 'E'.",
          "[Recalculation] Parse Filter properties (sFilterType, sFilterBC) to create beam inclusion/exclusion list.",
          "[Recalculation] Parse Position strings (sHorizontalPlanePositions, sVerticalPlanePositions) to create offset arrays.",
          "[Recalculation] Iterate through all GenBeams in the Element.",
          "[Recalculation] Filter beams: Exclude dummies. Apply beam code filters based on Include/Exclude logic.",
          "[Recalculation] Collect valid Beams and their envelope vertices to determine Element bounding box.",
          "[Recalculation] Determine Reference Point (Bottom-Left) from beam vertices.",
          "[Recalculation] Check if a GripPoint (_PtG) was moved/changed.",
          "[Recalculation] If GripPoint moved, update the corresponding Horizontal or Vertical offset value in memory.",
          "[Recalculation] Generate intersection Planes based on calculated offsets.",
          "[Recalculation] Generate Visualization: Draw grid lines representing the planes in Element Zone 'T'.",
          "[Recalculation] Iterate through valid Beams to generate Drills.",
          "[Recalculation] For each Beam, calculate intersection with each reference Plane.",
          "[Recalculation] If intersection exists within beam length, calculate drill vector (drill through smallest side).",
          "[Recalculation] Create Drill operation and add to Beam.",
          "[Recalculation] Update Properties: Write modified offset values back to sHorizontalPlanePositions and sVerticalPlanePositions strings.",
          "[Recalculation] Generate Visualization: Draw symbol and text in Element Zone 'I' (Side and Plan views)."
        ],
        "conditionalBranches": [
          {
            "condition": "Is the script being inserted?",
            "path1": {
              "name": "Insertion Path (Master)",
              "steps": [
                "Check insert cycle.",
                "Show Dialog (if needed).",
                "Prompt for Elements.",
                "Spawn Satellite instances.",
                "Erase Self."
              ]
            },
            "path2": {
              "name": "Recalculation Path (Satellite)",
              "steps": [
                "Validate Element.",
                "Parse Properties.",
                "Filter Beams.",
                "Calculate Grid/Planes.",
                "Apply Drills.",
                "Draw Visualization."
              ]
            }
          },
          {
            "condition": "Beam Code Filter Logic",
            "path1": {
              "name": "Include Mode",
              "steps": [
                "Beam is processed ONLY if its code matches the sFilterBC list.",
                "Non-matching beams are ignored."
              ]
            },
            "path2": {
              "name": "Exclude Mode",
              "steps": [
                "Beam is processed ONLY if its code does NOT match the sFilterBC list.",
                "Matching beams are ignored."
              ]
            }
          },
          {
            "condition": "Is the Element a Multi-Element?",
            "path1": {
              "name": "Standard Element",
              "steps": [
                "Visualization Symbol is drawn at Element Origin."
              ]
            },
            "path2": {
              "name": "Multi-Element",
              "steps": [
                "Visualization Symbol is drawn offset by 200mm in X direction to avoid overlap."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Internal Logic)",
            "recovery": "Script automatically erases the new instance if count > 1 to prevent multiple masters."
          },
          {
            "check": "Selected Element Set",
            "errorMessage": "None (Silent)",
            "recovery": "If user cancels element selection (ssE.go() == false), the master script erases itself without doing anything."
          },
          {
            "check": "Element Exists on Recalculation",
            "errorMessage": "None (Internal Logic)",
            "recovery": "If _Element array is empty, the script instance erases itself."
          },
          {
            "check": "Beams found for Reference",
            "errorMessage": "None (Internal Logic)",
            "recovery": "If no beam vertices are found to calculate reference points, the script returns early, effectively doing nothing until beams are present."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Reference Grid Position",
            "how": "GripPoint Edit (Drag the grid lines visualized in the model)",
            "effect": "Moving a grip updates the specific offset value in sHorizontalPlanePositions or sVerticalPlanePositions. Drills move automatically to the new location."
          },
          {
            "action": "Change Filter Settings",
            "how": "OPM Properties (Select Element, change sFilterType or sFilterBC)",
            "effect": "Script recalculates. Beams are added or removed from the drilling operation based on the new filter rules."
          },
          {
            "action": "Adjust Drill Diameter",
            "how": "OPM Properties (Change dDiameterDrill)",
            "effect": "All drill operations on filtered beams update to the new diameter."
          },
          {
            "action": "Update Visualization",
            "how": "OPM Properties (Change nColor or dSymbolSize)",
            "effect": "The grid lines and script symbols change color or size immediately."
          }
        ]
      },
      "tokens_used": 10374,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-ReferenceDrill.mcr\n\n## Overview\nAutomatically creates reference drilling grids on multiple beams within an element. Drills are placed at specified intervals along vertical and horizontal axes relative to the element origin, useful for alignment marks or assembly reference points.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model environment. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Not designed for 2D drawings. |\n\n## Prerequisites\n- **Required Entities**: Elements containing GenBeams.\n- **Minimum Beam Count**: 0 (Script handles empty elements gracefully).\n- **Required Settings Files**: None (Catalog entries optional for ExecuteKeys).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT`\n**Action:** Browse and select `HSB_E-ReferenceDrill.mcr`.\n\n### Step 2: Configure Properties\n**Dialog Box:** A dynamic dialog will appear upon insertion.\n**Action:**\n1. **Selection**: Choose whether to \"Include\" or \"Exclude\" specific beam codes. Enter the beam codes (e.g., `STU`, `RIE`) if filtering is required.\n2. **Position**: Enter distances for \"Horizontal positions\" and \"Vertical positions\" (e.g., `500; 1000`).\n3. **Drill**: Set the desired Diameter for the reference holes.\n4. Click **OK** to confirm.\n\n### Step 3: Select Elements\n**Command Line:** `Select a set of elements`\n**Action:** Click on the Element(s) in the model where you want to add reference drills. Press Enter to finish selection.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| \\|Selection\\| | Header | - | Section header for filtering settings. |\n| \\|Filter type\\| | Dropdown | Include | Determines if the beam code list acts as a whitelist (Include) or blacklist (Exclude). |\n| \\|Filter beams with beamcode\\| | Text | - | List of beam codes to filter. Supports wildcards (e.g., `*STU*`). |\n| \\|Position\\| | Header | - | Section header for grid position settings. |\n| \\|Horizontal positions\\| | Text | - | Distances (mm) along the element Y-axis where vertical drill planes are created. |\n| \\|Vertical positions\\| | Text | 500 | Distances (mm) along the element X-axis where vertical drill planes are created. |\n| \\|Drill\\| | Header | - | Section header for machining settings. |\n| \\|Diameter\\| | Number | 18 | Diameter of the reference drill hole. |\n| \\|Visualisation\\| | Header | - | Section header for display settings. |\n| \\|Color\\| | Number | 4 | CAD color index for the grid lines and markers. |\n| \\|Symbol size\\| | Number | 40 | Size of the graphical marker displayed in the model. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| MasterToSatellite (Catalog Mapping) | Updates property values from a specific catalog entry if a mapping flag exists (Advanced use). |\n\n## Settings Files\n- **Filename**: Catalog entries (internal)\n- **Location**: Company or Install hsbCAD Catalog path\n- **Purpose**: Stores property presets for ExecuteKeys and MasterToSatellite mapping, allowing for quick loading of standard drilling configurations.\n\n## Tips\n- **Interactive Adjustment**: After insertion, select the element and look for the grip points on the visualized grid lines. Drag these points to visually adjust the drilling positions; the property values will update automatically.\n- **Beam Filtering**: Use the \"Filter beams with beamcode\" field with wildcards (e.g., `*Wall*`) to apply drills only to specific types of beams within a complex element.\n- **Coordinate Origin**: The script calculates the reference origin based on the bounding box of the beams. Ensure your beams are correctly positioned before inserting the script.\n\n## FAQ\n- **Q: How do I move the drill lines after I have placed them?**\n  A: Select the script instance in the model. You will see grip points along the horizontal and vertical grid lines. Click and drag these grip points to the desired location. The drill positions will update immediately.\n- **Q: Why are some of my beams not getting drilled?**\n  A: Check the Properties Palette. Ensure the \"Filter type\" is set correctly (Include vs. Exclude) and that the \"Filter beams with beamcode\" matches the codes of the beams you wish to process.\n- **Q: Can I use multiple distances for the grid?**\n  A: Yes. In the \"Horizontal positions\" or \"Vertical positions\" fields, enter multiple values separated by semicolons (e.g., `500; 1000; 1500`)."
      },
      "tokens_used": 7196,
      "error": null
    }
  }
}