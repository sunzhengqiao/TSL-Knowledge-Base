{
  "filename": "hsb_SplitPlates.mcr",
  "status": "completed",
  "total_tokens": 53235,
  "processing_time": 367.43208265304565,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "v1.0",
            "date": "050415",
            "author": "Anno Sportel",
            "changes": "First revision"
          },
          {
            "version": "v1.1",
            "date": "070316",
            "author": "Anno Sportel",
            "changes": "label splitted beams\n\t\t\tMake a diffrence between small modules and big ones."
          },
          {
            "version": "v1.2",
            "date": "070327",
            "author": "Anno Sportel",
            "changes": "Join platess first"
          },
          {
            "version": "v1.3",
            "date": "070820",
            "author": "Alberto Jena",
            "changes": "Dont join very top plate\n\t\t\tLabel from right to left"
          },
          {
            "version": "v1.4",
            "date": "070823",
            "author": "Alberto Jena",
            "changes": "very top plate is split when it have\n\t\t\ta stud bellow"
          },
          {
            "version": "v1.5",
            "date": "100831",
            "author": "Alberto Jena",
            "changes": "split the plates after they are name."
          },
          {
            "version": "v1.6",
            "date": "101109",
            "author": "Alberto Jena",
            "changes": "Add the option to create Splice Blocks"
          },
          {
            "version": "v1.7",
            "date": "110128",
            "author": "Alberto Jena",
            "changes": "Exclude the beams with beam code H"
          },
          {
            "version": "v1.8",
            "date": "110923",
            "author": "Alberto Jena",
            "changes": "Allow the TSL to run from the details"
          },
          {
            "version": "v1.9",
            "date": "07.11.2017",
            "author": "Mihai Bercuci",
            "changes": "Fix the defect when the TSL was removing one beam"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8592,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity to select 'Element' objects from the drawing. It performs direct 3D model modifications using dbSplit, dbJoin, and dbCreate on Beam objects. There is no usage of sd_ functions, _Viewport, or paper space specific entities."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing wall elements with plates (Top/Bottom)",
          "requiredSettings": []
        }
      },
      "tokens_used": 7637,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialogOnce",
            "trigger": "Insertion when _kExecuteKey is empty",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dMaxLength",
            "type": "PropDouble",
            "displayName": "Maximum length",
            "defaultValue": "4800",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dSizeOpeningModule",
            "type": "PropDouble",
            "displayName": "Opening module dimensions greater than",
            "defaultValue": "605",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dDistOpeningModule",
            "type": "PropDouble",
            "displayName": "Split distance to opening mudule",
            "defaultValue": "269",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dDistSmallModule",
            "type": "PropDouble",
            "displayName": "Split distance to small mudule",
            "defaultValue": "119",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dDistStud",
            "type": "PropDouble",
            "displayName": "Split distance to stud",
            "defaultValue": "119",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sResetSplittedStatus",
            "type": "PropString",
            "displayName": "Reset 'wall splitted' status",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sSpliceBlocks",
            "type": "PropString",
            "displayName": "Create splice blocks",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "Will Create Splice blocks in the location of the splits"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8223,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automatically splits wall top and bottom plates into transportable lengths based on a maximum length parameter, optimizing splice locations relative to studs and openings.\",\n    \"category\": \"Framing/Automation\",\n    \"typicalUseCase\": \"Used when a wall element exceeds standard raw material lengths (e.g., 4800mm or 6000mm) and needs to be broken into smaller segments with splices positioned at structurally appropriate locations (e.g., away from window headers or aligned with studs).\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"dMaxLength\",\n      \"technicalDefault\": \"4800\",\n      \"businessMeaning\": \"The maximum allowed length for a single plate segment, typically determined by transportation constraints or stock timber lengths.\",\n      \"validRange\": \"2400 - 12000 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Controls the frequency of splits. Plates longer than this value will be cut into multiple pieces.\"\n    },\n    {\n      \"name\": \"dSizeOpeningModule\",\n      \"technicalDefault\": \"605\",\n      \"businessMeaning\": \"The width threshold used to classify an opening as 'large'. Openings wider than this value are treated as 'Opening Modules' ("
      },
      "tokens_used": 11192,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch hsb_SplitPlates.mcr",
          "Check Execution Context: If executing for the first time (insertCycleCount <= 1), proceed",
          "User Interaction: If _kExecuteKey is empty, display Properties Dialog (showDialogOnce)",
          "User Input: Select a set of Elements (PrEntity)",
          "Data Collection: Gather all Openings and Beams from selected Elements",
          "Validation: Calculate minimum required split length based on largest opening and check against Maximum Length property",
          "Logic Branch: Check 'Reset 'wall splitted' status' property",
          "Path [Reset=Yes]: Iterate selected elements, remove 'Plates are split' text, display success message, Erase Instance",
          "Path [Reset=No]: Iterate each Element",
          "Element Loop: Check if element is already marked as split (Warning message only)",
          "Element Loop: Identify and classify plates (Top, Very Top, Bottom, Very Bottom) excluding beams with code 'H'",
          "Element Loop: Sort plates geometrically (Right to Left, Top to Bottom)",
          "Element Loop: Join adjacent plate segments into single beams (dbJoin)",
          "Element Loop: Calculate split points based on Studs, Modules, and Maximum Length",
          "Element Loop: Validate split points (ensure no duplicates/min distance)",
          "Action: Execute dbSplit on Top and Bottom plates at calculated points",
          "Conditional Action: If 'Create splice blocks' is Yes, generate blocking beams at split locations and stretch them to vertical members",
          "Action: Assign labels (A, B, C...) to split beam segments",
          "Action: Add 'Plates are split' text to Element",
          "Completion: Erase Script Instance"
        ],
        "conditionalBranches": [
          {
            "condition": "User selection for 'Reset 'wall splitted' status' property",
            "path1": {
              "name": "Reset Mode",
              "steps": [
                "Identify elements containing 'Plates are split' text",
                "Remove the specific ElemText from the element",
                "Report 'Splitted status is reset!'",
                "Erase TSL instance (stop processing)"
              ]
            },
            "path2": {
              "name": "Split Mode",
              "steps": [
                "Verify Opening dimensions fit within Max Length constraints",
                "Classify and Join plates",
                "Calculate split geometry",
                "Split beams and optionally create splice blocks",
                "Label resulting beams",
                "Mark element as processed"
              ]
            }
          },
          {
            "condition": "Opening size vs Maximum Length validation",
            "path1": {
              "name": "Validation Failure",
              "steps": [
                "Calculate required length: (Largest Opening + 2 * Split Distances)",
                "Compare against 'Maximum length' property",
                "If Required > Max: Display Warning 'Increase maximum split length...'",
                "Erase TSL instance (stop processing)"
              ]
            },
            "path2": {
              "name": "Validation Success",
              "steps": [
                "Proceed with beam processing"
              ]
            }
          },
          {
            "condition": "'Create splice blocks' property",
            "path1": {
              "name": "Yes (Create Blocks)",
              "steps": [
                "For every split point on Top/Bottom plates",
                "Calculate position adjacent to plate",
                "Create new Blocking beam (dbCreate)",
                "Stretch block to intersecting vertical beams"
              ]
            },
            "path2": {
              "name": "No (Do Nothing)",
              "steps": [
                "Skip block generation"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "Implicit (If selection is empty, script erases itself)",
            "recovery": "Select valid wall elements and run script again"
          },
          {
            "check": "Maximum Length vs Opening Geometry",
            "errorMessage": "Increase maximum split length to [Value]mm. Largest opening is [Value]",
            "recovery": "Increase the 'Maximum length' property or adjust 'Split distance' properties to accommodate the opening, then re-run"
          },
          {
            "check": "Split Point Spacing",
            "errorMessage": "Increase maximum split length! (VTP) or (BP/TP)",
            "recovery": "The calculated split points are too close together (geometry is too dense for the Max Length setting). Increase Max Length."
          },
          {
            "check": "Existing Split Status",
            "errorMessage": "Wall [Code][Number] is already split",
            "recovery": "Script attempts to split anyway. If this causes errors, use 'Reset 'wall splitted' status' = Yes first to clean the element."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Plate Geometry",
            "how": "The script modifies the underlying GenBeams directly via dbSplit and dbJoin.",
            "effect": "Original plates are replaced by multiple shorter segments with labels A, B, C, etc."
          },
          {
            "action": "Re-run Script",
            "how": "Since the script erases itself upon completion, user must launch the command again.",
            "effect": "Can be used to reset status (if switch changed) or re-split if geometry changed."
          }
        ]
      },
      "tokens_used": 11299,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SplitPlates.mcr\n\n## Overview\nAutomatically splits wall top and bottom plates into transportable lengths based on a maximum length setting. The script optimizes splice locations relative to studs and openings and optionally creates solid wood splice blocks at the split locations.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the 3D model on wall elements. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required entities**: Wall `Elements` (containing top and bottom plates).\n- **Minimum beam count**: N/A (Requires complete wall elements).\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_SplitPlates.mcr`\n\n### Step 2: Configure Properties\n```\nDialog: Properties Palette\nAction: Adjust the Maximum length and split distances if necessary. \n        Choose whether to create splice blocks or reset an existing split status.\n```\n*Note: The properties dialog appears automatically the first time you run the command in a session.*\n\n### Step 3: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the wall elements you wish to process and press Enter.\n```\n\n### Step 4: Processing\nThe script will automatically:\n1. Check if the wall is already marked as split.\n2. Join adjacent plate segments.\n3. Calculate split points based on studs, openings, and the maximum length.\n4. Split the plates and apply labels (A, B, C...).\n5. Erase itself from the drawing upon completion.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Maximum length | Number | 4800 | The maximum allowed length for a single plate segment (typically determined by raw material length or transport limits). |\n| Opening module dimensions greater than | Number | 605 | Threshold (width) to classify a wall opening as \"Large\". Openings wider than this trigger \"Opening Module\" split logic. |\n| Split distance to opening mudule | Number | 269 | The minimum distance allowed between a split point and the edge of a \"Large\" opening. |\n| Split distance to small mudule | Number | 119 | The minimum distance allowed between a split point and a \"Small\" opening/module. |\n| Split distance to stud | Number | 119 | The minimum distance allowed between a split point and a vertical stud. |\n| Reset 'wall splitted' status | Dropdown | Yes | If **Yes**, the script removes the \"Plates are split\" status from elements without splitting them. If **No**, the script performs the splitting operation. |\n| Create splice blocks | Dropdown | No | If **Yes**, generates solid blocking beams at the location of every split. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific items to the entity context menu. |\n\n## Settings Files\n- **None**: This script does not rely on external settings files.\n\n## Tips\n- **Resetting Walls**: If you need to re-run the script on a wall that has already been processed, set **Reset 'wall splitted' status** to `Yes` and run it once to clear the previous status. Then change it back to `No` and run it again to apply new splits.\n- **Validation Failure**: If the script reports \"Increase maximum split length...\", it means an opening in your wall is too wide to fit between the required split distances. Increase the **Maximum length** property to resolve this.\n- **Plate Labeling**: The script automatically labels resulting plate segments (A, B, C, etc.) to help identify them in lists and drawings.\n\n## FAQ\n- **Q: Why did the script disappear after I selected the elements?**\n  - **A:** The script is designed to run once and then erase itself automatically. The changes made to the plates (splitting and labeling) are permanent in the model.\n- **Q: The script warns that the wall is \"already split\". What should I do?**\n  - **A:** The script detected a marker text indicating previous processing. Use the **Reset 'wall splitted' status** property set to `Yes` to clean the wall, then run the script again with your desired settings.\n- **Q: What happens if my Maximum length is shorter than my wall opening?**\n  - **A:** The script will fail with a warning. You must increase the **Maximum length** property so that it is larger than the (Opening Width + 2 * Split Distances)."
      },
      "tokens_used": 6292,
      "error": null
    }
  }
}