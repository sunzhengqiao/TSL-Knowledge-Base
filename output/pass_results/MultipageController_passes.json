{
  "filename": "MultipageController.mcr",
  "status": "completed",
  "total_tokens": 48183,
  "processing_time": 309.77733635902405,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.2",
            "date": "21.01.2025",
            "author": "Thorsten Huck",
            "changes": "HSB-22556 alignment properties only visible if selected"
          },
          {
            "version": "1.1",
            "date": "08.01.2025",
            "author": "Thorsten Huck",
            "changes": "HSB-21565 new property to filter certain dimline alignments"
          },
          {
            "version": "1.0",
            "date": "07.01.2025",
            "author": "Thorsten Huck",
            "changes": "HSB-21565 initial version of MultipageController"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7702,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "Both",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "Script checks length of _Entity which is cast to ShopDrawView[]. If length is 0, it runs in Model Space prompting for a MultiPage entity (PrEntity selPage). If length > 0, it enters Block Space mode, adds triggers for _kShopDrawEvent, and checks _bOnGenerateShopDrawing. The header explicitly mentions 'block space of a multipage'."
        },
        "prerequisites": {
          "requiredEntities": [
            "MultiPage",
            "ShopDrawView",
            "DimLine"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (for batch processing existing pages) or Shopdrawing Block Space (for configuration during generation)",
          "requiredSettings": []
        }
      },
      "tokens_used": 7294,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10048,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically cleans up and organizes dimension lines within a MultiPage layout by removing redundant lines and realigning the rest with consistent spacing.",
          "category": "ShopDrawing / Automation",
          "typicalUseCase": "Used during the detailing phase when dimension lines generated by the system are overlapping, cluttered, or inconsistently spaced. It allows the user to quickly tidy up 2D drawings in Model Space or configure automatic cleanup for Shop Drawing generation."
        },
        "parameters": [
          {
            "name": "sPurge",
            "technicalDefault": "\"|No|\"",
            "businessMeaning": "Flag to enable the deletion of redundant or duplicate dimension lines.",
            "validRange": "Yes, No",
            "unit": "Boolean/String",
            "affectsOutput": "If set to 'Yes', overlapping or duplicate dimension lines are removed from the drawing."
          },
          {
            "name": "sAlign",
            "technicalDefault": "\"|No|\"",
            "businessMeaning": "Flag to enable the automatic realignment and spacing of dimension lines.",
            "validRange": "Yes, No",
            "unit": "Boolean/String",
            "affectsOutput": "If set to 'Yes', dimension lines are moved to prevent overlap, using defined offset distances. This reveals the offset properties (Baseline and Intermediate) for configuration."
          },
          {
            "name": "sFilter",
            "technicalDefault": "\"<|Any|>\"",
            "businessMeaning": "Filter to select specific dimension line orientations to process, leaving others untouched.",
            "validRange": "Any, Horizontal, Vertical, Aligned, Bottom, Top, Left, Right",
            "unit": "Enumeration",
            "affectsOutput": "Restricts the purge and alignment operations to only dimensions matching the selected orientation (e.g., aligning only horizontal dimensions)."
          },
          {
            "name": "dBaselineOffset",
            "technicalDefault": "U(10)",
            "businessMeaning": "The distance between the model geometry (or origin point) and the first dimension line.",
            "validRange": "5.0 - 100.0 mm (depending on scale)",
            "unit": "mm",
            "affectsOutput": "Determines how far away the row of dimensions starts from the object being dimensioned."
          },
          {
            "name": "dIntermediateOffset",
            "technicalDefault": "U(8)",
            "businessMeaning": "The spacing distance between subsequent stacked dimension lines.",
            "validRange": "5.0 - 50.0 mm (depending on scale and text size)",
            "unit": "mm",
            "affectsOutput": "Determines the gap between parallel dimension lines to ensure text readability."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sAlign is set to No",
            "effect": "Hides the alignment offset properties as they are not needed.",
            "cascade": [
              "dBaselineOffset",
              "dIntermediateOffset"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "DimLine",
            "description": "Existing dimension lines are modified (moved or erased). No new entities are created, but existing ones are repositioned or deleted.",
            "appliedTo": "Dimension lines associated with the selected MultiPage or ShopDrawViews."
          }
        ]
      },
      "tokens_used": 9078,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts by determining execution context based on available entities.",
          "Check if the script is running in Block Space (detecting ShopDrawViews).",
          "IF in Block Space:",
          "  -> Check if _bOnGenerateShopDrawing is true (Shopdrawing generation phase).",
          "  -> IF true: Retrieve configuration from the Map. Check if a TSL instance has already been created for this UID in Model Space. If not, create a new instance in Model Space with the current properties and mark as created to prevent duplicates.",
          "  -> IF false (Interactive Block Space): Display configuration options and preview. Adjust read-only status of alignment offsets based on 'sAlign' property.",
          "  -> Handle 'Add View' trigger if executed: Prompt user to select additional ShopDrawViews, append to _Entity, and re-run.",
          "  -> Handle 'Remove View' trigger if executed: Prompt user to select a ShopDrawView to remove from _Entity, and re-run.",
          "  -> Handle Grip Point Drag ('_Pt0'): Update visual preview of view boundaries and affected dimension lines.",
          "  -> If 'sAlign' is 'Yes': Execute AlignDimlines logic immediately for visualization.",
          "ELSE (Model Space Execution):",
          "  -> Prompt user to select Multipage entities using PrEntity.",
          "  -> Iterate through each selected Multipage entity.",
          "  -> Collect all associated Dimension Lines (DimLine TSLs) linked to the page.",
          "  -> Apply Filter: Remove dimlines not matching the selected views or 'sFilter' orientation.",
          "  -> IF 'sPurge' is 'Yes': Execute PurgeDimlines to remove redundant lines.",
          "  -> IF 'sAlign' is 'Yes': Execute AlignDimlines to reposition lines using offset properties.",
          "  -> Erase the script instance from Model Space (cleanup)."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Context (Block Space vs Model Space)",
            "path1": {
              "name": "Block Space (Configuration Mode)",
              "steps": [
                "Detect ShopDrawViews.",
                "Add Recalc triggers for ShopDraw generation.",
                "Handle _bOnGenerateShopDrawing: Create Model Space instance dynamically.",
                "Handle Display/Interaction: Set property visibility, show preview text.",
                "Execute Context Menu Triggers (Add/Remove views).",
                "Execute AlignDimlines (Preview only) if sAlign is Yes."
              ]
            },
            "path2": {
              "name": "Model Space (Execution Mode)",
              "steps": [
                "Prompt for MultiPage selection.",
                "Collect DimLines associated with pages.",
                "Purge DimLines if sPurge is Yes.",
                "Align DimLines if sAlign is Yes.",
                "Erase script instance."
              ]
            }
          },
          {
            "condition": "sAlign property state",
            "path1": {
              "name": "Alignment Enabled",
              "steps": [
                "Properties dBaselineOffset and dIntermediateOffset are visible and editable.",
                "Script executes AlignDimlines function.",
                "In Block Space, preview updates dynamically."
              ]
            },
            "path2": {
              "name": "Alignment Disabled",
              "steps": [
                "Properties dBaselineOffset and dIntermediateOffset are hidden.",
                "Dimension line positions remain unchanged."
              ]
            }
          },
          {
            "condition": "sFilter property state",
            "path1": {
              "name": "Specific Filter Selected",
              "steps": [
                "FilterDimlineByOrientation is called.",
                "Only dimension lines matching the selected orientation (e.g., Horizontal, Bottom) are processed."
              ]
            },
            "path2": {
              "name": "Any (Default)",
              "steps": [
                "All dimension lines associated with the view/page are processed regardless of orientation."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Selection (Model Space)",
            "errorMessage": "None (implicit). PrEntity loops allow 0 selections, but script does nothing if no pages selected.",
            "recovery": "Select valid MultiPage entities."
          },
          {
            "check": "Filter Logic (FilterDimlineByOrientation)",
            "errorMessage": "None explicit. Invalid vectors default to World Axis checks.",
            "recovery": "Ensure dimension lines have valid 'vecDir' or 'vecSide' attributes."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties",
            "how": "Object Properties Palette (OPM)",
            "effect": "Changing sPurge, sAlign, sFilter, dBaselineOffset, or dIntermediateOffset updates the script behavior. Changing sAlign toggles visibility of offset properties."
          },
          {
            "action": "Add/Remove Views",
            "how": "Right-click Context Menu (Add View / Remove View)",
            "effect": "Updates the _Entity list with ShopDrawViews. Adding prompts for selection; Removing prompts for a specific view to drop."
          },
          {
            "action": "Grip Edit",
            "how": "Drag Grip Point (_Pt0)",
            "effect": "Visually moves the script representation text/icon in Block Space. Used for placement only."
          },
          {
            "action": "Dynamic Preview",
            "how": "Automatic on property change in Block Space",
            "effect": "If sAlign is Yes, dimension lines shown in preview will shift to reflect the new offset values immediately."
          }
        ]
      },
      "tokens_used": 8601,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# MultipageController.mcr\n\n## Overview\nThis script automatically cleans up and organizes dimension lines within MultiPage layouts. It can remove redundant dimensions and realign remaining lines with consistent spacing to ensure drawings are clean and readable.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used to batch process existing Multipage layouts. |\n| Paper Space | No | Script runs in the block definition of Shop Drawings. |\n| Shop Drawing | Yes | Can be embedded in templates for automatic cleanup during generation. |\n\n## Prerequisites\n- **Required Entities**: MultiPage entity (for Model Space execution) or existing ShopDrawViews.\n- **Minimum Beams**: None.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `MultipageController.mcr`\n\n### Step 2: Place Script and Select Layouts\n```\nCommand Line: Insertion point:\nAction: Click anywhere in the drawing to place the script instance temporarily.\n```\n```\nCommand Line: Select Multipage entities:\nAction: Select one or more Multipage layouts from the Model Space and press Enter.\n```\n*Note: After processing, the script instance will automatically delete itself.*\n\n### Step 3: Configure Properties (Optional)\nIf you wish to configure the script for automatic use within a Shop Drawing template:\n1. Insert the script into the desired Shopdrawing block or template.\n2. Select the script instance.\n3. Adjust parameters in the Properties Panel (see below).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sPurge | Dropdown | No | If set to **Yes**, removes overlapping or duplicate dimension lines. |\n| sAlign | Dropdown | No | If set to **Yes**, realigns dimension lines using the offset settings below. **Note:** Offset settings are only visible when this is Yes. |\n| sFilter | Dropdown | Any | Filters which dimension lines are processed based on orientation. Options: Any, Horizontal, Vertical, Aligned, Bottom, Top, Left, Right. |\n| dBaselineOffset | Number | 10 mm | The distance from the model geometry to the first dimension line. |\n| dIntermediateOffset | Number | 8 mm | The spacing between subsequent stacked dimension lines. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add View | Prompts you to select an additional ShopDrawView to include in the calculation. |\n| Remove View | Prompts you to select a ShopDrawView to remove from the calculation. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Selective Alignment**: Use the `sFilter` property to align only specific types of dimensions (e.g., only Horizontal) without affecting others.\n- **Visibility Trick**: You must set `sAlign` to **Yes** in the properties palette to see and edit the `dBaselineOffset` and `dIntermediateOffset` values.\n- **Model Space Cleanup**: When running this in Model Space on existing layouts, the script performs the cleanup once and then automatically removes itself from the drawing to prevent clutter.\n\n## FAQ\n- Q: Why did the script disappear immediately after I selected the Multipage?\n- A: This is normal behavior for Model Space execution. The script performs the cleanup task once and erases itself to keep your drawing clean.\n\n- Q: I cannot see the Baseline Offset or Intermediate Offset properties. Where are they?\n- A: These properties are hidden unless alignment is active. Change the `sAlign` property to **Yes**, and the offset properties will appear.\n\n- Q: Can I use this to fix dimensions in a single view only?\n- A: Yes. Use the **Remove View** right-click option to isolate only the specific ShopDrawView you wish to correct, then update your properties."
      },
      "tokens_used": 5460,
      "error": null
    }
  }
}