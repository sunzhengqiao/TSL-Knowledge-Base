{
  "filename": "GE_WDET_VERTICAL_EDGE.mcr",
  "status": "completed",
  "total_tokens": 42137,
  "processing_time": 664.583643913269,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.2",
            "date": "21.jul.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Description added\nThumbnail added"
          },
          {
            "version": "1.1",
            "date": "08.nov.2011",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Added info from _Map to side beams\nAdded grade and material to blocking from _Map\nModule name changed"
          },
          {
            "version": "1.0",
            "date": "11.oct.2011",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Added info from _Map to blocking"
          },
          {
            "version": "0.2",
            "date": "",
            "author": "",
            "changes": "Release (No author/date found)"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7030,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses `getElement()` to select an Element and operates on physical geometry (Beams, Elements) within the 3D model context. It creates new Beams using `dbCreate()`, modifies element assignments via `assignToElementGroup`, and manipulates 3D vectors/points. There are no `sd_` prefixes, no `_Viewport` interactions, and no `_Entity[]` collections typically found in ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element (specifically ElementWallSF)"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space containing a Wall element with at least two vertical studs (perpendicular to wall Y-axis) to define the cavity for blocking.",
          "requiredSettings": []
        }
      },
      "tokens_used": 3888,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getElement",
              "promptOriginal": "Select an element",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select an insertion point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strEmpty0",
            "type": "PropString",
            "displayName": "- - - - - - - - - - - - - - - -",
            "defaultValue": "PLACEMENT PROPERTIES",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null,
            "readOnly": true
          },
          {
            "index": 0,
            "variable": "dStartOffset",
            "type": "PropDouble",
            "displayName": "  Start Offset",
            "defaultValue": "600 mm (24 in)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dEndOffset",
            "type": "PropDouble",
            "displayName": "  End Offset",
            "defaultValue": "0 mm (0 in)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dSpacing",
            "type": "PropDouble",
            "displayName": "  Spacing",
            "defaultValue": "600 mm (24 in)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dBlockingLength",
            "type": "PropDouble",
            "displayName": "  Blocking Length",
            "defaultValue": "200 mm (8 in)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "strEmpty1",
            "type": "PropString",
            "displayName": "- - - - - - - - - - - - - - - -",
            "defaultValue": "MATERIAL PROPERTIES",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null,
            "readOnly": true
          },
          {
            "index": 2,
            "variable": "strMat",
            "type": "PropString",
            "displayName": "  Material",
            "defaultValue": "SPF",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "strGrade",
            "type": "PropString",
            "displayName": "  Grade",
            "defaultValue": "#2",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7237,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates vertical blocking (firestopping/noggins) between two wall studs or joists at a user-selected edge location, automatically adapting to cavity size.",
          "category": "Framing/Wall Detail",
          "typicalUseCase": "Used to fill vertical cavities at wall ends, rough openings, or junctions with solid timber blocking for structural stability, fire resistance, or drywall backing."
        },
        "parameters": [
          {
            "name": "dStartOffset",
            "technicalDefault": "600 mm (24 in)",
            "businessMeaning": "The vertical distance from the user-selected insertion point to the center of the first blocking piece. If set to 0, the script automatically positions the first block so it sits directly on top of the bottom plate.",
            "validRange": "0 mm to Wall Height",
            "unit": "mm/in",
            "affectsOutput": "Determines the starting height of the blocking sequence along the wall Y-axis."
          },
          {
            "name": "dEndOffset",
            "technicalDefault": "0 mm (0 in)",
            "businessMeaning": "The vertical distance from the top of the wall down to the center of the last blocking piece. A value of 0 places the top of the last block flush with the top plate.",
            "validRange": "0 mm to Wall Height",
            "unit": "mm/in",
            "affectsOutput": "Determines the ending limit of the blocking sequence; sets the distance of the top-most block from the top plate."
          },
          {
            "name": "dSpacing",
            "technicalDefault": "600 mm (24 in)",
            "businessMeaning": "The size of the vertical gap (void) between adjacent blocking pieces. Note: This is the clear space between blocks, not center-to-center spacing.",
            "validRange": "0 mm to 1200 mm",
            "unit": "mm/in",
            "affectsOutput": "Controls how many blocks are generated; larger spacing results in fewer blocks."
          },
          {
            "name": "dBlockingLength",
            "technicalDefault": "200 mm (8 in)",
            "businessMeaning": "The actual vertical height (length in the wall's Y-axis) of each individual blocking piece.",
            "validRange": "50 mm to 1200 mm",
            "unit": "mm/in",
            "affectsOutput": "Determines the physical height of the generated timber blocks."
          },
          {
            "name": "strMat",
            "technicalDefault": "SPF",
            "businessMeaning": "The material code/species assigned to the generated blocking pieces and side studs.",
            "validRange": "Standard Timber Species (e.g., SPF, Hem Fir, LVL)",
            "unit": "Text",
            "affectsOutput": "Sets the material property for cost reporting and the 'Material' field in the BIM entity."
          },
          {
            "name": "strGrade",
            "technicalDefault": "#2",
            "businessMeaning": "The structural grade of the timber assigned to the generated blocking pieces.",
            "validRange": "Standard Grades (e.g., #2, MSR 2400, E1)",
            "unit": "Text",
            "affectsOutput": "Sets the grade property for engineering and the 'Grade' field in the BIM entity."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dSpacing or dBlockingLength changes",
            "effect": "Alters the vertical layout and total count of blocking pieces generated between Start and End offsets.",
            "cascade": []
          },
          {
            "trigger": "Cavity width between studs",
            "effect": "If the gap between side studs is larger than the fixed blocking width (38mm) + stud width, the script automatically inserts an additional new stud to reduce the cavity size.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Beam (Blocking)",
            "description": "Solid timber blocks inserted between the two identified side beams. Width is fixed at 38mm (1.5\") internally, height is defined by 'dBlockingLength'.",
            "appliedTo": "Created inside the cavity between the two closest vertical studs found at the insertion point."
          },
          {
            "type": "Beam (Stud/Joist)",
            "description": "Existing side beams found at the insertion point are modified (Color, Module, Information). If the cavity is too wide, a new stud is generated and added to the element.",
            "appliedTo": "The two vertical studs immediately to the left and right of the insertion point."
          }
        ]
      },
      "tokens_used": 7994,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script (Insert)",
          "2. User selects a Wall Element",
          "3. User selects an insertion point (on the wall face/edge)",
          "4. Script validates Element is a valid ElementWallSF",
          "5. Script imports configuration properties from _Map (if available)",
          "6. Script projects insertion point to valid wall coordinates",
          "7. Script identifies the closest vertical studs to the Left and Right of the insertion point",
          "8. Script removes any existing blocking intersecting the target zone",
          "9. Script validates the cavity width between the identified studs",
          "10. [Conditional] If cavity is too large, script inserts a new stud to reduce gap",
          "11. Script calculates vertical layout based on Start/End Offsets and Spacing",
          "12. [Conditional] If Start Offset is 0, align first block with bottom plate",
          "13. [Conditional] If End Offset is 0 or small, adjust top block position logic",
          "14. Script generates Blocking Beams at calculated positions",
          "15. Script applies Material, Grade, and Module information to new blocks and side studs",
          "16. Script self-deletes (eraseInstance)"
        ],
        "conditionalBranches": [
          {
            "condition": "Cavity Width Analysis (Gap between Left/Right studs)",
            "path1": {
              "name": "Exact Fit",
              "steps": [
                "Gap is approximately equal to Blocking Width (38mm)",
                "Proceeds directly to generating blocking in existing gap"
              ]
            },
            "path2": {
              "name": "Gap Too Small (< 38mm)",
              "steps": [
                "Script detects gap is smaller than blocking width",
                "Report Error: 'Space is too small'",
                "Script aborts and erases instance"
              ]
            },
            "path3": {
              "name": "Gap Too Large/Awkward (Between 38mm and 38mm+StudWidth)",
              "steps": [
                "Script detects gap is larger than block but too small for block+stud",
                "Report Error: 'Space is too large'",
                "Script aborts and erases instance"
              ]
            },
            "path4": {
              "name": "Gap Large Enough (> 38mm + StudWidth)",
              "steps": [
                "Script determines which side is closer to insertion point (Left vs Right)",
                "If Right is farther: Copy Left Stud and move it to the right",
                "If Left is farther: Copy Right Stud and move it to the left",
                "New 'Side Stud' is created to enclose the cavity correctly",
                "Proceeds to generate blocking"
              ]
            }
          },
          {
            "condition": "Start Offset Value",
            "path1": {
              "name": "Zero Offset",
              "steps": [
                "User sets dStartOffset to 0",
                "Script calculates 'dGrow' to place first block center exactly on top of bottom plate",
                "Blocking starts flush with bottom plate"
              ]
            },
            "path2": {
              "name": "Custom Offset",
              "steps": [
                "User sets dStartOffset > 0",
                "Script uses user value as distance from insertion point",
                "Blocking starts at specific custom height"
              ]
            }
          },
          {
            "condition": "End Offset Value (Top constraint)",
            "path1": {
              "name": "Zero Offset",
              "steps": [
                "User sets dEndOffset to 0",
                "Script reduces Max Height by half block length",
                "Top-most block is placed with top edge flush with top plate"
              ]
            },
            "path2": {
              "name": "Small Offset (<= Half Block + 75mm)",
              "steps": [
                "Script reduces Max Height by 1.5x block length",
                "Forces a specific top block position down from the top plate"
              ]
            },
            "path3": {
              "name": "Standard Offset",
              "steps": [
                "User sets specific End Offset",
                "Script reduces Max Height by (Offset + Half Block Length)",
                "Blocking stops specific distance down from top plate"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Validity",
            "errorMessage": "(Implicit) Script erases instance if selected element is not a valid ElementWallSF.",
            "recovery": "Select a valid Wall element containing timber studs."
          },
          {
            "check": "Vertical Studs Detection",
            "errorMessage": "'TSL GE_WDET_VERTICAL_EDGE cannot find a connecting stud on element [Element Number]'",
            "recovery": "Ensure the insertion point is clicked between two existing vertical studs. Do not click outside the wall extents or purely on plates/top plates."
          },
          {
            "check": "Cavity Size (Too Small)",
            "errorMessage": "'Cannot position [Script] on element [Element Number] because the space is too small'",
            "recovery": "Move the insertion point to a wider gap between studs, or manually adjust stud spacing."
          },
          {
            "check": "Cavity Size (Too Large/Awkward)",
            "errorMessage": "'Cannot position [Script] on element [Element Number] because the space is too large'",
            "recovery": "Select a location where studs are spaced closer together, or manually add a stud to split the large gap into two valid cavities."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Generated Geometry",
            "how": "Standard CAD Grips/Commands",
            "effect": "Since the script executes 'eraseInstance()' at the end, the TSL instance no longer exists in the tree. Users must edit the resulting Blocking Beams and Studs manually (move, erase, stretch) if changes are needed."
          },
          {
            "action": "Change Parameters (Offset/Spacing)",
            "how": "Re-insertion required",
            "effect": "To change Spacing or Material, the user must delete the generated blocking and re-run the script with new OPM settings or _Map configurations."
          }
        ]
      },
      "tokens_used": 9527,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_WDET_VERTICAL_EDGE\n\n## Overview\nGenerates vertical blocking (solid timber pieces) between wall studs at a user-selected location. This script automatically adapts to the cavity size to insert structural blocking, firestopping, or drywall backing, and will insert new side studs if the existing gap is too large.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D Wall Elements. |\n| Paper Space | No | Not designed for 2D drawings. |\n| Shop Drawing | No | Does not process views or dimensions. |\n\n## Prerequisites\n- **Required Entities**: A Wall Element (`ElementWallSF`).\n- **Minimum Beam Count**: At least 2 vertical studs must exist in the wall.\n- **Required Settings**: None strictly required, but the script can read defaults from `_Map` if available.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_WDET_VERTICAL_EDGE.mcr` from the list.\n\n### Step 2: Select Element\n```\nCommand Line: Select an element\nAction: Click on the Wall Element where you want to add the blocking.\n```\n\n### Step 3: Define Insertion Point\n```\nCommand Line: Select an insertion point\nAction: Click on the wall face or edge between two vertical studs where you want the blocking sequence to start.\n```\n*Note: The script will automatically locate the studs to the immediate left and right of your click point.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Placement Properties** | | | |\n| Start Offset | Number | 600 mm (24 in) | Vertical distance from the insertion point to the center of the first block. Set to `0` to place the first block flush on the bottom plate. |\n| End Offset | Number | 0 mm (0 in) | Distance from the top of the wall down to the center of the last block. Set to `0` to place the top block flush with the top plate. |\n| Spacing | Number | 600 mm (24 in) | The size of the gap (clear space) between adjacent blocking pieces. This is not center-to-center spacing. |\n| Blocking Length | Number | 200 mm (8 in) | The vertical height (length) of each individual blocking piece. |\n| **Material Properties** | | | |\n| Material | Text | SPF | The material code assigned to the new blocking and side studs. |\n| Grade | Text | #2 | The structural grade assigned to the new blocking and side studs. |\n\n## Right-Click Menu Options\nThis script is a \"generate and forget\" type. Once executed, the script instance deletes itself, leaving only the physical timber. Therefore, there are no right-click menu options to modify the script after insertion. To change parameters, delete the generated beams and re-run the script.\n\n## Settings Files\n- **Filename**: `_Map`\n- **Location**: Company or Install path (Global TSL config)\n- **Purpose**: If present, the script reads default Material, Grade, and Layout settings from this configuration file.\n\n## Tips\n- **Automatic Stud Insertion**: If the gap between the two studs you select is larger than the blocking width (approx. 38mm) plus one stud width, the script will automatically copy the nearest stud and insert it to create a correctly sized cavity.\n- **Start Offset Zero**: For a standard floor-to-floor blocking run starting at the bottom, set **Start Offset** to `0`. The script calculates the position to sit exactly on the bottom plate.\n- **Blocking Width**: The generated blocking has a fixed width of 38mm (1.5 inches).\n- **Self-Deleting**: The script removes itself from the model tree after running. Edit the resulting beams using standard AutoCAD/hsbCAD grips and commands.\n\n## FAQ\n- **Q: Why do I get the error \"Space is too small\"?**\n  - A: The gap between the two studs where you clicked is narrower than the 38mm blocking width. Move your insertion point to a wider gap or adjust the studs manually.\n- **Q: Why do I get the error \"Space is too large\"?**\n  - A: The gap is too wide for a single block but not wide enough to fit a block plus a new stud. Select a location with closer studs, or manually add a stud to split the gap before running the script.\n- **Q: Can I edit the spacing after the blocks are created?**\n  - A: No. Since the script instance self-deletes upon completion, you cannot change the OPM properties later. You must delete the blocks and run the script again with new settings."
      },
      "tokens_used": 6461,
      "error": null
    }
  }
}