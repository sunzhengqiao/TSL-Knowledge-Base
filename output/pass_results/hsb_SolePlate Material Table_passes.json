{
  "filename": "hsb_SolePlate Material Table.mcr",
  "status": "completed",
  "total_tokens": 47251,
  "processing_time": 182.84412741661072,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "14.04.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "00.06.2009",
            "author": "",
            "changes": "Change the option for the header and row Column\n\t\t\t\t\t\tExport teh group to each entry"
          },
          {
            "version": "1.2",
            "date": "10.05.2010",
            "author": "",
            "changes": "Change the Table and some small fixes on export"
          },
          {
            "version": "1.3",
            "date": "22.05.2010",
            "author": "",
            "changes": "Add extra property for the title of the table"
          },
          {
            "version": "1.4",
            "date": "11.02.2011",
            "author": "",
            "changes": "Add group for the new data base"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "hsb_SolePlate TableEntry"
        ]
      },
      "tokens_used": 7824,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses Group().collectEntities(TRUE,TslInst(),_kModelSpace); to manage existing instances. Insertion uses getPoint. No shop drawing API usage (no #Type E, no sd_ prefix, no _Viewport logic)."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Map data 'mpTable' must exist in the instance map (containing row data: sDescription, sWidth, sHeight, nQty, sUnit)",
            "Script 'hsb_SolePlate TableEntry' must be available in the search path"
          ]
        }
      },
      "tokens_used": 7022,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialogOnce",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Pick a Point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Property Palette Dialog",
            "trigger": "During script insertion via showDialogOnce()",
            "title": "Properties",
            "dataSource": "PropString and PropInt declarations",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nLineColor",
            "type": "PropInt",
            "displayName": "Color Header and Lines",
            "defaultValue": 171,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Row Color",
            "defaultValue": 143,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sGrpNm1",
            "type": "PropString",
            "displayName": "House Level group name",
            "defaultValue": "00_GF-Soleplates",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": ""
          },
          {
            "index": 2,
            "variable": "sGrpNm2",
            "type": "PropString",
            "displayName": "Floor Level group name",
            "defaultValue": "GF-Soleplates",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": ""
          },
          {
            "index": 3,
            "variable": "sDispRepOp",
            "type": "PropString",
            "displayName": "Show Table Dim in Disp Rep",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sTableTitle",
            "type": "PropString",
            "displayName": "Table Title",
            "defaultValue": "SOLEPLATE BOM",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7326,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a graphical Bill of Materials (BOM) table for Soleplates in the model, displaying dimensions, quantities, and units based on aggregated data stored in the instance map.",
          "category": "Reporting / Scheduling",
          "typicalUseCase": "Used after model processing to visualize a summary of soleplate requirements (cut lengths or totals) directly in the CAD environment, typically for workshop or site documentation."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "The text style definition (font and size) used for all text within the table (title, headers, and data content).",
            "validRange": "Any existing Dimension Style in the current drawing (e.g., 'Standard', 'Timber-2.5').",
            "unit": "String",
            "affectsOutput": "Alters the font and size of the text. Crucially, this triggers a recalculation of the column widths and total table width to ensure text fits, effectively resizing the table geometry."
          },
          {
            "name": "nLineColor",
            "technicalDefault": 171,
            "businessMeaning": "The AutoCAD color index for the structural elements of the table: the Title, Header text, and the grid lines separating cells.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the visual color of the table borders, title, and column headers. Default 171 is a custom hsbCAD style color."
          },
          {
            "name": "nColor",
            "technicalDefault": 143,
            "businessMeaning": "The AutoCAD color index for the data text within the table rows (the actual quantity and dimension values).",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the visual color of the row content."
          },
          {
            "name": "sGrpNm1",
            "technicalDefault": "00_GF-Soleplates",
            "businessMeaning": "The top-level group path for organizing the table in the CAD system structure (e.g., Project or Phase identifier).",
            "validRange": "String",
            "unit": "String",
            "affectsOutput": "Determines the parent group in the model tree. Used to logically group the drawing entity."
          },
          {
            "name": "sGrpNm2",
            "technicalDefault": "GF-Soleplates",
            "businessMeaning": "The secondary-level group path for organizing the table (e.g., specific Floor or Level identifier).",
            "validRange": "String",
            "unit": "String",
            "affectsOutput": "Determines the sub-group in the model tree. Used to logically group the drawing entity."
          },
          {
            "name": "sDispRepOp",
            "technicalDefault": "",
            "businessMeaning": "Intended to filter the visibility of the table based on specific Display Representations (e.g., Plan, 3D, Elevation). Note: Logic for this parameter is not active in the provided snippet.",
            "validRange": "String",
            "unit": "String",
            "affectsOutput": "None (Currently unused in this script version)."
          },
          {
            "name": "sTableTitle",
            "technicalDefault": "SOLEPLATE BOM",
            "businessMeaning": "The header text displayed at the top of the generated table, identifying the contents.",
            "validRange": "String",
            "unit": "String",
            "affectsOutput": "Updates the text string drawn at the top of the table geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sDimStyle is changed",
            "effect": "Recalculates the text width for all headers and data entries using the new style, which dynamically adjusts the column widths (dColumnWidth1-5) and the total table width.",
            "cascade": [
              "dColumnWidth1",
              "dColumnWidth2",
              "dColumnWidth3",
              "dColumnWidth4",
              "dColumnWidth5"
            ]
          },
          {
            "trigger": "sGrpNm1 or sGrpNm2 is changed",
            "effect": "Regenerates the internal CAD Group assignment for the script instance.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Graphical Table (Lines & Text)",
            "description": "Draws a grid of Polylines (PLine) for borders and Text entities for the Title, Headers, and cell content.",
            "appliedTo": "Model Space at the user-picked insertion point."
          },
          {
            "type": "Sub-Instance (TslInst)",
            "description": "Creates individual instances of 'hsb_SolePlate TableEntry' for each row of data, passing specific row geometry and content to them.",
            "appliedTo": "Nested within the same location as the main table."
          }
        ]
      },
      "tokens_used": 9102,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script is inserted into Model Space via command or catalog.",
          "System checks if _bOnInsert is true.",
          "System checks insertCycleCount(). If > 1, instance is erased and workflow stops.",
          "showDialogOnce() is called, opening the Properties Palette for user configuration.",
          "User picks an insertion point using getPoint().",
          "Script executes full calculation cycle.",
          "Entity Cleanup: Script collects all TslInst entities in ModelSpace matching this script's location.",
          "Entity Cleanup: For each found entity, if it is a 'hsb_SolePlate TableEntry' belonging to this table instance (checked via map handle), it is erased (dbErase).",
          "Data Retrieval: Script attempts to read 'mpTable' from the instance map.",
          "Data Validation: If 'mpTable' does not exist, the instance is erased and workflow stops.",
          "Data Processing: If 'mpTable' exists, script iterates through 'mpRow' entries.",
          "Dynamic Sizing: For each row and header, script calculates required text width based on sDimStyle to determine column widths (dColumnWidth1-5).",
          "Visual Generation: Script draws the Title, Header Row, and Grid Lines using calculated dimensions and color properties.",
          "Row Generation: Script iterates through data rows, drawing cell borders.",
          "Sub-Instance Creation: For each data row, a new instance of 'hsb_SolePlate TableEntry' is created via dbCreate at the specific row location.",
          "Group Assignment: The main table instance is assigned to the CAD Group specified by sGrpNm1 and sGrpNm2."
        ],
        "conditionalBranches": [
          {
            "condition": "Check insert cycle count during insertion",
            "path1": {
              "name": "Subsequent Cycle",
              "steps": [
                "Check if insertCycleCount() > 1",
                "Erase current instance",
                "Return (Stop)"
              ]
            },
            "path2": {
              "name": "First Cycle",
              "steps": [
                "Check if insertCycleCount() <= 1",
                "Continue to showDialogOnce() and getPoint()"
              ]
            }
          },
          {
            "condition": "Presence of Data Map",
            "path1": {
              "name": "Map Missing",
              "steps": [
                "Check if _Map has map 'mpTable'",
                "Evaluate to false",
                "Erase instance",
                "Return (Stop)"
              ]
            },
            "path2": {
              "name": "Map Found",
              "steps": [
                "Check if _Map has map 'mpTable'",
                "Evaluate to true",
                "Extract row data (Description, Width, Height, Qty, Unit)",
                "Calculate table geometry"
              ]
            }
          },
          {
            "condition": "Cleaning up old Sub-Instances",
            "path1": {
              "name": "Orphaned Entry",
              "steps": [
                "Iterate collected TslInst entities",
                "Check if scriptName is 'hsb_SolePlate TableEntry'",
                "Check if instance map handle matches current instance handle",
                "Both true: dbErase() the old entry"
              ]
            },
            "path2": {
              "name": "Unrelated Entity",
              "steps": [
                "Iterate collected TslInst entities",
                "Check if scriptName matches OR handle matches",
                "Both false: Ignore entity"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Availability of 'mpTable' in the Instance Map",
            "errorMessage": "None (Silent Failure). The script instance is erased immediately.",
            "recovery": "User must ensure the source script/logic populating 'mpTable' has run or that the required data is attached to the element before inserting this table."
          },
          {
            "check": "Valid Dimension Style (sDimStyle)",
            "errorMessage": "None (Visual deviation).",
            "recovery": "User updates 'sDimStyle' property in the palette to a valid style name to correct text sizing and layout."
          },
          {
            "check": "Insertion Point",
            "errorMessage": "None",
            "recovery": "User must click a valid point in Model Space when prompted."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Table Appearance",
            "how": "OPM (Object Properties Model) - Properties Palette",
            "effect": "Changing 'sDimStyle', 'nLineColor', 'nColor', or 'sTableTitle' triggers a redraw of the table geometry and updates text/line styles instantly."
          },
          {
            "action": "Move Table",
            "how": "Grip Edit / AutoCAD Move Command",
            "effect": "Moving the main script instance (_Pt0) updates the coordinate system, causing the table graphics and all sub-instances ('hsb_SolePlate TableEntry') to move relative to the new origin."
          },
          {
            "action": "Update Table Data",
            "how": "External Script / Map Update",
            "effect": "Updating the 'mpTable' map data (via external processes) and forcing a recalculation regenerates the rows, columns, and sub-instances to reflect new quantities or dimensions."
          }
        ]
      },
      "tokens_used": 9579,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SolePlate Material Table\n\n## Overview\nGenerates a graphical Bill of Materials (BOM) table for Soleplates in the model. It displays dimensions, quantities, and units based on aggregated data stored in the instance map.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be inserted into Model Space. |\n| Paper Space | No | Not supported for layout insertion. |\n| Shop Drawing | No | This is a model reporting/scheduling tool. |\n\n## Prerequisites\n- **Data Source**: An instance map named `mpTable` must exist in the model data. This map acts as the source for the table content (Description, Width, Height, Qty, Unit).\n- **Script Dependency**: The script `hsb_SolePlate TableEntry` must be present in the hsbCAD search path to handle individual row generation.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or use the hsbCAD catalog browser) â†’ Select `hsb_SolePlate Material Table.mcr`.\n\n### Step 2: Configure Properties\n**Action**: The Properties Palette will appear automatically upon insertion.\n**Details**: Set the Text Style, Colors, or Group Names before placing the element.\n\n### Step 3: Place Table\n```\nCommand Line: Pick a Point\nAction: Click anywhere in the Model Space to define the bottom-left origin of the table.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimstyle | Dropdown | *Current Style* | Selects the text style (font and size) for the entire table. Changing this automatically recalculates column widths to fit the text. |\n| Color Header and Lines | Number | 171 | Sets the AutoCAD color index for the table title, column headers, and grid lines. |\n| Row Color | Number | 143 | Sets the AutoCAD color index for the data text inside the rows. |\n| House Level group name | Text | 00_GF-Soleplates | Defines the top-level group name in the CAD model structure for this element. |\n| Floor Level group name | Text | GF-Soleplates | Defines the second-level group name in the CAD model structure for this element. |\n| Show Table Dim in Disp Rep | Text | *Empty* | Intended for display representation filtering (currently inactive). |\n| Table Title | Text | SOLEPLATE BOM | Sets the header text displayed at the top of the table. |\n\n## Right-Click Menu Options\nNone defined in this script. Standard AutoCAD grips and properties options apply.\n\n## Settings Files\nNo external settings files (XML/TXT) are used by this script. It relies entirely on the Instance Map data (`mpTable`) and Properties Palette inputs.\n\n## Tips\n- **Auto-Sizing**: If the text looks cut off or the columns are too wide, change the **Dimstyle** property. The script will dynamically resize the columns based on the new font metrics.\n- **Updating Data**: If the underlying model data changes, you usually do not need to delete the table. Ensure the `mpTable` is updated by the source process, and the script will refresh the next time the drawing is recalculated or opened.\n- **Colors**: Use distinct colors for Headers vs. Rows to improve readability on the shop floor.\n\n## FAQ\n- **Q: I inserted the script, but it disappeared immediately.**\n  - **A**: The script requires a data map named `mpTable` to function. If this data is not present in the model instance, the script erases itself automatically. Ensure the prerequisite data processing step has been completed before inserting the table.\n\n- **Q: How do I change the table title?**\n  - **A**: Select the table in the drawing, open the Properties Palette (`Ctrl+1`), and edit the **Table Title** field.\n\n- **Q: Can I move the table after inserting it?**\n  - **A**: Yes. Use the standard AutoCAD Move command or drag the grip point associated with the script instance. The graphical table and sub-instances will move together."
      },
      "tokens_used": 6398,
      "error": null
    }
  }
}