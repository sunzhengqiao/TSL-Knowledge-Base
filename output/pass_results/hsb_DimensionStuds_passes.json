{
  "filename": "hsb_DimensionStuds.mcr",
  "status": "completed",
  "total_tokens": 38352,
  "processing_time": 165.293630361557,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "19.01.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "06.04.2010",
            "author": "",
            "changes": "Add Offset for the dimension"
          },
          {
            "version": "1.2",
            "date": "06.04.2010",
            "author": "",
            "changes": "Add Property to have the dimensions as a running dimension."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6525,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": false,
          "detectionEvidence": "Uses _Viewport.append(getViewport()) and Element el = vp.element();, transforms geometry to/from viewport coordinate systems (ms2ps, ps2ms), uses Display dp(-1) with dimensions, and creates geometry based on a selected viewport layout."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Requires an active drawing with a Viewport containing an Element (e.g., a Wall).",
          "requiredSettings": []
        }
      },
      "tokens_used": 4318,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 3,
            "variable": "sMode",
            "type": "PropString",
            "displayName": "Show as",
            "defaultValue": "Line and Text",
            "inputType": "dropdown",
            "options": [
              "Line and Text",
              "Dimension Line"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimLayout",
            "type": "PropString",
            "displayName": "Dim Style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "strShowDimBot",
            "type": "PropString",
            "displayName": "Show Bottom Dimension",
            "defaultValue": "Start",
            "inputType": "dropdown",
            "options": [
              "Start",
              "End",
              "Center",
              "None"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Offset from element",
            "defaultValue": "100",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Offset between the element and the dimension line"
          },
          {
            "index": 2,
            "variable": "sFilterBMC",
            "type": "PropString",
            "displayName": "Include Beam With BeamCode",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Set the code of the extra beams that you want to show int the beam dimension at the bottom of the panel. To add more than 1 use ';' after each code"
          },
          {
            "index": 4,
            "variable": "strType",
            "type": "PropString",
            "displayName": "Dimension Orientation",
            "defaultValue": "Parallel",
            "inputType": "dropdown",
            "options": [
              "Parallel",
              "Perpendicular"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5795,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates 2D shop drawing dimensions for stud spacing and specific beam locations within a selected wall panel element on a layout view.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used during the creation of production drawings to annotate the position of studs, cripples, and blocking relative to the start or end of a wall panel, ensuring accurate framing layout."
        },
        "parameters": [
          {
            "name": "sMode",
            "technicalDefault": "Line and Text",
            "businessMeaning": "Determines the visual style of the dimension annotations. 'Line and Text' places individual text labels with leader lines at each stud location, while 'Dimension Line' creates a standard continuous dimension chain.",
            "validRange": "Line and Text, Dimension Line",
            "unit": "enum",
            "affectsOutput": "Switches between drawing individual text/line primitives and creating a parametric Dimension object."
          },
          {
            "name": "sDimLayout",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific Dimension Style (defined in the CAD standards or drawing template) to control arrowheads, text font, and precision.",
            "validRange": "List of available DimStyles in the drawing",
            "unit": "string",
            "affectsOutput": "Visual appearance of the dimension lines and text (color, size, arrow style)."
          },
          {
            "name": "strShowDimBot",
            "technicalDefault": "Start",
            "businessMeaning": "Defines which part of the stud/beam is used as the reference point for the dimension measurement (e.g., the left face, right face, or centerline).",
            "validRange": "Start, End, Center, None",
            "unit": "enum",
            "affectsOutput": "Shifts the dimension points laterally to align with the selected side or center of the timber component."
          },
          {
            "name": "dOffset",
            "technicalDefault": "100",
            "businessMeaning": "The vertical distance (in the 2D view) from the bottom edge of the wall element to the dimension line.",
            "validRange": "50mm - 500mm",
            "unit": "mm",
            "affectsOutput": "Moves the generated dimension annotations up or down away from the wall geometry to avoid clutter."
          },
          {
            "name": "sFilterBMC",
            "technicalDefault": "",
            "businessMeaning": "A filter list to include specific 'turned' beams (usually blocking or dwangs) that would normally be ignored. You enter the Beam Codes of the elements you want to dimension.",
            "validRange": "String matching Project Beam Codes (e.g., 'BLOCK;STRUT')",
            "unit": "string",
            "affectsOutput": "Adds extra dimension points for beams matching the specified codes that intersect the bottom plate."
          },
          {
            "name": "strType",
            "technicalDefault": "Parallel",
            "businessMeaning": "Controls the orientation of the dimension text relative to the dimension line.",
            "validRange": "Parallel, Perpendicular",
            "unit": "enum",
            "affectsOutput": "Rotates the dimension text to run horizontally with the dimension line or vertically relative to it."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sMode is set to 'Dimension Line'",
            "effect": "The strType (Dimension Orientation) parameter becomes active and relevant. In 'Line and Text' mode, orientation is handled manually by the drawing commands.",
            "cascade": [
              "strType"
            ]
          },
          {
            "trigger": "strShowDimBot is set to 'None'",
            "effect": "The script skips the bottom dimensioning logic entirely, rendering dOffset and sFilterBMC irrelevant for the specific execution.",
            "cascade": [
              "dOffset",
              "sFilterBMC",
              "strType"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Graphical Dimension (Dim)",
            "description": "A continuous chain dimension indicating stud positions if 'Dimension Line' mode is selected.",
            "appliedTo": "PaperSpace Viewport"
          },
          {
            "type": "Text and Line Primitives",
            "description": "Individual text labels (coordinate values) and leader lines if 'Line and Text' mode is selected.",
            "appliedTo": "PaperSpace Viewport"
          }
        ]
      },
      "tokens_used": 7310,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script from AutoCAD/hsbCAD",
          "Check if '_bOnInsert' is true (First run)",
          "[TRUE] Prompt user to 'Select a viewport' via getViewport()",
          "Display Properties Dialog (showDialog)",
          "Store selected Viewport and exit",
          "[FALSE/Recalculation] Retrieve stored Viewport from '_Viewport'",
          "Check if '_Viewport' array is empty",
          "[TRUE] Erase script instance and terminate",
          "[FALSE] Retrieve Element and Coordinate Systems from Viewport",
          "Analyze Element orientation (Check for reversed X axis relative to Viewport)",
          "Collect all Beams within the Element",
          "Sort Beams into Horizontal and Vertical arrays relative to Element CS",
          "Parse 'sFilterBMC' property into array of Beam Codes",
          "Filter 'Turned' Beams (Depth < Width) from Vertical array, retaining only those matching the Beam Code filter",
          "Identify Bottom Plates and Valid Studs/Wall Beams",
          "Generate Convex Hull of Wall vertices to find extreme extents",
          "Determine extreme points: Top, Bottom, Left, Right",
          "Calculate 'ptStartEl' based on extreme Left and Bottom points",
          "Calculate Element Height",
          "Filter Beams intersecting Bottom Plates to find those to dimension",
          "Merge closely spaced studs (remove duplicates based on proximity and width)",
          "Check 'strShowDimBot' property",
          "[!= None] Calculate Dimension Points based on selected reference (Start/End/Center)",
          "Check 'sMode' (Show as) property",
          "[Line and Text] Iterate through points, draw Text values and Leader Lines in PaperSpace",
          "[Dimension Line] Collect points, create continuous DimLine object, apply Orientation and Offset, draw in PaperSpace"
        ],
        "conditionalBranches": [
          {
            "condition": "Number of points to dimension (ptVerBot.length()) and Display Mode (nMode)",
            "path1": {
              "name": "Line and Text Mode",
              "steps": [
                "Loop through each calculated stud point",
                "Transform point from ModelSpace to PaperSpace",
                "Calculate dimension value distance from Start Element",
                "Draw Text at Offset distance",
                "Draw Leader Line from Text to Stud"
              ]
            },
            "path2": {
              "name": "Dimension Line Mode",
              "steps": [
                "Check if more than 1 point exists",
                "Append Start Element point to list",
                "Transform Base Point, apply Offset",
                "Create DimLine entity",
                "Project and Order points onto the dimension line",
                "Draw Dimension object with specified orientation (Parallel/Perpendicular)"
              ]
            }
          },
          {
            "condition": "Element Orientation in Viewport",
            "path1": {
              "name": "Standard Orientation",
              "steps": [
                "Use Element's default Vector X and Vector Z",
                "Proceed with dimension calculation"
              ]
            },
            "path2": {
              "name": "Reversed Orientation",
              "steps": [
                "Detect Element X axis pointing Left in Viewport",
                "Invert Element Vector X (vx = -vx)",
                "Invert Element Vector Z (vz = -vz)",
                "Proceed with dimension calculation using inverted vectors"
              ]
            }
          },
          {
            "condition": "Beam Geometry (Turned Beams)",
            "path1": {
              "name": "Standard Vertical Beams (Height > Width)",
              "steps": [
                "Beam is retained in 'bmVer' array",
                "Included in dimension calculations"
              ]
            },
            "path2": {
              "name": "Turned Beams (Width > Height)",
              "steps": [
                "Beam is flagged as 'turned'",
                "Check if Beam Code matches 'sFilterBMC'",
                "[Match] Retain in array",
                "[No Match] Remove from 'bmVer' array"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "None (Script terminates silently or waits for input)",
            "recovery": "User must select a valid Viewport containing an Element."
          },
          {
            "check": "Viewport/Element Availability on Recalculation",
            "errorMessage": "None (Script deletes itself)",
            "recovery": "Ensure the original Element and Viewport still exist in the drawing."
          },
          {
            "check": "Element Beams Existence",
            "errorMessage": "None (Script exits)",
            "recovery": "Ensure the selected Element is not empty or corrupt."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Dimension Style (Visual appearance)",
            "how": "OPM Property 'Dim Style'",
            "effect": "Updates the AutoCAD dimension style used for the dimension entities."
          },
          {
            "action": "Change Offset (Move dimension line)",
            "how": "OPM Property 'Offset from element'",
            "effect": "Moves the dimension line or text vertically away/towards the wall element."
          },
          {
            "action": "Switch between running dims and individual labels",
            "how": "OPM Property 'Show as' (Line and Text / Dimension Line)",
            "effect": "Regenerates the geometry as either a chain dimension or separate text/line entities."
          },
          {
            "action": "Change Reference Point",
            "how": "OPM Property 'Show Bottom Dimension' (Start/End/Center/None)",
            "effect": "Recalculates dimension points based on the face (left/right) or center of the studs."
          },
          {
            "action": "Include/Exclude Turned Beams",
            "how": "OPM Property 'Include Beam With BeamCode'",
            "effect": "Updates the list of dimensioned beams based on the semicolon-separated codes provided."
          },
          {
            "action": "Rotate Text",
            "how": "OPM Property 'Dimension Orientation' (Parallel/Perpendicular)",
            "effect": "Rotates the text inside the dimension entity (only affects Dimension Line mode)."
          }
        ]
      },
      "tokens_used": 8368,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_DimensionStuds\n\n## Overview\nThis script automatically generates 2D shop drawing dimensions for stud spacing and specific beam locations within a wall panel. It is designed to annotate the position of studs, cripples, and blocking relative to the start or end of a wall panel directly on a Paper Space layout.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is intended for 2D annotations only. |\n| Paper Space | Yes | Script requires a selected Viewport to function. |\n| Shop Drawing | Yes | Specifically designed for production drawings and layouts. |\n\n## Prerequisites\n- **Required Entities**: An Element (e.g., a Wall) must exist in the drawing.\n- **Minimum Beams**: 1 (The script searches for beams within the selected element).\n- **Required Settings**: The drawing must contain a Layout with an active Viewport displaying the element to be dimensioned.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select the `hsb_DimensionStuds.mcr` file from the script directory.\n\n### Step 2: Select a Viewport\n```\nCommand Line: Select a viewport\nAction: Click inside the viewport on the layout that shows the wall/element you wish to dimension.\n```\n*Note: The viewport must contain an Element. If no viewport is selected, the script will terminate.*\n\n### Step 3: Configure Properties\nAction: Once inserted, select the script object in the drawing (or while it is running) and open the **Properties Palette** (Ctrl+1). Adjust the parameters listed below to change the dimension style, offset, and filter options.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Show as | Dropdown | Line and Text | Determines the visual style. Choose **Line and Text** for individual labels with leaders, or **Dimension Line** for a standard continuous dimension chain. |\n| Dim Style | Dropdown | *Current* | Selects the specific Dimension Style (from CAD standards) to control arrowheads, font, and precision. |\n| Show Bottom Dimension | Dropdown | Start | Defines the reference point for dimensions: **Start** (left face), **End** (right face), **Center**, or **None** (disable). |\n| Offset from element | Number | 100 | The distance (mm) from the bottom edge of the wall element to the dimension line. Increase this if dimensions overlap with other details. |\n| Include Beam With BeamCode | Text | *Empty* | Filters specific \"turned\" beams (e.g., blocking/dwang) to include in the dimension. Enter Beam Codes separated by semicolons (e.g., `BLOCK;STRUT`). |\n| Dimension Orientation | Dropdown | Parallel | Controls how dimension text is aligned. **Parallel** runs text horizontally with the line; **Perpendicular** rotates it vertically. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the dimensions if the wall geometry or stud positions have changed. |\n| Erase | Removes the script and the generated dimensions from the drawing. |\n\n## Settings Files\nNo external settings files are required for this script. It relies on standard hsbCAD Element data and AutoCAD Dimension Styles.\n\n## Tips\n- **Dimensioning Blocking**: By default, the script may ignore horizontal blocking (beams laid flat/turned). Use the **Include Beam With BeamCode** property and type the specific codes (e.g., `DWANG`) to force these to be dimensioned.\n- **Avoiding Clutter**: If your drawing has notes or dimensions near the bottom plate, increase the **Offset from element** value to move the stud dimensions further down.\n- **Appearance**: To change arrows or text size, do not change script properties; instead, modify the AutoCAD **Dim Style** selected in the properties and run **Recalculate**.\n\n## FAQ\n- **Q: Why are my studs not showing up in the dimension?**\n  **A:** Ensure the selected viewport actually contains an Element. Also, check if the studs are part of that Element.\n- **Q: Why are my blocking struts missing?**\n  **A:** The script filters out \"turned\" beams (where width > height) unless specified. Add the Beam Code of your blocking to the **Include Beam With BeamCode** property.\n- **Q: The dimension text is upside down.**\n  **A:** Change the **Dimension Orientation** property to \"Parallel\" or \"Perpendicular\", or check your AutoCAD Dim Style text rotation settings."
      },
      "tokens_used": 6036,
      "error": null
    }
  }
}