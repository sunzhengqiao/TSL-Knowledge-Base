{
  "filename": "hsbPolylineBeamcut.mcr",
  "status": "completed",
  "total_tokens": 51743,
  "processing_time": 273.45271492004395,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9433,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses dbCreate() with the _kModelSpace argument. It manipulates 3D geometry (GenBeam, Beam, Sheet) using BeamCut and SolidSubtract operations. There are no sd_ prefixes, Viewport interactions, or #Type E constructs found which are characteristic of Paper Space or ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Dimension Styles (for annotation)",
            "Catalog (optional, for insert presets)"
          ]
        }
      },
      "tokens_used": 6683,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity (GenBeam)",
              "promptOriginal": "|Select genbeam(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity (EntPLine)",
              "promptOriginal": "|Select polyline(s) (<Enter> to pick points)|",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "Pick start point",
              "condition": "_bOnInsert (if no polyline selected in step 2)",
              "required": true
            },
            {
              "step": 4,
              "function": "PrPoint",
              "promptOriginal": "\n|Select next point|",
              "condition": "_bOnInsert (in a loop until finished)",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "Insertion (if no catalog key is provided)",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sAlignment",
            "type": "PropString",
            "displayName": "|Alignment|",
            "defaultValue": "|Reference Side|",
            "inputType": "dropdown",
            "options": [
              "|Reference Side|",
              "|Opposite Side|"
            ],
            "category": "|Geometry|",
            "description": null
          },
          {
            "index": 1,
            "variable": "sSide",
            "type": "PropString",
            "displayName": "|Side|",
            "defaultValue": "|Center|",
            "inputType": "dropdown",
            "options": [
              "|Left|",
              "|Center|",
              "|Right|"
            ],
            "category": "|Geometry|",
            "description": null
          },
          {
            "index": 0,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "|Depth|",
            "defaultValue": "20 mm",
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": null
          },
          {
            "index": 1,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": "30 mm",
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": null
          },
          {
            "index": 2,
            "variable": "sAnnotation",
            "type": "PropString",
            "displayName": "|Content|",
            "defaultValue": "|no Content|",
            "inputType": "dropdown",
            "options": [
              "|no Content|",
              "|Width & Depth|"
            ],
            "category": "|Display|",
            "description": "|Controls wether an annotation should be displayed.|"
          },
          {
            "index": 3,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Current DimStyles"
            ],
            "category": "|Display|",
            "description": null
          },
          {
            "index": 2,
            "variable": "dTxtH",
            "type": "PropDouble",
            "displayName": "|Text Height|",
            "defaultValue": "40 mm",
            "inputType": "number",
            "options": [],
            "category": "|Display|",
            "description": null
          },
          {
            "index": 4,
            "variable": "sReference",
            "type": "PropString",
            "displayName": "|Reference|",
            "defaultValue": "|Convert into Grippoints|",
            "inputType": "dropdown",
            "options": [
              "|Convert into Grippoints|",
              "|Keep Polyline|"
            ],
            "category": null,
            "description": "|The dependency to a polyline can be kept or its vertices to be used as reference.| |Beware that polylines with arced segments will be converted into straight segments|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Add entities|",
            "handler": "|Add entities|",
            "action": "Adds selected GenBeam entities to the list of beams to process.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Remove entities|",
            "handler": "|Remove entities|",
            "action": "Removes selected GenBeam entities from the list of beams to process.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Flip Side|",
            "handler": "|Flip Side|",
            "action": "Toggles the Alignment property and inverts the Side property if it is Left or Right.",
            "alsoTriggeredBy": "Double-click"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9468,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Creates a continuous, polyline-defined slot or recess (beamcut) across one or multiple beams, panels, or sheets.\",\n    \"category\": \"Machining\",\n    \"typicalUseCase\": \"Routing a trench for services, creating a housing for a perpendicular intersecting beam, or milling a decorative channel along a non-linear path across structural members.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sAlignment\",\n      \"technicalDefault\": \"|Reference Side|\",\n      \"businessMeaning\": \"Specifies which face of the element the cut"
      },
      "tokens_used": 10886,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Start (Insertion)",
          "2. Check for Insert Cycle Count; if > 1, erase instance and exit",
          "3. Check for Execute Key (Catalog Preset); if present, load properties, else show OPM Dialog",
          "4. Prompt User to Select GenBeam(s)",
          "5. Validate GenBeam Selection; if < 1 beam selected, erase instance and exit",
          "6. Determine Reference Coordinate System (Beam or Panel)",
          "7. Prompt User to Select Polyline(s) (Optional)",
          "8. [Branch] Check if Polyline was Selected",
          "   -> YES (Polyline Mode): Loop through selected polylines",
          "      - Extract vertices from polyline",
          "      - [Sub-Branch] Check 'Reference' Property",
          "         -> Convert into Grippoints: Erase polyline, store vertices only",
          "         -> Keep Polyline: Store polyline entity as reference",
          "      - Create new TSL Instance for each polyline",
          "   -> NO (Point Mode): Start Point Jig Loop",
          "      - Prompt for Start Point",
          "      - Loop: Prompt for Next Point; draw temporary visual polyline",
          "      - Create new TSL Instance using collected points",
          "9. Erase Initial 'Template' Instance and Exit Insertion",
          "10. [Recalc] Validate Existing GenBeams; if list empty, erase instance",
          "11. [Recalc] Check Execute Key for Context Actions",
          "    - 'Add entities': Select beams and append to list",
          "    - 'Remove entities': Select beams and remove from list",
          "    - 'Flip Side' / Double Click: Toggle Alignment and invert Side property",
          "12. [Recalc] Construct Coordinate System based on first GenBeam (Beam vs Sheet logic)",
          "13. [Recalc] Construct Tool Geometry",
          "    - Map user points/profile to Beam Face coordinate system",
          "    - Calculate offsets and miters based on Alignment and Side",
          "14. [Recalc] Generate Geometry",
          "    - If dependent on polyline and not centered: Use FreeProfile (SolidSubtract)",
          "    - Else: Use segmented BeamCuts with mitre calculations",
          "15. [Recalc] Generate Annotation",
          "    - Check 'Content' property; if 'Width & Depth', generate text and DimRequests"
        ],
        "conditionalBranches": [
          {
            "condition": "User input method during insertion",
            "path1": {
              "name": "Polyline Mode",
              "steps": [
                "Select existing polyline(s)",
                "Check 'Reference' property setting",
                "If 'Convert into Grippoints': Erase original polyline",
                "Create TSL instance linked to vertices or polyline entity"
              ]
            },
            "path2": {
              "name": "Point Mode",
              "steps": [
                "Pick start point",
                "Enter loop picking subsequent points",
                "Visual Jig displays current path",
                "Create TSL instance from picked points"
              ]
            }
          },
          {
            "condition": "Geometry Generation Logic (Recalc)",
            "path1": {
              "name": "Free Profile (Solid Subtraction)",
              "steps": [
                "Dependency on polyline entity exists",
                "Side is not Center",
                "Project tool polyline to reference plane",
                "Create FreeProfile and subtract solid from Beams"
              ]
            },
            "path2": {
              "name": "Segmented BeamCut",
              "steps": [
                "Calculate mitre intersections between segments",
                "Subtract adjacent segments to prevent overlap",
                "Calculate shortened cut length for acute angles",
                "Apply individual BeamCuts to GenBeams"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "GenBeam Count",
            "errorMessage": "None (Silent Exit)",
            "recovery": "Script erases itself if no beams are selected during insertion or if all beams are removed afterwards."
          },
          {
            "check": "Polyline Geometry",
            "errorMessage": "None",
            "recovery": "Script skips polylines with fewer than 2 vertices during insertion."
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None",
            "recovery": "Script self-erases if insertCycleCount > 1 (prevents duplicate instances from running logic)."
          },
          {
            "check": "Mitre Calculation Safety",
            "errorMessage": "None",
            "recovery": "Script performs angle checks (>90 degrees) before applying offset shortening to beamcuts to prevent geometry errors."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Dimensions (Depth/Width)",
            "how": "OPM Properties Palette",
            "effect": "Updates the size of the cut/profile immediately on recalc."
          },
          {
            "action": "Change Alignment/Side",
            "how": "OPM Properties Palette or Context Menu 'Flip Side' or Double-Click",
            "effect": "Toggles the cut between Reference/Opposite sides and flips Left/Right positioning."
          },
          {
            "action": "Edit Cut Path",
            "how": "Grips (if converted to points) or Edit Polyline (if 'Keep Polyline' selected)",
            "effect": "Modifying grip points or the reference polyline updates the path of the cut."
          },
          {
            "action": "Add/Remove Beams",
            "how": "Context Menu 'Add entities' / 'Remove entities'",
            "effect": "Adds or removes target beams from the machining operation."
          },
          {
            "action": "Toggle Annotation",
            "how": "OPM Properties Palette (Content property)",
            "effect": "Shows or hides the Width/Depth text label."
          }
        ]
      },
      "tokens_used": 9452,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbPolylineBeamcut\n\n## Overview\nThis script creates a continuous slot, channel, or housing cut across one or multiple beams or panels based on a defined path. It is ideal for routing service trenches, milling decorative grooves, or creating complex linear connections along structural elements.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script runs exclusively in Model Space to modify 3D geometry. |\n| Paper Space | No | Not intended for 2D drawings or views. |\n| Shop Drawing | No | Not intended for manufacturing views. |\n\n## Prerequisites\n- **Required entities**: GenBeam, GenPanel, or Sheet entities.\n- **Minimum beam count**: At least 1 beam must be selected during insertion.\n- **Required settings**: Dimension Styles (optional, used only if annotation is enabled).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Select `hsbPolylineBeamcut.mcr` from the file dialog.\n\n### Step 2: Select Beams\n```\nCommand Line: Select genbeam(s)\nAction: Click on the beam(s) or panel(s) you wish to cut. Press Enter to confirm selection.\n```\n*Note: The script will exit if no beams are selected.*\n\n### Step 3: Define Cut Path\n```\nCommand Line: Select polyline(s) (<Enter> to pick points)\nAction: \n- Option A (Polyline): Select one or more existing polylines in the model to define the cut shape.\n- Option B (Points): Press Enter to draw the path manually.\n```\n\n### Step 4: Define Points (If Option B selected)\n```\nCommand Line: Pick start point\nAction: Click the location where the cut should begin.\n```\n```\nCommand Line: Select next point\nAction: Click subsequent points to define the path. A preview line will appear. Press Enter to finish the path.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Alignment** | dropdown | Reference Side | Sets which face of the beam is used as the reference (Reference Side vs Opposite Side). |\n| **Side** | dropdown | Center | Positions the cut relative to the beam centerline (Left, Center, or Right). |\n| **Depth** | number | 20 mm | The depth of the cut into the material. |\n| **Width** | number | 30 mm | The width of the cut slot. |\n| **Content** | dropdown | no Content | Controls whether dimensions (Width & Depth) are annotated on the beam. |\n| **Dimstyle** | dropdown | Current | Selects the dimension style to use for annotations. |\n| **Text Height** | number | 40 mm | Sets the height of the annotation text. |\n| **Reference** | dropdown | Convert into Grippoints | Determines if the original polyline is kept or converted to draggable grip points. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Add entities** | Allows you to select additional beams or panels to include in the existing cut operation. |\n| **Remove entities** | Allows you to select specific beams or panels to remove from the cut operation. |\n| **Flip Side** | Toggles the Alignment property and inverts the Left/Right positioning. This can also be triggered by double-clicking the script instance. |\n\n## Settings Files\nNone specified. This script operates using standard OPM properties and does not require external XML setting files.\n\n## Tips\n- **Editing the Path**: If you set \"Reference\" to **Convert into Grippoints**, you can drag the blue grips in the model to adjust the cut shape. If set to **Keep Polyline**, simply use standard AutoCAD PEDIT commands on the polyline to update the cut.\n- **Arcs**: If you select a polyline with curved (arc) segments, the script will automatically convert them into straight segments (chords).\n- **Double-Click**: You can quickly flip the cut to the opposite side of the beam by double-clicking the script instance in the model.\n- **Multiple Beams**: You can select multiple non-parallel beams during insertion; the script will project the cut path onto all selected elements.\n\n## FAQ\n- **Q: What happens if I delete the beams associated with this script?**\n- **A:** The script detects that there are no beams to process and will automatically erase itself to prevent errors.\n- **Q: Can I change the size of the cut after inserting it?**\n- **A:** Yes, select the script instance and change the \"Width\" or \"Depth\" values in the Properties Palette. The 3D model will update immediately.\n- **Q: Why did my arc disappear?**\n- **A:** The script approximates arcs using straight lines. Ensure your polyline segment length is short enough if you need a smooth curve."
      },
      "tokens_used": 5821,
      "error": null
    }
  }
}