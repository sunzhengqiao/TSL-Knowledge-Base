{
  "filename": "hsbCullenSt.mcr",
  "status": "completed",
  "total_tokens": 48050,
  "processing_time": 289.127370595932,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9479,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _kModelSpace to collect TslInst entities. Creates Body objects and HardWrComp (hardware) directly in the model. Contains no #Type E entries, _Viewport logic, or sd_ prefixed functions indicative of Shop Drawing scripts. Insert instructions describe selecting beams in the model."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": [
            "hsbSimpsonFB.xml"
          ]
        }
      },
      "tokens_used": 6853,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 7080,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates Cullen flat straps or bended straps (ST-PFS) for wind bracing or hold-down applications on wall studs, including automated hardware export for BOM.",
          "category": "Hardware",
          "typicalUseCase": "A detailer selects a vertical stud in a wall to apply a specific flat or bended strap, adjusting offsets for sheathing and overhangs for structural requirements."
        },
        "parameters": [
          {
            "name": "sProductCode",
            "technicalDefault": "\"ST-ST-PFS-800\"",
            "businessMeaning": "Selects the specific strap profile and length from the Cullen catalog (e.g., flat straps 800-2000mm, or bended straps 50-100mm).",
            "validRange": "ST-ST-PFS-800, ST-ST-PFS-1000, ST-ST-PFS-1200, ST-ST-PFS-1300, ST-ST-PFS-2000, ST-PFS-50, ST-PFS-75, ST-PFS-100, ST-PFS-50-M, ST-PFS-75-M, ST-PFS-100-M",
            "unit": "String",
            "affectsOutput": "Switches between flat and bended geometry, sets the strap length, and determines the nail quantity (4 or 6) exported to the BOM."
          },
          {
            "name": "dOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "The standoff distance from the face of the stud to the strap.",
            "validRange": "0mm to typical cladding depth (e.g., 50mm)",
            "unit": "mm",
            "affectsOutput": "Moves the strap body perpendicular to the wall face, allowing the strap to sit behind sheathing materials."
          },
          {
            "name": "dOverhang",
            "technicalDefault": "U(225)",
            "businessMeaning": "The length of the strap extending past the end of the stud (top or bottom).",
            "validRange": "0mm to maximum structural length (e.g., 300mm)",
            "unit": "mm",
            "affectsOutput": "Extends the vertical length of the strap geometry relative to the stud's end point."
          },
          {
            "name": "dSide",
            "technicalDefault": "U(0)",
            "businessMeaning": "Lateral shift of the strap along the face of the stud (left/right).",
            "validRange": "Dependent on stud width (e.g., +/- 100mm)",
            "unit": "mm",
            "affectsOutput": "Slides the strap horizontally along the stud's surface axis."
          },
          {
            "name": "sText",
            "technicalDefault": "\"\"",
            "businessMeaning": "Custom text label to be displayed on the strap in the model.",
            "validRange": "Any alphanumeric string",
            "unit": "String",
            "affectsOutput": "Replaces the default Product Code text displayed on the 3D body."
          },
          {
            "name": "dTextHeight",
            "technicalDefault": "0",
            "businessMeaning": "Height of the text label displayed on the strap.",
            "validRange": "0 (Disabled/Default) to legible size (e.g., 10-100mm)",
            "unit": "mm",
            "affectsOutput": "Controls the visual size of the text label in the model."
          },
          {
            "name": "sZone",
            "technicalDefault": "Dynamically from Element",
            "businessMeaning": "The specific wall layer (zone) the strap is assigned to.",
            "validRange": "Valid zones of the parent element (e.g., -5 to +5)",
            "unit": "Index",
            "affectsOutput": "Filters which studs within an element are valid targets based on the selected zone."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sProductCode",
            "effect": "Selecting a bended strap (ST-PFS-M) triggers geometry changes and reduces nail count in hardware export.",
            "cascade": [
              "Strap Geometry (Flat vs Bent)",
              "Hardware Quantity (Nails)"
            ]
          },
          {
            "trigger": "Element Selection",
            "effect": "Populates the list of valid sZone values based on the element's composition.",
            "cascade": [
              "sZone Options"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body",
            "description": "The 3D geometric representation of the metal strap (Flat or Bended).",
            "appliedTo": "Selected GenBeam (Stud)"
          },
          {
            "type": "HardWrComp",
            "description": "The strap component for BOM (Manufacturer: Cullen, Material: Austenitic Stainless Steel).",
            "appliedTo": "Selected GenBeam"
          },
          {
            "type": "HardWrComp",
            "description": "Nail fasteners for BOM (Qty 4 or 6, Size 3.35x50mm, Material: Stainless Steel).",
            "appliedTo": "Selected GenBeam"
          },
          {
            "type": "Display Text",
            "description": "Annotation displaying the Product Code or custom sText string.",
            "appliedTo": "Strap Body"
          }
        ]
      },
      "tokens_used": 8007,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization and Settings Check",
          "2. Attempt to load 'hsbSimpsonFB.xml' settings from Company or Install path",
          "3. User Prompt: Select Element or GenBeam",
          "4. Entity Resolution:",
          "   - If Element selected: Collect all GenBeams associated with the Element.",
          "   - If GenBeam selected: Target the specific GenBeam.",
          "5. Filter Candidates: Iterate through collected beams.",
          "   - Check if beam is vertical (Z-axis alignment).",
          "   - Check if beam belongs to the selected 'sZone'.",
          "6. Insert TSL Instance onto valid beam(s).",
          "7. Geometric Calculation:",
          "   - Determine coordinate system based on beam orientation.",
          "   - Apply Offset (dOffset) perpendicular to the wall face.",
          "   - Apply Side shift (dSide) along the face.",
          "   - Apply Overhang (dOverhang) beyond the beam end.",
          "8. Geometry Generation (Conditional on Product Code):",
          "   - Generate Flat Strap body (Rectangular) OR",
          "   - Generate Bended Strap body (Vertical + Angled + Horizontal segments).",
          "9. Hardware Generation:",
          "   - Create HardWrComp for Strap (ST-PFS or ST-PFS-M).",
          "   - Create HardWrComp for Nails (4 or 6 qty depending on product type).",
          "10. Annotation: Draw text label (sText or Product Code) at calculated position.",
          "11. Finalize: Attach instance to beam and complete execution."
        ],
        "conditionalBranches": [
          {
            "condition": "Product Code Selection (sProductCode)",
            "path1": {
              "name": "Flat Straps (Indices 0-4)",
              "steps": [
                "Select standard rectangular body generation logic.",
                "Use standard dimensions (Width 35mm, specific Length).",
                "Set Nail Quantity to 6."
              ]
            },
            "path2": {
              "name": "Bended Straps (Indices 5-10)",
              "steps": [
                "Select complex body generation logic.",
                "Construct Part 1: Vertical leg.",
                "Construct Part 2: Angled connection (calculated via dX1, dY2).",
                "Construct Part 3: Horizontal flange (dX2 width).",
                "Set Nail Quantity to 4 for 'M' series (Indices 8-10).",
                "Set Nail Quantity to 6 for non-'M' series (Indices 5-7)."
              ]
            }
          },
          {
            "condition": "Text Content (sText)",
            "path1": {
              "name": "Default Text",
              "steps": [
                "Check if sText property is empty.",
                "Draw string 'AS-' + sProductCode.",
                "Offset text slightly from body surface."
              ]
            },
            "path2": {
              "name": "Custom Text",
              "steps": [
                "Check if sText property contains characters.",
                "Draw the content of sText.",
                "Place text directly on calculated position."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Verticality",
            "errorMessage": "Implicit: TSL simply skips non-vertical beams without explicit error, but logic requires dot(vecY, ZW) > threshold.",
            "recovery": "Select a vertical stud within the wall."
          },
          {
            "check": "Zone Validity",
            "errorMessage": "Zone does not exist on selected Element (sZone).",
            "recovery": "Select a valid Zone index from the property list provided by the Element's composition."
          },
          {
            "check": "Parent Entity Type",
            "errorMessage": "Selected entity is not a GenBeam or Element.",
            "recovery": "Select a valid Timber Beam or Wall Element."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions",
            "how": "OPM (Properties Palette)",
            "effect": "Updates dOffset, dOverhang, and dSide. Strap geometry immediately regenerates in new position."
          },
          {
            "action": "Change Product Code",
            "how": "OPM (Properties Palette) - Dropdown list",
            "effect": "Switches between Flat and Bended geometry. Updates Hardware BOM (Nail quantity and Strap Model)."
          },
          {
            "action": "Update Annotation",
            "how": "OPM (Properties Palette)",
            "effect": "Updates the displayed text string or text height (dTextHeight) on the strap body."
          },
          {
            "action": "Change Assignment",
            "how": "Context Menu (Right-click) or Move",
            "effect": "Moving the host beam moves the strap. Changing the script reference updates group assignment logic."
          }
        ]
      },
      "tokens_used": 10804,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCullenSt.mcr\n\n## Overview\nThis script generates Cullen flat straps or bended straps (ST-PFS) for wind bracing or hold-down applications on wall studs. It automates the creation of 3D geometry and exports hardware data (Straps and Nails) to the Bill of Materials (BOM).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model to create bodies and assign hardware. |\n| Paper Space | No | Not designed for detailing views. |\n| Shop Drawing | No | Does not generate 2D drawings. |\n\n## Prerequisites\n- **Required entities**: An `Element` (Wall) or a `GenBeam` (Stud).\n- **Minimum beam count**: 1 (script filters for vertical studs within the selection).\n- **Required settings**: `hsbSimpsonFB.xml` (Must be present in the Company or Install folder to load product data).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `hsbCullenSt.mcr`.\n\n### Step 2: Select Wall or Stud\n```\nCommand Line: Select Element or GenBeam:\nAction: Click on a wall element or a specific stud beam in the model.\n```\n### Step 3: Automatic Application\nThe script will automatically identify vertical studs within the selected Element (or the specific beam if selected) that match the current Zone (`sZone`) settings. It will then insert the strap onto the valid stud(s).\n\n### Step 4: Adjust Properties (Optional)\nSelect the inserted strap instance and open the **Properties Palette** (OPM) to adjust dimensions, offsets, or change the product code as required.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sProductCode | Dropdown | ST-ST-PFS-800 | Selects the specific strap profile (Flat vs. Bended) and length. Changing this updates geometry and nail count (e.g., 4 or 6 nails). |\n| dOffset | Number | 0 mm | Sets the standoff distance from the face of the stud. Use this to position the strap behind sheathing materials. |\n| dOverhang | Number | 225 mm | Defines how far the strap extends past the end of the stud (top or bottom). |\n| dSide | Number | 0 mm | Shifts the strap laterally (left/right) along the face of the stud. |\n| sText | String | (Empty) | Custom text label to display on the strap body. If left empty, the Product Code is displayed. |\n| dTextHeight | Number | 0 | Height of the text label on the strap. Set to > 0 to enable text; 0 uses default sizing. |\n| sZone | Index | Dynamic | Sets the specific wall layer (zone) the strap is assigned to. Only beams in this zone will receive the strap. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Properties... | Opens the Properties Palette to edit parameters listed above. |\n| Erase | Removes the strap instance and hardware assignments from the model. |\n| Move | Allows moving the strap to a different location/host (requires re-selection of beam). |\n\n## Settings Files\n- **Filename**: `hsbSimpsonFB.xml`\n- **Location**: Company or Install path\n- **Purpose**: Provides the catalog definitions for the Cullen straps, including dimensions, geometry types (flat/bended), and nail patterns.\n\n## Tips\n- **Sheathing Clearance**: If you have sheathing on the wall, increase the `dOffset` property so the strap sits flush against the stud face behind the sheathing.\n- **Switching Types**: You can toggle between a \"Flat Strap\" and a \"Bended Strap\" simply by changing the `sProductCode` dropdown. The geometry will update immediately.\n- **Text Visibility**: If the text label is too large or small, adjust `dTextHeight`. If you want the default product code to show, ensure `sText` is cleared.\n\n## FAQ\n- **Q: Why didn't the strap appear on my selected beam?**\n  - A: The script only applies to vertical studs. Ensure the beam is upright (Z-axis) and that it belongs to the `sZone` specified in the properties.\n- **Q: How do I change the number of nails in the BOM?**\n  - A: The nail quantity is determined by the `sProductCode`. Select a different product code (e.g., ST-PFS-50 vs ST-PFS-50-M) to change the nail count (4 vs 6).\n- **Q: Can I apply this to multiple studs at once?**\n  - A: Yes, if you select a Wall **Element**, the script will iterate through all valid vertical studs in the specified Zone and apply the strap to all of them."
      },
      "tokens_used": 5827,
      "error": null
    }
  }
}