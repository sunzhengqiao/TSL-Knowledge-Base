{
  "filename": "hsbHousing.mcr",
  "status": "completed",
  "total_tokens": 29979,
  "processing_time": 607.9045073986053,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": null,\n  \"versionHistory\": [\n    {\n      \"version\": \"1.1\",\n      \"date\": \"03.02.2011\",\n      \"author\": \"th@hsbCAD.de\",\n      \"changes\": \"minor translation bugfix\"\n    },\n    {\n      \"version\": \"1.0\",\n      \"date\": \""
      },
      "tokens_used": 5649,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses `getBeam()` to select entities and `Beam.addTool()` to modify geometry in 3D. It utilizes geometric classes like `House`, `Body`, and `PlaneProfile`. There are no references to ShopDrawing APIs (`sd_*`), `_Viewport`, or `#Type E` entity arrays."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3097,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getBeam",
              "promptOriginal": "|Select male beam|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getBeam",
              "promptOriginal": "|Select female beam|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sRound",
            "type": "PropString",
            "displayName": "Rounding Type",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|not rounded|",
              "|round|",
              "|relief|",
              "|rounded with small diameter|",
              "|relief with small diameter|",
              "|rounded|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "|Color|",
            "defaultValue": 254,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sLayerGroup",
            "type": "PropString",
            "displayName": "|Group, Layername or Zone Character|",
            "defaultValue": "T",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5682,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically creates a housing (mortise/pocket) at a T-connection between two timber beams, specifically machining the female beam to accept the male beam.",
          "category": "Joinery/Machining",
          "typicalUseCase": "Used when a perpendicular beam connection requires a pocket to be cut into the main beam to accommodate the intersecting beam."
        },
        "parameters": [
          {
            "name": "sRound",
            "technicalDefault": "T(\"|not rounded|\")",
            "businessMeaning": "Specifies the edge treatment of the internal corners of the housing (e.g., sharp corners, large radius rounding, or relief notches) to reduce stress concentrations or accommodate CNC tooling limitations.",
            "validRange": "not rounded, round, relief, rounded with small diameter, relief with small diameter, rounded",
            "unit": "Enumeration",
            "affectsOutput": "Modifies the 3D geometry of the pocket created on the female beam, adding fillets or chamfers to the vertical edges of the housing."
          },
          {
            "name": "nColor",
            "technicalDefault": "254",
            "businessMeaning": "Sets the display color for the preview visualization of the housing volume within the CAD model.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the color of the temporary graphical representation of the cut during script execution; does not affect physical production data."
          },
          {
            "name": "sLayerGroup",
            "technicalDefault": "\"T\"",
            "businessMeaning": "Assigns the script instance or the resulting tooling to a specific CAD Layer or hsbCAD Group (e.g., 'T' for walls, 'I' for interior), controlling how the element is organized in the project model.",
            "validRange": "Valid Layer Name string or Group Character ('T', 'I', 'J', 'Z', 'C')",
            "unit": "String",
            "affectsOutput": "Moves the script instance to the specified layer or group, which can influence visibility, filtering, and export mappings."
          },
          {
            "name": "_Beam[0] (Male)",
            "technicalDefault": "null (User Selection)",
            "businessMeaning": "The intersecting beam that serves as the template for the housing dimensions. This beam defines the width and depth of the pocket required.",
            "validRange": "Any valid GenBeam in Model Space",
            "unit": "Entity",
            "affectsOutput": "Determines the cross-sectional size of the housing cut into the female beam."
          },
          {
            "name": "_Beam[1] (Female)",
            "technicalDefault": "null (User Selection)",
            "businessMeaning": "The main receiving beam. This beam is physically modified (cut) to create the housing connection.",
            "validRange": "Any valid GenBeam in Model Space",
            "unit": "Entity",
            "affectsOutput": "The entity that receives the 'House' machining operation."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "House (Machining)",
            "description": "A parametric pocket volume calculated to fit the profile of the male beam into the female beam.",
            "appliedTo": "Beam[1] (Female beam)"
          },
          {
            "type": "Graphical Body (Debug)",
            "description": "A temporary 3D body visualizing the exact location and size of the housing cut.",
            "appliedTo": "Model Space"
          }
        ]
      },
      "tokens_used": 4037,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script execution started (Insertion)",
          "2. Property Dialog displayed (User selects Rounding Type, Color, Layer/Group)",
          "3. Command Line Prompt: Select Male beam (The intersecting beam)",
          "4. Command Line Prompt: Select Female beam (The receiving beam)",
          "5. Initialization of coordinate system vectors (vx, vy, vz) based on beam geometry",
          "6. Calculation of shadow profiles to determine intersection area",
          "7. Extraction of intersection segment and dimension calculation (dX, dY, dZ)",
          "8. Conditional Check: Are dimensions valid (dX>0, dY>0, dZ>0)?",
          "9. Execution of Tooling or Error Visualization",
          "10. Execution of Layer/Group assignment logic"
        ],
        "conditionalBranches": [
          {
            "condition": "Geometric Overlap Validation (dX>0 && dY>0 && dZ>0)",
            "path1": {
              "name": "Create Housing",
              "steps": [
                "Calculate House origin (ptHs)",
                "Instantiate House entity with dimensions and rounding type",
                "Apply tool (cut) to Female beam (bm1)",
                "Generate debug body and draw in preview color"
              ]
            },
            "path2": {
              "name": "Visualize Failure",
              "steps": [
                "Set visualization color to Red (1)",
                "Draw the calculated intersection line segment (ls)",
                "Skip tool creation (beams remain unmodified)"
              ]
            }
          },
          {
            "condition": "Layer/Group Assignment (sLayerGroup value)",
            "path1": {
              "name": "Existing Group Match",
              "steps": [
                "Iterate through all existing groups",
                "If name matches sLayerGroup, add script instance to that group"
              ]
            },
            "path2": {
              "name": "No Group Match (Zone or New Layer)",
              "steps": [
                "Check if sLayerGroup is a valid Zone Character ('T','I','J','Z','C')",
                "If Zone Char: Inherit layer and zone from the Female beam",
                "If not Zone Char: Treat sLayerGroup as a Layer Name and assign script instance to that new/existing layer"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Valid geometric intersection between Male and Female beams",
            "errorMessage": "None (Silent failure)",
            "recovery": "User sees a Red line indicating the intersection line. User must adjust beam positions or the script insertion point (_Pt0) to create a valid overlap."
          },
          {
            "check": "Beam selection",
            "errorMessage": "Handled by hsbCAD getBeam() standard prompts",
            "recovery": "User must select valid GenBeams to proceed."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Connection Geometry",
            "how": "Move or Rotate the connected beams",
            "effect": "Script recalculates intersection and updates the housing size/position automatically."
          },
          {
            "action": "Adjust Parameters",
            "how": "Select script instance and open AutoCAD Properties Palette (OPM)",
            "effect": "Updating 'Rounding Type' changes the corners of the pocket (sharp, round, relief). Updating 'Color' changes the debug preview color."
          },
          {
            "action": "Move Script",
            "how": "Standard AutoCAD Move command on the script instance",
            "effect": "Moves the reference point (_Pt0), which alters the vector calculation for the housing depth orientation."
          }
        ]
      },
      "tokens_used": 6476,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbHousing\n\n## Overview\nThis script automatically generates a housing (pocket/mortise) connection between two timber beams. It cuts a pocket into the \"female\" beam to accommodate the profile of the intersecting \"male\" beam based on their 3D geometry.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model to modify beam geometry. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | This script modifies the model, not the drawing views directly. |\n\n## Prerequisites\n- **Required Entities**: Two `GenBeam` entities.\n- **Minimum Beam Count**: 2 (One intersecting/male beam and one receiving/female beam).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbHousing.mcr` from the file list.\n\n### Step 2: Select Male Beam\n```\nCommand Line: Select male beam\nAction: Click on the beam that will be inserted into the pocket (the intersecting beam).\n```\n\n### Step 3: Select Female Beam\n```\nCommand Line: Select female beam\nAction: Click on the beam that needs to be cut to receive the male beam.\n```\n\n### Step 4: Configure Properties\nAfter selection, the script will attempt to calculate the connection. You can modify the connection properties via the **Properties Palette** (Ctrl+1) if the script is selected.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Rounding Type | dropdown | not rounded | Determines how the internal vertical corners of the housing are treated. Options include: `not rounded`, `round`, `relief`, `rounded with small diameter`, `relief with small diameter`, `rounded`. |\n| Color | number | 254 | Sets the color of the debug/preview body visualizing the housing volume (AutoCAD Color Index). |\n| Group, Layername or Zone Character | text | T | Assigns the script to a specific Layer or Group (e.g., 'T' for walls, 'I' for interior). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are added by this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Debugging**: If the housing is not created, look for a **Red line**. This indicates the beams do not have a valid geometric overlap (intersection) based on the current calculation logic. Adjust the beam positions or the script insertion point to ensure they overlap in 3D space.\n- **Corner Treatment**: Use the \"Rounding Type\" property to add radii or reliefs to the pocket corners. This is often required for stress relief in timber or to accommodate CNC milling tool diameters.\n- **Dynamic Updates**: If you move the connected beams using the AutoCAD `Move` or `Rotate` commands, the housing will automatically recalculate and update to fit the new geometry.\n\n## FAQ\n- **Q: Why is my beam not being cut?**\n  A: The script likely detected an invalid intersection. Check if a red line appears near the connection. Ensure the male beam physically passes through the female beam in the 3D model.\n- **Q: How do I change the size of the pocket?**\n  A: The pocket size is driven by the cross-section of the \"Male\" beam. To change the pocket size, change the size of the male beam in the Element or Catalog properties.\n- **Q: What does the \"Group, Layername or Zone Character\" property do?**\n  A: It organizes the script instance. If you enter \"T\", the script might inherit properties from the Wall group. If you enter a specific Layer Name, the script instance moves to that layer."
      },
      "tokens_used": 5038,
      "error": null
    }
  }
}