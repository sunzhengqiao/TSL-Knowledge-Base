{
  "filename": "HSB_L-Notch.mcr",
  "status": "completed",
  "total_tokens": 47781,
  "processing_time": 388.95835518836975,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 2,
          "minorVersion": 3,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "This tsl adds the required tooling for fitting a beam in a log wall.",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "30.06.2005",
            "author": "KR",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "05.07.2005",
            "author": "KR",
            "changes": "Added cutback of dovetail"
          },
          {
            "version": "1.02",
            "date": "10.07.2009",
            "author": "AS",
            "changes": "split and beamcut applied as static tools"
          },
          {
            "version": "1.03",
            "date": "13.07.2009",
            "author": "AS",
            "changes": "splitmargin added"
          },
          {
            "version": "1.04",
            "date": "13.07.2009",
            "author": "AS",
            "changes": "add tools static"
          },
          {
            "version": "1.05",
            "date": "14.07.2009",
            "author": "AS",
            "changes": "showDialog"
          },
          {
            "version": "1.06",
            "date": "15.07.2009",
            "author": "AS",
            "changes": "tools are non-static again; tsl remains active in the drawing; Apply cut when split has been performed in a previous execution"
          },
          {
            "version": "1.07",
            "date": "17.08.2009",
            "author": "AS",
            "changes": "Inserted by \"JBL-Balklaag Plaatsen\", use envelopeBody(TRUE, TRUE) instead of realBody"
          },
          {
            "version": "1.08",
            "date": "28.08.2009",
            "author": "AS",
            "changes": "Allow multiple splitheights"
          },
          {
            "version": "1.09",
            "date": "01.09.2009",
            "author": "AS",
            "changes": "Subtract cut-out at top and bottom while checking for intersection"
          },
          {
            "version": "1.10",
            "date": "17.10.2010",
            "author": "AS",
            "changes": "Rewrite tsl. This tsl is now the master and the slave."
          },
          {
            "version": "1.11",
            "date": "26.03.2012",
            "author": "AS",
            "changes": "Generalize this tsl."
          },
          {
            "version": "1.12",
            "date": "28.03.2012",
            "author": "AS",
            "changes": "Solve issue when the side mill is changed for splitted beams"
          },
          {
            "version": "1.13",
            "date": "04.04.2012",
            "author": "AS",
            "changes": "Add gap"
          },
          {
            "version": "1.14",
            "date": "10.04.2012",
            "author": "AS",
            "changes": "Dont delete tsl when element is regenerated"
          },
          {
            "version": "1.15",
            "date": "13.04.2012",
            "author": "AS",
            "changes": "Clear _Map when recalc is done"
          },
          {
            "version": "2.00",
            "date": "23.10.2012",
            "author": "AS",
            "changes": "Combine different solutions into this tsl."
          },
          {
            "version": "2.01",
            "date": "24.10.2012",
            "author": "AS",
            "changes": "Assign to element."
          },
          {
            "version": "2.02",
            "date": "06.03.2017",
            "author": "AS",
            "changes": "Add offset properties for bottom beamcut."
          },
          {
            "version": "2.03",
            "date": "12.06.2017",
            "author": "YB",
            "changes": "Add front and back properties for beamcut."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6513,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No 'sd_' or 'Multipage' prefix detected. No '#Type E' with '_Entity[]' usage found. Script uses _kModelSpace explicitly in TslInst.dbCreate call. Functionality involves adding tooling (BeamCut) and splitting beams, which are Model Space (3D) operations. The script uses ElementLog and Beam objects representing physical timber components."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Beam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "The script requires an Element (specifically an ElementLog derived object) and at least one Beam to operate on. It needs to be inserted into Model Space.",
          "requiredSettings": []
        }
      },
      "tokens_used": 4878,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 9215,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automates the connection between a structural beam and a log wall by notching the beam and cutting a matching hole in the wall, including splitting wall logs if the remaining material is too narrow.\",\n    \"category\": \"Joinery/LogBuilding\",\n    \"typicalUseCase\": \"Used when fitting joists, purlins, or rafters into a solid log wall where a precise L-notch or housing joint is required.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"dDepthLeft\",\n      \"technicalDefault\": \"U(7)\",\n      \"businessMeaning\": \"The depth of the horizontal shoulder cut on the left side of the beam (relative to the beam's local Y-axis).\",\n      \"validRange\": \"0mm to half beam width\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Determines how much material is removed from the left side of the beam end.\"\n    },\n    {\n      \"name\": \"dDepthRight\",\n      \"technicalDefault\": \"U(7)\",\n      \"businessMeaning\": \"The depth of the horizontal shoulder cut on the right side of the beam (relative to the beam's local Y-axis).\",\n      \"validRange\": \"0mm to half beam width\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Determines how much material is removed from the right side of the beam end.\"\n    },\n    {\n      \"name\": \"dDepthTop\",\n      \"technicalDefault\": \"U(7)\",\n      \"businessMeaning\": \"The depth of the vertical shoulder cut at the top of the beam (relative to the beam's local Z-axis).\",\n      \"validRange\": \"0mm to half beam height\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Determines how much material is removed from the top of the beam end.\"\n    },\n    {\n      \"name\": \"dDepthBottom\",\n      \"technicalDefault\": \"U(7)\",\n      \"businessMeaning\": \"The depth of the vertical shoulder cut at the bottom of the beam (relative to the beam's local Z-axis).\",\n      \"validRange\": \"0mm to half beam height\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Determines how much material is removed from the bottom of the beam end.\"\n    },\n    {\n      \"name\": \"dDepthFront\",\n      \"technicalDefault\": \"U(0)\",\n      \"businessMeaning\": \"The additional penetration depth of the notch into the log wall starting from the beam center towards the 'front' (local -X direction).\",\n      \"validRange\": \"0mm to Wall Thickness\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Extends the length of the notch and the hole in the wall forward from the beam center.\"\n    },\n    {\n      \"name\": \"dDepthBack\",\n      \"technicalDefault\": \"U(0)\",\n      \"businessMeaning\": \"The additional penetration depth of the notch into the log wall starting from the beam center towards the 'back' (local +X direction).\",\n      \"validRange\": \"0mm to Wall Thickness\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Extends the length of the notch and the hole in the wall backward from the beam center.\"\n    },\n    {\n      \"name\": \"offsetBeamCutBottomLeft\",\n      \"technicalDefault\": \"U(0)\",\n      \"businessMeaning\": \"Reduces the width of the bottom cutout starting from the left edge.\",\n      \"validRange\": \"0mm to beam width\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Narrows the bottom cut on the left side, useful for creating a specific bearing surface or avoiding edge defects.\"\n    },\n    {\n      \"name\": \"offsetBeamCutBottomRight\",\n      \"technicalDefault\": \"U(0)\",\n      \"businessMeaning\": \"Reduces the width of the bottom cutout starting from the right edge.\",\n      \"validRange\": \"0mm to beam width\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Narrows the bottom cut on the right side, useful for creating a specific bearing surface or avoiding edge defects.\"\n    },\n    {\n      \"name\": \"dGapLeft\",\n      \"technicalDefault\": \"U(1)\",\n      \"businessMeaning\": \"Clearance space on the left side between the beam shoulder and the log wall hole.\",\n      \"validRange\": \"0mm to 10mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Enlarges the hole cut in the log wall on the left side to ensure easy fit or account for tolerances.\"\n    },\n    {\n      \"name\": \"dGapRight\",\n      \"technicalDefault\": \"U(1)\",\n      \"businessMeaning\": \"Clearance space on the right side between the beam shoulder and the log wall hole.\",\n      \"validRange\": \"0mm to 10mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Enlarges the hole cut in the log wall on the right side to ensure easy fit or account for tolerances.\"\n    },\n    {\n      \"name\": \"dGapTop\",\n      \"technicalDefault\": \"U(1)\",\n      \"businessMeaning\": \"Clearance space at the top between the beam shoulder and the log wall hole.\",\n      \"validRange\": \"0mm to 10mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Enlarges the hole cut in the log wall at the top to ensure easy fit or account for tolerances.\"\n    },\n    {\n      \"name\": \"dGapBottom\",\n      \"technicalDefault\": \"U(1)\",\n      \"businessMeaning\": \"Clearance space at the bottom between the beam shoulder and the log wall hole.\",\n      \"validRange\": \"0mm to 10mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Enlarges the hole cut in the log wall at the bottom to ensure easy fit or account for tolerances.\"\n    },\n    {\n      \"name\": \"dSplitMargin\",\n      \"technicalDefault\": \"U(15)\",\n      \"businessMeaning\": \"The minimum width of remaining material in a log wall beam before the script decides to split the log instead of just cutting a hole.\",\n      \"validRange\": \"5mm to 50mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"If the log wall material remaining next to the notch is thinner than this value, the log beam is split into two parts; otherwise, a hole is simply cut.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"Changing dDepthFront or dDepthBack\",\n      \"effect\": \"Shifts the center point of the notch along the beam's length axis and extends the total length of the cuts applied to both the beam and the log wall.\",\n      \"cascade\": [\"ptLeft\", \"ptRight\", \"ptTop\", \"ptBottom\", \"BeamCut Lengths\"]\n    },\n    {\n      \"trigger\": \"Changing offsetBeamCutBottomLeft/Right\",\n      \"effect\": \"Reduces the effective width of the bottom BeamCut, potentially overriding the full beam width calculation.\",\n      \"cascade\": [\"widthBottomBeamCut\", \"originBottomBeamCut\"]\n    },\n    {\n      \"trigger\": \"Increasing Gap parameters\",\n      \"effect\": \"Increases the size of the void cut into the log wall while leaving the beam notch size unchanged (based on dDepth parameters).\",\n      \"cascade\": [\"bdBcBeam dimensions\", \"Log Wall Hole Size\"]\n    }\n  ],\n  \"outputEntities\": [\n    {\n      \"type\": \"BeamCut\",\n      \"description\": \"L-shaped notch or tenon cut into the selected beam (shoulders on left, right, top, bottom).\",\n      \"appliedTo\": \"The Beam selected by the user (the satellite instance owner).\"\n    },\n    {\n      \"type\": \"BeamCut\",\n      \"description\": \"Rectangular hole cut into the log wall to accommodate the notched beam, sized by beam dimensions minus depths plus gaps.\",\n      \"appliedTo\": \"The Beams comprising the Element (Log Wall).\"\n    },\n    {\n      \"type\": \"BeamSplit\",\n      \"description\": \"The log wall beam is split into two entities if the remaining material next to the hole is less than the Split Margin.\",\n      \"appliedTo\": \"The Beams comprising the Element (Log Wall"
      },
      "tokens_used": 8795,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches script or selects from catalog.",
          "[Conditional] Script checks for _kExecuteKey. If missing, a dialog prompts for default Notch and Gap dimensions.",
          "User is prompted to select an Element (the log wall).",
          "User is prompted to select a set of Beams (the joists/purlins to be notched).",
          "Script iterates through selected beams and creates a Satellite instance of the TSL for each beam, linking it to the Element.",
          "Master TSL instance erases itself.",
          "Satellite TSL initializes and verifies linkage to Element and Beam.",
          "Script calculates the intersection point of the Beam centerline with the Element's vertical center plane.",
          "[Validation] Script checks if the Beam is perpendicular to the Element wall surface. If not, execution halts with a warning.",
          "Script generates L-Notch geometry (Left, Right, Top, Bottom shoulders) based on depth properties and applies BeamCuts to the selected Beam.",
          "Script iterates through every beam contained within the Log Wall Element.",
          "For each Log Beam, script checks if it intersects with the selected Beam.",
          "[Conditional] If intersection exists, script calculates the remaining material width.",
          "[Conditional] If remaining width < Split Margin, the Log Beam is split into two separate beams.",
          "[Conditional] If remaining width >= Split Margin, a rectangular hole (BeamCut) is applied to the Log Beam.",
          "Script adds an 'NOTCH' item to the Element for export purposes."
        ],
        "conditionalBranches": [
          {
            "condition": "Check for Execute Key/Catalog on Insert",
            "path1": {
              "name": "Catalog/Execute Key",
              "steps": [
                "Script detects _kExecuteKey.",
                "Properties are loaded from the catalog definition automatically.",
                "Dialog is skipped."
              ]
            },
            "path2": {
              "name": "Manual Insert",
              "steps": [
                "No execute key found.",
                "Function showDialog() is executed.",
                "User manually enters default dimensions before proceeding to entity selection."
              ]
            }
          },
          {
            "condition": "Log Wall Beam Intersection",
            "path1": {
              "name": "Intersection Found",
              "steps": [
                "Script calculates intersection body volume.",
                "Measures width of remaining material.",
                "Proceeds to Split Margin check."
              ]
            },
            "path2": {
              "name": "No Intersection",
              "steps": [
                "Script skips current Log Beam.",
                "Continues to next beam in Element."
              ]
            }
          },
          {
            "condition": "Structural Integrity Check (Split vs Hole)",
            "path1": {
              "name": "Split Required",
              "steps": [
                "Condition met: Remaining material width < dSplitMargin.",
                "Check Map to verify if beam is already split at this height.",
                "If not split, execute bmLog.dbSplit().",
                "Append new beam segment to array.",
                "Record split height in Map."
              ]
            },
            "path2": {
              "name": "Hole Cut Only",
              "steps": [
                "Condition met: Remaining material width >= dSplitMargin.",
                "Create bcBeam (Cutting Body) defined by beam size minus gaps.",
                "Add bcBeam as a static tool to the Log Beam."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Assignment",
            "errorMessage": "No element selected!",
            "recovery": "User must ensure the script is linked to a valid Element (Log Wall) during insertion."
          },
          {
            "check": "Beam Validity",
            "errorMessage": "No valid beam selected",
            "recovery": "User must ensure the script is linked to a valid Beam entity during insertion."
          },
          {
            "check": "Geometric Perpendicularity",
            "errorMessage": "Not possible to find intersection",
            "recovery": "The selected beam must cross the log wall perpendicularly. Adjust the beam angle or position so it traverses the wall plane."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Notch Dimensions",
            "how": "Object Properties Palette (OPM)",
            "effect": "Updating 'Depth Left/Right/Top/Bottom' or 'Gap' properties recalculates the geometry, resizing the notch on the beam and the corresponding hole in the wall."
          },
          {
            "action": "Adjust Split Sensitivity",
            "how": "Object Properties Palette (OPM)",
            "effect": "Changing 'Split margin' determines whether the script splits the log beams or just cuts holes upon recalculation."
          },
          {
            "action": "Move Beam or Wall",
            "how": "Grip Edit / Move Command",
            "effect": "Moving the beam or wall triggers a recalculation, shifting the location of the notch and hole to maintain the connection."
          }
        ]
      },
      "tokens_used": 10337,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_L-Notch\n\n## Overview\nAutomates the connection between structural beams (joists, purlins, or rafters) and a log wall. It creates a precise L-notch on the beam and cuts a matching hole in the log wall, automatically splitting the logs if the remaining material is too narrow.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script modifies 3D beam geometry and must be used in the model. |\n| Paper Space | No | Not designed for 2D drawing generation. |\n| Shop Drawing | No | Not a shop drawing annotation script. |\n\n## Prerequisites\n- **Required Entities**: One `Element` (representing the log wall) and one or more `Beam` entities (the beams to be inserted).\n- **Minimum Beam Count**: 1.\n- **Geometric Constraint**: The selected beams must generally intersect the log wall perpendicularly for the tool to calculate the intersection correctly.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_L-Notch.mcr` from the catalog or file list.\n\n### Step 2: Configuration (Optional)\nIf the script is run manually (without a predefined catalog entry), a dialog box may appear asking for default Notch and Gap dimensions. If run from a catalog, these settings are loaded automatically.\n\n### Step 3: Select Log Wall\n```\nCommand Line: Select element:\nAction: Click on the log wall (Element) where the beam will be inserted.\n```\n\n### Step 4: Select Beams\n```\nCommand Line: Select beams:\nAction: Select the beam(s) (e.g., joists or purlins) that need to be notched and fitted into the wall. Press Enter to confirm selection.\n```\n\n### Step 5: Processing\nThe script will automatically calculate the intersection, notch the selected beams, and apply cuts or splits to the log wall logs.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| dDepthLeft | Double | 7 mm | Depth of the horizontal shoulder cut on the left side of the beam. |\n| dDepthRight | Double | 7 mm | Depth of the horizontal shoulder cut on the right side of the beam. |\n| dDepthTop | Double | 7 mm | Depth of the vertical shoulder cut at the top of the beam. |\n| dDepthBottom | Double | 7 mm | Depth of the vertical shoulder cut at the bottom of the beam. |\n| dDepthFront | Double | 0 mm | Additional penetration depth into the wall towards the \"front\" (local -X). |\n| dDepthBack | Double | 0 mm | Additional penetration depth into the wall towards the \"back\" (local +X). |\n| offsetBeamCutBottomLeft | Double | 0 mm | Reduces the width of the bottom cutout starting from the left edge. |\n| offsetBeamCutBottomRight | Double | 0 mm | Reduces the width of the bottom cutout starting from the right edge. |\n| dGapLeft | Double | 1 mm | Clearance space between the beam and the hole on the left side. |\n| dGapRight | Double | 1 mm | Clearance space between the beam and the hole on the right side. |\n| dGapTop | Double | 1 mm | Clearance space between the beam and the hole at the top. |\n| dGapBottom | Double | 1 mm | Clearance space between the beam and the hole at the bottom. |\n| dSplitMargin | Double | 15 mm | Minimum remaining material width required in the log to prevent splitting. If material is thinner than this, the log is split. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Update | Recalculates the notch and wall cuts based on current property values or beam positions. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A (All settings are managed via the Properties Panel).\n\n## Tips\n- **Perpendicularity**: Ensure the beams intersect the log wall element as close to 90 degrees as possible. If the script fails to find an intersection, check the alignment.\n- **Tolerances**: Use the `Gap` properties (Left, Right, Top, Bottom) to account for wood shrinkage or to ensure easier assembly on site.\n- **Splitting vs. Holes**: If you want the log wall to remain as continuous beams where possible, increase the `dSplitMargin`. If you prefer the logs to be cut through for better stability, decrease it.\n- **Offsets**: Use `offsetBeamCutBottom...` parameters if you need to reduce the bearing surface width at the bottom of the notch without changing the main depth dimensions.\n\n## FAQ\n- **Q: Why did the script split my log wall beam instead of just cutting a hole?**\n  **A**: The script calculates the remaining material width next to the notch. If this width is smaller than the `dSplitMargin` property (default 15mm), it automatically splits the log to prevent leaving a fragile sliver of wood.\n- **Q: The script reports \"Not possible to find intersection\". What is wrong?**\n  **A**: Ensure the beam actually passes through the volume of the log wall Element and that the beam is roughly perpendicular to the wall surface.\n- **Q: How do I make the notch go deeper into the wall?**\n  **A**: Increase the `dDepthFront` and `dDepthBack` properties. This extends the notch length along the beam axis into the wall."
      },
      "tokens_used": 8043,
      "error": null
    }
  }
}