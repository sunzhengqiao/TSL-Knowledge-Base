{
  "filename": "Alpine-BearingReaction.mcr",
  "status": "completed",
  "total_tokens": 28506,
  "processing_time": 342.68651127815247,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.6",
            "date": "01.jul.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Description updated"
          },
          {
            "version": "1.5",
            "date": "31.may.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Insertion step by step decribed in description"
          },
          {
            "version": "1.3",
            "date": "17.ago.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "_bOnInsert added to leave user chance to turn text label on/off"
          },
          {
            "version": "1.2",
            "date": "17.ago.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Description updated\n- Copyright added\n- Thumbnail added"
          },
          {
            "version": "1.0 && v1.1",
            "date": "",
            "author": "No author",
            "changes": ""
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4910,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses `_Pt0`, `_Map`, `_ThisInst`, and `CoordSys` which are typical for model-space scripts. It contains no `sd_` prefixes, no `_Viewport` usage, and no `#Type E` entry points found in `ShopDrawing` scripts. It uses `TrussEntity` and `eraseInstance()`, indicating it is a generator/interactive script operating on 3D model entities."
        },
        "prerequisites": {
          "requiredEntities": [
            "TrussEntity",
            "TslInst"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model space containing Trusses with calculation results (Map) containing RX, RY, RZ, NX, NY, NZ, ReactionMagnitude, MaxVerticalUplift, Plies, PlyWidth, InfillType, ReactionsOnInfill, MinReactionForDisplay.",
          "requiredSettings": []
        }
      },
      "tokens_used": 2902,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect truss(es)",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowNotice",
            "trigger": "After insertion and property assignment",
            "title": null,
            "dataSource": "Hardcoded string",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDisplayReaction",
            "type": "PropString",
            "displayName": "Display reaction label",
            "defaultValue": "|Yes|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3594,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Visualizes structural engineering load calculations (bearing reactions and uplift forces) directly on truss elements within the 3D model.",
          "category": "Annotation/Engineering",
          "typicalUseCase": "Used by engineers or detailers to verify load paths and display reaction magnitudes (kN or lbs) at truss bearing points without needing to open separate calculation reports."
        },
        "parameters": [
          {
            "name": "sDisplayReaction",
            "technicalDefault": "|Yes|",
            "businessMeaning": "Toggles the visibility of the reaction force annotation (direction arrow and magnitude text label) at the truss bearing point.",
            "validRange": "|No|, |Yes|",
            "unit": "Boolean/Option",
            "affectsOutput": "If set to '|No|', all graphical representations of the force vector and text labels are hidden. If set to '|Yes|', the script draws an arrow indicating the force direction and text indicating the magnitude (Reaction and Uplift)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User modifies the 'Display reaction label' property via the Properties Palette",
            "effect": "Changes the state of the internal variable 'nDisplayReactionLabel', which controls whether the drawing commands (disp.draw) are executed.",
            "cascade": [
              "nDisplayReactionLabel"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Annotation (PLine & Text)",
            "description": "A 3D vector arrow indicating the direction of the reaction force and text labels displaying the magnitude of the Reaction (R) and Uplift (U). Uplift is typically colored red (color index 5).",
            "appliedTo": "Truss bearing points (insertion point _Pt0) in the Model Space."
          }
        ]
      },
      "tokens_used": 5643,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User executes script insertion (Launch)",
          "[Conditional: _bOnInsert is true]",
          "User prompted to Select truss(es) via PrEntity",
          "User selects trusses",
          "Script checks if entities were selected",
          "[Conditional: If no entities selected]",
          "   -> Erase script instance and terminate",
          "[Conditional: If entities selected]",
          "   -> Iterate through selected entities",
          "   -> Filter for TrussEntity types",
          "   -> Access TrussDefinition and internal TslInst array",
          "   -> Iterate through TslInst to find existing 'Alpine-BearingReaction' instances",
          "   -> Apply the current 'sDisplayReaction' property setting to found instances",
          "   -> Show Notice: 'Please select all affected trusses again and execute the HSB_RECALC command to update display'",
          "   -> Erase script instance and terminate",
          "[Conditional: Subsequent Executions/Calculations (_bOnInsert false)]",
          "   -> Retrieve Map data (RX, RY, RZ, NX, NY, NZ)",
          "   -> Determine vector source (Map values vs CoordSys based on zero-check)",
          "   -> Calculate vectors and offsets (vecZOffset from Plies/PlyWidth)",
          "   -> Retrieve reaction magnitudes (ReactionMagnitude, MaxVerticalUplift)",
          "   -> Determine Unit system (Metric vs Imperial)",
          "   -> Check Display logic (Infill type, ReactionsOnInfill, Magnitude threshold)",
          "[Conditional: Valid to display]",
          "   -> Calculate Reference Point (Pt0 offset by vectors)",
          "   -> Draw Reaction Line (Vector arrow)",
          "   -> Draw Arrow Heads",
          "   -> Format Reaction String (kN or lbs)",
          "   -> Draw Reaction Text (Color 1)",
          "[Conditional: Uplift exists]",
          "   -> Format Uplift String",
          "   -> Calculate Uplift Position (Offset below main point)",
          "   -> Draw Uplift Text (Color 5 - Red)"
        ],
        "conditionalBranches": [
          {
            "condition": "User Input Phase (Insertion)",
            "path1": {
              "name": "Selection Aborted / Empty",
              "steps": [
                "User hits Esc or selects nothing",
                "_Entity.length() == 0",
                "eraseInstance() called",
                "Script terminates"
              ]
            },
            "path2": {
              "name": "Trusses Selected",
              "steps": [
                "_Entity filled with TrussEntity objects",
                "Script iterates internal TslInst of TrussDefinition",
                "Updates properties of existing instances",
                "Notification displayed",
                "eraseInstance() called",
                "Script terminates"
              ]
            }
          },
          {
            "condition": "Vector Data Source",
            "path1": {
              "name": "Old Map Data",
              "steps": [
                "Check: RX, RY, RZ not all zero",
                "Use Map values for reactionVector and trussNormalVector",
                "vecZOffset remains 0.0"
              ]
            },
            "path2": {
              "name": "New Model / CoordSys",
              "steps": [
                "Check: RX, RY, RZ all zero",
                "Get CoordSys from _ThisInst",
                "reactionVector = -coord.vecY()",
                "trussNormalVector = coord.vecX()",
                "vZ = coord.vecZ()",
                "vecZOffset calculated from Plies/PlyWidth"
              ]
            }
          },
          {
            "condition": "Visibility Criteria",
            "path1": {
              "name": "Visible",
              "steps": [
                "ReactionMagnitude > dMinReactionForDisplay",
                "InfillType is FALSE OR ReactionsOnInfill is TRUE",
                "sDisplayReaction (nDisplayReactionLabel) is TRUE",
                "Drawing commands executed"
              ]
            },
            "path2": {
              "name": "Hidden",
              "steps": [
                "Magnitude too low OR Infill type mismatch OR Display Property set to No",
                "Script returns without drawing"
              ]
            }
          },
          {
            "condition": "Unit System",
            "path1": {
              "name": "Metric",
              "steps": [
                "Check: U(1,'mm') == 1.0",
                "Format string: 'R= %.3fkN'",
                "Format string: 'U= %.3fkN'"
              ]
            },
            "path2": {
              "name": "Imperial",
              "steps": [
                "Check: U(1,'mm') != 1.0",
                "Format string: 'R= %d#' (integer)",
                "Format string: 'U= %d#' (integer)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Selection",
            "errorMessage": "None explicitly logged, but instance is erased if empty.",
            "recovery": "User must re-run script and select valid TrussEntities."
          },
          {
            "check": "Truss Type Compatibility",
            "errorMessage": "None explicitly logged. Non-truss entities are skipped via 'continue'.",
            "recovery": "User must select valid Trusses with Map data."
          },
          {
            "check": "Data Availability (Map)",
            "errorMessage": "If vectors are 0, script assumes CoordSys usage. If Magnitude is 0, display is skipped based on threshold.",
            "recovery": "Ensure Trusses have valid engineering calculation results (Map) populated."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Toggle Visibility",
            "how": "Properties Palette (OPM) -> 'Display reaction label' dropdown",
            "effect": "Sets nDisplayReactionLabel. If set to '|No|', drawing commands are skipped. If '|Yes|', vectors and text are drawn."
          },
          {
            "action": "Batch Update",
            "how": "Re-run script insertion, select trusses",
            "effect": "Iterates through existing instances attached to selected trusses and updates their 'sDisplayReaction' property to match the new insertion setting."
          },
          {
            "action": "Recalculate Geometry",
            "how": "Command Line -> HSB_RECALC",
            "effect": "Triggers the script execution path (_bOnInsert = false), reading latest Map data to update positions, magnitudes, and text values."
          }
        ]
      },
      "tokens_used": 6115,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Alpine-BearingReaction.mcr\n\n## Overview\nVisualizes structural engineering load calculations (bearing reactions and uplift forces) directly on truss elements in the 3D model. It creates annotations with direction arrows and text labels to display reaction magnitudes (kN or lbs) at truss bearing points.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D Truss entities. |\n| Paper Space | No | Not designed for Paper Space or Layouts. |\n| Shop Drawing | No | This is a model-space annotation tool. |\n\n## Prerequisites\n- **Required Entities**: Trusses that have been calculated and possess valid engineering data (Map) containing reaction values (RX, RY, RZ, etc.).\n- **Minimum Beam Count**: N/A (User selects trusses interactively).\n- **Required Settings**: None. However, the trusses must have calculation results available for the script to display values.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Browse and select `Alpine-BearingReaction.mcr`.\n\n### Step 2: Select Trusses\n```\nCommand Line: Select truss(es)\nAction: Click on the trusses you want to annotate or update, then press Enter.\n```\n\n### Step 3: Refresh Display\n```\nCommand Line: HSB_RECALC\nAction: Select the affected trusses again and press Enter. This triggers the script to read the calculation data and generate the arrows and text labels.\n```\n*(Note: The script will display a notification reminding you to perform this step after insertion.)*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Display reaction label | dropdown | |Yes| | Toggles the visibility of the reaction force arrow and text label. Set to |No| to hide annotations, or |Yes| to show them. |\n\n## Right-Click Menu Options\n*None configured.*\n\n## Settings Files\n*None required.*\n\n## Tips\n- **Unit Handling**: The script automatically detects your project units. It will display loads in **kN** (Metric) or **lbs** (Imperial) formatted as integers.\n- **Uplift Forces**: Pay attention to text colored **Red**; this indicates vertical uplift forces (MaxVerticalUplift), which are critical for connection design.\n- **Batch Updates**: If you insert the script again and select existing trusses, it will update the properties (e.g., turning labels on/off) for all instances attached to those trusses.\n\n## FAQ\n\n**Q: Why don't I see any arrows or text after running the script?**\nA: The script inserts as an instance but requires a calculation refresh. Select the trusses again and run the command `HSB_RECALC` to generate the graphics.\n\n**Q: Can I hide the reaction labels temporarily?**\nA: Yes. Select the truss (or the script instance), open the Properties Palette (Ctrl+1), and change \"Display reaction label\" to `|No|`. You will need to run `HSB_RECALC` for the change to take effect visually.\n\n**Q: Why are some values not showing?**\nA: The script has a built-in threshold (`MinReactionForDisplay`). Very small reaction magnitudes may be hidden automatically to reduce visual clutter."
      },
      "tokens_used": 5342,
      "error": null
    }
  }
}