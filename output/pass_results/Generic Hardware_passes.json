{
  "filename": "Generic Hardware.mcr",
  "status": "completed",
  "total_tokens": 39509,
  "processing_time": 770.0530588626862,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4693,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getPoint and PrPoint to define 3D coordinates (_PtG, _Pt0). Geometry is drawn based on Vector3d calculations (vX, vY, vZ) derived from point input. No Paper Space specific keywords (_Viewport, sd_*) or Shop Drawing structures (#Type E) are present."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": [
            "TslUtilities.dll"
          ]
        }
      },
      "tokens_used": 4839,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getString\",\n        \"promptOriginal\": \"Select Display Block ? [Yes/No]\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"Select Location\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"PrPoint\",\n        \"promptOriginal\": \"Select point to determine orientation/distribution\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 4,\n        \"function\": \"getElement\",\n        \"promptOriginal\": \"Select Element (optional)\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": false\n      }\n    ],\n    \"keywordOptions\": [\n      {\n        \"prompt\": \"Select Display Block ? [Yes/No]\",\n        \"options\": [\n          \"Y\",\n          \"N\"\n        ]\n      }\n    ]\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"SelectFromList\",\n      \"trigger\": \"Context Menu Click ('Select Display Block') or Insertion Reply 'Y'\",\n      \"title\": \"Select Block for Display\",\n      \"dataSource\": \"_BlockNames (Drawing Blocks)\",\n      \"features\": {\n        \"searchable\": true,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"psDisplayMode\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Display Mode\",\n      \"defaultValue\": \"Series\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Series\",\n        \"Cylinder\",\n        \"Single Insert\",\n        \"Box\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"psArticleNumber\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Article Number\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Hardware Data\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"psDescription\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Description\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Hardware Data\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"psManufacturer\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Manufacturer\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Hardware Data\",\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"psModel\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Model\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Hardware Data\",\n      \"description\": null\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"psMaterial\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Material\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Hardware Data\",\n      \"description\": null\n    },\n    {\n      \"index\": 6,\n      \"variable\": \"psCategory\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Category\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Hardware Data\",\n      \"description\": null\n    },\n    {\n      \"index\": 7,\n      \"variable\": \"psGroup\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Group\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Hardware Data\",\n      \"description\": null\n    },\n    {\n      \"index\": 8,\n      \"variable\": \"psNotes\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Notes\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Hardware Data\",\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"piQuantity\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"Quantity\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": \"When Spacing > 0, Quantity is set automatically\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"pdSpacing\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Spacing\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": \"When Spacing > 0, Quantity is set automatically\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"pdLength\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Length\",\n      \"defaultValue\": \"U(12, \\\"inch\\\")\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Hardware Data\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"pdWidth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Width/Diameter\",\n      \"defaultValue\": \"U(1, \\\"inch\\\")\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Hardware Data\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"pdHeight\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Height/Thickness\",\n      \"defaultValue\": \"U(1.5, \\\"inch\\\")\",\n      \"inputType\": \"number\",\n      \"options\": [],\n     "
      },
      "tokens_used": 7832,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 8997,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched: Initialize properties, units, and display flags",
          "Insertion Phase: Prompt user 'Select Display Block ? [Yes/No]'",
          "Branch: If 'Yes', set flag to trigger block dialog later",
          "Prompt user 'Select Location' to define origin (ptStartGrip)",
          "Prompt user 'Select point to determine orientation/distribution' to define vector and end point (ptEndGrip)",
          "Validate Vector: If valid, store grips; if invalid, restore from Map/Defaults",
          "Prompt user 'Select Element (optional)' to associate with a timber element",
          "Execution Phase: Check for 'Select Display Block' trigger or Insertion Flag",
          "If triggered: Open 'Select Block for Display' dialog (TslUtilities.dll)",
          "Calculate Geometry: Determine vX, vY, vZ and Length based on grip positions",
          "Draw Representation: Execute logic based on 'Display Mode' (Series, Cylinder, Single Insert, Box)",
          "Generate Hardware: Create/Update HardWrComp entity with OPM property values",
          "Completion: Instance generated and data committed to model"
        ],
        "conditionalBranches": [
          {
            "condition": "Reply to 'Select Display Block ? [Yes/No]'",
            "path1": {
              "name": "Yes",
              "steps": [
                "Set internal Map flag 'doBlockSelection' to 1",
                "Proceed to point selection",
                "Execute Block Selection Dialog after insertion"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skip block selection logic",
                "Proceed to point selection",
                "Use default geometry (circles/lines) for display"
              ]
            }
          },
          {
            "condition": "Result of 'Select point to determine orientation/distribution'",
            "path1": {
              "name": "Valid Point",
              "steps": [
                "Calculate vector vGrips",
                "Set _Pt0 (Midpoint)",
                "Append points to _PtG",
                "Continue to Element selection"
              ]
            },
            "path2": {
              "name": "User Cancel",
              "steps": [
                "eraseInstance()",
                "Return (Terminate)"
              ]
            }
          },
          {
            "condition": "Value of 'Display Mode' property",
            "path1": {
              "name": "Series",
              "steps": [
                "Draw Line and Arrows",
                "Loop points based on Spacing",
                "Draw Blocks or Circles at points"
              ]
            },
            "path2": {
              "name": "Cylinder",
              "steps": [
                "Draw 3D Cylinder Body",
                "Override Spacing to 0",
                "Override Quantity to 1"
              ]
            },
            "path3": {
              "name": "Single Insert",
              "steps": [
                "Skip Line/Arrow drawing",
                "Distribute points based on Spacing",
                "Draw Blocks or Circles at points"
              ]
            },
            "path4": {
              "name": "Box",
              "steps": [
                "Draw 3D Box Body at midpoint",
                "Scale by Length, Width, Height properties"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Vector Length (Grip Distance)",
            "errorMessage": "None (Auto-correction)",
            "recovery": "If length < 0.1 inch, restores vector from _Map storage to prevent zero-length geometry."
          },
          {
            "check": "User Input Prompts",
            "errorMessage": "None (Silent Exit)",
            "recovery": "If getString returns empty or getPoint is cancelled, eraseInstance() is called."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Display Block",
            "how": "Context Menu ('Select Display Block')",
            "effect": "Opens dialog to select a new block name from the drawing; updates display immediately."
          },
          {
            "action": "Adjust Geometry via Grips",
            "how": "Grip Edit (Start/End points)",
            "effect": "Recalculates vector, length, and midpoint; updates 'Length' property; redraws hardware distribution."
          },
          {
            "action": "Adjust Geometry via Property",
            "how": "OPM ('Length' property)",
            "effect": "Updates the distance between grips symmetrically around the center point."
          },
          {
            "action": "Modify Hardware Metadata",
            "how": "OPM (Hardware Data category fields)",
            "effect": "Updates the HardWrComp entity data (Manufacturer, Model, Material, etc.)."
          },
          {
            "action": "Change Visual Style",
            "how": "OPM ('Display Mode' dropdown)",
            "effect": "Switches between Series, Cylinder, Single Insert, or Box visualizations."
          }
        ]
      },
      "tokens_used": 7099,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Generic Hardware.mcr\n\n## Overview\nInserts and manages generic hardware components within the 3D model. It allows users to place hardware items with specific metadata (Manufacturer, Model, etc.) and visualize them using various display modes (Series, Cylinder, Box, or Custom Blocks) distributed along a user-defined path.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script uses 3D coordinates and vector geometry. |\n| Paper Space | No | Not designed for 2D layout or annotation. |\n| Shop Drawing | No | Does not generate shop drawing views directly. |\n\n## Prerequisites\n- **Required Entities:** None (Optional selection of a timber element/GenBeam is allowed).\n- **Minimum Beam Count:** 0.\n- **Required Settings:** `TslUtilities.dll` must be loaded in the hsbCAD environment.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `Generic Hardware.mcr`\n\n### Step 2: Choose Display Representation\n```\nCommand Line: Select Display Block ? [Yes/No]\nAction: Type Y to open a dialog and pick a specific AutoCAD block, or N to use default geometry.\n```\n*Note: If you select Yes, a list of available blocks in the current drawing will appear.*\n\n### Step 3: Set Location\n```\nCommand Line: Select Location\nAction: Click in the model to place the insertion point (Start Point).\n```\n\n### Step 4: Define Orientation\n```\nCommand Line: Select point to determine orientation/distribution\nAction: Click a second point to define the direction and length of the hardware placement.\n```\n\n### Step 5: Associate with Element (Optional)\n```\nCommand Line: Select Element (optional)\nAction: Click a timber beam if you wish to link the hardware to that specific element, or press Enter to skip.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Display Mode** | Dropdown | Series | Determines how the hardware is drawn: <br>• **Series**: Items distributed along a line with arrows.<br>• **Cylinder**: A single 3D cylinder body.<br>• **Single Insert**: Items distributed without the leader line.<br>• **Box**: A single 3D box body. |\n| **Article Number** | Text | - | The unique identifier for the hardware. |\n| **Description** | Text | - | A short description of the hardware item. |\n| **Manufacturer** | Text | - | Name of the hardware manufacturer. |\n| **Model** | Text | - | Specific model number or name. |\n| **Material** | Text | - | Material specification (e.g., Steel, Stainless Steel). |\n| **Category** | Text | - | Grouping category for lists/filters. |\n| **Group** | Text | - | Sub-group for organization. |\n| **Notes** | Text | - | Additional user comments. |\n| **Quantity** | Number | 0 | Number of hardware items. (Auto-calculated if Spacing > 0). |\n| **Spacing** | Number | 0 | Distance between items in Series/Single Insert mode. (Auto-calculates Quantity if > 0). |\n| **Length** | Number | 12\" | Physical length of the hardware or the distribution line. |\n| **Width/Diameter** | Number | 1\" | Width (for Box) or Diameter (for Cylinder/Circle). |\n| **Height/Thickness** | Number | 1.5\" | Height (for Box) or Thickness. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Select Display Block** | Opens a dialog allowing you to change the visual block used for the hardware representation. Useful for switching between different screw or plate symbols. |\n\n## Settings Files\n- **Filename**: N/A\n- **Location**: N/A\n- **Purpose**: This script does not rely on external XML settings files. It utilizes standard `TslUtilities.dll` for dialogs and reads Block definitions directly from the current drawing.\n\n## Tips\n- **Grip Editing:** You can click the hardware instance to reveal **Start** and **End** grips. Drag these grips to resize the distribution length or change the angle.\n- **Symmetric Resizing:** Changing the **Length** property in the palette will extend the hardware symmetrically from the center point.\n- **Fast Spacing:** To layout screws along a beam, set **Display Mode** to \"Series\", set your desired **Spacing**, and adjust the **Length** grips to cover the area. The Quantity will update automatically.\n\n## FAQ\n- **Q: How do I show my own custom screw head instead of a circle?**\n- **A:** Insert your custom block into the drawing first. Then, right-click the hardware instance and select \"Select Display Block\" to choose your block from the list.\n- **Q: Why can't I change the Quantity manually?**\n- **A:** If the **Spacing** property is set to a value greater than 0, the script automatically calculates the Quantity based on the Length. Set Spacing to 0 to manually control Quantity."
      },
      "tokens_used": 6049,
      "error": null
    }
  }
}