{
  "filename": "HSB_G-EntityInformation.mcr",
  "status": "completed",
  "total_tokens": 54894,
  "processing_time": 702.9922559261322,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9387,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The <insert> comment instructs the user to 'Select a viewport', a Paper Space entity. The script performs coordinate transformations using ms2ps (Model Space to Paper Space) and ps2ms to position text labels. It utilizes DrawingPrimitives (dp) for output, typical for 2D drawing annotations. The filename prefix 'HSB_G-' indicates a general tool rather than a 'sd_/' ShopDrawing generation script."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element",
            "TslInst"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Requires an active layout with at least one viewport to select.",
          "requiredSettings": [
            "Posnum.xml (located in _kPathHsbCompany\\Custom\\)",
            "HSB_G-FilterGenBeams (Catalog TSL for advanced filtering)"
          ]
        }
      },
      "tokens_used": 8128,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 23,
            "variable": "sInExcludeFilters",
            "type": "PropString",
            "displayName": "|Include|/|exclude|",
            "defaultValue": "|Include|",
            "inputType": "dropdown",
            "options": [
              "|Include|",
              "|Exclude|"
            ],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 1,
            "variable": "sFilterBC",
            "type": "PropString",
            "displayName": "|Filter beams with beamcode|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 31,
            "variable": "sFilterName",
            "type": "PropString",
            "displayName": "|Filter beams and sheets with name|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 2,
            "variable": "sFilterLabel",
            "type": "PropString",
            "displayName": "|Filter beams and sheets with label|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 25,
            "variable": "sFilterMaterial",
            "type": "PropString",
            "displayName": "|Filter beams and sheets with material|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 26,
            "variable": "sFilterHsbID",
            "type": "PropString",
            "displayName": "|Filter beams and sheets with hsbID|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 35,
            "variable": "sFilterSubLabel",
            "type": "PropString",
            "displayName": "|Filter beams and sheets with subLabel|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 36,
            "variable": "sFilterSubLabel2",
            "type": "PropString",
            "displayName": "|Filter beams and sheets with subLabel2|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 3,
            "variable": "sFilterZone",
            "type": "PropString",
            "displayName": "|Filter zones|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 29,
            "variable": "sFilterTslNames",
            "type": "PropString",
            "displayName": "|Filter tsl names|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 9,
            "variable": "genBeamFilterDefinition",
            "type": "PropString",
            "displayName": "|Filter definition for GenBeams|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "Dynamic list from catalog 'HSB_G-FilterGenBeams'",
            "category": "|Selection|",
            "description": "|Filter definition for GenBeams.| (|Will be combined with custom filters|) |Use| HSB_G-FilterGenBeams |to define the filters|."
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "Posnum.xml",
            "searchPaths": [
              "_kPathHsbCompany\\Custom\\"
            ],
            "purpose": "Provides prefix definitions based on Material and BeamCode.",
            "required": false
          },
          {
            "filename": "HSB_G-FilterGenBeams (Catalog TSL)",
            "searchPaths": [
              "hsbCAD Catalog"
            ],
            "purpose": "Provides advanced filter definitions for GenBeams.",
            "required": false
          }
        ]
      },
      "tokens_used": 8224,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates a filtered list of timber entities (beams, sheets, or macros) visible through a selected viewport and creates 2D text labels in Paper Space.",
          "category": "Annotation/Documentation",
          "typicalUseCase": "Creating a parts list, position schedule, or material summary for a specific view or floor plan without generating full shop drawings."
        },
        "parameters": [
          {
            "name": "sInExcludeFilters",
            "technicalDefault": "|Include|",
            "businessMeaning": "Determines if the subsequent filter criteria select entities to keep (Include) or entities to ignore (Exclude).",
            "validRange": "Include, Exclude",
            "unit": "Enumeration",
            "affectsOutput": "Inverts the logic of all other filtering properties, effectively showing only the matching items or hiding them."
          },
          {
            "name": "sFilterBC",
            "technicalDefault": "",
            "businessMeaning": "Filters structural timber elements based on their functional code (e.g., 'ST' for Studs, 'RB' for Rafters, 'FL' for Floor Joists).",
            "validRange": "String (supports wildcards like 'ST*')",
            "unit": "String",
            "affectsOutput": "Restricts the list to only beams performing the specified structural role."
          },
          {
            "name": "sFilterName",
            "technicalDefault": "",
            "businessMeaning": "Filters entities based on their explicit assigned name in the model properties.",
            "validRange": "String",
            "unit": "String",
            "affectsOutput": "Includes only entities with specific naming conventions used by the detailer."
          },
          {
            "name": "sFilterLabel",
            "technicalDefault": "",
            "businessMeaning": "Filters entities by their main Position Number or Label.",
            "validRange": "String",
            "unit": "String",
            "affectsOutput": "Targets specific parts or ranges of parts based on their assembly marks."
          },
          {
            "name": "sFilterMaterial",
            "technicalDefault": "",
            "businessMeaning": "Filters elements by their material grade or species (e.g., 'C24', 'GL28h', 'Kerto').",
            "validRange": "String",
            "unit": "String",
            "affectsOutput": "Generates lists for specific material grades, useful for procurement or ordering."
          },
          {
            "name": "sFilterHsbID",
            "technicalDefault": "",
            "businessMeaning": "Filters entities by their unique internal database identifier.",
            "validRange": "Numeric String",
            "unit": "ID",
            "affectsOutput": "Allows tracking of specific unique entities, often used for debugging or revision control."
          },
          {
            "name": "sFilterSubLabel",
            "technicalDefault": "",
            "businessMeaning": "Filters entities by a secondary label field, often used for piece marks or sub-assembly identifiers.",
            "validRange": "String",
            "unit": "String",
            "affectsOutput": "Refines the selection to specific sub-components within a larger assembly."
          },
          {
            "name": "sFilterSubLabel2",
            "technicalDefault": "",
            "businessMeaning": "Filters entities by a tertiary label field.",
            "validRange": "String",
            "unit": "String",
            "affectsOutput": "Provides an additional layer of categorization for complex filtering requirements."
          },
          {
            "name": "sFilterZone",
            "technicalDefault": "",
            "businessMeaning": "Filters entities belonging to specific building zones, floors, or phases defined in the project.",
            "validRange": "String",
            "unit": "String",
            "affectsOutput": "Restricts the output list to a specific geographic area or construction phase of the building."
          },
          {
            "name": "sFilterTslNames",
            "technicalDefault": "",
            "businessMeaning": "Filters entities that contain specific TSL scripts (macros) attached to them (e.g., 'HSB_M-SteelPlate').",
            "validRange": "String (Script Name)",
            "unit": "String",
            "affectsOutput": "Lists all beams that utilize a specific machining or connection detail."
          },
          {
            "name": "genBeamFilterDefinition",
            "technicalDefault": "",
            "businessMeaning": "Applies a pre-defined, complex filter set stored in the 'HSB_G-FilterGenBeams' catalog, combining multiple criteria into one selection.",
            "validRange": "List of Catalog Entries",
            "unit": "Catalog Reference",
            "affectsOutput": "Enables quick application of standard company-wide filtering rules (e.g., 'All Roof Beams') without manually configuring individual properties."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sInExcludeFilters is set to '|Exclude|'",
            "effect": "All other filter properties (sFilterBC, sFilterZone, etc.) act as a blacklist rather than a whitelist.",
            "cascade": [
              "sFilterBC",
              "sFilterName",
              "sFilterLabel",
              "sFilterMaterial",
              "sFilterHsbID",
              "sFilterSubLabel",
              "sFilterSubLabel2",
              "sFilterZone",
              "sFilterTslNames",
              "genBeamFilterDefinition"
            ]
          },
          {
            "trigger": "genBeamFilterDefinition is selected",
            "effect": "The selected definition's logic is combined with the values of the individual filter properties (like sFilterBC).",
            "cascade": [
              "sFilterBC",
              "sFilterMaterial",
              "sFilterZone"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text/Annotation",
            "description": "2D text labels and optional leader lines displaying entity information (Labels, Names, or lengths) in the Paper Space viewport.",
            "appliedTo": "N/A (Creates annotation in Paper Space based on Model Space selection)"
          }
        ]
      },
      "tokens_used": 10269,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. User launches the script 'HSB_G-EntityInformation'.\",\n    \"2. Script initializes properties and loads 'Posnum.xml' for prefix definitions.\",\n    \"3. Command line prompts user: 'Select a viewport'.\",\n    \"4. User selects a viewport in Paper Space.\",\n    \"5. Script validates the viewport (checks for hsbCAD data/transformations).\",\n    \"6. Script collects all entities (GenBeams, Elements, TslInsts) visible in the viewport.\",\n    \"7. Script iterates through the collected entities.\",\n    \"8. For each entity, script checks 'Dummy' status (ignores dummy beams).\",\n    \"9. Script applies active filters (BeamCode, Material, Name, Zone, etc.) based on 'Include/Exclude' logic.\",\n    \"10. If entity passes filters, script generates the text string content (Label, Name, Length, etc.).\",\n    \"11. Script determines the initial insertion point based on reference type (e.g., Center) and X/Y offsets.\",\n    \"12. Script checks if a 'PosnumPosition' exists in the entity's SubMap (previously saved location).\",\n    \"13. [Conditional] If position optimization is enabled and no saved position exists, script checks for overlaps with existing labels.\",\n    \"14. If overlap is found, script shifts the label incrementally until a clear space is located.\",\n    \"15. Script transforms the final coordinate from Model Space to Paper Space (ms2ps).\",\n    \"16. Script draws the text label and optional leader line in Paper Space.\",\n    \"17. Script stores the final relative position back into the entity's SubMap.\",\n    \"18. Process repeats for the next entity.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Viewport contains hsbCAD Data\",\n      \"path1\": {\n        \"name\": \"Valid Viewport\",\n        \"steps\": [\n          \"Script extracts Model Space to Paper Space transformation matrix.\",\n          \"Proceeds to entity enumeration.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Invalid/Empty Viewport\",\n        \"steps\": [\n          \"Script stops execution or produces no output.\",\n          \"User must select a different viewport.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Filter Mode (sInExcludeFilters)\",\n      \"path1\": {\n        \"name\": \"Include\",\n        \"steps\": [\n          \"Entities matching the filter criteria are processed.\",\n          \"Non-matching entities are ignored.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Exclude\",\n        \"steps\": [\n          \"Entities matching the filter criteria are ignored.\",\n          \"Non-matching entities are processed.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Existence of Saved Position (SubMap 'PosnumPosition')\",\n      \"path1\": {\n        \"name\": \"Position Saved\",\n        \"steps\": [\n          \"Script retrieves the relative vector from the entity's SubMap.\",\n          \"Label is placed at this specific saved location.\",\n          \"Collision optimization is skipped for this"
      },
      "tokens_used": 12099,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-EntityInformation.mcr\n\n## Overview\nAutomatically generates a filtered list of timber entities (beams, sheets, or macros) visible through a selected viewport and creates 2D text labels in Paper Space. This is ideal for creating parts lists, position schedules, or material summaries for specific views without generating full shop drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Source | Entities must exist in Model Space, but the script is run from a Layout. |\n| Paper Space | Yes | Primary execution space. User must select a viewport on a Layout tab. |\n| Shop Drawing | No | This is a general annotation tool, not a shop drawing generation script. |\n\n## Prerequisites\n- **Required Entities**: GenBeams, Elements, or TslInsts must exist in the model.\n- **Minimum Beam Count**: 0.\n- **Required Settings**: An active layout (Paper Space) with at least one viewport containing hsbCAD model data.\n- **Optional Files**:\n    - `Posnum.xml` (in `_kPathHsbCompany\\Custom\\`) for prefix definitions.\n    - `HSB_G-FilterGenBeams` (Catalog TSL) for advanced filtering presets.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Select `HSB_G-EntityInformation.mcr` from the file dialog.\n\n### Step 2: Select a Viewport\n```\nCommand Line: Select a viewport\nAction: Click inside the viewport frame in your Layout tab where you want to generate the labels.\n```\n\n### Step 3: Configure Properties (Optional)\nAction: Select the script instance (if it remains selected) or use the Properties Palette to adjust filters (e.g., filter by Material or Zone) if the initial result is not as desired.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| \\|Include\\|/\\|Exclude\\| | dropdown | \\|Include\\| | Determines if subsequent filters select entities to keep (Include) or ignore (Exclude). |\n| \\|Filter beams with beamcode\\| | text | (empty) | Filters structural timber elements by their functional code (e.g., 'ST' for Studs). |\n| \\|Filter beams and sheets with name\\| | text | (empty) | Filters entities based on their assigned name property. |\n| \\|Filter beams and sheets with label\\| | text | (empty) | Filters entities by their main Position Number or Label. |\n| \\|Filter beams and sheets with material\\| | text | (empty) | Filters elements by material grade or species (e.g., 'C24', 'GL28h'). |\n| \\|Filter beams and sheets with hsbID\\| | text | (empty) | Filters entities by their unique internal database ID. |\n| \\|Filter beams and sheets with subLabel\\| | text | (empty) | Filters entities by a secondary label (e.g., piece marks). |\n| \\|Filter beams and sheets with subLabel2\\| | text | (empty) | Filters entities by a tertiary label field. |\n| \\|Filter zones\\| | text | (empty) | Filters entities belonging to specific building zones or floors. |\n| \\|Filter tsl names\\| | text | (empty) | Filters entities that have specific TSL scripts (macros) attached to them. |\n| \\|Filter definition for GenBeams\\| | dropdown | (empty) | Select a pre-defined complex filter set from the 'HSB_G-FilterGenBeams' catalog. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are defined for this script. |\n\n## Settings Files\n- **Filename**: `Posnum.xml`\n- **Location**: `_kPathHsbCompany\\Custom\\`\n- **Purpose**: Defines prefixes based on Material and BeamCode to customize label generation.\n\n- **Filename**: `HSB_G-FilterGenBeams` (Catalog Entry)\n- **Location**: hsbCAD Catalog\n- **Purpose**: Provides advanced, pre-saved filter definitions that can be selected via the Properties Panel.\n\n## Tips\n- **Filtering Logic**: Use the `|Include|` setting to list specific items (e.g., only 'ST' studs). Use `|Exclude|` to hide specific items (e.g., exclude all 'Dummy' beams).\n- **Wildcards**: The text filters (like Name or Label) typically support wildcards (e.g., `ST*` to find all labels starting with ST).\n- **Collision Handling**: The script attempts to automatically detect overlapping text and shift labels to clear spaces. If labels appear cluttered, check the underlying model or adjust your filters to reduce density.\n- **Re-running**: You can select the script instance again in Paper Space and modify the filters in the Properties Palette to update the labels dynamically.\n\n## FAQ\n- **Q: Why is nothing appearing when I run the script?**\n  A: Ensure the selected viewport contains hsbCAD entities. Also, check if your filters are too restrictive (e.g., looking for a Material that doesn't exist in that view).\n- **Q: How do I list only wall elements?**\n  A: Enter the appropriate BeamCode for walls (e.g., 'WL' or 'W') into the `|Filter beams with beamcode|` property.\n- **Q: Can I save my filter settings for future use?**\n  A: Yes, you can create a filter definition using the `HSB_G-FilterGenBeams` script/catalog and then select it using the `|Filter definition for GenBeams|` dropdown in this script."
      },
      "tokens_used": 6787,
      "error": null
    }
  }
}