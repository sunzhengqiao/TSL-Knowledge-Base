{
  "filename": "hsbCLT-ZoneCreator.mcr",
  "status": "completed",
  "total_tokens": 36762,
  "processing_time": 238.15939164161682,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.1",
            "date": "16dec2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-10152 bugfix zone alignment, new nerging propeerty"
          },
          {
            "version": "1.0",
            "date": "16dec2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-10152 initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5073,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _kModelSpace explicitly during dbCreate in _bOnInsert. It operates on 3D construction entities (Element, GenBeam, Sip) to convert zones into panels. The script concludes with eraseInstance(), identifying it as a non-resident generation script for the 3D model. No #Type E, sd_ prefixes, or _Viewport usage detected."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing an Element with GenBeams in the target zone.",
          "requiredSettings": [
            "SipStyle catalog (used to match or create panel styles)"
          ]
        }
      },
      "tokens_used": 5576,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Standard Properties Dialog",
            "trigger": "Shown on _bOnInsert if _kExecuteKey is empty, or on _bOnMapIO",
            "title": null,
            "dataSource": "Internal Properties (nZone, sStyle, dMerge)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nZone",
            "type": "PropInt",
            "displayName": "Zone",
            "defaultValue": 5,
            "inputType": "dropdown",
            "options": [
              -5,
              -4,
              -3,
              -2,
              -1,
              0,
              1,
              2,
              3,
              4,
              5
            ],
            "category": "General",
            "description": "Defines the Zone to be converted"
          },
          {
            "index": 1,
            "variable": "sStyle",
            "type": "PropString",
            "displayName": "Style",
            "defaultValue": "Auto Selection",
            "inputType": "dropdown",
            "options": [
              "Auto Selection",
              "<Dynamic list from SipStyle catalog>"
            ],
            "category": "General",
            "description": "Defines the Style. If no proper style can be found a default style will be created."
          },
          {
            "index": 2,
            "variable": "dMerge",
            "type": "PropDouble",
            "displayName": "Merging",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": "General",
            "description": "Defines how potential gaps will be mergeed. To catch solid tolerances this value should be set to a value > 0, but it should not be bigger then a potential gap between the defining source entities."
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6352,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Converts a specific construction layer (Zone) defined by GenBeams into a solid CLT or SIP panel, including openings, and removes the original framing members.",
          "category": "Framing/Modeling",
          "typicalUseCase": "Replacing a stick-framed or stud layer with a structural timber panel (CLT/SIP) representation for fabrication or modeling."
        },
        "parameters": [
          {
            "name": "nZone",
            "technicalDefault": "5",
            "businessMeaning": "Selects the specific construction layer (Zone index) within the selected Element to be converted. This determines the elevation, thickness, and set of GenBeams to be replaced.",
            "validRange": "-5 to 5",
            "unit": "Index",
            "affectsOutput": "Determines the geometric boundary of the panel (height/thickness) and which specific GenBeams are deleted and replaced by the panel."
          },
          {
            "name": "sStyle",
            "technicalDefault": "Auto Selection",
            "businessMeaning": "Specifies the SipStyle catalog entry defining the material properties (e.g., layer makeup) of the new panel. 'Auto Selection' attempts to find a style matching the Zone's thickness.",
            "validRange": "List of available SipStyle catalog entries or 'Auto Selection'",
            "unit": "String",
            "affectsOutput": "Controls the material assignment and thickness of the resulting Sip entity. If no style matches, a new style is generated based on the Zone height."
          },
          {
            "name": "dMerge",
            "technicalDefault": "1",
            "businessMeaning": "Tolerance value used to merge the profiles of adjacent GenBeams. It closes small geometric gaps between beams to create a single, contiguous solid panel profile.",
            "validRange": "0.1 to 10",
            "unit": "mm",
            "affectsOutput": "Modifies the outline shape of the panel. Values too low result in panels fragmented by beam gaps; values too high may distort the panel shape by rounding off corners excessively."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "nZone is changed",
            "effect": "When 'sStyle' is set to 'Auto Selection', the script recalculates the required panel thickness based on the new Zone height to find a matching catalog entry.",
            "cascade": [
              "sStyle"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Sip",
            "description": "A solid panel entity (CLT or SIP) generated from the merged outline of the zone, including subtracted openings for windows/doors.",
            "appliedTo": "The coordinate system and element group of the selected Element."
          },
          {
            "type": "GenBeam (Erasure)",
            "description": "The original framing beams that defined the zone are deleted from the model.",
            "appliedTo": "The GenBeams residing in the target zone of the selected Element."
          }
        ]
      },
      "tokens_used": 7217,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched via command or catalog",
          "[Check] Is this a re-insertion (insertCycleCount > 1)?",
          "[Branch: Yes] -> Erase instance and return (Stop)",
          "[Branch: No] -> Continue",
          "[Check] Is _kExecuteKey set (Silent/Command mode)?",
          "[Branch: Yes] -> Load properties from catalog entry matching key",
          "[Branch: No] -> Show Standard Properties Dialog (Zone, Style, Merge)",
          "Prompt user to select Element(s)",
          "Instance created and attached to selected Element(s)",
          "Parent instance erased",
          "[New Instance Start] Retrieve Element reference and Coordinate System",
          "[Check] Is Element reference valid?",
          "[Branch: No] -> Report error, Erase instance (Stop)",
          "[Branch: Yes] -> Determine Zone geometry (height, origin, orientation)",
          "Collect Wall and Roof/Floor Openings into a PlaneProfile",
          "[Check] Style Selection Mode",
          "[Branch: Auto Selection] -> Iterate catalog to find style matching Zone height",
          "[Branch: Specific Style] -> Load specified SipStyle",
          "[Check] Was a valid SipStyle found or created?",
          "[Branch: No (New Style Created)] -> Create new SipStyle based on height, Set execution loops to 2 (Re-trigger script)",
          "[Branch: Yes] -> Continue",
          "Collect GenBeams in the specific Zone",
          "Generate shadow profiles of GenBeams on the Zone plane",
          "Merge profiles using Shrink/Union logic with Merging Tolerance (dMerge)",
          "Subtract Opening profiles from the merged Zone profile",
          "[Check] Does resulting profile have sufficient area?",
          "[Branch: No] -> Skip panel creation",
          "[Branch: Yes] -> Create Sip panels from rings",
          "Assign Sip panels to Element Group and Zone",
          "[Check] Were panels created successfully?",
          "[Branch: Yes] -> Erase original GenBeams in the zone",
          "[Check] Debug mode active?",
          "[Branch: No] -> Erase script instance (Non-resident)",
          "[Branch: Yes] -> Visualize bodies and keep instance"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase Instance",
                "Exit"
              ]
            },
            "path2": {
              "name": "Cycle = 1",
              "steps": [
                "Process Properties",
                "Prompt for Element",
                "Generate Sip"
              ]
            }
          },
          {
            "condition": "Execution Key / Catalog Usage",
            "path1": {
              "name": "_kExecuteKey present",
              "steps": [
                "Load props from _kExecuteKey",
                "Skip Dialog"
              ]
            },
            "path2": {
              "name": "Standard Insert",
              "steps": [
                "Show Dialog",
                "Wait for User OK"
              ]
            }
          },
          {
            "condition": "Style Match Result",
            "path1": {
              "name": "Match Found / Specified Valid",
              "steps": [
                "Use existing SipStyle",
                "Proceed to Geometry"
              ]
            },
            "path2": {
              "name": "No Match Found",
              "steps": [
                "Create new SipStyle named by height",
                "SetExecutionLoops(2)",
                "Restart Instance to load new style"
              ]
            }
          },
          {
            "condition": "Panel Creation Success",
            "path1": {
              "name": "Sip Created",
              "steps": [
                "Assign to Element Group",
                "Add Openings",
                "Erase Source GenBeams"
              ]
            },
            "path2": {
              "name": "No Sip Created (Area too small/Error)",
              "steps": [
                "Retain Source GenBeams",
                "Erase Instance"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Reference Attached",
            "errorMessage": "Element reference not found.",
            "recovery": "User must ensure an Element is selected during insertion."
          },
          {
            "check": "SipStyle Creation",
            "errorMessage": "Could not create SipStyle with name: [Height].",
            "recovery": "Script erases instance if debug is off. User may need to check catalog write permissions or style names."
          },
          {
            "check": "Profile Area",
            "errorMessage": "(Implicit) Area < dEps^2",
            "recovery": "Script skips panel creation for this specific area loop but continues checking other rings."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Parameters",
            "how": "OPM (Object Properties Manager)",
            "effect": "Since the script is non-resident (erases itself), parameter changes via OPM are not possible after execution. Re-running the script is required to change Zone, Style, or Merge values."
          },
          {
            "action": "Modify Geometry",
            "how": "Direct CAD editing / Grips",
            "effect": "The resulting Sip panels and Erased GenBeams are native entities. They can be edited manually or updated by other scripts."
          }
        ]
      },
      "tokens_used": 6996,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-ZoneCreator.mcr\n\n## Overview\nConverts a specific construction layer (Zone) defined by beams into a solid CLT or SIP panel. It automatically calculates the panel shape, subtracts openings, and replaces the original beams.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D construction elements. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Not a detailing script. |\n\n## Prerequisites\n- **Required entities**: An `Element` containing `GenBeams` defining the target zone.\n- **Minimum beam count**: 0 (The script validates profiles dynamically).\n- **Required settings**: Access to a `SipStyle` catalog to define material layers.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCLT-ZoneCreator.mcr`\n\n### Step 2: Configure Properties\n```\nDialog: Properties Palette\nAction: Configure the following settings before clicking OK:\n- Zone: Select the index of the layer to convert (e.g., 5 for the outermost layer).\n- Style: Choose \"Auto Selection\" to match the thickness, or pick a specific SipStyle.\n- Merging: Set a tolerance value to merge gaps between beams (Default is 1).\n```\n\n### Step 3: Select Element\n```\nCommand Line: Select elements\nAction: Click on the Element in the model that contains the beams you wish to convert.\n```\n\n### Step 4: Completion\nThe script processes the geometry, generates the new panel(s), deletes the original beams in the specified zone, and then removes itself from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Zone | Dropdown | 5 | Defines the specific construction layer (Zone index) to be converted. Range is -5 to 5. |\n| Style | Dropdown | Auto Selection | Defines the panel style. If \"Auto Selection\" is used, the script attempts to find a style matching the Zone's thickness; otherwise, it creates a new one. |\n| Merging | Number | 1 | Defines the tolerance to merge gaps between beams. Set > 0 to catch solid tolerances, but smaller than actual structural gaps. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| N/A | This is a non-resident script. It erases itself after execution and does not provide persistent context menu options. |\n\n## Settings Files\n- **Filename**: `SipStyle` Catalog entries\n- **Location**: hsbCAD Company/Install path\n- **Purpose**: Provides material definitions and layer makeups for the generated panels.\n\n## Tips\n- **Merging Tolerance**: If the resulting panel looks fragmented or has small slivers, try increasing the **Merging** value. If corners are being incorrectly cut off or rounded, decrease it.\n- **Undo Function**: Since the script erases itself after running, use the AutoCAD `Undo` command to revert changes if the result is not as expected.\n- **Style Management**: If the script creates a new style automatically, it will be named based on the height (e.g., \"200\"). Check your catalog if you wish to edit material properties later.\n\n## FAQ\n\n- **Q: Can I change the settings after I run the script?**\n  **A**: No. This script is non-resident; it erases itself immediately after generating the panel. To change parameters, use Undo (Ctrl+Z) and re-insert the script.\n\n- **Q: What happens to the original beams in the zone?**\n  **A**: The script automatically deletes the `GenBeams` that were located in the target zone and replaces them with the solid `Sip` panel.\n\n- **Q: Why did the script fail to create a panel?**\n  **A**: Ensure the selected Element actually contains beams in the specified Zone. Also, check that the resulting profile area is large enough to generate a valid solid."
      },
      "tokens_used": 5548,
      "error": null
    }
  }
}