{
  "filename": "HSB_W-DistributeHorizontalSheeting.mcr",
  "status": "completed",
  "total_tokens": 48132,
  "processing_time": 270.40230441093445,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 8170,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly creates instances in `_kModelSpace` via `tslNew.dbCreate(..., _kModelSpace, mapTsl);`. It manipulates 3D construction entities like `ElementWallSF`, `ElemZone`, and `Sheet`. The filename prefix `HSB_W-` indicates a Wall (Model) script, distinct from `sd_` (ShopDrawing) scripts. There is no usage of `_kPaperSpace`, `_Viewport`, or 2D drawing generation logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF",
            "HSB_G-DistributionPoint (TSLInst)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": [
            "Zone distribution property must be set to 'Horizontal Lap Siding'",
            "A valid TSL instance of 'HSB_G-DistributionPoint' must exist in the Floor Group with a matching distribution number"
          ]
        }
      },
      "tokens_used": 5731,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && (_kExecuteKey == \"\" || catalogNames.find(_kExecuteKey) == -1)",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity.go",
              "promptOriginal": "Select elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert (if no execute key is provided)",
            "title": null,
            "dataSource": "Script Properties (OPM)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 3,
            "variable": "sequenceNumber",
            "type": "PropInt",
            "displayName": "|Sequence number|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|The sequence number is used to sort the list of tsl's during generate construction|"
          },
          {
            "index": 0,
            "variable": "distributionNumber",
            "type": "PropInt",
            "displayName": "|Distribution number|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": null
          },
          {
            "index": 2,
            "variable": "propZoneIndex",
            "type": "PropInt",
            "displayName": "|Zone index|",
            "defaultValue": "2",
            "inputType": "number",
            "options": [
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10
            ],
            "category": "|Distribution|",
            "description": null
          },
          {
            "index": 0,
            "variable": "propMaximumSheetLength",
            "type": "PropDouble",
            "displayName": "|Maximum sheet length|",
            "defaultValue": "6000",
            "inputType": "number",
            "options": [],
            "category": "|Sheeting dimensions|",
            "description": "|Sets the maximum length of the sheet.|"
          },
          {
            "index": 1,
            "variable": "propSheetWidth",
            "type": "PropDouble",
            "displayName": "|Sheet width|",
            "defaultValue": "240",
            "inputType": "number",
            "options": [],
            "category": "|Sheeting dimensions|",
            "description": "|Sets the width of the sheet.|"
          },
          {
            "index": 4,
            "variable": "propSheetThickness",
            "type": "PropDouble",
            "displayName": "|Sheet thickness|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Sheeting dimensions|",
            "description": "|Sets the thickness of the sheet.||The thickness of the zone is used if this value is set to 0|"
          },
          {
            "index": 2,
            "variable": "propGapX",
            "type": "PropDouble",
            "displayName": "|Gap in length direction|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Sheeting dimensions|",
            "description": null
          },
          {
            "index": 3,
            "variable": "propGapY",
            "type": "PropDouble",
            "displayName": "|Gap in width direction|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Sheeting dimensions|",
            "description": null
          },
          {
            "index": 1,
            "variable": "propSheetColor",
            "type": "PropInt",
            "displayName": "|Sheet color|",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": "|Sheeting properties|",
            "description": null
          },
          {
            "index": 0,
            "variable": "propSheetMaterial",
            "type": "PropString",
            "displayName": "|Sheet material|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Sheeting properties|",
            "description": null
          },
          {
            "index": 1,
            "variable": "beamCodeFirstSheetAboveDistributionPoint",
            "type": "PropString",
            "displayName": "|Beam code first sheet above distribution point|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Sheeting properties|",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7096,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates horizontal sheeting or siding boards on a wall element, starting from a specified distribution point.",
          "category": "Model Generation / Cladding",
          "typicalUseCase": "Applying exterior horizontal lap siding or sheathing to a timber frame wall, ensuring boards are distributed correctly relative to a reference height (distribution point) and fit within wall openings."
        },
        "parameters": [
          {
            "name": "sequenceNumber",
            "technicalDefault": "0",
            "businessMeaning": "Defines the execution order of this script relative to other TSLs during the 'Generate Construction' process.",
            "validRange": "0-1000",
            "unit": "Integer",
            "affectsOutput": "Process order (does not change geometry directly, but affects dependencies if scripts build on top of this sheeting)."
          },
          {
            "name": "distributionNumber",
            "technicalDefault": "0",
            "businessMeaning": "The ID of the 'HSB_G-DistributionPoint' instance to use as the origin (start point) for the sheeting layout.",
            "validRange": "Any positive Integer",
            "unit": "Count",
            "affectsOutput": "Determines the X/Y start position of the first row of boards. If the point is not found, the script fails."
          },
          {
            "name": "propZoneIndex",
            "technicalDefault": "2",
            "businessMeaning": "The specific construction layer (Zone) of the wall to which the sheeting is assigned and geometrically aligned.",
            "validRange": "1-10",
            "unit": "Index",
            "affectsOutput": "Aligns sheeting to the coordinate system of the chosen zone and assigns the generated sheets to that zone in the BOM."
          },
          {
            "name": "propMaximumSheetLength",
            "technicalDefault": "6000",
            "businessMeaning": "The maximum cut length of a single board before it must be jointed or overlapped by the next board in the row.",
            "validRange": "1000 - 18000",
            "unit": "mm",
            "affectsOutput": "Determines how often boards are butted in the horizontal direction. Affects the number of individual sheet entities created."
          },
          {
            "name": "propSheetWidth",
            "technicalDefault": "240",
            "businessMeaning": "The exposed face width (vertical height) of the individual sheeting board.",
            "validRange": "50 - 600",
            "unit": "mm",
            "affectsOutput": "Determines the vertical spacing between rows of sheeting."
          },
          {
            "name": "propSheetThickness",
            "technicalDefault": "0",
            "businessMeaning": "The physical thickness of the sheeting material.",
            "validRange": "0 - 300 (0 = Use Zone Thickness)",
            "unit": "mm",
            "affectsOutput": "The 3D depth of the generated Sheet entities. If 0, it defaults to the thickness defined in the Zone properties."
          },
          {
            "name": "propGapX",
            "technicalDefault": "0",
            "businessMeaning": "The horizontal expansion gap or joint spacing between the ends of boards.",
            "validRange": "0 - 20",
            "unit": "mm",
            "affectsOutput": "Creates a small space between the end of one board and the start of the next in the horizontal direction."
          },
          {
            "name": "propGapY",
            "technicalDefault": "0",
            "businessMeaning": "The vertical expansion gap or overlap between rows of boards.",
            "validRange": "0 - 50",
            "unit": "mm",
            "affectsOutput": "Adjusts the vertical spacing step. Added to the Sheet Width to determine the start height of the next row."
          },
          {
            "name": "propSheetColor",
            "technicalDefault": "1",
            "businessMeaning": "The CAD display color used to visualize the sheeting in the model.",
            "validRange": "0-255 (0 = Use Zone Color)",
            "unit": "Index",
            "affectsOutput": "Visual representation in 3D model views."
          },
          {
            "name": "propSheetMaterial",
            "technicalDefault": "",
            "businessMeaning": "The material name assigned to the sheeting for reports, bills of materials, and machining.",
            "validRange": "String (Empty = Use Zone Material)",
            "unit": "Text",
            "affectsOutput": "Data attribute on the Sheet entity."
          },
          {
            "name": "beamCodeFirstSheetAboveDistributionPoint",
            "technicalDefault": "",
            "businessMeaning": "A specific identifier or code assigned to the first row of sheeting located physically above the distribution point.",
            "validRange": "Text String",
            "unit": "Text",
            "affectsOutput": "Assigns the 'BeamCode' property to the specific Sheet entities in the first row above the start point, useful for labeling or special handling."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "propSheetWidth is set to 0",
            "effect": "The script calculates width and gap based on Zone Variables ('Height' and 'Spacing'). propGapY is ignored.",
            "cascade": [
              "propSheetWidth",
              "propGapY"
            ]
          },
          {
            "trigger": "propSheetThickness is set to 0",
            "effect": "The script uses the thickness defined in the Element Zone properties.",
            "cascade": [
              "propSheetThickness"
            ]
          },
          {
            "trigger": "propMaximumSheetLength is set to 0",
            "effect": "The script looks for a Zone Variable 'Max. Length' or defaults to the wall length.",
            "cascade": [
              "propMaximumSheetLength"
            ]
          },
          {
            "trigger": "propSheetMaterial is empty",
            "effect": "The script uses the material defined in the Element Zone properties.",
            "cascade": [
              "propSheetMaterial"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Sheet",
            "description": "Rectangular sheets representing horizontal siding or cladding, trimmed to fit the wall profile and openings.",
            "appliedTo": "ElementWallSF (Targeted Wall Element)"
          }
        ]
      },
      "tokens_used": 9209,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script: User executes HSB_W-DistributeHorizontalSheeting.mcr.",
          "2. Insert Cycle Check: If insertCycleCount > 1, script erases self to prevent duplicates.",
          "3. Property Initialization: Check for ExecuteKey. If present, load catalog; else, show Properties Dialog.",
          "4. User Selection: Prompt user to select target Wall Elements (ElementWallSF).",
          "5. Instance Creation: Loop through selected elements and create a new TSL instance attached to each in ModelSpace.",
          "6. Erase Cursor: The original insert script instance is erased.",
          "7. Instance Execution: The attached instance runs (triggers: OnElementConstructed, Recalc, etc.).",
          "8. Element Validation: Verify the host element is valid. If not, warn and erase.",
          "9. Zone Configuration: Determine target Zone index. Fetch Zone settings (Distribution type, Material, Thickness).",
          "10. Distribution Point Lookup: Search the Floor Group for a TSL instance named 'HSB_G-DistributionPoint' matching the 'Distribution number' property.",
          "11. Dependency Linking: Establish dependency on the found Distribution Point.",
          "12. Grid Calculation: Calculate the start distribution point based on the bounding box of the wall and the location of the Distribution Point.",
          "13. Cleanup: Erase all existing sheets assigned to the target zone (excluding material 'Musband').",
          "14. Generation Loop: Iterate vertically (Rows) and horizontally (Columns) to create sheet profiles.",
          "15. Intersection & Creation: Check if sheet profile intersects the wall profile. If yes and area > tolerance, create Sheet entity.",
          "16. Attribute Assignment: Apply material, color, and specific BeamCode (if first row above distribution point).",
          "17. Completion: Instance erases self, leaving only the generated Sheets."
        ],
        "conditionalBranches": [
          {
            "condition": "Execute Key provided on insert",
            "path1": {
              "name": "Catalog Mode",
              "steps": [
                "Load properties from specified catalog",
                "Skip Properties Dialog"
              ]
            },
            "path2": {
              "name": "Manual Mode",
              "steps": [
                "ShowDynamicDialog for user input",
                "Prompt for entity selection"
              ]
            }
          },
          {
            "condition": "Zone Distribution Type check",
            "path1": {
              "name": "Valid Zone",
              "steps": [
                "Continue generation logic"
              ]
            },
            "path2": {
              "name": "Invalid Zone",
              "steps": [
                "Report Warning: 'The distribution of selected zone is not set to horizontal lap siding'",
                "Erase Instance"
              ]
            }
          },
          {
            "condition": "Distribution Point Found",
            "path1": {
              "name": "Found",
              "steps": [
                "Calculate grid start relative to point",
                "Set dependency"
              ]
            },
            "path2": {
              "name": "Not Found",
              "steps": [
                "Report Warning: 'Distribution point with number X cannot be found!'",
                "Erase Instance"
              ]
            }
          },
          {
            "condition": "Property Fallback (Width/Thickness/Material)",
            "path1": {
              "name": "Script Property Defined (> 0 or not empty)",
              "steps": [
                "Use value from Script Property"
              ]
            },
            "path2": {
              "name": "Script Property Empty/Zero",
              "steps": [
                "Use value from Element Zone properties or Zone Variables"
              ]
            }
          },
          {
            "condition": "Sheet Position Relative to Wall Boundary",
            "path1": {
              "name": "Within Bounds",
              "steps": [
                "Calculate intersection with wall profile",
                "Create Sheet if area valid"
              ]
            },
            "path2": {
              "name": "Outside Bounds",
              "steps": [
                "If X-direction: Stop current row and move to next Y-row",
                "If Y-direction: Stop generation completely"
              ]
            }
          },
          {
            "condition": "First Sheet Above Distribution Point",
            "path1": {
              "name": "Matches Criteria",
              "steps": [
                "Assign 'Beam code first sheet above distribution point' to Sheet"
              ]
            },
            "path2": {
              "name": "Does not Match",
              "steps": [
                "Assign default BeamCode"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Host Element Validity",
            "errorMessage": "The selected element is not a valid element. The distribution is not added!",
            "recovery": "Ensure a valid ElementWallSF is selected."
          },
          {
            "check": "Zone Distribution Setting",
            "errorMessage": "[Element Number] The distribution of selected zone is not set to horizontal lap siding",
            "recovery": "Edit Element Zone properties, set 'Distribution' to 'Horizontal Lap Siding'."
          },
          {
            "check": "Distribution Point Existence",
            "errorMessage": "[Element Number] Distribution point with number [X] cannot be found!",
            "recovery": "Insert 'HSB_G-DistributionPoint' TSL in the same Floor Group with matching distribution number."
          },
          {
            "check": "Zone Vertex Validity",
            "errorMessage": "[Element Number] Zone vertices are not valid!",
            "recovery": "Check wall geometry for errors or degenerate profiles."
          },
          {
            "check": "Sheet Dimensions",
            "errorMessage": "[Element Number] Invalid sheet sizes!",
            "recovery": "Ensure Maximum Length, Width, and Thickness are > 0."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions",
            "how": "OPM (Object Properties)",
            "effect": "Updates sheet width, length, gaps, or thickness. Triggers regeneration of sheets."
          },
          {
            "action": "Change Reference Point",
            "how": "Move 'HSB_G-DistributionPoint' instance",
            "effect": "Updates start position of the sheeting grid based on new point location."
          },
          {
            "action": "Change Material/Color",
            "how": "OPM",
            "effect": "Updates attributes of generated sheets."
          },
          {
            "action": "Regenerate",
            "how": "Right-click Recalc or Change Wall Geometry",
            "effect": "Script runs logic again: deletes old sheets (except 'Musband'), recalculates based on current wall profile, and creates new sheets."
          }
        ]
      },
      "tokens_used": 10737,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_W-DistributeHorizontalSheeting.mcr\n\n## Overview\nThis script automatically generates horizontal sheeting or siding boards on wall elements. It calculates the layout based on a specified distribution point, ensuring boards fit the wall profile and around openings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model environment to generate construction entities. |\n| Paper Space | No | Not applicable for 2D drawing generation. |\n| Shop Drawing | No | This is a model generation script, not a detailing script. |\n\n## Prerequisites\n- **Required Entities**: Wall elements (`ElementWallSF`).\n- **Required Context**: A valid TSL instance named `HSB_G-DistributionPoint` must exist in the same Floor Group.\n- **Required Settings**: The target Zone on the wall must have its \"Distribution\" property set to \"Horizontal Lap Siding\".\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_W-DistributeHorizontalSheeting.mcr`\n\n### Step 2: Configure Properties\n```\nCommand Line: None (Dialog Box)\nAction: The \"Properties\" dialog appears automatically (if not run from a catalog).\n       - Set the 'Distribution number' to match your Distribution Point instance.\n       - Set 'Zone index' to the wall layer you want to sheet.\n       - Adjust sheet dimensions (Width, Length, Thickness).\n       - Click OK to proceed.\n```\n\n### Step 3: Select Elements\n```\nCommand Line: Select elements\nAction: Click on the Wall Element(s) you wish to apply the sheeting to.\n       Press Enter to confirm selection.\n```\n\n### Step 4: Generation\n```\nAction: The script attaches to the wall and generates the sheets.\n       If the Distribution Point is found, the sheets are aligned starting from that reference height.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Sequence number | number | 0 | Determines the execution order of this script during \"Generate Construction\". |\n| Distribution number | number | 0 | The ID of the `HSB_G-DistributionPoint` to use as the start reference. |\n| Zone index | number | 2 | The specific construction layer (Zone) of the wall to receive the sheeting. |\n| Maximum sheet length | number | 6000 | The maximum length of a single board before it is jointed (in mm). |\n| Sheet width | number | 240 | The exposed face width of the sheeting board (in mm). |\n| Sheet thickness | number | 0 | Thickness of the material. Set to 0 to use the Zone's default thickness. |\n| Gap in length direction | number | 0 | Horizontal gap between the ends of boards (in mm). |\n| Gap in width direction | number | 0 | Vertical gap or overlap between rows of boards (in mm). |\n| Sheet color | number | 1 | The display color index for the generated sheets. |\n| Sheet material | text | [Empty] | Material name for reports/BOM. Leave empty to use Zone material. |\n| Beam code first sheet above distribution point | text | [Empty] | A specific identifier assigned to the first row of sheets above the distribution point. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the sheeting layout if the wall geometry or properties change. |\n| Erase | Removes the script instance and the associated generated sheets. |\n\n## Settings Files\n- **Filename**: None specific.\n- **Location**: N/A\n- **Purpose**: This script relies primarily on Element Zone settings and the `HSB_G-DistributionPoint` instance rather than external settings files.\n\n## Tips\n- **Reference Height**: To change where the sheeting starts vertically, move the `HSB_G-DistributionPoint` entity in the model rather than editing script properties.\n- **Zone Configuration**: Ensure the Zone properties (Material, Thickness) are correctly set on the wall before running this script, especially if you set script dimensions to 0 to inherit values.\n- **Openings**: The script automatically trims sheets around wall openings.\n\n## FAQ\n- **Q: I get an error \"Distribution point with number X cannot be found!\".**\n  A: Ensure you have inserted the `HSB_G-DistributionPoint` TSL into the same Floor Group and that its \"Number\" property matches the \"Distribution number\" in this script.\n- **Q: The script warns \"The distribution of selected zone is not set to horizontal lap siding\".**\n  A: Select the wall, go to Properties, find the Zone specified by \"Zone index\", and change the \"Distribution\" setting to \"Horizontal Lap Siding\".\n- **Q: How do I create a reveal (shadow gap) between rows?**\n  A: Set the \"Gap in width direction\" property to your desired reveal size.\n- **Q: Can I change the sheet material later?**\n  A: Yes, select the generated sheeting or the script instance in the model and update the \"Sheet material\" property in the Properties Palette, then Recalculate."
      },
      "tokens_used": 7189,
      "error": null
    }
  }
}