{
  "filename": "hsbShopdrawingReview.mcr",
  "status": "completed",
  "total_tokens": 18021,
  "processing_time": 193.98354196548462,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3508,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script instantiates a `PrEntity` prompt for `Element` selection and explicitly uses `collectEntities` with the filter `_kModelSpace`. It constructs a `ModelMap` from 3D entities to pass to an external DLL. There is no usage of ShopDrawing API (`sd_*`), `#Type E`, or Viewport handling."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "ModelSpace containing Elements",
          "requiredSettings": [
            "External DLL: hsbMakeLiteConnector.dll located in hsbCAD Utilities folder"
          ]
        }
      },
      "tokens_used": 1421,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select elements to be exported|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3060,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Sends selected 3D manufacturing data (Elements and sub-entities) to an external .NET assembly to perform a 'ShopdrawingReview', likely for data validation, BIM integration, or report generation within the 'hsbMakeLite' ecosystem.",
          "category": "Data Exchange / Integration",
          "typicalUseCase": "Used when a user needs to validate the manufacturing data of specific elements against external databases or generate review reports via the hsbMakeLite connector before production."
        },
        "parameters": [
          {
            "name": "ssE",
            "technicalDefault": "User selection via prompt",
            "businessMeaning": "The specific set of Elements (walls, roofs, floors) to be included in the review process. This defines the scope of the data being sent to the external review tool.",
            "validRange": "1 or more hsbCAD Elements",
            "unit": "Selection Set",
            "affectsOutput": "Determines which 3D geometry, machining, and construction tools are passed to the external DLL. No elements selected results in script termination."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "External Data Call",
            "description": "Invokes a method in 'hsbMakeLiteConnector.dll' named 'ShopdrawingReview' passing a ModelMap containing geometry, tools, and hardware info.",
            "appliedTo": "N/A (The script acts as a data transmitter, it does not create geometric entities itself)"
          }
        ]
      },
      "tokens_used": 2027,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script instance is created and initialized (_bOnInsert flag is true)",
          "Prompt user to select Elements (PrEntity) for export",
          "Check if user completed the selection",
          "Extract selected elements from selection set",
          "Iterate through each selected Element",
          "Validate if the Element is valid",
          "If valid, retrieve Element Group and collect all sub-entities from ModelSpace",
          "Aggregate all collected entities into a single array",
          "Configure ModelMap settings to include Solids, Tools (Analysed, Element, Construction), Hardware, and Roof Planes",
          "Compose the ModelMap with the aggregated entities",
          "Construct path to external DLL (hsbMakeLiteConnector.dll)",
          "Call .NET function 'ShopdrawingReview' passing the ModelMap data",
          "Erase the script instance from the drawing",
          "Exit execution"
        ],
        "conditionalBranches": [
          {
            "condition": "User input at PrEntity prompt (ssE.go())",
            "path1": {
              "name": "Cancel/Empty Selection",
              "steps": [
                "Execute eraseInstance()",
                "Return immediately (script terminates without processing)"
              ]
            },
            "path2": {
              "name": "Valid Selection",
              "steps": [
                "Proceed to entity collection loop",
                "Generate ModelMap",
                "Execute external call"
              ]
            }
          },
          {
            "condition": "Element validity within processing loop (el.bIsValid())",
            "path1": {
              "name": "Invalid Element",
              "steps": [
                "Execute continue command",
                "Skip to next element in array"
              ]
            },
            "path2": {
              "name": "Valid Element",
              "steps": [
                "Retrieve element group",
                "Collect sub-entities via grp.collectEntities",
                "Append sub-entities to master list"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "User confirms PrEntity selection (not cancelling)",
            "errorMessage": "None (silent termination)",
            "recovery": "User must re-run the script and make a selection"
          },
          {
            "check": "Entity is a valid hsbCAD Element",
            "errorMessage": "None (silent skip)",
            "recovery": "Script ignores invalid entries automatically; no user action required"
          }
        ],
        "postInsertionActions": [
          {
            "action": "None (Script is transient)",
            "how": "N/A",
            "effect": "The script calls eraseInstance() at the end of the insertion block, removing all traces of the script from the drawing immediately after the external function call completes."
          }
        ]
      },
      "tokens_used": 4179,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbShopdrawingReview.mcr\n\n## Overview\nThis script exports selected 3D Elements and their associated manufacturing data (geometry, tools, and hardware) to the external hsbMakeLite system. It is used to validate data or generate review reports without modifying the CAD drawing itself.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Elements must be selected from the 3D model. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities:** hsbCAD Elements (Walls, Roofs, or Floors) present in the Model Space.\n- **Minimum Count:** At least one Element must be selected for the function to execute.\n- **Required Settings:** The external file `hsbMakeLiteConnector.dll` must be located in your hsbCAD Utilities folder.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Select `hsbShopdrawingReview.mcr` from the file dialog.\n\n### Step 2: Select Elements\n```\nCommand Line: Select elements to be exported\nAction: Click on the desired Elements (Walls/Roofs) in the 3D model to include them in the review.\n```\n3. Press **Enter** to confirm your selection.\n   - *Note:* The script will automatically process the data, send it to the external tool, and then delete itself from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| N/A | N/A | N/A | This script has no editable properties in the Properties Panel. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| N/A | This script has no custom right-click menu options. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on the external DLL `hsbMakeLiteConnector.dll` rather than internal XML settings files.\n\n## Tips\n- **Transient Behavior:** This script is designed to run once and then remove itself from the drawing. Do not be alarmed if it disappears immediately after running; this is normal behavior.\n- **Selection Scope:** You can select multiple elements at once. The script will aggregate all data from the selected elements before sending the review package.\n- **Validation:** If the external review window does not appear, ensure that `hsbMakeLiteConnector.dll` is correctly installed and that no firewall rules are blocking the connection.\n\n## FAQ\n- **Q: I ran the script, but nothing happened in AutoCAD. Did it fail?**\n  - A: Not necessarily. The script sends data to an external application (hsbMakeLite). Check your taskbar or desktop for a popup window from that application.\n- **Q: Can I run this on a single beam?**\n  - A: No, this script is designed to process entire hsbCAD Elements (which contain beams), not individual GenBeams.\n- **Q: Why did the script erase itself?**\n  - A: The script acts as a \"command\" rather than a permanent object. It cleans up after itself to keep your drawing database clean."
      },
      "tokens_used": 3826,
      "error": null
    }
  }
}