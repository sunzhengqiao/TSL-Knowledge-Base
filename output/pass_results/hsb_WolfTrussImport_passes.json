{
  "filename": "hsb_WolfTrussImport.mcr",
  "status": "completed",
  "total_tokens": 20071,
  "processing_time": 159.22661590576172,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 2282,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses ModelMap.dbInterpretMap to generate geometry and calls eraseInstance(). No sd_* prefixes, no _Viewport handling, and no #Type E / _Entity[] arrays associated with ShopDrawing generation."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbCloudStorage\\hsbSteicoIO.dll"
          ]
        }
      },
      "tokens_used": 2422,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 1,
            "variable": "pTrussGroupName",
            "type": "PropString",
            "displayName": "Truss Group Name",
            "defaultValue": "Trusses\\Ground_Floor",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "pBeamGroupName",
            "type": "PropString",
            "displayName": "Beam Group Name",
            "defaultValue": "Beams\\Ground_Floor",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "pTrussFilter",
            "type": "PropString",
            "displayName": "Truss Name Filter",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "hsbSteicoIO.dll",
            "searchPaths": [
              "_kPathHsbInstall\\Utilities\\hsbCloudStorage"
            ],
            "purpose": "Contains the ImportWolfIFC function used to fetch truss data.",
            "required": true
          }
        ]
      },
      "tokens_used": 2274,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Imports roof truss geometry and data from an external Wolf (IFC) source into the hsbCAD model, organizing them into specific groups.",
          "category": "Import/Framing",
          "typicalUseCase": "A designer needs to bring in pre-engineered roof truss layouts from a third-party supplier (Wolf) into the detailed timber model to ensure accurate geometry and scheduling."
        },
        "parameters": [
          {
            "name": "pTrussGroupName",
            "technicalDefault": "Trusses\\Ground_Floor",
            "businessMeaning": "Defines the destination group name within the CAD project structure where the imported truss assemblies (usually GenBeams or Elements representing the whole truss) will be stored.",
            "validRange": "Any valid hsbCAD group path string (e.g., 'Roof\\Trusses', 'Level1\\Roof')",
            "unit": "string",
            "affectsOutput": "Organization and visibility of the imported truss objects in the project tree and lists. Incorrect paths may result in lost elements or cluttered structures."
          },
          {
            "name": "pBeamGroupName",
            "technicalDefault": "Beams\\Ground_Floor",
            "businessMeaning": "Defines the destination group name where the individual timber beams (top chords, bottom chords, webs) comprising the trusses will be stored if they are imported as separate entities.",
            "validRange": "Any valid hsbCAD group path string (e.g., 'Roof\\Members', 'Structural\\Timber')",
            "unit": "string",
            "affectsOutput": "Organization of the individual timber components. Separating trusses from beams allows for independent reporting and layer management."
          },
          {
            "name": "pTrussFilter",
            "technicalDefault": "",
            "businessMeaning": "Acts as a search filter to selectively import only specific trusses from the source file based on their names (e.g., importing only 'Attic' trusses while ignoring 'Standard' ones).",
            "validRange": "String value matching part or all of truss names in the source (empty string implies import all)",
            "unit": "string",
            "affectsOutput": "Filters the list of generated geometry. Only trusses matching the filter criteria are created in the model."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "pTrussGroupName is modified",
            "effect": "Changes the insertion path for truss assembly elements.",
            "cascade": []
          },
          {
            "trigger": "pBeamGroupName is modified",
            "effect": "Changes the insertion path for individual beam elements.",
            "cascade": []
          },
          {
            "trigger": "pTrussFilter is set",
            "effect": "Reduces the number of entities created by filtering the import list.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam/Element",
            "description": "The physical timber members (chords and webs) representing the trusses.",
            "appliedTo": "Groups defined by pBeamGroupName and pTrussGroupName."
          },
          {
            "type": "ModelMap Data",
            "description": "Geometric mapping data used to interpret the external IFC data into native hsbCAD entities.",
            "appliedTo": "Model Space."
          }
        ]
      },
      "tokens_used": 2934,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script initializes properties (pTrussGroupName, pBeamGroupName, pTrussFilter) from catalog or defaults.",
          "System checks if the script is in Insertion mode (_bOnInsert).",
          "[Insertion Mode] If no Execute Key is present, show property dialog to user.",
          "[Insertion Mode] Define path to external assembly hsbSteicoIO.dll.",
          "[Insertion Mode] Populate input Map with property values and fixed parameters (e.g., 'Nailplate' format).",
          "[Insertion Mode] Execute ImportWolfIFC function via callDotNetFunction2.",
          "[Insertion Mode] Store the returned Map data in the local ModelMap variable (mm).",
          "[Recalculation Mode] Retrieve stored map data from the script instance's internal storage (_Map) into the ModelMap variable (mm).",
          "Configure ModelMapInterpretSettings: enable resolveEntitiesByHandle and resolveElementsByNumber.",
          "Execute dbInterpretMap to generate or update geometry based on the map data.",
          "Execute eraseInstance() to delete the script entity from the drawing."
        ],
        "conditionalBranches": [
          {
            "condition": "Is the script being inserted for the first time (_bOnInsert == true)?",
            "path1": {
              "name": "Initial Import Path",
              "steps": [
                "Check for Execute Key (if empty, show UI).",
                "Construct input parameters.",
                "Call external .NET function (ImportWolfIFC) to fetch data.",
                "Store result in ModelMap."
              ]
            },
            "path2": {
              "name": "Recalculation Path",
              "steps": [
                "Retrieve internal Map (_Map) storage.",
                "Proceed directly to interpretation."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Presence of hsbSteicoIO.dll",
            "errorMessage": "Script failure during callDotNetFunction2 if the DLL is missing at the specified relative path.",
            "recovery": "Verify hsbCAD installation includes the Utilities\\hsbCloudStorage module."
          },
          {
            "check": "Valid Group Paths (pTrussGroupName, pBeamGroupName)",
            "errorMessage": "dbInterpretMap may fail to generate entities if target groups do not exist in the project structure.",
            "recovery": "Ensure the specified group paths exist in the drawing or correct the properties before insertion."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Script Self-Deletion",
            "how": "Automatic (Function call to eraseInstance())",
            "effect": "The script instance is removed immediately after execution. The resulting trusses/elements become native CAD entities. The script cannot be edited via grips or properties after insertion because it no longer exists."
          }
        ]
      },
      "tokens_used": 5145,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_WolfTrussImport.mcr\n\n## Overview\nThis script imports roof truss geometry and data from an external Wolf (IFC) source directly into your hsbCAD model. It automatically organizes the imported trusses and their individual timber components into specified project groups.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in Model Space to generate geometry. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | This is a modeling tool, not a detailing script. |\n\n## Prerequisites\n- **Required Settings**: The file `hsbSteicoIO.dll` must be present in your hsbCAD installation directory (`Utilities\\hsbCloudStorage`).\n- **Project Structure**: It is recommended (though not strictly enforced) to have the target Group Names (e.g., \"Trusses\") created in your project tree beforehand to ensure organization.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the AutoCAD command line.\n2. Select `hsb_WolfTrussImport.mcr` from the file dialog.\n3. Click in the Model Space to insert the script instance (location does not affect the import, but insertion is required to activate).\n\n### Step 2: Configure Properties\nImmediately after insertion, the script is active. Before the geometry generates, configure the import settings in the **Properties Palette** (usually on the right side of the screen).\n\n| Parameter | Action |\n|-----------|--------|\n| **Truss Group Name** | Enter the group path where the main truss assemblies should be stored (e.g., `1st Floor\\Roof\\Trusses`). |\n| **Beam Group Name** | Enter the group path for individual beams/chords (e.g., `1st Floor\\Roof\\Timber`). |\n| **Truss Name Filter** | (Optional) Enter a text string to filter specific trusses from the source file. Leave blank to import all trusses. |\n\n### Step 3: Execute Import\n1. Once properties are set, the script will attempt to execute the import logic automatically.\n2. If a file dialog or external prompt appears (from the Steico IO plugin), select the appropriate Wolf/IFC source file.\n3. The script will generate the geometry and then **automatically delete itself** from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Truss Group Name | Text | `Trusses\\Ground_Floor` | Determines the destination group in the project tree for the imported truss assemblies. |\n| Beam Group Name | Text | `Beams\\Ground_Floor` | Determines the destination group for the individual timber members (chords/webs) if they are imported as separate entities. |\n| Truss Name Filter | Text | ` (Empty)` | allows you to import only specific trusses. Enter a name or partial name to filter the list (e.g., \"Attic\" to import only attic trusses). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not use persistent right-click menu options, as the script instance deletes itself immediately after generating the trusses. |\n\n## Settings Files\n- **Filename**: `hsbSteicoIO.dll`\n- **Location**: `[hsbCAD Install Path]\\Utilities\\hsbCloudStorage`\n- **Purpose**: This library contains the `ImportWolfIFC` function required to read and interpret the external Wolf truss data.\n\n## Tips\n- **Verify Paths**: Ensure the `Truss Group Name` and `Beam Group Name` match your existing Project Tree structure. If the groups do not exist, the script may fail to place the elements visibly.\n- **Use Filters**: If importing a large file, use the `Truss Name Filter` to bring in only a specific section of the roof first to check alignment and positioning before importing the full set.\n- **Script Disappears**: Do not be alarmed when the script insertion point vanishes. This is intended behavior; the trusses remain as native hsbCAD elements.\n\n## FAQ\n- **Q: The script disappeared, but I don't see any trusses.**\n  - A: Check your Project Tree (Groups). The trusses may have been created inside a folder that is currently hidden or collapsed. Verify the paths in the Properties Palette were correct.\n- **Q: Can I modify the trusses after import?**\n  - A: Yes. Once the script finishes, the trusses are standard native elements in the drawing. You can edit them manually or using other hsbCAD tools.\n- **Q: I got an error about a missing DLL.**\n  - A: Ensure your hsbCAD installation is up-to-date and that the `hsbCloudStorage` module is correctly installed in your Utilities folder."
      },
      "tokens_used": 5014,
      "error": null
    }
  }
}