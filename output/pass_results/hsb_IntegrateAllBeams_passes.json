{
  "filename": "hsb_IntegrateAllBeams.mcr",
  "status": "completed",
  "total_tokens": 55548,
  "processing_time": 605.7649984359741,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "01.11.2009",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "27.03.2012",
            "author": "",
            "changes": "Release Version"
          },
          {
            "version": "1.2",
            "date": "08.06.2012",
            "author": "",
            "changes": "Bugfix with angled plates, increased birdsmouth beamcut to accomodate for steeper angles.  Added Beam types in properties if certain types dont want to be notched."
          },
          {
            "version": "1.3",
            "date": "02.07.2012",
            "author": "",
            "changes": "Add tolerance property"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7748,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses `PrEntity` to select `Element` objects from the current drawing context. It processes 3D geometry by iterating through `Element.beam()` arrays and performing boolean operations using `Cut` and `BeamCut` classes (`addToolStatic`). The script concludes with `eraseInstance()`, a pattern typical of 'run-once' utility scripts that modify the 3D model. It explicitly references `_kModelSpace` when collecting `TrussEntity` objects within element groups."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Elements with beams",
          "requiredSettings": []
        }
      },
      "tokens_used": 7591,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Please select Elements\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"dDepth1\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Depth inside Plate\",\n      \"defaultValue\": 8,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": \"Depth that the Studs are going to be cut inside the top and bottom plate\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dTolerance\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Tolerance\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 23,\n      \"variable\": \"sSquareTool\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Square tool to plate|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 30,\n      \"variable\": \"sFilterElementByInformation\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Exclude elements with Information field\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": \"Please type the information separated by ; \"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sbmName00\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Jack Over Opening\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sbmName01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Jack Under Opening\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sbmName02\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Cripple Stud\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sbmName03\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Transom\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"sbmName04\",\n      \"type\": \"PropString\",\n      \"displayName\": \"King Stud\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 6,\n      \"variable\": \"sbmName05\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Sill\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 7,\n      \"variable\": \"sbmName06\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Angled TopPlate Left\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 8,\n      \"variable\": \"sbmName07\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Angled TopPlate Right\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 9,\n      \"variable\": \"sbmName08\",\n      \"type\": \"PropString\",\n      \"displayName\": \"TopPlate\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 10,\n      \"variable\": \"sbmName09\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Bottom Plate\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 11,\n      \"variable\": \"sbmName10\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Blocking\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 12,\n      \"variable\": \"sbmName11\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Supporting Beam\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 13,\n      \"variable\": \"sbmName12\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Stud\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": \"Wall beams to notch\",\n      \"description\": null\n    },\n    {\n      \"index\": 14,\n     "
      },
      "tokens_used": 10347,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the integration (notching and birdsmouth cutting) of wall and floor beams where they intersect with angled or straight plates.",
          "category": "Framing",
          "typicalUseCase": "Used when detailing timber frame walls or floors to ensure studs, joists, and rafters fit tightly into top/bottom plates or headers, particularly at eaves or complex intersections."
        },
        "parameters": [
          {
            "name": "dDepth1",
            "technicalDefault": 8,
            "businessMeaning": "The depth of the recess cut into the plate (female beam) to accept the intersecting stud or joist (male beam).",
            "validRange": "5 to 50",
            "unit": "mm",
            "affectsOutput": "Increases the depth of the notch in the plate and the length of the cut on the stud. Deeper notches increase bearing surface but reduce the structural strength of the plate."
          },
          {
            "name": "dTolerance",
            "technicalDefault": 0,
            "businessMeaning": "A clearance gap added to the width of the notch to prevent binding due to timber tolerances or swelling.",
            "validRange": "0 to 5",
            "unit": "mm",
            "affectsOutput": "Widens the notch cut into the female beam slightly, ensuring an easier fit during assembly."
          },
          {
            "name": "sSquareTool",
            "technicalDefault": "No",
            "businessMeaning": "Determines the cut geometry for angled plate connections. 'Yes' forces a square (orthogonal) notch; 'No' allows a standard angled/birdsmouth cut.",
            "validRange": "No/Yes",
            "unit": "enum",
            "affectsOutput": "Switches the calculation logic for the cut profile, changing the shape of both the notch in the plate and the end cut of the intersecting beam."
          },
          {
            "name": "sFilterElementByInformation",
            "technicalDefault": "",
            "businessMeaning": "A filter to exclude specific elements from processing based on the text in their 'Information' property.",
            "validRange": "Text string (semicolon separated)",
            "unit": "string",
            "affectsOutput": "Prevents the script from modifying any element that matches the filter criteria, allowing selective processing within a selection set."
          },
          {
            "name": "sbmName00 through sbmName21 (Wall Beams)",
            "technicalDefault": "No",
            "businessMeaning": "Enables or disables integration (notching) for specific wall beam sub-types (e.g., Studs, Jacks, Cripples, Top Plates).",
            "validRange": "No/Yes",
            "unit": "enum",
            "affectsOutput": "If 'Yes', beams of this type will be cut or notched where they intersect. If 'No', they are ignored by the script."
          },
          {
            "name": "sbmFloorName00 through sbmFloorName06 (Floor Beams)",
            "technicalDefault": "No",
            "businessMeaning": "Enables or disables integration (notching) for specific floor beam sub-types (e.g., Joists, Rim Beams, Trimmers).",
            "validRange": "No/Yes",
            "unit": "enum",
            "affectsOutput": "If 'Yes', beams of this type will be cut or notched where they intersect. If 'No', they are ignored by the script."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sSquareTool is 'Yes'",
            "effect": "Changes the geometric calculation for angled plates to use trigonometry offsets rather than a simple birdsmouth.",
            "cascade": [
              "dDepth1"
            ]
          },
          {
            "trigger": "sFilterElementByInformation",
            "effect": "Filters the input Element array before any geometric processing begins.",
            "cascade": [
              "_Element"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Cut",
            "description": "A planar saw cut applied to the end of the intersecting (male) beam.",
            "appliedTo": "Studs, joists, or jacks (Wall/Floor beams to notch) where they meet a plate."
          },
          {
            "type": "BeamCut",
            "description": "A volumetric notch removed from the main (female) beam to accept the intersecting beam.",
            "appliedTo": "Top plates, bottom plates, headers, or rim beams."
          }
        ]
      },
      "tokens_used": 9689,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script (hsb_IntegrateAllBeams.mcr)",
          "2. Load default property values from Catalog (if _kExecuteKey is set)",
          "3. Display Properties Dialog (if running manually without ExecuteKey)",
          "4. Prompt User to select Elements (PrEntity)",
          "5. Validate Selection: If user cancels or selects nothing, erase instance and stop",
          "6. Store selected Elements in script memory",
          "7. Wait for User Action (Modify Properties in OPM or Recalculate)",
          "8. Initialize Processing: Parse Tolerance, Depth, and Beam Type filters",
          "9. Iterate through selected Elements",
          "10. [Filter Check] Check Element 'Information' field against exclusion list",
          "11. [Geometry Check] Retrieve all Beams within the Element",
          "12. Retrieve Truss Entities (if any) and calculate envelope bodies for intersection checks",
          "13. Iterate through Beams to find connections (Female beams)",
          "14. Iterate through potential intersecting beams (Male beams)",
          "15. [Connection Check] Verify T-connection using geometric tolerance",
          "16. [Priority Check] Verify the intersecting beam is the closest object (prevent skimming)",
          "17. [Type Filter] Check if specific beam types (Stud, Jack, etc.) are enabled for integration",
          "18. Determine Geometry Type: Angled Plate vs. Straight Plate",
          "19. Apply Cuts: Generate 'Cut' tool for Male beam and 'BeamCut' for Female beam",
          "20. Erase temporary Truss geometry entities",
          "21. Erase Script Instance (Self-destruct)"
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Check",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase instance immediately",
                "Stop execution (Prevent infinite loops)"
              ]
            },
            "path2": {
              "name": "Cycle = 1 (First Run)",
              "steps": [
                "Proceed to Entity Selection"
              ]
            }
          },
          {
            "condition": "Element Exclusion Filter",
            "path1": {
              "name": "Matches Exclusion List",
              "steps": [
                "Skip processing this Element",
                "Continue to next Element"
              ]
            },
            "path2": {
              "name": "Does Not Match",
              "steps": [
                "Process beams within this Element"
              ]
            }
          },
          {
            "condition": "Beam Type Configuration",
            "path1": {
              "name": "Type set to 'No' in Properties",
              "steps": [
                "Ignore this specific beam",
                "Do not generate cuts"
              ]
            },
            "path2": {
              "name": "Type set to 'Yes' in Properties",
              "steps": [
                "Proceed to intersection checks"
              ]
            }
          },
          {
            "condition": "Intersection Geometry (Angled vs Straight)",
            "path1": {
              "name": "Angled Plate Detected",
              "steps": [
                "Check 'Square tool to plate' property",
                "If Yes: Calculate square notch with offsets",
                "If No: Calculate standard birdsmouth cut"
              ]
            },
            "path2": {
              "name": "Straight Plate Detected",
              "steps": [
                "Check if Header beam is involved",
                "If Header: Apply notch to all stacked headers at location",
                "If Standard: Apply standard integration cut"
              ]
            }
          },
          {
            "condition": "Header Propagation",
            "path1": {
              "name": "Header Present",
              "steps": [
                "Calculate notch body",
                "Check intersection with all Header beams in array",
                "Apply cut to every intersecting Header"
              ]
            },
            "path2": {
              "name": "Standard Beam",
              "steps": [
                "Apply cut only to the single intersecting beam"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Selected Elements Array",
            "errorMessage": "None (Implicit)",
            "recovery": "If no elements selected or array is empty on recalc, the script erases itself automatically."
          },
          {
            "check": "Element Content (Beams)",
            "errorMessage": "None (Implicit)",
            "recovery": "If an Element contains 0 beams, the script halts processing for that element or returns entirely based on loop logic."
          },
          {
            "check": "T-Connection Validity",
            "errorMessage": "None (Implicit)",
            "recovery": "If beams do not form a valid T-connection within tolerance (15mm), they are skipped."
          },
          {
            "check": "Intersection Priority",
            "errorMessage": "None (Implicit)",
            "recovery": "If the beam is not the *first* intersection found from the surface (e.g. it just skims the edge), it is ignored to prevent incorrect cutting."
          },
          {
            "check": "Beam Orientation",
            "errorMessage": "None (Implicit)",
            "recovery": "If `dD(vx) > dD(vz)` (Flat orientation check), the beam is skipped."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Integration Parameters",
            "how": "Object Properties Palette (OPM)",
            "effect": "Updating properties (Depth, Tolerance, Types) triggers the script to recalculate and regenerate the cuts on the selected elements."
          },
          {
            "action": "Recalculate Script",
            "how": "Right-click context menu -> Recalculate",
            "effect": "Forces the script to re-run the integration logic against the current geometry of the selected elements."
          }
        ]
      },
      "tokens_used": 12479,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_IntegrateAllBeams.mcr\n\n## Overview\nThis script automates the integration of wall and floor beams by notching plates and cutting intersecting studs or joists. It is designed to create tight-fitting connections, including birdsmouth cuts for angled plates, ensuring proper bearing surfaces in timber frame construction.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates on Elements and GenBeams in the 3D model. |\n| Paper Space | No | Not applicable for 2D drawings. |\n| Shop Drawing | No | This script modifies the physical model geometry, not drawing views. |\n\n## Prerequisites\n- **Required Entities**: Elements (containing GenBeams) must exist in the model.\n- **Minimum Beam Count**: At least 1 element with beams must be selected.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or use the hsbCAD Scripts menu) â†’ Select `hsb_IntegrateAllBeams.mcr`\n\n### Step 2: Select Elements\n```\nCommand Line: Please select Elements\nAction: Click on the Wall or Floor Elements you wish to process and press Enter.\n```\n*Note: You can select multiple elements at once.*\n\n### Step 3: Configure Parameters (Optional)\nIf the Properties Palette does not open automatically, select the script instance (if available) or check command line options. Adjust parameters such as notch depth or tolerance.\n\n### Step 4: Execute\nThe script will calculate intersections and apply the cuts. The script instance will automatically erase itself once the cuts are applied to the beams.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Depth inside Plate | Number | 8 | The depth the Studs are cut into the top and bottom plates (mm). |\n| Tolerance | Number | 0 | Clearance gap added to the notch width to prevent binding (mm). |\n| |Square tool to plate| | Dropdown | No | If \"Yes\", forces a square (orthogonal) notch for angled plates instead of a birdsmouth. |\n| Exclude elements with Information field | Text | | Text string (semicolon separated) matching the 'Information' field of elements to skip. |\n| **Wall Beams to Notch** | | | | |\n| Jack Over Opening | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| Jack Under Opening | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| Cripple Stud | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| Transom | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| King Stud | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| Sill | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| Angled TopPlate Left | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| Angled TopPlate Right | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| TopPlate | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| Bottom Plate | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| Blocking | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| Supporting Beam | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| Stud | Dropdown | No | Set to \"Yes\" to integrate this beam type. |\n| **Floor Beams to Notch** | | | | |\n| Floor Beam Types | Dropdown | No | Set to \"Yes\" to integrate floor beams (Joists, Rim Beams, Trimmers, etc.). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Re-runs the integration logic with current property values. (Available only if the script instance is still active). |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on internal properties and does not require external settings files.\n\n## Tips\n- **Filtering Elements**: If you have complex assemblies where you only want to integrate specific walls, enter the unique text from the 'Information' property of those walls into the \"Exclude elements with Information field\" parameter.\n- **Angled Walls**: For steep roof angles or eaves, the script automatically adjusts the birdsmouth cut. If you prefer a square cut for easier manufacturing, set **|Square tool to plate|** to \"Yes\".\n- **Self-Deleting**: This script acts as a \"run-once\" tool. Once it applies the cuts to the beams, the script instance disappears from the drawing. If you need to change the parameters significantly, use AutoCAD's **UNDO** command to revert the script execution and run it again with new settings.\n- **Header Propagation**: The script is smart enough to apply notches to all stacked header beams if a header is detected at the connection.\n\n## FAQ\n- **Q: The script didn't cut a specific stud. Why?**\n  **A:** Check the \"Wall beams to notch\" properties. That specific beam type (e.g., \"Cripple Stud\" or \"King Stud\") might be set to \"No\". Change it to \"Yes\" and recalculate (or Undo and re-run).\n\n- **Q: How do I undo the cuts if the depth is wrong?**\n  **A:** Since the script erases itself, you cannot simply select it and change properties. Use the standard AutoCAD **UNDO** command immediately after running the script to revert the changes, then adjust the \"Depth inside Plate\" property and insert the script again.\n\n- **Q: What does the Tolerance parameter do?**\n  **A:** It adds a small gap to the width of the notch. If your timber tends to swell or you want a looser fit for assembly, increase this value (e.g., 1mm or 2mm)."
      },
      "tokens_used": 7694,
      "error": null
    }
  }
}