{
  "filename": "GE_WDET_LADDER_BLOCKING_MULTI_DOUBLE_BLOCK.mcr",
  "status": "completed",
  "total_tokens": 43269,
  "processing_time": 750.416660785675,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```"
      },
      "tokens_used": 9354,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script manipulates 3D physical entities (Element, ElementWallSF, Beam) using dbCreate() and coordinate system transformations. There are no references to sd_* functions, Viewport entities, or #Type E arrays typical of ShopDrawing scripts. It generates structural blocking for walls."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing a valid ElementWallSF.",
          "requiredSettings": [
            "hsbFramingDefaults.Inventory.dll",
            "Valid hsbCompany and hsbInstall paths"
          ]
        }
      },
      "tokens_used": 5736,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getElement",
              "promptOriginal": "Select an element",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select an insertion point (It defines where to place ladder along wall and icon/non icon side of wall)",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insertion (via showDialogOnce)",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 1,
            "variable": "sAlign",
            "type": "PropString",
            "displayName": "     Orientation",
            "defaultValue": "Edge",
            "inputType": "dropdown",
            "options": [
              "Edge",
              "Flat"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 2,
            "variable": "sDuplicate",
            "type": "PropString",
            "displayName": "     Double framing (both sides of wall)",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 3,
            "variable": "sMeasureTo",
            "type": "PropString",
            "displayName": "     Measure to",
            "defaultValue": "Center of block",
            "inputType": "dropdown",
            "options": [
              "Center of block",
              "Edge of block"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 0,
            "variable": "dNonFixedDistance",
            "type": "PropDouble",
            "displayName": "     Spacing",
            "defaultValue": 610.0,
            "inputType": "number",
            "options": [],
            "category": "Non-fixed blocking",
            "description": null
          },
          {
            "index": 5,
            "variable": "sDistribution",
            "type": "PropString",
            "displayName": "     Distribution starting point",
            "defaultValue": "Bottom of wall",
            "inputType": "dropdown",
            "options": [
              "Bottom of wall",
              "Top of wall",
              "Middle of wall",
              "Bottom fixed blocking location"
            ],
            "category": "Non-fixed blocking",
            "description": null
          },
          {
            "index": 7,
            "variable": "sFixed",
            "type": "PropString",
            "displayName": "     Fixed blocking type",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": [
              "None",
              "Single",
              "Multiple"
            ],
            "category": "Fixed blocking",
            "description": null
          },
          {
            "index": 1,
            "variable": "dFixedDistance",
            "type": "PropDouble",
            "displayName": "     Spacing ",
            "defaultValue": 1220.0,
            "inputType": "number",
            "options": [],
            "category": "Fixed blocking",
            "description": null
          },
          {
            "index": 2,
            "variable": "dFirstFixed",
            "type": "PropDouble",
            "displayName": "     Height of bottom fixed blocking",
            "defaultValue": 1220.0,
            "inputType": "number",
            "options": [],
            "category": "Fixed blocking",
            "description": null
          },
          {
            "index": 8,
            "variable": "sSingleDoubleBlocking",
            "type": "PropString",
            "displayName": "     Fixed blocking quantity",
            "defaultValue": "Single",
            "inputType": "dropdown",
            "options": [
              "Single",
              "Double"
            ],
            "category": "Fixed blocking",
            "description": null
          },
          {
            "index": 11,
            "variable": "sBlockLumberItem",
            "type": "PropString",
            "displayName": "          Lumber item",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": "Blocking info",
            "description": null
          },
          {
            "index": 12,
            "variable": "sBlockSizeOPM",
            "type": "PropString",
            "displayName": "          Beam size",
            "defaultValue": "From inventory",
            "inputType": "dropdown",
            "options": [
              "2x1",
              "2x2",
              "2x3",
              "2x4",
              "2x6",
              "2x8",
              "2x10",
              "2x12",
              "2x14",
              "2x16",
              "From inventory"
            ],
            "category": "Blocking info",
            "description": null
          },
          {
            "index": 0,
            "variable": "nBlockColorOPM",
            "type": "PropInt",
            "displayName": "          Beam color",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": "Blocking info",
            "description": null
          },
          {
            "index": 13,
            "variable": "sBlockNameOPM",
            "type": "PropString",
            "displayName": "          Name",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Blocking info",
            "description": null
          },
          {
            "index": 14,
            "variable": "sBlockMaterialOPM",
            "type": "PropString",
            "displayName": "          Material",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Blocking info",
            "description": null
          },
          {
            "index": 15,
            "variable": "sBlockGradeOPM",
            "type": "PropString",
            "displayName": "          Grade",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Blocking info",
            "description": null
          },
          {
            "index": 16,
            "variable": "sBlockInformationOPM",
            "type": "PropString",
            "displayName": "          Information",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Blocking info",
            "description": null
          },
          {
            "index": 17,
            "variable": "sBlockLabelOPM",
            "type": "PropString",
            "displayName": "          Label",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Blocking info",
            "description": null
          },
          {
            "index": 18,
            "variable": "sBlockSubLabelOPM",
            "type": "PropString",
            "displayName": "          Sublabel",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Blocking info",
            "description": null
          },
          {
            "index": 19,
            "variable": "sBlockSubLabel2OPM",
            "type": "PropString",
            "displayName": "          Sublabel2",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Blocking info",
            "description": null
          },
          {
            "index": 20,
            "variable": "sBlockBeamCodeOPM",
            "type": "PropString",
            "displayName": "          Beam code",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Blocking info",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "hsbFramingDefaults.Inventory.dll",
            "searchPaths": [
              "\\Utilities\\hsbFramingDefaultsEditor"
            ],
            "purpose": "Provides Lumber Item list for sBlockLumberItem property",
            "required": true
          }
        ]
      },
      "tokens_used": 9762,
      "error": null
    },
    "4": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "Request timeout after retries"
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script / Recalculate Instance",
          "2. Check Insertion State",
          "3. [Conditional] If Manual Insertion:",
          "   - Show warning message: 'cannot be manually inserted...'",
          "   - Erase instance and exit",
          "4. Load Lumber Inventory",
          "   - Call DotNet function 'GetLumberItems' from hsbFramingDefaults.Inventory.dll",
          "   - Populate list of Lumber Items",
          "5. Initialize OPM Properties",
          "   - Set default values for Spacing, Orientation, Fixed Blocking, etc.",
          "6. [Conditional] If On Insertion:",
          "   - Prompt user: 'Select an element'",
          "   - Prompt user: 'Select an insertion point'",
          "   - Show Dynamic Dialog (Properties Palette)",
          "   - Set 'ExecutionMode' in Map",
          "   - Set catalog from PropValues",
          "7. Validate Element Presence",
          "   - If no element selected, erase instance and exit",
          "   - If element deleted, erase instance and exit",
          "8. Initialize Coordinate System & Geometry",
          "   - Cast Element to ElementWallSF",
          "   - Extract coordinate system vectors (X, Y, Z)",
          "9. Determine Blocking Properties",
          "   - Retrieve Size, Material, Grade from Inventory or Manual OPM inputs",
          "   - Apply defaults from Map if available",
          "10. Identify Wall Geometry Context",
          "    - Find studs flanking the insertion point (Left and Right Studs)",
          "    - Determine Top and Bottom plates",
          "    - Establish Wall Height limits",
          "11. Calculate Fixed Blocking Locations",
          "    - [Branch None] Skip Fixed Blocking",
          "    - [Branch Single] Calculate location at 'Height of bottom fixed blocking'",
          "    - [Branch Multiple] Calculate locations from bottom up based on 'Spacing'",
          "12. Calculate Non-Fixed (Ladder) Blocking Locations",
          "    - Determine start point based on 'Distribution starting point' (Bottom/Top/Middle/Fixed)",
          "    - Iterate up/down wall using 'Spacing'",
          "    - Account for 'Measure to' (Center vs Edge of block)",
          "13. Filter Interference",
          "    - Remove non-fixed locations that overlap with fixed blocking ranges",
          "    - Verify points are within Top and Bottom plate boundaries",
          "14. Create Blocking Beams",
          "    - Loop through all valid filtered points",
          "    - Calculate orientation (Edge/Flat) and wall side (Front/Back) based on insertion point",
          "    - Create Beam entity using dbCreate",
          "    - Stretch beam dynamically between Left and Right studs",
          "15. [Conditional] If Double Framing = Yes AND Orientation = Flat:",
          "    - Duplicate all created blocking beams on the opposite side of the wall",
          "16. Apply Attributes",
          "    - Set Name, Material, Grade, Color, Information, Labels",
          "    - Set Module name to link studs and blocking as a sub-assembly",
          "    - Assign beams to Element Group",
          "17. Erase Instance and Exit"
        ],
        "conditionalBranches": [
          {
            "condition": "Manual Insertion Attempt",
            "path1": {
              "name": "Manual Insert",
              "steps": [
                "Display Error Message",
                "Erase Instance",
                "Stop"
              ]
            },
            "path2": {
              "name": "Construct Default",
              "steps": [
                "Load Inventory",
                "Process Wall Geometry",
                "Generate Blocking"
              ]
            }
          },
          {
            "condition": "sFixed (Fixed Blocking Type)",
            "path1": {
              "name": "None",
              "steps": [
                "Skip Fixed Blocking calculation"
              ]
            },
            "path2": {
              "name": "Single",
              "steps": [
                "Place one block at 'Height of bottom fixed blocking'"
              ]
            },
            "path3": {
              "name": "Multiple",
              "steps": [
                "Start from 'Height of bottom fixed blocking'",
                "Place blocks at intervals defined by 'Spacing' until Top Plate"
              ]
            }
          },
          {
            "condition": "sDuplicate (Double Framing)",
            "path1": {
              "name": "No",
              "steps": [
                "Create blocking on selected side only"
              ]
            },
            "path2": {
              "name": "Yes",
              "steps": [
                "Create blocking on selected side",
                "Duplicate blocking on opposite side (if Flat orientation)"
              ]
            }
          },
          {
            "condition": "sAlign (Orientation)",
            "path1": {
              "name": "Edge",
              "steps": [
                "Block Height is perpendicular to wall face",
                "Block Width is parallel to wall face",
                "Offset = Block Height / 2"
              ]
            },
            "path2": {
              "name": "Flat",
              "steps": [
                "Block Height is parallel to wall face",
                "Block Width is perpendicular to wall face",
                "Offset = Block Width / 2"
              ]
            }
          },
          {
            "condition": "sDistribution (Distribution starting point)",
            "path1": {
              "name": "Bottom of wall",
              "steps": [
                "Start calculations at Bottom Plate Z",
                "Propagate upwards"
              ]
            },
            "path2": {
              "name": "Top of wall",
              "steps": [
                "Start calculations at Top Plate Z",
                "Propagate downwards"
              ]
            },
            "path3": {
              "name": "Middle of wall",
              "steps": [
                "Start calculations at (Bottom + Top) / 2",
                "Propagate up and down"
              ]
            },
            "path4": {
              "name": "Bottom fixed blocking location",
              "steps": [
                "Start calculations at Fixed Bottom Z",
                "Propagate upwards"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "_bOnInsert flag",
            "errorMessage": "ScriptName: cannot be manually inserted. It places ladder blocking on wall T connections, defined on Defaults Editor.",
            "recovery": "Use Defaults Editor / Construction Directives to generate this element, or use a different script."
          },
          {
            "check": "_Element array length",
            "errorMessage": "None (Script erases silently or via general element error)",
            "recovery": "Select a valid ElementWallSF before running or recalculating."
          },
          {
            "check": "Element validity (ElementWallSF)",
            "errorMessage": "None (Script erases instance)",
            "recovery": "Ensure the selected element is a valid Wall element."
          },
          {
            "check": "Inventory Loading",
            "errorMessage": "None explicitly handled in script (Runtime Error likely)",
            "recovery": "Ensure hsbFramingDefaults.Inventory.dll exists in Utilities\\hsbFramingDefaultsEditor."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Geometry",
            "how": "Grip edit / Stretch",
            "effect": "Stretching the wall or modifying studs triggers recalculation, which re-runs the script to adjust blocking positions."
          },
          {
            "action": "Modify Parameters",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing Spacing, Orientation, Fixed Blocking settings, or Distribution rules immediately recalculates the blocking layout."
          },
          {
            "action": "Update Material/Size",
            "how": "OPM - Blocking Info",
            "effect": "Changes the Beam Size, Material, Grade, or Color of the generated blocks."
          },
          {
            "action": "Change Element",
            "how": "Properties Palette",
            "effect": "Changing the Lumber Item triggers updates to size/material if 'From inventory' is selected."
          }
        ]
      },
      "tokens_used": 10868,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_WDET_LADDER_BLOCKING_MULTI_DOUBLE_BLOCK.mcr\n\n## Overview\nThis script automatically generates \"ladder\" blocking (horizontal framing) within wall elements. It supports complex configurations including fixed blocking at specific heights, evenly spaced non-fixed blocking, double framing options, and variable orientation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Generates physical 3D beams within a Wall Element. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: Element (specifically `ElementWallSF`).\n- **Minimum Beam Count**: 0 (The script generates the blocking beams).\n- **Required Settings Files**:\n  - `hsbFramingDefaults.Inventory.dll` (Must be present in `Utilities\\hsbFramingDefaultsEditor`).\n\n## Usage Steps\n\n> **Note:** This script **cannot be manually inserted** via the command line. It is designed to be generated automatically via the **Defaults Editor** or Construction Directives when processing Wall T-connections.\n\nIf you attempt manual insertion, the script will display a warning and exit. To use this script:\n\n1.  Open the **hsbDefaultsEditor**.\n2.  Navigate to the appropriate Wall/T-connection construction directive.\n3.  Assign this script (`GE_WDET_LADDER_BLOCKING_MULTI_DOUBLE_BLOCK.mcr`) to the desired connection.\n4.  Configure the Properties Panel parameters (see below).\n5.  **Generate/Update** the drawing to apply the blocking.\n\n*(Note: Although the script contains prompts for Element and Insertion Point selection, the manual insertion logic is blocked to enforce workflow through the Defaults Editor.)*\n\n## Properties Panel Parameters\n\n### General\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Orientation | dropdown | Edge | Sets the rotation of the blocking beam. **Edge** stands perpendicular to the wall; **Flat** lays parallel. |\n| Double framing (both sides of wall) | dropdown | No | If **Yes**, duplicates blocking on the opposite side of the wall (only works if Orientation is Flat). |\n| Measure to | dropdown | Center of block | Defines if the spacing measurement is taken from the center or the edge of the block. |\n\n### Non-fixed blocking\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Spacing | number | 610.0 | The vertical distance between ladder blocking blocks. |\n| Distribution starting point | dropdown | Bottom of wall | Determines where spacing calculations start. Options: Bottom, Top, Middle of wall, or Bottom fixed blocking location. |\n\n### Fixed blocking\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Fixed blocking type | dropdown | None | Type of specific blocking to add. Options: **None**, **Single** (one block), or **Multiple** (repeating vertical pattern). |\n| Spacing | number | 1220.0 | Vertical spacing used for \"Multiple\" fixed blocking. |\n| Height of bottom fixed blocking | number | 1220.0 | The height for the first fixed block. |\n| Fixed blocking quantity | dropdown | Single | Determines if fixed blocks are single or double (stacked). |\n\n### Blocking info\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Lumber item | dropdown | *Empty* | Select a predefined lumber item from the Inventory. |\n| Beam size | dropdown | From inventory | Sets the cross-section size (e.g., 2x4, 2x6). Select \"From inventory\" to use the Lumber item size. |\n| Beam color | number | 2 | The color index for the generated beams. |\n| Name | text | *Empty* | Assigns a name to the generated beams. |\n| Material | text | *Empty* | Material specification. |\n| Grade | text | *Empty* | Lumber grade. |\n| Information | text | *Empty* | Additional information field. |\n| Label | text | *Empty* | Beam label. |\n| Sublabel | text | *Empty* | Beam sublabel. |\n| Sublabel2 | text | *Empty* | Beam sublabel 2. |\n| Beam code | text | *Empty* | Beam code. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add custom items to the right-click context menu. |\n\n## Settings Files\n- **Filename**: `hsbFramingDefaults.Inventory.dll`\n- **Location**: `\\\\Utilities\\\\hsbFramingDefaultsEditor`\n- **Purpose**: Provides the list of Lumber Items available in the \"Blocking info\" properties.\n\n## Tips\n- **Double Framing Logic**: The \"Double framing\" option creates blocks on both sides of the wall, but this only functions if the **Orientation** is set to **Flat**. If set to Edge, blocks remain on the selected side only.\n- **Centering Distribution**: Use \"Distribution starting point\" set to **Middle of wall** to automatically center the ladder blocking layout vertically between the top and bottom plates.\n- **Fixed vs Non-Fixed**: Use \"Fixed blocking\" for specific requirements like grab bar backing (set to Single at a specific height). Use \"Non-fixed\" for general structural ladder blocking.\n\n## FAQ\n- **Q: Can I insert this script using the TSLINSERT command?**\n  - A: No. Attempting to insert it manually will result in an error message stating it \"cannot be manually inserted.\" You must configure it in the Defaults Editor.\n- **Q: How do I make the blocking go all the way from floor to ceiling?**\n  - A: Ensure \"Fixed blocking type\" is set to **None**. In \"Non-fixed blocking\", set \"Distribution starting point\" to **Bottom of wall** (or Top) and ensure the spacing divides evenly into the wall height.\n- **Q: Why didn't my blocks appear on the other side of the wall when I selected \"Yes\" for Double framing?**\n  - A: Check your **Orientation** setting. Double framing only applies when the orientation is **Flat**."
      },
      "tokens_used": 7549,
      "error": null
    }
  }
}