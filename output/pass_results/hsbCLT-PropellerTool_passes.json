{
  "filename": "hsbCLT-PropellerTool.mcr",
  "status": "completed",
  "total_tokens": 50931,
  "processing_time": 327.0668942928314,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "This tsl creates a propeller surface tool based on two polylines. Polylines which are not drawn parallel to the XY-plane of the panel will be projected to the upper and lower surface of the panel.",
        "versionHistory": [
          {
            "version": "1.7",
            "date": "08.02.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-10652 straight segments of defining polyline not excluded"
          },
          {
            "version": "1.6",
            "date": "08.02.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-10652 bugfix tool orientation. Tool definitions can be edited via context commands"
          },
          {
            "version": "1.5",
            "date": "31.01.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-10496 visualization improved"
          },
          {
            "version": "1.4",
            "date": "29.01.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-10496 new tool definition to support various alignments"
          },
          {
            "version": "1.3",
            "date": "19sep2018",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "bugfix tool assignment"
          },
          {
            "version": "1.2",
            "date": "12mar2018",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "bugfix polyline projection to surface"
          },
          {
            "version": "1.1",
            "date": "19nov2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "bugfix tool side, new property tool type, single polyline definition supported"
          },
          {
            "version": "1.0",
            "date": "22feb2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "initial"
          }
        ],
        "settingsFiles": [
          "hsbCLT-Freeprofile.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 8579,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses _kModelSpace for dynamic dialog creation (tslDialog.dbCreate). There is no usage of _kPaperSpace, _Viewport, or sd_ prefixes. The functionality describes creating a 'propeller surface tool' based on polylines projected onto a panel surface, which is a 3D modeling task."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Polyline"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbCLT-Freeprofile.xml"
          ]
        }
      },
      "tokens_used": 7170,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10145,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a custom profile or contour machining operation (Propeller Surface Tool) on CLT panels based on user-selected polylines.",
          "category": "Machining/CAM",
          "typicalUseCase": "Creating complex non-rectangular cutouts, grooves, or edge profiles on Cross Laminated Timber (CLT) panels that require specific tooling geometry defined by projected polylines."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles.first()",
            "businessMeaning": "The CAD dimension style used to annotate the tool's dimensions or measurements in the model view.",
            "validRange": "Any valid dimension style defined in the current drawing.",
            "unit": "String (Style Name)",
            "affectsOutput": "Visual representation of dimensions associated with the tool."
          },
          {
            "name": "dTextHeight",
            "technicalDefault": "U(50)",
            "businessMeaning": "The height of text labels or dimensions displayed by the script for visualization purposes.",
            "validRange": "1mm to 500mm (typically 2.5mm to 10mm for standard plotting, larger for on-site stencils)",
            "unit": "mm",
            "affectsOutput": "Legibility of text annotations in the 3D model and drawings."
          },
          {
            "name": "ncDefining",
            "technicalDefault": "rgb(205,32,39) (Red)",
            "businessMeaning": "Visualization color for the primary polyline used to define the tool's path.",
            "validRange": "0 to 16777215 (RGB Integer)",
            "unit": "Integer (Color)",
            "affectsOutput": "Visual feedback in the CAD environment to distinguish the primary input geometry."
          },
          {
            "name": "ncBevel",
            "technicalDefault": "rgb(0,158,0) (Green)",
            "businessMeaning": "Visualization color for the secondary polyline (often used to define a bevel angle, offset, or secondary boundary).",
            "validRange": "0 to 16777215 (RGB Integer)",
            "unit": "Integer (Color)",
            "affectsOutput": "Visual feedback to distinguish secondary input geometry or bevel definitions."
          },
          {
            "name": "nt",
            "technicalDefault": "50",
            "businessMeaning": "The transparency level of the tool visualization overlay.",
            "validRange": "0 (Opaque) to 90 (High Transparency)",
            "unit": "Percentage (0-100 scale internally, mapped to integer)",
            "affectsOutput": "How easily the tool geometry can be seen over the underlying panel material."
          },
          {
            "name": "dDiameter",
            "technicalDefault": "0 (Read from Settings)",
            "businessMeaning": "The diameter of the milling cutter used to machine the profile.",
            "validRange": "6mm to 60mm (Common CLT milling diameters)",
            "unit": "mm",
            "affectsOutput": "Determines the physical width of the cut and internal corner radii. Critical for CNC machine selection."
          },
          {
            "name": "dLength",
            "technicalDefault": "0 (Read from Settings)",
            "businessMeaning": "The cutting length of the tool (how deep it can reach).",
            "validRange": "40mm to 300mm (Must exceed panel thickness)",
            "unit": "mm",
            "affectsOutput": "Ensures the tool is long enough to cut through the specific depth of the CLT layer."
          },
          {
            "name": "nToolIndex",
            "technicalDefault": "2",
            "businessMeaning": "The unique identifier number referencing the physical tool in the CNC machine's magazine (tool changer).",
            "validRange": "1 to 999",
            "unit": "Integer",
            "affectsOutput": "Generates the specific tool call command (e.g., M6 T2) in the CNC output code."
          },
          {
            "name": "sToolName",
            "technicalDefault": "Name of Tool",
            "businessMeaning": "Human-readable label for the tool configuration (e.g., '20mm Vertical Mill').",
            "validRange": "String",
            "unit": "Text",
            "affectsOutput": "Used for identification in drawings, reports, and BOMs; helps organize tool catalogs."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Adding or Editing a Tool Definition via Context Menu",
            "effect": "Updates the 'Tool[]' map within the settings file (hsbCLT-Freeprofile.xml).",
            "cascade": [
              "sToolName",
              "nToolIndex",
              "dDiameter",
              "dLength"
            ]
          },
          {
            "trigger": "Changing ncDefining or ncBevel",
            "effect": "Updates the 'Display' settings map.",
            "cascade": [
              "Display Visualization"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "FreeProfile / Propeller Surface Tool",
            "description": "A complex 3D milling operation or contour projected onto the top or bottom surface of the CLT element. The shape is defined by the input polylines.",
            "appliedTo": "Element (CLT Panel)"
          }
        ]
      },
      "tokens_used": 8875,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch & Initialization: Script starts, sets constants (U(1,\"mm\")), initializes variables, and prepares the settings environment.",
          "2. Settings Handling: The script attempts to locate and load the settings file (hsbCLT-Freeprofile.xml) from the company folder or the installation path. It creates a MapObject to persist these settings in the drawing.",
          "3. Version Check: If the script instance is being created (_bOnDbCreated), it compares the version of the loaded settings with the version in the installation directory and reports a notice if they differ.",
          "4. Tool Data Loading: The script reads tool definitions (Name, Diameter, Length, ToolIndex) from the loaded settings map into local arrays.",
          "5. Dialog Mode Initialization: The script checks the 'DialogMode' integer stored in the script instance map (_Map) to determine the user interface state.",
          "6. Interactive Flow Decision: The script branches based on the current DialogMode or context trigger actions.",
          "7. [Display Settings Mode]: If DialogMode is 1, a dialog is shown to configure visualization settings (DimStyle, Text Height, Colors, Transparency). Updates are saved to the MapObject.",
          "8. [Edit Tool Mode]: If DialogMode is 2 (triggered by 'Edit Tool Definition'), a dialog allows modifying an existing tool's properties. The MapObject is updated with the changes.",
          "9. [Add Tool Mode]: If DialogMode is 3 (triggered by 'Add Tool Definition'), a dialog allows entering details for a new tool. The tool is added to the list and the MapObject is updated.",
          "10. [Remove Tool Mode]: If DialogMode is 4 (triggered by 'Remove Tool Definition'), a dialog allows selecting a tool to remove. The tool is deleted from the list and the MapObject is updated.",
          "11. [Import/Export Settings]: Context triggers allow importing settings from an XML file or exporting the current MapObject to an XML file.",
          "12. Exit & Loop: After any dialog interaction or trigger action, the script sets execution loops to 2 and returns, effectively restarting the script with the new state (e.g., new DialogMode or updated data)."
        ],
        "conditionalBranches": [
          {
            "condition": "Settings File Existence",
            "path1": {
              "name": "File Found",
              "steps": [
                "Read settings from XML file found in Company Path or Install Path.",
                "Create or Update MapObject with these settings."
              ]
            },
            "path2": {
              "name": "File Not Found",
              "steps": [
                "Attempt to use default internal modes and empty arrays if mapSetting is empty.",
                "Proceed with empty or default tool lists."
              ]
            }
          },
          {
            "condition": "DialogMode State",
            "path1": {
              "name": "Mode 1: Display",
              "steps": [
                "Display 'Display' properties dialog.",
                "Update 'Display' map in MapObject.",
                "Restart script."
              ]
            },
            "path2": {
              "name": "Mode 2: Edit Tool",
              "steps": [
                "Display 'Tool Definition' dialog (Edit mode).",
                "Update existing tool entry in 'Tool[]' map.",
                "Restart script."
              ]
            },
            "path3": {
              "name": "Mode 3: Add Tool",
              "steps": [
                "Display 'Tool Definition' dialog (Add mode).",
                "Append new tool entry to 'Tool[]' map.",
                "Restart script."
              ]
            },
            "path4": {
              "name": "Mode 4: Remove Tool",
              "steps": [
                "Display 'Tool Definition' dialog (Remove mode) only if tool count > 1.",
                "Remove selected tool from 'Tool[]' map.",
                "Restart script."
              ]
            }
          },
          {
            "condition": "Export Settings Trigger",
            "path1": {
              "name": "File Exists",
              "steps": [
                "Prompt user for confirmation to overwrite.",
                "If Yes, write MapObject to XML file."
              ]
            },
            "path2": {
              "name": "File Does Not Exist",
              "steps": [
                "Write MapObject to XML file directly."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Tool Data Integrity",
            "errorMessage": "(Implicit) Tools with missing Name, Diameter, Length, or ToolIndex are ignored during loading.",
            "recovery": "Ensure the XML settings file contains valid entries for all required fields for every tool."
          },
          {
            "check": "Duplicate Tools",
            "errorMessage": "(Implicit) Duplicate tool names or indices are prevented during loading.",
            "recovery": "The script ignores subsequent duplicates. Edit the XML to ensure unique names and indices."
          },
          {
            "check": "Remove Tool Availability",
            "errorMessage": "(Implicit) The 'Remove Tool Definition' context menu item is only available if more than one tool exists.",
            "recovery": "N/A (System constraint to ensure at least one tool remains)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Display Settings",
            "how": "Right-click context menu (likely via a trigger not fully shown but implied by 'Edit' mode structure) or OPM key 'Display'.",
            "effect": "Opens a dialog to change colors, text height, and transparency of the tool visualization."
          },
          {
            "action": "Edit Tool Definition",
            "how": "Right-click context menu 'Edit Tool Definition'.",
            "effect": "Opens a dialog to modify Diameter, Length, and ToolIndex of an existing tool."
          },
          {
            "action": "Add Tool Definition",
            "how": "Right-click context menu 'Add Tool Definition'.",
            "effect": "Opens a dialog to create a new tool profile with specific Diameter, Length, and Index."
          },
          {
            "action": "Remove Tool Definition",
            "how": "Right-click context menu 'Remove Tool Definition' (Only if > 1 tool exists).",
            "effect": "Removes the selected tool from the catalog."
          },
          {
            "action": "Import/Export Settings",
            "how": "Right-click context menu 'Import Settings' or 'Export Settings'.",
            "effect": "Loads tool definitions from an XML file into the drawing or saves current definitions to an XML file."
          }
        ]
      },
      "tokens_used": 9598,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-PropellerTool.mcr\n\n## Overview\nThis script generates a specialized \"Propeller Surface Tool\" machining operation on CLT (Cross Laminated Timber) panels. It defines the tool path using two polylines, automatically projecting them onto the panel's surface if they are not drawn parallel to the XY-plane.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script is designed for 3D modeling in Model Space. |\n| Paper Space | No | Not supported in Layouts. |\n| Shop Drawing | No | This is a modeling/CAM definition script. |\n\n## Prerequisites\n- **Required Entities**: \n  - An Element (CLT Panel).\n  - Two Polylines (to define the tool shape/path).\n- **Minimum Beam Count**: 0\n- **Required Settings**: \n  - `hsbCLT-Freeprofile.xml` (Must be located in the Company or hsbCAD Install path).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT` â†’ Select `hsbCLT-PropellerTool.mcr`\n\n### Step 2: Select Element\n```\nCommand Line: Select Element:\nAction: Click on the CLT panel element you wish to apply the tool to.\n```\n\n### Step 3: Define Geometry\n```\nCommand Line: Select defining polyline / [Cancel]:\nAction: Select the first polyline that defines the primary boundary of the tool.\n\nCommand Line: Select second polyline / [Ok]:\nAction: Select the second polyline (often used for bevels or secondary offsets) or press Enter if a single polyline definition is sufficient.\n```\n*Note: If the selected polylines are not parallel to the panel's XY-plane, the script will automatically project them onto the panel's upper or lower surface.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sDimStyle | Dropdown | First in list | The dimension style used for annotating measurements in the model. |\n| dTextHeight | Double | U(50) | The height of text labels displayed for visualization (in mm). |\n| ncDefining | Integer (Color) | Red (205,32,39) | Color used to visualize the primary defining polyline. |\n| ncBevel | Integer (Color) | Green (0,158,0) | Color used to visualize the secondary polyline or bevel definition. |\n| nt | Integer | 50 | Transparency level of the tool visualization overlay (0-100). |\n| dDiameter | Double | 0 (Read from Settings) | The diameter of the milling cutter (in mm). |\n| dLength | Double | 0 (Read from Settings) | The cutting length of the tool (in mm). |\n| nToolIndex | Integer | 2 | The unique identifier number for the tool in the CNC machine magazine. |\n| sToolName | String | Name of Tool | Human-readable name for the tool configuration (e.g., \"20mm Vertical Mill\"). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Edit Display Settings | Opens a dialog to change visualization preferences such as colors, text height, and transparency. |\n| Edit Tool Definition | Allows you to modify the properties (Diameter, Length, Index, Name) of an existing tool selected from the catalog. |\n| Add Tool Definition | Opens a dialog to create a new tool profile and add it to the tool catalog. |\n| Remove Tool Definition | Removes a tool from the catalog. (Only available if more than one tool exists). |\n| Import Settings | Loads tool definitions from an external XML file into the current drawing. |\n| Export Settings | Saves the current tool catalog and settings to an XML file for backup or sharing. |\n\n## Settings Files\n- **Filename**: `hsbCLT-Freeprofile.xml`\n- **Location**: Company folder or hsbCAD installation path.\n- **Purpose**: Stores the library of tool definitions (Diameter, Length, ToolIndex, Name) and global display settings. This file allows the tool catalog to be shared across different projects or users.\n\n## Tips\n- **Visualization**: Use high-contrast colors for `ncDefining` and `ncBevel` if your polylines overlap or are complex; this makes it easier to distinguish the primary path from secondary bevels.\n- **Tool Management**: Use the \"Export Settings\" feature to back up your customized tool catalog after defining specific cutters required for your workshop.\n- **Projection**: You do not need to manually flatten your polylines onto the panel face. Draw them in a convenient work plane (e.g., XY-plane), and the script will project them to the panel surface automatically.\n\n## FAQ\n- **Q: Why does the tool disappear or look very faint?**\n  - A: Check the `nt` (Transparency) property. If it is set to a high value (close to 100), the tool will be nearly invisible. Lower the value to make it opaque.\n  \n- **Q: Can I use a single polyline instead of two?**\n  - A: Yes. You can select the first polyline and then press Enter (or select \"Ok\") when prompted for the second polyline to use a single definition.\n\n- **Q: How do I ensure the CNC machine uses the correct cutter?**\n  - A: Verify that the `nToolIndex` in the script properties matches the physical position of the tool in your CNC machine's tool changer magazine. You can manage this via \"Edit Tool Definition\"."
      },
      "tokens_used": 6564,
      "error": null
    }
  }
}