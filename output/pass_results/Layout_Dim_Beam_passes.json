{
  "filename": "Layout_Dim_Beam.mcr",
  "status": "completed",
  "total_tokens": 40596,
  "processing_time": 262.7317967414856,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.2",
            "date": "23.05.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-15514: Truss entities are now recognised for dimensioning"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6042,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly prompts for a Viewport using getViewport() and stores it in the _Viewport array. It retrieves the coordinate system transformation (ms2ps) from the viewport to translate geometry between Model Space and Paper Space. Specifically, it constructs the DimLine in Paper Space (lnPs), transforms it to Model Space to collect dimension points (lnMs.collectDimPoints), and then transforms the final dimension object back to Paper Space (dim.transformBy(ms2ps)) for display."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "Beam",
            "TrussEntity"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Must be inserted into a drawing with at least one Layout containing a Viewport linked to a valid Element (Model Space construction).",
          "requiredSettings": []
        }
      },
      "tokens_used": 5114,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select a viewport, you can add others later on with the HSB_LINKTOOLS command.",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strDir",
            "type": "PropString",
            "displayName": "Direction",
            "defaultValue": "Horizontal",
            "inputType": "dropdown",
            "options": [
              "Horizontal",
              "Vertical"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "strDir1",
            "type": "PropString",
            "displayName": "Dim from",
            "defaultValue": "Left",
            "inputType": "dropdown",
            "options": [
              "Left",
              "Right"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strSide",
            "type": "PropString",
            "displayName": "Side of beams/sheets",
            "defaultValue": "Left",
            "inputType": "dropdown",
            "options": [
              "Left",
              "Center",
              "Right",
              "Left and right"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "strAllZones",
            "type": "PropString",
            "displayName": "Zones to use",
            "defaultValue": "Use zone index",
            "inputType": "dropdown",
            "options": [
              "Use zone index",
              "All"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nZone",
            "type": "PropInt",
            "displayName": "Zone index",
            "defaultValue": 5,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "strTextDirD",
            "type": "PropString",
            "displayName": "Delta text direction",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": [
              "None",
              "Parallel",
              "Perpendicular"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "strTextDirC",
            "type": "PropString",
            "displayName": "Cumm text direction",
            "defaultValue": "Parallel",
            "inputType": "dropdown",
            "options": [
              "None",
              "Parallel",
              "Perpendicular"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sDimLayout",
            "type": "PropString",
            "displayName": "Dim Style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nDimColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7050,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates associative dimension lines in PaperSpace (Layouts) based on structural elements (Beams, Trusses, Sheets) visible in a selected Viewport.",
          "category": "ShopDrawing/Annotation",
          "typicalUseCase": "Creating automated overall length or spacing dimensions for wall panels or roof sections in 2D production drawings without manually picking every point."
        },
        "parameters": [
          {
            "name": "strDir",
            "technicalDefault": "Horizontal",
            "businessMeaning": "Sets the orientation of the dimension line on the drawing layout.",
            "validRange": "Horizontal, Vertical",
            "unit": "Enum",
            "affectsOutput": "Rotates the dimension line 90 degrees; changes the algorithm for detecting which beams are 'perpendicular' to the dimension direction."
          },
          {
            "name": "strDir1",
            "technicalDefault": "Left",
            "businessMeaning": "Defines the reading direction and origin for the dimensioning (Left-to-Right or Right-to-Left).",
            "validRange": "Left, Right",
            "unit": "Enum",
            "affectsOutput": "Determines which side of the construction is treated as the start (0.0) point for the dimensions."
          },
          {
            "name": "strSide",
            "technicalDefault": "Left",
            "businessMeaning": "Specifies which face of the structural elements (beams/sheets) the dimension line should snap to.",
            "validRange": "Left, Center, Right, Left and right",
            "unit": "Enum",
            "affectsOutput": "Offsets the dimension tick marks to the outside, center, or inside of the elements. 'Left and right' creates dimensions for both faces."
          },
          {
            "name": "strAllZones",
            "technicalDefault": "Use zone index",
            "businessMeaning": "Filters the dimensioning scope to either the entire structure (All) or a specific construction layer/zone (e.g., just the framing or just the sheathing).",
            "validRange": "Use zone index, All",
            "unit": "Enum",
            "affectsOutput": "If 'All', dimensions cover all generic beams. If 'Use zone index', dimensions only cover elements in the specific zone defined by nZone."
          },
          {
            "name": "nZone",
            "technicalDefault": "5",
            "businessMeaning": "The specific construction layer (Zone) index to dimension when 'Zones to use' is set to 'Use zone index'.",
            "validRange": "-5 to 5",
            "unit": "Index",
            "affectsOutput": "Restricts dimension collection to sheets or beams belonging to this specific zone ID. Ignored if strAllZones is 'All'."
          },
          {
            "name": "strTextDirD",
            "technicalDefault": "None",
            "businessMeaning": "Controls the rotation/orientation of the individual segment text (the small numbers between ticks).",
            "validRange": "None, Parallel, Perpendicular",
            "unit": "Enum",
            "affectsOutput": "Rotates the delta text labels relative to the dimension line."
          },
          {
            "name": "strTextDirC",
            "technicalDefault": "Parallel",
            "businessMeaning": "Controls the rotation/orientation of the cumulative (total) dimension text.",
            "validRange": "None, Parallel, Perpendicular",
            "unit": "Enum",
            "affectsOutput": "Rotates the main total length text label relative to the dimension line."
          },
          {
            "name": "sDimLayout",
            "technicalDefault": null,
            "businessMeaning": "Selects the visual style (arrowheads, text size, scale) for the dimension from the drawing's standard dimension styles.",
            "validRange": "Any valid DimStyle in the current CAD template",
            "unit": "String",
            "affectsOutput": "Changes the visual appearance of the dimension lines, arrows, and font properties."
          },
          {
            "name": "nDimColor",
            "technicalDefault": "1",
            "businessMeaning": "Sets the CAD color index for the dimension lines and text.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the display color of the generated dimension entity."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "strAllZones set to 'Use zone index'",
            "effect": "Activates the nZone parameter to determine which specific layer to dimension.",
            "cascade": [
              "nZone"
            ]
          },
          {
            "trigger": "strAllZones set to 'All'",
            "effect": "Ignores the nZone parameter and dimensions all Generic Beams and Trusses found in the view.",
            "cascade": [
              "nZone"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Dim",
            "description": "An associative dimension object displaying lengths and spacing of structural elements.",
            "appliedTo": "PaperSpace (referencing ModelSpace geometry via the selected Viewport)."
          }
        ]
      },
      "tokens_used": 7180,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User inserts script 'Layout_Dim_Beam.mcr'",
          "User selects insertion point (_Pt0) in Paper Space",
          "User selects a Viewport linked to a Model Space Element",
          "Script stores Viewport and initializes properties",
          "User adjusts properties via OPM (e.g., Direction, Zone, Side)",
          "Script retrieves coordinate transformation (ms2ps/ps2ms) from Viewport",
          "Script calculates Dimension Line orientation based on 'Direction' property",
          "Script collects Beams and Trusses from the Element",
          "Script filters entities perpendicular to the dimension vector",
          "Script determines Start and End points (checks for Bottom Plates or uses Reference Beams)",
          "Script collects intermediate dimension points based on 'Zones to use' property",
          "Script projects and sorts all collected points onto the dimension line",
          "Script generates Dimension object in Model Space",
          "Script transforms Dimension to Paper Space and draws it"
        ],
        "conditionalBranches": [
          {
            "condition": "Dimension Orientation (strDir)",
            "path1": {
              "name": "Horizontal",
              "steps": [
                "Sets DimLine vector to _XW",
                "Sets local Y to _YW"
              ]
            },
            "path2": {
              "name": "Vertical",
              "steps": [
                "Sets DimLine vector to _YW",
                "Sets local Y to -_XW"
              ]
            }
          },
          {
            "condition": "Origin/Start Point Detection",
            "path1": {
              "name": "Bottom Plate Found",
              "steps": [
                "Identifies beams with type '_kSFBottomPlate'",
                "Calculates extreme vertices of the bottom plate body",
                "Uses these extremes as the primary Start and End dimension points"
              ]
            },
            "path2": {
              "name": "No Bottom Plate",
              "steps": [
                "Uses the first and last beam from the filtered perpendicular list (arRef)",
                "Calculates points based on 'Dim from' (Left/Right) property",
                "Uses these as the primary Start and End dimension points"
              ]
            }
          },
          {
            "condition": "Zone Selection (strAllZones)",
            "path1": {
              "name": "All",
              "steps": [
                "Collects all Generic Beams (el.genBeam)",
                "Collects simplified Truss geometry (plTrusses)",
                "Adds points from these entities to the dimension line"
              ]
            },
            "path2": {
              "name": "Use zone index",
              "steps": [
                "Checks value of nZone property",
                "If nZone == 0: Filters specific Beams (excludes IDs in arHsbId) and Trusses",
                "If nZone != 0: Collects Sheets from specific zone (el.sheet(nZone))",
                "Adds points from selected group to the dimension line"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Array",
            "errorMessage": "None (Silent Exit)",
            "recovery": "Ensure the script instance is correctly initialized with a selected viewport."
          },
          {
            "check": "Viewport Element Validity",
            "errorMessage": "None (Silent Exit)",
            "recovery": "Ensure the selected Viewport is linked to a valid hsbCAD Element in Model Space."
          },
          {
            "check": "Geometry to Dimension",
            "errorMessage": "None (Silent Exit)",
            "recovery": "Ensure there are beams or trusses perpendicular to the chosen direction within the selected Element/Zone."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Direction (strDir)",
            "how": "OPM (Properties Palette)",
            "effect": "Rotates the dimension line 90 degrees (Horizontal <-> Vertical) and recalculates perpendicular beams."
          },
          {
            "action": "Change 'Dim from' (strDir1)",
            "how": "OPM",
            "effect": "Reverses the reading order of the dimension (Left <-> Right)."
          },
          {
            "action": "Change 'Side of beams' (strSide)",
            "how": "OPM",
            "effect": "Offsets the dimension ticks to Left, Center, or Right side of the beams."
          },
          {
            "action": "Filter by Zone (strAllZones/nZone)",
            "how": "OPM",
            "effect": "Switches between dimensioning all construction layers or a specific layer/zone."
          },
          {
            "action": "Move Script",
            "how": "Grip Edit (Drag)",
            "effect": "Relocates the dimension line origin (_Pt0) in Paper Space."
          }
        ]
      },
      "tokens_used": 8817,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Layout_Dim_Beam.mcr\n\n## Overview\nThis script automatically creates associative dimension lines in Paper Space (Layouts). It dimensions structural elements like beams, trusses, and sheets that are visible through a selected Viewport.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | The script is inserted in Paper Space but reads geometry from Model Space via the Viewport. |\n| Paper Space | Yes | This is the primary environment for inserting this script. |\n| Shop Drawing | Yes | Designed for creating production drawings. |\n\n## Prerequisites\n- A Layout (Paper Space) tab containing at least one Viewport.\n- The Viewport must be linked to a valid hsbCAD Element (Model Space construction).\n- Structural elements (Beams, Trusses, or Sheets) must exist within the Viewport's view.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Layout_Dim_Beam.mcr`\n\n### Step 2: Specify Insertion Point\n```\nCommand Line: \nAction: Click anywhere in the Paper Space to set the start point (origin) for the dimension line.\n```\n\n### Step 3: Select Viewport\n```\nCommand Line: Select a viewport, you can add others later on with the HSB_LINKTOOLS command.\nAction: Click on the border of the Viewport that displays the model you wish to dimension.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Direction | dropdown | Horizontal | Sets the orientation of the dimension line (Horizontal or Vertical). |\n| Dim from | dropdown | Left | Defines the reading direction and origin (Left-to-Right or Right-to-Left). |\n| Side of beams/sheets | dropdown | Left | Specifies which face of the elements to snap the dimension to (Left, Center, Right, or Both sides). |\n| Zones to use | dropdown | Use zone index | Filters elements to dimension. Select \"All\" for everything or \"Use zone index\" for specific layers. |\n| Zone index | number | 5 | The specific construction layer (Zone) index to dimension (e.g., framing, sheathing). |\n| Delta text direction | dropdown | None | Controls rotation of the individual segment text (the numbers between ticks). |\n| Cumm text direction | dropdown | Parallel | Controls rotation of the cumulative (total) dimension text. |\n| Dim Style | dropdown | *[DimStyles]* | Selects the visual style (arrows, text size, scale) from the drawing's standard dimension styles. |\n| Color | number | 1 | Sets the CAD color index for the dimension lines and text (1 = Red, etc.). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not use custom right-click menu options. Use the Properties Panel to adjust settings. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not require external settings files.\n\n## Tips\n- **Moving Dimensions:** To move the dimension line, simply click and drag the script's insertion grip in Paper Space.\n- **Zone Filtering:** If you only want to dimension the outer sheathing and not the internal studs, set \"Zones to use\" to \"Use zone index\" and enter the specific Zone index number for your sheathing layer.\n- **Bottom Plates:** The script automatically detects bottom plates to determine the start and end points of the wall dimension.\n\n## FAQ\n- **Q: Why did my dimension disappear?**\n  A: Ensure the selected Viewport is still linked to a valid Element. If the link is broken or the Element is empty, the dimension will not generate.\n- **Q: How do I switch between horizontal and vertical dimensions?**\n  A: Select the script instance, open the Properties (OPM) palette, and change the \"Direction\" property from Horizontal to Vertical.\n- **Q: Can I dimension specific layers (e.g., only the studs)?**\n  A: Yes. Set \"Zones to use\" to \"Use zone index\" and define the \"Zone index\" that corresponds to your stud layer."
      },
      "tokens_used": 6393,
      "error": null
    }
  }
}