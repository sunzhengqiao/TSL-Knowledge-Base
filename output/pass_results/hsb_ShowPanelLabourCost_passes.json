{
  "filename": "hsb_ShowPanelLabourCost.mcr",
  "status": "completed",
  "total_tokens": 38767,
  "processing_time": 238.59024739265442,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "02.03.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.2",
            "date": "25.03.2008",
            "author": "",
            "changes": "BugFix with the area of the Panel"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4474,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Viewport vp = getViewport(\"Select the viewport from which the element is taken\"); _Viewport.append(vp); if (_Viewport.length()==0) return; Element el=vp.element();"
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "A layout (Paper Space) containing a Viewport referencing a valid hsb Element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 4392,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select the viewport from which the element is taken",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Please Pick a Point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension Style",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "psExtType",
            "type": "PropString",
            "displayName": "Code External Walls",
            "defaultValue": "A;B;",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Please type the codes of the external walls separate by ; "
          },
          {
            "index": 0,
            "variable": "dExtPriceOp",
            "type": "PropDouble",
            "displayName": "Price for Opening on External Walls",
            "defaultValue": "3",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dExtPrice",
            "type": "PropDouble",
            "displayName": "Price for External Walls",
            "defaultValue": "2",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dExtPriceGb",
            "type": "PropDouble",
            "displayName": "Price for Gable External Walls",
            "defaultValue": "2",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dExtPriceDm",
            "type": "PropDouble",
            "displayName": "Price for Dormer External Walls",
            "defaultValue": "2",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "psIntType",
            "type": "PropString",
            "displayName": "Code Internal Walls",
            "defaultValue": "I;F;",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Please type the codes of the internal walls separate by ; "
          },
          {
            "index": 4,
            "variable": "dIntPriceOp",
            "type": "PropDouble",
            "displayName": "Price for Opening on Internal Walls",
            "defaultValue": "3",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "dIntPrice",
            "type": "PropDouble",
            "displayName": "Price for Internal Walls",
            "defaultValue": "2",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "dMinHeight",
            "type": "PropDouble",
            "displayName": "Minimun Height",
            "defaultValue": "2000",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "dIntPriceSm",
            "type": "PropDouble",
            "displayName": "Price Internal Wall when less than minimun height",
            "defaultValue": "3",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "dIntPriceGb",
            "type": "PropDouble",
            "displayName": "Price for Gable Internal Walls",
            "defaultValue": "2",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "dIntPriceDm",
            "type": "PropDouble",
            "displayName": "Price for Dormer Internal Walls",
            "defaultValue": "2",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6346,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Calculates and annotates the estimated labor cost for a timber wall panel based on its surface area, geometric type (gable, dormer, standard), height, and the number of openings.\",\n    \"category\": \"Estimation / Reporting\",\n    \"typicalUseCase\": \"Used during the creation of production layouts or shop drawings to automatically label each wall panel with its specific labor cost for project bidding or internal tracking.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sDimStyle\",\n      \"technicalDefault\": \"_DimStyles\",\n      \"businessMeaning\": \"Defines the visual appearance (font, size, arrows) of the dimension text label displaying the cost.\",\n      \"validRange\": \"Any existing Dimension Style name in the drawing\",\n      \"unit\": \"String (Style Name)\",\n      \"affectsOutput\": \"Changes the visual style of the generated text label.\"\n    },\n    {\n      \"name\": \"psExtType\",\n      \"technicalDefault\": \"A;B;\",\n      \"businessMeaning\": \"List of Element Codes (naming convention) that identify a wall as an 'External' wall. If the panel's code matches this list, external rates are used.\",\n      \"validRange\": \"String of semicolon-separated codes (e.g., \\\"A;B;EXT;\\\")\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Determines if 'External' pricing logic is applied to the element.\"\n    },\n    {\n      \"name\": \"dExtPriceOp\",\n      \"technicalDefault\": \"3\",\n      \"businessMeaning\": \"Fixed labor cost for each opening (window/door) cut into an External wall.\",\n      \"validRange\": \"> 0 (Currency units)\",\n      \"unit\": \"Currency / Opening\",\n      \"affectsOutput\": \"Increases total cost based on opening count for External walls.\"\n    },\n    {\n      \"name\": \"dExtPrice\",\n      \"technicalDefault\": \"2\",\n      \"businessMeaning\": \"Standard labor rate per square meter for a flat/standard External wall.\",\n      \"validRange\": \"> 0 (Currency units)\",\n      \"unit\": \"Currency / m²\",\n      \"affectsOutput\": \"Base multiplier for external wall area.\"\n    },\n    {\n      \"name\": \"dExtPriceGb\",\n      \"technicalDefault\": \"2\",\n      \"businessMeaning\": \"Labor rate per square meter for an External Gable wall (detected by presence of angle plates).\",\n      \"validRange\": \"> 0 (Currency units)\",\n      \"unit\": \"Currency / m²\",\n      \"affectsOutput\": \"Multiplier for external gable wall area.\"\n    },\n    {\n      \"name\": \"dExtPriceDm\",\n      \"technicalDefault\": \"2\",\n      \"businessMeaning\": \"Labor rate per square meter for an External Dormer cheek wall (detected by rotated bottom plate).\",\n      \"validRange\": \"> 0 (Currency units)\",\n      \"unit\": \"Currency / m²\",\n      \"affectsOutput\": \"Multiplier for external dormer wall area.\"\n    },\n    {\n      \"name\": \"psIntType\",\n      \"technicalDefault\": \"I;F;\",\n      \"businessMeaning\": \"List of Element Codes that identify a wall as an 'Internal' partition wall.\",\n      \"validRange\": \"String of semicolon-separated codes\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Determines if 'Internal' pricing logic is applied.\"\n    },\n    {\n      \"name\": \"dIntPriceOp\",\n      \"technicalDefault\": \"3\",\n      \"businessMeaning\": \"Fixed labor cost for each opening in an Internal wall.\",\n      \"validRange\": \"> 0 (Currency units)\",\n      \"unit\": \"Currency / Opening\",\n      \"affectsOutput\": \"Increases total cost based on opening count for Internal walls.\"\n    },\n    {\n      \"name\": \"dIntPrice\",\n      \"technicalDefault\": \"2\",\n      \"businessMeaning\": \"Standard labor rate per square meter for a flat/standard Internal wall.\",\n      \"validRange\": \"> 0 (Currency units)\",\n      \"unit\": \"Currency / m²\",\n      \"affectsOutput\": \"Base multiplier for internal wall area.\"\n    },\n    {\n      \"name\": \"dMinHeight\",\n      \"technicalDefault\": \"2000\",\n      \"businessMeaning\": \"Height threshold (in mm). If an internal wall is shorter than this, it is considered a 'short wall' (often harder to handle/erect).\",\n      \"validRange\": \"1000 - 3000 (Typical timber stud heights)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Triggers the use of the 'Short Wall' price rate if the panel height is below this value.\"\n    },\n    {\n      \"name\": \"dIntPriceSm\",\n      \"technicalDefault\": \"3\",\n      \"businessMeaning\": \"Labor rate per square meter for Internal walls that are shorter than the Minimum Height (dMinHeight).\",\n      \"validRange\": \"> 0 (Currency units, usually higher than dIntPrice)\",\n      \"unit\": \"Currency / m²\",\n      \"affectsOutput\": \"Overrides dIntPrice when internal wall height is below dMinHeight.\"\n    },\n    {\n      \"name\": \"dIntPriceGb\",\n      \"technicalDefault\": \"2\",\n      \"businessMeaning\": \"Labor rate per square meter for an Internal Gable wall.\",\n      \"validRange\": \"> 0 (Currency units)\",\n      \"unit\": \"Currency / m²\",\n      \"affectsOutput\": \"Multiplier for internal gable wall area.\"\n    },\n    {\n      \"name\": \"dIntPriceDm\",\n      \"technicalDefault\": \"2\",\n      \"businessMeaning\": \"Labor rate per square meter for an Internal Dormer cheek wall.\",\n      \"validRange\": \"> 0 (Currency units)\",\n      \"unit\": \"Currency / m²\",\n      \"affectsOutput\": \"Multiplier for internal dormer wall area.\"\n    }\n  ],\n  \"parameterDependencies\": [\n   "
      },
      "tokens_used": 7753,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script initializes properties (Dimension Style, Price Lists, Wall Codes) and parses semicolon-separated wall type codes into arrays.",
          "2. [Insertion Phase] Check if _bOnInsert is true.",
          "3. Prompt user: Select a Viewport (getViewport).",
          "4. Prompt user: Pick a Point for text placement (getPoint).",
          "5. Store Viewport and Point in _Viewport and _Pt0, then exit (Script waits for recalculation).",
          "6. [Execution Phase] Retrieve the last selected Viewport from the _Viewport array.",
          "7. Validate Viewport: Check if it contains a valid Element (hsb data). If invalid, script exits.",
          "8. Retrieve Element from Viewport and extract its Coordinate System (CS) and Geometry.",
          "9. Analyze Element Code: Check against 'External Wall' codes (psExtType) and 'Internal Wall' codes (psIntType).",
          "10. [Validation] If Element Code matches neither list, script exits (No price calculated).",
          "11. Collect Beams from Element: Identify Bottom Plates and Angle Plates (Types 54, 55) to determine geometry type.",
          "12. Generate Profile: Create a unified shadow profile of all beams in the element on the XY plane to calculate surface area (dArea).",
          "13. Calculate Dimensions: Determine Height (dHeight) and Length (dLegth) of the panel profile.",
          "14. [Internal Wall Logic] If wall is Internal AND Height < dMinHeight, override the Standard Internal Price with dIntPriceSm (Short Wall Price).",
          "15. Calculate Opening Cost: (Number of Openings) * (Price per Opening).",
          "16. Determine Base Geometry Logic (Conditional Branch):",
          "   a. Check if Bottom Plate exists.",
          "   b. Check alignment (Bottom Plate vs Element Vector) to detect Dormer walls.",
          "   c. Check presence of Angle Plates to detect Gable walls.",
          "17. Apply Price Multiplier based on Geometry (Standard, Gable, Dormer) to the Area.",
          "18. Sum Area Cost and Opening Cost.",
          "19. Draw Text: Format the total cost and display it at the user-picked point using the specified Dimension Style."
        ],
        "conditionalBranches": [
          {
            "condition": "Element Code Classification",
            "path1": {
              "name": "External Wall",
              "steps": [
                "Code found in 'psExtType' list.",
                "Set Price Index to 0.",
                "Use External Price properties (dExtPrice, dExtPriceGb, etc.)."
              ]
            },
            "path2": {
              "name": "Internal Wall",
              "steps": [
                "Code found in 'psIntType' list.",
                "Set Price Index to 1.",
                "Use Internal Price properties (dIntPrice, dIntPriceGb, etc.).",
                "Check height against dMinHeight for short wall surcharge."
              ]
            }
          },
          {
            "condition": "Geometry Detection (Bottom Plate & Angle Plate Check)",
            "path1": {
              "name": "Standard Wall",
              "steps": [
                "Condition: Bottom Plate exists AND is aligned to Element AND NO Angle Plates exist.",
                "OR: NO Bottom Plate exists AND NO Angle Plates exist.",
                "Calculation: Standard Price * Area."
              ]
            },
            "path2": {
              "name": "Gable Wall",
              "steps": [
                "Condition: Angle Plates exist (Type 54 or 55 present).",
                "Note: Takes precedence over alignment for Gable detection if plates exist.",
                "Calculation: Gable Price (dExtPriceGb/dIntPriceGb) * Area."
              ]
            },
            "path3": {
              "name": "Dormer Wall",
              "steps": [
                "Condition: Bottom Plate exists AND is rotated/Not aligned to Element Vector.",
                "Calculation: Dormer Price (dExtPriceDm/dIntPriceDm) * Area."
              ]
            }
          },
          {
            "condition": "Internal Wall Height",
            "path1": {
              "name": "Standard Height",
              "steps": [
                "Condition: dHeight >= dMinHeight.",
                "Calculation: Use dIntPrice."
              ]
            },
            "path2": {
              "name": "Short Wall",
              "steps": [
                "Condition: dHeight < dMinHeight.",
                "Calculation: Use dIntPriceSm (higher price)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "(Implicit) Script execution stops silently.",
            "recovery": "User must re-run script and select a valid viewport."
          },
          {
            "check": "Element Validity (hsb data attached)",
            "errorMessage": "None (Silent Exit)",
            "recovery": "Select a viewport that contains an hsb Element/Assembly."
          },
          {
            "check": "Wall Code Matching",
            "errorMessage": "None (Silent Exit)",
            "recovery": "Edit the Element Code in the hsbCAD properties or update the 'Code External/Internal Walls' script properties to include the element's code."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Dimension Style",
            "how": "OPM (Object Properties Model)",
            "effect": "Updates the visual appearance (font, size, arrows) of the cost label."
          },
          {
            "action": "Adjust Pricing Rates",
            "how": "OPM",
            "effect": "Updates the calculation for Total Cost. Script recalculates on property change, drawing the new value."
          },
          {
            "action": "Update Wall Code Lists",
            "how": "OPM (psExtType, psIntType)",
            "effect": "Allows the script to recognize different element codes as Internal or External without renaming the elements themselves."
          },
          {
            "action": "Move Label",
            "how": "Grip Edit / Drag",
            "effect": "Relocates the text label (_Pt0). Note: The script does not appear to have an associative leader, just absolute positioning."
          }
        ]
      },
      "tokens_used": 7843,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ShowPanelLabourCost.mcr\n\n## Overview\nThis script calculates the estimated labor cost for a wall panel based on its area, number of openings, height, and geometric type (gable, dormer, or standard). It displays the calculated cost as a text label in your Paper Space layout.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for Layouts. |\n| Paper Space | Yes | **Primary Environment.** Requires a Viewport containing an hsb Element. |\n| Shop Drawing | No | Used for estimation layouts, not manufacturing drawings. |\n\n## Prerequisites\n- **Required Entities:** A Viewport on a Layout tab that displays a valid hsbCAD Element (Wall).\n- **Minimum Beam Count:** N/A (Works at the Element level).\n- **Required Settings:** The Element must have a Code (e.g., \"A\", \"I\") that matches the script's \"Code External/Internal Walls\" lists to calculate a price.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsb_ShowPanelLabourCost.mcr` from the list.\n\n### Step 2: Select Viewport\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click on the border of the viewport that contains the wall panel you wish to price.\n```\n\n### Step 3: Pick Text Location\n```\nCommand Line: Please Pick a Point\nAction: Click anywhere in the layout where you want the cost label to appear.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Dimension Style** | dropdown | `_DimStyles` | The visual style (font, size) used for the cost text. |\n| **Code External Walls** | text | `A;B;` | Semicolon-separated list of Element Codes (e.g., `A;B;EXT;`) that identify a wall as \"External\". |\n| **Price for External Walls** | number | `2` | Labor rate per m² for standard external walls. |\n| **Price for Opening on External Walls** | number | `3` | Fixed labor cost per opening (window/door) in external walls. |\n| **Price for Gable External Walls** | number | `2` | Labor rate per m² for external gable walls (detected by angle plates). |\n| **Price for Dormer External Walls** | number | `2` | Labor rate per m² for external dormer cheek walls. |\n| **Code Internal Walls** | text | `I;F;` | Semicolon-separated list of Element Codes that identify a wall as \"Internal\". |\n| **Price for Internal Walls** | number | `2` | Labor rate per m² for standard internal walls. |\n| **Price for Opening on Internal Walls** | number | `3` | Fixed labor cost per opening in internal walls. |\n| **Minimun Height** | number | `2000` | Height threshold in mm. Walls shorter than this trigger the \"Short Wall\" price. |\n| **Price Internal Wall when less than minimun height** | number | `3` | Labor rate per m² for internal walls shorter than the Minimum Height. |\n| **Price for Gable Internal Walls** | number | `2` | Labor rate per m² for internal gable walls. |\n| **Price for Dormer Internal Walls** | number | `2` | Labor rate per m² for internal dormer cheek walls. |\n\n## Right-Click Menu Options\nStandard TSL context menu options apply when the label is selected:\n- **Recalculate:** Updates the cost if the wall geometry or properties change.\n- **Erase:** Removes the label.\n- **Properties:** Opens the Properties palette to adjust pricing or codes.\n\n## Settings Files\n- **Filename:** None used.\n- **Location:** N/A\n- **Purpose:** All configuration is handled directly via the Properties Panel.\n\n## Tips\n- **Matching Codes:** If the cost shows as 0 or nothing appears, check the **Element Code** in the hsbCAD properties. It must exist in the **Code External Walls** or **Code Internal Walls** lists (e.g., if your wall is code \"EXT\", add \"EXT;\" to the list).\n- **Dormer Detection:** Dormer walls are automatically detected if the bottom plate is rotated relative to the element vector. Ensure your geometry is constructed correctly for accurate pricing.\n- **Gable Detection:** The script looks for \"Angle Plates\" (Types 54/55) to identify gables.\n- **Quick Updates:** You can change the unit rates (e.g., `Price for External Walls`) in the Properties palette, and the text label will automatically update to reflect the new total.\n\n## FAQ\n- **Q: Why does my wall have a different price than expected?**\n- **A:** Check the **Height**. If an internal wall is shorter than the **Minimum Height** (default 2000mm), the script applies the higher \"Short Wall\" rate automatically.\n- **Q: Can I use this for floors or roofs?**\n- **A:** No. This script is designed specifically for Wall Panels (Elements) containing beams (studs/plates). It relies on wall-specific geometry like bottom plates.\n- **Q: How do I change the currency symbol?**\n- **A:** This script calculates a raw number. To add a currency symbol (like $ or €), you typically modify the **Dimension Style** (`sDimStyle`) used in AutoCAD to include a prefix or suffix."
      },
      "tokens_used": 7959,
      "error": null
    }
  }
}