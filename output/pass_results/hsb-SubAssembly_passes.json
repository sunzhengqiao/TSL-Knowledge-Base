{
  "filename": "hsb-SubAssembly.mcr",
  "status": "completed",
  "total_tokens": 28611,
  "processing_time": 208.24388313293457,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "16.09.2008",
            "author": "Anno Sportel (as@hsb-cad.com)",
            "changes": "Pilot version"
          },
          {
            "version": "1.1",
            "date": "17.09.2008",
            "author": "Anno Sportel (as@hsb-cad.com)",
            "changes": "remove Beams/Sheets from map after they've bin used"
          },
          {
            "version": "1.2",
            "date": "30.09.2008",
            "author": "Anno Sportel (as@hsb-cad.com)",
            "changes": "Add tsls to the _Entity array"
          },
          {
            "version": "1.3",
            "date": "08.10.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": ""
          },
          {
            "version": "1.4",
            "date": "08.10.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Change the Display Text"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5314,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script iterates through _Map to find model entities (GenBeam, Sheet, TslInst) and uses specific data organization functions setCompareKey() and setSubAssemblyName(). It does not use ShopDrawing prefixes (sd_), viewport handling, or 2D view generation logic typical of Paper Space scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Sheet",
            "TslInst"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 4254,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sName",
            "type": "PropString",
            "displayName": "Name Shopdraw Tag",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3708,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Groups selected timber elements (beams, sheets, and sub-components) into a logical sub-assembly for production management and places a visual identification tag in the 3D model.",
          "category": "Management/Organization",
          "typicalUseCase": "Defining a specific collection of elements (e.g., a roof truss, floor panel section, or pre-assembled wall unit) that should be treated as a single unit in lists, drawings, or export files."
        },
        "parameters": [
          {
            "name": "sName",
            "technicalDefault": "",
            "businessMeaning": "The custom label text displayed on the tag in the 3D model to identify this specific group of elements. It acts as a visual marker for the sub-assembly.",
            "validRange": "Any string (short codes like 'TRUSS-A' or 'WALL-01' recommended)",
            "unit": "Text",
            "affectsOutput": "Changes the text displayed at the script insertion point. If left blank, the text defaults to 'Shopdraw Tag'. Note: This does not change the internal sub-assembly ID generated for data processing."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "Annotation/Text",
            "description": "A text tag drawn at the insertion point to visually represent the sub-assembly grouping.",
            "appliedTo": "Model Space (at _Pt0)"
          }
        ]
      },
      "tokens_used": 4404,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Define tolerance, property strings, and symbol constants.",
          "2. Coordinate System Setup: Define local axes based on the current UCS and visualize the insertion coordinate system.",
          "3. Visualization of Connected Tools: Iterate through tools connected to the insertion beam to find specific 'Nailplate' geometry in attached scripts and draw them.",
          "4. Entity Collection: Iterate through the _Map to find and categorize valid construction elements (Sheets, Beams, TslInsts).",
          "5. Entity Processing: Add found elements to internal arrays (_GenBeam, _Sheet, etc.) and remove them from the _Map to prevent re-processing.",
          "6. Data Sorting: Sort the collected GenBeam array by handle to ensure a consistent order regardless of selection sequence.",
          "7. ID Generation: Concatenate the handles of all collected elements to create a unique 'SubAssemblyName' string.",
          "8. Data Assignment: Set the CompareKey and SubAssemblyName in the script instance and the Map.",
          "9. Visualization: Draw the text tag at the insertion point. Uses the user-defined 'Name Shopdraw Tag' property if present, otherwise defaults to 'Shopdraw Tag'."
        ],
        "conditionalBranches": [
          {
            "condition": "Check if default GenBeam array is empty",
            "path1": {
              "name": "Empty Array",
              "steps": [
                "Append _Beam0 (the insertion beam) to the _GenBeam array."
              ]
            },
            "path2": {
              "name": "Populated Array",
              "steps": [
                "Proceed with existing _GenBeam array content."
              ]
            }
          },
          {
            "condition": "Entity Type Check inside Map Loop",
            "path1": {
              "name": "Sheet or Beam",
              "steps": [
                "Cast to Sheet or Beam, add to specific array, and add to generic GenBeam array."
              ]
            },
            "path2": {
              "name": "TslInst",
              "steps": [
                "Cast to TslInst, add to _Entity array and GenBeam array."
              ]
            },
            "path3": {
              "name": "Other Entity",
              "steps": [
                "Ignore and continue to next entity."
              ]
            }
          },
          {
            "condition": "User Input for Tag Name (sName)",
            "path1": {
              "name": "Value Provided",
              "steps": [
                "Display the text defined in the 'Name Shopdraw Tag' property."
              ]
            },
            "path2": {
              "name": "Empty Value",
              "steps": [
                "Display the default text 'Shopdraw Tag'."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Validity",
            "errorMessage": "None (Internal Logic)",
            "recovery": "The script checks `gBm.bIsValid()` and `tsl.bIsValid()` internally. Invalid entities are skipped during processing to prevent runtime errors."
          },
          {
            "check": "Entity Kind",
            "errorMessage": "None (Internal Logic)",
            "recovery": "The script uses `bIsKindOf` to filter entities. Only Sheets, Beams, and TslInsts are processed; all other types found in the Map are ignored."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Tag Name",
            "how": "OPM (Object Properties Manager)",
            "effect": "Changing the 'Name Shopdraw Tag' property and recalculating updates the text displayed in the 3D model at the insertion point."
          },
          {
            "action": "Recalculate Script",
            "how": "Right-click context menu (Recalc)",
            "effect": "Re-scans the map for entities, re-generates the internal unique SubAssembly ID based on current handles, and updates the visual tag."
          },
          {
            "action": "Move Tag",
            "how": "Grip Edit / Move",
            "effect": "Moving the script instance (_Pt0) relocates the text tag in the model."
          }
        ]
      },
      "tokens_used": 5511,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb-SubAssembly\n\n## Overview\nGroups selected timber elements (beams, sheets, and sub-components) into a logical sub-assembly for production management and places a visual identification tag in the 3D model.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D model entities (GenBeams, Sheets, TslInsts). |\n| Paper Space | No | Not designed for 2D drawing generation. |\n| Shop Drawing | No | Does not generate shop drawing views. |\n\n## Prerequisites\n- **Required Entities**: At least one GenBeam, Sheet, or TslInst (Script Instance) must be present to serve as the host or group member.\n- **Minimum Beam Count**: 1 (Host beam).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or `TSLINST` for grouping multiple entities)\n```\nAction: Browse and select 'hsb-SubAssembly.mcr'.\n```\n\n### Step 2: Select Entities\n```\nCommand Line: Select beam:\nAction: Click on the primary GenBeam to host the script.\nNote: To group multiple specific elements, use the 'TSLINST' command, select all desired beams/sheets, and then select this script.\n```\n\n### Step 3: Set Insertion Point\n```\nCommand Line: Insertion point:\nAction: Click in the model space to place the sub-assembly tag.\n```\n\n### Step 4: Configure Label (Optional)\n```\nAction: Select the inserted script instance. Open the Properties (OPM) palette. Enter a custom name in the 'Name Shopdraw Tag' field.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Name Shopdraw Tag | Text | (Empty) | The custom label text displayed on the tag in the 3D model. If left empty, the tag displays \"Shopdraw Tag\". Use short codes like 'TRUSS-A' for clarity. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalc | Re-scans the associated elements and regenerates the internal unique SubAssembly ID. Use this if the grouped elements have changed. |\n\n## Settings Files\nNone required. The script relies on internal logic and entity properties.\n\n## Tips\n- **Grouping Multiple Elements**: While you can insert the script on a single beam, this script is most powerful when used with the `TSLINST` command. Select all the beams, sheets, and components you want to group, then run `TSLINST` and select `hsb-SubAssembly.mcr`. This ensures all selected items are included in the sub-assembly map.\n- **Visual Identification**: The text tag serves as a visual marker in the 3D model. Ensure the insertion point is chosen where it does not clash with other geometry.\n- **Unique IDs**: The script automatically generates a unique internal ID based on the handles of the grouped elements. This ID is used for data processing, while the \"Name Shopdraw Tag\" is for human-readable labeling.\n\n## FAQ\n- **Q: Why does my tag show \"Shopdraw Tag\" instead of my text?**\n  - A: Ensure you have entered a value in the \"Name Shopdraw Tag\" property in the Properties Palette and that the script has been recalculated.\n- **Q: Can I move the tag after insertion?**\n  - A: Yes. Use standard AutoCAD move commands or grip-edit the script insertion point to relocate the tag without affecting the logical grouping of the timber elements.\n- **Q: How do I add more beams to an existing sub-assembly?**\n  - A: You typically need to delete the script instance and re-run the insertion (`TSLINST`) selecting the new set of elements, or use the specific hsbCAD map manipulation tools if available in your environment."
      },
      "tokens_used": 5420,
      "error": null
    }
  }
}