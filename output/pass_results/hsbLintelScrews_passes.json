{
  "filename": "hsbLintelScrews.mcr",
  "status": "completed",
  "total_tokens": 49739,
  "processing_time": 345.3513433933258,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": \"\",\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"This TSL allows the user to apply a screw fastener connecting headers/lintels and king stud/ jamb stud. For tooling, if the diameter is set as 0 than the screw thread diameter is used. A size greater than 0 will overwrite the the tool diameter size. If the depth is set as 0 tooling is only applied to king stud/ jamb stud. If set as -1 then the screw length is used. A size greater than 0 will extend"
      },
      "tokens_used": 9147,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates on GenBeam entities (bm0, bm1) retrieved via getGenBeam, interacts with Body geometry, and adds tools (Drill) to the beams. There are no Paper Space indicators (sd_*, #Type E, Viewport) present. The insertion logic (getGenBeam) and geometric transformations are standard Model Space operations."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space containing two valid beams (Header/Lintel and Stud) to connect.",
          "requiredSettings": [
            "ScrewCatalog.xml"
          ]
        }
      },
      "tokens_used": 5696,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getGenBeam",
              "promptOriginal": "|Select entities|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getGenBeam",
              "promptOriginal": "|Select entities|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "SelectOption",
            "trigger": "During Insertion (Manufacturer Selection)",
            "title": "Select Manufacturer",
            "dataSource": "ScrewCatalog.xml",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sManufacturer",
            "type": "PropString",
            "displayName": "Manufacturer",
            "defaultValue": "---",
            "inputType": "dropdown",
            "options": "Populated from ScrewCatalog.xml",
            "category": "Component",
            "description": "Defines the Manufacturer"
          },
          {
            "index": 1,
            "variable": "sFamily",
            "type": "PropString",
            "displayName": "Family",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "Populated dynamically based on Manufacturer",
            "category": "Component",
            "description": "Defines the Family"
          },
          {
            "index": 2,
            "variable": "sProduct",
            "type": "PropString",
            "displayName": "Product",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "Populated dynamically based on Family",
            "category": "Component",
            "description": "Defines the Product"
          },
          {
            "index": 3,
            "variable": "dAngle",
            "type": "PropDouble",
            "displayName": "Angle",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Alignment",
            "description": "Defines the inclination Angle of the Screw"
          },
          {
            "index": 0,
            "variable": "nQuantity",
            "type": "PropInt",
            "displayName": "Quantity",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": "Alignment",
            "description": "Defines the nr. of Screws"
          },
          {
            "index": 4,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Offset",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Alignment",
            "description": "Defines the Offset between Screws"
          },
          {
            "index": 3,
            "variable": "sDrill",
            "type": "PropString",
            "displayName": "Drill",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Drill",
            "description": "Defines the Drill"
          },
          {
            "index": 5,
            "variable": "dDiameterDrill",
            "type": "PropDouble",
            "displayName": "Diameter",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Drill",
            "description": "Defines the DiameterDrill"
          },
          {
            "index": 6,
            "variable": "dLengthDrill",
            "type": "PropDouble",
            "displayName": "Depth",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Drill",
            "description": "Defines the extra Length of the Drill"
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "ScrewCatalog.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings"
            ],
            "purpose": "Stores screw manufacturer, family, product data and dimensions.",
            "required": true
          }
        ]
      },
      "tokens_used": 7968,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts and configures screw fasteners to connect lintels (headers) to king studs or jamb studs, including visual representation and CNC drilling/machining.",
          "category": "Hardware",
          "typicalUseCase": "When a user needs to secure a lintel beam to a vertical stud using a specific timber screw (e.g., ASSY, SPAX), requiring both the 3D model visualization for BOM and the drilling tools for manufacturing."
        },
        "parameters": [
          {
            "name": "sManufacturer",
            "technicalDefault": "---",
            "businessMeaning": "Selects the brand of the screw fastener (e.g., 'Wurth', 'Simpson Strong-Tie', 'Mungo').",
            "validRange": "List provided in ScrewCatalog.xml",
            "unit": "String (Enum)",
            "affectsOutput": "Filters the available 'Family' and 'Product' lists. Determines the specific geometry and drilling data to be applied."
          },
          {
            "name": "sFamily",
            "technicalDefault": "",
            "businessMeaning": "Selects the product line or series of the screw (e.g., 'ASSY 3.0', 'VGU').",
            "validRange": "Dynamic based on Manufacturer",
            "unit": "String (Enum)",
            "affectsOutput": "Filters the available 'Product' list."
          },
          {
            "name": "sProduct",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific screw SKU/size (e.g., '8x160', '12x240').",
            "validRange": "Dynamic based on Family",
            "unit": "String (Enum)",
            "affectsOutput": "Determines the actual screw length and diameter for 3D visualization and BOM (Hardware List)."
          },
          {
            "name": "dAngle",
            "technicalDefault": "0",
            "businessMeaning": "The inclination angle of the screw relative to the beam surface. 0 is typically perpendicular.",
            "validRange": "0 to 90 degrees",
            "unit": "degrees",
            "affectsOutput": "Rotates the screw geometry and the drill path. Changes the entry and exit points on the beams."
          },
          {
            "name": "nQuantity",
            "technicalDefault": "1",
            "businessMeaning": "The desired number of screws to be placed.",
            "validRange": "1 to 10 (practical limit)",
            "unit": "count",
            "affectsOutput": "Calculates the distribution of screws. If an odd number, one screw is centered; others are distributed symmetrically. Adds multiple items to the BOM."
          },
          {
            "name": "dOffset",
            "technicalDefault": "0",
            "businessMeaning": "The spacing distance between multiple screws along the lintel/stud face.",
            "validRange": "40mm to 600mm (dependent on beam width and structural requirements)",
            "unit": "mm",
            "affectsOutput": "Determines the linear distance between the centers of multiple screws."
          },
          {
            "name": "sDrill",
            "technicalDefault": "No",
            "businessMeaning": "Enables or disables the creation of CNC drill/machining operations for the screw holes.",
            "validRange": "No, Yes",
            "unit": "Boolean",
            "affectsOutput": "If 'Yes', adds Drill operations to the beams in the CAD model for production data."
          },
          {
            "name": "dDiameterDrill",
            "technicalDefault": "0",
            "businessMeaning": "The diameter of the drill hole. If 0, it defaults to the screw's thread diameter. If > 0, it overrides with a custom size.",
            "validRange": "0 (Auto) or 5mm to 30mm",
            "unit": "mm",
            "affectsOutput": "Changes the diameter of the Drill operation added to the beams."
          },
          {
            "name": "dLengthDrill",
            "technicalDefault": "0",
            "businessMeaning": "Controls the depth of the drill. 0 = drill only through the stud (target). -1 = drill to full screw length. >0 = extends the drill beyond the stud by this amount.",
            "validRange": "-1 (Full Length), 0 (Stud only), or >0 (Overdrill in mm)",
            "unit": "mm",
            "affectsOutput": "Determines the endpoint of the drill operation. Affects whether the lintel is drilled (default 0 usually drills through stud into lintel based on screw length)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sManufacturer changes",
            "effect": "Updates the list of available Families based on the XML catalog.",
            "cascade": [
              "sFamily",
              "sProduct"
            ]
          },
          {
            "trigger": "sFamily changes",
            "effect": "Updates the list of available Products based on the XML catalog.",
            "cascade": [
              "sProduct"
            ]
          },
          {
            "trigger": "sProduct changes",
            "effect": "Retrieves specific dimensions (Length/Diameter) for the BOM and visualization. Defaults Drill Diameter if dDiameterDrill is 0.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Body (Visual)",
            "description": "A 3D cylinder representing the screw fastener.",
            "appliedTo": "Model Space, positioned between Header/Lintel and Stud."
          },
          {
            "type": "Drill",
            "description": "CNC machining operation representing the hole for the screw.",
            "appliedTo": "King Stud/Jamb Stud (and potentially Header/Lintel depending on depth settings)."
          },
          {
            "type": "HardWrComp",
            "description": "Hardware component entry for BOM/Hardware list.",
            "appliedTo": "Linked to the main beam element."
          }
        ]
      },
      "tokens_used": 9156,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Load & Settings Initialization",
          "Read ScrewCatalog.xml (Company or Install path)",
          "Validate Manufacturer Data in XML",
          "User invokes script insertion (Command or Catalog)",
          "Check Insert Cycle (Cycle > 1 = Abort/Delete)",
          "Parse Execute Key (Catalog or Direct Command)",
          "Manufacturer Selection (via Dialog if not in Key)",
          "Entity Selection (Select Lintel/Header beam)",
          "Entity Selection (Select Stud beam)",
          "Filter/Sort beams to identify Lintel (bm1) and Stud (bm0)",
          "Beam Orientation Check (Vertical vs Horizontal)",
          "Parameter Calculation (Angles, Offsets, Distribution)",
          "Screw Distribution Logic (Odd vs Even Quantity)",
          "Generate Visual Body (Screw Geometry)",
          "Generate CNC Tools (Drills) if Enabled",
          "Create/Update Hardware Component (BOM Entry)",
          "Finalize & Draw"
        ],
        "conditionalBranches": [
          {
            "condition": "Catalog Execution Mode",
            "path1": {
              "name": "Catalog Load",
              "steps": [
                "Parse _kExecuteKey",
                "Load properties from Catalog",
                "Skip Manufacturer Dialog",
                "Proceed to Entity Selection"
              ]
            },
            "path2": {
              "name": "Manual Insert",
              "steps": [
                "Show Manufacturer Dialog (SelectOption)",
                "User selects Manufacturer",
                "User selects Family (if available)",
                "User selects Product (if available)",
                "Proceed to Entity Selection"
              ]
            }
          },
          {
            "condition": "Beam Orientation (Vertical vs Horizontal)",
            "path1": {
              "name": "Standard (Lintel/Stud)",
              "steps": [
                "Identify Stud as Vertical Beam",
                "Identify Lintel as Horizontal Beam",
                "Calculate screws vertically distributed on Lintel face"
              ]
            },
            "path2": {
              "name": "Alternative (Two Vertical Beams)",
              "steps": [
                "Both beams vertical (e.g., post connection)",
                "Orientation logic handles based on vector comparison",
                "Screws distributed based on calculated coordinate system"
              ]
            }
          },
          {
            "condition": "Screw Quantity Parity",
            "path1": {
              "name": "Odd Quantity",
              "steps": [
                "Place 1 center screw",
                "Distribute remaining (N-1)/2 on left",
                "Distribute remaining (N-1)/2 on right",
                "Update actual quantity if intersection fails"
              ]
            },
            "path2": {
              "name": "Even Quantity",
              "steps": [
                "Distribute N/2 on left (offset by half offset)",
                "Distribute N/2 on right (offset by half offset)",
                "Update actual quantity if intersection fails",
                "If 0 placed, set loops=2 and retry"
              ]
            }
          },
          {
            "condition": "Drill Depth Setting (dLengthDrill)",
            "path1": {
              "name": "0 (Standard)",
              "steps": [
                "Tool applied to Stud (bm0)",
                "Tool applied to Lintel (bm1)"
              ]
            },
            "path2": {
              "name": "-1 (Full Length)",
              "steps": [
                "Calculate drill length based on screw geometry",
                "Tool applied to Stud (bm0)",
                "Tool applied to Lintel (bm1)"
              ]
            },
            "path3": {
              "name": "> 0 (Extended)",
              "steps": [
                "Extend drill path by dLengthDrill amount",
                "Tool applied to Stud (bm0)",
                "Tool applied to Lintel (bm1)"
              ]
            }
          },
          {
            "condition": "Drill Enabled (sDrill == 'Yes')",
            "path1": {
              "name": "Yes",
              "steps": [
                "Check Drill Diameter (0 = use screw thread diam)",
                "Create Drill operation",
                "Add to bm0",
                "Add to bm1"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skip Tool generation",
                "Only generate Body"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Manufacturer Data Availability",
            "errorMessage": "Could not find manufacturer data. Tool will be deleted.",
            "recovery": "Ensure ScrewCatalog.xml exists in Company or Install TSL\\Settings folder and contains valid manufacturer data."
          },
          {
            "check": "Beam Selection Count",
            "errorMessage": "Script requires 2 valid beams.",
            "recovery": "Select two beams (Header and Stud) during insertion."
          },
          {
            "check": "Beam Intersection / Geometry Validity",
            "errorMessage": "Screws not placed (intersection fail) or Orientation mismatch.",
            "recovery": "Ensure beams intersect or are adjacent correctly. Check beam orientations (Vertical Stud vs Horizontal Lintel)."
          },
          {
            "check": "Settings Version Mismatch",
            "errorMessage": "Notice shown: 'A different Version of the settings has been found...'",
            "recovery": "Update XML or check version compatibility. Script continues with current version."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Manufacturer/Family/Product",
            "how": "OPM Properties Palette (Dropdowns)",
            "effect": "Updates screw dimensions, visual representation, and BOM data. Triggers recalculation."
          },
          {
            "action": "Adjust Angle",
            "how": "OPM Properties Palette (Angle)",
            "effect": "Rotates the screw geometry and drill path relative to the beam surface."
          },
          {
            "action": "Modify Quantity and Offset",
            "how": "OPM Properties Palette",
            "effect": "Re-distributes the screws. Adjusts spacing between screws. Handles odd/even logic automatically."
          },
          {
            "action": "Toggle Drill & Adjust Depth/Diameter",
            "how": "OPM Properties Palette",
            "effect": "Adds or removes CNC Drill operations. Changes hole size or depth strategy."
          },
          {
            "action": "Move Script Instance",
            "how": "Grip Edit / Move",
            "effect": "Script recalculates screw positions relative to the new beam intersection/geometry."
          }
        ]
      },
      "tokens_used": 10564,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbLintelScrews.mcr\n\n## Overview\nThis script inserts and configures screw fasteners to connect lintels (headers) to king studs or jamb studs. It generates the 3D screw visualization, adds the hardware to the BOM, and optionally creates CNC drill holes for manufacturing.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D beam entities. |\n| Paper Space | No | Not supported for detailing views. |\n| Shop Drawing | No | Not supported for 2D drawings. |\n\n## Prerequisites\n- **Required Entities**: Two GenBeam entities (a Header/Lintel and a Stud).\n- **Minimum Beam Count**: 2\n- **Required Settings**: `ScrewCatalog.xml` (Must be located in `TSL\\Settings` in your Company or Install folder).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsbLintelScrews.mcr` from the list and click OK.\n\n### Step 2: Select Manufacturer\nA dialog box will appear titled \"Select Manufacturer\".\n- **Action**: Choose the desired screw manufacturer (e.g., Wurth, Simpson) from the list.\n- **Action**: If prompted, select the specific **Family** and **Product** (size) from the subsequent drop-downs.\n\n### Step 3: Select Lintel/Header\n```\nCommand Line: |Select entities|\nAction: Click on the horizontal Lintel or Header beam.\n```\n\n### Step 4: Select Stud\n```\nCommand Line: |Select entities|\nAction: Click on the vertical King Stud or Jamb Stud beam.\n```\n\n*(Note: The script will automatically attempt to identify which beam is the lintel and which is the stud based on orientation.)*\n\n### Step 5: Configuration\nAfter insertion, select the script instance and adjust properties in the **Properties Palette** (Ctrl+1) as needed.\n\n---\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Manufacturer** | dropdown | \"---\" | Selects the screw brand. Populated from `ScrewCatalog.xml`. |\n| **Family** | dropdown | \"\" | Selects the product series (e.g., ASSY 3.0). Updates based on Manufacturer. |\n| **Product** | dropdown | \"\" | Selects the specific screw SKU/size (e.g., 8x160). Updates based on Family. |\n| **Angle** | number | 0 | The inclination angle of the screw in degrees (0° is typically perpendicular to the surface). |\n| **Quantity** | integer | 1 | The number of screws to place. Screws are distributed automatically based on the Offset. |\n| **Offset** | number | 0 | The spacing distance between multiple screws (in mm). |\n| **Drill** | dropdown | No | Set to \"Yes\" to generate CNC drill operations for the screw holes. |\n| **Diameter** | number | 0 | The drill hole diameter. **0** = Use screw thread diameter. **>0** = Custom diameter size. |\n| **Depth** | number | 0 | The length of the drill operation. **0** = Drill through Stud only. **-1** = Drill full screw length. **>0** = Extend drill by specific mm amount. |\n\n---\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add specific custom context menu options. Use the Properties Palette to modify settings. |\n\n---\n\n## Settings Files\n- **Filename**: `ScrewCatalog.xml`\n- **Location**: `_kPathHsbCompany\\TSL\\Settings` or `_kPathHsbInstall\\Content\\General\\TSL\\Settings`\n- **Purpose**: This XML file contains the database of available screw manufacturers, families, products, and their geometric dimensions.\n\n---\n\n## Tips\n- **Drill Diameter**: Leave the **Diameter** set to `0` to automatically use the screw's correct thread diameter for the drill hole.\n- **Drill Depth**: Set **Depth** to `-1` if you want the drill hole to match the exact length of the screw selected in the Product catalog.\n- **Multiple Screws**: When increasing **Quantity**:\n  - **Even Number**: Screws are distributed symmetrically to the left and right of the center point.\n  - **Odd Number**: One screw is placed in the center, and the rest are distributed symmetrically.\n- **Updating Catalog**: If the Manufacturer dropdown is empty, check that `ScrewCatalog.xml` exists in your Company settings folder.\n\n---\n\n## FAQ\n- **Q: I placed the script, but I don't see any drill holes in my CNC data?**\n  **A:** Check the Properties Palette. Ensure the **Drill** property is set to \"Yes\".\n\n- **Q: How do I drill through both the stud and the lintel?**\n  **A:** Set the **Depth** property to a value greater than 0 that ensures the drill passes through the combined thickness of both materials, or set it to -1 (Full Length) if the screw length is sufficient to penetrate both.\n\n- **Q: The screw looks like it is floating or intersecting incorrectly.**\n  **A:** Check the **Angle** property. If the beams are not perfectly orthogonal, you may need to adjust the angle slightly to ensure the screw penetrates correctly."
      },
      "tokens_used": 7208,
      "error": null
    }
  }
}