{
  "filename": "hsb_CreateModule.mcr",
  "status": "completed",
  "total_tokens": 23426,
  "processing_time": 288.31946325302124,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [
          "Abbund\\Materials.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 2342,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select Beam() entities and modifies their physical properties (setModule, setMaterial, setGrade). It does not reference Viewports, Sheets, or use ShopDrawing specific APIs (sd_* or _Entity[] with Type E). The function setModule is typically used to group 3D model elements."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Abbund\\Materials.xml"
          ]
        }
      },
      "tokens_used": 2774,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialogOnce",
              "promptOriginal": "Properties Palette",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select beams",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowNotice",
            "trigger": "Materials.xml not found",
            "title": "Notice",
            "dataSource": "Code",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sName",
            "type": "PropString",
            "displayName": "Name",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Beam properties for module",
            "description": null
          },
          {
            "index": 1,
            "variable": "sMaterial",
            "type": "PropString",
            "displayName": "Material",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "Loaded from Abbund\\Materials.xml (Excludes DEFAULT)"
            ],
            "category": "Beam properties for module",
            "description": null
          },
          {
            "index": 2,
            "variable": "sGrade",
            "type": "PropString",
            "displayName": "Grade",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Beam properties for module",
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": "Beam properties for module",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "Abbund\\Materials.xml",
            "searchPaths": [
              "_kPathHsbCompany"
            ],
            "purpose": "Provides the list of available materials for the Material property dropdown.",
            "required": true
          }
        ]
      },
      "tokens_used": 4459,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Groups selected beams into a logical module and standardizes their material, grade, and visual properties.",
          "category": "DataManagement",
          "typicalUseCase": "Used when a user needs to bundle a collection of beams (e.g., a wall panel or truss) into a single assembly for export or processing, and ensure all components share consistent material specifications and a module identifier."
        },
        "parameters": [
          {
            "name": "sName",
            "technicalDefault": "\"\"",
            "businessMeaning": "The specific label or identifier assigned to the individual beams. Used for sorting or labeling in drawings and reports.",
            "validRange": "Any alphanumeric string (Text)",
            "unit": "Text",
            "affectsOutput": "Updates the 'Name' attribute of the selected beams, affecting labels and BOM descriptions."
          },
          {
            "name": "sMaterial",
            "technicalDefault": "First item in list",
            "businessMeaning": "Defines the wood species or product type (e.g., C24, GL24h, Kerto-S) of the timber elements.",
            "validRange": "Restricted to values defined in Abbund\\Materials.xml (excluding 'DEFAULT')",
            "unit": "Text",
            "affectsOutput": "Updates the 'Material' property, which influences structural calculations, machining optimizations, and BOMs."
          },
          {
            "name": "sGrade",
            "technicalDefault": "\"\"",
            "businessMeaning": "The structural strength grade or quality class of the timber (e.g., C24, GL28h).",
            "validRange": "Standard timber grades (e.g., C14, C24, GL24h)",
            "unit": "Text",
            "affectsOutput": "Updates the 'Grade' property on the beam, critical for structural engineering data."
          },
          {
            "name": "nColor",
            "technicalDefault": "2",
            "businessMeaning": "The visual display color of the beams in the CAD model, used for visual distinction or status indication.",
            "validRange": "1-255 (AutoCAD Color Index)",
            "unit": "ACI (AutoCAD Color Index)",
            "affectsOutput": "Changes the graphical color of the selected beams in the 3D model and 2D views."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Script Initialization",
            "effect": "Reads Abbund\\Materials.xml to populate the available options for the Material dropdown.",
            "cascade": [
              "sMaterial"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam Attributes",
            "description": "Modifies existing beam properties: sets a common Module ID (based on the first beam's handle), updates Name, Material, Grade, and Color.",
            "appliedTo": "Beams selected by the user during execution."
          }
        ]
      },
      "tokens_used": 4545,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script initialization and search for configuration file (Abbund\\Materials.xml).",
          "2. If configuration file is missing, display error notice and terminate script.",
          "3. If configuration file is found, parse XML to populate the 'Material' property dropdown list.",
          "4. Define Properties Palette (OPM) fields: Name, Material, Grade, and Color.",
          "5. Trigger 'ShowDialogOnce' to focus the Properties Palette for user input.",
          "6. Prompt user to select beams using the 'Select beams' command line input.",
          "7. Check if user successfully selected one or more beams.",
          "8. If no beams selected, erase instance and terminate.",
          "9. If beams selected, generate a unique Module Name based on the first beam's handle.",
          "10. Iterate through all selected beams to update properties.",
          "11. Apply Name, Material, and Grade if fields are not empty.",
          "12. Always apply the generated Module Name and the specified Color.",
          "13. Erase the script instance from the drawing."
        ],
        "conditionalBranches": [
          {
            "condition": "Configuration File Availability",
            "path1": {
              "name": "File Found",
              "steps": [
                "Read XML file",
                "Parse 'MATERIAL[]' list",
                "Populate dropdown options",
                "Proceed to insertion phase"
              ]
            },
            "path2": {
              "name": "File Not Found",
              "steps": [
                "Display 'Materials not been set' notice",
                "Call eraseInstance()",
                "Stop script execution"
              ]
            }
          },
          {
            "condition": "User Selection",
            "path1": {
              "name": "Valid Selection (Count >= 1)",
              "steps": [
                "Generate Module ID from first beam handle",
                "Apply properties to all selected beams",
                "Erase script instance"
              ]
            },
            "path2": {
              "name": "Invalid/Empty Selection (Count < 1)",
              "steps": [
                "Call eraseInstance()",
                "Stop script execution (no changes made)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of 'Abbund\\Materials.xml' in the Company folder",
            "errorMessage": "Materials not been set, please run hsbMaterial Utility or contact SupportDesk",
            "recovery": "Run the hsbMaterial utility to generate the file or restore the missing XML file to the correct directory."
          },
          {
            "check": "Beam selection count is greater than zero",
            "errorMessage": "(None, script exits silently)",
            "recovery": "Re-run the script and ensure at least one beam is selected during the prompt."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None",
            "how": "N/A",
            "effect": "The script calls eraseInstance() at the end of the execution, removing itself from the drawing. The script cannot be re-edited after insertion; the changes to the beams are finalized immediately."
          }
        ]
      },
      "tokens_used": 4644,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_CreateModule.mcr\n\n## Overview\nGroups selected beams into a logical module and standardizes their material, grade, and visual properties.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D beam elements. |\n| Paper Space | No | Not designed for layout space. |\n| Shop Drawing | No | Not designed for generating views. |\n\n## Prerequisites\n- **Required entities**: Beams (GenBeam).\n- **Minimum beam count**: 1 or more.\n- **Required settings files**: `Abbund\\Materials.xml` (must exist in the Company folder).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_CreateModule.mcr`\n\n### Step 2: Configure Properties\n```\nAction: The Properties Palette (OPM) opens automatically.\n1. Enter a Name for the beams (optional).\n2. Select a Material from the dropdown list.\n3. Enter a Grade (e.g., C24).\n4. Set the Color index (default is Yellow/2).\n```\n\n### Step 3: Select Beams\n```\nCommand Line: Select beams\nAction: Click on the beams you wish to group and modify in the model. \nPress Enter or Right-click to confirm selection.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Name | Text | \"\" | Assigns a specific name label to the beams for reports or drawings. |\n| Material | dropdown | (First in list) | Defines the wood species or product type. List is loaded from your company materials file. |\n| Grade | Text | \"\" | Defines the structural strength grade (e.g., C24, GL24h). |\n| Color | Number | 2 | Sets the AutoCAD display color (1-255) for the selected beams. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add persistent right-click menu options as it deletes itself after running. |\n\n## Settings Files\n- **Filename**: `Abbund\\Materials.xml`\n- **Location**: Company folder (`_kPathHsbCompany`)\n- **Purpose**: Provides the list of available materials for the Material property dropdown.\n\n## Tips\n- Ensure you have run the `hsbMaterial` utility previously; otherwise, the script will fail to find the materials list.\n- The script assigns a Module ID based on the first beam selected, linking them logically in the database.\n- The script instance erases itself immediately after execution; you cannot edit the script properties later, only the modified beams.\n\n## FAQ\n- **Q: Why does the script disappear after I select the beams?**\n  A: This is a \"run-once\" script. It applies the changes to the beams and then removes itself from the drawing to keep the file size optimized.\n\n- **Q: I get a notice \"Materials not been set\". What do I do?**\n  A: The script cannot find `Abbund\\Materials.xml`. Run the `hsbMaterial` utility to generate the required settings file or contact your support desk to restore the file."
      },
      "tokens_used": 4662,
      "error": null
    }
  }
}