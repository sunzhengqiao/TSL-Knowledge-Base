{
  "filename": "hsb_Element Code.mcr",
  "status": "completed",
  "total_tokens": 29760,
  "processing_time": 590.6497938632965,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "23.10.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "First version"
          },
          {
            "version": "1.2",
            "date": "20.02.2013",
            "author": "Chirag Sawjani (csawjani@itw-industry.com)",
            "changes": "Bugfix, check on _Element length before executing code or else erase instance."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3948,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script targets ElementWallSF entities and uses 3D coordinate systems (CoordSys, Vector3d) to position text. It lacks 'sd_' or 'Multipage' prefixes, does not use '#Type E', does not reference _Viewport or _kPaperSpace, and utilizes eraseInstance/dbCreate logic typical of ModelSpace TSLs that attach to Elements."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 2236,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Please select Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Property Dialog",
            "trigger": "showDialogOnce() on Insert",
            "title": null,
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 130,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nOffset",
            "type": "PropDouble",
            "displayName": "Offset from Wall",
            "defaultValue": 250,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nOffsetX",
            "type": "PropDouble",
            "displayName": "Offset btw Lines",
            "defaultValue": 150,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dRotation",
            "type": "PropDouble",
            "displayName": "Set Rotation",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDispRepHead",
            "type": "PropString",
            "displayName": "Disp Rep Header",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5305,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates and positions a text label on wall elements (ElementWallSF) displaying their subtype, dimensions, and operation info based on a specific naming convention.",
          "category": "Annotation / Drafting",
          "typicalUseCase": "Labeling individual wall panels or lintels in the 3D model to display key identifying information (like Model Code and Size) directly on the geometry for visual verification or export."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Selects the CAD dimension style (font, text size, arrow style) used to display the element label.",
            "validRange": "Any existing DimStyle definition in the current drawing",
            "unit": "String (Name)",
            "affectsOutput": "Changes the font, height, and visual appearance of the generated text label."
          },
          {
            "name": "nColor",
            "technicalDefault": "130",
            "businessMeaning": "The color of the generated text label.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the display color of the label to contrast with the element or background."
          },
          {
            "name": "nOffset",
            "technicalDefault": "250",
            "businessMeaning": "The distance from the element surface where the label is placed. Acts as the standoff distance for standard elements.",
            "validRange": "0 - 2000 mm",
            "unit": "mm",
            "affectsOutput": "Moves the label closer to or further from the wall face along the normal vector."
          },
          {
            "name": "nOffsetX",
            "technicalDefault": "150",
            "businessMeaning": "The standoff distance used specifically when the element's description contains detailed operation info (indicated by a '/' character).",
            "validRange": "0 - 2000 mm",
            "unit": "mm",
            "affectsOutput": "Overrides 'nOffset' to position the label when specific element types (e.g., lintels with complex names) are detected."
          },
          {
            "name": "dRotation",
            "technicalDefault": "0",
            "businessMeaning": "The rotation angle of the label around the element's vertical (Z) axis.",
            "validRange": "0 - 360 degrees",
            "unit": "degrees",
            "affectsOutput": "Rotates the text label relative to the element's alignment."
          },
          {
            "name": "sDispRepHead",
            "technicalDefault": "",
            "businessMeaning": "The Display Representation filter (e.g., '_3D', '_Plan') that controls in which views the label is visible.",
            "validRange": "Valid Display Representation names in the hsbCAD template",
            "unit": "String",
            "affectsOutput": "Restricts label visibility to specific view configurations or shows it in all views if empty."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Element Description contains a '/' character",
            "effect": "The script uses nOffsetX instead of nOffset to calculate the label's position.",
            "cascade": [
              "nOffsetX"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text / Annotation",
            "description": "A text entity displaying the Element Model, Size, and Description (e.g., 'MODEL/SIZE<LintelDesc>') generated from the element's subtype property.",
            "appliedTo": "The selected ElementWallSF entities."
          }
        ]
      },
      "tokens_used": 6011,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User launches script command.",
          "2. Script checks for recursive insertion (insertCycleCount > 1); if true, script erases self and stops.",
          "3. Properties Dialog (showDialogOnce) appears for user configuration (Dimstyle, Color, Offsets, Rotation).",
          "4. Command line prompt requests selection of ElementWallSF entities.",
          "5. If user selects elements and confirms (ssE.go()):",
          "   a. Script loops through each selected Element.",
          "   b. Script checks if an instance of this script already exists on the element.",
          "   c. If an old instance exists, it is deleted (dbErase).",
          "   d. A new instance of the script is attached (dbCreate) to the element with current properties.",
          "6. The master 'insert' instance erases itself.",
          "7. Each attached instance executes:",
          "   a. Retrieves the host Element and sets dependency (updates if element changes).",
          "   b. Calculates the coordinate system (origin, X-vector, Z-vector) applying 'dRotation'.",
          "   c. Parses the Element SubType string to find Model, Size, and Operation Info.",
          "   d. Checks if SubType contains '/' (Operation Info).",
          "   e. Calculates the text insertion point (_Pt0) using either 'nOffset' (standard) or 'nOffsetX' (if '/' found).",
          "   f. Generates the display string (e.g., MODEL/SIZE<LintelDesc>).",
          "   g. Draws the 3D Text entity at the calculated location.",
          "   h. Assigns the text to the Element Group."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count > 1",
            "path1": {
              "name": "Re-entry Detected",
              "steps": [
                "Erase instance",
                "Terminate execution"
              ]
            },
            "path2": {
              "name": "First Run",
              "steps": [
                "Show Dialog",
                "Prompt for Entity Selection"
              ]
            }
          },
          {
            "condition": "Existing Script Found on Element",
            "path1": {
              "name": "Update Mode",
              "steps": [
                "Erase old script instance",
                "Create new script instance with current settings"
              ]
            },
            "path2": {
              "name": "Fresh Install",
              "steps": [
                "Create new script instance"
              ]
            }
          },
          {
            "condition": "Element SubType contains '/' character",
            "path1": {
              "name": "Complex Element (e.g., Lintel)",
              "steps": [
                "Use 'nOffsetX' for standoff distance",
                "Format string as 'MODEL/SIZE<Desc>'"
              ]
            },
            "path2": {
              "name": "Standard Element",
              "steps": [
                "Use 'nOffset' for standoff distance",
                "Format string as 'MODEL'"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "User selects valid ElementWallSF entities",
            "errorMessage": "None explicit, but loop does not run if selection is empty.",
            "recovery": "User must select valid wall elements when prompted."
          },
          {
            "check": "Attached Element validity",
            "errorMessage": "None explicit to user.",
            "recovery": "If element is invalid (!bIsValid), script returns without drawing."
          },
          {
            "check": "Element length/validity (Bugfix v1.2)",
            "errorMessage": "None explicit to user.",
            "recovery": "Script checks element integrity before code execution to prevent crashes; erases instance if check fails."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Label Appearance",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing sDimStyle, nColor, or dRotation immediately regenerates the text style, color, and orientation."
          },
          {
            "action": "Adjust Standoff Distance",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing nOffset or nOffsetX moves the text closer to or further from the wall surface (requires recalculation of origin, logic handles this via _Map)."
          },
          {
            "action": "Interactive Positioning/Rotation",
            "how": "Grip Edit (Graphical Grip)",
            "effect": "The script exposes a graphical point (_PtG). Moving this grip rotates the text around its insertion point (_Pt0) by changing the X-vector alignment."
          }
        ]
      },
      "tokens_used": 6824,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_Element Code\n\n## Overview\nThis script automatically generates and attaches text labels to wall elements. It displays the element's Model Code, Size, and Description directly in the 3D model based on the element's properties.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script runs in 3D model space. |\n| Paper Space | No | Not intended for Layout usage. |\n| Shop Drawing | No | Not intended for Shop Drawing generation. |\n\n## Prerequisites\n- **Required entities**: ElementWallSF (Wall elements) must exist in the model.\n- **Minimum beam count**: 0.\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsb_Element Code.mcr` from the file browser.\n\n### Step 2: Configure Properties\nUpon insertion, a properties dialog will appear automatically.\n- **Action**: Adjust settings like the Dimension Style, Color, or Offsets if necessary. Click OK to proceed.\n\n### Step 3: Select Elements\n```\nCommand Line: Please select Elements\nAction: Click on the Wall elements (ElementWallSF) you wish to label. Press Enter to confirm selection.\n```\n\n### Step 4: Automatic Generation\n- **Action**: The script will automatically attach to the selected elements and generate the text labels based on their individual properties.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimstyle | dropdown | _DimStyles | Selects the text style (font, size) used for the label. |\n| Color | number | 130 | Sets the AutoCAD color index for the text label. |\n| Offset from Wall | number | 250 mm | Sets the distance from the wall surface where the label is placed for standard elements. |\n| Offset btw Lines | number | 150 mm | Sets the distance used for elements with complex descriptions (containing a \"/\"). |\n| Set Rotation | number | 0° | Rotates the text label around the element's vertical axis. |\n| Disp Rep Header | text | [Empty] | Filters visibility by Display Representation (e.g., \"_3D\", \"_Plan\"). Leave empty to show in all views. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific custom context menu items are added by this script. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Interactive Rotation**: After insertion, you can select the label and use the **graphical grip** (blue dot) to drag and rotate the text interactively in the model.\n- **Smart Labeling**: If an element's name contains a \"/\" (indicating operation info, like a lintel), the script automatically switches to the \"Offset btw Lines\" distance to position the label correctly.\n- **Updates**: If you modify the host wall element, the label will automatically update to reflect the new geometry or properties.\n\n## FAQ\n- **Q: Why is my label appearing inside the wall?**\n  - A: Increase the \"Offset from Wall\" value in the Properties panel.\n- **Q: How do I hide the text in Plan view but keep it in 3D?**\n  - A: Enter the Display Representation code for the view you want (e.g., `_3D`) in the \"Disp Rep Header\" property.\n- **Q: Can I change the text height?**\n  - A: The text height is controlled by the \"Dimstyle\" setting. Select a different Dimstyle that defines a larger text height."
      },
      "tokens_used": 5436,
      "error": null
    }
  }
}