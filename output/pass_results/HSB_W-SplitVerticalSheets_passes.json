{
  "filename": "HSB_W-SplitVerticalSheets.mcr",
  "status": "completed",
  "total_tokens": 46104,
  "processing_time": 404.7754189968109,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl optimizes the chosen sheet with the given length. They are squared off and cut at standarized lengths.",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "20.03.2019",
            "author": "RVW",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "02.04.2019",
            "author": "RVW",
            "changes": "Make tsl work on element generation"
          },
          {
            "version": "1.02",
            "date": "13.01.2021",
            "author": "NG",
            "changes": "HSB-10126 Split sheets only vertical"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "HSB_G-FilterGenBeams"
        ]
      },
      "tokens_used": 7501,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly uses `_kModelSpace` when creating TSL instances via `dbCreate`. No references to `_kPaperSpace`, `_Viewport`, `sd_*` functions, or `#Type E` syntax were found. The script filters `Sheet` entities within an `Element` context in the 3D model."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Sheet"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Elements with Sheet entities (GenBeams).",
          "requiredSettings": [
            "HSB_G-FilterGenBeams"
          ]
        }
      },
      "tokens_used": 4473,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && _kExecuteKey == \"\"",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select a set of elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "On Insert if no execute key is present",
            "title": "Properties",
            "dataSource": "Internal OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 9,
            "variable": "operator",
            "type": "PropString",
            "displayName": "|Operator|",
            "defaultValue": "|All|",
            "inputType": "dropdown",
            "options": [
              "|All|",
              "|Any|"
            ],
            "category": "|Filtering|",
            "description": "|Specify whether all of the specified filter properties have to match or one of them|."
          },
          {
            "index": 0,
            "variable": "iFilterZone",
            "type": "PropInt",
            "displayName": "|Filter sheets in zone|",
            "defaultValue": "0",
            "inputType": "dropdown",
            "options": [
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "10"
            ],
            "category": "|Filtering|",
            "description": null
          },
          {
            "index": 1,
            "variable": "sFilterBeamcode",
            "type": "PropString",
            "displayName": "|Filter sheets with beamcode|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Filtering|",
            "description": null
          },
          {
            "index": 2,
            "variable": "sFilterLabel",
            "type": "PropString",
            "displayName": "|Filter sheets with label|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Filtering|",
            "description": null
          },
          {
            "index": 7,
            "variable": "sFilterMaterial",
            "type": "PropString",
            "displayName": "|Filter sheets with material|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Filtering|",
            "description": null
          },
          {
            "index": 8,
            "variable": "sFilterHsbID",
            "type": "PropString",
            "displayName": "|Filter sheets with hsbID|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Filtering|",
            "description": null
          },
          {
            "index": 5,
            "variable": "sSquareOff",
            "type": "PropString",
            "displayName": "|Make ends squared|",
            "defaultValue": "|Yes|",
            "inputType": "dropdown",
            "options": [
              "|Yes|",
              "|No|"
            ],
            "category": "|Optimizing|",
            "description": null
          },
          {
            "index": 6,
            "variable": "sOptimizeLength",
            "type": "PropString",
            "displayName": "|Optimize length|",
            "defaultValue": "|Yes|",
            "inputType": "dropdown",
            "options": [
              "|Yes|",
              "|No|"
            ],
            "category": "|Optimizing|",
            "description": null
          },
          {
            "index": 0,
            "variable": "dOptimizedLength",
            "type": "PropDouble",
            "displayName": "|Optimized length|",
            "defaultValue": "10000",
            "inputType": "number",
            "options": [],
            "category": "|Optimizing|",
            "description": null
          },
          {
            "index": 1,
            "variable": "dGap",
            "type": "PropDouble",
            "displayName": "|Gap|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Optimizing|",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8138,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Filters and processes wall/roof cladding sheets to square off their ends and cut them into standardized lengths suitable for transport or manufacturing.\",\n    \"category\": \"Fabrication/Optimization\",\n    \"typicalUseCase\": \"Used during element generation to ensure long cladding sheets on walls are cut to manageable stock lengths (e.g., 2.4m or 6.0m) and have clean, square ends.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"operator\",\n      \"technicalDefault\": \"|All|\",\n      \"businessMeaning\": \"Sets the logic for combining multiple filter criteria. 'All' requires the sheet to match every active filter; 'Any' requires just one match.\",\n      \"validRange\": \"[|All|, |Any|]\",\n      \"unit\": \"enum\",\n      \"affectsOutput\": \"Determines the subset of sheets selected for modification.\"\n    },\n    {\n      \"name\": \"iFilterZone\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Identifies specific construction zones or floors (1-10) to process only sheets belonging to that area.\",\n      \"validRange\": \"1-10\",\n      \"unit\": \"index\",\n      \"affectsOutput\": \"Restricts the optimization to sheets assigned to the specified zone index.\"\n    },\n    {\n      \"name\": \"sFilterBeamcode\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Selects sheets based on their specific beam code property (e.g., 'OSB', 'PLY18').\",\n      \"validRange\": \"Any valid beamcode string in the project\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Ensures only specific sheet types are processed.\"\n    },\n    {\n      \"name\": \"sFilterLabel\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Selects sheets based on custom user-assigned labels.\",\n      \"validRange\": \"Any valid label string in the project\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Filters sheets by a flexible label category.\"\n    },\n    {\n      \"name\": \"sFilterMaterial\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Selects sheets based on their material designation (e.g., 'C24', 'Structural Plywood').\",\n      \"validRange\": \"Any valid material name in the project\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Filters sheets by material composition.\"\n    },\n    {\n      \"name\": \"sFilterHsbID\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Selects a specific sheet by its unique internal hsbCAD ID.\",\n      \"validRange\": \"Valid hsbID string\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Targets a unique sheet instance for processing.\"\n    },\n    {\n      \"name\": \"sSquareOff\",\n      \"technicalDefault\": \"|Yes|\",\n      \"businessMeaning\": \"Trims the ends of the selected sheets to be perfectly square (90 degrees) relative to the element axis.\",\n      \"validRange\": \"[|Yes|, |No|]\",\n      \"unit\": \"enum\",\n      \"affectsOutput\": \"Geometry. Removes angled or irregular ends, ensuring the sheet is rectangular.\"\n    },\n    {\n      \"name\": \"sOptimizeLength\",\n      \"technicalDefault\": \"|Yes|\",\n      \"businessMeaning\": \"Enables the splitting of long sheets into smaller segments of a fixed target length.\",\n      \"validRange\": \"[|Yes|, |No|]\",\n      \"unit\": \"enum\",\n      \"affectsOutput\": \"Geometry. Determines if long sheets are subdivided into multiple pieces.\"\n    },\n    {\n      \"name\": \"dOptimizedLength\",\n      \"technicalDefault\": \"10000\",\n      \"businessMeaning\": \"The target standard length for the cut sheet segments (e.g., standard raw material length).\",\n      \"validRange\": \"500mm - 15000mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Geometry. Sets the interval at which the sheet is split.\"\n    },\n    {\n      \"name\": \"dGap\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"The width of the saw cut (kerf) or spacing between split segments.\",\n      \"validRange\": \"0mm - 10mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Geometry. Reduces the length of resulting pieces to account for material lost during cutting.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"sOptimizeLength = |No|\",\n      \"effect\": \"The cutting logic is skipped; parameters 'dOptimizedLength' and 'dGap' are ignored.\",\n      \"cascade\": [\n        \"dOptimizedLength\",\n        \""
      },
      "tokens_used": 9450,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launched via command palette or element generation.",
          "2. Check insert cycle count. If cycle > 1, script erases itself (prevents recursion/duplicates).",
          "3. Check for Execute Key. If empty, display Properties Dialog.",
          "4. Prompt user to select a set of Elements (PrEntity).",
          "5. Iterate through selected Elements.",
          "6. For each Element, create a 'Satellite' instance of the script attached to that Element, passing current properties as a catalog.",
          "7. Master instance erases itself.",
          "8. Satellite instance initializes and loads properties from the Master catalog.",
          "9. Verify Element is valid. If not, report error and erase.",
          "10. Check if execution is triggered (Debug mode, Element Constructed, or Manual Insert).",
          "11. Collect all Sheet (GenBeam) entities from the Element.",
          "12. Apply user-defined filters (Zone, Beamcode, Label, Material, HsbID) via 'HSB_G-FilterGenBeams'.",
          "13. Iterate through the filtered list of Sheets.",
          "14. Determine the 'Longest Segment' direction (typically Element X-axis) for processing.",
          "15. [Conditional] Square Off: If enabled, calculate split planes perpendicular to the axis to trim ends to a clean 90-degree cut.",
          "16. [Conditional] Optimize Length: If enabled, calculate sheet length along the axis.",
          "17. [Conditional] Optimize Length: While length > Target Length, perform a split operation at the target interval minus the gap.",
          "18. Satellite instance erases itself."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase Instance",
                "Stop Script"
              ]
            },
            "path2": {
              "name": "Cycle == 1",
              "steps": [
                "Continue to Insertion Logic"
              ]
            }
          },
          {
            "condition": "Execute Key Present",
            "path1": {
              "name": "Key is Empty",
              "steps": [
                "Show Properties Dialog",
                "Wait for User Input"
              ]
            },
            "path2": {
              "name": "Key Exists",
              "steps": [
                "Load Properties from Catalog",
                "Skip Dialog"
              ]
            }
          },
          {
            "condition": "Square Off (sSquareOff)",
            "path1": {
              "name": "Enabled (|Yes|)",
              "steps": [
                "Identify parallel edges",
                "Create split planes at extremities",
                "Trim off irregular ends",
                "Keep central rectangular portion"
              ]
            },
            "path2": {
              "name": "Disabled (|No|)",
              "steps": [
                "Skip geometry trimming",
                "Proceed to length check"
              ]
            }
          },
          {
            "condition": "Optimize Length (sOptimizeLength)",
            "path1": {
              "name": "Enabled (|Yes|)",
              "steps": [
                "Calculate current length",
                "If length > Optimized Length, enter loop",
                "Split sheet at Optimized Length - Gap",
                "Select remaining largest segment",
                "Repeat until length fits"
              ]
            },
            "path2": {
              "name": "Disabled (|No|)",
              "steps": [
                "Leave sheet length unmodified"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Filter Script Availability",
            "errorMessage": "|GenBeams could not be filtered!| ... |Make sure that the tsl| HSB_G-FilterGenBeams |is loaded in the drawing|.",
            "recovery": "Load the dependency script 'HSB_G-FilterGenBeams.mcr' into the drawing and re-run."
          },
          {
            "check": "Element Selection",
            "errorMessage": "|Invalid selection|",
            "recovery": "Ensure valid Elements are selected before script execution or during the PrEntity prompt."
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 9511,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_W-SplitVerticalSheets.mcr\n\n## Overview\nThis script optimizes wall or roof cladding sheets by squaring off their ends and cutting them into standardized lengths suitable for transport or manufacturing. It processes selected Elements and filters sheets based on specific criteria before modifying their geometry.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Must be run in 3D Model Space. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | Designed for 3D model processing. |\n\n## Prerequisites\n- **Required Entities**: Elements containing Sheet entities (GenBeams).\n- **Dependencies**: The script `HSB_G-FilterGenBeams.mcr` must be loaded in the drawing to allow filtering.\n- **Context**: Works best on Elements where sheets run parallel to the Element X-axis.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `HSB_W-SplitVerticalSheets.mcr`.\n\n### Step 2: Configure Properties\nDialog: Properties\nAction: Set the filtering criteria (Zone, Material, etc.) and optimizing parameters (Optimized Length, Gap) in the Properties Palette or the initial dialog.\n- If `sOptimizeLength` is set to \"Yes\", ensure `dOptimizedLength` matches your stock material size.\n\n### Step 3: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the Elements in the model that contain the sheets you wish to process. Press Enter to confirm selection.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Filtering** | | | |\n| Operator | Dropdown | All | Determines if \"All\" filter conditions must be met or just \"Any\". |\n| Filter sheets in zone | Dropdown | 0 | Select a specific zone number (1-10) to process only sheets in that zone. |\n| Filter sheets with beamcode | Text | (empty) | Enter a beam code to only process sheets matching this code. |\n| Filter sheets with label | Text | (empty) | Enter a label to only process sheets with this specific label. |\n| Filter sheets with material | Text | (empty) | Enter a material name to only process sheets made of this material. |\n| Filter sheets with hsbID | Text | (empty) | Enter a specific hsbID to target a single sheet instance. |\n| **Optimizing** | | | |\n| Make ends squared | Dropdown | Yes | If \"Yes\", trims the ends of the sheets to be perfectly square (90°) relative to the element axis. |\n| Optimize length | Dropdown | Yes | If \"Yes\", splits long sheets into segments of the target \"Optimized length\". |\n| Optimized length | Number | 10000 | The target length (mm) for the resulting sheet segments. |\n| Gap | Number | 0 | The saw kerf width (mm) or spacing to subtract between cut pieces. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific context menu options are defined for this script. |\n\n## Settings Files\n- **Filename**: None specified\n- **Location**: N/A\n- **Purpose**: This script relies on dependencies (`HSB_G-FilterGenBeams`) rather than specific external XML settings files.\n\n## Tips\n- **Saw Kerf**: If you are cutting sheets on a CNC or saw, set the **Gap** parameter to the width of your saw blade (e.g., 4mm or 5mm) to ensure the cut pieces fit perfectly within the raw material length.\n- **Clean Ends**: Use the **Make ends squared** option when walls have non-90° corners or irregular geometry to create clean, rectangular sheets for fabrication.\n- **Filtering**: Use the **Operator** \"Any\" with a Material filter if you want to catch all sheets of a certain material regardless of their Zone or Label.\n\n## FAQ\n- **Q: Why did the script report an error about filtering?**\n  A: Ensure that the script `HSB_G-FilterGenBeams.mcr` is loaded into your drawing. This script is required to process the filtering logic.\n- **Q: Can I split sheets horizontally (height-wise)?**\n  A: No, this script is designed to split \"Vertical\" sheets, meaning it cuts them along their length (usually the wall length) into shorter, standardized lengths.\n- **Q: The script disappeared after I selected elements. Did it fail?**\n  A: No, this is normal behavior. The script creates \"satellite\" instances on the elements to perform the work and then erases the master instance. Check your sheets to see if they were modified."
      },
      "tokens_used": 7031,
      "error": null
    }
  }
}