{
  "filename": "HSB_L-EditOpeningBeams.mcr",
  "status": "completed",
  "total_tokens": 42058,
  "processing_time": 337.5500681400299,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 3,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "This tsl adds the required tooling for fitting a beam in a log wall.",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "26.11.2012",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "29.11.2012",
            "author": "AS",
            "changes": "Add symbol"
          },
          {
            "version": "1.02",
            "date": "12.02.2019",
            "author": "RVW",
            "changes": "Add option to select an individual opening. And check if in the element or opening there already is an tslinstance present, if so erase it."
          },
          {
            "version": "1.03",
            "date": "18.02.2019",
            "author": "RVW",
            "changes": "Change centerpoint of beam regarding the tongueheight. Calculate centerpoint from beam bottom point + (total beamheight minus tongueheight divided by 2)."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5914,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses `_kModelSpace` in the `tsl.dbCreate` call. It operates on 3D entities (`ElementLog`, `Beam`) by adding `Cut` tools to the beams in the model. It lacks `sd_` prefix, `_Viewport`, `_kPaperSpace`, and `#Type E` patterns typical of ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementLog",
            "Opening",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5139,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert && (_kExecuteKey == \\\"\\\" || arSCatalogNames.find(_kExecuteKey) == -1)\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"T(\\\"|Select a set of elements|\\\")\",\n        \"condition\": \"sUserSelect == 0\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"T(\\\"|Select a set of openings|\\\")\",\n        \"condition\": \"sUserSelect == 1\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"PropertyDialog\",\n      \"trigger\": \"On Insert\",\n      \"title\": \"Properties\",\n      \"dataSource\": \"OPM Properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 2,\n      \"variable\": \"sUserSelect\",\n      \"type\": \"PropString\",\n      \"displayName\": \"T(\\\"|Select elements or openings|\\\")\",\n      \"defaultValue\": \"0\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"T(\\\"|Elements|\\\")\",\n        \"T(\\\"|Opening|\\\")\"\n      ],\n      \"category\": \"T(\\\"|Selection set|\\\")\",\n      \"description\": \"T(\\\"|Choose if tsl has to be executed on set of elements or set of openings.|\\\")\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"sSeperator01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"T(\\\"|Cut|\\\")\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"T(\\\"|Cut & Symbol|\\\")\",\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"dOffsetCut\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"\\\"     \\\"+T(\\\"|Offset cut|\\\")\",\n      \"defaultValue\": \"U(7)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"T(\\\"|Cut & Symbol|\\\")\",\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dAngleCut\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"\\\"     \\\"+T(\\\"|Angle cut|\\\")\",\n      \"defaultValue\": \"45\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"T(\\\"|Cut & Symbol|\\\")\",\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sSeperator02\",\n      \"type\": \"PropString\",\n      \"displayName\": \"T(\\\"|Symbol|\\\")\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"T(\\\"|Cut & Symbol|\\\")\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n     "
      },
      "tokens_used": 8302,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates angled sarking/drip cuts on the ends of log wall beams that intersect with window or door openings.",
          "category": "Log Construction / Wall Framing",
          "typicalUseCase": "Used when detailing a log wall with openings to ensure the logs ending at a window or door are cut back at an angle to facilitate water shedding and proper fitting of the opening jamb or lintel."
        },
        "parameters": [
          {
            "name": "sUserSelect",
            "technicalDefault": "0",
            "businessMeaning": "Defines the selection scope for the script execution. Determines whether the user selects an entire Wall Element (all its openings) or selects individual Openings.",
            "validRange": "Elements (0), Opening (1)",
            "unit": "Enum",
            "affectsOutput": "Determines which elements in the model are traversed to find beams needing cuts."
          },
          {
            "name": "dOffsetCut",
            "technicalDefault": "U(7)",
            "businessMeaning": "The offset distance from the theoretical intersection point (beam end in the opening) to the start of the cut. In construction terms, this controls the reveal depth or how far back from the jamb face the cut is positioned along the wall depth.",
            "validRange": "0.0 to Wall Width (typically 0-300mm)",
            "unit": "mm",
            "affectsOutput": "Shifts the position of the Cut tool along the wall's Y-axis. Larger values move the cut further into the wall structure."
          },
          {
            "name": "dAngleCut",
            "technicalDefault": "45",
            "businessMeaning": "The angle of the saw cut relative to the beam's longitudinal axis. This creates the sarking or drip cut intended to shed water away from the opening.",
            "validRange": "0 to 90 degrees",
            "unit": "degrees",
            "affectsOutput": "Changes the rotation of the Cut plane. 90 degrees is a square cut, 45 degrees is a standard drip cut."
          },
          {
            "name": "dSymbolOffset",
            "technicalDefault": "U(15)",
            "businessMeaning": "The size scale of the annotation symbol drawn in the model/cad to indicate the presence of the cut.",
            "validRange": "5.0 to 50.0mm",
            "unit": "mm",
            "affectsOutput": "Visually scales the length and size of the arrow drawn in the 3D model; does not affect physical machining."
          },
          {
            "name": "nSymbolColor",
            "technicalDefault": "1",
            "businessMeaning": "The CAD color index used to draw the cut annotation symbol.",
            "validRange": "0 to 255 (AutoCAD Color Index)",
            "unit": "Color Index",
            "affectsOutput": "Changes the display color of the arrow symbol; does not affect physical machining."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sUserSelect",
            "effect": "Changes the PrEntity prompt shown to the user (Elements vs Openings).",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Cut",
            "description": "Angled saw cuts applied to both sides of the beam ends that intersect the opening profile. The geometry is defined by the Offset and Angle parameters.",
            "appliedTo": "Beams within a selected ElementLog (Log Wall) that intersect the specified Opening(s)."
          },
          {
            "type": "Graphical Symbol",
            "description": "A 2D/3D arrow annotation drawn at the location of the cut to indicate the machining direction and presence.",
            "appliedTo": "Visualization layer (Element Zone 0, 'T')."
          }
        ]
      },
      "tokens_used": 7527,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. User launches script HSB_L-EditOpeningBeams (Insert or Catalog Execute).\",\n    \"2. [Check] If no execute key is provided, display the Properties Dialog for configuration.\",\n    \"3. Read the 'sUserSelect' property to determine selection scope.\",\n    \"4. [Branch] Prompt user to select either a Set of Elements or a Set of Openings based on scope.\",\n    \"5. Iterate through the selected entities to collect all target Openings.\",\n    \"6. Clean up: Iterate through TSL instances attached to the selected entities. If an instance of this script already exists, erase it to prevent duplicates.\",\n    \"7. Generate a new script instance for each unique Opening found.\",\n    \"8. [End Insert] The original insertion instance erases itself; control passes to the generated instances.\",\n    \"9. [Generated Instance] Validate that an Opening is attached to the instance.\",\n    \"10. Retrieve the parent Element (Log Wall) and all Beams within it.\",\n    \"11. Iterate through every beam in the wall.\",\n    \"12. Check if the beam's centerline start or end point falls inside the Opening's profile.\",\n    \"13. If intersecting: Calculate Cut geometry (Point & Vector) based on offset and angle.\",\n    \"14. Apply the Cut tool to the beam and draw the annotation symbol.\",\n    \"15. Assign visualization to the Element's tool layer.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"User Selection Scope (sUserSelect)\",\n      \"path1\": {\n        \"name\": \"Elements (0)\",\n        \"steps\": [\n          \"Prompt user: 'Select a set of elements'\",\n          \"Retrieve all openings belonging to the selected elements\",\n          \"Check TSLs attached to the Elements themselves\",\n          \"Process every opening found within those elements\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Opening (1)\",\n        \"steps\": [\n          \"Prompt user: 'Select a set of openings'\",\n          \"Cast selected entities to Opening type\",\n          \"Check TSLs attached specifically to the Openings\",\n          \"Process only the explicitly selected openings\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Beam End Intersection Logic\",\n      \"path1\": {\n        \"name\": \"ptBmMax (Beam End)\",\n        \"steps\": [\n          \"Check if beam end point is within opening profile\",\n          \"Calculate cut direction based on positive beam vector rotation\",\n          \"Apply cuts at the beam end\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"ptBmMin (Beam Start)\",\n        \"steps\": [\n          \"Check if beam start point is within opening profile\",\n          \"Calculate cut direction based on negative beam vector rotation\",\n          \"Apply cuts at the beam start\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Opening Attachment\",\n      \"errorMessage\": TN(\"|No openings attached to the selected element|!\"),\n      \"recovery\": \"The script instance will erase itself. User must ensure the script is run on or associated with a valid ElementLog containing an opening.\"\n    },\n    {\n      \"check\": \"Element Type\",\n      \"errorMessage\": \"Implicit Failure (Script exits quietly)\",\n      \"recovery\": \"Ensure the selected element is a Log Wall (ElementLog). Standard walls will fail the cast to ElementLog.\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Modify Cut Parameters\",\n      \"how\": \"Properties Palette (OPM)\",\n      \"effect\": \"Changing 'Offset cut', 'Angle cut', or 'Symbol size' triggers an immediate recalculation of the cut geometry and symbol graphics on the beams.\"\n    },\n    {\n      \"action\": \"Adjust Geometry\",\n      \"how\": \"CAD Grips / hsbCAD Move / Resize\",\n      \"effect\": \"Moving the Opening or resizing the Log Wall triggers the script to recalculate intersections, updating which beams are cut and the position of the cuts.\"\n    },\n    {\n      \"action\": \"Delete Instance\",\n      \"how\": \"AutoCAD Erase / Delete Key\",\n      \"effect\": \"Removes the logic instance. The physical Cut tools added to the beams will be removed if they were generated by this TSL (depending on hsbCAD tool linking behavior).\"\n    }\n  ]\n}\n```"
      },
      "tokens_used": 8653,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_L-EditOpeningBeams\n\n## Overview\nThis script automatically adds angled sarking (drip) cuts to the ends of log wall beams that intersect with window or door openings. It ensures proper water shedding and fitting for jambs and lintels by adjusting beam geometry based on customizable offsets and angles.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D model entities (Log Walls and Openings). |\n| Paper Space | No | Not designed for layout views or 2D drawings. |\n| Shop Drawing | No | Does not generate dimensions or annotations for manufacturing drawings. |\n\n## Prerequisites\n- **Required Entities**: The model must contain Log Wall elements (`ElementLog`) with defined Openings (`Opening`).\n- **Minimum Beam Count**: 0 (The script scans the element for existing beams).\n- **Required Settings Files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nExecute the `TSLINSERT` command in AutoCAD and select `HSB_L-EditOpeningBeams.mcr` from the list.\n\n### Step 2: Configure Selection Scope\nBefore selecting geometry, check the **Properties Palette** (OPM).\n1.  Locate the **Selection set** category.\n2.  Choose one of the following options for the `Select elements or openings` property:\n    *   **Elements**: Processes all openings within the selected Log Wall(s).\n    *   **Opening**: Processes only the specific opening(s) you select in the next step.\n\n### Step 3: Select Geometry\nDepending on your choice in Step 2, the command line will prompt you:\n\n**If Elements was selected:**\n```\nCommand Line: Select a set of elements\nAction: Click on the Log Wall(s) containing the openings you wish to process. Press Enter to confirm.\n```\n\n**If Opening was selected:**\n```\nCommand Line: Select a set of openings\nAction: Click directly on the window or door openings within the walls. Press Enter to confirm.\n```\n\n### Step 4: Processing\nThe script will automatically:\n1.  Remove any previous instances of this script attached to the selected items to prevent duplicates.\n2.  Identify beams ending inside the opening profile.\n3.  Apply the calculated cuts and draw symbols.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Selection set** | | | |\n| Select elements or openings | dropdown | Elements | Determines if you select whole walls or just individual openings for processing. |\n| **Cut & Symbol** | | | |\n| Offset cut | number | 7 mm | The distance from the opening face into the wall where the cut begins. |\n| Angle cut | number | 45 deg | The angle of the cut relative to the beam axis (e.g., 45Â° for a standard drip cut). |\n| Symbol size | number | 15 mm | The visual size of the arrow symbol drawn in the model to indicate the cut. |\n| Symbol color | integer | 1 (Red) | The CAD color index used for the annotation symbol. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Refreshes the script logic. Use this after manually moving the opening or resizing the wall to ensure cuts update to the new geometry. |\n\n## Settings Files\nNone. This script relies entirely on the Properties Palette for configuration.\n\n## Tips\n- **Duplicate Prevention**: If you run the script on an element that already has these cuts, the script will automatically erase the old instance before creating the new one. You can safely re-run the script to update settings.\n- **Visual Feedback**: The script draws a colored arrow/symbol at the cut location. If you do not see the symbol, check if the beam ends actually penetrate the opening polygon.\n- **Unit Independence**: The script handles internal unit conversions (mm/inches) automatically using the `U()` function, ensuring offsets remain correct regardless of your project units.\n\n## FAQ\n- **Q: Why did the script not cut any beams?**\n  - A: Ensure that the end points of the beams (centerline) actually fall within the polygon boundary of the selected opening. If the beams stop short or extend too far past the opening, the script may not detect the intersection.\n- **Q: How do I change the angle of the drip cut?**\n  - A: Select the script instance (or the opening/element it is attached to), open the Properties Palette, and modify the **Angle cut** value. The 3D model will update immediately.\n- **Q: Can I use this on standard framed walls?**\n  - A: No, this script is designed specifically for Log Walls (`ElementLog`). It will not function on standard timber frame walls."
      },
      "tokens_used": 6523,
      "error": null
    }
  }
}