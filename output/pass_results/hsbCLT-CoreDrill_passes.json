{
  "filename": "hsbCLT-CoreDrill.mcr",
  "status": "completed",
  "total_tokens": 45241,
  "processing_time": 628.0106744766235,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9146,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses _bOnInsert logic, creates 3D geometry (PlaneProfile, PLine), attaches hardware (HardWrComp), and interacts with GenBeam/Sip entities. It publishes MapRequests for Shopdrawing generation but does not contain #Type E logic or PaperSpace viewports."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (attached to a Sip panel)",
          "requiredSettings": []
        }
      },
      "tokens_used": 7006,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && (_kExecuteKey==\"\")",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select panel|, |<Enter> to select supported tools|",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "|Pick point at depth|",
              "condition": "_bOnInsert && (panel selected)",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select supported tsl tools|",
              "condition": "_bOnInsert && (no panel selected)",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "PropertiesDialog",
            "trigger": "Insertion (if no catalog key)",
            "title": "hsbCLT-CoreDrill",
            "dataSource": "Local Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dDiameter",
            "type": "PropDouble",
            "displayName": "|Diameter|",
            "defaultValue": "30",
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the Diameter|"
          },
          {
            "index": 1,
            "variable": "dMaxDepth",
            "type": "PropDouble",
            "displayName": "|Max Depth|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the maximal depth from the edge of the panel.||The depth is controlled by the insertion point.|"
          },
          {
            "index": 2,
            "variable": "dZOffset",
            "type": "PropDouble",
            "displayName": "|Z-Offset|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Alignment|",
            "description": "|Defines the Z-Offset of the drill|"
          },
          {
            "index": 1,
            "variable": "sAlignment",
            "type": "PropString",
            "displayName": "|Alignment|",
            "defaultValue": "|Vertical|",
            "inputType": "dropdown",
            "options": [
              "|Vertical|",
              "|Horizontal|"
            ],
            "category": "|Alignment|",
            "description": "|The alignment is seen relative to the panel alignment| |Panels which are not parallel or perpendicular to world Z-axis will use the panel coordinate system.|"
          },
          {
            "index": 0,
            "variable": "sDirection",
            "type": "PropString",
            "displayName": "|Direction|",
            "defaultValue": "|Bottom (Left)|",
            "inputType": "dropdown",
            "options": [
              "|Bottom (Left)|",
              "|Top (Right)|",
              "|Both|"
            ],
            "category": "|Alignment|",
            "description": "|Defines the reference edge from which the drill enters the panel|"
          },
          {
            "index": 2,
            "variable": "sFormat",
            "type": "PropString",
            "displayName": "|Format|",
            "defaultValue": "R@(Radius)",
            "inputType": "text",
            "options": [],
            "category": "|Display|",
            "description": "|Defines the format of the description.|"
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "|Color|",
            "defaultValue": 6,
            "inputType": "number",
            "options": [],
            "category": "|Display|",
            "description": "|Defines the Color|"
          },
          {
            "index": 3,
            "variable": "dTextHeight",
            "type": "PropDouble",
            "displayName": "|Text Height|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Display|",
            "description": "|Defines the TextHeight|"
          },
          {
            "index": 3,
            "variable": "sAllowOverwrite",
            "type": "PropString",
            "displayName": "|Allow Overwrite|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Display|",
            "description": "|Allows overwriting of text properties colour and heigth from TSL sd_EntitySymbolDisplay|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Set Drill Direction",
            "handler": "Direction",
            "action": "Sets the drill direction",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8049,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 7702,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script starts execution",
          "2. Check if insertion cycle is > 1 (if yes, erase and exit)",
          "3. Check if _kExecuteKey is set",
          "   [If Yes] Load properties from catalog",
          "   [If No] Display Properties Dialog (hsbCLT-CoreDrill)",
          "4. Prompt user: 'Select panel, <Enter> to select supported tools'",
          "5. [Branch A] Panel Selected -> Prompt user: 'Pick point at depth'",
          "5. [Branch B] No Panel Selected -> Prompt user: 'Select supported tsl tools'",
          "   (If tools selected, extract reference points and associated Sip panels)",
          "6. Create instance(s) attached to collected Sip panels",
          "7. Calculate geometry (start/end points) based on Diameter, Depth, Offset, Alignment, and Direction",
          "8. Generate PlaneProfile (visual representation in 3D)",
          "9. Generate/Update Hardware component (CoreDrill)",
          "10. Generate/Update MapRequests (Text and Dimensions for shopdrawings)",
          "11. Update Text and Symbol Display",
          "12. Script finishes"
        ],
        "conditionalBranches": [
          {
            "condition": "User input at 'Select panel' prompt",
            "path1": {
              "name": "Single Manual Insertion",
              "steps": [
                "User selects a Sip Panel",
                "User picks a specific point on the panel",
                "Script creates one drill instance at that location"
              ]
            },
            "path2": {
              "name": "Batch/Multi Insertion via Tools",
              "steps": [
                "User presses Enter (no panel)",
                "User selects existing TSL tools (that have AllowsEdgeDrill map key)",
                "Script iterates through valid tools",
                "Extracts reference points/panels from the tools",
                "Creates drill instances for each valid tool found"
              ]
            }
          },
          {
            "condition": "Property Change: 'sDirection'",
            "path1": {
              "name": "Default Recalculation",
              "steps": [
                "Geometry updates based on new direction string",
                "Grip point (ptG) stays at previous location relative to drill"
              ]
            },
            "path2": {
              "name": "Recalculation via Custom Command 'Set Drill Direction'",
              "steps": [
                "User executes 'Set Drill Direction'",
                "Map trigger 'trigger' is set",
                "Grip point (ptG) is reset to the middle of the drill",
                "Geometry updates"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases itself if insertCycleCount() > 1 to prevent infinite loops during hardware updates."
          },
          {
            "check": "Tool Compatibility (Batch Mode)",
            "errorMessage": "None",
            "recovery": "Script filters selected TSL instances checking for map entry 'AllowsEdgeDrill'. Invalid tools are ignored."
          },
          {
            "check": "Panel Validity",
            "errorMessage": "None",
            "recovery": "If a tool's GenBeam is not a Sip, it is skipped."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry Properties",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing Diameter, Max Depth, Z-Offset, Alignment, or Direction updates the 3D geometry and hardware dimensions immediately."
          },
          {
            "action": "Move Drill Location",
            "how": "Grip Edit (Drag Grip)",
            "effect": "The drill moves along its axis. The text position updates to the new grip location."
          },
          {
            "action": "Change Drill Direction",
            "how": "Context Menu (Right Click) -> 'Set Drill Direction'",
            "effect": "Opens selection dialog (Vertical/Horizontal/Top/Bottom/Both) and resets the grip point to the center of the drill."
          },
          {
            "action": "Update Display Properties",
            "how": "OPM",
            "effect": "Changing Color, Text Height, or Format updates the visual symbol and shopdrawing annotation requests."
          }
        ]
      },
      "tokens_used": 8344,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-CoreDrill\n\n## Overview\nThis script creates core drilling geometry and associated hardware in CLT (Sip) panels. It supports both manual insertion by picking a point and batch insertion based on existing compatible TSL tools.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates in the 3D model and attaches to Sip panels. |\n| Paper Space | No | |\n| Shop Drawing | No | Generates map requests for annotations but runs in Model Space. |\n\n## Prerequisites\n- **Required Entities**: A Sip Panel (or a compatible tool attached to a Sip panel).\n- **Minimum Beam Count**: 1 Panel.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCLT-CoreDrill.mcr`\n\n### Step 2: Configuration\nIf the script is not loaded with a specific catalog key, the **Properties Dialog** appears.\n1. Adjust the desired **Diameter** and **Max Depth**.\n2. Select **Alignment** (Vertical or Horizontal) and **Direction** (Bottom/Left, Top/Right, or Both).\n3. Click **OK** to proceed.\n\n### Step 3: Select Panel or Tools\nThe command line will prompt:\n```\nSelect panel, <Enter> to select supported tools\n```\n**Option A (Single Insertion):**\n- Click on a Sip panel in the drawing.\n- The command line will then prompt: `Pick point at depth`.\n- Click on the panel to define the insertion location and depth.\n\n**Option B (Batch Insertion):**\n- Press **Enter** without selecting a panel.\n- The command line will prompt: `Select supported tsl tools`.\n- Select existing TSL tools in the drawing that have the `AllowsEdgeDrill` attribute.\n- The script will automatically generate core drills for each selected tool based on their reference points.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Geometry** | | | |\n| Diameter | Number | 30 | Defines the diameter of the core drill. |\n| Max Depth | Number | 0 | Defines the maximum depth from the edge of the panel. (Depth is also controlled by the insertion point). |\n| **Alignment** | | | |\n| Alignment | Dropdown | Vertical | Sets the alignment relative to the panel coordinate system. Options: Vertical, Horizontal. |\n| Direction | Dropdown | Bottom (Left) | Defines the reference edge from which the drill enters. Options: Bottom (Left), Top (Right), Both. |\n| Z-Offset | Number | 0 | Defines the vertical (Z) offset of the drill position. |\n| **Display** | | | |\n| Format | Text | R@(Radius) | Defines the format string used for the text description. |\n| Color | Number | 6 | Sets the color of the visual symbol (AutoCAD color index). |\n| Text Height | Number | 0 | Defines the height of the annotation text (0 = auto/default). |\n| Allow Overwrite | Dropdown | No | Allows external style settings (e.g., `sd_EntitySymbolDisplay`) to overwrite the text color and height. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Set Drill Direction** | Opens a dialog to change the drill direction options (Vertical/Horizontal/Top/Bottom/Both). This also resets the script's grip point to the center of the drill. |\n\n## Settings Files\n- **Filename**: None specific to this script.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Batch Processing**: If you have multiple connections or tools that require a core drill in the same location, use Option B (Press Enter) and select the tools to generate all holes simultaneously.\n- **Depth Control**: While `Max Depth` limits the drill, the actual start position is determined by where you click on the panel edge.\n- **Grip Edit**: After insertion, you can drag the grip point to move the drill along its axis.\n\n## FAQ\n- **Q: How do I change the drill from vertical to horizontal?**\n  - A: Select the drill and change the **Alignment** property in the Properties Palette, or right-click and choose **Set Drill Direction**.\n- **Q: The drill isn't going all the way through the panel.**\n  - A: Check the **Max Depth** property. If it is set to 0 or a value smaller than the panel thickness, the drill will be partial. Increase the value or check your insertion point.\n- **Q: Can I use this on standard timber beams?**\n  - A: No, this script is designed specifically for **Sip** panels (typically used for CLT construction). It will not function on standard GenBeams unless they are Sip entities."
      },
      "tokens_used": 4994,
      "error": null
    }
  }
}