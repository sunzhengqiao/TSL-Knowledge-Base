{
  "filename": "HSB_G-ArrowSide.mcr",
  "status": "completed",
  "total_tokens": 36863,
  "processing_time": 464.2357556819916,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.00",
            "date": "03.04.2014",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "01.06.2015",
            "author": "AS",
            "changes": "Arrow now also visible in side view (FogBugzId 1341). Change thumbnail."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5999,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": false,
          "detectionEvidence": "Script prompts 'Select a viewport' during insertion and uses _Viewport entity. It converts coordinates using ms2ps (ModelSpace to PaperSpace) and draws based on Viewport properties (vp.widthPS, vp.heightPS). It queries vp.element() to access wall data."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "ElementWallSF"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space with a viewport showing a Wall element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 2928,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select a point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeparator01",
            "type": "PropString",
            "displayName": "Arrow",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dArrowOffset",
            "type": "PropDouble",
            "displayName": "Offset",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dArrowSize",
            "type": "PropDouble",
            "displayName": "Arrow size",
            "defaultValue": "150",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nArrowColor",
            "type": "PropInt",
            "displayName": "Arrow color",
            "defaultValue": "3",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sSeparator02",
            "type": "PropString",
            "displayName": "Name and description",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColorName",
            "type": "PropInt",
            "displayName": "Default name color",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "nColorActiveFilter",
            "type": "PropInt",
            "displayName": "Filter other element color",
            "defaultValue": "30",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "nColorActiveFilterThisElement",
            "type": "PropInt",
            "displayName": "Filter this element color",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sDimStyleName",
            "type": "PropString",
            "displayName": "Dimension style name",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sInstanceDescription",
            "type": "PropString",
            "displayName": "Extra description",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sDisableTsl",
            "type": "PropString",
            "displayName": "Disable the tsl",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sShowVpOutline",
            "type": "PropString",
            "displayName": "Show viewport outline",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Filter this element",
            "handler": "arSTrigger[0]",
            "action": "Adds the current wall element to the filter map.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Remove filter for this element",
            "handler": "arSTrigger[2]",
            "action": "Removes the current wall element from the filter map.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Remove filter for all elements",
            "handler": "arSTrigger[3]",
            "action": "Clears the entire filter map.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 5455,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a visual directional arrow and label indicating the structural orientation (Z-axis/height) of a wall element within a 2D layout viewport.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used on drawing layouts to clearly indicate the erection direction or 'up' side of a wall in elevation or section views, often for assembly clarity."
        },
        "parameters": [
          {
            "name": "dArrowOffset",
            "technicalDefault": "0",
            "businessMeaning": "Shifts the starting position of the arrow along the vertical axis (height) of the wall.",
            "validRange": "-2000 to 2000",
            "unit": "mm",
            "affectsOutput": "Moves the arrow graphic up or down relative to the wall's default origin point."
          },
          {
            "name": "dArrowSize",
            "technicalDefault": "150",
            "businessMeaning": "The visual length or scale of the directional arrow symbol.",
            "validRange": "50 to 500",
            "unit": "mm",
            "affectsOutput": "Resizes the arrow geometry; larger values make the arrow more visible on smaller scale drawings."
          },
          {
            "name": "nArrowColor",
            "technicalDefault": "3",
            "businessMeaning": "The CAD color index used for the arrow graphic.",
            "validRange": "0 to 255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the display color of the arrow polyline."
          },
          {
            "name": "nColorName",
            "technicalDefault": "-1",
            "businessMeaning": "The color of the text label when no specific wall filters are active.",
            "validRange": "0 to 255",
            "unit": "Index",
            "affectsOutput": "Controls text color in the default state."
          },
          {
            "name": "nColorActiveFilter",
            "technicalDefault": "30",
            "businessMeaning": "The color of the text label for walls that are NOT currently filtered/selected.",
            "validRange": "0 to 255",
            "unit": "Index",
            "affectsOutput": "Dims or changes the color of labels for 'other' walls to highlight the selected one."
          },
          {
            "name": "nColorActiveFilterThisElement",
            "technicalDefault": "1",
            "businessMeaning": "The color of the text label when this specific wall is actively filtered/selected.",
            "validRange": "0 to 255",
            "unit": "Index",
            "affectsOutput": "Highlights the label of the active wall to distinguish it from others."
          },
          {
            "name": "sDimStyleName",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "The text style (font, height) used for the wall label.",
            "validRange": "Existing Text Style names in the drawing",
            "unit": "String",
            "affectsOutput": "Alters the font and size properties of the descriptive text."
          },
          {
            "name": "sInstanceDescription",
            "technicalDefault": "",
            "businessMeaning": "Additional custom text appended to the script instance name.",
            "validRange": "Alphanumeric string",
            "unit": "Text",
            "affectsOutput": "Adds suffix text to the main label (e.g., 'Wall Arrow - North Side')."
          },
          {
            "name": "sDisableTsl",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggle to turn off the arrow generation while keeping the label instance.",
            "validRange": "Yes, No",
            "unit": "Enum",
            "affectsOutput": "If 'Yes', hides the arrow geometry and displays 'Disabled' text; if 'No', draws the arrow."
          },
          {
            "name": "sShowVpOutline",
            "technicalDefault": "Yes",
            "businessMeaning": "Visual debugging aid to display the borders of the selected viewport.",
            "validRange": "Yes, No",
            "unit": "Enum",
            "affectsOutput": "Draws a rectangle representing the viewport extents if enabled."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Context Menu 'Filter this element'",
            "effect": "Switches the active color logic from nColorName to nColorActiveFilterThisElement for this wall, and nColorActiveFilter for others.",
            "cascade": [
              "nColorName",
              "nColorActiveFilter",
              "nColorActiveFilterThisElement"
            ]
          },
          {
            "trigger": "sDisableTsl set to 'Yes'",
            "effect": "Overrides dArrowSize, dArrowOffset, and nArrowColor, preventing the arrow from drawing and changing the label to 'Disabled'.",
            "cascade": [
              "dArrowOffset",
              "dArrowSize",
              "nArrowColor"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "VisualAnnotation",
            "description": "A 3D polyline arrow indicating the wall's vertical Z-axis, transformed into 2D Paper Space coordinates.",
            "appliedTo": "Selected Wall Element (displayed in Viewport)"
          },
          {
            "type": "TextLabel",
            "description": "Script Name and optional Description text, color-coded based on filter status.",
            "appliedTo": "Paper Space (at selected point)"
          },
          {
            "type": "DebugGeometry",
            "description": "Rectangle outlining the Viewport borders (if enabled).",
            "appliedTo": "Paper Space"
          }
        ]
      },
      "tokens_used": 7646,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Insertion Started",
          "2. Check insertCycleCount (must be 1, otherwise erase and exit)",
          "3. Show Properties Dialog (OPM)",
          "4. Command Line Prompt: Select Viewport",
          "5. Command Line Prompt: Select Insertion Point",
          "6. Validate: Check if Viewport exists in _Viewport array",
          "7. Validate: Retrieve Element from Viewport and check validity",
          "8. Process Context Menu Triggers (Filter Map updates)",
          "9. Draw Default Script Name at Insertion Point",
          "10. Check 'Show viewport outline' setting (draw debug rectangle if Yes)",
          "11. Check 'Disable the tsl' setting",
          "12. Check Global Map for Active Filters",
          "13. Validate Element Type (Must be ElementWallSF)",
          "14. Calculate Arrow Geometry and Visibility Directions",
          "15. Draw Arrow in Paper Space"
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "Insert Cycle > 1",
              "steps": [
                "Erase current instance",
                "Exit script"
              ]
            },
            "path2": {
              "name": "Insert Cycle = 1",
              "steps": [
                "Proceed to prompts"
              ]
            }
          },
          {
            "condition": "Viewport Validity",
            "path1": {
              "name": "No Viewport Selected",
              "steps": [
                "Erase instance",
                "Exit script"
              ]
            },
            "path2": {
              "name": "Viewport Selected",
              "steps": [
                "Retrieve element from viewport",
                "Continue"
              ]
            }
          },
          {
            "condition": "Element Validity",
            "path1": {
              "name": "Invalid Element",
              "steps": [
                "Exit script (Name remains drawn)"
              ]
            },
            "path2": {
              "name": "Valid Element",
              "steps": [
                "Proceed to drawing logic"
              ]
            }
          },
          {
            "condition": "Property 'Disable the tsl'",
            "path1": {
              "name": "Yes",
              "steps": [
                "Redraw Name in Filter Color",
                "Draw 'Disabled' text below name",
                "Exit script (No arrow)"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Continue to Filter checks"
              ]
            }
          },
          {
            "condition": "Active Filter Map Status",
            "path1": {
              "name": "Map Empty",
              "steps": [
                "Proceed to draw arrow"
              ]
            },
            "path2": {
              "name": "Map Populated - This Element Filtered",
              "steps": [
                "Set Name Color to 'Filter this element'",
                "Draw 'Active filter' text",
                "Exit script (No arrow)"
              ]
            },
            "path3": {
              "name": "Map Populated - Other Element Filtered",
              "steps": [
                "Set Name Color to 'Filter other element'",
                "Draw 'Active filter' text",
                "Exit script (No arrow)"
              ]
            }
          },
          {
            "condition": "Element Type Cast",
            "path1": {
              "name": "ElementWallSF",
              "steps": [
                "Calculate arrow vectors",
                "Draw arrow polyline",
                "Apply visibility hide directions"
              ]
            },
            "path2": {
              "name": "Other Type",
              "steps": [
                "Exit script"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "None (Silent fail)",
            "recovery": "User must re-insert the script and ensure a viewport is selected."
          },
          {
            "check": "Viewport contains valid hsbCAD Element",
            "errorMessage": "None (Silent fail)",
            "recovery": "User must select a viewport that displays a valid hsbCAD element (Wall)."
          },
          {
            "check": "Element Type compatibility",
            "errorMessage": "None (Silent fail)",
            "recovery": "Ensure the element in the viewport is a Wall (ElementWallSF), not a beam or other entity."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Properties",
            "how": "Object Properties Palette (OPM)",
            "effect": "Modify arrow size, offset, colors, or disable the script instance entirely."
          },
          {
            "action": "Move Label",
            "how": "Grip Edit (Standard Point Grips)",
            "effect": "Relocate the text label and arrow anchor point."
          },
          {
            "action": "Filter this element",
            "how": "Right-click Context Menu",
            "effect": "Adds this wall to a global filter list. This instance highlights, while other instances dim."
          },
          {
            "action": "Remove filter for this element",
            "how": "Right-click Context Menu",
            "effect": "Removes this wall from the global filter list. All instances return to default visibility state."
          },
          {
            "action": "Remove filter for all elements",
            "how": "Right-click Context Menu",
            "effect": "Clears the global filter list. All instances return to default visibility state."
          }
        ]
      },
      "tokens_used": 8285,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-ArrowSide.mcr\n\n## Overview\nThis script generates a directional arrow and label in Paper Space to indicate the vertical orientation (Z-axis/height) of a wall element shown within a layout viewport. It is used in shop drawings to clarify the erection direction or \"up\" side of a wall.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is intended for layouts. |\n| Paper Space | Yes | The script must be inserted on a Layout tab. |\n| Shop Drawing | Yes | Designed for detailing production. |\n\n## Prerequisites\n- **Required Entities**: A viewport on a Layout tab displaying a Wall element (`ElementWallSF`).\n- **Minimum Beam Count**: 0.\n- **Required Settings**: None (uses standard hsbCAD properties).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_G-ArrowSide.mcr` from the list.\n\n### Step 2: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the viewport border or inside the viewport that displays the wall you want to annotate.\n```\n\n### Step 3: Place Label\n```\nCommand Line: Select a point\nAction: Click in Paper Space to position the text label and the anchor point for the arrow.\n```\n\n## Properties Panel Parameters\n\n### Arrow Settings\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Offset | Number | 0 | Moves the arrow start point vertically (mm). Positive moves it up, negative moves it down. |\n| Arrow size | Number | 150 | Sets the length/size of the arrow graphic (mm). |\n| Arrow color | Integer | 3 | Sets the AutoCAD color index for the arrow line. |\n\n### Name and Description\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Default name color | Integer | -1 | Color of the label text when no filters are applied. (-1 = ByLayer). |\n| Filter other element color | Integer | 30 | Color of the label when this specific wall is *not* the active filter. |\n| Filter this element color | Integer | 1 | Color of the label when this specific wall *is* the active filter. |\n| Dimension style name | String | _DimStyles | Specifies the text style used for the label. |\n| Extra description | String | (Empty) | Additional text appended to the end of the label. |\n\n### Script Settings\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Disable the tsl | Dropdown | Yes | If \"Yes\", the arrow is hidden, and the label shows \"(Disabled)\". If \"No\", the arrow is drawn. |\n| Show viewport outline | Dropdown | Yes | If \"Yes\", draws a rectangle indicating the boundary of the selected viewport (useful for debugging). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Filter this element | Highlights this wall instance (using \"Filter this element color\") and dims all other instances (using \"Filter other element color\"). Useful for focusing on specific walls in a busy drawing. |\n| Remove filter for this element | Removes this wall from the highlight filter, restoring its default color. |\n| Remove filter for all elements | Clears all filters, resetting all script instances in the drawing to their default colors. |\n\n## Settings Files\nNo external settings files are required for this script.\n\n## Tips\n- **Disabling the Arrow**: If you only need the tag/name without the directional arrow graphic, set **Disable the tsl** to \"Yes\" in the properties palette.\n- **Visibility Filters**: Use the **Filter this element** right-click option when you have multiple wall arrows on a layout. It allows you to highlight one specific wall while graying out the others for better clarity.\n- **Troubleshooting**: If the arrow does not appear, ensure the viewport you selected actually contains a valid Wall element (not a floor or beam) and that **Disable the tsl** is set to \"No\".\n\n## FAQ\n- **Q: Why does my arrow appear red or green?**\n  A: The arrow color is controlled by the **Arrow color** property. Check the Properties Palette (OPM) to change it to your preferred AutoCAD color index.\n- **Q: Can I move the label after inserting it?**\n  A: Yes, select the script instance and use the standard AutoCAD grip points to drag the label and arrow anchor to a new location.\n- **Q: What happens if I delete the viewport?**\n  A: The script instance will lose its reference to the wall. The label may remain, but the arrow will no longer generate correctly. You should delete the script instance if the viewport is removed."
      },
      "tokens_used": 6550,
      "error": null
    }
  }
}