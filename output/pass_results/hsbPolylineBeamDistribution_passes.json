{
  "filename": "hsbPolylineBeamDistribution.mcr",
  "status": "completed",
  "total_tokens": 36118,
  "processing_time": 164.0872836112976,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "15nov2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6077,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses 'Beam.dbCreate()' to generate new geometry in the model. Prompts for 'EntPLine' entities via command line inputs during '_bOnInsert'. No 'sd_' filename prefix or '_Viewport' references found."
        },
        "prerequisites": {
          "requiredEntities": [
            "PLine"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space with two polylines defining distribution boundaries",
          "requiredSettings": [
            "Catalog entry or user input for Width, Height, and Interdistance"
          ]
        }
      },
      "tokens_used": 4796,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select 2 polylines|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select second polyline|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 4,
              "function": "PrPoint",
              "promptOriginal": "|Select point in rafter direction|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "Properties defined in script",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": "60",
            "inputType": "number",
            "options": [],
            "category": "|Beam Properties|",
            "description": "|Defines the Width|"
          },
          {
            "index": 1,
            "variable": "dHeight",
            "type": "PropDouble",
            "displayName": "|Height|",
            "defaultValue": "200",
            "inputType": "number",
            "options": [],
            "category": "|Beam Properties|",
            "description": "|Defines the Height|"
          },
          {
            "index": 2,
            "variable": "dInterdistance",
            "type": "PropDouble",
            "displayName": "|Interdistance|",
            "defaultValue": "500",
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": "|Defines the Interdistance|"
          },
          {
            "index": 0,
            "variable": "sDistributionMode",
            "type": "PropString",
            "displayName": "|Mode|",
            "defaultValue": "|Even Distribution|",
            "inputType": "dropdown",
            "options": [
              "|Even Distribution|",
              "|Fixed Distribution|"
            ],
            "category": "|Distribution|",
            "description": "|Sets the mode of a distribution|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5266,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a distribution of structural beams (e.g., rafters or joists) spanning between two polylines, accommodating non-parallel boundaries and variable angles.",
          "category": "Framing",
          "typicalUseCase": "Framing a roof section or floor deck between two irregular or curved walls where the beam layout needs to follow a specific vector direction."
        },
        "parameters": [
          {
            "name": "dWidth",
            "technicalDefault": "60",
            "businessMeaning": "The cross-sectional width (thickness) of the individual beams being created.",
            "validRange": "45 - 300",
            "unit": "mm",
            "affectsOutput": "Determines the physical width of the beams. It is subtracted from the total span width to ensure beams fit exactly between the polylines without overlapping the boundaries."
          },
          {
            "name": "dHeight",
            "technicalDefault": "200",
            "businessMeaning": "The cross-sectional height (depth) of the individual beams being created.",
            "validRange": "100 - 600",
            "unit": "mm",
            "affectsOutput": "Defines the vertical dimension of the generated beams. It affects the structural size but does not influence the geometric positioning or spacing calculation."
          },
          {
            "name": "dInterdistance",
            "technicalDefault": "500",
            "businessMeaning": "The desired spacing (center-to-center) between adjacent beams.",
            "validRange": "300 - 1200",
            "unit": "mm",
            "affectsOutput": "In 'Fixed Distribution' mode, this is the exact gap used. In 'Even Distribution' mode, this value acts as a maximum target or divisor to calculate how many beams will fit, and the script recalculates the exact gap to fill the space evenly."
          },
          {
            "name": "sDistributionMode",
            "technicalDefault": "Even Distribution",
            "businessMeaning": "Determines the logic used to space the beams across the span.",
            "validRange": "N/A (Dropdown)",
            "unit": "N/A",
            "affectsOutput": "Selecting 'Even Distribution' forces beams to divide the total available width into equal parts. Selecting 'Fixed Distribution' places beams at strict intervals defined by 'dInterdistance', potentially leaving a partial remainder at the end."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Modifying dWidth",
            "effect": "Alters the effective calculation area for distribution. A wider width reduces the total span length available for placing beams.",
            "cascade": [
              "nNum (calculated quantity of beams)",
              "dDist (actual spacing used)"
            ]
          },
          {
            "trigger": "Changing sDistributionMode",
            "effect": "Changes how 'dInterdistance' is interpreted. In 'Even' mode, 'dInterdistance' becomes a suggestion; in 'Fixed' mode, it is a constraint.",
            "cascade": [
              "nNum",
              "dDist"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam",
            "description": "New timber elements created between the two input polylines.",
            "appliedTo": "All generated beams"
          },
          {
            "type": "Cut",
            "description": "End cuts applied to the beams where they intersect the boundary polylines to match the boundary angle (including twisted or curved boundaries).",
            "appliedTo": "Start and end of generated beams"
          },
          {
            "type": "Visual Lines",
            "description": "Lines drawn to visualize the selected polylines and the rafter/joist direction arrow.",
            "appliedTo": "Model Space visualization"
          }
        ]
      },
      "tokens_used": 5816,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Insertion/Recalculation Triggered",
          "2. Check insertCycleCount (Erase if > 1 to prevent double insert)",
          "3. Determine Property Source (Check for _kExecuteKey / Catalog)",
          "4. Display Dialog (if no catalog key used)",
          "5. Prompt User to Select First Polyline",
          "6. Prompt User to Select Second Polyline",
          "7. Prompt User to Specify Origin Point (getPoint)",
          "8. Prompt User to Specify Direction Point (PrPoint)",
          "9. Validate Input Entities (Polylines) and Points",
          "10. Calculate Coordinate System (Vectors X, Y, Z based on inputs)",
          "11. Orient Polylines (Reverse direction if necessary relative to X-vector)",
          "12. Clean up previous geometry (Erase existing generated beams)",
          "13. Construct Convex Hull and PlaneProfile from polylines",
          "14. Calculate Distribution Extents (Total width dX)",
          "15. Determine Quantity and Spacing (Based on Distribution Mode)",
          "16. Loop through positions to Create Beams",
          "17. Intersect Beam Planes with Polylines or Closing Lines",
          "18. Calculate Cuts based on intersection angles",
          "19. Generate Beams and Apply Cuts",
          "20. Draw Visualization Outlines"
        ],
        "conditionalBranches": [
          {
            "condition": "Property Initialization Method",
            "path1": {
              "name": "Catalog Execution",
              "steps": [
                "Check _kExecuteKey",
                "Load values from Catalog entry matching key",
                "Skip Dialog"
              ]
            },
            "path2": {
              "name": "Manual Input",
              "steps": [
                "No Key found",
                "Execute showDialog()",
                "User manually sets Width, Height, Interdistance, Mode"
              ]
            }
          },
          {
            "condition": "Distribution Mode Property",
            "path1": {
              "name": "Even Distribution",
              "steps": [
                "Calculate nNum based on Interdistance",
                "Recalculate dDist = Total Width / nNum",
                "Space beams evenly across the total span"
              ]
            },
            "path2": {
              "name": "Fixed Distribution",
              "steps": [
                "Keep dDist equal to dInterdistance property",
                "Calculate nNum",
                "Space beams strictly by dDist (remainder possible at end)"
              ]
            }
          },
          {
            "condition": "Intersection Calculation during Loop",
            "path1": {
              "name": "Main Polyline Intersection",
              "steps": [
                "Current X-plane intersects with user-selected Polylines",
                "Use these intersection points for beam ends"
              ]
            },
            "path2": {
              "name": "Closing Line Intersection",
              "steps": [
                "Current X-plane is outside the range of user-selected Polylines",
                "Intersect with generated Closing Lines (Start-to-Start / End-to-End)",
                "Use these intersection points for beam ends"
              ]
            }
          },
          {
            "condition": "Polyline Orientation",
            "path1": {
              "name": "Orientation Correct",
              "steps": [
                "Dot product of Polyline Direction and X-Vector is positive",
                "Use Polyline as is"
              ]
            },
            "path2": {
              "name": "Orientation Reversed",
              "steps": [
                "Dot product of Polyline Direction and X-Vector is negative",
                "Reverse Polyline geometry (pl.reverse())",
                "Proceed with reversed geometry"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Number of selected Polylines",
            "errorMessage": "Invalid set of polylines. Tool will be deleted.",
            "recovery": "Ensure two valid polylines are selected during the insertion prompts."
          },
          {
            "check": "Direction Grip Points",
            "errorMessage": "Grip point invalid. Tool will be deleted.",
            "recovery": "Ensure the origin and direction points are distinct and define a valid vector."
          },
          {
            "check": "Interdistance Value",
            "errorMessage": "Interdistance may not be <= 0. Tool will be deleted.",
            "recovery": "Set the 'Interdistance' property to a value greater than 0."
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "(Silent)",
            "recovery": "N/A (Internal safety check to erase duplicate instances)"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Beam Properties",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing Width, Height, Interdistance, or Mode triggers a recalculation. Beams are regenerated with new dimensions or spacing."
          },
          {
            "action": "Modify Input Geometry",
            "how": "Grip Edit the Polylines",
            "effect": "Since 'setDependencyOnEntity' is used, moving or reshaping the input polylines triggers the script. Beams update their start/end points and cuts to match the new boundary."
          },
          {
            "action": "Adjust Direction",
            "how": "Grip Edit the script instance origin/direction grips",
            "effect": "Changing the direction vector rotates the distribution layout. Beams are regenerated along the new vector."
          },
          {
            "action": "Delete Script Instance",
            "how": "AutoCAD Erase command",
            "effect": "The script instance and all generated beams (_Beam array elements) are erased from the model."
          }
        ]
      },
      "tokens_used": 8367,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbPolylineBeamDistribution.mcr\n\n## Overview\nGenerates a distribution of structural beams (such as rafters or joists) spanning between two user-selected polylines. It accommodates non-parallel boundaries and variable angles, automatically calculating end cuts to match the wall lines.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script generates new beams directly in the 3D model. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: Two Polylines existing in the Model Space to define the boundaries.\n- **Minimum Beam Count**: 0.\n- **Required Settings**: None (script properties can be set manually or via catalog).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbPolylineBeamDistribution.mcr` from the list.\n\n### Step 2: Select Boundary Polylines\n```\nCommand Line: Select 2 polylines\nAction: Click on the first polyline in your drawing that defines one side of the roof or floor area.\n```\n\n### Step 3: Select Second Polyline\n```\nCommand Line: Select second polyline\nAction: Click on the second polyline that defines the opposite boundary.\n```\n\n### Step 4: Define Direction\n```\nCommand Line: Select point in rafter direction\nAction: Click a point in the model to define the direction the beams should run towards (this sets the vector for the distribution).\n```\n\n### Step 5: Configure Properties\nA dialog will appear (if not using a catalog preset) to set initial dimensions. You can also modify these later in the Properties Palette.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Width** | Number | 60 | The cross-sectional width (thickness) of the individual beams (mm). |\n| **Height** | Number | 200 | The cross-sectional height (depth) of the individual beams (mm). |\n| **Interdistance** | Number | 500 | The spacing (center-to-center) between adjacent beams (mm). |\n| **Mode** | Dropdown | Even Distribution | **Even Distribution**: Divides the total span into equal parts based on the interdistance.<br>**Fixed Distribution**: Places beams strictly at the specified interdistance, potentially leaving a remainder at the end. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | No specific context menu options are defined for this script. Use the Properties Palette to modify settings. |\n\n## Settings Files\n- **Filename**: *None specified*\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Automatic Updates**: This script uses \"dependency\" logic. If you use AutoCAD grips to stretch or move the input polylines, the beams will automatically update their length and end cuts to match.\n- **Grip Editing**: You can select the script instance to view its origin and direction grips. Moving these allows you to rotate or reposition the entire distribution layout.\n- **Mode Selection**: Use \"Even Distribution\" when you need the beams to fill the space exactly without a small partial gap at the end. Use \"Fixed Distribution\" if strict spacing (e.g., standard joist spacing) is more important than filling the exact width.\n\n## FAQ\n- **Q: What happens if I change the Width property?**\n  A: The script recalculates the layout. Since the beam width is subtracted from the span, increasing the width reduces the available space for spacing.\n- **Q: Can I use this for curved walls?**\n  A: Yes. The script calculates intersections based on the polylines, so if the polylines are curved or angled, the beams will be generated with matching end cuts.\n- **Q: My beams disappeared after I changed a property.**\n  A: This usually happens if the new settings (like Interdistance) result in zero beams fitting in the space, or if the Interdistance is set to 0 or negative. Check the Property values and ensure the boundaries are still valid."
      },
      "tokens_used": 5796,
      "error": null
    }
  }
}