{
  "filename": "Strongtie HD2P x LR.mcr",
  "status": "completed",
  "total_tokens": 37504,
  "processing_time": 261.70561146736145,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4928,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of `_kModelSpace` in the `dbCreate` function call. The script generates 3D geometry including `Body`, `BeamCut`, and `Drill` objects, and utilizes `ElemNoNail` for element fabrication data. No `sd_` prefixes, `_Viewport` interactions, or 2D layout generation logic are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5100,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 8193,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates the 3D geometry and machining data for the Simpson Strong-Tie HD2P 2-piece hold-down tie rod system, used to resist uplift in timber wall panels.",
          "category": "Hardware",
          "typicalUseCase": "Inserting a heavy-duty hold-down connection into a timber wall element during detailing, specifically connecting multiple studs to the foundation or bottom plate with a specific left/right configuration."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "HD2P1L-B",
            "businessMeaning": "Specifies the exact hardware variant (Size 1 or 2, Left or Right orientation), controlling the physical dimensions of the bracket, the number of fastener holes, and the anchor bolt diameter.",
            "validRange": "HD2P1L-B, HD2P1R-B, HD2P2L-B, HD2P2R-B",
            "unit": "enum",
            "affectsOutput": "Changes the height (A), width (B), and other dimensions of the metal bodies (bd1, bd2, bd3, bd4). Adjusts the Drill diameter (9mm for Type 1, 6.5mm for Type 2)."
          },
          {
            "name": "sNoNailZones",
            "technicalDefault": "2;3",
            "businessMeaning": "Specifies which construction layers (Element Zones) of the wall should be protected from nailing to prevent interference with the tie rod installation.",
            "validRange": "-5 to 5 (excluding 0), separated by ';'",
            "unit": "integer list",
            "affectsOutput": "Creates 'ElemNoNail' zones on the wall element for the specified indices, blocking nailing machinery in the connector area."
          },
          {
            "name": "bmStuds (Input)",
            "technicalDefault": "User Selected",
            "businessMeaning": "The set of vertical studs to which the tie rods will be applied.",
            "validRange": "N/A (Selection)",
            "unit": "entity array",
            "affectsOutput": "Triggers the creation of a connector instance for each selected stud."
          },
          {
            "name": "_Pt0 (Input)",
            "technicalDefault": "User Picked",
            "businessMeaning": "The insertion point used to locate the connector along the wall. It also determines the orientation (flip) of the connector based on the element's origin.",
            "validRange": "N/A (Point)",
            "unit": "coordinates",
            "affectsOutput": "Sets the global position (transform) of the connector. Determines if the connector geometry is flipped vertically relative to the element coordinate system."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User changes sType",
            "effect": "Selects different dimension sets from the lookup arrays (dArA, dArB, etc.) and changes the drill hole size based on whether Type 1 or 2 is selected.",
            "cascade": [
              "nArSide",
              "dArA",
              "dArB",
              "dArC",
              "dArD",
              "nArQtyScrew",
              "Drill diameter"
            ]
          },
          {
            "trigger": "_Pt0 is selected",
            "effect": "Calculates the distance from the Element origin to set the 'flip' state, ensuring the connector projects in the correct vertical direction.",
            "cascade": [
              "bFlip",
              "vz (vertical orientation vector)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (MetalPart)",
            "description": "The composite 3D geometry of the HD2P tie rod, consisting of a main plate, triangulated section, bent shoe, and header plate, visualized as a single unit.",
            "appliedTo": "Visualized in Model Space; logically associated with the specific beam and element."
          },
          {
            "type": "BeamCut",
            "description": "A routed slot in the wood stud to allow the metal plate to sit flush or recessed.",
            "appliedTo": "The primary stud (_Beam[0]) and any intersecting perpendicular beams."
          },
          {
            "type": "ElemNoNail",
            "description": "A rectangular 'no-nail' zone applied to the wall element to prevent automated nailing in the area occupied by the hardware.",
            "appliedTo": "The Wall Element (_Element[0])."
          },
          {
            "type": "Drill",
            "description": "A cylindrical hole in the metal 'shoe' part of the connector for the anchor bolt.",
            "appliedTo": "The metal part geometry (Body bd3)."
          }
        ]
      },
      "tokens_used": 5865,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Execution: User launches the TSL script in AutoCAD/hsbCAD.",
          "2. Cycle Check: Script checks if 'insertCycleCount > 1'. If yes, it self-destructs to prevent loops.",
          "3. Configuration: 'showDialog()' opens, prompting user to select the Tie Rod Type (e.g., HD2P1L-B).",
          "4. Entity Selection: Prompt 'Select studs' appears. User selects a set of beams.",
          "5. Filtering: Script filters selected beams to find valid perpendicular studs ('_XW.filterBeamsPerpendicularSort').",
          "6. Validation: Script checks if at least one valid stud exists.",
          "7. Location Input: Prompt 'Pick point on desired side' appears. User clicks a point in the model.",
          "8. Orientation Calculation: Script determines the 'flip' state by comparing the pick point's Z-height relative to the Element origin.",
          "9. Instance Generation: Script loops through all filtered studs, projects the point to the element bottom, and spawns a specific TSL instance for each using 'dbCreate'.",
          "10. Cleanup: The original 'insert' script instance erases itself.",
          "11. Geometry Generation (Per Instance): The new instances execute, generating Metal Bodies (bd1-bd4), BeamCuts, Drills, and NoNail zones based on the selected Type and Flip state."
        ],
        "conditionalBranches": [
          {
            "condition": "Beam selection count validation ('bmStuds.length() < 1')",
            "path1": {
              "name": "Invalid Selection",
              "steps": [
                "Display 'Invalid connection' notice",
                "Erase the script instance",
                "Terminate execution"
              ]
            },
            "path2": {
              "name": "Valid Selection",
              "steps": [
                "Proceed to point input",
                "Calculate orientation and create instances"
              ]
            }
          },
          {
            "condition": "Vertical Orientation relative to Element Origin ('el.vecZ().dotProduct(_Pt0-el.ptOrg())<0')",
            "path1": {
              "name": "Flip True",
              "steps": [
                "Set Map 'flip' to true",
                "Invert vertical vector (vz)",
                "Invert NoNail zone direction"
              ]
            },
            "path2": {
              "name": "Flip False",
              "steps": [
                "Set Map 'flip' to false",
                "Use standard vertical vector",
                "Use standard NoNail zone direction"
              ]
            }
          },
          {
            "condition": "Hardware Variant Type ('nType < 2' -> Type 1 vs Type 2)",
            "path1": {
              "name": "Type 1 (HD2P1...)",
              "steps": [
                "Use dimensions A=380, B=220, D=54",
                "Set Screw Qty to 3",
                "Create Drill with 9mm diameter at Z=55"
              ]
            },
            "path2": {
              "name": "Type 2 (HD2P2...)",
              "steps": [
                "Use dimensions A=380, B=163, D=40",
                "Set Screw Qty to 2",
                "Create Drill with 6.5mm diameter at Z=50"
              ]
            }
          },
          {
            "condition": "Left/Right Orientation ('nSide' from array based on Type)",
            "path1": {
              "name": "Right Side (nSide = 1)",
              "steps": [
                "Set PLine Arc direction to Counter-Clockwise",
                "Offset geometry along +Vx"
              ]
            },
            "path2": {
              "name": "Left Side (nSide = -1)",
              "steps": [
                "Set PLine Arc direction to Clockwise",
                "Offset geometry along -Vx"
              ]
            }
          },
          {
            "condition": "NoNail Zone Validity ('nZn > -6 && nZn < 6 && nZn!=0')",
            "path1": {
              "name": "Valid Zone Index",
              "steps": [
                "Check if Element zone thickness > Epsilon",
                "Add ElemNoNail marker to the element"
              ]
            },
            "path2": {
              "name": "Invalid Zone Index/Thickness",
              "steps": [
                "Skip processing for this specific index token"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Minimum beam count",
            "errorMessage": "\nInvalid connection",
            "recovery": "User must select at least one valid stud beam and restart the command."
          },
          {
            "check": "Insert cycle count",
            "errorMessage": "None (Silent)",
            "recovery": "Script automatically erases itself if it detects it is running in a re-entrant loop."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Hardware Type",
            "how": "Properties Palette (OPM) -> 'Type' property",
            "effect": "Updates dimensions (A, B, D), number of screw holes, and the diameter/position of the anchor bolt drill. Triggers a recalculation of the 3D metal body."
          },
          {
            "action": "Adjust NoNail Zones",
            "how": "Properties Palette (OPM) -> 'NoNail' property",
            "effect": "Updates the list of element indices protected from nailing. The script parses the new string and regenerates the ElemNoNail entities on the wall."
          },
          {
            "action": "Recalculate",
            "how": "Right-click context menu -> Recalculate",
            "effect": "Re-runs the script logic to reflect changes in the connected element geometry or property updates."
          }
        ]
      },
      "tokens_used": 8050,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Strongtie HD2P x LR.mcr\n\n## Overview\nGenerates the 3D geometry and machining data for the Simpson Strong-Tie HD2P 2-piece hold-down tie rod system, used to resist uplift in timber wall panels. It automatically creates the metal connector bodies, drill holes for anchor bolts, routing cuts in the studs, and \"no-nail\" protection zones on the wall element.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Generates 3D bodies, cuts, and drilling operations. |\n| Paper Space | No | Not intended for 2D layout generation. |\n| Shop Drawing | No | Generates model data only, not drawing views. |\n\n## Prerequisites\n- **Required Entities**: At least one `GenBeam` (stud) and an enclosing `Element` (wall).\n- **Minimum Beam Count**: 1 stud.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Strongtie HD2P x LR.mcr`\n\n### Step 2: Configure Connector Type\n```\nCommand Line: Select Tie Rod Type\nAction: A dialog box appears. Select the desired hardware variant (e.g., HD2P1L-B, HD2P1R-B) from the list and click OK.\n```\n\n### Step 3: Select Studs\n```\nCommand Line: Select studs\nAction: Click on the vertical wood studs in the model where you want to install the hold-downs. Press Enter to confirm selection.\n```\n\n### Step 4: Define Location and Orientation\n```\nCommand Line: Pick point on desired side\nAction: Click a point in the model to position the connector. \nNote: The vertical orientation (up or down) is calculated based on this point's height relative to the wall element's origin.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | String | HD2P1L-B | Specifies the hardware variant (Size 1 or 2, Left or Right). Changing this updates the bracket dimensions, number of fastener holes, and anchor bolt diameter. |\n| NoNail | String | 2;3 | Defines which construction layers (Element Zones) are protected from nailing. Enter zone numbers separated by semicolons (e.g., \"2;3\"). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the connector geometry and cuts to reflect changes in the wall, stud positions, or property settings. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not rely on external settings files; all configuration is handled via the Properties Palette and input dialogs.\n\n## Tips\n- **Orientation Control**: The script automatically determines if the connector should face \"Up\" or \"Down\" based on where you click relative to the wall's origin (usually the bottom-left corner). If the connector appears upside down, try picking a point significantly higher or lower on the wall.\n- **Multi-Insert**: You can select multiple studs in Step 3. The script will generate a connector for each selected stud based on the single configuration chosen in Step 2.\n- **No-Nail Zones**: Ensure the `NoNail` property matches your specific wall layering (e.g., layer 2 for studs, 3 for sheathing) to prevent the nailing machine from shooting into the metal bracket.\n\n## FAQ\n- **Q: I see an \"Invalid connection\" message. What does this mean?**\n- **A:** You likely did not select any valid studs or the selected beams are not perpendicular to the wall element. Select at least one valid stud and try again.\n- **Q: How do I switch between a Left-hand and Right-hand connector?**\n- **A:** Select the connector, open the Properties Palette (Ctrl+1), and change the **Type** property (e.g., change `...L-B` to `...R-B`).\n- **Q: Why is my drill hole the wrong size?**\n- **A:** The drill hole size is tied to the Type property. Ensure you have selected the correct hardware variant (HD2P1 uses 9mm, HD2P2 uses 6.5mm)."
      },
      "tokens_used": 5368,
      "error": null
    }
  }
}