{
  "filename": "hsbTileVerge.mcr",
  "status": "completed",
  "total_tokens": 49321,
  "processing_time": 302.94202280044556,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": 2,\n    \"minorVersion\": 7,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"This tsl creates an instance of verge tiles per roofplane and computes the quantity of the required tiles. The roof plane needs to have a tile definition, the hsbTileGrid Tsl needs to be attached and the vertical tiling must be in range.\",\n  \"versionHistory\": [\n    {\n      \"version\": \"2.7\",\n      \"date\": \"23jul23\",\n      \"author\": \"nils.gregor@hsbcad.com\",\n      \"changes\": \"HSB-19266: Use ridge connection tile map to detect last verge.\\\"\"\n    },\n    {\n      \"version\": \"2.6\",\n      \"date\": \"08nov22\",\n      \"author\": \"nils.gregor@hsbcad.com\",\n      \"changes\": \"HSB-16994: Bugfix first verge tile not shown. Added functionality to add half tiles if needed\\\"\"\n    },\n    {\n      \"version\": \"2.5\",\n      \"date\": \"08nov22\",\n      \"author\": \"nils.gregor@hsbcad.com\",\n      \"changes\": \"\\\"HSB-16994 test to avoid error message\"\n   "
      },
      "tokens_used": 9034,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Found '_kModelSpace' used in tslNew.dbCreate() during insertion. Script prompts for ERoofPlane input via PrEntity and processes roof geometry (CoordSys, EdgeTileData). No references to _kPaperSpace, _Viewport, or sd_ prefixes."
        },
        "prerequisites": {
          "requiredEntities": [
            "ERoofPlane"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing a RoofPlane with tiling properties",
          "requiredSettings": [
            "Hsb_RoofTile map on RoofPlane",
            "Hsb_TileExportData map on RoofPlane (generated by hsbTileGrid)",
            "RoofTilingManager.dll"
          ]
        }
      },
      "tokens_used": 6789,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select roofplane|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9373,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Calculates, visualizes, and generates hardware items for verge tiles (gable end tiles) on a specific roof plane, automatically handling half-tiles and ridge connections.\",\n    \"category\": \"Hardware / Roofing\",\n    \"typicalUseCase\": \"After running the main roof tiling (hsbTileGrid), this script is attached to a roof plane to calculate the specific quantity and type of tiles needed for the sloped edges (verges) and to visualize them in the 3D model.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"ssErp (RoofPlane)\",\n      \"technicalDefault\": \"User Prompt Selection\",\n      \"businessMeaning\": \"The specific roof plane to be analyzed for verge tiling. This entity provides the geometric boundary, slope, and the attached tile style definition required to generate the correct hardware.\",\n      \"validRange\": \"Any valid ERoofPlane entity that has a tile style assigned and has been processed by hsbTileGrid.\",\n      \"unit\": \"Entity\",\n      \"affectsOutput\": \"Defines the location, pitch (which affects hardware rotation), and boundary of the generated tiles. Changing the roof plane geometry or slope will trigger a recalculation of tile positions.\"\n    },\n    {\n      \"name\": \"ncVerge (Standard Verge Color)\",\n      \"technicalDefault\": \"112 (Blue"
      },
      "tokens_used": 9789,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Inserted",
          "Check if insertCycleCount > 1 (erase duplicate instances if true)",
          "Prompt user to select RoofPlane(s) via command line",
          "Iterate through selected entities",
          "Attach new TSL instance to each selected RoofPlane in ModelSpace",
          "Erase original temporary TSL instance",
          "Instance Calculates: Retrieve RoofPlane entity and check validity",
          "Check for duplicate TSL instances attached to RoofPlane (erase if found)",
          "Extract RoofPlane geometry (Coordinate System, Pitch, Plane)",
          "Read Tile Export Data from RoofPlane map (Distributions, Z-Offset, Roof Profile)",
          "Validate Tile Data (Hsb_RoofTile and Hsb_TileExportData exist)",
          "Retrieve Roof Tile Family and Manufacturer definitions",
          "Query Roof Topology to identify Edge Types (Verges, Ridges, Eaves)",
          "Iterate through detected Verge edges",
          "Calculate Verge Tile distribution based on profile geometry and tile dimensions",
          "Check for Half-Tiles at the start/end of verge rows",
          "Check for Ridge Connections at the top of verge rows",
          "Validate special tiles (hsbTileSpecial) overlapping with calculated half-tiles",
          "Draw 2D visualization of Verge and Half Tiles",
          "Generate Hardware List items (Tile count, Article Number, Dimensions, Material)",
          "Check for overlapping Verge geometries and report warnings",
          "Update RoofPlane SubMap (Hsb_TileExportData) with subtracted full tiles and half-tile areas",
          "Store Verge Edge Data for subsequent scripts (e.g., hsbTileSpecial)"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle",
            "path1": {
              "name": "First Cycle",
              "steps": [
                "Proceed with Entity selection and script creation"
              ]
            },
            "path2": {
              "name": "Subsequent Cycle",
              "steps": [
                "Erase instance to prevent duplicates",
                "Return immediately"
              ]
            }
          },
          {
            "condition": "Duplicate TSL Instance",
            "path1": {
              "name": "Duplicate Found",
              "steps": [
                "Report 'already attached to roofplane' message",
                "Erase instance",
                "Return"
              ]
            },
            "path2": {
              "name": "No Duplicate",
              "steps": [
                "Set Dependency on RoofPlane",
                "Continue calculation"
              ]
            }
          },
          {
            "condition": "Tile Data Availability",
            "path1": {
              "name": "Data Missing/Invalid",
              "steps": [
                "Report 'Unexpected error' or 'could not find valid roof tile data'",
                "Erase instance",
                "Return"
              ]
            },
            "path2": {
              "name": "Data Valid",
              "steps": [
                "Extract Family, Standard Tile, and Manufacturer data",
                "Query .NET assembly for special tiles"
              ]
            }
          },
          {
            "condition": "Special Tile Overlap",
            "path1": {
              "name": "Overlap Detected",
              "steps": [
                "Skip creation of the specific half-tile",
                "Do not add to hardware count"
              ]
            },
            "path2": {
              "name": "No Overlap",
              "steps": [
                "Draw half-tile visualization",
                "Add to hardware quantity list",
                "Update full tile subtraction count"
              ]
            }
          },
          {
            "condition": "Ridge Connection",
            "path1": {
              "name": "Ridge Connection Exists",
              "steps": [
                "Retrieve specific connector hardware",
                "Add 1x Connector to hardware list",
                "Increment full tile subtraction count"
              ]
            },
            "path2": {
              "name": "No Ridge Connection",
              "steps": [
                "Proceed to next verge row"
              ]
            }
          },
          {
            "condition": "Hardware Generation",
            "path1": {
              "name": "Tiles Found",
              "steps": [
                "Create HardWrComp objects",
                "Apply Color, Transparency, Material, Dimensions",
                "Assign to instance"
              ]
            },
            "path2": {
              "name": "No Verge Tiles",
              "steps": [
                "Report 'No verge tile in distribution range found'",
                "Erase instance",
                "Return"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "RoofPlane Entity Validity",
            "errorMessage": "Unexpected error / no valid roofplane found",
            "recovery": "Ensure a valid ERoofPlane is selected and exists in the drawing."
          },
          {
            "check": "Duplicate Attachment",
            "errorMessage": "ScriptName - already attached to roofplane.",
            "recovery": "Remove the existing attached instance before re-inserting."
          },
          {
            "check": "Export Data Points",
            "errorMessage": "Unexpected error. (Missing distribution points)",
            "recovery": "Ensure hsbTileGrid has been run on the selected RoofPlane to generate Hsb_TileExportData."
          },
          {
            "check": "Family Definition",
            "errorMessage": "could not find valid roof tile data. Please make sure the roofplane has a roof tile style assigned.",
            "recovery": "Assign a valid Roof Tile Style to the RoofPlane."
          },
          {
            "check": "Verge Overlap",
            "errorMessage": "Vergetiles overlap. Change verge!",
            "recovery": "Adjust Roof Tile Style settings (width/overlap) or Roof Geometry to resolve overlap."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify RoofPlane Geometry",
            "how": "Grip edit or Move/Rotate RoofPlane",
            "effect": "Triggers recalculation of verge positions, quantities, and hardware."
          },
          {
            "action": "Change Roof Tile Style",
            "how": "Properties Palette (OPM) on RoofPlane",
            "effect": "Updates tile dimensions, manufacturer, and recalculates all verge calculations."
          },
          {
            "action": "Add/Move Special Tiles",
            "how": "Insert hsbTileSpecial script",
            "effect": "Verge script detects overlap and removes half-tiles that conflict with special tiles."
          },
          {
            "action": "Delete Script",
            "how": "Select TSL instance and Delete",
            "effect": "Removes verge visualization and hardware, restores full tile count in Tile Grid."
          }
        ]
      },
      "tokens_used": 8726,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbTileVerge.mcr\n\n## Overview\nThis script calculates, visualizes, and generates hardware items for verge tiles (gable end tiles) on a specific roof plane. It automatically handles complex configurations like half-tiles and ridge connections based on the assigned roof tile style.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be attached to an ERoofPlane in the model. |\n| Paper Space | No | Not designed for Paper Space or viewports. |\n| Shop Drawing | No | This is a model generation script, not a detailing tool. |\n\n## Prerequisites\n- **Required Entities**: An existing `ERoofPlane` (Roof Plane) in the drawing.\n- **Minimum Beam Count**: 0 (This script attaches to planes/elements, not beams).\n- **Required Settings**:\n  - A valid Roof Tile Style must be assigned to the Roof Plane.\n  - The `hsbTileGrid` script must already be attached and executed on the Roof Plane to generate the necessary tile export data.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or `_TSLINSERT`)\nAction: Browse the file list and select `hsbTileVerge.mcr`.\n\n### Step 2: Select Roof Plane\n```\nCommand Line: Select roofplane\nAction: Click on the desired Roof Plane entity in the drawing that you wish to generate verge tiles for.\n```\n\n### Step 3: Automatic Execution\nAction: The script automatically attaches to the roof plane, calculates the verge geometry, and generates the tile representations and hardware list.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| ncVerge | Integer | 112 (Blue) | Determines the display color of the standard verge tiles in the 3D model. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | No custom context menu options are provided by this script. |\n\n## Settings Files\n- **Filename**: N/A\n- **Location**: N/A\n- **Purpose**: This script relies on data maps (`Hsb_RoofTile`, `Hsb_TileExportData`) generated directly on the Roof Plane entity by the hsbTileGrid script, rather than external XML settings files.\n\n## Tips\n- **Run Order**: Always ensure `hsbTileGrid` is run before this script. If the verge tiles do not appear, check if `hsbTileGrid` is successfully generating tiles on the main roof area.\n- **Half-Tiles**: The script automatically calculates and inserts half-tiles if the geometry requires them, and it prevents overlap with special tiles (like vents or windows).\n- **Ridge Connections**: If the verge meets a ridge, the script will identify the correct connector hardware automatically.\n- **Overlaps**: If you see a warning \"Vergetiles overlap\", try adjusting your roof tile style settings (tile width/overlap) or modify the roof geometry slightly.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the roof plane?**\n  - **A:** This usually happens if the Roof Plane does not have a valid Tile Style assigned, or if `hsbTileGrid` has not been run yet (missing export data). It may also happen if the script is already attached to that roof plane.\n- **Q: Can I use this on multiple roof planes at once?**\n  - **A:** Yes, you can select multiple roof planes during the `Select roofplane` prompt, and the script will attach an instance to each one.\n- **Q: Do I need to count the tiles manually for reports?**\n  - **A:** No, the script generates hardware list items (HardWrComp) automatically, which will appear in your material lists and reports."
      },
      "tokens_used": 5610,
      "error": null
    }
  }
}