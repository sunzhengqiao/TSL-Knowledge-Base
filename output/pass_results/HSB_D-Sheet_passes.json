{
  "filename": "HSB_D-Sheet.mcr",
  "status": "completed",
  "total_tokens": 56120,
  "processing_time": 265.0468966960907,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9482,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getViewport() for user input and checks _Viewport.length(). It calculates the Model Space to Paper Space transformation using vp.coordSys() (ms2ps) and transforms dimensions using dim.transformBy(ms2ps). Properties include 'Offset in paperspace units'. The script draws text and dimensions at a user-selected point _Pt0 in the layout."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Sheet"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space (Layout) containing a Viewport linked to a sheet element",
          "requiredSettings": []
        }
      },
      "tokens_used": 7602,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getViewport\",\n        \"promptOriginal\": \"\\nSelecteer een viewport\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"Selecteer een positie\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"showDialog\",\n      \"trigger\": \"During insert (_bOnInsert) if _kExecuteKey is empty\",\n      \"title\": null,\n      \"dataSource\": \"OPM Properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 14,\n      \"variable\": \"sInExcludeFilters\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     Include/exclude\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Yes\",\n        \"No\"\n      ],\n      \"category\": \"Selection\",\n      \"description\": null\n    },\n    {\n      \"index\": 15,\n      \"variable\": \"sFilterBC\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     Filter beamcode\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Selection\",\n      \"description\": null\n    },\n    {\n      \"index\": 16,\n      \"variable\": \"sFilterMaterial\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     Filter material\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Selection\",\n      \"description\": null\n    },\n    {\n      \"index\": 17,\n      \"variable\": \"sFilterLabel\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     Filter label\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Selection\",\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"nZoneProp\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"     Zone\",\n      \"defaultValue\": 1,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        1,\n        2,\n        3,\n        4,\n        5,\n        6,\n        7,\n        8,\n        9,\n        10\n      ],\n      \"category\": \"Dimension Object\",\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sDimPerimeter\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     Dimension perimeter\",\n      \"defaultValue\": \"Yes\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Yes\",\n        \"No\"\n      ],\n      \"category\": \"Dimension Object\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sDimSheetEdges\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     Dimension sheet edges\",\n      \"defaultValue\": \"At sheet edges\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No dimension\",\n        \"At sheet edges\",\n        \"Dimension lines\"\n      ],\n      \"category\": \"Dimension Object\",\n      \"description\": null\n    },\n    {\n      \"index\": 13,\n      \"variable\": \"sDimSheetExtremes\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     Dimension extremes per sheet\",\n      \"defaultValue\": \"Yes\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Yes\",\n        \"No\"\n      ],\n      \"category\": \"Dimension Object\",\n      \"description\": \"Extremes are only dimensioned when 'Dimension sheet edges' property is set to 'At sheet edges'\"\n    },\n    {\n      \"index\": 18,\n      \"variable\": \"sDimAngles\",\n      \"type\": \"PropString\",\n      \"displayName"
      },
      "tokens_used": 10190,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automatically generates dimension lines, material labels, and geometric data for timber sheets on 2D drawings (layouts), based on the selected viewport and zone configuration.\",\n    \"category\": \"ShopDrawing\",\n    \"typicalUseCase\": \"An engineer or drafter places this script on a layout (Paper Space) to dimension floor cassettes, wall panels, or roof sheets shown in a viewport, ensuring all relevant sizes are annotated correctly relative to the sheet's local coordinate system.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sInExcludeFilters\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Determines if the subsequent filters (beamcode, material, label) are used to INCLUDE specific sheets in the dimensioning or EXCLUDE them.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"enum\",\n      \"affectsOutput\": \"Controls which sheets within the viewport are selected for dimensioning based on the filter criteria.\"\n    },\n    {\n      \"name\": \"sFilterBC\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Filters sheets based on their BeamCode (e.g., 'FLR', 'WALL'). Only sheets matching this code are processed if the filter is active.\",\n      \"validRange\": \"Any valid BeamCode string\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Limits dimension generation to specific sheet types defined by the BeamCode.\"\n    },\n    {\n      \"name\": \"sFilterMaterial\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Filters sheets based on their material name (e.g., 'C24', 'GL24h'). Only sheets matching this material are processed if the filter is active.\",\n      \"validRange\": \"Any valid Material name\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Limits dimension generation to sheets made of specific materials.\"\n    },\n    {\n      \"name\": \"sFilterLabel\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Filters sheets based on their assigned label property.\",\n      \"validRange\": \"Any valid Label string\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Limits dimension generation to sheets with a specific label.\"\n    },\n    {\n      \"name\": \"nZoneProp\",\n      \"technicalDefault\": 1,\n      \"businessMeaning\": \"Selects the specific manufacturing or construction zone to dimension. In prefab timber, zones often represent sections of a building (e.g., East Wing, Floor 1).\",\n      \"validRange\": \"1 to 10\",\n      \"unit\": \"count\",\n      \"affectsOutput\": \"Only sheets belonging to the selected zone number will be dimensioned.\"\n    },\n    {\n      \"name\": \"sDimPerimeter\",\n      \"technicalDefault\": \"Yes\",\n      \"businessMeaning\": \"Toggles the dimensioning of the outer boundary (overall length and width) of the sheet element.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"enum\",\n      \"affectsOutput\": \"If Yes, draws overall dimension lines indicating the total size of the sheet.\"\n    },\n    {\n      \"name\": \"sDimSheetEdges\",\n      \"technicalDefault\": \"At sheet edges\",\n      \"businessMeaning\": \"Determines how individual sheet segments (e.g., within a floor cassette) are dimensioned. 'At sheet edges' places dimensions at the specific edges of single timber boards, while 'Dimension lines' creates continuous dimension chains.\",\n      \"validRange\": \"No dimension, At sheet edges, Dimension lines\",\n      \"unit\": \"enum\",\n      \"affectsOutput\": \"Changes the location and style of dimensions for individual sheet parts.\"\n    },\n    {\n      \"name\": \"sDimSheetExtremes\",\n      \"technicalDefault\": \"Yes\",\n      \"businessMeaning\": \"Toggles dimensioning of the extreme outer points (min/max) of the sheet configuration, often used to define the"
      },
      "tokens_used": 10856,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script initialization: Define property arrays and set up Right-Click menu triggers.\",\n    \"2. User executes script (Insert).\",\n    \"3. System checks insert cycle count. If > 1, script self-destructs.\",\n    \"4. Command line prompt: 'Selecteer een viewport' (Select a viewport).\",\n    \"5. Command line prompt: 'Selecteer een positie' (Select position for instance).\",\n    \"6. System triggers Property Palette (OPM) display.\",\n    \"7. Script retrieves the Element associated with the selected Viewport.\",\n    \"8. Script checks the 'FilterElements' Map for the current Element handle.\",\n    \"9. System retrieves coordinate transformation (Model Space to Paper Space).\",\n    \"10. Script generates dimensions based on 'Dimension perimeter' and 'Dimension sheet edges' settings.\",\n    \"11. Script processes sheet openings: draws lines if 'Show crossing in opening' is Yes.\",\n    \"12. Script draws the Instance Name and Description at the selected Paper Space point.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Insert Cycle Count\",\n      \"path1\": {\n        \"name\": \"Cycle 1 (Initial Insert)\",\n        \"steps\": [\n          \"Prompt for Viewport\",\n          \"Prompt for Point\",\n          \"Show Properties Dialog\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Cycle > 1\",\n        \"steps\": [\n          \"Erase Instance\",\n          \"Exit Script\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Viewport Availability\",\n      \"path1\": {\n        \"name\": \"Viewport Selected\",\n        \"steps\": [\n          \"Get Element from Viewport\",\n          \"Check Element Validity\",\n          \"Proceed to Drawing\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No Viewport Selected\",\n        \"steps\": [\n          \"Erase Instance\",\n          \"Exit\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Manual Element Filter (Context Menu)\",\n      \"path1\": {\n        \"name\": \"Element is Filtered\",\n        \"steps\": [\n          \"Change Instance Name color to 'Filter this element color'\",\n          \"Draw 'Active filter' subtitle\",\n          \"Stop processing (Return)\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Element is Not Filtered\",\n        \"steps\": [\n          \"Process sheet geometry and dimensions\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Property: Dimension Perimeter (Yes/No)\",\n      \"path1\": {\n        \"name\": \"Yes\",\n"
      },
      "tokens_used": 11773,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_D-Sheet\n\n## Overview\nThis script automatically generates dimension lines, material labels, and geometric data for timber sheets on 2D drawings (layouts). It is used to annotate floor cassettes, wall panels, or roof sheets shown in a viewport, ensuring sizes are correct relative to the sheet's coordinate system.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed specifically for layouts. |\n| Paper Space | Yes | The script must be inserted onto a layout tab containing a viewport. |\n| Shop Drawing | N/A | This is an interactive script for detailing layouts, not an automated shop drawing generator. |\n\n## Prerequisites\n- **Required Entities**: A Viewport in Paper Space that is linked to a Sheet element (or Element).\n- **Minimum Beam Count**: 0.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `HSB_D-Sheet.mcr`\n\n### Step 2: Select Viewport\n```\nCommand Line: Selecteer een viewport\nAction: Click on the viewport border or inside the viewport that displays the sheets you want to dimension.\n```\n\n### Step 3: Select Position\n```\nCommand Line: Selecteer een positie\nAction: Click a point in the Paper Space (layout) where you want the script instance anchor to be placed.\n```\n\n### Step 4: Configure Properties\nAfter selecting the position, the Properties Palette will open. Adjust the filters and dimension settings to match your detailing requirements.\n\n## Properties Panel Parameters\n\n### Selection\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Include/exclude | dropdown | No | Determines if the filters below are used to Include specific sheets in the dimensioning or Exclude them. |\n| Filter beamcode | text | [Empty] | Filter sheets by their BeamCode (e.g., 'FLR', 'WALL'). Leave empty to accept all codes. |\n| Filter material | text | [Empty] | Filter sheets by their material name (e.g., 'C24'). |\n| Filter label | text | [Empty] | Filter sheets by their assigned label property. |\n\n### Dimension Object\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Zone | dropdown | 1 | Selects the manufacturing zone number (1-10) to dimension. Only sheets belonging to this zone will be processed. |\n| Dimension perimeter | dropdown | Yes | If Yes, draws overall dimension lines indicating the total length and width of the sheet. |\n| Dimension sheet edges | dropdown | At sheet edges | Sets the style for internal dimensions. <br>• *No dimension*: No internal dims.<br>• *At sheet edges*: Places dimensions at the specific edges of boards.<br>• *Dimension lines*: Creates continuous dimension chains. |\n| Dimension extremes per sheet | dropdown | Yes | If Yes, dimensions the extreme outer points (min/max) of the sheet configuration. Only works if 'Dimension sheet edges' is set to 'At sheet edges'. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Filter Elements | Allows you to manually filter specific elements. If an element is filtered, the instance name changes color to indicate it is being filtered out. |\n\n## Settings Files\n- **Filename**: None specified.\n- **Location**: N/A\n- **Purpose**: This script operates via standard Properties Palette settings.\n\n## Tips\n- **Self-Destruct Mechanism**: If you attempt to insert the script again on the same viewport (Cycle > 1), the instance will erase itself. To update dimensions, select the existing instance and modify its properties in the palette.\n- **Viewport Linking**: Ensure the viewport you select is actually linked to the 3D model; otherwise, the script cannot detect the sheets to dimension.\n- **Color Change**: If the text of the script instance changes color, check if elements have been manually filtered via the right-click menu.\n\n## FAQ\n- **Q: Why did the script disappear after I tried to insert it again?**\n  A: The script is designed to run only once per insertion cycle. If you insert it again in the same session, it deletes the previous instance and exits to prevent duplicates. Use the Properties palette to modify the existing one.\n- **Q: Can I use this to dimension individual beams?**\n  A: No, this script is designed specifically for \"Sheets\" (e.g., cassettes, panels), not single timber beams.\n- **Q: What does \"Selecteer een viewport\" mean?**\n  A: This is Dutch for \"Select a viewport\". The script prompts you to click on the viewport frame in your layout that displays the model you wish to dimension."
      },
      "tokens_used": 6217,
      "error": null
    }
  }
}