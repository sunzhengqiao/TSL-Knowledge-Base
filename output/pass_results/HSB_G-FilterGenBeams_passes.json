{
  "filename": "HSB_G-FilterGenBeams.mcr",
  "status": "completed",
  "total_tokens": 50240,
  "processing_time": 417.75008273124695,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 8789,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates on GenBeam entities, prompting the user to 'Select genbeams to filter' and accessing 3D properties such as beamCode(), material(), and myZoneIndex(). It does not contain logic for 2D layout generation, viewports, or drawing annotations, nor does it use the sd_ prefix or #Type E indicators."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D Model)",
          "requiredSettings": [
            "HSB_G-ContentFormat (loaded in the drawing for custom property filtering)"
          ]
        }
      },
      "tokens_used": 6230,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getGenBeam",
              "promptOriginal": "Select genbeams to filter",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "operationFilter",
            "type": "PropString",
            "displayName": "Operation filter",
            "defaultValue": "|Exclude|",
            "inputType": "dropdown",
            "options": [
              "|Exclude|",
              "|Include|"
            ],
            "category": "|Operation|",
            "description": "Include or exclude entities meeting the filter criteria."
          },
          {
            "index": 9,
            "variable": "operator",
            "type": "PropString",
            "displayName": "Operator",
            "defaultValue": "|Any|",
            "inputType": "dropdown",
            "options": [
              "|All|",
              "|Any|"
            ],
            "category": "|Operation|",
            "description": "Specify whether all of the specified properties have to match or one of them."
          },
          {
            "index": 1,
            "variable": "propBeamCodes",
            "type": "PropString",
            "displayName": "Beam codes",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Fixed Properties|",
            "description": null
          },
          {
            "index": 2,
            "variable": "propMaterials",
            "type": "PropString",
            "displayName": "Materials",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Fixed Properties|",
            "description": null
          },
          {
            "index": 3,
            "variable": "propLabels",
            "type": "PropString",
            "displayName": "Labels",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Fixed Properties|",
            "description": null
          },
          {
            "index": 4,
            "variable": "propHsbIds",
            "type": "PropString",
            "displayName": "Hsb Id's",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Fixed Properties|",
            "description": null
          },
          {
            "index": 5,
            "variable": "propZones",
            "type": "PropString",
            "displayName": "Zones",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Fixed Properties|",
            "description": null
          },
          {
            "index": 6,
            "variable": "propNames",
            "type": "PropString",
            "displayName": "Names",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Fixed Properties|",
            "description": null
          },
          {
            "index": 7,
            "variable": "propCustom",
            "type": "PropString",
            "displayName": "Custom Property",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Format Properties|",
            "description": "Specify a custom propertie e.g. @(Material) or @(PropertySet.Property)"
          },
          {
            "index": 8,
            "variable": "propCustomValues",
            "type": "PropString",
            "displayName": "Custom Values",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Format Properties|",
            "description": "Specify the value to check the custom property, * can be used as wildcard and as delimiter ;"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9228,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Filters a selection of timber beams (GenBeams) based on specific properties like material, zone, or custom attributes to create a subset for further processing.",
          "category": "Utility",
          "typicalUseCase": "Selecting specific groups of beams (e.g., only structural walls in Zone 1) from a large model to generate reports or apply specific machining operations."
        },
        "parameters": [
          {
            "name": "operationFilter",
            "technicalDefault": "|Exclude|",
            "businessMeaning": "Determines if the filter should hide (Exclude) or keep (Include) the beams that match the specified criteria.",
            "validRange": "Include, Exclude",
            "unit": "Boolean logic",
            "affectsOutput": "Inverts the result of the filtering logic, either retaining matching beams in the output set or removing them."
          },
          {
            "name": "operator",
            "technicalDefault": "|Any|",
            "businessMeaning": "Defines how multiple filter criteria are combined. 'Any' means a beam matches if one condition is true. 'All' means a beam must meet every active condition.",
            "validRange": "Any, All",
            "unit": "Logic operator",
            "affectsOutput": "Changes the strictness of the filter. 'Any' usually results in larger beam sets; 'All' results in smaller, more specific sets."
          },
          {
            "name": "propBeamCodes",
            "technicalDefault": "",
            "businessMeaning": "Filters beams based on their internal Beam Code (e.g., standard dimensions or profile types).",
            "validRange": "Standard beam codes used in the project (e.g., 'K240', 'ST200'). Supports wildcards like '*240*'.",
            "unit": "String",
            "affectsOutput": "Selects or excludes beams based on their cross-sectional type or standard profile."
          },
          {
            "name": "propMaterials",
            "technicalDefault": "",
            "businessMeaning": "Filters beams based on the assigned timber material grade or species.",
            "validRange": "Material names defined in the project or catalogs (e.g., 'C24', 'GL24h').",
            "unit": "String",
            "affectsOutput": "Selects beams of specific wood strength classes or types."
          },
          {
            "name": "propLabels",
            "technicalDefault": "",
            "businessMeaning": "Filters beams based on user-defined labels used for grouping or identification.",
            "validRange": "Any string label assigned to beams.",
            "unit": "String",
            "affectsOutput": "Selects beams that share a specific classification label."
          },
          {
            "name": "propHsbIds",
            "technicalDefault": "",
            "businessMeaning": "Filters beams based on their unique HSB identifier numbers.",
            "validRange": "Numeric IDs or ranges as strings.",
            "unit": "String (Numeric)",
            "affectsOutput": "Selects specific beams by their system-generated or manually assigned IDs."
          },
          {
            "name": "propZones",
            "technicalDefault": "",
            "businessMeaning": "Filters beams based on their assigned construction zone (e.g., Ground Floor, Zone A).",
            "validRange": "Zone names or indices defined in the project (e.g., '1', 'GF', 'Roof').",
            "unit": "String",
            "affectsOutput": "Selects beams belonging to a specific part of the building structure."
          },
          {
            "name": "propNames",
            "technicalDefault": "",
            "businessMeaning": "Filters beams based on their entity name.",
            "validRange": "Names assigned to beams.",
            "unit": "String",
            "affectsOutput": "Selects beams with specific naming conventions."
          },
          {
            "name": "propCustom",
            "technicalDefault": "",
            "businessMeaning": "Specifies the name of a custom property or data field to evaluate (e.g., Manufacturer, FireRating).",
            "validRange": "Valid property names from the element's property set or format map.",
            "unit": "String",
            "affectsOutput": "Defines the field to check against the custom values."
          },
          {
            "name": "propCustomValues",
            "technicalDefault": "",
            "businessMeaning": "Specifies the value(s) to match in the custom property field. Supports wildcards.",
            "validRange": "Values corresponding to the Custom Property field (e.g., '60min', 'Spruce').",
            "unit": "String",
            "affectsOutput": "Selects beams where the custom property matches this value."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "propCustom is empty",
            "effect": "Custom property filtering is skipped regardless of propCustomValues.",
            "cascade": [
              "propCustomValues"
            ]
          },
          {
            "trigger": "Operator is 'All'",
            "effect": "A beam only passes if it matches all non-empty filter fields (BeamCode AND Material AND Zone...).",
            "cascade": [
              "propBeamCodes",
              "propMaterials",
              "propLabels",
              "propHsbIds",
              "propZones",
              "propNames",
              "propCustomValues"
            ]
          },
          {
            "trigger": "Operator is 'Any'",
            "effect": "A beam passes if it matches at least one non-empty filter field (BeamCode OR Material OR Zone...).",
            "cascade": [
              "propBeamCodes",
              "propMaterials",
              "propLabels",
              "propHsbIds",
              "propZones",
              "propNames",
              "propCustomValues"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "EntityArray (GenBeams)",
            "description": "A filtered list of GenBeam entities stored in the _Map under the key 'GenBeams'.",
            "appliedTo": "The subset of the original selection that meets the criteria defined in the script properties."
          }
        ]
      },
      "tokens_used": 8497,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched via Insert command or Map execution.",
          "Properties initialized from default values.",
          "Execute Key Logic Check: Script checks if _kExecuteKey is valid and exists in the TSL Instance Catalog list.",
          "[Conditional] Execute Key Handling: If valid, properties are loaded from the Catalog, and the Catalog Map Object is updated/created.",
          "[Conditional] Insert Mode Flow: If _bOnInsert is true, the script handles the initial setup.",
          "[Conditional] Insert Cycle Check: If insertCycleCount() > 1, the instance is erased (multi-insert protection).",
          "Dialog Interaction: If no valid Execute Key is provided, the property dialog (showDialog) is displayed to the user.",
          "Catalog Update: The current property values are saved to the 'LastInserted' catalog entry.",
          "Entity Selection: User is prompted to 'Select genbeams to filter'.",
          "Map Population: Selected GenBeams are stored in the _Map under key 'GenBeams'. ManualInsert flag is set to true in _Map.",
          "Script pauses/ends initial insertion phase (return).",
          "Script Re-execution/Processing Phase: The script runs again with the populated _Map.",
          "Source of Properties Check: Determines if properties come from Catalog Dictionary, Map Input (manual), or a MapObject call.",
          "Map Input Priority: If _kExecuteKey is empty/default or not in catalogs, properties are read from the _Map (e.g., BeamCode[], Material[], Operator[]).",
          "Property Parsing: Filter strings (BeamCodes, Materials, etc.) are tokenized (split by ';') and converted to Uppercase for case-insensitive comparison.",
          "Processing Trigger: Logic runs if _bOnMapIO, ManualInsert flag is true, or _bOnDebug is active.",
          "Entity Iteration: Script loops through every GenBeam stored in the 'GenBeams' array in the _Map.",
          "Entity Validation: Skips invalid GenBeam entities.",
          "Comparison Loop: For each beam, the script retrieves properties (BeamCode, Material, Label, etc.) and compares them against the user-defined filter tokens using exact match or wildcard logic (*value, value*, *value*).",
          "Custom Property Check: If 'Custom Property' is set, the script calls 'HSB_G-ContentFormat' to evaluate the custom property value.",
          "Operator Evaluation: Based on the 'Operator' property ('Any' or 'All'), the script determines if the beam matches the criteria (Any=OR logic, All=AND logic).",
          "Inclusion/Exclusion Logic: The beam is added to the 'resultingGenBeams' array if it meets the 'Operation filter' criteria (Include matched items OR Exclude matched items).",
          "Result Storage: The filtered array of GenBeams is written back to the _Map under the key 'GenBeams'.",
          "[Conditional] Manual Insert Clean-up: If ManualInsert was true, a message is reported to the user, and the script instance is erased.",
          "Script Ends."
        ],
        "conditionalBranches": [
          {
            "condition": "Is a valid Execute Key provided during insertion?",
            "path1": {
              "name": "Catalog Load Path",
              "steps": [
                "Load properties from the Catalog specified by _kExecuteKey.",
                "Update the Catalog Dictionary/MapObject with these settings.",
                "Skip the initial Dialog display.",
                "Proceed to Entity Selection."
              ]
            },
            "path2": {
              "name": "Manual/Default Path",
              "steps": [
                "Check _Map for incoming properties (BeamCode[], Material[], etc.).",
                "Show Dialog to user if no Map properties found.",
                "Proceed to Entity Selection."
              ]
            }
          },
          {
            "condition": "What is the 'Operator' setting during filtering?",
            "path1": {
              "name": "Any (OR Logic)",
              "steps": [
                "A beam passes the filter if it matches ANY of the specified active criteria (e.g., matches Material OR matches Zone).",
                "Empty filter fields are ignored."
              ]
            },
            "path2": {
              "name": "All (AND Logic)",
              "steps": [
                "A beam passes the filter ONLY if it matches ALL specified active criteria (e.g., must match Material AND Zone AND Label).",
                "Only fields with user input are considered in the check."
              ]
            }
          },
          {
            "condition": "What is the 'Operation filter' setting?",
            "path1": {
              "name": "Include",
              "steps": [
                "Beams that match the filter criteria are KEPT in the result set.",
                "Beams that do not match are REMOVED."
              ]
            },
            "path2": {
              "name": "Exclude",
              "steps": [
                "Beams that match the filter criteria are REMOVED from the result set.",
                "Beams that do not match are KEPT."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Is 'HSB_G-ContentFormat' TSL loaded in the drawing?",
            "errorMessage": "Please make sure the tsl HSB_G-ContentFormat is loaded in the drawing",
            "recovery": "The user must load the 'HSB_G-ContentFormat' script into the drawing to use Custom Property filtering."
          },
          {
            "check": "Is the GenBeam entity valid?",
            "errorMessage": "None (Internal check)",
            "recovery": "The script automatically skips invalid entities in the loop."
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Internal check)",
            "recovery": "The script erases itself silently if insertCycleCount() > 1 to prevent duplicate instances."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Filter Properties",
            "how": "Select script instance, open Properties Palette (OPM), edit properties (Beam codes, Materials, Operator, etc.)",
            "effect": "The filtering logic updates immediately upon property change (assuming the script listens to properties or is re-triggered). Note: As this script auto-erases on manual insert, post-insertion modification usually applies to instances used as persistent filters or MapIO calls where the instance remains."
          },
          {
            "action": "Re-run filtering",
            "how": "Use the 'Execute' or 'Recalc' context menu option on the script instance.",
            "effect": "The script re-processes the GenBeams stored in its map using the current property values."
          },
          {
            "action": "Change Selection",
            "how": "Not directly supported via grips. Requires re-inserting the script or updating the input Map externally.",
            "effect": "N/A for the standard instance workflow."
          }
        ]
      },
      "tokens_used": 10096,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-FilterGenBeams.mcr\n\n## Overview\nThis script filters a selection of timber beams (GenBeams) based on specific properties such as material, zone, beam code, or custom attributes. It creates a subset of elements for further processing, reporting, or export operations.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates exclusively on 3D GenBeam entities. |\n| Paper Space | No | 2D layout and viewports are not supported. |\n| Shop Drawing | No | This is a model filtering tool, not a detailing tool. |\n\n## Prerequisites\n- **Required Entities**: GenBeam entities must exist in the model.\n- **Minimum Beam Count**: 0 (Script can run on an empty selection, though no output will be generated).\n- **Required Settings**: The script `HSB_G-ContentFormat.mcr` must be loaded in the drawing if you intend to use the \"Custom Property\" filter.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT` (or insert via hsbCAD toolbar)\n**Action**: Select `HSB_G-FilterGenBeams.mcr` from the available scripts list.\n\n### Step 2: Select GenBeams\n```\nCommand Line: Select genbeams to filter\nAction: Click to select beams or use a window selection in the model. Press Enter to confirm selection.\n```\n\n### Step 3: Configure Filter Properties\n**Action**: Before the script finalizes (or if used in a Map configuration), set the desired filter criteria in the Properties Palette (OPM).\n- Fill in the relevant fields (e.g., Materials, Zones).\n- Choose whether to \"Include\" or \"Exclude\" matching items.\n- Decide if the operator should be \"Any\" (match one criteria) or \"All\" (match all criteria).\n\n### Step 4: Processing\n**Action**: The script processes the selection and updates the internal Map with the filtered list of beams.\n- **Note**: If run manually, the script instance will erase itself automatically after processing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Operation filter | Dropdown | \\|Exclude\\| | Determines how matches are handled. **Exclude** removes matching beams; **Include** keeps only matching beams. |\n| Operator | Dropdown | \\|Any\\| | Logic operator. **Any** keeps beams that match at least one filter field. **All** keeps beams that match every active filter field. |\n| Beam codes | Text | Empty | Filter by beam code profile. Use wildcards (e.g., `*240*`) or semicolons for lists. |\n| Materials | Text | Empty | Filter by material grade (e.g., `C24`, `GL24h`). |\n| Labels | Text | Empty | Filter by user-assigned labels. |\n| Hsb Id's | Text | Empty | Filter by unique HSB identifier numbers. |\n| Zones | Text | Empty | Filter by construction zone names or indices (e.g., `1`, `Roof`). |\n| Names | Text | Empty | Filter by the specific entity name. |\n| Custom Property | Text | Empty | Define a custom property to check (e.g., `@(Material)`). Requires `HSB_G-ContentFormat`. |\n| Custom Values | Text | Empty | Define the value to match for the Custom Property. Use `*` as a wildcard or `;` as a delimiter. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalc | Re-runs the filtering logic on the currently stored selection using the current property settings. |\n\n## Settings Files\n- **Dependency**: `HSB_G-ContentFormat.mcr`\n- **Location**: Must be loaded in the current drawing.\n- **Purpose**: Provides the parsing logic for the Custom Property filter functionality.\n\n## Tips\n- **Wildcards**: You can use `*` in text fields to match parts of a string. For example, entering `Wall*` in the \"Names\" field will match \"Wall1\", \"Wall Exterior\", etc.\n- **Multiple Values**: Use a semicolon `;` to separate multiple values in a single field (e.g., `C24;C18`).\n- **Logic Strategy**:\n  - Use **Operator: Any** to gather broad groups (e.g., all beams made of Oak OR Pine).\n  - Use **Operator: All** to find specific items (e.g., Beams that are in Zone 1 AND are labeled \"Structural\").\n- **Case Insensitivity**: The script converts all inputs to uppercase, so you do not need to worry about capitalization (e.g., \"c24\" works the same as \"C24\").\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the beams?**\n  **A**: This is normal behavior for manual insertion. The script runs once to process the filter, saves the result to the system memory (Map), and then self-destructs to keep your drawing clean.\n\n- **Q: Can I filter by length or height?**\n  **A**: Not directly with this specific script. It focuses on data properties (Material, Zone, Name) rather than geometric dimensions. You would need to use a different script or pre-filter your selection manually.\n\n- **Q: I entered a value in \"Custom Values\" but nothing happened.**\n  **A**: Ensure that the \"Custom Property\" field is also correctly filled out (e.g., `@(Material)`). Additionally, verify that the `HSB_G-ContentFormat` script is loaded in your drawing."
      },
      "tokens_used": 7400,
      "error": null
    }
  }
}