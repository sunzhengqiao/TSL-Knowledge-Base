{
  "filename": "GE_HDWR_STUD_PLATE_TIE_SPT_TYPES_1_2_3_5.mcr",
  "status": "completed",
  "total_tokens": 48508,
  "processing_time": 376.0356845855713,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.2",
            "date": "02.jun.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Added features to make possible reset TXT source file using GE_HDWR_RESET_CATALOG_ENTRY tsl"
          },
          {
            "version": "1.1",
            "date": "17.mar.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Prop naming fixed"
          },
          {
            "version": "1.0",
            "date": "07.mar.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "GE_HDWR_RESET_CATALOG_ENTRY"
        ]
      },
      "tokens_used": 7365,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script constructs 3D geometry using PLine and Body objects and assigns them to Element groups. It interacts directly with GenBeam entities using PrEntity and calculates spatial relationships (Vector3d, Point3d). There are no 'sd_' function calls, viewport references, or 2D drawing logic indicative of ShopDrawing or Paper Space scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space containing vertical studs and at least one top or bottom plate.",
          "requiredSettings": [
            "TSL_Read_Metalpart_Family_Props.dll",
            "TXT source file containing SPT family details",
            "TSL_HARDWARE_FAMILY_LIST.dxx"
          ]
        }
      },
      "tokens_used": 6814,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select stud(s) and plate(s)",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Pick a point to define on what face of studs place hardware",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowNotice",
            "trigger": "Context Menu: Help",
            "title": null,
            "dataSource": "Script Internal",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "Type",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null,
            "readOnly": true
          },
          {
            "index": 0,
            "variable": "dLength",
            "type": "PropDouble",
            "displayName": "Lenght",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null,
            "readOnly": true
          },
          {
            "index": 1,
            "variable": "dClearWidth",
            "type": "PropDouble",
            "displayName": "Clear Width",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null,
            "readOnly": true
          },
          {
            "index": 2,
            "variable": "dBaseWidth",
            "type": "PropDouble",
            "displayName": "Base Width",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null,
            "readOnly": true
          },
          {
            "index": 3,
            "variable": "dPlatesHeight",
            "type": "PropDouble",
            "displayName": "Plates Height",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null,
            "readOnly": true
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Change type",
            "handler": "sChangeType",
            "action": "Prompts user (via DotNet dialog) to select a new hardware family type and recalculates the instance.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Help",
            "handler": "sHelp",
            "action": "Displays a message box with instructions: 'SPT Stud Tie Hardware Family types 1-2-3-5...'",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "TSL_HARDWARE_FAMILY_LIST.dxx",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Catalog\\"
            ],
            "purpose": "Catalog of hardware families",
            "required": true
          },
          {
            "filename": "TSL_Read_Metalpart_Family_Props.dll",
            "searchPaths": [
              "_kPathHsbInstall\\Utilities\\TslCustomSettings\\"
            ],
            "purpose": "Reads family properties from TXT source files and provides selection interface",
            "required": true
          }
        ]
      },
      "tokens_used": 9069,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates 3D geometry for Simpson Strong-Tie style stud-to-plate tie straps (Types 1-2-3-5), anchoring vertical studs to top or bottom plates.",
          "category": "Hardware / Connector",
          "typicalUseCase": "Used in timber framing to provide uplift resistance or lateral bracing by physically representing the metal connector that ties a stud to the wall plates."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "\"\"",
            "businessMeaning": "The specific catalog model or part number of the metal tie (e.g., 'SPT1', 'SPT2') selected from the hardware family list.",
            "validRange": "Text string matching keys in TSL_HARDWARE_FAMILY_LIST.dxx",
            "unit": "String",
            "affectsOutput": "Determines the dimensions (Length, Widths) loaded from the external catalog, which in turn reshapes the 3D body."
          },
          {
            "name": "dLength",
            "technicalDefault": "115 (mm)",
            "businessMeaning": "The total vertical height of the metal strap as measured along the stud axis.",
            "validRange": "50 - 1000",
            "unit": "mm",
            "affectsOutput": "Changes the vertical extent of the extruded metal body. Directly impacts the calculation of corner cutouts (15% and 5% of Length)."
          },
          {
            "name": "dClearWidth",
            "technicalDefault": "29 (mm)",
            "businessMeaning": "The horizontal width of the strap at the top (clear span) where it is not wrapped around the plate.",
            "validRange": "20 - 150",
            "unit": "mm",
            "affectsOutput": "Adjusts the width of the top segment of the PLine profile."
          },
          {
            "name": "dBaseWidth",
            "technicalDefault": "35 (mm)",
            "businessMeaning": "The horizontal width of the strap at the base/plate connection point.",
            "validRange": "25 - 150",
            "unit": "mm",
            "affectsOutput": "Adjusts the width of the bottom segment of the PLine profile and controls the width of cutout corners (15% of Base Width)."
          },
          {
            "name": "dPlatesHeight",
            "technicalDefault": "35 (mm)",
            "businessMeaning": "The vertical height of the lower portion of the strap that sits against the stud relative to the plate surface (effective anchor leg height).",
            "validRange": "25 - 100",
            "unit": "mm",
            "affectsOutput": "Offsets the geometry upward from the bottom reference point of the plate assembly."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User executes 'Change type' context menu",
            "effect": "Reloads the 'Map' data from the external TXT catalog using the selected Type string, overwriting the current dimension values.",
            "cascade": [
              "sType",
              "dLength",
              "dClearWidth",
              "dBaseWidth",
              "dPlatesHeight"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (3D Solid)",
            "description": "A symmetrical 3D metal strap representation generated by extruding a custom Polyline profile. The profile includes cutouts at the corners calculated as percentages of the base width and length. It is mirrored across the stud face to create 'ears' on both sides.",
            "appliedTo": "Visualized in Model Space relative to the selected Stud beam and Plate beams."
          }
        ]
      },
      "tokens_used": 8468,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution starts",
          "Check if Execute Key is 'Help' (Context Menu)",
          "[If Help] Display usage instructions in message box and exit",
          "Check if OnInsert, OnRecalc, or 'Change type' trigger",
          "[If Cycle Count > 1] Erase duplicate instance and exit",
          "Prepare Map and call DotNet DLL 'TSL_Read_Metalpart_Family_Props.dll' to load catalog data",
          "[If OnInsert] Load catalog selection dialog via DotNet call; [Else] Retrieve data from internal _Map",
          "[If OnInsert and selection cancelled] Erase instance and exit",
          "[If 'Change type' or Recalc] Update internal _Map with new catalog data",
          "[If OnInsert] Prompt user to select Stud(s) and Plate(s) (PrEntity)",
          "[If OnInsert and no beams selected] Erase instance and exit",
          "[If OnInsert] Prompt user for reference point to determine face (getPoint)",
          "[If OnInsert] Classify beams: Verticals, Bottom Plates, Top Plates",
          "[If OnInsert and no valid plates found] Report error, erase instance, and exit",
          "[If OnInsert and no valid verticals found] Report error, erase instance, and exit",
          "[If OnInsert] For each vertical stud: Clone script instance for Bottom Plate (if present) and Top Plate (if present), attaching specific beam sets and the reference point",
          "[If OnInsert] Erase master instance (script is now distributed to individual studs)",
          "[If Not OnInsert (Script Instance on Stud)] Retrieve coordinate system vectors (vx, vy, vz) and Plate Widths from _Map",
          "[If Manually Inserted (bOnInsert flag)] Calculate local coordinate system based on Stud vs Plate geometry and closest face logic",
          "[If Inserted by Tool] Retrieve saved coordinate system from _Map",
          "Set dependencies on Stud and Plate entities",
          "Assign TSL to Element Group of the Stud",
          "Update OPM Properties (dLength, dWidths, etc.) from Map data or apply Defaults if data invalid",
          "Check for and Erase duplicate TSL instances on the same Stud at the same location",
          "Generate 3D Geometry: Extrude symmetrical strap body based on calculated dimensions and coordinate system",
          "Draw Body to Model Space and Exit"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Trigger (Help vs Calculation)",
            "path1": {
              "name": "Show Help",
              "steps": [
                "Trigger: Context Menu 'Help'",
                "Execute 'reportNotice'",
                "Script ends"
              ]
            },
            "path2": {
              "name": "Calculate/Generate",
              "steps": [
                "Trigger: Insert, Recalc, or Change Type",
                "Proceed to Logic and Geometry generation"
              ]
            }
          },
          {
            "condition": "Insertion Context (Master vs Instance)",
            "path1": {
              "name": "Master Insertion Loop",
              "steps": [
                "User selects multiple studs and plates",
                "Script acts as a generator",
                "Iterates through valid vertical studs",
                "Creates specific instances for Top/Bottom configurations",
                "Self-destructs (eraseInstance) after generating children"
              ]
            },
            "path2": {
              "name": "Individual Instance Execution",
              "steps": [
                "Script runs attached to a single stud",
                "Retrieves geometry context from internal Map",
                "Draws the hardware part for that specific connection"
              ]
            }
          },
          {
            "condition": "Coordinate System Calculation",
            "path1": {
              "name": "Manual Insert Calculation",
              "steps": [
                "Flag 'bOnInsert' is true",
                "Script identifies intersecting plates using vector math",
                "Calculates closest face to user pick point (_Pt0)",
                "Derives Vectors (vx, vy, vz) dynamically from beam positions",
                "Calculates Plate Widths (dPlateWidth) dynamically"
              ]
            },
            "path2": {
              "name": "Tool Insert Calculation",
              "steps": [
                "Flag 'bOnInsert' is false",
                "Vectors (vx, vy, vz) retrieved directly from _Map",
                "Plate Widths retrieved directly from _Map",
                "Geometry is rebuilt based on stored coordinates"
              ]
            }
          },
          {
            "condition": "Plate Presence",
            "path1": {
              "name": "Bottom Plate Only",
              "steps": [
                "Top Plate array is empty",
                "Script generates instances only for Bottom Plate connections during Master loop"
              ]
            },
            "path2": {
              "name": "Top Plate Only",
              "steps": [
                "Bottom Plate array is empty",
                "Script generates instances only for Top Plate connections during Master loop"
              ]
            },
            "path3": {
              "name": "Both Plates",
              "steps": [
                "Both arrays populated",
                "Script generates two instances per stud (one top, one bottom)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection Count",
            "errorMessage": "Silent failure (Script erases self)",
            "recovery": "User must select at least one beam during PrEntity prompt"
          },
          {
            "check": "Existence of Valid Plates (Top or Bottom)",
            "errorMessage": "Report: 'Not valid top or bottom plates provided'",
            "recovery": "User must include at least one Top or Bottom plate in the selection set"
          },
          {
            "check": "Existence of Valid Vertical Studs",
            "errorMessage": "Report: 'Not valid vertical studs provided'",
            "recovery": "User must ensure selection contains vertical beams (Z-world parallel)"
          },
          {
            "check": "Map Data Validity (Dimensions)",
            "errorMessage": "None (Silent fallback)",
            "recovery": "Script uses hardcoded default values (115mm length, etc.) if Map contains 0 or invalid dimensions"
          },
          {
            "check": "Catalog Selection on Insert",
            "errorMessage": "Silent failure",
            "recovery": "If user cancels the DotNet Type Selection dialog on first insert, script erases itself"
          },
          {
            "check": "Dependency Validity",
            "errorMessage": "Silent failure",
            "recovery": "If Stud or associated Plate beams become invalid/deleted, script erases itself"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Type",
            "how": "Context Menu > 'Change type'",
            "effect": "Opens DotNet dialog to select a new hardware family. Reloads properties (Length, Widths, etc.) from the new catalog entry and regenerates the 3D body."
          },
          {
            "action": "Relocate / Move",
            "how": "Grip Edit / Move Command",
            "effect": "Script detects new location. If inserted manually, it recalculates the 'closest face' and repositions the strap relative to the new stud/plate orientation. If inserted by tool, it maintains stored orientation."
          },
          {
            "action": "Update Catalog",
            "how": "Running 'GE_HDWR_RESET_CATALOG_ENTRY' TSL",
            "effect": "This external script (mentioned in header dependencies) triggers this script to reload its TXT source file, ensuring the latest catalog entries are available for 'Change type'."
          },
          {
            "action": "Property Modification (Read Only)",
            "how": "AutoCAD Properties Palette",
            "effect": "Users can VIEW the dimensions (Type, Length, Clear Width, etc.), but cannot manually type in new values. Changing values requires the 'Change type' workflow or modifying the source TXT file."
          }
        ]
      },
      "tokens_used": 10041,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_STUD_PLATE_TIE_SPT_TYPES_1_2_3_5.mcr\n\n## Overview\nThis script generates 3D geometry for Simpson Strong-Tie style stud-to-plate tie straps (Types 1, 2, 3, and 5). It automatically places metal connectors on selected vertical studs where they intersect with top or bottom plates.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script generates 3D bodies using GenBeam entities. |\n| Paper Space | No | Not designed for 2D layouts or views. |\n| Shop Drawing | No | Does not process shop drawing layouts. |\n\n## Prerequisites\n- **Required Entities**: \n  - GenBeams representing vertical studs.\n  - GenBeams representing at least one Top Plate or Bottom Plate.\n- **Minimum Beam Count**: 2 (1 Stud + 1 Plate).\n- **Required Settings Files**:\n  - `TSL_Read_Metalpart_Family_Props.dll` (Required for selecting hardware types).\n  - `TSL_HARDWARE_FAMILY_LIST.dxx` (Catalog of available hardware families).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_HDWR_STUD_PLATE_TIE_SPT_TYPES_1_2_3_5.mcr` from the file browser.\n\n### Step 2: Select Beams\n```\nCommand Line: Select stud(s) and plate(s)\nAction: Click to select the vertical studs and the top or bottom plates they connect to. Press Enter to confirm selection.\n```\n\n### Step 3: Select Hardware Type\n```\nDialog: Select Hardware Family\nAction: A DotNet dialog will appear. Browse or search for the desired Strap Type (e.g., SPT1, SPT2) and click OK.\n```\n\n### Step 4: Define Orientation\n```\nCommand Line: Pick a point to define on what face of studs place hardware\nAction: Click on the screen on the side of the stud where you want the metal strap to wrap (e.g., left side or right side of the stud).\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | String | (Empty) | The specific model/part number of the tie strap (Read-Only). |\n| Lenght | Double | 0 | Total vertical height of the strap (Read-Only). |\n| Clear Width | Double | 0 | Horizontal width of the strap at the top section (Read-Only). |\n| Base Width | Double | 0 | Horizontal width of the strap at the base/plate connection (Read-Only). |\n| Plates Height | Double | 0 | Vertical height of the strap portion sitting against the stud relative to the plate (Read-Only). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change type | Opens a dialog to select a different hardware family. This updates all dimensions (Length, Widths, etc.) based on the new selection. |\n| Help | Displays a message box with usage instructions for the script. |\n\n## Settings Files\n- **Filename**: `TSL_HARDWARE_FAMILY_LIST.dxx`\n- **Location**: `_kPathHsbCompany\\TSL\\Catalog\\`\n- **Purpose**: Contains the catalog of hardware families and their associated dimensions.\n\n- **Filename**: `TSL_Read_Metalpart_Family_Props.dll`\n- **Location**: `_kPathHsbInstall\\Utilities\\TslCustomSettings\\`\n- **Purpose**: Handles the reading of TXT catalog files and provides the user interface for selecting hardware types.\n\n## Tips\n- **Batch Processing**: You can select multiple studs and multiple plates in one go. The script will automatically generate connectors for every valid stud-to-plate intersection found.\n- **Orientation**: The script determines the \"face\" of the stud based on the point you pick in Step 4. If the strap appears on the wrong side, delete it and pick a point on the opposite side when re-inserting.\n- **Updating Dimensions**: Since the dimension properties are Read-Only, always use the \"Change type\" context menu option to switch to a different size rather than trying to type in numbers.\n\n## FAQ\n- **Q: Why did the script disappear after I selected the beams?**\n  A: This usually happens if you did not select a valid combination of vertical studs and plates, or if you canceled the hardware selection dialog.\n- **Q: Can I modify the Length or Width manually in the properties palette?**\n  A: No, these values are locked to ensure they match the manufacturer's specifications for the selected Type. Use \"Change type\" to switch sizes.\n- **Q: How do I update the hardware catalog if new parts are added?**\n  A: Run the `GE_HDWR_RESET_CATALOG_ENTRY` script. This dependency forces the hardware script to reload its TXT source file and update the available options."
      },
      "tokens_used": 6751,
      "error": null
    }
  }
}