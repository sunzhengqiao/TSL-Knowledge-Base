{
  "filename": "hsbCurveDescription.mcr",
  "status": "completed",
  "total_tokens": 42308,
  "processing_time": 312.27130675315857,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\":"
      },
      "tokens_used": 8144,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "tslNew.dbCreate(..., _kModelSpace, mapTsl); found in the insertion logic. The script targets CurvedDescription entities via PrEntity ssE(T(\"|Select curved description|\"), CurvedDescription ());"
        },
        "prerequisites": {
          "requiredEntities": [
            "CurvedDescription"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5539,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select curved description|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "",
              "condition": "ents.length()==1",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "showDialog() called on insert",
            "title": null,
            "dataSource": "sArDimStyles (sorted _DimStyles)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "Sorted list of available DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dTxtH",
            "type": "PropDouble",
            "displayName": "|Text Height|",
            "defaultValue": "U(40)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Overrides the text size of the selected dimstyle for the schedule table.|"
          },
          {
            "index": 1,
            "variable": "dTxtHPress",
            "type": "PropDouble",
            "displayName": "|Text Height| |Press Label|",
            "defaultValue": "U(40)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Overrides the text size of the selected dimstyle for the press labels.|"
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "|Color|",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Defines the color of the schedule table|"
          },
          {
            "index": 2,
            "variable": "nColorPress",
            "type": "PropInt",
            "displayName": "|Color| |Press|",
            "defaultValue": "252",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|-1 = byPress|"
          },
          {
            "index": 1,
            "variable": "nColorRef",
            "type": "PropInt",
            "displayName": "|Color| |Reference Press|",
            "defaultValue": "4",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|-1 = byPress|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Number Presses|",
            "handler": "|Number Presses|",
            "action": "Resets the label of the first press to empty, triggering a renumbering of all assigned presses.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 6323,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically labels and numbers the presses (jigs) assigned to a curved timber beam and generates a schedule table displaying the lamella structure and material breakdown.",
          "category": "ShopDrawing / Documentation",
          "typicalUseCase": "Used during the detailing of glulam or curved beams to identify manufacturing jigs (presses) and provide a cut-list of lamellas directly in the 3D model or on production drawings."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "First sorted available DimStyle",
            "businessMeaning": "Selects the drafting text style to be used for the labels and the schedule table (e.g., font, specific text characteristics).",
            "validRange": "List of available DimStyles in the current drawing.",
            "unit": "String",
            "affectsOutput": "Font face, weight, and style of all text generated by the script."
          },
          {
            "name": "dTxtH",
            "technicalDefault": "U(40)",
            "businessMeaning": "Sets the text height specifically for the Lamella Schedule Table.",
            "validRange": "20mm - 100mm (Depending on drawing scale and visibility requirements)",
            "unit": "mm",
            "affectsOutput": "Legibility and size of the material breakdown table."
          },
          {
            "name": "dTxtHPress",
            "technicalDefault": "U(40)",
            "businessMeaning": "Sets the text height specifically for the Press Labels (the numbers pointing to the press entities).",
            "validRange": "20mm - 100mm",
            "unit": "mm",
            "affectsOutput": "Size of the numerical tags identifying individual presses."
          },
          {
            "name": "nColor",
            "technicalDefault": "1",
            "businessMeaning": "Defines the display color of the generated Lamella Schedule Table (lines and text).",
            "validRange": "0 - 255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Visual color of the material table."
          },
          {
            "name": "nColorPress",
            "technicalDefault": "252",
            "businessMeaning": "Defines the color of the standard press labels. Setting this to -1 uses the native color of the press entity itself.",
            "validRange": "-1, 0 - 255",
            "unit": "Index",
            "affectsOutput": "Color of the press tags (excluding the reference press)."
          },
          {
            "name": "nColorRef",
            "technicalDefault": "4",
            "businessMeaning": "Defines the color of the Reference Press label (the press closest to the beam's reference point). Setting this to -1 uses the native press color.",
            "validRange": "-1, 0 - 255",
            "unit": "Index",
            "affectsOutput": "Highlight color of the primary/reference press tag."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing 'dTxtH' or 'sDimStyle'",
            "effect": "Adjusts the column width factor in the schedule table to ensure text fits correctly within the calculated layout.",
            "cascade": [
              "Schedule Table Layout"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Annotation / Text",
            "description": "Numerical labels identifying the sequence of presses (1, 2, 3...) along the curve.",
            "appliedTo": "PressEnt (Press Entities) associated with the CurvedDescription."
          },
          {
            "type": "Annotation / Schedule Table",
            "description": "A table listing the curved style name, lamella quantities, wood qualities, and thicknesses, plus total press count and reference press info.",
            "appliedTo": "ModelSpace (at point _Pt0 or default location)."
          }
        ]
      },
      "tokens_used": 8489,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch: User executes the TSL command to insert 'hsbCurveDescription'.",
          "2. Configuration (Insert Cycle 1): A dialog (ShowDynamicDialog) appears listing available dimension styles. User selects the desired DimStyle.",
          "3. Entity Selection: User is prompted to select one or multiple 'CurvedDescription' entities from the model.",
          "4. [Conditional] Insertion Point Selection:",
          "   - If only ONE CurvedDescription is selected, user is prompted to pick a point (getPoint) to define the table location (_Pt0).",
          "   - If MULTIPLE CurvedDescriptions are selected, the script skips point picking and calculates the table origin automatically using the entity's coordinate system origin.",
          "5. Instance Creation: The script iterates through the selected entities and spawns a new TSL instance for each one using the selected configuration and location data.",
          "6. Cleanup: The initial 'starter' instance is erased, leaving only the generated instances attached to the entities.",
          "7. Instance Initialization (Generated Instances):",
          "   - Validates entity reference (must be CurvedDescription).",
          "   - Retrieves associated PressEnt (jig) entities.",
          "   - Sorts presses along the beam's X-axis based on insertion points.",
          "   - Assigns sequential numerical labels (1, 2, 3...) to presses.",
          "   - Calculates the Reference Press (closest to style reference point).",
          "8. Geometry Generation:",
          "   - Draws numerical labels at calculated offset points relative to each press.",
          "   - Parses the CurvedStyle lamella data (quantities, qualities, thicknesses).",
          "   - Draws the Lamella Schedule Table at the specified origin point.",
          "   - Adds summary data (Total Lams, Dry Joint, Offset/Zulage, Total Presses)."
        ],
        "conditionalBranches": [
          {
            "condition": "Number of CurvedDescriptions selected",
            "path1": {
              "name": "Single Entity Selection",
              "steps": [
                "Select one CurvedDescription",
                "Prompt user for Table Location Point (getPoint)",
                "Create instance at specific user point"
              ]
            },
            "path2": {
              "name": "Multiple Entity Selection",
              "steps": [
                "Select multiple CurvedDescriptions",
                "Skip point prompt",
                "Create instance at each entity's coordSys().ptOrg()"
              ]
            }
          },
          {
            "condition": "Number of Presses assigned to curve",
            "path1": {
              "name": "Presses Exist",
              "steps": [
                "Fetch press array",
                "Sort presses by X location",
                "Label presses 1 to N",
                "Identify Reference Press",
                "Draw press labels and 'Presses' summary in table"
              ]
            },
            "path2": {
              "name": "No Presses Found",
              "steps": [
                "Skip labeling logic",
                "Omit 'Presses' summary lines from table",
                "Draw Lamella data only"
              ]
            }
          },
          {
            "condition": "Press Color Property Settings (nColorPress, nColorRef)",
            "path1": {
              "name": "Explicit Color (> -1)",
              "steps": [
                "Check property value",
                "Apply specified color index to the Press Entity"
              ]
            },
            "path2": {
              "name": "By Press (-1)",
              "steps": [
                "Detect property value is -1",
                "Retain the native color of the Press Entity"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Reference Type",
            "errorMessage": "Invalid reference",
            "recovery": "The instance self-deletes (eraseInstance) if the linked entity is not a valid CurvedDescription."
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "N/A (Silent failure)",
            "recovery": "If insertCycleCount() > 1, the instance is immediately erased to prevent duplication during the loop that creates new instances."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Table Location",
            "how": "Grip Edit",
            "effect": "Dragging the grip (_Pt0) moves the entire Lamella Schedule Table to a new position. Labels on presses update dynamically if the specific offset logic changes relative to the table, though labels are primarily driven by the _PtG map."
          },
          {
            "action": "Renumber Presses",
            "how": "Right-click Context Menu -> 'Number Presses'",
            "effect": "Resets the label of the first press to empty, triggering a re-sort and renumbering of all assigned presses (1 to N) the next time the script recalculates."
          },
          {
            "action": "Update Visual Style",
            "how": "Properties Palette (OPM)",
            "effect": "Changing sDimStyle, dTxtH, or dTxtHPress updates the font and size of the table text and press labels immediately. Changing nColor, nColorRef, or nColorPress updates the colors of the table lines and press tags."
          }
        ]
      },
      "tokens_used": 8251,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCurveDescription.mcr\n\n## Overview\nThis script automates the labeling of manufacturing presses (jigs) and generates a detailed lamella schedule table for curved timber beams. It provides a visual breakdown of the beam's layer structure (quantities, quality, thickness) and numbers the assigned production presses directly in the model.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script inserts the schedule table and labels into the 3D model. |\n| Paper Space | No | Not supported in layout views. |\n| Shop Drawing | No | This is a model-space annotation tool, not a generative drawing layout script. |\n\n## Prerequisites\n- **Required Entities**: A `CurvedDescription` entity must exist in the model.\n- **Minimum Beam Count**: N/A (Operates on the curved description entity, not the beam directly).\n- **Required Settings**: None specific, though Dimension Styles must exist in the drawing to populate the drop-down list.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCurveDescription.mcr`\n\n### Step 2: Configure Dimension Style\n```\nDialog: Show Dynamic Dialog\nAction: Select the desired Dimension Style from the list to define the font and text characteristics for the schedule and labels.\n```\n\n### Step 3: Select Entity\n```\nCommand Line: Select curved description\nAction: Click on the CurvedDescription entity associated with your curved beam. You can select multiple descriptions if needed.\n```\n\n### Step 4: Define Table Location\n- **If ONE entity was selected**:\n  ```\n  Command Line: [Point Prompt]\n  Action: Click in the model to specify the insertion point for the Lamella Schedule Table.\n  ```\n- **If MULTIPLE entities were selected**:\n  ```\n  Action: The script automatically places the table at the coordinate system origin of each selected entity. No manual point picking is required.\n  ```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimstyle | Dropdown | (First Available) | Sets the drafting text style (font, etc.) for all generated text and tables. |\n| Text Height | Number | U(40) | Overrides the text height specifically for the Lamella Schedule Table. |\n| Text Height (Press Label) | Number | U(40) | Overrides the text height for the numerical labels attached to the presses. |\n| Color | Number | 1 | Sets the color (AutoCAD Color Index) for the schedule table lines and text. |\n| Color (Press) | Number | 252 | Sets the color for standard press labels. Set to `-1` to use the press entity's native color. |\n| Color (Reference Press) | Number | 4 | Sets the color for the Reference Press label (the press closest to the beam origin). Set to `-1` to use the native color. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Number Presses | Renumbers all assigned presses sequentially (1, 2, 3...) based on their position along the beam. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script uses internal logic and current drawing standards; no external XML settings file is required.\n\n## Tips\n- **Moving the Table**: Select the script instance and drag the blue grip point (`_Pt0`) to move the schedule table to a clearer location.\n- **Batch Processing**: Select multiple curved descriptions at once during insertion to quickly generate schedules for an entire project without manually placing each table.\n- **Color Management**: If you want the press labels to match the 3D press parts exactly, set both \"Color (Press)\" and \"Color (Reference Press)\" to `-1`.\n\n## FAQ\n- **Q: My text looks too small.**\n  - **A**: Increase the `Text Height` or `Text Height (Press Label)` values in the Properties Palette.\n- **Q: The press numbers are out of order.**\n  - **A**: Right-click the script instance and select \"Number Presses\" to force a recalculation based on current positions.\n- **Q: Can I change the font?**\n  - **A**: Yes, change the `Dimstyle` property to select a different text style defined in your AutoCAD drawing."
      },
      "tokens_used": 5562,
      "error": null
    }
  }
}