{
  "filename": "SectionGridDisplay.mcr",
  "status": "completed",
  "total_tokens": 28369,
  "processing_time": 337.0947320461273,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3855,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script selects 'Section2d' and 'Grid' entities during insertion which are Model Space entities. It performs 3D geometric calculations using 'intersectPoints' and 'clipVolume'. It uses standard Display (dpText/dpLines) drawing methods rather than sd_ (ShopDrawing) specific functions or _Viewport checks."
        },
        "prerequisites": {
          "requiredEntities": [
            "Grid",
            "Section2d"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3443,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select Sections|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getGrid",
              "promptOriginal": "|Select Grid|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "psDimstyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "pdTextH",
            "type": "PropDouble",
            "displayName": "|Text Height|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "piLabelColor",
            "type": "PropInt",
            "displayName": "|Label Color|",
            "defaultValue": 3,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "piLineColor",
            "type": "PropInt",
            "displayName": "|Line Color|",
            "defaultValue": 8,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "pdLabelScale",
            "type": "PropDouble",
            "displayName": "|Label Scale|",
            "defaultValue": 1.3,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "pdLabelOffset",
            "type": "PropDouble",
            "displayName": "|Label Offset|",
            "defaultValue": "U(12, \"inch\")",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4834,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the annotation of Grid coordinates on 2D Section views by detecting intersections and placing leader labels.",
          "category": "Annotation/ShopDrawing",
          "typicalUseCase": "When a user needs to show exactly which Grid lines (e.g., A, 1, B, 2) pass through a specific cross-section or wall view in the model layout."
        },
        "parameters": [
          {
            "name": "psDimstyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "The CAD text style (font) definition used to display the grid labels.",
            "validRange": "Any existing DimStyle name in the drawing",
            "unit": "string",
            "affectsOutput": "Changes the font and appearance of the text labels (e.g., Arial, Romans), unless overridden by Text Height."
          },
          {
            "name": "pdTextH",
            "technicalDefault": 0,
            "businessMeaning": "An explicit text height for the labels, overriding the standard height defined in the selected DimStyle.",
            "validRange": "> 0 (e.g., 2.5 to 10 mm depending on plot scale)",
            "unit": "drawing units (mm/inch)",
            "affectsOutput": "Sets the specific size of the text characters. If 0, the DimStyle's default height is used."
          },
          {
            "name": "piLabelColor",
            "technicalDefault": 3,
            "businessMeaning": "The display color of the Grid coordinate text (e.g., 'A', '1').",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "color index",
            "affectsOutput": "Changes the color of the text string only."
          },
          {
            "name": "piLineColor",
            "technicalDefault": 8,
            "businessMeaning": "The display color of the graphical leader line and the circle border surrounding the text.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "color index",
            "affectsOutput": "Changes the color of the leader line and the circle."
          },
          {
            "name": "pdLabelScale",
            "technicalDefault": 1.3,
            "businessMeaning": "A global scaling factor applied to the text height (from either DimStyle or explicit Text Height) and the circle size.",
            "validRange": "0.5 to 3.0",
            "unit": "multiplier (ratio)",
            "affectsOutput": "Increases or decreases the size of the text and the circle simultaneously."
          },
          {
            "name": "pdLabelOffset",
            "technicalDefault": "U(12, \"inch\")",
            "businessMeaning": "The distance from the intersection point on the section to the center of the label bubble, effectively pushing the label away from the drawing to avoid clutter.",
            "validRange": "100 to 1000 mm (or equivalent)",
            "unit": "distance (mm/inch)",
            "affectsOutput": "Moves the label bubble and leader line closer to or further from the section geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "pdTextH > 0",
            "effect": "Overrides the base height derived from psDimstyle, but still applies pdLabelScale.",
            "cascade": [
              "pdLabelScale"
            ]
          },
          {
            "trigger": "pdLabelScale",
            "effect": "Always multiplies the final text height and determines the radius of the border circle.",
            "cascade": [
              "psDimstyle",
              "pdTextH"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Graphical Annotation",
            "description": "Draws a circle, a leader line, and a text string containing the Grid coordinate (e.g., '1', 'A').",
            "appliedTo": "Model Space (associated with the selected Section2d entity)"
          }
        ]
      },
      "tokens_used": 5145,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script",
          "2. [Dialog] Configure initial properties (Dimstyle, Text Height, Colors, Scales) via showDialogOnce",
          "3. [Prompt] Select Section2d entity(s) (Single or Multiple selection allowed)",
          "4. [Prompt] Select a single Grid entity",
          "5. [Internal Loop] Iterate through each selected Section2d entity",
          "6. [Internal Action] For each Section, attach a new instance of this script (Cloning) linking the Grid and the specific Section",
          "7. [Internal Action] Erase the temporary 'commander' instance used for selection",
          "8. [Calculation] Each generated instance calculates intersection points between the Grid lines and the Section clipping volume",
          "9. [Generation] Draw graphical elements (Leader line, Circle border, Text label) at each intersection point"
        ],
        "conditionalBranches": [
          {
            "condition": "Text Height Override check (pdTextH > 0)",
            "path1": {
              "name": "Explicit Height",
              "steps": [
                "Use pdTextH value",
                "Multiply by pdLabelScale",
                "Set dpText.textHeight"
              ]
            },
            "path2": {
              "name": "DimStyle Height",
              "steps": [
                "Query textHeightForStyle from psDimstyle",
                "Multiply by pdLabelScale",
                "Set dpText.textHeight"
              ]
            }
          },
          {
            "condition": "Entity Integrity Validation (_Entity.length < 2 or !bIsValid)",
            "path1": {
              "name": "Valid Data",
              "steps": [
                "Cast Entity[0] to Grid",
                "Cast Entity[1] to Section2d",
                "Proceed to geometry calculation"
              ]
            },
            "path2": {
              "name": "Invalid/Missing Data",
              "steps": [
                "Execute eraseInstance()",
                "Stop script execution immediately"
              ]
            }
          },
          {
            "condition": "Intersection Detection (ptsGridInt.length)",
            "path1": {
              "name": "Intersections Found",
              "steps": [
                "Loop through points",
                "Calculate label offset position",
                "Draw Text, Circle, and Leader"
              ]
            },
            "path2": {
              "name": "No Intersections",
              "steps": [
                "Skip drawing loop",
                "Instance remains active but draws nothing"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Attached Entities Count",
            "errorMessage": "None (Internal Script Error)",
            "recovery": "Script automatically deletes itself if it is not attached to exactly 2 entities (1 Grid + 1 Section). User must re-run the selection command."
          },
          {
            "check": "Entity Validity (bIsValid)",
            "errorMessage": "None (Internal Script Error)",
            "recovery": "Script automatically deletes itself if the attached Grid or Section entities are invalid or deleted from the drawing. User must re-run the selection command."
          },
          {
            "check": "Selection Input (PrEntity/go)",
            "errorMessage": "None (Command Line Prompt)",
            "recovery": "User is prompted via command line to select entities. If selection is cancelled (go() returns false), the script exits and the 'commander' instance is erased."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Visual Settings",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing properties like 'Text Height', 'Label Scale', 'Label Offset', or 'Colors' immediately triggers a recalculation, redrawing the labels with new dimensions/styles."
          },
          {
            "action": "Move/Modify Section or Grid",
            "how": "CAD Grips/Move Commands",
            "effect": "Since the script references the Section coordSys and Grid geometry, moving either the Section or the Grid lines triggers a recalculation, causing the intersection points and labels to update positions automatically."
          }
        ]
      },
      "tokens_used": 5910,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# SectionGridDisplay.mcr\n\n## Overview\nThis script automatically annotates 2D Section views with Grid coordinates. It detects where Grid lines intersect the Section clipping volume and generates a leader line, a circle, and the coordinate text (e.g., A, 1, B) at those specific points.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates on Section2d and Grid entities within the 3D model. |\n| Paper Space | No | |\n| Shop Drawing | No | Labels are drawn in Model Space relative to the section geometry. |\n\n## Prerequisites\n- **Required Entities**: At least one `Section2d` entity and one `Grid` entity must exist in the drawing.\n- **Minimum Beams**: 0\n- **Required Settings**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nRun the command `TSLINSERT` in the AutoCAD command line and select `SectionGridDisplay.mcr` from the list.\n\n### Step 2: Select Sections\n```\nCommand Line: Select Sections\nAction: Click on one or more Section2d entities in your model that you wish to annotate. Press Enter to confirm selection.\n```\n\n### Step 3: Select Grid\n```\nCommand Line: Select Grid\nAction: Click on the single Grid entity that contains the lines (A, B, 1, 2, etc.) you want to display on the sections.\n```\n\n### Step 4: Automatic Generation\nThe script will automatically attach itself to the selected sections and calculate the intersection points. Labels will appear immediately.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimstyle | dropdown | `_DimStyles` | Selects the text style definition (font) to be used for the labels. |\n| Text Height | number | 0 | Sets a specific text height. If set to 0, the height defined in the selected Dimstyle is used. |\n| Label Color | number | 3 | The color of the coordinate text (e.g., \"1\", \"A\"). Uses standard AutoCAD Color Index (0-255). |\n| Line Color | number | 8 | The color of the leader line and the circle surrounding the text. Uses standard AutoCAD Color Index (0-255). |\n| Label Scale | number | 1.3 | A multiplier that adjusts the size of both the text and the circle simultaneously. |\n| Label Offset | number | ~300mm (12\") | The distance from the intersection point on the section to the center of the label bubble. Use this to push labels away from cluttered areas. |\n\n## Right-Click Menu Options\nThis script does not add specific custom items to the right-click context menu. Changes are made via the Properties Panel.\n\n## Settings Files\nNone.\n\n## Tips\n- **Adjusting Size**: If the labels are too small or too large, try changing the `Label Scale` first. This preserves the ratio between the text and the circle.\n- **Moving Sections**: If you move a Section or modify the Grid lines, the script will automatically detect the change and update the label positions.\n- **Visibility**: To change the font used, select a different `Dimstyle` from the dropdown. Ensure that Dimstyle exists in your CAD drawing template.\n\n## FAQ\n- **Q: Why did my labels disappear after I moved the Section?**\n- A: The script dynamically calculates intersections based on the Section's position. If the move resulted in no intersection between the Grid and the Section clipping volume, the labels will hide until the geometry overlaps again.\n\n- **Q: How do I make the text bigger without changing the circle size?**\n- A: Set `Text Height` to a specific value (e.g., 100mm) and set `Label Scale` to 1.0. Then adjust the circle size logic if needed (currently, the circle is tied to the text height logic).\n\n- **Q: Can I label multiple sections with one grid at once?**\n- A: Yes. During the \"Select Sections\" prompt, you can window-select or click multiple Section2d entities before pressing Enter."
      },
      "tokens_used": 5182,
      "error": null
    }
  }
}