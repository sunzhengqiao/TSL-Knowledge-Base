{
  "filename": "HSB_W-OpeningExtrusionProfiles.mcr",
  "status": "completed",
  "total_tokens": 18396,
  "processing_time": 398.5930333137512,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 1682,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses getOpening() for user input, operates directly on Element and Beam objects to modify properties (setExtrProfile), and utilizes _bOnElementConstructed. No usage of sd_ prefixes, _Viewport, or 2D drawing generation logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "OpeningSF",
            "Element",
            "Beam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 2377,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getOpening",
              "promptOriginal": "|Select an opening|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2772,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Standardizes the extrusion profile (e.g., weatherboarding or specific cladding shapes) of beams surrounding a selected opening, skipping rectangular structural beams.",
          "category": "Finishing/Framing",
          "typicalUseCase": "Used when inserting a window or door (OpeningSF) into a wall element to ensure that trimmers, cripples, or related components automatically adopt the correct wall finish profile rather than defaulting to a standard rectangular section."
        },
        "parameters": [
          {
            "name": "_Entity[0] (OpeningSF)",
            "technicalDefault": "getSelection",
            "businessMeaning": "The specific opening (window, door, or void) selected by the user to define the scope of work.",
            "validRange": "Valid OpeningSF instance in the model",
            "unit": "N/A",
            "affectsOutput": "Identifies the parent wall element and the collection of beams to be processed."
          },
          {
            "name": "sUsedProfile (String)",
            "technicalDefault": "el.beamExtrProfile()",
            "businessMeaning": "The specific profile name (e.g., 'FeatherEdge', 'Shiplap') to be applied to the component beams.",
            "validRange": "Any string matching a valid profile name in the hsbCAD catalog",
            "unit": "N/A",
            "affectsOutput": "Changes the geometric cross-section of the beam to match the profile shape, affecting both 3D visualization and potentially CAM/machining data."
          },
          {
            "name": "bm.extrProfile() (Filter Check)",
            "technicalDefault": "Beam Property",
            "businessMeaning": "The current profile assigned to an individual beam, used to determine if it should be skipped.",
            "validRange": "Rectangular vs. Named Profile",
            "unit": "N/A",
            "affectsOutput": "Beams that are 'Rectangular' are ignored and left unchanged."
          },
          {
            "name": "bm.module() (Filter Check)",
            "technicalDefault": "Beam Property",
            "businessMeaning": "The construction module (e.g., a specific trimmer macro) that generated the beam.",
            "validRange": "Non-empty string",
            "unit": "N/A",
            "affectsOutput": "Only beams generated by a module are updated; standard wall studs or plates without a module assignment are ignored."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Selection of Opening",
            "effect": "Retrieves the parent Element to determine the default 'sUsedProfile'. If the Element default is empty, the script searches for the first non-rectangular beam in the array to define the profile.",
            "cascade": [
              "sUsedProfile",
              "Beam Array"
            ]
          },
          {
            "trigger": "Beam Iteration Loop",
            "effect": "Evaluates every beam in the element against two filters (Rectangular? and Has Module?) before applying 'sUsedProfile'.",
            "cascade": [
              "bm.setExtrProfile()"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam Property Update",
            "description": "The 'Extrusion Profile' property is modified on specific beams within the wall.",
            "appliedTo": "Module-generated beams (e.g., trimmers/headers) within the element of the selected opening, excluding those with a standard rectangular profile."
          }
        ]
      },
      "tokens_used": 2616,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script execution triggered (Manual Insert or Event).",
          "2. Evaluate execution mode (_bOnInsert).",
          "3. [Conditional - Insert Mode] Prompt user to 'Select an opening'.",
          "4. [Conditional - Insert Mode] Store selection in _Entity and set 'ManualInsert' flag in _Map.",
          "5. [Conditional - Insert Mode] Pause script and return.",
          "6. [Conditional - Processing Mode] Validate that an entity was selected.",
          "7. [Conditional - Processing Mode] Validate that the selected entity is a valid OpeningSF.",
          "8. Retrieve parent Element from the OpeningSF.",
          "9. Determine target profile: Read default from Element, or leave empty if none exists.",
          "10. Start iteration through all beams in the Element.",
          "11. [Loop] Check if current beam profile is non-Rectangular.",
          "12. [Loop] If profile is non-Rectangular and target profile is unknown, update target profile to match this beam.",
          "13. [Loop] Check if current beam has a Module assignment.",
          "14. [Loop] If beam is Rectangular AND has a Module, apply the target profile.",
          "15. End Loop.",
          "16. Evaluate cleanup condition: Check if triggered by 'ManualInsert' or '_bOnElementConstructed'.",
          "17. Erase script instance from model."
        ],
        "conditionalBranches": [
          {
            "condition": "Script execution mode check",
            "path1": {
              "name": "Manual Insertion",
              "steps": [
                "Prompt for OpeningSF selection",
                "Store selection and Map flags",
                "Return/Wait for recalculation"
              ]
            },
            "path2": {
              "name": "Processing (Event or Recalc)",
              "steps": [
                "Proceed to Entity Validation",
                "Execute Beam Modification Logic"
              ]
            }
          },
          {
            "condition": "Beam Profile Analysis (Inside Loop)",
            "path1": {
              "name": "Non-Rectangular Profile",
              "steps": [
                "Use this beam's profile name if target profile is currently empty",
                "Skip modification for this beam (continue loop)"
              ]
            },
            "path2": {
              "name": "Rectangular Profile",
              "steps": [
                "Proceed to Module check"
              ]
            }
          },
          {
            "condition": "Beam Module Check (Inside Loop)",
            "path1": {
              "name": "No Module Assigned",
              "steps": [
                "Skip modification for this beam (continue loop)"
              ]
            },
            "path2": {
              "name": "Module Assigned",
              "steps": [
                "Apply target extrusion profile to beam"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Selection",
            "errorMessage": "No opening selected!",
            "recovery": "User must select a valid object in the model or restart script."
          },
          {
            "check": "Entity Type",
            "errorMessage": "Selected entity is not an opening!",
            "recovery": "User must select an instance of OpeningSF."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Script Self-Deletion",
            "how": "Automatic (Internal Logic)",
            "effect": "The script instance erases itself from the drawing immediately after processing, leaving only the modified beams behind."
          }
        ]
      },
      "tokens_used": 4669,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_W-OpeningExtrusionProfiles.mcr\n\n## Overview\nThis script automatically applies the correct wall finish profile (e.g., weatherboarding, feather edge, or shiplap) to the structural beams surrounding a selected window or door opening. It ensures that trimmers and cripples match the wall's surface profile instead of remaining as standard rectangular timber sections.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates directly on 3D wall elements and openings. |\n| Paper Space | No | This script does not generate 2D drawings or annotations. |\n| Shop Drawing | No | This is a modeling script, not a detailing tool. |\n\n## Prerequisites\n- **Required Entities**: An existing `OpeningSF` (window or door) inserted into a timber wall (`Element`).\n- **Minimum Beam Count**: The parent wall element must contain at least 2 beams.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Navigate to the location of `HSB_W-OpeningExtrusionProfiles.mcr`.\n3. Select the file and click **Open**.\n\n### Step 2: Select Opening\n```\nCommand Line: Select an opening\nAction: Click on a window, door, or generic opening object in your 3D model.\n```\n*Note: The script will automatically detect the parent wall and process the surrounding beams.*\n\n### Step 3: Automatic Processing\nOnce selected, the script will:\n1. Identify the target profile (inherited from the wall element or an existing finished beam).\n2. Apply this profile to all relevant trimmers/cripples around the opening.\n3. Automatically delete itself from the model.\n\n## Properties Panel Parameters\n\nThis script does not expose any editable parameters in the Properties Palette. All configuration is derived from the existing wall element and beams.\n\n## Right-Click Menu Options\n\nNo custom context menu options are assigned to this script.\n\n## Settings Files\n\nNo external settings files are required for this script.\n\n## Tips\n- **Automatic Cleanup**: It is normal for the script instance to disappear immediately after running. It is designed as a \"fire and forget\" tool that modifies existing beams rather than creating a new persistent object.\n- **Profile Detection**: If the wall element does not have a default extrusion profile defined, the script will scan the wall to find the first non-rectangular beam (e.g., a standard stud with a profile) and use that profile for the opening trimmers.\n- **Selective Updates**: The script intentionally skips standard rectangular structural beams. It only updates beams that are generated by a specific construction module (macro), ensuring only the finishing components are modified.\n\n## FAQ\n- **Q: Why did the script disappear after I selected the opening?**\n  - A: This is intended behavior. The script performs a one-time update on the beams and erases itself to prevent duplicate data in your project.\n- **Q: The script didn't change the main wall studs.**\n  - A: The script is designed to only update \"Module\" generated beams (like trimmers and headers created by opening macros). It ignores standard wall studs to preserve the structural integrity of the main wall.\n- **Q: What happens if my wall doesn't have a finish profile yet?**\n  - A: The script will look for any finished beam in the current wall to determine what shape to use. If all beams are rectangular, no changes will be made."
      },
      "tokens_used": 4280,
      "error": null
    }
  }
}