{
  "filename": "hsb_CreateMultipleHeightBlocking.mcr",
  "status": "completed",
  "total_tokens": 39464,
  "processing_time": 152.59599471092224,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "10.09.2009",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "28.06.2011",
            "author": "",
            "changes": "Custom command for recreate the blocking"
          },
          {
            "version": "1.2",
            "date": "16.12.2011",
            "author": "",
            "changes": "Added hsbId=12 for all blockings created"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5941,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script selects an Element using getElement(), creates 3D Beams using dbCreate(), and manipulates 3D geometry using PlaneProfile, Body, and Opening objects derived from Element beams. It lacks 'sd_' prefixes, '#Type E', or Viewport handling typical of ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space within an Element",
          "requiredSettings": []
        }
      },
      "tokens_used": 5156,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getElement",
              "promptOriginal": "Please select a Element",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Pick Starting Point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "Pick End Point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dHeightD1",
            "type": "PropDouble",
            "displayName": "Height Blocking Row 1",
            "defaultValue": "U(600)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Height of the row of Blocking from the starting point to the end point. Set '0' to avoid this row"
          },
          {
            "index": 1,
            "variable": "dHeightD2",
            "type": "PropDouble",
            "displayName": "Height Blocking Row 2",
            "defaultValue": "U(1200)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Height of the row of Blocking from the starting point to the end point. Set '0' to avoid this row"
          },
          {
            "index": 2,
            "variable": "dHeightD3",
            "type": "PropDouble",
            "displayName": "Height Blocking Row 3",
            "defaultValue": "U(1800)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Height of the row of Blocking from the starting point to the end point. Set '0' to avoid this row"
          },
          {
            "index": 3,
            "variable": "dHeightD4",
            "type": "PropDouble",
            "displayName": "Height Blocking Row 4",
            "defaultValue": "U(2400)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Height of the row of Blocking from the starting point to the end point. Set '0' to avoid this row"
          },
          {
            "index": 0,
            "variable": "strStager",
            "type": "PropString",
            "displayName": "Stager the Blocking",
            "defaultValue": "sArNY[0]",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dTolerance",
            "type": "PropDouble",
            "displayName": "|Tolerance|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Blockings will be cut back by the tolerance value.|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Reapply Blocking",
            "handler": "strChangeEntity",
            "action": "Resets the execution mode to 0, effectively triggering the regeneration of the blocking.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 6152,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates rows of blocking (noggins) between vertical studs at specific heights, cutting them to fit around openings and ensuring proper spacing with tolerances.",
          "category": "Framing",
          "typicalUseCase": "Used in wall panel manufacturing to install horizontal blocking between studs for structural rigidity, drywall backing, or fixture support."
        },
        "parameters": [
          {
            "name": "dHeightD1",
            "technicalDefault": "U(600)",
            "businessMeaning": "The vertical height (from the element origin) at which the first row of blocking is generated.",
            "validRange": "0 to Wall Height (mm)",
            "unit": "mm",
            "affectsOutput": "Controls the Z-axis placement of the first blocking row. If set to 0, this row is not generated."
          },
          {
            "name": "dHeightD2",
            "technicalDefault": "U(1200)",
            "businessMeaning": "The vertical height (from the element origin) at which the second row of blocking is generated.",
            "validRange": "0 to Wall Height (mm)",
            "unit": "mm",
            "affectsOutput": "Controls the Z-axis placement of the second blocking row. If set to 0, this row is not generated."
          },
          {
            "name": "dHeightD3",
            "technicalDefault": "U(1800)",
            "businessMeaning": "The vertical height (from the element origin) at which the third row of blocking is generated.",
            "validRange": "0 to Wall Height (mm)",
            "unit": "mm",
            "affectsOutput": "Controls the Z-axis placement of the third blocking row. If set to 0, this row is not generated."
          },
          {
            "name": "dHeightD4",
            "technicalDefault": "U(2400)",
            "businessMeaning": "The vertical height (from the element origin) at which the fourth row of blocking is generated.",
            "validRange": "0 to Wall Height (mm)",
            "unit": "mm",
            "affectsOutput": "Controls the Z-axis placement of the fourth blocking row. If set to 0, this row is not generated."
          },
          {
            "name": "strStager",
            "technicalDefault": "sArNY[0]",
            "businessMeaning": "Determines if the blocking pieces should be staggered (alternating positions) within the bay or centered consistently.",
            "validRange": "Yes/No",
            "unit": "Boolean",
            "affectsOutput": "If 'Yes', blocking alternates left/right relative to the bay center for nailing access. If 'No', all blocking is centered."
          },
          {
            "name": "dTolerance",
            "technicalDefault": "U(0)",
            "businessMeaning": "A gap size subtracted from the blocking length to ensure easy fit between studs (accommodating lumber variations or manufacturing tolerance).",
            "validRange": "0 to 10 mm",
            "unit": "mm",
            "affectsOutput": "Reduces the physical length of the blocking piece, creating a small gap between the blocking ends and the vertical studs."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dHeightD1 through dHeightD4",
            "effect": "Zero values suppress generation of that specific row.",
            "cascade": []
          },
          {
            "trigger": "strStager",
            "effect": "Alters the insertion point (nOffset) of the blocking beams.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Beam",
            "description": "Individual blocking elements created between vertical studs, matching the stud's width and height material properties.",
            "appliedTo": "The selected Wall Element."
          }
        ]
      },
      "tokens_used": 6668,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched (Insert or Recalc)",
          "[Insert Mode Only] check insertCycleCount > 1",
          "[Insert Mode Only] Show Properties Dialog (if first insert)",
          "[Insert Mode Only] Prompt user to select a Wall Element",
          "[Insert Mode Only] Prompt user to pick Start Point",
          "[Insert Mode Only] Prompt user to pick End Point",
          "[Insert Mode Only] Set internal 'ExecutionMode' map variable to 0",
          "Validate Element selection exists",
          "Collect Height properties (dHeightD1-D4) into array (filtering out values <= 0)",
          "[Recalc Only] Check if triggered by 'Reapply Blocking' context menu",
          "Check 'ExecutionMode' map variable",
          "Get Element Coordinate System and Geometry",
          "Filter Element Beams into Vertical (Studs) and Horizontal arrays based on direction relative to Element CS",
          "Generate Openings Profile (union of all opening shapes in element)",
          "Generate Horizontal Beams Profile (union of all horizontal beam contact faces)",
          "Union Openings and Horizontal Beams into a single 'Cut' Profile (obstructions)",
          "Project User Picked Points to the Element Plane (Z-plane closest point)",
          "Determine Blocking Direction (X-axis) based on vector between Picked Start and End points",
          "Loop through each defined Height Row (dHeightAr)",
          "Calculate intersection of Blocking Height Line with Picked Start/End points to define segment",
          "Create Temporary 'Full Block' beam spanning the entire segment length",
          "Extract Envelope Profile of the Full Block",
          "Identify valid Vertical Beams (Studs) intersecting the Full Block's envelope",
          "Calculate intersection points of Full Block centerline with Valid Studs",
          "Sort intersection points along the centerline",
          "Loop through intervals between intersection points (Bays)",
          "Calculate Blocking Length (Interval - Stud Width - Tolerance)",
          "[Conditional] Check if Blocking Length > MinLength (50mm)",
          "Create Individual Blocking Beam at interval center",
          "[Conditional] Apply Stagger offset (-1 or 1) if Stager option is Yes",
          "Assign Material, Grade, Name, HsbId (12), and Type from Element",
          "Assign Blocking to Element Group",
          "Store Blocking entity reference in Map (for cleanup on recalc)",
          "Loop through all created Blockings",
          "Check intersection of Blocking Profile with the 'Cut' Profile (Openings/Horizontals)",
          "Erase Blockings that significantly intersect the Cut Profile",
          "Erase the Temporary 'Full Block' beam",
          "Store center points of valid blockings in Map for display",
          "Set 'ExecutionMode' map variable to 1",
          "Draw preview lines at blocking locations"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "First Insert Cycle",
              "steps": [
                "Execute prompts for Element and Points"
              ]
            },
            "path2": {
              "name": "Subsequent Cycles (count > 1)",
              "steps": [
                "Erase Instance",
                "Exit Script immediately"
              ]
            }
          },
          {
            "condition": "dHeightD1 through dHeightD4 Values",
            "path1": {
              "name": "Value > 0",
              "steps": [
                "Include Height in processing Array (dHeightAr)",
                "Generate Blocking loop at this height"
              ]
            },
            "path2": {
              "name": "Value = 0 or less",
              "steps": [
                "Exclude Height from processing",
                "Skip this row"
              ]
            }
          },
          {
            "condition": "Execution Mode (Map variable)",
            "path1": {
              "name": "Mode 0 (Generation/Cleanup)",
              "steps": [
                "Erase previously generated blockings stored in Map",
                "Reset Map",
                "Run Geometry Calculation & Beam Creation logic",
                "Switch Mode to 1"
              ]
            },
            "path2": {
              "name": "Mode 1 (Display Only)",
              "steps": [
                "Skip Beam Creation logic",
                "Retrieve stored points from Map",
                "Draw Preview Lines"
              ]
            }
          },
          {
            "condition": "Stager Property (strStager)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Calculate nOffset = (-1)^j (Alternates -1 and 1)",
                "Shift blocking center alternatingly left/right relative to bay center"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "nOffset = 0",
                "Center blocking perfectly in the bay"
              ]
            }
          },
          {
            "condition": "Blocking Length Validity",
            "path1": {
              "name": "Length > MinLength (50mm)",
              "steps": [
                "Create Blocking Beam in model"
              ]
            },
            "path2": {
              "name": "Length <= MinLength (50mm)",
              "steps": [
                "Skip creation of beam (Gap too small)"
              ]
            }
          },
          {
            "condition": "Intersection with Obstructions (Openings/Horizontals)",
            "path1": {
              "name": "Intersection Area > Threshold (10 sqmm)",
              "steps": [
                "Identify as conflict",
                "Erase Blocking"
              ]
            },
            "path2": {
              "name": "No Intersection",
              "steps": [
                "Keep Blocking"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "None (Silent failure)",
            "recovery": "If _Element.length is 0, the script erases its own instance and exits."
          },
          {
            "check": "Vertical Beams (Studs) Exist",
            "errorMessage": "None (Silent failure)",
            "recovery": "If less than 1 vertical beam is found in the element filter, the script returns immediately without creating anything."
          },
          {
            "check": "Picked Points Alignment",
            "errorMessage": "None",
            "recovery": "Points are automatically projected onto the Element's XY plane (Z=0 of element CS). Direction is auto-flipped if user picks End point 'behind' Start point relative to Element X-axis."
          },
          {
            "check": "Blocking Geometry",
            "errorMessage": "None",
            "recovery": "Segments smaller than 50mm are ignored. Blockings intersecting openings/horizontals are automatically removed."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Reapply Blocking",
            "how": "Right-click context menu on script instance",
            "effect": "Resets 'ExecutionMode' to 0. This triggers a full regeneration: erasing old blockings, recalculating geometry based on current element state (e.g. moved studs/openings) and property values, and regenerating the blocking."
          },
          {
            "action": "Modify Heights",
            "how": "OPM (AutoCAD Properties Palette) - dHeightD1 to dHeightD4",
            "effect": "Updates the Z-height of specific blocking rows. Setting a value to 0 removes that row. Changes require a 'Reapply Blocking' or similar trigger to update geometry."
          },
          {
            "action": "Toggle Staggering",
            "how": "OPM (AutoCAD Properties Palette) - strStager",
            "effect": "Toggles blocking arrangement between centered and staggered (alternating offsets). Requires recalculation."
          },
          {
            "action": "Adjust Tolerance",
            "how": "OPM (AutoCAD Properties Palette) - dTolerance",
            "effect": "Modifies the gap subtracted from the blocking length (length = bay - width - tolerance). Requires recalculation."
          }
        ]
      },
      "tokens_used": 9092,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_CreateMultipleHeightBlocking.mcr\n\n## Overview\nAutomatically generates rows of blocking (noggins) between wall studs at specified heights. The script intelligently fits blocking between studs, cuts around openings, and allows for staggering and length tolerances.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates within the 3D model. |\n| Paper Space | No | Not supported in layout views. |\n| Shop Drawing | No | This is a model generation script. |\n\n## Prerequisites\n- **Required Entities**: An existing Wall Element containing vertical beams (studs).\n- **Minimum Beam Count**: At least 1 vertical stud and 2 horizontal points to define the blocking range.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n```\nCommand Line: TSLINSERT\nAction: Select hsb_CreateMultipleHeightBlocking.mcr from the file list.\n```\n\n### Step 2: Select Wall Element\n```\nCommand Line: Please select a Element\nAction: Click on the Wall Element in the drawing where you want to add blocking.\n```\n\n### Step 3: Define Start Point\n```\nCommand Line: Pick Starting Point\nAction: Click a point to define where the blocking pattern begins (usually the bottom plate or a specific vertical location).\n```\n\n### Step 4: Define End Point\n```\nCommand Line: Pick End Point\nAction: Click a point to define where the blocking pattern ends (usually the top plate). This creates the vertical range for the blocking rows.\n```\n\n### Step 5: Configure Properties\nAfter insertion, select the script instance and modify the heights in the Properties Palette (Ctrl+1) to specify where rows are created.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Height Blocking Row 1 | Number | 600 mm | Vertical height for the first row of blocking. Set to `0` to disable this row. |\n| Height Blocking Row 2 | Number | 1200 mm | Vertical height for the second row of blocking. Set to `0` to disable this row. |\n| Height Blocking Row 3 | Number | 1800 mm | Vertical height for the third row of blocking. Set to `0` to disable this row. |\n| Height Blocking Row 4 | Number | 2400 mm | Vertical height for the fourth row of blocking. Set to `0` to disable this row. |\n| Stager the Blocking | Dropdown | No | If **Yes**, blocking pieces alternate positions for easier nailing. If **No**, they are centered. |\n| |Tolerance|| | Number | 0 mm | Cuts back the length of the blocking by this amount to ensure a fit (accommodates lumber variation). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Reapply Blocking | Regenerates all blocking based on the current wall geometry and property settings. Use this if you move studs, add openings, or change height properties. |\n\n## Settings Files\nNone required.\n\n## Tips\n- **Removing Rows**: If you only need three rows of blocking, set the unused \"Height Blocking Row\" parameter to `0`.\n- **Updating Geometry**: If you modify the wall (e.g., add a window or move a stud), the blocking will not update automatically. Right-click the script instance and select **Reapply Blocking** to sync the model.\n- **Nailing Access**: Use the **Stager the Blocking** option set to **Yes**. This staggers the pieces so ends alternate, providing better access for nail guns.\n- **Fit Tolerance**: If the blocking is consistently too tight or loose between studs, adjust the **Tolerance** value (e.g., 2mm) to create a slight gap.\n\n## FAQ\n- **Q: Why did some blocking pieces disappear?**\n  **A:** The script automatically cuts blocking where it intersects with openings (windows/doors) or horizontal beams. If a bay is too small (less than 50mm), it also skips creating blocking there.\n\n- **Q: How do I change the heights after inserting?**\n  **A:** Select the script instance, open the Properties Palette (Ctrl+1), change the `Height Blocking Row` values, and then right-click the script and choose **Reapply Blocking**.\n\n- **Q: Can I use this on curved walls?**\n  **A:** This script is designed for planar walls defined by a start and end point. For complex curved geometry, results may vary."
      },
      "tokens_used": 6455,
      "error": null
    }
  }
}