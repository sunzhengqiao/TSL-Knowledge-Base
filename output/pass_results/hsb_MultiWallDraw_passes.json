{
  "filename": "hsb_MultiWallDraw.mcr",
  "status": "completed",
  "total_tokens": 31999,
  "processing_time": 278.1246988773346,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "22.08.2012",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "First version"
          },
          {
            "version": "1.2",
            "date": "14.11.2013",
            "author": "",
            "changes": "Bugfix"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5125,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script collects entities explicitly from the model using Group gp.collectEntities(..., _kModel). No usage of _Viewport or _kPaperSpace. It uses eraseInstance() immediately after insertion, which is characteristic of a utility tool rather than a persistent ShopDrawing element. The script creates a schematic visualization of wall elements using the Display class."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element (containing a SubMap named 'hsb_Multiwall')",
            "GenBeam (contained within the Elements)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Elements that have been tagged/processed by another script to contain 'hsb_Multiwall' map data.",
          "requiredSettings": []
        }
      },
      "tokens_used": 4287,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Pick a point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Offset between panels",
            "defaultValue": "U(4000)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension Style",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [
              "_DimStyles (System List)"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dNewTextHeight",
            "type": "PropDouble",
            "displayName": "Text Height",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Text Color",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Refresh Multiwalls|",
            "handler": "strChangeEntity",
            "action": "Clears the internal list of elements and re-scans the ModelSpace for Elements containing the 'hsb_Multiwall' submap.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "--------------------------------------",
            "handler": "strSeparator",
            "action": "Visual separator in the context menu.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Delete Multiwalls|",
            "handler": "strDeleteEntity",
            "action": "Removes the 'hsb_Multiwall' submap from all Elements in the ModelSpace, effectively deleting the multiwall configuration data.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 5674,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 2D schematic layout (overview) of multiple timber wall panels that have been grouped together by a 'Multiwall' number, stacking them visually in Model Space for checking.",
          "category": "Utility / Layout",
          "typicalUseCase": "Used after defining a multi-wall configuration to generate a clean, 2D overview drawing that displays all related wall panels and their element numbers in a list format."
        },
        "parameters": [
          {
            "name": "dOffset",
            "technicalDefault": "U(4000)",
            "businessMeaning": "The vertical distance between successive multiwall groups in the generated schematic list.",
            "validRange": "500 to 10000",
            "unit": "mm",
            "affectsOutput": "Controls the spacing of the rows in the overview. Increasing this value moves the next multiwall group further down/up in the drawing to avoid overlapping text or geometry."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "The AutoCAD Dimension Style used to format the text labels (Element Numbers) in the schematic.",
            "validRange": "Any existing Dimension Style name in the drawing",
            "unit": "N/A",
            "affectsOutput": "Determines the font, text size (if not overridden), and arrow style of the labels identifying the walls."
          },
          {
            "name": "dNewTextHeight",
            "technicalDefault": "-1",
            "businessMeaning": "The explicit height for the text labels in the schematic. A value of -1 ignores this setting and uses the height defined in the Dimension Style.",
            "validRange": "-1 (use style default) or 2.5 to 25.0",
            "unit": "mm",
            "affectsOutput": "If set to a positive value, it overrides the Dimension Style's text height, making the Element numbers larger or smaller for readability."
          },
          {
            "name": "nColor",
            "technicalDefault": "-1",
            "businessMeaning": "The specific color for the text labels. A value of -1 uses the color defined by the Dimension Style or the current layer.",
            "validRange": "-1 (use style/layer default) or 1 to 255 (AutoCAD Color Index)",
            "unit": "Color Index",
            "affectsOutput": "Changes the color of the Element Number text in the generated view, useful for highlighting or adhering to office layer standards."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dNewTextHeight is set to -1",
            "effect": "Text height is determined by the 'Text Height' setting within the 'sDimStyle'.",
            "cascade": [
              "sDimStyle"
            ]
          },
          {
            "trigger": "nColor is set to -1",
            "effect": "Text color is determined by the settings within 'sDimStyle' or the entity's layer properties.",
            "cascade": [
              "sDimStyle"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Schematic Geometry",
            "description": "2D projections of the GenBeams contained within the Elements.",
            "appliedTo": "Model Space (at the location picked by user)"
          },
          {
            "type": "Text Labels",
            "description": "Element Numbers and Headers.",
            "appliedTo": "Model Space"
          }
        ]
      },
      "tokens_used": 4788,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches script hsb_MultiWallDraw.mcr.",
          "System checks if script is in insertion mode (_bOnInsert).",
          "[Check] Script validates if this is the first insertion cycle (insertCycleCount() <= 1). If > 1, the script erases the instance and terminates.",
          "[Check] System collects all Entities of type 'Element' from ModelSpace (_kModel).",
          "[Loop] For each Element found, the script checks for the existence of a SubMap named 'hsb_Multiwall'.",
          "Elements containing the 'hsb_Multiwall' SubMap are stored in an internal array (_Element).",
          "System prompts the user: 'Pick a point' (getPoint).",
          "User picks a point in ModelSpace. This defines the origin (_Pt0) for the generated schematic.",
          "Script terminates insertion process and instance is immediately erased (utility pattern).",
          "Script executes calculation logic (_bOnRecalc) to generate the visualization.",
          "[Process] Script parses internal array to extract unique Multiwall Numbers and associated Element Numbers.",
          "Script sets up Display objects for geometry and text (using sDimStyle, nColor, dNewTextHeight).",
          "Script draws header 'Multiwalls' at the picked point.",
          "[Loop] For each unique Multiwall Number identified:",
          "  Coordinate System (CS) is shifted downwards by 'dOffset' amount.",
          "  Script iterates through all collected Elements to find those belonging to the current Multiwall Number.",
          "  For each matching Element:",
          "    Retrieves the local displacement and Coordinate System.",
          "    Retrieves all GenBeams within the Element.",
          "    Transforms and draws a schematic representation of the GenBeams in the 2D view.",
          "    Draws the Element Number label near the beam representation.",
          "Visualization generation complete."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion cycle count",
            "path1": {
              "name": "First Cycle",
              "steps": [
                "Proceed to collect Elements and prompt for point."
              ]
            },
            "path2": {
              "name": "Subsequent Cycles (>1)",
              "steps": [
                "Execute eraseInstance().",
                "Terminate script immediately."
              ]
            }
          },
          {
            "condition": "User selects 'Refresh Multiwalls' from Context Menu",
            "path1": {
              "name": "Execute Refresh",
              "steps": [
                "Clear internal list of Elements (_Element.setLength(0)).",
                "Re-scan ModelSpace for Elements with 'hsb_Multiwall' SubMap.",
                "Re-populate internal list.",
                "Re-run calculation and redraw visualization."
              ]
            }
          },
          {
            "condition": "User selects 'Delete Multiwalls' from Context Menu",
            "path1": {
              "name": "Execute Delete",
              "steps": [
                "Scan ModelSpace for Elements with 'hsb_Multiwall' SubMap.",
                "Remove the 'hsb_Multiwall' SubMap from found Elements (el.removeSubMapX).",
                "Clear internal list.",
                "Visualization effectively disappears as data source is gone."
              ]
            }
          },
          {
            "condition": "Text Height Property (dNewTextHeight)",
            "path1": {
              "name": "Value is -1 (Default)",
              "steps": [
                "Text height is controlled by the settings in the selected Dimension Style (sDimStyle)."
              ]
            },
            "path2": {
              "name": "Value > 0",
              "steps": [
                "Text height explicitly set to dNewTextHeight value.",
                "Overrides Dimension Style setting."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of 'hsb_Multiwall' SubMap on Elements",
            "errorMessage": "No error message explicitly shown in code.",
            "recovery": "User must ensure Elements have been processed by the 'hsb_Multiwall' configuration script prior to running this draw script. If no elements contain the map, the resulting visualization will be empty."
          },
          {
            "check": "Map Data Integrity (Number, Sequence, PTORG)",
            "errorMessage": "Potential logic error if map data is missing during drawing phase (would cause default values or crash depending on strictness of getPoint3d, but usually defaults to 0).",
            "recovery": "Ensure the upstream script writing 'hsb_Multiwall' writes complete coordinate and sequence data."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Visualization",
            "how": "Right-click Context Menu -> '|Refresh Multiwalls|'",
            "effect": "Re-scans the model for any new Elements tagged as multiwalls or changes to existing ones and updates the 2D schematic list."
          },
          {
            "action": "Remove Multiwall Data",
            "how": "Right-click Context Menu -> '|Delete Multiwalls|'",
            "effect": "Removes the multiwall grouping tag from all Elements in the model. The schematic will clear in the next update."
          },
          {
            "action": "Modify Layout Properties",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "User can change 'Offset between panels' (dOffset) to increase/decrease spacing, 'Dimension Style' (sDimStyle) to change text font/style, 'Text Height' (dNewTextHeight), or 'Text Color' (nColor). Changing these triggers an immediate update of the schematic."
          }
        ]
      },
      "tokens_used": 6439,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_MultiWallDraw.mcr\n\n## Overview\nThis script generates a 2D schematic overview (layout) of multiple timber wall panels in Model Space. It takes walls that have been grouped together by a \"Multiwall\" number and stacks them visually in a list for checking and verification.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script creates the schematic layout in the current Model Space. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: Elements that contain a SubMap named `hsb_Multiwall`. (This means you must have previously run a configuration script to tag/group your walls).\n- **Minimum Beam Count**: 0.\n- **Required Settings**: A Dimension Style must exist in the drawing for labeling.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Select `hsb_MultiWallDraw.mcr` from the file dialog.\n\n### Step 2: Pick Origin Point\n```\nCommand Line: Pick a point\nAction: Click anywhere in the Model Space to set the insertion point for the top of the wall list.\n```\n\n### Step 3: View Results\nThe script will automatically generate the wall overview at the selected location. The script instance itself will erase itself, leaving only the generated geometry and text.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Offset between panels | Number | 4000 mm | The vertical distance between successive multiwall groups in the generated list. Increase this if walls overlap. |\n| Dimension Style | Dropdown | _DimStyles | The AutoCAD Dimension Style used to format the Element Number labels (font, arrows, etc.). |\n| Text Height | Number | -1 | The height of the text labels. Set to -1 to use the Dimension Style's default height. |\n| Text Color | Number | -1 | The color of the text labels. Set to -1 to use the Dimension Style's default color or ByLayer. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Refresh Multiwalls | Clears the current list and re-scans the model for Elements with 'hsb_Multiwall' data, then redraws the schematic. Use this if you have added or modified walls. |\n| Delete Multiwalls | Removes the 'hsb_Multiwall' grouping data from all Elements in the model. This effectively ungroups the walls. |\n\n## Settings Files\nNone. This script does not rely on external XML or settings files.\n\n## Tips\n- **Avoid Overlaps**: If your generated walls look cluttered or overlap each other vertically, increase the **Offset between panels** property in the Properties Palette.\n- **Data Preparation**: Ensure you have run your multiwall configuration script *before* running this drawing script. If nothing appears, it means no walls have been tagged with the 'hsb_Multiwall' data yet.\n- **Text Readability**: If the Element Numbers are too small to read, set **Text Height** to a specific value (e.g., 250 mm) instead of -1.\n\n## FAQ\n- **Q: I ran the script but nothing appeared.**\n  A: This usually means the script could not find any Elements with the 'hsb_Multiwall' SubMap. Ensure your walls have been processed/assigned to a multiwall group by the prerequisite configuration script.\n  \n- **Q: How do I change the font of the Element Numbers?**\n  A: Change the **Dimension Style** property to a style that uses your desired font, or ensure **Text Height** is set correctly.\n\n- **Q: The script instance disappears after I pick a point. Is this normal?**\n  A: Yes. This is a utility script. It runs once to generate the geometry and then removes itself from the drawing to keep the file size down. The resulting lines and text remain until you delete them."
      },
      "tokens_used": 5686,
      "error": null
    }
  }
}