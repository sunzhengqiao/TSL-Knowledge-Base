{
  "filename": "hsb_SetBeamName.mcr",
  "status": "completed",
  "total_tokens": 58896,
  "processing_time": 262.24951124191284,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9589,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script operates on Element and Beam entities using el.beam() and el.sheet() to modify 3D attributes (Name, Material, Grade, Color). It utilizes the _bOnElementConstructed flag and executes eraseInstance(), indicating it is a processing script that runs during the regeneration of 3D model elements and does not generate 2D drawings. No _Viewport or _kPaperSpace logic is present."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing generated Timber Elements",
          "requiredSettings": []
        }
      },
      "tokens_used": 7579,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"ShowDynamicDialog\",\n      \"trigger\": \"During Insertion (_bOnInsert)\",\n      \"title\": null,\n      \"dataSource\": \"Property Palette (OPM)\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sColor\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Set Default Color\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Set All the beam with Default Color\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sModule\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Set Module Beam with Default Color\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Overwrite the Module Beam Color\"\n    },\n    {\n      \"index\": 23,\n      \"variable\": \"sSetInfo\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Set Information Field\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Set the information field if it doesnt have any\"\n    },\n    {\n      \"index\": 26,\n      \"variable\": \"sSetLabel\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Set subLabel with Group Name\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Set the sublabel field with the name of the group that the wall belongs to\"\n    },\n    {\n      \"index\": 27,\n      \"variable\": \"sWallType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Append Wall Type to subLabel\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Append the wall type after the group to the sublabel field of every beam\"\n    },\n    {\n      \"index\": 31,\n      \"variable\": \"sUseDetailProperties\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Use detail beam properties (if any)\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Uses the properties of a beam defined in details if any\"\n    },\n    {\n      \"index\": 28,\n      \"variable\": \"sFilterBeams\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Exclude Color on Beams with Code\",\n      \"defaultValue\": \"X;\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": \"Separate multiple entries by|';'\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"nColorDef\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"Default Color\",\n      \"defaultValue\": 7,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": \"\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sbmName00\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Jack Over Opening\",\n      \"defaultValue\": \"LINTOL PACKERS\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sbmName01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Jack Under Opening\",\n      \"defaultValue\": \"SILL STUDS\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sbmName02\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Cripple Stud\",\n      \"defaultValue\": \"CRIPPLE\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"sbmName03\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Transom\",\n      \"defaultValue\": \"TRANSOM\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 6,\n      \"variable\": \"sbmName04\",\n      \"type\": \"PropString\",\n      \"displayName\": \"King Stud\",\n      \"defaultValue\": \"STUD\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 7,\n      \"variable\": \"sbmName05\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Sill\",\n      \"defaultValue\": \"SILL\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 8,\n      \"variable\": \"sbmName06\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Angled TopPlate Left\",\n      \"defaultValue\": \"TOP PLATE\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 9,\n      \"variable\": \"sbmName07\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Angled TopPlate Right\",\n      \"defaultValue\": \"TOP PLATE\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 10,\n      \"variable\": \"sbmName08\",\n      \"type\": \"PropString\",\n      \"displayName\": \"TopPlate\",\n      \"defaultValue\": \"TOP PLATE\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \""
      },
      "tokens_used": 10301,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automatically standardizes the naming, coloring, material, and grading of timber beams within wall or floor elements to ensure consistency for production lists and visual checking.\",\n    \"category\": \"Framing / Configuration\",\n    \"typicalUseCase\": \"Run after generating or modifying a timber wall to ensure all structural studs, plates, and headers have correct engineering grades (e.g., C16), material codes (e.g., CLS), and standardized names for export to CAM or CSV lists.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sColor\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Master switch to apply color coding to the 3D beams. Typically used for visual quality control (e.g., highlighting different layers or structural types) or to reset colors to a standard view.\",\n      \"validRange\": \"Yes; No\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"If 'No', beams retain their original color or internal script defaults. If 'Yes', applies the value from 'Default Color' (nColorDef).\"\n    },\n    {\n      \"name\": \"sModule\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Determines if the color settings should overwrite the colors of beams inside imported modules (sub-elements).\",\n      \"validRange\": \"Yes; No\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"If 'No', module beams keep their color. If 'Yes', module beams are recolored based on the main script's color rules.\"\n    },\n    {\n      \"name\": \"nColorDef\",\n      \"technicalDefault\": 7,\n      \"businessMeaning\": \"The AutoCAD Color Index (ACI) applied to all beams when 'Set Default Color' is enabled.\",\n      \"validRange\": \"1-255 (ACI Index)\",\n      \"unit\": \"Integer\",\n      \"affectsOutput\": \"Changes the visual appearance of all beams in the model.\"\n    },\n    {\n      \"name\": \"sFilterBeams\",\n      \"technicalDefault\": \"X;\",\n      \"businessMeaning\": \"A list of beam codes (e.g., 'S;H') that should be excluded from color changes. Used to preserve specific visual distinctions for certain non-standard parts.\",\n      \"validRange\": \"Text string separated by semicolons (;)\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Beams with codes matching this list will not have their color changed by the script.\"\n    },\n    {\n      \"name\": \"sSetInfo\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Populates the generic 'Information' attribute of a beam with its designated Name if the Information field is currently empty.\",\n      \"validRange\": \"Yes; No\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Adds data to the beam's Information field, which is often used in labels or CAM exports.\"\n    },\n    {\n      \"name\": \"sSetLabel\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Sets the 'SubLabel' attribute of the beam to the name of the Element Group (e.g., 'Floor 1\\\\\\\\Wall A').\",\n      \"validRange\": \"Yes; No\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Updates the beam's SubLabel property to group beams physically by their parent assembly.\"\n    },\n    {\n      \"name\": \"sWallType\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Appends the Element's wall type"
      },
      "tokens_used": 11604,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Insertion/Execution Triggered",
          "2. Check Insertion Cycle Count",
          "3. Load Properties from OPM or Catalog",
          "4. Initialize Beam Mapping Arrays (Types, Names, Colors, Exclusions)",
          "5. Search for Elements in Model Space",
          "6. Iterate through found Elements",
          "7. Retrieve Element Coordinate System and Dimensions",
          "8. Determine Default Material and Grade (Fallback to 'CLS' and 'C16' if empty)",
          "9. (Pre-Processing Loop) Iterate Beams to map Types based on IDs and Codes",
          "10. (Main Processing Loop) Iterate Beams to apply properties",
          "11. Check Beam Type and Code Exclusions",
          "12. Apply Name (considering 'Use Detail Properties' setting)",
          "13. Apply Material (skip for Headers, check existing material)",
          "14. Apply Color (check Module setting, Filters, and Default/Map settings)",
          "15. Apply Grade (if empty)",
          "16. Apply Information/SubLabel (if enabled and empty)",
          "17. (Post-Processing) Update Sheet Names to match Materials",
          "18. Erase Script Instance (Cleanup)"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase Instance",
                "Exit Script"
              ]
            },
            "path2": {
              "name": "Cycle = 1",
              "steps": [
                "Show Dialog (if applicable)",
                "Continue to Processing"
              ]
            }
          },
          {
            "condition": "Beam Name Overwrite Logic",
            "path1": {
              "name": "Detail Properties Enabled & Name Exists",
              "steps": [
                "Preserve existing Beam Name",
                "Skip Name update"
              ]
            },
            "path2": {
              "name": "Detail Properties Disabled OR Name Empty",
              "steps": [
                "Check Exclusion List",
                "Update Beam Name from Map"
              ]
            }
          },
          {
            "condition": "Color Application (sModule & sFilter)",
            "path1": {
              "name": "Beam is Module & sModule=No OR Code in Filter",
              "steps": [
                "Skip Color Update"
              ]
            },
            "path2": {
              "name": "Beam is Main Element OR sModule=Yes AND Code not in Filter",
              "steps": [
                "Check sColor Flag",
                "Apply Default Color OR Mapped Type Color"
              ]
            }
          },
          {
            "condition": "Material Update",
            "path1": {
              "name": "Beam is Header Type",
              "steps": [
                "Skip Material Update"
              ]
            },
            "path2": {
              "name": "Beam is Not Header",
              "steps": [
                "Check if Material is Empty or 'PACKER'",
                "Apply Default Material"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Default Grade availability",
            "errorMessage": "None (Silent Correction)",
            "recovery": "Script defaults to property 'Grade' (C16) if element/beam grade is empty."
          },
          {
            "check": "Default Material availability",
            "errorMessage": "None (Silent Correction)",
            "recovery": "Script defaults to property 'Material' (CLS) if element/beam material is empty."
          },
          {
            "check": "Element Validity",
            "errorMessage": "None (Silent Skip)",
            "recovery": "Script skips elements that return false for bIsValid()."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Automatic Script Removal",
            "how": "_bOnElementConstructed event",
            "effect": "The script instance erases itself immediately after processing the element."
          },
          {
            "action": "Modify Beam Properties",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "User can manually override Name, Material, Grade, or Color on specific beams after the script has run."
          },
          {
            "action": "Update Script Settings for Batch",
            "how": "Edit Catalog/Properties before Insertion",
            "effect": "Changing 'Set Default Color', names, or filters in the script properties will affect the next set of elements the script is applied to."
          }
        ]
      },
      "tokens_used": 12304,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SetBeamName\n\n## Overview\nThis script automates the standardization of beam properties (Names, Materials, Grades, and Colors) within timber wall or floor elements. It is designed to batch-process generated elements to ensure consistency for production lists, labeling, and visual quality control.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script searches for and processes Timber Elements in the current model. |\n| Paper Space | No | This script does not operate on 2D drawings or layouts. |\n| Shop Drawing | No | This is a 3D model processing script. |\n\n## Prerequisites\n- **Required Entities**: Timber Elements (Walls/Floors) must exist in the Model Space.\n- **Minimum Beam Count**: 0 (The script will simply skip empty elements).\n- **Required Settings**: None (Uses internal properties or script defaults).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_SetBeamName.mcr` from the file browser.\n\n### Step 2: Configure Properties\nBefore clicking to place the script, open the **AutoCAD Properties Palette (Ctrl+1)**.\n- Set the desired **Naming Conventions** (e.g., \"STUD\", \"TOP PLATE\").\n- Configure **Color** and **Material** settings.\n- Adjust **Filters** if specific beams should be excluded from changes.\n\n### Step 3: Execute Script\n```\nCommand Line: TSLINSERT\nAction: Click anywhere in the Model Space to insert the script instance.\n```\nThe script will immediately scan all elements in the model, apply the configured properties, and then automatically delete itself.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Set Default Color** | dropdown | No | Applies a standard color to all beams for visual checking. |\n| **Set Module Beam with Default Color** | dropdown | No | If \"Yes\", overwrites the color of beams inside imported Modules (sub-elements). |\n| **Set Information Field** | dropdown | No | If \"Yes\", populates the beam's 'Information' field with its Name if it is currently empty. |\n| **Set subLabel with Group Name** | dropdown | No | If \"Yes\", sets the beam's 'SubLabel' to the parent Element's Group Name. |\n| **Append Wall Type to subLabel** | dropdown | No | If \"Yes\", appends the Wall Type to the SubLabel (e.g., \"ExtWall\"). |\n| **Use detail beam properties (if any)** | dropdown | No | If \"Yes\", preserves specific beam names defined in Details rather than overwriting them. |\n| **Exclude Color on Beams with Code** | text | X; | List of beam codes (separated by `;`) to exclude from color changes. |\n| **Default Color** | number | 7 | The AutoCAD Color Index (ACI) number to apply if coloring is enabled. |\n| **Jack Over Opening** | text | LINTOL PACKERS | Sets the name for Jack/Rafter beams located above openings. |\n| **Jack Under Opening** | text | SILL STUDS | Sets the name for Jack/Rafter beams located below openings. |\n| **Cripple Stud** | text | CRIPPLE | Sets the name for Cripple Studs. |\n| **Transom** | text | TRANSOM | Sets the name for Transom beams. |\n| **King Stud** | text | STUD | Sets the name for King Studs. |\n| **Sill** | text | SILL | Sets the name for Sill plates. |\n| **Angled TopPlate Left** | text | TOP PLATE | Sets the name for left-angled top plates. |\n| **Angled TopPlate Right** | text | TOP PLATE | Sets the name for right-angled top plates. |\n| **TopPlate** | text | TOP PLATE | Sets the name for standard Top Plates. |\n\n## Right-Click Menu Options\nThis script executes automatically upon insertion and erases itself immediately. There are no persistent right-click menu options associated with it.\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A.\n- **Purpose**: All settings are managed directly via the AutoCAD Properties Palette during insertion.\n\n## Tips\n- **Visual QC**: Enable \"Set Default Color\" and choose a bright color (e.g., Red) to quickly verify that all beams in a complex wall have been processed by the script.\n- **Preserving Manual Names**: If you have manually renamed specific beams in your details and want to keep them, set **Use detail beam properties (if any)** to \"Yes\".\n- **Exclusions**: Use the **Exclude Color on Beams with Code** field to ensure that hardware or special non-timber items (defined by specific codes) are not recolored by the batch process.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I inserted it?**\n  **A:** This is normal behavior. The script is a \"run-once\" processor. It scans the model, updates the beams, and then performs an automatic cleanup (`eraseInstance`) to avoid cluttering your drawing.\n- **Q: How do I change the Material or Grade?**\n  **A:** The script uses internal defaults (typically 'CLS' and 'C16') if these fields are empty. To change these defaults, you must edit the script source code or the specific element defaults before running this script, as these specific parameters are not exposed in the Properties Panel in this version.\n- **Q: The script didn't change the name of a specific beam. Why?**\n  **A:** Check if the beam has a specific name defined in its Detail properties. If **Use detail beam properties (if any)** is set to \"Yes\", the script will respect the existing name."
      },
      "tokens_used": 7519,
      "error": null
    }
  }
}