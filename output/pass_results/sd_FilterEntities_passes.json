{
  "filename": "sd_FilterEntities.mcr",
  "status": "completed",
  "total_tokens": 34354,
  "processing_time": 348.09153175354004,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": 1,\n    \"minorVersion\": 7,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"Consumes any GenBeam and creates several dimrequests in dependency of the contour and containg drills\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.7\",\n      \"date\": \"03.04.2023\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"HSB-18065: Support Lowfield-SpaceStudAssembly\"\n    },\n    {\n      \"version\": \"1.6\",\n      \"date\": \"06.05.2022\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"HSB-15357: Support GC-SpaceStudAssembly\"\n    },\n    {\n      \"version\": \"1.0\",\n      \"date\": \"14."
      },
      "tokens_used": 6635,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ShopDrawing",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "Filename prefix 'sd_' indicates ShopDrawing. Explicit comment: 'This tsl is only executed by the shopdraw engine and to use it one needs to append it to the ruleset of a multipage style.' Logic implements _bOnMapIO for configuration and filters the global _Entity array, which is standard behavior for filter scripts in Multipage layouts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam",
            "Sheet",
            "ElementWall",
            "TslInst",
            "Sip"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be run within the Shopdrawing engine as part of a Multipage style ruleset",
          "requiredSettings": [
            "TSL script 'mapIO_GetArcPLine.mcr' must be in drawing or search path",
            "Stereotypes used: Drill, Extremes, Contour, Beamcut"
          ]
        }
      },
      "tokens_used": 4527,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getGenBeam",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select point near tool",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnMapIO",
            "title": null,
            "dataSource": "Internal Properties Palette Configuration",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sEntityType",
            "type": "PropString",
            "displayName": "Entity to Select",
            "defaultValue": "|Beams|",
            "inputType": "dropdown",
            "options": [
              "|Beams|",
              "|Sheets|",
              "|Wall Elements|",
              "|SubAssembly|",
              "|SpaceStud Assembly|",
              "|Sip|",
              "|Only beams with tools|",
              "|Only sheets with tools|"
            ],
            "category": null,
            "description": "Only this entities will be added to the shopdraw"
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "mapIO_GetArcPLine.mcr",
            "searchPaths": [
              "Drawing",
              "Search paths"
            ],
            "purpose": "Script dependency mentioned in remarks",
            "required": true
          }
        ]
      },
      "tokens_used": 4368,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Filters the global list of entities available to the Shopdrawing engine, allowing specific views to display only certain element types or only elements that require machining.",
          "category": "ShopDrawing",
          "typicalUseCase": "Configuring a Multipage layout to separate structural framing views from sheathing views, or to generate a specific detail view that hides simple, uncut members and shows only those with complex geometry or drilling."
        },
        "parameters": [
          {
            "name": "sEntityType",
            "technicalDefault": "|Beams|",
            "businessMeaning": "Specifies the category of construction elements to retain for the current drawing view. It allows the user to isolate structural timber (beams), cladding (sheets), wall panels, or specific proprietary assemblies. It also provides smart filtering for complexity, showing only elements that require CNC machining (tools) or have non-rectangular shapes.",
            "validRange": "|Beams|, |Sheets|, |Wall Elements|, |SubAssembly|, |SpaceStud Assembly|, |Sip|, |Only beams with tools|, |Only sheets with tools|",
            "unit": "Enumeration",
            "affectsOutput": "Determines which entities are passed to downstream scripts in the ruleset. For example, if 'Only beams with tools' is selected, straight beams with no drillings or cuts are removed from the drawing, preventing them from being dimensioned or labeled in that specific view."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "Filtered Entity Set",
            "description": "The script modifies the global _Entity array, removing items that do not match the selected criteria. The output is the subset of entities (Beams, Sheets, etc.) that downstream scripts will process.",
            "appliedTo": "Subsequent scripts in the Multipage style ruleset (e.g., dimensioning, labeling, or listing scripts)."
          }
        ]
      },
      "tokens_used": 6002,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution begins",
          "[Conditional: _bOnInsert] User selects a GenBeam anchor and a placement point to instantiate the script",
          "[Conditional: _bOnMapIO] Properties palette opens allowing user to configure 'Entity to Select'",
          "[Main Execution] Script checks if the global _Entity array contains entities",
          "[Main Execution] Script copies all entities to a temporary local array and clears the global _Entity array",
          "[Main Execution] Script iterates through the temporary entity list",
          "[Filtering] Script evaluates each entity based on the selected filter mode (Beams, Sheets, etc.)",
          "[Filtering] Valid entities are appended back to the global _Entity array",
          "[Completion] Script finishes; downstream scripts in the multipage ruleset process only the filtered list"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Context",
            "path1": {
              "name": "Insertion",
              "steps": [
                "Prompt for GenBeam",
                "Prompt for Point",
                "Exit"
              ]
            },
            "path2": {
              "name": "Configuration (_bOnMapIO)",
              "steps": [
                "Initialize Property 'Entity to Select'",
                "Show Dialog",
                "Update Map settings",
                "Exit"
              ]
            },
            "path3": {
              "name": "Runtime Processing",
              "steps": [
                "Filter global entities",
                "Update global _Entity array"
              ]
            }
          },
          {
            "condition": "Filter Mode: 'Only beams with tools' (Index 6)",
            "path1": {
              "name": "Complex Beam",
              "steps": [
                "Cast entity to Beam",
                "Retrieve AnalysedTools",
                "Exclude standard perpendicular cuts",
                "If remaining tools > 0, append to _Entity"
              ]
            },
            "path2": {
              "name": "Simple Beam",
              "steps": [
                "Cast entity to Beam",
                "Retrieve AnalysedTools",
                "If no tools found, discard entity"
              ]
            }
          },
          {
            "condition": "Filter Mode: 'Only sheets with tools' (Index 7)",
            "path1": {
              "name": "Complex Sheet",
              "steps": [
                "Cast entity to Sheet",
                "Get Envelope Vertices",
                "Check for non-rectangular vertex count (!= 5)",
                "Check presence of AnalysedTools",
                "Check for non-90 degree angles",
                "If any complexity found, append to _Entity"
              ]
            },
            "path2": {
              "name": "Simple Sheet",
              "steps": [
                "Cast entity to Sheet",
                "Verify 5 vertices (rectangular)",
                "Verify no tools",
                "Verify 90 degree angles",
                "Discard entity"
              ]
            }
          },
          {
            "condition": "Filter Mode: 'SpaceStud Assembly' (Index 4)",
            "path1": {
              "name": "Supported Assembly",
              "steps": [
                "Cast entity to TslInst",
                "Check scriptName (hsb, GC, or Lowfield)",
                "Check Map for 'SpaceStudAssembly' key",
                "If match, append to _Entity"
              ]
            },
            "path2": {
              "name": "Unsupported/Wrong Type",
              "steps": [
                "Fail casting or Name/Key check",
                "Discard entity"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Global Entity Availability",
            "errorMessage": "None (Silent Exit)",
            "recovery": "Ensure the drawing contains entities and the shopdrawing layout is correctly populated"
          },
          {
            "check": "Entity Type Casting",
            "errorMessage": "None (Silent Skip)",
            "recovery": "The script automatically skips entities that do not match the target type (e.g., skipping a Sheet when filtering for Beams)"
          },
          {
            "check": "SpaceStud Assembly Integrity",
            "errorMessage": "None (Silent Skip)",
            "recovery": "Ensure the TslInst represents a valid SpaceStud Assembly with the correct internal map key 'SpaceStudAssembly'"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Filter Configuration",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing the 'Entity to Select' property alters which entities are processed by subsequent scripts in the ruleset during the next generation/update"
          }
        ]
      },
      "tokens_used": 7482,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# sd_FilterEntities.mcr\n\n## Overview\nThis script filters the list of entities available in a Multipage Shop Drawing layout. It allows specific views to display only selected element types (such as beams or sheets) or only elements that require machining (tools).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used for inserting the script instance into the drawing. |\n| Paper Space | Yes | Functionality is applied here when generating Shop Drawings. |\n| Shop Drawing | Yes | This script is executed by the Shopdrawing engine as part of a Multipage style ruleset. |\n\n## Prerequisites\n- **Required Entities**: Beams, Sheets, Wall Elements, Sub-assemblies, SpaceStud Assemblies, or SIPs must exist in the drawing to be filtered.\n- **Minimum Beam Count**: 0 (The script processes whatever entities are currently in the layout).\n- **Required Settings Files**:\n  - `mapIO_GetArcPLine.mcr` must be available in the drawing folder or the hsbCAD search path.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `sd_FilterEntities.mcr`\n\n### Step 2: Select Anchor Beam\n```\nCommand Line: Select GenBeam\nAction: Click on a beam in the model to act as the anchor/reference for this script instance.\n```\n\n### Step 3: Place Instance\n```\nCommand Line: Select point near tool\nAction: Click a location in the drawing to place the script instance.\n```\n\n### Step 4: Configure Filter (Properties Palette)\nAfter insertion, select the script instance and open the **Properties Palette** (Ctrl+1). Use the **Entity to Select** dropdown to define what should be visible in the specific Shop Drawing view.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Entity to Select | dropdown | \\|Beams\\| | Determines which entities are passed to the Shopdrawing engine for processing in the current view. |\n| *Available Options* | - | - | **\\|Beams\\|**: Shows only structural beams. <br> **\\|Sheets\\|**: Shows only cladding/sheets. <br> **\\|Wall Elements\\|**: Shows only wall panels. <br> **\\|SubAssembly\\|**: Shows sub-assemblies. <br> **\\|SpaceStud Assembly\\|**: Shows SpaceStud assemblies. <br> **\\|Sip\\|**: Shows Structural Insulated Panels. <br> **\\|Only beams with tools\\|**: Shows only beams with CNC machining/drilling. <br> **\\|Only sheets with tools\\|**: Shows only sheets with cuts or machining. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific custom context menu items are added by this script. |\n\n## Settings Files\n- **Filename**: `mapIO_GetArcPLine.mcr`\n- **Location**: Drawing folder or hsbCAD Search Paths\n- **Purpose**: Required dependency for the script to function correctly. It handles geometry calculations.\n\n## Tips\n- **Clean up Detail Views**: Use the \"Only beams with tools\" option in a detail view. This automatically hides simple, straight beams (which might clutter the drawing) and highlights only complex members that require dimensions for machining.\n- **Separate Structural and Cladding Plans**: Create two different rulesets in your Multipage style. Use one instance of this script set to \"\\|Beams\\|\" for the framing plan, and another instance set to \"\\|Sheets\\|\" for the sheathing layout.\n- **Troubleshooting**: If a view appears empty, check the **Entity to Select** property. You may have selected a filter type (like \"\\|Sip\\|\") that does not exist in the current model.\n\n## FAQ\n- **Q: I inserted the script, but I don't see any changes in my Model Space.**\n  - A: This script is designed primarily for the **Shop Drawing (Paper Space)** generation process. It filters the list of entities when the layout is calculated. In Model Space, it acts as a placeholder for your settings.\n- **Q: What is the difference between \"\\|Beams\\|\" and \"\\|Only beams with tools\\|\"?**\n  - A: \"\\|Beams\\|\" will show every single beam in the view. \"\\|Only beams with tools\\|\" acts as a smart filter, removing beams that are simple rectangles without drill holes or cuts, helping you focus on complex connections.\n- **Q: Can I filter for custom assemblies?**\n  - A: Yes, provided they are mapped correctly in the system. Use the \"\\|SubAssembly\\|\" or \"\\|SpaceStud Assembly\\|\" options if your drawing contains those specific entities."
      },
      "tokens_used": 5340,
      "error": null
    }
  }
}