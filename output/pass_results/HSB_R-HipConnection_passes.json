{
  "filename": "HSB_R-HipConnection.mcr",
  "status": "completed",
  "total_tokens": 38071,
  "processing_time": 222.27206802368164,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "14.02.2014",
            "author": "AS",
            "changes": "Pilot version."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6324,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses PrEntity with ElementRoof and Beam objects. Implements geometric logic for extending and cutting beams (addToolStatic). No sd_ prefixes, Viewport usage, or #Type E definitions found. Erases instance after execution."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementRoof",
            "Beam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 5046,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Properties Dialog",
            "trigger": "On Insert (if no catalog key is specified or found)",
            "title": null,
            "dataSource": "Local TSL Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeperator01",
            "type": "PropString",
            "displayName": "Hip connection",
            "defaultValue": "",
            "inputType": "readonly",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sBmCodeHK",
            "type": "PropString",
            "displayName": "Beamcode hip",
            "defaultValue": "HK-01",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOvershootLength",
            "type": "PropDouble",
            "displayName": "Overshoot length",
            "defaultValue": "200",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sSeperator02",
            "type": "PropString",
            "displayName": "Ridge connection",
            "defaultValue": "",
            "inputType": "readonly",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sSquareOff",
            "type": "PropString",
            "displayName": "Square off at ridge",
            "defaultValue": "|Yes|",
            "inputType": "dropdown",
            "options": [
              "|Yes|",
              "|No|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dOffsetCutTop",
            "type": "PropDouble",
            "displayName": "Offset cut at ridge",
            "defaultValue": "20",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5727,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the connection of timber hip beams across multiple roof elements by extending lower elements over upper ones and finishing the ridge end.",
          "category": "Framing",
          "typicalUseCase": "Used when constructing a roof with a hip line composed of multiple elements (e.g., a broken hip) where the carpenter wants the hip beams to physically overlap/connect at the element boundaries rather than stopping short."
        },
        "parameters": [
          {
            "name": "sBmCodeHK",
            "technicalDefault": "HK-01",
            "businessMeaning": "The naming code used to identify which beams in the roof elements are the hip beams. This acts as a filter to select only the relevant structural members for processing.",
            "validRange": "Any text string matching the project's beam naming standards (e.g., 'HIP', 'HK').",
            "unit": "String",
            "affectsOutput": "Determines which beams are modified. If the code does not match any beams in the selection, the script does nothing."
          },
          {
            "name": "dOvershootLength",
            "technicalDefault": "200",
            "businessMeaning": "The distance the hip beam extends past the edge of the lower element into the upper element. This ensures a physical overlap or 'tenon' effect between the segments.",
            "validRange": "50mm to 500mm",
            "unit": "mm",
            "affectsOutput": "Controls the length of the beam extension. A longer value increases the overlap between joined beam segments."
          },
          {
            "name": "sSquareOff",
            "technicalDefault": "|Yes|",
            "businessMeaning": "Determines whether the end of the top-most hip beam (closest to the ridge) is cut perpendicular to its length (square) or left as is.",
            "validRange": "Yes/No",
            "unit": "Boolean",
            "affectsOutput": "If 'Yes', a perpendicular saw cut is applied to the top end of the hip assembly. If 'No', the top end is not modified by this specific operation."
          },
          {
            "name": "dOffsetCutTop",
            "technicalDefault": "20",
            "businessMeaning": "The offset distance from the calculated top reference point where the square cut is applied. This allows for a gap or specific positioning relative to the ridge geometry.",
            "validRange": "0mm to 100mm",
            "unit": "mm",
            "affectsOutput": "Shifts the position of the square cut along the beam axis at the ridge end."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sSquareOff is set to |No|",
            "effect": "dOffsetCutTop is ignored.",
            "cascade": [
              "dOffsetCutTop"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Cut",
            "description": "Static saw cuts are added to extend the hip beams over element boundaries and optionally to square off the ridge end.",
            "appliedTo": "Beams matching the 'Beamcode hip' within the selected roof elements."
          }
        ]
      },
      "tokens_used": 7503,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization (Load properties)",
          "2. Check Insertion Cycle (Exit if > 1 to prevent double execution)",
          "3. Evaluate Catalog Key/Execute Key",
          "4. [Conditional] Show Properties Dialog (if no valid key found)",
          "5. Prompt User to Select Roof Elements (PrEntity)",
          "6. Validate Element Selection Count (Exit if < 1)",
          "7. Iterate Elements to Find Hip Beams (Filter by Beamcode property)",
          "8. Calculate Element Bounding Boxes (Extremes)",
          "9. Group Aligned Hip Beams (Check vector and positional alignment)",
          "10. Sort Hip Group along Main Axis",
          "11. Loop through Hip Group to generate overlaps",
          "12. Calculate Intersection Points at Element Boundaries",
          "13. Apply Extension Cuts (AddToolStatic with Overshoot Length)",
          "14. [Conditional] Apply Square Off Cut at Ridge (if enabled)",
          "15. Mark Beams as Processed",
          "16. Erase Script Instance (Finish)"
        ],
        "conditionalBranches": [
          {
            "condition": "Catalog Key Validity on Insert",
            "path1": {
              "name": "Catalog Key Valid",
              "steps": [
                "Load properties from catalog",
                "Skip dialog display",
                "Proceed to element selection"
              ]
            },
            "path2": {
              "name": "No/Invalid Catalog Key",
              "steps": [
                "Display warning if key was invalid",
                "Show Properties Dialog (showDialog)",
                "User inputs parameters manually",
                "Proceed to element selection"
              ]
            }
          },
          {
            "condition": "Square Off at Ridge (sSquareOff)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Identify last beam in hip chain (closest to ridge)",
                "Calculate cut point using Offset Cut Top property",
                "Apply perpendicular cut"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skip ridge cutting operation",
                "Preserve existing geometry at top end"
              ]
            }
          },
          {
            "condition": "Beam Alignment Check",
            "path1": {
              "name": "Aligned",
              "steps": [
                "Beam added to processing group (arBmThisHip)",
                "Included in overlap calculations"
              ]
            },
            "path2": {
              "name": "Misaligned",
              "steps": [
                "Beam ignored for this specific hip chain",
                "Script processes only the first continuous chain found"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Minimum Elements Selected",
            "errorMessage": "There is at least one elements required!",
            "recovery": "User must re-run script and select at least one roof element."
          },
          {
            "check": "Element Bounding Box Calculation",
            "errorMessage": "Extremes of element not found!",
            "recovery": "Ensure selected elements contain valid geometry (non-hip beams) to calculate bounds."
          },
          {
            "check": "Hip Beam Reference Point",
            "errorMessage": "Reference point not found!",
            "recovery": "Ensure hip beam geometry is valid and intersects with element context properly."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry",
            "how": "N/A (Script instance self-destructs)",
            "effect": "Cuts are applied statically to the beams. The script instance is erased immediately after execution."
          },
          {
            "action": "Update Parameters",
            "how": "Re-insertion required",
            "effect": "User must run the script again to change parameters or select different elements."
          }
        ]
      },
      "tokens_used": 8012,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_R-HipConnection.mcr\n\n## Overview\nThis script automates the connection of timber hip beams across multiple roof elements. It extends hip beams from lower elements over upper elements to create a physical overlap and optionally squares off the beam end at the ridge.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in 3D Model Space. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: Roof Elements (`ElementRoof`) containing Beams.\n- **Minimum Selection**: At least 1 Roof Element (typically multiple elements are required to see the connection effect).\n- **Identification**: Beams must be identifiable by a specific Beam Code (e.g., \"HK-01\") to be processed as hip beams.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_R-HipConnection.mcr`\n\n### Step 2: Configure Parameters (Optional)\nBefore selecting elements, you can adjust settings in the **Properties Palette** (usually on the right side of the screen) if a catalog preset is not used automatically.\n- Set the **Beamcode hip** to match the naming convention used in your project.\n- Adjust **Overshoot length** and **Ridge connection** settings as desired.\n\n### Step 3: Select Roof Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the roof elements containing the hip beams you wish to connect. Press Enter to confirm selection.\n```\n*Note: The script will automatically detect the hip beams based on the code, calculate the overlaps, and apply cuts. The script instance will then delete itself.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Beamcode hip** | Text | HK-01 | The filter code used to identify which beams in the roof elements are hip beams. Only beams with this code will be modified. |\n| **Overshoot length** | Number | 200 | The distance (in mm) the hip beam extends past the edge of the lower element into the upper element to create an overlap. |\n| **Square off at ridge** | Dropdown | Yes | Determines if the end of the top-most hip beam (near the ridge) is cut perpendicular to its length. |\n| **Offset cut at ridge** | Number | 20 | The offset distance (in mm) from the reference point where the square cut is applied at the ridge. Only active if \"Square off at ridge\" is Yes. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | The script executes immediately upon selection and erases itself. There are no persistent right-click options for the script instance. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on local TSL Properties rather than external XML settings files.\n\n## Tips\n- **Beam Alignment**: Ensure the hip beams in different elements are geometrically aligned (same vector direction and vertical position). The script groups beams based on this alignment.\n- **Verification**: After running, check that the hip beams physically overlap at the element boundaries.\n- **Chain Logic**: The script sorts the beams along their axis. Ensure your elements are ordered or positioned logically so the script can determine which is the \"lower\" and which is the \"upper\" element correctly.\n\n## FAQ\n- **Q: The script ran, but my beams weren't cut.**\n  A: Check the **Beamcode hip** property. It must exactly match the name or code assigned to your hip beams in the project. If the codes do not match, the script ignores the beams.\n- **Q: I got an error \"Extremes of element not found!\"**\n  A: The selected roof elements might be empty or lack valid geometry to calculate bounding boxes. Ensure you have selected valid structural elements.\n- **Q: Can I undo the changes?**\n  A: Yes, use the standard AutoCAD `UNDO` command to revert the cuts if the result is not as expected."
      },
      "tokens_used": 5459,
      "error": null
    }
  }
}