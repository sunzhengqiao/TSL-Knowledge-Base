{
  "filename": "HSB_E-RunElementTsls.mcr",
  "status": "completed",
  "total_tokens": 36214,
  "processing_time": 266.43831872940063,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": 2,\n    \"minorVersion\": 5,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"Description\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.00\",\n      \"date\": \"22-02-2018\",\n      \"author\": \"RP\",\n      \"changes\": \"Pilot version.\"\n    },\n    {\n      \"version\": \"1.01\",\n      \"date\": \"22-02-2018\",\n      \"author\": \"RP\",\n      \"changes\": \"Redo tsl with reading of xml, because when tsl is deleted afterwards, propvalues are not set from catalog\"\n    },\n    {\n      \"version\": \"1.02\",\n      \"date\": \"02-03-2018\",\n      \"author\": \"RP\",\n      \"changes\": \"Redo tsl with new dbCreate function in tsl\"\n    },\n    {\n      \"version\": \"1.03\",\n      \"date\": \"17-05-2018\",\n      \"author\": \"RP\",\n"
      },
      "tokens_used": 6967,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses 'PrEntity' to select Elements in the drawing environment, explicitly passes '_kModelSpace' as the target space argument in 'dbCreate', and lacks 'sd_' prefix, Viewport interactions, or '#Type E' detection typical of ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "RunElementTslsConfigurations.xml (created automatically if missing)",
            "HSB_G-FilterEntities TSL must be loaded for filtering logic"
          ]
        }
      },
      "tokens_used": 5701,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select element(s)|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "Insertion (_bOnInsert) if _kExecuteKey is empty",
            "title": "Properties",
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "setName",
            "type": "PropString",
            "displayName": "|Configuration set|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": "Dynamically populated from RunElementTslsConfigurations.xml (Map Names)",
            "category": null,
            "description": "|The configuration set that will be executed|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Execute Key (Catalog Name)",
            "handler": "_kExecuteKey",
            "action": "Runs the configuration set matching the catalog name passed via _kExecuteKey",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "RunElementTslsConfigurations.xml",
            "searchPaths": [
              "_kPathHsbCompany\\Tsl\\Settings\\RunElementTslsConfigurations.xml"
            ],
            "purpose": "Stores configuration sets containing mappings of TSL scripts to elements, including filters and catalogs.",
            "required": true
          }
        ]
      },
      "tokens_used": 4671,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A batch processing script that runs multiple configuration-specific TSL scripts on selected Elements based on a recipe defined in an external XML file.",
          "category": "Automation / Batch Processing",
          "typicalUseCase": "Applying a standard set of manufacturing details (like labels, wall connections, and sheathing) to an entire Element (wall/floor) with a single operation."
        },
        "parameters": [
          {
            "name": "setName",
            "technicalDefault": "null (Populated from XML)",
            "businessMeaning": "The name of the configuration set (recipe) to execute. Each set contains a list of specific construction scripts (TSLs) and the filtering logic required to apply them to the correct parts of the selected element.",
            "validRange": "List of Map Names defined in RunElementTslsConfigurations.xml (e.g., 'RoofFinish', 'WallStandard')",
            "unit": "String",
            "affectsOutput": "Determines which sub-scripts are launched (e.g., numbering, machining) and which specific sub-elements (beams/sheets) within the main Element are processed."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Selection of 'setName'",
            "effect": "Reads the specific map entry in 'RunElementTslsConfigurations.xml' to determine the list of TSLs to run and the catalogs to use for filtering and settings.",
            "cascade": [
              "Target TSLs (determined by 'TslName' in XML)",
              "Filter Catalogs (determined by 'FilterCatalog' in XML)",
              "Parameter Catalogs (determined by 'TslCatalog' in XML)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TSL Instances (Meta-Output)",
            "description": "The script dynamically creates instances of other TSL scripts (defined in the XML) attached to the filtered entities within the selected Element. These sub-scripts then generate the actual geometry, machining, or data.",
            "appliedTo": "Sub-components (Beams/Sheets) of the selected Element(s) that match the criteria defined in the XML configuration."
          }
        ]
      },
      "tokens_used": 6015,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts and reads 'RunElementTslsConfigurations.xml' to populate 'setName' property options.",
          "Check if running in Insertion Mode (_bOnInsert).",
          "[Path A: Insertion Mode] Check if insertCycleCount > 1. If yes, erase instance and exit.",
          "[Path A: Insertion Mode] Check for _kExecuteKey (Catalog Name execution).",
          "[Path A: Insertion Mode] If Key exists: Lookup catalog. If valid, load properties; else fallback to '_LastInserted'.",
          "[Path A: Insertion Mode] If Key missing: Show Properties Dialog (showDialog) and save selection.",
          "[Path A: Insertion Mode] Prompt user for Element selection (PrEntity).",
          "[Path A: Insertion Mode] Loop through selected Elements: Spawn a new instance of self in ModelSpace (dbCreate) for each element, passing the Configuration Name.",
          "[Path A: Insertion Mode] Erase the original (controller) instance and exit.",
          "[Path B: Execution/OnDbCreated Mode] Validate attached Element exists. If not, erase and exit.",
          "[Path B: Execution/OnDbCreated Mode] Verify XML configuration file exists. If missing, create default folder structure and 'Example' XML.",
          "[Path B: Execution/OnDbCreated Mode] Load the specific Map configuration set defined by the 'setName' property.",
          "[Path B: Execution/OnDbCreated Mode] Iterate through each TSL entry defined in the set.",
          "[Path B: Execution/OnDbCreated Mode] Filter Entities: Call 'HSB_G-FilterEntities' for the current Element using the catalogs defined in the XML.",
          "[Path B: Execution/OnDbCreated Mode] If filtering fails, report warning, erase instance, and stop.",
          "[Path B: Execution/OnDbCreated Mode] Iterate through successfully filtered entities.",
          "[Path B: Execution/OnDbCreated Mode] For each filtered entity, execute the target TSL (dbCreate) specified in the XML.",
          "[Path B: Execution/OnDbCreated Mode] Erase self and finish."
        ],
        "conditionalBranches": [
          {
            "condition": "Script Trigger Method (Insertion vs. Event)",
            "path1": {
              "name": "Manual Insertion / Catalog Key",
              "steps": [
                "Detects _bOnInsert == true",
                "Handles User Input (Dialog or Key)",
                "Selects Elements",
                "Spawns 'Worker' instances via dbCreate",
                "Erases self"
              ]
            },
            "path2": {
              "name": "OnDbCreated Event (Worker)",
              "steps": [
                "Detects _bOnInsert == false",
                "Reads XML Configurations",
                "Applies Filters to Element",
                "Executes Sub-TSLs",
                "Erases self"
              ]
            }
          },
          {
            "condition": "Catalog Key Lookup during Insertion",
            "path1": {
              "name": "Key Found",
              "steps": [
                "Execute 'setPropValuesFromCatalog' using the passed key name"
              ]
            },
            "path2": {
              "name": "Key Not Found",
              "steps": [
                "Execute 'setPropValuesFromCatalog' using fallback name '_LastInserted'"
              ]
            }
          },
          {
            "condition": "Configuration File Existence",
            "path1": {
              "name": "File Exists",
              "steps": [
                "Read existing settings from 'RunElementTslsConfigurations.xml'"
              ]
            },
            "path2": {
              "name": "File Missing",
              "steps": [
                "Attempt to create settings folder",
                "Write default 'Example' configuration map to XML",
                "Display Notice"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Check if insertCycleCount > 1",
            "errorMessage": "None (Silent exit)",
            "recovery": "N/A - Prevents recursive execution loops."
          },
          {
            "check": "Check if _Element.length() < 1",
            "errorMessage": "ScriptName: Invalid element.",
            "recovery": "Select a valid element when running the script."
          },
          {
            "check": "Check if Configuration Folder exists during file creation",
            "errorMessage": "Folder does not exist. [Path]",
            "recovery": "Manually verify write permissions or folder structure in the company path."
          },
          {
            "check": "Check if Configuration XML file exists after initial checks",
            "errorMessage": "ScriptName: Configuration file not found.",
            "recovery": "Ensure 'RunElementTslsConfigurations.xml' is present in the Tsl\\Settings folder or allow the script to recreate it."
          },
          {
            "check": "Check result of Filter Logic (TslInst().callMapIO)",
            "errorMessage": "Beams could not be filtered! Make sure that the tsl 'HSB_G-FilterEntities' is loaded in the drawing.",
            "recovery": "Load 'HSB_G-FilterEntities' TSL into the drawing and ensure filter catalogs are valid."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None - Script is Transient",
            "how": "N/A",
            "effect": "The script calls 'eraseInstance()' at the end of both Insertion and Execution phases. No instance remains in the drawing to be edited via OPM or grips. Changes must be made by re-running the script or editing the resulting sub-TSLs."
          }
        ]
      },
      "tokens_used": 7503,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-RunElementTsls\n\n## Overview\nThis is a batch processing script that runs multiple TSL scripts on selected Elements based on a recipe defined in an external XML file. It allows you to apply complex sets of manufacturing details (like labels, wall connections, and sheathing) to an entire Element (wall/floor) in a single operation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on Elements within the model. |\n| Paper Space | No | Not designed for 2D layouts. |\n| Shop Drawing | No | Not designed for detailing views. |\n\n## Prerequisites\n- **Required Entities**: Element (Wall or Floor).\n- **Minimum Beam Count**: N/A (Elements are selected, not individual beams).\n- **Required Settings Files**:\n    - `RunElementTslsConfigurations.xml` (Created automatically if missing).\n    - `HSB_G-FilterEntities` TSL must be loaded in the drawing for filtering logic to work.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_E-RunElementTsls.mcr` from the list.\n\n### Step 2: Select Configuration Set\n```\nCommand Line: |Select element(s)|\nProperties Panel/Dialog: Select a \"Configuration set\" (e.g., 'RoofFinish', 'WallStandard').\nAction: Choose the recipe you want to apply to the element from the dropdown list in the Properties Palette or the pop-up dialog.\n```\n\n### Step 3: Select Elements\n```\nCommand Line: |Select element(s)|\nAction: Click on the Element(s) (Walls/Floors) in the drawing you wish to process and press Enter.\n```\n\n### Step 4: Execution\nThe script will automatically process the selected elements, spawning the necessary sub-scripts defined in your configuration. The script instance will then erase itself from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Configuration set | dropdown | (First entry in XML) | The name of the configuration set (recipe) to execute. Each set contains a list of specific construction scripts and the filtering logic required to apply them. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Execute Key (Catalog Name) | Runs the configuration set matching a specific catalog name passed via an external key (often used in automated workflows). |\n\n## Settings Files\n- **Filename**: `RunElementTslsConfigurations.xml`\n- **Location**: `_kPathHsbCompany\\Tsl\\Settings\\` (Your company folder)\n- **Purpose**: Stores configuration sets (Maps) containing mappings of TSL scripts to elements, including which filters and catalogs to use.\n\n## Tips\n- **Transient Script**: This script deletes itself automatically after running. To change settings, you must re-insert the script; you cannot double-click it later to edit.\n- **Missing File**: If the XML file is missing, the script will attempt to create a default folder structure and an \"Example\" XML file for you to configure.\n- **Filter Errors**: If you see a warning about \"Beams could not be filtered,\" ensure the `HSB_G-FilterEntities` TSL is loaded in your drawing.\n\n## FAQ\n- **Q: Why did the script disappear after I ran it?**\n  - A: This is a \"transient\" script designed to perform a batch task and then remove itself to keep the drawing clean. To apply different settings, simply run the script again.\n- **Q: What happens if my configuration file is missing?**\n  - A: The script will try to generate a default \"Example\" configuration XML in your company settings folder. You can edit this file to define your own recipes.\n- **Q: I got an error \"Beams could not be filtered\".**\n  - A: Ensure the TSL named `HSB_G-FilterEntities` is loaded in your drawing. This script relies on it to select the correct beams within the Element."
      },
      "tokens_used": 5357,
      "error": null
    }
  }
}