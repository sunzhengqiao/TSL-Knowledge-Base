{
  "filename": "hsb_A4 Layout.mcr",
  "status": "completed",
  "total_tokens": 57880,
  "processing_time": 238.9538128376007,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9637,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "Found explicit property 'Drawing space' (sSpace) with options '|paper space|' and '|shopdraw multipage|'. The script uses matrix transformations 'transformBy(ms2ps)' to convert model coordinates to paper space for drawing dimensions and text, and 'transformBy(ps2ms)' to convert vectors back."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Paper Space Layout or Shopdraw Multipage environment",
          "requiredSettings": [
            "_DimStyles"
          ]
        }
      },
      "tokens_used": 7615,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 22,\n      \"variable\": \"sSpace\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Drawing space\",\n      \"defaultValue\": \"|paper space|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|paper space|\",\n        \"|shopdraw multipage|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"strShowDim\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Show Left Dimension List\",\n      \"defaultValue\": \"None\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Start\",\n        \"End\",\n        \"Center\",\n        \"None\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"dTextY\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"List Spacing\",\n      \"defaultValue\": \"U(5, 0.2)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dDistList\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"X Offset for List\",\n      \"defaultValue\": \"U(300, 12)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dDistListY\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Y Offset for List\",\n      \"defaultValue\": \"U(0, 0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"nColumn\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"Number of Items per column\",\n      \"defaultValue\": 20,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sDimLayout\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Dim Style\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": \"_DimStyles\",\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 25,\n      \"variable\": \"sDimStyleStuds\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Dim Style Studs Only\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": \"_DimStyles\",\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"dFactor\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Timber density (kg/m3)\",\n      \"defaultValue\": 450,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 28,\n      \"variable\": \"sYesNoHeadBinder\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Dimensions Include Headbinder\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Allow you to show or hide the length og the blocking pieces\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"strShowDimBot\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Show Bottom Dimension\",\n      \"defaultValue\": \"None\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Start\",\n        \"End\",\n        \"Center\",\n        \"None\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 42,\n      \"variable\": \"strLeftRightDimBot\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Bottom Dimension From\",\n      \"defaultValue\": \"Left Side\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Left Side\",\n        \"Right Side\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 31,\n      \"variable\": \"sMode\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Show as\",\n      \"defaultValue\": \"Line and Text\",\n     "
      },
      "tokens_used": 10336,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates automated 2D production drawings for timber wall panels in Paper Space, creating detailed dimension lists, running dimensions, and labels.",
          "category": "ShopDrawing",
          "typicalUseCase": "Automating the creation of wall panel fabrication drawings, specifically for listing stud locations and annotating member dimensions."
        },
        "parameters": [
          {
            "name": "sSpace",
            "technicalDefault": "\"|paper space|\"",
            "businessMeaning": "Specifies the target drawing environment.",
            "validRange": "[\"|paper space|\", \"|shopdraw multipage|\"]",
            "unit": "enum",
            "affectsOutput": "Determines if the script generates geometry in the current AutoCAD layout or within the hsbCAD multipage generation module."
          },
          {
            "name": "strShowDim",
            "technicalDefault": "\"None\"",
            "businessMeaning": "Controls whether a vertical list of running dimensions (Y-axis coordinates) is generated for the left side of the panel.",
            "validRange": "[\"Start\", \"End\", \"Center\", \"None\"]",
            "unit": "enum",
            "affectsOutput": "Creates a coordinate list starting from the wall Start, End, or Center. If 'None', no list is drawn."
          },
          {
            "name": "dTextY",
            "technicalDefault": "U(5, 0.2)",
            "businessMeaning": "The vertical line spacing (height) for rows of text in the dimension list.",
            "validRange": "3.0 to 10.0 (mm)",
            "unit": "mm/inches",
            "affectsOutput": "Adjusts the density of the text list to prevent overlapping or to save space."
          },
          {
            "name": "dDistList",
            "technicalDefault": "U(300, 12)",
            "businessMeaning": "The horizontal distance (X-offset) between the panel origin and the dimension list.",
            "validRange": "100 to 600 (mm)",
            "unit": "mm/inches",
            "affectsOutput": "Moves the list of dimensions left or right to clear the panel drawing."
          },
          {
            "name": "dDistListY",
            "technicalDefault": "U(0, 0)",
            "businessMeaning": "The vertical offset (Y-shift) for the start of the dimension list.",
            "validRange": "-1000 to 1000 (mm)",
            "unit": "mm/inches",
            "affectsOutput": "Shifts the entire list up or down to align with title blocks or avoid other annotations."
          },
          {
            "name": "nColumn",
            "technicalDefault": "20",
            "businessMeaning": "The maximum number of items displayed in a single column before wrapping to a new column.",
            "validRange": "5 to 50",
            "unit": "count",
            "affectsOutput": "Controls the width of the list area; lower values create wider blocks of text."
          },
          {
            "name": "sDimLayout",
            "technicalDefault": "null",
            "businessMeaning": "The AutoCAD Dimension Style applied to general layout dimensions (e.g., overall widths, heights).",
            "validRange": "Standard AutoCAD DimStyles",
            "unit": "string",
            "affectsOutput": "Controls arrow style, text size, and precision for main dimensions."
          },
          {
            "name": "sDimStyleStuds",
            "technicalDefault": "null",
            "businessMeaning": "The AutoCAD Dimension Style specifically applied to stud/beam running dimensions.",
            "validRange": "Standard AutoCAD DimStyles",
            "unit": "string",
            "affectsOutput": "Allows stud lists to have a different appearance (e.g., smaller text) than main dimensions."
          },
          {
            "name": "dFactor",
            "technicalDefault": "450",
            "businessMeaning": "Density of the timber material used to calculate the total weight of the panel.",
            "validRange": "350 to 700 (kg/m³)",
            "unit": "kg/m³",
            "affectsOutput": "Updates the displayed weight label on the drawing based on calculated volume."
          },
          {
            "name": "sYesNoHeadBinder",
            "technicalDefault": "\"No\"",
            "businessMeaning": "Determines if blocking/headbinder pieces are included in the calculation of overall or diagonal dimensions.",
            "validRange": "[\"No\", \"Yes\"]",
            "unit": "enum",
            "affectsOutput": "If 'Yes', dimensions span the full frame including binders; if 'No', they may cover only the main wall outline."
          },
          {
            "name": "strShowDimBot",
            "technicalDefault": "\"None\"",
            "businessMeaning": "Controls the display of horizontal running dimensions along the bottom of the panel.",
            "validRange": "[\"Start\", \"End\", \"Center\", \"None\"]",
            "unit": "enum",
            "affectsOutput": "Draws dimension lines along the bottom showing the location of studs/jacks from the Left, Right, or Center."
          },
          {
            "name": "strLeftRightDimBot",
            "technicalDefault": "\"Left Side\"",
            "businessMeaning": "Sets the origin reference for the bottom horizontal running dimensions.",
            "validRange": "[\"Left Side\", \"Right Side\"]",
            "unit": "enum",
            "affectsOutput": "Switches the zero-point of the bottom dimension chain between the left and right ends of the wall."
          },
          {
            "name": "sMode",
            "technicalDefault": "\"Line and Text\"",
            "businessMeaning": "Selects the graphical representation style for running dimensions.",
            "validRange": "[\"Line and Text\", \"Dimension Line - Running\", \"Dimension Line - Delta\"]",
            "unit": "enum",
            "affectsOutput": "Toggles between a simple text list, a standard chain dimension, or delta-style individual dimensions."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "strShowDim is 'None'",
            "effect": "List formatting parameters are ignored as no list is generated.",
            "cascade": [
              "dTextY",
              "dDistList",
              "dDistListY",
              "nColumn"
            ]
          },
          {
            "trigger": "strShowDimBot is 'None'",
            "effect": "The origin reference parameter becomes irrelevant.",
            "cascade": [
              "strLeftRightDimBot"
            ]
          },
          {
            "trigger": "sMode is 'Line and Text'",
            "effect": "The script generates text entities instead of graphical dimension lines for running dims.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Dimension",
            "description": "AutoCAD dimension objects representing member positions and overall sizes.",
            "appliedTo": "Paper Space View"
          },
          {
            "type": "Text",
            "description": "Text entities listing coordinate positions, material weights, and labels.",
            "appliedTo": "Paper Space Layout"
          },
          {
            "type": "Polyline",
            "description": "Optional outline representations of angled plates or specific framing members.",
            "appliedTo": "Paper Space Layout"
          }
        ]
      },
      "tokens_used": 10302,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: User inserts script or invokes via shopdraw generation.",
          "2. Entity Selection: User selects the target Wall Element (if not pre-selected).",
          "3. Base Point Definition: User places the script origin, or it defaults to element origin.",
          "4. Coordinate System Setup: Script retrieves Paper Space transformation matrices (ms2ps).",
          "5. Property Reading: Script reads all OPM properties (Dim styles, Offsets, Visibility flags).",
          "6. Geometry Analysis: Script iterates through Element beams to identify studs, jacks, plates, and angled components.",
          "7. Left Dimension List Generation: [Conditional] Calculates vertical coordinates and draws text or dimension lines.",
          "8. Bottom Dimension Generation: [Conditional] Calculates horizontal running dimensions based on selected origin.",
          "9. Component Annotation: [Conditional] Dimensions angled plates and specific context beams.",
          "10. Drawing Output: Entities (Dims, Text, Polylines) are drawn in Paper Space."
        ],
        "conditionalBranches": [
          {
            "condition": "Property 'Drawing space' (sSpace)",
            "path1": {
              "name": "Paper Space",
              "steps": [
                "Script uses current viewport transformation matrix.",
                "Geometry is projected directly to the active layout."
              ]
            },
            "path2": {
              "name": "Shopdraw Multipage",
              "steps": [
                "Script coordinates with hsbCAD multipage generator.",
                "Output is placed on the generated sheet layout."
              ]
            }
          },
          {
            "condition": "Property 'Show Left Dimension List' (strShowDim)",
            "path1": {
              "name": "None",
              "steps": [
                "Skip vertical coordinate calculation.",
                "List formatting properties (TextY, Column) are ignored."
              ]
            },
            "path2": {
              "name": "Start / End / Center",
              "steps": [
                "Calculate Y-axis distances from selected reference point.",
                "Apply column wrapping based on 'Number of Items per column'.",
                "Generate entities based on 'Show as' (sMode) property."
              ]
            }
          },
          {
            "condition": "Property 'Show as' (sMode)",
            "path1": {
              "name": "Line and Text",
              "steps": [
                "Draw simple text entities for coordinates.",
                "Draw polylines connecting text to geometry."
              ]
            },
            "path2": {
              "name": "Dimension Line (Running/Delta)",
              "steps": [
                "Create AutoCAD Dimension objects.",
                "Apply specified DimStyle (Standard or Studs Only)."
              ]
            }
          },
          {
            "condition": "Property 'Show Bottom Dimension' (strShowDimBot)",
            "path1": {
              "name": "None",
              "steps": [
                "Skip horizontal dimension generation."
              ]
            },
            "path2": {
              "name": "Start / End / Center",
              "steps": [
                "Filter relevant beams (studs/jacks) for bottom dimensioning.",
                "Determine zero-point based on 'Bottom Dimension From' (Left/Right).",
                "Draw running dimensions."
              ]
            }
          },
          {
            "condition": "Angled Plate Detection (nYesNoAngle)",
            "path1": {
              "name": "Disabled",
              "steps": [
                "Ignore beams of type _kSFAngledTPLeft and _kSFAngledTPRight."
              ]
            },
            "path2": {
              "name": "Enabled",
              "steps": [
                "Identify angled top plate beams.",
                "Calculate normal vectors for dimension placement.",
                "Draw individual delta dimensions for angled sections."
              ]
            }
          },
          {
            "condition": "Beam Context Dimensions (nYesNoBm)",
            "path1": {
              "name": "None (0)",
              "steps": [
                "Do not dimension beams contacting angle plates."
              ]
            },
            "path2": {
              "name": "Dimension (1)",
              "steps": [
                "Identify beams with T-connection to angle plates.",
                "Draw length dimension using Delta style."
              ]
            },
            "path3": {
              "name": "Text (2)",
              "steps": [
                "Identify beams with T-connection to angle plates.",
                "Draw text label containing beam length in parentheses."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Existence",
            "errorMessage": "No Element attached.",
            "recovery": "Select a valid Wall Element and re-run or update script reference."
          },
          {
            "check": "Model-to-Paper Space Transform",
            "errorMessage": "Invalid Viewport or Transform Matrix.",
            "recovery": "Ensure script is executed in a valid Paper Space Layout with an active viewport showing the element."
          },
          {
            "check": "Dimension Style Existence",
            "errorMessage": "Selected DimStyle not found in drawing.",
            "recovery": "Change 'Dim Style' property to a style existing in the current drawing template."
          },
          {
            "check": "Geometric Validity",
            "errorMessage": "Insufficient geometry to dimension.",
            "recovery": "Check that the wall has valid studs/plates; if 'None' is selected for all lists, no output is generated by design."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Layout Properties",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changes text size, offsets, visibility of dimension lists, and dimension styles."
          },
          {
            "action": "Move Script Origin",
            "how": "Grip Edit / Move Command",
            "effect": "Relocates the entire set of dimensions and text relative to the drawing border."
          },
          {
            "action": "Model Geometry Update",
            "how": "Modify Wall Element in Model Space",
            "effect": "Script recalculates dimensions to reflect new wall height, stud positions, or openings."
          }
        ]
      },
      "tokens_used": 11960,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_A4 Layout.mcr\n\n## Overview\nThis script automates the creation of 2D production drawings for timber wall panels directly in Paper Space. It generates detailed vertical stud lists, horizontal running dimensions, and weight labels, transforming 3D model data into a clean layout suitable for A4 plotting or shop drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | The script generates output in Paper Space. |\n| Paper Space | Yes | Primary mode. Requires a Layout tab with an active viewport of the wall. |\n| Shop Drawing | Yes | Can be used within the hsbCAD Multipage generation workflow. |\n\n## Prerequisites\n- **Required Entities**: A single Wall Element (Element).\n- **Required Context**: You must be on an AutoCAD Layout tab (Paper Space) with a viewport displaying the element.\n- **Required Settings**: Valid AutoCAD Dimension Styles must exist in the drawing to be selected in the properties.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or select from hsbCAD Script Menu)\nAction: Browse and select `hsb_A4 Layout.mcr`.\n\n### Step 2: Select Wall Element\n```\nCommand Line: Select Element:\nAction: Click on the desired Wall Element in Model Space or through the viewport.\n```\n\n### Step 3: Set Origin Point\n```\nCommand Line: Insertion point:\nAction: Click in Paper Space to define the bottom-left origin for the dimension list and layout.\n```\n*Note: This point determines where the text lists start relative to your drawing border.*\n\n### Step 4: Adjust Output\nAction: Select the inserted script object and open the **Properties Palette** (Ctrl+1). Adjust the \"Drawing space\", \"Show Left Dimension List\", or offsets to fit your title block.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Drawing space** | dropdown | \\|paper space\\| | Sets the output environment. Choose \"\\|paper space\\|\" for manual insertion or \"\\|shopdraw multipage\\|\" for automated batch generation. |\n| **Show Left Dimension List** | dropdown | None | Controls the vertical list of stud positions. Options: Start, End, Center, or None. |\n| **List Spacing** | number | U(5, 0.2) | The vertical height between lines of text in the dimension list (mm/inches). |\n| **X Offset for List** | number | U(300, 12) | Horizontal distance from the script origin to the start of the text list. |\n| **Y Offset for List** | number | U(0, 0) | Vertical shift for the start of the text list. Use this to align lists with title blocks. |\n| **Number of Items per column** | integer | 20 | How many studs are listed before the text wraps to a new column. |\n| **Dim Style** | dropdown | *Varies* | Select the AutoCAD Dimension Style to use for general layout dimensions (e.g., overall height). |\n| **Dim Style Studs Only** | dropdown | *Varies* | Select the AutoCAD Dimension Style specifically for the stud running dimensions. |\n| **Timber density (kg/m3)** | number | 450 | Material density used to calculate the total weight displayed on the drawing. |\n| **Dimensions Include Headbinder** | dropdown | No | If \"Yes\", dimensions include the length of blocking/headbinder pieces. |\n| **Show Bottom Dimension** | dropdown | None | Displays horizontal running dimensions along the bottom plate (Start, End, Center, None). |\n| **Bottom Dimension From** | dropdown | Left Side | Sets the zero-point for bottom dimensions (Left Side or Right Side). |\n| **Show as** | dropdown | Line and Text | Selects visual style: \"Line and Text\" (simple list), \"Dimension Line - Running\" (chain dims), or \"Dimension Line - Delta\". |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Recalc** | Updates the drawing to reflect changes in the 3D model or property changes. |\n| **Move** | Relocates the origin point of the script, moving all associated dimensions and text. |\n| **Properties** | Opens the Properties Palette to adjust layout parameters. |\n\n## Settings Files\n- **DimStyles**: AutoCAD Dimension Styles\n- **Location**: Current Drawing (.dwg)\n- **Purpose**: Defines text height, arrow style, and precision for generated dimensions. Ensure desired styles exist in the template before running the script.\n\n## Tips\n- **Text Overlap**: If the vertical list overlaps with the wall drawing, increase the **X Offset for List** or switch to the Shopdraw Multipage mode if available.\n- **Long Lists**: If your wall is very tall, decrease the **Number of Items per column** to create multiple narrow columns rather than one very tall column.\n- **Dimension Clarity**: Use different DimStyles for \"Dim Style\" (Main dims) and \"Dim Style Studs Only\" (Running dims) to make main dimensions bold and stud dimensions smaller/lighter.\n- **Viewports**: Ensure the viewport scale is correct before inserting. The script calculates Paper Space coordinates based on the current view transformation.\n\n## FAQ\n- **Q: I inserted the script but nothing appears.**\n  **A:** Check the Properties Palette. If both \"Show Left Dimension List\" and \"Show Bottom Dimension\" are set to \"None\", the script will generate no visible output. Set one of them to \"Start\" or \"End\".\n\n- **Q: The dimensions are pointing to empty space.**\n  **A:** The script calculates positions based on the Model Space geometry. Ensure you selected the correct Wall Element and that the script origin point in Paper Space aligns roughly with the projection of the wall.\n\n- **Q: The weight displayed is incorrect.**\n  **A:** Verify the **Timber density** property matches your actual material (e.g., change from 450 to 500 for denser timber).\n\n- **Q: Can I use this script in Model Space?**\n  **A:** No, this script is designed specifically to annotate drawings in Paper Space (Layouts). Ensure you are on a Layout tab when inserting."
      },
      "tokens_used": 8030,
      "error": null
    }
  }
}