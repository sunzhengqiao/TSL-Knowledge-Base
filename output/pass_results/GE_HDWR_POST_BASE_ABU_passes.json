{
  "filename": "GE_HDWR_POST_BASE_ABU.mcr",
  "status": "completed",
  "total_tokens": 42886,
  "processing_time": 445.88451623916626,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.3",
            "date": "06.jul.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Renamed from GE_HDWR_ABU_POST_BASE to GE_HDWR_POST_BASE_ABU"
          },
          {
            "version": "1.2",
            "date": "31.jul.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Added description"
          },
          {
            "version": "1.1",
            "date": "31.jul.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Assigned to 'Z' zone (entity set) instead of 'T' (tooling zone - non plotable)"
          },
          {
            "version": "1.0",
            "date": "10.apr.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Release: Copied from TH_ABU_POST_BASE v0.7 (28.feb.2012, David Rueda)"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7420,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses 3D geometric primitives (Body, CoordSys), getPoint for insertion, and addToolStatic to modify beam volumes. It assigns Hardware Components via _ThisInst.setHardWrComps. No usage of _Viewport, _kPaperSpace, or sd_ prefixes indicating drawing generation."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space for 3D hardware creation and beam modification",
          "requiredSettings": []
        }
      },
      "tokens_used": 5715,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a Post or a set of Studs",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "\nSelect and insertion point",
              "condition": "_bOnInsert && _Beam.length()==0",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "showDialogOnce",
            "title": "Properties",
            "dataSource": "PropDouble/PropString instances",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strType",
            "type": "PropString",
            "displayName": "Type",
            "defaultValue": "ABU44",
            "inputType": "dropdown",
            "options": [
              "ABU44",
              "ABU46",
              "ABU66",
              "ABU88"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "strFace",
            "type": "PropString",
            "displayName": "Post Face",
            "defaultValue": "Default",
            "inputType": "dropdown",
            "options": [
              "Default",
              "Flipped"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dRotation",
            "type": "PropDouble",
            "displayName": "Free Rotation",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dElev",
            "type": "PropDouble",
            "displayName": "Elevation",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strEmbed",
            "type": "PropString",
            "displayName": "Embedment",
            "defaultValue": "Concrete",
            "inputType": "dropdown",
            "options": [
              "Concrete",
              "Masony"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5749,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts an ABU-style adjustable post base hardware assembly, automatically sizing it to fit selected post/stud dimensions or allowing manual selection.",
          "category": "Hardware",
          "typicalUseCase": "Anchoring a timber post or column to concrete or masonry foundations where a specific metal post base plate (ABU series) is required."
        },
        "parameters": [
          {
            "name": "strType",
            "technicalDefault": "ABU44",
            "businessMeaning": "The specific catalog model of the post base, which dictates the physical dimensions of the plate to match the timber size (e.g., ABU44 for 4x4 posts).",
            "validRange": "ABU44, ABU46, ABU66, ABU88",
            "unit": "Catalog Selection",
            "affectsOutput": "Determines the width, depth, and height of the base plate geometry, the position of mounting holes, and the specific part number exported to the BOM."
          },
          {
            "name": "strFace",
            "technicalDefault": "Default",
            "businessMeaning": "The orientation of the base plate relative to the post's local axes, used to align the offset 'ears' or flanges of the base correctly.",
            "validRange": "Default, Flipped",
            "unit": "Selection",
            "affectsOutput": "Rotates the hardware geometry 90 degrees around the vertical axis (Z-axis) relative to the beam's local Y-axis."
          },
          {
            "name": "dRotation",
            "technicalDefault": 0,
            "businessMeaning": "A custom rotation angle to fine-tune the alignment of the base plate if the standard 'Default' or 'Flipped' orientations are insufficient.",
            "validRange": "0 - 360",
            "unit": "Degrees",
            "affectsOutput": "Rotates the entire hardware assembly (Base, Rod, Nut) around the insertion point's Z-axis."
          },
          {
            "name": "dElev",
            "technicalDefault": 0,
            "businessMeaning": "The vertical height (Z-offset) at which the post base is installed relative to the insertion point or reference level.",
            "validRange": "0 - 48 (depending on design requirements)",
            "unit": "Inches",
            "affectsOutput": "Moves the hardware assembly and the associated cut on the post up or down vertically."
          },
          {
            "name": "strEmbed",
            "technicalDefault": "Concrete",
            "businessMeaning": "Specifies the anchoring condition, determining the required length of the threaded rod and adhesive volume.",
            "validRange": "Concrete, Masony",
            "unit": "Selection",
            "affectsOutput": "Changes the length of the threaded rod (6\" for Concrete, 12\" for Masonry) and updates the adhesive quantity in the BOM."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User selects a Post/Stud during insertion",
            "effect": "The script automatically measures the beam section. If it matches a standard size (4x4, 4x6, 6x6, 8x8), it locks the 'Type' to the corresponding ABU model and locks 'Free Rotation' to 0.",
            "cascade": [
              "strType",
              "dRotation"
            ]
          },
          {
            "trigger": "User changes 'Embedment'",
            "effect": "The length of the rod geometry updates and the BOM quantity for 'Acrylic Tie Adhesive' is recalculated.",
            "cascade": [
              "Geometry (bdRod)",
              "BOM Data"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Body (Metal Plate)",
            "description": "The ABU post base plate consisting of a flat bottom section and two vertical side flanges with bolt holes.",
            "appliedTo": "Model Space (Visualized and exported to BOM)"
          },
          {
            "type": "3D Body (Cylinder)",
            "description": "A threaded rod (J-bolt) extending downwards from the center of the base plate. Length depends on Embedment setting.",
            "appliedTo": "Model Space (Visualized and exported to BOM)"
          },
          {
            "type": "3D Body (Hexagon)",
            "description": "A hex nut representing the anchor nut located on top of the base plate.",
            "appliedTo": "Model Space (Visualized and exported to BOM)"
          },
          {
            "type": "Beam Cut/Machining",
            "description": "A saw cut at the bottom of the post to accommodate the base plate hardware (offset 1.5\" from reference).",
            "appliedTo": "Selected Beam(s)"
          },
          {
            "type": "Hardware Components (BOM)",
            "description": "Exports 4 line items: Post Base, Rod, Nut, and Acrylic Tie Adhesive.",
            "appliedTo": "BOM / Lists"
          }
        ]
      },
      "tokens_used": 7780,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch (_bOnInsert = true)",
          "Check Insert Cycle Count",
          "[Conditional] If insertCycleCount > 1, eraseInstance (skip duplicates)",
          "Prompt User: PrEntity ('Select a Post or a set of Studs')",
          "[Conditional] If selection successful (ssE.go())",
          "Iterate through selected entities",
          "[Conditional] Filter for Beams where X-axis is vertical (parallel to World Z)",
          "Append valid Beams to _Beam array",
          "[Conditional] If Beam found: Calculate elevation (dElev) based on bottom-most point relative to World Z",
          "[Conditional] If _Beam.length() == 0 (No valid beams selected)",
          "Prompt User: getPoint ('Select an insertion point')",
          "Show Properties Dialog (showDialogOnce)",
          "[End of Insertion Logic]",
          "Initialize BOM Group ('X - Hardware', 'X-Post-Bases')",
          "Establish Reference CoordSys based on insertion point or beam geometry",
          "[Conditional] If _Beam.length() > 0",
          "Set Dependency on primary Beam (_Beam[0])",
          "Retrieve Level/Group name from Beam",
          "Calculate Position and Orientation",
          "[Conditional] Determine Type Logic (Single Beam vs Multiple Beams)",
          "Single Beam: Get dimensions (Width, Height) from beam element",
          "Multiple Beams: Calculate bounding box of all vertices to determine overall Width and Depth",
          "Auto-match Hardware Type (strType) based on calculated dimensions",
          "[Conditional] If exact size match found (e.g., 4x4, 6x6)",
          "Set strType to matched model",
          "Lock strType (ReadOnly)",
          "Reset dRotation to 0",
          "Lock dRotation (ReadOnly)",
          "[Conditional] If no exact match found",
          "Iterate through hardware dimensions to find smallest fitting type",
          "Fallback to current strType setting if no fit found",
          "Calculate final Rotation (Face 'Flipped' adds 90 deg)",
          "Apply Cut to Beam(s): Vertical cut 1.5\" above reference point",
          "[End Beam Logic]",
          "Generate Geometry: Base Plate, Side Flanges, Holes, Rod, Nut",
          "Apply User Rotation and Elevation to all geometry",
          "Visualize: Draw Bodies in standard and 'Engineering Components' display reps",
          "Export Data: BOM entries (Post Base, Rod, Nut, Adhesive) to Map",
          "Assign Hardware Components (HardWrComp) to instance"
        ],
        "conditionalBranches": [
          {
            "condition": "User Input Mode during Insertion",
            "path1": {
              "name": "Beam Selected",
              "steps": [
                "User selects Beam(s) via PrEntity",
                "Script filters for vertical beams (vecX || ZW)",
                "dElev is calculated automatically from beam bottom",
                "Insertion point is projected to beam center line at elevation",
                "Hardware Type is auto-detected and locked (if standard size)",
                "Free Rotation is locked to 0 (if standard size)",
                "Beam is cut and painted (Color 3)"
              ]
            },
            "path2": {
              "name": "No Beam Selected (Free Insert)",
              "steps": [
                "User selects nothing or invalid entities",
                "Script prompts for manual insertion point (getPoint)",
                "Properties Dialog is forced open",
                "User must manually select Type, Rotation, and Elevation",
                "No beam modification occurs"
              ]
            }
          },
          {
            "condition": "Hardware Sizing Logic",
            "path1": {
              "name": "Exact Match (Standard Size)",
              "steps": [
                "Calculated beam dims match arPostTaken (e.g. 4x4)",
                "strType is set automatically (e.g. ABU44)",
                "Properties strType and dRotation become Read-Only"
              ]
            },
            "path2": {
              "name": "Non-Standard / Custom Size",
              "steps": [
                "Beam dims do not match standard list",
                "Script iterates to find smallest hardware that fits beam",
                "strType defaults to current selection if no fit",
                "Properties remain editable by user"
              ]
            }
          },
          {
            "condition": "Embedment Selection",
            "path1": {
              "name": "Concrete",
              "steps": [
                "Rod Length set to 6\"",
                "BOM Rod Part: RFB#5x10",
                "BOM Adhesive Qty: 6"
              ]
            },
            "path2": {
              "name": "Masonry",
              "steps": [
                "Rod Length set to 12\"",
                "BOM Rod Part: RFB#5x16",
                "BOM Adhesive Qty: 12"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Orientation",
            "errorMessage": "None (Silent skip)",
            "recovery": "The script silently ignores beams where vecX is not parallel to World Z (vertical). User must select a vertical post."
          },
          {
            "check": "Insertion Cycle",
            "errorMessage": "None",
            "recovery": "Script erases itself if insertCycleCount > 1 to prevent duplicate instances during same command execution."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Hardware Type",
            "how": "OPM (Object Properties Palette) dropdown 'Type'",
            "effect": "Updates geometry dimensions (Width, Depth, Height, Hole Offset) and BOM Part Number."
          },
          {
            "action": "Flip Post Face",
            "how": "OPM dropdown 'Post Face' (Default/Flipped)",
            "effect": "Rotates the base plate geometry 90 degrees around the Z-axis relative to the beam."
          },
          {
            "action": "Adjust Free Rotation",
            "how": "OPM number input 'Free Rotation'",
            "effect": "Rotates the entire assembly around the insertion Z-axis. (Disabled if auto-sized to a standard post)."
          },
          {
            "action": "Change Elevation",
            "how": "OPM number input 'Elevation'",
            "effect": "Moves the hardware assembly up/down along the Z-axis. The associated beam cut remains at the calculated intersection point logic."
          },
          {
            "action": "Change Embedment",
            "how": "OPM dropdown 'Embedment' (Concrete/Masonry)",
            "effect": "Changes rod length geometry and updates BOM quantities for Rod and Adhesive."
          }
        ]
      },
      "tokens_used": 8662,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_POST_BASE_ABU.mcr\n\n## Overview\nInserts an ABU-style adjustable post base hardware assembly, automatically sizing it to fit selected post/stud dimensions or allowing manual selection for free placement.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for 3D hardware creation and beam modification. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- A **GenBeam** (Post or Stud) must exist in the model.\n- The beam must be vertical (X-axis parallel to World Z) for automatic detection.\n- Script must be run in Model Space.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_HDWR_POST_BASE_ABU.mcr`\n\n### Step 2: Select Post or Studs\n```\nCommand Line: Select a Post or a set of Studs\nAction: Click on a vertical post or select multiple studs.\n```\n*Note:* If a beam is selected, the script automatically detects its size and sets the hardware properties. If no beam is selected (or invalid selection), skip to Step 3.\n\n### Step 3: Define Insertion Point (If no beam selected)\n```\nCommand Line: Select an insertion point\nAction: Click anywhere in Model Space to place the hardware freely.\n```\n*Note:* The Properties Dialog will appear to allow manual configuration of Type and dimensions.\n\n### Step 4: Configure Properties\nAction: Adjust settings in the Dynamic Dialog or Properties Palette (OPM) as needed.\n- If a beam was selected, verify the auto-detected \"Type\".\n- Select \"Embedment\" type (Concrete vs Masonry) to set rod length.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | dropdown | ABU44 | Selects the hardware model size (e.g., ABU44 for 4x4 posts). Auto-locked if a matching beam size is detected. |\n| Post Face | dropdown | Default | Sets the orientation of the base plate relative to the post. \"Flipped\" rotates the plate 90 degrees. |\n| Free Rotation | number | 0 | Fine-tunes the rotation angle of the assembly (0-360 degrees). Locked if a standard beam size is auto-detected. |\n| Elevation | number | 0 | Vertical offset (Z-height) in inches relative to the insertion point or beam bottom. |\n| Embedment | dropdown | Concrete | Selects anchoring condition. \"Concrete\" uses a 6\" rod; \"Masony\" uses a 12\" rod. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | No specific context menu items are defined for this script. |\n\n## Settings Files\n*   No external settings files are used by this script.\n\n## Tips\n- **Auto-Sizing:** To save time, select the post during insertion. The script will automatically find the smallest fitting hardware (e.g., ABU66 for a 6x6 post) and lock the properties.\n- **Beam Cutting:** The script automatically applies a saw cut to the bottom of the selected post to accommodate the base plate.\n- **Vertical Requirement:** Ensure your posts are drawn perfectly vertical (X-axis up). The script ignores non-vertical beams.\n- **Adhesive:** Changing the Embedment to \"Masonry\" updates the Bill of Materials (BOM) to include more acrylic adhesive and a longer rod.\n\n## FAQ\n- **Q: Why can't I change the \"Type\" or \"Free Rotation\" fields?**\n- **A:** The script automatically detected the beam size and locked these properties to ensure the hardware fits correctly. To unlock them, you may need to disconnect the script from the beam or modify the beam size.\n- **Q: How do I raise the hardware off the floor?**\n- **A:** Use the \"Elevation\" property in the Properties Palette to input the desired height in inches.\n- **Q: My post isn't getting cut.**\n- **A:** Ensure you selected the beam during insertion (Step 2). If you inserted the hardware freely using a point (Step 3), it does not associate with a beam and therefore cannot cut it."
      },
      "tokens_used": 7560,
      "error": null
    }
  }
}