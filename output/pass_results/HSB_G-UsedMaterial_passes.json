{
  "filename": "HSB_G-UsedMaterial.mcr",
  "status": "completed",
  "total_tokens": 57042,
  "processing_time": 275.0433566570282,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": 2,
          "minorVersion": 1,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl shows the genbeams which are present in the drawing",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "07.06.2011",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "20.06.2011",
            "author": "AS",
            "changes": "Add filters"
          },
          {
            "version": "1.02",
            "date": "20.06.2011",
            "author": "AS",
            "changes": "Add a width sort for the sheets"
          },
          {
            "version": "1.03",
            "date": "20.06.2011",
            "author": "AS",
            "changes": "Ignore small differences in sheetsize"
          },
          {
            "version": "1.04",
            "date": "20.06.2011",
            "author": "AS",
            "changes": "Swap length and width for sheet size"
          },
          {
            "version": "1.05",
            "date": "22.06.2011",
            "author": "AS",
            "changes": "Update filters"
          },
          {
            "version": "1.06",
            "date": "16.09.2011",
            "author": "AS",
            "changes": "Increase column width"
          },
          {
            "version": "1.07",
            "date": "01.12.2011",
            "author": "AS",
            "changes": "Set category index to grade of beam/sheet"
          },
          {
            "version": "1.08",
            "date": "20.12.2011",
            "author": "AS",
            "changes": "Add Id of tsl to grade"
          },
          {
            "version": "1.09",
            "date": "18.01.2012",
            "author": "AS",
            "changes": "Add Id and Catagory to individual parts of the tsl."
          },
          {
            "version": "2.00",
            "date": "12.03.2013",
            "author": "AS",
            "changes": "Update to localizer"
          },
          {
            "version": "2.01",
            "date": "10.07.2014",
            "author": "AS",
            "changes": "Force it layer 0 during insert. Include only works if at least one filter is used."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 9239,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses 'Group().collectEntities(true, TslInst(), _kModelSpace)' to find existing instances and 'assignToLayer(\"0\")' during insertion. It prompts for a report position using 'getPoint()', which is standard for ModelSpace annotations. No shopdrawing (#Type E), viewport, or paper space specific logic is present."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing GenBeams or Sheets",
          "requiredSettings": []
        }
      },
      "tokens_used": 6690,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select a set of timbers and sheets",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select a position for the report",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeperator01",
            "type": "PropString",
            "displayName": "Selection",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sSelection",
            "type": "PropString",
            "displayName": "     Selection method",
            "defaultValue": "Manual (cross-select)",
            "inputType": "dropdown",
            "options": [
              "Manual (cross-select)"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sSeperator02",
            "type": "PropString",
            "displayName": "Filters",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sFilterMode",
            "type": "PropString",
            "displayName": "     Filter mode",
            "defaultValue": "Include",
            "inputType": "dropdown",
            "options": [
              "Include",
              "Exlude"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sCaseSensitive",
            "type": "PropString",
            "displayName": "     Case sensitive",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sFilterName",
            "type": "PropString",
            "displayName": "     Name",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sFilterBeamCode",
            "type": "PropString",
            "displayName": "     Beamcode",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sFilterMaterial",
            "type": "PropString",
            "displayName": "     Material",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "sFilterLabel",
            "type": "PropString",
            "displayName": "     Label",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "sFilterHsbID",
            "type": "PropString",
            "displayName": "     Hsb ID",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 10,
            "variable": "sFilterZone",
            "type": "PropString",
            "displayName": "     Zone",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 11,
            "variable": "sSeperator03",
            "type": "PropString",
            "displayName": "Style",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 12,
            "variable": "sDimStyleBreakDown",
            "type": "PropString",
            "displayName": "     Dimension style groups",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 13,
            "variable": "sDimStyleContent",
            "type": "PropString",
            "displayName": "     Dimension style content",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColorBreakDown",
            "type": "PropInt",
            "displayName": "     Color groups",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColorContent",
            "type": "PropInt",
            "displayName": "     Color content",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "nColorGrid",
            "type": "PropInt",
            "displayName": "     Color lines",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9671,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Calculates and generates a schedule report listing all timber beams and sheets in a selection, categorized by material grade and dimensions.",
          "category": "Reporting / Scheduling",
          "typicalUseCase": "Used during the design phase to generate a material take-off (MTO) or bill of materials (BOM) report directly in the CAD drawing to estimate costs or check quantities."
        },
        "parameters": [
          {
            "name": "sSelection",
            "technicalDefault": "Manual (cross-select)",
            "businessMeaning": "Defines how the user selects the elements to be included in the report. Currently fixed to manual selection.",
            "validRange": "N/A (Fixed value)",
            "unit": "Selection Mode",
            "affectsOutput": "Determines the initial set of GenBeams/Sheets evaluated by the script."
          },
          {
            "name": "sFilterMode",
            "technicalDefault": "Include",
            "businessMeaning": "Determines if the filter criteria act as an inclusive list (only items matching are kept) or exclusive list (items matching are removed).",
            "validRange": "Include, Exclude",
            "unit": "Logic",
            "affectsOutput": "Controls whether the report contains only the filtered items or everything except the filtered items."
          },
          {
            "name": "sCaseSensitive",
            "technicalDefault": "No",
            "businessMeaning": "Toggles whether text filters (like Name, Material) match exactly (case-sensitive) or ignore casing.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "Affects the accuracy of text-based filtering."
          },
          {
            "name": "sFilterName",
            "technicalDefault": "",
            "businessMeaning": "Filters elements based on their entity name. Supports wildcards like *prefix* or suffix*.",
            "validRange": "Text string (wildcards allowed)",
            "unit": "String",
            "affectsOutput": "Excludes or includes specific named elements from the report."
          },
          {
            "name": "sFilterBeamCode",
            "technicalDefault": "",
            "businessMeaning": "Filters elements based on their assigned Beam Code.",
            "validRange": "Text string (wildcards allowed)",
            "unit": "String",
            "affectsOutput": "Refines the report to specific structural grades or types."
          },
          {
            "name": "sFilterMaterial",
            "technicalDefault": "",
            "businessMeaning": "Filters elements based on their material property (e.g., C24, GL24h, OSB).",
            "validRange": "Text string (wildcards allowed)",
            "unit": "String",
            "affectsOutput": "Separates report by material type."
          },
          {
            "name": "sFilterLabel",
            "technicalDefault": "",
            "businessMeaning": "Filters elements based on their Label property.",
            "validRange": "Text string (wildcards allowed)",
            "unit": "String",
            "affectsOutput": "Filters elements based on user-defined labels."
          },
          {
            "name": "sFilterHsbID",
            "technicalDefault": "",
            "businessMeaning": "Filters elements based on their hsbCAD ID.",
            "validRange": "Text string",
            "unit": "String",
            "affectsOutput": "Filters specific element instances."
          },
          {
            "name": "sFilterZone",
            "technicalDefault": "",
            "businessMeaning": "Filters elements based on their assigned zone index.",
            "validRange": "Integer",
            "unit": "Zone Index",
            "affectsOutput": "Generates report for specific construction zones."
          },
          {
            "name": "sDimStyleBreakDown",
            "technicalDefault": "",
            "businessMeaning": "Selects the dimension style (font size, color) for the group headers in the report.",
            "validRange": "Available Dimension Styles in drawing",
            "unit": "Style Reference",
            "affectsOutput": "Visual appearance of the breakdown summary headers."
          },
          {
            "name": "sDimStyleContent",
            "technicalDefault": "",
            "businessMeaning": "Selects the dimension style for the detailed item list in the report.",
            "validRange": "Available Dimension Styles in drawing",
            "unit": "Style Reference",
            "affectsOutput": "Visual appearance of the item content list."
          },
          {
            "name": "nColorBreakDown",
            "technicalDefault": "1",
            "businessMeaning": "Sets the AutoCAD color index for the group header text.",
            "validRange": "0-255 (AutoCAD Index), -1 for ByBlock",
            "unit": "Color Index",
            "affectsOutput": "Text color of the breakdown headers."
          },
          {
            "name": "nColorContent",
            "technicalDefault": "-1",
            "businessMeaning": "Sets the AutoCAD color index for the detailed item text.",
            "validRange": "0-255 (AutoCAD Index), -1 for ByBlock",
            "unit": "Color Index",
            "affectsOutput": "Text color of the report content."
          },
          {
            "name": "nColorGrid",
            "technicalDefault": "-1",
            "businessMeaning": "Sets the AutoCAD color index for the grid lines drawn in the report.",
            "validRange": "0-255 (AutoCAD Index), -1 for ByBlock",
            "unit": "Color Index",
            "affectsOutput": "Line color of the report grid."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Any filter string (Name, BeamCode, etc.) is populated",
            "effect": "Activates the 'Include' filter mode logic. If 'Include' is set, but no filters are populated, the script effectively shows everything (or nothing depending on logic), but version 2.01 note suggests 'Include only works if at least one filter is used'.",
            "cascade": [
              "sFilterMode",
              "sCaseSensitive"
            ]
          },
          {
            "trigger": "sCaseSensitive is set to 'No'",
            "effect": "Converts all filter inputs and entity properties to Uppercase before comparison.",
            "cascade": [
              "sFilterName",
              "sFilterBeamCode",
              "sFilterMaterial",
              "sFilterLabel",
              "sFilterHsbID"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text (Annotation)",
            "description": "Creates a multi-line text schedule grouped by material and size. Updates the 'Grade' property of the analyzed GenBeams and Sheets with a unique ID corresponding to the report line item.",
            "appliedTo": "Model Space (at selected point) and GenBeams/Sheets (Grade property update)"
          },
          {
            "type": "PLine (Polyline)",
            "description": "Draws grid lines to structure the report visually.",
            "appliedTo": "Model Space (at selected point)"
          }
        ]
      },
      "tokens_used": 10967,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution begins.",
          "[Insert Phase] Check if insertCycleCount > 1.",
          "If true, erase duplicate instance and exit.",
          "Check execute key. If empty, show Properties Dialog.",
          "User confirms properties or cancels.",
          "Prompt user to 'Select a set of timbers and sheets' (PrEntity).",
          "User selects entities (cross-select).",
          "Script filters selection for valid GenBeams/Beams/Sheets.",
          "Prompt user to 'Select a position for the report' (getPoint).",
          "User clicks to place report.",
          "Calculate unique Script ID by scanning existing instances of 'HSB_G-UsedMaterial'.",
          "Assign instance to Layer '0'.",
          "[Execution Phase] Validate that _GenBeam array is not empty.",
          "If empty, display warning 'No timbers or sheets included...', erase instance, and exit.",
          "Parse Filter Properties (Name, BeamCode, Material, Label, HsbID, Zone).",
          "Filter selected entities based on parsed criteria and Filter Mode (Include/Exclude).",
          "Separate valid entities into Timbers (Beams) and Sheets.",
          "Process Timbers: Sort by Material Grade and Width.",
          "Generate Report Geometry for Timbers: Draw Header, Group Breakdowns (Sum of Lengths), and Content List (Individual Sizes).",
          "Write Category Grade (e.g., ID-1) to each Timber entity.",
          "Process Sheets: Sort by Thickness/Material, then by Size (Width x Length).",
          "Generate Report Geometry for Sheets: Draw Header, Group Breakdowns (Total Area), and Content List (Individual Sizes).",
          "Write Category Grade (e.g., ID-101) to each Sheet entity.",
          "Report generation complete."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Check",
            "path1": {
              "name": "Duplicate Insert",
              "steps": [
                "eraseInstance()",
                "Return"
              ]
            },
            "path2": {
              "name": "Normal Insert",
              "steps": [
                "Continue to Property Dialog"
              ]
            }
          },
          {
            "condition": "Execute Key",
            "path1": {
              "name": "Empty Key (Standard Run)",
              "steps": [
                "showDialog()",
                "Wait for user input"
              ]
            },
            "path2": {
              "name": "Populated Key (Scripted Run)",
              "steps": [
                "Skip dialog",
                "Use default/current properties"
              ]
            }
          },
          {
            "condition": "Selection Validation",
            "path1": {
              "name": "Valid GenBeams Selected",
              "steps": [
                "Populate _GenBeam array",
                "Proceed to placement"
              ]
            },
            "path2": {
              "name": "No Entities Selected / Invalid Types",
              "steps": [
                "_GenBeam.length() == 0",
                "Report Warning: 'No timbers or sheets included...'",
                "eraseInstance()",
                "Exit"
              ]
            }
          },
          {
            "condition": "Filter Mode",
            "path1": {
              "name": "Include Mode",
              "steps": [
                "Entity matches at least one active filter",
                "Include in report"
              ]
            },
            "path2": {
              "name": "Exclude Mode",
              "steps": [
                "Entity matches any active filter",
                "Exclude from report"
              ]
            }
          },
          {
            "condition": "Case Sensitivity",
            "path1": {
              "name": "Case Sensitive (Yes)",
              "steps": [
                "Direct string comparison"
              ]
            },
            "path2": {
              "name": "Case Insensitive (No)",
              "steps": [
                "Convert Filter and Entity strings to Uppercase",
                "Compare Uppercase strings"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases itself automatically to prevent duplicates."
          },
          {
            "check": "Entity Selection",
            "errorMessage": "No timbers or sheets included in the selection set.",
            "recovery": "User must re-run script and select valid GenBeam, Beam, or Sheet entities."
          },
          {
            "check": "Filter Logic",
            "errorMessage": "None implicit, but result may be empty report.",
            "recovery": "User adjusts Filter properties in OPM and forces recalculation (or erases and re-inserts)."
          },
          {
            "check": "Wildcard Syntax",
            "errorMessage": "None (Malformed wildcards treated as literals)",
            "recovery": "User corrects the filter string (e.g., ensures * is used correctly)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Filters or Styles",
            "how": "Properties Palette (OPM)",
            "effect": "Updating text filters (Name, Material, etc.) or changing Styles triggers a recalculation of the report content and visuals immediately."
          },
          {
            "action": "Move Report",
            "how": "Grip Edit (Select instance -> Drag grip)",
            "effect": "Moves the entire report geometry (Text and Grid lines) to a new location."
          },
          {
            "action": "Delete Report",
            "how": "AutoCAD Erase / Delete command",
            "effect": "Removes the report instance. Note: The 'Grade' property modification on the beams remains on the entities unless manually cleared or overwritten."
          },
          {
            "action": "Inspect Individual Part Grades",
            "how": "Select a Beam or Sheet included in the report -> Check Properties",
            "effect": "The 'Grade' property will show the ID assigned by the script (e.g., '1-5'), linking the physical part to the specific line in the report."
          }
        ]
      },
      "tokens_used": 12033,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-UsedMaterial.mcr\n\n## Overview\nThis script generates a material schedule (Bill of Materials) directly in the Model Space by analyzing selected timber beams and sheets. It lists items grouped by material grade and dimensions, calculates total quantities (length for timber, area for sheets), and links the physical parts to the report via the \"Grade\" property.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This is the primary environment for the script. |\n| Paper Space | No | Not supported for layout viewports. |\n| Shop Drawing | No | Not intended for manufacturing views. |\n\n## Prerequisites\n- **Required entities**: `GenBeam`, `Beam`, or `Sheet` entities must exist in the drawing.\n- **Minimum beam count**: At least 1 valid timber or sheet must be selected to generate a report.\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `HSB_G-UsedMaterial.mcr`.\n\n### Step 2: Select Entities\n```\nCommand Line: Select a set of timbers and sheets\nAction: Use a crossing window or select individual beams/sheets you wish to include in the report. Press Enter when finished.\n```\n\n### Step 3: Position Report\n```\nCommand Line: Select a position for the report\nAction: Click in the Model Space to define the top-left corner of the material list.\n```\n\n## Properties Panel Parameters\n\nConfigure these settings in the AutoCAD Properties Palette (Ctrl+1) after selecting the script instance.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Selection** | | | |\n| Selection method | dropdown | Manual (cross-select) | Defines how elements are selected (Currently fixed to manual). |\n| **Filters** | | | |\n| Filter mode | dropdown | Include | Determines if filters keep matching items (\"Include\") or remove them (\"Exclude\"). |\n| Case sensitive | dropdown | No | Defines if text filters (Name, Material) require exact casing. |\n| Name | text | | Filters elements by their entity name (supports wildcards like `*`). |\n| Beamcode | text | | Filters elements by their Beam Code property. |\n| Material | text | | Filters elements by their material grade (e.g., C24, GL24h). |\n| Label | text | | Filters elements by their Label property. |\n| Hsb ID | text | | Filters elements by their unique hsbCAD ID. |\n| Zone | text | | Filters elements by their assigned Zone index. |\n| **Style** | | | |\n| Dimension style groups | dropdown | | Sets the text style for the group summary headers. |\n| Dimension style content | dropdown | | Sets the text style for the individual item lines. |\n| Color groups | number | 1 | Sets the AutoCAD color index for group headers. |\n| Color content | number | -1 | Sets the AutoCAD color index for content text (-1 = ByBlock). |\n| Color lines | number | -1 | Sets the AutoCAD color index for grid lines (-1 = ByBlock). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add specific custom commands to the right-click context menu. Use the Properties Palette to modify settings. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies entirely on internal logic and Properties Palette inputs.\n\n## Tips\n- **Filter Logic**: If \"Filter mode\" is set to \"Include\", you must populate at least one filter field (e.g., Material), otherwise the report may remain empty or show everything depending on the version.\n- **Linking Parts**: The script automatically writes an ID to the \"Grade\" property of the beams and sheets. You can select a physical beam in the drawing and check its properties to see which line item in the report it corresponds to.\n- **Updating**: If you modify the geometry of the beams, select the report instance and use the `REGEN` command or right-click -> \"Reload\" (if available in your hsbCAD version) to update the quantities.\n- **Moving**: Select the text report to move the entire schedule. The text and grid lines are grouped together.\n\n## FAQ\n- **Q: Why is my report empty?**\n  A: Ensure you selected valid GenBeam or Sheet entities. If using \"Include\" filter mode, check that at least one filter field (like Material or Name) is actually filled in and matches your elements.\n  \n- **Q: How do I change the text size of the report?**\n  A: Use the \"Dimension style groups\" and \"Dimension style content\" parameters in the Properties Palette to select different pre-defined text styles from your drawing.\n\n- **Q: Can I separate timbers from sheets?**\n  A: Yes, the script automatically detects the entity type. Timbers are sorted by width and length; Sheets are sorted by size and thickness.\n\n- **Q: What happens if I delete the report?**\n  A: The report instance is removed. However, the \"Grade\" property modifications on the individual beams and sheets will remain until manually overwritten."
      },
      "tokens_used": 8442,
      "error": null
    }
  }
}