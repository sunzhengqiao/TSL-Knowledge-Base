{
  "filename": "hsbCLT-Electra.mcr",
  "status": "completed",
  "total_tokens": 53467,
  "processing_time": 358.06075286865234,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": 0,\n    \"implInsert\": 0\n  },\n  \"description\": \"Dieses TSL erzeugt Bearbeitungen für Elektroinstallationen an CLT Panelen This TSL creates tools of electrical installations on panels\",\n  \"versionHistory\": [\n    {\n      \"version\": \"4.11\",\n      \"date\": \"22.05.2025\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"write flag in mapX for rectangular sockets\"\n    },\n    {\n      \"version\": \"4.10\",\n      \"date\": \"22.04.2025\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"Add stereotypes\"\n    },\n    {\n      \"version\": \"4.9\",\n      \"date\": \"25.10.2024\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"Use triangles for the stretching/\\\"edit in place\\\" grips\"\n    },\n    {\n      \"version\": \"4.8\",\n      \"date\": \"09.10.2024\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"Use arrow grip shape for \\\"Edit in place\\\" grips; use color 4 to indicate stretch grip\"\n    },\n    {\n      \"version\": \"4.7\",\n      \"date\": \"02.10.2024\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"Add command \\\"Edit in place\\\"/\\\"Disable edit in place\\\"\"\n    },\n    {\n      \"version\": \"4.6\",\n      \"date\": \"03.05.2024\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"fix when draging grip point\"\n    },\n    {\n      \"version\": \"4.5\",\n      \"date\": \"02.05.2024\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes"
      },
      "tokens_used": 9283,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Filename 'hsbCLT-Electra.mcr' uses standard hsb prefix, not 'sd_' or 'Multipage'. Script contains explicit usage of '_kModelSpace' in 'PrPoint' constructors (e.g., 'PrPoint ssP(\"\\n\" + sMsg,ptLast, _kModelSpace);'). The script generates 3D machining (Bearbeitungen) and attaches Hardware components ('HardWrComp') to 'GenBeam' or 'Element' entities, which are Model Space operations. It utilizes 'dpElement' and 'dpPlan' for visualization but execution logic is based on 3D geometry."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Catalog entries for electrical installations",
            "Submap 'Hsb_Tag' for tagging functionality"
          ]
        }
      },
      "tokens_used": 7729,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10593,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates machining for electrical installations (sockets, switches) and wire chases on CLT panels, including plan annotations and hardware linkage for production data.",
          "category": "Machining/Hardware",
          "typicalUseCase": "Detailing CLT walls or floors by placing specific cutouts for round/rectangular sockets or vertical cable chases based on architectural plans."
        },
        "parameters": [
          {
            "name": "sShape",
            "technicalDefault": "\"Circle\"",
            "businessMeaning": "Determines the type of electrical box cutout (Round socket vs. Rectangular junction box).",
            "validRange": "Circle, Rectangle, Square",
            "unit": "String",
            "affectsOutput": "Switches the machining logic between a circular drill/slot or a rectangular contour. Changes the visible symbol in plan views."
          },
          {
            "name": "nQty",
            "technicalDefault": "1",
            "businessMeaning": "Number of identical electrical installations grouped together (e.g., a double socket).",
            "validRange": "1 to 10",
            "unit": "Count",
            "affectsOutput": "If > 1, creates a slotted hole or wider rectangular cutout. Updates the display text and BOM quantity."
          },
          {
            "name": "dDiameter",
            "technicalDefault": "68.0",
            "businessMeaning": "The diameter of the round socket or the width of the individual installation unit.",
            "validRange": "50mm to 150mm (Standard box dimensions)",
            "unit": "mm",
            "affectsOutput": "Defines the width of the cutout (Drill diameter or Rectangular width)."
          },
          {
            "name": "dDepth",
            "technicalDefault": "40.0",
            "businessMeaning": "Depth of the cutout into the panel material (often matching the box depth).",
            "validRange": "10mm to Panel Thickness",
            "unit": "mm",
            "affectsOutput": "Controls the Z-depth of the milling operation."
          },
          {
            "name": "dOffsetInstallation",
            "technicalDefault": "100.0",
            "businessMeaning": "Center-to-center distance between multiple grouped installations.",
            "validRange": "60mm to 200mm",
            "unit": "mm",
            "affectsOutput": "Calculates the total length of the combined cutout when nQty > 1."
          },
          {
            "name": "dElevation",
            "technicalDefault": "1050.0",
            "businessMeaning": "Vertical height of the installation center from the floor level.",
            "validRange": "300mm to 2500mm",
            "unit": "mm",
            "affectsOutput": "Positions the cutout vertically along the panel."
          },
          {
            "name": "sFormat",
            "technicalDefault": "\"<EL>\"",
            "businessMeaning": "String format for the label displayed in 2D drawings (e.g., showing Elevation, Type, or Quantity).",
            "validRange": "<EL>, <Type>, <Qty>, or combinations",
            "unit": "String",
            "affectsOutput": "Modifies the text annotation in plan and element views."
          },
          {
            "name": "dXOffset",
            "technicalDefault": "0.0",
            "businessMeaning": "Horizontal shift of the installation from the insertion point.",
            "validRange": "Unlimited",
            "unit": "mm",
            "affectsOutput": "Moves the cutout horizontally along the panel."
          },
          {
            "name": "dXBc / dYBc / dZBc",
            "technicalDefault": "100.0 / 50.0 / 60.0",
            "businessMeaning": "Dimensions for the Wirechase (Width, Height, Depth).",
            "validRange": "40-200mm / 20-100mm / 20-100mm",
            "unit": "mm",
            "affectsOutput": "Defines the size of the vertical conduit groove when Wirechase mode is active."
          },
          {
            "name": "dRotZ",
            "technicalDefault": "0.0",
            "businessMeaning": "Rotation angle of the installation on the panel surface.",
            "validRange": "0 to 360",
            "unit": "degrees",
            "affectsOutput": "Rotates the cutout geometry and associated visual elements."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "nQty > 1",
            "effect": "Enables 'multiple' logic, calculating total span using dOffsetInstallation.",
            "cascade": [
              "dDiameter",
              "dOffsetInstallation"
            ]
          },
          {
            "trigger": "sShape == \"Rectangle\"",
            "effect": "Interprets dDiameter as the 'Width' of the rectangle.",
            "cascade": [
              "dDiameter"
            ]
          },
          {
            "trigger": "Wirechase Mode (nQty <= 0 implied or catalog selection)",
            "effect": "Switches geometry output to use Wirechase dimensions (dXBc, etc.) instead of socket parameters.",
            "cascade": [
              "dXBc",
              "dYBc",
              "dZBc"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Machining (Drill/Cut/Contour)",
            "description": "The physical cutout in the CLT panel for the socket or wire chase.",
            "appliedTo": "Selected GenBeam or Element"
          },
          {
            "type": "HardWrComp",
            "description": "Hardware component attached for BOM lists and export data.",
            "appliedTo": "Element"
          },
          {
            "type": "TslDimRequest",
            "description": "2D annotation (text/lines) displayed in layout views indicating height and type.",
            "appliedTo": "Element Plan View"
          },
          {
            "type": "Grips",
            "description": "Interactive handles for moving the installation or stretching the wirechase geometry.",
            "appliedTo": "Model Space"
          }
        ]
      },
      "tokens_used": 8847,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches the TSL command (e.g., via Toolbar or command line).",
          "User selects a target CLT panel (GenBeam or Element) in the model.",
          "Dialog appears listing available Catalog Entries (e.g., 'Socket 1x', 'Wirechase'). User selects an entry.",
          "User specifies the insertion point on the panel (usually in a top view).",
          "User specifies the elevation height (vertical position) of the installation.",
          "Script calculates the local coordinates based on the panel's orientation and insertion point.",
          "Script generates 3D machining operations (Drills/Contours) on the panel.",
          "Script creates and links a Hardware Component (HardWrComp) to the Element/BOM.",
          "Script generates 2D visual representations and text tags for Plan and Element views.",
          "Script inserts the TSL instance into the drawing."
        ],
        "conditionalBranches": [
          {
            "condition": "Property 'nQty' (Quantity) value",
            "path1": {
              "name": "Socket Mode",
              "steps": [
                "Triggered when nQty > 0.",
                "Reads socket dimensions: Diameter (dDiameter), Depth (dDepth).",
                "Checks if nQty == 1: Creates a simple single cutout.",
                "Checks if nQty > 1: Calculates total length using 'dOffsetInstallation' and creates a combined/slotted cutout.",
                "Sets Hardware name based on Shape (Circle/Rectangle)."
              ]
            },
            "path2": {
              "name": "Wirechase Mode",
              "steps": [
                "Triggered when nQty <= 0.",
                "Reads wirechase dimensions: dXBc (Width), dYBc (Height), dZBc (Depth).",
                "Generates a rectangular contour milling for the cable chase.",
                "Sets Hardware name to 'Wirechase' and updates scale X/Y/Z accordingly."
              ]
            }
          },
          {
            "condition": "Catalog Entry Selection via Context Menu",
            "path1": {
              "name": "Catalog Apply",
              "steps": [
                "User right-clicks the instance and selects a specific entry from 'Catalog Entries'.",
                "Script executes 'setPropValuesFromCatalog'.",
                "All relevant properties (Diameter, Shape, Elevation, etc.) are overwritten by the catalog definition.",
                "Instance recalculates geometry immediately."
              ]
            }
          },
          {
            "condition": "Entity Relationship during Insertion",
            "path1": {
              "name": "Element Linked",
              "steps": [
                "Selected GenBeam has a valid parent Element.",
                "Hardware component is linked to the Element group.",
                "Visuals and Tags are published to the Element Plan views."
              ]
            },
            "path2": {
              "name": "Loose / No Element",
              "steps": [
                "Selected GenBeam has no valid parent Element.",
                "Hardware component is linked to the specific Group of the beam.",
                "Visuals are generated only for the beam."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Target Entity Validity",
            "errorMessage": "Script exits silently or fails to insert if no valid GenBeam or Element is selected.",
            "recovery": "Ensure a valid CLT panel is selected before running the command."
          },
          {
            "check": "Geometric Dimensions",
            "errorMessage": "Machining may not generate if Diameter, Depth, or Offset values are invalid (e.g., zero or negative where positive is required).",
            "recovery": "Adjust parameters in the Properties Palette to ensure positive dimensions for the selected mode."
          },
          {
            "check": "Insertion Point Projection",
            "errorMessage": "Point must project onto the plane of the selected panel.",
            "recovery": "Click closer to the actual surface of the panel in the view or ensure UCS aligns with the panel."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Installation",
            "how": "Drag the central 'Base' Grip point",
            "effect": "Updates 'dXOffset' and/or 'dElevation' to move the cutout across the panel surface or vertically."
          },
          {
            "action": "Stretch Wirechase",
            "how": "Drag 'WirechaseTop' or 'EditInPlace' grips",
            "effect": "Modifies the geometry of the wirechase (if in Wirechase mode), changing the shape/length of the cutout."
          },
          {
            "action": "Modify Parameters",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Changing 'sShape', 'nQty', 'dDiameter', or 'dDepth' immediately regenerates the machining and hardware."
          },
          {
            "action": "Switch Preset",
            "how": "Right-click Context Menu -> Catalog Entries",
            "effect": "Loads a predefined configuration (e.g., changing from a Double Socket to a Triple Socket)."
          }
        ]
      },
      "tokens_used": 10740,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-Electra\n\n## Overview\nThis script creates 3D machining for electrical installations (such as sockets, switches, and junction boxes) and vertical wire chases on CLT panels. It automatically links hardware components for BOM lists and generates 2D annotations for production drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in Model Space on 3D panels. |\n| Paper Space | No | Not applicable for layout views directly. |\n| Shop Drawing | No | Not a shop drawing generation script. |\n\n## Prerequisites\n- **Required Entities**: A single `GenBeam` or `Element` (CLT Wall/Floor) must exist in the model.\n- **Minimum Beam Count**: 1\n- **Required Settings**:\n    - Catalog entries containing predefined electrical installation types (e.g., \"Socket 1x\", \"Wirechase\").\n    - Submap `Hsb_Tag` must exist for tagging functionality.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsbCLT-Electra.mcr` from the list.\n\n### Step 2: Select Panel\n```\nCommand Line: Select element/beam:\nAction: Click on the CLT panel (GenBeam or Element) where you want to add the installation.\n```\n\n### Step 3: Select Type\n```\nCommand Line: [Dialog Box Appears]\nAction: Select a Catalog Entry (e.g., \"Socket Round\", \"Socket Rect\", \"Wirechase\") from the list and click OK.\n```\n\n### Step 4: Specify Insertion Point\n```\nCommand Line: Specify insertion point:\nAction: Click on the face of the panel in Top View or 3D View to place the center of the socket.\n```\n\n### Step 5: Specify Elevation\n```\nCommand Line: Elevation <1050>:\nAction: Type the vertical height (e.g., 1050) from the bottom of the panel and press Enter, or click a point in a Front/Elevation view.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sShape | Dropdown | Circle | Shape of the cutout: Circle, Rectangle, or Square. |\n| nQty | Number | 1 | Quantity of sockets (1-10). Set to **0 or negative** to enable **Wirechase** mode. |\n| dDiameter | Number | 68.0 | Diameter of round sockets OR Width of rectangular sockets. |\n| dDepth | Number | 40.0 | Depth of the cutout into the panel material. |\n| dOffsetInstallation | Number | 100.0 | Center-to-center distance between multiple grouped sockets (used when nQty > 1). |\n| dElevation | Number | 1050.0 | Vertical height of the installation center from the floor level. |\n| sFormat | String | <EL> | Format for the 2D label tag (e.g., `<EL>`, `<Type>`, `<Qty>`). |\n| dXOffset | Number | 0.0 | Horizontal shift of the installation along the panel width. |\n| dXBc / dYBc / dZBc | Number | 100 / 50 / 60 | Dimensions for Wirechase mode (Width, Height, Depth). Only active when nQty <= 0. |\n| dRotZ | Number | 0.0 | Rotation angle of the installation on the panel surface. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Catalog Entries | Opens a dialog to switch the installation to a different preset configuration (e.g., changing from a single socket to a double socket). |\n| Edit in place | Enables special \"Edit in place\" grips for advanced stretching/modification of the geometry. |\n| Disable edit in place | Disables the advanced editing grips. |\n\n## Settings Files\n- **Filename**: Catalog (specific name depends on company configuration, usually associated with Hsb catalogs).\n- **Location**: Company Standard or hsbCAD Install directory.\n- **Purpose**: Provides predefined dimensions and names for standard electrical boxes and wire chases.\n\n## Tips\n- **Wirechase Mode**: To create a vertical wire chase instead of a socket, change the `nQty` property to `0`. The script will then use the `dXBc`, `dYBc`, and `dZBc` parameters for dimensions.\n- **Multi-Gang Sockets**: Set `nQty` greater than 1 to create a combined cutout for multiple sockets (e.g., 2 or 3-gang switches). Adjust `dOffsetInstallation` to control the spacing.\n- **Editing**: You can drag the central grip (Blue square) to move the installation across the panel surface or change its elevation.\n- **Rectangular Sockets**: Ensure `sShape` is set to \"Rectangle\" if your catalog entry implies a junction box rather than a round flush-mount socket.\n\n## FAQ\n- **Q: How do I create a wire chase?\n- **A:** Select the \"Wirechase\" entry from the catalog during insertion, or manually set the `nQty` property to `0` in the Properties Palette.\n- **Q: The cutout is in the wrong spot on the panel.\n- **A:** Select the script instance in the model. Drag the central grip (Square handle) to move it, or adjust `dElevation` and `dXOffset` in the properties.\n- **Q: Can I rotate the socket?\n- **A:** Yes, use the `dRotZ` property in the Properties Palette to rotate the cutout."
      },
      "tokens_used": 6275,
      "error": null
    }
  }
}