{
  "filename": "GE_PLOT_OPENING_TEXT.mcr",
  "status": "completed",
  "total_tokens": 38357,
  "processing_time": 1419.8102507591248,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "v1.0",
            "date": "14.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Copied from BP_PLOT_OPENING_TEXT, to keep US content folder naming standards"
          },
          {
            "version": "v2.7",
            "date": "14.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Version control from 1.0 to 2.7, to keep updated with BP_PLOT_OPENING_TEXT Description added Copyright added Thumbnail added"
          },
          {
            "version": "v2.8",
            "date": "11.oct.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Text will be always parallel to _XW"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7469,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses 'getViewport' in _bOnInsert and stores it in '_Viewport'. Retrieves Element from Viewport ('vp.element()'). Calculates 'ms2ps' (Model Space to Paper Space) coordinate transformation. Comments explicitly state 'dimstyle was adjusted for display in paper space'. Transforms opening points using 'ms2ps' before drawing."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element (Wall)",
            "Opening"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space (Layout Tab)",
          "requiredSettings": [
            "DimStyle (defined in sDimLayout property)"
          ]
        }
      },
      "tokens_used": 6904,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimLayout",
            "type": "PropString",
            "displayName": "DimStyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "pSill",
            "type": "PropString",
            "displayName": "Display Sill Height",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "pSillPF",
            "type": "PropString",
            "displayName": "Sill Prefix",
            "defaultValue": "Sill: ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "pHead",
            "type": "PropString",
            "displayName": "Display Head Height",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "pHeadPF",
            "type": "PropString",
            "displayName": "Head Height Prefix",
            "defaultValue": "Head: ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "pModule",
            "type": "PropString",
            "displayName": "Display Module Name",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "pSizePF",
            "type": "PropString",
            "displayName": "Module Prefix",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "pRO",
            "type": "PropString",
            "displayName": "Display RO",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "pROPF",
            "type": "PropString",
            "displayName": "RO Prefix",
            "defaultValue": "RO: ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "pRoFrom",
            "type": "PropString",
            "displayName": "Take Opening Properties from",
            "defaultValue": "Framed hole",
            "inputType": "dropdown",
            "options": [
              "Framed hole",
              "Opening size"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffsetText",
            "type": "PropDouble",
            "displayName": "Offset Text",
            "defaultValue": "0.6",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dOffsetAllTextX",
            "type": "PropDouble",
            "displayName": "Offset All Text-X",
            "defaultValue": "0.6",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dOffsetAllTextY",
            "type": "PropDouble",
            "displayName": "Offset All Text-Y",
            "defaultValue": "0.6",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dTH",
            "type": "PropDouble",
            "displayName": "Text Height",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dmm",
            "type": "PropDouble",
            "displayName": "Scale output by",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 10,
            "variable": "pBrockportDefaults",
            "type": "PropString",
            "displayName": "Set To Brockport Defaults",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8192,
      "error": null
    },
    "4": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "Request timeout after retries"
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script initializes and checks 'Set To Brockport Defaults' property",
          "If 'Set To Brockport Defaults' is 'Yes', overwrites all default properties (offsets, prefixes, dimstyle) and sets property to 'No'",
          "If in Insert mode (_bOnInsert): Prompt user to 'Select a viewport' and store reference",
          "If in Execute mode: Validate that stored Viewport contains a valid Element (Wall)",
          "Retrieve all Openings from the Element",
          "Sort Openings based on their distance from the Element origin along the X-axis",
          "Loop through sorted Openings",
          "Check for intersection with other Openings: Merge profiles if touching/intersecting",
          "Check for 'Common Header': If headers intersect multiple merged openings, set flag to ignore headers during module name lookup",
          "Identify Module Name: Search for beams intersecting the opening body to find a module string",
          "Calculate Geometry Dimensions: Determine Sill, Head, Width, and Height based on profile vertices",
          "Apply Dimension Source Override: If 'Take Opening Properties from' is 'Opening size', overwrite calculated values with standard opening properties",
          "Format Text Strings: Apply fractional inch formatting logic (e.g., 48-1/2 vs 48) based on dimension remainder",
          "Calculate Text Position: Determine base position and apply offsets. Check distance to previous openings to stack text (stagger) if openings are close together",
          "Transform Coordinates: Convert Model Space coordinates to Paper Space using Viewport transformation matrix",
          "Draw Text: Render Sill, Head, Module, and RO text in Paper Space if their respective Display properties are 'Yes'"
        ],
        "conditionalBranches": [
          {
            "condition": "Brockport Defaults Property",
            "path1": {
              "name": "Apply Defaults",
              "steps": [
                "Set sDimLayout to 'RandyVP(inch)'",
                "Reset prefixes to standard (Sill: , Head: , RO: )",
                "Set offsets to 0 or 0.125",
                "Set text height to 0.09375",
                "Set property to 'No' to prevent re-running"
              ]
            },
            "path2": {
              "name": "User Configuration",
              "steps": [
                "Use current values stored in OPM properties"
              ]
            }
          },
          {
            "condition": "Opening Property Source (pRoFrom)",
            "path1": {
              "name": "Framed hole (Calculated)",
              "steps": [
                "Derive dimensions from the geometric profile of the opening (subtracting beam bodies if necessary)"
              ]
            },
            "path2": {
              "name": "Opening size (Standard)",
              "steps": [
                "Use opng.width(), opng.height(), opng.sillHeight(), opng.headHeight() directly"
              ]
            }
          },
          {
            "condition": "Common Header Detection",
            "path1": {
              "name": "Common Header Found",
              "steps": [
                "Ignore beams of type Header or Transom when searching for the Module name"
              ]
            },
            "path2": {
              "name": "No Common Header",
              "steps": [
                "Search all intersecting beams to find the first valid Module name"
              ]
            }
          },
          {
            "condition": "Dimension Formatting Logic",
            "path1": {
              "name": "Whole Number",
              "steps": [
                "If fractional remainder is < 0.09375 (3/32), format as integer (e.g., '48')"
              ]
            },
            "path2": {
              "name": "Fractional",
              "steps": [
                "If remainder is between 0.09375 and 0.95, format as fraction (e.g., '48-1/2')"
              ]
            },
            "path3": {
              "name": "Round Up",
              "steps": [
                "If remainder is > 0.95, round up to next integer (e.g., '49')"
              ]
            }
          },
          {
            "condition": "Text Display Properties",
            "path1": {
              "name": "Yes",
              "steps": [
                "Execute dp.draw() command for the specific text item"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skip drawing command for the specific text item"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "(Implicit) Script fails to run or exits silently if no viewport selected.",
            "recovery": "User must select a valid viewport during insertion."
          },
          {
            "check": "Element Validity",
            "errorMessage": "(Implicit) Script returns early if Viewport does not contain a valid hsb Element (Wall).",
            "recovery": "Ensure the selected viewport is looking at a valid wall/element."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify OPM Properties",
            "how": "Select Script Entity -> Properties Palette",
            "effect": "Change Visibility (Yes/No) of Sill/Head/Module/RO. Adjust Text Offsets, Prefixes, Text Height, and Dimension Source. Changes apply on Recalculate."
          },
          {
            "action": "Reset to Defaults",
            "how": "Set 'Set To Brockport Defaults' property to 'Yes' in OPM",
            "effect": "Resets all properties to the hardcoded Brockport standard values on next run."
          },
          {
            "action": "Update Geometry",
            "how": "Modify Wall/Opening in Model -> Right Click Script -> Recalculate",
            "effect": "Text updates to reflect new opening sizes and positions."
          }
        ]
      },
      "tokens_used": 9591,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_PLOT_OPENING_TEXT\n\n## Overview\nThis script automatically annotates wall openings in Paper Space with text labels such as Sill Height, Head Height, Module Name, and Rough Opening (RO) dimensions. It reads the geometry from a selected viewport displaying a wall in Model Space and generates formatted text labels on the layout.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | The script is intended to be inserted and used within a Layout tab. |\n| Paper Space | Yes | This is the primary environment. The script calculates coordinates from Model Space and draws text in Paper Space. |\n| Shop Drawing | No | This is a general annotation tool for layouts. |\n\n## Prerequisites\n- **Required Entities**: A Layout tab containing a viewport that displays a Wall Element with Openings.\n- **Minimum Beam Count**: 0 (Requires a Wall/Element, not individual beams).\n- **Required Settings**: A valid Dimension Style name must be specified in the `DimStyle` property if the default does not exist in the drawing.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_PLOT_OPENING_TEXT.mcr`\n\n### Step 2: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the viewport border within the Layout tab that displays the wall you wish to annotate.\n```\n\n### Step 3: Configure Properties (Optional)\nAfter insertion, the script runs immediately. To adjust labels, select the script entity in the drawing and open the **Properties** palette (Ctrl+1). Adjust text visibility, offsets, or prefixes there.\n\n### Step 4: Update\nIf the wall geometry changes, right-click the script entity and select **Recalculate** to update the text positions and values.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| DimStyle | Text | (Empty) | The dimension style to use for text appearance. |\n| Display Sill Height | Dropdown | Yes | Shows or hides the Sill Height text. |\n| Sill Prefix | Text | \"Sill: \" | Text placed before the sill height value. |\n| Display Head Height | Dropdown | Yes | Shows or hides the Head Height text. |\n| Head Height Prefix | Text | \"Head: \" | Text placed before the head height value. |\n| Display Module Name | Dropdown | Yes | Shows or hides the Module Name. |\n| Module Prefix | Text | (Empty) | Text placed before the module name. |\n| Display RO | Dropdown | Yes | Shows or hides the Rough Opening size. |\n| RO Prefix | Text | \"RO: \" | Text placed before the RO value. |\n| Take Opening Properties from | Dropdown | Framed hole | Determines dimensions: 'Framed hole' (calculated geometry) or 'Opening size' (standard properties). |\n| Offset Text | Number | 0.6 | General offset distance for the text. |\n| Offset All Text-X | Number | 0.6 | Horizontal offset for the text block. |\n| Offset All Text-Y | Number | 0.6 | Vertical offset for the text block. |\n| Text Height | Number | 1 | The height of the text characters in Paper Space units. |\n| Scale output by | Number | 1 | A multiplier factor for the text size. |\n| Set To Brockport Defaults | Dropdown | Yes | If set to 'Yes', resets all properties to standard Brockport settings and reverts to 'No'. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the text positions and values based on any changes made to the wall or openings in Model Space. |\n\n## Settings Files\n- **Filename**: None specified.\n- **Location**: N/A\n- **Purpose**: This script relies on internal property settings rather than external XML files.\n\n## Tips\n- **Resetting Settings**: If your text looks messy or offsets are wrong, set `Set To Brockport Defaults` to \"Yes\" in the properties panel and Recalculate to restore standard settings.\n- **Fractional Formatting**: The script automatically formats dimensions as fractional inches (e.g., 48-1/2). It simplifies to whole numbers if the fraction is very small (less than 3/32\").\n- **Common Headers**: If a header spans multiple openings (e.g., a garage door header), the script is smart enough to ignore that header beam when searching for the Module Name, preventing incorrect labeling.\n- **Text Clutter**: If openings are close together, the script automatically staggers (stacks) the text to prevent overlap.\n\n## FAQ\n- **Q: Why did the text not appear?**\n  A: Ensure the selected viewport actually contains a valid Wall element. Also, check the Properties palette to ensure `Display Sill Height`, `Display Head Height`, etc., are set to \"Yes\".\n- **Q: The dimensions shown don't match my rough opening sizes.**\n  A: Change the property `Take Opening Properties from` from \"Framed hole\" to \"Opening size\". \"Framed hole\" calculates based on the actual timber geometry, while \"Opening size\" uses the standard opening properties.\n- **Q: How do I make the text smaller?**\n  A: Lower the `Text Height` value in the Properties palette or adjust the `Scale output by` factor."
      },
      "tokens_used": 6201,
      "error": null
    }
  }
}