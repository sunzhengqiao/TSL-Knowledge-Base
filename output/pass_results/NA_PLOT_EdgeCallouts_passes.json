{
  "filename": "NA_PLOT_EdgeCallouts.mcr",
  "status": "completed",
  "total_tokens": 41805,
  "processing_time": 837.6241734027863,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7351,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "getViewport(T('Select a viewport')); _Viewport.append(vp); CoordSys ms2ps = vp.coordSys(); File comment: 'For use on a static HSB Viewport in PS'"
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "Sip"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space layout with an active Viewport",
          "requiredSettings": [
            "_DimStyles"
          ]
        }
      },
      "tokens_used": 7062,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "dynamicInteractions": [
            {
              "trigger": "Context Menu: Rename data",
              "function": "getString",
              "promptOriginal": "New Text to be displayed",
              "condition": "_kExecuteKey == stRenameDim"
            },
            {
              "trigger": "Context Menu: Rename data",
              "function": "PrPoint",
              "promptOriginal": "Select points near the text to rename",
              "condition": "_kExecuteKey == stRenameDim"
            },
            {
              "trigger": "Context Menu: Hide data",
              "function": "PrPoint",
              "promptOriginal": "Select points near the text to hide",
              "condition": "_kExecuteKey == stHideDim"
            }
          ]
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "psDimStyle",
            "type": "PropString",
            "displayName": "Dimension Style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "dataSource": "_DimStyles",
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "pdOffset",
            "type": "PropDouble",
            "displayName": "Connection Label Offset",
            "defaultValue": "0.2 inch",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "psLabelChoices",
            "type": "PropString",
            "displayName": "Label All Edges",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "pdKingTrimOffset",
            "type": "PropDouble",
            "displayName": "King-Trimmer Offset",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "pdMaxReportD",
            "type": "PropDouble",
            "displayName": "Max ReportDepth",
            "defaultValue": "6 inch",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "psLine1Context",
            "type": "PropString",
            "displayName": "Title 1 Context",
            "defaultValue": "Element",
            "inputType": "dropdown",
            "options": [
              "Element",
              "Sip"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "pdLabelTextH",
            "type": "PropDouble",
            "displayName": "Label Text Height",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "psLine1Prefix",
            "type": "PropString",
            "displayName": "Title 1 Prefix",
            "defaultValue": "Wall",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "psLine1Format",
            "type": "PropString",
            "displayName": "Title 1 Format",
            "defaultValue": "@(ElementNumber)",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "pdTitleTextH",
            "type": "PropDouble",
            "displayName": "Title Text Height",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "psLine2Prefix",
            "type": "PropString",
            "displayName": "Title 2 Prefix",
            "defaultValue": "Sip",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "pdTitleSpacing",
            "type": "PropDouble",
            "displayName": "Title Spacing Ratio",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "psLine2Context",
            "type": "PropString",
            "displayName": "Title 1 Context",
            "defaultValue": "Element",
            "inputType": "dropdown",
            "options": [
              "Element",
              "Sip"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "psLine2Format",
            "type": "PropString",
            "displayName": "Title 1 Format",
            "defaultValue": "@(Style)",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "piTitleColor",
            "type": "PropInt",
            "displayName": "Title Color",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Reset display data",
            "handler": "stResetDims",
            "action": "Clears the stored display map (mpDraw), forcing a regeneration of labels and positions.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Hide data",
            "handler": "stHideDim",
            "action": "Prompts user to select points near text; sets a 'bHideThis' flag on the corresponding map entries to prevent drawing.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Rename data",
            "handler": "stRenameDim",
            "action": "Prompts user for a new string and to select points near text; updates the 'stText' field for the corresponding map entries.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9670,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automates the annotation of Structural Insulated Panel (SIP) walls and roofs in Paper Space, including edge connection labels, header sizes, and element title blocks.\",\n    \"category\": \"ShopDrawing\",\n    \"typicalUseCase\": \"Used during the creation of production drawings to automatically dimension and label panel lumber connections (e.g., 2x splines, blocking) and identify wall/roof sections within a viewport.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"psDimStyle\",\n      \"technicalDefault\": \"\\\"\\\"\",\n      \"businessMeaning\": \"The CAD dimension style standard used to control the font, arrow size, and scale of all generated labels and dimensions.\",\n      \"validRange\": \"Any existing DimStyle in the current drawing template\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Controls the visual appearance (text size, arrowheads) of the connection labels. Used as the base unless overridden by specific text height properties.\"\n    },\n    {\n      \"name\": \"pdOffset\",\n      \"technicalDefault\": \"0.2 inch\",\n      \"businessMeaning\": \"The gap distance between the structural element (panel edge or header) and the start of the text label.\",\n      \"validRange\": \"0.05 - 0.5 inch\",\n      \"unit\": \"Length (inch/mm)\",\n      \"affectsOutput\": \"Moves the generated text closer to or further from the geometry to ensure legibility and avoid overlapping lines.\"\n    },\n    {\n      \"name\": \"psLabelChoices\",\n      \"technicalDefault\": \"\\\"Yes\\\"\",\n      \"businessMeaning\": \"Determines the density of labeling. 'Yes' labels every edge of the panels; 'No' limits labels to critical connections (openings, ends) or specific conditions defined in the script.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Reduces or increases the total number of callouts on the drawing to prevent clutter.\"\n    },\n    {\n      \"name\": \"pdKingTrimOffset\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"A specific adjustment for label placement near openings (windows/doors) to clear King and Trimmer studs.\",\n      \"validRange\": \"0 - 12 inch\",\n      \"unit\": \"Length (inch/mm)\",\n      \"affectsOutput\": \"Shifts the text position of labels located at jambs to ensure they do not overlap the framing lumber.\"\n    },\n    {\n      \"name\": \"pdMaxReportD\",\n      \"technicalDefault\": \"6 inch\",\n      \"businessMeaning\": \"The maximum depth threshold for reporting connection details or spline dimensions. Features deeper than this may be ignored or handled differently depending on internal logic.\",\n      \"validRange\": \"0 - 24 inch\",\n      \"unit\": \"Length (inch/mm)\",\n      \"affectsOutput\": \"Filters which manufacturing features receive a callout based on their depth, preventing labels for minor surface grooves.\"\n    },\n    {\n      \"name\": \"psLine1Context\",\n      \"technicalDefault\": \"\\\"Element\\\"\",\n      \"businessMeaning\": \"Selects the data source for the first line of the title block.\",\n      \"validRange\": \"Element, Sip\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Switches the data retrieved between the overall Element (Wall/Roof) properties and the specific Sip (Panel) properties.\"\n    },\n    {\n      \"name\": \"psLine1Prefix\",\n      \"technicalDefault\": \"\\\"Wall\\\"\",\n      \"businessMeaning\": \"Static text displayed before the dynamic data in the first line of the title.\",\n      \"validRange\": \"Any short string (e.g., 'Wall', 'Roof', 'Panel')\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Adds a descriptive label to the title (e.g., turns '101' into 'Wall 101').\"\n    },\n    {\n      \"name\": \"psLine1Format\",\n      \"technicalDefault\": \"\\\"@(ElementNumber)\\\"\",\n      \"businessMeaning\": \"The template code defining which specific property to display (e.g., ElementNumber, Elevation, Length) on the first line.\",\n      \"validRange\": \"Valid hsbCAD property string (e.g., '@(ElementNumber)', '@(Width)')\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Changes the actual data value shown in the title block.\"\n    },\n    {\n      \"name\": \"psLine2Prefix\",\n      \"technicalDefault\": \"\\\"Sip\\\"\",\n      \"businessMeaning\": \"Static text displayed before the dynamic data in the second line of the title.\",\n      \"validRange\": \"Any short string\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Adds a sub-label to the title (e.g., 'Sip Standard').\"\n    },\n    {\n      \"name\": \"psLine2Context\",\n      \"technicalDefault\": \"\\\"Element\\\"\",\n      \"businessMeaning\": \"Selects the data source for the second line of the title block.\",\n      \"validRange\": \"Element, Sip\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Switches the data retrieved for the subtitle between Element or Sip properties.\"\n    },\n    {\n      \"name\": \"psLine2Format\",\n      \"technicalDefault\": \"\\\"@(Style)\\\"\",\n      \"businessMeaning\": \"The template code defining which specific property to display on the second line.\",\n      \"validRange\": \"Valid hsbCAD property string\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Changes the actual data value shown in the second line of the title.\"\n    },\n    {\n      \"name\": \"piTitleColor\",\n      \"technicalDefault\": \"-1\",\n      \"businessMeaning\": \"The CAD color index used for the Title Block text.\",\n      \"validRange\": \"0 - 255 (or -1 for ByLayer)\",\n      \"unit\": \"Integer (Color Index)\",\n      \"affectsOutput\": \"Changes the color of the main title to distinguish it from dimension labels.\"\n    },\n    {\n      \"name\": \"pdLabelTextH\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"An explicit override for the height of the connection labels (e.g., '2x4').\",\n      \"validRange\": \"0 - 1.0 inch (0 = use DimStyle default)\",\n      \"unit\": \"Length (inch/mm)\",\n      \"affectsOutput\": \"If set to non-zero, ignores the DimStyle text height and forces labels to this specific size.\"\n    },\n    {\n      \"name\": \"pdTitleTextH\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\":"
      },
      "tokens_used": 11087,
      "error": null
    },
    "5": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "Request timeout after retries"
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# NA_PLOT_EdgeCallouts.mcr\n\n## Overview\nThis script automates the annotation of Structural Insulated Panel (SIP) walls and roofs directly in Paper Space. It generates labels for edge connections (e.g., lumber splines), header sizes, and creates a customizable title block for the element within a selected viewport.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for Paper Space annotations. |\n| Paper Space | Yes | Requires a viewport showing the model. |\n| Shop Drawing | Yes | Intended for creating production drawings. |\n\n## Prerequisites\n- **Required Entities**: A viewport containing an Element (Wall or Roof) with Sip (Structural Insulated Panel) sub-components.\n- **Minimum Beams**: None (Operates on Element/Sip entities).\n- **Required Settings**: The drawing must contain defined Dimension Styles (referenced as `_DimStyles`).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `NA_PLOT_EdgeCallouts.mcr`\n\n### Step 2: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the border of the viewport in Paper Space that displays the wall or roof you wish to annotate.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimension Style | dropdown | (Current) | Select the CAD Dimension Style to control text font and arrow size for labels. |\n| Connection Label Offset | number | 0.2 inch | The distance between the panel edge and the start of the label text. |\n| Label All Edges | dropdown | Yes | Set to \"Yes\" to label every edge; set to \"No\" to label only critical connections. |\n| King-Trimmer Offset | number | 0 | Adjusts label position at window/door openings to clear King and Trimmer studs. |\n| Max ReportDepth | number | 6 inch | Maximum depth of a feature to generate a label. Deeper features may be ignored. |\n| Title 1 Context | dropdown | Element | Source for the first title line: Element (overall wall) or Sip (specific panel). |\n| Title 1 Prefix | text | Wall | Static text placed before the dynamic data in Title 1 (e.g., \"Wall\", \"Roof\"). |\n| Title 1 Format | text | @(ElementNumber) | The data code displayed in Title 1 (e.g., @(ElementNumber), @(Length)). |\n| Title 2 Context | dropdown | Element | Source for the second title line: Element or Sip. |\n| Title 2 Prefix | text | Sip | Static text placed before the dynamic data in Title 2. |\n| Title 2 Format | text | @(Style) | The data code displayed in Title 2. |\n| Title Color | number | -1 | The CAD color index for the title block text (-1 = ByLayer). |\n| Label Text Height | number | 0 | Height of the connection labels. Set to 0 to use the Dimension Style default. |\n| Title Text Height | number | 0 | Height of the title text. Set to 0 to use the Dimension Style default. |\n| Title Spacing Ratio | number | 1 | The spacing factor between Title 1 and Title 2. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Reset display data | Clears all stored positions and settings for the labels, forcing a complete redraw of all annotations. |\n| Hide data | Prompts you to select text labels near the geometry to hide them from the drawing. |\n| Rename data | Prompts you to select a text label and enter a new string to manually override the displayed text. |\n\n## Settings Files\n- **Reference**: `_DimStyles`\n- **Location**: Current Drawing\n- **Purpose**: Provides the list of available Dimension Styles to format the text and arrows used in the callouts.\n\n## Tips\n- **Reducing Clutter**: If your drawing is too busy, change **Label All Edges** to \"No\". This will limit labels to major connections and openings.\n- **Manual Adjustments**: If an automatic label lands in a bad spot, use the **Rename data** or **Hide data** context menu options rather than exploding the script. This preserves the link to the model.\n- **Formatting Titles**: Use the **Title Format** fields to pull specific data like @(ElementNumber) or @(Elevation) to automate your title blocks.\n\n## FAQ\n- **Q: My labels are overlapping the framing lumber at windows.**\n  - **A:** Increase the **King-Trimmer Offset** property value. This shifts labels away from the rough opening jambs.\n- **Q: How do I change the text size without changing the Dimension Style?**\n  - **A:** Enter a specific value (in inches or mm) in the **Label Text Height** or **Title Text Height** properties. Setting this to 0 respects the CAD DimStyle.\n- **Q: Can I label a flat roof?**\n  - **A:** Yes, provided the geometry in the viewport is recognized as an Element with Sip entities. The script detects walls and roofs similarly."
      },
      "tokens_used": 6635,
      "error": null
    }
  }
}