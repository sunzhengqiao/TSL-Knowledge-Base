{
  "filename": "GE_WALLS_MITER_TO_MITER_ANGLED.mcr",
  "status": "completed",
  "total_tokens": 56529,
  "processing_time": 458.8045392036438,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9307,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses '_bOnInsert' and 'PrEntity' for interactive selection of Elements. It casts inputs to 'ElementWall' and performs 3D geometric operations (Body creation, Beam dbErase, Sheet cutting). No references to '_Viewport', 'sd_' prefixes, or '#Type E' found."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall",
            "ElementWall"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "\\Utilities\\hsbFramingDefaultsEditor\\hsbFramingDefaults.Inventory.dll",
            "_kPathHsbCompany",
            "_kPathHsbWallDetail"
          ]
        }
      },
      "tokens_used": 7020,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\n|Select 2 angled elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "|Connection type|",
            "defaultValue": "|Mitered End with Assembly|",
            "inputType": "dropdown",
            "options": [
              "|Mitered End with Assembly|",
              "|Mitered end without assembly|",
              "|Squared end|",
              "|Beveled Edge Stud| (|Stud length|)",
              "|Beveled Edge Stud| (|Wall length|)",
              "|Beveled stud not split|",
              "|Beveled stud splitted|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sLapTopPlates",
            "type": "PropString",
            "displayName": "|Lap top plates|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sSwitchLap",
            "type": "PropString",
            "displayName": "|Switch lap side|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dVTPLapLimits",
            "type": "PropDouble",
            "displayName": "VTP|Lap limits|",
            "defaultValue": "3.175mm / 0.125in",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dSheetingLimits",
            "type": "PropDouble",
            "displayName": "|Sheeting limits|",
            "defaultValue": "3.175mm / 0.125in",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sDummy1",
            "type": "PropString",
            "displayName": " ",
            "defaultValue": " ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sDummy2",
            "type": "PropString",
            "displayName": "",
            "defaultValue": "- |All new beams info|",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "strCustomProps",
            "type": "PropString",
            "displayName": "|Apply custom properties to new beams|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": "|If YES, beams will have properties set by user in the next lines. If not, beams will get properties from wall settings|"
          },
          {
            "index": 8,
            "variable": "sNewBeamsName",
            "type": "PropString",
            "displayName": "|Name|",
            "defaultValue": "SYP #2 2x4",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "sNewBeamsMaterial",
            "type": "PropString",
            "displayName": "|Material|",
            "defaultValue": "SYP",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 10,
            "variable": "sNewBeamsGrade",
            "type": "PropString",
            "displayName": "|Grade|",
            "defaultValue": "#2",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 11,
            "variable": "sNewBeamsInformation",
            "type": "PropString",
            "displayName": "|Information|",
            "defaultValue": "STUD",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 12,
            "variable": "sNewBeamsLabel",
            "type": "PropString",
            "displayName": "|Label|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 13,
            "variable": "sNewBeamsSublabel",
            "type": "PropString",
            "displayName": "|Sublabel|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 14,
            "variable": "sNewBeamsSublabel2",
            "type": "PropString",
            "displayName": "|Sublabel2|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 15,
            "variable": "sNewBeamsCode",
            "type": "PropString",
            "displayName": "|Beam code|",
            "defaultValue": ";;;;;;;;;;;;;",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 16,
            "variable": "nBmColor",
            "type": "PropInt",
            "displayName": "|Beam color|",
            "defaultValue": 3,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "\\Utilities\\hsbFramingDefaultsEditor\\hsbFramingDefaults.Inventory.dll",
            "searchPaths": [
              "_kPathHsbInstall"
            ],
            "purpose": "Retrieves Lumber Item data to populate potential dropdown lists (though no dynamic dropdown using this data is defined in the OPM section).",
            "required": true
          }
        ]
      },
      "tokens_used": 9168,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the connection of two angled walls (miter-to-miter) by trimming interfering studs, creating corner filler beams (beveled or mitered), lapping top plates, and cutting sheathing.",
          "category": "Framing",
          "typicalUseCase": "Joining two walls that meet at an angle other than 90 or 180 degrees (e.g., chamfered corners or angled bay windows) to ensure structural continuity and sheathing fit."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "|Mitered End with Assembly|",
            "businessMeaning": "Determines the geometric strategy for the corner connection. Defines whether to create a solid corner assembly, simple mitered ends, or specific beveled studs, and how those studs are sized.",
            "validRange": "Dropdown selection",
            "unit": "Selection",
            "affectsOutput": "Determines if new corner beams are created, if they are beveled or mitered, and whether the connection generates a sub-assembly group."
          },
          {
            "name": "sLapTopPlates",
            "technicalDefault": "|No|",
            "businessMeaning": "Controls whether the top plates of the two walls overlap (lap) at the intersection or simply butt against each other.",
            "validRange": "Yes/No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, top plates are extended and trimmed to overlap; if No, they are terminated at the intersection point."
          },
          {
            "name": "sSwitchLap",
            "technicalDefault": "|No|",
            "businessMeaning": "Specifies which wall's top plate sits on top of the other when lapping.",
            "validRange": "Yes/No",
            "unit": "Boolean",
            "affectsOutput": "Swaps the vertical ordering of the top plates (Z-height difference) at the overlap."
          },
          {
            "name": "dVTPLapLimits",
            "technicalDefault": "3.175mm",
            "businessMeaning": "A clearance or offset distance applied to the top plates during the lapping operation.",
            "validRange": "0mm - 25mm",
            "unit": "Length",
            "affectsOutput": "Adjusts the geometry of the top plate overlap to prevent geometric clashes or create specific gaps."
          },
          {
            "name": "dSheetingLimits",
            "technicalDefault": "3.175mm",
            "businessMeaning": "The offset distance for the sheathing cut line from the theoretical wall intersection.",
            "validRange": "0mm - 50mm",
            "unit": "Length",
            "affectsOutput": "Controls the gap between the sheathing panels on the two intersecting walls."
          },
          {
            "name": "strCustomProps",
            "technicalDefault": "|No|",
            "businessMeaning": "Switch to use manual property settings for newly created beams instead of inheriting from the parent wall.",
            "validRange": "Yes/No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, new corner beams use the specific Material/Grade/Name defined below. If No, they copy properties from the wall defaults."
          },
          {
            "name": "sNewBeamsName",
            "technicalDefault": "SYP #2 2x4",
            "businessMeaning": "The stock name/material designation for new beams.",
            "validRange": "Text",
            "unit": "String",
            "affectsOutput": "Sets the 'Name' attribute (e.g., for BOM or scheduling) of new corner beams."
          },
          {
            "name": "sNewBeamsMaterial",
            "technicalDefault": "SYP",
            "businessMeaning": "The material species/type.",
            "validRange": "Text",
            "unit": "String",
            "affectsOutput": "Sets the material property for new beams."
          },
          {
            "name": "sNewBeamsGrade",
            "technicalDefault": "#2",
            "businessMeaning": "The structural grade of the lumber.",
            "validRange": "Text",
            "unit": "String",
            "affectsOutput": "Sets the grade property for new beams."
          },
          {
            "name": "sNewBeamsInformation",
            "technicalDefault": "STUD",
            "businessMeaning": "Usage classification or additional info field.",
            "validRange": "Text",
            "unit": "String",
            "affectsOutput": "Sets the 'Information' attribute (often used for filtering or labels)."
          },
          {
            "name": "sNewBeamsLabel",
            "technicalDefault": "",
            "businessMeaning": "Primary label text.",
            "validRange": "Text",
            "unit": "String",
            "affectsOutput": "Sets the visible label on the beam in drawings."
          },
          {
            "name": "nBmColor",
            "technicalDefault": "3",
            "businessMeaning": "Visual color of the new beams in the CAD model.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Integer",
            "affectsOutput": "Changes the display color of the generated beams."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sLapTopPlates = |Yes|",
            "effect": "Enables the logic to switch the lap side.",
            "cascade": [
              "sSwitchLap"
            ]
          },
          {
            "trigger": "strCustomProps = |Yes|",
            "effect": "Activates the use of the subsequent property fields for new beams.",
            "cascade": [
              "sNewBeamsName",
              "sNewBeamsMaterial",
              "sNewBeamsGrade",
              "sNewBeamsInformation",
              "sNewBeamsLabel",
              "sNewBeamsSublabel",
              "sNewBeamsSublabel2",
              "sNewBeamsCode",
              "nBmColor"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam",
            "description": "New corner studs or posts (beveled or mitered depending on sType).",
            "appliedTo": "The intersection zone of the two selected walls."
          },
          {
            "type": "Cut",
            "description": "Trims on existing studs and blocking that interfere with the connection zone.",
            "appliedTo": "Existing vertical members (studs/blocking) in both walls."
          },
          {
            "type": "Cut",
            "description": "Angular cuts on wall sheeting to accommodate the corner angle.",
            "appliedTo": "Sheets on the selected walls."
          },
          {
            "type": "Geometry Modification",
            "description": "Extension and lapping of top plates.",
            "appliedTo": "Top plates of the selected walls."
          }
        ]
      },
      "tokens_used": 10514,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Load lumber inventory DLL and initialize default property values.",
          "2. User Insertion: Command line prompt to select 2 angled elements (Walls).",
          "3. Input Validation: Verify exactly 2 elements are selected and are valid ElementWalls.",
          "4. Duplicate Check: Search for existing instances of this script on the selected walls. If found matching the connection code, erase self to prevent overlap.",
          "5. Connectivity Check: Validate that Wall 1 and Wall 2 are physically touching (getConnectedElements).",
          "6. Geometry Validation: Ensure walls are not parallel or perpendicular (must be angled).",
          "7. Miter Validation: Calculate intersection of wall outlines. Result must be exactly 2 points.",
          "8. Topology Analysis: Check coincident vertices to determine 'Male' and 'Female' wall roles for the miter.",
          "9. Geometry Calculation: Calculate cleanup bodies (solid voids) based on 'Connection Type' (sType) and 'Lap' settings.",
          "10. [Conditional] Apply Lapping: If 'Lap top plates' is Yes, calculate overlap length and vertical order (Switch lap side).",
          "11. Clean Existing Members: Iterate through vertical studs and blocking in both walls.",
          "12. Interference Removal: If an existing stud/blocking envelope intersects the cleanup body, delete it (dbErase).",
          "13. Generate New Beams: Create corner filler beams/posts based on the selected connection type.",
          "14. [Conditional] Apply Properties: If 'Apply custom properties' is Yes, use OPM settings; otherwise, copy properties from a source stud in the wall.",
          "15. Process Sheeting: Iterate through wall sheets.",
          "16. Cut Sheeting: Calculate offset cut line (based on Sheeting Limits) and add static cut tool to sheets overlapping the corner.",
          "17. Finalize: Set Execution Mode to 1, store Connection Code in map, and draw display symbol."
        ],
        "conditionalBranches": [
          {
            "condition": "sLapTopPlates (Lap top plates) selection",
            "path1": {
              "name": "Lap Top Plates = Yes",
              "steps": [
                "Script calculates the geometry required to overlap the top plates of the two walls.",
                "Checks sSwitchLap to determine which wall's top plate sits on top (vertical offset).",
                "Uses dVTPLapLimits to define the gap or offset of the lapping plates."
              ]
            },
            "path2": {
              "name": "Lap Top Plates = No",
              "steps": [
                "Top plates are treated as standard butt ends.",
                "Geometry calculation proceeds without overlap logic."
              ]
            }
          },
          {
            "condition": "strCustomProps (Apply custom properties) selection",
            "path1": {
              "name": "Custom Props = Yes",
              "steps": [
                "New beams created in the corner get their Name, Material, Grade, Information, etc., explicitly from the OPM properties (e.g., 'SYP #2 2x4')."
              ]
            },
            "path2": {
              "name": "Custom Props = No",
              "steps": [
                "Script searches the existing wall structure for a valid stud to sample properties from.",
                "New beams inherit the attributes (Name, Material, Code, etc.) of that sampled stud."
              ]
            }
          },
          {
            "condition": "Topological Validation (Male/Female Check)",
            "path1": {
              "name": "Valid Miter Geometry",
              "steps": [
                "Both walls share exactly 2 coincident vertices with the intersection points.",
                "Proceeds to generation."
              ]
            },
            "path2": {
              "name": "Invalid Geometry",
              "steps": [
                "Intersection points != 2 OR vertices do not match.",
                "Report Error: 'Not a miter to miter connection'.",
                "Script instance is erased (cancelled)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Count",
            "errorMessage": "N/A (Internal Erasure)",
            "recovery": "User must select exactly 2 walls during the PrEntity prompt."
          },
          {
            "check": "Element Validity",
            "errorMessage": "N/A (Internal Erasure)",
            "recovery": "User must select valid 'ElementWall' entities, not generic solids or other objects."
          },
          {
            "check": "Wall Connectivity",
            "errorMessage": "\\nERROR: Selected walls are not in contact",
            "recovery": "User must ensure the two selected walls are touching in the 3D model."
          },
          {
            "check": "Wall Angle",
            "errorMessage": "\\nERROR: Walls cannot be perpendicular or parallel",
            "recovery": "User must use this script only for angled connections (e.g., bay windows, chamfers) excluding 90 or 180 degrees."
          },
          {
            "check": "Miter Intersection Points",
            "errorMessage": "\\nERROR: This is not a miter to miter connection, or the connection is not cleaned up. Tsl will be erased",
            "recovery": "Ensure wall outlines intersect properly. Clean up wall geometry if overlapping weirdly."
          },
          {
            "check": "Vertex Coincidence",
            "errorMessage": "\\nERROR: This is not a miter to miter connection, cannot apply this tsl on this type of connection",
            "recovery": "Verify the wall ends meet cleanly (end-to-end miter) rather than a T-connection or complex overlap."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Connection Type",
            "how": "OPM Properties Palette",
            "effect": "Changes the geometric logic (e.g., from 'Mitered End' to 'Squared end'), requiring regeneration of corner beams and re-cleaning of studs."
          },
          {
            "action": "Modify Lapping Settings",
            "how": "OPM Properties Palette (Lap top plates, Switch lap side)",
            "effect": "Regenerates the top plate geometry at the intersection to overlap or switch vertical ordering."
          },
          {
            "action": "Adjust Limits",
            "how": "OPM Properties Palette (VTP Lap limits, Sheeting limits)",
            "effect": "Updates the size of the gap/offset for the lapping plates and the distance of the sheathing cut line."
          },
          {
            "action": "Change Beam Properties",
            "how": "OPM Properties Palette (Apply custom properties, Name, Material, etc.)",
            "effect": "Updates the attributes of the generated corner beams. If 'Apply custom properties' is toggled, it switches the source of these attributes."
          }
        ]
      },
      "tokens_used": 12681,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_WALLS_MITER_TO_MITER_ANGLED.mcr\n\n## Overview\nAutomates the connection of two angled walls (e.g., bay windows or chamfered corners) by trimming interfering studs, creating corner filler beams, lapping top plates, and cutting sheathing to fit the miter angle.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be applied to 3D wall elements. |\n| Paper Space | No | Not intended for layout or detailing views. |\n| Shop Drawing | No | Not intended for generating 2D outputs directly. |\n\n## Prerequisites\n- **Required Entities**: 2 `ElementWall` entities that physically touch each other.\n- **Geometry**: Walls must meet at an angle (cannot be parallel or perpendicular/90°).\n- **Required Settings**: `hsbFramingDefaults.Inventory.dll` (must be present in the hsbCAD install path).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Browse and select `GE_WALLS_MITER_TO_MITER_ANGLED.mcr`\n\n### Step 2: Select Walls\n```\nCommand Line: |Select 2 angled elements|\nAction: Click on the first wall, then click on the second wall that forms the angled corner.\n```\n\n### Step 3: Configure Properties\nAfter selection, the Properties Palette (OPM) will display the script parameters. Adjust the connection type, lapping options, and material properties as needed. The model updates automatically based on these changes.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Connection type | dropdown | Mitered End with Assembly | Determines the geometry of the corner (e.g., Mitered, Squared, Beveled Stud). |\n| Lap top plates | dropdown | No | If Yes, the top plates of the two walls will overlap at the corner. |\n| Switch lap side | dropdown | No | Toggles which wall's top plate sits on top of the other (vertical ordering). |\n| VTP|Lap limits| | number | 3.175mm | The clearance or offset distance applied to top plates during lapping. |\n| Sheeting limits | number | 3.175mm | The offset distance from the intersection for cutting the wall sheathing. |\n| Apply custom properties to new beams | dropdown | No | If Yes, new corner beams use the specific properties defined below. If No, they inherit properties from the wall. |\n| Name | text | SYP #2 2x4 | The stock name for new corner beams (active if Custom Props is Yes). |\n| Material | text | SYP | The material species for new corner beams. |\n| Grade | text | #2 | The structural grade for new corner beams. |\n| Information | text | STUD | Usage classification for new corner beams. |\n| Label | text | | Primary label text for new beams. |\n| Sublabel | text | | Secondary label text. |\n| Sublabel2 | text | | Additional label text. |\n| Beam code | text | ;;;;;;;;;;;;; | Semicolon-separated code string for new beams. |\n| Beam color | integer | 3 | The AutoCAD color index for new beams. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add custom items to the right-click context menu. Edit parameters via the Properties Palette. |\n\n## Settings Files\n- **Filename**: `hsbFramingDefaults.Inventory.dll`\n- **Location**: `_kPathHsbInstall` (hsbCAD Installation Directory)\n- **Purpose**: Provides access to the lumber inventory database for beam properties.\n\n## Tips\n- **Wall Angle**: This script is designed specifically for *angled* connections (miter-to-miter). It will erase itself if applied to standard 90° corners or parallel walls.\n- **Top Plate Lapping**: Use the \"Switch lap side\" option to resolve structural sequencing requirements where one top plate must run continuously over the other.\n- **Custom Properties**: Use \"Apply custom properties to new beams\" if the corner requires a different grade or material than the rest of the wall framing (e.g., a pressure-treated post in a bay window).\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the walls?**\n  A: The script performs validation checks. It will erase itself if the walls are not touching, are parallel, or form a 90° angle.\n- **Q: Can I use this for a 90-degree corner?**\n  A: No. This script is specifically for angled (mitered) connections.\n- **Q: How do I change the gap between the sheathing panels?**\n  A: Adjust the \"Sheeting limits\" parameter in the Properties Panel.\n- **Q: The corner studs aren't the same size as the wall studs.**\n  A: Check the \"Apply custom properties to new beams\" setting. If it is set to \"Yes\", ensure the \"Name\" and dimensions match your requirements. If set to \"No\", the script copies properties from existing studs in the wall."
      },
      "tokens_used": 7839,
      "error": null
    }
  }
}