{
  "filename": "hsb_Apply Glue to Elements.mcr",
  "status": "completed",
  "total_tokens": 51963,
  "processing_time": 218.66072130203247,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 2,
          "minorVersion": 4,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl creates ",
        "versionHistory": [
          {
            "version": "2.4",
            "date": "05okt2020",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-7955: subtract the glue areas, support catalogues"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "hsb_GlueArea.mcr"
        ]
      },
      "tokens_used": 7307,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select 'Elements' and operates on Element geometry (zones, sheets, profiles). It uses dbCreate to attach child TSL instances (hsb_GlueArea) to the Element in 3D space. It does not use _Viewport, sd_* prefixes, or any Paper Space specific drawing commands."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsb_GlueArea.mcr"
          ]
        }
      },
      "tokens_used": 7108,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && _kExecuteKey == \"\"",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select one or More Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "On Insert (if no catalog key provided)",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nZones1",
            "type": "PropInt",
            "displayName": "Zone to be Glued",
            "defaultValue": "0",
            "inputType": "dropdown",
            "options": [
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "10"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nRefZ1",
            "type": "PropInt",
            "displayName": "Glue Reference Zone",
            "defaultValue": "0",
            "inputType": "dropdown",
            "options": [
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "10"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "nToolingIndexLine",
            "type": "PropInt",
            "displayName": "Tool index Line",
            "defaultValue": "51",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "nToolingIndexArea",
            "type": "PropInt",
            "displayName": "Tool index Area",
            "defaultValue": "52",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dSizeGlueArea",
            "type": "PropDouble",
            "displayName": "Size Glue Area",
            "defaultValue": "360.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dOriginXOffset",
            "type": "PropDouble",
            "displayName": "|Origin X offset|",
            "defaultValue": "0.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dOriginYOffset",
            "type": "PropDouble",
            "displayName": "|Origin Y offset|",
            "defaultValue": "0.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dMinimumWidthToCreateGlueArea",
            "type": "PropDouble",
            "displayName": "|Minimum width to create glue area|",
            "defaultValue": "200.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dMinimumGlueLineLength",
            "type": "PropDouble",
            "displayName": "|Minimum length of glue line|",
            "defaultValue": "200.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Reapply Glue",
            "handler": "Reapply Glue",
            "action": "Resets ExecutionMode to 0, triggering the glue generation logic to run again on the Element.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9563,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically calculates and generates CNC glue application instructions (lines or areas) on specific zones of timber elements, respecting exclusion zones defined by other scripts.",
          "category": "Manufacturing / Preparation",
          "typicalUseCase": "Preparing CLT panels or wall elements for automated gluing processes, ensuring glue is only applied to valid manufacturing layers while avoiding windows, hardware, or no-glue tags."
        },
        "parameters": [
          {
            "name": "nZones1",
            "technicalDefault": "0",
            "businessMeaning": "Specifies the manufacturing layer (Zone) of the element where the glue will be applied.",
            "validRange": "1 - 10 (based on Element composition)",
            "unit": "Zone Index",
            "affectsOutput": "Determines the 3D depth/location of the glue geometry relative to the element origin. Also triggers the deletion of existing glue definitions in this zone before regeneration."
          },
          {
            "name": "nRefZ1",
            "technicalDefault": "0",
            "businessMeaning": "Specifies the Reference Zone, usually used to determine boundaries or adjacent relationships for the glue calculation (e.g., the layer above or below the glued layer).",
            "validRange": "1 - 10",
            "unit": "Zone Index",
            "affectsOutput": "Influences the geometric calculation of where glue stops or starts relative to the reference geometry (e.g., beams or edges in the reference zone)."
          },
          {
            "name": "nToolingIndexLine",
            "technicalDefault": "51",
            "businessMeaning": "The specific CNC machine tool ID (nozzle/head) used for applying linear glue paths.",
            "validRange": "Integer (Machine specific, e.g., 1-999)",
            "unit": "Tool Index",
            "affectsOutput": "Sets the machining operation code in the generated child TSL for line segments."
          },
          {
            "name": "nToolingIndexArea",
            "technicalDefault": "52",
            "businessMeaning": "The specific CNC machine tool ID (nozzle/head) used for applying glue over larger surface areas.",
            "validRange": "Integer (Machine specific, e.g., 1-999)",
            "unit": "Tool Index",
            "affectsOutput": "Sets the machining operation code in the generated child TSL for area applications."
          },
          {
            "name": "dSizeGlueArea",
            "technicalDefault": "360.0",
            "businessMeaning": "Defines the dimension (length or side) of a standard glue application unit (e.g., the side length of a square glue blob or the spacing of the pattern).",
            "validRange": "10.0 - 2000.0 mm",
            "unit": "mm",
            "affectsOutput": "Controls the size of the geometry generated in the hsb_GlueArea script."
          },
          {
            "name": "dOriginXOffset",
            "technicalDefault": "0.0",
            "businessMeaning": "Shifts the entire glue pattern along the element's local X-axis.",
            "validRange": "-1000.0 - 1000.0 mm",
            "unit": "mm",
            "affectsOutput": "Moves the calculated glue geometry laterally on the element surface."
          },
          {
            "name": "dOriginYOffset",
            "technicalDefault": "0.0",
            "businessMeaning": "Shifts the entire glue pattern along the element's local Y-axis.",
            "validRange": "-1000.0 - 1000.0 mm",
            "unit": "mm",
            "affectsOutput": "Moves the calculated glue geometry longitudinally on the element surface."
          },
          {
            "name": "dMinimumWidthToCreateGlueArea",
            "technicalDefault": "200.0",
            "businessMeaning": "The minimum width of a surface required to generate a 'Glue Area'. If the surface is narrower, the script defaults to generating 'Glue Lines' or skips the area entirely.",
            "validRange": "50.0 - 1000.0 mm",
            "unit": "mm",
            "affectsOutput": "Acts as a filter to decide between Area vs. Line generation. Narrow surfaces get lines (if long enough), wide surfaces get areas."
          },
          {
            "name": "dMinimumGlueLineLength",
            "technicalDefault": "200.0",
            "businessMeaning": "The minimum length a glue line segment must be to be generated. Shorter segments are discarded.",
            "validRange": "10.0 - 1000.0 mm",
            "unit": "mm",
            "affectsOutput": "Filters out small, unwanted glue artifacts (e.g., splinters or small edges) that are too short to machine effectively."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dMinimumWidthToCreateGlueArea",
            "effect": "Determines if the output geometry is a closed Loop/Area or an open Line segment.",
            "cascade": [
              "nToolingIndexArea",
              "nToolingIndexLine"
            ]
          },
          {
            "trigger": "nZones1",
            "effect": "Clears existing glue instances in the selected zone before recalculating.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "hsb_GlueArea (Child TSL)",
            "description": "Generates instances of 'hsb_GlueArea' attached to the element. These contain the precise polylines (geometry) and tooling attributes required for CNC manufacturing.",
            "appliedTo": "The selected Element (in the specific manufacturing zone defined by nZones1)."
          }
        ]
      },
      "tokens_used": 9793,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User launches script (hsb_Apply Glue to Elements).",
          "2. Script checks for a Catalog Key (_kExecuteKey).",
          "3. [If no Key] Properties Dialog appears for user configuration (Zones, Tooling, Sizes).",
          "4. User selects one or more Elements (PrEntity prompt).",
          "5. Script validates selection and creates a child instance of itself attached to each selected Element.",
          "6. Parent instance erases itself.",
          "7. Child instances initialize with ExecutionMode 0 (Calculate).",
          "8. Child instances identify and erase existing 'hsb_GlueArea' TSLs in the target zone.",
          "9. Child instances scan for 'NoGlue' tags/exclusion zones from other TSLs.",
          "10. Child instances calculate valid gluing geometry on the Element.",
          "11. Child instances spawn 'hsb_GlueArea' TSLs (Manufacturing data).",
          "12. Child instance sets ExecutionMode to 1 (Done) and waits."
        ],
        "conditionalBranches": [
          {
            "condition": "Configuration Input Method",
            "path1": {
              "name": "Catalog/Silent Mode",
              "steps": [
                "Script launched with specific _kExecuteKey.",
                "Properties are loaded automatically from the catalog entry.",
                "Skips the interactive showDialog step."
              ]
            },
            "path2": {
              "name": "Interactive Dialog Mode",
              "steps": [
                "Script launched with no specific key.",
                "showDialog() is executed.",
                "User manually inputs properties before element selection."
              ]
            }
          },
          {
            "condition": "Geometric Calculation Logic (ExecutionMode 0)",
            "path1": {
              "name": "Narrow Area (Line Generation)",
              "steps": [
                "Calculated width < Minimum Width (dMinimumWidthToCreateGlueArea).",
                "OR Height is small (odd sizes).",
                "Generates single or multiple Line segments (Tool index Line)."
              ]
            },
            "path2": {
              "name": "Standard Area (Area Generation)",
              "steps": [
                "Calculated width >= Minimum Width.",
                "Height is sufficient for standard patterning.",
                "Generates Glue Area patterns (Tool index Area)."
              ]
            }
          },
          {
            "condition": "Odd Size Handling (Specific Logic)",
            "path1": {
              "name": "Very Small Height",
              "steps": [
                "Height <= Minimum Width Required (4x Shrink Profile).",
                "Height < Shrink Profile (45mm).",
                "Result: Skipped (No Glue)."
              ]
            },
            "path2": {
              "name": "Small/Odd Shape",
              "steps": [
                "Height <= Minimum Width Required but > Shrink Profile.",
                "Generates a single center line.",
                "Validates line length > Minimum Glue Line Length."
              ]
            },
            "path3": {
              "name": "Shrinkable Profile",
              "steps": [
                "Profile can be shrunk by Shrink Profile offset.",
                "Generates lines along the shrunken perimeter.",
                "Validates segment lengths > Minimum Glue Line Length."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Reference Zone vs Glue Zone",
            "errorMessage": "Reference zone should be lower than glue zone.",
            "recovery": "This is a Notice (reportNotice), not a hard stop. The script continues execution, but the logic may behave unexpectedly. User should ensure nRefZ1 <= nZones1 in properties."
          },
          {
            "check": "Element Selection",
            "errorMessage": "None (Silent failure of parent)",
            "recovery": "If no elements are selected during PrEntity, the parent script erases itself. User must run the command again and select valid Elements."
          },
          {
            "check": "Minimum Glue Line Length",
            "errorMessage": "None",
            "recovery": "Automatically filters out calculated glue lines shorter than 'dMinimumGlueLineLength' to avoid machine stops."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Reapply Glue",
            "how": "Right-click Context Menu",
            "effect": "Resets 'ExecutionMode' to 0, forcing a complete recalculation of glue geometry and regenerating child TSLs."
          },
          {
            "action": "Modify Parameters",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing properties (e.g., Zone, Size, Tool Index) usually triggers a recalc (via _bOnElementConstructed or similar flags in full environment), updating the glue geometry."
          }
        ]
      },
      "tokens_used": 11300,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_Apply Glue to Elements\n\n## Overview\nAutomatically calculates and generates CNC glue application instructions (lines or areas) on specific manufacturing layers (zones) of timber elements. It respects exclusion zones and applies specific tooling parameters for manufacturing data.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used to select 3D Elements and generate glue geometry. |\n| Paper Space | No | Not applicable for layouts or shop drawings. |\n| Shop Drawing | No | Processing occurs in the 3D model. |\n\n## Prerequisites\n- **Required Entities**: One or more `Elements` (e.g., walls, floors, CLT panels).\n- **Minimum Beam Count**: N/A (Operates on Elements).\n- **Required Settings Files**: \n  - `hsb_GlueArea.mcr` (Must be present in the TSL search path).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT`\n**Action:** Browse and select `hsb_Apply Glue to Elements.mcr`.\n\n### Step 2: Configure Properties\n**Action:** If running the script manually (not from a catalog), a properties dialog or the Properties Palette will appear.\n- Set the **Zone to be Glued** (e.g., Layer 1, 2, etc.).\n- Set the **Tool Indexes** for your CNC machine.\n- Adjust **Size** and **Offset** parameters if necessary.\n\n### Step 3: Select Elements\n```\nCommand Line: Select one or More Elements\nAction: Click on the timber elements in the model you wish to process. Press Enter to confirm selection.\n```\n*Note: The script will attach to the elements, calculate the geometry, and generate the glue instructions automatically.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Zone to be Glued | dropdown | 0 | Selects the specific manufacturing layer (1-10) where the glue will be applied. |\n| Glue Reference Zone | dropdown | 0 | Defines the reference layer (e.g., adjacent layer) used to calculate glue boundaries. |\n| Tool index Line | number | 51 | The CNC machine tool ID used for linear glue paths. |\n| Tool index Area | number | 52 | The CNC machine tool ID used for surface glue areas. |\n| Size Glue Area | number | 360.0 | The dimension (length/side) of the standard glue application unit (mm). |\n| \\|Origin X offset\\| | number | 0.0 | Shifts the glue pattern along the element's width (X-axis). |\n| \\|Origin Y offset\\| | number | 0.0 | Shifts the glue pattern along the element's length (Y-axis). |\n| \\|Minimum width to create glue area\\| | number | 200.0 | Threshold width (mm). Narrower surfaces generate lines; wider surfaces generate areas. |\n| \\|Minimum length of glue line\\| | number | 200.0 | Shortest allowed length (mm) for a glue line segment. Shorter segments are filtered out. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Reapply Glue | Forces the script to recalculate and regenerate all glue geometry on the element. Useful after modifying the element or changing properties. |\n\n## Settings Files\n- **Filename**: `hsb_GlueArea.mcr`\n- **Location**: TSL Script Folder\n- **Purpose**: This dependency script is spawned by the main script to hold the actual geometric polyline and tooling attributes for the CNC output.\n\n## Tips\n- **Lines vs. Areas**: If you want glue lines instead of areas on a specific surface, increase the **Minimum width to create glue area** value to be larger than that surface's width.\n- **Offsets**: Use the X and Y offsets to adjust the glue pattern start position to match machine jigging or placement constraints.\n- **Exclusions**: The script detects \"NoGlue\" tags or exclusion zones defined by other scripts and will not apply glue in those areas.\n- **Recalculation**: Changing the Element geometry (e.g., moving a window) will automatically trigger an update of the glue paths.\n\n## FAQ\n- **Q: Why is no glue appearing on my element?**\n  - **A:** Check that the **Zone to be Glued** matches a layer that actually exists in your Element. Also, verify that the width of the target surface exceeds the **Minimum width to create glue area** (if you expect areas) or **Minimum length of glue line** (if you expect lines).\n- **Q: What happens if I select a zone that is lower than the Reference Zone?**\n  - **A:** The script will generate a notice in the command line, but it will continue to run. Ensure your Reference Zone logic matches your construction setup (e.g., Reference Zone is usually the layer below the Glue Zone).\n- **Q: Can I use this for pre-fabricated wall panels?**\n  - **A:** Yes, this script is designed for automated manufacturing preparation of panels like CLT or timber frame walls."
      },
      "tokens_used": 6892,
      "error": null
    }
  }
}