{
  "filename": "hsb_SIP-CoverStrips.mcr",
  "status": "completed",
  "total_tokens": 38178,
  "processing_time": 138.7127857208252,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "18.11.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5915: fix bug at the property color"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6865,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script iterates through 3D Elements using el.beam(), el.sheet(), and el.sip(). It performs 3D geometric operations (PlaneProfile, envelopeBody, extractContactFaceInPlane) and creates new 3D Sheet entities using Sheet.dbCreate(). It does not use ShopDrawing prefixes (sd_), Viewport logic, or 2D drawing generation."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Sip"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Elements with SIP (Structural Insulated Panel) data.",
          "requiredSettings": []
        }
      },
      "tokens_used": 5767,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one or More Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "On Insert (if no execute key)",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sheetName",
            "type": "PropString",
            "displayName": "Add Sheet Name",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sheetMaterial",
            "type": "PropString",
            "displayName": "Add Sheet Material Type",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sheetColor",
            "type": "PropInt",
            "displayName": "Add sheet color",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5774,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates cover strips (filler sheets) to bridge gaps between Structural Insulated Panels (SIPs) and adjacent structural components like beams or other sheets within an Element.",
          "category": "Framing",
          "typicalUseCase": "Used when a wall contains SIPs that do not perfectly align with neighboring beams or sheets, leaving gaps that need to be covered with matching material (e.g., OSB or Plywood)."
        },
        "parameters": [
          {
            "name": "sheetName",
            "technicalDefault": "\"\"",
            "businessMeaning": "Assigns a specific name to the newly generated cover strips for identification in schedules, lists, and BIM data.",
            "validRange": "Any alphanumeric string (e.g., 'CoverStrip_Int')",
            "unit": "string",
            "affectsOutput": "Modifies the 'Name' property of the resulting Sheet entities."
          },
          {
            "name": "sheetMaterial",
            "technicalDefault": "\"\"",
            "businessMeaning": "Defines the material composition (e.g., 'OSB', 'Plywood') of the cover strips, affecting weight, cost estimation, and machining properties.",
            "validRange": "Any valid material name existing in the hsbCAD material catalog.",
            "unit": "string",
            "affectsOutput": "Sets the 'Material' property of the resulting Sheet entities."
          },
          {
            "name": "sheetColor",
            "technicalDefault": "1",
            "businessMeaning": "Determines the visual display color of the generated cover strips in the 3D model and drawings.",
            "validRange": "1 to 255 (standard AutoCAD Color Index)",
            "unit": "index",
            "affectsOutput": "Changes the visual color of the resulting Sheet entities."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Selection of Element (PrEntity)",
            "effect": "The geometry of the output depends entirely on the voids calculated between the SIP, Beam, and Sheet components inside the selected Element.",
            "cascade": [
              "Output Entity Geometry"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Sheet",
            "description": "Custom-shaped sheets (cover strips) created to fill the gaps on the interior and exterior faces of the SIP assembly. The thickness matches the existing internal or external SIP layer thickness.",
            "appliedTo": "The selected Element (assigned to the Element group)."
          }
        ]
      },
      "tokens_used": 6058,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launched via command or catalog.",
          "2. Check Insert Cycle: If > 1, exit immediately.",
          "3. Check Execute Key: If empty, show Properties Dialog for user input (Name, Material, Color).",
          "4. Prompt user to select one or more Elements (PrEntity).",
          "5. If selection is confirmed, loop through selected Elements.",
          "6. Spawn a new script instance (dbCreate) for each selected Element, passing current property values.",
          "7. Main script instance erases itself.",
          "8. Child instance starts execution for a specific Element.",
          "9. Verify Element contains SIP objects; if not, skip processing.",
          "10. Calculate geometric profiles: Extract envelopes of Beams, Sheets, and SIPs on both sides of the Element.",
          "11. Determine Gaps: Subtract SIP and Sheet profiles from the combined Beam/Element profile to find exposed areas.",
          "12. Analyze Gap Rings: Iterate through calculated gap polygons.",
          "13. Segment gaps into strips based on vertex projection.",
          "14. Generate Sheets: Create new Sheet entities with calculated dimensions and assign properties (Name, Material, Color).",
          "15. Assign new Sheets to the Element group.",
          "16. Child instance erases itself."
        ],
        "conditionalBranches": [
          {
            "condition": "Execute Key Status (_kExecuteKey)",
            "path1": {
              "name": "Manual Insert",
              "steps": [
                "Check if _kExecuteKey is empty",
                "Open Properties Dialog (showDialog)",
                "Wait for user input/confirmation",
                "Proceed to Selection Prompt"
              ]
            },
            "path2": {
              "name": "Command/Catalog Insert",
              "steps": [
                "Check if _kExecuteKey is set",
                "Skip Properties Dialog",
                "Proceed to Selection Prompt with default/current properties"
              ]
            }
          },
          {
            "condition": "SIP Presence in Element",
            "path1": {
              "name": "SIPs Found",
              "steps": [
                "Extract SIP Style and Thickness",
                "Proceed with Profile Calculation"
              ]
            },
            "path2": {
              "name": "No SIPs",
              "steps": [
                "Break loop",
                "Skip Element (no geometry generated)"
              ]
            }
          },
          {
            "condition": "Gap Segment Width (rectWidth)",
            "path1": {
              "name": "Significant Gap (>= 1mm)",
              "steps": [
                "Calculate intersection profile",
                "Determine orientation (Width vs Length)",
                "Create Sheet"
              ]
            },
            "path2": {
              "name": "Tiny Gap (< 1mm)",
              "steps": [
                "Stop processing current ring segment",
                "Ignore segment (prevents micro-entities)"
              ]
            }
          },
          {
            "condition": "Sheet Orientation (Width vs Length)",
            "path1": {
              "name": "Width > Length",
              "steps": [
                "Swap Coordinate System axes (X becomes Y, Y becomes -X)",
                "Create Sheet with adjusted orientation"
              ]
            },
            "path2": {
              "name": "Length >= Width",
              "steps": [
                "Use default Coordinate System",
                "Create Sheet"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element contains SIP entities",
            "errorMessage": "None (Silent)",
            "recovery": "Script aborts processing for the specific Element. User must select an Element with valid SIP definitions."
          },
          {
            "check": "Segment width calculation",
            "errorMessage": "None (Silent)",
            "recovery": "Segments smaller than 1mm are ignored to prevent invalid geometry creation."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Generated Sheets",
            "how": "Direct Grips / Properties Palette",
            "effect": "The resulting Sheets are standard hsbCAD entities. They can be moved, resized, or modified individually. The TSL script instance is erased after generation, so changes to the TSL properties will not update existing sheets."
          },
          {
            "action": "Regenerate Cover Strips",
            "how": "Re-run Script",
            "effect": "User must delete existing cover strips and re-run the script if the underlying wall geometry (Beams/SIPs) changes or if different properties are desired."
          }
        ]
      },
      "tokens_used": 9191,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SIP-CoverStrips.mcr\n\n## Overview\nAutomatically generates cover strips (filler sheets) to bridge gaps between Structural Insulated Panels (SIPs) and adjacent structural components like beams or sheets within a selected Element.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D Elements containing SIP entities. |\n| Paper Space | No | Not applicable for 2D layout generation. |\n| Shop Drawing | No | Not applicable for detailing views. |\n\n## Prerequisites\n- **Required Entities**: Elements containing SIP (Structural Insulated Panel) definitions.\n- **Minimum Beam Count**: 0 (Script relies on Element and SIP data).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_SIP-CoverStrips.mcr` from the catalog.\n\n### Step 2: Configure Properties (If Manual Insert)\nIf the script is run manually (without a pre-configured execute key), a properties dialog will appear.\n```\nDialog: Properties\nAction: Set the desired Name, Material, and Color for the cover strips, then click OK.\n```\n\n### Step 3: Select Elements\n```\nCommand Line: Select one or More Elements\nAction: Click on the desired Element(s) in the Model Space and press Enter to confirm.\n```\nThe script will process each selected Element, calculate the gaps between SIPs and other components, and generate the cover strips.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Add Sheet Name | Text | \"\" | Assigns a specific name to the newly generated cover strips for identification in lists and BIM data. |\n| Add Sheet Material Type | Text | \"\" | Defines the material composition (e.g., 'OSB', 'Plywood') of the cover strips. |\n| Add sheet color | Number | 1 | Determines the visual display color (AutoCAD Color Index 1-255) of the generated sheets. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific context menu options are added by this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not use external settings files.\n\n## Tips\n- The script automatically ignores gaps smaller than 1mm to prevent the creation of tiny, unusable entities.\n- The script instance erases itself immediately after generating the geometry. This means the link between the strips and the script is broken once created.\n- If you modify the underlying wall geometry (Beams/SIPs), you must delete the existing cover strips and re-run the script to update them.\n\n## FAQ\n- **Q: I selected an element, but no sheets were created. Why?**\n  **A:** The script only processes Elements that contain SIP entities. If the element is a standard timber frame without SIP data, the script will skip it silently.\n- **Q: Can I change the material of the strips after they are created?**\n  **A:** Yes. Since the script instance is removed after creation, the resulting sheets become standard hsbCAD Sheet entities. You can select them and modify their properties directly in the Properties Palette.\n- **Q: How is the thickness of the cover strip determined?**\n  **A:** The script automatically matches the thickness of the existing internal or external SIP layer associated with the gap."
      },
      "tokens_used": 4523,
      "error": null
    }
  }
}