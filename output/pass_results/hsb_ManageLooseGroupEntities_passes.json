{
  "filename": "hsb_ManageLooseGroupEntities.mcr",
  "status": "completed",
  "total_tokens": 26294,
  "processing_time": 231.50773406028748,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": \"\",\n    \"numBeamsReq\": 0,\n    \"keywords\": [],\n    \"majorVersion\": 1,\n    \"minorVersion\": 0,\n    \"dxaOut\": 0,\n    \"implInsert\": 0\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.0\",\n      \"date\": \"08.11.2010\",\n      \"author\": \"Alberto Jena (aj@hsb-cad.com)\",\n      \""
      },
      "tokens_used": 5511,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity(Element()) for user input and dbCreate to attach instances to Elements. It collects GenBeam entities using the _kModel constant. The logic handles 3D element lifecycle events such as _bOnElementDeleted and manages element grouping in the model. There is no 'sd_' prefix, Viewport handling, or ShopDrawing specific patterns."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3269,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2460,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Manages the lifecycle and grouping of 'loose' entities (e.g., separate framing members like gable studs or purlins) associated with a specific Element, ensuring they are automatically deleted when the parent Element is removed.",
          "category": "Model Management / Automation",
          "typicalUseCase": "When a user generates loose structural parts that should not be geometrically part of the main wall element but must still be linked to it for cleanup purposes (e.g., deleting a wall should also delete its associated loose gable studs)."
        },
        "parameters": [
          {
            "name": "_Element",
            "technicalDefault": "Element()",
            "businessMeaning": "The parent construction element (e.g., Wall or Floor) to which the 'loose' entities are logically linked.",
            "validRange": "Any valid Element entity in the model",
            "unit": "Entity",
            "affectsOutput": "Determines which specific sub-entities are tracked for deletion. If this element is deleted, the script locates and removes any GenBeams in the 'Loose' subgroup that are assigned to this element's handle."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "_Element is deleted (_bOnElementDeleted)",
            "effect": "The script triggers a search for loose entities in the model linked to this element and erases them.",
            "cascade": [
              "GenBeam entities in the Element's 'Loose' subgroup"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TslInst",
            "description": "An attached instance of this management script is created on each selected element to monitor lifecycle events.",
            "appliedTo": "Selected Elements"
          },
          {
            "type": "Group Structure",
            "description": "Assigns the element to a specific subgroup (e.g., 'WallName\\Loose') to organize related loose parts in the model tree.",
            "appliedTo": "Selected Elements"
          }
        ]
      },
      "tokens_used": 4872,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script initializes and sets execution sequence number (-40).",
          "2. [Insert Mode] Check if insertCycleCount > 1 to prevent recursive execution loops.",
          "3. [Insert Mode] Prompt user to select a set of Elements (Walls/Floors) using PrEntity.",
          "4. [Insert Mode] Iterate through the selected Element set.",
          "5. [Insert Mode] For each Element, create a new attached instance of this script (dbCreate).",
          "6. [Insert Mode] Erase the original 'master' script instance (it acts only as a factory).",
          "7. [Attached Mode] Retrieve the parent Element's handle and current Group name.",
          "8. [Attached Mode] Construct a target subgroup string (e.g., 'WallName\\Loose').",
          "9. [Attached Mode] Search for and erase any duplicate instances of this script attached to the same Element (singleton enforcement).",
          "10. [Attached Mode] Store the parent handle and target group in the instance Map.",
          "11. [Attached Mode] Set dependency on the Element and update display origin.",
          "12. [Event Mode] Monitor for Element Deletion, Construction, or List Modification events.",
          "13. [Event Mode] If event triggers, retrieve stored Map data (Handle/Group).",
          "14. [Event Mode] Collect all GenBeam entities within the target 'Loose' subgroup.",
          "15. [Event Mode] Iterate through collected GenBeams and compare their internal 'ElementHandle' (SubMap) with the parent's handle.",
          "16. [Event Mode] Erase any GenBeam that matches the parent handle (cleanup of loose entities).",
          "17. [Display] Draw script name at Element origin."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Check",
            "path1": {
              "name": "Recursive Execution",
              "steps": [
                "insertCycleCount > 1 detected",
                "Script instance erases itself immediately",
                "Execution stops"
              ]
            },
            "path2": {
              "name": "Normal Insertion",
              "steps": [
                "insertCycleCount is 1",
                "Script proceeds to prompt user for Element selection"
              ]
            }
          },
          {
            "condition": "User Selection at PrEntity Prompt",
            "path1": {
              "name": "Selection Successful",
              "steps": [
                "User selects Elements",
                "Instances created on Elements",
                "Master instance erased"
              ]
            },
            "path2": {
              "name": "Selection Cancelled/Empty",
              "steps": [
                "User cancels or selects nothing",
                "_Element array remains empty",
                "Script hits final validation check and erases itself"
              ]
            }
          },
          {
            "condition": "Element Lifecycle Event",
            "path1": {
              "name": "Cleanup Event",
              "steps": [
                "Event is _bOnElementDeleted, _bOnElementConstructed, or _bOnElementListModified",
                "Script scans 'Loose' subgroup for matching GenBeams",
                "Matching GenBeams are erased"
              ]
            },
            "path2": {
              "name": "Standard Recalc",
              "steps": [
                "Standard update triggered",
                "Script skips cleanup logic",
                "Updates display position and duplicates check"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Recursion / Loop Prevention",
            "errorMessage": "(No user message)",
            "recovery": "Script detects insertCycleCount > 1 and automatically erases the duplicate instance to prevent infinite loops."
          },
          {
            "check": "Parent Element Availability",
            "errorMessage": "(No user message)",
            "recovery": "Script checks if _Element is empty. If the parent element is missing or selection failed, the script erases itself to avoid errors."
          },
          {
            "check": "Map Data Integrity",
            "errorMessage": "(No user message)",
            "recovery": "Before executing cleanup, script verifies that 'sHandle' and 'sGroup' strings exist in the Map. If missing, cleanup is skipped."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Delete Parent Element",
            "how": "Standard AutoCAD Erase command",
            "effect": "Script triggers cleanup logic and removes all GenBeam entities in the associated 'Loose' subgroup that were linked to the deleted Element."
          },
          {
            "action": "Modify Parent Element",
            "how": "Grip edit or Properties palette change",
            "effect": "Script triggers (_bOnElementListModified/Constructed) and re-runs the cleanup logic to ensure loose entities are consistent with the current state."
          },
          {
            "action": "Copy Parent Element",
            "how": "Copy/Array commands",
            "effect": "The attached script instance is copied. The 'Duplicate Check' logic will detect multiple instances of the script on the new element and erase the extras, leaving only one active manager."
          }
        ]
      },
      "tokens_used": 5784,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ManageLooseGroupEntities.mcr\n\n## Overview\nThis script attaches to selected construction elements (like walls or floors) to manage \"loose\" sub-entities (such as gable studs). It ensures that these associated parts are automatically deleted or cleaned up when the parent element is modified or removed.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D Elements in the model. |\n| Paper Space | No | Not intended for layout or detailing views. |\n| Shop Drawing | No | Not intended for manufacturing outputs. |\n\n## Prerequisites\n- **Required Entities**: At least one Element (e.g., Wall or Floor) must exist in the model.\n- **Minimum beam count**: 0\n- **Required settings files**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_ManageLooseGroupEntities.mcr` from the file browser.\n\n### Step 2: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the elements (Walls/Floors) that contain or will contain loose entities you wish to manage. Press Enter when selection is complete.\n```\n\n### Step 3: Completion\nAfter selection, the script automatically attaches an instance of itself to the chosen elements. The initial script instance disappears, and the management logic runs in the background on those elements.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| *None* | - | - | This script does not expose user-editable parameters in the Properties Panel. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add specific options to the entity right-click menu. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not rely on external settings files.\n\n## Tips\n- **Cleanup**: This script is particularly useful for secondary framing members (like gable studs) that are generated separately but should logically disappear if the main wall is deleted.\n- **Grouping**: The script logically organizes entities by looking for a \"Loose\" subgroup within the element's group structure.\n- **Copying**: If you copy an element that has this script attached, the script will automatically detect the copy and ensure duplicate management instances are removed, keeping the model clean.\n\n## FAQ\n- **Q: How do I know if the script is working?**\n  - A: The script runs automatically in the background. You will notice its effect when you delete a managed element; any linked loose parts in the \"Loose\" subgroup will be deleted along with it.\n- **Q: Can I use this on beams?**\n  - A: No, this script is designed specifically for Elements (Walls/Floors).\n- **Q: What happens if I modify the element geometry?**\n  - A: The script triggers on modification events to ensure the loose entities are still valid, performing a cleanup check to maintain model integrity.\n- **Q: I inserted the script but nothing happened.**\n  - A: The script is designed to attach itself to elements and then erase the \"master\" instance. If you successfully selected elements, the script is now active on those elements. If no elements were selected, the script erased itself to prevent errors."
      },
      "tokens_used": 4398,
      "error": null
    }
  }
}