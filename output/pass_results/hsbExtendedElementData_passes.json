{
  "filename": "hsbExtendedElementData.mcr",
  "status": "completed",
  "total_tokens": 52516,
  "processing_time": 416.21217823028564,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9241,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script inserts via selecting Elements using `PrEntity`. It calculates physical geometric properties (Area, Volume, Insulation) from the 3D model using Element methods like `el.plEnvelope()`, `el.opening()`, and `el.genBeam()`. Visualization options are limited to 'WCS' (World Coordinate System) or 'ECS' (Element Coordinate System), which are Model Space concepts. There is no interaction with Viewports, Paper Space layouts, or `sd_` ShopDrawing classes."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Property Sets (to write data)",
            "DimStyle (for visualization)"
          ]
        }
      },
      "tokens_used": 6948,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select Element",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "Insertion (_bOnInsert)",
            "title": "Properties",
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 1,
            "variable": "sUnit",
            "type": "PropString",
            "displayName": "|Unit|",
            "defaultValue": "mm",
            "inputType": "dropdown",
            "options": [
              "mm",
              "cm",
              "m",
              "inch",
              "feet"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nDecimals",
            "type": "PropInt",
            "displayName": "|Decimals|",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sLengthSource",
            "type": "PropString",
            "displayName": "|Length taken from|",
            "defaultValue": "|entire Element|",
            "inputType": "dropdown",
            "options": [
              "|entire Element|",
              "|Zone 0|",
              "|Element Outline|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sHeightSource",
            "type": "PropString",
            "displayName": "|Height taken from|",
            "defaultValue": "|entire Element|",
            "inputType": "dropdown",
            "options": [
              "|entire Element|",
              "|Zone 0|",
              "|Element Outline|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sWidthSource",
            "type": "PropString",
            "displayName": "|Width taken from|",
            "defaultValue": "|entire Element|",
            "inputType": "dropdown",
            "options": [
              "|entire Element|",
              "|Zone 0|",
              "|Wall Outline|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dMinArea",
            "type": "PropDouble",
            "displayName": "|Net Area: ignore Openings < DU|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Openings with an area smaller than the given value in drawing units will not be taken to calculate the net area of the element"
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "|Color|",
            "defaultValue": 222,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sShowTable",
            "type": "PropString",
            "displayName": "|Show table|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|WCS|",
              "|ECS| |(Element coordinate system)|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sPropSetName",
            "type": "PropString",
            "displayName": "|Property Set Name|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": "If the chosen property set contains properties with the following names values will be set by this tsl. Please note that the type must be set to a real number and not to text - Height - Width - Length - Perimeter - AreaNet - AreaGros - Insulation. The values will be set in the unit which is set as property of this tsl"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8012,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Calculates and displays geometric properties (dimensions, area, volume, insulation) of a timber element and writes them to AutoCAD Property Sets.",
          "category": "Analysis",
          "typicalUseCase": "Generating detailed element reports, calculating net wall areas for estimation, or populating property sets for BIM/data export."
        },
        "parameters": [
          {
            "name": "sUnit",
            "technicalDefault": "mm",
            "businessMeaning": "Specifies the measurement unit (metric or imperial) for all displayed values and property set outputs.",
            "validRange": "mm, cm, m, inch, feet",
            "unit": "N/A (Enumeration)",
            "affectsOutput": "Numerical display of dimensions, areas, and volumes in both the on-screen table and the written Property Sets."
          },
          {
            "name": "nDecimals",
            "technicalDefault": "2",
            "businessMeaning": "Sets the precision (number of decimal places) for the calculated values displayed in the on-screen table.",
            "validRange": "0 to 4",
            "unit": "Count",
            "affectsOutput": "Visual formatting of the text table only. Property sets are written as raw numbers."
          },
          {
            "name": "sLengthSource",
            "technicalDefault": "|entire Element|",
            "businessMeaning": "Defines the geometric reference used to calculate the element's length (e.g., bounding box of all material vs. core structural zone vs. outline).",
            "validRange": "|entire Element|, |Zone 0|, |Element Outline|",
            "unit": "N/A (Enumeration)",
            "affectsOutput": "The calculated 'Length' value reported to the table and property sets. 'Zone 0' usually represents the structural timber area excluding claddings."
          },
          {
            "name": "sHeightSource",
            "technicalDefault": "|entire Element|",
            "businessMeaning": "Defines the geometric reference used to calculate the element's height.",
            "validRange": "|entire Element|, |Zone 0|, |Element Outline|",
            "unit": "N/A (Enumeration)",
            "affectsOutput": "The calculated 'Height' value reported to the table and property sets."
          },
          {
            "name": "sWidthSource",
            "technicalDefault": "|entire Element|",
            "businessMeaning": "Defines the geometric reference used to calculate the element's thickness/width.",
            "validRange": "|entire Element|, |Zone 0|, |Wall Outline|",
            "unit": "N/A (Enumeration)",
            "affectsOutput": "The calculated 'Width' value reported to the table and property sets. 'Wall Outline' refers to the 2D CAD profile used to generate the wall."
          },
          {
            "name": "dMinArea",
            "technicalDefault": "0",
            "businessMeaning": "Filters out small openings (like drill holes or service penetrations) from the Net Area calculation to avoid over-reduction of area.",
            "validRange": "0.0 to 10000.0 (depending on units)",
            "unit": "Square units (e.g., mm², in²)",
            "affectsOutput": "Net Area calculation. Openings smaller than this value are ignored, resulting in a larger Net Area."
          },
          {
            "name": "nColor",
            "technicalDefault": "222",
            "businessMeaning": "Sets the AutoCAD color index for the dimension lines and text table generated by the script.",
            "validRange": "1 to 255",
            "unit": "AutoCAD Color Index (ACI)",
            "affectsOutput": "Visual appearance of the generated data table in the CAD model."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific text style (font, size) used to render the dimension text and data table.",
            "validRange": "Any existing DimStyle in the drawing",
            "unit": "N/A (Style Name)",
            "affectsOutput": "Visual size and font of the generated text table. If left blank, it may use a default or fail to display text correctly."
          },
          {
            "name": "sShowTable",
            "technicalDefault": "|No|",
            "businessMeaning": "Controls the visibility and orientation of the data table in the model space.",
            "validRange": "|No|, |WCS|, |ECS| |(Element coordinate system)|",
            "unit": "N/A (Enumeration)",
            "affectsOutput": "Visibility of the text table. 'WCS' aligns text with World Coordinates (flat on screen), 'ECS' aligns with the wall orientation (rotated)."
          },
          {
            "name": "sPropSetName",
            "technicalDefault": "",
            "businessMeaning": "Identifies the target AutoCAD Property Set where the calculated values should be stored for BIM purposes or schedules.",
            "validRange": "Existing Property Set Definitions in the drawing",
            "unit": "N/A (String)",
            "affectsOutput": "Writes data to the Element's properties. If blank, no data is written to Property Sets. Requires the Property Set to have specific properties defined (e.g., 'Height', 'Width')."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sUnit changes",
            "effect": "Scales the numerical values written to the Property Set and displayed in the table.",
            "cascade": [
              "sLengthSource",
              "sHeightSource",
              "sWidthSource",
              "sPropSetName"
            ]
          },
          {
            "trigger": "sShowTable is set to |No|",
            "effect": "Parameters related to visual formatting become irrelevant.",
            "cascade": [
              "nColor",
              "sDimStyle",
              "nDecimals"
            ]
          },
          {
            "trigger": "sPropSetName is empty",
            "effect": "The script will not write any data to the element properties, regardless of other calculation settings.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Annotation/Text",
            "description": "A dynamic text table displaying dimensions, areas, volume, and insulation data.",
            "appliedTo": "Model Space (positioned relative to the selected Element)"
          },
          {
            "type": "Property Set Data",
            "description": "Numerical values for Height, Width, Length, Perimeter, AreaNet, AreaGros, and Insulation written to the Element's extended data.",
            "appliedTo": "Selected Element"
          }
        ]
      },
      "tokens_used": 9464,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched (Insert or Update)",
          "[Insertion] Load properties from catalog (if available)",
          "[Insertion] Display Properties Dialog for user configuration",
          "[Insertion] Prompt user to select Element(s) via PrEntity",
          "[Insertion] Iterate through selected elements",
          "[Insertion] Check if script instance already exists on the selected Element",
          "[Insertion] If valid, create new TSL instance attached to Element with calculated offset and properties",
          "[Insertion] Report success or failure (already attached) message",
          "[Insertion] Erase the temporary instance and exit",
          "[Execution/Update] Validate that an Element is linked (_Element)",
          "[Execution/Update] Retrieve Element Coordinate System (ECS) and visualize axes",
          "[Execution/Update] Determine geometric sources based on properties (entire Element, Zone 0, or Outline)",
          "[Execution/Update] Calculate shadow profiles for Length, Height, and Width",
          "[Execution/Update] Calculate Insulation Volume (Zone 0 shadow minus beams, sheets, and TSL openings)",
          "[Execution/Update] Calculate Gross Area and Net Area (subtracting openings smaller than dMinArea threshold)",
          "[Execution/Update] Calculate Perimeter from envelope vertices",
          "[Execution/Update] Extract numerical dimensions from shadow profiles",
          "[Execution/Update] Format values into strings based on selected Unit (sUnit) and Decimals (nDecimals)",
          "[Execution/Update] Export data to internal dxaout (Excel/Processing)",
          "[Execution/Update] Check if Property Set Name (sPropSetName) is defined",
          "[Execution/Update] If defined, attach Property Set to Element and map calculated values (Height, Width, Length, etc.) to it",
          "[Execution/Update] Check if Show Table (sShowTable) is enabled",
          "[Execution/Update] If enabled, determine display orientation (WCS vs ECS)",
          "[Execution/Update] Render text table at reference point (Arrow for Walls, Origin for others)"
        ],
        "conditionalBranches": [
          {
            "condition": "Is the script being inserted (_bOnInsert)?",
            "path1": {
              "name": "Insertion Flow",
              "steps": [
                "Load catalog properties",
                "Show Dialog",
                "Select Element",
                "Check for existing script instance",
                "Attach new instance or report error",
                "Erase temporary script"
              ]
            },
            "path2": {
              "name": "Execution/Update Flow",
              "steps": [
                "Validate linked Element",
                "Perform geometric calculations",
                "Update Property Sets",
                "Render visualization table"
              ]
            }
          },
          {
            "condition": "Does the Element already have this script attached?",
            "path1": {
              "name": "Unique Attachment",
              "steps": [
                "Calculate insertion coordinates",
                "Create TSL instance on Element",
                "Report: data successfully appended"
              ]
            },
            "path2": {
              "name": "Duplicate Detected",
              "steps": [
                "Skip creation for this Element",
                "Report: has already extended data attached"
              ]
            }
          },
          {
            "condition": "sPropSetName is not empty",
            "path1": {
              "name": "Export to Property Set",
              "steps": [
                "Attach Property Set to Element",
                "Get Property Map",
                "Set values for Height, Width, Length, Insulation, AreaNet, AreaGros, Perimeter",
                "Write Map back to Element"
              ]
            },
            "path2": {
              "name": "No Property Export",
              "steps": [
                "Skip Property Set logic"
              ]
            }
          },
          {
            "condition": "Element Type (Wall vs Others)",
            "path1": {
              "name": "Wall Element",
              "steps": [
                "Use Arrow point as reference for visualization",
                "Draw marker circle",
                "Offset reference point by Z-axis"
              ]
            },
            "path2": {
              "name": "Other Elements",
              "steps": [
                "Use Origin point as reference for visualization",
                "Draw simple line indicator"
              ]
            }
          },
          {
            "condition": "sShowTable value",
            "path1": {
              "name": "No Table",
              "steps": [
                "Skip visualization drawing"
              ]
            },
            "path2": {
              "name": "WCS Table",
              "steps": [
                "Set display vectors to World Coordinate System (XW, YW, ZW)",
                "Draw table"
              ]
            },
            "path3": {
              "name": "ECS Table",
              "steps": [
                "Set display vectors to Element Coordinate System (vx, vy, vz)",
                "Draw table"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Valid Element selected/linked",
            "errorMessage": "Script erases instance if _Element.length() < 1 or Element is invalid.",
            "recovery": "User must ensure script is inserted on a valid Element."
          },
          {
            "check": "Duplicate Script Attachment",
            "errorMessage": "\"Element X: has aleady extended data attached. no data appended.\"",
            "recovery": "User must remove the existing script instance from the Element before trying to attach a new one via the insertion tool, or modify the existing instance via Properties."
          },
          {
            "check": "Insulation Calculation Area",
            "errorMessage": "None explicit in output, but areas smaller than dEps^2 are ignored.",
            "recovery": "N/A (Internal optimization)."
          },
          {
            "check": "Net Area Opening Size",
            "errorMessage": "None explicit in output.",
            "recovery": "User can adjust the 'Net Area: ignore Openings < DU' property to filter small openings."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Dimensions Source",
            "how": "OPM (Properties Palette) - Modify 'Length taken from', 'Height taken from', 'Width taken from'",
            "effect": "Script recalculates dimensions based on entire Element, Zone 0, or Outline. Updates Property Set and Table."
          },
          {
            "action": "Filter Openings",
            "how": "OPM - Modify 'Net Area: ignore Openings < DU'",
            "effect": "Recalculates Net Area, ignoring openings smaller than the new threshold."
          },
          {
            "action": "Toggle Visualization",
            "how": "OPM - Modify 'Show table' (No/WCS/ECS)",
            "effect": "Hides or shows the data table, changing its orientation between World and Element coordinates."
          },
          {
            "action": "Change Units/Precision",
            "how": "OPM - Modify 'Unit' or 'Decimals'",
            "effect": "Updates the formatting of the text table and the numerical values written to the Property Set."
          },
          {
            "action": "Update Destination Property Set",
            "how": "OPM - Modify 'Property Set Name'",
            "effect": "Writes calculated data to a different Property Set definition on the Element."
          },
          {
            "action": "Move Visualization",
            "how": "Grip Edit (Standard AutoCAD grips on the script instance)",
            "effect": "Moves the table to a new location in model space."
          }
        ]
      },
      "tokens_used": 11175,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbExtendedElementData.mcr\n\n## Overview\nThis script automatically calculates geometric properties (dimensions, area, volume, and insulation) for a selected timber Element. It writes these values to an AutoCAD Property Set for scheduling and can display a data table directly in the model.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D Elements. |\n| Paper Space | No | Not supported in layout views. |\n| Shop Drawing | No | Not designed for detail generation. |\n\n## Prerequisites\n- **Required Entities**: An existing hsbCAD Element (Wall, Floor, or Roof).\n- **Minimum Beam Count**: 0.\n- **Required Settings**: An AutoCAD Property Set Definition must exist in the drawing if you wish to export data. It must contain the following properties defined as **Real Numbers**: `Height`, `Width`, `Length`, `Perimeter`, `AreaNet`, `AreaGros`, `Insulation`.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT` → Select `hsbExtendedElementData.mcr` from the list.\n\n### Step 2: Configure Properties\nA dialog box appears upon insertion. Configure the default settings (Units, Decimals, Property Set Name) and click **OK**.\n\n### Step 3: Select Element\n```\nCommand Line: Select Element\nAction: Click on the desired timber Element in the 3D model.\n```\n*Note: You can select multiple elements. If the script is already attached to an element, it will skip it.*\n\n### Step 4: Review Output\nThe script attaches to the element. If **Show table** is enabled, a text box displaying the calculations will appear near the element. The calculated values are automatically written to the specified Property Set.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Unit** | dropdown | mm | The unit of measurement used for displayed values and data written to Property Sets (mm, cm, m, inch, feet). |\n| **Decimals** | number | 2 | The number of decimal places shown in the on-screen text table. |\n| **Length taken from** | dropdown | \\|entire Element\\| | Defines the geometry used for length calculation: <br>• **entire Element**: Includes all layers (cladding, plaster).<br>• **Zone 0**: Structural timber zone only.<br>• **Element Outline**: Based on the 2D outline profile. |\n| **Height taken from** | dropdown | \\|entire Element\\| | Defines the geometry used for height calculation (Options same as Length). |\n| **Width taken from** | dropdown | \\|entire Element\\| | Defines the geometry used for thickness calculation. (Options: entire Element, Zone 0, Wall Outline). |\n| **Net Area: ignore Openings < DU** | number | 0 | Sets a threshold area. Openings smaller than this value are ignored in the Net Area calculation (useful to ignore drill holes). |\n| **Color** | number | 222 | AutoCAD color index for the dimension lines and text table. |\n| **Dimstyle** | dropdown | [Empty] | The text style used for the on-screen table. Leave blank to use a default, or select a specific style from your drawing. |\n| **Show table** | dropdown | \\|No\\| | Controls visibility of the data table in the model:<br>• **No**: Hides the table (data is still written to Property Sets).<br>• **WCS**: Table aligns with World Coordinates.<br>• **ECS**: Table aligns with Element orientation (rotates with wall). |\n| **Property Set Name** | dropdown | [Empty] | The name of the AutoCAD Property Set Definition to write data to. If left blank, no data is written to properties. |\n\n## Right-Click Menu Options\n*Note: This script does not add specific custom items to the right-click context menu. Standard hsbCAD script options (e.g., Refresh, Erase) apply.*\n\n## Settings Files\nNo specific external settings files (XML) are required for this script beyond standard hsbCAD catalogs.\n\n## Tips\n- **Zone 0 vs Entire Element**: Use \"Zone 0\" as the source for dimensions if you need structural timber quantities (net frame), excluding finishes like gypsum board or siding.\n- **Scheduling**: Since the script writes directly to AutoCAD Property Sets, you can create a standard AutoCAD Schedule Table to display these values in drawings.\n- **Performance**: If inserting on hundreds of elements, consider setting **Show table** to \"No\" initially to reduce visual clutter, then enable it only for specific elements as needed.\n- **Moving the Table**: If the table obstructs your view, select the script instance (often visible as a small grip or the text itself) and use AutoCAD Move commands or grips to relocate it.\n\n## FAQ\n- **Q: Why are my Property Sets not updating?**\n  - **A**: Check that the **Property Set Name** matches the definition in your drawing exactly. Ensure the properties inside that definition are spelled correctly (`Height`, `Width`, `Length`, etc.) and are defined as **Real Numbers** (Double), not Text.\n- **Q: The Net Area seems too large/small.**\n  - **A**: Adjust the **Net Area: ignore Openings < DU** parameter. If small service holes are reducing your area incorrectly, increase this value to filter them out.\n- **Q: Can I use this for Roofs and Floors?**\n  - **A**: Yes, the script works on any hsbCAD Element. For Walls, the table reference point is the \"Arrow\"; for other elements, it uses the Origin."
      },
      "tokens_used": 7676,
      "error": null
    }
  }
}