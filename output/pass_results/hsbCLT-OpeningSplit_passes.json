{
  "filename": "hsbCLT-OpeningSplit.mcr",
  "status": "completed",
  "total_tokens": 40964,
  "processing_time": 935.2021884918213,
  "passes": {
    "1": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "Request timeout after retries"
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select 3D entities (Opening, Element, Sip) and performs direct database modifications such as Sip.dbSplit(), Sip.dbCreate(), and Sip.addOpening(). There is no usage of ShopDrawing prefixes (sd_), Viewport interactions, or dimension generation code."
        },
        "prerequisites": {
          "requiredEntities": [
            "Opening",
            "Element",
            "Sip"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Painter definitions from the 'hsbCLT-OpeningSplit' collection",
            "hsbCAD version 21.0.108 or 22.0.15 or higher"
          ]
        }
      },
      "tokens_used": 6562,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select opening(s), element(s) or panel(s) with openings| |<Enter> to select existing header(s)|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dHeaderX",
            "type": "PropDouble",
            "displayName": "|Extension|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Header|",
            "description": "|Defines the Header Extension in X-Direction|"
          },
          {
            "index": 1,
            "variable": "dHeaderGap",
            "type": "PropDouble",
            "displayName": "|Horizontal Gap|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Header|",
            "description": "|Defines the horizontal gap to the header|"
          },
          {
            "index": 2,
            "variable": "dSillX",
            "type": "PropDouble",
            "displayName": "|Extension| ",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Sill|",
            "description": "|Defines the Sill Extension in X-Direction|"
          },
          {
            "index": 3,
            "variable": "sSplitSill",
            "type": "PropString",
            "displayName": "|Split Sill|",
            "defaultValue": "sNoYes",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Sill|",
            "description": "|Defines wether potential sill panels are to be splitted.|"
          },
          {
            "index": 4,
            "variable": "dGapTop",
            "type": "PropDouble",
            "displayName": "|Top|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Opening|",
            "description": "|Defines the gap on top of to the opening|"
          },
          {
            "index": 5,
            "variable": "dGapBottom",
            "type": "PropDouble",
            "displayName": "|Bottom| ",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Opening|",
            "description": "|Defines the gap on the bottom side of the opening|"
          },
          {
            "index": 6,
            "variable": "dGapLeft",
            "type": "PropDouble",
            "displayName": "|Left| ",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Opening|",
            "description": "|Defines the gap on the left side of the opening|"
          },
          {
            "index": 7,
            "variable": "dGapRight",
            "type": "PropDouble",
            "displayName": "|Right| ",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Opening|",
            "description": "|Defines the gap on the right side of the opening|"
          },
          {
            "index": 8,
            "variable": "sPainterStream",
            "type": "PropString",
            "displayName": "|Painter Definition|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Painter|",
            "description": "|Stores the data of the used painter definition to copy the definition via catalog|"
          },
          {
            "index": 9,
            "variable": "sReference",
            "type": "PropString",
            "displayName": "|Reference|",
            "defaultValue": "sReferences",
            "inputType": "dropdown",
            "options": [
              "|bySelection|"
            ],
            "category": "|Painter|",
            "description": "|Defines the Reference|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7591,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of header and sill panels (filling pieces) around openings in CLT or SIP panels, including splitting the main wall panels to integrate these structural elements.",
          "category": "Structural/Framing",
          "typicalUseCase": "Used during detailing to insert header and sill splints above and below windows/doors to maintain structural continuity or align with floor/ceiling joists, ensuring the main wall panels are split correctly to accommodate these inserts."
        },
        "parameters": [
          {
            "name": "dHeaderX",
            "technicalDefault": "U(0)",
            "businessMeaning": "Controls how far the header panel extends horizontally beyond the sides of the opening.",
            "validRange": "0 to 300 mm (commonly 0-100 mm)",
            "unit": "mm",
            "affectsOutput": "If > 0, the script widens the header panel and calculates vertical split lines in the main wall panels to accommodate this width."
          },
          {
            "name": "dHeaderGap",
            "technicalDefault": "U(0)",
            "businessMeaning": "Defines a horizontal reduction (gap) between the header panel and the opening jambs.",
            "validRange": "0 to 50 mm",
            "unit": "mm",
            "affectsOutput": "Reduces the effective width of the header panel, effectively creating space between the header and the window/door frame."
          },
          {
            "name": "dSillX",
            "technicalDefault": "U(0)",
            "businessMeaning": "Controls how far the sill panel extends horizontally beyond the sides of the opening.",
            "validRange": "0 to 300 mm (commonly 0-100 mm)",
            "unit": "mm",
            "affectsOutput": "If > 0, the script widens the sill panel. Combined with 'Split Sill', this triggers splitting of the main wall panels below the opening."
          },
          {
            "name": "sSplitSill",
            "technicalDefault": "\"sNoYes\"",
            "businessMeaning": "Determines if a separate, distinct sill panel should be created ('Yes') or if the wall should remain continuous/joined at that location ('No').",
            "validRange": "No | Yes",
            "unit": "enum",
            "affectsOutput": "If 'Yes', the script creates a new Sip entity for the sill and cuts the opening out of adjacent panels. If 'No', it attempts to join the sill area back into the main panels."
          },
          {
            "name": "dGapTop",
            "technicalDefault": "U(0)",
            "businessMeaning": "Vertical clearance between the top of the opening and the bottom of the header panel.",
            "validRange": "0 to 50 mm",
            "unit": "mm",
            "affectsOutput": "Lowers the vertical position of the header panel, increasing the height of the opening cutout."
          },
          {
            "name": "dGapBottom",
            "technicalDefault": "U(0)",
            "businessMeaning": "Vertical clearance between the bottom of the opening and the top of the sill panel.",
            "validRange": "0 to 50 mm",
            "unit": "mm",
            "affectsOutput": "Lowers the vertical position (reduces height) of the sill panel, increasing the height of the opening cutout."
          },
          {
            "name": "dGapLeft",
            "technicalDefault": "U(0)",
            "businessMeaning": "Horizontal clearance on the left side of the opening.",
            "validRange": "0 to 50 mm",
            "unit": "mm",
            "affectsOutput": "Insets the opening cutout on the left side."
          },
          {
            "name": "dGapRight",
            "technicalDefault": "U(0)",
            "businessMeaning": "Horizontal clearance on the right side of the opening.",
            "validRange": "0 to 50 mm",
            "unit": "mm",
            "affectsOutput": "Insets the opening cutout on the right side."
          },
          {
            "name": "sPainterStream",
            "technicalDefault": "\"\"",
            "businessMeaning": "Internal string storing the Painter Definition configuration used to copy attributes (material, grade, naming) to new panels.",
            "validRange": "N/A (Hidden/Computed)",
            "unit": "text",
            "affectsOutput": "Ensures newly created panels match specific catalog settings for attributes like Material, Grade, or Name."
          },
          {
            "name": "sReference",
            "technicalDefault": "\"sReferences\"",
            "businessMeaning": "User selection to choose which Painter Definition configuration to apply to the header and sill panels.",
            "validRange": "List of Painter Definitions from 'hsbCLT-OpeningSplit' collection",
            "unit": "enum",
            "affectsOutput": "Applies the specific visual and data attributes (Material, Color, Name, etc.) defined in the selected Painter entry to the new panels."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sSplitSill set to 'No'",
            "effect": "The script attempts to merge the sill area with the main wall panels using dbJoin, effectively undoing a split or preventing one.",
            "cascade": [
              "dSillX",
              "dGapBottom"
            ]
          },
          {
            "trigger": "dHeaderX > 0 or dSillX > 0",
            "effect": "Forces the script to split the existing wall panels (Sip.dbSplit) to insert the wider header or sill pieces.",
            "cascade": [
              "Sip Geometry",
              "Element Composition"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Sip (Panel)",
            "description": "New header and sill panels are generated to fill the void above and below the opening.",
            "appliedTo": "New entities created at the specific coordinates of the opening."
          },
          {
            "type": "Split Sip",
            "description": "Existing main wall panels are cut vertically to allow the insertion of the extended header or sill.",
            "appliedTo": "The original Sip entities selected during the script execution."
          },
          {
            "type": "Opening Cutout",
            "description": "The opening contour, plus any defined gaps, is subtracted from the main wall panels and the new header/sill inserts.",
            "appliedTo": "All Sip entities interacting with the opening profile."
          }
        ]
      },
      "tokens_used": 9124,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch script via command or catalog insert",
          "[Insertion Cycle Check] If cycleCount > 1, erase instance and exit (prevent double execution)",
          "[Entity Selection] Prompt user to select Opening(s), Element(s), or Panel(s) with openings",
          "[Selection Branch] Validate selection type",
          "   -> If selection is Empty: Prompt user to select existing Header(s) instead",
          "   -> If selection is Element: Iterate through all sub-entities (Openings, Sips)",
          "   -> If selection is Sip: Find all Openings contained within the Sip",
          "   -> If selection is Opening: Process directly",
          "[Filtering] Exclude circular openings from processing",
          "[Determine Geometry] Calculate mid-point and orientation vectors (X-axis)",
          "   -> If part of Element, use Element vectors",
          "   -> Else, use local Panel vectors",
          "[Define Profiles] Calculate PlaneProfiles for Header and Sill based on Opening dimensions + Extensions (dHeaderX, dSillX) + Gaps",
          "[Collect Panels] Identify Sip entities that intersect the opening geometry",
          "[Header Processing]",
          "   -> Split intersecting panels vertically at the opening center line (unless processing an existing header)",
          "   -> Apply opening cutout (minus gaps) to the split/intersected panels",
          "   -> Create new Header Sip entity using the calculated Header Profile (if not processing existing header)",
          "   -> Copy attributes (Color, Name, Material, Grade, etc.) from source panels or Element",
          "[Sill Processing]",
          "   -> [Condition: Split Sill = Yes]",
          "     -> Apply opening cutout (minus gaps) to the underlying panels",
          "     -> Create new Sill Sip entity using the calculated Sill Profile",
          "     -> Copy attributes from source panels or Element",
          "   -> [Condition: Split Sill = No]",
          "     -> Identify panels overlapping the Sill area",
          "     -> Execute dbJoin command to merge the Sill area back into the main panels",
          "[Painter Application] Apply selected Painter Definition attributes to the new Header/Sill Sips",
          "[Cleanup] Erase the script instance (TSL instance) upon completion",
          "End"
        ],
        "conditionalBranches": [
          {
            "condition": "Initial User Selection (PrEntity)",
            "path1": {
              "name": "Empty Selection",
              "steps": [
                "Execute secondary PrEntity prompt to select existing Header(s)",
                "Process geometry of selected headers"
              ]
            },
            "path2": {
              "name": "Selection Present",
              "steps": [
                "Filter entities by type (Element, Sip, Opening)",
                "Process openings derived from these entities"
              ]
            }
          },
          {
            "condition": "Entity Type Selected",
            "path1": {
              "name": "Element",
              "steps": [
                "Extract all openings belonging to the element",
                "Extract all panels (Sips) belonging to the element",
                "Process each opening found"
              ]
            },
            "path2": {
              "name": "Sip (Panel)",
              "steps": [
                "Find all openings assigned to this specific panel",
                "Set this panel as the source for attributes"
              ]
            },
            "path3": {
              "name": "Opening",
              "steps": [
                "Process this specific opening geometry",
                "Search for host panels automatically"
              ]
            }
          },
          {
            "condition": "sSplitSill Property Value",
            "path1": {
              "name": "Yes (Create Split)",
              "steps": [
                "Calculate Sill profile (Opening width + dSillX)",
                "Cut out Sill profile from wall panels",
                "Create new Sip entity for the Sill",
                "Assign attributes to new Sip"
              ]
            },
            "path2": {
              "name": "No (Join)",
              "steps": [
                "Identify wall panels overlapping the Sill area",
                "Merge panels (dbJoin) to remove the split line in the sill area",
                "Do not create a separate Sill Sip entity"
              ]
            }
          },
          {
            "condition": "Valid Header Entity Selected",
            "path1": {
              "name": "Processing Existing Header",
              "steps": [
                "Skip splitting panels at center line",
                "Skip creating a new Header filling piece",
                "Only apply gaps and cutouts to surrounding geometry"
              ]
            },
            "path2": {
              "name": "Processing Opening/Panel",
              "steps": [
                "Split panels at center line",
                "Create new Header filling piece"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None (Silent exit)",
            "recovery": "Script automatically handles multi-insertion scenarios by exiting after the first cycle to prevent duplication."
          },
          {
            "check": "Opening Geometry",
            "errorMessage": "None specific in code",
            "recovery": "Circular openings are silently skipped/excluded from processing."
          },
          {
            "check": "Required Entities",
            "errorMessage": "None explicit",
            "recovery": "If no panels are found intersecting the opening geometry, the script effectively does nothing visually for that location."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Header/Sill Extension",
            "how": "OPM Properties (Header->Extension / Sill->Extension)",
            "effect": "Requires re-insertion or re-running the script to update geometry (script uses 'eraseInstance' pattern, implying it is a generator script)."
          },
          {
            "action": "Toggle Sill Splitting",
            "how": "OPM Properties (Sill->Split Sill)",
            "effect": "Changing 'No' to 'Yes' will re-run the logic to split the panels and insert a sill part. Changing 'Yes' to 'No' will re-run the logic to join the panels."
          },
          {
            "action": "Adjust Gaps",
            "how": "OPM Properties (Opening category)",
            "effect": "Updates the clearance around the window/door. Requires recalculation."
          }
        ]
      },
      "tokens_used": 10330,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-OpeningSplit.mcr\n\n## Overview\nThis script automates the creation of structural header and sill panels around openings in CLT or SIP walls. It calculates the necessary geometry, splits existing wall panels to accommodate the inserts, and applies specific material attributes via Painter definitions.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script works on 3D model entities (Openings, Elements, Panels). |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: At least one Opening, Element (Wall), or Sip (Panel) entity.\n- **Minimum Beams**: 0 (Script targets Panels/Sips).\n- **Required Settings**: Painter definitions must exist in the `hsbCLT-OpeningSplit` collection in your hsbCAD catalog.\n- **Software Version**: hsbCAD version 21.0.108 or 22.0.15 or higher.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or select from your custom toolbar/menu)\nAction: Browse and select `hsbCLT-OpeningSplit.mcr`.\n\n### Step 2: Select Geometry\n```\nCommand Line: Select opening(s), element(s) or panel(s) with openings <Enter> to select existing header(s):\nAction: Click on the desired openings (windows/doors), the entire wall element, or specific panels. Press Enter to proceed to the next step or to select existing headers.\n```\n\n### Step 3: Configure Properties (Optional)\nAction: Before pressing Enter to finish, you can adjust the Header/Sill extensions and gaps in the Properties Palette (OPM) if the script focus is active.\n\n### Step 4: Execution\nAction: Press Enter. The script will process the geometry, split the panels, create the header/sill inserts, and then erase itself from the drawing.\n\n## Properties Panel Parameters\n\n### Header\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Extension | number | 0 | Defines how far the header panel extends horizontally beyond the opening sides. |\n| Horizontal Gap | number | 0 | Defines the horizontal gap between the header panel and the opening jambs. |\n\n### Sill\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Extension | number | 0 | Defines how far the sill panel extends horizontally beyond the opening sides. |\n| Split Sill | dropdown | No | Determines if a separate sill panel is created (**Yes**) or if the sill area is merged back into the main wall panels (**No**). |\n\n### Opening\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Top | number | 0 | Defines the vertical gap between the top of the opening and the header panel. |\n| Bottom | number | 0 | Defines the vertical gap between the bottom of the opening and the sill panel. |\n| Left | number | 0 | Defines the horizontal gap on the left side of the opening. |\n| Right | number | 0 | Defines the horizontal gap on the right side of the opening. |\n\n### Painter\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Reference | dropdown | bySelection | Selects the Painter Definition to apply attributes (Material, Grade, Name, etc.) to the new panels. |\n| Painter Definition | text | [Internal] | Internal data field used to copy the catalog definition. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script functions as a generator and erases itself after execution. There are no persistent right-click menu options attached to the script instance. |\n\n## Settings Files\n- **Painter Collection**: `hsbCLT-OpeningSplit`\n- **Location**: hsbCAD Catalog (Company or Install folder)\n- **Purpose**: Provides the templates for naming, material grading, and layer assignment for the generated header and sill panels.\n\n## Tips\n- **Splitting Logic**: If you set \"Split Sill\" to **No**, the script will attempt to join the wall panels at the sill location, effectively removing a previous sill split.\n- **Existing Headers**: If you want to modify an existing header configuration (e.g., change its width), run the script and press **Enter** immediately at the first prompt. This allows you to select specific existing header entities to process.\n- **Circular Openings**: The script automatically detects and skips circular openings; it is designed for rectangular profiles only.\n- **Attributes**: Use the \"Reference\" dropdown in the Properties Palette to ensure your new header and sill panels match the correct material specifications for your project.\n\n## FAQ\n- **Q: Why did the script disappear after I ran it?**\n  - A: This is a \"generator\" script. It creates the physical geometry (panels and cuts) and then removes its own instance from the drawing to keep the file size small.\n- **Q: How do I change the header size after it has been created?**\n  - A: Since the script instance is gone, you must run the script again. You can either delete the existing header and run the script on the opening, or use the \"Select existing header(s)\" option by pressing Enter at the first prompt.\n- **Q: The script didn't create a sill panel.**\n  - A: Check the **Split Sill** property in the Properties Palette before running the script. If it is set to \"No\", the script will merge the sill area into the main wall rather than creating a separate piece."
      },
      "tokens_used": 7357,
      "error": null
    }
  }
}