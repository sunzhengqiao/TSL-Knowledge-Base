{
  "filename": "hsb_ShowPosnum.mcr",
  "status": "completed",
  "total_tokens": 33832,
  "processing_time": 233.78843069076538,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "11.04.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version."
          },
          {
            "version": "1.1",
            "date": "13.04.2011",
            "author": "Chirag Sawjani (cs@itw-industry.com)",
            "changes": "Bugfix on sending text height to clone TSLs"
          },
          {
            "version": "1.2",
            "date": "22.12.2011",
            "author": "Chirag Sawjani (cs@itw-industry.com)",
            "changes": "Bugfix offset of TSL and projection to plane on centre of beam"
          },
          {
            "version": "1.3",
            "date": "22.12.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Attach the posnum to Info layer if the beam is part of an element."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4624,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No 'sd_' or 'Multipage' prefix. Script uses PrEntity for selection (Model Space interaction). Logic clones TSL onto GenBeam/MassGroup entities found in the model. No _Viewport or Paper Space specific APIs used."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "MassGroup"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3881,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Please select entities that have position numbers",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "130",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nHeight",
            "type": "PropInt",
            "displayName": "Enter Text Height",
            "defaultValue": "80",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nOffset",
            "type": "PropDouble",
            "displayName": "Offset from Beam",
            "defaultValue": "250",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nOffsetX",
            "type": "PropDouble",
            "displayName": "Offset btw Lines",
            "defaultValue": "150",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dRotation",
            "type": "PropDouble",
            "displayName": "Set Rotation",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDispRepHead",
            "type": "PropString",
            "displayName": "Disp Rep Header",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6563,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically labels timber beams and mass groups with their manufacturing position numbers in 3D model space, ensuring visual identification and tagging for production.",
          "category": "ShopDrawing/ModelAnnotation",
          "typicalUseCase": "Used to visually mark structural elements (beams, panels) with their unique position numbers directly on the model to assist with assembly planning and identification in the 3D view."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Selects the specific drafting style (e.g., font, arrow style) to be used for the position number text, ensuring consistency with CAD standards.",
            "validRange": "List of available DimStyles in the drawing template",
            "unit": "string",
            "affectsOutput": "Changes the visual appearance (font, line weight) of the displayed text."
          },
          {
            "name": "nColor",
            "technicalDefault": "130",
            "businessMeaning": "Defines the CAD color index used for the position number text, allowing users to color-code annotations (e.g., specific colors for floor vs. wall beams).",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "index",
            "affectsOutput": "Changes the color of the position number text in the model."
          },
          {
            "name": "nHeight",
            "technicalDefault": "80",
            "businessMeaning": "Sets the physical height of the position number text in the model, determining legibility relative to the timber element size.",
            "validRange": "30 - 300 (depending on model scale and beam size)",
            "unit": "mm",
            "affectsOutput": "Scales the size of the text object up or down."
          },
          {
            "name": "nOffset",
            "technicalDefault": "250",
            "businessMeaning": "Controls the perpendicular distance the label is placed away from the surface of the beam or panel to prevent overlapping with the material geometry.",
            "validRange": "0 - 500",
            "unit": "mm",
            "affectsOutput": "Moves the text closer to or further from the beam surface."
          },
          {
            "name": "nOffsetX",
            "technicalDefault": "150",
            "businessMeaning": "Defines the horizontal offset used to calculate the text orientation and alignment vector relative to the insertion point.",
            "validRange": "0 - 300",
            "unit": "mm",
            "affectsOutput": "Adjusts the alignment direction vector of the text."
          },
          {
            "name": "dRotation",
            "technicalDefault": "0",
            "businessMeaning": "Rotates the position number text around the vertical axis (Z-axis) relative to the beam, allowing customization of text angle for readability.",
            "validRange": "-180 - 360",
            "unit": "degrees",
            "affectsOutput": "Rotates the text label clockwise or counter-clockwise."
          },
          {
            "name": "sDispRepHead",
            "technicalDefault": "",
            "businessMeaning": "Specifies a Display Representation (e.g., 'Presentation', 'Detailed') in which the label should be visible. If left empty, it uses the default display behavior.",
            "validRange": "Any valid Display Representation name in the project",
            "unit": "string",
            "affectsOutput": "Controls visibility of the label depending on the active display view configuration."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "Text/Annotation",
            "description": "A 3D text object displaying the Position Number (e.g., 'B1', 'W2') derived from the beam or mass group properties.",
            "appliedTo": "The specific GenBeam or MassGroup selected during script execution. If the beam is part of an Element, the text is attached to the 'Info' layer of that element."
          }
        ]
      },
      "tokens_used": 4729,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script launched via command or catalog execution.\",\n    \"2. Properties initialized from catalog if execution key is present.\",\n    \"3. Internal check: If insertion cycle count > 1, erase instance and exit (anti-recursion).\",\n    \"4. If no execute key, display properties dialog once.\",\n    \"5. Prompt user to select entities (PrEntity) filtering for 'Position Numbers'.\",\n    \"6. Iterate through selection set to identify GenBeam or MassGroup entities.\",\n    \"7. For each valid entity, search for existing instances of this script attached to it.\",\n    \"8. Remove any existing found instances (to ensure uniqueness).\",\n    \"9. Clone the script instance onto the target entity, passing current property values.\",\n    \"10. Erase the initial 'launcher' script instance.\",\n    \"11. Each 'cloned' instance runs logic independently:\",\n    \"12. [Branch] Determine logic based on Entity Type (GenBeam vs MassGroup).\",\n    \"13. Retrieve coordinate system and position number string from host entity.\",\n    \"14. [Branch] Check if entity is part of an assembly Element.\",\n    \"15. Calculate text placement plane and rotation coordinate system.\",\n    \"16. Check internal Map for 'nSetOrg' to distinguish between Initial Placement and Update.\",\n    \"17. Set text insertion point and alignment vector.\",\n    \"18. Apply Display Representation settings if specified.\",\n    \"19. Draw text entity in 3D model space.\",\n    \"20. Finalize layer/group assignment based on Element status.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Host Entity Type\",\n      \"path1\": {\n        \"name\": \"GenBeam\",\n        \"steps\": [\n          \"Set ptDraw to Beam Center (bm.ptCen).\",\n          \"Set Plane using Beam Center and World Z.\",\n          \"Retrieve Position Number (posnum).\",\n          \"Check if beam belongs to an Element.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"MassGroup\",\n        \"steps\": [\n          \"Set ptDraw to Entity Origin (coordSysEntity.ptOrg).\",\n          \"Set Plane using Origin and World Z.\",\n          \"Retrieve Position Number (posnum).\",\n          \"Skip Element check.\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"Invalid/None\",\n        \"steps\": [\n          \"Erase script instance immediately.\",\n          \"Exit execution.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Element Membership (GenBeam only)\",\n      \"path1\": {\n        \"name\": \"Element Found\",\n        \"steps\": [\n          \"Assign TSL instance to Element Group 'I' (Info).\",\n          \"Set bAssingedToElement flag to True.\",\n          \"Skip generic group assignment.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No Element\",\n        \"steps\": [\n          \"Leave bAssingedToElement flag False.\",\n          \"Assign TSL instance to Beam's generic groups at end of script.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Initialization State (Map Check)\",\n      \"path1\": {\n        \"name\": \"First Run / No Map Entry\",\n        \"steps\": [\n          \"Calculate _Pt0 using Offset formula from beam center.\",\n          \"Calculate _PtG (Grip point) using X-vector and Rotation.\",\n          \"Set 'nSetOrg' integer in Map to True.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Update / Map Entry Exists\",\n        \"steps\": [\n          \"Retain existing _Pt0 and _Pt"
      },
      "tokens_used": 7916,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ShowPosnum.mcr\n\n## Overview\nThis script automatically labels timber beams and mass groups with their manufacturing position numbers in the 3D model space, ensuring visual identification and tagging for production.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script runs and annotates entities in the 3D model. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | This is a model annotation tool, not a layout generator. |\n\n## Prerequisites\n- **Required entities**: GenBeam or MassGroup entities.\n- **Minimum beam count**: 1.\n- **Required settings**: None.\n- **Data Requirement**: Entities must have assigned position numbers (PosNum) already generated.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_ShowPosnum.mcr` from the file dialog or run via a catalog.\n\n### Step 2: Configure Properties (Optional)\nIf no execution key is set, a properties dialog may appear automatically. Alternatively, set your preferred text height, color, and offset in the Properties Palette (Ctrl+1) before proceeding to the next step.\n\n### Step 3: Select Entities\n```\nCommand Line: Please select entities that have position numbers\nAction: Click on the beams or mass groups you wish to label, then press Enter.\n```\nThe script will process the selection and attach a position number label to each valid entity. If the script is already attached to an entity, it will update the existing label.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimstyle | dropdown | _DimStyles | Selects the drafting style (font, arrow style) for the text. |\n| Color | number | 130 | Sets the CAD color index (0-255) for the text. |\n| Enter Text Height | number | 80 | Defines the physical height of the text in millimeters. |\n| Offset from Beam | number | 250 | Sets the distance (mm) the label is placed away from the beam surface. |\n| Offset btw Lines | number | 150 | Adjusts the horizontal alignment vector (mm) relative to the insertion point. |\n| Set Rotation | number | 0 | Rotates the text label around the Z-axis in degrees. |\n| Disp Rep Header | text | [Blank] | Specifies a Display Representation (e.g., 'Presentation') for visibility control. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are defined for this script. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: This script relies on standard entity properties and does not require external XML settings files.\n\n## Tips\n- **Element Layers**: If a beam is part of an assembly (Element), the label is automatically attached to the Element's \"Info\" layer, ensuring it moves with the element.\n- **Visual Clash**: Increase the \"Offset from Beam\" value if the text is clipping into the material geometry in the 3D view.\n- **Batch Processing**: You can select multiple beams or mass groups in a single selection set to label them all at once.\n\n## FAQ\n- **Q: Why didn't the text appear on my beam?**\n  **A:** Ensure the beam has a valid Position Number assigned. Also, check if a specific Display Representation is set in the script properties and ensure that view is active in AutoCAD.\n- **Q: How do I change the font of the position number?**\n  **A:** Select the dimension style you wish to use in the `Dimstyle` property dropdown. Ensure the desired text style is configured in your CAD standard.\n- **Q: Can I rotate the text to face a specific direction?**\n  **A:** Yes, use the `Set Rotation` property. A value of 0 aligns it to the default beam axis; adjust degrees to rotate as needed."
      },
      "tokens_used": 6119,
      "error": null
    }
  }
}