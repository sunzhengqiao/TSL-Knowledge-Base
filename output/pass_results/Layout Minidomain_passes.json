{
  "filename": "Layout Minidomain.mcr",
  "status": "completed",
  "total_tokens": 34662,
  "processing_time": 260.7633557319641,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 6458,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Viewport interaction: getViewport(), _Viewport array, vp.ptCenPS(). Coordinate transformation: ms2ps = vp.coordSys(). Logic fetches Element from Viewport: Element el = vp.element()."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Viewport"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space (Layout) containing Viewports linked to Elements",
          "requiredSettings": []
        }
      },
      "tokens_used": 4843,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Properties Dialog (Implicit)",
            "trigger": "On Insert",
            "title": null,
            "dataSource": "Internal properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "d0",
            "type": "PropDouble",
            "displayName": "Scale",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Scale of the symbol"
          },
          {
            "index": 1,
            "variable": "d1",
            "type": "PropDouble",
            "displayName": "max. Length",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Shows a warning if the element length exceeds the value given"
          },
          {
            "index": 0,
            "variable": "s0",
            "type": "PropString",
            "displayName": "Check wall number",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "Shows a warning if the element name does not have a least 3 characters"
          },
          {
            "index": 1,
            "variable": "sHighlightElement",
            "type": "PropString",
            "displayName": "Highlight Element",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "This TSL shows a scalable arrow as default display. If this option is enabled it will also show the outline of the current element."
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4130,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Visualizes the orientation and location of an element within a selected Layout Viewport (Mini-domain) using an arrow or triangle symbol, and performs checks against design constraints (length and naming).",
          "category": "Layout/Annotation",
          "typicalUseCase": "Placing a directional indicator on a 2D drawing layout to show which wall or roof element is displayed in a specific viewport, while simultaneously verifying if the element fits within transport or manufacturing length limits."
        },
        "parameters": [
          {
            "name": "d0",
            "technicalDefault": 2,
            "businessMeaning": "Controls the visual size of the orientation symbol (arrow or triangle) drawn in Paper Space. It scales the symbol relative to the layout to ensure visibility regardless of the viewport scale.",
            "validRange": "0.5 to 10.0",
            "unit": "Multiplier",
            "affectsOutput": "Modifies the geometric dimensions of the directional arrow/triangle drawn in the layout."
          },
          {
            "name": "d1",
            "technicalDefault": 0,
            "businessMeaning": "Defines the maximum allowable production or transport length for the element. If set to a value greater than 0, the script triggers a warning if the actual element length exceeds this limit.",
            "validRange": "0 (disabled) to 20000 (20m)",
            "unit": "mm",
            "affectsOutput": "Does not change geometry, but generates a text report/warning in the command line if the constraint is violated."
          },
          {
            "name": "s0",
            "technicalDefault": "No",
            "businessMeaning": "Enforces a naming convention check for elements. It verifies that the Element Name/Wall Number contains at least 3 characters to ensure proper identification in production.",
            "validRange": "\"Yes\", \"No\"",
            "unit": "Selection",
            "affectsOutput": "Does not change geometry, but generates a text report/warning if the element name is too short."
          },
          {
            "name": "sHighlightElement",
            "technicalDefault": "No",
            "businessMeaning": "Toggles the display mode between a simple directional symbol and a detailed outline. When enabled, it draws the exact 2D projection (outline or envelope) of the element in Paper Space.",
            "validRange": "\"Yes\", \"No\"",
            "unit": "Selection",
            "affectsOutput": "Switches between drawing a simple Arrow/Triangle (No) and drawing the full Element Outline (Yes). The outline is drawn on top of or alongside the symbol."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "When 'sHighlightElement' is set to 'Yes'",
            "effect": "The script draws the element geometry in addition to the symbol defined by 'd0'.",
            "cascade": [
              "sHighlightElement",
              "d0"
            ]
          },
          {
            "trigger": "When Element Type is Wall vs Other",
            "effect": "The script selects different base geometry (Arrow vs Triangle) and different outline sources (plOutlineWall vs plEnvelope) for the 'Highlight' feature.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "2D PLine (Polyline)",
            "description": "A directional arrow (for walls) or triangle (for roofs/other) scaled by 'd0'.",
            "appliedTo": "Paper Space Layout (at the center of the selected Viewport)"
          },
          {
            "type": "2D PLine (Polyline)",
            "description": "The precise 2D outline or envelope of the element, projected into Paper Space.",
            "appliedTo": "Paper Space Layout (when 'Highlight Element' is 'Yes')"
          },
          {
            "type": "Text Notification",
            "description": "Warnings regarding element length exceeding 'd1' or element name length being insufficient.",
            "appliedTo": "hsbCAD Command Line / Log"
          }
        ]
      },
      "tokens_used": 6477,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User executes script insertion in Paper Space.",
          "2. Properties Dialog appears for initial configuration (Scale, Max Length, Wall Number Check, Highlight).",
          "3. User selects a Viewport on the current Layout via command line prompt.",
          "4. Script calculates the Viewport's center point in Paper Space.",
          "5. Script retrieves the Element associated with the selected Viewport.",
          "6. Script verifies if the Viewport contains valid hsbCAD Element data.",
          "7. [Conditional Branch] Script determines if the Element is a Wall or a Roof/Other type.",
          "8. Script generates the directional symbol geometry (Arrow for Wall, Triangle for Other) scaled by 'd0'.",
          "9. [Conditional Branch] If 'Highlight Element' is Yes, the Element's Outline or Envelope is calculated and transformed to Paper Space.",
          "10. [Conditional Branch] If 'max. Length' > 0, script compares element length and reports warnings if exceeded.",
          "11. [Conditional Branch] If 'Check wall number' is Yes, script validates Element Name length and reports warnings if invalid.",
          "12. Script draws the final 2D geometry in Paper Space."
        ],
        "conditionalBranches": [
          {
            "condition": "Element Type Detection (Casting to ElementWall)",
            "path1": {
              "name": "Wall Element",
              "steps": [
                "Retrieve Wall Outline points",
                "Calculate wall center based on X-vector",
                "Draw directional Arrow PLine",
                "Check Max Length (if d1 > 0)",
                "Check Wall Number (if s0 == Yes)",
                "Draw Wall Outline (if Highlight Enabled)"
              ]
            },
            "path2": {
              "name": "Roof/Other Element",
              "steps": [
                "Calculate rotation angle relative to Z-vector",
                "Draw directional Triangle PLine",
                "Close and Fill Triangle",
                "Draw Element Envelope (if Highlight Enabled)"
              ]
            }
          },
          {
            "condition": "Highlight Element Property (sHighlightElement)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Fetch specific geometry (plOutlineWall for Walls, plEnvelope for Others)",
                "Transform geometry from Model Space to Paper Space",
                "Draw geometry on top of symbol"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skip drawing detailed geometry",
                "Display only the directional Arrow or Triangle symbol"
              ]
            }
          },
          {
            "condition": "Viewport Data Validity",
            "path1": {
              "name": "Valid Element Present",
              "steps": [
                "Proceed with coordinate transformation and drawing"
              ]
            },
            "path2": {
              "name": "Invalid/No Element",
              "steps": [
                "Script terminates execution immediately",
                "No geometry is drawn"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport contains a valid Element",
            "errorMessage": "None (Silent failure)",
            "recovery": "Select a different viewport that is linked to a valid hsbCAD element."
          },
          {
            "check": "Element Length vs Max Length Property (d1)",
            "errorMessage": "ReportNotice: 'Element [Number] does not match max. length conventions. An element length of [Val] exceeds the maximal length of [d1]'",
            "recovery": "User should increase 'd1' property or modify the element in the model to be shorter."
          },
          {
            "check": "Element Name Length (s0 == Yes)",
            "errorMessage": "ReportNotice: 'Element [Number] does not match name conventions. Please check element number!'",
            "recovery": "User should rename the element in the model to have at least 3 characters or set 'Check wall number' to 'No'."
          },
          {
            "check": "Wall Outline Availability",
            "errorMessage": "None (Silent failure for walls with 0 outline points)",
            "recovery": "Ensure the wall element has valid geometry/contour."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties via OPM (Object Properties Manager)",
            "how": "Select the TSL instance in AutoCAD and change values in the Properties palette (d0, d1, s0, sHighlightElement).",
            "effect": "The script recalculates immediately. Changes include resizing the symbol (d0), enabling/disabling warnings (d1, s0), or toggling the element outline visualization (sHighlightElement)."
          },
          {
            "action": "Modify Underlying Element",
            "how": "Change the geometry or name of the element referenced by the viewport.",
            "effect": "The TSL updates its display (arrow position/orientation, highlight outline) and re-evaluates validation rules on the next recalculation."
          },
          {
            "action": "Delete or Modify Viewport",
            "how": "Standard AutoCAD editing of the viewport entity.",
            "effect": "If the viewport link is broken or the viewport is deleted, the TSL will fail to find the element and stop drawing (Silent failure)."
          }
        ]
      },
      "tokens_used": 7437,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Layout Minidomain.mcr\n\n## Overview\nThis script creates a directional indicator (arrow or triangle) in Paper Space to visualize the orientation of an element within a selected Viewport. It optionally draws the element's outline and performs automated checks for length limits and naming conventions.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | Must be inserted in Paper Space. |\n| Paper Space | Yes | Intended for use on Layouts containing Viewports. |\n| Shop Drawing | No | This is a layout annotation tool. |\n\n## Prerequisites\n- **Required Entities**: A Viewport on the current Layout that is linked to a valid hsbCAD Element (Wall or Roof).\n- **Minimum Beam Count**: 0 (Script reads the Element inside the Viewport).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Layout Minidomain.mcr`\n\n### Step 2: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the viewport frame in Paper Space that displays the element you wish to annotate.\n```\n\n### Step 3: Configure Properties\nAfter insertion, the script will calculate the position and draw the symbol. You can immediately adjust the appearance by selecting the newly inserted script object and modifying properties in the Properties Palette (Ctrl+1).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Scale | Number | 2 | Controls the size of the directional arrow/triangle symbol. Increase if the symbol is too small to see. |\n| max. Length | Number | 0 | Sets a length limit in mm. If set to > 0, the script reports a warning if the element length exceeds this value (e.g., transport length check). |\n| Check wall number | Dropdown | No | If set to \"Yes\", the script validates that the Element Name has at least 3 characters and reports a warning if invalid. |\n| Highlight Element | Dropdown | No | If set to \"Yes\", draws the full 2D outline of the element in Paper Space instead of just a simple symbol. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not add specific custom items to the right-click context menu. Use the Properties Palette to modify settings. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Visibility**: If you cannot see the arrow after insertion, check if the layer is frozen or increase the **Scale** property (d0).\n- **Detail View**: Use the **Highlight Element** property set to \"Yes\" to quickly project a \"clean\" view of a single wall or roof element onto your layout without other model clutter.\n- **Quality Control**: Set **max. Length** (d1) to your maximum transport size (e.g., 13000 mm). The script will automatically flag elements in the viewport that are too long for transport via the command line.\n- **Wall vs. Roof**: The script automatically detects the element type. It draws an Arrow for Walls and a Triangle for Roofs/Other elements to indicate direction.\n\n## FAQ\n- **Q: Why did the script not draw anything?**\n  - A: Ensure the selected Viewport actually contains a valid hsbCAD Element. If the viewport is empty or looking at empty space, the script will terminate silently.\n\n- **Q: How do I check if my walls are too long for the truck?**\n  - A: Select the script instance in Paper Space. In the Properties palette, set **max. Length** to your limit (e.g., 14000). Look at the AutoCAD command line (F2) to see warnings for any elements that exceed this length.\n\n- **Q: Can I change the element after placing the symbol?**\n  - A: Yes. If you change the model (geometry or name) or pan/zoom the viewport, the script will update automatically to reflect the new state."
      },
      "tokens_used": 5317,
      "error": null
    }
  }
}