{
  "filename": "GE_HDWR_STUD_PLATE_TIE_SPTR.mcr",
  "status": "completed",
  "total_tokens": 50938,
  "processing_time": 406.49467301368713,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": 1,\n    \"minorVersion\": 4,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.4\",\n      \"date\": \"02.jun.2014\",\n      \"author\": \"David Rueda (dr@hsb-cad.com)\",\n      \"changes\": \"Added features to make possible reset TXT source file using GE_HDWR_RESET_CATALOG_ENTRY tsl\"\n    },\n    {\n      \"version\": \"1.3\",\n      \"date\": \"06.mar.2013\",\n      \"author\": \"David Rueda (dr@hsb-cad.com)\",\n      \"changes\": \"Bugfix: DImensions properly taken from map accordingly to insertion method (manual/auto)\"\n    },\n    {\n     "
      },
      "tokens_used": 8722,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates 3D geometry using Body bd(pl, vz*dThickness,1) and dp.draw(bd). It operates on GenBeam objects selected via PrEntity and stored in the _Beam array. There are no 'sd_' prefixes, no '_Viewport' usage, and no '#Type E' definitions, indicating it is a standard modeling script for placing hardware in the 3D model."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space containing vertical stud beams and at least one bottom or top plate beam.",
          "requiredSettings": [
            "TSL_Read_Metalpart_Family_Props.dll (must be in ..\\Utilities\\TslCustomSettings)",
            "TXT file containing SPTR families details (path configurable)",
            "TSL_HARDWARE_FAMILY_LIST.dxx catalog file"
          ]
        }
      },
      "tokens_used": 6425,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\n|Select stud(s) and plate(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "\n|Pick a point to define on what face of studs place hardware|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "|Type|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dLength",
            "type": "PropDouble",
            "displayName": "|Lenght|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dMajorWidth",
            "type": "PropDouble",
            "displayName": "|Major Width|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dMinorWidth",
            "type": "PropDouble",
            "displayName": "|Minor Width|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Change type",
            "handler": "sChangeType",
            "action": "Recalculates and calls external function to prompt user for a new hardware family type.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Help",
            "handler": "sHelp",
            "action": "Displays a report notice with script usage information.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "TSL_HARDWARE_FAMILY_LIST.dxx",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Catalog\\"
            ],
            "purpose": "Catalog file listing hardware families.",
            "required": true
          },
          {
            "filename": "TSL_Read_Metalpart_Family_Props.dll",
            "searchPaths": [
              "_kPathHsbInstall\\Utilities\\TslCustomSettings\\"
            ],
            "purpose": "DLL library containing functions to read family properties from TXT source files and handle type selection dialogs.",
            "required": true
          }
        ]
      },
      "tokens_used": 9138,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 3D model of a Stud Plate Tie (SPTR) metal connector, securing vertical studs to horizontal top or bottom plates in timber framing.",
          "category": "Hardware",
          "typicalUseCase": "Used when detailing wall frames to indicate the location and type of metal strap ties required to resist uplift or shear loads, typically at the ends of walls or specific load points."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "",
            "businessMeaning": "The specific manufacturer model or catalog code for the Stud Plate Tie (e.g., 'SPTR38'). It identifies the family of the hardware.",
            "validRange": "N/A (String values from Catalog)",
            "unit": "String",
            "affectsOutput": "Determines the initial set of dimensions (Length, Widths) loaded from the external catalog TXT file."
          },
          {
            "name": "dLength",
            "technicalDefault": "0",
            "businessMeaning": "The total length of the metal tie strap.",
            "validRange": "100mm - 600mm (approx 4\" - 24\")",
            "unit": "mm (or inches)",
            "affectsOutput": "Defines the longitudinal extent of the 3D body along the wall/stud axis."
          },
          {
            "name": "dMajorWidth",
            "technicalDefault": "0",
            "businessMeaning": "The width of the main plate section of the tie that sits flush against the face of the stud.",
            "validRange": "50mm - 150mm (approx 2\" - 6\")",
            "unit": "mm (or inches)",
            "affectsOutput": "Controls the geometry of the central body width and the angle of the side cuts."
          },
          {
            "name": "dMinorWidth",
            "technicalDefault": "0",
            "businessMeaning": "The width of the narrower strap sections that wrap around the sides of the stud/plate.",
            "validRange": "20mm - 75mm (approx 0.75\" - 3\")",
            "unit": "mm (or inches)",
            "affectsOutput": "Controls the width of the tail sections of the strap and the angle of the side cuts."
          },
          {
            "name": "Entity Selection (PrEntity)",
            "technicalDefault": "Prompt Input",
            "businessMeaning": "Selection of the structural components (vertical studs and horizontal plates) to be connected.",
            "validRange": "Minimum 1 Stud + 1 Plate",
            "unit": "Set of Beams",
            "affectsOutput": "Defines the connection points. The script calculates the intersection of studs and plates to position the hardware. If multiple studs are selected, the script instances itself onto each stud."
          },
          {
            "name": "Face Definition (getPoint)",
            "technicalDefault": "Prompt Input",
            "businessMeaning": "Defines the specific face (side) of the studs where the hardware should be applied.",
            "validRange": "Any point in 3D space relative to the wall",
            "unit": "Point3d",
            "affectsOutput": "Determines the orientation (offset) of the hardware on the stud's local Y/Z axes, ensuring the tie is on the correct side of the wall (e.g., interior vs exterior)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Calculation of side cuts (dSideCut)",
            "effect": "Calculates the diagonal transition width between the Major Width and Minor Width.",
            "cascade": [
              "dMajorWidth",
              "dMinorWidth"
            ]
          },
          {
            "trigger": "Detection of Extra Plate (bExistsExtraPlate)",
            "effect": "Adjusts the offset (dOff) of the hardware length to account for double top plates or rim joists.",
            "cascade": [
              "dVariableStudEndLength"
            ]
          },
          {
            "trigger": "Change type (Context Menu)",
            "effect": "Reloads the Map properties from the catalog, potentially resetting dLength, dMajorWidth, and dMinorWidth to the new type's defaults.",
            "cascade": [
              "sType",
              "dLength",
              "dMajorWidth",
              "dMinorWidth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body",
            "description": "A 3D parametric body representing the metal strap tie, including the main plate, wrapping straps, and chamfered corners.",
            "appliedTo": "Individual Stud Beams (The script creates one instance per stud detected in the selection set)."
          }
        ]
      },
      "tokens_used": 9808,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"Script invoked (Manual Insert or Recalculation)\",\n    \"Check: If insertCycleCount > 1, erase instance and exit (prevents duplicate execution)\",\n    \"Check: If context menu 'Change type' triggered, reload properties from external DLL/Map\",\n    \"Check: If _bOnInsert (Manual Insert phase)\",\n    \"   Load Hardware Family catalog via TSL_Read_Metalpart_Family_Props.dll\",\n    \"   Prompt user to Select Stud(s) and Plate(s) (PrEntity)\",\n    \"   Prompt user to Pick a point to define face side (getPoint)\",\n    \"   Filter selection into arrays: Vertical Studs, Bottom Plates, Top Plates\",\n    \"   Validate: Check for valid studs and valid plates\",\n    \"   Determine connection targets: Set flags for Top Tie and/or Bottom Tie\",\n    \"   Loop through each vertical stud found:\",\n    \"     Spawn new TSL instance (dbCreate) for bottom connection if plates exist\",\n    \"     Spawn new TSL instance (dbCreate) for top connection if plates exist\",\n    \"   Erase the parent 'generator' instance\",\n    \"   Exit workflow\",\n    \"If Child Instance (Created by tool or generator):\",\n    \"   Retrieve 'bOnInsert' flag from Map to determine source (Manual vs Utility)\",\n    \"   Branch: Calculate Geometry Origin and Vectors\",\n    \"   Retrieve hardware dimensions (Length, Major Width, Minor Width) from Map\",\n    \"   Check for duplicate instances on same stud and erase them\",\n    \"   Calculate geometry offsets based on plate type (Single vs Double/Extra)\",\n    \"   Construct PLine profile for the strap (including side cuts and tabs)\",\n    \"   Mirror profile to create symmetric shape\",\n    \"   Extrude profile to 3D Body and draw\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Source of Insertion (Manual vs Utility)\",\n      \"path1\": {\n        \"name\": \"Manual Insertion (bOnInsert=1)\",\n        \"steps\": [\n          \"Filter plates into Bottom, VeryBottom, Top, VeryTop\",\n          \"Use ray intersection (filterBeamsHalfLineIntersectSort) to find primary plate intersecting the stud\",\n          \"Check for VeryBottom/VeryTop plates to identify 'Extra Plate' (e.g., double top plate)\",\n          \"Calculate coordinate system vectors (vx, vy, vz) based on beam vectors and picked point\",\n          \"Set dependencies on Stud and Plate beams\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Utility/Auto Insertion (bOnInsert=0)\",\n        \"steps\": [\n          \"Retrieve origin (PtOrg) and vectors (vx, vy, vz) directly from Map properties\",\n          \"Retrieve 'HasExtraPlate' flag directly from Map\",\n          \"Set dependency only on the Stud beam\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Plate Configuration (Single vs Double/Extra)\",\n      \"path1\": {\n        \"name\": \"Extra Plate Detected (Double Top/Bottom)\",\n        \"steps\": [\n          \"Set bExistsExtraPlate = true\",\n          \"Calculate offset (dOff) using dVariableStudEndLength\",\n          \"Apply offset to the start of the plate drawing logic\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Single Plate Only\",\n        \"steps\": [\n          \"Set bExistsExtraPlate = false\",\n          \"Offset (dOff) remains 0\",\n          \"Draw geometry starting from standard plate edge\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Catalog Data Integrity\",\n      \"path1\": {\n        \"name\": \"Valid Map Data\",\n        \"steps\": [\n          \"Check if Map contains LENGTH, MAJOR WIDTH, MINOR WIDTH > 0\",\n          \"Update OPM properties (dLength, dMajorWidth, dMinorWidth) from Map values\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Missing or Invalid Map Data\",\n        \"steps\": [\n          \"Set Display Pen color to Red (1) as warning\",\n          \"Assign hardcoded default values (L=115mm, MajW=29mm, MinW=35mm)\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\":"
      },
      "tokens_used": 10976,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_STUD_PLATE_TIE_SPTR.mcr\n\n## Overview\nGenerates a 3D model of a Stud Plate Tie (SPTR) metal connector, securing vertical studs to horizontal top or bottom plates in timber framing.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Use in the 3D model to generate hardware bodies. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities:** GenBeam (Studs and Plates).\n- **Minimum Beam Count:** 2 (1 Stud and 1 Plate).\n- **Required Settings Files:**\n  - `TSL_Read_Metalpart_Family_Props.dll` (Located in `..\\Utilities\\TslCustomSettings`)\n  - TXT file containing SPTR families details.\n  - `TSL_HARDWARE_FAMILY_LIST.dxx` catalog file.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_HDWR_STUD_PLATE_TIE_SPTR.mcr`\n\n### Step 2: Select Structural Elements\n```\nCommand Line: Select stud(s) and plate(s)\nAction: Click to select the vertical stud(s) and the horizontal bottom or top plate beam(s) they connect to. Press Enter to confirm selection.\n```\n\n### Step 3: Define Orientation\n```\nCommand Line: Pick a point to define on what face of studs place hardware\nAction: Click in the 3D model on the side of the wall where the metal strap should be applied (e.g., left face, right face, interior, or exterior).\n```\n\n### Step 4: Configure Type (Optional)\nAfter insertion, the script attempts to load dimensions from the catalog. If the Type is empty, use the **Properties** palette to select a code or use the Right-Click menu.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | Text | \"\" | The specific manufacturer model or catalog code (e.g., 'SPTR38'). Determines initial dimensions. |\n| Lenght | Number | 0 | The total length of the metal tie strap. |\n| Major Width | Number | 0 | The width of the main plate section sitting flush against the stud face. |\n| Minor Width | Number | 0 | The width of the narrower strap sections wrapping around the sides. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change type | Opens a dialog to select a new hardware family type from the catalog, automatically updating dimensions. |\n| Help | Displays a report notice with script usage information. |\n\n## Settings Files\n- **Filename**: `TSL_HARDWARE_FAMILY_LIST.dxx`\n- **Location**: `_kPathHsbCompany\\TSL\\Catalog\\`\n- **Purpose**: Catalog file listing available hardware families.\n\n- **Filename**: `TSL_Read_Metalpart_Family_Props.dll`\n- **Location**: `_kPathHsbInstall\\Utilities\\TslCustomSettings\\`\n- **Purpose**: Handles reading family properties from TXT source files and displaying selection dialogs.\n\n## Tips\n- **Batch Processing:** You can select multiple studs and plates in a single operation during Step 2. The script will automatically detect intersections and create an instance for each relevant connection.\n- **Double Plates:** The script automatically detects double top plates or rim joists (\"Extra Plates\") and adjusts the tie offset accordingly.\n- **Visual Warnings:** If the generated hardware body appears **Red**, it indicates the catalog data could not be read. Check that your TXT source files are correctly configured in the Company Catalog path.\n\n## FAQ\n- **Q: Why does my connector show up as a red block?**\n  **A:** This means the script could not find valid dimensions (Length, Major Width, Minor Width) in the loaded catalog map. Ensure the selected \"Type\" exists in your hardware TXT files and the DLL is accessible.\n- **Q: Can I use this for both top and bottom plates?**\n  **A:** Yes. Select both top and bottom plates along with the studs during the selection prompt. The script will identify valid intersections for both locations."
      },
      "tokens_used": 5869,
      "error": null
    }
  }
}