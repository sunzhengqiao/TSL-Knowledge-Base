{
  "filename": "HSB_G-PropertyMapping.mcr",
  "status": "completed",
  "total_tokens": 55170,
  "processing_time": 599.8713533878326,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": 2,\n    \"minorVersion\": 6,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"Tsl to map properties\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.00\",\n      \"date\": \"17.07.2014\",\n      \"author\": \"AS\",\n      \"changes\": \"Pilot version\"\n    },\n    {\n      \"version\": \"1.01\",\n      \"date\": \"08.07.2014\",\n      \"author\": \"AS\",\n      \"changes\": \"Set sequence number to 2000.\"\n    },\n    {\n      \"version\": \"1.02\",\n      \"date\": \"21.11.2014\",\n      \"author\": \"AS\",\n      \"changes\": \"Trim white spaces.\"\n    },\n    {\n      \"version\": \"2.00\",\n      \"date\": \"20.04.2017\",\n      \"author\": \"AS\",\n      \"changes\": \"Extend number of properties to map to.\"\n    },\n    {\n      \"version\": \"2.01\",\n      \"date\": \"19.05.2017\",\n      \"author\": \"YB\",\n      \"changes\": \"Added extrusion profile to the filter options.\"\n    },\n    {\n      \"version\": \"2.02\",\n      \"date\": \"19.05.2017\",\n      \"author\": \"YB\",\n      \"changes\": \"Made the extrusion profile property easier to understand.\"\n    },\n    {\n      \"version\": \"2.03\",\n      \"date\": \"13.06.2018\",\n      \"author\": \"FA\",\n      \"changes\": \"Added filter and adding of isotropic, also added another input for the type, you can now enter number or type by name.\"\n    },\n    {\n      \"version\": \"2.04\",\n     "
      },
      "tokens_used": 9214,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses Element.enumElements(\"GenBeam\") to iterate structural elements and modifies core data properties like setName, setType, setMaterial, and setHsbId. It lacks 'sd_' prefixes, '_Viewport' checks, or ShopDrawing specific entities (#Type E). The script uses '_bOnElementConstructed' and 'eraseInstance', characteristic of global or element-level processing scripts in the 3D model."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "ModelSpace",
          "requiredSettings": []
        }
      },
      "tokens_used": 7347,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"nSequenceNumber\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Sequence Number|\",\n      \"defaultValue\": 2000,\n      \"inputType\": \"number\",\n      \"category\": \"|Sequence Number|\",\n      \"description\": \"|Defines the Sequence Number of the TSL. The sequence number is used to sort the list of Tsl's during execution of eg OnElementConstructed. It can be set to positive or negative value.|\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"sCondition01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Condition| 1\",\n      \"defaultValue\": \" --- \",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \" --- \",\n        \"|Name|\",\n        \"|Material|\",\n        \"|Grade|\",\n        \"|Information|\",\n        \"|Label|\",\n        \"|Sublabel|\",\n        \"|Sublabel| 2\",\n        \"|Beamcode|\",\n        \"|Type|\",\n        \"|HsbId|\",\n        \"|Isotropic|\",\n        \"|Zone|\",\n        \"|Extrusion profile| \"\n      ],\n      \"category\": \"|Condition|\",\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sValueCondition01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Value condition| 1\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"|Condition|\",\n      \"description\": \"|Extrusion profile:|0 = |No extrusion profile|1 = |Extrusion profile||You can use the name of the beamtype or you can use the index for the beamtype list. This list can be retrieved by using the following TSL 'HSB_I-ListBeamTypes'.||Isotropic:||You can use the Isotropic name or use the following numbers.|\t|0 = 'Isotropic'||\t|1 = 'NonIsotropic'||\t|2 = 'MultiPlexIsotropic'| \"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sCondition02\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Condition| 2\",\n      \"defaultValue\": \" --- \",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \" --- \",\n        \"|Name|\",\n        \"|Material|\",\n        \"|Grade|\",\n        \"|Information|\",\n        \"|Label|\",\n        \"|Sublabel|\",\n        \"|Sublabel| 2\",\n        \"|Beamcode|\",\n        \"|Type|\",\n        \"|HsbId|\",\n        \"|Isotropic|\",\n        \"|Zone|\",\n        \"|Extrusion profile| \"\n      ],\n      \"category\": \"|Condition|\",\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sValueCondition02\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Value condition| 2\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"|Condition|\",\n      \"description\": \"|Extrusion profile:|0 = |No extrusion profile|1 = |Extrusion profile||You can use the name of the beamtype or you can use the index for the beamtype list. This list can be retrieved by using the following TSL 'HS"
      },
      "tokens_used": 10418,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically searches for structural elements (beams) that match specific criteria (conditions) and updates their properties (attributes) to new values. It acts as a 'Find and Replace' tool for BIM data.",
          "category": "Data Management / Model Automation",
          "typicalUseCase": "A user needs to update the 'Material' of all beams currently labeled 'Roof' to 'C24', or assign a specific 'Zone' code to all beams of a certain 'Type'. It ensures data consistency across the 3D model without manual editing."
        },
        "parameters": [
          {
            "name": "nSequenceNumber",
            "technicalDefault": 2000,
            "businessMeaning": "Controls the execution order of this script relative to others when the model is regenerated or elements are constructed.",
            "validRange": "Any integer (positive or negative)",
            "unit": "Integer",
            "affectsOutput": "Ensures this script runs after other scripts might have created or modified the geometry, or before others that rely on these properties."
          },
          {
            "name": "sCondition01..06",
            "technicalDefault": " --- ",
            "businessMeaning": "Defines the filter criteria (IF statements). Up to 6 properties can be checked to see if a beam qualifies for an update.",
            "validRange": "List of beam properties: Name, Material, Grade, Info, Label, Sublabel, Beamcode, Type, HsbId, Isotropic, Zone, Extrusion profile.",
            "unit": "Selection List",
            "affectsOutput": "Filters which beams are processed. If a beam does not match ALL active conditions, it is ignored."
          },
          {
            "name": "sValueCondition01..06",
            "technicalDefault": "",
            "businessMeaning": "The required value for the condition. For 'Type' and 'Isotropic', this accepts either codes (0, 1) or names ('Solid', 'Glulam').",
            "validRange": "String or Integer matching the specific property's allowed values.",
            "unit": "String",
            "affectsOutput": "Precision filter. Only beams matching this exact value (and logic) will have their properties changed."
          },
          {
            "name": "sSetter01..10",
            "technicalDefault": " --- ",
            "businessMeaning": "Defines the target property to change (THEN statements). Up to 10 properties can be modified per matching beam.",
            "validRange": "List of beam properties: Name, Material, Grade, Info, Label, Sublabel, Beamcode, Type, HsbId, Isotropic, Zone, Color.",
            "unit": "Selection List",
            "affectsOutput": "Identifies which data field on the beam will be overwritten."
          },
          {
            "name": "sValueSetter01..10",
            "technicalDefault": "",
            "businessMeaning": "The new value to write into the target property. Supports specific logic for Zones (prefixing numbers) and Types (index mapping).",
            "validRange": "String or Integer depending on the target property.",
            "unit": "String",
            "affectsOutput": "The actual data update applied to the beam (e.g., changing the label, assigning a production zone)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sConditionXX is ' --- '",
            "effect": "That specific condition is ignored, allowing other conditions to filter alone.",
            "cascade": [
              "sValueConditionXX"
            ]
          },
          {
            "trigger": "sConditionXX/sSetterXX is 'Type'",
            "effect": "The value input accepts either the Beam Type Name (e.g., 'SolidTimber') or the numeric Index from the hsbCAD Beam Types list.",
            "cascade": [
              "sValueConditionXX",
              "sValueSetterXX"
            ]
          },
          {
            "trigger": "sConditionXX/sSetterXX is 'Isotropic'",
            "effect": "The value input accepts 'Isotropic', 'NonIsotropic', 'MultiPlexIsotropic' or numeric codes 0, 1, 2.",
            "cascade": [
              "sValueConditionXX",
              "sValueSetterXX"
            ]
          },
          {
            "trigger": "sSetterXX is 'Zone'",
            "effect": "sValueSetterXX interprets input with specific logic: a number > 5 is wrapped (5 - n), and leading non-numeric characters are used as the Zone Layer prefix.",
            "cascade": [
              "sValueSetterXX"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Data Property Update",
            "description": "Modifies the non-geometric attributes of GenBeams. No physical geometry (solids/cuts) is generated, but the data attached to the beams is updated.",
            "appliedTo": "GenBeams in the model that satisfy the defined Condition criteria."
          }
        ]
      },
      "tokens_used": 9121,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Initialization",
          "Load Beam Types and Isotropic lists into memory arrays",
          "Display Properties Palette (OPM) with default parameters (Sequence Number, Conditions, Setters)",
          "User configuration via OPM",
          "Determine execution context (Manual Insert vs. Automatic Event)",
          "IF Manual Insert OR _bOnElementConstructed event:",
          "   -> Erase the script instance immediately (No geometry created)",
          "   -> Terminate execution",
          "ELSE (Automatic context / Recalc):",
          "   -> Enumerate all 'GenBeam' elements in the ModelSpace",
          "   -> For each GenBeam:",
          "      -> Initialize validation flag to TRUE",
          "      -> Check Condition 1 to 6:",
          "         -> IF Condition is not ' --- ':",
          "            -> Get current value of the specified property from the beam",
          "            -> Compare with user-defined 'Value condition'",
          "            -> Special handling for 'Type' (Index vs Name) and 'Isotropic'",
          "            -> IF mismatch: Set validation flag to FALSE",
          "      -> IF validation flag is TRUE (Beam matches all conditions):",
          "         -> Execute Setter 1 to 11:",
          "            -> IF Setter is not ' --- ':",
          "               -> Apply 'Value property' to the beam",
          "               -> Special handling for 'Type', 'Isotropic' (Index vs Name)",
          "               -> Special handling for 'Zone' (Layer prefix logic and value wrapping)",
          "               -> Special handling for 'Color' (Integer conversion)",
          "   -> Repeat for next beam",
          "   -> Execution Complete (Instance remains invisible or erased)"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Trigger",
            "path1": {
              "name": "Manual Insert / Event Driven",
              "steps": [
                "User inserts script manually",
                "OR model event (_bOnElementConstructed) fires",
                "Script calls eraseInstance()",
                "Script exits",
                "No properties are modified"
              ]
            },
            "path2": {
              "name": "Automatic Recalculation / Save",
              "steps": [
                "Model is recalculated or saved",
                "Script proceeds to beam enumeration",
                "Checks conditions against all beams",
                "Updates properties on matching beams"
              ]
            }
          },
          {
            "condition": "Property Type Input (Type or Isotropic)",
            "path1": {
              "name": "Short Input (Numeric Index)",
              "steps": [
                "Input string length < 3 characters",
                "Convert string directly to integer (e.g., '5' -> 5)",
                "Use integer for comparison or assignment"
              ]
            },
            "path2": {
              "name": "Long Input (Name)",
              "steps": [
                "Input string length >= 3 characters",
                "Normalize input (Remove spaces/underscores, Uppercase)",
                "Search for string in pre-loaded Beam Type or Isotropic array",
                "Use found index for comparison or assignment"
              ]
            }
          },
          {
            "condition": "Zone Layer Prefix Logic (Zone Property)",
            "path1": {
              "name": "Numeric Start",
              "steps": [
                "First character of value is a number (0-9)",
                "Extract prefix character from the Beam's current Layer Name (specific token)",
                "Use extracted character as Zone Layer Prefix",
                "Parse remainder of input as Zone Number"
              ]
            },
            "path2": {
              "name": "Alpha Start",
              "steps": [
                "First character of value is NOT a number",
                "Use first character of input as Zone Layer Prefix",
                "Remove first character from string",
                "Parse remainder as Zone Number"
              ]
            }
          },
          {
            "condition": "Zone Number Validation",
            "path1": {
              "name": "Valid Range",
              "steps": [
                "Parsed Zone Number <= 5",
                "Assign Zone using calculated Prefix and Number"
              ]
            },
            "path2": {
              "name": "Out of Range",
              "steps": [
                "Parsed Zone Number > 5",
                "Calculate new Number: 5 - Input",
                "Assign Zone using calculated Prefix and calculated Number"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Condition Logic Matching",
            "errorMessage": "(No explicit error message generated, failure is silent)",
            "recovery": "If a beam is not updated, verify that 'Value condition' exactly matches the current property state (including case sensitivity for names/indices) or that the condition property index exists."
          },
          {
            "check": "Type/Isotropic Name Resolution",
            "errorMessage": "(Silent failure if not found)",
            "recovery": "If setting by Name, ensure the name matches the hsbCAD database (ignores spaces/underscores). If setting by Index, use the integer index from the Beam Types list."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Filter Criteria (Conditions)",
            "how": "OPM (AutoCAD Properties Palette)",
            "effect": "Changes which beams are selected for property updates in the next model recalculation."
          },
          {
            "action": "Modify Target Properties (Setters)",
            "how": "OPM (AutoCAD Properties Palette)",
            "effect": "Changes what data is written to the matching beams in the next model recalculation."
          },
          {
            "action": "Trigger Execution",
            "how": "Model Recalculation (e.g., Save, specific TSL command)",
            "effect": "The script runs the logical check against all beams and applies the updates."
          },
          {
            "action": "Delete Script",
            "how": "AutoCAD Erase command",
            "effect": "Stops the automatic property mapping from running in the future."
          }
        ]
      },
      "tokens_used": 10446,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-PropertyMapping.mcr\n\n## Overview\nThis script acts as an automated \"Find and Replace\" tool for BIM data. It scans all structural beams in the model, identifies those matching specific criteria (Conditions), and updates their properties (Setters) automatically during model recalculation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script runs in the 3D model context. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Does not process 2D drawing generation. |\n\n## Prerequisites\n- **Required entities**: `GenBeam` elements (Beams/Columns) must exist in the model to be processed.\n- **Minimum beam count**: 0 (The script will simply do nothing if no beams exist).\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT`\n**Action:** Browse the file list and select `HSB_G-PropertyMapping.mcr`.\n\n### Step 2: Configure Mapping Rules\n**Action:**\n1. Ensure the script instance is selected (it may appear as a cross or preview point in the model).\n2. Open the **Properties Palette** (press `Ctrl+1`).\n3. Scroll to the \"Condition\" section to define **Which beams to find**.\n4. Scroll to the \"Property Mapping\" section to define **What to change**.\n\n### Step 3: Apply Changes\n**Command:** `TSLRECALC` or Save the drawing.\n**Action:** The script will automatically scan the entire model, filter beams based on your Conditions, and apply the new values defined in the Setters.\n\n## Properties Panel Parameters\n\n### General Settings\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Sequence Number | Integer | 2000 | Determines when this script runs relative to other scripts during regeneration. Use lower numbers to run earlier. |\n\n### Condition Section (Filtering)\n*These parameters define the \"IF\" logic. All active conditions must be true for a beam to be updated.*\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Condition 1..6 | Dropdown | ` --- ` | Select the property to check (e.g., Name, Material, Type, Zone). Select ` --- ` to ignore. |\n| Value condition 1..6 | String | Empty | The value to match. (See Tips for specific input formats for Types/Isotropics). |\n\n### Property Mapping Section (Updates)\n*These parameters define the \"THEN\" logic. All active setters are applied to matching beams.*\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Setter 1..10 | Dropdown | ` --- ` | Select the property to modify (e.g., Material, Grade, Label, Color). Select ` --- ` to ignore. |\n| Value property 1..10 | String | Empty | The new value to write into the selected property. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Forces the script to re-run the mapping logic immediately. |\n| Erase | Removes the script instance, stopping all automatic mapping. |\n\n## Settings Files\n- **Filename**: N/A\n- **Location**: N/A\n- **Purpose**: This script relies on internal lists for Beam Types and Isotropics; no external XML file is required.\n\n## Tips\n- **Disable specific lines**: If you only need to check one condition but leave others for later, set the unused `Condition` dropdowns to ` --- `.\n- **Using Names vs. Indices**:\n    - For **Type** and **Isotropic**: You can type the name (e.g., \"Solid Timber\") or the numeric index found in the hsbCAD lists.\n    - Names are not case-sensitive and ignore spaces/underscores.\n- **Zone Logic**:\n    - If the value starts with a number (e.g., \"5\"), the script calculates the Zone Layer prefix automatically based on the current beam's layer.\n    - If the number is greater than 5, it wraps mathematically (e.g., Input 7 becomes Zone -2).\n    - To specify a letter prefix explicitly (e.g., \"A5\"), start the text with a letter.\n- **Execution Order**: If you have multiple property mapping scripts, use the **Sequence Number** to ensure they run in the correct order (e.g., set a Label first, then move that beam to a Zone based on the new Label).\n\n## FAQ\n- **Q: I inserted the script and set the properties, but nothing happened.**\n  - **A:** The script runs on model recalculation. Press `TSLRECALC` or save the drawing to trigger the update.\n- **Q: Why did some beams not update?**\n  - **A:** Check your Conditions. If a beam fails *any one* of the active Condition checks, it will be skipped. Ensure the \"Value condition\" exactly matches the current state of the beam.\n- **Q: How do I see the numeric index for a Beam Type?**\n  - **A:** Use the `HSB_I-ListBeamTypes` script to generate a list of all valid indices and names.\n- **Q: Can I use this script to change the visual Color of the beams?**\n  - **A:** Yes. Select \"Color\" in the `Setter` dropdown and enter the integer color index (e.g., 1 for Red, 5 for Blue) in the `Value property`."
      },
      "tokens_used": 8624,
      "error": null
    }
  }
}