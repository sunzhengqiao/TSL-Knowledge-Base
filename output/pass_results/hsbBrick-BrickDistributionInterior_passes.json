{
  "filename": "hsbBrick-BrickDistributionInterior.mcr",
  "status": "completed",
  "total_tokens": 46787,
  "processing_time": 261.810489654541,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 8879,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicitly creates 'hsbBrick-3dBricks' TSL instances using _kModelSpace. Script logic involves 3D geometry calculations (ElementWall, PlaneProfile, intersections). No sd_* prefixes or _kPaperSpace references found."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall",
            "hsbBrick-CourseDistribution (TSL Instance)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": [
            "A TSL instance named hsbBrick-CourseDistribution containing a subMapX with key 'hsbBrickData'"
          ]
        }
      },
      "tokens_used": 6820,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select element(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getTslInst",
              "promptOriginal": "|Select course distribution|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDialog",
            "trigger": "Insertion (if no execute key provided)",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dButtJointMin",
            "type": "PropDouble",
            "displayName": "|Minimum|",
            "defaultValue": "U(9)",
            "inputType": "number",
            "options": [],
            "category": "|Mortar Butt Joint|",
            "description": "|Defines the minmal butt joint|"
          },
          {
            "index": 1,
            "variable": "dButtJointMax",
            "type": "PropDouble",
            "displayName": "|Maximum|",
            "defaultValue": "U(15)",
            "inputType": "number",
            "options": [],
            "category": "|Mortar Butt Joint|",
            "description": "|Defines the maximal butt joint|"
          },
          {
            "index": 2,
            "variable": "dButtJointProp",
            "type": "PropDouble",
            "displayName": "|calculated|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Mortar Butt Joint|",
            "description": "|The calculated Butt Joint|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|AddPLine|",
            "handler": "|AddPLine|",
            "action": "Appends a Polyline to the script entities for debugging.",
            "alsoTriggeredBy": "TslDoubleClick"
          },
          {
            "menuItem": "|Generate 3d of special bricks|",
            "handler": "|Generate 3d of special bricks|",
            "action": "Generates 3D representations for special bricks defined in the distribution.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Generate 3d bricks|",
            "handler": "|Generate 3d bricks|",
            "action": "Generates 3D representations for all bricks in the distribution.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Delete 3d of special bricks|",
            "handler": "|Delete 3d of special bricks|",
            "action": "Deletes generated 3D special bricks.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Delete 3d bricks|",
            "handler": "|Delete 3d bricks|",
            "action": "Deletes all generated 3D bricks.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 6969,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Calculates the optimal layout of brickwork for interior walls, determining cut lengths, quantities, and vertical mortar joint widths to fit specific wall segments.",
          "category": "Finishing/Masonry",
          "typicalUseCase": "Generating detailed brick schedules and 3D visualization for interior partition walls, ensuring mortar joints remain within specified architectural tolerances at corners and T-intersections."
        },
        "parameters": [
          {
            "name": "dButtJointMin",
            "technicalDefault": "U(9)",
            "businessMeaning": "The minimum permissible width of the vertical mortar joint (head joint) between the ends of bricks. Ensures joints are not too tight for structural and aesthetic reasons.",
            "validRange": "5mm - 10mm",
            "unit": "mm",
            "affectsOutput": "Acts as a constraint for the distribution algorithm. If the wall length cannot be filled with a joint size equal to or larger than this value, the calculation may report an error or adjust cut brick sizes to maintain the minimum gap."
          },
          {
            "name": "dButtJointMax",
            "technicalDefault": "U(15)",
            "businessMeaning": "The maximum permissible width of the vertical mortar joint. Prevents unsightly or weak wide joints.",
            "validRange": "15mm - 25mm",
            "unit": "mm",
            "affectsOutput": "Acts as a constraint for the distribution algorithm. If the calculated joint to fit whole bricks exceeds this, the script adjusts the layout (typically by trimming the first/last brick) to reduce the joint size."
          },
          {
            "name": "dButtJointProp",
            "technicalDefault": "U(0)",
            "businessMeaning": "The actual mathematically derived width of the vertical mortar joint that allows the bricks to fit the current wall segment perfectly while respecting Min/Max constraints.",
            "validRange": "Read-only (Result)",
            "unit": "mm",
            "affectsOutput": "Defines the exact spacing used to generate 3D brick geometry and hardware lists."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change in Wall Geometry (Length/Intersections)",
            "effect": "The script recalculates the number of bricks required to fill the new length, altering the calculated joint size.",
            "cascade": [
              "dButtJointProp"
            ]
          },
          {
            "trigger": "Change in Parent Brick Data (from hsbBrick-CourseDistribution)",
            "effect": "If the standard brick length changes, the script recalculates the distribution modules to fit the wall, changing the joint size.",
            "cascade": [
              "dButtJointProp"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TslInst (hsbBrick-3dBricks)",
            "description": "3D representations of individual bricks generated based on the calculated distribution. These can be generated for all bricks or just 'special' (cut) bricks via context menu.",
            "appliedTo": "Selected ElementWall (Interior)"
          },
          {
            "type": "HardWrComp",
            "description": "Data entries representing each brick for production reports (BOMs), including calculated dimensions, position numbers, and type identifiers (e.g., 'Regular' or 'Special').",
            "appliedTo": "Selected ElementWall (Interior)"
          }
        ]
      },
      "tokens_used": 9056,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User initiates script insertion.",
          "System checks if an Execute Key (catalog name) is provided.",
          "If no key, ShowDialog() prompts for property settings (Min/Max Joint).",
          "User is prompted to select ElementWall(s).",
          "User is prompted to select the parent 'hsbBrick-CourseDistribution' TSL instance.",
          "System validates the parent TSL contains 'hsbBrickData' subMap.",
          "If valid, the script instance is created and erased (setup complete), triggering the calculation.",
          "Script reads brick dimensions and wall geometry.",
          "Script calculates wall intersections (T-junctions, X-junctions, corners) to define zones.",
          "Script iterates through rows and modules to calculate brick layout.",
          "Script determines the actual Butt Joint width (dButtJointProp) fitting within Min/Max limits.",
          "Script generates PlaneProfiles for bricks, cutting them against wall zones.",
          "Script creates HardWrComp entries for BOM/Reporting.",
          "Script scans for existing linked 'hsbBrick-3dBricks' instances.",
          "Script triggers recalculation of linked 3D bricks to update dependencies."
        ],
        "conditionalBranches": [
          {
            "condition": "Execute Key present during Insertion",
            "path1": {
              "name": "Execute Key Path",
              "steps": [
                "System searches catalog for matching key",
                "Loads properties from catalog entry",
                "Skips Dialog"
              ]
            },
            "path2": {
              "name": "Manual Insertion Path",
              "steps": [
                "Properties Dialog appears",
                "User configures Min/Max joints manually",
                "Proceeds to selection prompts"
              ]
            }
          },
          {
            "condition": "Parent TSL Data Validation",
            "path1": {
              "name": "Valid Parent",
              "steps": [
                "MapX 'hsbBrickData' found",
                "Script proceeds with calculation"
              ]
            },
            "path2": {
              "name": "Invalid Parent",
              "steps": [
                "MapX missing or empty",
                "Report Error: 'Invalid tsl instance has no brick data.'",
                "Erase Instance",
                "Terminate"
              ]
            }
          },
          {
            "condition": "Wall Intersection Logic",
            "path1": {
              "name": "Intersected Zone",
              "steps": [
                "Calculate start/end points based on intersection vector",
                "Generate cut-brick geometry (Special Bricks) for the intersection area",
                "Adjust brick dimensions to fit the intersected profile"
              ]
            },
            "path2": {
              "name": "Clear Zone",
              "steps": [
                "Calculate standard distribution along full wall length",
                "Generate full-width bricks where geometry permits"
              ]
            }
          },
          {
            "condition": "Row Parity (Staggering)",
            "path1": {
              "name": "Even Row",
              "steps": [
                "Apply standard bond offset",
                "Check for corner intersection (bIsIntersectedCorners[0])",
                "Adjust start position if corner intersected"
              ]
            },
            "path2": {
              "name": "Odd Row",
              "steps": [
                "Apply half-brick offset (staggered)",
                "Check for specific intersection patterns (e.g., iModule logic)",
                "Calculate complex cuts for T/X intersections in odd rows"
              ]
            }
          },
          {
            "condition": "Context Menu 3D Operations",
            "path1": {
              "name": "Generate All 3D Bricks",
              "steps": [
                "Trigger: 'Generate 3d bricks'",
                "Iterate all calculated bricks",
                "Create 'hsbBrick-3dBricks' TSL for each"
              ]
            },
            "path2": {
              "name": "Generate Special Bricks Only",
              "steps": [
                "Trigger: 'Generate 3d of special bricks'",
                "Iterate calculated bricks",
                "Identify non-standard/cut bricks",
                "Create 'hsbBrick-3dBricks' TSL for special items only"
              ]
            },
            "path3": {
              "name": "Delete 3D Bricks",
              "steps": [
                "Trigger: 'Delete 3d bricks' or 'Delete 3d of special bricks'",
                "Search Model Space for linked 'hsbBrick-3dBricks'",
                "Erase found instances"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Parent TSL Map Content",
            "errorMessage": "\nInvalid tsl instance has no brick data.",
            "recovery": "Ensure a valid hsbBrick-CourseDistribution instance is selected which contains calculated brick data."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Joint Parameters",
            "how": "OPM Properties Palette",
            "effect": "Changing 'Minimum' or 'Maximum' properties triggers a recalculation of the joint width (dButtJointProp) and brick distribution layout."
          },
          {
            "action": "Update Geometry",
            "how": "Grip Edit / Modify Wall",
            "effect": "Modifying the host ElementWall (length or intersections) triggers an automatic recalculation of the brick layout to fit the new geometry."
          },
          {
            "action": "Visualize Bricks (3D)",
            "how": "Right-click Context Menu -> 'Generate 3d bricks' or 'Generate 3d of special bricks'",
            "effect": "Creates 3D TSL instances (hsbBrick-3dBricks) in the model representing the calculated layout. These instances maintain a dependency link for updates."
          },
          {
            "action": "Remove Visualization",
            "how": "Right-click Context Menu -> 'Delete 3d bricks'",
            "effect": "Removes the generated 3D brick instances from the model while preserving the calculation logic and hardware list."
          },
          {
            "action": "Debug Geometry",
            "how": "Right-click Context Menu -> 'AddPLine' or Double Click",
            "effect": "Appends a visual Polyline representation of the calculated distribution profiles to the script for debugging purposes."
          }
        ]
      },
      "tokens_used": 9226,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbBrick-BrickDistributionInterior.mcr\n\n## Overview\nCalculates the optimal brick layout for interior walls, determining cut lengths, quantities, and vertical mortar joint widths to fit specific wall segments. It ensures that mortar joints remain within specified architectural tolerances at corners and intersections.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D wall geometry. |\n| Paper Space | No | Not applicable for drawings. |\n| Shop Drawing | No | Not applicable for shop drawings. |\n\n## Prerequisites\n- **Required Entities:**\n  - An `ElementWall` representing the interior wall.\n  - An existing TSL instance named `hsbBrick-CourseDistribution` that contains brick data (specifically a subMap named `hsbBrickData`).\n- **Minimum Beam Count:** 0 (This script relies on Wall elements, not beams).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbBrick-BrickDistributionInterior.mcr`\n\n### Step 2: Configure Properties (If Required)\nIf inserting manually (without a predefined catalog entry), a dialog may appear.\n```\nAction: Set the desired Minimum and Maximum mortar joint widths.\nClick OK to confirm.\n```\n\n### Step 3: Select Wall\n```\nCommand Line: |Select element(s)|\nAction: Click on the interior wall(s) where you want to calculate brick distribution.\n```\n\n### Step 4: Select Course Distribution\n```\nCommand Line: |Select course distribution|\nAction: Click on the existing 'hsbBrick-CourseDistribution' TSL instance that defines the brick course data.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Minimum** | Number | 9 mm | The minimum permissible width of the vertical mortar joint (head joint) between bricks. |\n| **Maximum** | Number | 15 mm | The maximum permissible width of the vertical mortar joint. |\n| **calculated** | Number | 0 mm | (Read-Only) The actual mathematically derived joint width that fits the current wall segment within the min/max limits. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **AddPLine** | Appends a Polyline to the script entities to visualize the calculated distribution profiles (useful for debugging). |\n| **Generate 3d bricks** | Creates 3D representations for all bricks in the distribution in the model. |\n| **Generate 3d of special bricks** | Creates 3D representations only for special (cut) bricks. |\n| **Delete 3d bricks** | Removes all generated 3D brick instances from the model. |\n| **Delete 3d of special bricks** | Removes only the 3D special brick instances from the model. |\n\n## Settings Files\n- **Filename:** None\n- **Location:** N/A\n- **Purpose:** This script relies on dynamic data from the selected `hsbBrick-CourseDistribution` instance rather than external settings files.\n\n## Tips\n- **Visualizing Results:** After calculation, right-click the script instance and select **\"Generate 3d bricks\"** to see a visual representation of the wall in the 3D model.\n- **Optimization:** If the calculated joint size (`calculated`) hits the minimum or maximum limit, consider adjusting your wall dimensions or the Min/Max properties to get a more standard joint size.\n- **Updates:** If you modify the wall geometry (e.g., lengthen the wall) or change the parent Course Distribution, the script will automatically recalculate.\n\n## FAQ\n- **Q: I get an error \"Invalid tsl instance has no brick data.\"**\n  - **A:** Ensure you selected a valid `hsbBrick-CourseDistribution` instance in Step 4. That instance must contain the necessary brick data (hsbBrickData) for this script to function.\n- **Q: Why are my calculated joints 0?**\n  - **A:** This usually means the wall is too short or the brick dimensions from the parent script do not fit the geometry within the allowed Min/Max joint tolerances. Check your constraints.\n- **Q: How do I remove the 3D bricks without deleting my calculation?**\n  - **A:** Use the right-click menu option **\"Delete 3d bricks\"**. This removes the visual geometry but keeps the script instance and the hardware list (BOM) data intact."
      },
      "tokens_used": 5837,
      "error": null
    }
  }
}