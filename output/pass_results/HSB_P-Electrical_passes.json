{
  "filename": "HSB_P-Electrical.mcr",
  "status": "completed",
  "total_tokens": 50490,
  "processing_time": 520.7432923316956,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "16.06.2014",
            "author": "AS",
            "changes": "Pilot version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7333,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script performs geometric modifications using 'Drill' and 'BeamCut' objects applied to 'GenBeam' entities extracted from an Element via 'el.genBeam()'. It uses '_ThisInst.assignToElementGroup()', typical for attaching TSLs to 3D elements. It lacks 'sd_' prefixes, '_Viewport' usage, and drawing generation logic characteristic of Paper Space or ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space containing a wall element",
          "requiredSettings": []
        }
      },
      "tokens_used": 5889,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_kExecuteKey == \"\" || arSCatalogNames.find(_kExecuteKey) == -1",
              "required": false
            },
            {
              "step": 2,
              "function": "getElement",
              "promptOriginal": "|Select a wall|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "SelectFromList",
            "trigger": "Right-click context menu item 'Set installation types'",
            "title": null,
            "dataSource": "Map 'Installations' within _Map",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeparator01",
            "type": "PropString",
            "displayName": "|General settings|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dHeightFinishedFloor",
            "type": "PropDouble",
            "displayName": "     |Height finished floor|",
            "defaultValue": "190",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Sets the height of the finished floor.| |The height for the installation is measured from the finished floor.|"
          },
          {
            "index": 1,
            "variable": "dHeightSoleplate",
            "type": "PropDouble",
            "displayName": "     |Height soleplate|",
            "defaultValue": "38",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Sets the height of the soleplate.| |The height of the soleplate.|"
          },
          {
            "index": 1,
            "variable": "sSeparator02",
            "type": "PropString",
            "displayName": "|Installation|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nQuantity",
            "type": "PropInt",
            "displayName": "     |Quantity|",
            "defaultValue": "1",
            "inputType": "dropdown",
            "options": [
              "1",
              "2",
              "3",
              "4"
            ],
            "category": null,
            "description": "|Sets the amount of boxes.|"
          },
          {
            "index": 6,
            "variable": "sHeight",
            "type": "PropString",
            "displayName": "     |Height from finished floor|",
            "defaultValue": "1100",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "|Sets the height.| |The height is measured from the finished floor.|"
          },
          {
            "index": 3,
            "variable": "dDiameter",
            "type": "PropDouble",
            "displayName": "     |Diameter|",
            "defaultValue": "69",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Sets the diameter.|"
          },
          {
            "index": 4,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "     |Depth|",
            "defaultValue": "50",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Sets the depth.|"
          },
          {
            "index": 5,
            "variable": "dBetweenInstallations",
            "type": "PropDouble",
            "displayName": "     |Offset between installations|",
            "defaultValue": "71",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Sets the offset between the installations.|"
          },
          {
            "index": 7,
            "variable": "sInstallationTypes",
            "type": "PropString",
            "displayName": "     |Installation types|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "|The installation types can be set through a custom action.||This action is available in the right mouse click menu.|"
          },
          {
            "index": 2,
            "variable": "sSeparator03",
            "type": "PropString",
            "displayName": "|Extra mill|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "dWidthExtraMill",
            "type": "PropDouble",
            "displayName": "     |Width extra mill|",
            "defaultValue": "40",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Sets the width.|"
          },
          {
            "index": 8,
            "variable": "dHeightExtraMill",
            "type": "PropDouble",
            "displayName": "     |Height extra mill|",
            "defaultValue": "40",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Sets the height.|"
          },
          {
            "index": 6,
            "variable": "dDepthExtraMill",
            "type": "PropDouble",
            "displayName": "     |Depth extra mill|",
            "defaultValue": "50",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Sets the depth.|"
          },
          {
            "index": 3,
            "variable": "sSeparator04",
            "type": "PropString",
            "displayName": "|Wire chase|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sSideWireChase",
            "type": "PropString",
            "displayName": "     |Side wire chase|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "|Left|",
              "|Right|",
              "|Aligned|"
            ],
            "category": null,
            "description": "|Sets the side of the wire chase.||The side is taken while looking towards the installation.|"
          },
          {
            "index": 5,
            "variable": "sDirectionWireChase",
            "type": "PropString",
            "displayName": "     |Direction wire chase|",
            "defaultValue": "|Up|",
            "inputType": "dropdown",
            "options": [
              "|Up|",
              "|Down|",
              "|Up and down|"
            ],
            "category": null,
            "description": "|Sets the direction of the wire chase.|"
          },
          {
            "index": 10,
            "variable": "dWidthWireChase",
            "type": "PropDouble",
            "displayName": "     |Width wire chase|",
            "defaultValue": "30",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Sets the width.|"
          },
          {
            "index": 9,
            "variable": "dDepthWireChase",
            "type": "PropDouble",
            "displayName": "     |Depth wire chase|",
            "defaultValue": "30",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "|Sets the depth.|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Set installation types|",
            "handler": "|Set installation types|",
            "action": "Opens a dialog (SelectFromList) to configure installation types for each generated point.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8341,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of electrical socket boxes and vertical wire chases (slots) in timber wall elements.",
          "category": "Machining/Utilities",
          "typicalUseCase": "Used during the detailing phase to prepare wall panels for electrical rough-ins, ensuring holes for boxes and chases for wires are milled to correct depths and heights relative to the finished floor level."
        },
        "parameters": [
          {
            "name": "dHeightFinishedFloor",
            "technicalDefault": "190",
            "businessMeaning": "The vertical distance from the bottom of the wall element (soleplate bottom) to the finished floor level. Used as the Z=0 reference for all height measurements.",
            "validRange": "0 - 500 mm (depending on floor construction)",
            "unit": "mm",
            "affectsOutput": "Offsets the vertical placement of all electrical boxes and wire chases upwards or downwards to match the actual floor height."
          },
          {
            "name": "dHeightSoleplate",
            "technicalDefault": "38",
            "businessMeaning": "The height of the bottom wall plate (soleplate). Used to calculate the net height of the timber structure.",
            "validRange": "30 - 100 mm",
            "unit": "mm",
            "affectsOutput": "Refines the reference point calculation to ensure boxes are placed relative to the floor surface, not the raw timber bottom."
          },
          {
            "name": "nQuantity",
            "technicalDefault": "1",
            "businessMeaning": "The number of electrical boxes to create horizontally at each specified height level.",
            "validRange": "1 - 4",
            "unit": "count",
            "affectsOutput": "Creates multiple drill holes and extra mills spaced horizontally based on the 'Offset between installations' parameter."
          },
          {
            "name": "sHeight",
            "technicalDefault": "1100",
            "businessMeaning": "A semicolon-separated list of vertical installation heights for the socket boxes (e.g., '300;1100;1500').",
            "validRange": "100 - 3000 mm (must be within wall height)",
            "unit": "mm",
            "affectsOutput": "Determines the Y-axis (vertical) positions of all socket groups. Allows multiple rows of sockets at different elevations in a single operation."
          },
          {
            "name": "dDiameter",
            "technicalDefault": "69",
            "businessMeaning": "The diameter of the cylindrical hole drilled for the electrical conduit or back box.",
            "validRange": "60 - 80 mm (standard sizes)",
            "unit": "mm",
            "affectsOutput": "Defines the size of the circular Drill operation."
          },
          {
            "name": "dDepth",
            "technicalDefault": "50",
            "businessMeaning": "The depth of the hole drilled into the wall.",
            "validRange": "20 - Wall Thickness mm",
            "unit": "mm",
            "affectsOutput": "Determines how deep the Drill operation penetrates the wall."
          },
          {
            "name": "dBetweenInstallations",
            "technicalDefault": "71",
            "businessMeaning": "The center-to-center horizontal distance between multiple socket boxes.",
            "validRange": "50 - 200 mm",
            "unit": "mm",
            "affectsOutput": "Spaces the holes horizontally when 'Quantity' is greater than 1."
          },
          {
            "name": "sInstallationTypes",
            "technicalDefault": "",
            "businessMeaning": "Metadata tag for the type of electrical installation (e.g., 'Switch', 'Socket'). Managed via a right-click menu.",
            "validRange": "Text string",
            "unit": "text",
            "affectsOutput": "Non-geometric. Stores data in the element Map for reporting or labeling purposes."
          },
          {
            "name": "dWidthExtraMill",
            "technicalDefault": "40",
            "businessMeaning": "The horizontal width of the rectangular recess cut surrounding the socket hole (for box flanges or plasterboard depth).",
            "validRange": "20 - 100 mm",
            "unit": "mm",
            "affectsOutput": "Defines the X-axis size of the rectangular BeamCut (recess) around the main drill hole."
          },
          {
            "name": "dHeightExtraMill",
            "technicalDefault": "40",
            "businessMeaning": "The vertical height of the rectangular recess cut surrounding the socket hole.",
            "validRange": "20 - 100 mm",
            "unit": "mm",
            "affectsOutput": "Defines the Y-axis size of the rectangular BeamCut (recess) around the main drill hole."
          },
          {
            "name": "dDepthExtraMill",
            "technicalDefault": "50",
            "businessMeaning": "The depth of the rectangular recess (shallower or equal to the main drill, often for drywall clearance).",
            "validRange": "10 - 50 mm",
            "unit": "mm",
            "affectsOutput": "Defines how deep the rectangular BeamCut operation penetrates the wall."
          },
          {
            "name": "sSideWireChase",
            "technicalDefault": "",
            "businessMeaning": "The side of the insertion point where the vertical wire chase is routed (Left, Right, or Aligned with the holes).",
            "validRange": "Left / Right / Aligned",
            "unit": "enum",
            "affectsOutput": "Offsets the vertical groove horizontally relative to the socket holes."
          },
          {
            "name": "sDirectionWireChase",
            "technicalDefault": "Up",
            "businessMeaning": "The vertical direction the wire chase runs from the socket (Up, Down, or Up and Down to cover the full wall height).",
            "validRange": "Up / Down / Up and down",
            "unit": "enum",
            "affectsOutput": "Calculates the length and start/end point of the vertical wire chase groove."
          },
          {
            "name": "dWidthWireChase",
            "technicalDefault": "30",
            "businessMeaning": "The width of the vertical groove cut for wires.",
            "validRange": "20 - 60 mm",
            "unit": "mm",
            "affectsOutput": "Defines the X-axis width of the vertical BeamCut (wire chase)."
          },
          {
            "name": "dDepthWireChase",
            "technicalDefault": "30",
            "businessMeaning": "The depth of the vertical groove cut for wires.",
            "validRange": "15 - 40 mm",
            "unit": "mm",
            "affectsOutput": "Defines how deep the vertical wire chase penetrates the wall."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing 'dHeightFinishedFloor' or 'dHeightSoleplate'",
            "effect": "Recalculates the vertical origin (Y=0) for all installation heights.",
            "cascade": [
              "sHeight",
              "Wire Chase vertical position"
            ]
          },
          {
            "trigger": "Setting 'nQuantity' > 1",
            "effect": "Activates the horizontal offset logic to duplicate the drill and cut geometry.",
            "cascade": [
              "dBetweenInstallations",
              "Total width of milling"
            ]
          },
          {
            "trigger": "Changing 'sDirectionWireChase' to 'Up and down'",
            "effect": "Forces the wire chase to span the full height of the wall panel plus an overlap.",
            "cascade": [
              "Wire chase length",
              "Wire chase start point"
            ]
          },
          {
            "trigger": "Setting 'sSideWireChase' to 'Aligned'",
            "effect": "Centers the wire chase vertically relative to the socket holes, rather than offsetting strictly left or right.",
            "cascade": [
              "Wire chase horizontal position"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Drill",
            "description": "Cylindrical holes representing the electrical box penetrations.",
            "appliedTo": "Selected Wall Element (GenBeams)"
          },
          {
            "type": "BeamCut",
            "description": "Rectangular recesses around the holes (Extra Mill) and vertical slots (Wire Chases) for routing cables.",
            "appliedTo": "Selected Wall Element (GenBeams)"
          },
          {
            "type": "Display",
            "description": "Text numbers drawn at the installation points indicating the sequence/order.",
            "appliedTo": "Model Space (Visual only)"
          }
        ]
      },
      "tokens_used": 9626,
      "error": null
    },
    "5": {
      "success": true,
      "data": {},
      "tokens_used": 11999,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_P-Electrical.mcr\n\n## Overview\nThis script automates the creation of electrical socket box penetrations and vertical wire chases (slots) in timber wall elements. It calculates vertical positions relative to the finished floor level and generates cylindrical holes, rectangular recesses, and cable routing grooves.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be inserted in 3D model space to modify wall geometry. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: A Wall Element (`ElementWall`) must exist in the drawing.\n- **Minimum Beam Count**: 0 (The script extracts beams from the selected wall element automatically).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT`\n**Action:** Browse and select `HSB_P-Electrical.mcr`.\n\n### Step 2: Select Wall\n```\nCommand Line: Select a wall\nAction: Click on the desired Wall Element in the model.\n```\n\n### Step 3: Set Insertion Point\n```\nCommand Line: (Pick point prompt)\nAction: Click on the face of the wall to define the horizontal location and alignment for the electrical installation.\n```\n\n### Step 4: Configure Properties (Optional)\n**Action:** Select the inserted script instance and open the **Properties Palette** (Ctrl+1). Adjust dimensions, heights, and quantities as needed.\n\n## Properties Panel Parameters\n\n### General Settings\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Height finished floor | number | 190 mm | Vertical offset from the bottom of the wall element to the finished floor surface. Acts as the Z=0 reference for heights. |\n| Height soleplate | number | 38 mm | Height of the bottom wall plate (soleplate). Used to refine the structural reference point. |\n\n### Installation\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Quantity | dropdown | 1 | Number of socket boxes to create horizontally (1 to 4). |\n| Height from finished floor | text | 1100 | Vertical position(s) of the sockets. Separate multiple heights with a semicolon (e.g., `300;1100;1500`). |\n| Diameter | number | 69 mm | Diameter of the main drill hole for the electrical box. |\n| Depth | number | 50 mm | Depth of the main drill hole. |\n| Offset between installations | number | 71 mm | Center-to-center distance between sockets when Quantity is greater than 1. |\n| Installation types | text | | Metadata for the installation type. Set via the Right-Click menu. |\n\n### Extra Mill\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Width extra mill | number | 40 mm | Horizontal width of the rectangular recess around the hole. |\n| Height extra mill | number | 40 mm | Vertical height of the rectangular recess around the hole. |\n| Depth extra mill | number | 50 mm | Depth of the rectangular recess (often used for plasterboard clearance). |\n\n### Wire Chase\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Side wire chase | dropdown | Aligned | Side of the wire chase relative to the insertion point (Left, Right, or Aligned). |\n| Direction wire chase | dropdown | Up | Vertical direction of the wire chase (Up, Down, or Up and down). |\n| Width wire chase | number | 30 mm | Width of the vertical groove for wires. |\n| Depth wire chase | number | 30 mm | Depth of the vertical groove for wires. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Set installation types | Opens a selection dialog to choose specific installation type metadata for the generated points. |\n\n## Settings Files\n- **None**: This script does not rely on external settings files (XML/INI).\n\n## Tips\n- **Multiple Heights**: You can create multiple rows of sockets in a single operation by entering semicolon-separated values in the **Height from finished floor** property (e.g., `300; 1200`).\n- **Floor Offset**: If your sockets appear too low or too high, check the **Height finished floor** value. The script measures height up from the bottom of the wall element, so this offset is critical for accuracy relative to the actual floor finish.\n- **Wire Chase Alignment**: The **Side wire chase** option determines where the vertical groove is cut. \"Aligned\" centers it relative to the socket holes, while \"Left\" or \"Right\" offsets it based on your view direction during insertion.\n\n## FAQ\n- **Q: Why are my socket holes cutting through the bottom plate?**\n  **A:** Check your **Height finished floor** and **Height soleplate** settings. If the wall element includes the bottom plate in its geometry, ensure the \"Height finished floor\" accounts for the plate thickness and flooring material.\n\n- **Q: How can I create sockets for both a kitchen counter and a standard wall height at the same time?**\n  **A:** Use the **Height from finished floor** property. Enter both heights separated by a semicolon, for example: `1050; 1300` (assuming a standard backslash height and a higher outlet).\n\n- **Q: The wire chase isn't going all the way to the top or bottom of the wall.**\n  **A:** Change the **Direction wire chase** property to `Up and down`. This forces the groove to span the full height of the wall panel."
      },
      "tokens_used": 7302,
      "error": null
    }
  }
}