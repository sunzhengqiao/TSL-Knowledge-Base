{
  "filename": "HSB_G-EllipticalArc.mcr",
  "status": "completed",
  "total_tokens": 24338,
  "processing_time": 551.118451833725,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 1,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl creates a elliptical arc.",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "27.02.2017",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "03.03.2017",
            "author": "AS",
            "changes": "Add option to assign arc to element"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4743,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses standard getPoint() and getString() prompts which typically operate in Model Space. There are no 'sd_' prefixes, no viewport checks, and no 'Entity' collections with '#Type E'. The script constructs PLine objects and uses Display().draw() to visualize geometry in the 3D model environment. It explicitly interacts with _Element (global variable), which is a Model Space entity."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element (Optional)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D). Can optionally assign geometry to an existing Element group.",
          "requiredSettings": []
        }
      },
      "tokens_used": 2106,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getString",
              "promptOriginal": "|Place arc in in Element or <World>  UCS|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getElement",
              "promptOriginal": "|Select an element|<Enter> |to place the arc in world ucs|.",
              "condition": "_bOnInsert && (selectionMode.left(1) == \"E\")",
              "required": false
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "|Select a position|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "width",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": "U(1500)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "height",
            "type": "PropDouble",
            "displayName": "|Height|",
            "defaultValue": "U(400)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "showHelperLinesProp",
            "type": "PropString",
            "displayName": "|Show helper lines|",
            "defaultValue": "1 (|Yes|)",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3249,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"This script generates a 3D elliptical arc geometry to visually represent curved wall plates, roof edges, or other architectural features within the timber model.\",\n    \"category\": \"Layout/Geometry\",\n    \"typicalUseCase\": \"Used by designers to establish complex curved reference lines or to visualize the path of future curved beams (like glulam arches) in relation to an element or the world coordinate system.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"width\",\n      \"technicalDefault\": \"U(1500)\",\n      \"businessMeaning\": \"The horizontal projection length (major axis) of the elliptical arc.\",\n      \"validRange\": \"100 mm - 20000 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Determines the overall span of the arc geometry along the local X-axis.\"\n    },\n    {\n      \"name\": \"height\",\n      \"technicalDefault\": \"U(400)\",\n      \"businessMeaning\":The vertical rise (minor axis) of the elliptical arc relative to its chord.\",\n      \"validRange\": \"10 mm - 5000 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Controls the curvature/steepness of the arc along the local Y-axis.\"\n    },\n    {\n      \"name\": \"showHelperLinesProp\",\n      \"technicalDefault\": \"1 (|Yes|)\",\n      \"businessMeaning\": \"Toggles the visibility of the geometric construction lines used to solve the arc geometry.\",\n      \"validRange\": \"Yes/No\",\n      \"unit\": \"boolean\",\n      \"affectsOutput\": \"When 'Yes', displays auxiliary lines and circles (Red, Green, Blue) showing how the arc is calculated. When 'No', only the final arc (Black) is displayed.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"Change in width or height\",\n      \"effect\": \"The script recalculates the intersection points of the circles that define the tangent arcs.\",\n      \"cascade\": [\n        \"Pt0\",\n        \"arc\"\n      ]\n    }\n  ],\n  \"outputEntities\": [\n    {\n      \"type\": \"PLine (Geometry)\",\n      \"description\": \"A visual 3D elliptical arc curve.\",\n      \"appliedTo\": \"Model Space (World UCS) or a selected Element group.\"\n    }\n  ]\n}\n```"
      },
      "tokens_used": 3447,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script execution starts",
          "2. Check insertion cycle count (if > 1, erase instance and stop)",
          "3. Display Properties Dialog (showDialog)",
          "4. Command line prompt: 'Place arc in in Element or <World> UCS'",
          "5. [Branch] If input starts with 'E' -> Prompt to select Element -> Store in _Element",
          "6. [Branch] If input is not 'E' -> Skip element selection",
          "7. Command line prompt: 'Select a position' -> Store in _Pt0",
          "8. Return (Pause execution waiting for AutoCAD event)",
          "9. [Recalculation] Define Local Coordinate System (World or Element based)",
          "10. Calculate geometric points (A, B, C, D, etc.) based on Width, Height, and _Pt0",
          "11. Generate Arc PLine",
          "12. [Branch] If 'Show helper lines' is Yes -> Draw construction geometry",
          "13. Draw final Arc"
        ],
        "conditionalBranches": [
          {
            "condition": "User input for placement context (Element vs World)",
            "path1": {
              "name": "Element-based Placement",
              "steps": [
                "User types 'E' at command prompt",
                "User selects an Element from the model",
                "Script retrieves Element's coordinate system (vecX, vecY, vecZ)",
                "Script projects insertion point (_Pt0) onto the Element's plane",
                "Script assigns geometry to the Element group"
              ]
            },
            "path2": {
              "name": "World UCS Placement",
              "steps": [
                "User presses Enter or types non-'E' string",
                "Script uses World Coordinate System (XW, YW, ZW)",
                "Geometry is placed independent of specific Elements"
              ]
            }
          },
          {
            "condition": "Show Helper Lines Property",
            "path1": {
              "name": "Yes (Helpers Visible)",
              "steps": [
                "Draw construction circles (CircleC_AC, CircleD_DE, CircleH_HA, CircleK_KB)",
                "Draw construction lines (AB, CD, PH, PK, AD, BD)",
                "Draw Arc"
              ]
            },
            "path2": {
              "name": "No (Helpers Hidden)",
              "steps": [
                "Skip drawing construction geometry",
                "Draw Arc only"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Validity",
            "errorMessage": "None (Script fails silently)",
            "recovery": "If selected element is invalid or deleted, script halts calculation. User must re-insert or fix element reference."
          },
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None",
            "recovery": "If script is triggered multiple times during a single drag-drop operation, the instance is erased to prevent duplicates."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Dimensions",
            "how": "OPM Properties Palette (Width/Height)",
            "effect": "Arc is recalculated with new span and rise."
          },
          {
            "action": "Toggle Visualization",
            "how": "OPM Properties Palette (Show helper lines)",
            "effect": "Construction lines appear or disappear."
          },
          {
            "action": "Move",
            "how": "Grip Edit / Move Command",
            "effect": "_Pt0 updates, shifting the entire arc relative to the coordinate system."
          }
        ]
      },
      "tokens_used": 6108,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-EllipticalArc.mcr\n\n## Overview\nThis script generates a 3D elliptical arc geometry within the hsbCAD model. It is used to create visual references for curved wall plates, roof edges, or other architectural features, with options to define the horizontal span and vertical rise.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates in the 3D model environment. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | This is a model generation tool. |\n\n## Prerequisites\n- **Required Entities**: None (Optional: An existing Element if placing relative to one).\n- **Minimum beam count**: 0\n- **Required settings files**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_G-EllipticalArc.mcr` from the file dialog.\n\n### Step 2: Define Placement Context\n```\nCommand Line: |Place arc in in Element or <World> UCS|\nAction: \n- Type 'E' and press Enter to place the arc inside a specific Element (e.g., a wall or roof).\n- Press Enter directly to place the arc in the World Coordinate System (global origin).\n```\n\n### Step 3: Select Element (Conditional)\n*Only appears if you typed 'E' in the previous step.*\n```\nCommand Line: |Select an element|<Enter> |to place the arc in world ucs|.\nAction: Click on the desired Element in the model.\n```\n\n### Step 4: Position the Arc\n```\nCommand Line: |Select a position|\nAction: Click a point in the drawing area to define the start/anchor point of the arc.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Width** | Number | 1500 mm | The horizontal projection length (major axis) of the elliptical arc. |\n| **Height** | Number | 400 mm | The vertical rise (minor axis) of the arc relative to its chord. |\n| **Show helper lines** | Dropdown | Yes | Toggles the visibility of red, green, and blue construction lines/circles used to calculate the arc geometry. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add custom items to the right-click context menu. Use standard AutoCAD grips to move the arc. |\n\n## Settings Files\n- **Filename**: None required\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Visualizing Geometry**: If the arc does not appear as expected, set \"Show helper lines\" to **Yes** in the properties. This will display the construction circles and tangent points used to generate the curve, helping you understand how the Width and Height values interact.\n- **Quick Adjustments**: You can change the Width and Height immediately after insertion by selecting the arc and typing `PROPERTIES` (or double-clicking the object) to open the Properties Palette.\n- **Moving the Arc**: Use the standard AutoCAD **Move** command or drag the visible grips to relocate the arc to a new position.\n\n## FAQ\n- **Q: Can I change the arc to fit onto an angled wall?**\n  - A: Yes. During insertion (Step 2), type 'E' and select the Element. The script will align the geometry to that Element's local coordinate system.\n- **Q: What do the colorful lines represent?**\n  - A: These are construction helper lines. They show the geometric calculation of the ellipse. You can hide them by changing \"Show helper lines\" to **No** in the Properties panel."
      },
      "tokens_used": 4685,
      "error": null
    }
  }
}