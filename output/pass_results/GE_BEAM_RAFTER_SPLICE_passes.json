{
  "filename": "GE_BEAM_RAFTER_SPLICE.mcr",
  "status": "completed",
  "total_tokens": 27386,
  "processing_time": 224.09410905838013,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.3",
            "date": "15-may--2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Thumbnail added"
          },
          {
            "version": "1.2",
            "date": "11-Apr--2011",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Making sure displaced piece is the lower one of the 2 resultants from every rafter"
          },
          {
            "version": "1.1",
            "date": "06-Apr--2011",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Bug fix, copy was extended to infinite..."
          },
          {
            "version": "1.0",
            "date": "04-Apr--2011",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5086,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses Beam() entities and geometric modification functions like dbSplit and transformBy. No sd_* prefixes, _Viewport usage, or #Type E entries found. The script operates on 3D geometry and erases itself upon completion."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space with at least one existing beam to splice.",
          "requiredSettings": []
        }
      },
      "tokens_used": 2284,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\n|Select beam(s) to splice|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select splice midpoint|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "|Offset direction for new beams|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 4,
              "function": "getString",
              "promptOriginal": "|Set splice overlap <2'-0''>|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3076,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Splits a selected timber beam into two overlapping sections at a defined midpoint and offsets the lower section laterally to visualize a splice joint.",
          "category": "Framing/Detailing",
          "typicalUseCase": "Used when a long rafter or beam must be represented as two separate pieces joined on site, allowing the user to define the overlap length and displacement direction for detailing or checking clearances."
        },
        "parameters": [
          {
            "name": "ssE (Beam Selection)",
            "technicalDefault": "null",
            "businessMeaning": "The target beam(s) (typically rafters) that are too long for a single piece and need to be split.",
            "validRange": "Existing GenBeam entities in the model.",
            "unit": "Selection",
            "affectsOutput": "Determines which beam geometry is deleted and replaced by two spliced segments."
          },
          {
            "name": "_Pt0 (Splice Midpoint)",
            "technicalDefault": "User Point",
            "businessMeaning": "The location along the beam where the center of the splice connection will occur.",
            "validRange": "Must fall within the longitudinal length of the selected beam.",
            "unit": "mm / inches",
            "affectsOutput": "Sets the origin for the overlap region. The cut points are calculated as Midpoint +/- (Overlap/2)."
          },
          {
            "name": "ptDir (Offset Direction)",
            "technicalDefault": "User Point",
            "businessMeaning": "The side direction towards which the lower half of the spliced beam will be shifted.",
            "validRange": "Non-collinear to beam axis. The script snaps this to the beam's local Y-axis.",
            "unit": "Vector / Direction",
            "affectsOutput": "Controls the lateral translation of the displaced beam segment (moving it by its own width)."
          },
          {
            "name": "sL / dL (Splice Overlap)",
            "technicalDefault": "610mm (24 inches)",
            "businessMeaning": "The length over which the two beam segments will overlap each other.",
            "validRange": "> 0mm and significantly less than total beam length (typically 300mm to 1500mm depending on engineering requirements).",
            "unit": "mm / inches",
            "affectsOutput": "Calculates the distance between the start and end cut points centered on the Splice Midpoint."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Splice Midpoint changes",
            "effect": "The valid range for Splice Overlap shifts. If Overlap extends past beam ends relative to the new Midpoint, the operation fails.",
            "cascade": [
              "sL (Splice Overlap)"
            ]
          },
          {
            "trigger": "Offset Direction changes",
            "effect": "Determines which specific beam segment (left or right of split) gets displaced based on its Z-height.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam",
            "description": "Two separate beam entities replacing the original single beam, with the lower beam shifted laterally by its own width.",
            "appliedTo": "The originally selected beam entity."
          }
        ]
      },
      "tokens_used": 5879,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Start Script Execution",
          "2. Check Insert Cycle Count (Protection against copy/drag re-execution)",
          "3. Prompt user to select beam(s) to splice (PrEntity)",
          "4. Prompt user to select splice midpoint (getPoint)",
          "5. Prompt user to select offset direction (getPoint)",
          "6. Prompt user to enter splice overlap length (getString)",
          "7. Parse input length; set default to 610mm (2'-0'') if invalid/empty",
          "8. Validate Selection: Check if any beams were selected",
          "9. Validate Length: Check if overlap length is positive",
          "10. Loop through all selected beams",
          "11. Calculate geometric centerline and vectors (X, Y, Z) for current beam",
          "12. Project the user-selected midpoint onto the beam's axis",
          "13. Calculate Start and End cut points based on overlap length",
          "14. Validate Geometry: Check if cut points fall within the physical length of the beam",
          "15. Split beam into two segments at calculated points",
          "16. Determine local Y-side direction relative to user input (Snap to side)",
          "17. Compare Z-heights of the two resulting segments to identify the lower one",
          "18. Transform (Move) the lower segment laterally by its own width",
          "19. End Loop (Repeat for next beam if multiple selected)",
          "20. Erase script instance from model",
          "21. End"
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count check",
            "path1": {
              "name": "Re-entry detected",
              "steps": [
                "Erase script instance",
                "Return immediately"
              ]
            },
            "path2": {
              "name": "First execution",
              "steps": [
                "Proceed to beam selection"
              ]
            }
          },
          {
            "condition": "Splice Overlap Input",
            "path1": {
              "name": "Valid numeric input",
              "steps": [
                "Use parsed value"
              ]
            },
            "path2": {
              "name": "Empty, zero, or non-numeric input",
              "steps": [
                "Assign default value: 610mm (24 inches)"
              ]
            }
          },
          {
            "condition": "Splice Fit Validation",
            "path1": {
              "name": "Cuts fit within beam length",
              "steps": [
                "Proceed to split beam"
              ]
            },
            "path2": {
              "name": "Cuts exceed beam boundaries",
              "steps": [
                "Report error message: 'ERROR: There is no room for splice on selected point'",
                "Continue to next beam in loop"
              ]
            }
          },
          {
            "condition": "Displacement Target (Z-Height Comparison)",
            "path1": {
              "name": "Original segment is lower",
              "steps": [
                "Move Original segment"
              ]
            },
            "path2": {
              "name": "New segment is lower",
              "steps": [
                "Move New segment"
              ]
            }
          },
          {
            "condition": "Offset Direction Vector",
            "path1": {
              "name": "Input vector aligns with beam local Y",
              "steps": [
                "Keep vector direction"
              ]
            },
            "path2": {
              "name": "Input vector opposes beam local Y",
              "steps": [
                "Invert vector direction (-vBmY)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection Count",
            "errorMessage": "None (Silent exit)",
            "recovery": "User must re-run script and ensure at least one beam is selected."
          },
          {
            "check": "Overlap Length (dL)",
            "errorMessage": "Length must be positive value",
            "recovery": "User must re-run script and enter a value greater than 0."
          },
          {
            "check": "Geometric Splice Feasibility",
            "errorMessage": "ERROR: There is no room for splice on selected point",
            "recovery": "User must select a point further from the beam ends or reduce the overlap length."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None (Script is self-destructing)",
            "how": "N/A",
            "effect": "The script instance calls eraseInstance() at the end of execution. The resulting beams are native GenBeam entities without TSL parameters."
          }
        ]
      },
      "tokens_used": 6079,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_BEAM_RAFTER_SPLICE\n\n## Overview\nThis script splits a selected timber beam (typically a rafter) into two overlapping sections to visualize a splice joint. It automatically offsets the lower section laterally by its own width, allowing you to detail or check clearances for site connections.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the 3D model. |\n| Paper Space | No | Not applicable for drawings. |\n| Shop Drawing | No | This is a modeling tool only. |\n\n## Prerequisites\n- **Required entities**: At least one existing timber beam (`GenBeam`).\n- **Minimum beam count**: 1.\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_BEAM_RAFTER_SPLICE.mcr`\n\n### Step 2: Select Beams\n```\nCommand Line: Select beam(s) to splice\nAction: Click on the beam or beams you wish to splice. Press Enter to confirm selection.\n```\n\n### Step 3: Define Splice Location\n```\nCommand Line: Select splice midpoint\nAction: Click a point along the length of the beam where you want the center of the overlap to be located.\n```\n\n### Step 4: Define Offset Direction\n```\nCommand Line: Offset direction for new beams\nAction: Click to the side of the beam to indicate which direction the pieces should separate. The script will snap this to the beam's local side direction.\n```\n\n### Step 5: Set Overlap Length\n```\nCommand Line: Set splice overlap <2'-0''>\nAction: Type the desired length for the splice overlap (e.g., 600mm or 24\") and press Enter. Press Enter without typing to accept the default (2'-0\" / 610mm).\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| N/A | N/A | N/A | This script runs via command line input only and does not expose properties in the Properties Palette. It replaces the geometry and erases itself upon completion. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| N/A | No context menu options are available. The script executes once and deletes itself. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- The script automatically determines which of the two resulting segments is \"lower\" (based on Z-height) and moves that one.\n- The standard default overlap is 2'-0\" (610mm), which is common for rafter splicing.\n- Ensure you pick the splice midpoint far enough from the beam ends; otherwise, the script will report that there is \"no room for splice.\"\n- The original single beam is deleted and replaced by two new beam entities.\n\n## FAQ\n- **Q: Why did I get the error \"ERROR: There is no room for splice on selected point\"?**\n  A: The overlap length you entered extends beyond the physical ends of the beam from your selected midpoint. Either pick a point closer to the center of the beam or enter a smaller overlap length.\n\n- **Q: Can I undo the changes made by this script?**\n  A: Yes, you can use the standard AutoCAD `UNDO` command to revert the operation.\n\n- **Q: The script disappeared after I ran it. Is that normal?**\n  A: Yes. This is a \"command script\" that self-destructs after execution. The results are the new beams created in the model."
      },
      "tokens_used": 4982,
      "error": null
    }
  }
}