{
  "filename": "hsbPolylineMarker.mcr",
  "status": "completed",
  "total_tokens": 33581,
  "processing_time": 145.92376852035522,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "30.04.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-21987 initial version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5898,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses tslNew.dbCreate(..., _kModelSpace, ...) during the OnInsert phase. It prompts for GenBeam and PLine selection using PrEntity and manipulates the beam geometry (gb.addTool), which are standard 3D model operations. There is no usage of _Viewport, sd_ prefixes, or shop drawing specific catalogs."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "EntPLine"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 4672,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select marking polylines|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select genbeams to be marked|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "reportNotice",
            "trigger": "Error on Insert (Invalid Selection)",
            "title": null,
            "dataSource": "Internal String",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "reportNotice",
            "trigger": "Error on Recalc (Invalid Selection Set)",
            "title": null,
            "dataSource": "Internal String",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "reportNotice",
            "trigger": "Error on Recalc (Invalid PLine)",
            "title": null,
            "dataSource": "Internal String",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "reportNotice",
            "trigger": "Error on Recalc (No common marking area)",
            "title": null,
            "dataSource": "Internal String",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [],
        "contextMenu": [
          {
            "menuItem": "|Flip Side|",
            "handler": "|Flip Side|",
            "action": "Toggles the 'flip' integer state in the internal Map, causing the projection to use the opposite side of the polyline plane.",
            "alsoTriggeredBy": "Double Click"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 4767,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Projects a selected 2D polyline onto specific timber elements to create precise marking lines, indicating locations for cuts, openings, or hardware placement during fabrication.",
          "category": "Framing/Machining",
          "typicalUseCase": "Used when a designer needs to mark the intersection of a complex geometry (like a roof dormer opening or wall junction) defined by a polyline onto specific beams for manual or CNC cutting."
        },
        "parameters": [
          {
            "name": "ents (Marking Polylines)",
            "technicalDefault": "PrEntity selection",
            "businessMeaning": "The geometric boundary or path that serves as the template for the mark to be transferred to the beam.",
            "validRange": "Any valid Polyline (PLine)",
            "unit": "Geometry",
            "affectsOutput": "Defines the shape and length of the marking lines applied to the beam."
          },
          {
            "name": "ents2 (Target GenBeams)",
            "technicalDefault": "PrEntity selection",
            "businessMeaning": "The structural timber elements that will receive the marking lines.",
            "validRange": "One or more valid GenBeams",
            "unit": "Entity",
            "affectsOutput": "Determines which beams physically display the tool marks and carry the data for production."
          },
          {
            "name": "bFlipFace (Flip Side)",
            "technicalDefault": "0",
            "businessMeaning": "Selects the projection direction of the polyline, allowing the user to mark the beam on the opposite face relative to the polyline's normal vector.",
            "validRange": "0 (Front/Normal), 1 (Back/Flipped)",
            "unit": "Integer (Boolean)",
            "affectsOutput": "Toggles the location of the markings from one side of the beam to the other based on the projection vector."
          },
          {
            "name": "dEps",
            "technicalDefault": "U(.1)",
            "businessMeaning": "Tolerance setting used to determine if a polyline is valid and to calculate intersections precisely.",
            "validRange": "0.1mm - 1.0mm",
            "unit": "mm",
            "affectsOutput": "Filters out tiny, unusable geometry fragments and ensures clean trimming of the marking lines at beam edges."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User selects 'Flip Side' or Double Clicks the instance",
            "effect": "Inverts the bFlipFace integer state",
            "cascade": [
              "Projection Vector",
              "Marking Side"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "MarkerLine",
            "description": "Non-physical lines applied to the beam surface for visual reference in the model and data export for manufacturing.",
            "appliedTo": "The selected GenBeam(s)"
          }
        ]
      },
      "tokens_used": 5190,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User launches script via 'TSLCONTENT' command.",
          "2. Command line prompts: 'Select marking polylines'.",
          "3. System validates selection (must contain at least one valid PLine).",
          "4. [Conditional] If selection invalid: Report error, erase instance, abort.",
          "5. Command line prompts: 'Select genbeams to be marked'.",
          "6. System filters selection for valid, non-dummy GenBeams.",
          "7. System enters nested loop: For each Beam, iterate through each selected PLine.",
          "8. System calculates preliminary projection/intersection to verify validity.",
          "9. For each valid (Beam + PLine) pair: Create a new specific instance of hsbPolylineMarker.",
          "10. System erases the original 'generator' instance.",
          "11. [Recalc Phase] Specific instance validates its linked entities still exist.",
          "12. Specific instance projects PLine onto Beam face based on flip state.",
          "13. System calculates intersection of projected PLine and Beam body profile.",
          "14. System trims PLine to fit within Beam boundaries.",
          "15. [Conditional] If resulting marking length < 10mm: Report error, erase instance.",
          "16. System applies visual graphics (Line/Circle) and adds MarkerLine tools to the Beam."
        ],
        "conditionalBranches": [
          {
            "condition": "User selects entities during Insertion",
            "path1": {
              "name": "Invalid Selection (Empty)",
              "steps": [
                "Report 'Invalid selection set.'",
                "Erase Instance",
                "Return"
              ]
            },
            "path2": {
              "name": "Valid Selection",
              "steps": [
                "Store entities in array",
                "Proceed to Beam Selection"
              ]
            }
          },
          {
            "condition": "Geometry Projection Check (Recalc)",
            "path1": {
              "name": "No Common Area",
              "steps": [
                "Report 'No common marking area found'",
                "Erase Instance",
                "Return"
              ]
            },
            "path2": {
              "name": "Valid Intersection",
              "steps": [
                "Calculate intersection points",
                "Trim PLine to beam edges",
                "Apply Marking Lines"
              ]
            }
          },
          {
            "condition": "User Interaction (Recalc)",
            "path1": {
              "name": "Normal Recalc",
              "steps": [
                "Read current 'flip' state",
                "Project using current normal vector"
              ]
            },
            "path2": {
              "name": "Flip Side / Double Click",
              "steps": [
                "Invert 'flip' integer in Map",
                "Set Execution Loops to 2 (Force redraw)",
                "Project using inverted normal vector"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Polylines selected during insertion",
            "errorMessage": "Invalid selection set.",
            "recovery": "User must restart script and ensure at least one PLine is selected."
          },
          {
            "check": "GenBeams selected are valid (not dummy)",
            "errorMessage": "Silent failure (Dummy beams skipped in loop)",
            "recovery": "Ensure valid structural beams are selected."
          },
          {
            "check": "Linked PLine exists and has length > tolerance (dEps)",
            "errorMessage": "Invalid selection set. / Invalid pline",
            "recovery": "Ensure original geometry has not been deleted."
          },
          {
            "check": "Projected PLine intersects Beam body profile",
            "errorMessage": "No common marking area found",
            "recovery": "Adjust PLine position relative to Beam or use 'Flip Side' to check opposite face."
          },
          {
            "check": "Resulting marking length > 10mm",
            "errorMessage": "Instance Erased",
            "recovery": "Adjust PLine to ensure a significant marking area."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Toggle Projection Side",
            "how": "Right-click Context Menu ('Flip Side') or Double Click",
            "effect": "Inverts the projection vector, moving the marking from one side of the beam face to the other."
          },
          {
            "action": "Dynamic Update",
            "how": "Geometry Modification (Stretching PLine or Moving Beam)",
            "effect": "Script recalculates intersection and updates MarkerLine positions automatically."
          },
          {
            "action": "Instance Deletion",
            "how": "Deleting the source PLine or Beam",
            "effect": "The script detects invalid dependencies, reports 'Invalid selection set', and erases itself."
          }
        ]
      },
      "tokens_used": 7522,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbPolylineMarker.mcr\n\n## Overview\nProjects a selected 2D polyline onto specific timber elements (GenBeams) to create precise marking lines. These marks indicate locations for cuts, openings, or hardware placement during fabrication.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model environment. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | Not intended for 2D drawings. |\n\n## Prerequisites\n- **Required Entities**: At least one Polyline (EntPLine) and one or more GenBeams.\n- **Minimum Beam Count**: 1\n- **Required Settings**: None required.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbPolylineMarker.mcr` from the file dialog.\n\n### Step 2: Select Marking Polylines\n```\nCommand Line: Select marking polylines\nAction: Select one or more 2D Polylines that define the shape you want to transfer to the beams. Press Enter when finished.\n```\n*Note: If you do not select a valid polyline, the script will report an error and exit.*\n\n### Step 3: Select Target GenBeams\n```\nCommand Line: Select genbeams to be marked\nAction: Click on the structural timber beams (GenBeams) that intersect with or align to the selected polylines. Press Enter to confirm.\n```\n*Note: The script will automatically filter out invalid selections (like dummy beams).*\n\n### Step 4: Automatic Processing\nThe script will now automatically generate a specific marker instance for every valid combination of Polyline and Beam. If the geometry does not intersect or the resulting mark is too small, instances may be deleted automatically.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| *None* | *N/A* | *N/A* | This script does not expose editable properties in the Properties Palette. All interaction is handled via the Context Menu or Double-Click. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip Side | Toggles the projection direction. If the mark is on the \"front\" face, this moves it to the \"back\" face (or vice versa) relative to the polyline's vector. |\n\n## Settings Files\n- **Filename**: None used.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Flipping the Mark**: If the marking line appears on the wrong face of the beam, simply double-click the script instance or select \"Flip Side\" from the right-click menu.\n- **Intersection is Key**: Ensure your polyline physically intersects the volume of the beam in 3D space. If there is no common volume, the script will report \"No common marking area found\" and delete the instance.\n- **Minimum Length**: The script ignores marking lines shorter than 10mm to prevent clutter in the model.\n- **Dynamic Updates**: If you move the polyline or stretch the beam geometry, the marking lines will automatically update to match the new intersection.\n\n## FAQ\n- **Q: Why did the script instance disappear immediately after creation?**\n  **A**: This usually means the projection failed. Check that the polyline and the beam actually overlap in 3D space. Alternatively, the resulting intersection line might have been shorter than 10mm.\n- **Q: Can I use one polyline to mark multiple beams at once?**\n  **A**: Yes. You can select multiple GenBeams during the insertion step. The script will loop through them and create a separate marker for each beam that intersects the polyline.\n- **Q: What happens if I delete the source polyline?**\n  **A**: The script instance will detect that the source geometry is missing, report \"Invalid selection set,\" and erase itself automatically."
      },
      "tokens_used": 5532,
      "error": null
    }
  }
}