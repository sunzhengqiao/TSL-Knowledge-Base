{
  "filename": "hsbFA_Add2MassElement.mcr",
  "status": "completed",
  "total_tokens": 48093,
  "processing_time": 416.5539815425873,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This TSL defines a FastenerAssembly Guideline in dependency of a cylindrical MassElement and creates a FastenerAssembly on creation time. It also attaches a group key per all selected entities if the property set hsbDimGroup is available. This groupkey will be used to group drill holls in shopdrawings as well as display a grouped label in modelspace",
        "versionHistory": [
          {
            "version": "1.5",
            "date": "25jan12",
            "author": "th@hsbCAD.de",
            "changes": "new option to set length by grip points"
          },
          {
            "version": "1.4",
            "date": "02.09.2011",
            "author": "th@hsbCAD.de",
            "changes": "bugfix"
          },
          {
            "version": "1.3",
            "date": "02.09.2011",
            "author": "th@hsbCAD.de",
            "changes": "insert dialog varies from execute key. if the tsl is inserted with the key 'nogenbeam' the dialog does not show the drill properties and the user is not prompted for a genbeam selection"
          },
          {
            "version": "1.2",
            "date": "30.08.2011",
            "author": "th@hsbCAD.de",
            "changes": "bugfix drill diameter"
          },
          {
            "version": "1.1",
            "date": "29.08.2011",
            "author": "th@hsbCAD.de",
            "changes": "new Option to link a genbeam for tooling, new properties to define optional drill in linked genbeam new context command to add or remove a genbeam and to flip side of tooling the Z-Axis of the mass element defines the default direction of the drill, if depth is set to 0 a complete through drill is assumed"
          },
          {
            "version": "1.0",
            "date": "28.08.2011",
            "author": "th@hsbCAD.de",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7409,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script interacts with 3D entities (MassElement, GenBeam) and creates geometric operations (Drill, FastenerAssembly) within the model. The insertion loop uses `_kAllSpaces` but targets Model entities. No `sd_` prefix, `#Type E`, or `_Viewport` usage is present."
        },
        "prerequisites": {
          "requiredEntities": [
            "MassElement (Must be shapeType _kMSTCylinder)",
            "GenBeam (Optional, for tooling/drilling)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space with a cylindrical MassElement selected.",
          "requiredSettings": [
            "FastenerAssemblyDef Catalog (Must have at least one entry for Style selection)"
          ]
        }
      },
      "tokens_used": 5419,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select Mass Element(s)",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select GenBeam(s) (optional)",
              "condition": "_bOnInsert && _kExecuteKey != 'NOGENBEAM'",
              "required": false
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "Select start and end point (optional)",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 4,
              "function": "PrPoint",
              "promptOriginal": "Select end point",
              "condition": "_bOnInsert && first point selected",
              "required": false
            },
            {
              "step": 5,
              "function": "getGenBeam",
              "promptOriginal": "Select GenBeam",
              "condition": "_bOnRecalc && _kExecuteKey == \"Add GenBeam\"",
              "required": true
            },
            {
              "step": 6,
              "function": "getGenBeam",
              "promptOriginal": "Select GenBeam",
              "condition": "_bOnRecalc && _kExecuteKey == \"Remove GenBeam\"",
              "required": true
            },
            {
              "step": 7,
              "function": "PrPoint",
              "promptOriginal": "Select start and end point (optional)",
              "condition": "_bOnRecalc && _kExecuteKey == \"Edit in place\"",
              "required": false
            },
            {
              "step": 8,
              "function": "PrPoint",
              "promptOriginal": "Select end point",
              "condition": "_bOnRecalc && _kExecuteKey == \"Edit in place\" && first point selected",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "_bOnInsert",
            "title": "Properties",
            "dataSource": "Internal TSL Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sStyle",
            "type": "PropString",
            "displayName": "Fastener Style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "Catalog Entries",
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sFlip",
            "type": "PropString",
            "displayName": "Flip Side",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dDeltaDiameter",
            "type": "PropDouble",
            "displayName": "Delta Diameter",
            "defaultValue": -1.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "Depth (0=complete)",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Add GenBeam",
            "handler": "Add GenBeam",
            "action": "Prompts user to select a GenBeam and adds it to the _GenBeam array.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Remove GenBeam",
            "handler": "Remove GenBeam",
            "action": "Prompts user to select a GenBeam and removes it from the _GenBeam array.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Flip Side",
            "handler": "Flip Side",
            "action": "Toggles the flip state in the Map and recalculates the drill position.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Edit in place",
            "handler": "Edit in place",
            "action": "Prompts user for start and end points to manually set the grip points.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7692,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts a threaded rod or fastener assembly (defined by a cylindrical MassElement) and automatically generates clearance holes through selected timber beams (GenBeams) based on the rod's position.",
          "category": "Hardware / Connection",
          "typicalUseCase": "Creating a through-bolt or rod connection where a steel rod passes through multiple timber columns or beams, ensuring the holes in the timber align with the rod."
        },
        "parameters": [
          {
            "name": "sStyle",
            "technicalDefault": "Empty",
            "businessMeaning": "Selects the specific hardware configuration (e.g., specific threaded rod type, bolt assembly) from the hsbCAD Fastener Assembly catalog to be inserted in the model.",
            "validRange": "Any valid FastenerAssemblyDef name present in the current catalog.",
            "unit": "String",
            "affectsOutput": "Determines the 3D geometry and BOM data of the Fastener Assembly entity created at the MassElement location."
          },
          {
            "name": "sFlip",
            "technicalDefault": "No",
            "businessMeaning": "Reverses the orientation of the drilling operation relative to the intersection point. This determines from which side the depth is measured or which side is considered the 'entry' for blind holes.",
            "validRange": "Yes, No",
            "unit": "Boolean/String",
            "affectsOutput": "Swaps the start and end points of the drill, flipping the direction vector. If depth is non-zero, it switches whether the depth extends 'forward' or 'backward' from the intersection surface."
          },
          {
            "name": "dDeltaDiameter",
            "technicalDefault": -1.0,
            "businessMeaning": "Adjusts the diameter of the drill hole relative to the radius of the cylindrical MassElement. Controls the clearance between the timber and the rod.",
            "validRange": "Typically -2.0 to +10.0 mm. (Note: Negative values make the hole smaller than the MassElement radius; Positive values make it larger for clearance).",
            "unit": "mm",
            "affectsOutput": "Calculates Drill Radius as (MassElement Radius + Delta Diameter / 2). Directly changes the size of the hole drilled in the GenBeam."
          },
          {
            "name": "dDepth",
            "technicalDefault": 0.0,
            "businessMeaning": "Defines the length of the drill hole. A value of 0 implies a through-hole (drilling entirely through the intersecting timber). A non-zero value creates a blind hole of that specific depth.",
            "validRange": "0 (Through) or >0 (Blind hole depth in mm).",
            "unit": "mm",
            "affectsOutput": "Determines the end point of the drill. If 0, the drill extends to the exit surface of the timber. If >0, the drill stops at the specified distance from the entry point."
          },
          {
            "name": "Start/End Points (Grip Points)",
            "technicalDefault": "None",
            "businessMeaning": "Manual override for the start and end points of the drilling/fastener guideline.",
            "validRange": "Any 3D coordinates in model space.",
            "unit": "Coordinates (mm)",
            "affectsOutput": "Overrides the automatic intersection calculation with GenBeams. Forces the drill and guideline to follow exactly these points."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sFlip is set to 'Yes'",
            "effect": "Reverses the calculation vector used for determining the drill start/end points when dDepth is non-zero.",
            "cascade": [
              "dDepth"
            ]
          },
          {
            "trigger": "dDepth is set to 0",
            "effect": "Disables the use of Flip logic for depth calculation and defaults to a Through-drill (calculating intersection with both sides of the GenBeam).",
            "cascade": [
              "sFlip"
            ]
          },
          {
            "trigger": "GenBeam selection is empty",
            "effect": "No Drill entities are created. Only the Fastener Assembly and Guideline are generated.",
            "cascade": [
              "dDeltaDiameter",
              "dDepth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "FastenerAssemblyEnt",
            "description": "The physical 3D representation of the hardware (rod/bolt) inserted into the model.",
            "appliedTo": "Anchored to the script instance at the MassElement origin."
          },
          {
            "type": "Drill",
            "description": "A machining operation (hole) added to the timber beams.",
            "appliedTo": "All selected GenBeams that intersect with the cylindrical MassElement or the user-defined grip points."
          },
          {
            "type": "FastenerGuideline",
            "description": "A visual line indicating the axis and extent of the connection.",
            "appliedTo": "The script instance."
          },
          {
            "type": "PropertySet (hsbDimGroup)",
            "description": "Assigns a grouping key to the MassElement to link dimensioning and labeling of the holes in shop drawings.",
            "appliedTo": "The selected MassElement."
          }
        ]
      },
      "tokens_used": 9789,
      "error": null
    },
    "5": {
      "success": true,
      "data": {},
      "tokens_used": 11449,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbFA_Add2MassElement.mcr\n\n## Overview\nThis script inserts a fastener assembly (such as a threaded rod or bolt) based on a cylindrical MassElement. It automatically generates clearance holes through selected timber beams (GenBeams) and applies grouping keys for consistent shop drawing labels.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This is the primary environment for inserting the script and interacting with 3D beams and mass elements. |\n| Paper Space | No | |\n| Shop Drawing | No | While it creates grouping data for shop drawings, the script itself runs in the model. |\n\n## Prerequisites\n- **Required Entities**: A cylindrical MassElement (shape type `_kMSTCylinder`) must exist in the model or be created during insertion.\n- **Minimum Beam Count**: 0 (GenBeams are optional if you only want the fastener assembly without drilling).\n- **Required Settings**: A valid Fastener Assembly Definition must exist in your hsbCAD catalog to select a Style.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `hsbFA_Add2MassElement.mcr`.\n\n### Step 2: Select Mass Element\n```\nCommand Line: Select Mass Element(s)\nAction: Click on the cylindrical MassElement in the model that represents the location of the fastener.\n```\n\n### Step 3: Select GenBeams (Optional)\n```\nCommand Line: Select GenBeam(s) (optional)\nAction: Select the timber beams you wish to drill through. Press Enter to skip if no drilling is required.\n```\n*Note: If you insert the script using the specific execute key 'NOGENBEAM', this prompt is skipped automatically.*\n\n### Step 4: Define Length (Optional)\n```\nCommand Line: Select start and end point (optional)\nAction: You can click two points in 3D space to manually define the length and direction of the fastener guideline. Press Enter to skip and use automatic calculation.\n```\n\n### Step 5: Configure Properties\nAction: The Properties palette will appear. Select the **Fastener Style** and adjust diameters or depths as needed. The script will generate the fastener and drills immediately.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Fastener Style | dropdown | (Empty) | Selects the hardware configuration (e.g., threaded rod type) from your catalog. |\n| Flip Side | dropdown | No | Reverses the drilling direction. \"Yes\" calculates depth from the opposite side of the intersection. |\n| Delta Diameter | number | -1.0 | Adjusts the hole size. Positive values make the hole larger (clearance); negative values make it smaller. |\n| Depth | number | 0.0 | Length of the drill. `0` creates a through-hole (drills completely through the beam). Any positive value creates a blind hole of that depth. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add GenBeam | Allows you to select additional timber beams after insertion. The script will calculate and add drills to these new beams. |\n| Remove GenBeam | Prompts you to select a beam to remove its associated drill from this assembly. |\n| Flip Side | Toggles the \"Flip Side\" property, reversing the drill direction instantly. |\n| Edit in place | Allows you to manually redefine the start and end points of the fastener guideline by clicking in the model. |\n\n## Settings Files\n- **Filename**: None specified\n- **Location**: N/A\n- **Purpose**: This script relies on the standard hsbCAD Fastener Catalogs rather than external XML settings files.\n\n## Tips\n- **Through Holes**: Leave **Depth** set to `0.0` to ensure the drill goes all the way through the selected beams.\n- **Clearance**: If your rod is 20mm and you want a 22mm hole, ensure your MassElement radius is 10mm and set **Delta Diameter** to `2.0`.\n- **Direction**: The Z-axis of the MassElement defines the default drilling direction. Use **Flip Side** if the drill is going the wrong way.\n- **Grouping**: The script automatically attaches a group key (if the `hsbDimGroup` property set is available) to group holes in shop drawings.\n\n## FAQ\n- **Q: Why is no drill appearing in my beam?**\n  A: Check if you selected the correct GenBeam in Step 3 or used \"Add GenBeam\" from the right-click menu. Also, ensure the cylinder actually intersects with the timber.\n- **Q: How do I make the hole larger than the rod?**\n  A: Increase the **Delta Diameter** value. For example, `2.0` will add 1mm to the radius (2mm to the total diameter).\n- **Q: Can I change the length of the rod visually?**\n  A: Yes, use the \"Edit in place\" right-click option to select new start and end points, or grip-edit the guideline points if enabled."
      },
      "tokens_used": 6335,
      "error": null
    }
  }
}