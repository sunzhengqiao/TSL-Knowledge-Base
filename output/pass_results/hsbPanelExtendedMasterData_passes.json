{
  "filename": "hsbPanelExtendedMasterData.mcr",
  "status": "completed",
  "total_tokens": 32301,
  "processing_time": 255.52068877220154,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 6639,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit use of _kModelSpace in tslNew.dbCreate(). No 'sd_' or 'Multipage' prefix. Validation logic checks for MasterPanel entities. Display uses direct drawing in World Coordinate System (_ZW)."
        },
        "prerequisites": {
          "requiredEntities": [
            "MasterPanel"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 4218,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select other panels|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 1,
            "variable": "sUnit",
            "type": "PropString",
            "displayName": "|Unit|",
            "defaultValue": "mm",
            "inputType": "dropdown",
            "options": [
              "mm",
              "cm",
              "m",
              "inch",
              "feet"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nDecimals",
            "type": "PropInt",
            "displayName": "|Decimals|",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "|Color|",
            "defaultValue": 3,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4157,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a visual data table in ModelSpace listing extended properties of a Master Panel (dimensions, areas, material quality, yield) and writes non-graphical attributes for data extraction.",
          "category": "DataManagement/Reporting",
          "typicalUseCase": "Used during the design or detailing phase to verify panel geometric properties and material statistics, and to populate attribute data for production lists or BIM export."
        },
        "parameters": [
          {
            "name": "sUnit",
            "technicalDefault": "mm",
            "businessMeaning": "The unit of measurement (metric or imperial) used to display dimensions and calculated areas in the visual report.",
            "validRange": "mm, cm, m, inch, feet",
            "unit": "String",
            "affectsOutput": "Alters the text labels and numerical conversion of dimensions in the on-screen data table (e.g., 5000 mm vs 5.0 m)."
          },
          {
            "name": "nDecimals",
            "technicalDefault": "0",
            "businessMeaning": "The precision level for the numerical values displayed in the report.",
            "validRange": "0 - 4",
            "unit": "Integer (Decimal Places)",
            "affectsOutput": "Rounds the displayed values for lengths, widths, thicknesses, and areas in the visual table."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "Active Standard DimStyle",
            "businessMeaning": "The text style used for the generated data table, controlling font and size.",
            "validRange": "Any DimStyle defined in the AutoCAD drawing",
            "unit": "String",
            "affectsOutput": "Changes the visual appearance (font, height) of the data table text."
          },
          {
            "name": "nColor",
            "technicalDefault": "3",
            "businessMeaning": "The color index used to draw the data table text in the CAD environment.",
            "validRange": "0 - 255 (AutoCAD Color Index)",
            "unit": "Integer",
            "affectsOutput": "Changes the display color of the generated text."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sUnit",
            "effect": "Determines the conversion logic for calculating area and length strings. Switching to imperial units (inches/feet) adjusts the length unit format logic.",
            "cascade": [
              "sAreaNet",
              "sAreaBrut",
              "sPeri",
              "sHeight",
              "sWidth",
              "sLength"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text Entity",
            "description": "A visual table drawn in ModelSpace displaying PosNum, Style, Quality, Net Area, Gross Area, Perimeter, Length, Width, Thickness, Yield, and Info.",
            "appliedTo": "ModelSpace (positioned relative to the MasterPanel)"
          },
          {
            "type": "Attribute Data (dxaout)",
            "description": "Structured data properties written for export, including Code, Width, Height, Length, NetArea, Area, Perimeter, Sublabel, Grade, and Info.",
            "appliedTo": "Script Instance"
          }
        ]
      },
      "tokens_used": 4667,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script invoked via command line or catalog",
          "2. Check insertCycleCount; abort if > 1 to prevent loops",
          "3. Determine configuration source: Show Properties Dialog if executed manually, or load properties from Catalog if executed via catalog",
          "4. Prompt user to select MasterPanel entities on screen",
          "5. Iterate through selected entities:",
          "   - Calculate bottom-left point of panel geometry",
          "   - Determine insertion point (offset 1700mm downwards from panel bottom)",
          "   - Create a cloned script instance attached to the panel at the calculated point",
          "6. Erase the temporary 'installer' script instance",
          "7. [Cloned Instance Execution] Validate attached entity is a MasterPanel; self-erase if invalid",
          "8. Extract MasterPanel geometry data and update yield",
          "9. Iterate through nested ChildPanels:",
          "   - Aggregate net area (envelope minus openings)",
          "   - Detect and report style variations",
          "   - Parse material string to determine Quality (VI, BVI, NVI)",
          "10. Apply style from child panels to MasterPanel entity",
          "11. Format numerical values based on 'sUnit' and 'nDecimals' properties",
          "12. Export data attributes (dxaout) for production lists (always in mm)",
          "13. Draw visual data table in ModelSpace at the script origin"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Source",
            "path1": {
              "name": "Manual Execution",
              "steps": [
                "_kExecuteKey is empty",
                "showDialog() is called to present properties (Unit, Decimals, DimStyle) to user",
                "User confirms values"
              ]
            },
            "path2": {
              "name": "Catalog Execution",
              "steps": [
                "_kExecuteKey contains catalog entry name",
                "setPropValuesFromCatalog() is called",
                "Properties are loaded silently without dialog"
              ]
            }
          },
          {
            "condition": "Child Panel Style Consistency",
            "path1": {
              "name": "Consistent Styles",
              "steps": [
                "All child panels have the same style",
                "sChildStyle is set",
                "MasterPanel style is updated to match"
              ]
            },
            "path2": {
              "name": "Style Variation Detected",
              "steps": [
                "Subsequent child panels have a different style than the first",
                "reportNotice() generates warning: 'Style variation in Masterpanel [PosNum]'",
                "Processing continues"
              ]
            }
          },
          {
            "condition": "Material Quality Detection",
            "path1": {
              "name": "Known Quality",
              "steps": [
                "Material string contains 'VI', 'BVI', or 'NVI'",
                "sQuality is set to the found value",
                "Quality is included in table and export"
              ]
            },
            "path2": {
              "name": "Unknown Quality",
              "steps": [
                "Material string does not match known quality patterns",
                "reportNotice() generates warning: 'Unknown Quality in Masterpanel [PosNum]'",
                "Quality field may be empty in output"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Attached Entity Type",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script erases itself via eraseInstance() if the linked entity is not a valid MasterPanel."
          },
          {
            "check": "Style Variance",
            "errorMessage": "Style variation in Masterpanel [Panel Number]",
            "recovery": "Informative only; script continues using the first detected style."
          },
          {
            "check": "Material Quality",
            "errorMessage": "Unknown Quality in Masterpanel [Panel Number]",
            "recovery": "Informative only; script continues, Quality field may be blank."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Display Units",
            "how": "OPM Properties (Property Palette) -> sUnit dropdown",
            "effect": "Recalculates the text strings for Length, Width, Height, Perimeter, and Areas to display in the selected unit (mm, cm, m, inch, feet)."
          },
          {
            "action": "Adjust Precision",
            "how": "OPM Properties -> nDecimals dropdown",
            "effect": "Updates the decimal places shown in the on-screen table text."
          },
          {
            "action": "Modify Appearance",
            "how": "OPM Properties -> sDimStyle or nColor",
            "effect": "Changes the text font/size or color of the generated table immediately."
          },
          {
            "action": "Move Data Table",
            "how": "Grip edit or standard Move command",
            "effect": "Relocates the text table in ModelSpace. Note: The script does not automatically re-anchor if the panel moves significantly relative to the script origin, but it reads live data from the panel."
          },
          {
            "action": "Panel Geometry Update",
            "how": "Modify the MasterPanel geometry or child panels",
            "effect": "Script recalculates automatically on next regeneration/update, refreshing Areas, Perimeter, and Yield values."
          }
        ]
      },
      "tokens_used": 7212,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbPanelExtendedMasterData.mcr\n\n## Overview\nThis script generates a visual data table in Model Space that displays extended properties of a Master Panel, including dimensions, net/gross area, material quality, and yield. It also attaches attribute data to the element for use in production lists or data extraction.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script is designed to run and display data in Model Space only. |\n| Paper Space | No | Not supported for layout generation. |\n| Shop Drawing | No | This is not a shop drawing generation script. |\n\n## Prerequisites\n- **Required Entities**: A `MasterPanel` entity must exist in the drawing.\n- **Minimum Count**: At least 1 MasterPanel must be selected during insertion.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nRun the `TSLINSERT` command in the AutoCAD command line and select `hsbPanelExtendedMasterData.mcr` from the list.\n\n### Step 2: Configure Properties\nA dialog box will appear upon insertion.\n- **Unit**: Select the desired unit (e.g., mm, m, inch).\n- **Decimals**: Choose the number of decimal places (0-4).\n- **Dimstyle**: Select the text style for the table.\n- **Color**: Select the color for the text.\n- Click **OK** to confirm.\n\n### Step 3: Select Panels\n```\nCommand Line: Select other panels\nAction: Click on the MasterPanel(s) you wish to analyze. Press Enter to finish selection.\n```\n\n### Step 4: Generation\nThe script will automatically generate a text table below each selected panel containing the calculated data. If the script detects mixed styles within the panel or unknown material qualities, a warning will be displayed in the command line.\n\n## Properties Panel Parameters\n\nAfter insertion, select the generated script instance (the data table origin point) and open the **Properties Palette** (Ctrl+1) to modify the following:\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Unit | Dropdown | mm | Sets the unit of measurement for displayed dimensions (Length, Width, Height, Perimeter) and Areas. Options: mm, cm, m, inch, feet. |\n| Decimals | Dropdown | 0 | Sets the precision (number of decimal places) for numerical values in the table. |\n| Dimstyle | Dropdown | Standard | Defines the text style (font, height) used for the data table. |\n| Color | Number | 3 | Sets the AutoCAD color index for the text table. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific custom context menu options are provided for this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not rely on external settings or XML files; it uses internal properties.\n\n## Tips\n- **Live Updates**: If you modify the geometry of the MasterPanel (e.g., change size or add openings), the data table will automatically recalculate and update the next time the drawing regenerates.\n- **Moving the Table**: You can use the standard AutoCAD **Move** command or grip-edit the script insertion point to relocate the data table if it conflicts with other elements.\n- **Data Aggregation**: The script analyzes all ChildPanels within the MasterPanel to calculate the Net Area (envelope minus openings) and detect material quality.\n- **Unit Conversion**: Changing the `Unit` property in the palette instantly converts the displayed values without needing to delete and re-run the script.\n\n## FAQ\n- **Q: I see a warning \"Style variation in Masterpanel\". What does this mean?**\n  A: This means the ChildPanels nested inside your MasterPanel have different styles assigned to them. The script will continue to function but will report this inconsistency.\n  \n- **Q: How do I change the text size of the data table?**\n  A: Select the script instance, open the Properties Palette (Ctrl+1), and change the **Dimstyle** property to a text style with your desired height/font settings.\n\n- **Q: Can I use this on elements other than MasterPanels?**\n  A: No. The script is designed specifically to read MasterPanel entities. If attached to another entity type, it will erase itself.\n\n- **Q: The \"Quality\" field is empty in my table. Why?**\n  A: The script looks for specific strings (VI, BVI, NVI) in the material name of the panel. If your material naming convention differs, the script reports \"Unknown Quality\" and leaves the field blank."
      },
      "tokens_used": 5408,
      "error": null
    }
  }
}