{
  "filename": "hsbSphere.mcr",
  "status": "completed",
  "total_tokens": 26797,
  "processing_time": 256.23235726356506,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "04jul12",
            "author": "th@hsbCAD.de",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5062,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses _kModelSpace in dbCreate call; no sd_ prefix; no #Type E or _Entity inputs; script logic targets GenBeam modification in model environment."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Company folder must contain a revolution shape definition",
            "hsbSetting->Hundegger 2 configuration"
          ]
        }
      },
      "tokens_used": 1795,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select Beam(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sProfile",
            "type": "PropString",
            "displayName": "Revolution Mill",
            "defaultValue": "Shape 1",
            "inputType": "dropdown",
            "options": [
              "Shape 1",
              "Shape 2"
            ],
            "category": null,
            "description": "Specifies the tooling index, see hsbSetting->Hundegger 2"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4508,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Applies a spherical or revolution milling operation (end rounding) to timber beams at a user-defined location.",
          "category": "Machining",
          "typicalUseCase": "Creating aesthetic rounded ends on beams (e.g., for pergolas or log cabins) or preparing specific joint geometries requiring a revolution mill on a CNC machine."
        },
        "parameters": [
          {
            "name": "sProfile",
            "technicalDefault": "Shape 1",
            "businessMeaning": "Selects the specific CNC tooling configuration (Revolution Mill) to apply. This maps to a tool index defined in the Hundegger machine settings (hsbSetting->Hundegger 2), determining the exact contour or radius of the spherical cut.",
            "validRange": "Shape 1, Shape 2 (Defined by script array, typically maps to specific tool indices in Hundegger settings)",
            "unit": "Selection",
            "affectsOutput": "Changes the geometry of the sphere/mill shape applied to the beam end and updates the manufacturing G-code to use the corresponding CNC tool."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change of 'sProfile'",
            "effect": "Updates the internal integer 'nIndex' which is passed to the RevolutionMill command.",
            "cascade": [
              "nIndex",
              "RevolutionMill Geometry"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "RevolutionMill",
            "description": "A 3D machining operation that removes material to create a spherical or rounded contour at the specified insertion point on the beam.",
            "appliedTo": "The selected GenBeam(s) at the coordinate provided by the user during insertion."
          },
          {
            "type": "Cut",
            "description": "A standard saw cut applied perpendicular to the beam's X-axis at the insertion point to trim the beam end.",
            "appliedTo": "The selected GenBeam(s) at the coordinate provided by the user during insertion."
          }
        ]
      },
      "tokens_used": 4314,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script (hsbSphere)",
          "2. Check insertCycleCount: If > 1, erase instance and exit (Safety Check)",
          "3. Show Dynamic Dialog (Properties Palette) for user to configure 'Revolution Mill' shape",
          "4. Prompt user to Select Beam(s)",
          "5. Prompt user to select Insertion Point (location of sphere/cut)",
          "6. Iterate through selected beams",
          "   6a. Attach new instance of script to beam at insertion point (dbCreate)",
          "   6b. If instance is valid, apply properties from '_LastInserted' catalog entry",
          "7. Erase the original 'seed' script instance",
          "8. Execute logic on generated instances: Create RevolutionMill at _Pt0 with nIndex",
          "9. Execute logic on generated instances: Add Cut at _Pt0 perpendicular to beam axis",
          "10. Generate display graphics (2D profile approximations)"
        ],
        "conditionalBranches": [
          {
            "condition": "insertCycleCount > 1",
            "path1": {
              "name": "Abort Repeat",
              "steps": [
                "Erase current instance",
                "Return (Stop execution)"
              ]
            },
            "path2": {
              "name": "Proceed",
              "steps": [
                "Show Dialog",
                "Prompt for Beams"
              ]
            }
          },
          {
            "condition": "Beam Selection (ssBm.go())",
            "path1": {
              "name": "User Cancels/Empty Selection",
              "steps": [
                "Script terminates (or reaches eraseInstance)",
                "No geometry created"
              ]
            },
            "path2": {
              "name": "Valid Selection",
              "steps": [
                "Store beam array",
                "Prompt for Insertion Point"
              ]
            }
          },
          {
            "condition": "Instance Creation (tslNew.bIsValid())",
            "path1": {
              "name": "Valid Instance",
              "steps": [
                "Set properties from '_LastInserted' catalog",
                "Add to model"
              ]
            },
            "path2": {
              "name": "Invalid Instance",
              "steps": [
                "Skip property assignment",
                "Continue loop (next beam)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection",
            "errorMessage": "None (Script simply terminates)",
            "recovery": "User must restart script and ensure at least one beam is selected."
          },
          {
            "check": "Insertion Point",
            "errorMessage": "None (Script terminates if point is not provided)",
            "recovery": "User must restart script and click a valid point in the drawing."
          },
          {
            "check": "External Configuration (Revolution Shape)",
            "errorMessage": "Potential CNC or Visual Error (not explicitly trapped in code)",
            "recovery": "Ensure Company folder contains a revolution shape definition at 0,0,0 WCS and Hundegger 2 settings are correct."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Sphere Shape",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing 'Revolution Mill' property updates the internal 'nIndex', which alters the tool index used for the RevolutionMill geometry generation."
          },
          {
            "action": "Relocate Sphere/Cut",
            "how": "Grip Edit (Move Script Entity)",
            "effect": "Moving the script grip updates '_Pt0', which shifts the location of both the RevolutionMill sphere and the perpendicular Cut on the beam."
          },
          {
            "action": "Update from Catalog",
            "how": "Right-click Context Menu (if available) or OPM",
            "effect": "Allows re-applying standard property sets from the catalog to the specific instance."
          }
        ]
      },
      "tokens_used": 5810,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbSphere.mcr\n\n## Overview\nThis script applies a spherical or revolution milling operation (end rounding) to timber beams at a user-defined location. It automatically generates both the 3D spherical machining contour and a perpendicular saw cut at the insertion point.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script is designed for use in the 3D model environment. |\n| Paper Space | No | Not supported for layout or detailing views. |\n| Shop Drawing | No | Not intended for generating 2D shop drawings directly. |\n\n## Prerequisites\n- **Required Entities**: At least one `GenBeam` must exist in the model.\n- **Minimum Beam Count**: 1.\n- **Required Settings**:\n  - Company folder must contain a valid **revolution shape definition**.\n  - **hsbSetting->Hundegger 2** configuration must be set up to map the script shapes to the correct machine tool indices.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Select `hsbSphere.mcr` from the file list.\n\n### Step 2: Configure Properties (Optional)\nAction: A dialog or the Properties Palette may appear upon launch. You can set the **Revolution Mill** shape now or modify it later.\n- Select \"Shape 1\" or \"Shape 2\" depending on the desired tooling profile.\n\n### Step 3: Select Beam(s)\n```\nCommand Line: Select Beam(s)\nAction: Click on the timber beam(s) in the model you wish to apply the sphere to. Press Enter to confirm selection.\n```\n\n### Step 4: Select Insertion Point\n```\nCommand Line: [Select Point]\nAction: Click on the beam where the center of the spherical cut should be located. This determines where the perpendicular cut and revolution mill will be applied.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Revolution Mill | dropdown | Shape 1 | Selects the specific CNC tooling configuration (Revolution Mill) to apply. This maps to a tool index defined in the Hundegger 2 settings (hsbSetting->Hundegger 2), determining the exact contour or radius of the spherical cut. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Grip Edit | Select the script entity and drag the grip to move the location of the sphere/cut along the beam. |\n| Properties | Opens the Properties Palette to change the Revolution Mill shape (e.g., switch from Shape 1 to Shape 2). |\n| Delete | Removes the script and associated machining from the beam. |\n\n## Settings Files\n- **Revolution Shape Definition**\n  - **Location**: Company Folder (defined in your hsbCAD configuration).\n  - **Purpose**: Provides the geometric definition for the revolution contour used to generate the 3D milling graphics and CNC path.\n- **hsbSetting (Hundegger 2)**\n  - **Purpose**: Maps the script properties (\"Shape 1\", \"Shape 2\") to specific tool indices on the Hundegger machine.\n\n## Tips\n- **Post-Insertion Editing**: You can easily move the sphere after insertion. Select the script entity in the model, click the grip point, and slide it to the new location along the beam.\n- **CNC Output**: Ensure that the \"Revolution Mill\" selection corresponds correctly to your Hundegger machine settings to ensure the correct tool is called during manufacturing.\n- **Dual Operation**: The script not only creates the spherical mill but also automatically applies a perpendicular Cut at the insertion point, trimming the beam end cleanly.\n\n## FAQ\n- Q: Why do I not see the cut in the 3D model?\n  A: Ensure that your display style (Visual Style) is set to show 3D solids or machining operations (e.g., \"Realistic\" or \"Shaded\" with machining visibility turned on).\n- Q: Can I use this on curved beams?\n  A: The script is designed for standard GenBeams. While it may technically attach to other entities, it is optimized for linear timber elements.\n- Q: What happens if I select \"Shape 2\" but it isn't defined in my settings?\n  A: The script may default to a generic shape or produce an error in the CNC output. Verify your Hundegger 2 settings in the hsbCAD configuration."
      },
      "tokens_used": 5308,
      "error": null
    }
  }
}