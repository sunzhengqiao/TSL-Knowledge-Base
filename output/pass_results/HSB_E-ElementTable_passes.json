{
  "filename": "HSB_E-ElementTable.mcr",
  "status": "completed",
  "total_tokens": 55550,
  "processing_time": 688.4089555740356,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": 1,
          "minorVersion": 4,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "07.05.2014",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "16.10.2014",
            "author": "AS",
            "changes": "Add width height and length as nameformats. Support a total row."
          },
          {
            "version": "1.02",
            "date": "06.09.2016",
            "author": "AS",
            "changes": "Add filter options."
          },
          {
            "version": "1.03",
            "date": "14.09.2016",
            "author": "AS",
            "changes": "Order by element number, use profbrutto as area instead of bounding box."
          },
          {
            "version": "1.04",
            "date": "14.09.2016",
            "author": "AS",
            "changes": "Add recalc triggers to add and remove elements if selection mode is set to select elements.."
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "HSB_G-FilterGenBeams"
        ]
      },
      "tokens_used": 8162,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses '_kModelSpace' to collect entities from Groups. It lacks 'sd_' prefix, '#Type E' declaration, and '_Viewport' logic. It generates a 2D table of text and lines based on user-selected Elements using standard getPoint() insertion and Display drawing methods."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (required to source elements via Group().collectEntities)",
          "requiredSettings": [
            "HSB_G-FilterGenBeams"
          ]
        }
      },
      "tokens_used": 7960,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select one or more elements|",
              "condition": "_bOnInsert && nInsertType == 3",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select a position for the table|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrEntity",
              "promptOriginal": "|Select one or more elements to add|",
              "condition": "_kExecuteKey == recalcTriggers[0]",
              "required": true
            },
            {
              "step": 4,
              "function": "PrEntity",
              "promptOriginal": "|Select one or more elements to remove|",
              "condition": "_kExecuteKey == recalcTriggers[1]",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnInsert (if _kExecuteKey is empty or not found in catalog)",
            "title": null,
            "dataSource": "Properties Palette (Prop declarations)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeperator01",
            "type": "PropString",
            "displayName": "|Selection|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sInsertType",
            "type": "PropString",
            "displayName": "     |Selection mode|",
            "defaultValue": 3,
            "inputType": "dropdown",
            "options": [
              "|Select entire project|",
              "|Select floor level in floor level list|",
              "|Select current floor level|",
              "|Select elements in drawing|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 10,
            "variable": "beamCodesToExclude",
            "type": "PropString",
            "displayName": "     |Beam codes to exclude|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 11,
            "variable": "materialsToExclude",
            "type": "PropString",
            "displayName": "     |Materials to exclude|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 12,
            "variable": "labelsToExclude",
            "type": "PropString",
            "displayName": "     |Labels to exclude|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sNameFloorGroup",
            "type": "PropString",
            "displayName": "     |Floorgroup|",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": "Dynamically populated from ModelSpace Groups",
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sSeperator02",
            "type": "PropString",
            "displayName": "|Table|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sPropTitle",
            "type": "PropString",
            "displayName": "     |Title|",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              "|Project name|/|Project number|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sSubtitle",
            "type": "PropString",
            "displayName": "     |Subtitle|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sSeperator03",
            "type": "PropString",
            "displayName": "|Style|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sDimStyleHeader",
            "type": "PropString",
            "displayName": "     |Dimension style header|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "_DimStyles (System list)",
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "sDimStyleContent",
            "type": "PropString",
            "displayName": "     |Dimension style content|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "_DimStyles (System list)",
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "sDimStyleBarCode",
            "type": "PropString",
            "displayName": "     |Dimension style barcodes|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "_DimStyles (System list)",
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColorHeader",
            "type": "PropInt",
            "displayName": "     |Color header|",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColorContent",
            "type": "PropInt",
            "displayName": "     |Color content|",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "nColorTable",
            "type": "PropInt",
            "displayName": "     |Color Table|",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Add elements|",
            "handler": "recalcTriggers[0]",
            "action": "Prompts user to select additional Elements to append to the table.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Remove elements|",
            "handler": "recalcTriggers[1]",
            "action": "Prompts user to select Elements to remove from the table.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9375,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Generates a 2D dimensional schedule table for timber elements, calculating dimensions, surface areas, and barcodes based on user-defined selection and filtering criteria.\",\n    \"category\": \"Reporting / Scheduling\",\n    \"typicalUseCase\": \"Creating a production summary or architectural element list (e.g., a wall schedule) that displays dimensions and areas for manufacturing or quantity takeoff.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sInsertType\",\n      \"technicalDefault\": 3,\n      \"businessMeaning\": \"Defines the scope of elements to include in the table. Options include the entire project, a specific floor, the current active floor, or a manual selection of elements.\",\n      \"validRange\": \"0 (All), 1 (Selected Floor), 2 (Current Floor), 3 (Manual Selection)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Determines which elements are processed and appear in the table rows.\"\n    },\n    {\n      \"name\": \"sNameFloorGroup\",\n      \"technicalDefault\": 0,\n      \"businessMeaning\": \"Selects a specific floor level from the project structure when the selection mode is set to 'Select floor level'.\",\n      \"validRange\": \"List of available Floor Groups in the model\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Filters the table to show only elements belonging to the chosen floor.\"\n    },\n    {\n      \"name\": \"beamCodesToExclude\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Specifies beam types (e.g., 'Stud', 'Plate') to ignore when calculating the element's length and net area. Used to calculate net surface area (e.g., for sheathing) by excluding internal framing members.\",\n      \"validRange\": \"Semicolon-separated string of beam codes\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Reduces the calculated 'Length' and 'Area' values in the table by excluding the specified components from the geometric calculation.\"\n    },\n    {\n      \"name\": \"materialsToExclude\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Excludes specific material grades (e.g., 'C24', 'GL24h') from the element's geometric calculations.\",\n      \"validRange\": \"Semicolon-separated string of material names\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Reduces calculated 'Length' and 'Area' by omitting components made of these materials.\"\n    },\n    {\n      \"name\": \"labelsToExclude\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Excludes elements or components bearing specific user labels from geometric calculations.\",\n      \"validRange\": \"Semicolon-separated string of labels\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Filters out specific components based on assigned labels.\"\n    },\n    {\n      \"name\": \"sPropTitle\",\n      \"technicalDefault\": 0,\n      \"businessMeaning\": \"Selects the format for the main header of the table, typically combining Project Name and Number.\",\n      \"validRange\": \"0 (Project name/number)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Changes the text displayed at the top of the table.\"\n    },\n    {\n      \"name\": \"sSubtitle\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Allows custom text input for a secondary header (e.g., specific building wing, or phase name).\",\n      \"validRange\": \"Any alphanumeric string\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Adds a text line below the main title.\"\n    },\n    {\n      \"name\": \"sDimStyleHeader\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Assigns a CAD text style (font, height) to the table column headers.\",\n      \"validRange\": \"Available Text Styles in the drawing\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Alters the appearance and size of the header text.\"\n    },\n    {\n      \"name\": \"sDimStyleContent\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Assigns a CAD text style to the data rows (dimensions, element numbers).\",\n      \"validRange\": \"Available Text Styles in the drawing\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Alters the appearance and size of the data text.\"\n    },\n    {\n      \"name\": \"sDimStyleBarCode\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Assigns the specific font style required to render barcodes correctly.\",\n      \"validRange\": \"Available Text Styles in the drawing (typically a barcode font)\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Ensures barcodes are machine-readable.\"\n    },\n    {\n      \"name\": \"nColorHeader\",\n      \"technicalDefault\": -1,\n      \"businessMeaning\": \"Sets the CAD Color (ByLayer if -1) for the header text and top border lines.\",\n      \"validRange\": \"0-255 (AutoCAD Color Index) or -1 (ByLayer)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Visual styling of the header.\"\n    },\n    {\n      \"name\": \"nColorContent\",\n      \"technicalDefault\": -1,\n      \"businessMeaning\": \"Sets the CAD Color for the data rows.\",\n      \"validRange\": \"0-255 or -1 (ByLayer)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Visual styling of the data.\"\n    },\n    {\n      \"name\": \"nColorTable\",\n      \"technicalDefault\": -1,\n      \"businessMeaning\": \"Sets the CAD Color for the table grid lines.\",\n      \"validRange\": \"0-255 or -1 (ByLayer)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Visual styling of the grid lines.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"sInsertType is set to '1' (Select floor level)\",\n      \"effect\": \"Enables sNameFloorGroup for user input.\",\n      \"cascade\": [\n        \"sNameFloorGroup\"\n      ]\n    },\n    {\n      \"trigger\": \"sInsertType is NOT '1'\",\n      \"effect\": \"Disables sNameFloorGroup (Read Only).\",\n      \"cascade\": [\n        \"sNameFloorGroup\"\n      ]\n    },\n    {\n      \"trigger"
      },
      "tokens_used": 11392,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launch: Initialize properties and check for Catalog presets.",
          "2. Show Properties Dialog (unless using a catalog preset).",
          "3. Determine Selection Mode (Project, Floor List, Current Floor, or Manual).",
          "4. Collect Elements based on Selection Mode.",
          "5. Prompt user for table insertion point (getPoint).",
          "6. Process Elements:",
          "   - Sort by Element Number.",
          "   - Apply GenBeam exclusion filters (if configured) using 'HSB_G-FilterGenBeams'.",
          "   - Calculate Dimensions (Width, Height) and Measures (Length, Area).",
          "7. Calculate Table Geometry (Column widths based on text styles).",
          "8. Draw Table (Title, Subtitle, Headers, Data Rows, Total Row)."
        ],
        "conditionalBranches": [
          {
            "condition": "Selection Mode (sInsertType)",
            "path1": {
              "name": "0 - Entire Project",
              "steps": [
                "Collects all Elements from ModelSpace via an empty Group."
              ]
            },
            "path2": {
              "name": "1 - Floor List",
              "steps": [
                "Enables 'Floorgroup' property.",
                "Collects Elements from the specific Group selected in 'Floorgroup' dropdown."
              ]
            },
            "path3": {
              "name": "2 - Current Floor",
              "steps": [
                "Disables 'Floorgroup' property.",
                "Collects Elements from '_kCurrentGroup'."
              ]
            },
            "path4": {
              "name": "3 - Manual Selection",
              "steps": [
                "Disables 'Floorgroup' property.",
                "Adds 'Add/Remove elements' context menu triggers.",
                "Prompts user to select Elements via command line."
              ]
            }
          },
          {
            "condition": "Filters Active (Codes/Materials/Labels defined)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Call 'HSB_G-FilterGenBeams'.",
                "Recalculate Length/Area excluding filtered components."
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Use standard Element geometry for calculations."
              ]
            }
          },
          {
            "condition": "Area Calculation (profBrutto)",
            "path1": {
              "name": "Valid profBrutto (> 0)",
              "steps": [
                "Use profBrutto area directly."
              ]
            },
            "path2": {
              "name": "Invalid profBrutto",
              "steps": [
                "Calculate area via PlaneProfile union of all component Beams in the element."
              ]
            }
          },
          {
            "condition": "Context Menu Trigger (Insert Type 3 only)",
            "path1": {
              "name": "Add elements",
              "steps": [
                "Prompt user to select Elements.",
                "Append new Elements to the table list.",
                "Regenerate table."
              ]
            },
            "path2": {
              "name": "Remove elements",
              "steps": [
                "Prompt user to select Elements.",
                "Remove selected Elements from the table list.",
                "Regenerate table."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Dependency 'HSB_G-FilterGenBeams'",
            "errorMessage": "|Beams could not be filtered|! ... |Make sure that the tsl| HSB_G-FilterGenBeams |is loaded in the drawing|.",
            "recovery": "Ensure the required TSL script is loaded in the drawing or clear the exclusion filter properties."
          },
          {
            "check": "Insert Cycle",
            "errorMessage": "(None - Silent failure/erase)",
            "recovery": "N/A - Script prevents re-execution within the same insert cycle."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Add/Remove Elements",
            "how": "Right-click Context Menu (Only if Selection Mode = Manual)",
            "effect": "Modifies the list of elements included in the report and redraws the table."
          },
          {
            "action": "Change Properties",
            "how": "Properties Palette (OPM)",
            "effect": "Changing filters, styles, or colors triggers a recalculation and redraw of the table content and styling."
          },
          {
            "action": "Move Table",
            "how": "Grip Edit / AutoCAD Move",
            "effect": "Relocates the entire table based on the insertion point."
          }
        ]
      },
      "tokens_used": 11087,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-ElementTable.mcr\n\n## Overview\nThis script generates a dimensional schedule (element table) for timber construction elements directly in the model. It calculates and displays dimensions, surface areas, and barcodes based on the selected elements, with options to exclude specific materials or beam types (like studs) from area calculations.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required to source elements from the project. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: Elements (Walls/Floors) or GenBeams must exist in the drawing.\n- **Minimum Beam Count**: 0.\n- **Required Scripts**: The script `HSB_G-FilterGenBeams` must be loaded in the drawing to use exclusion filters.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_E-ElementTable.mcr`\n\n### Step 2: Configure Selection\nAfter launching, the Properties Palette will appear. Set the **Selection mode** (`sInsertType`) to determine how the script gathers elements:\n- **Select entire project**: Automatically grabs all elements.\n- **Select floor level in floor level list**: Enables the **Floorgroup** dropdown to pick a specific level.\n- **Select current floor level**: Uses the active working layer/group.\n- **Select elements in drawing**: Prompts you to manually pick elements on screen.\n\n### Step 3: Configure Filters (Optional)\nIf you need to calculate net surface areas (e.g., for sheathing), enter the beam codes or materials to exclude in the **Beam codes to exclude** or **Materials to exclude** fields.\n\n### Step 4: Place Table\n- If you selected **\"Select elements in drawing\"**, the command line will prompt: `Select one or more elements`. Select your objects and press Enter.\n- For other modes, or after selection, the command line will prompt: `Select a position for the table`. Click in the Model Space to place the table.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Selection mode** | dropdown | 3 | Choose how to select elements: Entire Project, Floor List, Current Floor, or Manual Selection. |\n| **Floorgroup** | dropdown | 0 | Select a specific floor level. Only active if \"Selection mode\" is set to \"Select floor level in floor level list\". |\n| **Beam codes to exclude** | text | | Enter beam codes (e.g., \"Stud;Plate\") to remove from geometric/area calculations. |\n| **Materials to exclude** | text | | Enter material names (e.g., \"C24\") to exclude from calculations. |\n| **Labels to exclude** | text | | Enter labels to exclude specific components from calculations. |\n| **Title** | dropdown | 0 | Choose the format for the main table header (e.g., Project Name/Number). |\n| **Subtitle** | text | | Enter custom text for a secondary header line. |\n| **Dimension style header** | dropdown | | Select the text style (font/height) for the table headers. |\n| **Dimension style content** | dropdown | | Select the text style for the data rows. |\n| **Dimension style barcodes** | dropdown | | Select the specific font style required to generate readable barcodes. |\n| **Color header** | number | -1 | Set the color for the header text (-1 for ByLayer). |\n| **Color content** | number | -1 | Set the color for the data text (-1 for ByLayer). |\n| **Color Table** | number | -1 | Set the color for the table grid lines (-1 for ByLayer). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Add elements** | Prompts you to select additional elements to append to the existing table. (Only available in Manual Selection mode). |\n| **Remove elements** | Prompts you to select elements currently in the table to remove them. (Only available in Manual Selection mode). |\n\n## Settings Files\n- **Dependency**: `HSB_G-FilterGenBeams.mcr`\n- **Purpose**: This script is required to filter out specific beam codes or materials during the calculation process.\n\n## Tips\n- **Net Area Calculation**: To calculate the area of sheathing/boarding only, exclude the internal framing codes (like studs) in the **Beam codes to exclude** property.\n- **Sorting**: Elements are automatically sorted by their Element Number in the table.\n- **Updating**: Changes to filters or styles in the Properties Palette will automatically regenerate the table.\n\n## FAQ\n- **Q: Why is the \"Floorgroup\" dropdown greyed out?**\n  A: You must change the **Selection mode** to \"Select floor level in floor level list\" to enable this option.\n- **Q: I see an error about \"HSB_G-FilterGenBeams\".**\n  A: Ensure the script `HSB_G-FilterGenBeams.mcr` is loaded into your drawing (using `TSLLOAD`) or clear the text in the exclusion filter fields.\n- **Q: How do I add more elements to an existing table later?**\n  A: Select the table, right-click, and choose **Add elements**. Note: This only works if the table was created using \"Select elements in drawing\" mode."
      },
      "tokens_used": 7574,
      "error": null
    }
  }
}