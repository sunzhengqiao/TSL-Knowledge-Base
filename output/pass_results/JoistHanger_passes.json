{
  "filename": "JoistHanger.mcr",
  "status": "completed",
  "total_tokens": 52263,
  "processing_time": 285.0320403575897,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "Inserted by user in Model Space, will sort through selection sets of Joists & carrying beams",
        "versionHistory": [
          {
            "version": "0.0",
            "date": "25JULY2007",
            "author": "Craig Colomb",
            "changes": ""
          },
          {
            "version": "4.0",
            "date": "30April2013",
            "author": "",
            "changes": "Customized for RMLH"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "HangerList.mcr"
        ]
      },
      "tokens_used": 9192,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity prompts for Beams (ssEJ, ssEH) which implies Model Space selection. No sd_* prefix or _Viewport usage found. Documentation explicitly states 'Inserted by user in Model Space'. Script creates Beam entities (bmL, bmR) and geometric bodies (bdHanger). dxaout usage and TSL BOM mapping indicate 3D model processing."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Beam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space with user-selected Joists and Carrying Beams",
          "requiredSettings": [
            "HangerList.mcr",
            "MapObject 'Hangers' (Manufacturer dictionary)"
          ]
        }
      },
      "tokens_used": 6086,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select Joists, all must be parallel",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select Carrying Beams",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 11,
            "variable": "psManufacturer",
            "type": "PropString",
            "displayName": "Manufacturer",
            "defaultValue": "Simpson",
            "inputType": "dropdown",
            "options": [
              "Simpson",
              "USP"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "psRunMode",
            "type": "PropString",
            "displayName": "Execution Mode",
            "defaultValue": "Standard",
            "inputType": "dropdown",
            "options": [
              "Standard",
              "Manual"
            ],
            "category": null,
            "description": "\"Execution mode\" controls whether hanger models are selected by joist type, or simple geometry."
          },
          {
            "index": 6,
            "variable": "pdNum",
            "type": "PropDouble",
            "displayName": "Posnum",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "psNotes",
            "type": "PropString",
            "displayName": "General notes",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "psWeb",
            "type": "PropString",
            "displayName": "Web Stiffener",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "\"Web Stiffener\" & \"Backer Block\" turn these accessories on and off."
          },
          {
            "index": 10,
            "variable": "psBacker",
            "type": "PropString",
            "displayName": "Backer Block",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": [
              "None",
              "Single",
              "Double"
            ],
            "category": null,
            "description": "\"Web Stiffener\" & \"Backer Block\" turn these accessories on and off."
          },
          {
            "index": 0,
            "variable": "piColor",
            "type": "PropInt",
            "displayName": "Hanger Color",
            "defaultValue": 6,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Update Hanger List",
            "handler": "Update Hanger List",
            "action": "Runs the associated HangerList.mcr and updates the local store of hanger models",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7883,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automates the insertion of proprietary joist hangers (Simpson/USP) at T-connections, selecting the correct model based on joist geometry and profiles, and optionally adding web stiffeners.\",\n    \"category\": \"Hardware / Connection\",\n    \"typicalUseCase\": \"Used during the detailing phase to apply engineered metal connectors to floor or roof systems, ensuring the hanger matches the specific joist type (e.g., I-joist) and spacing requirements.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"psManufacturer\",\n      \"technicalDefault\": \"Simpson\",\n      \"businessMeaning\": \"Selects the brand of hardware to utilize, which determines the specific catalog of hanger models available for selection.\",\n      \"validRange\": \"Simpson, USP\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Changes the MapObject lookup source, resulting in different 3D geometry and nailing patterns (e.g., swapping a Simpson H2.5A for a USP equivalent).\"\n    },\n    {\n      \"name\": \"psRunMode\",\n      \"technicalDefault\": \"Standard\",\n      \"businessMeaning\": \"Determines the logic used to select the hanger size. 'Standard' attempts to match based on the beam's profile name (e.g., TJI, BCI), while 'Manual' relies on geometric dimensions or user selection.\",\n      \"validRange\": \"Standard, Manual\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Alters the filtering algorithm in the Hanger Library map to either search by Profile Name or geometric dimensions.\"\n    },\n    {\n      \"name\": \"psWeb\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Toggles the inclusion of web stiffeners (blocking) within the joist web, required for certain hanger installations on I-joists to prevent web crushing.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"If 'Yes', generates two solid wood beams (bmFillL, bmFillR) inside the joist web; if 'No', these beams are erased.\"\n    },\n    {\n      \"name\": \"psBacker\",\n      \"technicalDefault\": \"None\",\n      \"businessMeaning\": \"Specifies the quantity of backer blocks (nailing plates) attached to the carrying beam behind the hanger to provide additional nailing surface.\",\n      \"validRange\": \"None, Single, Double\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Logic is present in code but commented out in this version. Intended to create or erase backer block beams based on the selection.\"\n    },\n    {\n      \"name\": \"psNotes\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"User-defined text field for adding specific installation notes, special instructions, or tagging relevant to this specific instance.\",\n      \"validRange\": \"Text string\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Updates the instance compare key (triggering a recalculation if changed) and stores data in the Map for potential labeling or BOM export.\"\n    },\n    {\n      \"name\": \"piColor\",\n      \"technicalDefault\": \"6\",\n      \"businessMeaning\": \"Controls the visual display color of the hanger in the CAD model, often used to distinguish different types of hardware or stages of design.\",\n      \"validRange\": \"0-256 (AutoCAD Color Index)\",\n      \"unit\": \"count\",\n      \"affectsOutput\": \"Changes the color attribute of the generated Body (bdHanger).\"\n    },\n    {\n      \"name\": \"pdNum\",\n      \"technicalDefault\": \"-1\",\n      \"businessMeaning\": \"The Position Number (or Mark Number) assigned to this specific hanger instance for fabrication tracking.\",\n      \"validRange\": \"Integer (>0)\",\n      \"unit\": \"count\",\n      \"affectsOutput\": \"Read-only display of the instance's assigned position number; primarily for documentation purposes.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"psManufacturer is changed\",\n      \"effect\": \"Reloads the MapObject 'Hangers' with the new manufacturer's data and re-evaluates the hanger model selection.\",\n      \"cascade\": [\n        \"stModel\",\n        \"psJoistNails\",\n        \"psFaceNails\"\n      ]\n    },\n    {\n      \"trigger\": \"psWeb is set to 'No'\",\n      \"effect\": \"Deletes any existing web stiffener beams associated with this instance.\",\n      \"cascade\": [\n        \"bmFillL\",\n        \"bmFillR\"\n      ]\n    },\n    {\n      \"trigger\": \"psWeb is set to 'Yes'\",\n      \"effect\": \"Generates new web stiffener beams if they do not exist.\",\n      \"cascade\": [\n        \"bmFillL\",\n        \"bmFillR\"\n      ]\n    }\n  ],\n  \"outputEntities\": [\n    {\n      \"type\": \"Body (MetalPart)\",\n      \"description\": \"3D representation of the joist hanger connector (e.g., Simpson face-mount hanger).\",\n      \"appliedTo\": \"At the intersection of the Joist and Carrying Beam.\"\n    },\n    {\n      \"type\": \"Beam (Web Stiffener)\",\n      \"description\": \"Solid wood blocking placed inside the joist web to reinforce the connection.\",\n      \"appliedTo\": \"Inside the Joist beam (Left and Right sides of the web"
      },
      "tokens_used": 10773,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Initialization & Map Check\",\n    \"2. [Conditional] Verify MapObject 'Hangers' validity\",\n    \"3. [Conditional] If Map invalid or 'Update Hanger List' triggered, execute HangerList.mcr\",\n    \"4. [Insertion Phase] Prompt user to select Joist Beams (ssEJ)\",\n    \"5. [Insertion Phase] Prompt user to select Carrying/Header Beams (ssEH)\",\n    \"6. [Insertion Phase] Sort selected Joists perpendicular to vector and group 'Sister' joists (doubles/triples)\",\n    \"7. [Insertion Phase] Iterate through Joists and Headers to find valid T-connections\",\n    \"8. [Insertion Phase] For each connection, spawn a child script instance (tslSlave) passing the specific beams\",\n    \"9. [Insertion Phase] Master script instance self-erases (cleanup)\",\n    \"10. [Execution Phase - Child Instance] Validate attached beams (Minimum 2 required)\",\n    \"11. [Execution Phase] Calculate intersection geometry and connection angles (Square, Angled, Sloped)\",\n    \"12. [Execution Phase] Determine Joist Profile (I-Joist vs Solid) and Execution Mode\",\n    \"13. [Execution Phase] Select appropriate Hanger Model from Map based on dimensions/profile\",\n    \"14. [Execution Phase] Generate 3D Hanger Body\",\n    \"15. [Execution Phase] [Conditional] Create or Update Web Stiffeners based on 'psWeb' property\",\n    \"16. [Execution Phase] Export data (BOM, Model, Notes) to Map and DXA\",\n    \"17. [Execution Phase] Set Instance Compare Key for change detection\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"MapObject 'Hangers' Validity\",\n      \"path1\": {\n        \"name\": \"Map Valid\",\n        \"steps\": [\n          \"Load map into mpHangerLibrary variable\",\n          \"Proceed to Insertion/Execution\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Map Invalid\",\n        \"steps\": [\n          \"Run HangerList.mcr to generate store\",\n          \"Verify store created\",\n          \"If failed, Report Error and Erase Instance\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Context Menu 'Update Hanger List'\",\n      \"path1\": {\n        \"name\": \"Triggered\",\n        \"steps\": [\n          \"Execute HangerList.mcr\",\n          \"Reload mpHangerLibrary\",\n          \"Report success/fail\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Not Triggered\",\n        \"steps\": [\n          \"Use existing mpHangerLibrary\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Web Stiffener Property (psWeb)\",\n      \"path1\": {\n        \"name\": \"Yes\",\n        \"steps\": [\n          \"Check Map for existing stiffener beams (bmFillL, bmFillR)\",\n          \"Calculate insertion points within Joist web\",\n          \"Create Beams if new, or Reposition/Trim if existing\",\n          \"Add Cutting tools to stiffener beams\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No\",\n        \"steps\": [\n          \"Retrieve stiffener beams from Map\",\n          \"Erase beams from Database\",\n          \"Remove entries from Map\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Execution Mode (psRunMode)\",\n      \"path1\": {\n        \"name\": \"Standard\",\n        \"steps\": [\n          \"Filter Hangers by Joist Profile Name (e.g., TJI, BCI)\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Manual\",\n        \"steps\": [\n          \"Filter Hangers by geometric dimensions\",\n          \"Triggered automatically if multiple joist profiles are selected\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"MapObject 'Hangers' exists and contains data\",\n      \"errorMessage\": \"Failed to retrieve hanger data, please consult CAD manager. JoistHanger script cannot continue and is self-destructing.\",\n      \"recovery\": \"Ensure HangerList.mcr has been run successfully or consult CAD Manager.\"\n    },\n    {\n      \"check\": \"GenBeam count attached to instance\",\n"
      },
      "tokens_used": 12083,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# JoistHanger.mcr\n\n## Overview\nAutomates the insertion of proprietary joist hangers (Simpson/USP) at T-connections between joists and carrying beams. It selects the correct model based on joist geometry and profiles, and optionally adds web stiffeners.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be inserted in Model Space to interact with 3D beams. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | This is a model detailing script. |\n\n## Prerequisites\n- **Required Entities:** GenBeams representing Joists and Carrying/Header Beams.\n- **Minimum Beam Count:** 2 (at least one joist and one carrying beam).\n- **Required Settings:** A valid MapObject named 'Hangers' (generated by the dependency script `HangerList.mcr`).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `JoistHanger.mcr`\n\n### Step 2: Select Joists\n```\nCommand Line: Select Joists, all must be parallel\nAction: Select all joist beams that need hangers. Ensure they are parallel to each other.\n```\n\n### Step 3: Select Carrying Beams\n```\nCommand Line: Select Carrying Beams\nAction: Select the carrying or header beams that support the joists.\n```\n\n### Step 4: Automatic Processing\nThe script will automatically find the T-connections between the selected sets, spawn a hanger instance at each location, and then erase the master script instance.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Manufacturer | dropdown | Simpson | Selects the hardware brand (Simpson or USP). This determines the catalog of available hangers. |\n| Execution Mode | dropdown | Standard | Determines selection logic. 'Standard' uses beam profile names; 'Manual' uses geometric dimensions. |\n| Web Stiffener | dropdown | No | Adds solid wood blocking inside the joist web to reinforce the connection. |\n| Backer Block | dropdown | None | Specifies the quantity of backer blocks behind the hanger. (Note: Logic may be disabled in current version). |\n| Hanger Color | number | 6 | Sets the AutoCAD color index for the hanger body. |\n| General notes | text | | User-defined text for specific installation notes or tagging. |\n| Posnum | number | -1 | The Position Number (Mark Number) assigned to this specific hanger instance for fabrication tracking. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Update Hanger List | Runs the associated HangerList.mcr script to refresh the local library of available hanger models and manufacturers. |\n\n## Settings Files\n- **File Dependency**: `HangerList.mcr`\n- **MapObject**: `Hangers`\n- **Purpose**: Generates and stores the dictionary of hanger models (geometry and nailing patterns) used by the script. Ensure this is run via the right-click menu if hangers are missing.\n\n## Tips\n- Ensure all joists selected in Step 2 are parallel; otherwise, the script may not calculate intersections correctly.\n- If the script \"self-destructs\" (disappears) immediately after insertion, this is normal behavior. The master script spawns individual hangers at the connection points and removes itself.\n- If you see an error regarding \"Failed to retrieve hanger data,\" use the right-click menu option **Update Hanger List** to rebuild the manufacturer database.\n\n## FAQ\n- **Q: Why did the script disappear after I selected the beams?**\n  A: The script functions as a \"batch inserter.\" It calculates the connections, creates the individual hanger objects, and then erases the master script instance to clean up the drawing.\n- **Q: How do I switch between Simpson and USP hangers?**\n  A: Select a hanger instance in the model, open the Properties Palette (Ctrl+1), and change the **Manufacturer** property.\n- **Q: What happens if I change the \"Execution Mode\"?**\n  A: \"Standard\" tries to match hangers based on the beam's profile name (e.g., TJI). \"Manual\" searches based purely on the height and width of the beam, which is useful for custom or unknown profiles."
      },
      "tokens_used": 6246,
      "error": null
    }
  }
}