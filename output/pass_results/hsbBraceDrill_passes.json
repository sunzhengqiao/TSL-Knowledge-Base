{
  "filename": "hsbBraceDrill.mcr",
  "status": "completed",
  "total_tokens": 48452,
  "processing_time": 197.47829818725586,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "Creates brace drills on beams of type brace and every connected beams (1 instance per pair of beams)",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "10jan2019",
            "author": "david.rueda@hsbcad.com",
            "changes": "initial"
          },
          {
            "version": "1.01",
            "date": "28jan2019",
            "author": "david.rueda@hsbcad.com",
            "changes": "Search for female beams improved and drill alignment (to male or female center) added so user can use a simple brace representation instead a real beam"
          },
          {
            "version": "1.02",
            "date": "29jan2019",
            "author": "david.rueda@hsbcad.com",
            "changes": "Added end cut to brace"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8036,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of '_kModelSpace' in dbCreate function; performs 3D solid modifications (Drill, Cut) via addTool methods on Beam objects; no ShopDrawing specific identifiers (sd_ prefix, #Type E, or _Viewport) found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Beam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 6543,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity.go (Beam)",
              "promptOriginal": "|Select construction|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "_bOnInsert (Default execution)",
            "title": null,
            "dataSource": "TSL script properties (PropDouble/PropString)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dDiameter",
            "type": "PropDouble",
            "displayName": "|Diameter|",
            "defaultValue": "12",
            "inputType": "number",
            "options": [],
            "category": "|Main drill|",
            "description": "|Defines the diameter of the main drill|"
          },
          {
            "index": 1,
            "variable": "dDiameterSinkhole",
            "type": "PropDouble",
            "displayName": "|Diameter|",
            "defaultValue": "50",
            "inputType": "number",
            "options": [],
            "category": "|Sinkhole|",
            "description": "|Defines the diameter of the sinkhole|"
          },
          {
            "index": 2,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "|Depth|",
            "defaultValue": "15",
            "inputType": "number",
            "options": [],
            "category": "|Sinkhole|",
            "description": "|Defines the sinkhole depth on receiving beam|"
          },
          {
            "index": 3,
            "variable": "dDepthBrace",
            "type": "PropDouble",
            "displayName": "|Depth on brace|",
            "defaultValue": "15",
            "inputType": "number",
            "options": [],
            "category": "|Sinkhole|",
            "description": "|Defines the sinkhole depth on the brace|"
          },
          {
            "index": 0,
            "variable": "sDrillAlignment",
            "type": "PropString",
            "displayName": "|Drill alignment|",
            "defaultValue": "|To brace center|",
            "inputType": "dropdown",
            "options": [
              "|To brace center|",
              "|To female center|"
            ],
            "category": "|Offsets|",
            "description": "|Defines if drill will be aligned to the brace or the female beam center|"
          },
          {
            "index": 4,
            "variable": "dOffsetLateral",
            "type": "PropDouble",
            "displayName": "|Lateral|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Offsets|",
            "description": "|Defines the lateral offset|"
          },
          {
            "index": 5,
            "variable": "dOffsetDepth",
            "type": "PropDouble",
            "displayName": "|Normal|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Offsets|",
            "description": "|Defines the offset on direction normal to the connection|"
          },
          {
            "index": 1,
            "variable": "sMaker",
            "type": "PropString",
            "displayName": "|Maker|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Hardware info|",
            "description": "|Defines the maker|"
          },
          {
            "index": 2,
            "variable": "sProductName",
            "type": "PropString",
            "displayName": "|Product name|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Hardware info|",
            "description": "|Defines the product name|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "TslDoubleClick",
            "handler": "sDoubleClick",
            "action": "Erases the TSL instance",
            "alsoTriggeredBy": "Double Click"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7454,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of bolted connections for diagonal braces, including through-holes, counterbores (sinkholes) on both the brace and the main beam, and an automatic end cut on the brace.",
          "category": "Hardware",
          "typicalUseCase": "Used when connecting diagonal timber braces to columns or beams using through-bolts with washers/nuts that need to be recessed (counterbored)."
        },
        "parameters": [
          {
            "name": "dDiameter",
            "technicalDefault": "12",
            "businessMeaning": "The diameter of the main through-hole (bolt size) drilled through both the brace and the receiving beam.",
            "validRange": "8 - 30 (Standard bolt sizes: M10, M12, M16, M20, M24)",
            "unit": "mm",
            "affectsOutput": "Changes the size of the cylindrical drill passing through the connected beams."
          },
          {
            "name": "dDiameterSinkhole",
            "technicalDefault": "50",
            "businessMeaning": "The diameter of the counterbore (sinkhole) intended to hide the washer and nut head.",
            "validRange": "25 - 80 (Must be larger than main drill diameter)",
            "unit": "mm",
            "affectsOutput": "Changes the diameter of the wider, shallow hole at the start and end of the drill path."
          },
          {
            "name": "dDepth",
            "technicalDefault": "15",
            "businessMeaning": "The depth of the counterbore on the receiving (female) beam to accommodate the washer/nut assembly.",
            "validRange": "5 - 40",
            "unit": "mm",
            "affectsOutput": "Determines how deep the counterbore is drilled into the receiving beam."
          },
          {
            "name": "dDepthBrace",
            "technicalDefault": "15",
            "businessMeaning": "The depth of the counterbore on the brace beam to accommodate the washer/head on the brace side.",
            "validRange": "5 - 40",
            "unit": "mm",
            "affectsOutput": "Determines how deep the counterbore is drilled into the brace."
          },
          {
            "name": "sDrillAlignment",
            "technicalDefault": "|To brace center|",
            "businessMeaning": "Determines the geometric reference for the drill centerline. 'To brace center' aligns the hole with the brace's axis. 'To female center' aligns the hole with the receiving beam's axis.",
            "validRange": "Enumerated List",
            "unit": "N/A",
            "affectsOutput": "Shifts the position of the drill hole laterally to ensure the bolt passes through the center of the intended reference beam (useful if the brace is wider than the beam)."
          },
          {
            "name": "dOffsetLateral",
            "technicalDefault": "0",
            "businessMeaning": "A manual lateral shift of the drill hole along the local X-axis relative to the calculated insertion point.",
            "validRange": "-100 - 100",
            "unit": "mm",
            "affectsOutput": "Slides the drill hole left or right from the standard alignment."
          },
          {
            "name": "dOffsetDepth",
            "technicalDefault": "0",
            "businessMeaning": "A manual offset of the drill hole in the direction normal to the connection surface (local Y-axis).",
            "validRange": "-100 - 100",
            "unit": "mm",
            "affectsOutput": "Slides the drill hole deeper or shallower relative to the surface."
          },
          {
            "name": "sMaker",
            "technicalDefault": "",
            "businessMeaning": "The name of the hardware manufacturer (e.g., Simpson, Hilti)",
            "validRange": "String",
            "unit": "Text",
            "affectsOutput": "Updates the Manufacturer field in the BOM/Hardware list."
          },
          {
            "name": "sProductName",
            "technicalDefault": "",
            "businessMeaning": "The specific commercial name or code of the hardware product (e.g., 'M12 Bolt Kit')",
            "validRange": "String",
            "unit": "Text",
            "affectsOutput": "Updates the Product Name in the BOM/Hardware list and serves as the identifier if Maker is empty."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dDiameter changes",
            "effect": "Ideally, dDiameterSinkhole should be updated to be larger than the new bolt size to ensure clearance for washers.",
            "cascade": [
              "dDiameterSinkhole"
            ]
          },
          {
            "trigger": "sProductName and sMaker",
            "effect": "Combined to generate the Hardware Article Number in the BOM (Format: 'Maker - ProductName').",
            "cascade": [
              "HardWrComp ArticleNumber"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Drill",
            "description": "Main through-hole passing through both the brace and the receiving beam.",
            "appliedTo": "Brace Beam, Female Beam"
          },
          {
            "type": "Drill (Counterbore)",
            "description": "A wider, shallower hole on the face of the female beam to recess the nut/washer.",
            "appliedTo": "Female Beam"
          },
          {
            "type": "Drill (Counterbore)",
            "description": "A wider, shallower hole on the face of the brace beam to recess the bolt head/washer.",
            "appliedTo": "Brace Beam"
          },
          {
            "type": "Cut",
            "description": "An end cut on the brace perpendicular to the female beam, ensuring a tight butt joint connection.",
            "appliedTo": "Brace Beam"
          },
          {
            "type": "HardWrComp",
            "description": "A logical hardware component added to the BOM (Bill of Materials) representing the bolt assembly.",
            "appliedTo": "Brace Beam (Logical attachment)"
          }
        ]
      },
      "tokens_used": 9548,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch / Initialization",
          "Check execution context (Insert vs Recalc)",
          "IF Insert Mode:",
          "  Prompt user to select construction (Beams)",
          "  IF no beams selected: Erase instance and Exit",
          "  Set internal Map flag 'Distribution Mode' to 1",
          "  Return (triggers Recalc)",
          "IF Recalc Mode ('Distribution Mode' = 1):",
          "  Sort selected beams into 'Braces' and 'Others' (Non-braces)",
          "  IF list is empty: Erase instance and Exit",
          "  Iterate through all Braces to find intersecting connections with 'Others'",
          "  FOR EACH Brace-Female pair found:",
          "    Create a new TSL Instance via dbClone (Connection Mode)",
          "  Report number of braces and drills created",
          "  Erase the 'Master' distributing instance",
          "IF Recalc Mode ('Distribution Mode' = 0 / Connection Mode):",
          "  Validate inputs (Must be exactly 2 beams: _Beam[0] Brace, _Beam[1] Female)",
          "  IF invalid: Erase instance and Exit",
          "  Clean up duplicate TSL instances on the same brace",
          "  Calculate Drill Geometry based on 'Drill Alignment' and Offsets",
          "  Create Main Drill (Through Hole)",
          "  Create Sinkhole on Female Beam (Counterbore)",
          "  Create Sinkhole on Brace Beam (Counterbore)",
          "  Create End Cut on Brace (Perpendicular to Female)",
          "  Create Hardware Component (BOM Entry)",
          "  Draw visual representation of the drill axis"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Input (Beam Selection)",
            "path1": {
              "name": "Valid Selection",
              "steps": [
                "User selects beams",
                "Script enters 'Distribution Mode'",
                "Script sorts and connects beams automatically"
              ]
            },
            "path2": {
              "name": "Empty Selection / Cancel",
              "steps": [
                "User cancels or selects nothing",
                "Script detects 0 beams",
                "eraseInstance() is called",
                "Script terminates"
              ]
            }
          },
          {
            "condition": "Execution Loop in Distribution Mode",
            "path1": {
              "name": "Production Run (bDebug == false)",
              "steps": [
                "Identify Brace-Female pairs",
                "Execute dbCreate to spawn child TSLs",
                "Erase master instance"
              ]
            },
            "path2": {
              "name": "Debug Run (bDebug == true)",
              "steps": [
                "Identify Brace-Female pairs",
                "Visualize connected beams and text",
                "Do NOT create TSLs",
                "Keep master instance for inspection"
              ]
            }
          },
          {
            "condition": "Drill Alignment Property",
            "path1": {
              "name": "To brace center",
              "steps": [
                "Reference point = bmBrace.ptCenSolid()",
                "Drill axis aligns with Brace centerline"
              ]
            },
            "path2": {
              "name": "To female center",
              "steps": [
                "Reference point = bmFemale.ptCenSolid()",
                "Drill axis aligns with Female beam centerline"
              ]
            }
          },
          {
            "condition": "Hardware Naming",
            "path1": {
              "name": "Maker and Product defined",
              "steps": [
                "Article Number = 'Maker - ProductName'"
              ]
            },
            "path2": {
              "name": "Only Product defined",
              "steps": [
                "Article Number = 'ProductName'"
              ]
            },
            "path3": {
              "name": "None defined",
              "steps": [
                "Article Number = 'ScriptName'"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam count in Connection Mode",
            "errorMessage": "Script Name - Error: not valid beam of type brace found",
            "recovery": "Script erases itself. User must ensure 2 beams are linked: 1 Brace and 1 connected beam."
          },
          {
            "check": "Existence of Female Beam",
            "errorMessage": "(Internal) No drill created",
            "recovery": "If a brace has no intersecting beams in 'Others' list, no drill is generated for that brace."
          },
          {
            "check": "Beam Type assignment",
            "errorMessage": "Script Name - Error: not valid beam of type brace found",
            "recovery": "Ensure _Beam[0] is the brace (Type 8) and _Beam[1] is the receiving beam."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions",
            "how": "OPM (Object Properties Palette)",
            "effect": "Updates drill diameter, sinkhole size, and depths immediately upon recalculation."
          },
          {
            "action": "Adjust Geometry Position",
            "how": "OPM (Offset Lateral, Offset Normal)",
            "effect": "Shifts the drill centerline relative to the calculated intersection."
          },
          {
            "action": "Change Alignment Reference",
            "how": "OPM (Drill Alignment dropdown)",
            "effect": "Toggles the drill center between the Brace center and the Female beam center."
          },
          {
            "action": "Update Hardware Info",
            "how": "OPM (Maker, Product Name)",
            "effect": "Updates the BOM entry and article number associated with the connection."
          },
          {
            "action": "Delete Connection",
            "how": "Double Click (TslDoubleClick) or Context Menu",
            "effect": "Erases the specific TSL instance removing drills and hardware, but does not delete the beams."
          }
        ]
      },
      "tokens_used": 9960,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbBraceDrill.mcr\n\n## Overview\nThis script automates the creation of bolted connections for diagonal braces. It creates through-holes and counterbores (sinkholes) on both the brace and the receiving beam, and automatically applies an end cut to the brace to ensure a tight fit.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for generating 3D geometry and modifications. |\n| Paper Space | No | Not designed for 2D layouts. |\n| Shop Drawing | No | Not a shop drawing annotation script. |\n\n## Prerequisites\n- **Required Entities**: GenBeam or Beam elements.\n- **Minimum Beam Count**: 2 (One brace and one connected beam/column).\n- **Required Settings Files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbBraceDrill.mcr` from the list.\n\n### Step 2: Select Beams\n```\nCommand Line: |Select construction|\nAction: Select the diagonal brace and the beam(s) or column(s) it connects to. Press Enter to confirm.\n```\n*Note: The script will automatically detect which beams are braces (Type 8) and which are receiving beams.*\n\n### Step 3: Configure Properties\nAfter insertion, select the newly created connection instance and adjust the drill dimensions (diameter, depth, offsets) in the Properties Palette (OPM) if the default values do not match your requirements.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Diameter** | Number | 12 | The diameter of the main through-hole (bolt size). |\n| **Diameter** (Sinkhole) | Number | 50 | The diameter of the counterbore (sinkhole) for washers/nuts. |\n| **Depth** (Sinkhole) | Number | 15 | The depth of the counterbore on the receiving beam. |\n| **Depth on brace** (Sinkhole) | Number | 15 | The depth of the counterbore on the brace beam. |\n| **Drill alignment** | Dropdown | To brace center | Determines if the hole aligns with the brace center or the receiving (female) beam center. |\n| **Lateral** (Offset) | Number | 0 | Shifts the drill hole laterally relative to the connection point. |\n| **Normal** (Offset) | Number | 0 | Shifts the drill hole in/out relative to the surface. |\n| **Maker** | Text | - | The name of the hardware manufacturer (e.g., Simpson). |\n| **Product name** | Text | - | The specific name or code of the hardware product. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Double Click** | **Deletes** the TSL instance and removes all associated drills and hardware from the beams. |\n\n## Settings Files\n- None.\n\n## Tips\n- **Alignment**: If your brace is wider than the column it connects to, change the **Drill alignment** to \"To female center\" to ensure the bolt passes through the center of the column.\n- **Batch Processing**: You can select multiple braces and their connected beams in one go during Step 2. The script will create a separate connection instance for each valid pair found.\n- **Deletion**: Since double-clicking deletes the connection, be careful not to double-click accidentally. You can also use the `ERASE` command to remove the specific connection instance.\n\n## FAQ\n- **Q: The script disappeared after I ran it. Is that normal?**\n  - **A:** Yes. This is a \"distributor\" script. It processes your selection, creates the individual connection instances on the beams, and then deletes itself to clean up the drawing.\n- **Q: How do I change the bolt size after insertion?**\n  - **A:** Select the connection instance (usually visualized near the intersection), open the Properties Palette (Ctrl+1), and change the **Diameter** value.\n- **Q: What if the hole is in the wrong position?**\n  - **A:** Adjust the **Lateral** or **Normal** offset values in the Properties Palette to fine-tune the position without moving the beams."
      },
      "tokens_used": 6911,
      "error": null
    }
  }
}