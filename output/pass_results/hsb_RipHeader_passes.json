{
  "filename": "hsb_RipHeader.mcr",
  "status": "completed",
  "total_tokens": 38334,
  "processing_time": 298.5126528739929,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "10.02.2011",
            "author": "Chirag Sawjani",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "15.02.2011",
            "author": null,
            "changes": "Remove Packer if it's below the header"
          },
          {
            "version": "1.2",
            "date": "15.02.2011",
            "author": null,
            "changes": "Added property to set minimum depth of header"
          },
          {
            "version": "1.3",
            "date": "16.02.2011",
            "author": null,
            "changes": "Report changed to show the Opening description."
          },
          {
            "version": "1.4",
            "date": "21.05.2012",
            "author": null,
            "changes": "Added SFPacker to packer check."
          },
          {
            "version": "1.5",
            "date": "15.08.2012",
            "author": null,
            "changes": "Add a property for only report a list of the elements where the opening clash with the header and also add beams by code to the rip option."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5650,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity to select Element objects. Retrieves Beams and Openings via el.beam() and el.opening(). Performs geometric modifications on Beam objects using bm.setD() and bm.transformBy(). No usage of ShopDrawing (sd_) functions, _Viewport, or 2D drawing generation."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Beam",
            "Opening"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space containing Wall/Panel Elements with Headers and Openings.",
          "requiredSettings": []
        }
      },
      "tokens_used": 4857,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sYesNoBlocking",
            "type": "PropString",
            "displayName": "Show Report of Ripped Headers",
            "defaultValue": "|Yes|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dMinDepthOfHeader",
            "type": "PropDouble",
            "displayName": "Enter Minimum Depth of Header",
            "defaultValue": 140,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sFilterBeams",
            "type": "PropString",
            "displayName": "|Include Beams with Code|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "|Separate multiple entries by| ;"
          },
          {
            "index": 2,
            "variable": "sOnlyReport",
            "type": "PropString",
            "displayName": "Only Show Report",
            "defaultValue": "|Yes|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": "It will only show the report of the openigns that clash with the header and wont cut the header"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6915,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically detects clashes between wall openings and header beams, resizing (ripping) the headers to fit the opening height and removing conflicting infill packers.",
          "category": "Framing / Wall Automation",
          "typicalUseCase": "Used when generating or editing timber frame walls to ensure headers do not intrude into door or window openings, effectively 'ripping' the bottom of the header off to sit flush with the top of the opening, and cleaning up blocking underneath."
        },
        "parameters": [
          {
            "name": "sYesNoBlocking",
            "technicalDefault": "|Yes|",
            "businessMeaning": "Controls whether the script displays a report in the command line listing specific headers that were successfully modified.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "Does not affect geometry. If 'No', the script runs silently. If 'Yes', it prints dimensions and locations of modified headers."
          },
          {
            "name": "dMinDepthOfHeader",
            "technicalDefault": "140",
            "businessMeaning": "The minimum structural height required for a header beam. If ripping the header to clear the opening would reduce its height below this value, the script aborts the cut for that specific header to prevent structural failure.",
            "validRange": "45 - 300",
            "unit": "mm",
            "affectsOutput": "Acts as a safety constraint. If the calculated rip depth violates this, the header remains unmodified and an error is reported."
          },
          {
            "name": "sFilterBeams",
            "technicalDefault": "",
            "businessMeaning": "Allows the user to define specific beam codes (e.g., 'HDR', 'Lintel') that should be treated as headers by the script, in addition to standard System Header types.",
            "validRange": "Alphanumeric string (e.g., 'HDR;LVL')",
            "unit": "String",
            "affectsOutput": "Expands the scope of which beams are checked and potentially ripped. Only beams matching these codes (or type _kHeader) are processed."
          },
          {
            "name": "sOnlyReport",
            "technicalDefault": "|Yes|",
            "businessMeaning": "Toggles 'Dry Run' mode. If enabled, the script only identifies and reports clashes between openings and headers without modifying any geometry.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "Critical execution switch. If 'Yes', no geometry changes occur (no cuts, no deletions). If 'No', headers are resized and packers are deleted."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sOnlyReport is set to '|No|'",
            "effect": "Activates the geometry modification logic, making 'dMinDepthOfHeader' and 'sFilterBeams' active constraints on the model.",
            "cascade": [
              "dMinDepthOfHeader",
              "sFilterBeams"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Modified Geometry",
            "description": "Header beams are vertically shortened (ripped) to clear the opening profile. The beam body is transformed downwards to align with the new bottom cut.",
            "appliedTo": "Beams of type _kHeader or matching the filter codes, located directly above openings."
          },
          {
            "type": "Deleted Entity",
            "description": "Packer or blocking beams located directly below the ripped header and intersecting the opening profile are removed from the model.",
            "appliedTo": "Beams of type _kBeam or _kSFPacker found underneath the header."
          }
        ]
      },
      "tokens_used": 6710,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script: User executes hsb_RipHeader.mcr.",
          "2. Instance Check: Script verifies if it is the first insert cycle. If not, it erases itself to prevent re-running.",
          "3. Configuration: Dialog is shown (if needed) to set properties like Minimum Depth and Filter Codes.",
          "4. Element Selection: User is prompted to select a set of Elements (Walls/Panels) via command line.",
          "5. Data Parsing: Script converts the 'Include Beams with Code' string property into a usable array of codes.",
          "6. Element Iteration: Script loops through each selected Element.",
          "7. Beam Classification: For each Element, beams are categorized into 'Headers' (System Headers + User Codes) and 'Packers' (Standard Beams + SFPackers).",
          "8. Opening Loop: Script iterates through all Openings found in the current Element.",
          "9. Spatial Check: Calculates a shadow profile for the opening and checks for intersection with Headers located directly above.",
          "10. Clash Detection: Checks the vertical distance between the top of the opening and the bottom of the header.",
          "11. [Conditional] Branch: Script checks the 'Only Show Report' property.",
          "12. [Conditional] Validation: If executing, checks if the new header depth meets the 'Minimum Depth' requirement and if the cut is greater than 0.5mm.",
          "13. Modification Execution: If valid, the Header is resized and moved down; if invalid, an error is reported.",
          "14. Packer Removal: Identifies Packers located below the header and intersecting the opening profile, then erases them.",
          "15. Reporting: Outputs a notice or message to the command line based on the 'Show Report' setting.",
          "16. Cleanup: Script erases its own instance from the model."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "Re-triggered",
              "steps": [
                "Check insertCycleCount() > 1",
                "Erase Instance",
                "Exit"
              ]
            },
            "path2": {
              "name": "First Launch",
              "steps": [
                "Prompt for Element Selection",
                "Proceed to Processing"
              ]
            }
          },
          {
            "condition": "Only Show Report (sOnlyReport)",
            "path1": {
              "name": "Report Only (Yes)",
              "steps": [
                "Detect Clash",
                "Report 'Opening overlapping with header'",
                "Skip Geometry Modification",
                "Skip Packer Deletion"
              ]
            },
            "path2": {
              "name": "Execute (No)",
              "steps": [
                "Detect Clash",
                "Calculate New Depth",
                "Validate New Depth",
                "Modify Header Geometry",
                "Delete Packers",
                "Report Success/Failure"
              ]
            }
          },
          {
            "condition": "Header Rip Validity (During Execute)",
            "path1": {
              "name": "Valid Rip",
              "steps": [
                "Check: (NewDepth >= MinDepth) AND (Cut > 0.5mm)",
                "Set Beam Depth (bm.setD)",
                "Transform Beam Down (bm.transformBy)",
                "Proceed to Packer Check"
              ]
            },
            "path2": {
              "name": "Invalid Rip",
              "steps": [
                "Check Failure Condition",
                "Set Error Flag (nRipHeaderError)",
                "Report Error Message (Min Depth Exceeded OR Already Ripped)",
                "Stop Processing Current Opening Headers"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Contains Beams",
            "errorMessage": "None (Silent skip)",
            "recovery": "Script skips the element if it contains no beams (bmAll.length()<1)."
          },
          {
            "check": "Significant Intersection",
            "errorMessage": "Error in finding distance to underside of header",
            "recovery": "Requires geometric correction of the model. Script fails if the combined header profile area above the opening is less than 1mm²."
          },
          {
            "check": "Header Clash Exists",
            "errorMessage": "None (No action taken)",
            "recovery": "Script only acts if the vertical distance to the header underside is negative (inside the opening)."
          },
          {
            "check": "Minimum Structural Depth",
            "errorMessage": "Header of Wall [WallNum] cannot be ripped. Minimum Depth of [Val]mm exceeded.",
            "recovery": "User must increase the 'Minimum Depth of Header' property or manually adjust the model/header size."
          },
          {
            "check": "Previous Rip Detection",
            "errorMessage": "Header of Wall [WallNum] already ripped to height of opening.",
            "recovery": "Indicates the header is already very close to the opening height (cut amount < 0.5mm). No action taken."
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 8416,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_RipHeader.mcr\n\n## Overview\nThis script automatically detects clashes between wall openings and header beams. It resizes (\"rips\") the headers to fit the height of door or window openings and removes any blocking or packers located below the header that interfere with the opening.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used in 3D model to modify wall/panel framing. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | Does not generate 2D drawings or views. |\n\n## Prerequisites\n- **Required Entities**: Elements (Walls/Panels) containing both Beams and Openings.\n- **Minimum Beam Count**: 0 (Script simply skips elements without beams).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsb_RipHeader.mcr`\n\n### Step 2: Configure Properties (Optional)\nBefore selecting elements, you can adjust the script settings in the **Properties Palette** (Ctrl+1).\n- **Only Show Report**: Set to `|Yes|` for a safe test run, or `|No|` to actually cut the headers.\n- **Enter Minimum Depth of Header**: Ensure this is set to your structural requirement (default 140mm).\n- **Include Beams with Code**: Add specific beam codes (e.g., `HDR;LVL`) if you want to rip beams that are not standard system headers.\n\n### Step 3: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the Wall or Panel elements you wish to process. Press Enter to confirm selection.\n```\n*Note: Once the selection is confirmed, the script will process the elements and automatically erase itself from the drawing.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Show Report of Ripped Headers | dropdown | \\|Yes\\| | If `|Yes|`, prints a list of modified headers to the command line. If `|No|`, runs silently. |\n| Enter Minimum Depth of Header | number | 140 | The minimum height (in mm) a header must have. The script will not cut a header if it would go below this depth. |\n| \\|Include Beams with Code\\| | text | | A list of custom beam codes to treat as headers (e.g., `HDR;Lintel`). Separate multiple codes with `| ;`. |\n| Only Show Report | dropdown | \\|Yes\\| | **Safety Switch**. If `|Yes|`, the script only identifies clashes without modifying geometry. If `|No|`, it cuts headers and deletes packers. |\n\n## Right-Click Menu Options\nNone. This script runs once upon insertion and does not attach persistent context menu items to the elements.\n\n## Settings Files\nNone. This script operates independently of external XML or configuration files.\n\n## Tips\n- **Run a Test First**: Always run the script with **Only Show Report** set to `|Yes|` to preview which headers will be cut without changing your model.\n- **Custom Headers**: If you use specific lumber for headers (like LVL) that isn't automatically detected, add the code in the **Include Beams with Code** field (e.g., `|LVL|`).\n- **Packer Removal**: The script automatically looks for \"SFPacker\" or standard beams directly below the header and deletes them if they clash with the opening.\n- **Self-Cleaning**: The script instance disappears from the drawing immediately after running. To run it again, you must insert it fresh via `TSLINSERT`.\n\n## FAQ\n- **Q: Why didn't my header get cut even though the report showed a clash?**\n  - A: The calculated height of the header after the cut likely fell below the **Enter Minimum Depth of Header** value. Increase the minimum depth property or check if the header is too small for the opening.\n- **Q: What does \"Header already ripped\" mean in the report?**\n  - A: The script detected that the header is already within 0.5mm of the opening height, so no further modification was necessary.\n- **Q: Can I undo the changes?**\n  - A: Yes, use the standard AutoCAD `UNDO` command immediately after running the script if the results are not as expected."
      },
      "tokens_used": 5786,
      "error": null
    }
  }
}