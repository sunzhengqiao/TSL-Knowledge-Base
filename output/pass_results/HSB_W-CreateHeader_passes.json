{
  "filename": "HSB_W-CreateHeader.mcr",
  "status": "completed",
  "total_tokens": 41965,
  "processing_time": 280.14722084999084,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 7543,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses _kModelSpace during dbCreate, selects OpeningSF entities via PrEntity in _bOnInsert, and uses 'HSB_W-' filename prefix indicating a Wall script in the 3D model. No ShopDrawing (sd_) or Multipage prefixes or Viewport interactions are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "OpeningSF",
            "Element"
          ],
          "minimumBeams": 4,
          "requiredSpace": "A valid Element containing beams (specifically a TopPlate) and at least one OpeningSF.",
          "requiredSettings": []
        }
      },
      "tokens_used": 3851,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select openings",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "numberOfHeaders",
            "type": "PropInt",
            "displayName": "|Number of headers|",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": "|Header|",
            "description": "|Sets the number of headers.|"
          },
          {
            "index": 0,
            "variable": "headerW",
            "type": "PropDouble",
            "displayName": "|Header width|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Header|",
            "description": "|Sets the width of the headers.||The default beam width for the element is used when an invalid height is specified.|"
          },
          {
            "index": 1,
            "variable": "headerH",
            "type": "PropDouble",
            "displayName": "|Header height|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Header|",
            "description": "|Sets the height of the headers.||The default beam height for the element is used when an invalid height is specified.|"
          },
          {
            "index": 1,
            "variable": "numberOfSupportingBeamsLeft",
            "type": "PropInt",
            "displayName": "|Number of supporting beams on the left-hand side|",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": "|Supporting beams|",
            "description": "|Sets the number of supporting beams on the left-hand side.|"
          },
          {
            "index": 2,
            "variable": "numberOfSupportingBeamsRight",
            "type": "PropInt",
            "displayName": "|Number of supporting beams on the right-hand side|",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": "|Supporting beams|",
            "description": "|Sets the number of supporting beams on the right-hand side.|"
          },
          {
            "index": 2,
            "variable": "supportingBeamW",
            "type": "PropDouble",
            "displayName": "|Supporting beams width|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Supporting beams|",
            "description": "|Sets the width of the supporting beams.||The default beam width for the element is used when an invalid height is specified.|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7082,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates header beams spanning an opening and adjusts the adjacent jack/king studs to support them.",
          "category": "Framing",
          "typicalUseCase": "Inserting headers (lintels) above windows or doors in a timber frame wall and ensuring the surrounding studs are sized and cut correctly to support the load."
        },
        "parameters": [
          {
            "name": "numberOfHeaders",
            "technicalDefault": "2",
            "businessMeaning": "The number of header plies (stacked beams) to create across the opening width.",
            "validRange": "1 to 5",
            "unit": "count",
            "affectsOutput": "Determines how many header beams are generated. The first header is placed at the front, the second at the back, and any additional headers are stacked behind the front header."
          },
          {
            "name": "headerW",
            "technicalDefault": "U(0)",
            "businessMeaning": "The thickness (depth perpendicular to the wall face) of the header timber.",
            "validRange": "Standard timber dimensions (e.g., 35mm to 220mm). 0 uses the default element beam width.",
            "unit": "mm",
            "affectsOutput": "Sets the width (Z-dimension) of the generated header beams and calculates the offset for stacked headers (if numberOfHeaders > 2)."
          },
          {
            "name": "headerH",
            "technicalDefault": "U(0)",
            "businessMeaning": "The vertical height of the header timber.",
            "validRange": "Standard timber dimensions (e.g., 45mm to 300mm). 0 uses the default element beam height.",
            "unit": "mm",
            "affectsOutput": "Sets the height (Y-dimension) of the header beams and dictates the vertical position of the cut applied to the supporting beams below."
          },
          {
            "name": "numberOfSupportingBeamsLeft",
            "technicalDefault": "2",
            "businessMeaning": "The number of jack studs (short vertical supports) to generate/modify on the left side of the opening.",
            "validRange": "0 to 4",
            "unit": "count",
            "affectsOutput": "Resizes the nearest N beams on the left to match 'supportingBeamW', applies the header-height cut, and assigns the 'Supporting Beam' type. Remaining beams are marked as King Studs."
          },
          {
            "name": "numberOfSupportingBeamsRight",
            "technicalDefault": "2",
            "businessMeaning": "The number of jack studs (short vertical supports) to generate/modify on the right side of the opening.",
            "validRange": "0 to 4",
            "unit": "count",
            "affectsOutput": "Resizes the nearest N beams on the right to match 'supportingBeamW', applies the header-height cut, and assigns the 'Supporting Beam' type. Remaining beams are marked as King Studs."
          },
          {
            "name": "supportingBeamW",
            "technicalDefault": "U(0)",
            "businessMeaning": "The thickness (width across the wall) of the jack stud material.",
            "validRange": "Standard timber dimensions (e.g., 35mm to 220mm). 0 uses the default element beam width.",
            "unit": "mm",
            "affectsOutput": "Adjusts the width (X-dimension) of the identified jack studs on both sides of the opening."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "headerH changes",
            "effect": "Modifies the vertical position of the bottom cut on the Jack Studs to match the header height.",
            "cascade": [
              "numberOfSupportingBeamsLeft",
              "numberOfSupportingBeamsRight"
            ]
          },
          {
            "trigger": "numberOfHeaders increases above 2",
            "effect": "Calculates additional insertion points offset by the 'headerW' distance in the Z-direction.",
            "cascade": [
              "headerW"
            ]
          },
          {
            "trigger": "supportingBeamW changes",
            "effect": "Re-calculates the lateral transformation of the Jack Studs to maintain their correct relative positions next to the opening.",
            "cascade": [
              "numberOfSupportingBeamsLeft",
              "numberOfSupportingBeamsRight"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam",
            "description": "Header beams (Type: Header) spanning the opening width.",
            "appliedTo": "New entities created based on the OpeningSF location."
          },
          {
            "type": "GenBeam",
            "description": "Jack Studs (Type: SupportingBeam) resized and cut to support the header.",
            "appliedTo": "Existing beams immediately adjacent to the OpeningSF."
          },
          {
            "type": "GenBeam",
            "description": "King Studs (Type: KingStud) marked as full-height supports.",
            "appliedTo": "Existing beams outer to the Jack Studs."
          },
          {
            "type": "Cut",
            "description": "Vertical cuts at the ends of headers; Horizontal cuts at the top of Jack Studs.",
            "appliedTo": "Header beams and Jack Stud beams."
          }
        ]
      },
      "tokens_used": 7709,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Start / User Launch\",\n    \"2. Check Insertion Cycle (Abort if > 1 to prevent loops)\",\n    \"3. Check for Execute Key / Catalog usage\",\n    \"4. [Conditional] Show Properties Dialog if no Execute Key provided\",\n    \"5. Set internal catalog to '_LastInserted'\",\n    \"6. Prompt User to Select OpeningSF entities (PrEntity)\",\n    \"7. Iterate through selected openings\",\n    \"8. Create new script instance for each selected opening (dbCreate with 'ManualInserted' map flag)\",\n    \"9. Erase the initial 'selector' instance\",\n    \"10. [Instance Execution] Validate linked Entity is an OpeningSF\",\n    \"11. Validate Opening is attached to a valid Element\",\n    \"12. Extract Coordinate System and calculate Opening center/width\",\n    \"13. Search for Beams above opening (Module detection)\",\n    \"14. Filter beams left and right of the opening within the module\",\n    \"15. [Validation] Verify TopPlate exists above opening\",\n    \"16. Resolve Header and Supporting Beam dimensions (Use user props or Element defaults)\",\n    \"17. Calculate Header Insertion Points (Front, Back, or Stacked)\",\n    \"18. Generate Header Beams (dbCreate), apply Cuts, set Type/Code\",\n    \"19. Process Left Side Supporting Beams (Create new if needed, Transform, Resize, Apply Cut)\",\n    \"20. Process Right Side Supporting Beams (Create new if needed, Transform, Resize, Apply Cut)\",\n    \"21. Set remaining outer beams as King Studs\",\n    \"22. Erase Script Instance (Terminate)\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"numberOfHeaders variable value\",\n      \"path1\": {\n        \"name\": \"Single Header\",\n        \"steps\": [\n          \"Calculate position at element front (inner face)\",\n          \"Create 1 Header beam\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Double Header\",\n        \"steps\": [\n          \"Calculate position at element front\",\n          \"Calculate position at element back\",\n          \"Create 2 Header beams\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"Stacked Headers (>2)\",\n        \"steps\": [\n          \"Calculate position at element front\",\n          \"Calculate position at element back\",\n          \"Loop for remaining headers: Offset from front by 'headerW' distance\",\n          \"Create N Header beams\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Existing Beam Count vs. Requested Supporting Beams\",\n      \"path1\": {\n        \"name\": \"Sufficient Beams Exist\",\n        \"steps\": [\n          \"Use existing beams in the array\",\n          \"Transform existing beams to align with opening\",\n          \"Resize first 'N' beams as Jack Studs\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Insufficient Beams (Generate new)\",\n        \"steps\": [\n          \"Identify outermost beam\",\n          \"Copy outermost beam\",\n          \"Transform copy inwards (towards opening)\",\n          \"Increment BeamCode index\",\n          \"Repeat until count matches 'numberOfSupportingBeams'\",\n          \"Transform all beams to align\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Supporting Beam Index vs. Count\",\n      \"path1\": {\n        \"name\": \"Jack Stud (Inner)\",\n        \"steps\": [\n          \"Index is less than requested count\",\n          \"Resize width to 'supportingBeamW'\",\n          \"Apply horizontal top cut (header height)\",\n          \"Set Type to 'Supporting Beam'\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"King Stud (Outer)\",\n        \"steps\": [\n          \"Index is greater or equal to requested count\",\n          \"Do not resize width\",\n          \"Do not apply top cut\",\n          \"Set Type to 'King Stud'\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n"
      },
      "tokens_used": 9615,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_W-CreateHeader\n\n## Overview\nThis script automates the creation of structural headers above wall openings (such as windows or doors). It generates the header beams and simultaneously adjusts the adjacent vertical studs to create correctly sized jack studs and king studs.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in the 3D model on an existing Element. |\n| Paper Space | No | This script does not function in Layouts/Shop Drawings. |\n| Shop Drawing | No | This script is for model generation only. |\n\n## Prerequisites\n- **Required Entities**: An existing `Element` (Wall) containing a `TopPlate` and at least one `OpeningSF` (Opening entity).\n- **Minimum Beam Count**: The wall must contain a top plate and at least one vertical stud on each side of the opening.\n- **Required Settings**: None (defaults to Element standard sizes if dimensions are set to 0).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_W-CreateHeader.mcr`\n\n### Step 2: Select Openings\n```\nCommand Line: Select openings\nAction: Click on the OpeningSF entities (the rectangle defining the window/door rough opening) you wish to frame. You can select multiple openings. Press Enter to confirm.\n```\n\n*(Note: Once selected, the script will automatically calculate the geometry, generate the headers, and cut/resize the surrounding studs.)*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Number of headers | Integer | 2 | Sets the number of header plies (stacked beams) to create across the opening width. |\n| Header width | Number | 0 | Sets the thickness (depth) of the header timber. Use 0 to apply the Element's default beam width. |\n| Header height | Number | 0 | Sets the vertical height of the header timber. Use 0 to apply the Element's default beam height. |\n| Number of supporting beams on the left-hand side | Integer | 2 | Sets the number of jack studs (short vertical supports) to generate or modify on the left side of the opening. |\n| Number of supporting beams on the right-hand side | Integer | 2 | Sets the number of jack studs (short vertical supports) to generate or modify on the right side of the opening. |\n| Supporting beams width | Number | 0 | Sets the thickness of the jack stud material. Use 0 to apply the Element's default beam width. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not add custom items to the right-click context menu. Standard AutoCAD/hsbCAD options apply. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Zero Values**: If you leave `Header width`, `Header height`, or `Supporting beams width` set to `0`, the script will automatically use the default material dimensions defined in your Element properties.\n- **Stacking Headers**: If you increase \"Number of headers\" above 2, the additional headers will be stacked behind the front header based on the \"Header width\" dimension.\n- **Auto-Fill Studs**: If the script detects that there are not enough existing studs next to the opening to satisfy the count requested in \"Number of supporting beams,\" it will automatically copy the outermost stud and move it inward to fill the gap.\n- **Multi-Selection**: You can frame multiple openings at once by window selecting or picking several `OpeningSF` entities during the command prompt.\n\n## FAQ\n- **Q: Why are my studs not being cut at the top?**\n  **A:** Ensure that the `Header height` parameter is set correctly. The studs are cut to match the bottom of the header. If the header height is 0 (default), ensure your Element has a valid default height defined.\n- **Q: How do I create a \"King-Jack-King\" setup (2 studs on each side)?**\n  **A:** Set both \"Number of supporting beams on the left-hand side\" and \"Number of supporting beams on the right-hand side\" to 1. The script will resize the inner stud to be a Jack Stud and leave the outer one as a full-height King Stud.\n- **Q: Can I use this on openings that aren't aligned with the wall top plate?**\n  **A:** The script searches for beams above the opening module. If the opening is rotated or placed such that no valid TopPlate is found directly above it, the script may fail to generate headers."
      },
      "tokens_used": 6165,
      "error": null
    }
  }
}