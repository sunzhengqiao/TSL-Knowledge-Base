{
  "filename": "Hilti-Verteilung.mcr",
  "status": "completed",
  "total_tokens": 51676,
  "processing_time": 294.1374125480652,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9148,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses '_kModelSpace' as the argument for 'dbCreate' methods to insert 'Hilti-Verankerung' instances. There are no references to '_kPaperSpace', '_Viewport', or 'sd_' prefixes typical of Paper Space or ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "TSL script 'Hilti-Verankerung' must be installed",
            "Catalog entries must exist for 'Hilti-Verankerung'"
          ]
        }
      },
      "tokens_used": 6955,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sCatalogEntry1",
            "type": "PropString",
            "displayName": "Catalog Entry",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "<<Edit in place>>"
            ],
            "category": "Aussenwand",
            "description": "Defines the Catalog Entry Einträge beginnend mit AW sind für die Innenwand reserviert."
          },
          {
            "index": 1,
            "variable": "sModeDistribution1",
            "type": "PropString",
            "displayName": "Mode of Distribution",
            "defaultValue": "Stud based",
            "inputType": "dropdown",
            "options": [
              "Stud based",
              "Even",
              "Fixed"
            ],
            "category": "Aussenwand",
            "description": "Defines the Mode of Distribution"
          },
          {
            "index": 0,
            "variable": "dCornerOffset1",
            "type": "PropDouble",
            "displayName": "Start Offset",
            "defaultValue": 150.0,
            "inputType": "number",
            "options": [],
            "category": "Aussenwand",
            "description": "Defines the Start outer corner offset"
          },
          {
            "index": 1,
            "variable": "dInterdistance1",
            "type": "PropDouble",
            "displayName": "Interdistance",
            "defaultValue": 625.0,
            "inputType": "number",
            "options": [],
            "category": "Aussenwand",
            "description": "Defines the minimal interdistance"
          },
          {
            "index": 2,
            "variable": "dCornerOffsetEnd1",
            "type": "PropDouble",
            "displayName": "End Offset",
            "defaultValue": 150.0,
            "inputType": "number",
            "options": [],
            "category": "Aussenwand",
            "description": "Defines the End outer corner offset"
          },
          {
            "index": 2,
            "variable": "sCatalogEntry2",
            "type": "PropString",
            "displayName": "Catalog Entry ",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "<<Edit in place>>"
            ],
            "category": "Innenwand",
            "description": "Defines the Catalog Entry Einträge beginnend mit ZW sind für die Außenwand reserviert."
          },
          {
            "index": 3,
            "variable": "sModeDistribution2",
            "type": "PropString",
            "displayName": "Mode of Distribution",
            "defaultValue": "Stud based",
            "inputType": "dropdown",
            "options": [
              "Stud based",
              "Even",
              "Fixed"
            ],
            "category": "Innenwand",
            "description": "Defines the Mode of Distribution"
          },
          {
            "index": 3,
            "variable": "dCornerOffset2",
            "type": "PropDouble",
            "displayName": "Start Offset ",
            "defaultValue": 150.0,
            "inputType": "number",
            "options": [],
            "category": "Innenwand",
            "description": "Defines the Start outer corner offset"
          },
          {
            "index": 4,
            "variable": "dInterdistance2",
            "type": "PropDouble",
            "displayName": "Interdistance ",
            "defaultValue": 625.0,
            "inputType": "number",
            "options": [],
            "category": "Innenwand",
            "description": "Defines the minimal interdistance"
          },
          {
            "index": 5,
            "variable": "dCornerOffsetEnd2",
            "type": "PropDouble",
            "displayName": "End Offset ",
            "defaultValue": 150.0,
            "inputType": "number",
            "options": [],
            "category": "Innenwand",
            "description": "Defines the End outer corner offset"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Hilti-Verteilung",
            "handler": null,
            "action": "Inserts the script instance via command TSLCONTENT.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Delete Distribution",
            "handler": "sTriggerDeleteDistribution",
            "action": "Deletes the 'Hilti-Verankerung' instances created by this script.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Recalculate",
            "handler": "sTriggerRecalculate",
            "action": "Triggers the calculation and distribution of 'Hilti-Verankerung' instances.",
            "alsoTriggeredBy": "sDoubleClick"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7836,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the placement and distribution of Hilti wall anchors (fasteners) along the bottom plates of timber frame walls.",
          "category": "Hardware",
          "typicalUseCase": "Used during the detailing phase to calculate and insert anchor points for securing timber walls to the foundation or floor slab, ensuring they meet structural spacing requirements."
        },
        "parameters": [
          {
            "name": "sCatalogEntry1",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific Hilti anchor type (hardware catalog) to be used for exterior walls (Aussenwand). This determines the geometry and size of the fastener.",
            "validRange": "Depends on available 'Hilti-Verankerung' catalog entries (often starting with 'AW' for exterior).",
            "unit": "Catalog Selection",
            "affectsOutput": "Changes the 3D geometry and properties of the inserted 'Hilti-Verankerung' instances on exterior walls."
          },
          {
            "name": "sModeDistribution1",
            "technicalDefault": "Stud based",
            "businessMeaning": "Determines the algorithm for spacing anchors on exterior walls.",
            "validRange": "Stud based, Even, Fixed",
            "unit": "Enumeration",
            "affectsOutput": "Controls the number and position of anchors. 'Stud based' aligns with wall studs. 'Even' spaces them equally within the wall length. 'Fixed' uses a set spacing from the start."
          },
          {
            "name": "dCornerOffset1",
            "technicalDefault": "150.0",
            "businessMeaning": "The distance from the start of the exterior wall bottom plate to the center of the first anchor.",
            "validRange": "50.0 - 500.0 mm (depends on plate width and edge distance requirements)",
            "unit": "mm",
            "affectsOutput": "Moves the first anchor position away from the wall start corner."
          },
          {
            "name": "dInterdistance1",
            "technicalDefault": "625.0",
            "businessMeaning": "The target spacing between anchor centers on exterior walls.",
            "validRange": "400.0 - 1200.0 mm (typical structural engineering requirements)",
            "unit": "mm",
            "affectsOutput": "Adjusts the gap between subsequent anchors. In 'Stud based' mode, this acts as a maximum limit. In 'Even' mode, it is used to calculate the divisor. In 'Fixed' mode, it is the exact step."
          },
          {
            "name": "dCornerOffsetEnd1",
            "technicalDefault": "150.0",
            "businessMeaning": "The distance from the end of the exterior wall bottom plate to the center of the last anchor.",
            "validRange": "50.0 - 500.0 mm",
            "unit": "mm",
            "affectsOutput": "Moves the last anchor position away from the wall end corner."
          },
          {
            "name": "sCatalogEntry2",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific Hilti anchor type (hardware catalog) to be used for interior walls (Innenwand).",
            "validRange": "Depends on available 'Hilti-Verankerung' catalog entries (often starting with 'ZW' or similar for interior).",
            "unit": "Catalog Selection",
            "affectsOutput": "Changes the 3D geometry and properties of the inserted 'Hilti-Verankerung' instances on interior walls."
          },
          {
            "name": "sModeDistribution2",
            "technicalDefault": "Stud based",
            "businessMeaning": "Determines the algorithm for spacing anchors on interior walls.",
            "validRange": "Stud based, Even, Fixed",
            "unit": "Enumeration",
            "affectsOutput": "Controls the number and position of anchors on interior walls following the same logic as exterior walls."
          },
          {
            "name": "dCornerOffset2",
            "technicalDefault": "150.0",
            "businessMeaning": "The distance from the start of the interior wall bottom plate to the center of the first anchor.",
            "validRange": "50.0 - 500.0 mm",
            "unit": "mm",
            "affectsOutput": "Moves the first anchor position away from the wall start corner for interior walls."
          },
          {
            "name": "dInterdistance2",
            "technicalDefault": "625.0",
            "businessMeaning": "The target spacing between anchor centers on interior walls.",
            "validRange": "400.0 - 1200.0 mm",
            "unit": "mm",
            "affectsOutput": "Adjusts the gap between subsequent anchors on interior walls."
          },
          {
            "name": "dCornerOffsetEnd2",
            "technicalDefault": "150.0",
            "businessMeaning": "The distance from the end of the interior wall bottom plate to the center of the last anchor.",
            "validRange": "50.0 - 500.0 mm",
            "unit": "mm",
            "affectsOutput": "Moves the last anchor position away from the wall end corner for interior walls."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sModeDistribution (1 or 2) is set to 'Stud based'",
            "effect": "The script calculates positions based on the existing studs in the wall element. The 'dInterdistance' acts as a filter (max distance) rather than a fixed step.",
            "cascade": [
              "dInterdistance"
            ]
          },
          {
            "trigger": "sModeDistribution (1 or 2) is set to 'Even'",
            "effect": "The script calculates the exact spacing required to fit an integer number of anchors between the offsets, attempting to be as close to 'dInterdistance' as possible but dividing the length evenly.",
            "cascade": [
              "dInterdistance",
              "dCornerOffset",
              "dCornerOffsetEnd"
            ]
          },
          {
            "trigger": "sModeDistribution (1 or 2) is set to 'Fixed'",
            "effect": "The script places anchors at exactly 'dInterdistance' intervals starting from 'dCornerOffset', regardless of whether the last one lands exactly on 'dCornerOffsetEnd' (though logic suggests an end check).",
            "cascade": [
              "dInterdistance",
              "dCornerOffset",
              "dCornerOffsetEnd"
            ]
          },
          {
            "trigger": "Script is applied to an Element",
            "effect": "The script detects if the element is an exterior or interior wall and automatically switches the parameter set used (Suffix 1 for Exterior, Suffix 2 for Interior).",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "TslInst",
            "description": "Instances of the script 'Hilti-Verankerung' (Hilti Anchors). These represent the hardware/fasteners.",
            "appliedTo": "The selected wall Element (Element). Specifically, they are inserted along the bottom plate trajectory."
          }
        ]
      },
      "tokens_used": 9546,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches script via command 'TSLCONTENT' or inserts TSLCONTENT instance.",
          "Script checks if '_bOnInsert' is true.",
          "If inserting, script retrieves available 'Hilti-Verankerung' catalog entries.",
          "Script filters catalog entries into Exterior (Aussenwand, excluding 'ZW') and Interior (Innenwand, excluding 'AW') lists.",
          "Script initializes properties (Catalog Entry, Mode, Offsets) with default values and fills dropdowns.",
          "User selects one or more Elements (walls) in the drawing.",
          "User configures properties via Object Properties Palette (OPM): selecting Catalog Entries, Distribution Modes, and Spacing/Offset values.",
          "Script triggers calculation via 'Recalculate' context menu or double-click (sTriggerRecalculate / sDoubleClick).",
          "Script loops through selected Elements to determine processing logic.",
          "For each Element, script identifies if it is an Exterior or Interior wall based on naming or user classification.",
          "Script selects the appropriate parameter set (Suffix 1 for Exterior, Suffix 2 for Interior).",
          "Script identifies the bottom plate of the wall (filtering beams perpendicular to Y-axis).",
          "Branch: Distribution Mode (Stud based vs Even vs Fixed).",
          "If 'Stud based': Script extracts Stud positions. It filters studs to ensure they are outside Start/End offsets. It further filters studs based on Interdistance (skipping if too close to previous anchor). Special logic handles Baufritz project (opening edges vs rest of wall).",
          "If 'Even' or 'Fixed': Script calculates the wall length profile between Start and End offsets. 'Even' divides length to fit integer count near Interdistance. 'Fixed' places anchors at exact Interdistance steps.",
          "Script generates insertion points (ptsDis) for the anchors along the wall.",
          "Script creates instances of 'Hilti-Verankerung' TSL at each calculated point using dbCreate.",
          "Script attaches the new 'Hilti-Verankerung' instances to the parent wall Element.",
          "Process repeats for all selected Elements."
        ],
        "conditionalBranches": [
          {
            "condition": "Wall Classification (Exterior vs Interior)",
            "path1": {
              "name": "Exterior Wall (Aussenwand)",
              "steps": [
                "Use parameters with suffix '1' (sCatalogEntry1, dCornerOffset1, etc.).",
                "Filter catalog entries starting with 'AW'."
              ]
            },
            "path2": {
              "name": "Interior Wall (Innenwand)",
              "steps": [
                "Use parameters with suffix '2' (sCatalogEntry2, dCornerOffset2, etc.).",
                "Filter catalog entries starting with 'ZW'."
              ]
            }
          },
          {
            "condition": "Distribution Mode",
            "path1": {
              "name": "Stud based",
              "steps": [
                "Identify all Studs in the Element.",
                "Filter out studs closer than Start Offset from wall start.",
                "Filter out studs closer than End Offset from wall end.",
                "Iterate through remaining studs.",
                "Place anchor at stud if distance > Interdistance from previous anchor.",
                "(Baufritz specific) Differentiate between anchors at opening edges vs standard positions."
              ]
            },
            "path2": {
              "name": "Even",
              "steps": [
                "Calculate effective length (Total Length - Start Offset - End Offset).",
                "Divide effective length by target Interdistance to determine part count.",
                "Calculate exact modular spacing to fit parts evenly.",
                "Generate points starting at Start Offset + half-step (to center)."
              ]
            },
            "path3": {
              "name": "Fixed",
              "steps": [
                "Calculate effective length.",
                "Start placing anchors at Start Offset.",
                "Step by exact Interdistance.",
                "Stop if next anchor exceeds End Offset."
              ]
            }
          },
          {
            "condition": "Project Special (Baufritz)",
            "path1": {
              "name": "Baufritz Project",
              "steps": [
                "Additional logic to distinguish anchors at openings.",
                "Likely assigns different catalog entries or properties for edge cases."
              ]
            },
            "path2": {
              "name": "Standard Project",
              "steps": [
                "Standard distribution logic without special opening handling."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Catalog Entry Availability",
            "errorMessage": "N/A (Script usually defaults to empty or specific available entry, but relies on 'Hilti-Verankerung' script existing).",
            "recovery": "Ensure 'Hilti-Verankerung' TSL script is installed and catalog entries are defined in the project."
          },
          {
            "check": "Wall Geometry",
            "errorMessage": "No horizontal beams found or profile length invalid.",
            "recovery": "Ensure valid Element with bottom plates is selected."
          },
          {
            "check": "Offsets vs Wall Length",
            "errorMessage": "Start Offset + End Offset >= Wall Length.",
            "recovery": "No anchors generated. User must reduce offsets."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties",
            "how": "Object Properties Palette (OPM)",
            "effect": "Changing Catalog Entry, Offsets, or Distribution modes does NOT update geometry immediately due to 'guard from any change not desired'. User must right-click -> 'Recalculate' or Double-click to apply changes."
          },
          {
            "action": "Delete Distribution",
            "how": "Right-click context menu -> 'Delete Distribution'",
            "effect": "Removes all 'Hilti-Verankerung' instances generated by this specific script instance."
          },
          {
            "action": "Recalculate",
            "how": "Right-click context menu -> 'Recalculate' or Double-click",
            "effect": "Re-runs the distribution logic, effectively updating anchor positions and counts based on current property settings and wall geometry."
          }
        ]
      },
      "tokens_used": 10570,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Hilti-Verteilung\n\n## Overview\nThis script automates the placement and distribution of Hilti anchors (fasteners) along the bottom plates of timber frame walls. It automatically detects whether a wall is an exterior or interior wall and applies specific spacing rules and anchor types for each.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates exclusively in Model Space. |\n| Paper Space | No | Not supported for layouts or shop drawings. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: Element (Walls).\n- **Minimum Beam Count**: 0 (Script operates on Element level).\n- **Required Settings**:\n    - The TSL script `Hilti-Verankerung` must be installed and available in the project.\n    - Valid Catalog entries for `Hilti-Verankerung` must exist (typically starting with 'AW' for exterior walls and 'ZW' for interior walls).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `Hilti-Verteilung.mcr`\n```\nCommand Line: (Dialog appears to select script)\nAction: Navigate to the script location and select 'Hilti-Verteilung.mcr'.\n```\n\n### Step 2: Select Wall Elements\n```\nAction: Select the Wall Elements (single or multiple) in the drawing where you want to distribute anchors.\n```\n\n### Step 3: Configure Properties\n```\nAction: With the script instance selected, open the Properties Palette (Ctrl+1). Set the desired Catalog Entries and Distribution parameters for both Exterior (Aussenwand) and Interior (Innenwand) categories.\n```\n\n### Step 4: Recalculate\n```\nAction: Right-click on the script instance and select 'Recalculate' (or Double-click the instance).\nAction: The script will generate and insert the 'Hilti-Verankerung' instances along the bottom plates based on the settings.\n```\n\n## Properties Panel Parameters\n\n### Exterior Walls (Aussenwand)\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Catalog Entry | dropdown | | Select the Hilti anchor hardware catalog entry (usually starting with 'AW'). |\n| Mode of Distribution | dropdown | Stud based | Choose how anchors are spaced: <br>• **Stud based**: Aligns with existing studs.<br>• **Even**: Spaces anchors equally along the wall.<br>• **Fixed**: Uses a fixed step distance. |\n| Start Offset | number | 150.0 mm | Distance from the start of the wall to the center of the first anchor. |\n| Interdistance | number | 625.0 mm | Target spacing between anchors. In 'Stud based' mode, this acts as a maximum limit. |\n| End Offset | number | 150.0 mm | Distance from the end of the wall to the center of the last anchor. |\n\n### Interior Walls (Innenwand)\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Catalog Entry | dropdown | | Select the Hilti anchor hardware catalog entry (usually starting with 'ZW'). |\n| Mode of Distribution | dropdown | Stud based | Choose how anchors are spaced (Same logic as Exterior Walls). |\n| Start Offset | number | 150.0 mm | Distance from the start of the wall to the center of the first anchor. |\n| Interdistance | number | 625.0 mm | Target spacing between anchors. |\n| End Offset | number | 150.0 mm | Distance from the end of the wall to the center of the last anchor. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Hilti-Verteilung | Inserts the script instance into the drawing. |\n| Delete Distribution | Removes all 'Hilti-Verankerung' anchor instances that were created by this script. |\n| Recalculate | Re-runs the calculation logic. Use this after changing properties or wall geometry to update the anchor positions. |\n\n## Settings Files\n- **Dependency**: `Hilti-Verankerung.mcr`\n- **Location**: TSL Script Database\n- **Purpose**: This parent script relies on the `Hilti-Verankerung` script to generate the actual 3D geometry of the anchors. Ensure that script and its catalogs are correctly loaded.\n\n## Tips\n- **Automatic Detection**: You do not need to manually specify if a wall is Exterior or Interior; the script detects this and applies the correct parameter set (suffix 1 vs suffix 2).\n- **Updates Required**: Changing a property in the palette (like Offset or Distance) does not move the anchors immediately. You **must** trigger a Recalculate (Right-click > Recalculate) to see changes.\n- **Stud Based Mode**: If you select \"Stud based\" but no anchors appear, ensure the wall has valid studs defined and that the Interdistance is not too small for the stud spacing.\n\n## FAQ\n- **Q: I changed the Interdistance, but the anchors didn't move.**\n- **A:** Changes to properties are not applied instantly. Right-click the script instance and select **Recalculate** to update the model.\n\n- **Q: Can I use different anchor types for different walls in one run?**\n- **A:** Yes. Configure the \"Exterior\" (Aussenwand) settings for exterior walls and the \"Interior\" (Innenwand) settings for interior walls. The script will apply the correct type automatically based on the wall type.\n\n- **Q: What happens if my Start Offset + End Offset is larger than the wall length?**\n- **A:** No anchors will be generated for that wall. Reduce the offset values in the Properties Panel and Recalculate."
      },
      "tokens_used": 7621,
      "error": null
    }
  }
}