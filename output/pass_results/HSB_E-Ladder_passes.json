{
  "filename": "HSB_E-Ladder.mcr",
  "status": "completed",
  "total_tokens": 54114,
  "processing_time": 415.54345870018005,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9129,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates on _bOnElementConstructed, indicating it is part of the 3D element generation process. It uses dbCreate to generate physical Beam entities and dbErase to remove the source beam. It performs 3D geometric operations (Body intersections, Vector math, Plane transformations) and references GenBeam/Element entities. There is no usage of sd_* functions, Viewport interactions, or Paper Space specific APIs."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (Must be inserted into an Element or run on a selected GenBeam)",
          "requiredSettings": [
            "HSB_G-Distribution (Map configuration)"
          ]
        }
      },
      "tokens_used": 6957,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 9868,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Transforms a single linear beam (e.g., purlin or top plate) into a series of perpendicular 'ladder' rungs or blocking members distributed along its length, typically used for wind bracing or fixing sub-structure.\",\n    \"category\": \"Framing\",\n    \"typicalUseCase\": \"Generating timber blocking between rafters or on top of a wall plate to support roof sheathing or cladding where a continuous beam is not required or needs to be broken for ventilation/stiffness.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sBmCodeFilter\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Filter to identify which beams in the construction should be transformed into a ladder configuration. Only beams matching this code are processed.\",\n      \"validRange\": \"Any valid BeamCode string\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Determines selection of the source beam to be erased and replaced by the ladder.\"\n    },\n    {\n      \"name\": \"sBmCodeLadder\",\n      \"technicalDefault\": \"KSTL-01\",\n      \"businessMeaning\": \"The material/grading code assigned to the newly generated ladder rungs (blocking pieces).\",\n      \"validRange\": \"Any valid BeamCode defined in the catalog\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Sets the material properties and shop drawing label of the generated rungs.\"\n    },\n    {\n      \"name\": \"Sdistribution\",\n      \"technicalDefault\": \"Left\",\n      \"businessMeaning\": \"Defines the geometric rule used to calculate the positions of the ladder rungs along the beam (e.g., fixed spacing from left/right, centered, aligned with rafters, or aligned with structural grids).\",\n      \"validRange\": \"Left, Right, Centre, Centre no beam in centre, At Rafter, Left from Rafter, Right from Rafter, Left&Right from Rafter, On Grid\",\n      \"unit\": \"Enum\",\n      \"affectsOutput\": \"Changes the X-coordinates of the generated rungs along the parent beam axis.\"\n    },\n    {\n      \"name\": \"dThicknessLadder\",\n      \"technicalDefault\": \"48 mm\",\n      \"businessMeaning\": \"The width of the ladder rung along the axis of the parent beam. This is effectively the extrusion length of the rung.\",\n      \"validRange\": \"Typically 30mm to 100mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Determines the length of the individual rungs along the beam centerline.\"\n    },\n    {\n      \"name\": \"dHeightLadder\",\n      \"technicalDefault\": \"200 mm\",\n      \"businessMeaning\": \"The height/depth of the ladder rung (perpendicular to the parent beam width). The script attempts to orient the rung so this dimension matches the vertical or element Z-axis.\",\n      \"validRange\": \"Typically 45mm to 300mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Sets the cross-sectional height of the generated rungs.\"\n    },\n    {\n      \"name\": \"dSpacingLadder\",\n      \"technicalDefault\": \"600 mm\",\n      \"businessMeaning\": \"The distance between the centerlines of adjacent ladder rungs. Used for fixed spacing or as a maximum spacing if 'Distribute evenly' is active.\",\n      \"validRange\": \"300mm to 1500mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Controls the frequency/density of rungs along the beam.\"\n    },\n    {\n      \"name\": \"dOffsetFirstLadder\",\n      \"technicalDefault\": \"0 mm\",\n      \"businessMeaning\": \"The distance from the start of the parent beam to the center of the first ladder rung.\",\n      \"validRange\": \"0mm to half span\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Shifts the start position of the entire ladder group.\"\n    },\n    {\n      \"name\": \"dOffsetLastLadder\",\n      \"technicalDefault\": \"0 mm\",\n      \"businessMeaning\": \"The distance from the end of the parent beam to the center of the last ladder rung.\",\n      \"validRange\": \"0mm to half span\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Shifts the end position of the entire ladder group.\"\n    },\n    {\n      \"name\": \"dOffsetRafterLadder\",\n      \"technicalDefault\": \"0 mm\",\n      \"businessMeaning\": \"A shift offset applied specifically when distributing relative to rafters. Positive/Negative values shift the rungs relative to the rafter centerline.\",\n      \"validRange\": \"-100mm to 100mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Fine-tuning of rung position relative to structural rafters.\"\n    },\n    {\n      \"name\": \"placeFirstBeam\",\n      \"technicalDefault\": \"Yes\",\n      \"businessMeaning\": \"Controls whether a rung is placed explicitly at the start offset position.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"Presence or absence of the first rung in the sequence.\"\n    },\n    {\n      \"name\": \"SPlaceLastBeam\",\n      \"technicalDefault\": \"Yes\",\n      \"businessMeaning\": \"Controls whether a rung is placed explicitly at the end offset position.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"Presence or absence of the last rung in the sequence.\"\n    },\n    {\n      \"name\": \"SDistrEvenly\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"If 'Yes', calculates the exact spacing required to fit an integer number of rungs within the bounds without exceeding the 'Spacing ladder' value. If 'No', uses fixed spacing.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"Adjusts the spacing between rungs to fit the beam length perfectly or keeps it fixed.\"\n    },\n    {\n      \"name\": \"extrusionProfile\",\n      \"technicalDefault\": \"--\",\n      \"businessMeaning\": \"Assigns a specific cross-section profile (from catalogs) to the rungs instead of a standard rectangular sawn timber size.\",\n      \"validRange\": \"Catalog Profile Names or --\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Geometry and machining capability of the rungs.\"\n    },\n    {\n      \"name\": \"allowClashWithRafter\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"If 'No', the script suppresses the creation of a ladder rung if it physically intersects/volume-clashes with a detected rafter.\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"Prevents generation of rungs that would overlap with rafters.\"\n    },\n    {\n      \"name\": \"flipY\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Rotates the ladder rung 180 degrees around its own axis. Used to correct material orientation (e.g., crown up/down or machined face direction).\",\n      \"validRange\": \"Yes, No\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"Rotation of the rung cross-section.\"\n    },\n    {\n      \"name\": \"variableThicknessLadder\",\n      \"technicalDefault\": \"-1\",\n      \"businessMeaning\": \"Index of a Design Standard Property (DSP) variable that overrides the fixed 'Thickness ladder' value. -1 means disabled.\",\n      \"validRange\": \"Integer (-1 or higher)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Dynamically sets thickness based on element properties.\"\n    },\n    {\n      \"name\": \"variableHeightLadder\",\n      \"technicalDefault\": \"-1\",\n      \"businessMeaning\": \"Index of a DSP variable that overrides the fixed 'Height ladder' value.\",\n      \"validRange\": \"Integer (-1 or higher)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Dynamically sets height based on element properties.\"\n    },\n    {\n      \"name\": \"variableSpacingLadder\",\n      \"technicalDefault\": \"-1\",\n      \"businessMeaning\": \"Index of a DSP variable that overrides the fixed 'Spacing ladder' value.\",\n      \"validRange\": \"Integer (-1 or higher)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Dynamically sets spacing based on element properties.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"Sdistribution is set to 'At Rafter', 'Left from Rafter', 'Right from Rafter', or 'Left&Right from Rafter'\",\n      \"effect\": \"The script requires Rafters to be present in the element. The 'Offset rafter ladders' parameter becomes active.\",\n      \"cascade\": [\n        \"dOffsetRafterLadder\",\n        \"allowClashWithRafter"
      },
      "tokens_used": 9448,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Triggered: Execution starts via _bOnElementConstructed (during generation) or _bOnInsert (manual execution).\",\n    \"2. Context Determination: System checks if the script is running automatically on an element or manually inserted.\",\n    \"3. Source Beam Identification:\",\n    \"   - Auto: Iterates element beams and filters by sBmCodeFilter and SubMapX check.\",\n    \"   - Manual: Prompts user to select a single beam via command line.\",\n    \"4. Parameter Resolution: Script reads Properties. If variable overrides (e.g., variableThicknessLadder) are enabled (index > -1), values are fetched from Element Design Properties (DSP).\",\n    \"5. Geometry Calculation: Determines source beam length, effective start/end points based on dOffsetFirstLadder/dOffsetLastLadder, and coordinate system (Vector X, Y, Z).\",\n    \"6. Distribution Strategy Execution (Branching):\",\n    \"   - Linear (Left/Right/Centre): Calculates points based on fixed spacing (dSpacingLadder).\",\n    \"   - Evenly: Recalculates spacing to fit integer number of rungs within length.\",\n    \"   - Rafter-based (At/From Rafter): Filters Rafters, projects centerlines onto source beam, and applies offsets.\",\n    \"   - On Grid: Intersects beam centerline with element Grid lines.\",\n    \"7. Ladder Generation Loop: Iterates through calculated distribution positions.\",\n    \"   - Geometry Creation: Constructs PLine/Body for the rung based on dThicknessLadder and dHeightLadder.\",\n    \"   - Orientation: Aligns the rung's local coordinate system (Matching Height to Z or Y axis of source).\",\n    \"   - Clash Detection: Checks for intersection with Rafters if 'allowClashWithRafter' is No.\",\n    \"   - Entity Creation: dbCreate the new beam, copy attributes (Layer, Code, Material), and apply extrusion profile.\",\n    \"8. Cleanup: dbErase the original source beam.\",\n    \"9. Termination: eraseInstance() removes the script instance from the element/selection.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Execution Context\",\n      \"path1\": {\n        \"name\": \"_bOnElementConstructed (Auto)\",\n        \"steps\": [\n          \"Iterate all beams in current element.\",\n          \"Filter beams matching sBmCodeFilter.\",\n          \"Skip if beam already has 'HSB_E-Ladder' SubMapX (Used=true).\",\n          \"Process valid beams.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"_bOnInsert (Manual)\",\n        \"steps\": [\n          \"Set manualInserted flag to true.\",\n          \"Prompt user: 'Select beam to transform to ladder'.\",\n          \"Process selected beam.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Variable Override Index\",\n      \"path1\": {\n        \"name\": \"Index > -1\",\n        \"steps\": [\n          \"Read integer value from Element DSP at specific index.\",\n          \"Use DSP value for dimension (e.g., Thickness).\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Index == -1 (Default)\",\n        \"steps\": [\n          \"Use hardcoded property value from script (e.g., dThicknessLadder).\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Sdistribution Mode\",\n      \"path1\": {\n        \"name\": \"Linear (Left/Right/Centre/No Centre)\",\n        \"steps\": [\n          \"Calculate number of rungs.\",\n          \"If SDistrEvenly: Divide length by count to get new spacing.\",\n          \"Generate points sequentially along beam X-axis.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Rafter Relative (At/From Rafter)\",\n        \"steps\": [\n          \"Collect Rafters from element (using type filters).\",\n          \"Project rafter centerlines onto beam.\",\n          \"Apply dOffsetRafterLadder.\",\n          \"Filter duplicates using tolerance.\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"On Grid\",\n        \"steps\": [\n          \"Retrieve Grids associated with the beam's groups.\",\n          \"Calculate intersection of Beam Centerline and Grid lines.\",\n          \"Use intersections as rung positions.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Rafter Clash Check\",\n      \"path1\": {\n        \"name\": \"Clash Detected & allowClashWithRafter == No\",\n        \"steps\": [\n          \"Skip generation of current rung.\",\n          \"Report message: 'Beam not added because of intersection with rafter'.\",\n          \"Continue to next position.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No Clash or allowClashWithRafter == Yes\",\n        \"steps\": [\n"
      },
      "tokens_used": 11602,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-Ladder.mcr\n\n## Overview\nThis script transforms a single linear beam (such as a purlin or top plate) into a series of perpendicular \"ladder\" rungs or blocking members distributed along its length. It is typically used to create wind bracing or fixing sub-structures by replacing a continuous beam with smaller, spaced components.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Runs during element generation or via manual insertion. |\n| Paper Space | No | Not applicable for 2D drawings. |\n| Shop Drawing | No | This is a 3D generation script. |\n\n## Prerequisites\n- **Required Entities**: GenBeam (for manual execution) or Element (for automatic execution).\n- **Minimum Beam Count**: 1 source beam.\n- **Required Settings**: `HSB_G-Distribution` (Map configuration for distribution logic).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Select `HSB_E-Ladder.mcr` from the file list.\n\n### Step 2: Select Source Beam\n```\nCommand Line: Select beam to transform to ladder\nAction: Click on the linear beam in the 3D model that you wish to replace with rungs.\n```\n*(Note: If run automatically on an element, the script filters beams based on the \"BmCode Filter\" property instead of prompting.)*\n\n### Step 3: Configure Parameters\n```\nAction: Press Ctrl+1 to open the Properties Palette if not already visible.\nAdjust parameters (e.g., Spacing, Dimensions, Distribution Mode) as required.\n```\n\n### Step 4: Execute\n```\nAction: The script processes immediately upon selection or property change.\nThe original beam is erased, and the new ladder rungs are generated.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sBmCodeFilter | String | -- | Filter to identify which source beams should be transformed. Only beams matching this code are processed automatically. |\n| sBmCodeLadder | String | KSTL-01 | The material/grading code assigned to the newly generated ladder rungs. |\n| Sdistribution | Enum | Left | Defines how rungs are positioned: Left, Right, Centre, At Rafter, On Grid, etc. |\n| dThicknessLadder | Double | 48 mm | The width of the rung along the axis of the parent beam (extrusion length). |\n| dHeightLadder | Double | 200 mm | The height/depth of the rung (perpendicular to the parent beam width). |\n| dSpacingLadder | Double | 600 mm | The distance between centerlines of adjacent rungs. |\n| dOffsetFirstLadder | Double | 0 mm | Distance from the start of the parent beam to the center of the first rung. |\n| dOffsetLastLadder | Double | 0 mm | Distance from the end of the parent beam to the center of the last rung. |\n| dOffsetRafterLadder | Double | 0 mm | Shift offset applied specifically when distributing relative to rafters. |\n| placeFirstBeam | Boolean | Yes | Controls whether a rung is placed explicitly at the start offset position. |\n| SPlaceLastBeam | Boolean | Yes | Controls whether a rung is placed explicitly at the end offset position. |\n| SDistrEvenly | Boolean | No | If Yes, calculates exact spacing to fit an integer number of rungs within the bounds. |\n| extrusionProfile | String | -- | Assigns a specific cross-section profile from catalogs to the rungs. |\n| allowClashWithRafter | Boolean | No | If No, suppresses rung creation if it intersects with a detected rafter. |\n| flipY | Boolean | No | Rotates the ladder rung 180 degrees around its own axis. |\n| variableThicknessLadder | Integer | -1 | DSP index to override fixed thickness (-1 disables). |\n| variableHeightLadder | Integer | -1 | DSP index to override fixed height (-1 disables). |\n| variableSpacingLadder | Integer | -1 | DSP index to override fixed spacing (-1 disables). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| N/A | This script instance removes itself immediately after generating the beams. Standard recalculation is not available post-execution. |\n\n## Settings Files\n- **Filename**: `HSB_G-Distribution`\n- **Location**: Company Standards or hsbCAD Install path\n- **Purpose**: Provides configuration data for distribution logic, specifically when using \"At Rafter\" or \"On Grid\" modes to locate structural members.\n\n## Tips\n- Use the **Sdistribution** \"At Rafter\" mode to automatically align rungs with underlying structural rafters.\n- If your rungs are not fitting perfectly between start and end points, enable **SDistrEvenly** to auto-calculate the spacing.\n- If you notice missing rungs in the middle of the span, check if **allowClashWithRafter** is set to \"No\"; the script may be deleting rungs that overlap with rafters.\n\n## FAQ\n- **Q: Why did the original beam disappear?**\n  A: The script is designed to erase the source beam and replace it with the individual ladder rungs.\n- **Q: Why are no rungs being generated?**\n  A: Check the **sBmCodeFilter** property to ensure it matches the code of the beam you selected. Also, verify that the calculated spacing does not exceed the beam length.\n- **Q: Can I use variable sizes for the rungs?**\n  A: Yes. Set the **variableThicknessLadder**, **variableHeightLadder**, or **variableSpacingLadder** indices to the corresponding Design Standard Property (DSP) indices to control dimensions dynamically."
      },
      "tokens_used": 7110,
      "error": null
    }
  }
}