{
  "filename": "FLR_Chase.mcr",
  "status": "completed",
  "total_tokens": 39960,
  "processing_time": 191.35947012901306,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4941,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses 'getElementRoof' and collects entities specifically from '_kModelSpace'. It modifies 3D geometry by adding 'BeamCut' and 'Drill' tools to 'Beam' and 'TrussEntity' objects. It utilizes 'Display dp(5)' for 3D visualization and contains no 'sd_' functions, '_Viewport' handling, or '#Type E' declarations indicative of shop drawings or paper space."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementRoof",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing a Floor/Roof Element with Joists or Beams",
          "requiredSettings": []
        }
      },
      "tokens_used": 5416,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": \"Properties Palette\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"\\nSelect start point\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"PrPoint\",\n        \"promptOriginal\": \"\\nSelect next point\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 4,\n        \"function\": \"getElementRoof\",\n        \"promptOriginal\": \"\\nSelect a reference Element\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 1,\n      \""
      },
      "tokens_used": 8498,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of floor chases (openings/notches) in joists or trusses to allow passage for HVAC ducts, plumbing, or wiring.",
          "category": "Framing/Machining",
          "typicalUseCase": "Used during the floor system design phase to cut rectangular, round, or oval openings through multiple structural members along a defined path."
        },
        "parameters": [
          {
            "name": "stShape",
            "technicalDefault": "Rectangular",
            "businessMeaning": "The cross-sectional geometry of the opening to be cut (Rectangular, Round, or Oval).",
            "validRange": "Rectangular, Round, Oval",
            "unit": "Selection",
            "affectsOutput": "Determines the specific tool type applied: BeamCut for Rectangular, Drill for Round, or a combination of both for Oval."
          },
          {
            "name": "dW",
            "technicalDefault": "12.0",
            "businessMeaning": "Width of the rectangular/oval chase. Represents the minor axis for ovals or width for rectangles.",
            "validRange": "2.0 to 24.0 inches",
            "unit": "inch",
            "affectsOutput": "Sets the width of the BeamCut or the minor diameter axis of the Oval. Defines the lateral extent of the hole across the joist."
          },
          {
            "name": "dH",
            "technicalDefault": "4.0",
            "businessMeaning": "Height of the rectangular/oval chase or Diameter of the round chase. Represents the vertical extent of the opening.",
            "validRange": "2.0 to 14.0 inches",
            "unit": "inch",
            "affectsOutput": "Sets the height of the BeamCut, the Diameter of the Drill, or the major axis of the Oval. Determines how much vertical material is removed."
          },
          {
            "name": "dZOff",
            "technicalDefault": "0.0",
            "businessMeaning": "Vertical offset of the chase centerline from the center of the reference element (floor/roof).",
            "validRange": "-6.0 to 6.0 inches",
            "unit": "inch",
            "affectsOutput": "Shifts the entire chase path vertically up or down relative to the element center, ensuring the hole aligns with ductwork depth or avoids bottom plate interference."
          },
          {
            "name": "stJoistFind",
            "technicalDefault": "All Floor Joists",
            "businessMeaning": "Selects the scope of joists to be machined based on their grouping in the model tree.",
            "validRange": "All Floor Joists, Only Element Joists",
            "unit": "Selection",
            "affectsOutput": "Controls which collection of entities is queried for intersections. 'All' includes broader structural groups, while 'Only Element' restricts cuts to beams strictly within the selected roof element."
          },
          {
            "name": "stKeepPerp",
            "technicalDefault": "Yes",
            "businessMeaning": "Enforces a constraint that only joists running perpendicular to the chase path are cut.",
            "validRange": "Yes, No",
            "unit": "Selection",
            "affectsOutput": "If 'Yes', the script skips joists that are not perpendicular to the defined chase line. If 'No', it will attempt to cut any joist intersecting the chase path regardless of angle."
          },
          {
            "name": "stDim",
            "technicalDefault": "Current DimStyle",
            "businessMeaning": "The dimension style used for formatting text labels in the 3D model.",
            "validRange": "Available Dimension Styles",
            "unit": "Style",
            "affectsOutput": "Dictates the font size, units display, and appearance of the annotation text describing the chase size and offset."
          },
          {
            "name": "_PtG (Grip Points)",
            "technicalDefault": "User Input",
            "businessMeaning": "Start and end points defining the centerline path of the chase through the building.",
            "validRange": "Within floor boundary",
            "unit": "coords",
            "affectsOutput": "Defines the location, direction, and length of the chase. The script projects these points to find intersecting joists."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "stShape == 'Round'",
            "effect": "Parameter dW is ignored in calculations; dH is used as the Diameter.",
            "cascade": [
              "dW"
            ]
          },
          {
            "trigger": "stShape == 'Oval'",
            "effect": "The script calculates a 'Smallest' dimension from dW and dH to generate two corner Drills and a connecting BeamCut.",
            "cascade": [
              "dW",
              "dH"
            ]
          },
          {
            "trigger": "stKeepPerp == 'Yes'",
            "effect": "Joists that are not perpendicular to the vector between _PtG[0] and _PtG[1] are ignored during tool generation.",
            "cascade": [
              "Joist List",
              "Tooling Logic"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "BeamCut",
            "description": "A rectangular subtractive volume applied to the beam geometry.",
            "appliedTo": "Beams and TrussEntities that intersect the chase path (used for Rectangular and Oval shapes)."
          },
          {
            "type": "Drill",
            "description": "A cylindrical subtractive volume applied to the beam geometry.",
            "appliedTo": "Beams and TrussEntities that intersect the chase path (used for Round shapes and the corners of Oval shapes)."
          },
          {
            "type": "3D Annotation",
            "description": "Text label displaying dimensions (e.g., 'RECTANGULAR (12x4)') and offset info.",
            "appliedTo": "Model Space, positioned at the average center of the chase path."
          }
        ]
      },
      "tokens_used": 6957,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script (Insert TSL)",
          "Properties Palette Opens (OPM)",
          "User selects 'Shape', 'Width/Height', 'Offset', and other properties",
          "Command Line Prompt: Select start point of chase",
          "Command Line Prompt: Select next point of chase (defines path)",
          "Command Line Prompt: Select reference Element (Floor/Roof)",
          "Script calculates elevation from element and projects points to element plane",
          "Script generates search body along path",
          "Script collects Beams and TrussEntities based on 'Joists to use' setting",
          "Loop through collected beams/trusses",
          "Check 'Keep Perpendicular' setting: Skip non-perpendicular joists if enabled",
          "Check intersection between Chase Body and Beam Envelope",
          "Apply Machining (BeamCut or Drill) based on 'Shape' selection",
          "Generate 3D Text Label (Size and Offset info)",
          "Finish"
        ],
        "conditionalBranches": [
          {
            "condition": "Shape Property Selection",
            "path1": {
              "name": "Rectangular",
              "steps": [
                "Calculate width based on dW",
                "Create BeamCut tool with dimensions dW x dH"
              ]
            },
            "path2": {
              "name": "Round",
              "steps": [
                "Ignore dW parameter",
                "Create Drill tool with diameter dH"
              ]
            },
            "path3": {
              "name": "Oval",
              "steps": [
                "Calculate smallest dimension (min of dW, dH)",
                "Create 2 Drills at corners using smallest dimension",
                "Create connecting BeamCut between drills"
              ]
            }
          },
          {
            "condition": "Joist Collection Scope",
            "path1": {
              "name": "All Floor Joists",
              "steps": [
                "Get Parent Group name",
                "Collect all Beams and TrussEntities in that Group structure"
              ]
            },
            "path2": {
              "name": "Only Element Joists",
              "steps": [
                "Use specific ElementRoof selected",
                "Collect only Beams and TrussEntities strictly inside that Element"
              ]
            }
          },
          {
            "condition": "Keep Perpendicular Setting",
            "path1": {
              "name": "Yes",
              "steps": [
                "Calculate vector of current beam",
                "Check angle relative to Chase vector",
                "Skip machining if not perpendicular"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Attempt machining on any beam intersecting the chase path regardless of angle"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Reference Element Validity",
            "errorMessage": "No valid element for TSL 'FLR_Chase.mcr'",
            "recovery": "Script erases instance. User must re-insert and select a valid Floor/Roof element."
          },
          {
            "check": "Point Count",
            "errorMessage": "Internal check failure (Script Erases)",
            "recovery": "Must ensure exactly 2 points (Start/End) define the chase during insertion."
          },
          {
            "check": "Grip Point Projection (Post-Insertion)",
            "errorMessage": "Snaps to reference lines",
            "recovery": "User drags grips; script automatically projects points to maintain alignment with original vector or roof planes."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Dimensions",
            "how": "Edit 'Width', 'Height', or 'Offset' in OPM (Properties Palette)",
            "effect": "Machining tools update immediately. Visual representation updates."
          },
          {
            "action": "Move Chase (Grip Edit)",
            "how": "Drag Start or End grip points in Model Space",
            "effect": "Chase path updates. Joists are re-evaluated. Machining is added to new intersecting beams, removed from non-intersecting beams."
          },
          {
            "action": "Change Shape",
            "how": "Edit 'Shape' property in OPM",
            "effect": "Switches tooling logic (e.g., BeamCut to Drill). Updates all affected joists."
          },
          {
            "action": "Rotate/Align",
            "how": "Drag 'Center' grip or use specific '_PtG' grip logic",
            "effect": "Script constrains movement to perpendicular lines if 'Keep Perpendicular' is Yes, otherwise moves freely in plane."
          }
        ]
      },
      "tokens_used": 7550,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# FLR_Chase.mcr\n\n## Overview\nThis script automates the creation of floor chases (openings or notches) in joists and trusses. It is used to cut rectangular, round, or oval openings through multiple structural members along a defined path to accommodate HVAC ducts, plumbing, or wiring.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model to modify beam geometry. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | Does not generate 2D drawings directly. |\n\n## Prerequisites\n- **Required Entities**: A Floor or Roof Element containing Joists or Beams must exist in the model.\n- **Minimum Beam Count**: 0 (The script will run, but requires at least one intersecting joist to create a visible cut).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `FLR_Chase.mcr`\n\n### Step 2: Configure Properties\n**Action:** Upon insertion, the Properties Palette (OPM) will open.\n- Adjust parameters such as **Shape**, **Width**, **Height**, and **Offset** now or after insertion.\n- Click in the model space to begin defining the chase location.\n\n### Step 3: Define Path\n```\nCommand Line: Select start point\nAction: Click the location where the chase should begin.\n```\n\n### Step 4: Define End Point\n```\nCommand Line: Select next point\nAction: Click the location where the chase should end. This defines the centerline path of the opening.\n```\n\n### Step 5: Select Reference Element\n```\nCommand Line: Select a reference Element\nAction: Click the Floor or Roof element that contains the joists you wish to cut. This provides the height reference for the script.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Shape | dropdown | Rectangular | The geometry of the cut: Rectangular, Round, or Oval. |\n| Width (dW) | number | 12.0 | The width of the chase (inches). For Oval shapes, this is the minor axis. |\n| Height (dH) | number | 4.0 | The height of the chase (inches). For Round shapes, this acts as the Diameter. |\n| Offset (dZOff) | number | 0.0 | Vertical offset (inches) from the center of the reference element. Moves the hole up or down. |\n| Joists to use | dropdown | All Floor Joists | Determines the scope of beams to cut. \"All Floor Joists\" includes broader groups; \"Only Element Joists\" restricts cuts to the specific element selected. |\n| Keep Perpendicular | dropdown | Yes | If \"Yes\", only joists running perpendicular to the chase path are cut. If \"No\", any intersecting joist will be cut. |\n| Dim Style | dropdown | Current DimStyle | The dimension style used for the 3D text label annotation. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the machining based on current property values or if beam positions have changed. |\n| Erase | Removes the script instance and the associated cuts from the model. |\n\n## Settings Files\nNone required.\n\n## Tips\n- **Moving the Chase:** You can drag the Start and End grip points in the model after insertion to resize or move the chase. The machining will automatically update.\n- **Perpendicular Logic:** Use the \"Keep Perpendicular\" setting set to \"Yes\" to avoid accidentally cutting rim joists or headers that run parallel to the chase path.\n- **Oval Shapes:** When using the Oval shape, the script calculates the geometry based on the smaller of your Width and Height values to create the corner radii.\n- **Visual Feedback:** A 3D text label is generated showing the size and offset of the chase for easy identification in the model.\n\n## FAQ\n- **Q: What happens if I select \"Round\" shape?**\n  **A:** The script ignores the \"Width\" parameter and uses the \"Height\" parameter as the diameter to create a cylindrical drill hole.\n- **Q: Why did the script not cut a specific joist that crosses the line?**\n  **A:** Check if \"Keep Perpendicular\" is set to \"Yes\". If enabled, joists that are not at a near-90-degree angle to the chase path will be ignored. Also, ensure the joist is part of the group defined in \"Joists to use\".\n- **Q: How do I lower the chase to avoid a top plate?**\n  **A:** Use the \"Offset\" property. A negative value moves the chase downward relative to the element center."
      },
      "tokens_used": 6598,
      "error": null
    }
  }
}