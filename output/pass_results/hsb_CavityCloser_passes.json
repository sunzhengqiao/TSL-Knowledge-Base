{
  "filename": "hsb_CavityCloser.mcr",
  "status": "completed",
  "total_tokens": 30609,
  "processing_time": 217.52576088905334,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "01.02.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "09.02.2010",
            "author": null,
            "changes": "Add an index on the information to export"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3880,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script attaches to ElementWallSF entities and performs 3D calculations based on opening widths and heights (OpeningSF). It generates ElemItems for export purposes. There is no usage of ShopDrawing APIs (sd_*), Viewport interaction, or 2D drawing generation."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF",
            "Opening"
          ],
          "minimumBeams": 0,
          "requiredSpace": "The script must be attached to a valid ElementWallSF that contains at least one OpeningSF; otherwise, the instance erases itself.",
          "requiredSettings": []
        }
      },
      "tokens_used": 3597,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialogOnce",
            "trigger": "On insert if _kExecuteKey is empty",
            "title": null,
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sTimberWidth",
            "type": "PropString",
            "displayName": "Timber Width",
            "defaultValue": "38",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sTimberHeight",
            "type": "PropString",
            "displayName": "Timber Height",
            "defaultValue": "50 Sawn",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sTimberLength",
            "type": "PropString",
            "displayName": "Timber Length",
            "defaultValue": "4800",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "DimStyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sDispRep",
            "type": "PropString",
            "displayName": "Show In Display Rep",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Set the Text Color",
            "defaultValue": 171,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Offset Between Lines",
            "defaultValue": "U(100)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5141,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Calculates the total linear meterage of timber required for cavity closers based on wall openings and exports it as a non-physical material item (BOM entry).\",\n    \"category\": \"Reporting/MaterialList\",\n    \"typicalUseCase\": \"Used during the detailing phase to automatically estimate raw material needs for closing wall cavities around windows and doors, ensuring a 15% waste allowance is factored into the calculation.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sTimberWidth\",\n      \"technicalDefault\": \"\\\"38\\\"\",\n      \"businessMeaning\": \"The cross-sectional width (or thickness relative to the wall face) of the timber stock to be used for the cavity closers.\",\n      \"validRange\": \"30 - 200 (Typical timber sizes in mm)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Sets the 'WIDTH' attribute in the exported ElemItem (BOM entry).\"\n    },\n    {\n      \"name\": \"sTimberHeight\",\n      \"technicalDefault\": \"\\\"50 Sawn\\\"\",\n      \"businessMeaning\": \"The cross-sectional height (or depth) of the timber stock to"
      },
      "tokens_used": 6923,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched via command or AutoCAD palette.",
          "Check if insertion event (_bOnInsert) is active.",
          "If inserting, check insertCycleCount. If > 1, erase self and exit.",
          "If inserting and _kExecuteKey is empty, display the Properties Dialog (showDialogOnce).",
          "Prompt user to select a set of elements (PrEntity).",
          "If user cancels selection (ssE.go() fails), script ends (implicit exit).",
          "Iterate through selected elements.",
          "For each element, create a new instance of this script attached to that element, transferring current property values.",
          "Erase the original 'controller' instance and exit.",
          "If not inserting (Running/Regen), verify _Element array is not empty. If empty, erase self and exit.",
          "Cast the first element to ElementWallSF. If invalid, erase self and exit.",
          "Clean up duplicate scripts: Iterate through TSL instances attached to the wall and erase any other instances of this script with a different handle.",
          "Retrieve openings from the wall. If no openings exist, erase self and exit.",
          "Iterate through wall openings.",
          "Skip invalid openings (non-OpeningSF types).",
          "Check Opening Type (Door vs others).",
          "Calculate total cavity closer length: Doors = Width * 1.15; Others = (Height * 2) * 1.15.",
          "Format the total calculated length into a string.",
          "Create a non-physical ElemItem (BOM entry) named 'CAVITYCLOSER' with dimensions, stock length, and total required length.",
          "Add the ElemItem to the wall.",
          "Draw a temporary display string 'Test' at wall origin.",
          "Assign the script instance to the element group."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Check (insertCycleCount > 1)",
            "path1": {
              "name": "Abort Insertion",
              "steps": [
                "EraseInstance",
                "Return"
              ]
            },
            "path2": {
              "name": "Proceed Insertion",
              "steps": [
                "Check Execute Key",
                "Show Dialog (if needed)",
                "Prompt for Selection"
              ]
            }
          },
          {
            "condition": "User Selection (ssE.go())",
            "path1": {
              "name": "Valid Selection",
              "steps": [
                "Iterate elements",
                "Create attached instances",
                "Erase controller instance"
              ]
            },
            "path2": {
              "name": "Cancelled/Empty Selection",
              "steps": [
                "Script exits naturally (no elements processed)"
              ]
            }
          },
          {
            "condition": "Attached Element Validation (_Element.length <= 0 or !el.bIsValid)",
            "path1": {
              "name": "Invalid Attachment",
              "steps": [
                "EraseInstance",
                "Return"
              ]
            },
            "path2": {
              "name": "Valid Wall Element",
              "steps": [
                "Proceed to duplicate cleanup and opening analysis"
              ]
            }
          },
          {
            "condition": "Wall Openings Exist (opAll.length < 1)",
            "path1": {
              "name": "No Openings",
              "steps": [
                "EraseInstance",
                "Return"
              ]
            },
            "path2": {
              "name": "Openings Found",
              "steps": [
                "Iterate openings",
                "Calculate lengths"
              ]
            }
          },
          {
            "condition": "Opening Type (op.openingType() == _kDoor)",
            "path1": {
              "name": "Door Opening",
              "steps": [
                "Add Width * 1.15 to Total Length"
              ]
            },
            "path2": {
              "name": "Window/Other Opening",
              "steps": [
                "Add (Height * 2) * 1.15 to Total Length"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Is the script instance a duplicate created during the insert cycle?",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script self-destructs automatically; user does not need to act."
          },
          {
            "check": "Is the attached entity a valid ElementWallSF?",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script self-destructs if attached to non-wall or invalid entity."
          },
          {
            "check": "Does the wall contain valid OpeningSF entities?",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script self-destructs if no openings are found."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Timber Dimensions (Width/Height/Length)",
            "how": "OPM (Object Properties Manager)",
            "effect": "Updates the attributes (THICKNESS, WIDTH, LENGTH) of the exported BOM ElemItem."
          },
          {
            "action": "Modify Display Settings (Color/Offset)",
            "how": "OPM",
            "effect": "Changes the visual representation of the 'Test' display text."
          },
          {
            "action": "Change Wall Geometry (Add/Remove/Resize Openings)",
            "how": "hsbCAD Wall / Opening Edit Tools",
            "effect": "Triggers script recalculation. If openings are removed or wall becomes invalid, script erases itself. Otherwise, the calculated 'LENGTH' attribute in the BOM updates to reflect new opening sizes."
          },
          {
            "action": "Delete the Wall",
            "how": "AutoCAD Erase",
            "effect": "Script instance and associated BOM item are deleted with the wall."
          }
        ]
      },
      "tokens_used": 5528,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_CavityCloser\n\n## Overview\nThis script automatically calculates the total linear meterage of timber required for cavity closers based on wall openings. It exports this data as a non-physical BOM entry (material list) attached to the wall, including a standard 15% waste allowance.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be attached to ElementWallSF entities in the 3D model. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | Does not generate 2D drawings or shop views. |\n\n## Prerequisites\n- **Required Entities**: The script requires `ElementWallSF` entities that contain `OpeningSF` entities (windows or doors).\n- **Minimum Beam Count**: 0.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Select `hsb_CavityCloser.mcr` from the file list.\n3.  Click **Open**.\n\n### Step 2: Select Walls\n```\nCommand Line: Select a set of elements\nAction: Click on the walls (ElementWallSF) you wish to process. You can select multiple walls.\n```\n\n### Step 3: Configure Properties (Optional)\n1.  After selection, the script attaches to the selected walls.\n2.  If this is the first time running the script, a properties dialog may appear automatically.\n3.  Alternatively, select a wall and press `Ctrl+1` to open the **Properties Palette** to adjust Timber Width, Height, and other settings.\n\n### Step 4: Review Results\n1.  The script calculates the timber length automatically.\n2.  To see the calculated material, look at the wall's BOM/Element Items. An entry named `CAVITYCLOSER` will be added with the total length required.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Timber Width | Text | \"38\" | The cross-sectional width (in mm) of the timber stock to be used. |\n| Timber Height | Text | \"50 Sawn\" | The cross-sectional height/depth of the timber stock. |\n| Timber Length | Text | \"4800\" | The standard stock length (in mm) of the timber available for cutting. |\n| DimStyle | Dropdown | <None> | Select a specific dimension style for text display (if applicable). |\n| Show In Display Rep | Dropdown | <None> | Controls in which display representations the script is visible. |\n| Set the Text Color | Number | 171 | Determines the color of any text generated by the script. |\n| Offset Between Lines | Number | 100 | Sets the vertical offset (in internal units) between lines of text display. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific items to the right-click context menu. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Waste Calculation**: The script automatically adds 15% to the calculated length to account for cutting waste.\n- **Door vs Window Logic**: The calculation logic differs based on the opening type:\n    - **Doors**: Calculates `Width * 1.15`.\n    - **Windows/Others**: Calculates `(Height * 2) * 1.15`.\n- **Automatic Cleanup**: If you delete all openings from a wall, the script will detect this and remove itself automatically to keep the project clean.\n- **Updating Data**: If you resize a window or door, the script will recalculate the material length the next time the model regenerates.\n\n## FAQ\n- **Q: Where can I see the calculated total length?**\n- **A:** The script creates an \"ElemItem\" attached to the wall. You can view this in your BOM/Material List exports or by querying the element items of the specific wall.\n\n- **Q: The script disappeared from my wall.**\n- **A:** This happens if the wall has no openings or is deleted. Ensure your wall has valid Door or Window entities attached.\n\n- **Q: How do I change the timber size used for the calculation?**\n- **A:** Select the wall, open the Properties Palette (Ctrl+1), and modify the \"Timber Width\" or \"Timber Height\" fields. The BOM entry will update accordingly."
      },
      "tokens_used": 5540,
      "error": null
    }
  }
}