{
  "filename": "BMF U Shoe.mcr",
  "status": "completed",
  "total_tokens": 26922,
  "processing_time": 261.0795953273773,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 1,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4945,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script generates 3D geometry (Body objects) using coordinates relative to _Pt0 and interacts with _Beam0 (GenBeam). It does not contain ShopDrawing specific prefixes like 'sd_' or 'Multipage*', nor does it use _Viewport or #Type E constructs. The logic focuses on material generation, cutting operations (_Beam0.addTool), and creating physical parts in 3D space."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 2278,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dBaseHeigh",
            "type": "PropDouble",
            "displayName": "Base Heigh",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "strFixing",
            "type": "PropString",
            "displayName": "Type of Fixing",
            "defaultValue": "Nails",
            "inputType": "dropdown",
            "options": [
              "Nails",
              "Screws"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4875,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 3D model of a galvanized steel 'U Shoe' connector (BMF series) for specific beam widths, creating the necessary hardware geometry and machining cuts on the timber beam.",
          "category": "Hardware/Connector",
          "typicalUseCase": "Used when a specific metal shoe (BMF - 290xx series) is required to support or connect a timber joist or purlin to a substructure, providing a secure connection point."
        },
        "parameters": [
          {
            "name": "dBaseHeigh",
            "technicalDefault": "0",
            "businessMeaning": "The axial offset of the shoe assembly along the beam relative to the insertion point. It sets the distance the shoe is shifted from the beam's start or end reference.",
            "validRange": "0 mm to ~300 mm (depending on beam length)",
            "unit": "mm",
            "affectsOutput": "Shifts the entire U-shaped shoe geometry (base plate and side plates) along the beam's axis. Simultaneously adjusts the position of the perpendicular cut/notch applied to the timber beam to ensure the shoe and beam cut align correctly."
          },
          {
            "name": "strFixing",
            "technicalDefault": "Nails",
            "businessMeaning": "Specifies the intended fastener method for installing the shoe onto the timber.",
            "validRange": "Nails, Screws",
            "unit": "Selection (String)",
            "affectsOutput": "Updates the Article Number (Model) and Designation string for reporting and labeling purposes (e.g., appending '-Nails' to the part name). It does not change the physical geometry of the shoe or beam."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Beam Width (Selection of _Beam0)",
            "effect": "The script looks up the beam width and selects the corresponding U Shoe dimensions from internal arrays. If the width does not match a supported size (45, 50, 60, 70, 80, 90, 100, 120mm), the script fails.",
            "cascade": [
              "Shoe Width (arSb)",
              "Shoe Back Height (arSh1)",
              "Shoe Base Height (arSh2)",
              "Base Model Code (strSm)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (Steel Plates)",
            "description": "A galvanized steel assembly consisting of a bottom base plate, two lateral side plates, and internal stiffener plates, forming a U-shape tailored to the beam width.",
            "appliedTo": "ModelSpace (positioned relative to _Beam0)"
          },
          {
            "type": "Cut (Machining)",
            "description": "A perpendicular cut applied to the timber beam at the calculated offset, likely shortening the beam or creating a seat for the shoe connection.",
            "appliedTo": "_Beam0"
          }
        ]
      },
      "tokens_used": 5169,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Insertion triggered by user or plugin.",
          "Initialize unit system to millimeters.",
          "Visualize local coordinate axes at insertion point _Pt0.",
          "Define Properties: 'dBaseHeigh' (Double, 0.0) and 'strFixing' (String, Nails/Screws).",
          "Detect and validate reference beam (_Beam0).",
          "Calculate beam width (dMw) and height (dMh).",
          "Lookup beam width in predefined size array [45, 50, 60, 70, 80, 90, 100, 120].",
          "[Validation Check] Verify beam width matches a supported size.",
          "Retrieve specific dimensions (dSb, dSh1, dSh2) and Model Name (strSm) based on the matched index.",
          "Calculate geometry variables: shoe width (dSb), back height (dSh1), base thickness (dSh2), plate thickness (dSt), and length (dSl).",
          "Execute 'Cut' operations on _Beam0: Apply perpendicular cut at offset (dBaseHeigh + dSh2).",
          "Generate 'Bottom Plate' geometry based on shoe width and length.",
          "Generate 'Lateral Plates' geometry: Create one plate, rotate 180 degrees to create the pair.",
          "Generate 'Internal Plates' geometry: Create stiffeners, rotate to create opposing set, and create front connecting plate.",
          "Update Model Strings: Append fixing type ('-Nails' or '-Screws') to Model Name and Designation.",
          "Assign Attributes: Set CompareKey, Model Number, Designation, and Material ('Galvanized Steel').",
          "Render final 3D geometry in the model."
        ],
        "conditionalBranches": [
          {
            "condition": "Beam Width Compatibility Check",
            "path1": {
              "name": "Valid Beam Size",
              "steps": [
                "Beam width matches one of the predefined sizes (45, 50, 60... 120mm).",
                "Index variable (iIndex) is set to the position of the match.",
                "Script proceeds to generate the specific U Shoe geometry.",
                "Machining cuts are applied to the beam."
              ]
            },
            "path2": {
              "name": "Invalid Beam Size",
              "steps": [
                "Beam width does not match any predefined size within tolerance.",
                "Index variable (iIndex) remains -1.",
                "Report error message: 'Shoe cannot be used!'.",
                "Erase the current script instance.",
                "Script execution terminates."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Width Validation",
            "errorMessage": "\nShoe cannot be used!",
            "recovery": "The user must select a beam with a width corresponding to the supported sizes (45, 50, 60, 70, 80, 90, 100, or 120mm) to successfully insert the script."
          },
          {
            "check": "Beam Selection",
            "errorMessage": "Implicit Failure (Standard hsbCAD behavior if _Beam0 is missing).",
            "recovery": "The user must insert the script onto a valid GenBeam entity in the model."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Base Height Offset",
            "how": "OPM Properties Palette (Edit 'Base Heigh')",
            "effect": "Moves the shoe assembly along the beam axis and updates the position of the beam cut correspondingly."
          },
          {
            "action": "Change Fixing Type",
            "how": "OPM Properties Palette (Edit 'Type of Fixing')",
            "effect": "Updates the Article Number and Designation string (e.g., switching between 'Nails' and 'Screws'). Does not affect geometry."
          },
          {
            "action": "Move Script",
            "how": "Grip Edit (Drag _Pt0)",
            "effect": "Repositions the entire connector assembly and associated machining relative to the new insertion point on the beam."
          }
        ]
      },
      "tokens_used": 4742,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# BMF U Shoe\n\n## Overview\nThis script generates a detailed 3D model of a galvanized steel \"U Shoe\" connector (BMF series) tailored to specific timber beam widths. It automatically creates the steel hardware geometry (base plate, side plates, and stiffeners) and applies the necessary perpendicular cut to the timber beam.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script generates 3D bodies and beam machining. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | This is a modeling script, not a detailing tool. |\n\n## Prerequisites\n- **Required Entity:** A single Timber Beam (`GenBeam`) in the model.\n- **Beam Width Constraint:** The beam width must exactly match one of the supported sizes: 45, 50, 60, 70, 80, 90, 100, or 120 mm.\n- **Minimum Beam Count:** 1\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `BMF U Shoe.mcr`\n\n### Step 2: Select Reference Beam\n```\nCommand Line: Select beam:\nAction: Click on the timber beam where you want to insert the U Shoe connection.\n```\n*Note: The script will automatically detect the beam width. If the width does not match the supported sizes, the insertion will fail with the error \"Shoe cannot be used!\".*\n\n### Step 3: Configure Properties\nAfter insertion, the shoe is generated immediately. To adjust its position or settings, select the script instance in the model and open the **Properties Palette** (Ctrl+1).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Base Heigh | Number | 0 | The axial offset along the beam. Use this to slide the shoe assembly forwards or backwards from the insertion point. It updates both the shoe position and the beam cut simultaneously. |\n| Type of Fixing | Dropdown | Nails | Select the preferred fastener type. Options are **Nails** or **Screws**. This only updates the Article Number and Designation labels for reporting; it does not change the physical geometry. |\n\n## Right-Click Menu Options\nThere are no custom context menu options for this script. Use the standard AutoCAD/hsbCAD grips to move the insertion point.\n\n## Settings Files\nNo external settings files are used by this script. All dimensions are hardcoded based on the detected beam width.\n\n## Tips\n- **Beam Compatibility:** Before inserting, verify your beam width. If your project uses custom widths not listed in the prerequisites (e.g., 140mm), the script will not run.\n- **Positioning:** If you need to move the shoe to a different location along the beam, you can drag the grip point (the insertion coordinate) or adjust the **Base Heigh** property in the palette for precise control.\n- **Reporting:** Ensure you select the correct **Type of Fixing** if your BOM or production lists require specific fastener descriptions (e.g., \"BMF-290xx-Nails\" vs \"BMF-290xx-Screws\").\n\n## FAQ\n- **Q: I get an error \"Shoe cannot be used!\" when I click the beam. Why?**\n  A: The width of the beam you selected does not match one of the predefined hardware sizes (45, 50, 60, 70, 80, 90, 100, or 120mm). Check your beam properties and ensure the width is correct.\n\n- **Q: Does changing the fixing type add holes for nails or screws?**\n  A: No. This parameter only changes the text label (Article Number) for the part. It does not alter the 3D geometry of the steel shoe.\n\n- **Q: Can I use this on a beam that is already machined?**\n  A: Yes, the script adds its own cut to the beam. However, ensure the new cut does not conflict with existing machining operations."
      },
      "tokens_used": 4913,
      "error": null
    }
  }
}