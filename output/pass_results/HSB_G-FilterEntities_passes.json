{
  "filename": "HSB_G-FilterEntities.mcr",
  "status": "completed",
  "total_tokens": 40306,
  "processing_time": 334.9890627861023,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 3,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl filters a set of enities",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "23.11.2017",
            "author": "RP",
            "changes": "Pilot version based on HSB_G-FilterGenbeams"
          },
          {
            "version": "1.01",
            "date": "01.05.2018",
            "author": "RP",
            "changes": "Add any/all operator"
          },
          {
            "version": "1.02",
            "date": "08.05.2018",
            "author": "RP",
            "changes": "Make upper on values"
          },
          {
            "version": "1.03",
            "date": "12.09.2018",
            "author": "RP",
            "changes": "For loop was not using index but always the first in the list"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6448,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity for selection and operates on generic Entity objects. It lacks sd_*, Multipage* prefixes, _Viewport checks, and #Type E declarations. It performs utility filtering on selected entities."
        },
        "prerequisites": {
          "requiredEntities": [
            "Entity"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "HSB_G-ContentFormat"
          ]
        }
      },
      "tokens_used": 3896,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select entities to filter",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert (if not triggered by execute key)",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "operationFilter",
            "type": "PropString",
            "displayName": "Operation filter",
            "defaultValue": "|Exclude|",
            "inputType": "dropdown",
            "options": [
              "|Exclude|",
              "|Include|"
            ],
            "category": "|Operation|",
            "description": "|Include or exclude entities meeting the filter criteria.|"
          },
          {
            "index": 1,
            "variable": "operator",
            "type": "PropString",
            "displayName": "Operation comparison",
            "defaultValue": "|All|",
            "inputType": "dropdown",
            "options": [
              "|All|",
              "|Any|"
            ],
            "category": "|Operation|",
            "description": "|Specify if check needs to be done on all or any value.|"
          },
          {
            "index": 2,
            "variable": "propCustom1",
            "type": "PropString",
            "displayName": "Custom Propertie 1",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Format Properties 1|",
            "description": "|Specify a custom propertie e.g. @(Material) or @(PropertySet.Property)||To check which properties are available on an entitie, use the custom action on the tsl HSB_G-ContentFormat|"
          },
          {
            "index": 3,
            "variable": "valueCustom1",
            "type": "PropString",
            "displayName": "Custom Value 1",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Format Properties 1|",
            "description": "|Specify the value to check the custom property, * can be used as wildcard and as delimiter| ;"
          },
          {
            "index": 4,
            "variable": "propCustom2",
            "type": "PropString",
            "displayName": "Custom Propertie 2",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Format Properties 2|",
            "description": "|Specify a custom propertie e.g. @(Material) or @(PropertySet.Property)||To check which properties are available on an entitie, use the custom action on the tsl HSB_G-ContentFormat|"
          },
          {
            "index": 5,
            "variable": "valueCustom2",
            "type": "PropString",
            "displayName": "Custom Value 2",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Format Properties 2|",
            "description": "|Specify the value to check the custom property, * can be used as wildcard and as delimiter| ;"
          },
          {
            "index": 6,
            "variable": "propCustom3",
            "type": "PropString",
            "displayName": "Custom Propertie 3",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Format Properties 3|",
            "description": "|Specify a custom propertie e.g. @(Material) or @(PropertySet.Property)||To check which properties are available on an entitie, use the custom action on the tsl HSB_G-ContentFormat|"
          },
          {
            "index": 7,
            "variable": "valueCustom3",
            "type": "PropString",
            "displayName": "Custom Value 3",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Format Properties 3|",
            "description": "|Specify the value to check the custom property, * can be used as wildcard and as delimiter| ;"
          },
          {
            "index": 8,
            "variable": "propCustom4",
            "type": "PropString",
            "displayName": "Custom Propertie 4",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Format Properties 4|",
            "description": "|Specify a custom propertie e.g. @(Material) or @(PropertySet.Property)||To check which properties are available on an entitie, use the custom action on the tsl HSB_G-ContentFormat|"
          },
          {
            "index": 9,
            "variable": "valueCustom4",
            "type": "PropString",
            "displayName": "Custom Value 4",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Format Properties 4|",
            "description": "|Specify the value to check the custom property, * can be used as wildcard and as delimiter| ;"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6606,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Filters a selection of CAD entities based on custom property data, allowing users to isolate specific items (e.g., specific materials, sizes, or naming conventions) for further processing or modification.",
          "category": "Utility/Data Management",
          "typicalUseCase": "Selecting all structural elements marked as 'Kerto' to apply a specific machining rule, or filtering out all elements with a specific 'Status' property from a selection."
        },
        "parameters": [
          {
            "name": "operationFilter",
            "technicalDefault": "|Exclude|",
            "businessMeaning": "Determines whether the script keeps or discards entities that match the specified criteria. 'Include' retains matches; 'Exclude' removes matches.",
            "validRange": "Include, Exclude",
            "unit": "enum",
            "affectsOutput": "Inverts the final selection set logic."
          },
          {
            "name": "operator",
            "technicalDefault": "|All|",
            "businessMeaning": "Defines the Boolean logic used when multiple custom properties (1 through 4) are defined. 'All' requires the entity to match every active property; 'Any' requires the entity to match at least one.",
            "validRange": "All, Any",
            "unit": "enum",
            "affectsOutput": "Controls the strictness of the filtering when multiple criteria are active."
          },
          {
            "name": "propCustom1",
            "technicalDefault": "",
            "businessMeaning": "The name of the first property to inspect on the entity (e.g., Material, ElementNumber).",
            "validRange": "Any valid property name available on the entity (often requires @ prefix).",
            "unit": "text",
            "affectsOutput": "Identifies which data field to evaluate."
          },
          {
            "name": "valueCustom1",
            "technicalDefault": "",
            "businessMeaning": "The value that 'propCustom1' must match. Supports wildcards (*) and multiple values separated by semicolons (;).",
            "validRange": "Text string, wildcards, or semicolon-delimited list.",
            "unit": "text",
            "affectsOutput": "The target value used for comparison against the entity's property."
          },
          {
            "name": "propCustom2",
            "technicalDefault": "",
            "businessMeaning": "The name of the second property to inspect, used for multi-condition filtering.",
            "validRange": "Any valid property name available on the entity.",
            "unit": "text",
            "affectsOutput": "Identifies a secondary data field to evaluate."
          },
          {
            "name": "valueCustom2",
            "technicalDefault": "",
            "businessMeaning": "The value that 'propCustom2' must match. Supports wildcards and delimiters.",
            "validRange": "Text string, wildcards, or semicolon-delimited list.",
            "unit": "text",
            "affectsOutput": "The target value for the secondary comparison."
          },
          {
            "name": "propCustom3",
            "technicalDefault": "",
            "businessMeaning": "The name of the third property to inspect.",
            "validRange": "Any valid property name available on the entity.",
            "unit": "text",
            "affectsOutput": "Identifies a tertiary data field to evaluate."
          },
          {
            "name": "valueCustom3",
            "technicalDefault": "",
            "businessMeaning": "The value that 'propCustom3' must match.",
            "validRange": "Text string, wildcards, or semicolon-delimited list.",
            "unit": "text",
            "affectsOutput": "The target value for the tertiary comparison."
          },
          {
            "name": "propCustom4",
            "technicalDefault": "",
            "businessMeaning": "The name of the fourth property to inspect.",
            "validRange": "Any valid property name available on the entity.",
            "unit": "text",
            "affectsOutput": "Identifies a quaternary data field to evaluate."
          },
          {
            "name": "valueCustom4",
            "technicalDefault": "",
            "businessMeaning": "The value that 'propCustom4' must match.",
            "validRange": "Text string, wildcards, or semicolon-delimited list.",
            "unit": "text",
            "affectsOutput": "The target value for the quaternary comparison."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Populating propCustom1 through propCustom4",
            "effect": "The corresponding valueCustomX parameter becomes active. If the property is empty, the value is ignored.",
            "cascade": [
              "valueCustom1",
              "valueCustom2",
              "valueCustom3",
              "valueCustom4"
            ]
          },
          {
            "trigger": "Populating multiple Custom Properties (1, 2, 3, 4)",
            "effect": "The 'operator' parameter determines how these multiple conditions interact (AND vs OR logic).",
            "cascade": [
              "operator"
            ]
          },
          {
            "trigger": "Setting the filter criteria",
            "effect": "The 'operationFilter' parameter determines if the matching entities are kept or removed from the final set.",
            "cascade": [
              "operationFilter"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Entity Selection Set",
            "description": "The script does not create geometry. Instead, it outputs a filtered array of Entity objects (e.g., Beams, Columns) that match the user's criteria, which can then be passed to another script or selected in the model.",
            "appliedTo": "User-selected input entities in Model Space."
          }
        ]
      },
      "tokens_used": 7843,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Script loads, defines properties, and checks if an execute key was used.",
          "2. Property Setup: If an execute key is found, properties are loaded from the catalog. Otherwise, default properties are used.",
          "3. User Interaction (Insert Only): If inserting manually, the ShowDynamicDialog is displayed to configure filter criteria (Include/Exclude, Any/All, Property/Value pairs).",
          "4. Entity Selection: User selects the set of entities to filter via the 'Select entities to filter' prompt.",
          "5. Data Staging: Selected entities are stored in the _Map, and a 'ManualInsert' flag is set to true.",
          "6. Execution Trigger: The script detects _bOnMapIO or the ManualInsert flag to begin processing.",
          "7. Property Preprocessing: Input values for Custom Properties are processed (tokenized by ';', converted to uppercase).",
          "8. Entity Iteration: The script loops through every entity in the stored selection array.",
          "9. Criteria Evaluation: For each entity, the script calls 'HSB_G-ContentFormat' for each of the 4 custom property slots to check for matches against the specified values.",
          "10. Logic Resolution: The match results are combined based on the 'operator' setting (Any = OR, All = AND).",
          "11. Final Filtering: The result is inverted if 'operationFilter' is set to Exclude. Entities are either added to the 'resultingEntities' array or skipped.",
          "12. Output Generation: The filtered array of entities is stored back into the _Map.",
          "13. Completion & Cleanup: If triggered by manual insert, a success message is displayed to the user, and the script instance is erased."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Method",
            "path1": {
              "name": "Execute Key",
              "steps": [
                "Properties loaded from catalog matching the key.",
                "Dialog is skipped (unless key is invalid/not found).",
                "Entity selection prompt appears immediately."
              ]
            },
            "path2": {
              "name": "Manual Insert",
              "steps": [
                "ShowDynamicDialog appears for user configuration.",
                "User confirms settings.",
                "Entity selection prompt appears."
              ]
            }
          },
          {
            "condition": "Operator Logic",
            "path1": {
              "name": "Any (OR)",
              "steps": [
                "Entity matches if 'matchingCustom1' OR 'matchingCustom2' OR 'matchingCustom3' OR 'matchingCustom4' is true.",
                "If 'Include', keep entity. If 'Exclude', discard entity."
              ]
            },
            "path2": {
              "name": "All (AND)",
              "steps": [
                "Entity matches only if ALL active criteria (defined Custom Properties) are true.",
                "If no criteria are defined, entity is automatically included.",
                "If 'Include', keep entity. If 'Exclude', discard entity."
              ]
            }
          },
          {
            "condition": "Map Data Source",
            "path1": {
              "name": "Legacy Integer Map",
              "steps": [
                "Checks for 'Exclude' and 'Any' integers in _Map.",
                "Sets 'operationFilter' and 'operator' properties based on these integers."
              ]
            },
            "path2": {
              "name": "String Map",
              "steps": [
                "Checks for 'Custom1[]', 'Value1[]', etc., strings in _Map.",
                "Sets the corresponding PropString variables directly."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Dependency Check",
            "errorMessage": "Please make sure the tsl HSB_G-ContentFormat is loaded in the drawing",
            "recovery": "User must ensure the script 'HSB_G-ContentFormat.mcr' is loaded in the drawing for the filter logic to function."
          },
          {
            "check": "Entity Integrity",
            "errorMessage": "None",
            "recovery": "Internal loop checks `ent.bIsValid()` and skips any invalid entities automatically."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Review Filtered Selection",
            "how": "Command Line Report",
            "effect": "Upon manual insertion, the script prints the resulting filtered entities to the command line report and erases itself, effectively acting as a one-time filter utility."
          },
          {
            "action": "Reuse Filter Criteria",
            "how": "Execute Key / Catalog",
            "effect": "Settings can be saved to a catalog (_LastInserted or custom) to be recalled instantly via an execute key in future sessions, bypassing the dialog."
          }
        ]
      },
      "tokens_used": 8320,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-FilterEntities.mcr\n\n## Overview\nThis script allows you to filter a selection of CAD entities in Model Space based on custom property data. It helps you quickly isolate or exclude specific items (e.g., specific materials, sizes, or naming conventions) from a larger selection set.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This is the primary environment for selecting and filtering entities. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Script:** The script `HSB_G-ContentFormat.mcr` must be loaded in the drawing to retrieve property values.\n- **Selection:** You must have entities available to select during the script execution.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_G-FilterEntities.mcr`\n\n### Step 2: Configure Filter Criteria\n```\nAction: A properties dialog appears automatically upon insertion.\n```\n1.  **Operation Filter:** Choose **Include** to keep matching items or **Exclude** to remove them.\n2.  **Operation Comparison:** Choose **All** (AND logic) if entities must meet every condition, or **Any** (OR logic) if they only need to meet one condition.\n3.  **Custom Properties:** Enter up to 4 Property/Value pairs to define your filter.\n4.  Click **OK** to confirm settings.\n\n### Step 3: Select Entities\n```\nCommand Line: Select entities to filter\nAction: Click the entities or use a window selection in the model, then press Enter.\n```\n*Result:* The script processes the selection. The filtered set is passed along or reported, and the script instance erases itself.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Operation filter | dropdown | Exclude | Determines if matching entities are kept (**Include**) or removed (**Exclude**). |\n| Operation comparison | dropdown | All | Sets the logic for multiple filters: **All** (AND) requires every condition to be true; **Any** (OR) requires at least one to be true. |\n| Custom Propertie 1 | text | [Empty] | The name of the property to check (e.g., `Material`, `ElementNumber`). |\n| Custom Value 1 | text | [Empty] | The value to match. Use `*` as a wildcard or `;` to separate multiple values. |\n| Custom Propertie 2 | text | [Empty] | The name of the second property to check. |\n| Custom Value 2 | text | [Empty] | The value to match for the second property. |\n| Custom Propertie 3 | text | [Empty] | The name of the third property to check. |\n| Custom Value 3 | text | [Empty] | The value to match for the third property. |\n| Custom Propertie 4 | text | [Empty] | The name of the fourth property to check. |\n| Custom Value 4 | text | [Empty] | The value to match for the fourth property. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add specific context menu actions. It functions primarily via the Properties Palette during insertion. |\n\n## Settings Files\n- **Dependency:** `HSB_G-ContentFormat.mcr`\n- **Purpose:** This script is required to read and format the property data from the selected entities.\n\n## Tips\n- **Wildcards:** You can use `*` in the Value field to match partial text (e.g., `C24*` will find `C24-GradeA`).\n- **Multiple Values:** You can check against several values at once by separating them with a semicolon `;` (e.g., `Wood;Steel`).\n- **Finding Property Names:** If you don't know the exact name of a property, check the documentation or output of the `HSB_G-ContentFormat` script.\n- **Save Presets:** If you use a filter frequently, save your configured script instance to a Catalog entry. This allows you to run the filter instantly later using an execute key.\n\n## FAQ\n- **Q: Why did the script fail or filter nothing?**\n  A: Ensure that `HSB_G-ContentFormat.mcr` is loaded in your drawing. Also, verify that the Property Names (e.g., `Material`) actually exist on the entities you selected.\n- **Q: What is the difference between 'All' and 'Any'?**\n  A: If you set two conditions (e.g., Material=\"Wood\" and Name=\"Beam*\"), **All** will only find entities that are Wood AND start with Beam. **Any** will find entities that are Wood OR start with Beam (or both).\n- **Q: Can I filter by properties that aren't standard hsbCAD properties?**\n  A: Yes, as long as the property exists on the entity and the `HSB_G-ContentFormat` script can read it, you can reference it (e.g., `(PropertySet.CustomData)`)."
      },
      "tokens_used": 7193,
      "error": null
    }
  }
}