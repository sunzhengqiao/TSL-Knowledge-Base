{
  "filename": "HSB_E-SetDrillVisualizationType.mcr",
  "status": "completed",
  "total_tokens": 43447,
  "processing_time": 246.7249720096588,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "09.10.2013",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "2.00",
            "date": "04.06.2015",
            "author": "AS",
            "changes": "Add beam filter options (FogBugzId 1356)"
          },
          {
            "version": "2.01",
            "date": "04.06.2015",
            "author": "AS",
            "changes": "Update thumbnail"
          },
          {
            "version": "2.02",
            "date": "23.12.2015",
            "author": "AS",
            "changes": "Add filters. Set CNC-DrillElement properties through catalog."
          },
          {
            "version": "2.03",
            "date": "03.07.2017",
            "author": "DR",
            "changes": "Added option (Yes/No) to erase TSLs that don't match filters"
          },
          {
            "version": "2.04",
            "date": "29.09.2017",
            "author": "RP",
            "changes": "Set hardcoded sequence number"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "CNC_DrillElement"
        ]
      },
      "tokens_used": 6845,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script inserts instances into `_kModelSpace` during the `insertCycle`. It prompts the user to select `Element()` objects and attaches itself to them. It operates on the element's TSL instances (`el.tslInst()`) to modify properties of `CNC_DrillElement`. No `sd_` prefix, `_Viewport` logic, or drawing-specific entities are used."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Catalog entries for CNC_DrillElement",
            "Catalog entries for HSB_E-SetDrillVisualizationType"
          ]
        }
      },
      "tokens_used": 5519,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select one or more elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "Insertion if no execute key or execute key not in catalog list",
            "title": "Property Dialog (Default)",
            "dataSource": "Properties Palette inputs",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 1,
            "variable": "sInExcludeFilters",
            "type": "PropString",
            "displayName": "|Include|/|exclude|",
            "defaultValue": "|Include|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 2,
            "variable": "sFilterBC",
            "type": "PropString",
            "displayName": "|Filter beams with beamcode|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 3,
            "variable": "sFilterLabel",
            "type": "PropString",
            "displayName": "|Filter objects with label|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 4,
            "variable": "sFilterMaterial",
            "type": "PropString",
            "displayName": "|Filter objects with material|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 5,
            "variable": "sFilterHsbId",
            "type": "PropString",
            "displayName": "|Filter objects with hsb id|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Selection|",
            "description": null
          },
          {
            "index": 6,
            "variable": "sScriptNameDrill",
            "type": "PropString",
            "displayName": "|Scriptname drill tsl|",
            "defaultValue": "CNC_DrillElement",
            "inputType": "text",
            "options": [],
            "category": "|Drill|",
            "description": null
          },
          {
            "index": 2,
            "variable": "catalogDrillTsl",
            "type": "PropString",
            "displayName": "|Visualization Type|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": "|Drill|",
            "description": null
          },
          {
            "index": 7,
            "variable": "sDeleteTSLsIfDontMatchFilter",
            "type": "PropString",
            "displayName": "|Delete TSLs that don't match filters'|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6208,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically configures the visualization style (e.g., realistic, schematic) of drill holes generated by the CNC_DrillElement script, based on specific beam attributes.",
          "category": "Automation/CNC",
          "typicalUseCase": "Used when a user wants to change how drill holes are displayed (e.g., cylinders vs. lines) on specific groups of beams (like wall studs vs. floor joists) without editing each drill manually."
        },
        "parameters": [
          {
            "name": "sInExcludeFilters",
            "technicalDefault": "|Include|",
            "businessMeaning": "Determines if the filter criteria selects the beams to be processed ('Include') or selects the beams to be ignored while processing all others ('Exclude').",
            "validRange": "|Include|, |Exclude|",
            "unit": "Enumeration",
            "affectsOutput": "Inverts the selection logic for the filters. 'Include' only modifies matching beams; 'Exclude' modifies everything except matching beams."
          },
          {
            "name": "sFilterBC",
            "technicalDefault": "",
            "businessMeaning": "Filters beams based on their Beam Code (commercial or functional code). Supports wildcards (e.g., 'WALL*').",
            "validRange": "Any string matching project Beam Codes",
            "unit": "String",
            "affectsOutput": "Limits the update to beams whose Beam Code matches the pattern."
          },
          {
            "name": "sFilterLabel",
            "technicalDefault": "",
            "businessMeaning": "Filters beams based on their user-defined Label. Supports wildcards (e.g., '*Top*').",
            "validRange": "Any string matching project Labels",
            "unit": "String",
            "affectsOutput": "Limits the update to beams whose Label matches the pattern."
          },
          {
            "name": "sFilterMaterial",
            "technicalDefault": "",
            "businessMeaning": "Filters beams based on their Material grade/name (e.g., 'C24', 'GL28'). Supports wildcards.",
            "validRange": "Any string matching project Materials",
            "unit": "String",
            "affectsOutput": "Limits the update to beams whose Material matches the pattern."
          },
          {
            "name": "sFilterHsbId",
            "technicalDefault": "",
            "businessMeaning": "Filters beams based on their hsbId (production identifier). Supports wildcards.",
            "validRange": "Any string matching project hsbIds",
            "unit": "String",
            "affectsOutput": "Limits the update to beams whose hsbId matches the pattern."
          },
          {
            "name": "sScriptNameDrill",
            "technicalDefault": "CNC_DrillElement",
            "businessMeaning": "The name of the target TSL script that generates the drill holes to be modified.",
            "validRange": "Valid TSL script filename",
            "unit": "String",
            "affectsOutput": "Defines which script instances are searched for and updated. Usually hardcoded to 'CNC_DrillElement'."
          },
          {
            "name": "catalogDrillTsl",
            "technicalDefault": "",
            "businessMeaning": "The specific Catalog preset to apply to the target drill script. This preset contains the visualization settings (e.g., color, 3D body, simple lines).",
            "validRange": "List of catalog entries for the target script",
            "unit": "Catalog Name",
            "affectsOutput": "Changes the graphical representation of the drill holes in the model (e.g., from detailed 3D cylinders to schematic 2D lines)."
          },
          {
            "name": "sDeleteTSLsIfDontMatchFilter",
            "technicalDefault": "|No|",
            "businessMeaning": "If set to 'Yes', the script will permanently remove (delete) drill instances from beams that do not match the active filters.",
            "validRange": "|No|, |Yes|",
            "unit": "Enumeration",
            "affectsOutput": "Controls whether non-matching drill TSLs are erased from the element. If 'No', non-matching drills are left untouched."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sInExcludeFilters is set to |Exclude|",
            "effect": "Beams matching the filter criteria (BC, Label, Material, etc.) are skipped, and only non-matching beams are updated.",
            "cascade": [
              "sFilterBC",
              "sFilterLabel",
              "sFilterMaterial",
              "sFilterHsbId"
            ]
          },
          {
            "trigger": "All filters (sFilterBC, sFilterLabel, etc.) are empty",
            "effect": "The script treats the selection as 'Include All', forcing an update on all beams regardless of the 'Include/Exclude' setting, to prevent unintended deletions.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "TSL Property Modification",
            "description": "Updates the properties of existing 'CNC_DrillElement' instances to change their visualization type based on a catalog entry.",
            "appliedTo": "CNC_DrillElement TSL instances attached to GenBeams within the selected Element."
          },
          {
            "type": "TSL Erasure",
            "description": "Deletes CNC_DrillElement instances if 'sDeleteTSLsIfDontMatchFilter' is Yes and the beam does not match the criteria.",
            "appliedTo": "CNC_DrillElement TSL instances attached to GenBeams within the selected Element."
          }
        ]
      },
      "tokens_used": 7460,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script initializes and defines Properties (Filters, Catalog Selection, Delete Option).",
          "Check if launched via Catalog Execute Key.",
          "If Execute Key is valid, load properties from Catalog.",
          "Enter Insertion Phase (_bOnInsert).",
          "Check insertCycleCount; if > 1, erase instance and exit to prevent duplicates.",
          "If no Execute Key (or invalid), display Property Dialog (showDialog) for user input.",
          "Save current properties to '_LastInserted' catalog.",
          "Prompt user to Select one or more Elements (PrEntity).",
          "Iterate through selected Elements.",
          "For each Element: Remove existing invalid TSLs and remove existing instances of this script (cleanup).",
          "Attach new instance of this script to the Element (with 'ManualInserted' map flag).",
          "Report count of inserted TSLs, erase temporary insert instance, and exit.",
          "Enter Execution Phase (Instance attached to Element).",
          "Verify Element is valid; if not, warn and erase.",
          "If 'ManualInserted', load properties from '_LastInserted' catalog.",
          "Parse Filter Strings (BeamCode, Label, Material, HsbId) into arrays.",
          "Check if all Filters are empty; if true, force 'Exclude' mode to true (Apply to All logic).",
          "Get all TSL instances attached to the Element.",
          "Loop through TSLs: Skip invalid or non-target script (CNC_DrillElement) instances.",
          "Extract Beam attributes (Code, Label, Material, HsbId) from the Drill TSL's linked Beam.",
          "Compare Beam attributes against Filter arrays (Wildcard support).",
          "Determine Filter Match status (True/False).",
          "Evaluate logic: (Match AND Include Mode) OR (No Match AND Exclude Mode).",
          "If logic is True: Apply 'Visualization Type' catalog settings to the Drill TSL.",
          "If logic is False (Excluded by filters): Check 'Delete TSLs' property.",
          "If 'Delete TSLs' is Yes: Erase the Drill TSL instance.",
          "If 'Delete TSLs' is No: Leave Drill TSL unchanged.",
          "Erase self (this utility script instance) and exit."
        ],
        "conditionalBranches": [
          {
            "condition": "Launch Method (Catalog vs Manual)",
            "path1": {
              "name": "Catalog Execution",
              "steps": [
                "Check if _kExecuteKey exists in HSB_E-SetDrillVisualizationType catalog.",
                "If yes, load preset properties directly.",
                "Skip Property Dialog."
              ]
            },
            "path2": {
              "name": "Manual Execution",
              "steps": [
                "Check if _kExecuteKey is missing or invalid.",
                "Trigger showDialog().",
                "User inputs properties manually.",
                "Proceed to Element selection."
              ]
            }
          },
          {
            "condition": "Filter Logic Evaluation",
            "path1": {
              "name": "Update Drill Visualization",
              "steps": [
                "Beam matches filters AND Mode is 'Include'.",
                "OR Beam does NOT match filters AND Mode is 'Exclude'.",
                "Action: Execute tsl.setPropValuesFromCatalog(catalogDrillTsl)."
              ]
            },
            "path2": {
              "name": "Handle Excluded Drills",
              "steps": [
                "Beam does NOT match filters AND Mode is 'Include'.",
                "OR Beam matches filters AND Mode is 'Exclude'.",
                "Check property sDeleteTSLsIfDontMatchFilter.",
                "If '|Yes|': Erase the Drill TSL.",
                "If '|No|': Do nothing (Preserve existing Drill)."
              ]
            }
          },
          {
            "condition": "Empty Filter State",
            "path1": {
              "name": "Global Apply (Safety Override)",
              "steps": [
                "All filter fields (BC, Label, Material, HsbId) are empty.",
                "Code overrides 'Include/Exclude' setting to force application on all beams.",
                "Result: All target Drill TSLs on the element are updated."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None (Silent)",
            "recovery": "Script automatically erases itself if insertCycleCount() > 1 to ensure single execution."
          },
          {
            "check": "Element Selection",
            "errorMessage": "None (Silent)",
            "recovery": "If user cancels PrEntity selection or provides empty set, script finishes without attaching TSLs."
          },
          {
            "check": "Element Attachment",
            "errorMessage": "|Invalid or no element selected.|",
            "recovery": "Script erases itself (_Element.length() == 0 check)."
          },
          {
            "check": "Drill TSL Integrity",
            "errorMessage": "None",
            "recovery": "Script skips TSLs where bIsValid() is false. It also skips Drill TSLs if they do not have a 'Beam' entity in their map."
          }
        ],
        "postInsertionActions": [
          {
            "action": "No Persistent Modification",
            "how": "N/A",
            "effect": "The script self-erases (eraseInstance()) immediately after processing. It does not remain in the model as an editable entity."
          },
          {
            "action": "Re-running the script",
            "how": "Re-insert the TSL via hsbCAD command.",
            "effect": "If attached to an element already containing this script, the new insertion process cleans up the old instance and attaches a fresh one with new settings."
          }
        ]
      },
      "tokens_used": 10248,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-SetDrillVisualizationType.mcr\n\n## Overview\nThis script allows you to batch update the visualization style (e.g., realistic, schematic, or 2D lines) of drill holes generated by the `CNC_DrillElement` script. It filters beams based on attributes like Beam Code, Material, or Label and applies specific catalog settings to the drill holes within selected Elements.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Select Elements in the 3D model to update their drill visualization. |\n| Paper Space | No | Not intended for use in Layouts. |\n| Shop Drawing | No | Does not process 2D drawing details. |\n\n## Prerequisites\n- **Required Entities**: Elements containing beams with drill holes (`CNC_DrillElement` instances already attached).\n- **Minimum Beam Count**: N/A (Operates on Elements).\n- **Required Settings**: Catalog entries for `CNC_DrillElement` must exist to define the visualization styles.\n\n## Usage Steps\n\n### Step 1: Launch Script\nRun the command `TSLINSERT` (or select the script from the hsbCAD toolbar/menu) and select `HSB_E-SetDrillVisualizationType.mcr`.\n\n### Step 2: Configure Settings\nIf the script is not run via a predefined catalog execute key, a dialog appears (or check the AutoCAD Properties Palette).\n1.  **Define Filters**: Specify which beams to target using Beam Code, Label, Material, or hsbId. Supports wildcards (e.g., `WALL*`).\n2.  **Set Mode**: Choose whether to `Include` matching beams (apply changes only to them) or `Exclude` matching beams (apply changes to everything else).\n3.  **Select Visualization**: Choose the target script name (default: `CNC_DrillElement`) and the **Visualization Type** (Catalog entry) you wish to apply.\n4.  **Deletion Option**: Choose `Yes` or `No` for \"Delete TSLs that don't match filters\" to remove drills from excluded beams.\n\n### Step 3: Select Elements\n```\nCommand Line: |Select one or more elements|\nAction: Click on the Element(s) in the model or draw a selection window. Press Enter to confirm.\n```\n\n### Step 4: Execution\nThe script processes all beams within the selected Elements.\n- Matching beams have their drill hole visualization updated to the chosen catalog style.\n- Depending on your deletion setting, non-matching drill TSLs may be removed.\n- **Note**: The script instance will automatically erase itself from the model after processing is complete.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Selection Category** | | | |\n| Include/exclude | Dropdown | \\|Include\\| | Determines if the filters select beams to process (\"Include\") or to ignore (\"Exclude\"). |\n| Filter beams with beamcode | Text | | Enter a Beam Code (supports wildcards like `STUD*`). |\n| Filter objects with label | Text | | Enter a Label (supports wildcards). |\n| Filter objects with material | Text | | Enter a Material name (e.g., `C24`). |\n| Filter objects with hsb id | Text | | Enter an hsbId. |\n| **Drill Category** | | | |\n| Scriptname drill tsl | Text | CNC_DrillElement | The name of the TSL script to target. |\n| Visualization Type | Dropdown | | Select the Catalog entry defining the visual style (color, 3D body, etc.). |\n| **Other** | | | |\n| Delete TSLs that don't match filters | Dropdown | \\|No\\| | If set to `Yes`, drills on excluded beams are permanently deleted. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not have persistent right-click menu options as it erases itself after running. |\n\n## Settings Files\n- **Catalog Entries**: `CNC_DrillElement`\n- **Location**: hsbCAD Catalog (TslTabs or Catalog database)\n- **Purpose**: Provides the preset visualization styles applied by this script.\n\n## Tips\n- **Wildcards**: Use `*` in filter fields (e.g., `FLOOR*` in Beam Code) to select multiple beam types at once.\n- **Safety**: The \"Delete TSLs\" option is irreversible for the specific session. Use `No` initially to preview changes, then re-run with `Yes` if needed to clean up unwanted drills.\n- **Persistence**: Once the script runs, it disappears from the model. To change settings again, simply re-insert the script and select the elements.\n- **Apply to All**: If all filter fields are left empty, the script automatically applies the visualization changes to **all** beams in the selected Element.\n\n## FAQ\n- **Q: Why did the script disappear after I selected the elements?**\n  - A: This is a utility script designed to perform a \"batch update\" and then self-destruct to keep your model clean. The changes applied to the drill holes remain.\n- **Q: Can I undo the changes?**\n  - A: Yes, you can use the standard AutoCAD `UNDO` command immediately after running the script.\n- **Q: Nothing happened when I ran the script.**\n  - A: Ensure the selected Elements actually contain beams with the `CNC_DrillElement` script attached. Also, check that your filters are not excluding all beams."
      },
      "tokens_used": 7167,
      "error": null
    }
  }
}