{
  "filename": "NA_HATCH_SELECTED_ZONE.mcr",
  "status": "completed",
  "total_tokens": 41669,
  "processing_time": 649.8992393016815,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5772,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly prompts for a viewport on insertion ('_Viewport.append(getViewport...)'), retrieves the element from it ('Element thisElement = thisViewPort.element()'), and performs transformations to paper space coordinates ('CoordSys modelToPaperTransformation = thisViewPort.coordSys()', 'outlineToDraw.transformBy(modelToPaperTransformation)'). It draws display data intended for the 2D layout."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Must be executed within a valid AutoCAD Layout containing a viewport linked to an hsbCAD Element.",
          "requiredSettings": [
            "PainterDefinitions of type GenBeam"
          ]
        }
      },
      "tokens_used": 4220,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "\nSelect element viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDialog",
            "trigger": "Immediately after viewport selection during insert",
            "title": "Properties",
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "userIncludeFilter",
            "type": "PropString",
            "displayName": "Include filter",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": "Dynamic list based on GenBeam PainterDefinitions",
            "category": "Beams/Sheets to hatch",
            "description": "Painter definition of type GenBeam \nAddition filter applied to get a subset of beams/sheets at selected zone \nIf set to None will not apply inclusion(this) filter"
          },
          {
            "index": 1,
            "variable": "userExcludeFilter",
            "type": "PropString",
            "displayName": "Exclude filter",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": "Dynamic list based on GenBeam PainterDefinitions",
            "category": "Beams/Sheets to hatch",
            "description": "Painter definition of type GenBeam\nSubtraction filter(painter definition) applied to get a subset of dimensioned beams/sheets at selected zone\nIf set to None will not apply exclusion(this) filter\nIf both filters are not None it will get beams/sheets which are at specified zone and sutisfy conditions of include(above) filter,\nthen it will remove genbeams which satisfy exclude(this) fiter"
          },
          {
            "index": 2,
            "variable": "userZone",
            "type": "PropInt",
            "displayName": "Zone",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              0,
              1,
              2,
              3,
              4,
              5,
              -1,
              -2,
              -3,
              -4,
              -5
            ],
            "category": "Beams/Sheets to hatch",
            "description": "Zone to which dimensioned beams/sheets belong to:\n0 zone inside element container\n1, 2, 3, 4, 5 zones at front of wall container or at top of floor/roof container\n-1, -2, -3, -4, -5 zones at back of wall container or at back of floor/roof container"
          },
          {
            "index": 3,
            "variable": "userHatchPattern",
            "type": "PropString",
            "displayName": "Hatch pattern",
            "defaultValue": "ANSI31",
            "inputType": "dropdown",
            "options": "_HatchPatterns (Global List)",
            "category": "Hatching",
            "description": "If set to SOLID will fill selected beams/sheets with selected colour and transparency."
          },
          {
            "index": 4,
            "variable": "userHatchScale",
            "type": "PropDouble",
            "displayName": "Hatch scale",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": "Hatching",
            "description": "Scale of hatch pattern in paper space"
          },
          {
            "index": 5,
            "variable": "userHatchAngle",
            "type": "PropDouble",
            "displayName": "Hatch angle",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "Hatching",
            "description": "Angle of hatch pattern in degrees"
          },
          {
            "index": 6,
            "variable": "userHatchColour",
            "type": "PropInt",
            "displayName": "Hatch colour",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": "Hatching",
            "description": "Colour of hatch pattern. \nIf set to -1 will use colour of this TSL instance"
          },
          {
            "index": 7,
            "variable": "userHatchTransparency",
            "type": "PropInt",
            "displayName": "Hatch transparency",
            "defaultValue": 60,
            "inputType": "number",
            "options": [],
            "category": "Hatching",
            "description": "If hatch is set to SOLID will use this transparency value."
          },
          {
            "index": 8,
            "variable": "userMergeSuperImposed",
            "type": "PropString",
            "displayName": "Merge superimposed",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "Hatching",
            "description": "If set to Yes, will merge areas which are completly on top of each other"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6817,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates 2D hatching or solid fills for specific groups of timber beams (GenBeams) within a layout viewport, based on construction zones and material filters.",
          "category": "ShopDrawing",
          "typicalUseCase": "Visualizing specific structural layers (e.g., top plates, studs, or sheathing) in an elevation or plan view to distinguish them from other components, often used for assembly instructions or presentation drawings."
        },
        "parameters": [
          {
            "name": "userIncludeFilter",
            "technicalDefault": "None",
            "businessMeaning": "Selects a specific category of beams to hatch (e.g., 'Studs', 'Joists'), based on the GenBeam PainterDefinitions defined in the hsbCAD catalogue.",
            "validRange": "None or any valid GenBeam PainterDefinition name",
            "unit": "String",
            "affectsOutput": "Determines which beams are initially collected for hatching. If 'None', all beams in the zone are considered."
          },
          {
            "name": "userExcludeFilter",
            "technicalDefault": "None",
            "businessMeaning": "Removes a specific category of beams from the hatching set (e.g., removing 'Noggins' from a stud wall hatch).",
            "validRange": "None or any valid GenBeam PainterDefinition name",
            "unit": "String",
            "affectsOutput": "Subtracts beams from the selection set defined by the Include Filter."
          },
          {
            "name": "userZone",
            "technicalDefault": 0,
            "businessMeaning": "Specifies the construction layer or offset zone to query. 0 is the main container. Positive values usually indicate front/top layers (cladding, exterior), negative values indicate back/bottom layers.",
            "validRange": "-5 to 5 (hsbCAD standard zones)",
            "unit": "Index",
            "affectsOutput": "Restricts the search for beams to a specific 3D depth relative to the element's coordinate system."
          },
          {
            "name": "userHatchPattern",
            "technicalDefault": "ANSI31",
            "businessMeaning": "The visual style of the fill. Standard CAD patterns (e.g., ANSI31, SOLID). If set to 'SOLID', the beam is filled with a transparent color.",
            "validRange": "Standard AutoCAD hatch patterns or 'SOLID'",
            "unit": "String",
            "affectsOutput": "Determines if the area is lined or solid filled. Switches the usage of 'Transparency' vs 'Scale/Angle'."
          },
          {
            "name": "userHatchScale",
            "technicalDefault": 1,
            "businessMeaning": "Controls the density of the hatch pattern lines in the Paper Space layout.",
            "validRange": "0.1 to 10.0 (Typical paper space scales)",
            "unit": "Factor",
            "affectsOutput": "Scales the spacing of the hatch pattern. Higher values = wider spacing."
          },
          {
            "name": "userHatchAngle",
            "technicalDefault": 0,
            "businessMeaning": "Rotates the hatch pattern lines relative to the horizontal axis of the layout.",
            "validRange": "0 to 360",
            "unit": "Degrees",
            "affectsOutput": "Rotates the hatch lines."
          },
          {
            "name": "userHatchColour",
            "technicalDefault": -1,
            "businessMeaning": "The color of the hatch lines or solid fill. -1 inherits the color from the TSL instance's layer properties.",
            "validRange": "-1 (ByBlock) or 0-255 (AutoCAD Color Index)",
            "unit": "ACI",
            "affectsOutput": "Changes the visual color of the generated hatch."
          },
          {
            "name": "userHatchTransparency",
            "technicalDefault": 60,
            "businessMeaning": "The opacity of the solid fill. Only active when Pattern is 'SOLID'. Allows underlying geometry or grid lines to show through.",
            "validRange": "0 (Opaque) to 90 (Transparent)",
            "unit": "Percent",
            "affectsOutput": "Adjusts the transparency of the solid hatch fill."
          },
          {
            "name": "userMergeSuperImposed",
            "technicalDefault": "No",
            "businessMeaning": "Determines if overlapping beam profiles (e.g., stacked plates or coincident beams) should be combined into a single hatch area to prevent visual 'doubling' or messy line overlaps.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If 'Yes', unions overlapping 2D profiles before hatching. If 'No', hatches every beam outline individually."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "userHatchPattern set to 'SOLID'",
            "effect": "Activates 'userHatchTransparency' and deactivates 'userHatchScale' and 'userHatchAngle' (as they have no effect on a solid fill).",
            "cascade": [
              "userHatchTransparency",
              "userHatchScale",
              "userHatchAngle"
            ]
          },
          {
            "trigger": "userHatchPattern set to a pattern (e.g., ANSI31)",
            "effect": "Activates 'userHatchScale' and 'userHatchAngle'. 'userHatchTransparency' is ignored.",
            "cascade": [
              "userHatchScale",
              "userHatchAngle",
              "userHatchTransparency"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "2D Geometry / Display",
            "description": "Projected cross-sectional outlines of selected GenBeams, filled with hatching or solid color.",
            "appliedTo": "Paper Space Viewport (referencing the selected Model Space Element)."
          }
        ]
      },
      "tokens_used": 8265,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script (Insert TSL)",
          "2. Check Insert Cycle Count (Safety Check)",
          "3. Prompt User to Select Element Viewport on Layout",
          "4. Open Properties Dialog (User configures Zone, Filters, Hatch Style)",
          "5. Validate Viewport Selection",
          "6. Retrieve Element from Viewport and Validate Element Integrity",
          "7. Calculate Coordinate System Transformations (Model to Paper Space)",
          "8. Collect GenBeams based on Zone Selection",
          "9. Apply Include Filter (Painter Definition) if not 'None'",
          "10. Apply Exclude Filter (Painter Definition) if not 'None'",
          "11. Generate 2D Outlines for each filtered GenBeam (Project to View Plane)",
          "12. Iterate through Outlines to generate Graphics",
          "13. Display Graphics in Viewport (Hatching or Solid Fill)"
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count > 1",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase current instance",
                "Terminate script"
              ]
            },
            "path2": {
              "name": "Cycle = 1 (First Run)",
              "steps": [
                "Continue to Viewport Selection"
              ]
            }
          },
          {
            "condition": "User Zone Selection (0 to 5 vs -1 to -5)",
            "path1": {
              "name": "Specific Zone (0 to 5)",
              "steps": [
                "Retrieve beams only from the specific index zone"
              ]
            },
            "path2": {
              "name": "All Beams (-1 to -5)",
              "steps": [
                "Retrieve ALL beams from the element",
                "Skip zone-specific retrieval (Relies solely on Painter Filters for selection)"
              ]
            }
          },
          {
            "condition": "Merge Superimposed Setting",
            "path1": {
              "name": "Yes",
              "steps": [
                "Check for overlapping outlines",
                "Union overlapping areas into single profiles",
                "Skip drawing merged duplicates"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Process each beam outline individually",
                "Draw every beam independently"
              ]
            }
          },
          {
            "condition": "Hatch Pattern Type",
            "path1": {
              "name": "SOLID",
              "steps": [
                "Draw outline",
                "Apply Solid Fill",
                "Use 'Hatch Transparency' property",
                "Ignore Hatch Scale and Angle"
              ]
            },
            "path2": {
              "name": "Pattern (e.g. ANSI31)",
              "steps": [
                "Draw outline",
                "Apply Pattern Hatch",
                "Use 'Hatch Scale' and 'Hatch Angle'",
                "Ignore Transparency property"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "No valid viewport. Erasing this instance.",
            "recovery": "User must re-run the script and ensure a valid layout viewport containing an hsbCAD element is selected."
          },
          {
            "check": "Element Validity (On Recalculation)",
            "errorMessage": "No valid element in viewport",
            "recovery": "Ensure the linked Element in Model Space has not been deleted or invalidated. If the element is valid, the script will simply halt execution without drawing until the next update."
          },
          {
            "check": "Geometry Extraction",
            "errorMessage": "(Internal)",
            "recovery": "Script attempts a fallback extraction using AnalysedCut (Hip/Valley) logic if the standard face extraction fails. No specific user message is shown for this internal recovery."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties",
            "how": "Properties Palette (OPM) - Select the TSL instance in Paper Space",
            "effect": "Script recalculates immediately upon property change. Updates the filtering (Zone/Include/Exclude), hatch style, or merging logic and refreshes the graphics in the viewport."
          },
          {
            "action": "Update Element Geometry",
            "how": "Modify Model Space beams (resize/rotate/move)",
            "effect": "When the layout view is refreshed or the TSL is recalculated, the outlines update to match the new beam geometry."
          },
          {
            "action": "Delete",
            "how": "AutoCAD Erase command",
            "effect": "Removes the TSL instance and the associated hatching graphics."
          }
        ]
      },
      "tokens_used": 9786,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# NA_HATCH_SELECTED_ZONE.mcr\n\n## Overview\nThis script generates 2D hatching or solid fills for specific groups of timber beams (GenBeams) within a layout viewport, based on construction zones and material filters. It is used to distinguish structural layers or material types in shop drawings or presentation layouts.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script operates on Layouts. |\n| Paper Space | Yes | Primary environment; requires a viewport linked to an hsbCAD Element. |\n| Shop Drawing | Yes | Designed for detailing and presentation views. |\n\n## Prerequisites\n- **Required entities**: An AutoCAD Layout containing a viewport linked to a valid hsbCAD Element.\n- **Minimum beam count**: 1 GenBeam within the selected element.\n- **Required settings**: Valid GenBeam PainterDefinitions (in the hsbCAD catalogue) to use the Include/Exclude filters.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `NA_HATCH_SELECTED_ZONE.mcr`\n\n### Step 2: Select Viewport\n```\nCommand Line: Select element viewport\nAction: Click on a viewport in Paper Space that displays the element you want to hatch.\n```\n\n### Step 3: Configure Properties\n```\nAction: With the TSL instance selected, open the Properties Palette (Ctrl+1).\nAdjust the filters (Zone/Include/Exclude) and Hatch settings to define which beams to draw and how they should look.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Include filter | dropdown | None | Selects a category of beams to hatch (e.g., Studs, Plates) based on GenBeam PainterDefinitions. If \"None\", all beams in the zone are considered. |\n| Exclude filter | dropdown | None | Removes a specific category of beams from the selection set defined by the Include filter. |\n| Zone | dropdown | 0 | Specifies the construction layer (0 = main container; 1-5 = front/top; -1 to -5 = back/bottom). |\n| Hatch pattern | dropdown | ANSI31 | Visual style of the fill. Set to \"SOLID\" to use the colour and transparency settings. |\n| Hatch scale | number | 1 | Scale of the hatch pattern in Paper Space (spacing of lines). |\n| Hatch angle | number | 0 | Rotation angle of the hatch pattern in degrees. |\n| Hatch colour | number | -1 | Colour of the hatch. -1 uses the TSL instance colour (ByBlock). Otherwise, use AutoCAD Color Index (0-255). |\n| Hatch transparency | number | 60 | Opacity percentage (0-90) used only when Pattern is set to \"SOLID\". |\n| Merge superimposed | dropdown | No | If \"Yes\", combines overlapping beam profiles into a single hatch area to prevent visual clutter. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are defined for this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on standard hsbCAD catalog PainterDefinitions but does not use an external settings XML file.\n\n## Tips\n- **Solid Fills**: To create a coloured overlay (e.g., for sheathing or concrete), set **Hatch pattern** to `SOLID` and adjust the **Hatch transparency** to see underlying geometry.\n- **Clean Up Overlaps**: If you have multiple plates stacked on top of each other, set **Merge superimposed** to `Yes` to avoid double-hatching lines.\n- **Zone Logic**: Use **Zone** 0 for the main frame structure. Use positive/negative zones to hatch cladding, gables, or flooring layers independently.\n- **Filtering**: Use the **Include filter** to select general groups (e.g., \"All Structural\") and the **Exclude filter** to remove specific items (e.g., \"Blocking\") from that group.\n\n## FAQ\n- **Q: Why is the transparency option not changing the hatch look?**\n  **A**: Transparency only applies when the **Hatch pattern** is set to `SOLID`. If you are using a pattern like ANSI31, you must change the color or scale, not the transparency.\n- **Q: How do I hatch only the studs in a wall?**\n  **A**: Set **Zone** to `0`, set **Include filter** to your \"Studs\" PainterDefinition, and ensure **Exclude filter** is `None`.\n- **Q: The script asks for a viewport but I am in Model Space.**\n  **A**: This script only works in Paper Space layouts. Switch to a Layout tab, create a viewport looking at your model, and run the script there."
      },
      "tokens_used": 6809,
      "error": null
    }
  }
}