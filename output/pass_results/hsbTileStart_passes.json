{
  "filename": "hsbTileStart.mcr",
  "status": "completed",
  "total_tokens": 50114,
  "processing_time": 256.43930554389954,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.6",
            "date": "12jun19",
            "author": "nils.gregor@hsbcad.com",
            "changes": "Changed default path for roofscaping report "
          },
          {
            "version": "1.5",
            "date": "23may19",
            "author": "nils.gregor@hsbcad.com",
            "changes": "Adjusted translation "
          },
          {
            "version": "1.4",
            "date": "20may19",
            "author": "nils.gregor@hsbcad.com",
            "changes": " Erase instance, if no exporter group is found "
          },
          {
            "version": "1.3",
            "date": "16may19",
            "author": "nils.gregor@hsbcad.com",
            "changes": " find default exporter group in content General "
          },
          {
            "version": "1.2",
            "date": "16may19",
            "author": "nils.gregor@hsbcad.com",
            "changes": " changed reading exporter groups "
          },
          {
            "version": "1.1",
            "date": "15may19",
            "author": "nils.gregor@hsbcad.com",
            "changes": " change starting sequence "
          },
          {
            "version": "1.0",
            "date": "19nov18",
            "author": "nils.gregor@hsbcad.com",
            "changes": " initial "
          }
        ],
        "settingsFiles": [
          "groups.xml"
        ],
        "dependencies": [
          "_hsbTileGrid",
          "hsbTileHipRidge",
          "hsbTileVerge",
          "hsbTileLath"
        ]
      },
      "tokens_used": 8288,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly uses `_kModelSpace` in `tslNew.dbCreate()` calls. User input is handled via `PrEntity` looking for `ERoofPlane()`, which are 3D entities. No references to `_kPaperSpace`, `_Viewport`, or `sd_` prefixes. The script manages 3D roof elements like TileGrid, Hips, Ridges, and Verges."
        },
        "prerequisites": {
          "requiredEntities": [
            "ERoofPlane"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": [
            "groups.xml (in Company Export catalogue or General content)"
          ]
        }
      },
      "tokens_used": 6738,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getString",
              "promptOriginal": "|Type <D> for dialog, <E> for export, <Enter> attach roof data|",
              "condition": "_bOnInsert && !sKey",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select roofplane(s)|",
              "condition": "_bOnInsert && bStart",
              "required": true
            }
          ],
          "keywordOptions": [
            {
              "prompt": "|Type <D> for dialog, <E> for export, <Enter> attach roof data|",
              "options": [
                "D",
                "E",
                ""
              ]
            }
          ]
        },
        "dialogs": [
          {
            "type": "ShowDialog",
            "trigger": "User types 'D' in getString prompt",
            "title": "Properties",
            "dataSource": "OPM Properties (sVerge, sRidge, sTileGridCatalog, sRidgeTileCatalog, sExporterGroup)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sVerge",
            "type": "PropString",
            "displayName": "|Create verge tiles|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|After adjusting tile grid|"
            ],
            "category": "Settings",
            "description": "|Defines the verges|"
          },
          {
            "index": 1,
            "variable": "sRidge",
            "type": "PropString",
            "displayName": "|Create ridge tiles|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|After adjusting tile grid|"
            ],
            "category": "Settings",
            "description": "|Defines the ridges|"
          },
          {
            "index": 2,
            "variable": "sTileGridCatalog",
            "type": "PropString",
            "displayName": "|Use TileGrid catalog|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": "Settings",
            "description": "|Defines the TileGridCatalog|"
          },
          {
            "index": 3,
            "variable": "sRidgeTileCatalog",
            "type": "PropString",
            "displayName": "|Use TileHipRidge catalog|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": "Settings",
            "description": "|Defines the RidgeTileCatalog|"
          },
          {
            "index": 4,
            "variable": "sExporterGroup",
            "type": "PropString",
            "displayName": "|Exporter Group|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": "Export",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "TslDoubleClick",
            "handler": "TslDoubleClick",
            "action": "Creates hsbTileHipRidge and hsbTileVerge TSLs if properties are set to 'After adjusting tile grid'",
            "alsoTriggeredBy": "Double click on text 'Adjust vertical tiling and double click'"
          }
        ],
        "settingsFiles": [
          {
            "filename": "groups.xml",
            "searchPaths": [
              "_kPathHsbCompany\\Export\\catalogue\\groups.xml",
              "_kPathHsbInstall\\Content\\General\\hsbCompany\\Export\\catalogue\\groups.xml"
            ],
            "purpose": "Provides list of Exporter Groups available for the 'Exporter Group' property",
            "required": true
          }
        ]
      },
      "tokens_used": 9248,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Initiates the roof tiling (roofscaping) workflow by attaching tile data to roof planes, managing tile catalogs for grids and ridges, and triggering geometry generation or data exports.",
          "category": "Pre-Processing/Construction",
          "typicalUseCase": "Used at the beginning of the roofing process to define how tiles are laid out on a roof, specify which catalogs to use, and ultimately generate ridge/verge details or export material lists."
        },
        "parameters": [
          {
            "name": "sVerge",
            "technicalDefault": "|No|",
            "businessMeaning": "Controls the generation of verge (gable end) tiles.",
            "validRange": "|No|, |After adjusting tile grid|",
            "unit": "enum",
            "affectsOutput": "If set to 'After adjusting tile grid', creates `hsbTileVerge` TSLs on the roof edges upon a specific double-click action."
          },
          {
            "name": "sRidge",
            "technicalDefault": "|No|",
            "businessMeaning": "Controls the generation of ridge and hip tiles.",
            "validRange": "|No|, |After adjusting tile grid|",
            "unit": "enum",
            "affectsOutput": "If set to 'After adjusting tile grid', creates `hsbTileHipRidge` TSLs on the roof peaks/hips upon a specific double-click action."
          },
          {
            "name": "sTileGridCatalog",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific catalog defining the tile dimensions, spacing, and layout rules for the main roof field.",
            "validRange": "Names of catalogs found in `_hsbTileGrid`",
            "unit": "string",
            "affectsOutput": "Determines the geometry, spacing, and pattern of the primary tile grid attached to the roof plane."
          },
          {
            "name": "sRidgeTileCatalog",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific catalog defining the geometry and properties of ridge, hip, and valley tiles.",
            "validRange": "Names of catalogs found in `hsbTileHipRidge`",
            "unit": "string",
            "affectsOutput": "Determines the specific geometry and placement of tiles at roof intersections and peaks."
          },
          {
            "name": "sExporterGroup",
            "technicalDefault": "",
            "businessMeaning": "Specifies the configuration group (from groups.xml) for exporting tile quantities and data to external files (e.g., Excel).",
            "validRange": "Exporter Group names defined in the Company or General catalog",
            "unit": "string",
            "affectsOutput": "Controls the content, format, and destination of the generated report/export file when the export function is triggered."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User double-clicks on the text 'Adjust vertical tiling and double click'",
            "effect": "Evaluates `sRidge` and `sVerge`. If set to generate, it inserts the `hsbTileHipRidge` and `hsbTileVerge` scripts onto the roof planes.",
            "cascade": [
              "hsbTileHipRidge",
              "hsbTileVerge"
            ]
          },
          {
            "trigger": "User types 'E' (Export) at the command prompt",
            "effect": "Bypasses geometry creation and uses the `sExporterGroup` parameter to generate a material report via the ModelMap composer.",
            "cascade": [
              "ModelMap",
              "Export File"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TSL Instance (_hsbTileGrid)",
            "description": "Main roof field tiling grid.",
            "appliedTo": "Selected ERoofPlane(s)"
          },
          {
            "type": "TSL Instance (hsbTileHipRidge)",
            "description": "Ridge and hip tile elements.",
            "appliedTo": "Selected ERoofPlane(s) (Top/Intersection edges)"
          },
          {
            "type": "TSL Instance (hsbTileVerge)",
            "description": "Verge (gable end) tile elements.",
            "appliedTo": "Selected ERoofPlane(s) (Side edges)"
          },
          {
            "type": "Hardware Component",
            "description": "Bill of Materials entries for Full and Half tiles.",
            "appliedTo": "Parent _hsbTileGrid instance"
          },
          {
            "type": "SubMap (hsb_TileExportData)",
            "description": "Data attached to the roof plane identifying it as processed and storing export flags.",
            "appliedTo": "ERoofPlane"
          }
        ]
      },
      "tokens_used": 8547,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Start & Validation",
          "2. Check for 'groups.xml' in Company and General paths",
          "3. Command Line Prompt: Type <D> for dialog, <E> for export, or <Enter> to attach data",
          "4. Branch based on Input (Dialog, Export, or Default)",
          "5. Entity Selection: Select RoofPlane(s)",
          "6. First Execution Phase: Clean old tile data from planes and mark planes with submap",
          "7. Script Restart: Self-erase and re-insert via Command Stack",
          "8. Second Execution Phase: Create '_hsbTileGrid' TSL on selected planes",
          "9. User Interaction: User adjusts tile grid settings manually in properties",
          "10. User Action: User double-clicks text 'Adjust vertical tiling and double click'",
          "11. Detail Generation: Create 'hsbTileHipRidge' and 'hsbTileVerge' TSLs based on settings",
          "12. Quantity Calculation: Calculate Full/Half tile quantities and attach hardware to Grid",
          "13. Script Finish: Erase 'hsbTileStart' instance"
        ],
        "conditionalBranches": [
          {
            "condition": "Initial User Input at Command Line",
            "path1": {
              "name": "Dialog Mode",
              "steps": [
                "User types 'D'",
                "Show OPM Properties dialog",
                "User confirms/edits settings",
                "Proceed to Entity Selection"
              ]
            },
            "path2": {
              "name": "Export Mode",
              "steps": [
                "User types 'E'",
                "Load properties from last inserted",
                "Select RoofPlane(s)",
                "Skip Geometry Generation",
                "Run Export Routine (ModelMap -> Excel/Report)",
                "Erase Instance"
              ]
            },
            "path3": {
              "name": "Standard Mode (Default)",
              "steps": [
                "User presses Enter",
                "Proceed to Entity Selection",
                "Execute Full Workflow"
              ]
            }
          },
          {
            "condition": "Double Click Event (Execution Key == 'TslDoubleClick')",
            "path1": {
              "name": "Create Details",
              "steps": [
                "Check 'sRidge' property (Set to 'After adjusting tile grid')",
                "If True: Create 'hsbTileHipRidge' TSL",
                "Check 'sVerge' property (Set to 'After adjusting tile grid')",
                "If True: Create 'hsbTileVerge' TSL",
                "Update Hardware Quantities",
                "Erase Instance"
              ]
            },
            "path2": {
              "name": "Grid Adjustment Only",
              "steps": [
                "Ridge/Verge settings are 'No'",
                "Skip creation of detail TSLs",
                "Script continues to wait or updates existing hardware",
                "Instance remains (if logic allows) or erases depending on flag"
              ]
            }
          },
          {
            "condition": "Script Execution Cycle",
            "path1": {
              "name": "First Run (Initialization)",
              "steps": [
                "Detect '_Map' does not have 'SecoundRun' flag",
                "Remove 'hsb_TileExportData' submaps",
                "Erase existing hsbTile scripts",
                "Set 'hsbTileStart' flag in RoofPlane submap",
                "Push commands to stack to restart script",
                "Erase Instance"
              ]
            },
            "path2": {
              "name": "Second Run (Processing)",
              "steps": [
                "Detect '_Map' has 'SecoundRun' flag",
                "Find RoofPlanes marked in First Run",
                "Create '_hsbTileGrid' TSL",
                "Wait for Double Click interaction"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of Exporter Groups in groups.xml",
            "errorMessage": "Please define an Exporter Group first and try again.",
            "recovery": "User must add a valid groups.xml to the Company Export catalogue or ensure General content is accessible."
          },
          {
            "check": "RoofPlane Selection Count",
            "errorMessage": "No roofplanes found, instance will be deleted",
            "recovery": "User must select valid ERoofPlane entities when prompted."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Trigger Detail Generation",
            "how": "Double-click on the script instance or the text 'Adjust vertical tiling and double click'",
            "effect": "Creates hsbTileHipRidge and hsbTileVerge scripts if the OPM properties 'Create ridge tiles' and 'Create verge tiles' are set to 'After adjusting tile grid'."
          },
          {
            "action": "Modify Tile Settings",
            "how": "Edit OPM Properties (TileGrid Catalog, RidgeTile Catalog) before double-clicking",
            "effect": "Changes the parameters used when generating the Tile Grid and subsequent Edge details."
          },
          {
            "action": "Update Quantities",
            "how": "Recalculation of the RoofPlane",
            "effect": "Script aggregates tile data from attached scripts, calculates net totals (Full/Half tiles), and writes them as Hardware components to the _hsbTileGrid instance."
          }
        ]
      },
      "tokens_used": 10557,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbTileStart.mcr\n\n## Overview\nThis script initiates the roof tiling (roofscaping) workflow. It attaches tile data to roof planes, manages tile catalogs for grids and ridges, and triggers the generation of ridge, hip, and verge details or material exports.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Requires 3D Roof Planes (ERoofPlane). |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: ERoofPlane (Roof Planes) must exist in the model.\n- **Minimum Beam Count**: N/A\n- **Required Settings**: `groups.xml` must exist in the Company Export catalogue (`_kPathHsbCompany\\Export\\catalogue\\`) or the General content folder (`_kPathHsbInstall\\Content\\General\\`).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbTileStart.mcr`\n\n### Step 2: Choose Operation Mode\n```\nCommand Line: Type <D> for dialog, <E> for export, <Enter> attach roof data\nAction: Press Enter to proceed with standard tiling, type 'D' to open settings first, or type 'E' to generate a report only.\n```\n\n### Step 3: Select Roof Planes\n```\nCommand Line: Select roofplane(s)\nAction: Click on the Roof Planes you wish to apply tiling to and press Enter.\n```\n*Note: The script will automatically clean up previous tiling data on the selected planes and restart internally to apply the new data.*\n\n### Step 4: Configure Tile Settings (Optional)\nOnce the script attaches to the roof, select the script instance and open the **Properties Palette**.\n- Select the appropriate **TileGrid Catalog** for the main roof field.\n- Adjust other settings like Ridge or Verge creation if needed.\n\n### Step 5: Finalize Generation\n```\nAction: Double-click the text \"Adjust vertical tiling and double click\" displayed near the roof.\n```\n*This calculates quantities and creates the Ridge, Hip, and Verge elements if the properties are enabled.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Create verge tiles | dropdown | No | Determines if verge (gable end) tiles are created. Set to \"After adjusting tile grid\" to generate them on double-click. |\n| Create ridge tiles | dropdown | No | Determines if ridge and hip tiles are created. Set to \"After adjusting tile grid\" to generate them on double-click. |\n| Use TileGrid catalog | dropdown | | Selects the catalog defining dimensions and layout rules for the main roof field tiles. |\n| Use TileHipRidge catalog | dropdown | | Selects the catalog defining geometry and properties for ridge, hip, and valley tiles. |\n| Exporter Group | dropdown | | Specifies the configuration group (from groups.xml) for exporting tile data to reports (e.g., Excel). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| TslDoubleClick | Triggered by double-clicking the text \"Adjust vertical tiling and double click\". This finalizes the tile layout, creates ridge/verge details (if enabled), and calculates hardware quantities. |\n\n## Settings Files\n- **Filename**: `groups.xml`\n- **Location**: `_kPathHsbCompany\\Export\\catalogue\\` or `_kPathHsbInstall\\Content\\General\\hsbCompany\\Export\\catalogue\\`\n- **Purpose**: Provides the list of available Exporter Groups used in the Properties Panel for generating material lists.\n\n## Tips\n- **Export Mode**: If you only need a material list and do not want to generate 3D tile geometry, type `E` at the initial command prompt.\n- **Cleanup**: When you select new roof planes, the script automatically removes old tile data from them, ensuring a fresh start.\n- **Workflow**: Ensure you select your catalogs in the Properties palette *before* double-clicking the text to finalize the geometry.\n\n## FAQ\n- **Q: Why did my script instance disappear after double-clicking?**\n  - A: This is normal behavior. Once the script generates the final Tile Grid and details, the `hsbTileStart` instance erases itself, leaving the generated tile elements behind.\n- **Q: What happens if I see an error about \"Exporter Group\"?**\n  - A: The script cannot find `groups.xml`. Please check with your CAD Manager to ensure the Export catalogue is correctly configured in your hsbCAD environment.\n- **Q: Can I generate the roof tiling without the ridge and verge tiles?**\n  - A: Yes. Set the \"Create ridge tiles\" and \"Create verge tiles\" properties to \"No\" in the Properties palette before double-clicking to finalize."
      },
      "tokens_used": 6736,
      "error": null
    }
  }
}