{
  "filename": "hsbTileSingle.mcr",
  "status": "completed",
  "total_tokens": 53059,
  "processing_time": 291.3358733654022,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": \"\",\n    \"numBeamsReq\": 0,\n"
      },
      "tokens_used": 9630,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly creates and draws 3D geometry using 'Body bd3D' and 'dp.draw(bd3D)'. It interacts with physical entities like ERoofPlane and GenBeam to calculate tile placement. It uses standard Display objects without _Viewport references or paper space specific flags. It lacks 'sd_' prefixes or #Type E headers typical of ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "ERoofPlane",
            "GenBeam (Laths)",
            "ElementRoof"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "DimStyle"
          ]
        }
      },
      "tokens_used": 7385,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getERoofPlane\",\n        \"promptOriginal\": null,\n        \"condition\": \"_kExecuteKey == sTrigger[1]\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Select a set of laths\",\n        \"condition\": \"_kExecuteKey == sTrigger[2]\",\n        \"required\": true\n      },\n      {\n        \"step\": 4,\n        \"function\": \""
      },
      "tokens_used": 10390,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Calculates the layout, geometry, and quantity of roof tiles based on roof plane geometry and lath positions, providing 3D visualization and material counts.",
          "category": "Modeling/Covering",
          "typicalUseCase": "Determining the number and positioning of tiles, slates, or panels on a roof plane to generate cutting lists or visualizations for construction drawings."
        },
        "parameters": [
          {
            "name": "sDisplay",
            "technicalDefault": "Tile grid + visible width",
            "businessMeaning": "Controls the visual representation of the tiles in the model view, allowing the user to see the grid layout, the actual coverage width, or both.",
            "validRange": "Tile grid + visible width, Tile grid, visible width",
            "unit": "enum",
            "affectsOutput": "Alters the 2D and 3D display lines; does not affect calculated quantities."
          },
          {
            "name": "sGroup",
            "technicalDefault": "",
            "businessMeaning": "Assigns the script instance to a specific catalog group in the project tree to organize the model structure.",
            "validRange": "Any valid group path string",
            "unit": "string",
            "affectsOutput": "Changes the layer or group hierarchy where the visual elements are placed."
          },
          {
            "name": "dHipValleyExt",
            "technicalDefault": "30",
            "businessMeaning": "Defines an extension distance beyond the theoretical roof edge (hips/valleys) to ensure tiles cover these critical transitions effectively.",
            "validRange": "0 - 200 mm",
            "unit": "mm",
            "affectsOutput": "Expands the calculation area, potentially adding tiles at roof edges to prevent gaps."
          },
          {
            "name": "dDeltaL",
            "technicalDefault": "0",
            "businessMeaning": "Offsets the starting position of the tile grid to the left relative to the roof outline, used to align cuts or overhangs.",
            "validRange": "-500 - 500 mm",
            "unit": "mm",
            "affectsOutput": "Shifts the entire tile array horizontally along the roof plane."
          },
          {
            "name": "dDeltaR",
            "technicalDefault": "0",
            "businessMeaning": "Offsets the ending position of the tile grid to the right relative to the roof outline, allowing adjustments for ridge or eave details.",
            "validRange": "-500 - 500 mm",
            "unit": "mm",
            "affectsOutput": "Stretches or shrinks the tile area horizontally."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Specifies the dimension style (text size, font, arrows) used for labeling tile dimensions.",
            "validRange": "Any existing DimStyle in the drawing",
            "unit": "string",
            "affectsOutput": "Changes the visual style of dimension text labels."
          },
          {
            "name": "nColor",
            "technicalDefault": "252",
            "businessMeaning": "Sets the CAD color index for the tile visualization lines and text.",
            "validRange": "0 - 255",
            "unit": "index",
            "affectsOutput": "Changes the display color of the generated geometry."
          },
          {
            "name": "sAutoUpdate",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles automatic recalculation of tile layout when connected geometry changes, balancing accuracy with performance.",
            "validRange": "Yes, No",
            "unit": "enum",
            "affectsOutput": "If 'No', the script does not update automatically; the user must manually trigger an update to see changes."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Appending Roof Plane (Trigger 1)",
            "effect": "Defines the primary boundary and slope for the tile layout. Without this, no calculation can occur.",
            "cascade": [
              "dHipValleyExt",
              "dDeltaL",
              "dDeltaR"
            ]
          },
          {
            "trigger": "Appending Laths (Trigger 2)",
            "effect": "Provides the physical support layout. The tile positioning and spacing logic depends entirely on the location of these laths.",
            "cascade": [
              "sDisplay"
            ]
          },
          {
            "trigger": "Appending Roof Elements (Trigger 3)",
            "effect": "Adds structural elements (e.g., rafters/trusses) which are scanned for lath beams to derive the tiling surface.",
            "cascade": [
              "sDisplay"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (3D Solid)",
            "description": "A solid body representing the total volume of the calculated tiles, excluding openings like windows or chimneys.",
            "appliedTo": "Model Space"
          },
          {
            "type": "PlaneProfile (2D Geometry)",
            "description": "Lines representing the grid pattern and/or visible width of the tiles, projected onto the roof plane.",
            "appliedTo": "Model Space / Plan View"
          },
          {
            "type": "Text Labels",
            "description": "Dimension strings indicating the visible width of specific tile columns.",
            "appliedTo": "Model Space / Plan View"
          },
          {
            "type": "Map Data (TileData)",
            "description": "Quantities of tiles sorted by type (index), stored for use in reports or lists.",
            "appliedTo": "Internal Map (Exportable)"
          }
        ]
      },
      "tokens_used": 8537,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script insertion launches 'showDialog' to configure initial properties (Display, Group, Extensions, Offsets).\",\n    \"2. User selects 'Assign roofplane' (Trigger 1) and picks a Roof Plane entity.\",\n    \"3. User selects 'Append roof laths' (Trigger 2) or 'Append roof elements' (Trigger 3) to define the structural support.\",\n    \"4. Script calculates the coordinate system and tile offset based on the Roof Plane and Lath positions.\",\n    \"5. Script extracts contact faces of laths and sorts them from Eave to Ridge.\",\n    \"6. Script merges laths that are within 50mm of each other horizontally.\",\n    \"7. [Conditional] Validation: Check if laths exist.\",\n    \"8. Script generates the tile grid array based on Roof Envelope and Tile Dimensions (Width/Height).\",\n    \"9. Script subtracts Roof Openings (windows/chimneys) and manually subtracted contours from the tile body.\",\n    \"10. Script renders 3D Body (volume), 2D Grid (lines), and Visible Width dimensions.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Check if 'isJig' flag is TRUE in internal Map\",\n      \"path1\": {\n        \"name\": \"Jig Preview Mode\",\n        \"steps\": [\n          \"Retrieve preview outline 'pl0' from Map\",\n          \"Draw hatch pattern on outline\",\n          \"Exit script (skip full calculation)\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Standard Calculation Mode\",\n        \"steps\": [\n          \"Retrieve full entity data\",\n          \"Execute geometry generation logic\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Validation: Number of Laths found > 0\",\n      \"path1\": {\n        \"name\": \"No Laths Error\",\n        \"steps\": [\n          \"Generate warning box geometry on roof plane\",\n          \"Display text: 'append laths or roof elements'\",\n          \"Exit script immediately\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Laths Present\",\n        \"steps\": [\n          \"Calculate tile positions\",\n          \"Proceed to rendering\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Lath Merging Check: Distance between"
      },
      "tokens_used": 11377,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbTileSingle.mcr\n\n## Overview\nThis script calculates the precise layout, geometry, and quantity of roof tiles or slates based on roof plane geometry and lath positions. It provides 3D visualization of the covering layer and generates material counts for production lists.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script creates 3D bodies and 2D geometry on the roof plane. |\n| Paper Space | No | Not designed for paper space detailing. |\n| Shop Drawing | No | This is a modeling/scripting tool, not a shop drawing generator. |\n\n## Prerequisites\n- **Required Entities**:\n  - `ERoofPlane` (Roof Plane entity defining the boundary and slope).\n  - `GenBeam` (Beams representing the laths/battens).\n  - `ElementRoof` (Optional, used to auto-detect laths).\n- **Minimum beam count**: 0 (Script will prompt if laths are missing).\n- **Required settings**: A valid `DimStyle` must exist in the drawing for dimension labels.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Select `hsbTileSingle.mcr` from the file list and click **Open**.\n*Result: The configuration dialog appears automatically on first insertion.*\n\n### Step 2: Configure Initial Properties\nDialog: Configuration Dialog\nAction: Set visual preferences (Display mode), Group name, and Extensions. Click **OK**.\n*Note: You can also change these later in the Properties Palette.*\n\n### Step 3: Assign Roof Plane\nCommand Line: (Right-click on the script instance in the model)\nMenu: Select `Assign roofplane`\nAction: Click on the desired `ERoofPlane` entity in your model.\n*Result: The script establishes the primary work surface and coordinate system.*\n\n### Step 4: Append Laths\nCommand Line: (Right-click on the script instance)\nMenu: Select `Append roof laths`\nPrompt: `Select a set of laths`\nAction: Select the `GenBeam` entities that represent the laths and press **Enter**.\n*Result: The script calculates tile spacing based on these laths.*\n\n### Step 5: (Optional) Append Roof Elements\nCommand Line: (Right-click on the script instance)\nMenu: Select `Append roof elements`\nAction: Select an `ElementRoof` entity.\n*Result: The script scans the element for internal laths automatically.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sDisplay | dropdown | Tile grid + visible width | Controls what is visualized: Grid lines, Visible Width, or both. |\n| sGroup | text | *Empty* | Assigns the script instance to a specific catalog group in the project tree. |\n| dHipValleyExt | number | 30 | Extension distance (mm) beyond the roof edge (hips/valleys) to ensure coverage. |\n| dDeltaL | number | 0 | Left offset (mm). Shifts the tile grid start position horizontally. |\n| dDeltaR | number | 0 | Right offset (mm). Shifts the tile grid end position horizontally. |\n| sDimStyle | string | _DimStyles | Specifies the dimension style used for labeling tile widths. |\n| nColor | number | 252 | CAD Color Index for the generated tile lines and text. |\n| sAutoUpdate | enum | Yes | If \"Yes\", the script recalculates automatically when geometry changes. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Assign roofplane | Links the script to a specific Roof Plane to define the boundary and slope. |\n| Append roof laths | Allows manual selection of lath beams to define the tile layout. |\n| Append roof elements | Attaches a roof element, automatically scanning it for laths. |\n\n## Settings Files\n- **Filename**: N/A (Uses Drawing Settings)\n- **Location**: Current DWG\n- **Purpose**: The script relies on the DimStyles defined within the current AutoCAD/hsbCAD drawing rather than an external XML file.\n\n## Tips\n- **Adjusting Alignment**: If the tile grid does not align perfectly with your roof edges (e.g., at the gable), adjust the `dDeltaL` or `dDeltaR` properties slightly rather than moving the laths.\n- **Performance**: In large models, setting `sDisplay` to \"Tile grid\" (lines only) instead of \"Tile grid + visible width\" can improve regen performance.\n- **Troubleshooting**: If you see a warning box on the roof, ensure you have selected valid laths. The script cannot calculate tiles without them.\n\n## FAQ\n- **Q: Why do I see a warning box on my roof?**\n  **A**: The script could not find any laths (`GenBeam` entities) attached to it. Use the \"Append roof laths\" or \"Append roof elements\" right-click option to assign them.\n\n- **Q: How do I change the tile width or height?**\n  **A**: This specific script relies on the positions of the laths to determine layout. To change the tile exposure, adjust the spacing of your lath beams.\n\n- **Q: The dimensions are too small to read.**\n  **A**: Change the `sDimStyle` property to a dimension style with larger text settings defined in your drawing."
      },
      "tokens_used": 5740,
      "error": null
    }
  }
}