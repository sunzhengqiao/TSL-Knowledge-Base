{
  "filename": "GH-Verbinder Top OV.mcr",
  "status": "completed",
  "total_tokens": 57997,
  "processing_time": 935.8749356269836,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": 0,\n    \"implInsert\": 0\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"3.11\",\n      \"date\": \"03/06/2024\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"HSB-22143: For site modus, change milling for Baufritz\"\n    },\n    {\n      \"version\": \"3.10\",\n      \"date\": \"10.04.2023\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"20230410: Fix House vetors make sure right hand side\"\n    },\n    {\n      \"version\": \"3.9\",\n      \"date\": \"05.07.2022\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"HSB-15918: Weinmann drill to be switsched ON/OFF depending on the state of production {Teilmontage,Werk,Baustelle}\"\n    },\n    {\n      \"version\": \"3.8\",\n      \"date\": \"10feb2021\",\n      \"author\": \"marsel.nakuci@hsbcad.com\",\n      \"changes\": \"HSB-10687: nonail area include all parts, add milling at all parts, fix hardware\"\n    },\n    {\n      \"version\": \"3.7\",\n      \"date\": \"14dec2020\",\n      \"author\": \"marsel.nakuci@hsbcad.com\",\n      \"changes\": \"HSB-10103: dAxisOffset used for distance between parts\"\n    },\n    {\n      \"version\": \"3.6\",\n      \"date\": \"14dec2020\",\n      \"author\": \"marsel.nakuci@hsbcad.com\",\n      \"changes\": \"HSB-10103: make nr of parts variable, check boundary conditions\"\n    },\n    {\n      \"version\": \"3.5\",\n      \"date\": \"29sep2020\",\n      \"author\": \"thorsten.huck@hsbCAD.com\",\n      \"changes\": \"HSB-9035 bugfix toggle plant or construction site\"\n    },\n    {\n      \"version\": \"3.4\",\n      \"date\": \"29sep2020\",\n      \"author\": \"thorsten.huck@hsbCAD.com\",\n      \"changes\": \"HSB-9024 double connector quantity output\"\n    },\n    {\n      \"version\": \"3.3\",\n      \"date\": \"28jul2020\",\n      \"author\": \"thorsten.huck@hsb"
      },
      "tokens_used": 9669,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script processes 3D entities (Beam, Element) and applies manufacturing tools (ElemMill, ElemNoNail, SolidSubtract). It creates 3D geometry (Body) and hardware components. No SD prefixes, Viewport handling, or 2D drawing generation logic found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam",
            "Element"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 8672,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 11034,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a GH-OV (Gluhlam Verbinder Oberseite) metal connector for T-, L-, or parallel timber beam connections, including necessary cuts, no-nail areas, and optional position drilling for element assembly.",
          "category": "Hardware",
          "typicalUseCase": "Connecting main beams and secondary beams in timber frame structures using a specific steel top connector plate, often in roof or floor assemblies."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "Type 40",
            "businessMeaning": "Selects the size of the GH-OV connector plate.",
            "validRange": "Type 40, Type 60, Type 80, Type 100",
            "unit": "Catalog",
            "affectsOutput": "Determines the width of the metal plate geometry (40mm, 60mm, 80mm, or 100mm) and the associated notch size in the wood."
          },
          {
            "name": "sRelief",
            "technicalDefault": "rounded",
            "businessMeaning": "Defines the corner treatment of the milled slot for the connector.",
            "validRange": "not rounded, rounded, relief, rounded with small diameter, relief with small diameter",
            "unit": "Enum",
            "affectsOutput": "Changes the geometry of the milling operation (slot) where the connector sitsâ€”sharp corners, rounded, or relief cuts to prevent stress concentration or allow for manufacturing tolerances."
          },
          {
            "name": "sConType",
            "technicalDefault": "T-Connection",
            "businessMeaning": "Defines the geometric relationship between the selected beams.",
            "validRange": "T-Connection, Length connection, Parallel connection",
            "unit": "Enum",
            "affectsOutput": "Dictates how the script calculates the intersection and placement of the connector (perpendicular, end-to-end, or side-by-side)."
          },
          {
            "name": "sElemDrill",
            "technicalDefault": "No",
            "businessMeaning": "Enables or disables a position drilling hole in the floor element for alignment during assembly.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, creates a drill/milling operation in the Element associated with the beams to mark the connector position for pre-assembly."
          },
          {
            "name": "dOffset",
            "technicalDefault": "0",
            "businessMeaning": "Moves the connector along the main beam axis.",
            "validRange": "0 to 2000",
            "unit": "mm",
            "affectsOutput": "Slides the connector slot and metal part along the length of the main beam."
          },
          {
            "name": "dCenterOffset",
            "technicalDefault": "0",
            "businessMeaning": "Shifts the connector sideways relative to the center of the main beam.",
            "validRange": "-Width/2 to Width/2",
            "unit": "mm",
            "affectsOutput": "Moves the connector laterally across the face of the main beam."
          },
          {
            "name": "nQty",
            "technicalDefault": "1",
            "businessMeaning": "Number of connectors to generate along the beam.",
            "validRange": "1, 2",
            "unit": "Count",
            "affectsOutput": "Duplicates the hardware, cuts, and tooling. Spacing is controlled by dAxisOffset."
          },
          {
            "name": "dAxisOffset",
            "technicalDefault": "0",
            "businessMeaning": "Distance between two connectors when Quantity is set to 2.",
            "validRange": "100 to 2000",
            "unit": "mm",
            "affectsOutput": "Defines the spacing between the first and second connector sets along the beam axis."
          },
          {
            "name": "dGap",
            "technicalDefault": "0",
            "businessMeaning": "Creates a vertical gap (air space) between the main and secondary beams.",
            "validRange": "0 to 20",
            "unit": "mm",
            "affectsOutput": "Lowers the secondary beam relative to the main beam, or lifts the main beam, depending on 'Gap applies to'."
          },
          {
            "name": "sGapIn",
            "technicalDefault": "Male beam",
            "businessMeaning": "Specifies which beam is moved to create the gap defined by dGap.",
            "validRange": "Male beam, Female beam, Both beams",
            "unit": "Enum",
            "affectsOutput": "Determines if the secondary beam is lowered, the main beam is lifted, or the space is split between them."
          },
          {
            "name": "dScrewHT",
            "technicalDefault": "100",
            "businessMeaning": "Length of the screw used for the Female beam (Main beam).",
            "validRange": "60 to 300",
            "unit": "mm",
            "affectsOutput": "Updates the BOM/metadata for screw requirements. Does not change geometry."
          },
          {
            "name": "dScrewNT",
            "technicalDefault": "100",
            "businessMeaning": "Length of the screw used for the Male beam (Secondary beam).",
            "validRange": "60 to 300",
            "unit": "mm",
            "affectsOutput": "Updates the BOM/metadata for screw requirements. Does not change geometry."
          },
          {
            "name": "dSnap",
            "technicalDefault": "200",
            "businessMeaning": "IntelliSnap distance for automatically detecting the beam intersection during insertion.",
            "validRange": "50 to 500",
            "unit": "mm",
            "affectsOutput": "Usability setting during script insertion. No effect on final production."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "nQty changes to 2",
            "effect": "Enables spacing calculation for the second connector.",
            "cascade": [
              "dAxisOffset"
            ]
          },
          {
            "trigger": "sType changes",
            "effect": "Adjusts internal width variable and milling tool geometry.",
            "cascade": [
              "dWidth (internal)",
              "Milling Geometry"
            ]
          },
          {
            "trigger": "sElemDrill is Yes",
            "effect": "Activates element tooling logic (positioning drills/mills).",
            "cascade": [
              "Element Milling",
              "NoNail Areas"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "MetalPart",
            "description": "GH-OV Connector Plate (Steel, zincated).",
            "appliedTo": "Inserts a 3D Body representation at the beam intersection."
          },
          {
            "type": "Milling",
            "description": "Slot/recess in the top of the beam(s) to accommodate the connector plate.",
            "appliedTo": "Main Beam and/or Secondary Beam based on connection type."
          },
          {
            "type": "ElementMill / ElemDrill",
            "description": "Positioning hole in the floor element for pre-assembly reference.",
            "appliedTo": "Linked Element (Floor/Wall) associated with the beams."
          },
          {
            "type": "NoNail Area",
            "description": "Protected area on the element where nails/screws should not be placed to avoid hitting the connector.",
            "appliedTo": "Linked Element and intersecting Elements."
          }
        ]
      },
      "tokens_used": 9790,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script via hsbCAD command.",
          "2. Display Initial Dialog (Type, Relief, Connection Type, etc.).",
          "3. Determine Connection Type (T vs. Length vs. Parallel).",
          "4. [Conditional] Prompt User for Beam Selection based on Connection Type.",
          "5. [Conditional] If Parallel Connection, prompt for Reference Point along the beams.",
          "6. System auto-assigns Main (Female) and Secondary (Male) beam roles based on geometry.",
          "7. Insert Script Instance into drawing.",
          "8. Execute Calculation Logic:",
          "   - Calculate intersection/coordinate system.",
          "   - Apply offsets (dOffset, dCenterOffset).",
          "   - Determine geometry width based on sType.",
          "9. Loop for Quantity (nQty):",
          "   - Apply spacing if nQty > 1.",
          "   - Apply Gap (dGap) logic to beams.",
          "   - Generate Beam Milling/Drilling.",
          "   - Create Connector Body (3D representation).",
          "10. Check for Linked Element (Floor/Wall).",
          "11. [Conditional] If Element Drill is Yes:",
          "   - Generate Position Milling/Drilling in Element.",
          "   - Calculate and Apply NoNail areas to Element and intersecting Elements.",
          "12. Update BOM and Properties.",
          "13. Finalize Script Execution."
        ],
        "conditionalBranches": [
          {
            "condition": "Connection Type selection (sConType) during Insert",
            "path1": {
              "name": "T-Connection",
              "steps": [
                "Prompt: Select beams (Single selection set).",
                "Script identifies intersection.",
                "Auto-detects Main vs Secondary beams."
              ]
            },
            "path2": {
              "name": "Length / Parallel Connection",
              "steps": [
                "Prompt: Select exactly 2 beams (Loop until 2 collected).",
                "If Parallel: Prompt for Reference Point (_Pt0) to define placement along the beam.",
                "Use specific vector logic for end-to-end or side-by-side alignment."
              ]
            }
          },
          {
            "condition": "Element Drill setting (sElemDrill)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Search for valid Element linked to Main Beam.",
                "Generate position milling (ElemMill) in Element Zone 1.",
                "Subtract tool body from Element sheets.",
                "Apply NoNail areas to linked Element and all intersecting Elements."
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skip Element search.",
                "Skip Element Milling.",
                "Skip NoNail generation (unless implied by other tooling)."
              ]
            }
          },
          {
            "condition": "Quantity setting (nQty)",
            "path1": {
              "name": "Single Connector",
              "steps": [
                "Calculate position based on dOffset.",
                "Generate geometry once."
              ]
            },
            "path2": {
              "name": "Double Connector",
              "steps": [
                "Loop iteration 1: Generate connector at base position.",
                "Loop iteration 2: Generate connector at base position + dAxisOffset.",
                "Generate combined tooling for both."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection Count",
            "errorMessage": "Script aborts/erases instance.",
            "recovery": "User must select at least 1 beam for T-connection, or exactly 2 beams for Length/Parallel connections."
          },
          {
            "check": "Parallel Connection Reference",
            "errorMessage": "Script fails to calculate position.",
            "recovery": "When selecting parallel beams, ensure a valid reference point is provided when prompted."
          },
          {
            "check": "Element Validity",
            "errorMessage": "No Element tooling generated.",
            "recovery": "Ensure the Main Beam is correctly grouped to a floor/wall element in the CAD model structure."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Geometry Parameters",
            "how": "Properties Palette (OPM)",
            "effect": "Updates connector size (sType), offsets (dOffset), or quantity (nQty) and immediately recalculates tooling."
          },
          {
            "action": "Flip Connector Side",
            "how": "Right-click Context Menu -> 'Seite wechseln'",
            "effect": "Toggles the orientation of the milling and connector relative to the beam centerline or intersection vector."
          },
          {
            "action": "Adjust Connection Configuration",
            "how": "Properties Palette (OPM) -> sConType",
            "effect": "Allows switching between T, Length, and Parallel logic (Note: May require re-selection of beams if vector logic differs significantly)."
          },
          {
            "action": "Toggle Production Mode",
            "how": "Properties Palette (OPM) -> Mounting/Production State",
            "effect": "Changes drilling/milling strategies (e.g., Weinmann drills ON/OFF based on Plant vs Site mode)."
          }
        ]
      },
      "tokens_used": 11808,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GH-Verbinder Top OV\n\n## Overview\nThis script generates a GH-OV (Gluhlam Verbinder Oberseite) metal connector plate for T-, L-, or parallel timber beam connections. It automatically creates the necessary wood recesses (milling), places the 3D hardware representation, and optionally adds positioning drills and no-nail areas to the linked floor element.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for inserting the connector on 3D beams. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: At least two Timber Beams (GenBeam) or Structural Members. Optionally, a Floor/Wall Element linked to the main beam if using element drilling features.\n- **Minimum Beam Count**: 2 (Script logic adapts for T-connections vs. End-to-End or Parallel connections).\n- **Required Settings**: Standard Production State settings (Plant vs. Construction Site) determine specific drilling/milling strategies (e.g., Weinmann drills).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `GH-Verbinder Top OV.mcr`.\n\n### Step 2: Configure Initial Settings\n```\nDialog: Configuration\nAction: Select the Connector Type (e.g., Type 60), Relief style, and Connection Type (T, Length, or Parallel) in the initial dialog. Click OK.\n```\n\n### Step 3: Select Beams\nThe prompts vary based on the Connection Type selected in Step 2.\n\n**Scenario A: T-Connection**\n```\nCommand Line: Select beams:\nAction: Click on the intersecting beams. The script will automatically detect the intersection and assign Main (Female) and Secondary (Male) roles.\n```\n\n**Scenario B: Length or Parallel Connection**\n```\nCommand Line: Select beam 1:\nAction: Click the first beam.\n\nCommand Line: Select beam 2:\nAction: Click the second beam.\n\nCommand Line: (If Parallel) Specify reference point:\nAction: Click a point along the beams to define exactly where the connector should be placed.\n```\n\n### Step 4: Finalize Insertion\nAction: The script instance is inserted at the calculated intersection. Open the **Properties Palette** (Ctrl+1) to fine-tune offsets, gaps, or quantity if needed.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **sType** | dropdown | Type 40 | Size of the connector plate (Width: 40/60/80/100mm). |\n| **sRelief** | dropdown | rounded | Corner treatment of the milled slot (Sharp, Rounded, or Relief cuts). |\n| **sConType** | dropdown | T-Connection | Geometric relationship between beams (T, Length, Parallel). |\n| **sElemDrill** | dropdown | No | Adds a positioning drill hole in the linked floor element. |\n| **dOffset** | number | 0 | Moves the connector along the main beam axis. |\n| **dCenterOffset** | number | 0 | Moves the connector sideways relative to the main beam center. |\n| **nQty** | integer | 1 | Number of connectors (1 or 2). |\n| **dAxisOffset** | number | 0 | Distance between connectors if Quantity is 2. |\n| **dGap** | number | 0 | Vertical air gap created between beams. |\n| **sGapIn** | dropdown | Male beam | Determines which beam moves to create the gap (Male, Female, or Both). |\n| **dScrewHT** | number | 100 | Screw length for the Female (Main) beam (BOM only). |\n| **dScrewNT** | number | 100 | Screw length for the Male (Secondary) beam (BOM only). |\n| **dSnap** | number | 200 | IntellSnap detection radius during insertion. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Seite wechseln | Flips the connector orientation to the opposite side of the beam centerline or intersection vector. |\n\n## Settings Files\n- **Production State Config**: Controlled by global hsbCAD settings (`Werk`, `Baustelle`, `Teilmontage`).\n- **Purpose**: Determines if specific Weinmann drills are enabled or disabled based on the assembly location (Plant vs. Site).\n\n## Tips\n- **Double Connectors**: Use `nQty = 2` combined with `dAxisOffset` to quickly create pairs of connectors without inserting the script twice.\n- **Element Assembly**: If `sElemDrill` is set to \"Yes\" but no hole appears, check that your Main Beam is correctly grouped to a floor element in the model structure.\n- **Parallel Connections**: When using \"Parallel connection\", ensure you pick a clear reference point near the desired location to avoid the connector snapping to the wrong end of the beam.\n\n## FAQ\n- **Q: Why is the connector not sitting flush with the beam top?**\n  A: Check the `dGap` parameter. If a gap is applied, ensure `sGapIn` is set correctly to move the intended beam (Male or Female).\n- **Q: Can I switch from a T-connection to a Parallel connection after inserting?**\n  A: Yes, change `sConType` in the Properties Palette. You may need to adjust the `dOffset` or re-select beams if the intersection vectors differ significantly.\n- **Q: The script is creating drilling operations in the element that I don't want.**\n  A: Set `sElemDrill` to \"No\" in the Properties Palette. This will remove the element tooling and no-nail areas."
      },
      "tokens_used": 7024,
      "error": null
    }
  }
}