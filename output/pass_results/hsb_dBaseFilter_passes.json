{
  "filename": "hsb_dBaseFilter.mcr",
  "status": "completed",
  "total_tokens": 31167,
  "processing_time": 222.6390917301178,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "09.06.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Bugfix"
          },
          {
            "version": "1.2",
            "date": "20.10.2010",
            "author": "",
            "changes": "Add sequence number"
          },
          {
            "version": "1.3",
            "date": "24.02.2011",
            "author": "",
            "changes": "Add special set of rules"
          },
          {
            "version": "1.5",
            "date": "10.08.2011",
            "author": "",
            "changes": "Dormel elements get shaped information too"
          },
          {
            "version": "1.6",
            "date": "23.03.2012",
            "author": "",
            "changes": "Add nErase option"
          },
          {
            "version": "1.7",
            "date": "28.05.2012",
            "author": "",
            "changes": "Moved special options into properties"
          },
          {
            "version": "1.8",
            "date": "23.10.2019",
            "author": "",
            "changes": "Small performance improvement. No need to check for Squared or Special if its Shaped."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4977,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script utilizes PrEntity with ElementWallSF() to select entities. It iterates over Element members and queries geometry using el.beam() and el.profBrutto(0). The script calls eraseInstance() after processing, characteristic of a transient utility script operating on Model Space data. No ShopDrawing (sd_) or Paper Space (_Viewport) APIs are used."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Wall Elements",
          "requiredSettings": []
        }
      },
      "tokens_used": 4104,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one or More Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowPropertiesDialog",
            "trigger": "_bOnInsert && _kExecuteKey==\"\"",
            "title": "Properties",
            "dataSource": "TSL Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sUseSpecialRules",
            "type": "PropString",
            "displayName": "Set Special Rules",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dMaxHeight",
            "type": "PropDouble",
            "displayName": "Special if wall is higher than:",
            "defaultValue": "U(3200, 125)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Deactivated if set to 0"
          },
          {
            "index": 1,
            "variable": "dMinHeight",
            "type": "PropDouble",
            "displayName": "Special if wall is lower than:",
            "defaultValue": "U(1500, 60)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Deactivated if set to 0"
          },
          {
            "index": 2,
            "variable": "dMinLength",
            "type": "PropDouble",
            "displayName": "Special if wall is shorter than:",
            "defaultValue": "U(1500, 60)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Deactivated if set to 0"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5991,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Classifies selected Wall Elements into production categories (Shaped, Special, or Square) based on their geometric complexity and dimensional thresholds to automate filtering for downstream processes like manufacturing or engineering.",
          "category": "Data Management / Utility",
          "typicalUseCase": "Used after drawing walls to automatically tag walls that have gables (Shaped) or are non-standard dimensions (Special), allowing the user to filter these lists for production schedules or specific CAM operations."
        },
        "parameters": [
          {
            "name": "sUseSpecialRules",
            "technicalDefault": "\"No\"",
            "businessMeaning": "Master switch to enable dimensional filtering. If set to 'No', the script only checks if the wall is geometrically complex (Shaped) or simple (Square). If 'Yes', it applies height and length thresholds to flag dimensionally unique walls as 'Special'.",
            "validRange": "\"No\", \"Yes\"",
            "unit": "String",
            "affectsOutput": "Determines whether the Min/Max Height and Min Length parameters are evaluated to assign the 'Special' tag."
          },
          {
            "name": "dMaxHeight",
            "technicalDefault": "U(3200, 125)",
            "businessMeaning": "Defines the height threshold above which a wall is considered non-standard or 'Special'. Used to identify tall walls that may require specific engineering, bracing, or handling during transport.",
            "validRange": "0 to 10000 mm (0 to 400 inches)",
            "unit": "Length (mm/inches)",
            "affectsOutput": "If wall height > this value (and > 0), the Element Information is set to 'Special'."
          },
          {
            "name": "dMinHeight",
            "technicalDefault": "U(1500, 60)",
            "businessMeaning": "Defines the height threshold below which a wall is considered a dwarf wall, pony wall, or kick-wall and flagged as 'Special'. These often require different nailing patterns or ledger details.",
            "validRange": "0 to 3000 mm (0 to 120 inches)",
            "unit": "Length (mm/inches)",
            "affectsOutput": "If wall height < this value (and > 0), the Element Information is set to 'Special'."
          },
          {
            "name": "dMinLength",
            "technicalDefault": "U(1500, 60)",
            "businessMeaning": "Defines the length threshold below which a wall is considered too short for standard production flow or a shear segment, flagged as 'Special'. Short walls are often difficult to handle on assembly tables or may represent filler pieces.",
            "validRange": "0 to 6000 mm (0 to 240 inches)",
            "unit": "Length (mm/inches)",
            "affectsOutput": "If wall length < this value (and > 0), the Element Information is set to 'Special'."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sUseSpecialRules is set to \"No\"",
            "effect": "The dimensional checks for Height and Length are skipped.",
            "cascade": [
              "dMaxHeight",
              "dMinHeight",
              "dMinLength"
            ]
          },
          {
            "trigger": "Any Dimensional parameter (dMaxHeight, dMinHeight, dMinLength) is set to 0",
            "effect": "That specific dimension check is ignored (treated as inactive), even if sUseSpecialRules is 'Yes'.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Element Information Property",
            "description": "Sets the text classification of the Wall Element.",
            "appliedTo": "Selected Wall Elements (ElementWallSF)"
          }
        ]
      },
      "tokens_used": 4913,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Start",
          "Set Instance Sequence Number",
          "Load Properties from Catalog (if _bOnDbCreated)",
          "Check for Insertion Phase (_bOnInsert)",
          "If Inserting: Check insertCycleCount() > 1",
          "If > 1: Erase Instance and Exit",
          "If == 1: Show Properties Dialog if key is empty",
          "Prompt User to Select Elements (PrEntity)",
          "If User provides input: Append Elements to Set",
          "Exit Insertion Phase (Return)",
          "Check if Elements exist in Set",
          "If Set is empty: Erase Instance and Exit",
          "Iterate through each Element in Set",
          "Get Element Coordinate System and Beams",
          "Check for Complex Geometry (Gables/Angles)",
          "If Complex Found: Set Element Information to 'Shaped'",
          "If Simple Geometry: Calculate Element Height and Length",
          "Check Special Rules Toggle (sUseSpecialRules)",
          "If Enabled: Compare dimensions against Thresholds (dMinHeight, dMaxHeight, dMinLength)",
          "If Thresholds Met: Set Element Information to 'Special'",
          "Else: Set Element Information to 'Square'",
          "Check Erase Flag or Event Trigger (_bOnElementConstructed)",
          "Erase Instance and Exit"
        ],
        "conditionalBranches": [
          {
            "condition": "Wall Geometry Analysis (Is Shaped?)",
            "path1": {
              "name": "Shaped Wall",
              "steps": [
                "Identify Angled Top Plate beam types",
                "Check Bottom Plate alignment",
                "If angle or misalignment found -> Set Info to 'Shaped'",
                "Skip Dimension Checks"
              ]
            },
            "path2": {
              "name": "Non-Shaped Wall",
              "steps": [
                "Extract Brutto Profile Extents",
                "Calculate Height and Length",
                "Evaluate Special Rules (Optional)",
                "Set Info to 'Special' or 'Square'"
              ]
            }
          },
          {
            "condition": "Special Rules Enabled (sUseSpecialRules == 'Yes')",
            "path1": {
              "name": "Apply Dimensional Rules",
              "steps": [
                "Check if Height > dMaxHeight",
                "Check if Height < dMinHeight",
                "Check if Length < dMinLength",
                "If any condition matches -> Set Info to 'Special'"
              ]
            },
            "path2": {
              "name": "Ignore Dimensional Rules",
              "steps": [
                "Skip Min/Max Height and Length checks",
                "Set Info to 'Square' (Since Shaped check already failed)"
              ]
            }
          },
          {
            "condition": "Initial Insertion Cycle",
            "path1": {
              "name": "Standard Insert",
              "steps": [
                "Show Properties Dialog",
                "Run PrEntity Selection",
                "Process Elements in next execution cycle"
              ]
            },
            "path2": {
              "name": "Redundant Cycle (insertCycleCount > 1)",
              "steps": [
                "Erase Instance immediately",
                "Stop execution"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection Validity",
            "errorMessage": "None explicit, but script erases itself if no elements are found.",
            "recovery": "User must ensure they select valid ElementWallSF entities during the PrEntity prompt."
          },
          {
            "check": "Entity Type",
            "errorMessage": "None explicit (Handled by PrEntity filter ElementWallSF).",
            "recovery": "User cannot select non-Wall entities due to filter."
          },
          {
            "check": "Dimensional Thresholds",
            "errorMessage": "None explicit.",
            "recovery": "Set dMinHeight, dMaxHeight, or dMinLength to 0 in properties to deactivate specific checks if they are flagging too many walls incorrectly."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Re-filter Elements",
            "how": "Run script again on existing elements (Script is transient).",
            "effect": "Overwrites existing Element Information with new calculation based on current property settings."
          },
          {
            "action": "Adjust Thresholds",
            "how": "Select the script instance or use Properties Palette before selection.",
            "effect": "Changes the criteria for 'Special' classification in subsequent executions."
          }
        ]
      },
      "tokens_used": 5463,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_dBaseFilter.mcr\n\n## Overview\nThis script automatically classifies selected Wall Elements into production categories ('Shaped', 'Special', or 'Square') based on their geometry and dimensions. It updates the \"Element Information\" field to help filter lists for manufacturing or engineering reports.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on Wall Elements in the model. |\n| Paper Space | No | Not intended for layout views. |\n| Shop Drawing | No | Does not process drawing views. |\n\n## Prerequisites\n- **Required Entities**: Wall Elements (`ElementWallSF`).\n- **Minimum Beams**: 1 Wall Element must be selected.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Select `hsb_dBaseFilter.mcr` from the file dialog.\n\n### Step 2: Configure Properties (Optional)\n1. Upon insertion, the Properties palette may open automatically.\n2. Adjust the filtering rules (e.g., height limits) if the default values do not match your project requirements.\n\n### Step 3: Select Elements\n```\nCommand Line: Select one or More Elements\nAction: Click on the Wall Elements you wish to classify and press Enter.\n```\n*Note: The script instance will disappear automatically after processing.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Set Special Rules | dropdown | No | Master switch to enable dimensional filtering. If 'No', only geometry (Shaped vs. Square) is checked. |\n| Special if wall is higher than: | number | 3200mm (125\") | Walls taller than this value are marked 'Special'. Set to 0 to disable. |\n| Special if wall is lower than: | number | 1500mm (60\") | Walls shorter than this value are marked 'Special'. Set to 0 to disable. |\n| Special if wall is shorter than: | number | 1500mm (60\") | Walls with a length shorter than this value are marked 'Special'. Set to 0 to disable. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are defined for this script. |\n\n## Settings Files\n- **Filename**: None used.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Geometry Priority**: If a wall contains a gable, angled top plate, or complex geometry, it is always marked as **\"Shaped\"**, regardless of its height or length settings.\n- **Disabling Checks**: To ignore a specific dimension rule (e.g., you don't care about wall height), set that specific property value to `0`.\n- **Re-running**: To re-classify walls after changing parameters, simply run the script again and select the same elements.\n- **Data Location**: The result is written to the element's data fields. You can check the classification by selecting a wall and looking at its Element Information or generating a listing report.\n\n## FAQ\n- **Q: The script disappeared after I selected the walls. Did it work?**\n  - A: Yes. This is a \"transient\" script designed to run once and delete itself. Check the properties of the selected walls to see the updated \"Element Information.\"\n  \n- **Q: What is the difference between \"Shaped\" and \"Special\"?**\n  - A: \"Shaped\" refers to complex geometry (gables, dormers, non-rectangular shapes). \"Special\" refers to standard rectangular walls that fall outside your defined height or length thresholds (e.g., very tall or very short walls).\n\n- **Q: How do I see the results for all walls?**\n  - A: Use the hsbCAD listing or reporting tools to filter/export based on the \"Element Information\" field."
      },
      "tokens_used": 5719,
      "error": null
    }
  }
}