{
  "filename": "GE_PLOT_SHOW_NAILING_DESCRIPTION.mcr",
  "status": "completed",
  "total_tokens": 32214,
  "processing_time": 381.58533906936646,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "19.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Copied from hsb_ShowNailingDescription, to keep US content folder naming standards - Thumbnail added"
          },
          {
            "version": "1.5",
            "date": "19.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Version control from 1.0 to 1.5, to keep updated with hsb_ShowNailingDescription"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5005,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script utilizes `getViewport()` to prompt the user for a viewport selection and accesses `_Viewport[0].element()`. It calculates coordinate transformations (`vp.coordSys()`, `ps2ms`) and applies a scale factor (`ps2ms.scale()`) to the `Display.dimStyle()` method, which is characteristic of Paper Space annotation scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element (via Viewport)",
            "TslInst (attached to Element containing 'NailingInfo' map)"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Paper Space (Layout) containing a valid Viewport linked to an hsbCAD Element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 3689,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Pick a Point To Locate the Description",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Standard Properties Dialog",
            "trigger": "Insertion (via showDialogOnce)",
            "title": "Properties",
            "dataSource": "Script Properties (nZone, sDimLayout, dOffsetBetweenLn, sYesNoNailingType, sPrefix)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nZone",
            "type": "PropInt",
            "displayName": "Nailing Zone",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimLayout",
            "type": "PropString",
            "displayName": "Dim Style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": "_DimStyles (System Styles)",
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffsetBetweenLn",
            "type": "PropDouble",
            "displayName": "Offset Between Text Lines",
            "defaultValue": "5mm",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sYesNoNailingType",
            "type": "PropString",
            "displayName": "Show Nailing Type",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sPrefix",
            "type": "PropString",
            "displayName": "Nailing Description Prefix",
            "defaultValue": "Cladding Nailing: ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5362,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Displays a text label in Paper Space showing the nailing schedule (spacing and nail type) for a specific element and zone, calculated from model data.",
          "category": "ShopDrawing",
          "typicalUseCase": "Annotating a wall panel layout drawing to show the required fastener spacing for the sheathing or cladding based on engineering calculations stored in the model."
        },
        "parameters": [
          {
            "name": "nZone",
            "technicalDefault": "0",
            "businessMeaning": "Selects which specific nailing zone (data set) to display. Elements may have different nailing requirements for edges, fields, or different sides (e.g., Zone 1: Perimeter, Zone 2: Intermediate).",
            "validRange": "1 - 10",
            "unit": "count",
            "affectsOutput": "Determines which specific spacing values and nail types are retrieved from the element's data map and displayed in the text label."
          },
          {
            "name": "sDimLayout",
            "technicalDefault": "null",
            "businessMeaning": "Sets the graphical style (text height, font, color, layer) of the annotation to match the project's drafting standards.",
            "validRange": "Any existing Dimension Style name in the drawing",
            "unit": "text_style",
            "affectsOutput": "Changes the appearance and scale of the generated text label in the drawing viewport."
          },
          {
            "name": "dOffsetBetweenLn",
            "technicalDefault": "5mm",
            "businessMeaning": "Controls the vertical gap between the primary line (Spacing info) and the secondary line (Nail Type info) when both are displayed.",
            "validRange": "0mm - 20mm",
            "unit": "mm",
            "affectsOutput": "Adjusts the vertical spacing of the multi-line text block to prevent overlap or improve readability."
          },
          {
            "name": "sYesNoNailingType",
            "technicalDefault": "No",
            "businessMeaning": "Toggle to include or exclude the specific nail product code or description in the annotation.",
            "validRange": "Yes, No",
            "unit": "boolean",
            "affectsOutput": "If 'Yes', adds a second line of text displaying 'Nail Type: [Code]'; if 'No', this line is omitted."
          },
          {
            "name": "sPrefix",
            "technicalDefault": "Cladding Nailing: ",
            "businessMeaning": "A customizable text label that appears immediately before the spacing values to describe what is being nailed (e.g., 'Floor Nailing:', 'Sheathing:').",
            "validRange": "Any alphanumeric string",
            "unit": "text",
            "affectsOutput": "Prepends the specified text to the spacing output string."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sYesNoNailingType is set to 'No'",
            "effect": "The parameter dOffsetBetweenLn is effectively ignored as the second line of text is not drawn.",
            "cascade": [
              "dOffsetBetweenLn"
            ]
          },
          {
            "trigger": "nZone selection",
            "effect": "The displayed values for Spacing and Nail Type change based on the data stored in the Element's attached TSL instance map for that specific zone index.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Text Annotation (Paper Space)",
            "description": "A multi-line text label displaying nailing spacing (Perimeter / Intermediate) and optionally the Nail Type, formatted according to the selected Dim Style.",
            "appliedTo": "Paper Space Layout (at the user-picked insertion point)"
          }
        ]
      },
      "tokens_used": 5224,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Insertion Initiated",
          "Check Insert Cycle Count (prevent duplicate instances)",
          "Prompt User: Pick insertion point in Paper Space",
          "Prompt User: Select a Viewport containing model data",
          "Display Properties Dialog (configure Zone, Style, Prefix, etc.)",
          "Script Recalculation Triggered (post-insert)",
          "Validate Viewport and Element existence",
          "Validate Element contains Beams",
          "Iterate attached TSL instances to find 'NailingInfo' map",
          "Retrieve Spacing (Perimeter/Intermediate) and Nail Type for selected Zone",
          "Check Element for Sheets (Cladding)",
          "Render Text: Display 'N/A' or Spacing Data based on Sheet check",
          "Render Text: Display Nail Type (optional) based on property setting and data availability"
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "Count > 1",
              "steps": [
                "Erase current script instance",
                "Exit script immediately"
              ]
            },
            "path2": {
              "name": "Count == 1",
              "steps": [
                "Proceed to User Prompts"
              ]
            }
          },
          {
            "condition": "Viewport Assignment",
            "path1": {
              "name": "Viewport array empty",
              "steps": [
                "Erase instance",
                "Exit"
              ]
            },
            "path2": {
              "name": "Viewport valid",
              "steps": [
                "Calculate coordinate transforms (Paper Space <-> Model Space)",
                "Proceed to Element validation"
              ]
            }
          },
          {
            "condition": "Element Beam Count",
            "path1": {
              "name": "Beams < 1",
              "steps": [
                "Exit script (No text drawn)"
              ]
            },
            "path2": {
              "name": "Beams >= 1",
              "steps": [
                "Proceed to Data Extraction"
              ]
            }
          },
          {
            "condition": "Cladding/Sheet Existence",
            "path1": {
              "name": "No Sheets (Length == 0)",
              "steps": [
                "Draw static text: 'Cladding Nailing: N/A'"
              ]
            },
            "path2": {
              "name": "Sheets Present",
              "steps": [
                "Construct string: Prefix + Perimeter Spacing + Intermediate Spacing",
                "Draw data text"
              ]
            }
          },
          {
            "condition": "Nail Type Display Logic",
            "path1": {
              "name": "Property 'Yes' AND Data String Not Empty",
              "steps": [
                "Draw second line: 'Nail Type: [Data]' below the spacing line"
              ]
            },
            "path2": {
              "name": "Property 'No' OR Data String Empty",
              "steps": [
                "Skip second line drawing"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "None (Silent failure)",
            "recovery": "The instance self-erases if the viewport link is lost. Re-insert the script and select a valid viewport."
          },
          {
            "check": "Element Validity",
            "errorMessage": "None (Silent failure)",
            "recovery": "Ensure the selected viewport is looking at a valid hsbCAD Element or Group."
          },
          {
            "check": "Beam Availability",
            "errorMessage": "None (Silent failure)",
            "recovery": "The script will not generate text if the element contains 0 beams. Verify the element structure."
          },
          {
            "check": "NailingInfo Map Availability",
            "errorMessage": "None (Defaults to 0)",
            "recovery": "If 'NailingInfo' map is missing in attached TSLs, spacing displays as '0mm'. Ensure the element has the correct nailing generation TSL attached."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Nailing Zone",
            "how": "OPM Property 'Nailing Zone'",
            "effect": "Updates the displayed spacing values to correspond with the selected zone index (1-10)."
          },
          {
            "action": "Modify Appearance",
            "how": "OPM Properties 'Dim Style', 'Offset Between Text Lines', 'Show Nailing Type', 'Prefix'",
            "effect": "Changes text font/size, vertical spacing between lines, visibility of the second text line, and the leading description text."
          },
          {
            "action": "Move Annotation",
            "how": "AutoCAD Grips (Standard TSL Insertion Point)",
            "effect": "Relocates the text block to a new position in Paper Space."
          }
        ]
      },
      "tokens_used": 7062,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_PLOT_SHOW_NAILING_DESCRIPTION.mcr\n\n## Overview\nThis script automatically generates text labels in Paper Space displaying the nailing schedule (spacing and nail type) for specific elements. It retrieves engineering data from the model and places it in your layout drawings based on the viewport and zone selected.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | The script reads data from here but does not place objects here. |\n| Paper Space | Yes | This script must be inserted into a Layout tab. |\n| Shop Drawing | Yes | Used for annotating production drawings. |\n\n## Prerequisites\n- **Required Entities**: A Layout tab containing a Viewport linked to a valid hsbCAD Element.\n- **Minimum Beam Count**: 1 (The selected Element must contain structural members).\n- **Required Settings**: The Element must have an attached TSL instance that contains a 'NailingInfo' data map (usually generated by a wall/roof script).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nSelect `GE_PLOT_SHOW_NAILING_DESCRIPTION.mcr` from the file browser.\n\n### Step 2: Pick Location\n```\nCommand Line: Pick a Point To Locate the Description\nAction: Click inside the Paper Space layout where you want the nailing label to appear.\n```\n\n### Step 3: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click the border of the viewport that displays the wall or floor element you wish to annotate.\n```\n\n### Step 4: Configure Properties\nAfter selecting the viewport, the Properties dialog will appear automatically. Adjust settings if necessary and press OK.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Nailing Zone | dropdown | 1 | Selects the specific nailing zone data to display (Range: 1-10). Use different zones if the element has multiple nailing schedules (e.g., zone 1 for perimeter, zone 2 for field). |\n| Dim Style | dropdown | *Current* | Selects the Dimension Style to control text height, font, and layer. |\n| Offset Between Text Lines | number | 5mm | Sets the vertical distance between the spacing line and the nail type line (if visible). |\n| Show Nailing Type | dropdown | No | Toggles the display of the specific nail product code on a second line. |\n| Nailing Description Prefix | text | Cladding Nailing: | Custom text added before the spacing values (e.g., \"Floor Nailing: \", \"Sheathing: \"). |\n\n## Right-Click Menu Options\n*None defined.*\n\n## Settings Files\n*None defined.*\n\n## Tips\n- **Updating Text**: If the model changes, simply select the text label and right-click to **Recalc** (or force a recalculation via the hsbCAD menu) to update the values.\n- **Missing Data**: If the label displays \"N/A\", ensure the element inside the viewport actually has cladding or sheets assigned.\n- **Zero Values**: If the label shows \"0mm\" spacing, check that the element has the correct nailing calculation script attached and that the selected 'Nailing Zone' actually contains data.\n- **Moving Text**: Use the standard AutoCAD grip at the insertion point to drag the label to a clearer location on the drawing.\n\n## FAQ\n- **Q: Why did the text disappear after I deleted the viewport?**\n  A: This script is linked to the viewport. If the viewport is removed, the script instance is automatically erased.\n- **Q: Can I use this for multiple elements on the same layout?**\n  A: Yes, run the script again for each viewport/element combination you need to label.\n- **Q: The text is too small to read.**\n  A: Change the 'Dim Style' property to a style with a larger text height defined in your drawing standards."
      },
      "tokens_used": 5872,
      "error": null
    }
  }
}