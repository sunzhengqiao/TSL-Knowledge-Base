{
  "filename": "hsb_LockAndTagBeams.mcr",
  "status": "completed",
  "total_tokens": 14299,
  "processing_time": 369.27326107025146,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 2402,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity with Beam() filter to select entities and operates on GenBeam instances via the _Beam array. There is no use of sd_ prefix, _Viewport access, or ShopDrawing specific entities like #Type E with _Entity[]. The script ends with eraseInstance(), which is typical for utility-style scripts executed in the 3D model."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Beams to process",
          "requiredSettings": []
        }
      },
      "tokens_used": 1134,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect beams",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 1627,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Utility script to lock selected beams to their parent Element by tagging them with a 'NoErase' attribute, ensuring they remain associated and are not removed during automated processes or updates.",
          "category": "Utility / Model Management",
          "typicalUseCase": "Used when a user wants to safeguard specific structural members (beams) from being deleted or losing their association during model regeneration, element splitting, or export routines."
        },
        "parameters": [
          {
            "name": "ssE",
            "technicalDefault": "null",
            "businessMeaning": "The selection set of timber beams to be locked and tagged.",
            "validRange": "1 or more Beams",
            "unit": "Count",
            "affectsOutput": "Determines which beams receive the 'NoErase' tag and parent handle update. Only selected beams are modified."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "Data Attribute (SubMap)",
            "description": "Writes a specific map entry named 'NoErase' containing the handle of the parent Element to the selected beams. Also updates the internal 'panhand' reference.",
            "appliedTo": "The specific Beam entities selected by the user during the PrEntity prompt."
          }
        ]
      },
      "tokens_used": 2997,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches script (hsb_LockAndTagBeams)",
          "Script checks if this is the initial insertion cycle (_bOnInsert)",
          "Script checks if insertCycleCount is greater than 1",
          "If cycle > 1, script erases itself and terminates",
          "If cycle is 1, script prompts user to select entities (PrEntity) filtered for Beams",
          "User selects Beams and confirms selection",
          "Selected Beams are stored in the internal _Beam array",
          "Script instance is erased, preparing for the next execution cycle",
          "Script runs again with _bOnInsert false, processing stored Beams",
          "For each Beam in the array, the script retrieves the parent Element",
          "Script sets the Beam's panhand (parent handle) to the Element",
          "Script creates a Map with the key 'Key' containing the Element's handle",
          "Script writes this Map to the Beam as a sub-map named 'NoErase'",
          "Script instance is erased, execution completes"
        ],
        "conditionalBranches": [
          {
            "condition": "Is this the first insertion cycle? (_bOnInsert)",
            "path1": {
              "name": "Insertion Phase (Cycle 1)",
              "steps": [
                "Check insertCycleCount",
                "Prompt for Beam selection",
                "Store selection in _Beam",
                "Erase instance"
              ]
            },
            "path2": {
              "name": "Processing Phase (Cycle 2+)",
              "steps": [
                "Iterate through _Beam array",
                "Set parent handle and NoErase attribute",
                "Erase instance"
              ]
            }
          },
          {
            "condition": "Is the insertion cycle count greater than 1?",
            "path1": {
              "name": "Recursive Call Detected (Cycle > 1)",
              "steps": [
                "Erase instance immediately",
                "Stop script execution"
              ]
            },
            "path2": {
              "name": "Fresh Insertion (Cycle == 1)",
              "steps": [
                "Proceed to PrEntity prompt for Beams"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "User selects valid Beam entities",
            "errorMessage": "None explicit in code",
            "recovery": "User must retry script execution and select Beams"
          },
          {
            "check": "Beam has a valid parent Element handle",
            "errorMessage": "None explicit in code",
            "recovery": "N/A (Script assumes valid hsbCAD hierarchy)"
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 2509,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_LockAndTagBeams.mcr\n\n## Overview\nThis utility script protects selected structural beams from being deleted or losing their connection to their parent element during automated model processes. It applies a specific 'NoErase' tag to the selected beams, ensuring they are preserved during updates, element splitting, or export routines.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Primary execution environment. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required entities**: Structural Beams (GenBeam) that belong to an Element.\n- **Minimum beam count**: 1 or more.\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_LockAndTagBeams.mcr`\n\n### Step 2: Select Beams\n```\nCommand Line: Select beams\nAction: Click on the beams in the 3D model that you want to lock and protect. Press Enter to confirm the selection.\n```\n\n### Step 3: Automatic Processing\nAction: The script will automatically run in the background. It will link the selected beams to their parent Element and apply the 'NoErase' attribute. The script instance will remove itself from the drawing immediately upon completion.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| N/A | N/A | N/A | This script has no editable properties in the Properties Palette. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| N/A | This script does not add specific options to the right-click context menu. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- Use this script before running major model regeneration or export routines to safeguard critical structural members.\n- Ensure the beams you select are already part of an Element; the script relies on finding the parent Element to function correctly.\n- The process is instantaneous; the script will disappear from the drawing immediately after processing the beams.\n\n## FAQ\n- **Q: What happens if I run this script on a beam that is not part of an Element?**\n  - A: The script may fail to tag the beam correctly because it cannot find a parent handle. Ensure beams are properly assigned to Elements before running.\n- **Q: How can I remove the \"NoErase\" tag?**\n  - A: This script acts as a \"lock.\" You would typically need to use a complementary \"Unlock\" script or manually edit the beam attributes via the hsbCAD Entity Properties to remove the map entry named 'NoErase'.\n- **Q: Does this script change the geometry of the beam?**\n  - A: No. It only changes internal data attributes regarding the beam's relationship to its parent element and its deletion protection status."
      },
      "tokens_used": 3630,
      "error": null
    }
  }
}