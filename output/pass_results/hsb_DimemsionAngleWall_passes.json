{
  "filename": "hsb_DimemsionAngleWall.mcr",
  "status": "completed",
  "total_tokens": 28360,
  "processing_time": 184.78884029388428,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "18.03.2009",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5989,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses _Viewport.append(getViewport()) on insert. Checks if (_Viewport.length()==0). Converts coordinates from Model Space to Paper Space using ms2ps transform. Draws Display objects in Paper Space."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "The script must be inserted into a Paper Space layout associated with a valid hsbCAD Element (Model).",
          "requiredSettings": []
        }
      },
      "tokens_used": 2726,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "DefaultPropertiesDialog",
            "trigger": "On Insert (_bOnInsert)",
            "title": null,
            "dataSource": "Script Properties (sDimStyle, nColor, dOffset)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension Style",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [
              "<Dynamic: Loaded Dimension Styles>"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "5",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Offset DimLine",
            "defaultValue": "U(100)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5465,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates and annotates the angle dimensions for angled top plates (walls) in Paper Space layouts, specifically visualizing the roof pitch relative to the horizontal floor joist direction.",
          "category": "ShopDrawing/Annotation",
          "typicalUseCase": "Used during the creation of 2D layout drawings to dimension and indicate the pitch of angled walls (e.g., gable ends or dormer cheeks) relative to the main floor orientation."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Determines the visual appearance of the angle text (font, precision, units, arrows) according to the CAD drafting standards.",
            "validRange": "Any loaded dimension style in the active drawing",
            "unit": "Style Name",
            "affectsOutput": "Changes the format, font size, and precision of the angle text displayed on the drawing."
          },
          {
            "name": "nColor",
            "technicalDefault": "5",
            "businessMeaning": "Determines the color index used for the dimension lines, leader lines, arc, and text.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Color Index",
            "affectsOutput": "Changes the screen and plot color of the generated annotation geometry."
          },
          {
            "name": "dOffset",
            "technicalDefault": "U(100)",
            "businessMeaning": "Sets the distance from the wall surface to the dimension arc and annotation text (clearance gap).",
            "validRange": "50mm to 500mm",
            "unit": "mm",
            "affectsOutput": "Moves the arc and angle text closer to or further from the angled wall beam."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Viewport Selection",
            "effect": "The script relies on the Viewport's coordinate system and associated Element to identify angled beams. Changing the Viewport updates the source geometry.",
            "cascade": [
              "sDimStyle",
              "nColor",
              "dOffset"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "AnnotationGeometry",
            "description": "Creates a set of lines (extension lines), a PLine (arc), and text representing the wall angle. Specifically, it draws a dimension arc from the wall surface X-axis to the Y-axis (horizontal) at a specified offset.",
            "appliedTo": "Angled Top Plate Beams (Left or Right type) found within the selected Viewport's Element."
          }
        ]
      },
      "tokens_used": 4118,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script inserted into Paper Space.",
          "2. Command line prompts: 'Select a viewport'.",
          "3. User selects a Viewport.",
          "4. Properties Dialog displays (Dimension Style, Color, Offset).",
          "5. User confirms settings.",
          "6. Script checks if Viewport has a valid hCAD Element.",
          "7. Script retrieves all beams from the Element.",
          "8. Script filters beams for 'Angled Top Plate' types (Left/Right).",
          "9. Script sorts Left beams to find the one with the minimum X value.",
          "10. Script sorts Right beams to find the one with the maximum X value.",
          "11. If Left Beam exists: Calculate angle, generate geometry (lines/arc/text), transform to Paper Space, draw.",
          "12. If Right Beam exists: Calculate angle, generate geometry (lines/arc/text), transform to Paper Space, draw.",
          "13. Script execution finishes."
        ],
        "conditionalBranches": [
          {
            "condition": "Is the selected Viewport associated with a valid hsbCAD Element?",
            "path1": {
              "name": "Valid Element",
              "steps": [
                "Retrieves Element coordinate system.",
                "Extracts beams for processing."
              ]
            },
            "path2": {
              "name": "Invalid Element",
              "steps": [
                "Script terminates (returns).",
                "No geometry is generated."
              ]
            }
          },
          {
            "condition": "Are there 'Angled Top Plate Left' beams present?",
            "path1": {
              "name": "Left Beams Found",
              "steps": [
                "Sorts array based on X coordinates (Bubble Sort).",
                "Identifies the beam with the minimum X value.",
                "Calculates dimension angle relative to Element Y-axis.",
                "Draws extension lines, arc, and text."
              ]
            },
            "path2": {
              "name": "No Left Beams",
              "steps": [
                "Skips Left beam logic entirely.",
                "Proceeds to check for Right beams."
              ]
            }
          },
          {
            "condition": "Are there 'Angled Top Plate Right' beams present?",
            "path1": {
              "name": "Right Beams Found",
              "steps": [
                "Sorts array based on X coordinates (Bubble Sort).",
                "Identifies the beam with the maximum X value.",
                "Calculates dimension angle relative to Element Y-axis.",
                "Draws extension lines, arc, and text."
              ]
            },
            "path2": {
              "name": "No Right Beams",
              "steps": [
                "Skips Right beam logic entirely.",
                "Script ends."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "Implicit failure (Script exits silently).",
            "recovery": "User must run the script again and select a viewport."
          },
          {
            "check": "Element Validity (vp.element().bIsValid())",
            "errorMessage": "None (Silent exit).",
            "recovery": "User must ensure the selected viewport views an hsbCAD generated model."
          },
          {
            "check": "Beam Existence (_kSFAngledTPLeft or _kSFAngledTPRight)",
            "errorMessage": "None (No output generated).",
            "recovery": "User must ensure the model contains angled top plate walls."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Dimension Style",
            "how": "OPM (Object Properties Manager)",
            "effect": "Updates the text formatting (units, precision, font) of the angle annotation."
          },
          {
            "action": "Modify Offset",
            "how": "OPM",
            "effect": "Recalculates the position of the dimension arc and text, moving it closer or further from the wall surface."
          },
          {
            "action": "Change Color",
            "how": "OPM",
            "effect": "Changes the ACI color of all generated geometry (lines, arc, text)."
          },
          {
            "action": "Recalculate Script",
            "how": "hsbCAD Update Command / Model Change",
            "effect": "Re-runs the beam search and sorting logic to update dimensions if the wall geometry changes."
          }
        ]
      },
      "tokens_used": 5336,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_DimemsionAngleWall.mcr\n\n## Overview\nAutomatically generates roof pitch angle dimensions for angled top plate walls directly in Paper Space. It annotates the angle between the wall surface and the horizontal floor joist direction.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for layout generation. |\n| Paper Space | Yes | Must be run on a layout containing a viewport of an hsbCAD model. |\n| Shop Drawing | N/A | Used in general layout drawings. |\n\n## Prerequisites\n- **Required Entities**: A viewport showing an hsbCAD Element (Model) containing Angled Top Plate beams.\n- **Minimum Beam Count**: At least one \"Angled Top Plate\" (Left or Right type) must exist in the model.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_DimemsionAngleWall.mcr` from the list.\n\n### Step 2: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the viewport frame in Paper Space that displays the wall you wish to dimension.\n```\n\n### Step 3: Configure Properties\n```\nAction: The Properties Palette will appear automatically.\nAction: Adjust the Dimension Style, Color, or Offset as needed.\nAction: Close the Properties Palette or click elsewhere in the drawing to generate the dimensions.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimension Style | Dropdown | _DimStyles | Selects the CAD dimension style to control text font, size, and arrowheads for the angle annotation. |\n| Color | Number | 5 | Sets the AutoCAD Color Index (ACI) for the dimension lines and text. Default is Blue (5). |\n| Offset DimLine | Number | 100 | Sets the distance (in mm) from the wall surface to the dimension arc. |\n| | | | |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are available for this script. Use the Properties Palette to make changes. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Viewport Validity**: Ensure the viewport you select is active and linked to a valid hsbCAD model. If the script runs but produces no output, check if the model actually contains \"Angled Top Plate\" beams.\n- **Finding Walls**: The script automatically identifies the furthest left and furthest right angled walls in the model to place the dimensions.\n- **Updating**: If you modify the wall pitch in the model, you can select the script entity and change a property (e.g., nudge the Offset) to force a refresh/recalculation of the angle.\n\n## FAQ\n- **Q: Why did nothing appear when I ran the script?**\n  **A:** The script only works on \"Angled Top Plate\" beams. If your walls are vertical or use a different subtype, the script will not find geometry to dimension. Also, ensure the selected viewport actually contains an Element.\n- **Q: How do I change the text size of the angle?**\n  **A:** You cannot change the text size directly in this script's properties. Instead, change the `Dimension Style` property to a style that uses your desired text height and font settings.\n- **Q: Can I move the dimension arc?**\n  **A:** Yes. Select the generated dimension object in Paper Space and modify the `Offset DimLine` value in the Properties Palette to move the arc closer or further from the wall."
      },
      "tokens_used": 4726,
      "error": null
    }
  }
}