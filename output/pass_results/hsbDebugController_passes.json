{
  "filename": "hsbDebugController.mcr",
  "status": "completed",
  "total_tokens": 41819,
  "processing_time": 391.24217438697815,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.2\",\n      \"date\": \"14jul2020\",\n"
      },
      "tokens_used": 7795,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Found explicit usage of `_kModelSpace` in `Group().collectEntities(true, TslInst(), _kModelSpace)` and `tslNew.dbCreate(..., _kModelSpace, ...)`. Script uses `getPoint()` for insertion location and interacts with TSL instances. No `sd_` prefix, `_Viewport` usage, or Sheet/Element entities found."
        },
        "prerequisites": {
          "requiredEntities": [
            "None (Optional: TslInst for selection)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "MapObject access for 'hsbTSLDev/hsbTSLDebugController'"
          ]
        }
      },
      "tokens_used": 5072,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select tsl(s)|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": false\n      },\n      {\n        \"step\": 2,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": null,\n        \"condition\":"
      },
      "tokens_used": 8642,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A development utility tool that enables TSL developers to dynamically set a 'Debug' flag for specific scripts across the entire project without editing source code.",
          "category": "Utility / Development Tool",
          "typicalUseCase": "Used by TSL scripters to trace execution and report messages for specific timber scripts (e.g., wall generators or rafters) during development or troubleshooting."
        },
        "parameters": [
          {
            "name": "Select tsl(s)",
            "technicalDefault": "null (User Input)",
            "businessMeaning": "Selection filter used during insertion to identify which script types should be added to the debug list by picking existing instances in the model.",
            "validRange": "Any valid TslInst present in the Model Space",
            "unit": "Entity",
            "affectsOutput": "Adds the script name of selected instances to the global debug MapObject; if 'Add/Remove ByEntity' is used later, it toggles this state."
          },
          {
            "name": "Script Name",
            "technicalDefault": "sTslScriptNames (All loaded TSLs)",
            "businessMeaning": "Dropdown selection of a specific TSL file name from the project catalog to target for debugging. Used when no entity is selected during insertion.",
            "validRange": "List of all loaded TSL script names in the catalog (excluding the debug controller itself)",
            "unit": "String",
            "affectsOutput": "Sets the script name in the global debug MapObject; causes all instances of this script to trigger debug reporting code."
          },
          {
            "name": "Show Relation",
            "technicalDefault": "false",
            "businessMeaning": "Visual toggle to draw 3D connection lines between this controller instance and all active TSL instances currently flagged for debugging.",
            "validRange": "true / false",
            "unit": "Boolean",
            "affectsOutput": "Controls the visibility of PLine entities connecting the controller to the target timber instances in the model view."
          },
          {
            "name": "Add/Remove ByIndex",
            "technicalDefault": "Command Line Input",
            "businessMeaning": "Context menu command to target a script for debugging by entering its numeric index from a reported list of all loaded scripts.",
            "validRange": "Integer corresponding to the reported list index",
            "unit": "Count",
            "affectsOutput": "Adds or removes the script name from the global debug MapObject based on the index provided."
          },
          {
            "name": "Erase All Instances of [ScriptName]",
            "technicalDefault": "Context Trigger",
            "businessMeaning": "Dynamically generated context command to batch-delete every instance of a specific script currently in the debug list.",
            "validRange": "N/A (Action Command)",
            "unit": "N/A",
            "affectsOutput": "Permanently deletes geometry (TslInst entities) from the Model Space."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Insertion (Select tsl(s) or Script Name)",
            "effect": "Updates the content of the 'hsbTSLDebugController' MapObject",
            "cascade": [
              "bDebug flag in target scripts",
              "Visual list display in controller",
              "Erase All Instances triggers"
            ]
          },
          {
            "trigger": "Show Relation Toggle",
            "effect": "Redraws the Display graph",
            "cascade": [
              "PLine visibility",
              "Text annotation"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text (Annotation)",
            "description": "Displays 'Debug Control' header and a list of active script names with instance counts.",
            "appliedTo": "Model Space (at insertion point _Pt0)"
          },
          {
            "type": "PLine (3D Line)",
            "description": "Visual lines connecting the controller to the origin point (ptOrg) of every TSL instance currently in the debug list.",
            "appliedTo": "Model Space (between Controller and Target TSLs)"
          },
          {
            "type": "MapObject",
            "description": "Persistent data storage under 'hsbTSLDev/hsbTSLDebugController' containing the list of active script names.",
            "appliedTo": "Project Database"
          }
        ]
      },
      "tokens_used": 6919,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Start: Initialize MapObject ('hsbTSLDebugController') to store persistent debug list.",
          "2. Catalog Scan: Retrieve all loaded TSL names, sort alphabetically, and exclude self.",
          "3. Insertion Phase (`_bOnInsert`):",
          "   3a. Check `insertCycleCount`; if > 1, erase instance and exit (safety check).",
          "   3b. Prompt: 'Select tsl(s)' (Entity Selection).",
          "4. Branch: Determine if entities were selected.",
          "   4a. [Path A - No Selection]: Show Properties Dialog with 'Script Name' dropdown.",
          "   4b. [Path B - Selection]: Extract script names from selected `TslInst` entities.",
          "5. Prompt: Get insertion point (`getPoint`).",
          "6. Update MapObject: Save the new/updated list of script names to project database.",
          "7. Branch: Check if Dialog was used (Path A).",
          "   7a. [Yes]: Create new instance (Clone) via `dbCreate` and erase current instance (to clean up dialog properties).",
          "   7b. [No]: Complete insertion normally.",
          "8. Display Phase:",
          "   8a. Collect all `TslInst` in ModelSpace and count matches against the debug list.",
          "   8b. Draw Text: 'Debug Control' header and list of active scripts with instance counts.",
          "   8c. If 'Show Relation' enabled, draw 3D Lines connecting controller to target instances."
        ],
        "conditionalBranches": [
          {
            "condition": "User provides input during 'Select tsl(s)' prompt",
            "path1": {
              "name": "Select by Entity",
              "steps": [
                "User selects one or more existing TSL instances in model.",
                "Script extracts `scriptName()` from each entity.",
                "Adds names to debug list if not present.",
                "Standard insertion completes (no re-instantiation)."
              ]
            },
            "path2": {
              "name": "Select by Catalog",
              "steps": [
                "User presses Enter (Null selection).",
                "Script displays Properties Dialog (OPM).",
                "User selects a script name from the dropdown list of all loaded TSLs.",
                "Script triggers `dbCreate` to spawn a clean copy of itself and erases the original (removing the dropdown property)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Internal logic)",
            "recovery": "Automatically erases the instance if `insertCycleCount() > 1` to prevent recursive insertion loops."
          },
          {
            "check": "Self-Exclusion",
            "errorMessage": "None",
            "recovery": "Script explicitly filters out its own filename from the debug list during catalog scan and entity selection."
          },
          {
            "check": "Index Range (AddRemoveByIndex)",
            "errorMessage": "None (Fail silent)",
            "recovery": "Checks if `nRet > 0 && nRet <= sTslScriptNames.length()` before attempting to add/remove the script; ignores invalid numbers."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Add/Remove Scripts by Entity",
            "how": "Context Menu -> 'Add/Remove ByEntity'",
            "effect": "Prompts user to pick entities; toggles their script names in the global debug list (adds if missing, removes if present)."
          },
          {
            "action": "Add/Remove Scripts by Index",
            "how": "Context Menu -> 'Add/Remove ByIndex'",
            "effect": "Reports a numbered list of all loaded scripts to the command line; user types index to toggle that script in the debug list."
          },
          {
            "action": "Toggle Visual Relations",
            "how": "Context Menu -> 'Show Relation'",
            "effect": "Toggles the `ShowRelation` boolean, switching 3D connection lines between the controller and debugged instances on or off."
          },
          {
            "action": "Batch Delete Target Instances",
            "how": "Context Menu -> 'Erase All Instances of [ScriptName]' (Dynamic)",
            "effect": "Permanently deletes every instance of the specific script listed in the debug menu from the Model Space."
          },
          {
            "action": "Reset and Erase Controller",
            "how": "Context Menu -> 'Reset + Erase' or Double Click",
            "effect": "Deletes the MapObject data entry (clearing the global debug list) and erases the controller instance."
          }
        ]
      },
      "tokens_used": 8258,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbDebugController\n\n## Overview\nThis is a development utility tool that allows users to dynamically activate \"Debug Mode\" for specific TSL scripts within the project. It creates a visual controller in the model that links to target scripts, enabling trace execution and message reporting without editing source code.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be inserted in Model Space to function. |\n| Paper Space | No | Not designed for Paper Space usage. |\n| Shop Drawing | No | Not designed for Shop Drawing layouts. |\n\n## Prerequisites\n- **Required Entities**: None required to run. However, existing TSL instances (timber scripts) are needed to be targeted for debugging.\n- **Minimum Beam Count**: 0\n- **Required Settings**: The script automatically creates/updates a project setting entry (`hsbTSLDebugController`) in the background to store the list of active scripts.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbDebugController.mcr` from the catalog.\n\n### Step 2: Select Target Scripts\n```\nCommand Line: Select tsl(s)\nAction: Do one of the following:\n1. Pick one or more existing TSL instances (scripts) in your drawing to add them to the debug list.\n2. Press Enter to open the Properties Palette and select a script name from the full project catalog.\n```\n\n### Step 3: Place Controller\n```\nCommand Line: Specify insertion point\nAction: Click in the Model Space to place the Debug Controller symbol.\n```\n*(Note: If you selected scripts via the Properties Palette, the script will automatically refresh itself at this point.)*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Script Name | Dropdown | *(empty)* | A list of all TSL scripts currently loaded in the catalog. Select the script you wish to debug. This is primarily used if you pressed Enter during the \"Select tsl(s)\" prompt. |\n| Show Relation | Boolean | False | When set to **True**, draws 3D lines connecting the controller to the origin of every instance currently being debugged. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add/Remove ByEntity | Prompts you to pick TSL instances in the model. If picked, they are added to the debug list; if picked again, they are removed. |\n| Add/Remove ByIndex | Displays a numbered list of all loaded scripts on the command line. Type the index number to toggle that script in the debug list. |\n| Show Relation | Toggles the visual 3D lines (connectors) between the controller and the active script instances on or off. |\n| Erase All Instances of [ScriptName] | (Dynamic Item) Deletes all instances of a specific script currently listed in the debug menu from the model. |\n| Reset + Erase | Clears the debug list from the project settings and deletes the controller instance. |\n\n## Settings Files\n- **Internal Storage**: `hsbTSLDev/hsbTSLDebugController`\n- **Location**: Project Data / MapObject\n- **Purpose**: Stores the list of script names currently active for debugging so the setting persists across CAD sessions.\n\n## Tips\n- **Visual Troubleshooting**: Enable **Show Relation** to quickly see where all instances of a specific script are located in your 3D model. The lines point from the controller to the origin of each debugged instance.\n- **Batch Cleanup**: Use the **Erase All Instances** right-click option to quickly delete all occurrences of a specific test script (e.g., temporary wall layouts) without selecting them manually.\n- **Double-Click**: Double-clicking the controller acts as a shortcut for the \"Reset + Erase\" function.\n\n## FAQ\n- **Q: Can I debug multiple scripts at once?**\n  A: Yes. You can either select multiple entities during insertion or use the \"Add/Remove\" context menu options repeatedly to build a list of active scripts.\n- **Q: How do I stop the debugging messages?**\n  A: Either use the \"Reset + Erase\" option on the controller to remove it entirely, or use \"Add/Remove\" options to remove specific scripts from the list while keeping the controller.\n- **Q: What happens if I move the controller?**\n  A: The controller is just a visual marker and data container. Moving it will move the text label and the anchor point for the visual relation lines, but it will not break the debug functionality."
      },
      "tokens_used": 5133,
      "error": null
    }
  }
}