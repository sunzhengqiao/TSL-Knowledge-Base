{
  "filename": "hsb_LayoutPlanSection.mcr",
  "status": "completed",
  "total_tokens": 42965,
  "processing_time": 524.033417224884,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "27.05.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "27.10.2010",
            "author": "",
            "changes": "Release Version"
          },
          {
            "version": "1.2",
            "date": "18.11.2010",
            "author": "",
            "changes": "Project all the points to the origin of the viewport or place holder"
          },
          {
            "version": "1.3",
            "date": "13.04.2011",
            "author": "",
            "changes": "Add some displays for the space stud"
          },
          {
            "version": "2.0",
            "date": "07.06.2012",
            "author": "",
            "changes": "Made properties for each beam type and its display and corrected Viewport shadowprofile plane"
          },
          {
            "version": "2.2",
            "date": "07.02.2013",
            "author": "",
            "changes": "Added _kBlocking to array"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5930,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "PropString sSpace offers options 'paper space' and 'shopdraw multipage'. Script uses _Viewport array and getViewport() for Paper Space logic. Script uses _Entity array and getShopDrawView() for Shopdrawing logic, specifically handling 'shopdraw multipage' string."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "ShopDrawView",
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Layout (Paper Space) or Shopdrawing Multipage context",
          "requiredSettings": []
        }
      },
      "tokens_used": 5624,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select the viewport from which the element is taken",
              "condition": "_bOnInsert && (sSpace == \"|paper space|\")",
              "required": true
            },
            {
              "step": 2,
              "function": "getShopDrawView",
              "promptOriginal": "|Select the view entity from which the module is taken|",
              "condition": "_bOnInsert && (sSpace == \"|shopdraw multipage|\")",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 1,
            "variable": "sSpace",
            "type": "PropString",
            "displayName": "|Drawing space|",
            "defaultValue": "|paper space|",
            "inputType": "dropdown",
            "options": [
              "|paper space|",
              "|shopdraw multipage|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sbmName00",
            "type": "PropString",
            "displayName": "Jack Over Opening",
            "defaultValue": "N",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sbmName01",
            "type": "PropString",
            "displayName": "Jack Under Opening",
            "defaultValue": "N",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sbmName02",
            "type": "PropString",
            "displayName": "Cripple Stud",
            "defaultValue": "X",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sbmName03",
            "type": "PropString",
            "displayName": "Transom",
            "defaultValue": "-",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sbmName04",
            "type": "PropString",
            "displayName": "King Stud",
            "defaultValue": "X",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "sbmName05",
            "type": "PropString",
            "displayName": "Sill",
            "defaultValue": "N",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "sbmName06",
            "type": "PropString",
            "displayName": "Angled TopPlate Left",
            "defaultValue": "S",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 10,
            "variable": "sbmName07",
            "type": "PropString",
            "displayName": "Angled TopPlate Right",
            "defaultValue": "S",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 11,
            "variable": "sbmName08",
            "type": "PropString",
            "displayName": "TopPlate",
            "defaultValue": "S",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 12,
            "variable": "sbmName09",
            "type": "PropString",
            "displayName": "Bottom Plate",
            "defaultValue": "S",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 13,
            "variable": "sbmName10",
            "type": "PropString",
            "displayName": "Blocking",
            "defaultValue": "N",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 15,
            "variable": "sbmName11",
            "type": "PropString",
            "displayName": "Supporting Beam",
            "defaultValue": "X",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 16,
            "variable": "sbmName12",
            "type": "PropString",
            "displayName": "Stud",
            "defaultValue": "X",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 17,
            "variable": "sbmName13",
            "type": "PropString",
            "displayName": "Stud Left",
            "defaultValue": "X",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 18,
            "variable": "sbmName14",
            "type": "PropString",
            "displayName": "Stud Right",
            "defaultValue": "X",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 19,
            "variable": "sbmName15",
            "type": "PropString",
            "displayName": "Header",
            "defaultValue": "N",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 20,
            "variable": "sbmName16",
            "type": "PropString",
            "displayName": "Brace",
            "defaultValue": "N",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 21,
            "variable": "sbmName17",
            "type": "PropString",
            "displayName": "Locating Plate",
            "defaultValue": "N",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 22,
            "variable": "sbmName18",
            "type": "PropString",
            "displayName": "Packer",
            "defaultValue": "N",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 23,
            "variable": "sbmName19",
            "type": "PropString",
            "displayName": "SolePlate",
            "defaultValue": "S",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 24,
            "variable": "sbmName20",
            "type": "PropString",
            "displayName": "HeadBinder/Very Top Plate",
            "defaultValue": "S",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 25,
            "variable": "sbmName21",
            "type": "PropString",
            "displayName": "Vent",
            "defaultValue": "S",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 26,
            "variable": "sbmName22",
            "type": "PropString",
            "displayName": "Angle Fillet",
            "defaultValue": "S",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 27,
            "variable": "sbmName23",
            "type": "PropString",
            "displayName": "Beam",
            "defaultValue": "N",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8181,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 8458,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script inserted via command palette or macro",
          "Check insertCycleCount > 1; if true, eraseInstance and exit (prevents multiple instances)",
          "Display properties dialog (showDialog)",
          "Evaluate 'sSpace' property",
          "[Conditional] If sSpace is 'paper space': Prompt user to select Viewport",
          "[Conditional] If sSpace is 'shopdraw multipage': Prompt user to select ShopDrawView Entity",
          "Store selected entity in appropriate array (_Viewport or _Entity)",
          "Pause execution (_bOnInsert block ends)",
          "Resume execution on recalculation/update",
          "[Conditional] Detect environment type based on arrays: if _Viewport present, set sSpace to 'paper space'; if _Entity present and is ShopDrawView, set sSpace to 'shopdraw multipage'",
          "Set sSpace property to Read-Only",
          "Initialize Element (el) and CoordSys (csVp)",
          "[Conditional] Paper Space Logic: Retrieve Viewport from array, validate hsb data (element must be valid), extract Element and CoordSys",
          "[Conditional] Shopdraw Multipage Logic: Retrieve ShopDrawView from array, retrieve ViewData from SubMap, find specific ViewData for viewport, extract Entities, CoordSys, and target Element",
          "Extract Beams from the Element (el.beam())",
          "Construct projection plane using Viewport/View origin and World Z",
          "Loop through each Beam in the element",
          "Find Beam Type index in predefined list",
          "Retrieve Cross display symbol (X, -, /, \\, O, S, N) from properties array",
          "Skip drawing if symbol is 'N' (Not visible) or beam type not found",
          "Calculate Beam geometry points (corners and center)",
          "Transform points and Body into Viewport Coordinate System",
          "Project lines and circles onto the shadow plane",
          "Calculate shadow profile of the beam body",
          "Draw Shadow Profile",
          "[Conditional] If symbol is 'X': Draw diagonal crosses (L1, L2)",
          "[Conditional] If symbol is '-': Draw horizontal centerline (L3)",
          "[Conditional] If symbol is '/': Draw single diagonal (L1)",
          "[Conditional] If symbol is '\\': Draw single diagonal (L2)",
          "[Conditional] If symbol is 'O': Draw circle at beam center"
        ],
        "conditionalBranches": [
          {
            "condition": "sSpace property selection during insert",
            "path1": {
              "name": "Paper Space Mode",
              "steps": [
                "User runs getViewport()",
                "Script stores Viewport in _Viewport array",
                "Recalculation uses _Viewport[0] to get Element and CoordSys"
              ]
            },
            "path2": {
              "name": "Shopdraw Multipage Mode",
              "steps": [
                "User runs getShopDrawView()",
                "Script stores ShopDrawView in _Entity array",
                "Recalculation queries ViewData map to find view data",
                "Extracts Element and CoordSys from ViewData"
              ]
            }
          },
          {
            "condition": "Display Symbol (Cross) for specific beam type",
            "path1": {
              "name": "Visible Beam (Symbol != 'N')",
              "steps": [
                "Calculate geometry",
                "Project and Draw Shadow",
                "Draw specific symbol overlay (X, -, /, \\, O)"
              ]
            },
            "path2": {
              "name": "Hidden Beam (Symbol == 'N')",
              "steps": [
                "Skip beam processing entirely in loop"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Silent)",
            "recovery": "Script self-erases if insertCycleCount > 1 to prevent duplicates."
          },
          {
            "check": "Viewport validity (Paper Space)",
            "errorMessage": "None (Silent Return)",
            "recovery": "User must select a Viewport that contains hsb element data."
          },
          {
            "check": "ViewData found (Shopdraw Space)",
            "errorMessage": "None (Silent Return)",
            "recovery": "User must ensure the selected view exists in the ViewData map (_kViewDataSets)."
          },
          {
            "check": "Entity extraction (Shopdraw Space)",
            "errorMessage": "None (Silent Return)",
            "recovery": "The ViewData show set must contain a valid Element."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Display Symbol per Beam Type",
            "how": "OPM Properties Palette (e.g., 'Jack Over Opening', 'Stud', 'TopPlate')",
            "effect": "Changes the cross-section mark or visibility for the specified beam type in the generated view. Options: 'X' (Cross), '-' (Line), '/' (Slash), '\\' (Backslash), 'O' (Circle), 'S' (Shadow only), 'N' (None)."
          },
          {
            "action": "Regenerate View",
            "how": "Script Recalculation (Update)",
            "effect": "Re-runs the projection logic based on current Element geometry and updated display properties."
          }
        ]
      },
      "tokens_used": 8068,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_LayoutPlanSection.mcr\n\n## Overview\nThis script generates a 2D schematic section or layout representation of a timber element directly within Paper Space or on a Shop Drawing page. It projects the geometry of beams onto a 2D plane and allows users to customize the display symbol (e.g., cross, circle, line) for specific beam types such as studs, plates, and headers.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for documentation output. |\n| Paper Space | Yes | Requires selection of a Viewport containing an hsbCAD element. |\n| Shop Drawing | Yes | Supports \"Multipage\" Shopdraws by selecting a View entity. |\n\n## Prerequisites\n- **Required Entities**: A viewport in a Layout tab displaying an hsbCAD element, OR a Shopdraw View entity in a multipage drawing.\n- **Minimum Beams**: None (works on empty elements, though nothing will be drawn).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_LayoutPlanSection.mcr` from the list.\n\n### Step 2: Select Drawing Space\nA dialog or command line prompt will appear to define the working environment:\n```\nCommand Line: |Drawing space|\nOptions: |paper space| or |shopdraw multipage|\nAction: Select the appropriate context where you want to generate the section.\n```\n\n### Step 3: Select Source View\nDepending on your selection in Step 2, follow the corresponding prompt:\n\n**If Paper Space:**\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click on the viewport frame in the Layout tab that displays the 3D element you wish to detail.\n```\n\n**If Shopdraw Multipage:**\n```\nCommand Line: |Select the view entity from which the module is taken|\nAction: Select the Shopdraw View entity associated with the desired module.\n```\n\n### Step 4: Configure Display (Post-Insertion)\nAfter insertion, select the generated script object and open the **Properties Palette**. Configure the display symbols for various beam types (e.g., Studs, Top Plates) to control how they appear in the 2D projection. \n\nTo refresh the drawing after changing properties, run a recalculation (e.g., `TSLUPDATE` or use the hsbCAD update function).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Drawing space** | dropdown | `|paper space|` | Sets the context: Paper Space (Viewport) or Shopdraw Multipage. |\n| **Jack Over Opening** | text | N | Display symbol: `X` (Cross), `-` (Line), `/` (Slash), `\\` (Backslash), `O` (Circle), `S` (Shadow/Outline), `N` (Hidden). |\n| **Jack Under Opening** | text | N | Display symbol for this beam type (see codes above). |\n| **Cripple Stud** | text | X | Display symbol for this beam type. |\n| **Transom** | text | - | Display symbol for this beam type. |\n| **King Stud** | text | X | Display symbol for this beam type. |\n| **Sill** | text | N | Display symbol for this beam type. |\n| **Angled TopPlate Left/Right** | text | S | Display symbol for angled top plates. |\n| **TopPlate** | text | S | Display symbol for top plates. |\n| **Bottom Plate** | text | S | Display symbol for bottom plates. |\n| **Blocking** | text | N | Display symbol for blocking. |\n| **Stud** | text | X | Display symbol for standard studs. |\n| **Stud Left/Right** | text | X | Display symbol for left/right specific studs. |\n| **Header** | text | N | Display symbol for headers. |\n| **Brace** | text | N | Display symbol for bracing. |\n| **Beam** | text | N | Display symbol for general beams. |\n\n*Note: There are additional properties for specific sub-components (Locating Plate, Packer, SolePlate, etc.) which follow the same symbol logic.*\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add specific custom items to the right-click context menu. |\n\n## Settings Files\n- None used.\n\n## Tips\n- **Symbol Codes**: Use `S` for \"Shadow Only\" to create clean structural outlines without internal hatching or crosses.\n- **Hiding Details**: Use `N` (None) to hide complex or irrelevant elements like blocking or braces to keep the drawing clean.\n- **Placement**: Ensure your script insertion point is roughly where you want the schematic to appear, though it links to the selected viewport's coordinates.\n- **Updates**: If you modify the 3D model, ensure the script updates to reflect changes in geometry.\n\n## FAQ\n- **Q: Why does my script disappear immediately after insertion?**\n  A: The script has a built-in check to prevent duplicate instances. If you insert it twice on the same viewport/view, the second instance will erase itself.\n  \n- **Q: Can I use this on a standard AutoCAD viewport without hsbCAD data?**\n  A: No. The selected viewport must contain a valid hsbCAD Element (generated by hsbCAD) for the script to extract geometry.\n\n- **Q: What is the difference between 'S' and 'N'?**\n  A: `S` draws the outline (shadow profile) of the beam. `N` draws nothing, effectively hiding that beam type completely."
      },
      "tokens_used": 6704,
      "error": null
    }
  }
}