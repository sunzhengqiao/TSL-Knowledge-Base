{
  "filename": "HSB_D-SipEdges.mcr",
  "status": "completed",
  "total_tokens": 34818,
  "processing_time": 209.49070596694946,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 2,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "20.10.2017",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "27.10.2017",
            "author": "AS",
            "changes": "Display edge corners and angles."
          },
          {
            "version": "1.02",
            "date": "14.11.2019",
            "author": "//Rvw",
            "changes": "Add option to round the corners and angles to whole integers."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6088,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script calls getViewport() on insert, stores in _Viewport[], and retrieves _Viewport[0] for processing. It transforms coordinates using vp.coordSys() (ModelSpace to PaperSpace) and uses the Display class for drawing text in 2D views."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementRoof",
            "Sip",
            "SipEdge"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be inserted into a 2D Viewport containing a Roof Element with valid SIP (Structural Insulated Panel) data.",
          "requiredSettings": []
        }
      },
      "tokens_used": 2812,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getViewport\",\n        \"promptOriginal\": \"|Select a viewport|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"showEdgeAnglesProp\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Show edge angles|\",\n      \"defaultValue\": 1,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No|\",\n        \"|Yes|\"\n      ],\n      \"category\": \"|Angles|\",\n      \"description\": \"|Specifies whether the angles should be visible or not.|\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"roundEdgeAngels\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Round off edge angles|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No|\",\n        \"|Yes|\"\n      ],\n      \"category\": \"|Angles|\",\n      \"description\": \"|Round off the edge angles to whole numbers|\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"switchDirectionProp\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Switch direction|\",\n      \"defaultValue\": 1,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No|\",\n        \"|Yes|\"\n      ],\n      \"category\": \"|Angles|\",\n      \"description\": \"|Specifies whether the angles should be clockwise or not.|\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"angleOffsetFromEdge\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Offset from edge|\",\n      \"defaultValue\": \"U(10)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Angles|\",\n      \"description\": \"|Sets the offset of the angles from the sip edges.|\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"angleColor\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Angle color|\",\n      \"defaultValue\": "
      },
      "tokens_used": 7178,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the annotation of Structural Insulated Panel (SIP) geometry by calculating and displaying edge bevel angles and corner angles within 2D PaperSpace viewports.",
          "category": "ShopDrawing/Annotation",
          "typicalUseCase": "Used during the creation of production drawings to automatically dimension the complex angles of SIP roof and wall panels, ensuring manufacturing crews know the exact cuts required without manual measurement."
        },
        "parameters": [
          {
            "name": "showEdgeAnglesProp",
            "technicalDefault": "1",
            "businessMeaning": "Controls the visibility of the bevel (slope) angles along the edges of the SIP panels.",
            "validRange": "0 (No), 1 (Yes)",
            "unit": "Boolean",
            "affectsOutput": "If set to No, no edge angle text will be drawn in the viewport."
          },
          {
            "name": "roundEdgeAngels",
            "technicalDefault": "0",
            "businessMeaning": "Determines if the calculated edge angles are rounded to whole integers or displayed with decimals.",
            "validRange": "0 (No/Decimals), 1 (Yes/Integers)",
            "unit": "Boolean",
            "affectsOutput": "Changes the precision of the text string displayed for edge angles (e.g., 26.57° vs 27°)."
          },
          {
            "name": "switchDirectionProp",
            "technicalDefault": "1",
            "businessMeaning": "Reverses the sign convention of the angle (Clockwise vs Counter-Clockwise) to match specific drafting standards or machinery requirements.",
            "validRange": "0 (No), 1 (Yes)",
            "unit": "Boolean",
            "affectsOutput": "Multiplies the calculated angle by -1, flipping positive angles to negative and vice versa."
          },
          {
            "name": "angleOffsetFromEdge",
            "technicalDefault": "U(10)",
            "businessMeaning": "Sets the distance from the physical edge of the panel to the center point of the angle text.",
            "validRange": "0mm - 100mm",
            "unit": "mm",
            "affectsOutput": "Moves the edge angle text closer to or further away from the panel geometry to prevent overlapping with other dimensions."
          },
          {
            "name": "angleColor",
            "technicalDefault": "1",
            "businessMeaning": "Defines the AutoCAD color index used for the edge angle text.",
            "validRange": "1 - 255 (AutoCAD Index)",
            "unit": "Color Index",
            "affectsOutput": "Changes the visual appearance of the edge dimension text on the drawing."
          },
          {
            "name": "showCornersProp",
            "technicalDefault": "1",
            "businessMeaning": "Controls the visibility of the angles at the intersections (corners) where two SIP edges meet.",
            "validRange": "0 (No), 1 (Yes)",
            "unit": "Boolean",
            "affectsOutput": "If set to No, corner angles (hip, valley, or eave intersections) will not be displayed."
          },
          {
            "name": "roundCornerAngles",
            "technicalDefault": "0",
            "businessMeaning": "Determines if the intersection angles are rounded to whole numbers.",
            "validRange": "0 (No/Decimals), 1 (Yes/Integers)",
            "unit": "Boolean",
            "affectsOutput": "Changes the precision of the text string displayed for corner angles."
          },
          {
            "name": "cornerOffsetFromEdge",
            "technicalDefault": "U(5)",
            "businessMeaning": "Sets the distance from the corner vertex to the center point of the corner angle text.",
            "validRange": "0mm - 100mm",
            "unit": "mm",
            "affectsOutput": "Moves the corner text away from the vertex to maintain drawing clarity."
          },
          {
            "name": "cornerColor",
            "technicalDefault": "1",
            "businessMeaning": "Defines the AutoCAD color index used for the corner angle text.",
            "validRange": "1 - 255 (AutoCAD Index)",
            "unit": "Color Index",
            "affectsOutput": "Changes the visual appearance of the corner dimension text."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "showEdgeAnglesProp is set to No",
            "effect": "Disables the utility of the other edge settings.",
            "cascade": [
              "roundEdgeAngels",
              "switchDirectionProp",
              "angleOffsetFromEdge",
              "angleColor"
            ]
          },
          {
            "trigger": "showCornersProp is set to No",
            "effect": "Disables the utility of the other corner settings.",
            "cascade": [
              "roundCornerAngles",
              "cornerOffsetFromEdge",
              "cornerColor"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Annotation",
            "description": "Text labels displaying the calculated degrees (°) for edge bevels and corner intersections.",
            "appliedTo": "PaperSpace Viewport overlaying ElementRoof/Sip entities."
          }
        ]
      },
      "tokens_used": 5885,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script inserted: check if on insert cycle > 1",
          "2. If cycle > 1: Erase instance and exit (ghost instance prevention)",
          "3. If cycle == 1: Show initial configuration dialog",
          "4. Prompt user: Select a viewport via command line",
          "5. Validate viewport selection",
          "6. Check if viewport has valid element data (ElementRoof)",
          "7. Retrieve SIP (Structural Insulated Panel) data from element",
          "8. Iterate through each SIP",
          "9. Iterate through each SipEdge of the SIP",
          "10. Calculate Edge Bevel Angles (if enabled): Transform to PaperSpace, calculate dot product, adjust for direction and rounding, place text at offset",
          "11. Calculate Corner Angles (if enabled): Calculate angle between current and previous edge vectors, adjust for convexity, place text at offset",
          "12. Generate Display entities for text in Viewport"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Check",
            "path1": {
              "name": "First Cycle",
              "steps": [
                "Show dialog",
                "Prompt for Viewport",
                "Store Viewport",
                "Calculate and Draw"
              ]
            },
            "path2": {
              "name": "Ghost/Cycle > 1",
              "steps": [
                "Erase Instance",
                "Exit Script"
              ]
            }
          },
          {
            "condition": "Viewport Data Validity",
            "path1": {
              "name": "Valid Element Roof",
              "steps": [
                "Get SIPs",
                "Process Geometry",
                "Draw Annotations"
              ]
            },
            "path2": {
              "name": "Invalid/No Element",
              "steps": [
                "Exit Script silently"
              ]
            }
          },
          {
            "condition": "Show Edge Angles Property",
            "path1": {
              "name": "Yes (1)",
              "steps": [
                "Calculate bevel angle",
                "Apply direction switch (optional)",
                "Apply rounding (optional)",
                "Draw text label"
              ]
            },
            "path2": {
              "name": "No (0)",
              "steps": [
                "Skip edge processing loop"
              ]
            }
          },
          {
            "condition": "Show Corners Property",
            "path1": {
              "name": "Yes (1)",
              "steps": [
                "Calculate angle between edges",
                "Determine convexity (convex/concave)",
                "Apply rounding (optional)",
                "Draw text label"
              ]
            },
            "path2": {
              "name": "No (0)",
              "steps": [
                "Skip corner processing loop"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport contains valid hsb Element",
            "errorMessage": "None (Script exits silently)",
            "recovery": "Select a viewport that contains a generated Roof element with Sip data."
          },
          {
            "check": "SIP Edges exist (length > 1)",
            "errorMessage": "None",
            "recovery": "Ensure the element has valid geometry with defined edges."
          },
          {
            "check": "Bevel angle magnitude > tolerance",
            "errorMessage": "None",
            "recovery": "Angles effectively 0 or 90 degrees are skipped automatically."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Toggle Visibility",
            "how": "OPM Property: Show edge angles / Show corners",
            "effect": "Shows or hides the respective text labels in the viewport."
          },
          {
            "action": "Adjust Precision",
            "how": "OPM Property: Round off edge angles / Round off corners angles",
            "effect": "Changes display from decimal (e.g., 26.57) to integer (e.g., 27)."
          },
          {
            "action": "Adjust Offset Position",
            "how": "OPM Property: Offset from edge / Offset from corner",
            "effect": "Moves the text label closer or further from the geometry."
          },
          {
            "action": "Change Color",
            "how": "OPM Property: Angle color / Corner color",
            "effect": "Updates the AutoCAD color of the dimension text."
          },
          {
            "action": "Flip Angle Direction",
            "how": "OPM Property: Switch direction",
            "effect": "Inverts the sign of the bevel angle (Clockwise/Counter-Clockwise)."
          }
        ]
      },
      "tokens_used": 6437,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_D-SipEdges.mcr\n\n## Overview\nThis script automates the annotation of Structural Insulated Panels (SIPs) by calculating and displaying bevel angles along panel edges and intersection angles at corners within 2D PaperSpace viewports.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is intended for 2D drawings only. |\n| Paper Space | Yes | The script must be inserted into a layout tab containing a viewport of the model. |\n| Shop Drawing | Yes | Used for creating production drawings showing precise cut angles. |\n\n## Prerequisites\n- **Required Entities:** An `ElementRoof` containing valid **SIP** (Structural Insulated Panel) data.\n- **Minimum Beam Count:** 0 (This script relies on Element/SIP geometry, not beams).\n- **Required Settings:** None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `HSB_D-SipEdges.mcr` from the script list.\n\n### Step 2: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the viewport in PaperSpace that displays the Roof Element you wish to annotate.\n```\nNote: The script will automatically detect if the viewport contains valid Roof/SIP data. If no data is found, the script will exit silently.\n\n### Step 3: Adjust Settings\nAction: Select the inserted script object in PaperSpace. Open the **Properties Palette** (Ctrl+1) to toggle visibility, change precision, or adjust text locations.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Show edge angles** | Dropdown | Yes | Toggles the visibility of the bevel angles along the SIP edges. |\n| **Show corners** | Dropdown | Yes | Toggles the visibility of the angles at the intersections (corners) of the SIP edges. |\n| **Round off edge angles** | Dropdown | No | If set to **Yes**, edge angles are rounded to whole integers (e.g., 27°). If **No**, decimals are shown (e.g., 26.57°). |\n| **Round off corners angles** | Dropdown | No | If set to **Yes**, corner angles are rounded to whole integers. |\n| **Switch direction** | Dropdown | Yes | Reverses the sign of the edge angle (Clockwise vs. Counter-Clockwise) to match specific machinery standards. |\n| **Offset from edge** | Number | 10 mm | Sets the distance from the physical edge of the panel to the center of the edge angle text. |\n| **Offset from corner** | Number | 5 mm | Sets the distance from the corner vertex to the center of the corner angle text. |\n| **Angle color** | Integer | 1 | Sets the AutoCAD color index for the edge angle text. |\n| **Corner color** | Integer | 1 | Sets the AutoCAD color index for the corner angle text. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Erase** | Removes the script and all associated annotations from the drawing. |\n| **Recalculate** | Refreshes the annotations based on the current geometry and property settings. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Cluttered Drawing?** If the angles overlap with other dimensions, increase the **Offset from edge** or **Offset from corner** values in the Properties palette.\n- **Visual Distinction:** Change the **Angle color** to a different color (e.g., Red or Magenta) so production crews can easily differentiate angle annotations from standard dimensions.\n- **Precision Control:** Use the **Round off...** options to simplify the drawing for manufacturing if decimal precision is not required.\n\n## FAQ\n- **Q: I inserted the script but nothing happened.**\n  - A: Ensure the selected viewport contains a generated Roof Element with valid SIP data. The script will not run on empty viewports or standard beams without SIP information.\n- **Q: How do I hide the corner angles but keep the edge angles?**\n  - A: Select the script object, open the Properties Palette, and change **Show corners** to \"No\".\n- **Q: The angle sign is wrong for my machinery (positive instead of negative).**\n  - A: Use the **Switch direction** property in the Properties Palette to invert the sign of the calculated angles."
      },
      "tokens_used": 6418,
      "error": null
    }
  }
}