{
  "filename": "hsb_WallSchedule.mcr",
  "status": "completed",
  "total_tokens": 48559,
  "processing_time": 197.69570302963257,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "29.09.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7662,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script prompts for an insertion point using getPoint (ModelSpace interaction) and uses PrEntity to select 'Elements'. It generates geometry (PLine, text) directly in the drawing using absolute coordinates (_Pt0, _XW, _YW). It lacks sd_ prefixes, Viewport handling, or Paper Space specific entities, indicating it is a standard ModelSpace scheduling/annotation script."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "ModelSpace (schedule is placed at user-selected coordinates)",
          "requiredSettings": [
            "hsb_WallPanelSchedule.dll (for processing element data)",
            "hsb_WriteExcelTable.dll (for Excel export functionality)"
          ]
        }
      },
      "tokens_used": 5502,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Pick insertion point for the table",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialogOnce",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "Default Properties Dialog",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": null,
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "prStrTitulo",
            "type": "PropString",
            "displayName": "|Title:| ",
            "defaultValue": "|Wall Schedule|",
            "inputType": "text",
            "options": null,
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "prStrType",
            "type": "PropString",
            "displayName": "|String Type Align|",
            "defaultValue": "|Left|",
            "inputType": "dropdown",
            "options": [
              "|Left|",
              "|Right|",
              "|Center|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "prDbleType",
            "type": "PropString",
            "displayName": "|Double Type Align|",
            "defaultValue": "|Left|",
            "inputType": "dropdown",
            "options": [
              "|Left|",
              "|Right|",
              "|Center|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "prIntType",
            "type": "PropString",
            "displayName": "|Int Type Align|",
            "defaultValue": "|Left|",
            "inputType": "dropdown",
            "options": [
              "|Left|",
              "|Right|",
              "|Center|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "prPlineType",
            "type": "PropString",
            "displayName": "|Pline Type Align|",
            "defaultValue": "|Left|",
            "inputType": "dropdown",
            "options": [
              "|Left|",
              "|Right|",
              "|Center|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dScalePl",
            "type": "PropDouble",
            "displayName": "|Scale Factor|",
            "defaultValue": 0,
            "inputType": "number",
            "options": null,
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColorGrid",
            "type": "PropInt",
            "displayName": "|Grid Color|",
            "defaultValue": 8,
            "inputType": "number",
            "options": null,
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColorText",
            "type": "PropInt",
            "displayName": "|Text Color|",
            "defaultValue": 254,
            "inputType": "number",
            "options": null,
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Export to Microsoft Excel",
            "handler": "strExportExcel",
            "action": "Exports schedule data to an Excel file via hsb_WriteExcelTable.dll",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7688,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a customizable 2D schedule table in ModelSpace listing properties of selected wall elements (dimensions, areas, shapes) and provides functionality to export this data to Excel.",
          "category": "Scheduling/Annotation",
          "typicalUseCase": "Creating a wall panel list or summary sheet for production or architectural approval, showing panel marks, dimensions, and graphical elevation views."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Determines the text style (font, height) used for all text inside the schedule table. Column widths are calculated dynamically based on this style.",
            "validRange": "Any existing Text/Dim Style name in the drawing",
            "unit": "String",
            "affectsOutput": "Text appearance and overall table dimensions (width/height)."
          },
          {
            "name": "prStrTitulo",
            "technicalDefault": "|Wall Schedule|",
            "businessMeaning": "The main title text displayed at the top of the generated table.",
            "validRange": "Any alphanumeric string",
            "unit": "String",
            "affectsOutput": "Changes the text label drawn in the header section of the table."
          },
          {
            "name": "prStrType",
            "technicalDefault": "|Left|",
            "businessMeaning": "Controls the horizontal alignment of text-based data (e.g., Marks, Names) within the table cells.",
            "validRange": "Left, Right, Center",
            "unit": "Enumeration",
            "affectsOutput": "Position of text content relative to the cell grid lines."
          },
          {
            "name": "prDbleType",
            "technicalDefault": "|Left|",
            "businessMeaning": "Controls the horizontal alignment of numerical data (e.g., Lengths, Areas) within the table cells.",
            "validRange": "Left, Right, Center",
            "unit": "Enumeration",
            "affectsOutput": "Position of numeric content relative to the cell grid lines."
          },
          {
            "name": "prIntType",
            "technicalDefault": "|Left|",
            "businessMeaning": "Controls the horizontal alignment of integer data (e.g., Quantities) within the table cells.",
            "validRange": "Left, Right, Center",
            "unit": "Enumeration",
            "affectsOutput": "Position of integer content relative to the cell grid lines."
          },
          {
            "name": "prPlineType",
            "technicalDefault": "|Left|",
            "businessMeaning": "Controls the horizontal alignment of graphical profiles (e.g., Wall elevation shapes) within the table cells.",
            "validRange": "Left, Right, Center",
            "unit": "Enumeration",
            "affectsOutput": "Position of the wall profile graphic relative to the cell grid lines."
          },
          {
            "name": "dScalePl",
            "technicalDefault": 0,
            "businessMeaning": "Sets a shrinkage/inset value for graphical profiles drawn in the table. It reduces the size of the wall outline to create a margin inside the cell.",
            "validRange": "0.0 to 20.0 (internal mm units)",
            "unit": "mm (internal units)",
            "affectsOutput": "Size of the wall profile graphics; larger values make the drawn shape smaller."
          },
          {
            "name": "nColorGrid",
            "technicalDefault": 8,
            "businessMeaning": "AutoCAD Color Index (ACI) used for the table grid lines and borders.",
            "validRange": "0 to 255 (Standard ACI colors)",
            "unit": "Index",
            "affectsOutput": "Color of the PLine entities forming the table grid."
          },
          {
            "name": "nColorText",
            "technicalDefault": 254,
            "businessMeaning": "AutoCAD Color Index (ACI) used for the text content within the schedule.",
            "validRange": "0 to 255 (Standard ACI colors)",
            "unit": "Index",
            "affectsOutput": "Color of the text entities drawn in the table."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sDimStyle is changed",
            "effect": "Recalculates column widths based on the text height of the new style.",
            "cascade": []
          },
          {
            "trigger": "dScalePl is greater than 0",
            "effect": "Only affects rows where the schedule contains graphical profile data (Polylines).",
            "cascade": []
          },
          {
            "trigger": "Alignment parameters (prStrType, etc.) are changed",
            "effect": "Only affects cells containing that specific data type.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "PLine",
            "description": "Grid lines, table borders, and graphical representations of wall profiles (elevations) within cells.",
            "appliedTo": "ModelSpace (at the selected insertion point)"
          },
          {
            "type": "Text",
            "description": "Table title, column headers, and data fields (dimensions, marks, areas) extracted from the selected Elements.",
            "appliedTo": "ModelSpace"
          }
        ]
      },
      "tokens_used": 9777,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched",
          "[Insert Phase] Check insertCycleCount: Erase instance if count > 1 (prevents duplicates)",
          "[Insert Phase] Show Properties Dialog (showDialogOnce) if _kExecuteKey is empty",
          "[Insert Phase] Prompt user for Table Insertion Point (_Pt0)",
          "[Insert Phase] Prompt user to select Wall Elements (PrEntity)",
          "[Processing Phase] Validate Elements: Erase instance if _Element.length() == 0",
          "[Processing Phase] Collect GenBeams from selected Elements into Entity array",
          "[Processing Phase] Compose ModelMap with Solid, Tool, and Construction info",
          "[Processing Phase] Call external DLL (hsb_WallPanelSchedule.dll) to process ModelMap into Schedule Data",
          "[Decision] Check if Data Map ('Table') exists and is not empty",
          "[Branch A - Data Found] Calculate dynamic column widths based on text content and DimStyle",
          "[Branch A - Data Found] Draw Table Grid (Outline, Horizontal lines, Vertical lines)",
          "[Branch A - Data Found] Draw Header Row and Column Titles",
          "[Branch A - Data Found] Loop through data rows to draw cell content (Text or PLine)",
          "[Branch B - No Data] Draw minimal box containing only the Title text",
          "[Finalization] Map instance OID, Location, and Type to _Map for external reference",
          "[Finalization] Add Context Menu trigger for 'Export to Microsoft Excel'"
        ],
        "conditionalBranches": [
          {
            "condition": "Schedule Data Availability (mapNiveles.length() != 0)",
            "path1": {
              "name": "Populated Schedule",
              "steps": [
                "Calculate row heights and column widths dynamically",
                "Draw full table grid structure",
                "Iterate through rows to determine cell content type",
                "Draw text or graphical profiles based on column data"
              ]
            },
            "path2": {
              "name": "Empty/Placeholder Schedule",
              "steps": [
                "Calculate width based on Title string",
                "Draw single rectangle outline",
                "Draw Title text centered in box"
              ]
            }
          },
          {
            "condition": "Cell Content Type (during row iteration)",
            "path1": {
              "name": "Textual Content",
              "steps": [
                "Identify alignment property (String/Double/Int type)",
                "Calculate text insertion point (Left/Center/Right)",
                "Draw text entity with specified color"
              ]
            },
            "path2": {
              "name": "Graphical Content (PLine)",
              "steps": [
                "Identify alignment property (Pline type)",
                "Apply shrinkage (dScalePl) to profile",
                "Calculate transformation coordinate system",
                "Draw PLine entity"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "None (Silent failure)",
            "recovery": "The script executes eraseInstance() if no elements are selected. The user must re-insert the script and select valid hsbCAD Elements."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Visual Updates",
            "how": "Modify OPM Properties (Title, DimStyle, Colors, Alignment, Scale Factor)",
            "effect": "Script recalculates and redraws the table immediately to reflect changes in text style, alignment, or graphical scale."
          },
          {
            "action": "Export Data",
            "how": "Right-click Context Menu -> 'Export to Microsoft Excel'",
            "effect": "Triggers callDotNetFunction2 to hsb_WriteExcelTable.dll, generating 'WallSchedule.xlsx' in the project folder containing the current schedule data."
          }
        ]
      },
      "tokens_used": 10992,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_WallSchedule.mcr\n\n## Overview\nGenerates a customizable 2D schedule table in ModelSpace that lists properties (dimensions, areas, shapes) of selected wall elements. It includes functionality to export the schedule data directly to Microsoft Excel.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The schedule is placed at a user-selected coordinate in Model Space. |\n| Paper Space | No | Not supported for Paper Space layout. |\n| Shop Drawing | No | This script does not generate Shop Drawing entities. |\n\n## Prerequisites\n- **Required Entities**: `Element` (Wall) or `GenBeam` entities must be present in the model.\n- **Minimum Beam Count**: 0 (Script handles empty selection by drawing a placeholder).\n- **Required Settings**:\n  - `hsb_WallPanelSchedule.dll` (Required for processing element data).\n  - `hsb_WriteExcelTable.dll` (Required for Excel export functionality).\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Select `hsb_WallSchedule.mcr` from the file dialog.\n\n### Step 2: Configure Properties\n1.  Upon insertion, the Properties Palette (OPM) will display, allowing you to configure the schedule appearance (Title, Dimension Style, Colors, etc.).\n2.  You may adjust these now or modify them later after insertion.\n\n### Step 3: Define Insertion Point\n```\nCommand Line: Pick insertion point for the table\nAction: Click in the Model Space to set the top-left corner of the schedule.\n```\n\n### Step 4: Select Wall Elements\n```\nCommand Line: Select Elements\nAction: Select the Wall Elements or GenBeams you wish to include in the schedule and press Enter.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| |Dimstyle| | dropdown | _DimStyles | Determines the text style (font, height) used for the schedule table. Column widths are calculated based on this style. |\n| |Title:| | text | \\|Wall Schedule\\| | The main title text displayed at the top of the table. |\n| |String Type Align| | dropdown | \\|Left\\| | Horizontal alignment for text-based data (e.g., Marks). Options: Left, Right, Center. |\n| |Double Type Align| | dropdown | \\|Left\\| | Horizontal alignment for numerical data (e.g., Lengths). Options: Left, Right, Center. |\n| |Int Type Align| | dropdown | \\|Left\\| | Horizontal alignment for integer data (e.g., Quantities). Options: Left, Right, Center. |\n| |Pline Type Align| | dropdown | \\|Left\\| | Horizontal alignment for graphical profiles (wall shapes). Options: Left, Right, Center. |\n| |Scale Factor| | number | 0 | Shrinkage/inset value for graphical profiles (mm). Use this to reduce the size of wall outlines so they don't touch cell borders. |\n| |Grid Color| | number | 8 | AutoCAD Color Index (ACI) for the table grid lines. |\n| |Text Color| | number | 254 | AutoCAD Color Index (ACI) for the text inside the table. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Export to Microsoft Excel | Exports the current schedule data to an Excel file named `WallSchedule.xlsx` in the project folder. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not use external XML settings files; it relies on DLL dependencies (`hsb_WallPanelSchedule.dll` and `hsb_WriteExcelTable.dll`) for functionality.\n\n## Tips\n- **Adjusting Text Size**: To change the text size of the schedule, change the `|Dimstyle|` property to a style with a different text height. The table will automatically resize.\n- **Fitting Wall Shapes**: If the graphical elevation of the wall touches the grid lines, increase the `|Scale Factor|` value to shrink the graphic inside the cell.\n- **Visual Updates**: You can modify any property in the Properties Palette after insertion, and the table will automatically redraw to reflect the changes.\n\n## FAQ\n- **Q: What happens if I select no elements?**\n  **A:** The script will draw a simple placeholder box containing only the Title. You must delete this instance and re-run the script if you need to populate the table, or check if valid elements were selected.\n- **Q: Why did the script disappear after I selected elements?**\n  **A:** This typically occurs if the script detects a duplicate instance cycle or if the processing logic found no valid data. Ensure you are selecting valid hsbCAD Elements.\n- **Q: Where is the Excel file saved?**\n  **A:** It is saved in the current project folder with the filename `WallSchedule.xlsx`."
      },
      "tokens_used": 6938,
      "error": null
    }
  }
}