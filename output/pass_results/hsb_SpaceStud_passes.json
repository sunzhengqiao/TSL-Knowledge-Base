{
  "filename": "hsb_SpaceStud.mcr",
  "status": "completed",
  "total_tokens": 54409,
  "processing_time": 583.1911809444427,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9203,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script interacts with ElementWallSF and GenBeam entities directly in the model. It uses _bOnInsert, dbCreate with _kModel, and references other TSL scripts (hsb_SpaceStudAssembly) for sub-assemblies. No sd_*, Viewport, or ShopDrawing specific entities/patterns were found."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space with Wall elements",
          "requiredSettings": [
            "hsb_SpaceStudAssembly.tsl",
            "Catalog entries for Space Studs (sizes 80mm, 55mm etc.)",
            "Nail plate definitions"
          ]
        }
      },
      "tokens_used": 5593,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "psExtType",
            "type": "PropString",
            "displayName": "Code SpaceStud Wall",
            "defaultValue": "M;",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sMes",
            "type": "PropString",
            "displayName": "Beams NOT to plate",
            "defaultValue": "----------",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sJacks",
            "type": "PropString",
            "displayName": "Jacks Above/Below Opening",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 3,
            "variable": "sBlocking",
            "type": "PropString",
            "displayName": "Blocking",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 13,
            "variable": "sPlateTopPlate",
            "type": "PropString",
            "displayName": "Top Plate",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 14,
            "variable": "sPlateBottomPlate",
            "type": "PropString",
            "displayName": "Bottom Plate",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 15,
            "variable": "sPlateTransom",
            "type": "PropString",
            "displayName": "Transom",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 4,
            "variable": "sMes2",
            "type": "PropString",
            "displayName": "Beams to Ignore",
            "defaultValue": "----------",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 16,
            "variable": "sAllOpBeams",
            "type": "PropString",
            "displayName": "Ignore all opening beams",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "This will ignore cripples, king studs, sill, transom, jacks"
          },
          {
            "index": 5,
            "variable": "sTopPlate",
            "type": "PropString",
            "displayName": "Top Plate ",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 6,
            "variable": "sBottomPlate",
            "type": "PropString",
            "displayName": "Bottom Plate ",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 7,
            "variable": "sCripple",
            "type": "PropString",
            "displayName": "First Cripple",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 17,
            "variable": "sAllCripples",
            "type": "PropString",
            "displayName": "All Cripples",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 18,
            "variable": "sKingStud",
            "type": "PropString",
            "displayName": "King Studs",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 19,
            "variable": "sIgnoreJacks",
            "type": "PropString",
            "displayName": "Jacks Above/Below Opening ",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 8,
            "variable": "sStuds",
            "type": "PropString",
            "displayName": "Left/Right Studs",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 9,
            "variable": "sOpBeams",
            "type": "PropString",
            "displayName": "Sill/Transom",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 20,
            "variable": "sPacker",
            "type": "PropString",
            "displayName": "Packer",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 11,
            "variable": "sClip",
            "type": "PropString",
            "displayName": "Apply only one clip",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          },
          {
            "index": 10,
            "variable": "sbmCode",
            "type": "PropString",
            "displayName": "Exclude Beams with Code",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Please fill the codes that you dont need to be convert, use ';' if you want to filter more that 1 code"
          },
          {
            "index": 0,
            "variable": "dMinLength",
            "type": "PropDouble",
            "displayName": "Minimum length for space stud",
            "defaultValue": "600",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "If 0 is set then it wont use this filter"
          },
          {
            "index": 12,
            "variable": "sOnlyClip",
            "type": "PropString",
            "displayName": "Only clip beams smaller than minimum length",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": ""
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9538,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 11360,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Insertion\",\n    \"2. Check Insert Cycle: If count > 1, erase instance and exit (prevents loops)\",\n    \"3. Display Dialog (if no Execute Key)\",\n    \"4. Prompt User: Select Wall Elements (PrEntity)\",\n    \"5. Parse Properties: Wall Codes (psExtType), Beam Codes (sbmCode), Minimum Length (dMinLength), and Type Flags\",\n    \"6. Validate Selection: If no elements selected, erase instance and exit\",\n    \"7. Filter Walls: Iterate selected elements, keep only ElementWallSF matching Wall Codes\",\n    \"8. Iterate Filtered Walls and Beams\",\n    \"9. Filter Beam Code: Skip if beam code is in Exclude list (sbmCode)\",\n    \"10. Filter Beam Type: Check against Type Flags (Top Plate, Jacks, Cripple, etc.) to determine if beam should be processed or avoided\",\n    \"11. Filter Beam Length: Compare beam length against dMinLength based on bOnlyClip logic\",\n    \"12. Calculate Geometry: Determine split position and dimensions based on beam size and dBlockLength\",\n    \"13. Split Beam: Create two new beams (bmNewFront, bmNewBack) with half widths\",\n    \"14. [Conditional] Create Connecting Hardware:\",\n    \"   - Branch A (Large Studs): Create 4 Nail Plates (corners)\",\n    \"   - Branch B (Small/Studs): Create 2 Clips (sides)\",\n    \"15. Generate Assembly: Create hsb_SpaceStudInstance wrapping the new beams and hardware\",\n    \"16. Erase Original Beam\",\n    \"17. Erase Script Instance (Cleanup)\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Minimum Length and 'Only Clip' Logic\",\n      \"path1\": {\n        \"name\": \"Process Normal Beams\",\n        \"steps\": [\n          \"Triggered if bOnlyClip='No' AND Length >= dMinLength\",\n          \"Proceeds to split beam and apply standard plating/clipping logic\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Process Small Beams (Clip Only)\",\n        \"steps\": [\n          \"Triggered if bOnlyClip='Yes' AND Length < dMinLength\",\n          \"Proceeds to split beam and apply standard plating/clipping logic\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Beam Type Filters\",\n      \"path1\": {\n        \"name\": \"Avoid Beam\",\n        \"steps\": [\n          \"Triggered if beam type matches 'Avoid' properties (e.g., sTopPlate='Yes')\",\n          \"Beam is skipped and remains unchanged\"\n        ]\n      },\n      \"path2\": {\n        \""
      },
      "tokens_used": 11332,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SpaceStud.mcr\n\n## Overview\nThis script converts standard timber studs within selected walls into \"Space Studs\" by splitting them longitudinally and applying nail plates or metal clips. It allows for detailed filtering based on beam types, codes, and lengths to automate the creation of insulation spacing in timber frame walls.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for processing ElementWallSF and GenBeam entities. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities:** ElementWallSF (Wall entities).\n- **Minimum Beam Count:** 0 (Processes existing beams within selected walls).\n- **Required Settings Files:**\n  - `hsb_SpaceStudAssembly.tsl` (Sub-script for generating the assembly).\n  - Catalog entries for Space Stud sizes (e.g., 80mm, 55mm).\n  - Nail plate definitions loaded in the catalog.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_SpaceStud.mcr`\n\n### Step 2: Configure Properties (Optional)\nBefore insertion, you may adjust the parameters in the **Properties Palette** to define which beams should be processed (e.g., set Wall Codes, Minimum Length, or Toggle specific beam types).\n\n### Step 3: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the Wall elements (ElementWallSF) you wish to process and press Enter.\n```\n*Note: The script will filter the selected entities to find valid walls matching the \"Code SpaceStud Wall\" property.*\n\n### Step 4: Automatic Processing\nOnce selected, the script automatically:\n1. Iterates through beams in the selected walls.\n2. Filters beams based on your configuration (Code, Type, Length).\n3. Splits valid studs into two separate beams.\n4. Inserts Nail Plates (for standard studs) or Clips (for short studs).\n5. Groups the components into an `hsb_SpaceStudInstance`.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Code SpaceStud Wall** | Text | `M;` | The code assigned to the wall elements that should be processed. Only walls with this code (in their name or properties) will be affected. |\n| **Beams NOT to plate** | Text | `----------` | A string identifier for beams that should not receive plating (Legacy/Internal filter). |\n| **Jacks Above/Below Opening** | Dropdown | `No` | Determines if Jack studs are processed or ignored. |\n| **Blocking** | Dropdown | `No` | Determines if Blocking members are processed or ignored. |\n| **Top Plate** | Dropdown | `No` | Determines if the Top Plate is processed or ignored. |\n| **Bottom Plate** | Dropdown | `No` | Determines if the Bottom Plate is processed or ignored. |\n| **Transom** | Dropdown | `No` | Determines if Transom beams are processed or ignored. |\n| **Beams to Ignore** | Text | `----------` | A string identifier for beams to be skipped completely. |\n| **Ignore all opening beams** | Dropdown | `No` | If `Yes`, ignores cripples, king studs, sills, transoms, and jacks. |\n| **First Cripple** | Dropdown | `No` | Determines if the first cripple stud is processed. |\n| **All Cripples** | Dropdown | `No` | Determines if all cripple studs are processed. |\n| **King Studs** | Dropdown | `No` | Determines if King Studs are processed. |\n| **Jacks Above/Below Opening** | Dropdown | `No` | Duplicate parameter for Jacks control. |\n| **Left/Right Studs** | Dropdown | `No` | Determines if standard Left/Right studs are processed. |\n| **Sill/Transom** | Dropdown | `No` | Determines if Sill/Transom beams are processed. |\n| **Packer** | Dropdown | `No` | Determines if Packer beams are processed. |\n| **Apply only one clip** | Dropdown | `No` | If `Yes`, applies a single clip instead of standard configuration. |\n| **Exclude Beams with Code** | Text | | List of beam codes to exclude (separate multiple codes with `;`). |\n| **Minimum length for space stud** | Number | `600` | Beams shorter than this length (in mm) may be treated differently (e.g., clipped instead of plated). Set to 0 to disable. |\n| **Only clip beams smaller than minimum length** | Dropdown | `No` | If `Yes`, beams smaller than the minimum length will be clipped; larger beams will follow standard plating logic. |\n\n## Right-Click Menu Options\nNo specific right-click context menu options are defined for this script instance.\n\n## Settings Files\n- **Filename**: `hsb_SpaceStudAssembly.tsl`\n- **Location**: hsbCAD application path (TSL folder).\n- **Purpose**: This sub-script is called to generate the actual geometry and assembly of the split studs and connecting hardware.\n\n## Tips\n- **Wall Codes**: Ensure the walls you select have the \"Code SpaceStud Wall\" (default `M;`) correctly assigned in their properties, or update the script property to match your project's wall naming convention.\n- **Length Filtering**: Use the \"Minimum length\" and \"Only clip beams...\" settings to handle short cripple studs differently from full-height studs, ensuring optimal fabrication details.\n- **Beam Exclusion**: Use the \"Exclude Beams with Code\" property to prevent specific structural beams (like posts or beams with specific codes) from being split.\n\n## FAQ\n- **Q: Why didn't the script process my studs?**\n- **A:** Check that the selected Wall entity matches the \"Code SpaceStud Wall\" property. Also, verify that the studs are not excluded by the \"Exclude Beams with Code\" or specific type filters (e.g., if \"Left/Right Studs\" is set to \"No\").\n- **Q: What happens to the original studs?**\n- **A:** The original studs are deleted and replaced by the new \"Space Stud\" assembly containing the split beams and plates.\n- **Q: Can I use this on existing walls?**\n- **A:** Yes, simply select the existing `ElementWallSF` entities when prompted by the script."
      },
      "tokens_used": 7383,
      "error": null
    }
  }
}