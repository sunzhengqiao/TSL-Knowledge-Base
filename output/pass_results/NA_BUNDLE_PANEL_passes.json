{
  "filename": "NA_BUNDLE_PANEL.mcr",
  "status": "completed",
  "total_tokens": 47596,
  "processing_time": 159.38898849487305,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7394,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates in ModelSpace using `_bOnInsert`, `getPoint`, and `PrEntity` prompts to select Wall/Element entities. It collects entities using `_kModelSpace` and creates TslInst clones. It lacks ShopDrawing signatures (sd_, #Type E, _Entity[]), PaperSpace checks (_Viewport), or Multipage prefixes."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Wall or Roof Elements.",
          "requiredSettings": []
        }
      },
      "tokens_used": 6094,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of Wall elements",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select a reference point to display Wall",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strDimStyle",
            "type": "PropString",
            "displayName": "DimStyle",
            "defaultValue": "_DimStyles",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "strStack",
            "type": "PropString",
            "displayName": "Location(Bundle,Row,Position)",
            "defaultValue": "X-999-999-999",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strShowHeight",
            "type": "PropString",
            "displayName": "Show Panel Sizes",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "strLink",
            "type": "PropString",
            "displayName": "Link to real panel",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "strFlip",
            "type": "PropString",
            "displayName": "Flip me",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dAddLeft",
            "type": "PropDouble",
            "displayName": "Additional Gap Left",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dAddRight",
            "type": "PropDouble",
            "displayName": "Additional Gap Right",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "pColor",
            "type": "PropInt",
            "displayName": "Forced Color",
            "defaultValue": -1,
            "inputType": "dropdown",
            "options": [
              -1,
              32
            ],
            "category": "Color Management",
            "description": null
          },
          {
            "index": 1,
            "variable": "piAssignedColor",
            "type": "PropInt",
            "displayName": "Color Group",
            "defaultValue": -1,
            "inputType": "text",
            "options": [],
            "category": "Color Management",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Reset colors in this file|",
            "handler": "stResetColors",
            "action": "Erases the 'moWallHeights' and 'moFloorLengths' MapObjects from the database.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8813,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 2D production representation of wall panels within a stacking layout (bundle/truck), calculating gaps and writing logistics data to the elements.",
          "category": "Production/Logistics",
          "typicalUseCase": "Used when creating a shipping or production bundle drawing to visualize how panels fit onto a truck or in a storage stack, and to tag elements with their specific location coordinates."
        },
        "parameters": [
          {
            "name": "strDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Specifies the dimension style (text style) used to display the panel size and label text.",
            "validRange": "Any existing Text Style in the drawing",
            "unit": "Style Name",
            "affectsOutput": "Font, height, and appearance of the panel label and dimension text in the 2D view."
          },
          {
            "name": "strStack",
            "technicalDefault": "X-999-999-999",
            "businessMeaning": "The unique logistics identifier for the panel's location, defining the Bundle, Row, and Position (e.g., TRK1-Bundle-Row-Pos).",
            "validRange": "Alphanumeric string (Format: Prefix-Stack-Row-Place)",
            "unit": "String",
            "affectsOutput": "Updates the element's information field and is used for downstream production filtering/sorting. Read-Only (populated by parent script)."
          },
          {
            "name": "strShowHeight",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the visibility of the panel's dimensions (Length x Height) next to the element number.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If 'Yes', adds dimension text (e.g., '2430 x 2800') to the panel label in the drawing."
          },
          {
            "name": "strLink",
            "technicalDefault": "No",
            "businessMeaning": "Toggles a visual leader line connecting the 2D stack representation to the actual 3D model location of the panel.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "Draws a line from the 2D geometry to the 3D element origin if 'Yes'."
          },
          {
            "name": "strFlip",
            "technicalDefault": "No",
            "businessMeaning": "Indicates if the panel is rotated 180 degrees (face-down or reversed orientation) within the stack.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "Swaps displayed dimensions (Height x Length), draws specific 'flip' indicators, and sets the 'RotateInBundle' flag in production data."
          },
          {
            "name": "dAddLeft",
            "technicalDefault": "0.0",
            "businessMeaning": "Additional spacing or gap required on the left side of the panel in the bundle (e.g., for lifting straps, protective corners, or overlap).",
            "validRange": "0 to ~500 (mm)",
            "unit": "Length",
            "affectsOutput": "Visually extends the 2D rectangle on the left and adds to the 'ShiftPanelInLevel' metadata."
          },
          {
            "name": "dAddRight",
            "technicalDefault": "0.0",
            "businessMeaning": "Additional spacing or gap required on the right side of the panel in the bundle.",
            "validRange": "0 to ~500 (mm)",
            "unit": "Length",
            "affectsOutput": "Visually extends the 2D rectangle on the right."
          },
          {
            "name": "pColor",
            "technicalDefault": "-1",
            "businessMeaning": "Forces the display color of the panel representation, often used to color-code by truck or priority.",
            "validRange": "AutoCAD Color Index (1-255) or -1 (ByLayer)",
            "unit": "Index",
            "affectsOutput": "Changes the color of the panel geometry in the CAD model."
          },
          {
            "name": "piAssignedColor",
            "technicalDefault": "-1",
            "businessMeaning": "A read-only grouping tag assigned by a parent script to categorize panels (e.g., all panels on Truck 1).",
            "validRange": "Integer",
            "unit": "Count/Index",
            "affectsOutput": "Metadata only; used for data extraction or filtering."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "mpStackLocation Map (Input from Parent Script)",
            "effect": "Populates the Location String (strStack), Reference Point, and Parent Entity. Sets initial flip state.",
            "cascade": [
              "strStack",
              "ptParentRef",
              "entParent"
            ]
          },
          {
            "trigger": "strFlip = Yes",
            "effect": "Swaps the order of dimensions in the text label (Height x Length) and modifies the coordinate system written to production metadata.",
            "cascade": [
              "ElementBundleData (RotateInBundle)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "PLine (2D Geometry)",
            "description": "A 2D rectangle representing the panel's top-down view in the stack, including any added gaps (dAddLeft/dAddRight) and opening indicators.",
            "appliedTo": "Model Space (representing the bundle location)"
          },
          {
            "type": "Text",
            "description": "Label containing the Element Number and optionally Dimensions (LxH).",
            "appliedTo": "Model Space (centered on the panel representation)"
          },
          {
            "type": "Map Data (ElementBundleData)",
            "description": "Logistics data attached to the wall element containing Bundle Name, Level, Position, Shift, and Rotation info for production/MES systems.",
            "appliedTo": "Selected Wall Element (subMapX)"
          }
        ]
      },
      "tokens_used": 10249,
      "error": null
    },
    "5": {
      "success": true,
      "data": {},
      "tokens_used": 9740,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# NA_BUNDLE_PANEL.mcr\n\n## Overview\nGenerates a 2D production representation of wall panels within a stacking layout (such as a truck load or storage bundle). It visualizes panel placement, calculates necessary gaps for logistics, and tags elements with specific location data for production management.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script creates 2D geometry in Model Space to represent the bundle layout. |\n| Paper Space | No | Not supported for Paper Space usage. |\n| Shop Drawing | No | This is a production/logistics script, not a detailing script. |\n\n## Prerequisites\n- **Required Entities**: Wall or Roof Elements must exist in the drawing.\n- **Minimum Beam Count**: 1 (At least one element must be selected).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `NA_BUNDLE_PANEL.mcr` from the list.\n\n### Step 2: Select Wall Elements\n```\nCommand Line: Select a set of Wall elements\nAction: Click on the Wall or Roof elements in the model that you want to include in the bundle representation. Press Enter to confirm selection.\n```\n\n### Step 3: Set Reference Point\n```\nCommand Line: Select a reference point to display Wall\nAction: Click in the Model Space to define where the 2D bundle representation of the selected panels should be drawn.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| DimStyle | Text | _DimStyles | Specifies the text style used for the panel labels and dimensions (e.g., \"_DimStyles\"). |\n| Location(Bundle,Row,Position) | Text | X-999-999-999 | The logistics identifier defining the specific Bundle, Row, and Position for this panel (e.g., TRK1-1-2). |\n| Show Panel Sizes | Dropdown | Yes | If \"Yes\", displays the panel dimensions (Length x Height) next to the element number. |\n| Link to real panel | Dropdown | No | If \"Yes\", draws a leader line connecting the 2D bundle representation to the actual 3D location of the panel in the model. |\n| Flip me | Dropdown | No | If \"Yes\", indicates the panel is rotated 180 degrees (face down) in the stack. This swaps dimension display order (Height x Length) and updates rotation data. |\n| Additional Gap Left | Number | 0.0 | Adds extra spacing (in current units) to the left side of the panel in the bundle, typically used for lifting straps or protection. |\n| Additional Gap Right | Number | 0.0 | Adds extra spacing (in current units) to the right side of the panel in the bundle. |\n| Forced Color | Dropdown | -1 | Overrides the color of the panel representation. -1 uses the layer color; other numbers force a specific AutoCAD color index. |\n| Color Group | Number | -1 | A read-only tag used to group panels (e.g., by Truck ID) for data extraction or filtering. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Reset colors in this file | Clears all cached color mappings related to wall heights and floor lengths from the current project database. |\n\n## Settings Files\nNone. This script does not rely on external XML settings files.\n\n## Tips\n- **Visualizing Orientation**: Use the **Flip me** property to indicate if a panel is stacked face-down. The script will visually indicate this flip and update production data accordingly.\n- **Logistics Tagging**: The **Location** string is critical for production lists. Ensure this matches your shipping documentation or truck loading plan.\n- **Verification**: Set **Link to real panel** to \"Yes\" initially to verify that your 2D bundle layout correctly corresponds to the 3D model locations.\n\n## FAQ\n- **Q: Can I use this script to generate production drawings for individual walls?**\n  - A: No, this script is specifically designed for creating bundle/truck loading layouts, not individual wall shop drawings.\n- **Q: Why are my dimensions showing as Height x Length instead of Length x Height?**\n  - A: Check the **Flip me** property. If it is set to \"Yes\", the script assumes the panel is rotated and swaps the dimension order to reflect the viewed face."
      },
      "tokens_used": 5306,
      "error": null
    }
  }
}