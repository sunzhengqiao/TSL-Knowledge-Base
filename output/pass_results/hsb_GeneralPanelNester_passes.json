{
  "filename": "hsb_GeneralPanelNester.mcr",
  "status": "completed",
  "total_tokens": 58139,
  "processing_time": 796.9265866279602,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "18.10.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Prototype"
          },
          {
            "version": "1.1",
            "date": "10.02.2012",
            "author": "",
            "changes": "Release"
          },
          {
            "version": "1.2",
            "date": "22.10.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Add the option to nest PLines and some improvements to the nester results Needs a MVBlock call ToleranceCheck"
          },
          {
            "version": "1.3",
            "date": "22.10.2011",
            "author": "",
            "changes": "If the PLines are selected now there is an option to select the labels to add that information to the Sip Panels Needs a Property Set Called PanelInfo"
          },
          {
            "version": "1.5",
            "date": "26.01.2015",
            "author": "",
            "changes": "Improved the option to pick TEXT when PLines are used for nestin"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 9167,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses standard 3D world coordinates (_PtW, _XW, _YW, _ZW) and performs geometric manipulations on entities (ChildPanel, EntPLine) in the model environment. It does not use ShopDrawing APIs (like sd_*), Viewport lists, or specific drawing sheet entities. The insertion point is retrieved using getPoint, which implies direct interaction in the Model Space."
        },
        "prerequisites": {
          "requiredEntities": [
            "ChildPanel or EntPLine"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D environment). The user must select either existing ChildPanels or closed Polylines to nest.",
          "requiredSettings": [
            "Property Set 'PanelInfo' (if using Polylines)",
            "SipStyle",
            "MasterPanelStyle"
          ]
        }
      },
      "tokens_used": 6428,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "|Set point to place master panels|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select child panels|",
              "condition": "sObjects==sChildPanels",
              "required": true
            },
            {
              "step": 3,
              "function": "PrEntity",
              "promptOriginal": "|Select close polylines|",
              "condition": "sObjects==sPLines",
              "required": true
            },
            {
              "step": 4,
              "function": "PrEntity",
              "promptOriginal": "|Select labels|",
              "condition": "sObjects==sPLines",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sEmpty",
            "type": "PropString",
            "displayName": "NESTER INFO",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Read-only informational field"
          },
          {
            "index": 11,
            "variable": "sObjects",
            "type": "PropString",
            "displayName": "|Objects To Nest|",
            "defaultValue": "|Child Panels|",
            "inputType": "dropdown",
            "options": [
              "|Child Panels|",
              "|Polylines|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 12,
            "variable": "pSipStyle",
            "type": "PropString",
            "displayName": "Sip style",
            "defaultValue": "Dynamic from Catalog",
            "inputType": "dropdown",
            "options": "All SipStyle entries",
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "pStyle",
            "type": "PropString",
            "displayName": "MasterPanel style:",
            "defaultValue": "Dynamic from Catalog",
            "inputType": "dropdown",
            "options": "All MasterPanelStyle entries",
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sMPName",
            "type": "PropString",
            "displayName": "MasterPanel Name:",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sMP1",
            "type": "PropString",
            "displayName": "Use 1220x4800",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 13,
            "variable": "sMP8",
            "type": "PropString",
            "displayName": "Use 1220x4900",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sMP2",
            "type": "PropString",
            "displayName": "Use 1220x5100",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sMP3",
            "type": "PropString",
            "displayName": "Use 1220x5500",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sMP4",
            "type": "PropString",
            "displayName": "Use 1220x6000",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sMP5",
            "type": "PropString",
            "displayName": "Use 1220x6250",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "sMP6",
            "type": "PropString",
            "displayName": "Use 1220x6500",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "sMP7",
            "type": "PropString",
            "displayName": "Use 1220x7500",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dAllowedTimeInSeconds",
            "type": "PropDouble",
            "displayName": "|Allowed run time in seconds|",
            "defaultValue": 360,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dMinimumSpacing",
            "type": "PropDouble",
            "displayName": "|Minimum spacing|",
            "defaultValue": 35,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 10,
            "variable": "sNester",
            "type": "PropString",
            "displayName": "Nester to use",
            "defaultValue": "|V6|",
            "inputType": "dropdown",
            "options": [
              "|Test|",
              "|V4|",
              "|V5|",
              "|V6|"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9703,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically nests smaller child panels or polylines onto standard-size stock master panels to optimize material usage in timber construction.",
          "category": "Production/Optimization",
          "typicalUseCase": "Used during the design or manufacturing phase to arrange Sip panels or wall components efficiently onto raw sheets (e.g., OSB or Plywood) to minimize waste."
        },
        "parameters": [
          {
            "name": "sEmpty",
            "technicalDefault": "",
            "businessMeaning": "A read-only status field used to display informational messages or results of the nesting operation to the user.",
            "validRange": "N/A",
            "unit": "Text",
            "affectsOutput": "None (Display only)"
          },
          {
            "name": "sObjects",
            "technicalDefault": "|Child Panels|",
            "businessMeaning": "Determines the type of entities to be nested. Specifies whether the user will select existing hsbCAD ChildPanels or generic AutoCAD Polylines (which will be converted to Sip panels).",
            "validRange": "Child Panels, Polylines",
            "unit": "Selection Mode",
            "affectsOutput": "Determines the input geometry type and whether 'PanelInfo' property sets and text labels are processed."
          },
          {
            "name": "pSipStyle",
            "technicalDefault": "Dynamic from Catalog",
            "businessMeaning": "Defines the construction style (material, thickness, layers) for the Structural Insulated Panels (Sip) created when nesting Polylines.",
            "validRange": "Any valid SipStyle entry in the catalog",
            "unit": "Catalog Entry",
            "affectsOutput": "Controls the physical attributes of the generated Sip elements if 'Objects To Nest' is set to Polylines."
          },
          {
            "name": "pStyle",
            "technicalDefault": "Dynamic from Catalog",
            "businessMeaning": "Defines the construction style for the generated master panels (sheets) used as the nesting base.",
            "validRange": "Any valid MasterPanelStyle entry in the catalog",
            "unit": "Catalog Entry",
            "affectsOutput": "Properties of the master panel entities, though the geometry is primarily driven by the dimension flags (e.g., Use 1220x4800)."
          },
          {
            "name": "sMPName",
            "technicalDefault": "",
            "businessMeaning": "Assigns a specific name prefix or identifier to the generated master panels.",
            "validRange": "Text string",
            "unit": "String",
            "affectsOutput": "Naming convention of the master panels in the model/database."
          },
          {
            "name": "sMP1",
            "technicalDefault": "No",
            "businessMeaning": "Enables or disables the use of a stock sheet size of 1220mm x 4800mm for nesting.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, a 1220x4800 mm master panel area is added to the available nesting space."
          },
          {
            "name": "sMP8",
            "technicalDefault": "No",
            "businessMeaning": "Enables or disables the use of a stock sheet size of 1220mm x 4900mm for nesting.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, a 1220x4900 mm master panel area is added to the available nesting space."
          },
          {
            "name": "sMP2",
            "technicalDefault": "No",
            "businessMeaning": "Enables or disables the use of a stock sheet size of 1220mm x 5100mm for nesting.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, a 1220x5100 mm master panel area is added to the available nesting space."
          },
          {
            "name": "sMP3",
            "technicalDefault": "No",
            "businessMeaning": "Enables or disables the use of a stock sheet size of 1220mm x 5500mm for nesting.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, a 1220x5500 mm master panel area is added to the available nesting space."
          },
          {
            "name": "sMP4",
            "technicalDefault": "No",
            "businessMeaning": "Enables or disables the use of a stock sheet size of 1220mm x 6000mm for nesting.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, a 1220x6000 mm master panel area is added to the available nesting space."
          },
          {
            "name": "sMP5",
            "technicalDefault": "No",
            "businessMeaning": "Enables or disables the use of a stock sheet size of 1220mm x 6250mm for nesting.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, a 1220x6250 mm master panel area is added to the available nesting space."
          },
          {
            "name": "sMP6",
            "technicalDefault": "No",
            "businessMeaning": "Enables or disables the use of a stock sheet size of 1220mm x 6500mm for nesting.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, a 1220x6500 mm master panel area is added to the available nesting space."
          },
          {
            "name": "sMP7",
            "technicalDefault": "No",
            "businessMeaning": "Enables or disables the use of a stock sheet size of 1220mm x 7500mm for nesting.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, a 1220x7500 mm master panel area is added to the available nesting space."
          },
          {
            "name": "dAllowedTimeInSeconds",
            "technicalDefault": 360,
            "businessMeaning": "The maximum calculation time allowed for the nesting algorithm to find an optimal solution before stopping.",
            "validRange": "10 to 3600 seconds",
            "unit": "Seconds",
            "affectsOutput": "Higher values may yield better packing efficiency but take longer to process. Lower values process faster but might result in suboptimal material usage."
          },
          {
            "name": "dMinimumSpacing",
            "technicalDefault": 35,
            "businessMeaning": "The required clearance distance between nested parts to account for saw kerf (cut width) or handling safety margins.",
            "validRange": "0 to 100 mm",
            "unit": "mm",
            "affectsOutput": "Determines how closely panels can be placed. Larger spacing results in more waste but accommodates tooling constraints."
          },
          {
            "name": "sNester",
            "technicalDefault": "|V6|",
            "businessMeaning": "Selects the specific version of the nesting algorithm engine to use for calculation.",
            "validRange": "Test, V4, V5, V6",
            "unit": "Algorithm Version",
            "affectsOutput": "Different versions may use different logic for optimization, affecting the speed and layout quality of the nesting result."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sObjects set to 'Polylines'",
            "effect": "Requires user to select labels (Text/MText) to populate PanelInfo.",
            "cascade": [
              "pSipStyle"
            ]
          },
          {
            "trigger": "sObjects set to 'Child Panels'",
            "effect": "Ignores pSipStyle and text selection logic; uses existing panel geometry.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "ChildPanel",
            "description": "The nested panels transformed to their new positions within the master panels.",
            "appliedTo": "Selected Child Panels or Panels generated from Polylines."
          },
          {
            "type": "Sip",
            "description": "Structural Insulated Panels created when input objects are Polylines.",
            "appliedTo": "Polylines selected by the user."
          },
          {
            "type": "MasterPanel",
            "description": "Stock sheets (e.g., 1220x6000) representing the raw material onto which items are nested.",
            "appliedTo": "Virtual nesting area defined by the dimension flags (sMP1, sMP2, etc)."
          }
        ]
      },
      "tokens_used": 11629,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script insertion triggers property configuration (Stock sizes, Styles, Nester version).",
          "2. User picks an insertion point for the Master Panels (Stock sheets).",
          "3. [Branch] User selects input objects based on 'Objects To Nest' property.",
          "4. [Branch - Polylines only] User selects Text/MText labels to populate PanelInfo.",
          "5. Script initializes Master Panels (Stock) based on enabled dimension flags (e.g., 1220x4800).",
          "6. Script initializes Nester Child objects (Items to nest) from selected entities.",
          "7. Script executes Nesting algorithm with specified timeout and spacing.",
          "8. [Branch] Script validates Nesting result.",
          "9. [Branch - Success] Script transforms Child Panels to their new coordinates.",
          "10. [Branch - Success - Polylines] Script creates Sip elements and ChildPanels from Polylines.",
          "11. Script performs alignment operations (Bottom-Left justification and Gap reduction).",
          "12. Script stacks generated Sip panels in a designated layout area.",
          "13. Script reports Nesting results (Leftovers) and erases the script instance."
        ],
        "conditionalBranches": [
          {
            "condition": "Property 'Objects To Nest' (sObjects)",
            "path1": {
              "name": "Child Panels",
              "steps": [
                "Prompt user to select ChildPanel entities.",
                "Append valid ChildPanels to entity list.",
                "Calculate envelope for nesting.",
                "Transform existing ChildPanels to nested position.",
                "Skip Sip creation steps."
              ]
            },
            "path2": {
              "name": "Polylines",
              "steps": [
                "Prompt user to select closed Polylines.",
                "Attach 'PanelInfo' property set to Polylines.",
                "Prompt user to select Labels (Text/MText).",
                "Map Labels to Polylines based on geometric containment (Text inside PLine).",
                "Update 'PanelCode' in property set.",
                "Calculate envelope from PLine geometry.",
                "Create new Sip element using 'Sip style'.",
                "Create new ChildPanel from Sip.",
                "Transform new entities to nested position."
              ]
            }
          },
          {
            "condition": "Result of Nesting Algorithm (nester.nest)",
            "path1": {
              "name": "Success (OK)",
              "steps": [
                "Loop through Nesting results.",
                "Apply transformations to entities.",
                "Execute fine-tuning alignment.",
                "Generate final report."
              ]
            },
            "path2": {
              "name": "Failure/Error",
              "steps": [
                "Display error message (e.g., 'Not possible to nest').",
                "Check for specific errors (e.g., 'No dongle present').",
                "Erase script instance immediately.",
                "Do not generate/modify geometry."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Nesting Algorithm Success",
            "errorMessage": "Not possible to nest",
            "recovery": "Check input geometry sizes vs Master Panel sizes, ensure Dongle is present, or increase 'Allowed run time'."
          },
          {
            "check": "Hardware Security (Dongle)",
            "errorMessage": "No dongle present",
            "recovery": "Ensure the hsbCAD security dongle is connected to the computer."
          },
          {
            "check": "Entity Area Validity",
            "errorMessage": "(Silent filter)",
            "recovery": "Entities with area less than 1mm x 1mm are ignored by the nester."
          },
          {
            "check": "PLine Closure",
            "errorMessage": "(Implicit)",
            "recovery": "Script prompts for 'close polylines', implies open polylines may cause calculation errors."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None (Script Self-Deletes)",
            "how": "N/A",
            "effect": "The script calls 'eraseInstance()' at the end of execution. The resulting panels and SIPs are standard CAD entities and are no longer controlled by this script instance. To re-nest, the user must insert the script again."
          }
        ]
      },
      "tokens_used": 12882,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_GeneralPanelNester.mcr\n\n## Overview\nThis script automatically nests smaller child panels or closed polylines onto standard-size stock master panels. It optimizes material usage for timber construction by arranging parts efficiently within defined sheet dimensions based on selected styles and sizes.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script interacts with 3D geometry and coordinates in the model. |\n| Paper Space | No | Not supported in layout views. |\n| Shop Drawing | No | This is a production/modeling tool, not a drawing generator. |\n\n## Prerequisites\n- **Required Entities**: Existing `ChildPanel` entities OR closed `Polylines` (representing parts).\n- **Settings**: `SipStyle` and `MasterPanelStyle` entries must exist in your catalog.\n- **Property Sets**: If using Polylines, a Property Set definition named `PanelInfo` is required to store data.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_GeneralPanelNester.mcr`\n\n### Step 2: Configure Properties\nBefore inserting, select the script instance in the drawing to open the **Properties Palette**.\n- Set **Objects To Nest** to \"Child Panels\" or \"Polylines\".\n- Select the desired **Sip style** (if using Polylines) and **MasterPanel style**.\n- Enable the stock sheet sizes you wish to use (e.g., set \"Use 1220x6000\" to \"Yes\").\n\n### Step 3: Set Insertion Point\n```\nCommand Line: Set point to place master panels\nAction: Click in the Model Space to define where the top-left of the stock sheets (Master Panels) will be generated.\n```\n\n### Step 4: Select Objects to Nest\n*If \"Objects To Nest\" is set to Child Panels:*\n```\nCommand Line: Select child panels\nAction: Select the panel entities you want to arrange on the sheets. Press Enter to confirm.\n```\n\n*If \"Objects To Nest\" is set to Polylines:*\n```\nCommand Line: Select close polylines\nAction: Select the closed polylines representing the parts to be nested. Press Enter to confirm.\n```\n\n### Step 5: Select Labels (Polylines Only)\n```\nCommand Line: Select labels\nAction: Select any Text or MText entities associated with the polylines. These are used to populate the 'PanelInfo' property data. Press Enter if no labels are needed.\n```\n\n### Step 6: Processing\nThe script will now calculate the optimal nesting layout.\n- Wait for the calculation to complete (limited by the \"Allowed run time in seconds\" property).\n- Upon success, the nested panels will be moved to the stock sheets, and the script instance will delete itself.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| NESTER INFO | String | - | Read-only field displaying status or error messages. |\n| Objects To Nest | Dropdown | Child Panels | Choose whether to nest existing hsbCAD Child Panels or generic Polylines. |\n| Sip style | Dropdown | Dynamic | Defines the material and construction style for panels created from Polylines. |\n| MasterPanel style | Dropdown | Dynamic | Defines the style for the stock Master Panels (sheets). |\n| MasterPanel Name | String | - | Assigns a specific name prefix to the generated Master Panels. |\n| Use 1220x4800 | Dropdown | No | Enable to include a 1220x4800mm stock sheet in the nesting calculation. |\n| Use 1220x4900 | Dropdown | No | Enable to include a 1220x4900mm stock sheet in the nesting calculation. |\n| Use 1220x5100 | Dropdown | No | Enable to include a 1220x5100mm stock sheet in the nesting calculation. |\n| Use 1220x5500 | Dropdown | No | Enable to include a 1220x5500mm stock sheet in the nesting calculation. |\n| Use 1220x6000 | Dropdown | No | Enable to include a 1220x6000mm stock sheet in the nesting calculation. |\n| Use 1220x6250 | Dropdown | No | Enable to include a 1220x6250mm stock sheet in the nesting calculation. |\n| Use 1220x6500 | Dropdown | No | Enable to include a 1220x6500mm stock sheet in the nesting calculation. |\n| Use 1220x7500 | Dropdown | No | Enable to include a 1220x7500mm stock sheet in the nesting calculation. |\n| Allowed run time in seconds | Number | 360 | Maximum time allowed for the nesting algorithm to find a solution. |\n| Minimum spacing | Number | 35 | Clearance distance between nested parts (saw kerf/safety margin) in mm. |\n| Nester to use | Dropdown | V6 | Selects the algorithm version (Test, V4, V5, or V6). |\n\n## Right-Click Menu Options\nThere are no specific context menu options added by this script. Configuration is done entirely via the Properties Palette.\n\n## Settings Files\nNo external settings files (XML) are used by this script. All configuration is handled via Properties and Catalog entries.\n\n## Tips\n- **Self-Deleting**: The script instance automatically erases itself after a successful run. You only need to insert it again if you want to re-nest.\n- **Dongle Requirement**: If the script fails with \"No dongle present,\" ensure your hsbCAD security dongle is connected.\n- **Calculation Time**: If you have many complex parts, increase the \"Allowed run time in seconds\" to allow the algorithm more time to find a better fit.\n- **Polyline Workflow**: When nesting polylines, ensure your text labels are positioned inside the corresponding polyline boundaries so the script can link them correctly.\n\n## FAQ\n- **Q: Why did the script disappear after I ran it?**\n  - A: This is normal behavior. The script creates the geometry (Master Panels and nested parts) and then removes itself from the drawing to keep the model clean.\n- **Q: What happens if the calculation takes too long?**\n  - A: The script will stop at the time limit defined in \"Allowed run time in seconds\" and use the best solution found up to that point. Increase this value if the result is not optimal.\n- **Q: Can I mix different stock sizes?**\n  - A: Yes. You can enable multiple \"Use 1220x...\" options (e.g., both 4800 and 6000 lengths) to allow the nester to mix different sheet sizes."
      },
      "tokens_used": 8330,
      "error": null
    }
  }
}