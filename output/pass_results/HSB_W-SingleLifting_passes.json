{
  "filename": "HSB_W-SingleLifting.mcr",
  "status": "completed",
  "total_tokens": 46944,
  "processing_time": 673.0657687187195,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.6",
            "date": "3-11-2023",
            "author": "Ronald van Wijngaarden",
            "changes": "Change property name, diameter to radius."
          },
          {
            "version": "1.00",
            "date": "19.04.2017",
            "author": "YB",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "07.06.2017",
            "author": "DR",
            "changes": "Added multi insertion, display, and enhanced to set element's zone number and character that it belongs to"
          },
          {
            "version": "1.02",
            "date": "08.06.2017",
            "author": "AS",
            "changes": "Simplify insert"
          },
          {
            "version": "1.03",
            "date": "14.06.2017",
            "author": "YB",
            "changes": "Add a drill to adjacent beams"
          },
          {
            "version": "1.04",
            "date": "20.06.2017",
            "author": "YB",
            "changes": "Changed display according to adjacent beams, changed Pt0 to centerpoint of beams."
          },
          {
            "version": "1.05",
            "date": "19.06.2021",
            "author": "MN",
            "changes": "HSB-12182: add trigger to add/remove connecting beams"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7741,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script filename 'HSB_W-SingleLifting.mcr' uses the standard naming convention without 'sd_' or 'Multipage' prefixes. No '#Type E' declarations or _Viewport usage are present. The script performs 3D geometric operations such as creating Drills on Beams and visualizing a PLine in 3D space using CoordSys and Vector3d, which are characteristic of Model Space scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5101,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getBeam",
              "promptOriginal": "Select a vertical beam",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select insertion point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "PrEntity",
            "trigger": "Context menu 'add Connecting Beams' triggered",
            "title": null,
            "dataSource": "Model Space",
            "features": {
              "searchable": false,
              "multiSelect": true
            }
          },
          {
            "type": "PrEntity",
            "trigger": "Context menu 'remove ConnectingBeams' triggered",
            "title": null,
            "dataSource": "Model Space",
            "features": {
              "searchable": false,
              "multiSelect": true
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "propOffsetVertical",
            "type": "PropDouble",
            "displayName": "Vertical offset",
            "defaultValue": "U(80)",
            "inputType": "number",
            "options": [],
            "category": "Tooling",
            "description": "Offset in the vertical direction."
          },
          {
            "index": 1,
            "variable": "propOffsetHorizontal",
            "type": "PropDouble",
            "displayName": "Horizontal offset",
            "defaultValue": "U(80)",
            "inputType": "number",
            "options": [],
            "category": "Tooling",
            "description": "Offset in the horizontal direction."
          },
          {
            "index": 2,
            "variable": "propDiameter",
            "type": "PropDouble",
            "displayName": "Drill radius",
            "defaultValue": "U(10)",
            "inputType": "number",
            "options": [],
            "category": "Tooling",
            "description": "Specifies the drill radius."
          },
          {
            "index": 0,
            "variable": "sZoneCharacter",
            "type": "PropString",
            "displayName": "Layer",
            "defaultValue": 1,
            "inputType": "dropdown",
            "options": [
              "'E' for element tools",
              "'Z' for general items",
              "'T' for beam tools",
              "'I' for information",
              "'C' for construction",
              "'D' for dimension"
            ],
            "category": "Style",
            "description": null
          },
          {
            "index": 0,
            "variable": "nPrZoneIndex",
            "type": "PropInt",
            "displayName": "Zone index",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              0,
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10
            ],
            "category": "Style",
            "description": null
          },
          {
            "index": 1,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 3,
            "inputType": "number",
            "options": [],
            "category": "Display",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "add Connecting Beams",
            "handler": "add Connecting Beams",
            "action": "Prompts user to select beams to add to the connecting beams list for drilling.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "remove ConnectingBeams",
            "handler": "remove ConnectingBeams",
            "action": "Prompts user to select beams to remove from the connecting beams list.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7150,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Generates a lifting anchor for timber wall panels, creating drill holes for the lifting hardware (strap or bolt) through vertical studs and connecting members, plus a visual symbol of the lifting loop.\",\n    \"category\": \"Production / Hardware\",\n    \"typicalUseCase\": \"Preparing a wall element for transport by specifying where a lifting strap passes through the timber, ensuring the holes are aligned through multiple studs and plates.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"propOffsetVertical\",\n      \"technicalDefault\": \"U(80)\",\n      \"businessMeaning\": \"The vertical distance from the reference point (beam center) to the top/bottom of the lifting loop. Effectively controls how 'deep' or 'high' the lifting eye extends from the face of the beam.\",\n      \"validRange\": \"40mm - 200mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Moves the position of the drill start/end points vertically and stretches the visual lifting loop symbol.\"\n    },\n    {\n      \"name\": \"propOffsetHorizontal\",\n      \"technicalDefault\": \"U(80)\",\n      \"businessMeaning\": \"The horizontal distance from the center line to the side of the lifting loop (the half-width of the loop).\",\n      \"validRange\": \"30mm - 200mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Determines the width of the lifting loop visual and the spread of the drill holes on the connecting beams. Influences which adjacent beams are included based on gap calculations.\"\n    },\n    {\n      \"name\": \"propDiameter\",\n      \"technicalDefault\": \"U(10)\",\n      \"businessMeaning\": \"The radius of the drill hole required for the lifting hardware. (Note: Despite the variable name being 'Diameter', the code treats this value as a Radius).\",\n      \"validRange\": \"4mm - 20mm (Radius)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Changes the diameter of the Drill entities added to the beams.\"\n    },\n    {\n      \"name\": \"sZoneCharacter\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"The CAD layer category or zone character used to organize the display of the lifting symbol.\",\n      \"validRange\": \"E, Z, T, I, C, D\",\n      \"unit\": \"enum\",\n      \"affectsOutput\": \"Assigns the visual PLine to a specific CAD layer/zone for filtering or visibility control.\"\n    },\n    {\n      \"name\": \"nPrZoneIndex\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"The specific index number within the selected zone character, used for finer granularity of layer management.\",\n      \"validRange\": \"0 - 10\",\n      \"unit\": \"count\",\n      \"affectsOutput\": \"Assigns the visual PLine to a specific layer index.\"\n    },\n    {\n      \"name\": \"nColor\",\n      \"technicalDefault\": \"3\",\n      \"businessMeaning\": \"The AutoCAD color index used to draw the visual lifting symbol.\",\n      \"validRange\": \"0 - 255 (AutoCAD Index)\",\n      \"unit\": \"color\",\n      \"affectsOutput\": \"Changes the display color of the lifting loop PLine.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"propOffsetHorizontal is changed\",\n      \"effect\": \"Alters the range of beams searched for connection. If the offset is too small, adjacent beams might not be included.\",\n      \"cascade\": [\n        \"Drill Locations\",\n        \"Visual PLine Width\"\n      ]\n    },\n    {\n      \"trigger\": \"propDiameter is changed\",\n     "
      },
      "tokens_used": 9922,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User executes the script.",
          "[Conditional] If no execute key is provided, show catalog dialog to select preset.",
          "Prompt user to select a vertical beam.",
          "Prompt user to select an insertion point (defines side of beam and height).",
          "Verify selected beam is valid and part of a valid element.",
          "Verify beam orientation: Check if Beam Vector is parallel to Element Y-axis.",
          "Determine 'Inside' and 'Outside' vectors based on insertion point relative to beam center.",
          "Create drill on the main selected beam at calculated offset.",
          "Identify vertical beams to the Left and Right of the main beam using ray projection.",
          "Loop through Left/Right beams: Drill through them if they fall within 'Horizontal offset' limit.",
          "Initialize or retrieve the list of connecting (transverse) beams.",
          "[First Run Only] Auto-detect all beams intersecting the outward ray and store as candidates.",
          "Create vertical drill holes in the connecting beams based on calculated offsets.",
          "Adjust insertion point center based on total left/right offsets.",
          "Draw the visual PLine (lifting loop) symbol with specified layer and color."
        ],
        "conditionalBranches": [
          {
            "condition": "Initial Insertion Mode (_bOnInsert)",
            "path1": {
              "name": "Execute Key Provided",
              "steps": [
                "Load properties from catalog based on _kExecuteKey.",
                "Skip catalog dialog.",
                "Prompt for beam and point."
              ]
            },
            "path2": {
              "name": "Standard Insert",
              "steps": [
                "Show 'Last Inserted' catalog dialog.",
                "Prompt for beam and point."
              ]
            }
          },
          {
            "condition": "Beam Verticality Check",
            "path1": {
              "name": "Beam is Vertical",
              "steps": [
                "Proceed with orientation calculation.",
                "Generate drills and display."
              ]
            },
            "path2": {
              "name": "Beam is Not Vertical",
              "steps": [
                "Report notice: 'Beam is not vertical!'.",
                "Erase script instance.",
                "Stop execution."
              ]
            }
          },
          {
            "condition": "Connecting Beams Initialization",
            "path1": {
              "name": "First Run (iConnectingBeamsInserted == 0)",
              "steps": [
                "Detect all beams intersecting the ray starting at insertion point.",
                "Store all detected beams in Map as 'connectingBeamsAll'.",
                "Mark initialization as done."
              ]
            },
            "path2": {
              "name": "Subsequent Runs",
              "steps": [
                "Retrieve list of 'connectingBeams' from Map.",
                "Use stored list for drilling."
              ]
            }
          },
          {
            "condition": "Context Menu Triggered",
            "path1": {
              "name": "Add Connecting Beams",
              "steps": [
                "Prompt user to select beams.",
                "Filter selection: Keep only beams found in auto-detected 'connectingBeamsAll' and not already in list.",
                "Append valid beams to list.",
                "Update Map.",
                "Recalculate (2 loops)."
              ]
            },
            "path2": {
              "name": "Remove Connecting Beams",
              "steps": [
                "Prompt user to select beams.",
                "Filter selection: Keep only beams currently in the list.",
                "Remove beams from list.",
                "Update Map.",
                "Recalculate (2 loops)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam validity and Element assignment",
            "errorMessage": "None (Silent erase)",
            "recovery": "Select a valid beam that belongs to an element."
          },
          {
            "check": "Beam orientation relative to Element",
            "errorMessage": "Beam is not vertical!",
            "recovery": "Select a beam that is parallel to the Element's Y-axis."
          },
          {
            "check": "Adding Connecting Beams (via Trigger)",
            "errorMessage": "None (Beams are silently filtered out)",
            "recovery": "Only select beams that physically intersect the search area defined by the insertion point."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry",
            "how": "OPM Properties (Vertical offset, Horizontal offset, Drill radius)",
            "effect": "Updates the position and size of drills on the main, adjacent, and connecting beams. Resizes the visual symbol."
          },
          {
            "action": "Modify Display",
            "how": "OPM Properties (Zone, Color)",
            "effect": "Changes the layer and color of the lifting symbol."
          },
          {
            "action": "Add Connecting Beams",
            "how": "Right-click Context Menu > 'add Connecting Beams'",
            "effect": "Opens selection prompt to add beams to the drilling list. Beams must be within the auto-detected search path."
          },
          {
            "action": "Remove Connecting Beams",
            "how": "Right-click Context Menu > 'remove ConnectingBeams'",
            "effect": "Opens selection prompt to remove beams from the drilling list."
          }
        ]
      },
      "tokens_used": 10387,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_W-SingleLifting.mcr\n\n## Overview\nThis script generates a single lifting anchor for timber wall panels. It automatically creates drill holes for lifting hardware (straps or bolts) through the main vertical stud, adjacent studs, and connecting members, while visualizing the lifting loop symbol.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Designed for 3D model interaction. |\n| Paper Space | No | Not intended for layout views. |\n| Shop Drawing | No | Not intended for 2D drawings. |\n\n## Prerequisites\n- **Required entities**: A vertical Beam (stud) that belongs to an Element.\n- **Minimum beam count**: 1\n- **Required settings**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\n```\nCommand Line: TSLINSERT\nAction: Select HSB_W-SingleLifting.mcr from the catalog list.\n```\n\n### Step 2: Select Main Beam\n```\nCommand Line: Select a vertical beam\nAction: Click on the vertical stud (wall element) where you want to place the lifting anchor.\n```\n*Note: The script will automatically verify if the selected beam is vertical. If it is horizontal or angled, the script will abort.*\n\n### Step 3: Define Position\n```\nCommand Line: Select insertion point\nAction: Click on the face of the selected beam to set the height and side for the lifting loop.\n```\n*Note: This point determines the center of the lifting anchor and helps the script detect which adjacent beams to drill.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Vertical offset** | Number | 80 mm | The vertical distance from the beam center to the top/bottom of the loop. Controls how \"deep\" the lifting eye extends. |\n| **Horizontal offset** | Number | 80 mm | The horizontal distance from the center line to the side of the loop. Controls the width of the loop. |\n| **Drill radius** | Number | 10 mm | The radius of the drill hole for the lifting hardware. (Note: This value sets the radius, not the diameter). |\n| **Layer** | Dropdown | 1 | The CAD layer category (e.g., E for element tools, T for beam tools) used to organize the display. |\n| **Zone index** | Number | 0 | The specific index number within the selected layer category. |\n| **Color** | Number | 3 | The AutoCAD color index used to draw the visual lifting loop symbol. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **add Connecting Beams** | Opens a selection prompt to add beams to the drilling list. You can only select beams that were initially auto-detected by the script during insertion. |\n| **remove ConnectingBeams** | Opens a selection prompt to remove beams from the current drilling list. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: No external settings files are required for this script.\n\n## Tips\n- **Beam Orientation**: Ensure the beam you select is perfectly vertical relative to the element's Y-axis. If the script disappears immediately after selection, check the beam's orientation.\n- **Drill Size**: The property labeled \"Drill radius\" controls the size of the hole. If you need a 20mm hole, set this value to 10.\n- **Modifying Members**: After insertion, use the right-click context menu to add or remove specific connecting beams (e.g., top or bottom plates) without deleting and re-inserting the anchor.\n\n## FAQ\n- **Q: Why did the script delete itself immediately after I picked the beam?**\n- **A**: The selected beam was likely not vertical. The script only works on beams that are parallel to the Element's Y-axis.\n\n- **Q: Can I add a beam that wasn't drilled initially?**\n- **A**: Only if it was physically located within the auto-detection range during the initial insertion. The \"add Connecting Beams\" function allows you to select from a list of candidates found near the insertion point.\n\n- **Q: How do I change the size of the loop visualization?**\n- **A**: Adjust the \"Vertical offset\" and \"Horizontal offset\" properties in the AutoCAD Properties palette. This will resize the symbol and update the drill positions accordingly."
      },
      "tokens_used": 6643,
      "error": null
    }
  }
}