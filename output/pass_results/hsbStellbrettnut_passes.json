{
  "filename": "hsbStellbrettnut.mcr",
  "status": "completed",
  "total_tokens": 20652,
  "processing_time": 530.3905456066132,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 2264,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script modifies 3D beam geometry using `_Beam[].addTool()`, calculates 3D spatial data (Point3d, Body, Plane), and lacks Paper Space identifiers (sd_, _Viewport) or ShopDrawing entities (_Entity)."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space (3D environment)",
          "requiredSettings": []
        }
      },
      "tokens_used": 2287,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "Depth",
            "defaultValue": "U(5)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dGapLength",
            "type": "PropDouble",
            "displayName": "Gap Depth",
            "defaultValue": "U(5)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dGapSide",
            "type": "PropDouble",
            "displayName": "Gap Side",
            "defaultValue": "U(2)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2120,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automates the creation of a T-connection blocking groove (mortise and tenon) between two timber beams, generating the slot in the main beam and the tenon trim on the inserting beam.\",\n    \"category\": \"Joinery/Machining\",\n    \"typicalUseCase\": \"Connecting joists, purlins, or shelf beams into main carrying beams where a structural slot is required to transfer loads.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"dDepth\",\n      \"technicalDefault\": \"U(5)\",\n      \"businessMeaning\": \"Tenon Length / Functional Slot Depth. Determines how deep the male beam inserts into the female beam before touching the bottom of the groove.\",\n      \"validRange\": \"10 mm to 1/2 of beam width\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Controls the length of the tenon on Beam 0 and the depth of the bearing surface in the slot of Beam 1.\"\n    },\n    {\n      \"name\": \"dGapLength\",\n      \"technicalDefault\": \"U(5)\",\n      \"businessMeaning\": \"Back Clearance. Extra space cut at the bottom of the groove to prevent the beams from bottoming out, accommodating tolerances or swelling.\",\n      \"validRange\": \"0 mm to 10 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Extends the total depth of the groove in Beam 1 beyond the tenon length (dDepth).\"\n    },\n    {\n      \"name\": \"dGapSide\",\n      \"technicalDefault\": \"U(2)\",\n      \"businessMeaning\": \"Side Clearance. Horizontal tolerance added to the width of the groove to ensure easy assembly of the male beam.\",\n      \"validRange\": \"1 mm to 5 mm\",\n      \""
      },
      "tokens_used": 5529,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches script (hsbStellbrettnut.mcr)",
          "Script sets internal units (U) to millimeters",
          "Script initializes OPM properties: Depth (dDepth), Gap Depth (dGapLength), Gap Side (dGapSide)",
          "Script checks current values of dDepth and dGapLength",
          "[Decision] Are dDepth <= 0 AND dGapLength <= 0?",
          "If YES: Script calculates a dynamic stretch connection between Beam 0 and Beam 1, erases the current script instance, and stops.",
          "If NO: Script proceeds to generate tooling geometry",
          "Script creates a 'Cut' tool on Beam 0 (Male/Tenon) starting from Pt0 along the Z1 axis with length dDepth",
          "Script creates a 'BeamCut' tool on Beam 1 (Female/Mortise) to cut a slot",
          "Slot geometry includes depth (dDepth + dGapLength), width (Beam Width + dGapSide), and infinite length along the beam",
          "Script applies tools to beams using addTool()",
          "Script initializes Display object (ID 106)",
          "Script retrieves the cutting body of the mortise slot",
          "Script validates that the cutting body has at least 2 extreme vertices",
          "[Decision] Does cutting body have valid vertices?",
          "If NO: Script erases instance and stops",
          "If YES: Script proceeds to calculate visual representation",
          "Script intersects the cutting body with Beam 1's envelope",
          "Script extracts the contact face profile in the Z1 plane",
          "Script calculates the extent of this face in the Y0 direction",
          "Script draws a polyline in the 3D view to visualize the connection limit",
          "Execution completes"
        ],
        "conditionalBranches": [
          {
            "condition": "Values of Depth and Gap Depth are zero or negative",
            "path1": {
              "name": "Dynamic Stretch Mode",
              "steps": [
                "Call stretchDynamicTo between Beam[0] and Beam[1]",
                "Erase script instance",
                "Return (Script ends)"
              ]
            },
            "path2": {
              "name": "Standard Groove Mode",
              "steps": [
                "Define Cut tool for Tenon (Beam 0)",
                "Define BeamCut tool for Mortise (Beam 1)",
                "Apply tools to beams",
                "Calculate and draw visualization graphics"
              ]
            }
          },
          {
            "condition": "Cutting body vertex validation (during visualization)",
            "path1": {
              "name": "Geometry Error",
              "steps": [
                "Detect less than 2 extreme vertices",
                "Erase instance",
                "Return (Script ends)"
              ]
            },
            "path2": {
              "name": "Visualization Success",
              "steps": [
                "Intersect body with beam envelope",
                "Extract contact face",
                "Draw limit line"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Property values (dDepth, dGapLength) vs Zero threshold",
            "errorMessage": "None (Silent switch to dynamic stretch mode)",
            "recovery": "User sets positive values in properties to generate machining, or zero/negative to use stretch behavior"
          },
          {
            "check": "Cutting Body Vertex Count",
            "errorMessage": "None (Silent failure and erase)",
            "recovery": "User must check beam alignment and sizes, then re-insert script"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Groove Dimensions",
            "how": "OPM Properties Palette (Depth, Gap Depth, Gap Side)",
            "effect": "Re-calculates Cut and BeamCut geometry, updates machining on both beams immediately"
          },
          {
            "action": "Convert to Dynamic Stretch",
            "how": "OPM Properties Palette (Set Depth and Gap Depth to <= 0)",
            "effect": "Script self-deletes, applies a stretch relation between the two beams instead of solid machining"
          },
          {
            "action": "Move Beams",
            "how": "Grip Edit / Move Command",
            "effect": "Since Pt0 is used as reference, moving beams triggers recalculation. The slot (Beam 1) is infinite along the beam length, so it updates position relative to Beam 0."
          }
        ]
      },
      "tokens_used": 3758,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbStellbrettnut\n\n## Overview\nThis script automates the creation of a T-connection joinery (mortise and tenon) between two timber beams. It generates a slot in the main beam and a tenon trim on the inserting beam, allowing for adjustable connections such as shelf supports or joist hangers.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for 3D beam geometry modification. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: 2 GenBeams (one inserting beam, one main carrying beam).\n- **Minimum Beam Count**: 2\n- **Required Settings**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbStellbrettnut.mcr`\n\n### Step 2: Select Beams\n```\nCommand Line: Select the inserting beam (Beam 0):\nAction: Click on the beam that will insert into the other (the tenon side).\n\nCommand Line: Select the main beam (Beam 1):\nAction: Click on the beam that will receive the groove (the mortise side).\n```\n\n### Step 3: Configure Parameters\n```\nAction: Select the script instance and open the Properties Palette (Ctrl+1).\nAdjust the Depth, Gap Depth, and Gap Side as needed.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Depth | Number | 5 mm | Determines how deep the tenon inserts into the main beam. (Tenon Length). |\n| Gap Depth | Number | 5 mm | Extra space at the bottom of the groove to prevent bottoming out (Back Clearance). |\n| Gap Side | Number | 2 mm | Horizontal clearance added to the groove width for easier assembly (Side Clearance). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific custom context menu items are defined for this script. Standard options (Delete, Properties) apply. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Dynamic Stretch Mode**: If you set both **Depth** and **Gap Depth** to `0` or negative values, the script will switch to \"Dynamic Stretch\" mode. It will delete the machining and instead create a stretch relation between the two beams.\n- **Infinite Slot**: The groove cut into the main beam (Beam 1) is infinite in length. You can slide the inserting beam (Beam 0) along the main beam, and the connection will update automatically.\n- **Adjustable Fit**: If the timber is swelling or requires loose fit, increase the **Gap Side** value.\n\n## FAQ\n- **Q: What happens if I set the Depth to 0?**\n  - A: The script detects this value, deletes itself, and converts the connection into a dynamic stretch constraint instead of cutting wood.\n- **Q: Why did my groove disappear?**\n  - A: This usually happens if the geometry validation fails. Check that the beams are intersecting correctly and try re-inserting the script.\n- **Q: Can I use this for curved beams?**\n  - A: While the script works on beam geometry, extreme curvature might cause validation errors if the cutting body cannot be calculated. It is best suited for straight or standard arched beams."
      },
      "tokens_used": 4694,
      "error": null
    }
  }
}