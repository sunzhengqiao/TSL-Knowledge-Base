{
  "filename": "HSB_W-ProfiledHeader.mcr",
  "status": "completed",
  "total_tokens": 33595,
  "processing_time": 568.819874048233,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": 1,
          "minorVersion": 2,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "04.01.2013",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "19.03.2014",
            "author": "AS",
            "changes": "Add option to change material name"
          },
          {
            "version": "1.02",
            "date": "02.04.2014",
            "author": "AS",
            "changes": "Add option to copy profile name to one of the header properties."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5154,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of `_kModelSpace` in `dbCreate`. The script prompts for `OpeningSF` selection and retrieves `Element` and `Beam` objects from the model. No references to `_kPaperSpace`, `_Viewport`, or ShopDrawing `#Type E` annotations. The script structure is a 'command' style script (inserts, performs actions, erases itself) typical of Model Space utilities."
        },
        "prerequisites": {
          "requiredEntities": [
            "OpeningSF",
            "Element",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing valid OpeningSF entities with parent Elements containing Header beams.",
          "requiredSettings": []
        }
      },
      "tokens_used": 3891,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select one or more openings|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDialog",
            "trigger": "_bOnInsert (if _kExecuteKey is empty or not found)",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeperator01",
            "type": "PropString",
            "displayName": "|Extrusion profile|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sExtrusionProfileName",
            "type": "PropString",
            "displayName": "     |Extrusion profile name|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Dynamically generated list of all Extrusion Profiles (sorted alphabetically with Rectangular at top)"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sMaterialName",
            "type": "PropString",
            "displayName": "     |Material|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sCopyProfileNameToField",
            "type": "PropString",
            "displayName": "     |Copy profile name to|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|Do not copy profile name|",
              "|Information|"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5868,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Utility to batch modify the cross-section profiles and material of header beams located above selected wall openings.",
          "category": "Framing/Modification",
          "typicalUseCase": "Replacing standard rectangular headers with specific profiled sections (e.g., glulams or custom shapes) and optionally updating their material properties and metadata."
        },
        "parameters": [
          {
            "name": "sSeperator01",
            "technicalDefault": "",
            "businessMeaning": "Visual grouping label in the properties palette to separate header profile settings.",
            "validRange": "N/A (Static Text)",
            "unit": "N/A",
            "affectsOutput": "None (UI only)"
          },
          {
            "name": "sExtrusionProfileName",
            "technicalDefault": "_kExtrProfRectangular (moved to top of list)",
            "businessMeaning": "The specific cross-sectional shape and dimensions (e.g., 'Rectangular 45x245', 'Round') to be applied to the header beam.",
            "validRange": "List of available Extrusion Profiles in the current hsbCAD catalog.",
            "unit": "mm/Geometry",
            "affectsOutput": "Changes the 3D geometry, volume, and CNC machining information of the header beam."
          },
          {
            "name": "sMaterialName",
            "technicalDefault": "",
            "businessMeaning": "The timber material grade or species assigned to the header beam.",
            "validRange": "String (e.g., C24, GL24h). If empty, the existing material is retained.",
            "unit": "Text",
            "affectsOutput": "Updates the beam's material property, affecting weight calculations, structural reports, and visual rendering."
          },
          {
            "name": "sCopyProfileNameToField",
            "technicalDefault": "|Do not copy profile name|",
            "businessMeaning": "Configuration to automatically write the selected profile name into the beam's 'Information' field for reports or labeling.",
            "validRange": "|Do not copy profile name|, |Information|",
            "unit": "Enumeration",
            "affectsOutput": "Updates the non-graphical 'Information' attribute of the beam entity."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sCopyProfileNameToField is set to '|Information|'",
            "effect": "The value from 'sExtrusionProfileName' is copied to the target beam's Information field.",
            "cascade": [
              "sExtrusionProfileName"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam (Modified)",
            "description": "Existing Header beams are updated with new profiles, materials, and information data.",
            "appliedTo": "Header beams (Type=_kHeader) found within the parent Element (Wall) of the selected OpeningSF."
          }
        ]
      },
      "tokens_used": 5912,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script initializes: Retrieves and sorts all Extrusion Profile names (placing 'Rectangular' at top).",
          "Check Execution Context: Determines if called via Execute Key (Catalog) or manual Insert.",
          "[Conditional] Property Input: If manual insert, open Dialog to select Profile, Material, and Info options. If Execute Key, load properties from Catalog.",
          "Cycle Check: Verify insertCycleCount is 1. If > 1, script erases itself (safety lock).",
          "User Selection: Prompt user to select one or more OpeningSF entities (Wall Openings).",
          "Processing Loop: Iterate through each selected OpeningSF.",
          "Satellite Generation: For each valid opening, insert a new 'Satellite' instance of this script into ModelSpace, passing current properties via a temporary 'MasterToSatellite' catalog.",
          "Master Termination: The original 'Master' instance reports the count of inserted scripts and erases itself.",
          "Satellite Execution: Each Satellite instance wakes up and loads properties from the temporary catalog.",
          "Entity Validation: Satellite confirms it is attached to a valid OpeningSF with a valid parent Element (Wall).",
          "Header Detection: Satellite scans the parent Element for beams of type '_kHeader'.",
          "Spatial Filtering: Check if the opening's center point spatially overlaps with the header beam's length along the wall's X-axis.",
          "Modification Loop: Apply selected Extrusion Profile, Material (if specified), and Information text (if enabled) to all valid headers found.",
          "Satellite Termination: Satellite reports changes made and erases itself."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Method (Insert vs Execute Key)",
            "path1": {
              "name": "Manual Insert",
              "steps": [
                "insertCycleCount check",
                "showDialog() is called",
                "User selects properties from UI",
                "User selects Openings"
              ]
            },
            "path2": {
              "name": "Execute Key / Catalog",
              "steps": [
                "insertCycleCount check",
                "Properties set via setPropValuesFromCatalog()",
                "Script skips Dialog",
                "User selects Openings (if interactive) or processes pre-selection"
              ]
            }
          },
          {
            "condition": "Spatial Overlap Check (Opening vs Header)",
            "path1": {
              "name": "Overlap Detected",
              "steps": [
                "Dot product check confirms opening is within beam length",
                "Beam added to modification list",
                "Beam Profile/Material is updated"
              ]
            },
            "path2": {
              "name": "No Overlap",
              "steps": [
                "Dot product check confirms opening is outside beam range",
                "Beam skipped (ignored)",
                "No changes to this beam"
              ]
            }
          },
          {
            "condition": "Configuration: Material Name",
            "path1": {
              "name": "Provided",
              "steps": [
                "sMaterialName string is not empty",
                "bmHeader.setMaterial() is executed"
              ]
            },
            "path2": {
              "name": "Empty",
              "steps": [
                "sMaterialName is empty string",
                "Beam retains existing material"
              ]
            }
          },
          {
            "condition": "Configuration: Copy Profile Name",
            "path1": {
              "name": "To Information Field",
              "steps": [
                "sCopyProfileNameToField == '|Information|'",
                "bmHeader.setInformation(sExtrusionProfileName) is executed"
              ]
            },
            "path2": {
              "name": "Do Not Copy",
              "steps": [
                "sCopyProfileNameToField != '|Information|'",
                "Beam Information field is left unchanged"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Silent)",
            "recovery": "Script executes eraseInstance() if count > 1 to prevent recursive execution loops."
          },
          {
            "check": "Entity Attachment (_Entity array)",
            "errorMessage": "None (Silent)",
            "recovery": "Script executes eraseInstance() if _Entity.length() == 0. Ensures satellite instances are attached to an object."
          },
          {
            "check": "OpeningSF Validity",
            "errorMessage": "None (Silent)",
            "recovery": "Script executes eraseInstance() if the cast to OpeningSF fails or bIsValid() returns false."
          },
          {
            "check": "Parent Element Validity",
            "errorMessage": "None (Silent)",
            "recovery": "Script executes eraseInstance() if the OpeningSF has no valid parent Element (Wall)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Script Self-Deletion",
            "how": "Automatic (Internal Logic)",
            "effect": "The TSL instance removes itself from the model immediately after modifying the beams. No editable script remains in the drawing."
          },
          {
            "action": "Direct Beam Modification",
            "how": "Result of Script Execution",
            "effect": "The Header beams in the wall are permanently modified with the new Profile and Material until manually changed again."
          }
        ]
      },
      "tokens_used": 7265,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_W-ProfiledHeader.mcr\n\n## Overview\nThis utility allows you to batch modify the cross-section profiles and material properties of header beams located above wall openings. It is useful for replacing standard rectangular headers with specific profiled sections (e.g., glulams) and updating material grades for multiple openings at once.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D model elements. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Not designed for 2D detailing views. |\n\n## Prerequisites\n- **Required Entities**: Wall openings (`OpeningSF`) must exist in the model.\n- **Parent Elements**: The selected openings must belong to a Wall (`Element`) that contains existing Header beams.\n- **Minimum Beam Count**: Existing header beams must be present above the openings to be modified.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Browse to and select `HSB_W-ProfiledHeader.mcr`.\n\n### Step 2: Configure Properties\n1.  Upon insertion, a dialog or the Properties Palette will appear displaying the script parameters.\n2.  **Extrusion profile name**: Select the desired cross-section shape (e.g., Rectangular, Round, or custom profiles) from the dropdown list.\n3.  **Material**: Enter the material name (e.g., C24, GL24h) to apply. *Leave this blank to keep the beam's current material.*\n4.  **Copy profile name to**: Choose whether to save the selected profile name into the beam's \"Information\" field for reporting.\n5.  Press **Enter** or click **OK** to confirm settings.\n\n### Step 3: Select Openings\n```\nCommand Line: Select one or more openings\nAction: Click on individual wall openings or drag a window to select multiple openings in the model.\n```\n\n### Step 4: Completion\nThe script will process the selected openings, identify the associated header beams, and apply the new profile and material settings. The script instance will automatically delete itself from the drawing once finished.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Extrusion profile name** | Dropdown | Rectangular | Select the specific cross-sectional shape to apply to the header beams. |\n| **Material** | Text | (Empty) | The timber grade or species to assign. If left empty, the existing material is preserved. |\n| **Copy profile name to** | Dropdown | Do not copy | Select \"Information\" to automatically write the profile name into the beam's Information field. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script runs immediately upon insertion and does not remain in the drawing to offer context menu options. |\n\n## Settings Files\n- **None**: This script does not rely on external settings or XML files for configuration.\n\n## Tips\n- **Batch Processing**: You can select multiple wall openings in a single step to update all headers in a wall or floor plan efficiently.\n- **Material Preservation**: If you only want to change the shape (profile) of the headers but keep the current material, ensure the **Material** field is left empty.\n- **Verification**: Since the script deletes itself automatically, use the AutoCAD `UNDO` command immediately after execution if the results are not as expected.\n\n## FAQ\n- **Q: I ran the script, but it disappeared and didn't seem to do anything.**\n  - **A**: Ensure you selected valid `OpeningSF` entities that actually have Header beams associated with them. If the opening has no header above it, the script will find nothing to modify.\n- **Q: Can I use this to edit beams other than headers?**\n  - **A**: No, this script specifically searches for and modifies only the beams identified as `_kHeader` type within the parent wall element.\n- **Q: How do I change the headers back to the original shape?**\n  - **A**: Run the script again, select the original profile (e.g., Rectangular) and the original dimensions, and select the same openings. Alternatively, use the standard AutoCAD `UNDO` command if the change was recent."
      },
      "tokens_used": 5505,
      "error": null
    }
  }
}