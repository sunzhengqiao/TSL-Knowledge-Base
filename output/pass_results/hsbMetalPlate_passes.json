{
  "filename": "hsbMetalPlate.mcr",
  "status": "completed",
  "total_tokens": 51577,
  "processing_time": 244.56219100952148,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "12.05.2021",
            "author": "Marsel Nakuci",
            "changes": "HSB-11670: initial"
          }
        ],
        "settingsFiles": [
          "MetalPlateCatalog.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 7372,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script does not use 'sd_' prefix, '_Viewport', or '_kPaperSpace'. It creates 3D geometry using 'Body' and 'PlaneProfile', and attaches 'HardWrComp' to 'GenBeam' entities, which is typical for model detailing."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "MetalPlateCatalog.xml"
          ]
        }
      },
      "tokens_used": 6819,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select Genbeams|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sManufacturer",
            "type": "PropString",
            "displayName": "|Manufacturer|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "---",
              "..."
            ],
            "category": "|Component|",
            "description": "|Defines the Manufacturer|"
          },
          {
            "index": 1,
            "variable": "sFamily",
            "type": "PropString",
            "displayName": "|Family|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Component|",
            "description": "|Defines the Family|"
          },
          {
            "index": 2,
            "variable": "sProduct",
            "type": "PropString",
            "displayName": "|Product|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Component|",
            "description": "|Defines the Product|"
          },
          {
            "index": 3,
            "variable": "sModeInsert",
            "type": "PropString",
            "displayName": "|Mode|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|Single|",
              "|Multiple|"
            ],
            "category": "|Insertion Mode|",
            "description": "|Defines the ModeInsert|"
          },
          {
            "index": 4,
            "variable": "sFace",
            "type": "PropString",
            "displayName": "|Face|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|View Direction|",
              "|Normal to View Direction|",
              "|All|"
            ],
            "category": "|Alignment|",
            "description": "|Defines the Face|"
          },
          {
            "index": 5,
            "variable": "sSide",
            "type": "PropString",
            "displayName": "|Side|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|One|",
              "|Both|"
            ],
            "category": "|Alignment|",
            "description": "|Defines the Side|"
          },
          {
            "index": 0,
            "variable": "dOffsetLength",
            "type": "PropDouble",
            "displayName": "|Offset Length|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Alignment|",
            "description": "|Defines the OffsetLength|"
          },
          {
            "index": 1,
            "variable": "dOffsetWidth",
            "type": "PropDouble",
            "displayName": "|Offset Width|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Alignment|",
            "description": "|Defines the OffsetWidth|"
          },
          {
            "index": 2,
            "variable": "dRotate",
            "type": "PropDouble",
            "displayName": "|Rotate|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Alignment|",
            "description": "|Defines the Rotate|"
          },
          {
            "index": 4,
            "variable": "sType",
            "type": "PropString",
            "displayName": "|Type|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|2 Genbeams|",
              "|3 Genbeams|"
            ],
            "category": "|Component|",
            "description": "|Defines the Type|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Swap Side|",
            "handler": "|Swap Side|",
            "action": "Flips the insertion side of the metal plate relative to the beam geometry.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "MetalPlateCatalog.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings"
            ],
            "purpose": "Provides the catalog of metal plate definitions including Manufacturers, Families, Products, and dimensions.",
            "required": true
          }
        ]
      },
      "tokens_used": 9160,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates and inserts metal connection plates (splines) at the intersections of 2 or 3 timber beams, generating both the 3D geometry and the BOM hardware entries.",
          "category": "Hardware/Connectors",
          "typicalUseCase": "Inserting standardized metal plates (e.g., from manufacturers like Simpson or Meko) to reinforce joints between timber beams in a 3D model."
        },
        "parameters": [
          {
            "name": "sManufacturer",
            "technicalDefault": "---",
            "businessMeaning": "Selects the manufacturer of the metal plate. This filters the available products in the catalog.",
            "validRange": "List of manufacturers defined in MetalPlateCatalog.xml",
            "unit": "String",
            "affectsOutput": "Updates the 'Manufacturer' field in the BOM and filters the 'Family' dropdown options."
          },
          {
            "name": "sFamily",
            "technicalDefault": "",
            "businessMeaning": "Selects the product family or series within the chosen manufacturer.",
            "validRange": "List of families defined in MetalPlateCatalog.xml for the selected manufacturer",
            "unit": "String",
            "affectsOutput": "Filters the 'Product' dropdown options."
          },
          {
            "name": "sProduct",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific plate model. This selection determines the physical dimensions (Length, Width, Thickness) of the plate.",
            "validRange": "List of products defined in MetalPlateCatalog.xml for the selected family",
            "unit": "String",
            "affectsOutput": "Directly controls the size and thickness of the 3D plate geometry and the model number in the BOM."
          },
          {
            "name": "sModeInsert",
            "technicalDefault": "|Single|",
            "businessMeaning": "Defines whether the tool inserts a plate at a single intersection or processes multiple valid intersections found in the selection set.",
            "validRange": "|Single|, |Multiple|",
            "unit": "Enum",
            "affectsOutput": "In 'Multiple' mode, the script iterates through the selection to find all valid joints and creates plates at each. In 'Single' mode, it creates only one."
          },
          {
            "name": "sFace",
            "technicalDefault": "|View Direction|",
            "businessMeaning": "Determines the orientation of the plate relative to the user's current camera view. Allows placing the plate on the near side, far side, or all sides of the joint.",
            "validRange": "|View Direction|, |Normal to View Direction|, |All|",
            "unit": "Enum",
            "affectsOutput": "Controls the coordinate system and placement plane of the plate geometry."
          },
          {
            "name": "sSide",
            "technicalDefault": "|One|",
            "businessMeaning": "Specifies whether to place a single plate or double plates (one on each side of the beams) to sandwich the joint.",
            "validRange": "|One|, |Both|",
            "unit": "Enum",
            "affectsOutput": "If 'Both', creates two mirrored plate bodies and doubles the quantity in the BOM."
          },
          {
            "name": "dOffsetLength",
            "technicalDefault": "0",
            "businessMeaning": "Slides the plate along its primary longitudinal axis relative to the joint center.",
            "validRange": "-200 to 200 mm (typical adjustment range)",
            "unit": "mm",
            "affectsOutput": "Shifts the 3D position of the plate along its length."
          },
          {
            "name": "dOffsetWidth",
            "technicalDefault": "0",
            "businessMeaning": "Slides the plate along its secondary (width) axis relative to the joint center.",
            "validRange": "-200 to 200 mm (typical adjustment range)",
            "unit": "mm",
            "affectsOutput": "Shifts the 3D position of the plate along its width."
          },
          {
            "name": "dRotate",
            "technicalDefault": "0",
            "businessMeaning": "Rotates the plate around its normal vector (the axis perpendicular to the plate face).",
            "validRange": "-180 to 180 degrees",
            "unit": "degrees",
            "affectsOutput": "Rotates the plate geometry within the placement plane."
          },
          {
            "name": "sType",
            "technicalDefault": "|2 Genbeams|",
            "businessMeaning": "Defines the joint topology being connected—either a 2-beam connection (corner, splice) or a 3-beam connection (T-junction or intersection).",
            "validRange": "|2 Genbeams|, |3 Genbeams|",
            "unit": "Enum",
            "affectsOutput": "Changes the geometric calculation logic to determine the correct intersection plane and orientation for the plate."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing sManufacturer",
            "effect": "Updates the sFamily list with values associated with the new manufacturer.",
            "cascade": [
              "sFamily"
            ]
          },
          {
            "trigger": "Changing sFamily",
            "effect": "Updates the sProduct list with values associated with the new family.",
            "cascade": [
              "sProduct"
            ]
          },
          {
            "trigger": "Changing sProduct",
            "effect": "Reads dimensions (Length, Width, Thickness) from the XML catalog.",
            "cascade": [
              "Geometry Generation"
            ]
          },
          {
            "trigger": "Executing 'Swap Side' context menu",
            "effect": "Flips the plate to the opposite side of the joint by inverting the plane vector and offsets.",
            "cascade": [
              "sSide",
              "Geometry Orientation"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body",
            "description": "A 3D solid representation of the metal plate, positioned at the beam intersection.",
            "appliedTo": "Model Space (visual representation)"
          },
          {
            "type": "HardWrComp",
            "description": "A hardware component entry for BOM/CAM output. Includes Manufacturer, Model, Material, and Quantity (x1 or x2).",
            "appliedTo": "Element/GenBeam (BOM attachment)"
          }
        ]
      },
      "tokens_used": 9978,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Load units, constants, and debug maps.",
          "2. Settings Loading: Search for 'MetalPlateCatalog.xml' in Company or Install paths and load into mapSetting.",
          "3. Data Validation: Verify Manufacturer data exists in the XML. If missing, report error and delete instance.",
          "4. Property Declaration: Define and populate OPM properties (Manufacturer, Family, Product, Type, Face, Side, Offsets).",
          "5. User Selection (Insert Mode): Prompt user to select GenBeams (2 or 3 depending on Type).",
          "6. Intersection Calculation: Analyze selected beams to find valid intersection planes/couples.",
          "7. Dynamic Preview (Jig): Display potential plate locations dynamically. Highlight intersection under cursor.",
          "8. User Confirmation: User clicks to select a specific intersection.",
          "9. Geometry Generation: Calculate coordinates based on Face/Side settings, create Plate Body, and apply Offsets/Rotation.",
          "10. Hardware Generation: Create HardWrComp entry for BOM with Manufacturer, Model, and Material."
        ],
        "conditionalBranches": [
          {
            "condition": "User selects different 'sManufacturer'",
            "path1": {
              "name": "Filter Families",
              "steps": [
                "Read available Families from XML for the selected Manufacturer.",
                "Update 'sFamily' property options."
              ]
            }
          },
          {
            "condition": "User selects different 'sFamily'",
            "path1": {
              "name": "Filter Products",
              "steps": [
                "Read available Products from XML for the selected Family.",
                "Update 'sProduct' property options."
              ]
            }
          },
          {
            "condition": "Value of 'sSide' (One vs Both)",
            "path1": {
              "name": "One",
              "steps": [
                "Calculate single insertion plane.",
                "Create one 3D Body.",
                "Set Hardware Quantity to 1."
              ]
            },
            "path2": {
              "name": "Both",
              "steps": [
                "Calculate two mirrored insertion planes.",
                "Create two 3D Bodies (sandwiching the beams).",
                "Set Hardware Quantity to 2."
              ]
            }
          },
          {
            "condition": "Context Menu 'Swap Side' executed",
            "path1": {
              "name": "Execute Swap",
              "steps": [
                "Invert the plane vector (vecPlaneMap).",
                "Negate Rotate and Offset Length values.",
                "Trigger geometry regeneration."
              ]
            }
          },
          {
            "condition": "Insertion Mode (Single vs Multiple)",
            "path1": {
              "name": "Single",
              "steps": [
                "Run Jig to let user pick one specific intersection.",
                "Generate one plate instance."
              ]
            },
            "path2": {
              "name": "Multiple",
              "steps": [
                "Iterate through all found valid couples.",
                "Generate plate at every valid intersection (Logic inferred from standard patterns, though snippet highlights Jig interaction)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of Manufacturer data in XML",
            "errorMessage": "Could not find manufacturer data. Tool will be deleted.",
            "recovery": "Ensure 'MetalPlateCatalog.xml' is present in the correct folder and contains valid entries."
          },
          {
            "check": "Valid Beam Intersection Geometry",
            "errorMessage": "Beams not OK",
            "recovery": "Select GenBeams that physically intersect or align correctly for the chosen Type (2 or 3 Genbeams)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Plate Dimensions/Model",
            "how": "OPM Properties (Manufacturer, Family, Product)",
            "effect": "Re-reads dimensions from XML, regenerates Body size and thickness, updates BOM model number."
          },
          {
            "action": "Adjust Position/Orientation",
            "how": "OPM Properties (Offset Length, Offset Width, Rotate, Face)",
            "effect": "Transforms the existing Body coordinate system (translation and rotation)."
          },
          {
            "action": "Flip Plate Side",
            "how": "Right-click Context Menu -> Swap Side",
            "effect": "Mirrors the plate to the opposite side of the joint vectors."
          }
        ]
      },
      "tokens_used": 11813,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbMetalPlate.mcr\n\n## Overview\nThis script creates and inserts standardized metal connection plates (splines) at the intersections of 2 or 3 timber beams. It automatically generates the 3D geometry of the plate and adds the hardware data to the Bill of Materials (BOM).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model to create physical connections. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | The geometry is created in the model, not directly on drawings. |\n\n## Prerequisites\n- **Required Entities**: GenBeams (Timber beams).\n- **Minimum Beam Count**: 2 (or 3, depending on the Type setting).\n- **Required Settings**: `MetalPlateCatalog.xml` must exist in the company or install settings folder.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsbMetalPlate.mcr`\n\n### Step 2: Select Beams\n```\nCommand Line: Select Genbeams\nAction: Select the timber beams you wish to connect (e.g., select 2 beams for a corner joint or 3 for a T-junction). Press Enter to confirm selection.\n```\n\n### Step 3: Place Plate\n```\nAction: Move your cursor over the intersection of the selected beams.\n- The script will highlight valid intersection points dynamically.\n- Click once to select the specific intersection point where you want the plate placed.\n```\n\n### Step 4: Adjust Properties\n```\nAction: With the plate selected, open the Properties Palette (Ctrl+1).\n- Select the **Manufacturer** (e.g., Simpson, Meko).\n- Select the **Family** and **Product** (this sets the physical size of the plate).\n- Adjust alignment (Face, Side) or offsets if needed.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Manufacturer | dropdown | --- | Selects the plate manufacturer. Updates the available families. |\n| Family | dropdown/text | | Selects the product series (updates available products). |\n| Product | dropdown/text | | Selects the specific plate model. Determines geometry size and thickness. |\n| Mode | dropdown | Single | Choose between inserting at one intersection (`Single`) or all found valid intersections (`Multiple`). |\n| Face | dropdown | View Direction | Sets the orientation relative to your current view (View Direction, Normal to View, All). |\n| Side | dropdown | One | Sets whether to insert one plate (`One`) or two plates sandwiching the joint (`Both`). |\n| Type | dropdown | 2 Genbeams | Defines the joint topology: connection of 2 beams or 3 beams. |\n| Offset Length | number | 0 | Shifts the plate along its length axis relative to the joint center. |\n| Offset Width | number | 0 | Shifts the plate along its width axis relative to the joint center. |\n| Rotate | number | 0 | Rotates the plate on the plane (degrees). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Swap Side | Flips the metal plate to the opposite side of the joint. |\n\n## Settings Files\n- **Filename**: `MetalPlateCatalog.xml`\n- **Location**: `_kPathHsbCompany\\TSL\\Settings` or `_kPathHsbInstall\\Content\\General\\TSL\\Settings`\n- **Purpose**: Defines the library of available metal plates, including dimensions, thicknesses, and manufacturer details.\n\n## Tips\n- **Dynamic Updates**: After insertion, you can change the Product in the properties palette to resize the plate without deleting and re-running the script.\n- **Fine-tuning**: Use the Offset Length and Offset Width properties to slide the plate into the exact position without moving the script itself.\n- **Visual Confirmation**: If the plate appears on the \"back\" side of the beam, use the **Swap Side** right-click option to flip it to the front.\n- **Catalog Management**: If the Manufacturer dropdown is empty, check your `MetalPlateCatalog.xml` file location.\n\n## FAQ\n- **Q: Why did the script delete itself immediately after I selected the beams?**\n  A: This usually happens if the `MetalPlateCatalog.xml` file is missing or cannot be found. Ensure the settings file is in the correct directory.\n- **Q: Can I use this for non-standard intersection angles?**\n  A: Yes, the script calculates the intersection plane based on the actual geometry of the selected beams, but you may need to use the Rotate property to align specific plate shapes.\n- **Q: How do I insert a plate on both sides of the beams automatically?**\n  A: Set the **Side** property to `Both` in the Properties Palette before or after insertion."
      },
      "tokens_used": 6435,
      "error": null
    }
  }
}