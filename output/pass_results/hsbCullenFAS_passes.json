{
  "filename": "hsbCullenFAS.mcr",
  "status": "completed",
  "total_tokens": 52352,
  "processing_time": 371.82598781585693,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.7",
            "date": "25/06/2024",
            "author": "Marsel Nakuci",
            "changes": "HSB-20923: Add property text size; fix position of bracket; allow manual or automatic assignment (global); show qty in plan view"
          },
          {
            "version": "1.6",
            "date": "04feb20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435: enable rotate180 of second leg when attached at only 1 beam"
          },
          {
            "version": "1.5",
            "date": "29.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435: change the favored position in Mode 0"
          },
          {
            "version": "1.4",
            "date": "29.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435: hardware export"
          },
          {
            "version": "1.3",
            "date": "23.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435: add a default favorite direction for Mode=0"
          },
          {
            "version": "1.2",
            "date": "23.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435: make sure there are always map values for iside, ifold, ifold1"
          },
          {
            "version": "1.1",
            "date": "30.09.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435: working version"
          },
          {
            "version": "1.0",
            "date": "27.09.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435:initial"
          }
        ],
        "settingsFiles": [
          "hsbCullenFAS.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 9413,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates 3D geometry using 'Body', utilizes 'Display' for visualization, and references '_kModelSpace' in entity collection. It includes hardware export logic ('HardWrComp'). No 'sd_' prefix, '_Viewport', '#Type E', or '_kPaperSpace' indicators are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D environment)",
          "requiredSettings": [
            "hsbCullenFAS.xml"
          ]
        }
      },
      "tokens_used": 7556,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sGroupAssignment",
            "type": "PropString",
            "displayName": "|Group Assignment|",
            "defaultValue": "<|Default|>",
            "inputType": "dropdown",
            "options": [
              "<|Default|>",
              "|No group assigment|"
            ],
            "category": "|General|",
            "description": "|Defines to layer to assign the instance|, <|Default|> = |byEntity|",
            "condition": "DialogMode == 4"
          },
          {
            "index": 0,
            "variable": "dTextHeight",
            "type": "PropDouble",
            "displayName": "|Text Height|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|Display|",
            "description": "|Defines the Text Height|",
            "condition": "DialogMode != 4"
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "hsbCullenFAS.xml",
            "searchPaths": [
              "[Company]\\TSL\\Settings\\hsbCullenFAS.xml",
              "[Install]\\Content\\General\\TSL\\Settings\\hsbCullenFAS.xml"
            ],
            "purpose": "Provides global settings, group assignments, and default values for the TSL instance.",
            "required": false
          }
        ]
      },
      "tokens_used": 10246,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates the 3D geometry and hardware data for a Cullen FAS Framing Anchor, typically used to connect timber elements (e.g., joist to bearer).",
          "category": "Hardware/Connector",
          "typicalUseCase": "Inserting a connection bracket at the edge of a single beam or at the intersection of two beams, ensuring correct BOM export for the bracket and its associated nails."
        },
        "parameters": [
          {
            "name": "sGroupAssignment",
            "technicalDefault": "<|Default|>",
            "businessMeaning": "Specifies the CAD Layer or Group the connector instance is assigned to for model organization. '<|Default|>' assigns the instance to the same layer as the entity it is attached to (byEntity).",
            "validRange": "[\"<|Default|>\", \"|No group assigment|\"]",
            "unit": "String (Enum)",
            "affectsOutput": "Model organization and filtering in lists/views. Does not alter physical geometry."
          },
          {
            "name": "dTextHeight",
            "technicalDefault": "0",
            "businessMeaning": "Controls the size of the text label ('FAS' or 'FAS x Qty') displayed in the 3D model view. A value of 0 uses the system default text size.",
            "validRange": "0 (Default) or >0 (e.g., 10mm - 100mm depending on drawing scale)",
            "unit": "mm",
            "affectsOutput": "Visual size of the product annotation in the model."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "DialogMode == 4",
            "effect": "Hides Display properties and shows Global Settings properties (Group Assignment).",
            "cascade": [
              "sGroupAssignment",
              "dTextHeight"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Body (Steel Plate)",
            "description": "Creates the physical geometry of the Cullen FAS bracket, including folded leg geometries if configured.",
            "appliedTo": "Selected GenBeam(s)"
          },
          {
            "type": "Hardware Component (HardWrComp)",
            "description": "Exports production data: 1x 'Framing Anchor' (Manufacturer: Cullen) and 18x 'Annular Ringshank Nails'.",
            "appliedTo": "Primary GenBeam"
          },
          {
            "type": "Text Label",
            "description": "Draws a text label indicating the product code and quantity (e.g., 'FAS x 2') in the model.",
            "appliedTo": "Model Space"
          }
        ]
      },
      "tokens_used": 9845,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Load settings from 'hsbCullenFAS.xml' (Company or General path). Create MapObject if missing.",
          "2. Dialog Mode Check: Determine if properties are being set in OPM (DialogMode==4) or if geometry generation is required.",
          "3. Entity Acquisition: Identify the GenBeam(s) involved. (Typically 1 or 2 beams defined by the insertion context).",
          "4. Geometric Calculation: Calculate the insertion point (_Pt0), coordinate system (vec0, vec1, vDir), and rotation based on beam geometry and intersections.",
          "5. Quantity Assessment: Check for other 'hsbCullenFAS' instances attached to the same beam(s) to determine the total quantity and identify if the current instance is the 'First' to draw text.",
          "6. 3D Geometry Generation: Create the main plate body using PLine operations. Generate folded legs based on 'iFold' properties (0 = flat, -1/1 = folded directions). Apply rotation if 'iRotate180' is active.",
          "7. Visualization: Draw the 3D body. If the instance is 'First', draw the text label ('FAS' or 'FAS x Qty') at the calculated location.",
          "8. Hardware Export: Clear old TSL hardware components. Create new HardWrComp entries for 1x 'Framing Anchor' and 18x 'Annular Ringshank Nails'. Assign to Element or Group.",
          "9. Completion: Finalize script execution and update OPM if necessary."
        ],
        "conditionalBranches": [
          {
            "condition": "Number of GenBeams selected",
            "path1": {
              "name": "Single Beam Connection",
              "steps": [
                "Quantity set to 1 immediately.",
                "Text label forced to 'FAS'.",
                "Geometry placed at the selected edge of the single beam."
              ]
            },
            "path2": {
              "name": "Dual Beam Connection",
              "steps": [
                "Script scans ModelSpace for other 'hsbCullenFAS' instances attached to the same pair of beams.",
                "Calculates total quantity of brackets connecting these specific beams.",
                "Identifies the 'first' instance (lowest handle) to handle the text label.",
                "Text label shows 'FAS x [TotalQty]'."
              ]
            }
          },
          {
            "condition": "Leg Fold State (iFold1)",
            "path1": {
              "name": "Unfolded (iFold1 == 0)",
              "steps": [
                "Leg geometry is drawn flat relative to the main plate.",
                "No thickness offset logic for folding applied."
              ]
            },
            "path2": {
              "name": "Folded (iFold1 == -1 or 1)",
              "steps": [
                "Leg geometry is rotated 90 degrees.",
                "Vertex points are adjusted by material thickness to ensure correct physical overlap.",
                "Direction of fold (positive or negative) determined by iFold1 value."
              ]
            }
          },
          {
            "condition": "Settings File Availability",
            "path1": {
              "name": "File Found",
              "steps": [
                "Settings loaded from XML.",
                "MapObject created in dictionary for persistence.",
                "Global parameters (like GroupAssignment) applied."
              ]
            },
            "path2": {
              "name": "File Not Found",
              "steps": [
                "Script checks Company path, then General Install path.",
                "If neither found, script proceeds with hardcoded defaults.",
                "ReportNotice issued if version mismatch occurs during DB creation."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Valid GenBeam Entity",
            "errorMessage": "Script requires a valid GenBeam to generate geometry.",
            "recovery": "Ensure a beam is selected before insertion or that the TSL is linked to a valid beam entity."
          },
          {
            "check": "Settings Version",
            "errorMessage": "Notice displayed if XML version differs from MapObject version.",
            "recovery": "Update settings XML or MapObject manually if required, otherwise script continues."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Text Height",
            "how": "OPM (Object Properties Manager)",
            "effect": "Resizes the 'FAS' text label in the 3D model."
          },
          {
            "action": "Fold/Unfold Legs",
            "how": "Custom Commands (implied by 'custom command Fold leg 1' in summary, likely via OPM integer properties or context menu triggers if defined, though specific triggers not visible in this snippet, properties 'iFold' exist)",
            "effect": "Changes the geometry of leg 1/2 from flat to perpendicular (folded)."
          },
          {
            "action": "Rotate 180 degrees",
            "how": "OPM Property (iRotate180)",
            "effect": "Flips the generated bracket geometry 180 degrees around its axis."
          },
          {
            "action": "Modify Group Assignment",
            "how": "OPM (DialogMode 4)",
            "effect": "Changes the layer/group the hardware and instance are assigned to."
          }
        ]
      },
      "tokens_used": 9391,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCullenFAS.mcr\n\n## Overview\nGenerates the 3D geometry and production data for a Cullen FAS Framing Anchor. This script automates the placement of the bracket and associated nails (18x Annular Ringshank Nails) to connect timber elements (beams).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script creates 3D bodies and hardware data. |\n| Paper Space | No | Not designed for 2D layout or detailing views. |\n| Shop Drawing | No | Does not generate shop drawing annotations directly. |\n\n## Prerequisites\n- **Required Entities**: At least one `GenBeam` (Timber Beam).\n- **Minimum Beam Count**: 1 (Supports connections between 1 or 2 beams).\n- **Required Settings**: `hsbCullenFAS.xml` (Optional; if missing, the script uses internal defaults).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `hsbCullenFAS.mcr` from the list.\n\n### Step 2: Select Beam(s)\n```\nCommand Line: Select beam(s):\nAction: Click the primary beam you wish to attach the bracket to.\n```\n*(Note: If connecting two beams at an intersection, select the secondary beam as well, or position the script at the intersection point depending on your standard hsbCAD input settings.)*\n\n### Step 3: Configuration & Placement\nThe script will automatically calculate the insertion point based on the beam geometry.\n- If attached to a single beam, it defaults to the favored position (usually the end or edge).\n- If attached to two beams, it calculates the intersection.\n- The 3D bracket and text label will appear immediately.\n\n### Step 4: Modify Properties (Optional)\nSelect the inserted instance and open the **Properties Palette** to adjust parameters like Text Height or Group Assignment.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Group Assignment** | dropdown | `<Default>` | Determines the CAD Layer/Group for the instance. `<Default>` assigns it to the same layer as the beam it is attached to. *(Visible in Global Configuration Mode)* |\n| **Text Height** | number | `0` | Controls the size of the text label (e.g., \"FAS\") in the model view. A value of `0` uses the system default text size. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None Detected* | This script does not currently expose custom actions via the right-click context menu. Modify properties via the Properties Palette. |\n\n## Settings Files\n- **Filename**: `hsbCullenFAS.xml`\n- **Location**: Searches first in `[Company]\\TSL\\Settings\\`, then `[Install]\\Content\\General\\TSL\\Settings\\`.\n- **Purpose**: Stores global settings, default group assignments, and configuration values for the script.\n\n## Tips\n- **Quantity Labeling**: When connecting two beams, the script scans for other brackets of the same type between those specific beams. It sums the quantity and displays it (e.g., \"FAS x 2\"). Only the \"first\" bracket (lowest handle ID) displays the text to avoid clutter.\n- **Hardware Export**: The script automatically exports production data for **1x Framing Anchor** and **18x Annular Ringshank Nails** to the BOM/CNC lists.\n- **Text Visibility**: If the text label is too small or large to read in the model view, select the bracket and change the `Text Height` property in the Properties Palette.\n\n## FAQ\n- **Q: My bracket is placed on the wrong layer.**\n  - A: Select the bracket and change the `Group Assignment` property in the Properties Palette from `<Default>` to the specific layer you require.\n- **Q: What does \"Text Height 0\" mean?**\n  - A: It tells the script to use the standard system text size defined in your hsbCAD/AutoCAD settings rather than a custom size.\n- **Q: Can I rotate the bracket 180 degrees?**\n  - A: Yes, though the specific property depends on the script version loaded. Check the Properties Palette for geometric integer properties (often named `iRotate`) or use the hsbCAD move/rotate commands if the specific property is not exposed in your version."
      },
      "tokens_used": 5901,
      "error": null
    }
  }
}