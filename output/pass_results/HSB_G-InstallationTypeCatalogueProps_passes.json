{
  "filename": "HSB_G-InstallationTypeCatalogueProps.mcr",
  "status": "completed",
  "total_tokens": 27653,
  "processing_time": 364.9049859046936,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "17.06.2014",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "05.11.2014",
            "author": "AS",
            "changes": "Add Id. (FogBugzId 467)"
          }
        ],
        "settingsFiles": [
          "HSB-InstallationTypeCatalogue.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 4376,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No sd_* prefix, no #Type E declarations, no viewport checks. The script immediately erases the instance on insert (_bOnInsert) and handles XML map data logic using _Map, indicating it operates on data cataloging rather than geometry in specific spaces."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "ModelSpace (script immediately erases itself, likely run as a command to update properties/databases)",
          "requiredSettings": [
            "HSB-InstallationTypeCatalogue.xml (expected in _kPathHsbCompany\\Abbund)"
          ]
        }
      },
      "tokens_used": 1463,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sEntryName",
            "type": "PropString",
            "displayName": "Installation type",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "mode == 1 (Add)"
          },
          {
            "index": 0,
            "variable": "nColorIndex",
            "type": "PropInt",
            "displayName": "Color index",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "mode == 1 (Add)"
          },
          {
            "index": 0,
            "variable": "sEntryName",
            "type": "PropString",
            "displayName": "Installation type",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "Dynamic list from HSB-InstallationTypeCatalogue.xml"
            ],
            "category": null,
            "description": "mode == 2 (Select)"
          },
          {
            "index": 0,
            "variable": "sId",
            "type": "PropString",
            "displayName": "Id",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "mode == 3 (Edit) - Read Only"
          },
          {
            "index": 1,
            "variable": "sEntryName",
            "type": "PropString",
            "displayName": "Installation type",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "mode == 3 (Edit)"
          },
          {
            "index": 0,
            "variable": "nColorIndex",
            "type": "PropInt",
            "displayName": "Color index",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "mode == 3 (Edit)"
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "HSB-InstallationTypeCatalogue.xml",
            "searchPaths": [
              "_kPathHsbCompany\\Abbund"
            ],
            "purpose": "Provides the catalogue data (entries, types) used to populate the Installation type list in select mode.",
            "required": true
          }
        ]
      },
      "tokens_used": 5607,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "This script manages a catalog of installation types (categories for electrical/mechanical/service installations) within the hsbCAD environment, allowing users to add, select, or edit entries linked to specific color indices.",
          "category": "Data Management/Cataloguing",
          "typicalUseCase": "Used to define or select standardized installation categories (e.g., 'Electric/Socket', 'Water/Pipe') to ensure consistent labeling and coloring of installation elements within a timber construction model."
        },
        "parameters": [
          {
            "name": "sEntryName",
            "technicalDefault": "",
            "businessMeaning": "The display name or label for the installation type (e.g., 'Socket', 'Switch', 'Valve'), often combined with a broader category (e.g., 'Electricity/Socket').",
            "validRange": "String text, typically 'Category/SubCategory' format.",
            "unit": "text",
            "affectsOutput": "Updates the name/label in the external XML catalog file 'HSB-InstallationTypeCatalogue.xml'. Does not directly affect geometry, but affects data consistency for subsequent scripts or schedules."
          },
          {
            "name": "nColorIndex",
            "technicalDefault": -1,
            "businessMeaning": "The AutoCAD color index assigned to this installation type, used to visually distinguish different service types in the model.",
            "validRange": "0 to 255 (AutoCAD color index), or -1 for default/undefined.",
            "unit": "index",
            "affectsOutput": "Updates the color attribute in the XML catalog. Entities using this installation type may be displayed in this color."
          },
          {
            "name": "sId",
            "technicalDefault": "",
            "businessMeaning": "The unique identifier for the installation entry in the catalog.",
            "validRange": "Unique alphanumeric string (automatically generated or fixed).",
            "unit": "text",
            "affectsOutput": "Serves as the key for identifying the entry in the XML file. Read-only in edit mode to prevent breaking database links."
          },
          {
            "name": "mode",
            "technicalDefault": "0",
            "businessMeaning": "The operational state of the script, determining whether the user is adding a new type, selecting an existing one, or editing an existing entry.",
            "validRange": "1 (Add), 2 (Select), 3 (Edit)",
            "unit": "mode",
            "affectsOutput": "Switches the visible properties and validation logic (e.g., showing a dropdown list vs. a text input field)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "mode changes to 2 (Select)",
            "effect": "sEntryName input changes from text to a dropdown list populated by 'HSB-InstallationTypeCatalogue.xml'.",
            "cascade": [
              "sEntryName"
            ]
          },
          {
            "trigger": "mode changes to 3 (Edit)",
            "effect": "sId becomes visible and read-only. sEntryName acts as an editable field for the existing entry ID.",
            "cascade": [
              "sId",
              "sEntryName"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "XML Data Entry",
            "description": "Adds or updates nodes in the 'HSB-InstallationTypeCatalogue.xml' file located in the company folder.",
            "appliedTo": "Global catalog (not specific to individual beams, but available for use by other scripts)."
          }
        ]
      },
      "tokens_used": 3426,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution triggered (insertion or recalculation)",
          "Script checks _bOnInsert flag",
          "[Insertion Path] Script erases its own instance and returns immediately (no geometry created)",
          "[Recalculation Path] Script defines file paths for XML catalog (Company\\Abbund)",
          "Script retrieves 'Mode' value from _Map object (defaults to 0 if not found)",
          "[Mode 1: Add] Exposes 'sEntryName' (text input) and 'nColorIndex' properties to OPM",
          "[Mode 2: Select] Reads 'HSB-InstallationTypeCatalogue.xml' from file",
          "[Mode 2: Select] Iterates XML map to build array of 'Key/Type' strings for dropdown",
          "[Mode 2: Select] Exposes 'sEntryName' as a dropdown list property to OPM",
          "[Mode 3: Edit] Exposes 'sId' (Read-Only), 'sEntryName' (text input), and 'nColorIndex' to OPM"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution State: _bOnInsert flag status",
            "path1": {
              "name": "Insertion",
              "steps": [
                "EraseInstance() called",
                "Script terminates immediately",
                "No user input occurs at this stage"
              ]
            },
            "path2": {
              "name": "Recalculation/Properties Update",
              "steps": [
                "Proceed to mode determination",
                "Load XML configuration",
                "Expose properties based on mode"
              ]
            }
          },
          {
            "condition": "Operational Mode (determined by _Map 'Mode' key)",
            "path1": {
              "name": "Add New Type (Mode 1)",
              "steps": [
                "Initialize 'sEntryName' as text input",
                "Initialize 'nColorIndex' as integer input"
              ]
            },
            "path2": {
              "name": "Select Existing Type (Mode 2)",
              "steps": [
                "Check 'HSB-InstallationTypeCatalogue.xml' existence",
                "Parse XML nodes",
                "Construct dropdown list from 'Key/Type'",
                "Initialize 'sEntryName' as dropdown property"
              ]
            },
            "path3": {
              "name": "Edit Existing Type (Mode 3)",
              "steps": [
                "Initialize 'sId' property (Read Only)",
                "Initialize 'sEntryName' as text input",
                "Initialize 'nColorIndex' as integer input"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "File Read Access (Mode 2)",
            "errorMessage": "Implicit failure if 'HSB-InstallationTypeCatalogue.xml' is missing or corrupt",
            "recovery": "User must ensure XML file exists in _kPathHsbCompany\\Abbund folder"
          },
          {
            "check": "Data Structure (Mode 2)",
            "errorMessage": "Implicit failure if XML structure does not contain expected Maps",
            "recovery": "Administrator must validate XML schema matches script expectations (Key + 'Type' string)"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Installation Properties",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Updating 'sEntryName' or 'nColorIndex' writes changes to the linked _Map object (and potentially the XML file if write-back logic exists, though not shown in this snippet)."
          },
          {
            "action": "Change Script Mode",
            "how": "Update the underlying 'Mode' value in the script instance (likely via external tool or direct map manipulation)",
            "effect": "Switches the available input fields between Add/Select/Edit interfaces on next recalculation."
          }
        ]
      },
      "tokens_used": 4302,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-InstallationTypeCatalogueProps\n\n## Overview\nThis script manages the catalog of installation types (e.g., electrical sockets, water pipes) within the hsbCAD environment. It allows users to add, select, or edit installation categories and their associated color codes, which are stored in a central XML file for use by other scripts.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates here to manage data catalog settings. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities:** None.\n- **Minimum Beam Count:** 0.\n- **Required Settings Files:** \n  - `HSB-InstallationTypeCatalogue.xml` must be present in the company folder structure (usually `_kPathHsbCompany\\Abbund`).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT`\n**Action:** Select `HSB_G-InstallationTypeCatalogueProps.mcr` from the file list.\n\n### Step 2: Insert Script Instance\n```\nCommand Line: [Insertion Point]\nAction: Click a location in the Model Space to insert the script instance.\n```\n*Note: Upon insertion, the script may initialize and prepare the XML data link. Select the script instance after insertion to access its properties.*\n\n### Step 3: Configure Properties\n**Action:** With the script instance selected, open the **Properties Palette** (Ctrl+1).\n- Use the **Installation type** field to define or select a category.\n- Use the **Color index** to assign a visual color to the installation type.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Installation type | Dropdown / Text | \"\" | The name of the installation type (e.g., \"Electricity/Socket\"). In \"Select\" mode, this is a dropdown list populated from the XML catalog. In \"Add\" or \"Edit\" modes, this is a text input field. |\n| Color index | Number | -1 | The AutoCAD color index (0-255) assigned to the installation type. Use -1 for default/undefined. |\n| Id | Text (Read Only) | \"\" | The unique internal identifier for the entry. This is only visible in \"Edit\" mode and cannot be changed. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | No specific custom context menu items are added by this script. Configuration is done via the Properties Palette. |\n\n## Settings Files\n- **Filename**: `HSB-InstallationTypeCatalogue.xml`\n- **Location**: `\\\\_kPathHsbCompany\\Abbund` (Company Folder)\n- **Purpose**: Stores the catalog entries (IDs, Names, Color Indices) that define the available installation types for the project.\n\n## Tips\n- **XML Location:** Ensure the `HSB-InstallationTypeCatalogue.xml` file exists in your company's `Abbund` folder. If the file is missing, the dropdown lists for selection may be empty.\n- **Data Persistence:** Changes made to the properties (Name/Color) are typically written back to the XML file, ensuring the catalog is updated for all users/scripts accessing that file.\n- **Modes:** The script behavior (Adding vs. Selecting vs. Editing) is determined by internal logic (Mode) linked to the instance. You may see different input fields (Text vs. Dropdown) depending on the current mode of the instance.\n\n## FAQ\n- **Q: I cannot see a dropdown list for \"Installation type\".**\n  - A: The script might be in \"Add\" or \"Edit\" mode. Ensure the XML file exists and is correctly formatted. The dropdown only appears in \"Select\" mode (Mode 2).\n- **Q: Where is the installation data actually stored?**\n  - A: The data is stored in the `HSB-InstallationTypeCatalogue.xml` file, not inside the drawing file. This allows the catalog to be shared across multiple projects."
      },
      "tokens_used": 8479,
      "error": null
    }
  }
}