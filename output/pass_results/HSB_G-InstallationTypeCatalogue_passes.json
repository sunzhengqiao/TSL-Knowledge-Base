{
  "filename": "HSB_G-InstallationTypeCatalogue.mcr",
  "status": "completed",
  "total_tokens": 37575,
  "processing_time": 361.0998785495758,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 2,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "18.06.2013",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "28.03.2014",
            "author": "AS",
            "changes": "Add name"
          },
          {
            "version": "1.02",
            "date": "05.11.2014",
            "author": "AS",
            "changes": "Add Id. (FogBugzId 467)"
          }
        ],
        "settingsFiles": [
          "HSB-InstallationTypeCatalogue.xml"
        ],
        "dependencies": [
          "HSB_G-InstallationTypeCatalogueProps.mcr"
        ]
      },
      "tokens_used": 6270,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly uses _kModelSpace in TslInst.dbCreate() calls. It draws geometry using Display classes at the selected _Pt0 in the current coordinate system. No ShopDrawing specific prefixes (sd_*) or #Type E entities are present. No _Viewport usage found."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (requires a point selection for placement). Requires 'HSB-InstallationTypeCatalogue.xml' in the hsbCompany\\Abbund directory.",
          "requiredSettings": [
            "HSB-InstallationTypeCatalogue.xml",
            "HSB_G-InstallationTypeCatalogueProps.mcr"
          ]
        }
      },
      "tokens_used": 3610,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 7971,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Provides a user interface to create, edit, and visualize a catalogue of installation types (e.g., electrical sockets, plumbing fixtures), generating a schematic table in the model space.\",\n    \"category\": \"Catalog Management / Documentation\",\n    \"typicalUseCase\": \"Used by detailers to define standardized symbols and IDs for MEP installations and generate a legend/schedule sheet for shop drawings.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"dTxtHeight\",\n      \"technicalDefault\": \"U(50)\",\n      \"businessMeaning\": \"Controls the scale of the catalogue table, defining the height of the text characters which in turn scales the row heights and column widths.\",\n      \"validRange\": \"2.5mm - 100mm (depending on drawing scale and desired visibility)\",\n      \"unit\": \"Length (mm/inches depending on project units)\",\n      \"affectsOutput\": \"Resizes the entire drawn table. Increasing this value makes the legend larger and easier to read.\"\n    },\n    {\n      \"name\": \"sDimStyle\",\n      \"technicalDefault\": \"_DimStyles (System default)\",\n      \"businessMeaning\": \"Determines the font and text style used for the header and content within the catalogue table.\",\n      \"validRange\": \"Any Dimension Style defined in the current drawing\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"Changes the visual appearance (font) of the text labels in the table to match project drafting standards.\"\n    },\n    {\n      \"name\": \"_Pt0\",\n      \"technicalDefault\": \"User selected point\",\n      \"businessMeaning\": \"The anchor point (origin) where the top-left of the catalogue table is placed in the model.\",\n      \"validRange\": \"Any valid 3D coordinate in Model Space\",\n      \"unit\": \"Coordinates\",\n      \"affectsOutput\": \"Determines the physical location of the generated table in the drawing.\"\n    },\n    {\n      \"name\": \"sAddEntry\",\n      \"technicalDefault\": \"\\\"|Add an entry|\\\"\",\n      \"businessMeaning\": \"Context menu command to initiate the workflow for defining a new installation type, including its name, color, and geometric symbol.\",\n      \"validRange\": \"N/A (Trigger)\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"Launches the input dialogs, prompts for geometry selection, creates a new ID (e.g., A, B, AA), and updates the XML catalogue file.\"\n    },\n    {\n      \"name\": \"sEditEntry\",\n"
      },
      "tokens_used": 7551,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script (Command Run)",
          "2. Check Insert Cycle: If cycle > 1, erase instance and exit to prevent duplication.",
          "3. User Input: Prompt for insertion point (_Pt0) in Model Space.",
          "4. Load Data: Read 'HSB-InstallationTypeCatalogue.xml' into internal Map.",
          "5. Configuration Check: If _kExecuteKey is empty (initial insert), invoke property dialog (via sub-script in Mode 0/Default) for initial settings.",
          "6. Generation: Calculate geometry based on dTxtHeight and _Pt0, then draw the table header and rows.",
          "7. Iteration: Loop through loaded XML entries to draw ID, Type Name, Symbol geometry, and Color index.",
          "8. Finish: Instance remains in model space, displaying the catalogue."
        ],
        "conditionalBranches": [
          {
            "condition": "User triggers 'Add an entry' context menu",
            "path1": {
              "name": "Standard Add Workflow",
              "steps": [
                "Load XML catalogue into memory.",
                "Launch sub-script UI (Mode 1) to input Entry Name and Color.",
                "Generate unique ID (A-Z, then AA-ZZ) by checking existing keys.",
                "Validate ID: If calculated ID already exists, show warning and abort.",
                "Prompt user to select Polylines for symbol definition.",
                "Prompt user to select Reference Point for symbol alignment.",
                "Transform symbol geometry to World Origin relative to reference point.",
                "Update internal Map with new entry.",
                "Write updated Map to XML file.",
                "Recalculate script to refresh drawing."
              ]
            }
          },
          {
            "condition": "User triggers 'Edit an entry' or 'Remove an entry' context menu",
            "path1": {
              "name": "Selection Workflow",
              "steps": [
                "Load XML catalogue.",
                "Launch sub-script UI (Mode 2) displaying list of current ID/Names.",
                "User selects target entry from list.",
                "Parse selection string (format 'ID/Name').",
                "Locate entry index in internal Map."
              ]
            },
            "path2": {
              "name": "Execution: Remove",
              "steps": [
                "Remove entry from internal Map using key.",
                "Write changes to XML.",
                "Recalculate."
              ],
              "condition": "Trigger is 'Remove an entry'"
            },
            "path3": {
              "name": "Execution: Edit",
              "steps": [
                "Launch sub-script UI (Mode 3) pre-filled with current Name/Color.",
                "User modifies Name and/or Color.",
                "Prompt user to select NEW Polylines (optional selection).",
                "Prompt user to select NEW Reference Point.",
                "Transform new geometry to World Origin.",
                "Update internal Map with new data.",
                "Write changes to XML.",
                "Recalculate."
              ],
              "condition": "Trigger is 'Edit an entry'"
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Silent fail)",
            "recovery": "Script self-erases if insertCycleCount() > 1 to prevent multiple instances on regen."
          },
          {
            "check": "Unique ID Generation",
            "errorMessage": "The catalogue already contains an entry with this key. Use the edit option to adjust this entry.",
            "recovery": "Operation aborts. User must remove the conflicting ID or select a different action."
          },
          {
            "check": "Edit Selection Validity",
            "errorMessage": "None (Implicit check)",
            "recovery": "If entryIndex is -1 (not found), the script erases the instance and returns, preventing a crash."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Add Entry",
            "how": "Context Menu (Right-click) -> 'Add an entry'",
            "effect": "Opens dialog to define new installation type; prompts for geometry selection; updates XML catalogue and redraws the table."
          },
          {
            "action": "Edit Entry",
            "how": "Context Menu (Right-click) -> 'Edit an entry'",
            "effect": "Opens list selection to pick an item; allows changing name, color, and symbol geometry; updates XML and table."
          },
          {
            "action": "Remove Entry",
            "how": "Context Menu (Right-click) -> 'Remove an entry'",
            "effect": "Opens list selection; deletes the selected item from XML and removes row from table."
          },
          {
            "action": "Resize Table",
            "how": "Properties Palette (OPM) -> 'Text size' or 'Dimension style'",
            "effect": "Immediately recalculates and redraws the table at the new scale or font style."
          },
          {
            "action": "Relocate Table",
            "how": "Grip Edit / Move",
            "effect": "Standard AutoCAD move using the insertion point (_Pt0) as base handle."
          }
        ]
      },
      "tokens_used": 7323,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-InstallationTypeCatalogue.mcr\n\n## Overview\nThis script creates a dynamic catalogue (legend) of installation types, such as electrical sockets or plumbing fixtures, directly in Model Space. It allows you to define custom symbols and IDs, managing them via an XML file to generate standardized schedules for your drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script inserts the catalogue table at a selected 3D point. |\n| Paper Space | No | Not supported for layout insertion. |\n| Shop Drawing | No | This is a Model Space management tool. |\n\n## Prerequisites\n- **Required Entities**: None.\n- **Minimum Beam Count**: 0.\n- **Required Settings Files**:\n  - `HSB-InstallationTypeCatalogue.xml` (Located in `hsbCompany\\Abbund`)\n  - `HSB_G-InstallationTypeCatalogueProps.mcr` (Must be in the TSL search path)\n\n## Usage Steps\n\n### Step 1: Launch Script\n```\nCommand: TSLINSERT\nAction: Select 'HSB_G-InstallationTypeCatalogue.mcr' from the file list.\n```\n\n### Step 2: Define Insertion Point\n```\nCommand Line: Pick insertion point:\nAction: Click in the Model Space where you want the top-left corner of the catalogue table to appear.\n```\n\n### Step 3: Initial Configuration (First Run Only)\nIf this is the first time running the script, a property dialog may appear automatically to set default text styles. Otherwise, the table will generate immediately based on existing data in the XML file.\n\n### Step 4: Manage Catalogue Entries\nOnce inserted, use the Right-Click Context Menu on the script instance to Add, Edit, or Remove installation types.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Text size** | Number (Double) | U(50) | Controls the height of the text in the table. Changing this scales the entire table (row height, column width). |\n| **Dimension style** | String | _DimStyles | Determines the font and text style used for the table headers and content. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Add an entry** | Launches a workflow to create a new installation type. You will be prompted to enter a Name, select a Color, pick Polylines to act as the symbol, and pick a Reference Point for that symbol. |\n| **Edit an entry** | Opens a list of current entries. Selecting one allows you to modify its Name, Color, and Geometry (Symbol). |\n| **Remove an entry** | Opens a list of current entries. Selecting one permanently deletes it from the catalogue and the XML file. |\n\n## Settings Files\n- **Filename**: `HSB-InstallationTypeCatalogue.xml`\n- **Location**: `hsbCompany\\Abbund` directory.\n- **Purpose**: Stores the persistent list of installation types (IDs, Names, Colors, and Symbol Geometry) so the data is shared across the project.\n\n## Tips\n- **Scaling**: To make the legend readable on a specific plot scale, adjust the **Text size** property in the Properties Palette (Ctrl+1).\n- **Symbol Creation**: When adding a symbol, draw the representation (e.g., a circle with lines) using Polylines first. The script will ask you to select these geometry items to \"stamp\" them into the catalogue.\n- **Unique IDs**: The script automatically generates IDs (A, B, C... AA, AB...). If you encounter an ID conflict, check the XML file or use the Edit function to clean up old entries.\n\n## FAQ\n- **Q: Why does the table disappear when I move it?**\n  - **A**: Ensure you are selecting the script instance, not just the text lines. Use the insertion point grip to move the table safely.\n- **Q: How do I change the font of the table?**\n  - **A**: Change the **Dimension style** property in the Properties Palette to match your preferred text style (e.g., `Standard` or a custom TTF style).\n- **Q: Can I use this for electrical legends?**\n  - **A**: Yes, this script is designed specifically for creating MEP (Mechanical, Electrical, Plumbing) legends and symbol catalogues."
      },
      "tokens_used": 4850,
      "error": null
    }
  }
}