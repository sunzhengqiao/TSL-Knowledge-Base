{
  "filename": "MasterPanelClone.mcr",
  "status": "completed",
  "total_tokens": 32364,
  "processing_time": 166.5651867389679,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "09.11.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-17005 initial version of a masterpanel clone"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5069,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Entity collection uses '_kModelSpace'; 'dbCreate' invoked with 'int bForceModelSpace = true'; script creates 3D 'Body' geometry and draws in 3D using 'dp.draw(bd)'; no '_Viewport' or '_kPaperSpace' API usage."
        },
        "prerequisites": {
          "requiredEntities": [
            "MasterPanel"
          ],
          "minimumBeams": 1,
          "requiredSpace": "ModelSpace containing existing MasterPanel entities",
          "requiredSettings": []
        }
      },
      "tokens_used": 4311,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select entities|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sFormat",
            "type": "PropString",
            "displayName": "|Format|",
            "defaultValue": "@(Number)",
            "inputType": "text",
            "options": [],
            "category": "|General|",
            "description": "|Defines the format to display properties|"
          },
          {
            "index": 1,
            "variable": "nSolidColor",
            "type": "PropInt",
            "displayName": "|Color|",
            "defaultValue": 40,
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the Color of the solid|"
          },
          {
            "index": 2,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "|Text Color|",
            "defaultValue": 7,
            "inputType": "number",
            "options": [],
            "category": "|Display|",
            "description": "|Defines the Color|"
          },
          {
            "index": 3,
            "variable": "dTextHeight",
            "type": "PropDouble",
            "displayName": "|Text Height|",
            "defaultValue": "300 (mm)",
            "inputType": "number",
            "options": [],
            "category": "|Display|",
            "description": "|Defines the text height of the dimension|, |0 = byDimstyle|"
          },
          {
            "index": 4,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|DimStyle|",
            "defaultValue": "_DimStyles.sorted()",
            "inputType": "dropdown",
            "options": [],
            "category": "|Display|",
            "description": "|Defines the DimStyle|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6248,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a static geometric clone (solid body) of a selected MasterPanel, placed at a user-defined location, with a customizable text label displaying panel properties.",
          "category": "Modeling/Visualisation",
          "typicalUseCase": "Used to visualize the placement of a specific panel design in a new location without creating a new structural element, or to represent existing geometry for referencing."
        },
        "parameters": [
          {
            "name": "sFormat",
            "technicalDefault": "\"@(Number)\"",
            "businessMeaning": "Defines the data format string to extract and display specific properties (like Name, Length, or EAN) from the referenced MasterPanel as a text label.",
            "validRange": "Valid hsbCAD format keywords (e.g., @(Number), @(Name), @(Length))",
            "unit": "string",
            "affectsOutput": "Alters the informational text displayed above the cloned solid in the CAD model."
          },
          {
            "name": "nSolidColor",
            "technicalDefault": "40",
            "businessMeaning": "Sets the visual color of the cloned solid body representing the panel.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "index",
            "affectsOutput": "Changes the color of the 3D representation of the panel clone to distinguish it from other elements."
          },
          {
            "name": "nColor",
            "technicalDefault": "7",
            "businessMeaning": "Defines the color of the text label associated with the panel clone.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "index",
            "affectsOutput": "Changes the visibility color of the property text label."
          },
          {
            "name": "dTextHeight",
            "technicalDefault": "300",
            "businessMeaning": "Controls the physical height of the property text label on the drawing.",
            "validRange": "0 to 1000+ (0 = use DimStyle default)",
            "unit": "mm",
            "affectsOutput": "Scales the size of the text label; 0 defers to the dimension style settings."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles.sorted()",
            "businessMeaning": "Specifies the Dimension Style to apply to the text label (governing font and default height).",
            "validRange": "Existing DimStyles in the drawing",
            "unit": "string",
            "affectsOutput": "Determines the font and fallback text height settings when dTextHeight is 0."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dTextHeight = 0",
            "effect": "Text height is determined by sDimStyle",
            "cascade": [
              "dTextHeight",
              "sDimStyle"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body",
            "description": "A solid body geometry matching the shape and thickness of the source MasterPanel.",
            "appliedTo": "New TSL Instance in ModelSpace"
          },
          {
            "type": "Text",
            "description": "Formatted text label displaying properties of the source MasterPanel.",
            "appliedTo": "New TSL Instance in ModelSpace"
          }
        ]
      },
      "tokens_used": 5185,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution triggered via command or catalog insert",
          "Check Insert Cycle: If cycle count > 1, erase temporary instance and exit",
          "Catalog check: If _kExecuteKey matches a catalog name, load properties from catalog",
          "If no catalog match, display Standard Dialog (showDialog) for user to configure properties (Format, Color, Text Height, etc.)",
          "Scan ModelSpace for existing 'MasterPanelClone' instances to track source panels",
          "Prompt user to select MasterPanel entities (PrEntity)",
          "Prompt user to pick an insertion point (getPoint)",
          "Process Selections: Filter out MasterPanels that are already referenced by existing clones",
          "Calculate geometry: Determine bounding profile of all selected panels to establish a relative group base point",
          "Calculate transformation: Compute vector from calculated base point to user-picked insertion point",
          "Iterate through valid MasterPanels: For each panel, calculate its relative position, apply transformation vector, and create a new TSL instance ('MasterPanelClone') linking to that specific MasterPanel",
          "Erase the temporary insert instance",
          "Child Instance Calculation: Retrieve properties from linked MasterPanel",
          "Generate Geometry: Create solid Body (Clone) and Text Label at the transformed location",
          "Draw result in ModelSpace"
        ],
        "conditionalBranches": [
          {
            "condition": "Re-insertion / Recalculation cycle check (insertCycleCount)",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase current instance",
                "Terminate script"
              ]
            },
            "path2": {
              "name": "Cycle = 1 (Initial Insertion)",
              "steps": [
                "Proceed to Catalog/Dialog loading",
                "Execute Entity Selection and Placement logic"
              ]
            }
          },
          {
            "condition": "Catalog Execution Key presence (_kExecuteKey)",
            "path1": {
              "name": "Catalog Key Found",
              "steps": [
                "Load properties from specified Catalog entry",
                "Skip standard dialog"
              ]
            },
            "path2": {
              "name": "No Catalog Key",
              "steps": [
                "Invoke 'showDialog()' to let user manually set properties"
              ]
            }
          },
          {
            "condition": "Text Height property (dTextHeight) value",
            "path1": {
              "name": "Height <= 0",
              "steps": [
                "Retrieve default text height from DimStyle (sDimStyle)"
              ]
            },
            "path2": {
              "name": "Height > 0",
              "steps": [
                "Use specific value defined in dTextHeight property"
              ]
            }
          },
          {
            "condition": "Reference Entity Validation on Recalc",
            "path1": {
              "name": "Valid MasterPanel Reference",
              "steps": [
                "Rebuild solid geometry",
                "Update text label based on current properties"
              ]
            },
            "path2": {
              "name": "Invalid/Deleted MasterPanel Reference",
              "steps": [
                "Report error message: 'invalid masterpanel reference'",
                "Erase script instance"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Is the referenced MasterPanel still valid and existing in the database?",
            "errorMessage": "\\nMasterPanelClone: |invalid masterpanel reference|",
            "recovery": "The script instance is automatically erased to prevent errors. User must re-insert the clone and select a valid MasterPanel."
          },
          {
            "check": "Is the selected MasterPanel already cloned by another instance?",
            "errorMessage": "Message: 'Masterpanel [Number] alreday clomed' (Warning/Info)",
            "recovery": "The specific panel is skipped in the current batch process, but others are processed. User can proceed with the remaining selection."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Clone",
            "how": "Grip Edit (Move)",
            "effect": "Updates _Pt0, translating the solid body and text label to the new location relative to the original MasterPanel geometry."
          },
          {
            "action": "Change Visual Properties",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing 'Color' (nSolidColor) updates the solid body color. Changing 'Text Color' (nColor) updates the label color. Changing 'Text Height' (dTextHeight) resizes the label."
          },
          {
            "action": "Update Label Content",
            "how": "OPM (Object Properties Palette) - Format property",
            "effect": "Modifying the 'Format' string (sFormat) triggers a recalc, fetching and displaying different properties (e.g., changing from @(Number) to @(Length)) from the source MasterPanel."
          }
        ]
      },
      "tokens_used": 6446,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# MasterPanelClone.mcr\n\n## Overview\nCreates a static geometric clone (solid body) of a selected MasterPanel, placed at a user-defined location, with a customizable text label displaying panel properties.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script creates 3D solid geometry and operates only here. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities:** Existing \"MasterPanel\" entities must be present in the drawing.\n- **Minimum Beam Count:** 1\n- **Required Settings:** None\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT`\n**Action:** Browse and select `MasterPanelClone.mcr`.\n\n### Step 2: Configure Properties (Dialog)\n**Action:** If the script is not run from a pre-configured catalog entry, a configuration dialog appears. Set the desired Color, Text Height, and Format string, then click OK.\n\n### Step 3: Select Entities\n**Command Line:** `Select entities`\n**Action:** Click on one or more existing MasterPanel entities in the model that you wish to clone. Press Enter to confirm selection.\n\n### Step 4: Define Location\n**Command Line:** `Pick insertion point`\n**Action:** Click in the Model Space to specify where the cloned panel group should be placed.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Format | Text | @(Number) | Defines the data format string to extract and display properties (e.g., @(Name), @(Length), @(EAN)) from the source MasterPanel. |\n| Color | Number | 40 | Sets the AutoCAD Color Index (0-255) for the solid body of the cloned panel. |\n| Text Color | Number | 7 | Sets the AutoCAD Color Index (0-255) for the text label. |\n| Text Height | Number | 300 (mm) | Defines the physical height of the text label. Set to 0 to use the DimStyle default height. |\n| DimStyle | Dropdown | *(Sorted List)* | Specifies the Dimension Style to apply to the text label (controls font and default height). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add specific custom commands to the right-click context menu. |\n\n## Settings Files\n- **Filename:** None\n- **Location:** N/A\n- **Purpose:** N/A\n\n## Tips\n- **Moving the Clone:** You can use the grip points to move the cloned panel to a new location. The text label moves with it.\n- **Dynamic Labels:** Change the \"Format\" property in the Properties Palette to instantly update the label text without re-inserting the script (e.g., switch from `@(Number)` to `@(Length)`).\n- **Text Styling:** If you want the text height to match your standard dimension settings automatically, set \"Text Height\" to `0` and ensure the correct \"DimStyle\" is selected.\n\n## FAQ\n- **Q: What happens if I delete the original MasterPanel that was cloned?**\n  - A: The script detects the missing reference during a recalculation, displays the error \"invalid masterpanel reference\", and automatically erases the clone instance to prevent data corruption.\n- **Q: Why did the clone skip one of the panels I selected?**\n  - A: The script checks if a MasterPanel is already referenced by another existing clone. If a duplicate is found, a warning \"Masterpanel [Number] already cloned\" is issued, and that specific panel is skipped during the insertion process."
      },
      "tokens_used": 5105,
      "error": null
    }
  }
}