{
  "filename": "hsb_CoverStrip.mcr",
  "status": "completed",
  "total_tokens": 28749,
  "processing_time": 194.99848914146423,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "01.02.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3773,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script filename lacks 'sd_' or 'Multipage' prefixes. No references to '_Viewport' or '_Entity[]' of '#Type E'. The script creates physical 'Sheet' entities via 'sh.dbCreate()' in the 3D model."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing hsbCAD Elements (specifically Walls)",
          "requiredSettings": [
            "Catalog entry for property initialization (_kExecuteKey)"
          ]
        }
      },
      "tokens_used": 3149,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dTimberWidth",
            "type": "PropDouble",
            "displayName": "Sheet Thickness",
            "defaultValue": "9",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dTimberHeight",
            "type": "PropDouble",
            "displayName": "Sheet Height",
            "defaultValue": "140",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sName",
            "type": "PropString",
            "displayName": "Sheet Name",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sMaterial",
            "type": "PropString",
            "displayName": "Sheet Material",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nZones",
            "type": "PropInt",
            "displayName": "Zone to Assign the Sheets",
            "defaultValue": "1",
            "inputType": "dropdown",
            "options": [
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "10"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5624,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automatically generates a horizontal sheet (cover strip) attached to a wall element, spanning the wall's length with a user-defined width and thickness.\",\n    \"category\": \"Sheeting/Cladding\",\n    \"typicalUseCase\": \"Creating a fascia board, ridge cap covering, or horizontal capping strip flush with or set back from the wall face.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"dTimberWidth\",\n      \"technicalDefault\": \"9\",\n      \"businessMeaning\": \"The material thickness of the cover strip (e.g., thickness of plywood or OSB board).\",\n      \"validRange\": \"6 - 50 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Directly sets the 3D thickness of the generated Sheet entity.\"\n    },\n    {\n      \"name\": \"dTimberHeight\",\n      \"technicalDefault\": \"140\",\n      \"businessMeaning\": \"The width of the strip measured along the wall's thickness/depth direction (how far the strip covers the wall surface).\",\n      \"validRange\": \"50 - 300 mm\",\n      \"unit\": \"mm\",\n      \"a"
      },
      "tokens_used": 6378,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script",
          "[Insertion Phase - _bOnInsert is TRUE]",
          "Check if insertCycleCount > 1",
          "[If cycle > 1] Erase current script instance and exit",
          "[If cycle == 1] Check if _kExecuteKey is empty",
          "[If Key empty] Show Dialog for properties (once)",
          "Prompt User: 'Select a set of elements' (PrEntity)",
          "[If User Cancels] Exit without creating",
          "[If User Selects Elements] Iterate through selected elements",
          "For each element: Create a new instance of the script attached to that specific element (dbCreate)",
          "Erase the original command-line script instance",
          "[Execution Phase - _bOnInsert is FALSE]",
          "Check if _Element array has elements",
          "[If _Element.length <= 0] Erase instance and exit",
          "Retrieve first element as ElementWall",
          "Check if ElementWall is valid",
          "[If Invalid] Erase instance and exit",
          "Define Wall Coordinate System (Origin, X, Y, Z vectors)",
          "Set Script Origin Point (_Pt0) to Wall Origin",
          "Scan for existing instances of this script attached to the wall",
          "[If Duplicate found] Erase the duplicate instance",
          "Calculate Wall Min/Max dimensions (segmentMinMax)",
          "Project Wall endpoints onto Wall X-axis to find Left/Right points",
          "Calculate Sheet Bottom Right point: Wall Right - (Wall Y * TimberHeight)",
          "Define Sheet Geometry: Rectangle from Left to Right points with Height",
          "Create Sheet Entity with Thickness (dTimberWidth)",
          "Assign Sheet Name and Material",
          "Assign Sheet to Element Group with specific Zone",
          "Erase Script Instance",
          "Exit"
        ],
        "conditionalBranches": [
          {
            "condition": "Check insertCycleCount > 1",
            "path1": {
              "name": "Repeated Insert",
              "steps": [
                "eraseInstance()",
                "return"
              ]
            },
            "path2": {
              "name": "First Insert",
              "steps": [
                "Check _kExecuteKey",
                "Show Dialog if needed",
                "Prompt for Element Selection"
              ]
            }
          },
          {
            "condition": "User Selects Elements (PrEntity)",
            "path1": {
              "name": "Selection Successful",
              "steps": [
                "Loop through selected elements",
                "Spawn child instances for each",
                "Erase parent"
              ]
            },
            "path2": {
              "name": "Selection Cancelled/Empty",
              "steps": [
                "Script ends",
                "No geometry created"
              ]
            }
          },
          {
            "condition": "Element Validity Check",
            "path1": {
              "name": "Valid Wall Element",
              "steps": [
                "Extract Coordinates",
                "Generate Sheet",
                "Assign properties"
              ]
            },
            "path2": {
              "name": "Invalid Element",
              "steps": [
                "eraseInstance()",
                "return"
              ]
            }
          },
          {
            "condition": "Duplicate Script Detection",
            "path1": {
              "name": "Duplicate Found",
              "steps": [
                "Identify instance by script name and handle",
                "Erase old instance (tslAll[i].dbErase())",
                "Proceed to generate new Sheet"
              ]
            },
            "path2": {
              "name": "No Duplicate",
              "steps": [
                "Proceed to generate Sheet"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element selection during PrEntity",
            "errorMessage": "(Implicit) Command cancelled if no selection made.",
            "recovery": "Relaunch command and select valid Element/Wall."
          },
          {
            "check": "Element array population (_Element.length)",
            "errorMessage": "(Silent) Script deletes itself if no element is linked.",
            "recovery": "Ensure the script instance is correctly attached to an Element during the initial insertion phase."
          },
          {
            "check": "Element Type and Validity (el.bIsValid)",
            "errorMessage": "(Silent) Script deletes itself if element is not a valid Wall.",
            "recovery": "Select a Wall element (ElementWall), not a beam or other entity type."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Sheet Dimensions",
            "how": "OPM Properties (Sheet Thickness / Sheet Height)",
            "effect": "Updates the geometry (Thickness/Depth) of the Sheet entity on recalculation."
          },
          {
            "action": "Change Material/Name",
            "how": "OPM Properties (Sheet Material / Sheet Name)",
            "effect": "Updates the attribute data of the Sheet entity."
          },
          {
            "action": "Assign Zone",
            "how": "OPM Property (Zone to Assign the Sheets)",
            "effect": "Re-assigns the Sheet to the specified element group zone."
          },
          {
            "action": "Replace/Rerun",
            "how": "Re-running the selection command on the same wall",
            "effect": "The script detects the previous instance via `tslInstAttached` and erases it before creating a new one, ensuring only one cover strip exists per wall instance."
          }
        ]
      },
      "tokens_used": 4874,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_CoverStrip.mcr\n\n## Overview\nAutomatically generates a horizontal sheet (cover strip) attached to a wall element, spanning the wall's length with a user-defined width and thickness. This is typically used for creating fascia boards, ridge cap coverings, or horizontal capping strips.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script creates physical 3D sheet entities. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: An existing Wall Element (`ElementWall`) in the model.\n- **Minimum Beam Count**: 0 (This script operates on Elements, not individual beams).\n- **Required Settings**: A Catalog entry is recommended to initialize properties (`_kExecuteKey`), though not strictly mandatory.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_CoverStrip.mcr`\n\n### Step 2: Configure Properties (Optional)\nIf no default catalog entry is set, a dialog may appear to set initial parameters (Thickness, Height, Material). You can also change these later in the Properties Panel.\n\n### Step 3: Select Element\n```\nCommand Line: Select a set of elements\nAction: Click on the Wall element(s) in the drawing where you want to apply the cover strip. Press Enter to confirm selection.\n```\n*Note: The script will attach itself to the selected element and generate the geometry.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Sheet Thickness | Number | 9 | The material thickness of the cover strip (e.g., thickness of plywood or OSB board). |\n| Sheet Height | Number | 140 | The width of the strip measured along the wall's thickness/depth direction (how far the strip covers the wall surface). |\n| Sheet Name | Text | [Empty] | A custom name to identify the sheet entity. |\n| Sheet Material | Text | [Empty] | The material code to assign to the sheet for reports and lists. |\n| Zone to Assign the Sheets | Dropdown | 1 | Assigns the sheet to a specific production group zone (Options 1-10). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None Defined* | This script does not add custom items to the right-click context menu. Use the standard Properties palette to modify parameters. |\n\n## Settings Files\n- **Filename**: Catalog Entry (implicit)\n- **Location**: hsbCAD Catalog\n- **Purpose**: Stores default values for thickness, height, material, and zone so the script can run without prompting the user every time.\n\n## Tips\n- **Updating Dimensions**: You can adjust the \"Sheet Thickness\" or \"Sheet Height\" at any time by selecting the generated sheet and changing the values in the Properties Panel (AutoCAD OPM). The geometry will update automatically.\n- **Replacing Existing Strips**: If you run the script again on a wall that already has a cover strip, the script will automatically detect and erase the old strip before creating the new one. This prevents duplicates on the same wall.\n\n## FAQ\n- **Q: I ran the script, but nothing appeared?**\n- **A:** Ensure you selected a valid Wall Element. If you selected a beam or an empty space, the script will exit without creating geometry.\n- **Q: How do I change the material of the strip?**\n- **A:** Select the strip in the model, open the Properties palette (Ctrl+1), and update the \"Sheet Material\" field.\n- **Q: Can I use this on curved walls?**\n- **A:** The script calculates the span based on the wall's Min/Max points. It is designed primarily for linear walls, though it will attempt to span the total length of the element geometry."
      },
      "tokens_used": 4951,
      "error": null
    }
  }
}