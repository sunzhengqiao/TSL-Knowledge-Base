{
  "filename": "GenericAngleExcelImporter.mcr",
  "status": "completed",
  "total_tokens": 46831,
  "processing_time": 461.8207063674927,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": 1,
          "minorVersion": 3,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.3",
            "date": "11.11.2025",
            "author": "Marsel Nakuci",
            "changes": "HSB-24891: Fix when running hsbExcelToMap"
          },
          {
            "version": "1.2",
            "date": "3/16/2023",
            "author": "cc",
            "changes": "Added findFile(sLastPath) safety"
          },
          {
            "version": "1.1",
            "date": "07.10.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-15990: Support family description"
          },
          {
            "version": "1.0",
            "date": "08.09.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-15990: Initial"
          }
        ],
        "settingsFiles": [
          "GA.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 8726,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates as a transient data import utility. It uses 'callDotNetFunction2' to process Excel data and updates MapObjects and XML settings files. It contains no geometry generation commands (Body, GenBeam), no 'sd_' prefixed functions, no ShopDrawing entities (#Type E), and no _Viewport interactions. The script concludes with 'eraseInstance()', removing itself from the drawing after execution."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "None (Utility script runs in standard execution context)",
          "requiredSettings": [
            "GA.xml",
            "hsbExcelToMap.dll or .exe",
            "Excel file (.xlsx)"
          ]
        }
      },
      "tokens_used": 6815,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sLastPath",
            "type": "PropString",
            "displayName": "Path",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "General",
            "description": "Defines the last used path",
            "hidden": true
          },
          {
            "index": 1,
            "variable": "sImport",
            "type": "PropString",
            "displayName": "Sheet Import",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "All Sheets"
            ],
            "category": "General",
            "description": "Defines the Import"
          },
          {
            "index": 2,
            "variable": "sImportMode",
            "type": "PropString",
            "displayName": "Import Mode",
            "defaultValue": "|Drawing|",
            "inputType": "dropdown",
            "options": [
              "|Drawing|",
              "|Drawing + Company XML|"
            ],
            "category": "General",
            "description": "Defines the ImportMode"
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "GA.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings"
            ],
            "purpose": "Stores general settings including version and list of manufacturers",
            "required": true
          }
        ]
      },
      "tokens_used": 8355,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A utility script to import Angle Bracket hardware data from Excel files into the hsbCAD system database (MapObjects) and configuration files.",
          "category": "Data Management / Utility",
          "typicalUseCase": "Used when updating or adding new manufacturer angle bracket catalogs. The user selects an Excel file containing bracket dimensions and properties, and the script parses this data to make it available for detailing scripts (e.g., inserting connections)."
        },
        "parameters": [
          {
            "name": "sLastPath",
            "technicalDefault": "\"\"",
            "businessMeaning": "Stores the directory path of the most recently processed Excel file to facilitate quick re-importing.",
            "validRange": "Any valid file system path string (e.g., \"C:\\Projects\\Hardware\\AngleBrackets.xlsx\").",
            "unit": "Text (Path)",
            "affectsOutput": "Sets the starting location for the file browser dialog in the .NET component (hsbExcelToMap), improving workflow efficiency."
          },
          {
            "name": "sImport",
            "technicalDefault": "\"All Sheets\"",
            "businessMeaning": "Selects the specific Excel worksheet (tab) containing the angle bracket data to process. This allows filtering by manufacturer or product type if the Excel file contains multiple datasets.",
            "validRange": "List of Sheet Names found in the uploaded Excel file that contain valid header data (Manufacturer, Family, Article).",
            "unit": "Text",
            "affectsOutput": "Determines which subset of hardware data is parsed and subsequently written to the hsbCAD MapObjects. Changing this imports different products into the active session."
          },
          {
            "name": "sImportMode",
            "technicalDefault": "\"|Drawing|\"",
            "businessMeaning": "Controls the scope of the data importâ€”whether the data is loaded only for the current drawing session or permanently saved to the company's standard configuration files.",
            "validRange": "Options: \"|Drawing|\" (Current session only), \"|Drawing + Company XML|\" (Global update).",
            "unit": "Enumeration",
            "affectsOutput": "If set to \"|Drawing + Company XML|\", the script overwrites the physical XML files on the disk (and the MapObject), making the new hardware data available to all users and future projects. If set to \"|Drawing|\", it only updates the in-memory database for the current CAD session."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User selects a file via the .NET dialog",
            "effect": "The script updates the internal 'LastAccessedFilePath' and writes it to the sLastPath property.",
            "cascade": [
              "sLastPath"
            ]
          },
          {
            "trigger": "Script reads the selected Excel file",
            "effect": "Populates the dropdown list for sImport with valid sheet names found in the file.",
            "cascade": [
              "sImport"
            ]
          },
          {
            "trigger": "sImportMode is set to \"|Drawing + Company XML|\"",
            "effect": "The script triggers a write operation to the XML file located at _kPathHsbCompany and updates the list of manufacturers in the main settings.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "MapObject (hsbTSL)",
            "description": "In-memory database objects representing the Angle Bracket families, products, dimensions, and materials read from Excel.",
            "appliedTo": "Global hsbCAD Session Memory (used by other TSLs to generate geometry)"
          },
          {
            "type": "XML File",
            "description": "Configuration files (e.g., ManufacturerName.xml) stored in the company path that persist the hardware data for future use.",
            "appliedTo": "File System (Company Standards/TSL/Settings)"
          }
        ]
      },
      "tokens_used": 8072,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launched via command line or catalog insertion.",
          "2. Initialization: Constants, Properties, and Settings (GA.xml) are loaded. Settings are read from Company or Install path; MapObject is created if missing.",
          "3. [Insert Cycle] Check if `insertCycleCount() > 1`. If true, erase instance and exit (safety check).",
          "4. [Insert Cycle] Restore 'LastInserted' catalog values to populate `sLastPath`.",
          "5. [Insert Cycle] Call .NET function `hsbExcelToMap` passing the last accessed path. This opens a File Dialog for the user to select an Excel file.",
          "6. [Insert Cycle] Retrieve the selected file path from the .NET return Map and update the `sLastPath` property.",
          "7. Parse the 'Sheets' Map returned by the .NET function.",
          "8. Iterate through available sheets to validate data (checking for Manufacturer, Family, Article headers).",
          "9. Populate the `sImports` property array with valid sheet names. Insert '<All Sheets>' at index 0.",
          "10. Check if any valid sheets were found. If `sImports` is empty, report error and exit.",
          "11. [Insert Cycle] Show the Properties Dialog (`showDialog`) to allow user to select sheet and import mode. Script pauses.",
          "12. User modifies `sImport` (Sheet) or `sImportMode` (Drawing vs. XML) in the Properties Palette and triggers a recalculation.",
          "13. Determine the Import Mode (`nImportMode`).",
          "14. Loop through the selected sheets (or all sheets if '<All Sheets>' is selected).",
          "15. For each row in the sheet(s): Read Article, Material, Dimensions, and Diameter data.",
          "16. Construct the hierarchical data structure: Product -> Family -> Manufacturer.",
          "17. Update the specific Manufacturer MapObject (create or update).",
          "18. [Update Phase] Iterate through all updated manufacturer entries.",
          "19. [Conditional] If Import Mode is 'Drawing + Company XML', write the MapObject data to the physical XML file in the Company path.",
          "20. Check if the manufacturer is new relative to the global GA.xml settings. If new, add to the manufacturer list.",
          "21. Update the main GA.xml settings file with the new manufacturer list.",
          "22. Report the total number of articles imported to the command line.",
          "23. Erase the script instance."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "Subsequent Cycle",
              "steps": [
                "Detect insertCycleCount() > 1",
                "Execute eraseInstance()",
                "Exit script"
              ]
            },
            "path2": {
              "name": "First Cycle",
              "steps": [
                "Proceed to load Excel data",
                "Execute .NET call",
                "Show Dialog"
              ]
            }
          },
          {
            "condition": "Valid Data in Sheets",
            "path1": {
              "name": "Valid Headers Found",
              "steps": [
                "Detect Manufacturer, Family, and Article columns",
                "Add sheet name to sImports list"
              ]
            },
            "path2": {
              "name": "No Valid Data",
              "steps": [
                "Skip current sheet",
                "Check if sImports list is empty",
                "If empty, report error and erase instance"
              ]
            }
          },
          {
            "condition": "Import Mode (sImportMode)",
            "path1": {
              "name": "|Drawing| (Memory Only)",
              "steps": [
                "Update MapObjects in current session",
                "Skip XML file generation",
                "Skip updating GA.xml manufacturers"
              ]
            },
            "path2": {
              "name": "|Drawing + Company XML|",
              "steps": [
                "Update MapObjects in current session",
                "Write manufacturer data to .xml file on disk",
                "Update GA.xml with new manufacturers"
              ]
            }
          },
          {
            "condition": "New Manufacturer Detected",
            "path1": {
              "name": "New Manufacturer",
              "steps": [
                "Manufacturer name not found in sManufacturers array",
                "Append to mapSetting 'Manufacturer[]'",
                "Trigger bUpdate flag to rewrite GA.xml"
              ]
            },
            "path2": {
              "name": "Existing Manufacturer",
              "steps": [
                "Manufacturer name found in array",
                "No change to GA.xml manufacturer list"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of valid Excel data headers (Manufacturer, Family, Article) in the selected file.",
            "errorMessage": "Could not find any data in [Path]",
            "recovery": "The script exits and erases itself. The user must ensure the Excel file contains the correct headers and run the script again."
          },
          {
            "check": "Settings Version Mismatch on Insert",
            "errorMessage": "Notice: A different Version of the settings has been found... Current Version X Other Version Y",
            "recovery": "The script reports a notice but continues execution, using the specific version logic defined in the code."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Import Scope",
            "how": "Properties Palette (OPM) - Modify 'Sheet Import' or 'Import Mode' and Recalculate",
            "effect": "The script re-parses the data. If 'Import Mode' is changed to include XML, it generates files on disk. If 'Sheet Import' is changed, it processes different data ranges from the Excel file."
          }
        ]
      },
      "tokens_used": 8939,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GenericAngleExcelImporter.mcr\n\n## Overview\nThis utility script imports Angle Bracket hardware data from a specific Excel file format into the hsbCAD database. It allows you to update hardware catalogs for the current drawing session and permanently update your company's standard configuration files.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the model space to import data. |\n| Paper Space | No | Not applicable for this data import tool. |\n| Shop Drawing | No | This script is for model data management only. |\n\n## Prerequisites\n- **Required Entities**: None.\n- **Minimum Beam Count**: 0.\n- **Required Settings**:\n  - `GA.xml` (General Settings file).\n  - `hsbExcelToMap` component (DLL/EXE).\n  - A valid Excel file (`.xlsx`) containing the hardware data with specific headers (Manufacturer, Family, Article).\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Select `GenericAngleExcelImporter.mcr` from the file browser.\n\n### Step 2: Select Excel File\n1.  A standard Windows File Dialog will appear automatically.\n2.  Navigate to the folder containing your hardware Excel file.\n3.  Select the file and click **Open**.\n\n### Step 3: Configure Import Settings\n1.  The script will pause. Select the script instance in the drawing (if not already selected).\n2.  Open the **Properties Palette** (press `Ctrl+1`).\n3.  **Sheet Import**: Select a specific worksheet from the dropdown or choose \"All Sheets\" to import data from every tab in the Excel file.\n4.  **Import Mode**: Choose the scope of the import:\n    -   `|Drawing|`: Imports data only for the current session (temporary).\n    -   `|Drawing + Company XML|`: Imports data for the current session AND updates the company XML files on the hard drive (permanent).\n\n### Step 4: Execute Import\n1.  Right-click anywhere in the drawing area.\n2.  Select **Recalculate** from the context menu.\n3.  The script will process the data. A message will appear in the command line (e.g., \"X articles imported\").\n4.  The script instance will automatically erase itself upon completion.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Sheet Import | Dropdown | All Sheets | Select which Excel worksheet to process. Options are populated based on the file selected in Step 2. |\n| Import Mode | Dropdown | \\|Drawing\\| | Determines if the update is temporary (current session only) or permanent (updates Company XML files). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Executes the import process using the currently selected properties. |\n\n## Settings Files\n- **Filename**: `GA.xml`\n- **Location**: `_kPathHsbCompany\\TSL\\Settings` or `_kPathHsbInstall\\Content\\General\\TSL\\Settings`\n- **Purpose**: Stores the list of available manufacturers and script version information.\n\n## Tips\n- **Excel Format**: Ensure your Excel file contains the required headers: \"Manufacturer\", \"Family\", and \"Article\". If these are missing, the script will report an error.\n- **Updating Standards**: Use the `|Drawing + Company XML|` mode only when you are sure the data is correct and ready to be shared with all users in your company.\n- **Re-running**: The script remembers the last used file path. To run it again on a different file, simply insert the script and select the new file when the dialog appears.\n\n## FAQ\n- **Q: Why did the script disappear after I ran it?**\n  - A: This is normal behavior. The script is designed as a transient utility; it erases itself from the drawing after successfully importing the data to keep your drawing clean.\n- **Q: Can I import data from multiple Excel files at once?**\n  - A: No, you must run the script separately for each Excel file.\n- **Q: What happens if I choose \"|Drawing|\" mode?**\n  - A: The hardware data will be available in your current drawing session, but if you close the drawing or start a new one without updating the XML, the new data will not appear. Other users will not see the changes."
      },
      "tokens_used": 5924,
      "error": null
    }
  }
}