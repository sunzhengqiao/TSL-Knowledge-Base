{
  "filename": "Pitzl HVP.mcr",
  "status": "completed",
  "total_tokens": 58127,
  "processing_time": 1133.625694990158,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": null,\n  \"versionHistory\": [\n    {\n      \"version\": \"2.3\",\n      \"date\": \"30.11.2023\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-20786 article selection fixed\"\n    },\n    {\n      \"version\": \"2.2\",\n      \"date\": \"24sep2020\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"HSB-8947 tolerance added on type checking\"\n    },\n    {\n      \"version\": \"2.1\",\n      \"date\": \"22.08.19\\\"\",\n      \"author\": \"marsel.nakuci@hsbcad.com\",\n      \"changes\": \"HSB-5210 fix dDouble883_MDHs and dDouble883_MDWs\"\n    },\n    {\n      \"version\": \"2.0\",\n      \"date\": \"22.08.19\\\"\",\n      \"author\": \"marsel.nakuci@hsbcad.com\",\n      \"changes\": \"HSB-5210 Extend to include Double HVP\"\n    },\n    {\n      \"version\": \"1.2\",\n      \"date\": \"17may18\\\"\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"minor bugfix to show correct family on insert via ribbon\"\n    },\n    {\n      \"version\": \"1.1\",\n      \"date\": \"15may17\\\"\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"Hyperlinks DE, FR and EN added\"\n    },\n    {\n      \"version\": \"1.0\",\n      \"date\": \"14dec17\",\n      \"author\": \"florian.wuermseer@hsbcad.com\",\n      \"changes\": \"initial version (derived from \\\""
      },
      "tokens_used": 9828,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script instantiates 3D Body objects and applies 3D tooling (BeamCut, House) to beam entities (bm0, bm1). Display logic utilizes dpModel and dpPlan. No 'sd_' prefix in filename, no _Viewport usage, and no #Type E or _Entity[] declarations typical of Shop Drawing scripts found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 8007,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getGenBeam",
              "promptOriginal": "Select main beam",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getGenBeam",
              "promptOriginal": "Select secondary beam",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "SelectFromList",
            "trigger": "Insertion (if no execute key provided)",
            "title": "Select Connector Family",
            "dataSource": "Internal string arrays (e.g. sXS_Articles, sS_Articles)",
            "features": {
              "searchable": true,
              "multiSelect": false
            }
          },
          {
            "type": "GetString",
            "trigger": "Context Menu Action: Create catalog entry",
            "title": null,
            "dataSource": "User Input",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sArticle",
            "type": "PropString",
            "displayName": "Article",
            "defaultValue": "88006",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sMillMode",
            "type": "PropString",
            "displayName": "Milling",
            "defaultValue": "none",
            "inputType": "dropdown",
            "options": [
              "none",
              "male",
              "female",
              "half"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dMaleMillDepth",
            "type": "PropDouble",
            "displayName": "Male mill depth",
            "defaultValue": 20,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dOffsetX",
            "type": "PropDouble",
            "displayName": "Offset X",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dOffsetY",
            "type": "PropDouble",
            "displayName": "Offset Y",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "dOffsetZ",
            "type": "PropDouble",
            "displayName": "Offset Z",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "dRotX",
            "type": "PropDouble",
            "displayName": "Rot X",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "dRotY",
            "type": "PropDouble",
            "displayName": "Rot Y",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "dRotZ",
            "type": "PropDouble",
            "displayName": "Rot Z",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "bShowHelp",
            "type": "PropInt",
            "displayName": "Show help",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 10,
            "variable": "nRoundType",
            "type": "PropInt",
            "displayName": "Round type",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 11,
            "variable": "sHyperlink",
            "type": "PropString",
            "displayName": "Hyperlink",
            "defaultValue": "http://www.pitzl.de",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 12,
            "variable": "sTriggerSetCatalog",
            "type": "PropString",
            "displayName": "Set catalog",
            "defaultValue": "Create catalog entry",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Create catalog entry",
            "handler": "setCatalog",
            "action": "Prompts user for a name via command line and creates a catalog entry from current properties.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9632,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates and inserts Pitzl HVP timber connectors, including the metal plate body, necessary timber machining (milling/pockets), and screw hardware data.",
          "category": "Hardware",
          "typicalUseCase": "Connecting timber beams (e.g., joists to main beams) using Pitzl HVP heavy-duty connectors, allowing for surface mounting or recessed installation."
        },
        "parameters": [
          {
            "name": "sArticle",
            "technicalDefault": "88006",
            "businessMeaning": "The specific Pitzl product code (e.g., 88006, 88107) determining the connector's physical size, screw pattern, and load capacity.",
            "validRange": "Valid Pitzl HVP Article Numbers (880xx, 881xx, 882xx, 883xx, 884xx, 885xx, or Double variants).",
            "unit": "string",
            "affectsOutput": "Alters the dimensions (Width, Height, Thickness) of the connector body, the number and length of screws generated for the BOM, and the geometry of the milling cuts. The script auto-corrects to a larger article if the beams are too big for the selection."
          },
          {
            "name": "sMillMode",
            "technicalDefault": "none",
            "businessMeaning": "Controls how the connector sits relative to the timber surface (Surface mounted, Recessed in main beam, Recessed in secondary beam, or Recessed in both).",
            "validRange": "none, male, female, half",
            "unit": "enum",
            "affectsOutput": "Determines if 'House' (pocket/recess) or 'BeamCut' tools are applied to the beams. Adjusts the Z-position of the connector body to sit flush with or within the timber surface."
          },
          {
            "name": "dMaleMillDepth",
            "technicalDefault": 20,
            "businessMeaning": "The depth of the recess (milling) cut into the main beam when using specific milling modes (like 'half').",
            "validRange": "0 to approx. 50 (dependent on beam height and connector size)",
            "unit": "mm",
            "affectsOutput": "Offsets the connector body into the main beam and controls the depth of the pocket cut. If this value is less than the ground plate thickness, the tooling logic changes (e.g., using non-extended cuts)."
          },
          {
            "name": "dOffsetX",
            "technicalDefault": 0,
            "businessMeaning": "Shifts the connector position along the secondary beam axis (transverse to the main beam).",
            "validRange": "User defined",
            "unit": "mm",
            "affectsOutput": "Moves the connector geometry and associated tooling along the Y-axis of the local coordinate system."
          },
          {
            "name": "dOffsetY",
            "technicalDefault": 0,
            "businessMeaning": "Shifts the connector vertically relative to the beam intersection.",
            "validRange": "User defined",
            "unit": "mm",
            "affectsOutput": "Moves the connector geometry and associated tooling along the Y-axis (vertical in local context)."
          },
          {
            "name": "dOffsetZ",
            "technicalDefault": 0,
            "businessMeaning": "Shifts the connector position along the main beam axis.",
            "validRange": "User defined",
            "unit": "mm",
            "affectsOutput": "Moves the connector geometry and associated tooling along the Z-axis."
          },
          {
            "name": "dRotX",
            "technicalDefault": 0,
            "businessMeaning": "Rotates the connector around its local X-axis.",
            "validRange": "0-360",
            "unit": "degrees",
            "affectsOutput": "Rotates the connector body and all tooling geometry."
          },
          {
            "name": "dRotY",
            "technicalDefault": 0,
            "businessMeaning": "Rotates the connector around its local Y-axis (Vertical axis).",
            "validRange": "0-360",
            "unit": "degrees",
            "affectsOutput": "Rotates the connector body and all tooling geometry."
          },
          {
            "name": "dRotZ",
            "technicalDefault": 0,
            "businessMeaning": "Rotates the connector around its local Z-axis (Main beam axis).",
            "validRange": "0-360",
            "unit": "degrees",
            "affectsOutput": "Rotates the connector body and all tooling geometry."
          },
          {
            "name": "nRoundType",
            "technicalDefault": 2,
            "businessMeaning": "Defines the corner geometry of the milling/pocket operations.",
            "validRange": "0 (Square), 1 (Chamfer), 2 (Round/Fillet)",
            "unit": "integer",
            "affectsOutput": "Changes the shape of the 'House' tooling (pockets) applied to the beams."
          },
          {
            "name": "bShowHelp",
            "technicalDefault": 1,
            "businessMeaning": "Flag to show or hide hyperlinks to the manufacturer's documentation.",
            "validRange": "0 (No), 1 (Yes)",
            "unit": "boolean",
            "affectsOutput": "Visual only. Displays the URL link near the connector in the CAD model."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sArticle changes",
            "effect": "Updates internal dimensions (height, width, thickness) and screw configuration. The script may automatically override the selected article if the beam dimensions are too large for the chosen connector.",
            "cascade": [
              "dConHeights",
              "dConWidth",
              "dConThick",
              "Hardware BOM"
            ]
          },
          {
            "trigger": "sMillMode changes to 'half'",
            "effect": "Activates the use of 'dMaleMillDepth' to offset the connector and apply cuts to both beams.",
            "cascade": [
              "dMaleMillDepth",
              "bm0 Tooling",
              "bm1 Tooling"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body",
            "description": "3D representation of the Pitzl HVP metal connector plate.",
            "appliedTo": "Model Space (at intersection of beams)"
          },
          {
            "type": "House",
            "description": "Milling operation to create a pocket/recess in the timber.",
            "appliedTo": "Main Beam (if mode is male/half) or Secondary Beam (if mode is female/half)"
          },
          {
            "type": "BeamCut",
            "description": "Cutting operation, typically used to trim the timber or open up the pocket area.",
            "appliedTo": "Main Beam"
          },
          {
            "type": "HardWrComp",
            "description": "Hardware data for BOM export. Includes the connector plate and the specific screws (diameter x length) and quantity required.",
            "appliedTo": "Script Instance / BOM List"
          }
        ]
      },
      "tokens_used": 11061,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch: User executes 'Pitzl HVP' script.",
          "Input Selection: User selects Main Beam (bm0) via getGenBeam (if _bOnInsert is true).",
          "Input Selection: User selects Secondary Beam (bm1) via getGenBeam (if _bOnInsert is true).",
          "Property Initialization: Properties (sArticle, offsets, rotations, etc.) are loaded from defaults or Catalog entry if an execute key was used.",
          "Dialog/Selection Phase (Conditional): If no execute key was provided, a 'SelectFromList' dialog appears to choose the Connector Family (Type).",
          "Property Calculation: Internal dimensions (height, width, thickness) and screw data are mapped based on the selected Article number and detected beam geometry.",
          "Geometry Validation: Script checks if the selected Article fits the beams (tolerances checked against beam widths/heights).",
          "Auto-Correction Logic (Conditional): If beams are too large for the selected article, the script automatically upgrades to the next larger size.",
          "Instance Creation: Connector Body (3D) and Tooling (Milling/Cuts) are generated based on the sMillMode setting.",
          "Hardware Generation: HardWrComp entries are created for BOM (Connector plate + Screws).",
          "Visualization: Connector is drawn in Model and Plan views with labels.",
          "Completion: Script finishes, allowing post-insertion editing."
        ],
        "conditionalBranches": [
          {
            "condition": "Execute Key usage at Launch",
            "path1": {
              "name": "With Execute Key",
              "steps": [
                "Script launches with specific settings.",
                "Family and properties are preset from the catalog.",
                "User selects beams.",
                "Script runs directly to calculation and generation without the Family Selection dialog."
              ]
            },
            "path2": {
              "name": "Without Execute Key",
              "steps": [
                "Script launches.",
                "User selects beams.",
                "Family Selection dialog appears (e.g., 880-Vorgabe, 881-Vorgabe).",
                "Script runs to calculation and generation."
              ]
            }
          },
          {
            "condition": "Beam Dimensions vs. Selected Article",
            "path1": {
              "name": "Beams fit article",
              "steps": [
                "Validation passes.",
                "Selected article is used.",
                "Proceed to geometry generation."
              ]
            },
            "path2": {
              "name": "Beams too large for article",
              "steps": [
                "Validation fails.",
                "Script searches internal arrays for a larger article.",
                "If found: 'sArticle' property is updated to the larger size.",
                "If not found: Error displayed, 'sArticle' set to error string (read-only)."
              ]
            }
          },
          {
            "condition": "Milling Mode (sMillMode)",
            "path1": {
              "name": "Mode 0 (none)",
              "steps": [
                "Body positioned on surface.",
                "No tooling applied to beams."
              ]
            },
            "path2": {
              "name": "Mode 1 (male)",
              "steps": [
                "Body recessed into Main Beam (bm0).",
                "BeamCut applied to Main Beam."
              ]
            },
            "path3": {
              "name": "Mode 2 (female)",
              "steps": [
                "Body positioned on surface relative to Secondary Beam.",
                "House (pocket) applied to Secondary Beam (bm1)."
              ]
            },
            "path4": {
              "name": "Mode 3 (half)",
              "steps": [
                "Body recessed based on dMaleMillDepth.",
                "BeamCut applied to Main Beam (type depends on depth vs ground plate thickness).",
                "House applied to Secondary Beam."
              ]
            }
          },
          {
            "condition": "Context Menu Trigger: 'Create catalog entry'",
            "path1": {
              "name": "User provides name",
              "steps": [
                "Prompts for name via getString.",
                "Saves current configuration to catalog with provided name."
              ]
            },
            "path2": {
              "name": "User provides no name",
              "steps": [
                "Auto-generates name (e.g., '88006 none milled').",
                "Ensures uniqueness by appending (n) if necessary.",
                "Saves current configuration to catalog."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection",
            "errorMessage": "Implicitly handled by getGenBeam. Script requires 2 non-parallel beams.",
            "recovery": "User must select valid GenBeam entities."
          },
          {
            "check": "Article Size vs Beam Geometry",
            "errorMessage": "Reported via command line: 'Connector size was corrected to [Article]' or 'No articles found for this situation'.",
            "recovery": "User accepts auto-correction or manually adjusts beam sizes/selection to fit available articles."
          },
          {
            "check": "Debug State",
            "errorMessage": "None (Logic only).",
            "recovery": "Controls verbosity of command line messages."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Parameters",
            "how": "Properties Palette (OPM)",
            "effect": "Updating sArticle, Offsets, or Milling mode triggers a recalc. Geometry, Tooling, and BOM update automatically."
          },
          {
            "action": "Create Catalog Entry",
            "how": "Right-click Context Menu -> 'Create catalog entry'",
            "effect": "Saves current instance configuration as a reusable catalog entry for future inserts."
          },
          {
            "action": "Move/Rotate Connector",
            "how": "Grip Edit / Move Command",
            "effect": "Script instance moves relative to attached beams. Note: Offsets (dOffsetX/Y/Z) properties remain static unless edited in OPM; the instance coordinate system shifts."
          }
        ]
      },
      "tokens_used": 11949,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Pitzl HVP\n\n## Overview\nGenerates and inserts Pitzl HVP heavy-duty timber connectors, including the 3D metal plate body, necessary timber machining (milling/pockets), and screw hardware data for BOM export.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script creates 3D bodies and applies tooling to beams in the model. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: 2 GenBeams (Main Beam and Secondary Beam).\n- **Minimum Beam Count**: 2\n- **Required Settings Files**: None (Uses internal article data).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT`\n**Action**: Browse and select `Pitzl HVP.mcr`.\n\n### Step 2: Select Main Beam\n```\nCommand Line: Select main beam\nAction: Click on the primary beam (e.g., the beam carrying the load).\n```\n\n### Step 3: Select Secondary Beam\n```\nCommand Line: Select secondary beam\nAction: Click on the connecting beam (e.g., the joist or purlin meeting the main beam).\n```\n\n### Step 4: Select Connector Family (Conditional)\n*If you did not use a specific Catalog Entry (Execute Key) to start the script:*\n```\nDialog: SelectFromList\nAction: Choose the desired connector Family (e.g., 880-Vorgabe, 881-Vorgabe) from the list and click OK.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Article | text | 88006 | The specific Pitzl product code (e.g., 88006, 88107). Determines size and screw pattern. |\n| Milling | dropdown | none | Installation method: `none` (surface mounted), `male` (pocket in main beam), `female` (pocket in secondary beam), or `half` (recessed in both). |\n| Male mill depth | number | 20 | Depth of the recess into the main beam (used when Milling is set to 'half'). |\n| Offset X | number | 0 | Moves the connector along the secondary beam axis. |\n| Offset Y | number | 0 | Moves the connector vertically relative to the beam intersection. |\n| Offset Z | number | 0 | Moves the connector along the main beam axis. |\n| Rot X | number | 0 | Rotates the connector around its local X-axis. |\n| Rot Y | number | 0 | Rotates the connector around its local Y-axis. |\n| Rot Z | number | 0 | Rotates the connector around its local Z-axis. |\n| Round type | number | 2 | Shape of the milling corners (0=Square, 1=Chamfer, 2=Round). |\n| Show help | number | 1 | Toggle to show (1) or hide (0) the manufacturer hyperlink in the model. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Create catalog entry | Saves the current connector configuration (Article, Offsets, Milling mode) as a new entry in the catalog for future use. |\n\n## Tips\n- **Auto-Correction**: If the beams you selected are too large for the chosen Article number, the script will automatically calculate and switch to the next larger size available. A message will appear in the command line confirming the change.\n- **Milling Modes**:\n    - Use **Male** to recess the plate into the main beam.\n    - Use **Female** to recess the plate into the secondary beam.\n    - Use **Half** to recess partially into the main beam (using \"Male mill depth\") and fully into the secondary beam.\n- **Catalog Entries**: If you frequently use specific offsets or sizes, use the \"Create catalog entry\" context menu option to save that setup. You can then launch the script directly from that entry to skip the selection dialog.\n\n## FAQ\n- **Q: Why did the Article number change automatically after I selected it?**\n  **A**: The script detected that the beam dimensions were too large for the manually selected article. It automatically upgraded to a larger size to ensure the connector fits physically.\n- **Q: How do I make the connector sit flush with the beam surface?**\n  **A**: Set the `Milling` property to `male` (for main beam) or `female` (for secondary beam) to create the necessary pocket. Set offsets to 0 to align with the intersection.\n- **Q: Can I move the connector after insertion?**\n  **A**: Yes, you can use standard AutoCAD Move commands. Alternatively, adjust the `Offset X/Y/Z` properties in the Properties Palette for precise positioning."
      },
      "tokens_used": 7650,
      "error": null
    }
  }
}