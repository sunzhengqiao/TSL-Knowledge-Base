{
  "filename": "hsbProjectData.mcr",
  "status": "completed",
  "total_tokens": 43385,
  "processing_time": 365.9550907611847,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "This TSL sets extended user defined project data and displays it in the drawing",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "19.08.2011",
            "author": "th@hsbCAD.de",
            "changes": "configuration path modified\nbeta bugfixes"
          },
          {
            "version": "1.0",
            "date": "18.08.2011",
            "author": "th@hsbCAD.de",
            "changes": "initial"
          }
        ],
        "settingsFiles": [
          "hsbProjectDataConfig.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 7098,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses dbCreate with _kAllSpaces, but the drawing logic (dp.draw) relies on _Pt0, _XU, _YU which are intrinsic insertion coordinates typical of Model Space elements. It does not use _Viewport, sd_ prefixes, or #Type E annotations. It creates a visual representation of text data at a user-picked point."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Requires a valid MapObject setup and optionally an XML configuration file (hsbProjectDataConfig.xml). Requires the external DLL hsbProjectData.dll.",
          "requiredSettings": [
            "hsbProjectData.dll",
            "hsbProjectDataConfig.xml (optional, fallback to MapObject or defaults)"
          ]
        }
      },
      "tokens_used": 5010,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog (via callDotNetFunction2)",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "MapObject (ITWDEDICT/hsbProjectData), hsbProjectDataConfig.xml, or Defaults",
            "features": {
              "searchable": false,
              "multiSelect": true
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sName",
            "type": "PropString",
            "displayName": "|Field Name|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dTxtH",
            "type": "PropDouble",
            "displayName": "|Text Height|",
            "defaultValue": "U(20)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sHAlign",
            "type": "PropString",
            "displayName": "|Horizontal|",
            "defaultValue": "|Center|",
            "inputType": "dropdown",
            "options": [
              "|Left|",
              "|Center|",
              "|Right|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sVAlign",
            "type": "PropString",
            "displayName": "|Vertical|",
            "defaultValue": "|Center|",
            "inputType": "dropdown",
            "options": [
              "|Bottom|",
              "|Center|",
              "|Top|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "|Color|",
            "defaultValue": "3",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "hsbProjectDataConfig.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\CATALOG"
            ],
            "purpose": "Provides configuration for project data fields and default values",
            "required": false
          }
        ]
      },
      "tokens_used": 6603,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts and manages text labels displaying user-defined project metadata (such as Project Name, Number, City) within the CAD drawing.",
          "category": "Annotation/Information",
          "typicalUseCase": "Labeling drawing layouts or 3D model views with project-specific title block data (e.g., placing a 'Project Name' tag in a floor plan view)."
        },
        "parameters": [
          {
            "name": "sName",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific data field (e.g., 'Project Name', 'City', 'Revision') to display. This value acts as a key to retrieve the actual text string from the project database (MapObject).",
            "validRange": "Any label string defined in the hsbProjectData MapObject or configuration XML.",
            "unit": "string",
            "affectsOutput": "Determines which text content is rendered at the insertion point."
          },
          {
            "name": "dTxtH",
            "technicalDefault": "U(20)",
            "businessMeaning": "Defines the plotted height of the text characters.",
            "validRange": "2.5 mm to 500 mm (Typically 20-100 mm depending on plot scale)",
            "unit": "mm",
            "affectsOutput": "Scales the size of the text display. Also affects the vertical offset if multiple labels are inserted at once (stacking height)."
          },
          {
            "name": "sHAlign",
            "technicalDefault": "|Center|",
            "businessMeaning": "Controls the horizontal anchor point of the text relative to the insertion coordinate.",
            "validRange": "|Left|, |Center|, |Right|",
            "unit": "enum",
            "affectsOutput": "Aligns the text to start, center, or end at the picked insertion point."
          },
          {
            "name": "sVAlign",
            "technicalDefault": "|Center|",
            "businessMeaning": "Controls the vertical anchor point of the text relative to the insertion coordinate.",
            "validRange": "|Bottom|, |Center|, |Top|",
            "unit": "enum",
            "affectsOutput": "Aligns the text so the picked point is at the baseline, middle, or top of the text."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "Assigns the CAD Dimension Style to the text, defining the font, line type, and specific text generation standards.",
            "validRange": "Any valid Dimension Style name currently loaded in the drawing.",
            "unit": "string",
            "affectsOutput": "Changes the font and visual style attributes of the text."
          },
          {
            "name": "nColor",
            "technicalDefault": "3",
            "businessMeaning": "Sets the CAD color index for the text entity to control visibility and layering.",
            "validRange": "0 to 255 (AutoCAD Color Index)",
            "unit": "color index",
            "affectsOutput": "Changes the visual color of the text label."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Initialization via DotNet Dialog (hsbProjectData.dll)",
            "effect": "The list of available options for 'sName' is dynamically populated based on the entries found in the 'ITWDEDICT/hsbProjectData' MapObject or the XML configuration file.",
            "cascade": [
              "sName"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text Annotation",
            "description": "Visual text elements displaying project properties.",
            "appliedTo": "Model Space (inserted at user-picked points)"
          }
        ]
      },
      "tokens_used": 8898,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launched",
          "2. Check insertCycleCount (prevent double run)",
          "3. Load initial properties from Catalog (if _kExecuteKey is set)",
          "4. Determine Data Source configuration (XML vs MapObject vs Defaults)",
          "5. Synchronize current project settings (Name, Number, City) into the data map",
          "6. Launch Dynamic Dialog (hsbProjectData.dll) for user selection and input",
          "7. [Conditional] Check DialogResult (Cancel vs OK)",
          "8. Update MapObject with new values (Create new or Update existing)",
          "9. Update script properties (Color, Height, Alignment) from dialog output",
          "10. Prompt user for Insertion Point (getPoint)",
          "11. Loop through selected dialog entries",
          "12. Create new TSL instance for each selected entry at calculated offset",
          "13. Erase the manager instance",
          "14. [Instance Mode] Validate property 'sName' and set dependency on MapObject",
          "15. [Instance Mode] Retrieve Value from MapObject based on 'sName'",
          "16. [Instance Mode] Draw Text entity"
        ],
        "conditionalBranches": [
          {
            "condition": "Availability of Configuration Data (XML or MapObject) at Initialization",
            "path1": {
              "name": "Default Data",
              "steps": [
                "Check: Config file missing AND MapObject missing",
                "Action: Create default map entries (Project Name, Number, City, etc.) using standard hsbCAD project functions",
                "Action: Create MapObject in dictionary if it doesn't exist"
              ]
            },
            "path2": {
              "name": "XML Configuration",
              "steps": [
                "Check: Config file exists AND MapObject missing",
                "Action: Read map entries from 'hsbProjectDataConfig.xml'",
                "Action: Update standard fields (Name, Number) with current project data"
              ]
            },
            "path3": {
              "name": "Existing MapObject",
              "steps": [
                "Check: MapObject valid",
                "Action: Load existing entries from 'ITWDEDICT/hsbProjectData'",
                "Action: Populate dialog with current values"
              ]
            }
          },
          {
            "condition": "User Interaction in Dynamic Dialog",
            "path1": {
              "name": "Cancel",
              "steps": [
                "Check: DialogResult == 0",
                "Action: Erase Instance",
                "Action: Terminate Script"
              ]
            },
            "path2": {
              "name": "Accept / OK",
              "steps": [
                "Check: DialogResult != 0",
                "Action: Proceed to update MapObject and Geometry"
              ]
            }
          },
          {
            "condition": "MapObject Persistence State",
            "path1": {
              "name": "New Object",
              "steps": [
                "Check: MapObject invalid (bIsValid == false)",
                "Action: dbCreate new MapObject using mapOut data"
              ]
            },
            "path2": {
              "name": "Update Existing",
              "steps": [
                "Check: MapObject valid",
                "Action: Update existing values",
                "Action: Append new non-existing entries",
                "Action: Set updated map to MapObject"
              ]
            }
          },
          {
            "condition": "Visual Display Validity (Instance Mode)",
            "path1": {
              "name": "Valid MapObject",
              "steps": [
                "Check: mo.bIsValid() == true",
                "Action: Retrieve string value from map based on Label",
                "Action: Draw Value"
              ]
            },
            "path2": {
              "name": "Invalid MapObject",
              "steps": [
                "Check: mo.bIsValid() == false",
                "Action: Set text display to '???'"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases itself automatically if insertCycleCount > 1 to prevent duplicate execution."
          },
          {
            "check": "Dialog Cancellation",
            "errorMessage": "None (Silent)",
            "recovery": "If DialogResult is 0, the script instance is immediately erased and execution halts."
          },
          {
            "check": "Field Name Validity (Post-Insertion)",
            "errorMessage": "None (Silent Correction)",
            "recovery": "If 'sName' is empty or not found in the allowed list, the script automatically resets it to the first available entry in the list."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Displayed Field",
            "how": "OPM (Properties Palette) -> Field Name",
            "effect": "The text entity updates to display the value associated with the newly selected label."
          },
          {
            "action": "Update Text Appearance",
            "how": "OPM -> Text Height, Horizontal, Vertical, Color, Dimstyle",
            "effect": "The text entity immediately redraws with new size, alignment, font, or color."
          },
          {
            "action": "Move Label",
            "how": "Grip Edit (Move)",
            "effect": "The label relocates to the new position."
          },
          {
            "action": "Update Project Data",
            "how": "Update the underlying MapObject (ITWDEDICT/hsbProjectData) via external tools or the script manager",
            "effect": "All instances depending on this MapObject automatically update their displayed text values to reflect the new data."
          }
        ]
      },
      "tokens_used": 9477,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbProjectData.mcr\n\n## Overview\nInserts and manages text labels that display user-defined project metadata (such as Project Name, Number, or City) directly in the CAD drawing. It acts as a smart tag that reads data from the project database.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Primary usage environment for placing project labels. |\n| Paper Space | No | Not supported for insertion in Layouts. |\n| Shop Drawing | No | Not designed for Shop Drawing context. |\n\n## Prerequisites\n- **Required Entities**: None.\n- **Minimum Beam Count**: 0.\n- **Required Settings**:\n  - `hsbProjectData.dll` (Required).\n  - `hsbProjectDataConfig.xml` (Optional; if missing, defaults to standard hsbCAD project data).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbProjectData.mcr` from the catalog.\n\n### Step 2: Configure Project Data\nA configuration dialog will appear automatically upon insertion.\n- **Action**: Select the data fields (e.g., Project Name, Address, Revision) you want to display from the list. You can select multiple items at once.\n- **Action**: Click **OK** to confirm or **Cancel** to stop.\n\n### Step 3: Place Labels\n```\nCommand Line: Specify insertion point:\nAction: Click in the Model Space where you want the label(s) to appear.\n```\n*Note: If you selected multiple items in the previous step, they will be inserted as a stack at the clicked location.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Field Name | dropdown | (First available) | Selects the specific project data field to display (e.g., Project Name, City). |\n| Text Height | number | U(20) | Sets the height of the text characters in the drawing. |\n| Horizontal | dropdown | Center | Sets horizontal alignment relative to the insertion point (Left, Center, Right). |\n| Vertical | dropdown | Center | Sets vertical alignment relative to the insertion point (Bottom, Center, Top). |\n| Dimstyle | dropdown | (Current) | Assigns a specific Dimension Style to determine font and text appearance. |\n| Color | number | 3 | Sets the CAD color index for the text. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are configured for this script. |\n\n## Settings Files\n- **Filename**: `hsbProjectDataConfig.xml`\n- **Location**: `<Company Path>\\TSL\\CATALOG`\n- **Purpose**: Defines custom field names and default values for the project data. If this file is missing, the script uses default standard fields.\n\n## Tips\n- **Bulk Insertion**: You can insert multiple labels at once by selecting multiple fields in the initial dialog. They will be stacked vertically based on the \"Text Height\" setting.\n- **Updating Text**: If project information changes (e.g., the Project Name is updated in the main project properties), use the \"Update Project Data\" functionality (if available in your environment) or the script manager to refresh the underlying data. The labels will automatically update to reflect changes.\n- **Changing Content**: To change what a specific label displays after insertion, select the label, open the **Properties Palette**, and change the **Field Name** option.\n\n## FAQ\n- **Q: Why does my text display \"???\"?**\n  **A**: This means the script cannot find the data field specified in \"Field Name\" within the current project database. Select the label and choose a valid Field Name in the Properties Palette.\n- **Q: Can I change the font style of the label?**\n  **A**: Yes. Select the label and change the \"Dimstyle\" property in the Properties Palette to a dimension style that uses your desired font.\n- **Q: The text is too small/large when I plot.**\n  **A**: Adjust the \"Text Height\" property. Remember that this value is typically in millimeters and scales with your plot scale."
      },
      "tokens_used": 6299,
      "error": null
    }
  }
}