{
  "filename": "sd_TslDimRequest.mcr",
  "status": "completed",
  "total_tokens": 45790,
  "processing_time": 784.3118958473206,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9051,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ShopDrawing",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "Filename starts with 'sd_', script header explicitly states 'only executed by the shopdraw engine and not to be inserted in model space', uses #Type E pattern with _Entity[] and entCollector, collects ViewData from Multipage styles, specifically references MultiPageStyle and RuleSetData."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element (Multipage Sheet)",
            "TslInst (Attached TSLs providing Map data)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "ShopDrawing generation context within hsbCAD",
          "requiredSettings": [
            "MultipageStyle configuration",
            "RuleSetData in the entCollector",
            "Attached TSLs with valid 'DimRequest' Map data"
          ]
        }
      },
      "tokens_used": 5456,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getEntity",
              "promptOriginal": "Select entity",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Insertion point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Insertion (unless executed via key)",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnMapIO",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sStereotype",
            "type": "PropString",
            "displayName": "Stereotype",
            "defaultValue": "<Disabled>",
            "inputType": "dropdown",
            "options": [
              "<Disabled>",
              "*",
              "<Dynamic List from MultiPageStyles>"
            ],
            "category": "Global Chain Dimension",
            "description": "Defines the stereotype of a global chain dimension. |* = any, empty = suppress"
          },
          {
            "index": 1,
            "variable": "sDimDirection",
            "type": "PropString",
            "displayName": "Direction",
            "defaultValue": "Default",
            "inputType": "dropdown",
            "options": [
              "Default",
              "Positive View Direction",
              "Negative View Direction"
            ],
            "category": "Global Chain Dimension",
            "description": "Defines the direction of the dimension line"
          },
          {
            "index": 2,
            "variable": "sDimSide",
            "type": "PropString",
            "displayName": "Side",
            "defaultValue": "Default",
            "inputType": "dropdown",
            "options": [
              "Default",
              "Positive View Direction",
              "Negative View Direction"
            ],
            "category": "Global Chain Dimension",
            "description": "Defines the side of the dimension"
          },
          {
            "index": 3,
            "variable": "sStereotypeRadial",
            "type": "PropString",
            "displayName": "Stereotype",
            "defaultValue": "<Disabled>",
            "inputType": "dropdown",
            "options": [
              "<Disabled>",
              "*",
              "<Dynamic List from MultiPageStyles>"
            ],
            "category": "Radial Dimension",
            "description": "Defines the stereotype of a radial dimension. |* = any, empty = suppress"
          },
          {
            "index": 4,
            "variable": "sChainStereotype",
            "type": "PropString",
            "displayName": "Stereotype",
            "defaultValue": "<Disabled>",
            "inputType": "dropdown",
            "options": [
              "<Disabled>",
              "*",
              "<Dynamic List from MultiPageStyles>"
            ],
            "category": "Local Chain Dimension",
            "description": "Defines the stereotype of a local chain dimension."
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7231,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Aggregates dimension requests (points, chains, radial) from various attached scripts and transmits them to the shop drawing engine to automate dimensioning in layout views.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used automatically within a Multipage Style ruleset to ensure specific elements (beams, walls, trusses) have their dimensions (length, spacing, curvature) drawn correctly on production sheets based on TSL-generated markers."
        },
        "parameters": [
          {
            "name": "sStereotype",
            "technicalDefault": "<Disabled>",
            "businessMeaning": "Acts as a filter to determine which global chain dimensions are drawn. It matches the dimension request against specific Drawing Styles (Stereotypes) configured in the Multipage settings.",
            "validRange": "<Disabled> (none), * (all), or specific style names (e.g., 'Standard', 'Precise')",
            "unit": "String (Selection List)",
            "affectsOutput": "Controls whether global chain dimensions appear and which visual style (font, arrow size, layer) they use. '<Disabled>' hides them entirely."
          },
          {
            "name": "sDimDirection",
            "technicalDefault": "Default",
            "businessMeaning": "Sets the orientation of the dimension text along the dimension line relative to the view direction.",
            "validRange": "Default, Positive View Direction, Negative View Direction",
            "unit": "Enum",
            "affectsOutput": "Changes the reading order of dimension values (e.g., Left-to-Right vs Right-to-Left) without moving the geometry."
          },
          {
            "name": "sDimSide",
            "technicalDefault": "Default",
            "businessMeaning": "Determines the physical placement of the dimension line relative to the material outline being measured.",
            "validRange": "Default, Positive View Direction, Negative View Direction",
            "unit": "Enum",
            "affectsOutput": "Flips the dimension line from one side of the timber element to the opposite side."
          },
          {
            "name": "sStereotypeRadial",
            "technicalDefault": "<Disabled>",
            "businessMeaning": "Filters radial dimensions (arcs, circles) to be drawn, applying specific Drawing Styles for curved elements.",
            "validRange": "<Disabled> (none), * (all), or specific style names",
            "unit": "String (Selection List)",
            "affectsOutput": "Enables or disables radius/diameter dimensions on curved parts and controls their appearance."
          },
          {
            "name": "sChainStereotype",
            "technicalDefault": "<Disabled>",
            "businessMeaning": "Filters local chain dimensions (smaller, cumulative dimension strings within a single view) to be drawn.",
            "validRange": "<Disabled> (none), * (all), or specific style names",
            "unit": "String (Selection List)",
            "affectsOutput": "Controls the visibility and styling of local dimension chains (e.g., stud spacings) on the drawing."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changes in MultiPageStyle configuration",
            "effect": "The dropdown lists for sStereotype, sStereotypeRadial, and sChainStereotype automatically update to reflect the Stereotypes defined in the project's styles.",
            "cascade": [
              "sStereotype",
              "sStereotypeRadial",
              "sChainStereotype"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "DimRequestPoint",
            "description": "Logical markers defining where linear dimensions should start, end, or continue in the 2D drawing view.",
            "appliedTo": "Shop Drawing Views (Paper Space)"
          },
          {
            "type": "DimRequestRadial",
            "description": "Logical markers instructing the engine to dimension the radius or diameter of curved timber parts.",
            "appliedTo": "Shop Drawing Views (Paper Space)"
          },
          {
            "type": "DimRequestText",
            "description": "Text labels (descriptions) associated with dimension markers, placed near the geometry in the drawing.",
            "appliedTo": "Shop Drawing Views (Paper Space)"
          }
        ]
      },
      "tokens_used": 7891,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Load constants, debug settings, and property definitions.",
          "2. Execution Flow Check: Determine context (Insertion, MapIO, or Calculation).",
          "3. Insertion Mode (_bOnInsert):",
          "   - Prevent duplicate execution (eraseInstance if cycle > 1).",
          "   - Load properties from Execute Key or LastInserted catalog, or show Dialog.",
          "   - Prompt for Defining Entity (_Entity[0]).",
          "   - Prompt for Insertion Point (_Pt0).",
          "4. MapIO Mode (_bOnMapIO):",
          "   - Import properties from input Map.",
          "   - Validate and reset 'Side' and 'Direction' if needed.",
          "   - Show Dialog and export current properties to output Map.",
          "5. Calculation Mode (Normal Execution):",
          "   - Import properties if available in Map.",
          "   - Resolve dependencies: Extract Defining Entity and ViewDatas from entCollector (if in ShopDraw mode) or direct selection.",
          "   - Validation: Check if Defining Entity exists (erase if invalid).",
          "6. Data Collection Phase:",
          "   - Scan Defining Entity and sub-entities for 'Hsb_DimensionInfo' SubMaps.",
          "   - Iterate attached TSL instances and extract 'DimRequest[]' Maps.",
          "   - Filter requests: Radial dimensions are processed immediately; Point requests are aggregated.",
          "7. Geometry Processing:",
          "   - Generate Outline Profile (shadow) of the entity.",
          "   - Collect and normalize perpendicular side vectors (vecPerp) based on property settings (Default/Positive/Negative).",
          "8. Dimension Generation Loop:",
          "   - Iterate through collected Views (vecViews) and Perpendicular Sides (vecPerps).",
          "   - For each valid combination, calculate dimension points by snapping request nodes/reference points to the entity outline.",
          "   - Create DimRequestPoint objects with calculated coordinates, vectors, and stereotypes.",
          "   - Create DimRequestText objects if descriptions exist.",
          "   - Submit requests to the Shop Draw Engine (addDimRequest)."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Context",
            "path1": {
              "name": "Insertion Workflow",
              "steps": [
                "Check insertCycleCount > 1? -> Erase Instance.",
                "Check _kExecuteKey? -> Yes: Load Catalog; No: Show Dialog.",
                "Select Entity.",
                "Select Point.",
                "Finish."
              ]
            },
            "path2": {
              "name": "MapIO Workflow",
              "steps": [
                "Check for 'PROPSTRING[]' in Map? -> Yes: Load Properties.",
                "Validate/Reset Side/Direction properties.",
                "Show Dialog.",
                "Update Map.",
                "Finish."
              ]
            },
            "path3": {
              "name": "Calculation Workflow",
              "steps": [
                "Check for 'PROPSTRING[]' in Map? -> Yes: Load Properties.",
                "Validate/Reset Side/Direction properties.",
                "Get Dependencies (Entity, Collector).",
                "Validate Entity -> Erase if invalid.",
                "Collect Map Data.",
                "Process Dimensions."
              ]
            }
          },
          {
            "condition": "Data Source Strategy",
            "path1": {
              "name": "SubMapX (Direct Entity Data)",
              "steps": [
                "Identify entities with 'Hsb_DimensionInfo' SubMapX.",
                "Read 'mapRequests' key.",
                "Extract vector/point data directly from entity map."
              ]
            },
            "path2": {
              "name": "Attached TSL (Indirect Script Data)",
              "steps": [
                "Iterate TslInst array attached to entity.",
                "Get Map from TSL instance.",
                "Extract 'DimRequest[]' array.",
                "Distinguish between 'DimRequestRadial' and 'DimRequestPoint' keywords."
              ]
            }
          },
          {
            "condition": "Dimension Side Logic (sDimSide)",
            "path1": {
              "name": "Positive View Direction (Index 1)",
              "steps": [
                "Check if vecPerp is parallel to Entity X or Y.",
                "Check if vecPerp is NOT codirectional (points same way).",
                "If true, Flip vecPerp (multiply by -1)."
              ]
            },
            "path2": {
              "name": "Negative View Direction (Index 2)",
              "steps": [
                "Check if vecPerp is parallel to Entity X or Y.",
                "Check if vecPerp IS codirectional.",
                "If true, Flip vecPerp (multiply by -1)."
              ]
            },
            "path3": {
              "name": "Default (Index 0)",
              "steps": [
                "Use vecPerp exactly as defined in the request maps."
              ]
            }
          },
          {
            "condition": "Dimension Direction Logic (sDimDirection)",
            "path1": {
              "name": "Negative View Direction (Index 2)",
              "steps": [
                "Invert the ordering vector for reference points.",
                "Effect: Changes sorting order of dimension text."
              ]
            },
            "path2": {
              "name": "Default/Positive (Index 0 or 1)",
              "steps": [
                "Use standard vector for ordering reference points."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Duplicate Insertion",
            "errorMessage": "None (Silent)",
            "recovery": "Script detects if insertCycleCount > 1 and immediately calls eraseInstance() to prevent multiple instances."
          },
          {
            "check": "Defining Entity Existence",
            "errorMessage": "sd_TslDimRequest: Could not find defining entity.",
            "recovery": "If _Entity[0] is invalid or cannot be resolved, script reports error and calls eraseInstance()."
          },
          {
            "check": "Property Enum Integrity",
            "errorMessage": "None (Silent)",
            "recovery": "If 'sDimSide' or 'sDimDirection' values are not found in the dropdown arrays, the script resets them to the first valid option ('Default')."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Stereotypes / Filters",
            "how": "OPM (AutoCAD Properties) or ShowDynamicDialog",
            "effect": "Changing 'Stereotype' properties (Global, Radial, Local Chain) immediately filters which attached dimension requests are actually processed and drawn in the Shop Drawing."
          },
          {
            "action": "Flip Dimensions",
            "how": "OPM (AutoCAD Properties) or ShowDynamicDialog",
            "effect": "Changing 'Direction' or 'Side' properties recalculates the placement and orientation of dimension lines relative to the view or material."
          },
          {
            "action": "Geometry Update",
            "how": "Update Model (Stretch/Move Beams)",
            "effect": "Because the script collects data dynamically from attached entities, if the timber element changes size/shape, the script automatically calculates new dimension positions on the next regeneration."
          }
        ]
      },
      "tokens_used": 9493,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# sd_TslDimRequest.mcr\n\n## Overview\nThis script acts as a dimensioning manager for Shop Drawings. It collects dimension requests generated by other attached scripts (TSLs) and transmits them to the shop drawing engine to automatically generate dimensions in layout views.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is intended for Shop Drawing generation only and should not be manually inserted in model space. |\n| Paper Space | Yes | It functions within the context of generating shop drawing layouts. |\n| Shop Drawing | Yes | This is the primary environment where the script executes automatically via rulesets. |\n\n## Prerequisites\n- **Required Entities**: An Element (representing the Multipage Sheet) and attached TSL instances (scripts) that contain valid dimension request data (Maps).\n- **Minimum Beam Count**: 0 (It processes the Element or attached data, not beams directly).\n- **Required Settings**:\n    - A configured **MultipageStyle** containing defined Stereotypes for dimensions.\n    - **RuleSetData** configured in the entity collector.\n    - Attached TSLs must output \"DimRequest\" map data for this script to find.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `sd_TslDimRequest.mcr`\n*Note: Typically, this script is launched automatically by the Shop Drawing engine based on your Multipage Style configuration, rather than manual insertion.*\n\n### Step 2: Select Entity\n```\nCommand Line: Select entity\nAction: Click on the Element (Multipage Sheet) or the construction entity that has the dimension data attached.\n```\n\n### Step 3: Define Location\n```\nCommand Line: Insertion point\nAction: Click in the drawing to specify the insertion point for the script instance.\n```\n\n### Step 4: Configure Properties\nAfter insertion, select the script instance and open the **Properties Palette** (Ctrl+1) to configure which dimensions are drawn and how they are displayed.\n\n## Properties Panel Parameters\n\n### Global Chain Dimension\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Stereotype | dropdown | <Disabled> | Selects the visual style to apply. `*` uses any style, `<Disabled>` hides these dimensions. |\n| Direction | dropdown | Default | Sets the reading direction of the dimension text (e.g., Left-to-Right). |\n| Side | dropdown | Default | Determines which side of the element the dimension line is placed on. |\n\n### Radial Dimension\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Stereotype | dropdown | <Disabled> | Selects the visual style for radius/diameter dimensions. `*` applies to all curved parts. |\n\n### Local Chain Dimension\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Stereotype | dropdown | <Disabled> | Selects the visual style for local chain dimensions (e.g., stud spacing). |\n\n## Right-Click Menu Options\nNone.\n\n## Settings Files\n- **Configuration Source**: MultipageStyles (Project/Database)\n- **Purpose**: Defines the \"Stereotypes\" available in the dropdown lists. These settings control arrow styles, text height, and layers for the dimensions generated by this script.\n\n## Tips\n- **Filtering Views**: Use specific Stereotype names (instead of `*`) to control which dimensions appear on different drawing layouts. For example, use a \"Precise\" stereotype for detail views and \"Standard\" for general views.\n- **Fixing Overlaps**: If dimensions overlap with geometry or other notes, change the **Side** property (e.g., from \"Default\" to \"Negative View Direction\") to flip the dimension line to the opposite side.\n- **Reading Order**: If dimension text reads backwards (Right-to-Left), change the **Direction** property to \"Positive View Direction\".\n- **Troubleshooting Missing Dimensions**: If dimensions do not appear, ensure that attached TSLs (like connection scripts) are actually generating \"DimRequest\" data and that the **Stereotype** filter in this script isn't set to `<Disabled>`.\n\n## FAQ\n- **Q: Why don't I see any dimensions even though I inserted the script?**\n  - A: Check the **Stereotype** properties in the palette. If they are set to `<Disabled>`, dimensions will be hidden. Also, verify that the Element has other scripts attached to it that provide dimension data.\n- **Q: Can I use this to dimension a single beam in Model Space?**\n  - A: No, this script is designed specifically for the Paper Space Shop Drawing environment.\n- **Q: What does the \"*\" option in Stereotype do?**\n  - A: It acts as a wildcard, allowing the script to process any dimension requests regardless of their specific assigned style name."
      },
      "tokens_used": 6668,
      "error": null
    }
  }
}