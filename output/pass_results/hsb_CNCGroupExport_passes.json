{
  "filename": "hsb_CNCGroupExport.mcr",
  "status": "completed",
  "total_tokens": 34591,
  "processing_time": 196.934228181839,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "01.08.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "01.08.2011",
            "author": null,
            "changes": "Implement export of selected entities 17.1.15"
          },
          {
            "version": "1.3",
            "date": "03/08/2022",
            "author": "Robert Pol",
            "changes": "Add option to select the current delivery"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5319,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses `_kModelSpace` specifically when collecting entities via `Group().collectEntities(...)`. It targets `Element` and `Entity` objects in the model for export. There are no references to `sd_` prefixes, `_Viewport`, or paper space specific constructs like `_kPaperSpace`."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Entity"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Exporter Groups configuration in ModelMap",
            "Exporter Shortcuts configuration in ModelMap"
          ]
        }
      },
      "tokens_used": 2936,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": "Properties Dialog",
              "condition": "!_kExecuteKey",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select a set of entities|",
              "condition": "strExportOp index is 1 (Select entities in drawing)",
              "required": true
            },
            {
              "step": 3,
              "function": "PrEntity",
              "promptOriginal": "|Select a set of elements|",
              "condition": "strExportOp index is 3 (Select elements in drawing)",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strExportOp",
            "type": "PropString",
            "displayName": "Elements to export",
            "defaultValue": "Select all entities in drawing",
            "inputType": "dropdown",
            "options": [
              "Select all entities in drawing",
              "Select entities in drawing",
              "Select all elements in drawing",
              "Select elements in drawing",
              "Select current delivery"
            ],
            "category": "|Export|",
            "description": null
          },
          {
            "index": 1,
            "variable": "pGroup",
            "type": "PropString",
            "displayName": "|Exporter group|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "<Dynamic list from ModelMap Exporter Groups>"
            ],
            "category": "|Export|",
            "description": "|Select the group that needs to be exported. If empty the single export is used|"
          },
          {
            "index": 2,
            "variable": "pShortcut",
            "type": "PropString",
            "displayName": "|Single export|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "<Dynamic list from ModelMap Exporter Shortcuts>"
            ],
            "category": "|Export|",
            "description": "|Select the single export that needs to be exported. If empty the group export is used|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "_kExecuteKey",
            "handler": "Execute Key",
            "action": "Sets properties from catalog based on _kExecuteKey. If found, bypasses the dialog.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "ModelMap Configuration",
            "searchPaths": [
              "_kPathHsbCompany",
              "_kPathHsbInstall"
            ],
            "purpose": "Provides the list of 'Exporter Groups' and 'Exporter Shortcuts' for the dropdown properties.",
            "required": true
          }
        ]
      },
      "tokens_used": 6528,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the export of CNC and production data for timber components based on specific Machine configurations and project delivery phases.",
          "category": "Production / Manufacturing",
          "typicalUseCase": "Used when the design is complete and the user needs to generate machine files (e.g., BTL, Posex, Weinmann) for the entire project, a specific delivery lot, or a user-selected set of beams."
        },
        "parameters": [
          {
            "name": "strExportOp",
            "technicalDefault": "Select all entities in drawing",
            "businessMeaning": "Determines the selection scope of the timber components to be included in the export file. It filters the model to ensure only the relevant production data is processed.",
            "validRange": "Select all entities in drawing, Select entities in drawing, Select all elements in drawing, Select elements in drawing, Select current delivery",
            "unit": "List",
            "affectsOutput": "Controls which specific beams and elements appear in the resulting CNC/Production export file."
          },
          {
            "name": "pGroup",
            "technicalDefault": "",
            "businessMeaning": "Selects a named collection of export configurations (Exporter Group) defined in the ModelMap. This allows exporting to multiple machines or formats simultaneously (e.g., a CNC machine and a labeling machine).",
            "validRange": "Dynamic list from ModelMap configuration",
            "unit": "String",
            "affectsOutput": "Determines which formats and machine targets are included in the export package. If a group is selected, it overrides the single export."
          },
          {
            "name": "pShortcut",
            "technicalDefault": "",
            "businessMeaning": "Selects a specific single export configuration (Shortcut) defined in the ModelMap. This is used for exporting to a single specific machine or file format.",
            "validRange": "Dynamic list from ModelMap configuration",
            "unit": "String",
            "affectsOutput": "Determines the specific format and data structure of the output file. This is used if no Exporter Group is specified."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "pGroup is set to empty (\"\")",
            "effect": "The script ignores the Group setting and uses the value from 'pShortcut' to define the export configuration.",
            "cascade": [
              "pShortcut"
            ]
          },
          {
            "trigger": "strExportOp is set to 'Select current delivery'",
            "effect": "The script reads the Project Delivery Map to filter elements, ignoring entities not assigned to the active delivery ID.",
            "cascade": [
              "Project Map Data",
              "_Entity Collection"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Manufacturing Files / CNC Data",
            "description": "Generates external data files (such as BTL, Posex, or machine-specific formats) containing geometry, tooling, and material information. No physical geometry is drawn in the CAD model.",
            "appliedTo": "The set of Entities or Elements determined by the 'Elements to export' parameter."
          }
        ]
      },
      "tokens_used": 5881,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Insertion: User inserts 'hsb_CNCGroupExport' into the drawing.",
          "2. Initialization: Script sets unit to mm and initializes properties from catalog or defaults.",
          "3. [Conditional] Input Method: Script checks for an '_kExecuteKey'. If present, properties load silently; otherwise, the Properties Palette (Dialog) is shown.",
          "4. [Conditional] Entity Collection: Based on the 'Elements to export' (strExportOp) selection, the script gathers entities.",
          "   a. All Entities: Collects all entities in ModelSpace.",
          "   b. Select Entities: Prompts user to select entities.",
          "   c. All Elements: Collects all elements and their sub-entities.",
          "   d. Select Elements: Prompts user to select elements and collects their sub-entities.",
          "   e. Current Delivery: Reads Project Maps to filter elements assigned to the active delivery.",
          "5. Export Configuration: Resolves the export target. Uses 'Exporter group' if set, otherwise falls back to 'Single export'.",
          "6. Export Execution: Sets specific ModelMap flags (Solids, Tooling, Hardware, etc.) and calls 'ModelMap().callExporter' to generate files.",
          "7. Completion: Reports success or failure. Script calls 'eraseInstance()' to remove itself from the drawing."
        ],
        "conditionalBranches": [
          {
            "condition": "Check for Execute Key (_kExecuteKey) on insertion",
            "path1": {
              "name": "Catalog/Silent Mode",
              "steps": [
                "Check if _kExecuteKey exists in TSL Catalog",
                "If found, set properties from that Catalog entry",
                "Bypass Properties Palette"
              ]
            },
            "path2": {
              "name": "Interactive Mode",
              "steps": [
                "Verify _kExecuteKey is empty or invalid",
                "Load properties from '_LastInserted' catalog",
                "Open Properties Palette (showDialog) for user input"
              ]
            }
          },
          {
            "condition": "Elements to export (strExportOp) selection",
            "path1": {
              "name": "All Entities (Index 0)",
              "steps": [
                "Call Group().collectEntities for all Entities in ModelSpace",
                "Append to internal list"
              ]
            },
            "path2": {
              "name": "Select Entities (Index 1)",
              "steps": [
                "Prompt user with PrEntity",
                "If user confirms (go()), append selected entities to list"
              ]
            },
            "path3": {
              "name": "All Elements (Index 2)",
              "steps": [
                "Collect all Elements in ModelSpace",
                "Loop through elements",
                "Append Element and all entities in its elementGroup"
              ]
            },
            "path4": {
              "name": "Select Elements (Index 3)",
              "steps": [
                "Prompt user with PrEntity for Elements",
                "If user confirms, loop through selection",
                "Append Element and all entities in its elementGroup"
              ]
            },
            "path5": {
              "name": "Current Delivery (Index 4)",
              "steps": [
                "Read 'Hsb_Delivery' map to get active delivery ID",
                "Iterate through 'Delivery[]' map",
                "Find map matching active delivery ID",
                "Extract 'ENTITY' maps from matched delivery",
                "Append entities to list with specific quantities"
              ]
            }
          },
          {
            "condition": "Determination of Export Configuration",
            "path1": {
              "name": "Group Export",
              "steps": [
                "Check if pGroup property is not empty",
                "Use pGroup value as the exporter identifier"
              ]
            },
            "path2": {
              "name": "Single Export",
              "steps": [
                "Check if pGroup property is empty",
                "Use pShortcut property as the exporter identifier"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Catalog Key Validity",
            "errorMessage": "None (Handled silently)",
            "recovery": "If _kExecuteKey is not found in the catalog list, the script defaults to loading '_LastInserted' settings."
          },
          {
            "check": "Entity Selection Cancellation",
            "errorMessage": "None (Handled by flow)",
            "recovery": "If the user cancels the PrEntity prompt (options 1 or 3), the script proceeds to export with an empty list (or previously collected list), likely resulting in an empty export file or a generic export error."
          },
          {
            "check": "Exporter Execution",
            "errorMessage": "\"\\nTsl::callExporter failed.\"",
            "recovery": "User must verify that 'Exporter Group' or 'Single Export' names exist in the ModelMap configuration and that the destination folder is accessible."
          },
          {
            "check": "Insertion Cycle",
            "errorMessage": "None",
            "recovery": "If insertCycleCount() > 1, the script automatically erases itself to prevent duplicate execution."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Script Self-Deletion",
            "how": "Automatic",
            "effect": "The script instance is immediately erased from the drawing database after execution. No OPM changes, grip edits, or context menu interactions are possible post-insertion."
          }
        ]
      },
      "tokens_used": 7842,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_CNCGroupExport\n\n## Overview\nAutomates the export of CNC and production data for timber components based on specific machine configurations or project delivery phases. It generates manufacturing files (e.g., BTL, Posex) for the entire project, specific deliveries, or user-selected objects.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in Model Space to access Elements and Entities. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: Elements or Entities (beams/walls) present in the drawing.\n- **Minimum Beam Count**: 0 (Can export an empty list if nothing is found).\n- **Required Settings**: Exporter Groups and Exporter Shortcuts must be configured in the ModelMap (Company or Install path).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_CNCGroupExport.mcr`\n\n### Step 2: Configure Export Settings\nThe Properties Palette will appear automatically upon insertion. Configure the following:\n1. **Elements to export**: Choose how to filter the model (e.g., \"Select all entities in drawing\", \"Select current delivery\", or manual selection modes).\n2. **Exporter group**: Select a predefined group of exports from the dropdown (e.g., a group containing both a CNC machine export and a Label export).\n3. **Single export**: If the \"Exporter group\" is left empty, select a specific single export shortcut (e.g., \"Weinmann CNC\").\n4. Click outside the Properties Palette or close it to execute.\n\n### Step 3: Select Objects (Conditional)\n*This step only appears if you selected \"Select entities in drawing\" or \"Select elements in drawing\" in Step 2.*\n\n**Option A: Select entities**\n```\nCommand Line: |Select a set of entities|\nAction: Click on specific beams or parts in the model. Press Enter to confirm.\n```\n\n**Option B: Select elements**\n```\nCommand Line: |Select a set of elements|\nAction: Click on whole Elements (e.g., a wall assembly) in the model. Press Enter to confirm.\n```\n\n### Step 4: Execution\nThe script processes the selected objects, generates the CNC/Production files, and then automatically removes itself from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Elements to export | dropdown | Select all entities in drawing | Determines the scope of the export. Options include all entities, all elements, manual selection, or filtering by the current project delivery. |\n| Exporter group | dropdown | (Empty) | Select a named collection of export configurations from the ModelMap. If selected, this overrides the \"Single export\" setting. |\n| Single export | dropdown | (Empty) | Select a specific single export configuration (shortcut) from the ModelMap. Used only if \"Exporter group\" is empty. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Execute Key | Sets the script properties based on a predefined Catalog Entry (Key). This allows for silent execution without opening the Properties Palette if a matching Key is found. |\n\n## Settings Files\n- **Filename**: ModelMap Configuration (`.map` or related XML configuration)\n- **Location**: `_kPathHsbCompany` or `_kPathHsbInstall`\n- **Purpose**: Defines the available \"Exporter Groups\" and \"Exporter Shortcuts\" used in the dropdown menus. Without these, the export targets cannot be resolved.\n\n## Tips\n- **Script Behavior**: This script is \"run-once.\" It will automatically delete itself from the drawing after the export is complete to prevent duplicate data.\n- **Delivery Management**: Use the \"Select current delivery\" option to quickly export only the parts assigned to the active delivery phase in your project map.\n- **Group vs. Single**: If you need to generate files for multiple machines at once (e.g., a saw and a CNC), define an \"Exporter Group\" in the ModelMap and select it here. Otherwise, use \"Single export.\"\n\n## FAQ\n- **Q: Why did the script disappear immediately after I closed the properties?**\n  - A: This is normal behavior. The script executes the export command and then runs `eraseInstance()` to clean itself up automatically.\n- **Q: The export failed. What went wrong?**\n  - A: Verify that the name you entered in \"Exporter group\" or \"Single export\" matches exactly with the names defined in your ModelMap configuration. Also, ensure you have write permissions to the destination folder.\n- **Q: Can I edit the settings after I run it?**\n  - A: No. Since the script erases itself after running, you must insert a new instance to change settings or run the export again."
      },
      "tokens_used": 6085,
      "error": null
    }
  }
}