{
  "filename": "HSB_E-ResetZoneOutlines.mcr",
  "status": "completed",
  "total_tokens": 40164,
  "processing_time": 309.5089478492737,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 7397,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity to select Element objects and logic revolves around Element properties (el.genBeam, el.zone, el.beam). No usage of sd_ functions, _Viewport, or Paper Space entities."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Elements",
          "requiredSettings": [
            "TSL script 'HSB_G-FilterGenBeams' must be loaded in the drawing to filter GenBeams",
            "Catalog entry 'ManualInsert' recommended for default property values"
          ]
        }
      },
      "tokens_used": 4587,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select element(s)",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "Insertion when _kExecuteKey is empty/default",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sTryToKeepOpenings",
            "type": "PropString",
            "displayName": "Try to keep opening information",
            "defaultValue": "|Yes|",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 1,
            "variable": "sSetZoneHeight",
            "type": "PropString",
            "displayName": "Try to set the height of the zone",
            "defaultValue": "|Yes|",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 3,
            "variable": "sSetZoneProfile",
            "type": "PropString",
            "displayName": "Try to set the zoneprofile",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 2,
            "variable": "genBeamFilterDefinition",
            "type": "PropString",
            "displayName": "Filter definition for height",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": "Filter",
            "description": "The filter definition used to filter the special beams and sheets.Use HSB_G-FilterGenBeams to define the filters."
          },
          {
            "index": 0,
            "variable": "dMaxArea",
            "type": "PropDouble",
            "displayName": "Maximun area allowed for an element",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "Filter",
            "description": "If the maximum area is exceeded, then a message will be displayed with the name of the relevant element."
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7662,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically recalculates and resets the zone outlines (2D profiles) and heights of selected timber wall or floor elements based on the actual geometry of their constituent beams and sheets.",
          "category": "Structural/ElementGeneration",
          "typicalUseCase": "Used after structural modifications (e.g., resizing studs, changing layouts) to synchronize the manufacturing zones (Zone 0-Zone 5) with the current physical construction without manual redrawing."
        },
        "parameters": [
          {
            "name": "sTryToKeepOpenings",
            "technicalDefault": "|Yes|",
            "businessMeaning": "Determines if existing cutouts (like windows or doors) in the element's current zone definition should be preserved and subtracted from the newly calculated outline.",
            "validRange": "Yes|No",
            "unit": "enum",
            "affectsOutput": "If 'Yes', the new zone outline will have holes where openings previously existed. If 'No', the outline will become a solid shape based on the beams, effectively erasing opening information."
          },
          {
            "name": "sSetZoneHeight",
            "technicalDefault": "|Yes|",
            "businessMeaning": "Controls whether the script should measure the physical thickness of the beams/sheets and update the element's zone height to match.",
            "validRange": "Yes|No",
            "unit": "enum",
            "affectsOutput": "If 'Yes', the manufacturing height (dH) of the zone is updated to the span of the filtered beams. If 'No', the existing height value is retained."
          },
          {
            "name": "sSetZoneProfile",
            "technicalDefault": null,
            "businessMeaning": "Controls whether the geometric 2D boundary (profile) of the element zones is redrawn based on the filtered beams.",
            "validRange": "Yes|No",
            "unit": "enum",
            "affectsOutput": "If 'Yes', Zone 0 is set to the convex hull of the structure, and Zones 1-5 are set to the union of the selected sheeting profiles. If 'No', the existing shapes are not modified."
          },
          {
            "name": "genBeamFilterDefinition",
            "technicalDefault": "",
            "businessMeaning": "Selects a filter preset (defined in another script) to determine which specific beams or sheets are considered part of the zone for calculation purposes.",
            "validRange": "Any valid catalog entry from HSB_G-FilterGenBeams",
            "unit": "string",
            "affectsOutput": "Filters the geometry used to calculate height and outlines. For example, it allows calculating Zone 5 height based only on 'tile laths' while ignoring 'insulation'. Incorrect filtering may lead to incorrect zone dimensions."
          },
          {
            "name": "dMaxArea",
            "technicalDefault": 0,
            "businessMeaning": "A safety threshold to warn the user if an element's calculated surface area exceeds transport or production limits.",
            "validRange": "0 to 500+ (0 disables the check)",
            "unit": "m²",
            "affectsOutput": "Generates a warning report if the element area is too large; does not alter the geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sSetZoneHeight is 'Yes'",
            "effect": "The accuracy of the height calculation depends entirely on 'genBeamFilterDefinition' including the correct vertical beams.",
            "cascade": [
              "genBeamFilterDefinition"
            ]
          },
          {
            "trigger": "sSetZoneProfile is 'Yes'",
            "effect": "For Zones > 0, the generated outline depends on 'genBeamFilterDefinition' selecting the correct sheeting layers.",
            "cascade": [
              "genBeamFilterDefinition"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "PlaneProfile (Netto Profile)",
            "description": "The updated 2D manufacturing outline for the element zones, representing the exact shape of the timber component.",
            "appliedTo": "Selected Element objects (Zones 0 through 5)"
          },
          {
            "type": "ElemZone (Properties)",
            "description": "Updated zone height (thickness) and coordinate system data based on the filtered beam extents.",
            "appliedTo": "Selected Element objects"
          },
          {
            "type": "Element Width",
            "description": "The overall width property of the element (specifically for Zone 0) is synchronized with the calculated zone height.",
            "appliedTo": "Selected Element objects"
          }
        ]
      },
      "tokens_used": 6385,
      "error": null
    },
    "5": {
      "success": true,
      "data": {},
      "tokens_used": 9260,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-ResetZoneOutlines.mcr\n\n## Overview\nAutomatically recalculates and resets the zone outlines (2D profiles) and heights of selected timber wall or floor elements to match the current geometry of their beams and sheets. This is typically used to synchronize manufacturing data after structural modifications.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on Elements in the 3D model. |\n| Paper Space | No | Not intended for 2D views or layouts. |\n| Shop Drawing | No | Not for shop drawing generation. |\n\n## Prerequisites\n- **Required Entities**: At least one hsbCAD Element (Wall or Floor).\n- **Minimum beam count**: 0 (Works on existing elements with or without sub-beams, though beams are needed for meaningful updates).\n- **Required settings**: The TSL script `HSB_G-FilterGenBeams` must be loaded in the drawing to provide filter options for selecting specific beams or sheets.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `HSB_E-ResetZoneOutlines.mcr`\n\n### Step 2: Select Elements\n```\nCommand Line: Select element(s)\nAction: Click on the Element(s) in the model you wish to update and press Enter.\n```\n\n### Step 3: Configure Properties\nThe script will insert and immediately open the Properties Palette (OPM). Adjust settings as needed and click **Apply** or close the palette to execute the calculation.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Try to keep opening information | dropdown | Yes | If 'Yes', existing openings (windows/doors) in the current zone are preserved. If 'No', the outline is calculated as a solid shape, effectively removing opening data. |\n| Try to set the height of the zone | dropdown | Yes | If 'Yes', the script measures the physical thickness of the filtered beams and updates the element's zone height. |\n| Try to set the zoneprofile | dropdown | No | If 'Yes', the 2D boundary (profile) of the element zones is redrawn based on the filtered beams (Zone 0 as convex hull, Zones 1-5 as union of sheeting). |\n| Filter definition for height | dropdown | (Empty) | Select a specific filter preset (defined in HSB_G-FilterGenBeams) to determine which beams/sheets are used to calculate the height and outline. |\n| Maximun area allowed for an element | number | 0 | Sets a safety limit (in m²). If the element's calculated area exceeds this value, a warning message is displayed. Set to 0 to disable the check. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific options to the right-click context menu. |\n\n## Settings Files\nThis script does not use its own separate settings file but relies on:\n- **Dependency**: `HSB_G-FilterGenBeams` catalog entries.\n- **Purpose**: Provides the filter logic used to select which beams/sheets define the zone height and profile.\n\n## Tips\n- **Filter Accuracy**: The correct `Filter definition` is critical. If the height is calculated incorrectly, ensure your filter includes the vertical studs or structural beams and excludes items like cladding or insulation.\n- **Resetting Outlines**: If you want to completely redraw the element shape based on the beams, set \"Try to set the zoneprofile\" to **Yes** and \"Try to keep opening information\" to **No**.\n- **Large Elements**: Use the \"Maximun area allowed for an element\" setting as a quick check to identify elements that may be too large for transport or production machinery.\n\n## FAQ\n- **Q: Why did my openings disappear after running the script?**\n  A: The \"Try to keep opening information\" parameter was likely set to \"No\". Change this to \"Yes\" and re-run to preserve cutouts for windows and doors.\n- **Q: The zone height updated to the wrong value. Why?**\n  A: Check the \"Filter definition for height\". It might be filtering only on sheets (e.g., OSB) rather than the structural studs (e.g., GenBeams), or vice versa.\n- **Q: What is the difference between Zone 0 and Zones 1-5?**\n  A: Zone 0 typically represents the overall outer contour (convex hull), while Zones 1-5 usually represent specific layers like sheeting profiles. This script updates both if the respective options are enabled."
      },
      "tokens_used": 4873,
      "error": null
    }
  }
}