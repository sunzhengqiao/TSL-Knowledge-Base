{
  "filename": "hsbTslDim.mcr",
  "status": "completed",
  "total_tokens": 57562,
  "processing_time": 522.7040936946869,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9522,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Filename hsbTslDim.mcr lacks sd_ or Multipage prefix. Uses getPoint() for interactive insertion typical of ModelSpace tools. Handles Model entities (GenBeam, Sheet, TslInst, ERoofPlane). Includes a 'Show in Modelspace' property but is primarily an interactive dimensioning tool for 3D models."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Sheet",
            "ERoofPlane",
            "Sip",
            "EntPLine",
            "TslInst"
          ],
          "minimumBeams": 0,
          "requiredSpace": "None strictly required (points can be selected without entities), entity selection is optional",
          "requiredSettings": [
            "_DimStyles"
          ]
        }
      },
      "tokens_used": 8173,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": "|_LastInserted|",
              "condition": "_bOnInsert && _kExecuteKey==\"\"",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select insertion point|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "\n|Next point| |(Defines Direction)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 4,
              "function": "PrPoint",
              "promptOriginal": "\nSelect dim point",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 5,
              "function": "PrEntity",
              "promptOriginal": "Select entities |(optional)|",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 6,
              "function": "getInt",
              "promptOriginal": "Dimpoints of entities on ... |(Default = 2)|",
              "condition": "_bOnInsert && ents.length()>0",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Insertion if _kExecuteKey is empty",
            "title": "|_LastInserted|",
            "dataSource": "TSL Instance Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "|Color|",
            "defaultValue": 9,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDisplayModeDelta",
            "type": "PropString",
            "displayName": "|Display mode| |Delta|",
            "defaultValue": "|Parallel|",
            "inputType": "dropdown",
            "options": [
              "|Parallel|",
              "|Perpendicular|",
              "|None|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sDisplayModeChain",
            "type": "PropString",
            "displayName": "|Display mode| |Chain|",
            "defaultValue": "|Parallel|",
            "inputType": "dropdown",
            "options": [
              "|Parallel|",
              "|Perpendicular|",
              "|None|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sMirrorDim",
            "type": "PropString",
            "displayName": "|Mirror read direction|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sDeltaOnTop",
            "type": "PropString",
            "displayName": "|Delta on Top|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sAlias",
            "type": "PropString",
            "displayName": "|Description Alias|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dLinearScale",
            "type": "PropDouble",
            "displayName": "|Linear Scale Factor|",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sTslToDim",
            "type": "PropString",
            "displayName": "|TSL Name|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "|Separate multiple TSL entries by| ';'"
          },
          {
            "index": 6,
            "variable": "sAddDims",
            "type": "PropString",
            "displayName": "|additional dimpoints|",
            "defaultValue": "|None|",
            "inputType": "dropdown",
            "options": [
              "|None|",
              "|Drills|",
              "|TSL's|",
              "|TSL's also from linked Element|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "sShowInModel",
            "type": "PropString",
            "displayName": "|Show in Modelspace|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "sSpecialMode",
            "type": "PropString",
            "displayName": "|Mode|",
            "defaultValue": "|Default|",
            "inputType": "dropdown",
            "options": [
              "|Default|",
              "|Opening embraced by GenBeams|"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Edit points of entities (sTrigger[12])",
            "handler": "sTrigger[12]",
            "action": "Converts entity dimpoints to grips and clears entity selection",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "Catalog (via _kExecuteKey)",
            "searchPaths": [
              "hsbCAD Catalog"
            ],
            "purpose": "Set properties from catalog entry if execution key is provided",
            "required": false
          }
        ]
      },
      "tokens_used": 9154,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates associative dimension lines for timber elements (beams, sheets, planes) and their sub-components (TSLs, drills) within the 3D model, providing accurate measurement annotations that update with design changes.",
          "category": "Annotation / Modeling",
          "typicalUseCase": "Used by detailers to label critical dimensions such as beam lengths, opening widths, or spacing of connectors directly in the 3D model to ensure construction accuracy before manufacturing."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Determines the visual standard of the dimension (text size, arrow style, units) based on the project's drafting standards or CAD configuration.",
            "validRange": "Any string matching a defined DimStyle in the drawing environment.",
            "unit": "String",
            "affectsOutput": "Alters the graphic appearance (font size, tick marks, precision) of the dimension line."
          },
          {
            "name": "nColor",
            "technicalDefault": 9,
            "businessMeaning": "Assigns a specific CAD color to the dimension to distinguish it from geometry or other annotations (e.g., red for critical dims).",
            "validRange": "0-255 (Standard CAD Index Colors)",
            "unit": "Index",
            "affectsOutput": "Changes the display color of the dimension lines and text."
          },
          {
            "name": "sDisplayModeDelta",
            "technicalDefault": "|Parallel|",
            "businessMeaning": "Controls how the individual (delta) dimension text/ticks align relative to the dimension line.",
            "validRange": "|Parallel|, |Perpendicular|, |None|",
            "unit": "Enum",
            "affectsOutput": "Rotates the dimension text or tick marks for individual measurements."
          },
          {
            "name": "sDisplayModeChain",
            "technicalDefault": "|Parallel|",
            "businessMeaning": "Controls how the chain (cumulative) dimension segments align relative to the dimension line.",
            "validRange": "|Parallel|, |Perpendicular|, |None|",
            "unit": "Enum",
            "affectsOutput": "Rotates the dimension text or tick marks for chain measurements."
          },
          {
            "name": "sMirrorDim",
            "technicalDefault": "|No|",
            "businessMeaning": "Forces the dimension text to be readable from a specific direction, effectively mirroring the text if the dimension is viewed upside-down.",
            "validRange": "|No|, |Yes|",
            "unit": "Enum",
            "affectsOutput": "Flips the orientation of the dimension text (e.g., from upside-down to right-side-up)."
          },
          {
            "name": "sDeltaOnTop",
            "technicalDefault": "|No|",
            "businessMeaning": "Moves the specific measurement text (delta) above the dimension line instead of breaking the line to place text inside it.",
            "validRange": "|No|, |Yes|",
            "unit": "Enum",
            "affectsOutput": "Relocates the dimension text value to above the line."
          },
          {
            "name": "sAlias",
            "technicalDefault": "",
            "businessMeaning": "Allows the user to add a custom text description (label) next to the dimension, such as 'Ridge' or 'Opening Width'.",
            "validRange": "Alphanumeric string (auto-wrapped if > 20 chars).",
            "unit": "String",
            "affectsOutput": "Displays the custom text label at the start of the dimension."
          },
          {
            "name": "dLinearScale",
            "technicalDefault": 1,
            "businessMeaning": "Scales the numerical value displayed by the dimension (e.g., displaying meters while the model is in mm, or scaling for drawings).",
            "validRange": "> 0 (Standard 1.0 = true size).",
            "unit": "Factor",
            "affectsOutput": "Multiplies the displayed number by this factor."
          },
          {
            "name": "sTslToDim",
            "technicalDefault": "",
            "businessMeaning": "Filters which specific TSL (Timber Script Language) connectors or smart entities should be included in the dimensioning.",
            "validRange": "Semicolon-separated list of TSL script names.",
            "unit": "String",
            "affectsOutput": "Restricts dimension points to only origins of TSLs matching the names in the list."
          },
          {
            "name": "sAddDims",
            "technicalDefault": "|None|",
            "businessMeaning": "Automatically includes dimension points for sub-components attached to the main beam, such as drill holes or hardware connectors.",
            "validRange": "|None|, |Drills|, |TSL's|, |TSL's also from linked Element|",
            "unit": "Enum",
            "affectsOutput": "Adds additional dim points for drills or TSL origins along the measured entity."
          },
          {
            "name": "sShowInModel",
            "technicalDefault": "|No|",
            "businessMeaning": "Toggles the visibility of the dimension in the 3D ModelSpace. Useful for keeping the 3D view clean or checking dimensions spatially.",
            "validRange": "|No|, |Yes|",
            "unit": "Enum",
            "affectsOutput": "Hides or shows the dimension entity in the 3D model view."
          },
          {
            "name": "sSpecialMode",
            "technicalDefault": "|Default|",
            "businessMeaning": "Switches the logic to dimension the size of openings enclosed by beams rather than the beams themselves.",
            "validRange": "|Default|, |Opening embraced by GenBeams|",
            "unit": "Enum",
            "affectsOutput": "Calculates and dimensions the clear width/height of openings formed by selected beams."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sAddDims is set to |TSL's| or |TSL's also from linked Element|",
            "effect": "The value of sTslToDim is used to filter which TSLs generate dimension points.",
            "cascade": [
              "sTslToDim"
            ]
          },
          {
            "trigger": "Script is attached to a single TslInst entity",
            "effect": "The dLinearScale parameter is automatically overwritten by the 'scale' property of the attached TSL instance.",
            "cascade": [
              "dLinearScale"
            ]
          },
          {
            "trigger": "sSpecialMode is set to |Opening embraced by GenBeams|",
            "effect": "The dimension points are derived from the shadow profile of the beams rather than their endpoints or sub-components.",
            "cascade": [
              "sAddDims",
              "sTslToDim"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Dimension (Dim)",
            "description": "A graphical object displaying measurement values and extension lines based on calculated points.",
            "appliedTo": "ModelSpace or Drawing generation context, anchored at user-defined points or derived entity geometry."
          },
          {
            "type": "Text Annotation",
            "description": "Optional custom text labels derived from the sAlias parameter.",
            "appliedTo": "Located at the origin point of the dimension."
          }
        ]
      },
      "tokens_used": 10467,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User initiates script insert (hsbTslDim)",
          "Check insert cycle count; if > 1, erase instance and exit",
          "Check execution key (_kExecuteKey)",
          "  [Branch] If empty: Show properties dialog to user",
          "  [Branch] If set: Load property preset from catalog",
          "Prompt user for Insertion Point (_Pt0)",
          "Prompt user for 'Next Point' to define Direction Vector (vx)",
          "Validate Direction Point; if invalid, erase instance and exit",
          "Loop: Prompt user to select Dimension Points",
          "  Append points to grip list (_PtG) and map storage until user cancels",
          "Prompt user to select Entities (Beams, Sheets, etc.) - Optional",
          "  [Branch] If entities selected: Prompt for 'Dimpoints side' (Left/Right/Center)",
          "  Store entities and their side settings in the instance map",
          "Finish Insertion; Instance is created in ModelSpace",
          "Start Calculation Cycle (_bOnRecalc)",
          "Retrieve Direction Vector (vx) and construct local coordinate system",
          "Check for 'specialMode' in map on DB creation",
          "Collect Entities from map submap 'Entity[]' into internal list",
          "Check Entity Count for Scale Dependency",
          "  [Branch] If count == 1 and Entity is TslInst: Override Linear Scale with TSL's scale property",
          "Validate Linear Scale (must be > 0)",
          "Parse 'sTslToDim' string into TSL name filter array",
          "Check 'sSpecialMode' (Mode)",
          "  [Branch] Default: Calculate dimpoints from entity geometry (Endpoints/Center)",
          "    Filter and Append Drill points (if 'sAddDims' allows)",
          "    Filter and Append TSL points (if 'sAddDims' allows and names match)",
          "  [Branch] Opening embraced by GenBeams: Generate shadow profiles of beams",
          "    Union profiles and identify Opening Rings",
          "    Calculate extents of openings in vx direction",
          "    Add extents as dimpoints",
          "Check for Trigger 12 (Edit points of entities)",
          "  [Branch] If Triggered: Convert all calculated entity points to manual grips",
          "    Clear internal entity list to stop automatic recalculation of those points",
          "Assemble final list of points (Grips + Entity Points + Drills + TSLs)",
          "Order points along the dimension line (unless reference point exists)",
          "Create Dimension Entity with specified style, color, and display modes",
          "Calculate Read Direction based on Screen Coordinates and Mirror setting",
          "Draw Dimension and optional Alias Text",
          "Assign instance to groups defined in map"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Key (_kExecuteKey) presence during insertion",
            "path1": {
              "name": "Manual Configuration",
              "steps": [
                "Show Dynamic Dialog",
                "User manually sets properties (Dimstyle, Color, etc.)"
              ]
            },
            "path2": {
              "name": "Catalog Preset",
              "steps": [
                "Skip Dialog",
                "Execute setPropValuesFromCatalog(_kExecuteKey)"
              ]
            }
          },
          {
            "condition": "Entity Selection and Scale Factor",
            "path1": {
              "name": "Single TSL Dependency",
              "steps": [
                "Attached to exactly one TslInst entity",
                "Read 'scale' property from attached TSL map",
                "Overwrite dLinearScale property"
              ]
            },
            "path2": {
              "name": "Standard/Independent",
              "steps": [
                "Zero or multiple entities attached",
                "Use dLinearScale property value defined by user or catalog",
                "Clamp value to minimum of 1.0 if invalid"
              ]
            }
          },
          {
            "condition": "Special Mode (sSpecialMode) setting",
            "path1": {
              "name": "Default Mode",
              "steps": [
                "Iterate selected entities",
                "Calculate endpoints or center points based on 'dimSide' map setting",
                "Collect points from Drills/TSLs if 'sAddDims' is configured"
              ]
            },
            "path2": {
              "name": "Opening Embraced by GenBeams",
              "steps": [
                "Filter entities for GenBeams",
                "Create shadow profiles on the dimension plane",
                "Union profiles to find solid mass",
                "Identify inner rings (holes/openings)",
                "Calculate opening extents (width) along dimension vector"
              ]
            }
          },
          {
            "condition": "Trigger 12 (Context Menu: Edit points of entities)",
            "path1": {
              "name": "Convert to Static",
              "steps": [
                "Take all currently calculated entity points",
                "Add them to the manual grip list (_PtG)",
                "Remove entity associations from map and internal list",
                "Future updates ignore entity geometry, only grips move"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None (Silent fail)",
            "recovery": "Script erases itself immediately if run more than once per insert command"
          },
          {
            "check": "Direction Point Definition",
            "errorMessage": "None (Script Exit)",
            "recovery": "If user fails to pick a valid second point to define direction, the script erases the instance (erasesInstance)"
          },
          {
            "check": "Linear Scale Factor Validity",
            "errorMessage": "None (Auto-Correction)",
            "recovery": "If dLinearScale <= 0, it is automatically reset to 1.0"
          },
          {
            "check": "Entity 'dimSide' Input",
            "errorMessage": "None (Auto-Correction)",
            "recovery": "If user input for dimpoints side is < 0 or > 3, it defaults to 2 (Left and Right)"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Dimension Appearance",
            "how": "OPM (Object Properties Palette)",
            "effect": "Updates DimStyle, Color, Display Modes (Parallel/Perpendicular), Mirror Direction, and Delta placement instantly upon recalculation."
          },
          {
            "action": "Edit Points / Convert to Manual",
            "how": "Right-click Context Menu -> 'Edit points of entities'",
            "effect": "Breaks the link to the timber entities. The calculated dimension points become manual grips (PrPoint), allowing free positioning independent of the beams."
          },
          {
            "action": "Modify Dimension Geometry",
            "how": "Grip Edit (Drag handles)",
            "effect": "Moves the insertion point, direction, or individual dimension points. The dimension line and values update dynamically."
          },
          {
            "action": "Update via Entity Modification",
            "how": "Stretch/Move connected Beams or Sheets (if not converted to manual points)",
            "effect": "The script detects the change in the associated entities and recalculates the dimension points to match the new geometry."
          }
        ]
      },
      "tokens_used": 12069,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbTslDim.mcr\n\n## Overview\nThis script creates associative dimension lines for timber elements (beams, sheets, planes) and their sub-components (like drill holes or TSL connectors) directly in the 3D model. It provides accurate measurement annotations that automatically update if the design geometry changes.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This is the primary environment for interactive placement and viewing. |\n| Paper Space | No | This script does not generate dimensions in layout views. |\n| Shop Drawing | No | Not intended for automatic shop drawing generation. |\n\n## Prerequisites\n- **Required Entities**: None strictly required (points can be selected manually), but typically used with `GenBeam`, `Sheet`, `ERoofPlane`, or `TslInst`.\n- **Minimum Beam Count**: 0.\n- **Required Settings**: `_DimStyles` (Standard CAD dimension styles must be available in the drawing).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbTslDim.mcr`\n\n### Step 2: Configure Properties\n```\nDialog Box: [Properties Dialog]\nAction: Verify settings (DimStyle, Color, etc.) and click OK.\n```\n\n### Step 3: Set Insertion Point\n```\nCommand Line: Select insertion point\nAction: Click in the model where you want the dimension line to start.\n```\n\n### Step 4: Define Direction\n```\nCommand Line: Next point (Defines Direction)\nAction: Click a second point to set the direction and angle of the dimension line.\n```\n\n### Step 5: Add Manual Points (Optional)\n```\nCommand Line: Select dim point\nAction: Click specific points you want to dimension. Press **Enter** or **Esc** to finish adding points and proceed.\n```\n\n### Step 6: Select Entities (Optional)\n```\nCommand Line: Select entities (optional)\nAction: Select beams, sheets, or other elements to automatically generate dimension points based on their geometry. Press **Enter** to finish selection.\n```\n\n### Step 7: Define Entity Side (If Entities Selected)\n```\nCommand Line: Dimpoints of entities on ... (Default = 2)\nAction: Enter a number to define which side of the entity to dimension (e.g., 1 for Left, 2 for Right, 3 for Center).\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimstyle | dropdown | _DimStyles | Selects the visual style (text size, arrows) for the dimension. |\n| Color | number | 9 | Sets the CAD color index for the dimension line and text. |\n| Display mode Delta | dropdown | Parallel | Controls how individual (delta) dimension text aligns relative to the line. Options: Parallel, Perpendicular, None. |\n| Display mode Chain | dropdown | Parallel | Controls how cumulative chain dimension segments align. Options: Parallel, Perpendicular, None. |\n| Mirror read direction | dropdown | No | If Yes, flips the text orientation so it is readable from the opposite side. |\n| Delta on Top | dropdown | No | If Yes, moves the dimension text above the line instead of breaking the line. |\n| Description Alias | text | | Adds a custom text label (e.g., \"Ridge\") at the start of the dimension. |\n| Linear Scale Factor | number | 1 | Multiplies the displayed dimension value (e.g., use 0.001 to convert mm to m). |\n| TSL Name | text | | Filters which specific TSL connectors are dimensioned. Separate multiple names with a semicolon (;). |\n| additional dimpoints | dropdown | None | Automatically includes points for Drills or TSLs connected to the selected entities. |\n| Show in Modelspace | dropdown | No | Toggles the visibility of the dimension in the 3D model. |\n| Mode | dropdown | Default | Switches logic to \"Opening embraced by GenBeams\" to dimension clear openings within a wall frame. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Edit points of entities | Breaks the link to the timber entities. Converts all currently calculated dimension points into manual grip points, allowing you to move them independently without affecting the original beams. |\n\n## Settings Files\n- **Filename**: Catalog Entries (defined in `_kExecuteKey`)\n- **Location**: hsbCAD Catalog\n- **Purpose**: Allows you to save predefined property sets (presets) so you don't have to manually configure the dialog every time.\n\n## Tips\n- **Dimensioning Openings**: To find the width of a window or door opening in a frame, set the **Mode** property to \"Opening embraced by GenBeams\" and select the surrounding beams.\n- **Filtering Hardware**: If you only want to dimension specific connectors (like screws), type the name of that TSL script into the **TSL Name** property and set **additional dimpoints** to \"TSL's\".\n- **Static Dimensions**: If you want to keep a dimension even if you delete or move the beam later, use the \"Edit points of entities\" right-click option to freeze the points.\n\n## FAQ\n- **Q: How do I display dimensions in meters instead of millimeters?**\n  **A:** Change the **Linear Scale Factor** property to `0.001`.\n- **Q: My dimension text is upside down. How do I fix it?**\n  **A:** Set the **Mirror read direction** property to \"Yes\".\n- **Q: Can I mix manual points and automatic entity dimensions?**\n  **A:** Yes. You can pick manual points in Step 5 and then select entities in Step 6. The script will combine them into one dimension line."
      },
      "tokens_used": 8177,
      "error": null
    }
  }
}