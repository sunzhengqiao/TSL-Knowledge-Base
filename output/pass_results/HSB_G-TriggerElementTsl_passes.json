{
  "filename": "HSB_G-TriggerElementTsl.mcr",
  "status": "completed",
  "total_tokens": 25267,
  "processing_time": 517.1181800365448,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl will trigger a tsl in a viewport",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "06.02.2017",
            "author": "RP",
            "changes": "First version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4213,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses getViewport() during insertion and stores the result in the _Viewport property array. Retrieves the Element using vp.element(). Explicitly prompts user to 'Select a viewport', indicating operation in a Layout environment."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "A Layout (Paper Space) containing a Viewport linked to an Element",
          "requiredSettings": []
        }
      },
      "tokens_used": 2902,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "|Select a viewport|",
              "condition": "_bOnInsert && insertCycleCount() == 1",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select a position|",
              "condition": "_bOnInsert && insertCycleCount() == 1",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dimStyle",
            "type": "PropString",
            "displayName": "|Dimension style text|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "tslName",
            "type": "PropString",
            "displayName": "|Tsl to trigger|",
            "defaultValue": "HSB_E-Replicator",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "executekey",
            "type": "PropString",
            "displayName": "|Execute Key|",
            "defaultValue": "setInViewport",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "setInViewport",
            "handler": "setInViewport",
            "action": "Finds the TSL instance defined in 'tslName' within the viewport's element and executes recalcNow with 'executekey'.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 2499,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A layout-based remote control that sends a command signal to a specific TSL instance located within the 3D model shown in a selected viewport.",
          "category": "Automation/Control",
          "typicalUseCase": "Refreshing or updating a specific data label, list, or graphical element on a 2D drawing (such as an element replicator) without manually opening and editing the 3D element properties."
        },
        "parameters": [
          {
            "name": "dimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Defines the visual style (font, size, color) of the text label that identifies this trigger instance on the 2D layout.",
            "validRange": "Any valid Dimension Style name available in the current CAD project",
            "unit": "Text Style",
            "affectsOutput": "Changes the appearance (height, font, arrowheads) of the label text marking the trigger location in Paper Space."
          },
          {
            "name": "tslName",
            "technicalDefault": "HSB_E-Replicator",
            "businessMeaning": "The specific script (TSL) attached to the 3D Element in the viewport that should receive the trigger command. This defines the target component to be updated.",
            "validRange": "Any valid TSL file name currently assigned to the Element within the selected viewport",
            "unit": "String",
            "affectsOutput": "Determines which specific script in the 3D model executes the logic; if incorrect, the trigger does nothing."
          },
          {
            "name": "executekey",
            "technicalDefault": "setInViewport",
            "businessMeaning": "The specific command keyword sent to the target TSL. The target script uses this key to decide which logic branch to run (e.g., updating a list, changing a visibility flag).",
            "validRange": "Any string defined as a recalc trigger (addRecalcTrigger) or handled within the target TSL's code",
            "unit": "String",
            "affectsOutput": "Determines the specific action performed by the target script (e.g., recalculating dimensions vs. regenerating a list)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing tslName",
            "effect": "The executekey must be valid for the newly selected target script. Different target scripts listen for different keys.",
            "cascade": [
              "executekey"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "2D Text/Label",
            "description": "A text label in the layout displaying the script name, indicating the presence of the trigger.",
            "appliedTo": "Paper Space (Layout)"
          }
        ]
      },
      "tokens_used": 4354,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. User executes script insertion (or starts command).\",\n    \"2. System checks insertion cycle count (insertCycleCount).\",\n    \"3. [Conditional] If cycle count > 1, script erases itself and exits (Safety check).\",\n    \"4. System prompts user: 'Select a viewport'.\",\n    \"5. User clicks a viewport in Paper Space.\",\n    \"6. System prompts user: 'Select a position'.\",\n    \"7. User clicks a point in Paper Space for the label location.\",\n    \"8. System displays the Properties Dialog (showDialog).\",\n    \"9. Script calculates geometry and stores Viewport data.\",\n    \"10. [Recalculation Phase] Script checks if _Viewport array contains data.\",\n    \"11. [Conditional] If _Viewport is empty, script erases itself and exits.\",\n    \"12. System retrieves the Element associated with the stored Viewport.\",\n    \"13. System draws the script name text at the selected position.\",\n    \"14. [Conditional] System verifies if the linked Element is valid (bIsValid).\",\n    \"15. If Element is invalid, script stops processing.\",\n    \"16. If Element is valid, System retrieves all TSL instances attached to that Element.\",\n    \"17. System iterates through the list of TSL instances.\",\n    \"18. [Conditional Loop] System compares each TSL's scriptName with the 'tslName' property.\",\n    \"19. If a match is found, System triggers that TSL using tsl.recalcNow(executekey).\",\n    \"20. Loop continues until all TSLs are checked.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Insertion Cycle Count > 1\",\n      \"path1\": {\n        \"name\": \"Retry Cycle Detected\",\n        \"steps\": [\"eraseInstance()\", \"return (Exit)\"]\n      },\n      \"path2\": {\n        \"name\": \"First Run\",\n        \"steps\": [\"Proceed to Viewport selection\"]\n      }\n    },\n    {\n      \"condition\": \"_Viewport array is empty (During Recalculation)\",\n      \"path1\": {\n        \"name\": \"Data Lost / Corrupt\",\n        \"steps\": [\"eraseInstance()\", \"return (Exit)\"]\n      },\n      \"path2\": {\n        \"name\": \"Data Intact\",\n        \"steps\": [\"Retrieve Viewport object\", \"Continue to Element retrieval\"]\n      }\n    },\n    {\n      \"condition\": \"Element Validity (!el.bIsValid())\",\n      \"path1\": {\n        \"name\": \"Invalid Element\",\n        \"steps\": [\"return (Stop execution, no triggers sent)\"]\n      },\n      \"path2\": {\n        \"name\": \"Valid Element\",\n        \"steps\": [\"Fetch TSL instances\", \"Start scanning loop\"]\n      }\n    },\n    {\n      \"condition\": \"TSL Name Match (Loop Iteration)\",\n      \"path1\": {\n        \"name\": \"Match Found\",\n        \"steps\": [\"Execute tsl.recalcNow(executekey)\", \"Continue to next item\"]\n      },\n      \"path2\": {\n        \"name\": \"No Match\",\n        \"steps\": [\"Continue to next item in list\"]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Viewport Selection\",\n      \"errorMessage\": \"Implicit in command line prompt.\",\n      \"recovery\": \"User must select a valid AutoCAD"
      },
      "tokens_used": 6306,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "```json\n{\n  \"documentation\": \"# HSB_G-TriggerElementTsl.mcr\\n\\n## Overview\\nThis script acts as a remote control for your 3D model, allowing you to send a command signal to a specific TSL script within an Element directly from a 2D Layout. It is typically used to refresh or update specific labels, lists, or graphical data (like an Element Replicator) without manually opening and editing the 3D element properties.\\n\\n## Usage Environment\\n| Space | Supported | Notes |\\n|-------|-----------|-------|\\n| Model Space | No | This script operates on Layouts. |\\n| Paper Space | Yes | This is the primary environment. You must be on a Layout tab. |\\n| Shop Drawing | No | Not intended for use within the Shop Drawing context. |\\n\\n## Prerequisites\\n- **Required Entities**: A Layout (Paper Space) containing a Viewport that is linked to a 3D Element.\\n- **Minimum beam count**: 0.\\n- **Required settings**: None. However, the target Element must have the specific TSL script (defined in the properties) assigned to it.\\n\\n## Usage Steps\\n\\n### Step 1: Launch Script\\nCommand: `TSLINSERT` \\u2192 Select `HSB_G-TriggerElementTsl.mcr` from the list.\\n\\n### Step 2: Select a Viewport\\n```\\nCommand Line: Select a viewport\\nAction: Click on the viewport frame or inside the viewport that displays the 3D element you wish to control.\\n```\\n\\n### Step 3: Select a Position\\n```\\nCommand Line: Select a position\\nAction: Click a location in the Paper Space where you want the trigger label/text to be placed.\\n```\\n\\n### Step 4: Configure Properties\\nAfter placement, the Properties Palette will open. Adjust the **Tsl to trigger** and **Execute Key** if the defaults are not suitable for your target element.\\n\\n## Properties Panel Parameters\\n\\n| Parameter | Type | Default | Description |\\n|-----------|------|---------|-------------|\\n| Dimension style text | dropdown | _DimStyles | Select the text style (font, size, color) for the label identifying this trigger in the layout. |\\n| Tsl to trigger | text | HSB_E-Replicator | Enter the exact filename of the TSL script attached to the 3D Element that you want to update. |\\n| Execute Key | text | setInViewport | Enter the specific command keyword that the target TSL expects to receive to perform the update action. |\\n\\n## Right-Click Menu Options\\n\\n| Menu Item | Description |\\n|-----------|-------------|\\n| setInViewport | Scans the element in the linked viewport for the TSL specified in the properties and sends the command defined in \\\"Execute Key\\\" to refresh it. |\\n\\n## Settings Files\\n- No specific settings files are used by this script.\\n\\n## Tips\\n- **Target Accuracy**: Ensure the **Tsl to trigger** name matches the script name assigned to the Element in the 3D model exactly. If the name is wrong, the trigger will fail silently.\\n- **Visual Reference**: The script draws text at the selected position in Paper Space. Use this to identify which Viewport and Element the trigger is linked to.\\n- **Common Use Case**: This is frequently used to update \\\"Replicator\\\" lists on drawings. If you modify the 3D model and want the 2D list to reflect changes immediately, run this trigger.\\n\\n## FAQ\\n- **Q: I right-clicked \\u2018setInViewport\\u2019 but nothing happened on my drawing.**\\n- **A**: Verify that the `tslName` property matches the script name on the element. Also, check if the `executekey` is a valid command recognized by that specific script.\\n\\n- **Q: Can I move the label text after placing it?**\\n- **A**: Yes, you can use standard AutoCAD commands (like `MOVE`) to reposition the text label in Paper Space. This does not affect the trigger's link to the viewport.\\n\"\n}\n```"
      },
      "tokens_used": 4993,
      "error": null
    }
  }
}