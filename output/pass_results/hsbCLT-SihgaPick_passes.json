{
  "filename": "hsbCLT-SihgaPick.mcr",
  "status": "completed",
  "total_tokens": 53379,
  "processing_time": 278.15873885154724,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9494,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No sd_* or Multipage* prefix detected. No #Type E definition or _Viewport usage found. The script operates on Model entities (Sip/Element), adds 3D tools (Drills), and draws 3D bodies (Display dpDevice.showInDxa(true)), indicating a Model Space environment."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip",
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "XML mapSetting containing SihgaPick Type definitions, LoadDefinitions, and configurations"
          ]
        }
      },
      "tokens_used": 5833,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getSip",
              "promptOriginal": "Select sip",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "Type",
            "defaultValue": "SihgaPick",
            "inputType": "dropdown",
            "options": [
              "SihgaPick",
              "SihgaPickMax"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 1,
            "variable": "sAssociation",
            "type": "PropString",
            "displayName": "Association",
            "defaultValue": "Wall",
            "inputType": "dropdown",
            "options": [
              "Wall",
              "Floor",
              "Auto"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 2,
            "variable": "nLiftDirection",
            "type": "PropInt",
            "displayName": "LiftDirection",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              "Top",
              "Front",
              "Back",
              "Side"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 3,
            "variable": "bStraightenUp",
            "type": "PropInt",
            "displayName": "StraightenUp",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 4,
            "variable": "nNumDevices",
            "type": "PropInt",
            "displayName": "NumDevices",
            "defaultValue": 0,
            "inputType": "number",
            "options": null,
            "category": "General",
            "description": null
          },
          {
            "index": 5,
            "variable": "dUneveness",
            "type": "PropDouble",
            "displayName": "Allowed uneveness",
            "defaultValue": 20,
            "inputType": "number",
            "options": null,
            "category": "General",
            "description": null
          },
          {
            "index": 6,
            "variable": "nShowStraps",
            "type": "PropInt",
            "displayName": "ShowStraps",
            "defaultValue": 1,
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 7,
            "variable": "dThicknessWallMin",
            "type": "PropDouble",
            "displayName": "ThicknessWallMin",
            "defaultValue": 120,
            "inputType": "number",
            "options": null,
            "category": "General",
            "description": null
          },
          {
            "index": 8,
            "variable": "bManualMode",
            "type": "PropInt",
            "displayName": "ManualMode",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 9,
            "variable": "nOffsetX",
            "type": "PropInt",
            "displayName": "OffsetX",
            "defaultValue": 0,
            "inputType": "number",
            "options": null,
            "category": "General",
            "description": null
          },
          {
            "index": 10,
            "variable": "nOffsetY",
            "type": "PropInt",
            "displayName": "OffsetY",
            "defaultValue": 0,
            "inputType": "number",
            "options": null,
            "category": "General",
            "description": null
          },
          {
            "index": 11,
            "variable": "nRotZ",
            "type": "PropInt",
            "displayName": "RotZ",
            "defaultValue": 0,
            "inputType": "number",
            "options": null,
            "category": "General",
            "description": null
          },
          {
            "index": 12,
            "variable": "nChainWidth",
            "type": "PropInt",
            "displayName": "ChainWidth",
            "defaultValue": 80,
            "inputType": "number",
            "options": null,
            "category": "General",
            "description": null
          },
          {
            "index": 13,
            "variable": "nSideDrill",
            "type": "PropInt",
            "displayName": "SideDrill",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "General",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "hsbCLT-SihgaPick.xml",
            "searchPaths": [
              "HsbCompany/hsbCLT-SihgaPick.xml",
              "HsbInstall/hsbCLT-SihgaPick.xml"
            ],
            "purpose": "Contains Type definitions, LoadDefinitions, configurations, and mapSetting for SihgaPickMax",
            "required": true
          }
        ]
      },
      "tokens_used": 8548,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically calculates and positions SihgaPick lifting hardware on CLT panels based on weight, center of gravity, and installation orientation.",
          "category": "Hardware / Production",
          "typicalUseCase": "Used during detailing to add certified lifting inserts to CLT walls or floors, ensuring the number of points and chain lengths are structurally valid."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "SihgaPick",
            "businessMeaning": "Selects the hardware model: Standard SihgaPick (shorter) or SihgaPickMax (heavy duty, longer depth).",
            "validRange": "SihgaPick, SihgaPickMax",
            "unit": "Selection",
            "affectsOutput": "Determines the drill depth (~68mm vs ~138mm) and the 3D body geometry of the device."
          },
          {
            "name": "sAssociation",
            "technicalDefault": "Wall",
            "businessMeaning": "Defines the installation context (Vertical Wall, Horizontal Floor/Roof), which determines the load case logic.",
            "validRange": "Wall, Floor, Auto",
            "unit": "Selection",
            "affectsOutput": "Switches the XML lookup configuration between Wall and Floor/Roof load tables."
          },
          {
            "name": "nLiftDirection",
            "technicalDefault": 0,
            "businessMeaning": "Specifies which face of the panel is oriented upwards during the lift.",
            "validRange": "Top, Front, Back, Side",
            "unit": "Index",
            "affectsOutput": "Affects the selection of load configuration maps in the XML and calculation of stability angles."
          },
          {
            "name": "bStraightenUp",
            "technicalDefault": 0,
            "businessMeaning": "If Yes, ensures the panel hangs vertically; requires specific configurations from the XML.",
            "validRange": "No, Yes",
            "unit": "Boolean",
            "affectsOutput": "Modifies the selection logic in calcLiftingParameters to find configurations that satisfy 'Upright' angle constraints."
          },
          {
            "name": "nNumDevices",
            "technicalDefault": 0,
            "businessMeaning": "Number of lifting points. If 0, the script calculates the minimum required based on panel weight.",
            "validRange": "0 (Auto) to 8",
            "unit": "Count",
            "affectsOutput": "Directly controls the quantity of drill holes and 3D device bodies generated."
          },
          {
            "name": "dUneveness",
            "technicalDefault": 20,
            "businessMeaning": "Tolerance for horizontal deviation of lifting points from the ideal edge.",
            "validRange": "0 - 100",
            "unit": "mm",
            "affectsOutput": "Filters valid positions along the panel edge where devices can be inserted."
          },
          {
            "name": "nShowStraps",
            "technicalDefault": 1,
            "businessMeaning": "Toggles the visual representation of lifting chains/straps and length labels.",
            "validRange": "No, Yes",
            "unit": "Boolean",
            "affectsOutput": "Controls visibility of Polyline and Text entities representing the rigging geometry."
          },
          {
            "name": "dThicknessWallMin",
            "technicalDefault": 120,
            "businessMeaning": "Minimum panel thickness required to safely use the hardware configuration.",
            "validRange": "60 - 300",
            "unit": "mm",
            "affectsOutput": "Used as a validation filter; thin panels below this value may fail configuration checks."
          },
          {
            "name": "bManualMode",
            "technicalDefault": 0,
            "businessMeaning": "Bypasses automatic calculation to allow manual positioning of devices.",
            "validRange": "No, Yes",
            "unit": "Boolean",
            "affectsOutput": "When Yes, automatic placement is disabled, and OffsetX/Y/RotZ are used to place the tool."
          },
          {
            "name": "nOffsetX",
            "technicalDefault": 0,
            "businessMeaning": "Manual horizontal distance from the panel's origin.",
            "validRange": "Panel Length",
            "unit": "mm",
            "affectsOutput": "Sets the X-coordinate of the lifting point when ManualMode is active."
          },
          {
            "name": "nOffsetY",
            "technicalDefault": 0,
            "businessMeaning": "Manual vertical distance from the panel's origin.",
            "validRange": "Panel Width/Height",
            "unit": "mm",
            "affectsOutput": "Sets the Y-coordinate of the lifting point when ManualMode is active."
          },
          {
            "name": "nRotZ",
            "technicalDefault": 0,
            "businessMeaning": "Rotation of the device around the Z-axis.",
            "validRange": "0 - 360",
            "unit": "degrees",
            "affectsOutput": "Rotates the drill and body geometry in ManualMode."
          },
          {
            "name": "nChainWidth",
            "technicalDefault": 80,
            "businessMeaning": "Width or spacing parameter for the graphical chain representation.",
            "validRange": "20 - 200",
            "unit": "mm",
            "affectsOutput": "Affects the geometry of the visual chain/strap drawing."
          },
          {
            "name": "nSideDrill",
            "technicalDefault": 0,
            "businessMeaning": "Adds a perpendicular side hole (locking pin) for the device.",
            "validRange": "No, Yes",
            "unit": "Boolean",
            "affectsOutput": "Adds a secondary Drill operation to the element."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "bManualMode changes to Yes",
            "effect": "Automatic COG-based calculation is disabled. Manual offsets become the primary source for position.",
            "cascade": [
              "nOffsetX",
              "nOffsetY",
              "nRotZ"
            ]
          },
          {
            "trigger": "sType changes to SihgaPickMax",
            "effect": "Switches to heavy-duty configuration tables and increases drill depth.",
            "cascade": [
              "dThicknessWallMin",
              "nNumDevices",
              "nSideDrill"
            ]
          },
          {
            "trigger": "sAssociation changes",
            "effect": "Updates the load definition source (Wall vs Floor/Roof) in the XML.",
            "cascade": [
              "nNumDevices",
              "nLiftDirection"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Drill",
            "description": "Cylindrical hole for the lifting pin. Depth varies by type (approx 68mm for Pick, 138mm for PickMax).",
            "appliedTo": "Selected Sip/Element"
          },
          {
            "type": "Body",
            "description": "3D representation of the hardware device (Color 253) used for visualization and export.",
            "appliedTo": "ModelSpace"
          },
          {
            "type": "Polyline",
            "description": "Lines representing the lifting chains/straps from the device to a central hook point.",
            "appliedTo": "ModelSpace"
          },
          {
            "type": "MapX",
            "description": "Embedded production data (Qty, Name, Diameter, Depth, Association) for reports and CAM export.",
            "appliedTo": "Sip/Element"
          },
          {
            "type": "DimensionRequest",
            "description": "Request object to auto-dimension the lifting points in shop drawings.",
            "appliedTo": "Sip/Element"
          }
        ]
      },
      "tokens_used": 10666,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script",
          "Prompt user to select a Sip (Structural Insulated Panel) or Element",
          "Load XML configuration file (hsbCLT-SihgaPick.xml) from Company or Install directory",
          "Validate XML contains necessary Types and LoadDefinitions",
          "Read OPM Properties (Type, Association, LiftDirection, etc.)",
          "Calculate panel properties (Weight, Bounding Box, Center of Gravity)",
          "Check Association Mode (Wall, Floor, Auto)",
          "Check Operation Mode (Manual vs Automatic)",
          "Automatic Mode Branch: Call calcLiftingParameters to determine device count and positions based on XML tables",
          "Manual Mode Branch: Use OffsetX/Y and RotZ properties to position single device",
          "Generate Drill objects for lifting holes (Main hole + optional side pin)",
          "Add MapX production data to Drill and Sip (Qty, Name, Depth, etc.)",
          "Draw 3D Body representation of the device",
          "Draw visual straps/chains if ShowStraps is Yes",
          "Create DimensionRequest object for shop drawing annotations",
          "Finish"
        ],
        "conditionalBranches": [
          {
            "condition": "bManualMode Property Check",
            "path1": {
              "name": "Automatic Mode",
              "steps": [
                "Calculate panel weight and geometry",
                "Check sAssociation (Wall/Floor/Auto) and nLiftDirection",
                "Query XML LoadDefinition for valid configuration",
                "Validate against bStraightenUp and dUneveness constraints",
                "Determine nNumDevices and ChainLength",
                "Compute optimal points along panel edges"
              ]
            },
            "path2": {
              "name": "Manual Mode",
              "steps": [
                "Skip calculation logic",
                "Read nOffsetX, nOffsetY, nRotZ properties",
                "Place device at specified offset from panel origin"
              ]
            }
          },
          {
            "condition": "sType Selection (SihgaPick vs SihgaPickMax)",
            "path1": {
              "name": "SihgaPick (Standard)",
              "steps": [
                "Use LoadDefinition for standard Pick",
                "Set Drill Depth to approx 68mm",
                "Draw shorter Body geometry"
              ]
            },
            "path2": {
              "name": "SihgaPickMax (Heavy Duty)",
              "steps": [
                "Use LoadDefinition for PickMax",
                "Set Drill Depth to approx 138mm",
                "Draw longer Body geometry",
                "Check specific XML rules for edge offsets (fix in v3.7)"
              ]
            }
          },
          {
            "condition": "nNumDevices > 1",
            "path1": {
              "name": "Single Device",
              "steps": [
                "Generate one Drill",
                "Draw one Body",
                "Skip strap/chain drawing"
              ]
            },
            "path2": {
              "name": "Multiple Devices",
              "steps": [
                "Generate multiple Drills",
                "Draw multiple Bodies",
                "Calculate and draw Polyline chains/traverses",
                "Add ChainLength strings to Map (Chain1, Chain2, etc.)",
                "Create dimension request chain between points"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Sip/Element Selection",
            "errorMessage": "User fails to select a valid panel.",
            "recovery": "Script prompts again via getPoint/getGenBeam loop."
          },
          {
            "check": "XML File Existence",
            "errorMessage": "hsbCLT-SihgaPick.xml not found in Company or Install folders.",
            "recovery": "User must ensure XML configuration is provided in the correct directory."
          },
          {
            "check": "Lifting Configuration Match",
            "errorMessage": "No valid configuration found in XML for current Weight, Thickness, or Angle constraints.",
            "recovery": "User must change Association, LiftDirection, or ManualMode to bypass logic, or consult XML settings."
          },
          {
            "check": "Wall Length/COG Checks (Automatic Mode)",
            "errorMessage": "Panel length or Center of Gravity deviation exceeds limits defined in XML.",
            "recovery": "Script enforces minimum number of devices (e.g., 4 for long walls, 3 for eccentric COG). User can force nNumDevices manually if allowed."
          },
          {
            "check": "Minimum Thickness",
            "errorMessage": "Panel thickness is less than dThicknessWallMin.",
            "recovery": "Script may fail to find valid configuration; user must increase thickness property (if applicable) or use different hardware."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Operation Mode",
            "how": "OPM Property 'ManualMode'",
            "effect": "Switches between Automatic calculation (based on XML) and Manual placement (using Offsets)."
          },
          {
            "action": "Adjust Device Position",
            "how": "OPM Properties 'OffsetX', 'OffsetY', 'RotZ' (Only active in ManualMode)",
            "effect": "Moves the single lifting device to the specified coordinates/rotation."
          },
          {
            "action": "Modify Lifting Logic",
            "how": "OPM Properties 'Type', 'Association', 'LiftDirection', 'StraightenUp'",
            "effect": "Triggers recalculation to find new matching configuration in XML tables."
          },
          {
            "action": "Edit Visuals",
            "how": "OPM Property 'ShowStraps'",
            "effect": "Toggles the visibility of the chain/strap polylines and length labels."
          },
          {
            "action": "Edit Geometry Constraints",
            "how": "OPM Property 'Allowed uneveness'",
            "effect": "Changes the tolerance filter for finding valid horizontal positions along the edge."
          }
        ]
      },
      "tokens_used": 11169,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-SihgaPick.mcr\n\n## Overview\nAutomatically calculates and positions SihgaPick lifting hardware on CLT panels based on panel weight, center of gravity, and installation orientation. It supports both automatic configuration generation via XML tables and manual placement for specific project needs.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on Model entities (Sip/Element) and generates 3D tools (Drills/Bodies). |\n| Paper Space | No | Not designed for layout or detailing views. |\n| Shop Drawing | No | Creates production data (MapX) but runs in the model context. |\n\n## Prerequisites\n- **Required Entities**: A valid Sip or Element (CLT Wall or Floor).\n- **Minimum Beams**: 1 Panel required.\n- **Required Settings**: `hsbCLT-SihgaPick.xml` configuration file must exist in the `HsbCompany` or `HsbInstall` directory.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCLT-SihgaPick.mcr` from the list.\n\n### Step 2: Select Panel\n```\nCommand Line: Select sip\nAction: Click on the CLT wall or floor element to insert the lifting hardware.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | dropdown | SihgaPick | Selects the hardware model. Choose between **SihgaPick** (Standard) or **SihgaPickMax** (Heavy Duty). |\n| Association | dropdown | Wall | Defines the installation context. Options: **Wall**, **Floor**, or **Auto**. Determines the load case logic used. |\n| LiftDirection | dropdown | Top | Specifies which face is up during lifting. Options: **Top**, **Front**, **Back**, or **Side**. |\n| StraightenUp | dropdown | No | If set to **Yes**, the script calculates configurations to ensure the panel hangs vertically. |\n| NumDevices | number | 0 | Number of lifting points. **0** = Auto-calculate based on weight. Max 8. |\n| Allowed uneveness | number | 20 | Tolerance (mm) for horizontal deviation of lifting points from the ideal edge. |\n| ShowStraps | dropdown | Yes | Toggles the visual representation of lifting chains/straps and length labels. |\n| ThicknessWallMin | number | 120 | Minimum panel thickness (mm) required to safely use the hardware configuration. |\n| ManualMode | dropdown | No | If **Yes**, automatic calculation is disabled. Use OffsetX/Y to place the device manually. |\n| OffsetX | number | 0 | Manual horizontal distance (mm) from the panel's origin. Only active in ManualMode. |\n| OffsetY | number | 0 | Manual vertical distance (mm) from the panel's origin. Only active in ManualMode. |\n| RotZ | number | 0 | Rotation of the device (degrees) around the Z-axis. Only active in ManualMode. |\n| ChainWidth | number | 80 | Width or spacing parameter (mm) for the graphical chain representation. |\n| SideDrill | dropdown | No | If **Yes**, adds a perpendicular side hole (locking pin) for the device. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the script logic based on current properties and geometry (Standard TSL behavior). |\n\n## Settings Files\n- **Filename**: `hsbCLT-SihgaPick.xml`\n- **Location**: `HsbCompany/hsbCLT-SihgaPick.xml` or `HsbInstall/hsbCLT-SihgaPick.xml`\n- **Purpose**: Contains Type definitions, LoadDefinitions (weight/thickness limits), and configurations for both SihgaPick and SihgaPickMax models. This file is critical for the \"Auto\" calculation of `NumDevices`.\n\n## Tips\n- **Automatic Calculation**: Leave `NumDevices` set to **0** to let the script determine the minimum number of lifting points required based on the panel's weight and center of gravity.\n- **Manual Override**: If the automatic placement doesn't suit your specific construction detail, set `ManualMode` to **Yes** and use `OffsetX`, `OffsetY`, and `RotZ` to position the insert exactly where you need it.\n- **Visual Feedback**: Toggle `ShowStraps` to **No** if you want to hide the chain/strap graphics in the model to reduce clutter, while keeping the hardware inserts visible.\n- **Heavy Panels**: Use the **SihgaPickMax** type for heavier loads or thicker panels. This increases drill depth and uses heavy-duty load tables.\n\n## FAQ\n- **Q: The script shows an error \"No valid configuration found\". Why?**\n  **A:** This means the XML settings do not contain a configuration that matches your panel's specific weight, thickness, or lifting angle. Try changing the `Association`, `LiftDirection`, or switching to the `SihgaPickMax` type.\n  \n- **Q: How do I force the script to use 4 lifting points instead of the 2 it calculated?**\n  **A:** Change the `NumDevices` property from **0** to **4**. The script will attempt to place 4 points based on the geometry.\n\n- **Q: Can I use this on floor elements?**\n  **A:** Yes. Set the `Association` property to **Floor** or **Auto** to ensure the correct load tables are used for horizontal elements."
      },
      "tokens_used": 7669,
      "error": null
    }
  }
}