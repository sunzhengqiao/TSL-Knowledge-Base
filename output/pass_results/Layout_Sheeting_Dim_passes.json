{
  "filename": "Layout_Sheeting_Dim.mcr",
  "status": "completed",
  "total_tokens": 58492,
  "processing_time": 243.70403337478638,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "",
            "date": "040605",
            "author": "Anno Sportel",
            "changes": "First revision"
          },
          {
            "version": "",
            "date": "040506",
            "author": "Anno Sportel",
            "changes": "Place text on the correct side of the dimline"
          },
          {
            "version": "",
            "date": "040510",
            "author": "Anno Sportel",
            "changes": "Update translatable strings"
          },
          {
            "version": "",
            "date": "040701",
            "author": "Anno Sportel",
            "changes": "Update conversions of zones"
          },
          {
            "version": "",
            "date": "040831",
            "author": "Anno Sportel",
            "changes": "Change check on alignment. codirectional with vx instead of vxps."
          },
          {
            "version": "",
            "date": "040831",
            "author": "Alberto Jena",
            "changes": "Add auto scale"
          },
          {
            "version": "",
            "date": "120921",
            "author": "Chirag Sawjani",
            "changes": "Added a property for ignoring openings"
          },
          {
            "version": "",
            "date": "130712",
            "author": "Alberto Jena",
            "changes": "Fix issue with the orientation to display material of the zone"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 9322,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses getViewport() during _bOnInsert to select a viewport. Manages _Viewport array. Calculates ms2ps (Model Space to Paper Space) transformation using vp.coordSys(). Draws dimensions in Paper Space using Display dp after transforming geometry."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Sheet",
            "Viewport"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be inserted in a Paper Space Layout containing a Viewport with a valid hsbCAD Element.",
          "requiredSettings": [
            "_DimStyles (Dimension Styles)"
          ]
        }
      },
      "tokens_used": 7992,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getViewport\",\n        \"promptOriginal\": \"Select a viewport.\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"Properties Dialog\",\n      \"trigger\": \"showDialogOnce on Insert\",\n      \"title\": \"Properties\",\n      \"dataSource\": \"Script Properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"dDimOff\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Distance dimension line to element\",\n      \"defaultValue\": \"U(300)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dTextOff\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Distance text\",\n      \"defaultValue\": \"U(100)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"sDeltaOnTop\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Side of delta dimensioning\",\n      \"defaultValue\": \"Above\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Above\",\n        \"Below\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sTextSide\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Side of dimensioning text\",\n      \"defaultValue\": \"Left\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Left\",\n        \"Right\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sStartDim\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Start dimensionsing\",\n      \"defaultValue\": \"Left\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Left\",\n        \"Right\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sDimStyle\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Dimension style\",\n      \"defaultValue\": \"Delta perpendicular\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Delta perpendicular\",\n        \"Delta parallel\",\n        \"Cummulative perpendicular\",\n        \"Cummalative parallel\",\n        \"Both perpendicular\",\n        \"Both parallel\",\n        \"Delta parallel, Cummalative perpendicular\",\n        \"Delta perpendicular, Cummalative parallel\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sDimLayout\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Dimension layout\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"_DimStyles\"\n      ],\n      \"category\": null,\n     "
      },
      "tokens_used": 10889,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates sheathing layout dimensions in Paper Space, aligned to the viewport view, to indicate the boundaries and spacing of an element (wall/floor).",
          "category": "ShopDrawing",
          "typicalUseCase": "Used to annotate production drawings (layouts) with precise dimensions for the outer shell (sheathing) of walls or floors, ensuring dimensions are readable and correctly oriented regardless of the viewport rotation."
        },
        "parameters": [
          {
            "name": "dDimOff",
            "technicalDefault": "U(300)",
            "businessMeaning": "The offset distance between the dimension line and the element geometry in the drawing.",
            "validRange": "50 to 1000",
            "unit": "mm",
            "affectsOutput": "Moves the dimension lines closer to or further from the element to avoid collision with other details."
          },
          {
            "name": "dTextOff",
            "technicalDefault": "U(100)",
            "businessMeaning": "The offset distance between the dimension text and the dimension line.",
            "validRange": "10 to 500",
            "unit": "mm",
            "affectsOutput": "Adjusts the text legibility by moving it away from the dimension line."
          },
          {
            "name": "sDeltaOnTop",
            "technicalDefault": "Above",
            "businessMeaning": "Determines the vertical stacking order of delta (individual) dimensions versus cumulative dimensions when both are displayed.",
            "validRange": "Above, Below",
            "unit": "Enum",
            "affectsOutput": "Swaps the position of detailed dimensions relative to the total running dimension."
          },
          {
            "name": "sTextSide",
            "technicalDefault": "Left",
            "businessMeaning": "Specifies the side of the dimension line where the text labels are aligned.",
            "validRange": "Left, Right",
            "unit": "Enum",
            "affectsOutput": "Flips the justification and position of the dimension text along the line."
          },
          {
            "name": "sStartDim",
            "technicalDefault": "Left",
            "businessMeaning": "Defines the starting side for the dimension chain (which end is treated as zero).",
            "validRange": "Left, Right",
            "unit": "Enum",
            "affectsOutput": "Reverses the direction in which dimensions are measured and displayed."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "Delta perpendicular",
            "businessMeaning": "Selects the dimensioning strategy: Individual member spacing (Delta), Total length (Cumulative), or Both, measured parallel or perpendicular to the element's main axis.",
            "validRange": "Delta perpendicular, Delta parallel, Cummulative perpendicular, Cummalative parallel, Both perpendicular, Both parallel, etc.",
            "unit": "Enum",
            "affectsOutput": "Changes the type of dimensions generated (e.g., showing only stud spacing vs. total wall length)."
          },
          {
            "name": "sDimLayout",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Selects the visual style (text size, arrowheads, ticks) for the dimensions from the hsbCAD standards.",
            "validRange": "List of available DimStyles in the project",
            "unit": "String",
            "affectsOutput": "Updates the visual appearance of the dimension lines to match drafting standards."
          },
          {
            "name": "nZn",
            "technicalDefault": "1",
            "businessMeaning": "Specifies the Element Zone (e.g., specific floor or wall layer) to calculate dimensions for.",
            "validRange": "1 to 10",
            "unit": "Index",
            "affectsOutput": "Filters which part of the element is dimensioned, based on zone definitions."
          },
          {
            "name": "nDimColor",
            "technicalDefault": "1",
            "businessMeaning": "The CAD color index used for the dimension lines and text.",
            "validRange": "0 to 255",
            "unit": "Color Index",
            "affectsOutput": "Changes the display color of the dimensions for layer control or highlighting."
          },
          {
            "name": "sIgnoreOpenings",
            "technicalDefault": "No",
            "businessMeaning": "If Yes, the script treats the element as a solid box, ignoring holes like windows or doors when calculating dimensions.",
            "validRange": "No, Yes",
            "unit": "Enum",
            "affectsOutput": "Removes 'jumps' in dimension lines over openings, providing an overall bounding box dimension."
          },
          {
            "name": "sFilterByLabel",
            "technicalDefault": "",
            "businessMeaning": "Filters the sheets to be dimensioned based on their labels (names), using a semicolon-separated list.",
            "validRange": "String of sheet labels",
            "unit": "String",
            "affectsOutput": "Restricts dimensioning to specific components (e.g., only exterior sheathing) if labels are used."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Setting sDimStyle to 'Both perpendicular' or 'Both parallel'",
            "effect": "The sDeltaOnTop parameter becomes active to determine the stacking order of the two dimension lines.",
            "cascade": [
              "sDeltaOnTop"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Dimension",
            "description": "Paper Space dimensions (lines, arrows, and text) representing the sheathing layout.",
            "appliedTo": "Paper Space Layout (Viewport)"
          },
          {
            "type": "Text",
            "description": "A text label displaying the material name of the zone, placed at the start of the dimension.",
            "appliedTo": "Paper Space Layout"
          }
        ]
      },
      "tokens_used": 9908,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Insertion: User runs 'Layout_Sheeting_Dim' command.\",\n    \"2. Viewport Selection: User clicks a viewport in Paper Space.\",\n    \"3. Initial Configuration: Properties dialog appears (showDialogOnce) to set initial parameters (Zone, Style, Offsets).\",\n    \"4. Validation Check: Script verifies if the selected viewport contains a valid hsbCAD Element.\",\n    \"5. Orientation Analysis: Script calculates the transformation between Model Space and Paper Space to align element axes with screen axes.\",\n    \"6. Zone Extraction: Script retrieves all Sheets (Sheathing) belonging to the specified Zone index.\",\n    \"7. Geometry Processing: Script calculates bounding boxes and extracts profile points for Left, Right, Top, and Bottom sides.\",\n    \"8. 4-Side Dimensioning Loop: Script iterates 4 times (Left, Right, Bottom, Top) to generate dimensions for each side.\",\n    \"9. Point Projection & Sorting: For the current side, collected profile points are projected onto a reference line and sorted.\",\n    \"10. Dimension Generation: A Dimension object is created using the projected points and the specified Style (Delta/Cumulative).\",\n    \"11. Rendering: The Dimension and Material Label are drawn in Paper Space.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Viewport Element Validity\",\n      \"path1\": {\n        \"name\": \"Valid Element\",\n        \"steps\": [\n          \"Extract Element CoordSys\",\n          \"Proceed to Orientation Analysis\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Invalid/No Element\",\n        \"steps\": [\n          \"Exit Script Early (return)\",\n          \"No drawing performed\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Element Alignment to Screen Axes\",\n      \"path1\": {\n        \"name\": \"Aligned (Orthogonal)\",\n        \"steps\": [\n          \"Determine orientation (e.g., Element X is Screen X)\",\n          \"Calculate Left/Right/Top/Bottom vectors\",\n          \"Proceed to Dimensioning\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Not Aligned\",\n        \"steps\": [\n          \"Report Error: 'Vectors not aligned'\",\n          \"Exit Script Early (return)\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Property 'Ignore Openings' (sIgnoreOpenings)\",\n      \"path1\": {\n        \"name\": \"Yes (Ignore)\",\n        \"steps\": [\n          \"Filter out opening profiles during point collection\",\n          \"Calculate dimensions across openings (bounding box)\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No (Account)\",\n        \"steps\": [\n          \"Include opening profiles in point collection\",\n          \"Dimension steps/jumps at openings\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Dimension Side Loop (nAlignment 0-3)\",\n      \"path1\": {\n        \"name\": \"Left (nAlignment=0)\",\n        \"steps\": [\n          \"Use pntsL (Left profile points)\",\n          \"Offset line to the Left\",\n          \"Draw Vertical Text Label\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Right (nAlignment=1)\",\n        \"steps\": [\n          \"Use pntsR (Right profile points)\",\n          \"Offset line to the Right\",\n          \"Draw Vertical Text Label\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"Bottom (nAlignment=2)\",\n        \"steps\": [\n          \"Use pntsB (Bottom profile points)\",\n          \"Offset line Down\",\n          \"Draw Horizontal Text Label\"\n        ]\n      },\n      \"path4\": {\n        \"name\": \"Top (nAlignment=3)\",\n        \"steps\": [\n          \"Use pntsT (Top profile points)\",\n          \"Offset line Up\",\n          \"Draw Horizontal Text Label\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Viewport Entity Check\",\n      \"errorMessage\": \"Implicit return (Script does nothing)\",\n      \"recovery\": \"Select a viewport that displays a valid hsbCAD Element (Wall/Floor) and update the script.\"\n    },\n    {\n      \"check\": \"Vector Alignment Check\",\n      \"errorMessage\": \"Error!\\\\nVectors not aligned.\",\n      \"recovery\": \"Rotate the Viewport or the Element View so that the element is orthogonal to the screen (0, 90, 180, 270 degrees).\"\n    },\n    {\n      \"check\": \"Zone Availability\",\n      \"errorMessage\": \"No dimensions generated (if zone is empty)\",\n      \"recovery\": \"Ensure the selected Element has sheathing/material defined in the specified Zone index (Property nZn).\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Adjust Dimension Offsets\",\n      \"how\": \"OPM (Properties Palette)\",\n      \"effect\": \"Updates 'dDimOff' (Line distance) and 'dTextOff' (Text distance) properties, moving dimensions closer/further.\"\n    },\n    {\n      \"action\": \"Change Dimension Style\",\n      \"how\": \"OPM\",\n      \"effect\": \"Updates 'sDimStyle' to switch between Delta (individual), Cumulative (total), or Both dimensions.\"\n    },\n    {\n      \"action\": \"Change Zone\",\n      \"how\": \"OPM\",\n      \"effect\": \"Updates 'nZn' to dimension a different layer of the element (e.g., inner sheathing vs outer sheathing).\"\n    },\n    {\n      \"action\": \"Modify Element Geometry\",\n      \"how\": \"Model Space Edit / Generate\",\n      \"effect\": \"Script detects change in element bounds or sheathing and recalculates dimension points and values.\"\n    },\n    {\n      \"action\": \"Viewport Navigation\",\n      \"how\": \"Pan/Zoom/Move Viewport\",\n      \"effect\": \"Dimensions remain locked"
      },
      "tokens_used": 12581,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Layout Sheathing Dim\n\n## Overview\nThis script automatically generates sheathing layout dimensions in Paper Space. It calculates and displays precise Delta (individual) and Cumulative (total) dimensions for the selected element (wall or floor) based on the viewport orientation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | The script reads geometry from Model Space but is inserted in Layouts. |\n| Paper Space | Yes | Dimensions are drawn directly in the Layout. |\n| Shop Drawing | Yes | Designed for production drawings and layouts. |\n\n## Prerequisites\n- **Required Entities**: A Layout tab containing a Viewport with a valid hsbCAD Element (Wall or Floor).\n- **Minimum Beam Count**: 0 (Dims are based on Element/Sheets).\n- **Required Settings**: Project must have valid `_DimStyles` configured for dimension appearance.\n\n## Usage Steps\n\n### Step 1: Launch Script\nExecute the command `TSLINSERT` in AutoCAD.\n1. Select `Layout_Sheeting_Dim.mcr` from the file list.\n2. Click **Open**.\n\n### Step 2: Select Viewport\nThe command line will prompt:\n```\nSelect a viewport.\n```\n**Action**: Click on the viewport border in the Paper Space layout that displays the element you wish to dimension.\n\n### Step 3: Configure Properties (Optional)\nUpon insertion, the Properties dialog may appear (or open the Properties Palette via Ctrl+1).\n1. Set the **Element Zone** (`nZn`) if you are dimensioning a specific layer (e.g., inner sheathing vs outer sheathing).\n2. Adjust offsets and dimension styles as needed.\n3. The script will automatically generate the dimensions in Paper Space.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Distance dimension line to element** | Number | 300 mm | Sets the gap between the element geometry and the dimension line. |\n| **Distance text** | Number | 100 mm | Sets the gap between the dimension line and the text label. |\n| **Side of delta dimensioning** | Dropdown | Above | Determines if individual dimensions are stacked Above or Below cumulative lines. |\n| **Side of dimensioning text** | Dropdown | Left | Aligns the dimension text to the Left or Right of the dimension line. |\n| **Start dimensioning** | Dropdown | Left | Sets which side of the element is treated as the zero point (Left or Right). |\n| **Dimension style** | Dropdown | Delta perpendicular | Selects the type of dimensioning: <br>- *Delta*: Spacing of individual sheets.<br>- *Cumulative*: Total running length.<br>- *Both*: Displays both types.<br>Can be Parallel or Perpendicular to the element. |\n| **Dimension layout** | Dropdown | *Project Dependent* | Selects the visual style (arrowheads, text size, etc.) from the project's `_DimStyles` list. |\n| **nZn (Zone)** | Number | 1 | Specifies the Element Material Zone index to calculate dimensions for. |\n| **nDimColor (Color)** | Number | 1 | Sets the CAD Color Index for the dimension lines and text. |\n| **sIgnoreOpenings** | Dropdown | No | If set to **Yes**, openings (windows/doors) are ignored, and dimensions run across the full bounding box. |\n| **sFilterByLabel** | Text | | Filters sheets to be dimensioned by their label name (semicolon-separated list). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Recalculate** | Updates the dimensions to reflect changes in the Model Space geometry or updates to the script properties. |\n\n## Settings Files\n- **Filename**: `_DimStyles` (Project specific)\n- **Location**: Defined in your hsbCAD Project/Catalog settings.\n- **Purpose**: Provides standard drafting styles (text height, arrow style, tick marks) used by the `sDimLayout` parameter.\n\n## Tips\n- **Orthogonal View**: Ensure your Viewport is rotated such that the element is perfectly horizontal or vertical on the screen. The script will display an error \"Vectors not aligned\" if the view is rotated (e.g., to 45 degrees).\n- **Ignoring Openings**: Use the **sIgnoreOpenings** property set to \"Yes\" if you want the overall length of the sheathing run without dimensioning around every window or door cut-out.\n- **Visual Clutter**: If dimension lines overlap with other details, increase the **Distance dimension line to element** property via the Properties Palette.\n- **Material Label**: The script automatically places a text label with the material name of the zone at the start of the dimension line.\n\n## FAQ\n- **Q: Why does the script show \"Error! Vectors not aligned\"?**\n  A: The element in your Viewport is not square to the screen. Use the DVIEW command or rotate the UCS/View within the viewport so the wall/floor is straight up/down or left/right.\n- **Q: Why are no dimensions appearing?**\n  A: Ensure the Viewport you selected actually contains an hsbCAD Element. Also, check if the Zone (`nZn`) you selected actually contains sheathing/sheets.\n- **Q: How do I change the dimension arrows or text size?**\n  A: Change the **Dimension layout** property to select a different predefined style from your project standards, or modify the `_DimStyles` settings in your catalog."
      },
      "tokens_used": 7800,
      "error": null
    }
  }
}