{
  "filename": "Layout_DIM_Elements_Type2.mcr",
  "status": "completed",
  "total_tokens": 40524,
  "processing_time": 264.367529630661,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.2",
            "date": "20.10.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Fig Issue with ISM details"
          },
          {
            "version": "1.3",
            "date": "13.01.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Add the extreme points of the element to the dim line"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4815,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly prompts the user to select a Viewport during insertion using getViewport(). It retrieves the Element from the Viewport and calculates the Model Space to Paper Space coordinate transformation (ms2ps). Dimensions are calculated based on Model Space entities (Beams/Sheets) but are transformed to Paper Space before being drawn with dp.draw(dim)."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element (containing Beams/Sheets)"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Paper Space (Layout) with a Viewport linked to a valid hsbCAD Element",
          "requiredSettings": [
            "Dimension Styles"
          ]
        }
      },
      "tokens_used": 5469,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Select point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select a viewport, you can add others later on with the HSB_LINKTOOLS command.",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strDir",
            "type": "PropString",
            "displayName": "Direction",
            "defaultValue": "Horizontal",
            "inputType": "dropdown",
            "options": [
              "Horizontal",
              "Vertical"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "strSide",
            "type": "PropString",
            "displayName": "Side of beams/sheets",
            "defaultValue": "Left",
            "inputType": "dropdown",
            "options": [
              "Left",
              "Center",
              "Right",
              "Left and right"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strAllZones",
            "type": "PropString",
            "displayName": "Zones to use",
            "defaultValue": "Use zone index",
            "inputType": "dropdown",
            "options": [
              "Use zone index",
              "All"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nZone",
            "type": "PropInt",
            "displayName": "Zone index",
            "defaultValue": 5,
            "inputType": "dropdown",
            "options": [
              -5,
              -4,
              -3,
              -2,
              -1,
              0,
              1,
              2,
              3,
              4,
              5
            ],
            "category": null,
            "description": "index 5 is default"
          },
          {
            "index": 3,
            "variable": "strTextDirD",
            "type": "PropString",
            "displayName": "Delta text direction",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": [
              "None",
              "Parallel",
              "Perpendicular"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "strTextDirC",
            "type": "PropString",
            "displayName": "Cumm text direction",
            "defaultValue": "Parallel",
            "inputType": "dropdown",
            "options": [
              "None",
              "Parallel",
              "Perpendicular"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sShowProfile",
            "type": "PropString",
            "displayName": "Numbering Direction",
            "defaultValue": "Left",
            "inputType": "dropdown",
            "options": [
              "Left",
              "Right"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension Style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": "|Dimension Style|",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7878,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of dimension lines for timber construction elements (walls/floors) in Paper Space layouts, labeling beam and sheet positions based on zones and alignment.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used by draftsmen to generate accurate layout dimensions for production drawings, specifically to detail the spacing of studs, plates, and sheathing materials relative to the element's origin."
        },
        "parameters": [
          {
            "name": "strDir",
            "technicalDefault": "Horizontal",
            "businessMeaning": "Sets the primary orientation of the dimension line on the drawing layout.",
            "validRange": "Horizontal, Vertical",
            "unit": "N/A",
            "affectsOutput": "Determines if the dimension line runs along the screen X-axis (Horizontal) or Y-axis (Vertical) in Paper Space."
          },
          {
            "name": "strSide",
            "technicalDefault": "Left",
            "businessMeaning": "Specifies which side of the timber members (beams/sheets) is used to pick up the dimension points.",
            "validRange": "Left, Center, Right, Left and right",
            "unit": "N/A",
            "affectsOutput": "Offsets the dimension witness lines and measurement points to the left face, centerline, right face, or both sides of the members."
          },
          {
            "name": "strAllZones",
            "technicalDefault": "Use zone index",
            "businessMeaning": "Selects whether to dimension the entire element (all zones) or a specific construction layer (zone index).",
            "validRange": "Use zone index, All",
            "unit": "N/A",
            "affectsOutput": "If 'All', dimensions every GenBeam. If 'Use zone index', dimensions only the sheets in the specified zone or beams if the index is 0."
          },
          {
            "name": "nZone",
            "technicalDefault": "5",
            "businessMeaning": "Identifies the specific layer index (e.g., interior finish, exterior sheathing) to dimension.",
            "validRange": "-5 to 5",
            "unit": "Index",
            "affectsOutput": "Filters the sheeting elements to be dimensioned. A value of 0 triggers dimensioning of structural beams instead of sheets."
          },
          {
            "name": "strTextDirD",
            "technicalDefault": "None",
            "businessMeaning": "Controls the orientation of text for individual segment lengths (Delta dimensions).",
            "validRange": "None, Parallel, Perpendicular",
            "unit": "N/A",
            "affectsOutput": "Rotates the individual measurement text to be parallel to the dimension line, perpendicular to it, or at the default angle."
          },
          {
            "name": "strTextDirC",
            "technicalDefault": "Parallel",
            "businessMeaning": "Controls the orientation of text for cumulative lengths (running dimensions).",
            "validRange": "None, Parallel, Perpendicular",
            "unit": "N/A",
            "affectsOutput": "Rotates the cumulative measurement text to align with the dimension line."
          },
          {
            "name": "sShowProfile",
            "technicalDefault": "Left",
            "businessMeaning": "Determines the start direction and sorting order for the dimension chain.",
            "validRange": "Left, Right",
            "unit": "N/A",
            "affectsOutput": "Reverses the order of dimension points (Left-to-Right vs Right-to-Left), affecting how cumulative values increase."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Selects the CAD standard for the appearance of the dimension (arrowheads, text size, etc.).",
            "validRange": "Any Dimension Style defined in the drawing",
            "unit": "N/A",
            "affectsOutput": "Updates the visual representation (color, font, ticks) of the dimension entity in Paper Space."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "strAllZones set to 'Use zone index'",
            "effect": "Activates the nZone filter. If nZone is 0, the script switches from dimensioning sheets to dimensioning beams.",
            "cascade": [
              "nZone"
            ]
          },
          {
            "trigger": "sShowProfile changed",
            "effect": "Reverses the array of dimension points, effectively flipping the start and end points of the dimension line.",
            "cascade": [
              "strTextDirD",
              "strTextDirC"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Dimension",
            "description": "Paper Space dimension lines displaying the positions of structural timber and sheathing.",
            "appliedTo": "Viewport and Element in Layout."
          }
        ]
      },
      "tokens_used": 6514,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. User launches script and selects insertion point in Paper Space (getPoint).\",\n    \"2. User selects a Viewport linked to a Model Space Element (getViewport).\",\n    \"3. Script retrieves Element and calculates transformation (Model to Paper Space).\",\n    \"4. Script analyzes Element orientation in the Viewport to determine axis mapping (X, Y, Z to Screen X/Y).\",\n    \"5. Script initializes Dimension Line geometry based on user property (Horizontal/Vertical).\",\n    \"6. Script collects extreme points from all beams and bottom plates.\",\n    \"7. Script filters entities based on 'Zones to use' and 'Zone index' properties (All GenBeams, Specific Zone Sheets, or Structural Beams).\",\n    \"8. Script projects collected points onto the dimension line.\",\n    \"9. Script sorts points based on the 'Numbering Direction' property (Left-to-Right or Right-to-Left).\",\n    \"10. Script generates and draws the Dimension entity in Paper Space.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"User selection for 'Direction' (strDir)\",\n      \"path1\": {\n        \"name\": \"Horizontal\",\n        \"steps\": [\n          \"Sets dimension vector (vecDimDir) to Paper Space X-axis (_XW) equivalent.\",\n          \"Includes bottom plate extreme points in the dimension chain.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Vertical\",\n        \"steps\": [\n          \"Sets dimension vector (vecDimDir) to Paper Space Y-axis (_YW) equivalent.\",\n          \"Skips bottom plate specific extreme point logic.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"User selection for 'Zones to use' (strAllZones) and 'Zone index' (nZone)\",\n      \"path1\": {\n        \"name\": \"All Zones\",\n        \"steps\": [\n          \"Retrieves all GenBeams from the element.\",\n          \"Collects dimension points from all retrieved GenBeams.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Use Zone Index\",\n        \"steps\": [\n          \"Checks value of nZone.\",\n          \"If nZone == 0: Filters structural Beams (excluding specific IDs) and adds extreme element points.\",\n          \"If nZone != 0: Retrieves Sheets from the specific Zone Index.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Element Orientation Detection\",\n      \"path1\": {\n        \"name\": \"Standard Views (Plan/Front/Side)\",\n        \"steps\": [\n          \"Matches Element X/Y/Z to Screen X/Y based on parallelism.\",\n          \"Defines vx (Dim Direction) and vy (Perpendicular).\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Non-Standard/Rotated View\",\n        \"steps\": [\n          \"Fails alignment checks.\",\n          \"Reports Error: 'Vectors not aligned'.\",\n          \"Script terminates drawing.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"User selection for 'Numbering Direction' (sShowProfile)\",\n      \"path1\": {\n        \"name\": \"Left (Default)\",\n        \"steps\": [\n          \"Maintains the calculated order of dimension points.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Right\",\n        \"steps\": [\n          \"Reverses the order of points in the array (swapping indices).\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Viewport Element Validity\",\n      \"errorMessage\": \"None (Silent Failure)\",\n      \"recovery\": \"Ensure the selected viewport contains a valid hsbCAD Element and is linked to model space data.\"\n    },\n    {\n      \"check\": \"Element Axis Alignment to Screen\",\n      \"errorMessage\": \"Error! Vectors not aligned.\",\n      \"recovery\": \"Rotate the viewport or element so the main axes (X, Y, or Z) are horizontal or vertical on the screen.\"\n    },\n    {\n      \"check\": \"Existence of Bottom Plates\",\n      \"errorMessage\": \"Runtime Error (Script Crash)\",\n      \"recovery\": \"Ensure the element contains at least one Bottom Plate beam, as the script relies on it to define the reference line for sorting points.\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Change Dimension Orientation\",\n      \"how\": \"OPM Property 'Direction'\",\n      \"effect\": \"Switches the dimension line between Horizontal and Vertical relative to the screen.\"\n    },\n    {\n      \"action\": \"Filter Dimensioned Content\",\n      \"how\": \"OPM Properties 'Zones to use' and 'Zone index'\",\n      \"effect\": \"Toggles between dimensioning all structural members, only structural beams, or sheathing from a specific layer.\"\n    },\n    {\n      \"action\": \"Adjust Witness Line Location\",\n      \"how\": \"OPM Property 'Side of beams/sheets'\",\n      \"effect\": \"Moves dimension pick points to the Left, Center, or Right side of members.\"\n    },\n    {\n      \"action\": \"Reverse Dimension Order\",\n      \"how\": \"OPM Property 'Numbering Direction'\",\n      \"effect\": \"Reverses the sequence of dimensions (Left-to-Right vs Right-to-Left).\"\n    },\n    {\n      \"action\": \"Modify Visual Style\",\n      \"how\": \"OPM Property 'Dimension Style'\",\n      \"effect\":"
      },
      "tokens_used": 9415,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Layout_DIM_Elements_Type2.mcr\n\n## Overview\nAutomates the creation of dimension lines for timber construction elements (walls or floors) in Paper Space layouts. It calculates dimensions based on Model Space entities (beams/sheets) and projects them into the selected Layout viewport, labeling positions based on specific zones and alignment settings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | Script operates within Paper Space Layouts. |\n| Paper Space | Yes | Script requires a Viewport to be selected. |\n| Shop Drawing | Yes | Used for generating production layout dimensions. |\n\n## Prerequisites\n- **Required Entities:** A Layout (Paper Space) tab containing at least one Viewport linked to a valid hsbCAD Element (Wall or Floor).\n- **Minimum Beam Count:** 1 (The element must contain structural data).\n- **Required Settings:** Standard AutoCAD Dimension Styles must exist in the drawing.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Layout_DIM_Elements_Type2.mcr` from the list.\n\n### Step 2: Select Insertion Point\n```\nCommand Line: Select point\nAction: Click in the Paper Space (Layout) where you want the dimension line to appear.\n```\n\n### Step 3: Select Viewport\n```\nCommand Line: Select a viewport, you can add others later on with the HSB_LINKTOOLS command.\nAction: Click on the border of the Viewport that displays the element you wish to dimension.\n```\n\n*Note: Once inserted, the dimension will generate. You can modify its appearance and behavior using the Properties Palette (Ctrl+1).*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Direction | dropdown | Horizontal | Sets the orientation of the dimension line on the sheet (Horizontal or Vertical). |\n| Side of beams/sheets | dropdown | Left | Determines which side of the timber members is used to place dimension points (Left, Center, Right, or Left and right). |\n| Zones to use | dropdown | Use zone index | Selects whether to dimension the entire element (\"All\") or a specific construction layer (\"Use zone index\"). |\n| Zone index | dropdown | 5 | The specific layer index to dimension. Use **0** to dimension structural beams instead of sheathing. |\n| Delta text direction | dropdown | None | Controls the rotation of text for individual segment lengths (None, Parallel, or Perpendicular). |\n| Cumm text direction | dropdown | Parallel | Controls the rotation of text for cumulative/running dimensions. |\n| Numbering Direction | dropdown | Left | Sets the sorting order for the dimension chain (Left-to-Right or Right-to-Left). |\n| Dimension Style | dropdown | *(Current)* | Selects the visual style (arrows, text size) for the dimension from available AutoCAD styles. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add specific items to the right-click context menu. Edit properties via the palette. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Viewport Alignment:** Ensure your viewport view is \"straight\" (Plan, Front, or Side elevation). If the view is rotated (isometric or arbitrary angle), the script may fail with an error: \"Error! Vectors not aligned.\"\n- **Filtering Content:** To dimension only the structural studs (timber) and ignore the sheathing sheets, set **Zones to use** to \"Use zone index\" and set **Zone index** to `0`.\n- **Numbering Order:** Use the **Numbering Direction** property to reverse the dimension chain if the numbers start from the wrong side of the element.\n- **Text Readability:** If dimension text overlaps, try changing the **Delta text direction** to \"Perpendicular\" to rotate individual measurements.\n\n## FAQ\n- **Q: Why do I get an error saying \"Vectors not aligned\"?**\n  **A:** The script cannot determine the horizontal/vertical axes because the Viewport is rotated too much. Use the AutoCAD `DVIEW` or `MVSETUP` commands (or the hsbCAD Viewport tools) to square the view to the screen.\n- **Q: How do I switch between dimensioning the OSB sheets and the timber studs?**\n  **A:** In the Properties Palette, change **Zone index**. If it is currently `5`, `4`, etc., it dimensions sheets. Change it to `0` to dimension the structural beams.\n- **Q: Can I move the dimension line after inserting it?**\n  **A:** Yes. Select the dimension entity in Paper Space and use standard AutoCAD move commands or grips to reposition it. The dimension values will remain linked to the model space geometry."
      },
      "tokens_used": 6433,
      "error": null
    }
  }
}