{
  "filename": "hsb_ShowSIPSplinesOnLayout.mcr",
  "status": "completed",
  "total_tokens": 24147,
  "processing_time": 171.4742250442505,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 2,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "31.08.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "First Release."
          },
          {
            "version": "1.1",
            "date": "19.08.2009",
            "author": "",
            "changes": "First Release."
          },
          {
            "version": "1.2",
            "date": "17.09.2010",
            "author": "",
            "changes": "Show the name of the timber istead of the type."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3572,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _Viewport.append(getViewport()) during _bOnInsert to select a layout viewport. It retrieves the Element from the Viewport (vp.element()) and calculates geometry (ms2ps, ps2ms) to transform model coordinates to paper space coordinates using ptToDisplay.transformBy(ms2ps) for drawing text."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "Beam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Paper Space with a Viewport linked to a valid Element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 3170,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dim Style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffsetFromEl",
            "type": "PropDouble",
            "displayName": "Offset From Element",
            "defaultValue": "50",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2749,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Annotates a PaperSpace layout with the names of structural members (e.g., splines, studs) found in the selected Viewport, projecting labels onto the 2D drawing.",
          "category": "ShopDrawing",
          "typicalUseCase": "A user creating shop drawings for wall or floor panels needs to identify and label specific structural members (like splines in SIP panels) in the elevation or plan view on a layout sheet."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "The visual style definition (font, size, layer) used for the generated text labels in the drawing. It ensures the annotations match company drafting standards.",
            "validRange": "Any Dimension Style name currently loaded in the CAD drawing.",
            "unit": "String",
            "affectsOutput": "Alters the height, font, color, and layer of the text labels drawn in PaperSpace."
          },
          {
            "name": "dOffsetFromEl",
            "technicalDefault": "50",
            "businessMeaning": "The distance the label is shifted away from the beam's projected center line relative to the Element's coordinate system. This prevents labels from overlapping with the beam drawing.",
            "validRange": "0 to 1000 (depending on drawing scale and element size)",
            "unit": "mm",
            "affectsOutput": "Moves the text label closer to or further from the beam geometry on the layout. A value too low causes overlap; a value too high places the label far away from the relevant member."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "Text Annotation",
            "description": "String labels displaying the name of beams (filtered as perpendicular to the Element's X-axis) drawn in PaperSpace coordinates.",
            "appliedTo": "PaperSpace Layout (associated with the selected Viewport)"
          }
        ]
      },
      "tokens_used": 4313,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script in AutoCAD/hsbCAD.",
          "2. [Insert Phase] Prompt user 'Select a viewport'.",
          "3. User selects a Viewport entity in PaperSpace.",
          "4. Display Properties Dialog (Dim Style, Offset From Element).",
          "5. [Calculation Phase] Validate that a Viewport is attached to the script instance.",
          "6. Retrieve the 3D Element associated with the selected Viewport.",
          "7. Check if Element is valid.",
          "8. Collect all Beams contained within the Element.",
          "9. Filter Beams: Select only those perpendicular to the Element's X-axis (sorted).",
          "10. Define a clipping area (PlaneProfile) on the Element's local XY plane.",
          "11. Loop through filtered Beams.",
          "12. For each Beam: Calculate shadow profile on the Element's Z-plane and intersect with clipping area.",
          "13. [Conditional] Check if intersected area is greater than 4mm².",
          "14. If valid: Project Beam center onto Element's X-axis line to determine label X-coordinate.",
          "15. Apply Offset distance in negative Y-direction to determine final position.",
          "16. Transform Model Space coordinates to Paper Space coordinates.",
          "17. Draw Text Label using specified Dimension Style."
        ],
        "conditionalBranches": [
          {
            "condition": "Script Execution State (Insert vs. Recalc)",
            "path1": {
              "name": "Insertion",
              "steps": [
                "Prompt for Viewport selection",
                "Show Properties Dialog",
                "Stop execution (return)"
              ]
            },
            "path2": {
              "name": "Calculation/Update",
              "steps": [
                "Validate existing Viewport attachment",
                "Process geometry and draw labels"
              ]
            }
          },
          {
            "condition": "Viewport Attachment Check",
            "path1": {
              "name": "No Viewport Attached",
              "steps": [
                "Erase script instance from drawing",
                "Exit (return)"
              ]
            },
            "path2": {
              "name": "Viewport Present",
              "steps": [
                "Retrieve Element from Viewport",
                "Proceed to processing"
              ]
            }
          },
          {
            "condition": "Element Validity",
            "path1": {
              "name": "Element Invalid",
              "steps": [
                "Silent Exit (return)"
              ]
            },
            "path2": {
              "name": "Element Valid",
              "steps": [
                "Extract coordinate system and beams",
                "Proceed to processing"
              ]
            }
          },
          {
            "condition": "Beam Geometry Threshold (Shadow Area)",
            "path1": {
              "name": "Insignificant Geometry (Area <= 4mm²)",
              "steps": [
                "Skip beam (do not label)"
              ]
            },
            "path2": {
              "name": "Significant Geometry (Area > 4mm²)",
              "steps": [
                "Get Beam Name",
                "Calculate Label Position",
                "Add to drawing"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport List Length",
            "errorMessage": "None (Script self-destructs)",
            "recovery": "User must run the script again and select a viewport."
          },
          {
            "check": "Element Validity inside Viewport",
            "errorMessage": "None (Silent failure)",
            "recovery": "User must ensure the selected Viewport looks at a valid hsbCAD Element."
          },
          {
            "check": "Beam Count",
            "errorMessage": "None (Silent failure)",
            "recovery": "User must ensure the Element contains beams."
          },
          {
            "check": "Shadow Profile Area",
            "errorMessage": "None (Beam ignored)",
            "recovery": "N/A (Filter designed to ignore small slivers/fillers)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Offset Distance",
            "how": "OPM (Object Properties Manager) - Change 'Offset From Element' value",
            "effect": "Re-calculates label positions, moving them closer to or further from the element centerline in the drawing."
          },
          {
            "action": "Change Visual Style",
            "how": "OPM - Change 'Dim Style' property",
            "effect": "Updates all text labels to the selected dimension style (font, height, layer)."
          },
          {
            "action": "Model Updates",
            "how": "Modify the 3D Element or Beams (add/remove/resize)",
            "effect": "On recalculation (e.g., save/reload or context menu recalc), labels update to reflect new beam names, positions, or quantities."
          }
        ]
      },
      "tokens_used": 5553,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ShowSIPSplinesOnLayout\n\n## Overview\nThis script automates the labeling of structural members (such as splines or studs) on a 2D layout. It projects the names of specific beams found in a Viewport onto the Paper Space, creating clear annotations for shop drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is intended for 2D Layouts. |\n| Paper Space | Yes | The script must be run on a Layout tab containing a Viewport. |\n| Shop Drawing | Yes | Designed for annotating production drawings. |\n\n## Prerequisites\n- **Required Entities**: A Layout Viewport that is linked to a valid hsbCAD Element.\n- **Minimum Beams**: The Element within the Viewport must contain at least one beam.\n- **Required Settings**: None (Standard AutoCAD Dimension Styles are recommended).\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Open the target Layout tab in AutoCAD.\n2. Type `TSLINSERT` in the command line.\n3. Select `hsb_ShowSIPSplinesOnLayout.mcr` from the file list.\n\n### Step 2: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the border of the Viewport displaying the Element you wish to annotate.\n```\n*Note: If you cancel or select an invalid viewport, the script instance will automatically delete itself.*\n\n### Step 3: Configure Properties\n1. After selecting the viewport, the script instance is created.\n2. Select the script instance (it may appear as a small cross or marker near the viewport).\n3. Open the **Properties Palette** (Ctrl+1).\n4. Adjust the **Dim Style** and **Offset From Element** as needed (see Parameters below).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dim Style | Text | \"\" | Select a Dimension Style name from the drawing to control the font, size, and layer of the text labels. |\n| Offset From Element | Number | 50 | The distance (in mm) to shift the label away from the beam's center line. Increase this value if labels overlap the drawing. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add custom items to the right-click menu. Updates happen automatically via the Properties Palette. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Avoid Overlap**: If labels are crossing over beams or other text, increase the \"Offset From Element\" value in the Properties Palette.\n- **Consistent Styling**: Ensure your chosen \"Dim Style\" uses a text height appropriate for your plot scale.\n- **Filtered Beams**: The script specifically labels beams that are perpendicular to the Element's local X-axis. Beams running parallel to the main direction will be ignored.\n- **Small Elements**: Very small beams or filler pieces (with a projection area less than 4mm²) are automatically ignored to keep the drawing clean.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the viewport?**\n  **A:** This happens if the selected Viewport is not linked to a valid hsbCAD Element or if the Element contains no valid data. Ensure you select a viewport showing a 3D model.\n- **Q: Why are some beams not showing labels?**\n  **A:** The script only labels beams perpendicular to the Element's X-axis and ignores beams smaller than 4mm² in area.\n- **Q: How do I update the labels if I change the 3D model?**\n  **A:** The script listens for model updates. If you modify the beams in the Element, save or refresh the drawing, and the labels will recalculate automatically. You can also manually trigger an update by changing the \"Offset From Element\" value."
      },
      "tokens_used": 4790,
      "error": null
    }
  }
}