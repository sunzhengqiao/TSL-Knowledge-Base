{
  "filename": "hsb_LinkBeamsToElement.mcr",
  "status": "completed",
  "total_tokens": 25364,
  "processing_time": 594.4668562412262,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "05.09.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "02.02.2012",
            "author": "",
            "changes": "Added property to set colour to that of the zone"
          },
          {
            "version": "1.2",
            "date": "03.02.2012",
            "author": "",
            "changes": "Bugfix on Insert"
          },
          {
            "version": "1.3",
            "date": "20.03.2012",
            "author": "",
            "changes": "Bugfix when no beam code was set"
          },
          {
            "version": "1.4",
            "date": "26.06.2012",
            "author": "",
            "changes": "Add Zone 0 to the list of available zones to assign the beams"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4302,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity to select Beam entities and getElement to select Elements. It modifies model data using bm.assignToElementGroup(). No 'sd_' functions, '_Viewport', or shop drawing markers ('#Type E') are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 2814,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect beams",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getElement",
              "promptOriginal": "Select element to attach the beams",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nZones",
            "type": "PropInt",
            "displayName": "Zone to Assign the Beams",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              0,
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sZoneColour",
            "type": "PropString",
            "displayName": "Use Sheeting Zone Colour?",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "Sets the colour of the beams from the selected zone"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2832,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A utility script to logically assign loose timber beams to a specific construction zone within a target Element and optionally match the beams' display color to that zone.",
          "category": "Data Management / Construction Logic",
          "typicalUseCase": "Used when beams (e.g., purlins, studs, or joists) have been drawn independently or imported and need to be 'adopted' by a main wall, floor, or roof element for proper CAM processing, material listing, or drawing organization."
        },
        "parameters": [
          {
            "name": "nZones",
            "technicalDefault": 0,
            "businessMeaning": "Identifies the specific 'Zone' (construction layer or side) within the target Element that the beams belong to. In hsbCAD, zones typically represent wall layers (e.g., framing vs. sheathing) or sides (internal/external). Values 6-10 map to negative zones (-1 to -5).",
            "validRange": "0 to 10 (Mapped to 0, 1, 2, 3, 4, 5, -1, -2, -3, -4, -5)",
            "unit": "Index",
            "affectsOutput": "Determines the structural grouping of the beam. If 'Use Sheeting Zone Colour' is active, this determines which color palette is used."
          },
          {
            "name": "sZoneColour",
            "technicalDefault": "No",
            "businessMeaning": "A toggle to override the beams' current visual color with the specific color defined in the Element's settings for the selected Zone.",
            "validRange": "\"No\", \"Yes\"",
            "unit": "Enumeration",
            "affectsOutput": "Visual appearance (AutoCAD Color Index) of the selected beams. Does not affect geometry or machining."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sZoneColour is set to \"Yes\"",
            "effect": "The resulting color of the beams becomes dependent on the color defined in the Element's properties for the Zone specified in 'nZones'.",
            "cascade": [
              "nZones"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam (Modification)",
            "description": "Updates the data properties of existing beams to link them to an Element Group and updates their Color property.",
            "appliedTo": "User-selected Beams"
          }
        ]
      },
      "tokens_used": 4130,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches script (Insert)",
          "System checks insertion cycle count",
          "[Conditional] Display Properties Dialog (if launched without execute key)",
          "Command line prompt: Select beams",
          "User selects one or more Beams",
          "Command line prompt: Select element to attach the beams",
          "User selects one Element",
          "Script validates Element and Beam selections",
          "[Conditional] Map Zone Index (0-5 maps to 0-5; 6-10 maps to -1 to -5)",
          "Script loops through selected Beams",
          "Script executes: Assign Beam to Element Group and Zone",
          "[Conditional] Set Beam Color (if 'Use Sheeting Zone Colour' is Yes)",
          "Script executes: Erase Instance (Self-destruct)"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Count > 1",
              "steps": [
                "Erase Instance",
                "Exit Script"
              ]
            },
            "path2": {
              "name": "Count == 1",
              "steps": [
                "Continue to User Prompts"
              ]
            }
          },
          {
            "condition": "Property 'Use Sheeting Zone Colour' (sZoneColour)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Retrieve color index from Element's Zone properties",
                "Apply color to Beam entity"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skip color assignment"
              ]
            }
          },
          {
            "condition": "Input Validation",
            "path1": {
              "name": "Missing Element or Beams",
              "steps": [
                "Erase Instance",
                "Exit (Silent Failure)"
              ]
            },
            "path2": {
              "name": "Valid Selection",
              "steps": [
                "Execute Linking Logic"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "None (Script fails silently)",
            "recovery": "Re-run the script and ensure an Element is selected."
          },
          {
            "check": "Beam Selection",
            "errorMessage": "None (Script fails silently)",
            "recovery": "Re-run the script and ensure at least one Beam is selected."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Script Instance Removal",
            "how": "Automatic (Internal Code)",
            "effect": "The script instance is immediately erased from the drawing. The property changes (Assignment and Color) are permanently applied to the selected beams."
          }
        ]
      },
      "tokens_used": 6443,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_LinkBeamsToElement.mcr\n\n## Overview\nThis script allows you to link loose timber beams (such as purlins or studs) to a specific construction zone within a target Element. It optionally updates the beams' display color to match the Element's zone settings for better visual organization.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in the 3D model environment. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | This is a model editing tool and does not generate shop drawings. |\n\n## Prerequisites\n- **Required Entities**: You must have at least one GenBeam and one Element (e.g., a wall, floor, or roof) existing in the model.\n- **Minimum Beam Count**: You must select at least one beam to link.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsb_LinkBeamsToElement.mcr` from the list.\n\n### Step 2: Select Beams\n```\nCommand Line: Select beams\nAction: Click on one or more beams in the model that you wish to assign to an element.\n         Press Enter to confirm your selection.\n```\n\n### Step 3: Select Target Element\n```\nCommand Line: Select element to attach the beams\nAction: Click on the main Element (Wall/Floor/Roof) that you want to take ownership of the selected beams.\n```\n\n### Step 4: Completion\nThe script automatically assigns the beams to the specified zone and updates their color (if configured). The script instance will then automatically erase itself from the drawing.\n\n## Properties Panel Parameters\nYou can adjust these settings in the AutoCAD Properties Palette (Ctrl+1) before selecting the entities if desired.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Zone to Assign the Beams | dropdown | 0 | Determines which construction layer/zone inside the element the beams belong to. Options 6–10 correspond to negative zones (-1 to -5). |\n| Use Sheeting Zone Colour? | dropdown | No | If set to \"Yes\", the script changes the beams' color to match the color defined for the selected zone in the Element's properties. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add custom options to the right-click context menu. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Visual Organization**: If you are struggling to see which beams belong to which element, set \"Use Sheeting Zone Colour?\" to \"Yes\". The beams will change color to match the element's layer coding.\n- **Negative Zones**: If your element uses negative zones (often used for exterior layers or cladding), select values 6 through 10 in the Zone list (6 = -1, 10 = -5).\n- **Re-running**: If you make a mistake, simply select the beams again and run the script to re-assign them to the correct element.\n\n## FAQ\n- **Q: Why did the script disappear from my drawing after I used it?**\n  **A:** This is a \"utility\" script designed to perform an action once. It automatically erases itself after linking the beams to keep your drawing clean. The link you created remains.\n- **Q: What happens if I don't select any beams?**\n  **A:** The script will exit silently without making changes. Ensure you have selected beams and an element before proceeding."
      },
      "tokens_used": 4843,
      "error": null
    }
  }
}