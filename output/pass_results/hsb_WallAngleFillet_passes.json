{
  "filename": "hsb_WallAngleFillet.mcr",
  "status": "completed",
  "total_tokens": 53174,
  "processing_time": 222.2929961681366,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "16.09.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "16.09.2008",
            "author": null,
            "changes": "Add the basic Properties of the beams that are created"
          },
          {
            "version": "1.2",
            "date": "16.09.2008",
            "author": null,
            "changes": "Publish the Properties"
          },
          {
            "version": "1.2",
            "date": "16.09.2008",
            "author": null,
            "changes": "Publish the Properties"
          },
          {
            "version": "1.5",
            "date": "20.01.2011",
            "author": null,
            "changes": "Add property for Display Rep and fix issue with multiple creation of beams in some cases"
          },
          {
            "version": "1.6",
            "date": "14.04.2011",
            "author": null,
            "changes": "Fixed Solid Beam Generation, added check for parallel walls and added hsbId=999 to fillets"
          },
          {
            "version": "1.8",
            "date": "14.04.2011",
            "author": null,
            "changes": "All the beams are now Type Stud and have beam code \"AF\""
          },
          {
            "version": "1.9",
            "date": "14.04.2015",
            "author": null,
            "changes": "Beam Type changes to Wedge"
          }
        ],
        "settingsFiles": [
          "Materials.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 8579,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _bOnInsert with PrEntity to select Element types. Explicitly casts to ElementWall. Uses dbCreate to generate new beams. No usage of sd_ functions, Viewport, or #Type E."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing two perpendicular connected ElementWall entities.",
          "requiredSettings": [
            "Materials.xml"
          ]
        }
      },
      "tokens_used": 7231,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect 2 Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowNotice",
            "trigger": "Error on Startup (Missing Materials.xml)",
            "title": null,
            "dataSource": "Static String",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "ShowNotice",
            "trigger": "Error on Startup (Empty Materials List)",
            "title": null,
            "dataSource": "Static String",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sStretchPlates",
            "type": "PropString",
            "displayName": "Stretch Top and Bottom Plate",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "If YES then the top and bottom plate will be stretch creating a miter connection, otherwise the Angle Fillets will be the full heigth of the wall"
          },
          {
            "index": 1,
            "variable": "sFullBeam",
            "type": "PropString",
            "displayName": "Create a Full Solid Beam",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "If YES then a full solid beam will be created and will be attach to one of the elements, otherwise 2 half beams will be put in place"
          },
          {
            "index": 2,
            "variable": "sName",
            "type": "PropString",
            "displayName": "Name",
            "defaultValue": "Fillet",
            "inputType": "text",
            "options": [],
            "category": "Beam Properties",
            "description": null
          },
          {
            "index": 3,
            "variable": "sMaterial",
            "type": "PropString",
            "displayName": "Material",
            "defaultValue": "Dynamic",
            "inputType": "dropdown",
            "options": [
              "From Materials.xml"
            ],
            "category": "Beam Properties",
            "description": null
          },
          {
            "index": 4,
            "variable": "sGrade",
            "type": "PropString",
            "displayName": "Grade",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Beam Properties",
            "description": null
          },
          {
            "index": 5,
            "variable": "sInformation",
            "type": "PropString",
            "displayName": "Information",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Beam Properties",
            "description": null
          },
          {
            "index": 6,
            "variable": "sLabel",
            "type": "PropString",
            "displayName": "Label",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Beam Properties",
            "description": null
          },
          {
            "index": 7,
            "variable": "sSublabel",
            "type": "PropString",
            "displayName": "Sublabel",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Beam Properties",
            "description": null
          },
          {
            "index": 8,
            "variable": "sSublabel2",
            "type": "PropString",
            "displayName": "Sublabel2",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Beam Properties",
            "description": null
          },
          {
            "index": 9,
            "variable": "strNailing",
            "type": "PropString",
            "displayName": "Set Fillets as NO Nail",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 32,
            "inputType": "number",
            "options": [],
            "category": "Beam Properties",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Reapply Timbers",
            "handler": "Reapply Timbers",
            "action": "Sets execution mode to regenerate and replace the created internal beams.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "Materials.xml",
            "searchPaths": [
              "_kPathHsbCompany\\Abbund\\Materials.xml"
            ],
            "purpose": "Provides the list of valid material names for the OPM Material property.",
            "required": true
          }
        ]
      },
      "tokens_used": 8491,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates corner fillet (angle studs) timber to fill the void between two perpendicular timber frame walls, with options to miter the top/bottom plates.",
          "category": "Framing/Joinery",
          "typicalUseCase": "Used when two walls meet at a 90-degree angle to provide structural support or close the gap for insulation/sheathing, specifically creating the angled studs ( wedges) at the intersection."
        },
        "parameters": [
          {
            "name": "sStretchPlates",
            "technicalDefault": "No",
            "businessMeaning": "Determines if the top and bottom plates of the existing walls should be mitered (cut at an angle) to meet flush with the corner fillet. If 'No', the plates remain square and the fillet occupies the full height between them.",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "Geometry of the existing wall plates (adds static cuts/angles) and the vertical height of the fillet beams."
          },
          {
            "name": "sFullBeam",
            "technicalDefault": "No",
            "businessMeaning": "Controls the physical composition of the corner filler. If 'Yes', a single solid wedge block is created. If 'No', two separate timber pieces (split wedges) are created, one attached to each wall.",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "Number of generated beams (1 vs 2) and the logical grouping of the corner geometry."
          },
          {
            "name": "sName",
            "technicalDefault": "Fillet",
            "businessMeaning": "The identifier name assigned to the generated corner beams for lists and schedules.",
            "validRange": "Alphanumeric String",
            "unit": "text",
            "affectsOutput": "Metadata (Name property of the GenBeam)."
          },
          {
            "name": "sMaterial",
            "technicalDefault": "Dynamic",
            "businessMeaning": "The specific timber material grade or species to be used for manufacturing the corner fillets.",
            "validRange": "List from Materials.xml",
            "unit": "text",
            "affectsOutput": "Material property of the GenBeam."
          },
          {
            "name": "sGrade",
            "technicalDefault": "",
            "businessMeaning": "Structural grade designation (e.g., C24) of the timber.",
            "validRange": "String",
            "unit": "text",
            "affectsOutput": "Grade property of the GenBeam."
          },
          {
            "name": "sInformation",
            "technicalDefault": "",
            "businessMeaning": "Additional comments or manufacturing instructions specific to the piece.",
            "validRange": "String",
            "unit": "text",
            "affectsOutput": "Information property of the GenBeam."
          },
          {
            "name": "sLabel",
            "technicalDefault": "",
            "businessMeaning": "Primary label text to be physically marked on the timber piece.",
            "validRange": "String",
            "unit": "text",
            "affectsOutput": "Label property of the GenBeam."
          },
          {
            "name": "sSublabel",
            "technicalDefault": "",
            "businessMeaning": "Secondary label text for additional identification.",
            "validRange": "String",
            "unit": "text",
            "affectsOutput": "Sublabel property of the GenBeam."
          },
          {
            "name": "sSublabel2",
            "technicalDefault": "",
            "businessMeaning": "Tertiary label text for additional identification.",
            "validRange": "String",
            "unit": "text",
            "affectsOutput": "Sublabel2 property of the GenBeam."
          },
          {
            "name": "strNailing",
            "technicalDefault": "No",
            "businessMeaning": "If 'Yes', marks the beam with the code suffix 'NO', typically indicating the piece should not be nailed or is processed differently (e.g., glue-only).",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "Beam Code attribute (appends ';;;;;;;;NO;')."
          },
          {
            "name": "nColor",
            "technicalDefault": 32,
            "businessMeaning": "The display color of the generated beams in the CAD model for visual differentiation.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "number",
            "affectsOutput": "Visual representation."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sStretchPlates set to 'Yes'",
            "effect": "Modifies existing wall plates by adding static cuts to create a mitered joint.",
            "cascade": [
              "ElementWall Top Plates",
              "ElementWall Bottom Plates"
            ]
          },
          {
            "trigger": "sFullBeam set to 'Yes'",
            "effect": "Creates a single combined wedge beam instead of two separate ones.",
            "cascade": [
              "Beam Count"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam (Wedge)",
            "description": "Angled timber stud(s) filling the corner intersection. The shape is a wedge defined by the wall heights and the angle between walls.",
            "appliedTo": "The intersection of the two selected ElementWall entities."
          },
          {
            "type": "Static Cut (Miter)",
            "description": "Angular cuts applied to the top and bottom plates of the walls to accept the fillet.",
            "appliedTo": "Existing horizontal beams (plates) within the selected ElementWall entities."
          }
        ]
      },
      "tokens_used": 9875,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Verify Materials.xml exists and contains valid entries.",
          "2. Insert Phase: Prompt user to select 2 Elements (Walls) via PrEntity.",
          "3. Selection Validation: Check if exactly 2 valid ElementWalls are selected.",
          "4. Geometry Validation: Verify walls are connected (touching) and are not parallel (perpendicular intersection required).",
          "5. Calculation: Determine intersection points, wall centers, and identify interior vs. exterior corners.",
          "6. Branch 1 (sStretchPlates): Check property setting.",
          "7. Branch 2 (sFullBeam): Check property setting to determine generation method.",
          "8. Execution: Generate new beam(s) and apply top/bottom cuts based on plate stretching configuration.",
          "9. Finalization: Apply user properties (Name, Material, Code, etc.) and update display representation."
        ],
        "conditionalBranches": [
          {
            "condition": "Materials.xml Check",
            "path1": {
              "name": "File Found and Valid",
              "steps": [
                "Read materials list into array.",
                "Populate Material property dropdown.",
                "Proceed to Insert phase."
              ]
            },
            "path2": {
              "name": "File Missing or Empty",
              "steps": [
                "Display Notice: 'Materials not been set...'",
                "Call eraseInstance().",
                "Stop script execution."
              ]
            }
          },
          {
            "condition": "sStretchPlates Property (Miter Plates)",
            "path1": {
              "name": "Yes (Stretch/Miter)",
              "steps": [
                "Identify horizontal beams (plates) intersecting the interior corner body.",
                "Add Static Cut (miter) to the top and bottom plates of both walls.",
                "Generate fillet beams."
              ]
            },
            "path2": {
              "name": "No (Full Height)",
              "steps": [
                "Do not modify existing wall plates.",
                "Generate fillet beams to fit full height between current plates.",
                "Apply top/bottom cuts to the fillet beams themselves to match plate height."
              ]
            }
          },
          {
            "condition": "sFullBeam Property (Geometry Type)",
            "path1": {
              "name": "Yes (Single Beam)",
              "steps": [
                "Calculate combined wedge geometry.",
                "Determine if angle is obtuse or acute to define side cuts.",
                "Create 1 GenBeam (Type Wedge).",
                "Assign to Element Group of Wall 1."
              ]
            },
            "path2": {
              "name": "No (Split Beams)",
              "steps": [
                "Create 1 GenBeam attached to Wall 1.",
                "Create 1 GenBeam attached to Wall 2.",
                "Apply miter cuts to the joining faces of both beams.",
                "Assign each beam to their respective wall's Element Group."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Materials.xml exists at _kPathHsbCompany\\Abbund\\",
            "errorMessage": "Materials not been set, please run hsbMaterial Utility or contact SupportDesk",
            "recovery": "Run hsbMaterial utility to configure materials or ensure XML file is present."
          },
          {
            "check": "Materials list contains entries",
            "errorMessage": "Materials not been set, please run hsbMaterial Utility or contact SupportDesk",
            "recovery": "Check XML file content or regenerate via utility."
          },
          {
            "check": "Exactly 2 Elements selected",
            "errorMessage": "(Silent failure - Script erases instance)",
            "recovery": "Re-run script and select 2 elements."
          },
          {
            "check": "Selected entities are valid ElementWalls",
            "errorMessage": "(Silent failure - Script erases instance)",
            "recovery": "Ensure selection objects are Timber Frame Walls."
          },
          {
            "check": "Walls are connected (getConnectedElements check)",
            "errorMessage": "(Silent failure - Script erases instance)",
            "recovery": "Select walls that physically touch or intersect."
          },
          {
            "check": "Walls are not parallel (Perpendicular intersection)",
            "errorMessage": "(Silent failure - Script erases instance)",
            "recovery": "Select walls that meet at an angle (typically 90 degrees)."
          },
          {
            "check": "Walls contain horizontal beams (Plates)",
            "errorMessage": "(Silent failure - Function returns early)",
            "recovery": "Ensure walls have top and bottom plates defined."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Configuration",
            "how": "Modify OPM Properties (sStretchPlates, sFullBeam, strNailing)",
            "effect": "Triggers script recalculation: Erases old beams and regenerates based on new settings (e.g., switching from split to full beam, or applying miter cuts)."
          },
          {
            "action": "Update Metadata",
            "how": "Modify OPM Properties (Name, Material, Grade, Labels)",
            "effect": "Updates the properties of the generated fillet beams without changing geometry."
          },
          {
            "action": "Reapply Timbers",
            "how": "Right-click context menu -> 'Reapply Timbers'",
            "effect": "Forces a regeneration of the timber elements (erases old and creates new) using the current geometry and property settings."
          },
          {
            "action": "Delete Script",
            "how": "Standard CAD Erase/Delete command on the script instance",
            "effect": "Erases the script instance and all generated fillet beams associated with it."
          }
        ]
      },
      "tokens_used": 11962,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_WallAngleFillet.mcr\n\n## Overview\nThis script automatically generates corner fillet (wedge) timbers to fill the void between two perpendicular timber frame walls. It includes options to miter the top and bottom plates of the existing walls to accept the new corner pieces.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model. |\n| Paper Space | No | Not designed for 2D layouts. |\n| Shop Drawing | No | Not intended for detailing views. |\n\n## Prerequisites\n- **Required Entities**: Two `ElementWall` entities that intersect at a corner (perpendicular).\n- **Minimum Beam Count**: 0 (The script creates the new beams).\n- **Required Settings**: `Materials.xml` must exist in your hsbCAD company directory (`_kPathHsbCompany\\Abbund\\`).\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Select `hsb_WallAngleFillet.mcr` from the file dialog.\n\n### Step 2: Select Walls\n```\nCommand Line: Select 2 Elements\nAction: Click on the first wall, then click on the second wall.\n```\n*Note: The two walls must be connected and form a corner (usually 90Â°). If they are parallel or not touching, the script will fail.*\n\n### Step 3: Configure (Optional)\nAfter selection, the script generates the corner pieces. You can immediately modify the settings using the Properties Palette (Ctrl+1) while the script instance is selected. Changes will trigger a regeneration of the timber.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Stretch Top and Bottom Plate | Dropdown | No | If **Yes**, the top and bottom plates of the existing walls are cut (mitered) to meet the corner. If **No**, the fillets are created full height between the plates. |\n| Create a Full Solid Beam | Dropdown | No | If **Yes**, creates one single solid wedge. If **No**, creates two separate half-wedges (one attached to each wall). |\n| Name | Text | Fillet | The name assigned to the generated beams for scheduling. |\n| Material | Dropdown | Dynamic | The timber material to use (pulled from Materials.xml). |\n| Grade | Text | (Empty) | Structural grade of the timber (e.g., C24). |\n| Information | Text | (Empty) | Additional manufacturing notes. |\n| Label | Text | (Empty) | Primary label text for the piece. |\n| Sublabel | Text | (Empty) | Secondary label text. |\n| Sublabel2 | Text | (Empty) | Tertiary label text. |\n| Set Fillets as NO Nail | Dropdown | No | If **Yes**, appends \"NO\" to the beam code to indicate no nailing required. |\n| Color | Number | 32 | The AutoCAD color index for the generated beams. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Reapply Timbers | Deletes the currently generated corner beams and regenerates them based on the current property settings and wall geometry. Useful if the wall geometry has changed manually. |\n\n## Settings Files\n- **Filename**: `Materials.xml`\n- **Location**: `_kPathHsbCompany\\Abbund\\Materials.xml`\n- **Purpose**: Provides the list of available timber materials for the \"Material\" dropdown property. If this file is missing, the script will display an error and exit.\n\n## Tips\n- **Wall Connection**: Ensure the walls you select actually touch or intersect at their ends. The script validates for connected, non-parallel walls.\n- **Mitering**: If you want a clean corner where the top and bottom plates meet at a 45-degree angle, set \"Stretch Top and Bottom Plate\" to **Yes**.\n- **Solid vs Split**: Use the \"Create a Full Solid Beam\" option depending on your manufacturing preference. Two split beams are often easier to handle on site than one large wedge.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the walls?**\n  **A:** The most common cause is a missing or empty `Materials.xml` file. Check that your Company settings path is correct and the file contains materials. Alternatively, the walls might not be connected or might be parallel.\n\n- **Q: Can I use this on walls that are not at 90 degrees?**\n  **A:** The script is designed for perpendicular intersections. It checks if walls are parallel; however, acute or obtuse angles may result in unexpected geometry.\n\n- **Q: What happens if I change the wall height after running the script?**\n  **A:** The script does not automatically update if the wall properties change. Select the script instance and right-click **Reapply Timbers** to update the fillets to the new wall height."
      },
      "tokens_used": 7036,
      "error": null
    }
  }
}