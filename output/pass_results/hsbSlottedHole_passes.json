{
  "filename": "hsbSlottedHole.mcr",
  "status": "completed",
  "total_tokens": 49627,
  "processing_time": 312.70732164382935,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.5",
            "date": "19feb2018",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " new shape 'explicit radius' and multiple assignment added "
          },
          {
            "version": "1.4",
            "date": "24Sep2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " new property alignment added "
          },
          {
            "version": "1.3",
            "date": "25apr2016",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " Quantity and Interdistance dependencies added "
          },
          {
            "version": "1.2",
            "date": "22apr2016",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " properties categorized, insertion supports distribution and multiple insertion "
          },
          {
            "version": "1.1",
            "date": "21mar2012",
            "author": "th@hsbCAD.de",
            "changes": " bugfix"
          },
          {
            "version": "1.0",
            "date": "22feb2012",
            "author": "th@hsbCAD.de",
            "changes": " initial "
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7073,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script interacts with 'Beam' entities via PrEntity prompts, creates 3D 'Mortise' tools, and explicitly passes the '_kModelSpace' constant to the dbCreate function. It utilizes geometry classes like Body and PlaneProfile for visualization in the 3D model."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5884,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getGenBeam\",\n        \"promptOriginal\": \"|Select beam(s)|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"|Pick first point of distribution along beam axis.|\",\n        \"condition\": \"_bOnInsert && bDistribute\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"|Pick point|\",\n        \"condition\": \"_bOnInsert && !bDistribute\",\n        \"required\": true\n      },\n      {\n        \"step\": 4,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"|Pick second point| <Enter> to insert a single tool\",\n        \"condition\": \"_bOnInsert && bDistribute\",\n        \"required\": false\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"ShowDialog\",\n      \"trigger\": \"_bOnInsert (if no execute key)\",\n      \"title\": null,\n      \"dataSource\": \"TSL Instance Properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"dLength\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"(A) Length\",\n      \"defaultValue\": \"U(80,2)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry\",\n      \"description\": \"Defines the Length\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dWidth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"(B) Width\",\n      \"defaultValue\": \"U(20,1)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry\",\n      \"description\": \"Defines the Width\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dDepth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"(C) Depth\",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry\",\n      \"description\": \"Defines the Depth, 0 = complete through\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"sShape\",\n      \"type\": \"PropString\",\n      \"displayName\": \"(F) Shape\",\n      \"defaultValue\": \"Rectangular\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Rectangular\",\n        \"Round\",\n        \"Rounded\",\n        \"Explicit Radius\"\n      ],\n      \"category\": \"Geometry\",\n      \"description\": \"Defines the Shape\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"dOffset\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"(D) Offset from Axis\",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Alignment\",\n      \"description\": \"Defines the axis offset\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"dAngle\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"(E) Angle\",\n      \"defaultValue\": \"0\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Alignment\",\n      \"description\": \"Defines the Angle\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sAlignment\",\n      \"type\": \"PropString\",\n      \"displayName\": \"(J) Alignment\",\n      \"defaultValue\": \"UCS\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"UCS\",\n        \"Perpendicular to UCS\"\n      ],\n      \"category\": \"Alignment\",\n      \"description\": \"Defines the Alignment\"\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"dRadius\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"(R) Radius\",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry"
      },
      "tokens_used": 9170,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates customizable slotted holes (mortises) or rows of holes in structural timber beams to accommodate bolts, dowels, or ventilation needs.",
          "category": "Joinery/Machining",
          "typicalUseCase": "Creating slots for steel plate connections, adjustable bracing, or multiple drilling patterns in CLT or timber frames."
        },
        "parameters": [
          {
            "name": "dLength",
            "technicalDefault": "U(80,2)",
            "businessMeaning": "The longitudinal dimension of the slot along the beam's axis (or rotated axis). Determines the slot size required for bolt clearance or movement.",
            "validRange": "10mm to 3000mm",
            "unit": "mm",
            "affectsOutput": "Length of the void cut into the beam."
          },
          {
            "name": "dWidth",
            "technicalDefault": "U(20,1)",
            "businessMeaning": "The width of the slot, typically corresponding to the bolt diameter plus tolerance. Acts as a threshold for distribution logic.",
            "validRange": "6mm to Beam Width/Height",
            "unit": "mm",
            "affectsOutput": "Width of the void. If 'dInterdistance' is less than this value, single insertion mode is forced."
          },
          {
            "name": "dDepth",
            "technicalDefault": "U(0)",
            "businessMeaning": "The depth of the cut from the reference face. A value of 0 creates a through-hole (penetrating the entire beam).",
            "validRange": "0 (Through) to Beam Thickness",
            "unit": "mm",
            "affectsOutput": "Depth of the machining operation."
          },
          {
            "name": "sShape",
            "technicalDefault": "Rectangular",
            "businessMeaning": "The end profile geometry of the slot. 'Rectangular' has sharp corners, 'Round' is a circle, 'Rounded' is a standard stadium shape, and 'Explicit Radius' allows custom corner rounding.",
            "validRange": "Rectangular, Round, Rounded, Explicit Radius",
            "unit": "Enumeration",
            "affectsOutput": "Geometry of the slot ends. 'Explicit Radius' enables the 'dRadius' property."
          },
          {
            "name": "dOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "The distance from the beam's reference axis (or insertion point) to the centerline of the slot.",
            "validRange": "-500mm to 500mm (dependent on beam size)",
            "unit": "mm",
            "affectsOutput": "Translates the slot perpendicular to the beam axis."
          },
          {
            "name": "dAngle",
            "technicalDefault": "0",
            "businessMeaning": "The rotation of the slot relative to the beam's coordinate system. 0 aligns it with the beam length.",
            "validRange": "-90 to 90 degrees",
            "unit": "degrees",
            "affectsOutput": "Rotates the slot around the insertion point."
          },
          {
            "name": "sAlignment",
            "technicalDefault": "UCS",
            "businessMeaning": "Determines the plane of the slot. 'UCS' aligns the slot width with the local Y-axis (usually beam width), while 'Perpendicular to UCS' aligns with the local Z-axis (usually beam height).",
            "validRange": "UCS, Perpendicular to UCS",
            "unit": "Enumeration",
            "affectsOutput": "Orientation of the slot on the beam cross-section."
          },
          {
            "name": "dRadius",
            "technicalDefault": "U(0)",
            "businessMeaning": "Specific corner radius value, active only when Shape is set to 'Explicit Radius'.",
            "validRange": "0 to dWidth/2",
            "unit": "mm",
            "affectsOutput": "Rounds the slot corners to the specified radius."
          },
          {
            "name": "dInterdistance",
            "technicalDefault": "U(0)",
            "businessMeaning": "The spacing between the centers of multiple slots. If 0, only a single slot is created based on Quantity.",
            "validRange": "0 (Single) to 2000mm",
            "unit": "mm",
            "affectsOutput": "Spacing between slots in a series. Controls insertion flow (single vs distribution)."
          },
          {
            "name": "sDistributionMode",
            "technicalDefault": "Fixed",
            "businessMeaning": "Logic for spacing multiple slots. 'Fixed' uses 'dInterdistance' strictly; 'Even' calculates spacing to fit slots between two grip points.",
            "validRange": "Fixed, Even",
            "unit": "Enumeration",
            "affectsOutput": "Calculates the positions of slots when 'nQty' > 1 or grip points are defined."
          },
          {
            "name": "nQty",
            "technicalDefault": "1",
            "businessMeaning": "The total number of slots to generate. 0 implies distribution is controlled purely by grip points (or calculated via spacing).",
            "validRange": "0 (By Grip Points) to 100",
            "unit": "count",
            "affectsOutput": "Number of machining instances generated."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Setting sShape != 'Explicit Radius'",
            "effect": "Disables/Resets dRadius to 0.",
            "cascade": [
              "dRadius"
            ]
          },
          {
            "trigger": "Setting dInterdistance > dWidth during insertion",
            "effect": "Switches command line prompts to Distribution mode (asking for start/end points).",
            "cascade": [
              "_PtG (Grip Points)"
            ]
          },
          {
            "trigger": "Changing sDistributionMode to 'Even'",
            "effect": "Recalculates dInterdistance based on the distance between grip points and nQty.",
            "cascade": [
              "dInterdistance"
            ]
          },
          {
            "trigger": "Moving Grip Points (in 'Fixed' mode)",
            "effect": "Recalculates nQty based on the new total distance divided by dInterdistance.",
            "cascade": [
              "nQty",
              "_Pt0 (Insertion Point)"
            ]
          },
          {
            "trigger": "Changing nQty (in 'Fixed' mode)",
            "effect": "Adjusts the position of the furthest grip point to fit the new quantity.",
            "cascade": [
              "_PtG0"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Mortise",
            "description": "A parametric void (slotted hole) cut into the beam geometry. Can be simple or complex (rounded/explicit radius).",
            "appliedTo": "Selected Beam(s)"
          }
        ]
      },
      "tokens_used": 8914,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script initialization: Check for duplicate insertion cycle (if count > 1, delete self).",
          "2. Prompt user to select Beam entity(s) using PrEntity.",
          "3. Check selection: If no beams selected, delete instance and exit.",
          "4. Determine configuration source: Check for 'ExecuteKey' (Catalog) vs. User Dialog.",
          "5. Load properties: Apply from Catalog (specific entry or 'LastInserted') or display ShowDialog for manual input.",
          "6. Validate geometry: Ensure Length and Width are greater than Epsilon (0.1mm).",
          "7. Evaluate Distribution Mode: Check if 'Interdistance' > 'Width'.",
          "8. Interactive Point Loop:",
          "   a. Prompt for first point (Start of distribution or Center point).",
          "   b. If Distribution Mode: Prompt for optional second point (End of distribution).",
          "   c. If two points provided: Calculate average point as Center (_Pt0) and store endpoints as Grips.",
          "   d. Create new TSL instance(s) on selected beam(s) using dbCreate.",
          "   e. Repeat loop until user breaks (Esc/Enter).",
          "9. Delete temporary 'Template' instance.",
          "10. New Instance Execution:",
          "   a. Detect 'Change Face' trigger (Context menu or Property change).",
          "   b. Establish Coordinate System (CS) based on Beam vectors and Face orientation.",
          "   c. Apply Rotation offset (dAngle).",
          "   d. Initialize Grip Points if missing and Interdistance > 0.",
          "   e. Recalculate Quantity and Spacing based on Distribution Mode (Fixed vs. Even).",
          "   f. Generate array of slot locations.",
          "   g. Create Mortise tools and visualize geometry."
        ],
        "conditionalBranches": [
          {
            "condition": "Configuration Source (Insertion)",
            "path1": {
              "name": "Catalog Mode",
              "steps": [
                "Checks if _kExecuteKey is provided.",
                "Searches Catalogs for matching entry name.",
                "If found: Loads properties from that entry.",
                "If not found: Loads properties from '_LastInserted' entry."
              ]
            },
            "path2": {
              "name": "Dialog Mode",
              "steps": [
                "No Execute Key detected.",
                "Executes ShowDialog().",
                "User manually enters parameters.",
                "Script proceeds with user-defined values."
              ]
            }
          },
          {
            "condition": "Interdistance vs. Width (Insertion Prompt)",
            "path1": {
              "name": "Distribution Mode",
              "steps": [
                "Condition: dInterdistance > dWidth.",
                "Prompt 1: 'Pick first point of distribution along beam axis'.",
                "Prompt 2: 'Pick second point <Enter> to insert a single tool'.",
                "Calculates Center and Grip Points based on inputs."
              ]
            },
            "path2": {
              "name": "Single Tool Mode",
              "steps": [
                "Condition: dInterdistance <= dWidth.",
                "Prompt 1: 'Pick point'.",
                "Ignores second point input.",
                "Inserts single slot at picked location."
              ]
            }
          },
          {
            "condition": "Distribution Logic (Recalculation)",
            "path1": {
              "name": "Fixed Spacing",
              "steps": [
                "Condition: sDistributionMode == 'Fixed'.",
                "Logic: Distance between grips / dInterdistance = Quantity.",
                "User Interaction: Moving grips updates Quantity. Changing Quantity moves outer grip."
              ]
            },
            "path2": {
              "name": "Even Spacing",
              "steps": [
                "Condition: sDistributionMode == 'Even'.",
                "Logic: Distance between grips / (Quantity - 1) = dInterdistance.",
                "User Interaction: Changing Quantity or moving grips updates the Interdistance value automatically."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None (Silent)",
            "recovery": "Automatically erases the instance if insertCycleCount() > 1 to prevent duplication."
          },
          {
            "check": "Beam Selection",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases itself if beam array length is < 1."
          },
          {
            "check": "Geometry Dimensions",
            "errorMessage": "[ScriptName]: Invalid geometry. Tool will be deleted.",
            "recovery": "Erases instance. User must set Length (dLength) and Width (dWidth) greater than 0.1mm in the catalog or dialog before insertion."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Flip Slot Orientation",
            "how": "Context Menu ('Change Face') or OPM (Change Alignment to 'Perpendicular to UCS')",
            "effect": "Swaps the local Y and Z axes, rotating the slot 90 degrees relative to the beam surface."
          },
          {
            "action": "Adjust Distribution / Quantity",
            "how": "Drag Diamond-shaped Grips (_PtG) or change 'nQty' / 'dInterdistance' in OPM",
            "effect": "In 'Fixed' mode, moving grips changes the count. In 'Even' mode, moving grips changes the spacing. Changing 'nQty' in OPM redistributes slots along the grip vector."
          },
          {
            "action": "Move Slot Center",
            "how": "Drag Center Grip (_Pt0)",
            "effect": "Translates the entire distribution pattern along the beam axis."
          },
          {
            "action": "Modify Geometry",
            "how": "Edit OPM Properties (dLength, dWidth, dRadius, sShape)",
            "effect": "Updates the size and profile of the mortise immediately. 'Explicit Radius' is only active when Shape is set accordingly."
          },
          {
            "action": "Rotate Slot",
            "how": "Edit 'dAngle' in OPM",
            "effect": "Rotates the slot around the insertion point vector."
          }
        ]
      },
      "tokens_used": 10877,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbSlottedHole.mcr\n\n## Overview\nThis script creates customizable slotted holes (mortises) or rows of holes in structural timber beams. It supports various shapes, including rectangular and rounded ends, and allows for complex distribution patterns along the beam axis for connections or ventilation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | Machining is defined in the model and reflected in drawings automatically. |\n\n## Prerequisites\n- **Required Entities**: At least one Beam (GenBeam) must exist in the model.\n- **Minimum Beam Count**: 1.\n- **Required Settings**: None (defaults to internal properties or Catalog settings).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbSlottedHole.mcr` from the list.\n\n### Step 2: Select Beam\n```\nCommand Line: Select beam(s)\nAction: Click on the beam(s) where you want to add the slot. Press Enter to confirm selection.\n```\n\n### Step 3: Configure Geometry\nIf no specific Catalog entry is triggered, the Properties Palette (OPM) or a dialog will appear.\n- Adjust parameters like **Length**, **Width**, and **Depth**.\n- Select the desired **Shape** (e.g., Rectangular, Round, Rounded).\n- *Note: Set Depth to `0` for a through-hole.*\n\n### Step 4: Define Placement\nThe script prompts change based on the **Interdistance** property relative to the **Width**.\n\n**Option A: Create a Distribution Row (if Interdistance > Width)**\n```\nCommand Line: Pick first point of distribution along beam axis.\nAction: Click the start position for the row of holes.\n```\n```\nCommand Line: Pick second point <Enter> to insert a single tool\nAction: Click the end position. The script will fill the space based on your quantity settings, or press Enter to place just one at the start.\n```\n\n**Option B: Single Slot (if Interdistance <= Width)**\n```\nCommand Line: Pick point\nAction: Click the exact center location for the single slot.\n```\n\n### Step 5: Adjust (Post-Insertion)\nOnce placed, you can drag the **Grips** (diamond shapes) in the model to adjust the start/end points of the distribution or the center position of the slot.\n\n## Properties Panel Parameters\n\n### Geometry\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| (A) Length | Number | 80 mm | The longitudinal dimension of the slot. |\n| (B) Width | Number | 20 mm | The width of the slot (perpendicular to length). |\n| (C) Depth | Number | 0 mm | The depth of the cut. `0` creates a through-hole. |\n| (F) Shape | Dropdown | Rectangular | Shape of the slot ends: *Rectangular, Round, Rounded, Explicit Radius*. |\n| (R) Radius | Number | 0 mm | Corner radius. Only active when Shape is set to *Explicit Radius*. |\n\n### Alignment\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| (D) Offset from Axis | Number | 0 mm | Moves the slot center perpendicular to the beam axis. |\n| (E) Angle | Number | 0 deg | Rotates the slot around its insertion point. |\n| (J) Alignment | Dropdown | UCS | Defines orientation plane: *UCS* or *Perpendicular to UCS*. |\n\n### Distribution\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Interdistance | Number | 0 mm | Distance between slot centers. `0` implies a single slot or manual placement. |\n| Distribution Mode | Dropdown | Fixed | *Fixed*: Keeps spacing constant, changes quantity. *Even*: Keeps quantity constant, adjusts spacing. |\n| Quantity | Integer | 1 | Total number of slots to generate. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change Face | Flips the orientation of the slot 90 degrees relative to the beam surface (swaps local Y and Z axes). |\n| Delete | Removes the slotted hole script from the beam. |\n\n## Settings Files\n- **Catalog Entries**: Standard hsbCAD Catalogs (`.catalog`)\n- **Purpose**: Store predefined sizes and settings for quick insertion (e.g., \"M20 Slot for Steel Plate\").\n\n## Tips\n- **Through Holes**: Always leave **Depth** as `0` unless you specifically require a blind pocket.\n- **Rounded Corners**: For standard stadium slots (fully rounded ends), select the **Rounded** shape. Use **Explicit Radius** if you need a specific corner radius that differs from half the width.\n- **Adjustable Patterns**: Insert a row of slots using the **Distribution** steps above. After insertion, select the script and drag the diamond-shaped **Grips** in the model to stretch or shrink the row. The slots will automatically recalculate based on your **Distribution Mode** (Fixed or Even).\n- **Flip Orientation**: If the slot is cutting into the wrong face of the beam, select the tool, right-click, and choose **Change Face**.\n\n## FAQ\n- **Q: Why does the command line ask for two points sometimes?**\n  - **A**: This happens when the **Interdistance** property is set larger than the **Width**. The script assumes you want to create a row of slots distributed along a path.\n- **Q: How do I rotate the slot?**\n  - **A**: Use the **(E) Angle** property in the palette, or change the **(J) Alignment** to rotate it 90 degrees to the current UCS.\n- **Q: The tool vanished after I changed the size.**\n  - **A**: Ensure **(A) Length** and **(B) Width** are greater than 0.1 mm. The script deletes itself if the geometry is too small to generate."
      },
      "tokens_used": 7709,
      "error": null
    }
  }
}