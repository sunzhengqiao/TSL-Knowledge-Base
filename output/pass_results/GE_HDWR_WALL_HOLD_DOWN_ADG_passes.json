{
  "filename": "GE_HDWR_WALL_HOLD_DOWN_ADG.mcr",
  "status": "completed",
  "total_tokens": 43437,
  "processing_time": 1126.2102146148682,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": 1,
          "minorVersion": 2,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.2",
            "date": "11.jun.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Corrected drawing shape Thumbnail added"
          },
          {
            "version": "1.1",
            "date": "02.jun.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Added features to make possible reset TXT source file using GE_HDWR_RESET_CATALOG_ENTRY tsl"
          },
          {
            "version": "1.0",
            "date": "08.nov.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release Renamed from GE_HDWR_HANGER_WAH to GE_HDWR_WALL_ANCHOR_WAH"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "GE_HDWR_RESET_CATALOG_ENTRY tsl"
        ]
      },
      "tokens_used": 6974,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script constructs 3D Body geometry (e.g., bdDrill, bdDrilledBottomBase), uses getPoint for interactive 3D point selection, performs vector math relative to Beam entities (vecX, vecD), and inserts sub-instances using tsl.dbCreate. No sd_ prefixes, _Viewport checks, or #Type E ShopDrawing logic found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space",
          "requiredSettings": [
            "TSL_HARDWARE_FAMILY_LIST.dxx (located in _kPathHsbCompany/TSL/Catalog)",
            "TSL_Read_Metalpart_Family_Props.dll (located in _kPathHsbInstall/Utilities/TslCustomSettings)",
            "Sub-scripts: GE_HDWR_ANCHOR_J-BOLT.mcr, GE_HDWR_ANCHOR_ADHESIVE.mcr, GE_HDWR_ANCHOR_SCREW.mcr, or GE_HDWR_ANCHOR_EMBEDDED.mcr"
          ]
        }
      },
      "tokens_used": 5940,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 8911,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts a specific type of steel hold-down bracket (ADG series) onto wall studs to resist uplift forces, typically anchored to concrete.",
          "category": "Hardware",
          "typicalUseCase": "Used when framing shear walls where hold-down anchors are required at ends or corners to prevent the wall from lifting due to lateral loads (wind/seismic)."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "\"ADG\"",
            "businessMeaning": "The specific model identifier of the hold-down hardware (e.g., 'ADG'). This drives which catalog entry is loaded.",
            "validRange": "N/A (Catalog dependent)",
            "unit": "String",
            "affectsOutput": "Determines the specific dimensions and anchor type for the entire assembly."
          },
          {
            "name": "dClearWidth",
            "technicalDefault": "U(70,2.625)",
            "businessMeaning": "The internal width (gap) between the side plates of the bracket. This must be sufficient to fit around the timber stud width.",
            "validRange": "30mm - 300mm (Typically matches stud width, e.g., 45mm, 70mm, 90mm)",
            "unit": "mm",
            "affectsOutput": "Adjusts the spacing of the side plates (`bdPlateSideLeft`, `bdPlateSideRight`) and the top/bottom plates width."
          },
          {
            "name": "dOverallDepth",
            "technicalDefault": "U(560,22)",
            "businessMeaning": "The projection length of the bracket extending perpendicular to the wall (the 'leg' of the hold-down). This determines how far the anchor point is from the stud face.",
            "validRange": "100mm - 1000mm",
            "unit": "mm",
            "affectsOutput": "Lengthens the back plate and side plates to reach the specific anchor location."
          },
          {
            "name": "dOverallHeight",
            "technicalDefault": "U(50,2)",
            "businessMeaning": "The vertical height of the steel plates.",
            "validRange": "40mm - 600mm",
            "unit": "mm",
            "affectsOutput": "Scales the vertical geometry of the plates and the position of drilled holes."
          },
          {
            "name": "ANCHORMODEL (Map)",
            "technicalDefault": "Catalog dependent",
            "businessMeaning": "The category of the concrete anchor used with the bracket (e.g., J-Bolt, Adhesive, Screw, Embedded).",
            "validRange": "\"J-Bolt\", \"Adhesive Anchor\", \"Screw Anchor\", \"Embedded Anchor\"",
            "unit": "Enum/String",
            "affectsOutput": "Selects which sub-script (GE_HDWR_ANCHOR_*.mcr) is instantiated to model the concrete anchor."
          },
          {
            "name": "ANCHORTYPE (Map)",
            "technicalDefault": "Catalog dependent",
            "businessMeaning": "The specific size or grade of the anchor (passed to the anchor sub-script).",
            "validRange": "Catalog dependent (e.g., \"1/2\", \"M12\", \"HILTI-HST3\")",
            "unit": "String",
            "affectsOutput": "Determines the geometry and dimensions of the generated anchor sub-component."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User executes 'Change type' context menu",
            "effect": "Re-runs the DotNet dialog to fetch new catalog settings, refreshing _Map.",
            "cascade": [
              "sType",
              "dClearWidth",
              "dOverallDepth",
              "dOverallHeight",
              "ANCHORMODEL",
              "ANCHORTYPE"
            ]
          },
          {
            "trigger": "dClearWidth change",
            "effect": "Adjusts the offset of side plates and the width of top/bottom plates.",
            "cascade": [
              "Geometry: bdPlateSideLeft/Right positions",
              "Geometry: plDrilledBottomBase width"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Body (MetalPart)",
            "description": "A multi-plate steel bracket consisting of a back plate, two side plates, top/bottom closure plates, and intermediate spacers, with a central drill hole.",
            "appliedTo": "Referenced GenBeam(s) (Studs)"
          },
          {
            "type": "TSL Instance (Sub-Component)",
            "description": "A concrete anchor model (J-Bolt, Adhesive, Screw, or Embedded) generated by a separate TSL script.",
            "appliedTo": "Concrete/Foundation (Conceptually located relative to the bracket point)"
          }
        ]
      },
      "tokens_used": 7597,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script",
          "Check Execution Context (Insert vs. Recalc vs. Context Menu)",
          "Load Hardware Family Properties (DotNet call to 'TSL_Read_Metalpart_Family_Props.dll')",
          "Wait for User Selection (Dialog) if new insertion or type change",
          "[Insert Mode] Prompt user to select Stud(s) (GenBeams)",
          "[Insert Mode] Validate at least one beam selected",
          "[Insert Mode] Prompt user for Reference Point",
          "[Insert Mode] Identify 'Closer Beam' to reference point",
          "[Insert Mode] Filter for vertical beams",
          "[Insert Mode] Calculate insertion points on all filtered beams",
          "[Insert Mode] Create Sub-instances for each valid beam",
          "[Insert Mode] Erase Master Instance",
          "[Sub-Instance Mode] Retrieve Properties from _Map (Type, Width, Depth, Height)",
          "[Sub-Instance Mode] Align local coordinate system (vx, vy, vz) to beam geometry",
          "[Sub-Instance Mode] Generate Metalpart Geometry (Drilled bases, Side plates, Back plate)",
          "[Sub-Instance Mode] Determine Anchor Sub-script based on ANCHORMODEL",
          "[Sub-Instance Mode] Insert Anchor Component (J-Bolt, Adhesive, Screw, or Embedded)",
          "Finalize Visualization"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Key / Event",
            "path1": {
              "name": "Help Menu",
              "steps": [
                "Triggered by 'Help' context menu",
                "Display usage report",
                "Exit script (no geometry generation)"
              ]
            },
            "path2": {
              "name": "Change Type",
              "steps": [
                "Triggered by 'Change type' context menu",
                "Re-run DotNet catalog selection",
                "Update _Map with new dimensions",
                "Recalculate geometry based on new props"
              ]
            },
            "path3": {
              "name": "Normal Insert/Recalc",
              "steps": [
                "Proceed with geometry generation logic",
                "Fetch map data (existing or new)"
              ]
            }
          },
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "Sub-Instance Creation",
              "steps": [
                "Cycle > 1 detected",
                "Erase instance to prevent duplication",
                "Return"
              ]
            },
            "path2": {
              "name": "Master Processing",
              "steps": [
                "Cycle = 0 or 1",
                "Continue processing beam selection and geometry"
              ]
            }
          },
          {
            "condition": "User Input Validation (Insert Mode)",
            "path1": {
              "name": "No Beams Selected",
              "steps": [
                "Beam set is empty",
                "Erase instance",
                "Return"
              ]
            },
            "path2": {
              "name": "Beams Selected",
              "steps": [
                "Proceed to Reference Point prompt",
                "Identify vertical beams",
                "Generate sub-instances"
              ]
            }
          },
          {
            "condition": "Anchor Model Selection",
            "path1": {
              "name": "J-Bolt",
              "steps": [
                "Map ANCHORMODEL == 'J-Bolt'",
                "Script Name: 'GE_HDWR_ANCHOR_J-BOLT'",
                "Insert anchor"
              ]
            },
            "path2": {
              "name": "Adhesive Anchor",
              "steps": [
                "Map ANCHORMODEL == 'Adhesive Anchor'",
                "Script Name: 'GE_HDWR_ANCHOR_ADHESIVE'",
                "Insert anchor"
              ]
            },
            "path3": {
              "name": "Screw Anchor",
              "steps": [
                "Map ANCHORMODEL == 'Screw Anchor'",
                "Script Name: 'GE_HDWR_ANCHOR_SCREW'",
                "Insert anchor"
              ]
            },
            "path4": {
              "name": "Embedded Anchor",
              "steps": [
                "Map ANCHORMODEL == 'Embedded Anchor'",
                "Script Name: 'GE_HDWR_ANCHOR_EMBEDDED'",
                "Insert anchor"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Catalog Data Availability",
            "errorMessage": "None explicit, but if mapOut.length()==0 on insert, script erases itself.",
            "recovery": "Ensure 'TSL_HARDWARE_FAMILY_LIST.dxx' exists in company path and contains valid entries for 'ADG' family."
          },
          {
            "check": "Beam Selection",
            "errorMessage": "Instance is erased silently if no beams are selected.",
            "recovery": "User must run command again and select at least one GenBeam."
          },
          {
            "check": "Beam Orientation (Vertical)",
            "errorMessage": "None explicit",
            "recovery": "Script filters beams using `isParallelTo(vecX)`. Only vertical studs are processed."
          },
          {
            "check": "Sub-Script Existence",
            "errorMessage": "Likely fails silently or throws internal error if GE_HDWR_ANCHOR_*.mcr files are missing.",
            "recovery": "Ensure required anchor sub-scripts are present in the TSL search path."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Hardware Type",
            "how": "Right-click Context Menu -> 'Change type'",
            "effect": "Opens DotNet dialog, updates all dimension properties (Width, Depth, Height) and Anchor type, regenerates geometry."
          },
          {
            "action": "Move / Grip Edit",
            "how": "CAD Grips / Move Command",
            "effect": "Script recalculates `_Pt0`. It re-evaluates position relative to beam center. `_Pt0` is snapped to the beam corner (closest end and face) defined by vector math."
          },
          {
            "action": "Delete Beam",
            "how": "CAD Delete Command",
            "effect": "Script checks `_bOnElementDeleted`. If attached beam is deleted, `eraseInstance()` is called, removing the hardware."
          }
        ]
      },
      "tokens_used": 8111,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_WALL_HOLD_DOWN_ADG\n\n## Overview\nThis script inserts an ADG series steel hold-down bracket onto wall studs to resist uplift forces. It automatically generates the metal bracket geometry and inserts the appropriate concrete anchor sub-component (such as a J-Bolt or Adhesive anchor) based on catalog selections.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script creates 3D geometry and requires interaction with beams. |\n| Paper Space | No | Not designed for 2D layout or detailing views. |\n| Shop Drawing | No | Not a layout generation script. |\n\n## Prerequisites\n- **Required Entities**: GenBeam (typically vertical wall studs).\n- **Minimum Beam Count**: 1.\n- **Required Settings Files**:\n  - `TSL_HARDWARE_FAMILY_LIST.dxx` (Catalog defining dimensions and types).\n  - `TSL_Read_Metalpart_Family_Props.dll` (Utility for reading catalog data).\n- **Dependencies**: Sub-scripts for anchors (e.g., `GE_HDWR_ANCHOR_J-BOLT.mcr`, `GE_HDWR_ANCHOR_ADHESIVE.mcr`) must be accessible in the TSL search path.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_HDWR_WALL_HOLD_DOWN_ADG.mcr`\n\n### Step 2: Select Hardware\n*If running for the first time or using the \"Change type\" command:*\n```\nDialog Box: Select Hardware Family/Type\nAction: Select the desired model (e.g., ADG) and configuration from the DotNet dialog. Click OK.\n```\n\n### Step 3: Select Beams\n```\nCommand Line: Select beams\nAction: Click on the wall stud(s) where you want to install the hold-down. Press Enter to confirm selection.\n```\n\n### Step 4: Specify Reference Point\n```\nCommand Line: Specify reference point\nAction: Click in the 3D model to indicate the location for the bracket. The script will snap the bracket to the corner of the stud closest to this point.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sType | String | Catalog Dependent | The specific model identifier of the hold-down hardware (e.g., 'ADG'). |\n| dClearWidth | Number | 70mm | The internal width (gap) between the side plates of the bracket. Ensure this matches or exceeds your stud width. |\n| dOverallDepth | Number | 560mm | The projection length of the bracket extending perpendicular to the wall (the \"leg\" reaching the anchor point). |\n| dOverallHeight | Number | 50mm | The vertical height of the steel plates. |\n| ANCHORMODEL | String | Catalog Dependent | The category of the concrete anchor (e.g., J-Bolt, Adhesive Anchor, Screw Anchor). |\n| ANCHORTYPE | String | Catalog Dependent | The specific size or grade of the anchor (passed to the anchor sub-script). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change type | Re-opens the hardware selection dialog. Allows you to switch to a different catalog entry, which automatically updates dimensions and anchor types. |\n| Help | Displays a brief usage report and version information in the command line. |\n\n## Settings Files\n- **Filename**: `TSL_HARDWARE_FAMILY_LIST.dxx`\n- **Location**: `_kPathHsbCompany/TSL/Catalog`\n- **Purpose**: Contains the database of available hardware families, dimensions, and default properties for the ADG series.\n\n## Tips\n- **Reference Point Logic**: The script calculates the insertion position based on the corner of the stud closest to the point you click. If the bracket lands on the wrong face or end, delete it and click closer to the desired corner.\n- **Vertical Beams Only**: The script automatically filters beams; it will generally only attach to elements oriented vertically (studs).\n- **Modifying Dimensions**: While you can type numbers directly into the Properties palette, using the **Change type** context menu is recommended to ensure all parameters (width, depth, height, and anchor settings) remain compatible with the hardware catalog.\n\n## FAQ\n- **Q: Why did the script disappear after I ran it?**\n  **A:** This usually happens if no beams were selected or if the script failed to find valid catalog data. Ensure `TSL_HARDWARE_FAMILY_LIST.dxx` exists and that you selected a GenBeam before placing the point.\n- **Q: How do I switch from a J-Bolt to an Adhesive anchor?**\n  **A:** Right-click the installed hardware and select **Change type**. Select the desired configuration from the dialog, which will update the `ANCHORMODEL` and insert the correct anchor sub-component.\n- **Q: Can I use this on horizontal beams (plates/headers)?**\n  **A:** The script is designed for hold-downs on wall studs and filters for vertical orientation. It may not function correctly on horizontal beams."
      },
      "tokens_used": 5904,
      "error": null
    }
  }
}