{
  "filename": "hsbCullenDistribute.mcr",
  "status": "completed",
  "total_tokens": 53037,
  "processing_time": 342.96895122528076,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "2.6",
            "date": "13.09.2024",
            "author": "Marsel Nakuci",
            "changes": "HSB-20921: Add offset property for GA at soleplate"
          },
          {
            "version": "2.5",
            "date": "07feb20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435: add distribution for AG, distribution applicable for sheets and horizontal beam of wall"
          },
          {
            "version": "2.4",
            "date": "04feb20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435 fix distribution when nNrParts is inserted for ST-PFS"
          },
          {
            "version": "2.3",
            "date": "04feb20",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435 distribution of ST-PFS hsbCullenDistribute"
          },
          {
            "version": "2.2",
            "date": "29.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435 set for PC also iSideSelected"
          },
          {
            "version": "2.1",
            "date": "27.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435 fix distribution for PC"
          },
          {
            "version": "2.0",
            "date": "24.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435 change name, add property type to pick what type to be distributed"
          },
          {
            "version": "1.3",
            "date": "23.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435 cleanup"
          },
          {
            "version": "1.2",
            "date": "23.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435 fix bug for walls with different heights"
          },
          {
            "version": "1.1",
            "date": "22.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435 delete instance after generation, add property swap x-y, if dDistanceBetween<0, calculation is done based on the nNrParts"
          },
          {
            "version": "1.0",
            "date": "22.10.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5435 initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "hsbCullenFASdistribute"
        ]
      },
      "tokens_used": 9059,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script creates TSL instances using _kModelSpace (tslNew.dbCreate(..., _kModelSpace, mapTsl)). It interacts with ElementWallSF, Beam, and Sheet entities for fabrication generation. There is no usage of _Viewport, sd_ prefixes, or output generation logic indicative of Paper Space or ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF",
            "Sheet",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 6282,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select the crossing stick frame walls(s)|",
              "condition": "_bOnInsert && sType is FAS, PC or ST-PFS",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select the stick frame walls(s)|",
              "condition": "_bOnInsert && sType is ST-PFS",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select the sheet or horizontal beam of the wall|",
              "condition": "_bOnInsert && sType is GA Cullen",
              "required": true
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "|Select point that define the edge of the bracket|",
              "condition": "_bOnInsert && sType is GA Cullen",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Standard Properties Dialog",
            "trigger": "On Insert",
            "title": null,
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "|Type|",
            "defaultValue": "FAS",
            "inputType": "dropdown",
            "options": [
              "FAS",
              "PC",
              "ST-PFS",
              "GA Cullen"
            ],
            "category": "|General|",
            "description": "|Defines the Type|"
          },
          {
            "index": 1,
            "variable": "dDistanceBottom",
            "type": "PropDouble",
            "displayName": "|Distance Bottom/Start|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the Distance at the Bottom|"
          },
          {
            "index": 2,
            "variable": "dDistanceTop",
            "type": "PropDouble",
            "displayName": "|Distance Top/End|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the Distance at the Top|"
          },
          {
            "index": 3,
            "variable": "dDistanceBetween",
            "type": "PropDouble",
            "displayName": "|Distance Between|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the Distance Between the parts|"
          },
          {
            "index": 0,
            "variable": "nNrParts",
            "type": "PropInt",
            "displayName": "|Nr. Parts|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the Nr. Parts to be distributed along the walls|"
          },
          {
            "index": 1,
            "variable": "sSwapXY",
            "type": "PropString",
            "displayName": "|Swap X-Y|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|General|",
            "description": "|Swap the parts upside down|"
          },
          {
            "index": 4,
            "variable": "dOffsetAngleBracket",
            "type": "PropDouble",
            "displayName": "|Offset| GA",
            "defaultValue": "10",
            "inputType": "number",
            "options": [],
            "category": "|Soleplate|",
            "description": "|Defines the OffsetAngleBracket|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8531,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the distribution of structural metal connectors (Cullen brackets) along timber walls, floors, or soleplates based on spacing rules or specific quantities.",
          "category": "Hardware",
          "typicalUseCase": "A user needs to place a series of Metal Angle (GA) brackets or specific connectors (FAS, PC) along the intersection of stick frame walls or along a beam/soleplate with consistent spacing."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "FAS",
            "businessMeaning": "Specifies the connector type and distribution logic to use. Options include Framing Anchor System (FAS), Panel Connector (PC), Stud-to-Plate Floor joist (ST-PFS), or General Angle (GA Cullen).",
            "validRange": "FAS, PC, ST-PFS, GA Cullen",
            "unit": "enum",
            "affectsOutput": "Determines the script's logic flow, which entities are selected (walls vs beams/sheets), and the specific TSL generated ('GA' vs other scripts)."
          },
          {
            "name": "dDistanceBottom",
            "technicalDefault": 0,
            "businessMeaning": "The offset distance from the start (bottom) of the element (wall height or beam length) to the center of the first connector.",
            "validRange": "0 to 2000 mm",
            "unit": "mm",
            "affectsOutput": "Shifts the start position of the distribution pattern along the element."
          },
          {
            "name": "dDistanceTop",
            "technicalDefault": 0,
            "businessMeaning": "The offset distance from the end (top) of the element (wall height or beam length) to the center of the last connector.",
            "validRange": "0 to 2000 mm",
            "unit": "mm",
            "affectsOutput": "Restricts the distribution area, ensuring the last connector is at least this distance from the end."
          },
          {
            "name": "dDistanceBetween",
            "technicalDefault": 0,
            "businessMeaning": "The center-to-center spacing between connectors. If negative, spacing is calculated automatically based on 'Nr. Parts'.",
            "validRange": "-1 to 2000 mm (negative implies auto-calculation)",
            "unit": "mm",
            "affectsOutput": "Controls the density of the connectors. A positive value forces specific spacing; negative triggers the 'Nr. Parts' logic."
          },
          {
            "name": "nNrParts",
            "technicalDefault": 0,
            "businessMeaning": "The total number of connectors to distribute. Used only when 'Distance Between' is negative or auto-calculation is required.",
            "validRange": "2 to 100",
            "unit": "count",
            "affectsOutput": "Determines how many connector instances are created. Overrides 'Distance Between' if 'Distance Between' is negative."
          },
          {
            "name": "sSwapXY",
            "technicalDefault": "|No|",
            "businessMeaning": "Flips the connector orientation (rotates 180 degrees or mirrors) if required for installation constraints.",
            "validRange": "|No|, |Yes|",
            "unit": "enum",
            "affectsOutput": "Modifies the orientation (vecX/vecY) of the generated connector TSL instance."
          },
          {
            "name": "dOffsetAngleBracket",
            "technicalDefault": 10,
            "businessMeaning": "An offset applied specifically to GA brackets on soleplates to adjust their position relative to the plate edge, ensuring proper seating or clearance.",
            "validRange": "0 to 100 mm",
            "unit": "mm",
            "affectsOutput": "Adjusts the coordinate position of the generated connector along the Z/Y axis relative to the soleplate."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sType changes to 'GA Cullen'",
            "effect": "Changes input prompts to select a Sheet or Beam instead of Walls. Enables 'Offset' property relevance for soleplates.",
            "cascade": [
              "dOffsetAngleBracket"
            ]
          },
          {
            "trigger": "dDistanceBetween is negative",
            "effect": "Script switches to 'Count Mode' and calculates spacing based on nNrParts.",
            "cascade": [
              "nNrParts"
            ]
          },
          {
            "trigger": "dDistanceBetween is positive",
            "effect": "Script calculates the maximum number of parts (nNrParts) that fit within the distances.",
            "cascade": [
              "nNrParts"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TSL Instance (Connector)",
            "description": "Generates instances of 'GA' (General Angle) TSL or delegates to 'hsbCullenFASdistribute' depending on the selected Type.",
            "appliedTo": "Wall intersections (ElementWallSF), Sheets, or Beams (specifically horizontal/soleplates)."
          }
        ]
      },
      "tokens_used": 9328,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. User launches script hsbCullenDistribute.mcr\",\n    \"2. Script initializes properties (Type, Distances, Nr Parts, Swap XY, Offset).\",\n    \"3. User selects 'Type' (FAS, PC, ST-PFS, or GA Cullen) in dialog or via catalog.\",\n    \"4. Conditional Entity Selection Prompt:\",\n    \"   - If Type is FAS/PC/ST-PFS: Prompt 'Select the crossing stick frame walls(s)'.\",\n    \"   - If Type is ST-PFS: Specific prompt 'Select the stick frame walls(s)'.\",\n    \"   - If Type is GA Cullen: Prompt 'Select the sheet or horizontal beam of the wall'.\",\n    \"5. If Type is GA Cullen, user defines edge point: Prompt 'Select point that define the edge of the bracket'.\",\n    \"6. Script processes selection based on Type:\",\n    \"   - [FAS/PC/ST-PFS] Validates wall intersections and delegates generation to 'hsbCullenFASdistribute'.\",\n    \"   - [GA Cullen] Calculates distribution points along selected Sheet or Beam.\",\n    \"7. Conditional Distribution Calculation (GA Cullen):\",\n    \"   - If Distance Between >= 0: Calculate max number of parts fitting in length.\",\n    \"   - If Distance Between < 0: Calculate spacing based on exact Nr. Parts.\",\n    \"8. Generation: Script creates TSL instances ('hsbCullenFASdistribute' or 'GA') at calculated locations.\",\n    \"9. Script erases itself (delete instance after generation).\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Property 'sType' selection\",\n      \"path1\": {\n        \"name\": \"FAS or PC or ST-PFS\",\n        \"steps\": [\n          \"Prompt user to select ElementWallSF (Stick Frame Walls).\",\n          \"Internal check: iMode == 0 (Initialization).\",\n          \"Validation: Ensure at least 2 walls selected.\",\n          \"Identify intersecting wall pairs (Male/Female).\",\n          \"Instance Creation: Insert 'hsbCullenFASdistribute' TSL for each valid pair.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"GA Cullen\",\n        \"steps\": [\n          \"Prompt user to select Beam or Sheet.\",\n          \"Prompt user for Point3d to define bracket edge.\",\n          \"Branch: Sheet detected -> Find profile, calculate distribution along X-axis.\",\n          \"Branch: Beam detected -> Check if horizontal, calculate distribution along beam axis.\",\n          \"Instance Creation: Insert 'GA' TSL at calculated points.\",\n          \"Apply Offset property if beam is identified as 'soleplate'.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Property 'dDistanceBetween' value (GA Cullen Mode)\",\n      \"path1\": {\n        \"name\": \"Positive Value (Fixed Spacing)\",\n        \"steps\": [\n          \"Define available length (Total Length - Bottom Dist - Top Dist - Part Length).\",\n          \"Calculate modular distance (Distance Between + Part Length).\",\n          \"Determine integer count of parts (Nr Parts) that fit.\",\n          \"Recalculate exact spacing to fit parts evenly.\",\n          \"Update 'dDistanceBetween' and 'nNrParts' properties to calculated values.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Negative Value (Fixed Count)\",\n        \"steps\": [\n          \"Use 'nNrParts' to determine quantity.\",\n          \"Validate nNrParts >= 2 (defaults to 2 if less).\",\n          \"Calculate modular distance between parts.\",\n          \"Handle overlap error if parts are too long for the space.\",\n          \"Update 'dDistanceBetween' to resulting clear spacing.\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Element count for FAS/PC\",\n      \"errorMessage\": \"TN(\\\"|at least 2 walls needed|\\\")\",\n      \"recovery\": \"Script erases itself; user must restart and select at least two intersecting walls.\"\n    },\n    {\n      \"check\": \"Beam orientation for GA Cullen\",\n      \"errorMessage\": \"TN(\\\"|only horizontal beams are allowed for inserting distribution|\\\")\",\n      \"recovery\": \"Script erases itself; user must select a horizontal beam.\"\n    },\n    {\n      \"check\": \"Sheet intersection for GA Cullen\",\n      \"errorMessage\": \"TN(\\\"|unexpected error|\\\")\",\n      \"recovery\": \"Script erases itself; user should check sheet selection and coordinates"
      },
      "tokens_used": 12281,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCullenDistribute.mcr\n\n## Overview\nAutomates the distribution of structural metal connectors (Cullen brackets) along timber walls, floors, or soleplates based on defined spacing rules or specific quantities.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be run in Model Space to detect walls and beams. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | This is a generation/scripting tool, not a drawing annotation tool. |\n\n## Prerequisites\n- **Required Entities**:\n  - For types **FAS**, **PC**, **ST-PFS**: Stick frame walls (`ElementWallSF`).\n  - For type **GA Cullen**: Sheets or horizontal Beams.\n- **Minimum Beam/Entity Count**:\n  - For **FAS** and **PC**: At least 2 intersecting walls are required.\n- **Required Settings Files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCullenDistribute.mcr`\n\n### Step 2: Configure Distribution Type\nBefore selecting elements, configure the **Type** property in the Properties Palette (or Dialog):\n- **FAS**: Framing Anchor System (Wall intersections).\n- **PC**: Panel Connector (Wall intersections).\n- **ST-PFS**: Stud-to-Plate Floor joist.\n- **GA Cullen**: General Angle bracket (For sheets or horizontal beams).\n\n### Step 3: Select Elements\nThe prompt depends on the Type selected in Step 2:\n\n*If Type is **FAS**, **PC**, or **ST-PFS**:*\n```\nCommand Line: Select the crossing stick frame walls(s)\nAction: Click on the stick frame walls that intersect or require connections. Select at least two walls.\n```\n\n*If Type is **GA Cullen**:*\n```\nCommand Line: Select the sheet or horizontal beam of the wall\nAction: Click on the specific sheet or beam (e.g., a soleplate) where the brackets should be placed.\n```\n\n### Step 4: Define Bracket Edge (GA Cullen Only)\n*If Type is **GA Cullen**:*\n```\nCommand Line: Select point that define the edge of the bracket\nAction: Click a point on the selected beam/sheet to define the alignment edge for the brackets.\n```\n\n### Step 5: Generation\nThe script automatically calculates positions and inserts the connector instances. The script instance (`hsbCullenDistribute`) will delete itself upon completion.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | dropdown | FAS | Defines the type of connector to distribute. Options: FAS, PC, ST-PFS, GA Cullen. |\n| Distance Bottom/Start | number | 0 | Offset distance from the start (bottom) of the element to the center of the first connector (mm). |\n| Distance Top/End | number | 0 | Offset distance from the end (top) of the element to the center of the last connector (mm). |\n| Distance Between | number | 0 | Center-to-center spacing between connectors. Enter a **negative number** (e.g., -1) to automatically calculate spacing based on \"Nr. Parts\". |\n| Nr. Parts | number | 0 | The total number of connectors to distribute. Used only if \"Distance Between\" is negative. |\n| Swap X-Y | dropdown | No | Swaps the orientation of the connector (flips it upside down). Options: No, Yes. |\n| Offset GA | number | 10 | (Soleplate category) Adjusts the position of the bracket relative to the plate edge (mm). |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific context menu options are added by this script. |\n\n## Settings Files\nNone required.\n\n## Tips\n- **Using Fixed Counts**: To distribute a specific number of brackets evenly, set **Distance Between** to `-1` and set **Nr. Parts** to your desired count. The script will calculate the correct spacing automatically.\n- **Horizontal Beams Only**: When using the **GA Cullen** type, ensure you select a horizontal beam. If a vertical beam is selected, the script will generate an error and exit.\n- **Script Disappears**: It is normal for the script instance to vanish from the drawing after it runs. It has successfully generated the individual connector objects.\n\n## FAQ\n- **Q: Why did the script disappear after I finished?**\n  **A:** The script is designed to delete itself (`delete instance after generation`) after creating the connector objects. This keeps your drawing clean.\n- **Q: How do I space brackets evenly if I know how many I need but not the distance?**\n  **A:** Set the **Distance Between** property to a negative value (e.g., -1) and enter the required quantity in **Nr. Parts**.\n- **Q: I got an error \"at least 2 walls needed\". What does this mean?**\n  **A:** This error occurs for FAS and PC types if you selected fewer than two walls. These connectors are designed for intersections between multiple walls."
      },
      "tokens_used": 7556,
      "error": null
    }
  }
}