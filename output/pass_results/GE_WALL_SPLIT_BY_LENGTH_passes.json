{
  "filename": "GE_WALL_SPLIT_BY_LENGTH.mcr",
  "status": "completed",
  "total_tokens": 40465,
  "processing_time": 553.0556862354279,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "v1.0",
            "date": "19.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Copied from hsb_Split Walls, to keep US content folder naming standards\n- Thumbnail added"
          },
          {
            "version": "v1.9",
            "date": "19.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Version control from 1.0 to 1.9, to keep updated with hsb_Split Walls"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6393,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity to select Element objects in Model Space, retrieves 3D geometry via el.coordSys(), plOutlineWall(), and Wall objects, and modifies the database using Wall.dbSplit(). No ShopDrawing (sd_*) or Viewport interactions found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Wall"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Wall elements",
          "requiredSettings": []
        }
      },
      "tokens_used": 5231,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialogOnce",
              "promptOriginal": null,
              "condition": "_bOnInsert && _kExecuteKey==\"\"",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Please select the elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Properties Dialog",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "Script Properties (OPM)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dMaxWallLength",
            "type": "PropDouble",
            "displayName": "Max. Wall Length",
            "defaultValue": "3600",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "The Length entered here will be the max length that any wall can be."
          },
          {
            "index": 1,
            "variable": "dDistanceToWindow",
            "type": "PropDouble",
            "displayName": "Min. Distance to Opening",
            "defaultValue": "300",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "This is the min distance that any wall will split to an opening."
          },
          {
            "index": 2,
            "variable": "dMinDistanceToWallEdge",
            "type": "PropDouble",
            "displayName": "Min. Distance to Wall Edge",
            "defaultValue": "300",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "This is the min distance that any wall will split to the end of a Wall."
          },
          {
            "index": 0,
            "variable": "sGenerate",
            "type": "PropString",
            "displayName": "Frame walls after split",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6968,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically splits long wall elements into shorter segments suitable for manufacturing or transport, while ensuring splits do not occur too close to openings or wall ends.",
          "category": "Manufacturing / Drafting Automation",
          "typicalUseCase": "A user has designed a long continuous wall (e.g., 10m) but the production facility can only handle panels up to 3.6m. This script splits the wall into three pieces, ensuring joints avoid windows and doors to maintain structural integrity."
        },
        "parameters": [
          {
            "name": "dMaxWallLength",
            "technicalDefault": "3600",
            "businessMeaning": "The maximum allowable length for a single wall panel or element. This usually corresponds to physical constraints such as truck bed length, factory door dimensions, or manufacturing machine bed size.",
            "validRange": "2400 - 12000",
            "unit": "mm",
            "affectsOutput": "Determines the frequency of wall splits. Higher values result in fewer, longer wall elements. The script attempts to place a split at this distance from the start or previous split."
          },
          {
            "name": "dDistanceToWindow",
            "technicalDefault": "300",
            "businessMeaning": "The mandatory structural 'keep-out' zone around openings (windows/doors). It ensures the wall joint is not placed directly adjacent to an opening, which could weaken the frame or hinder installation.",
            "validRange": "150 - 600",
            "unit": "mm",
            "affectsOutput": "Creates a virtual exclusion zone extending from the edges of any opening found in the wall. If a calculated split point falls within this zone, the script moves the split point back to the safe edge of the opening."
          },
          {
            "name": "dMinDistanceToWallEdge",
            "technicalDefault": "300",
            "businessMeaning": "The minimum acceptable length for the starting or ending segment of a wall. This prevents the creation of tiny, unusable slivers of wall material at the ends of a run.",
            "validRange": "100 - 1000",
            "unit": "mm",
            "affectsOutput": "Defines exclusion zones at the very start and end of the wall element. Splits are prohibited within this distance from the wall's original endpoints."
          },
          {
            "name": "sGenerate",
            "technicalDefault": "Yes",
            "businessMeaning": "Determines whether the wall framing (studs, plates, noggins) should be automatically recalculated after the wall is split.",
            "validRange": "Yes, No",
            "unit": "Boolean (String)",
            "affectsOutput": "If set to 'Yes', the script triggers the 'Hsb_GenerateConstruction' command for all new wall segments. If 'No', the wall outlines are split, but the internal timber framing remains in its previous state (or ungenerated)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "High dMaxWallLength vs Small Wall Total Length",
            "effect": "If the wall is shorter than the Max Length, no split occurs.",
            "cascade": [
              "dMaxWallLength"
            ]
          },
          {
            "trigger": "dDistanceToWindow overlapping dMaxWallLength",
            "effect": "If an opening is located such that its exclusion zone overlaps the theoretical split point, the split is shifted back to the edge of the exclusion zone. This creates a wall segment shorter than dMaxWallLength.",
            "cascade": [
              "dMaxWallLength",
              "dDistanceToWindow"
            ]
          },
          {
            "trigger": "Exclusion Zones larger than Max Length",
            "effect": "If the combined 'keep-out' zones (Openings + Edges) leave no gap larger than dMaxWallLength, the script enters a retry loop. If it fails to find a spot after 30 attempts, it reports an error and stops splitting that specific wall.",
            "cascade": [
              "dMaxWallLength",
              "dDistanceToWindow",
              "dMinDistanceToWallEdge"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Wall Elements",
            "description": "New wall elements created by the database split operation (dbSplit).",
            "appliedTo": "The selected Element entities."
          },
          {
            "type": "Construction/Framing",
            "description": "Timber framing generated by the subsequent Hsb_GenerateConstruction command.",
            "appliedTo": "The newly created wall elements (if sGenerate is 'Yes')."
          }
        ]
      },
      "tokens_used": 7299,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. User launches script (Run TSL).\",\n    \"2. If '_kExecuteKey' is empty, show Properties Dialog for parameters (Max Length, Distances, etc.).\",\n    \"3. Prompt user to select Wall Elements ('PrEntity').\",\n    \"4. Validate selection: if empty, erase script instance and stop.\",\n    \"5. Iterate through selected Elements: Retrieve geometry and Openings.\",\n    \"6. Define 'No Valid Areas' (exclusion zones) based on Openings and Wall Edges.\",\n    \"7. Enter Split Loop: Calculate potential split point at 'dMaxWallLength'.\",\n    \"8. Check Interference: Is split point inside a 'No Valid Area'?\",\n    \"9. Branch A (Interference): Move split point to edge of zone and retry (increment counter).\",\n    \"10. Branch B (Clear): Perform 'dbSplit' to cut the Wall.\",\n    \"11. Add new split location to 'No Valid Areas' to prevent overlapping splits.\",\n    \"12. Repeat steps 7-11 until end of wall is reached.\",\n    \"13. If 'sGenerate' is 'Yes', prepare command strings to generate framing.\",\n    \"14. Execute 'Hsb_GenerateConstruction' commands via Command Stack.\",\n    \"15. Erase script instance and exit.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Interference Check (Split point location)\",\n      \"path1\": {\n        \"name\": \"Valid Split Point\",\n        \"steps\": [\n          \"Check if point is not inside any exclusion zone.\",\n          \"Check if point is not behind the start.\",\n          \"Execute Wall.dbSplit(ptSplit).\",\n          \"Update 'elToSplit' to the new segment.\",\n          \"Add new exclusion zone at the split edge.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Invalid Split Point (Interference)\",\n        \"steps\": [\n          \"Detect point inside 'No Valid Area' (Opening or Edge buffer).\",\n          \"Move split point backward ('vecDirection * U(1)').\",\n          \"Increment safety counter 'nTimes'.\",\n          \"Retry logic from beginning of interference check.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Framing Generation (sGenerate property)\",\n      \"path1\": {\n        \"name\": \"Yes\",\n        \"steps\": [\n          \"Collect entity numbers of processed walls.\",\n          \"Push '-Hsb_GenerateConstruction' commands to Command Stack.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No\",\n        \"steps\": [\n          \"Skip framing command generation.\",\n          \"Leave walls as empty outlines (or previously framed state)."
      },
      "tokens_used": 9337,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_WALL_SPLIT_BY_LENGTH.mcr\n\n## Overview\nThis script automatically splits long wall elements into shorter segments suitable for manufacturing or transport. It ensures that splits respect specific safety distances from wall openings (windows/doors) and wall edges to maintain structural integrity.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This is where the script must be run. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: Existing Wall elements (hsbCAD Elements) in the model.\n- **Minimum Beam Count**: At least one wall element.\n- **Required Settings**: None required; all parameters are set via the Properties Palette.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT` â†’ Select `GE_WALL_SPLIT_BY_LENGTH.mcr`\n\n### Step 2: Configure Parameters\n**Action**: Upon running the script, the Properties Palette (OPM) will appear.\n*   Adjust the **Max. Wall Length**, **Min. Distance to Opening**, and **Min. Distance to Wall Edge** as required for your project.\n*   Choose whether to **Frame walls after split**.\n\n### Step 3: Select Walls\n```\nCommand Line: Please select the elements\nAction: Click on the wall element(s) you wish to split and press Enter.\n```\n\n**Result**: The script will process the selected walls, creating splits at valid locations. If \"Frame walls after split\" was set to \"Yes\", the framing for the new segments will be automatically generated.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Max. Wall Length | Number | 3600 | The maximum allowable length for a single wall panel (e.g., for transport or machine limits). |\n| Min. Distance to Opening | Number | 300 | The minimum \"keep-out\" zone around windows/doors. Splits will not be placed closer than this distance to an opening. |\n| Min. Distance to Wall Edge | Number | 300 | The minimum allowable length for the start or end segment of a wall. Prevents tiny unusable wall slivers. |\n| Frame walls after split | Dropdown | Yes | If \"Yes\", the script automatically generates the timber framing (studs/plates) for the new wall segments. If \"No\", only the outline is split. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific items to the entity context menu. |\n\n## Settings Files\n- **None Required**: This script operates independently without external settings files.\n\n## Tips\n- **Check Openings**: If a wall has windows or doors placed very close together, the script may fail to split the wall if there is no gap large enough to satisfy the \"Max. Wall Length\" minus the \"Min. Distance to Opening\" on both sides.\n- **Units**: The parameters are in millimeters (mm). Ensure you account for unit conversion if working in imperial, though the script handles internal unit independence.\n- **Performance**: If generating framing automatically (\"Yes\"), processing a large number of complex walls may take a moment.\n\n## FAQ\n- **Q: Why didn't my wall split?**\n  - **A**: The wall might be shorter than the specified \"Max. Wall Length,\" or the openings might be positioned such that there is no valid spot to cut without violating the safety distances.\n\n- **Q: Can I undo the changes?**\n  - **A**: Yes, you can use the standard AutoCAD `UNDO` command to revert the wall splits and framing generation.\n\n- **Q: What happens if the script cannot find a valid split point after 30 tries?**\n  - **A**: The script will report an error for that specific wall and stop splitting it, leaving it in its original state to prevent errors."
      },
      "tokens_used": 5237,
      "error": null
    }
  }
}