{
  "filename": "hsbTileEdge.mcr",
  "status": "completed",
  "total_tokens": 52913,
  "processing_time": 261.40982246398926,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7136,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select ERoofPlane entities during _bOnInsert, which are 3D Model Space entities. It explicitly creates and draws 3D Body objects (Body bd3D, Body bd). There are no references to _Viewport, sd_ prefixes, or Paper Space specific functions like Multipage or #Type E."
        },
        "prerequisites": {
          "requiredEntities": [
            "ERoofPlane",
            "GenBeam",
            "ElementRoof"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing at least two Roof Planes",
          "requiredSettings": [
            "DimStyles",
            "TileMap (Map object used to retrieve tile dimensions)"
          ]
        }
      },
      "tokens_used": 8241,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10833,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Calculates and visualizes the layout of roof tiles along a roof intersection (valley, hip, or ridge) defined by two roof planes, including quantity takeoff and custom tile handling.",
          "category": "Structural/Cladding",
          "typicalUseCase": "Used when detailing a roof to determine the exact number and type of tiles needed to cover a valley or hip, and to generate a 3D representation or 2D plan view of the tiling layout."
        },
        "parameters": [
          {
            "name": "sPartStart",
            "technicalDefault": "\"\"",
            "businessMeaning": "Specifies the catalog name or type of the special tile used at the start of the roof edge (e.g., a half-tile, starter tile, or specific trim piece).",
            "validRange": "String value corresponding to an entry in the TileMap catalog.",
            "unit": "String",
            "affectsOutput": "Adds a specific 3D body at the start point and increments the quantity count for that specific tile type in the output data."
          },
          {
            "name": "sPartEnd",
            "technicalDefault": "\"\"",
            "businessMeaning": "Specifies the catalog name or type of the special tile used at the end of the roof edge.",
            "validRange": "String value corresponding to an entry in the TileMap catalog.",
            "unit": "String",
            "affectsOutput": "Adds a specific 3D body at the end point and increments the quantity count for that specific tile type in the output data."
          },
          {
            "name": "sGroup",
            "technicalDefault": "\"\"",
            "businessMeaning": "Assigns the script instance to a specific organizational grouping in the CAD model (e.g., 'Roof\\Tiles\\North'), used for layer management and filtering.",
            "validRange": "String path separated by backslashes (e.g., \"Group\\SubGroup\").",
            "unit": "String",
            "affectsOutput": "Changes the group assignment of the TSL instance in the model browser, but does not change the geometry."
          },
          {
            "name": "sAllowEdit",
            "technicalDefault": "No",
            "businessMeaning": "Controls whether the user can interactively modify the tile layout after insertion using grip points or context menu options.",
            "validRange": "No, Yes",
            "unit": "Enum",
            "affectsOutput": "If 'Yes', enables Jig modes allowing deletion, addition, or modification of individual tiles via mouse clicks. If 'No', the layout remains static based solely on calculation."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Sets the graphical style (text size, arrow style, color) for any dimensions or annotations generated by the script.",
            "validRange": "Name of an existing Dimension Style in the drawing.",
            "unit": "String",
            "affectsOutput": "Updates the visual appearance of any text or dimension lines drawn in the plan view."
          },
          {
            "name": "ERoofPlane Selection (er[])",
            "technicalDefault": "User Selection",
            "businessMeaning": "The two adjacent roof planes that define the geometry (slope, intersection line) where the tiles will be laid.",
            "validRange": "Exactly two valid ERoofPlane entities selected in the model.",
            "unit": "Entity",
            "affectsOutput": "Determines the intersection line, the angle of the mitre (Valley, Hip, or Ridge), and the boundary for tile calculation."
          },
          {
            "name": "Roof Laths / Elements (GenBeam/ElementRoof)",
            "technicalDefault": "User Selection (via Context Menu)",
            "businessMeaning": "The structural battens or roof elements that define the top surface level (nailing plane) for the tiles.",
            "validRange": "GenBeam entities of type 'Lath' or ElementRoof entities.",
            "unit": "Entity",
            "affectsOutput": "Calculates the exact elevation (Z-height) of the tile plane to ensure tiles sit correctly on the structure."
          },
          {
            "name": "Tile Modifications (Interactive Jig)",
            "technicalDefault": "None",
            "businessMeaning": "User-defined manual overrides, such as removing a tile to make room for a chimney or changing a standard tile to a vent tile.",
            "validRange": "Interactively selected regions or individual tiles within the layout.",
            "unit": "Graphical Selection",
            "affectsOutput": "Alters the standard generated array by skipping indices or swapping types, updating the final quantity report accordingly."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sAllowEdit set to 'Yes'",
            "effect": "Unlocks the interactive modification tools (Jigs) which write coordinate data to the internal Map.",
            "cascade": [
              "_Map Point3dArray('pt')",
              "Visual Layout",
              "Final Quantity Counts"
            ]
          },
          {
            "trigger": "Selection of Roof Laths/Elements",
            "effect": "Determines the height of the tile plane (pnTile). If missing, tiles may default to the roof plane level.",
            "cascade": [
              "3D Tile Z-Position",
              "dZ (Thickness) calculation"
            ]
          },
          {
            "trigger": "ERoofPlane Geometry Change",
            "effect": "Recalculates the intersection line vector and the specific 'Mitre' type (Valley vs Hip).",
            "cascade": [
              "Tile Orientation",
              "3D Body Shape",
              "Coverage Area"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Body (Tile Representation)",
            "description": "A solid body representing the course of tiles along the edge, including thickness and slope.",
            "appliedTo": "Model Space (Visual representation of the finished surface)"
          },
          {
            "type": "3D Body (Start/End Parts)",
            "description": "Specific solid bodies generated from the TileMap dimensions for special starter or end tiles.",
            "appliedTo": "Model Space (Start and End points of the intersection)"
          },
          {
            "type": "Graphical PLine/Hatch",
            "description": "2D outlines and hatching used to represent the tiled area in plan drawings.",
            "appliedTo": "Plan Views"
          },
          {
            "type": "Map Data (TileData)",
            "description": "A data structure containing the calculated quantities of each tile type (Standard + Start + End + Custom).",
            "appliedTo": "Internal Script Map (Exportable for BOM)"
          }
        ]
      },
      "tokens_used": 9293,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Launch: User executes hsbTileEdge command.\",\n    \"2. Initial Configuration: Properties dialog displays for Part Start/End, Grouping, and Edit permissions.\",\n    \"3. Geometry Selection: User is prompted to select two adjacent ERoofPlane entities.\",\n    \"4. Intersection Calculation: Script computes the common intersection line (Valley/Hip/Ridge) between the two planes and stores Start/End points.\",\n    \"5. [Validation Check] If valid intersection is found, script proceeds; otherwise, the instance is erased.\",\n    \"6. Data Retrieval: Script loads TileMap catalog and checks for attached structural elements (Laths/Elements) to define the tile elevation.\",\n    \"7. Layout Generation: Script divides the intersection length by tile dimensions to calculate the number of columns.\",\n    \"8. Interactive Editing (Optional): If 'sAllowEdit' is Yes, user may execute Jig triggers to select specific tiles for deletion or modification.\",\n    \"9. Final Generation: Script draws 3D tile bodies, 2D hatching, and outputs quantity data to the 'TileData' map.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Number of Roof Planes Selected during Insert\",\n      \"path1\": {\n        \"name\": \"Less than 2 Planes\",\n        \"steps\": [\n          \"User cancels selection or selects only one plane.\",\n          \"Script triggers 'eraseInstance()'.\",\n          \"Process terminates.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"2 Planes Selected"
      },
      "tokens_used": 11846,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbTileEdge.mcr\n\n## Overview\nThis script calculates and visualizes the layout of roof tiles along a roof intersection (valley, hip, or ridge) defined by two roof planes. It performs quantity takeoff and generates 3D bodies representing the tile coverage.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script requires 3D ERoofPlane entities to define the geometry. |\n| Paper Space | No | Does not support direct creation in Paper Space. |\n| Shop Drawing | No | This is a detailing/modeling script, not a drawing generator. |\n\n## Prerequisites\n- **Required Entities**: At least two adjacent `ERoofPlane` entities in the model.\n- **Structural Elements** (Optional but recommended): `GenBeam` (Laths) or `ElementRoof` entities to define the exact nailing height.\n- **Required Settings**: A valid `TileMap` (catalog containing tile dimensions like width, length, and thickness) must be available in the project.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbTileEdge.mcr` from the list.\n\n### Step 2: Configure Initial Properties\nBefore or immediately after insertion, use the Properties Palette (Ctrl+1) to set:\n- **Part Start/End**: Define specific tiles for the beginning and end of the run (e.g., half-tiles).\n- **Allow Edit**: Set to \"Yes\" if you plan to manually modify individual tiles later.\n- **Group**: Assign a group name for organization.\n\n### Step 3: Select Roof Planes\n```\nCommand Line: Select ERoofPlane 1/2 <Exit>:\nAction: Click on the first roof plane defining the intersection.\n```\n```\nCommand Line: Select ERoofPlane 2/2 <Exit>:\nAction: Click on the second adjacent roof plane.\n```\n*Note: If you do not select two valid planes, the script instance will be automatically erased.*\n\n### Step 4: Define Structural Height (Optional)\nOnce the script is inserted, you can refine the tile elevation to match the battens.\n1. Select the `hsbTileEdge` instance in the model.\n2. Right-click and choose the option to select structural elements (e.g., \"Select Laths\" or similar context menu item).\n3. Select the `GenBeam` or `ElementRoof` laths in the model.\n4. The tile geometry will update to sit on top of these elements.\n\n### Step 5: Interactive Editing (If Enabled)\nIf **sAllowEdit** was set to \"Yes\":\n1. Select the script instance.\n2. Use the specific Right-Click menu option to start the edit Jig (e.g., \"Modify Tiles\").\n3. Click on individual tiles or regions to delete them or swap their type based on your catalog options.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sPartStart | Text | \"\" | The catalog name of the special tile used at the start of the edge (e.g., Starter Tile). |\n| sPartEnd | Text | \"\" | The catalog name of the special tile used at the end of the edge. |\n| sGroup | Text | \"\" | Organizational path for the instance in the model browser (e.g., \"Roof\\Tiles\"). |\n| sAllowEdit | Enum | No | Controls if the user can interactively add/remove tiles after insertion. (Options: Yes, No). |\n| sDimStyle | Text | _DimStyles | The dimension style used for any annotations or measurements drawn by the script. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Select Structural Elements | Allows you to pick GenBeam laths or roof elements to set the correct Z-height for the tiles. |\n| Modify / Edit Tiles | (Only available if sAllowEdit is Yes) Enters an interactive mode to select and remove specific tiles or change their properties. |\n| Recalculate | Refreshes the tile layout based on current geometry or property changes. |\n\n## Settings Files\n- **Filename**: `TileMap` (varies by project configuration)\n- **Location**: Defined in your hsbCAD configuration or project folder.\n- **Purpose**: Contains the geometric definitions (width, height, length) for the available tile types. The script reads this to generate accurate 3D bodies and quantities.\n\n## Tips\n- **Plane Intersection**: Ensure the two roof planes you select physically intersect in 3D space. If they are parallel or do not meet, the calculation will fail.\n- **Accuracy**: Always select the structural laths (GenBeams) in the Right-Click menu if available. This ensures the tiles visualize exactly where they will be nailed, rather than just floating on the theoretical roof plane.\n- **Quantities**: The script generates quantity data (how many standard, start, and end tiles) which can be exported for BOM/estimating.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the planes?**\n  **A**: You likely selected fewer than two valid ERoofPlane entities, or the planes selected do not form a valid intersection. The script is designed to erase itself if the geometry is invalid.\n- **Q: How do I remove a tile to make room for a chimney?**\n  **A**: Set the **sAllowEdit** property to \"Yes\" in the Properties Palette. Then, right-click the script instance, select the edit/modify option, and click the specific tile(s) you wish to remove.\n- **Q: The tiles are floating above the battens. How do I fix this?**\n  **A**: Use the Right-Click menu option to select the Structural Elements (Laths) and pick the beams underneath. The script will adjust the tile elevation to match the top of the beams."
      },
      "tokens_used": 5564,
      "error": null
    }
  }
}