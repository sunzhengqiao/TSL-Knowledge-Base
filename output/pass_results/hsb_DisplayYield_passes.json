{
  "filename": "hsb_DisplayYield.mcr",
  "status": "completed",
  "total_tokens": 17666,
  "processing_time": 146.26164722442627,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "18.10.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Prototype"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 2772,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses getPoint() and PrEntity to select MasterPanel entities, which are operations performed in the 3D model environment. There are no references to Viewport, sd_ prefixes, or Multipage classes. The Display object is used to draw directly at coordinates, indicating Model Space annotation."
        },
        "prerequisites": {
          "requiredEntities": [
            "MasterPanel"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 1432,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select Master Panels|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 1,
            "variable": "pDimStyle",
            "type": "PropString",
            "displayName": "Dim style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "pTextHeight",
            "type": "PropDouble",
            "displayName": "Text height",
            "defaultValue": "U(1000)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2301,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Calculates and displays the average cutting yield percentage of selected MasterPanels at a specific location in the model.",
          "category": "DataAnalysis",
          "typicalUseCase": "Used by a design engineer or production manager to check the material efficiency (yield) of a group of wall or floor panels directly in the 3D model."
        },
        "parameters": [
          {
            "name": "pDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Selects the specific drafting standard (font, size, color) for the yield label.",
            "validRange": "Any Dimension Style currently loaded in the AutoCAD drawing",
            "unit": "N/A",
            "affectsOutput": "Alters the visual appearance (font, arrowheads, layers) of the generated text label."
          },
          {
            "name": "pTextHeight",
            "technicalDefault": "U(1000)",
            "businessMeaning": "Sets the height of the text characters for the yield label.",
            "validRange": "50mm - 5000mm (depending on model scale and visibility requirements)",
            "unit": "mm",
            "affectsOutput": "Resizes the text object; larger values make the text legible from further away in the model view."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "DisplayEntity",
            "description": "A text object displaying the calculated yield percentage (e.g., 'Yield: 85.5%') placed at the selected point.",
            "appliedTo": "Model Space (annotation only, does not modify geometry)"
          }
        ]
      },
      "tokens_used": 2306,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution begins",
          "Check execution state: Is this an initial Insert (_bOnInsert)?",
          "[Insert Mode] Prompt user to select insertion point (_Pt0) via getPoint()",
          "[Insert Mode] Prompt user to select Master Panels via PrEntity()",
          "[Insert Mode] Store selected entities into the _Entity array",
          "[Insert Mode] Return from script (wait for system recalculation)",
          "[Recalc Mode] Check if _Entity array contains elements",
          "[Recalc Mode] Iterate through _Entity to filter and collect valid MasterPanels into mpAll",
          "[Recalc Mode] Loop through valid panels: apply temporary Z-transform, force updateYield(), and retrieve yield value",
          "[Recalc Mode] Calculate average yield across all collected panels",
          "[Recalc Mode] Apply scaling (multiply by 100) and add constant offset (9.307...)",
          "[Recalc Mode] Initialize Display object with properties pDimStyle and pTextHeight",
          "[Recalc Mode] Draw formatted result string at coordinate _Pt0"
        ],
        "conditionalBranches": [
          {
            "condition": "Script initialization state (_bOnInsert)",
            "path1": {
              "name": "Insertion Flow",
              "steps": [
                "Execute getPoint() for location",
                "Execute PrEntity() for panel selection",
                "Populate _Entity array",
                "Terminate function"
              ]
            },
            "path2": {
              "name": "Execution/Recalc Flow",
              "steps": [
                "Validate _Entity array length",
                "Process geometry and calculate yield",
                "Render Display text"
              ]
            }
          },
          {
            "condition": "Entity Selection Count",
            "path1": {
              "name": "Empty Selection",
              "steps": [
                "Detect _Entity.length() == 0",
                "Return immediately (no output)"
              ]
            },
            "path2": {
              "name": "Valid Selection",
              "steps": [
                "Loop through entities",
                "Cast and verify MasterPanel validity",
                "Calculate average yield"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Array Length",
            "errorMessage": "None (Silent failure)",
            "recovery": "User must delete the script instance or ensure valid selection exists if modifying externally"
          },
          {
            "check": "Entity Type and Validity",
            "errorMessage": "None (Silent skipping)",
            "recovery": "User selects correct MasterPanel entities during insertion prompt"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Text Height",
            "how": "OPM (Properties Palette) -> Text height",
            "effect": "The text object redraws with the new character size defined by pTextHeight."
          },
          {
            "action": "Change Dimension Style",
            "how": "OPM (Properties Palette) -> Dim style",
            "effect": "The text object redraws using the selected dimension style (color, font, layer settings)."
          },
          {
            "action": "Move Annotation",
            "how": "Grip Edit (Drag script instance)",
            "effect": "Updates the _Pt0 coordinate variable, causing the text to move to the new location."
          }
        ]
      },
      "tokens_used": 4631,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_DisplayYield.mcr\n\n## Overview\nThis script calculates the average cutting yield percentage of selected MasterPanels and displays the result as a text label at a specific location in the 3D model. It helps users quickly assess material efficiency for a group of wall or floor panels.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in the 3D model to select panels and place annotations. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required entities**: MasterPanel (Wall or Floor panels)\n- **Minimum beam count**: 1\n- **Required settings files**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `hsb_DisplayYield.mcr` from the script list.\n\n### Step 2: Specify Location\n```\nCommand Line: Select insertion point\nAction: Click in the model space where you want the yield percentage text to appear.\n```\n\n### Step 3: Select Panels\n```\nCommand Line: Select Master Panels\nAction: Click on the MasterPanels (walls/floors) you wish to analyze. Press Enter to confirm the selection.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Text height | Number | U(1000) | Sets the height of the text characters for the yield label. Increase this value if the text is too small to read in the model view. |\n| Dim style | Dropdown | _DimStyles | Selects the drafting standard (font, color, layer) for the text label. Options are based on Dimension Styles currently loaded in the drawing. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not add custom items to the right-click context menu. Use standard AutoCAD functions to Delete or view Properties. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Moving the Label**: If you need to move the text after placing it, simply select the text object and use the grip point to drag it to a new location.\n- **Visibility**: If the text is difficult to see, select the object and press `Ctrl+1` to open the Properties Palette. Increase the \"Text height\" or change the \"Dim style\" to a style with a contrasting color.\n- **Data Accuracy**: The yield calculation updates automatically. If the geometry of the selected panels changes, the script will recalculate the average yield the next time the model updates.\n\n## FAQ\n- Q: The text displays 0% or an unexpected value. Why?\n- A: Ensure you selected valid MasterPanel entities during the insertion step. The script ignores non-panel entities. If panels were deleted after the script was inserted, the yield may not calculate correctly; delete the script instance and re-insert it.\n\n- Q: How do I change the font of the yield text?\n- A: You cannot change the font directly in the script properties. Instead, select the script instance, open the Properties Palette (`Ctrl+1`), and change the \"Dim style\" to a style that uses your desired font.\n\n- Q: Can I add more panels to an existing calculation?\n- A: No, you must delete the existing script instance and run the command again, selecting all desired panels at once."
      },
      "tokens_used": 4224,
      "error": null
    }
  }
}