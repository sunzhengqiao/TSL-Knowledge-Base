{
  "filename": "HSB_G-Distribution.mcr",
  "status": "completed",
  "total_tokens": 37408,
  "processing_time": 379.65653896331787,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl calculates a distribution between two points. The distribution positions can be retrieved through MapIO.",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "03.08.2016",
            "author": "AS",
            "changes": "First revision"
          },
          {
            "version": "1.01",
            "date": "01.09.2016",
            "author": "AS",
            "changes": "Add distribution types"
          },
          {
            "version": "1.02",
            "date": "31.01.2018",
            "author": "AS",
            "changes": "Ignore distribute evenly when spacing exceeds distribution length."
          },
          {
            "version": "1.03",
            "date": "07.12.2018",
            "author": "RP",
            "changes": "If spacingProp < 0 return, because of /0"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5897,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script interacts with the user via getPoint() and uses basic geometric entities (PLine) and dimensions (Dim) through the Display object, which typically operate in Model Space. There are no indicators of Paper Space usage such as '_Viewport', no 'sd_' prefixes indicating ShopDrawing functions, and no '#Type E' entity filtering."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "User input required to select two points defining the distribution start and end.",
          "requiredSettings": []
        }
      },
      "tokens_used": 3532,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Select start distribution",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select end distribution",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "spacingProp",
            "type": "PropDouble",
            "displayName": "|Spacing|",
            "defaultValue": "600",
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": "|Sets the spacing of the distribution|."
          },
          {
            "index": 1,
            "variable": "distributionType",
            "type": "PropString",
            "displayName": "|Distribution type|",
            "defaultValue": "|From start to end|",
            "inputType": "dropdown",
            "options": [
              "|From start to end|",
              "|From end to start|",
              "|From centre|",
              "|From centre, no position in centre|"
            ],
            "category": "|Distribution|",
            "description": "|Sets the distribution type of the distribution|."
          },
          {
            "index": 0,
            "variable": "distributeEvenlyProp",
            "type": "PropString",
            "displayName": "|Distribute evenly|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Distribution|",
            "description": "|Specifies whether the spacing is changed to fit the whole distribution length|."
          },
          {
            "index": 1,
            "variable": "startOffset",
            "type": "PropDouble",
            "displayName": "|Start offset|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": "|Sets the offset from the start of the distribution|."
          },
          {
            "index": 2,
            "variable": "endOffset",
            "type": "PropDouble",
            "displayName": "|End offset|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": "|Sets the offset from the end of the distribution|."
          },
          {
            "index": 3,
            "variable": "useStartAsPositionProp",
            "type": "PropString",
            "displayName": "|Use start as position|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Start and end positions|",
            "description": "|Specifies whether the start position is a distribution position or not|."
          },
          {
            "index": 4,
            "variable": "useEndAsPositionProp",
            "type": "PropString",
            "displayName": "|Use end as position|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Start and end positions|",
            "description": "|Specifies whether the start position is a distribution position or not|."
          },
          {
            "index": 3,
            "variable": "allowedDistanceBetweenPositions",
            "type": "PropDouble",
            "displayName": "|Allowed distance between positions|",
            "defaultValue": "10",
            "inputType": "number",
            "options": [],
            "category": "|Start and end positions|",
            "description": "|Sets the allowed distance between the extreme distribution positions and the start and end position of the distribution|."
          },
          {
            "index": 5,
            "variable": "showDimensionLineProp",
            "type": "PropString",
            "displayName": "|Show dimension lines|",
            "defaultValue": "|Yes|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Dimension|",
            "description": "|Specifies whether the dimension line is visible|."
          },
          {
            "index": 2,
            "variable": "dimStyle",
            "type": "PropString",
            "displayName": "|Dimension style|",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [],
            "category": "|Dimension|",
            "description": "|Sets the dimension style|."
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5942,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Calculates and visualizes a linear distribution pattern (e.g., for studs or joists) between two points, exporting coordinates for further generation.",
          "category": "Framing/Layout",
          "typicalUseCase": "Planning the layout of wall studs, rafters, or floor joists to determine spacing and positions before generating the actual timber elements."
        },
        "parameters": [
          {
            "name": "spacingProp",
            "technicalDefault": "600",
            "businessMeaning": "The center-to-center distance between distributed elements (e.g., standard stud or joist spacing).",
            "validRange": "300 to 1200",
            "unit": "mm",
            "affectsOutput": "Determines the density of distribution points. If 'Distribute evenly' is Yes, this value acts as a maximum target to be adjusted to fit the length."
          },
          {
            "name": "distributionType",
            "technicalDefault": "From start to end",
            "businessMeaning": "Controls the alignment logic, deciding if the layout starts from one end or is centered on the midpoint.",
            "validRange": "List: From start to end, From end to start, From centre, From centre, no position in centre",
            "unit": "enum",
            "affectsOutput": "Shifts the entire array of positions. 'From centre' options ensure symmetry around the midpoint."
          },
          {
            "name": "distributeEvenlyProp",
            "technicalDefault": "No",
            "businessMeaning": "Forces the layout to divide the total length exactly, ensuring no partial gap at the end by modifying the spacing.",
            "validRange": "Yes/No",
            "unit": "bool",
            "affectsOutput": "If Yes, overrides 'spacingProp' with a calculated value that divides the distribution length into an integer number of spaces."
          },
          {
            "name": "startOffset",
            "technicalDefault": "0",
            "businessMeaning": "Sets a margin or clear space from the start point before the distribution begins.",
            "validRange": "0 to 500",
            "unit": "mm",
            "affectsOutput": "Shifts the first calculated position away from the selected start point."
          },
          {
            "name": "endOffset",
            "technicalDefault": "0",
            "businessMeaning": "Sets a margin or clear space from the end point before the distribution ends.",
            "validRange": "0 to 500",
            "unit": "mm",
            "affectsOutput": "Shifts the last calculated position away from the selected end point."
          },
          {
            "name": "useStartAsPositionProp",
            "technicalDefault": "No",
            "businessMeaning": "Determines if an element must be placed exactly at the user-selected start point.",
            "validRange": "Yes/No",
            "unit": "bool",
            "affectsOutput": "If Yes, forces a position at the start point (provided it is within the 'Allowed distance')."
          },
          {
            "name": "useEndAsPositionProp",
            "technicalDefault": "No",
            "businessMeaning": "Determines if an element must be placed exactly at the user-selected end point.",
            "validRange": "Yes/No",
            "unit": "bool",
            "affectsOutput": "If Yes, forces a position at the end point (provided it is within the 'Allowed distance')."
          },
          {
            "name": "allowedDistanceBetweenPositions",
            "technicalDefault": "10",
            "businessMeaning": "Tolerance distance. If the calculated grid falls within this range of the start/end, it snaps to the edge.",
            "validRange": "1 to 50",
            "unit": "mm",
            "affectsOutput": "Controls when 'Use start/end as position' triggers relative to the calculated grid."
          },
          {
            "name": "showDimensionLineProp",
            "technicalDefault": "Yes",
            "businessMeaning": "Controls the visibility of the dimension lines in the CAD model.",
            "validRange": "Yes/No",
            "unit": "bool",
            "affectsOutput": "Hides or shows the dimension lines indicating distribution length."
          },
          {
            "name": "dimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Specifies the drafting standard (text height, arrow style) for the dimensions.",
            "validRange": "Available Dimension Styles",
            "unit": "string",
            "affectsOutput": "Visual appearance of dimension lines."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "distributeEvenlyProp is set to Yes",
            "effect": "The 'spacingProp' value is ignored and recalculated to fit the length perfectly.",
            "cascade": [
              "spacingProp"
            ]
          },
          {
            "trigger": "distributionType is 'From centre'",
            "effect": "The start/end positions are determined by the midpoint calculation, potentially overriding 'useStartAsPositionProp' unless the calculated point happens to align.",
            "cascade": [
              "useStartAsPositionProp",
              "useEndAsPositionProp"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "PLine (Visual)",
            "description": "Small circles drawn at each calculated distribution point to mark location.",
            "appliedTo": "Model Space"
          },
          {
            "type": "MapIO Data",
            "description": "Array of Point3d coordinates ('DistributionPositions') used by other scripts to generate actual beams or elements.",
            "appliedTo": "Script Map"
          },
          {
            "type": "Dim (Dimension)",
            "description": "Dimension lines showing the total span and offsets.",
            "appliedTo": "Model Space"
          }
        ]
      },
      "tokens_used": 7136,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution begins (triggered by Insert or MapIO request).",
          "[Insert Mode] User selects 'Start distribution' point via getPoint.",
          "[Insert Mode] User selects 'End distribution' point via getPoint.",
          "[Insert Mode] Script sets 'ManualInsert' flag in Map and exits.",
          "[Calculation Mode] Script determines if run via MapIO or ManualInsert (Property change/Grip edit).",
          "Retrieve Start/End coordinates (from MapIO data or _Pt0/_PtG).",
          "Retrieve and Map Input Properties (Offsets, Spacing, Types, etc.) from MapIO or OPM.",
          "Validate Inputs: Check if Spacing is greater than tolerance (0.1mm). Return if invalid.",
          "Calculate Direction Vector and effective Distribution Length (Total Length - Start Offset - End Offset).",
          "[Branch] Analyze 'Distribute Evenly' property.",
          "[Branch] Analyze 'Distribution Type' to determine alignment logic (Start-based, End-based, or Center-based).",
          "Calculate final Spacing value (Fixed user value vs. Calculated even division).",
          "Calculate precise Start Point (Shifted from midpoint if Center-based).",
          "Generate Point Array: Loop from Start Point along Direction Vector until End Point is passed.",
          "Edge Correction: Compare generated first/last points against original Start/End references.",
          "[Branch] Apply 'Use Start/End as Position' logic to add or remove edge points.",
          "Visualization: Draw PLine circles at each valid distribution point.",
          "[Branch] Draw Dimension Lines if 'Show Dimension Lines' property is Yes.",
          "[MapIO Only] Write 'DistributionPositions' Point3d array to MapIO and exit.",
          "[Manual Only] Reset 'ManualInsert' flag for next update cycle."
        ],
        "conditionalBranches": [
          {
            "condition": "Script Trigger Context",
            "path1": {
              "name": "Initial Insert (_bOnInsert)",
              "steps": [
                "Prompt user for Start Point",
                "Prompt user for End Point",
                "Save points to Element",
                "Return immediately"
              ]
            },
            "path2": {
              "name": "Calculation/Update (_bOnMapIO || manualInsert)",
              "steps": [
                "Load existing points and properties",
                "Execute geometry calculations",
                "Update visualization and data"
              ]
            }
          },
          {
            "condition": "Distribution Type Alignment",
            "path1": {
              "name": "Linear (Start to End / End to Start)",
              "steps": [
                "Normalize vector between points",
                "Start distribution at Start Point + Start Offset",
                "Step forward by spacing"
              ]
            },
            "path2": {
              "name": "Center-based (From Centre)",
              "steps": [
                "Calculate geometric midpoint",
                "Adjust start point backwards from center by spacing increments",
                "Ensure specific center inclusion logic (position at center vs gap at center)"
              ]
            }
          },
          {
            "condition": "Distribute Evenly Logic",
            "path1": {
              "name": "No (Fixed Spacing)",
              "steps": [
                "Use 'spacingProp' value directly",
                "Fill loop until length exceeded",
                "Remainder space at end allowed"
              ]
            },
            "path2": {
              "name": "Yes (Calculated Spacing)",
              "steps": [
                "Calculate ideal number of spaces (Ceiling of Length / Spacing)",
                "Adjust space count for center-type symmetry",
                "Override Spacing = Length / NumberOfSpaces"
              ]
            }
          },
          {
            "condition": "Edge Position Usage (Start/End points)",
            "path1": {
              "name": "Enforce Position (Use Start/End = Yes)",
              "steps": [
                "Check distance from calculated grid to edge",
                "If > Allowed Distance: Insert original edge point into array",
                "If <= Allowed Distance: Grid assumed close enough"
              ]
            },
            "path2": {
              "name": "Ignore Position (Use Start/End = No)",
              "steps": [
                "Check distance from calculated grid to edge",
                "If < Tolerance: Remove grid point at edge",
                "Maintains offset from edge"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Spacing Property Value",
            "errorMessage": "None (Silent failure/return)",
            "recovery": "User must set 'Spacing' property to a positive number (> 0.1mm) to allow calculation."
          },
          {
            "check": "Distribution Length Validity",
            "errorMessage": "None (Handled gracefully)",
            "recovery": "If Start Offset + End Offset > Total Length, distribution length is effectively 0 or negative, resulting in no points generated."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Layout Geometry",
            "how": "Grip Edit (Move Start or End Points)",
            "effect": "Script recalculates vector and length, redistributing points along the new line immediately."
          },
          {
            "action": "Change Configuration",
            "how": "OPM Properties Palette",
            "effect": "Changing 'Spacing', 'Distribution Type', or 'Offsets' triggers recalculation and updates point positions and circles."
          },
          {
            "action": "Toggle Dimensions",
            "how": "OPM Property 'Show dimension lines'",
            "effect": "Adds or removes the dimension line object from the display without changing distribution points."
          },
          {
            "action": "Data Extraction",
            "how": "External Script calling MapIO",
            "effect": "Retrieves the 'DistributionPositions' Point3d array to generate actual timber elements (e.g., studs, joists)."
          }
        ]
      },
      "tokens_used": 8041,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-Distribution.mcr\n\n## Overview\nThis script calculates and visualizes a linear distribution pattern (such as stud or joist layout) between two user-selected points. It exports the calculated position coordinates to the MapIO, allowing other scripts to generate actual timber elements based on this layout.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Distribution is visualized using geometry in Model Space. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required entities**: None.\n- **Minimum beam count**: 0.\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_G-Distribution.mcr` from the list.\n\n### Step 2: Define Start Point\n```\nCommand Line: Select start distribution\nAction: Click in the drawing to set the starting point for the distribution.\n```\n\n### Step 3: Define End Point\n```\nCommand Line: Select end distribution\nAction: Click to set the ending point. The script will automatically calculate and display the distribution.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Spacing | Number | 600 | Sets the center-to-center distance between distribution positions (in mm). |\n| Distribution type | Dropdown | From start to end | Sets the alignment logic. Options: From start to end, From end to start, From centre, From centre (no position in centre). |\n| Distribute evenly | Dropdown | No | If set to \"Yes\", the spacing is automatically adjusted to fit the exact distribution length without a remainder. |\n| Start offset | Number | 0 | Sets the offset distance (in mm) from the start point before distribution begins. |\n| End offset | Number | 0 | Sets the offset distance (in mm) from the end point before distribution ends. |\n| Use start as position | Dropdown | No | Specifies whether the start point must be a distribution position. |\n| Use end as position | Dropdown | No | Specifies whether the end point must be a distribution position. |\n| Allowed distance between positions | Number | 10 | The tolerance (in mm) allowed for snapping distribution points to the start or end edges. |\n| Show dimension lines | Dropdown | Yes | Toggles the visibility of the dimension lines in the model. |\n| Dimension style | Dropdown | _DimStyles | Selects the dimension style to be used for displaying measurements. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add custom items to the right-click context menu. Edit properties via the Properties Palette (Ctrl+1). |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Grip Editing**: After insertion, select the distribution element and use the blue grips to move the Start or End points. The positions will recalculate automatically.\n- **Even Distribution**: If you need the layout to fill the space exactly with no partial gap at the end, change \"Distribute evenly\" to \"Yes\".\n- **Center Alignment**: Use the \"From centre\" options when you want the layout to be symmetric around the midpoint of the selected line.\n- **Data Usage**: The small circles drawn by this script represent data points. Other scripts (e.g., wall generators) can read these points to automatically create studs or joists.\n\n## FAQ\n- **Q: Why don't I see any distribution circles?**\n  A: Check your \"Spacing\" value. If it is set too large for the total length, or if your \"Start offset\" and \"End offset\" sum up to more than the total length, no positions will be generated.\n- **Q: How do I force a stud at the very start and end?**\n  A: Set \"Use start as position\" and \"Use end as position\" to \"Yes\". Ensure \"Allowed distance between positions\" is sufficient to capture the edge.\n- **Q: Can I change the arrow style of the dimension line?**\n  A: Yes, change the \"Dimension style\" property to match your preferred drafting standard configured in hsbCAD."
      },
      "tokens_used": 6860,
      "error": null
    }
  }
}