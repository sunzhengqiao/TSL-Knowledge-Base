{
  "filename": "hsbCLT-ProfileConnection.mcr",
  "status": "completed",
  "total_tokens": 51147,
  "processing_time": 687.5850346088409,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.5",
            "date": "31.01.2024",
            "author": "Thorsten Huck",
            "changes": "bugfix when facet offset <=0"
          },
          {
            "version": "1.4",
            "date": "24.07.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5411 Bug fix at calculation of vFacet1 and vFacet2"
          },
          {
            "version": "1.3",
            "date": "03.07.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSBCAD-612 support multiple panels, connection will be created for all panels and the beam"
          },
          {
            "version": "1.2",
            "date": "21.mar2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "TSL display at middle of edges"
          },
          {
            "version": "1.1",
            "date": "21.mar2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "fix sugestions from Roman and Thorsten in HSBCAD-612"
          },
          {
            "version": "1.0",
            "date": "21.mar2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "initial version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8583,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses '_kModelSpace' in the dbCreate function call. It performs 3D geometric manipulations using Vector3d and Point3d, and modifies solid geometry using addTool on Beam and Sip objects. There are no references to 'sd_' functions, viewports, or paper space entities."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam",
            "Sip"
          ],
          "minimumBeams": 1,
          "requiredSpace": "ModelSpace",
          "requiredSettings": []
        }
      },
      "tokens_used": 6916,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select panel and beam",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "PropertyDialog",
            "trigger": "Insertion (if no ExecuteKey provided)",
            "title": "Script Properties",
            "dataSource": "PropDouble variables",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dGapTopVertical",
            "type": "PropDouble",
            "displayName": "Top Vertical",
            "defaultValue": 10.0,
            "inputType": "number",
            "options": [],
            "category": "Gap values",
            "description": "Defines the top vertical gap"
          },
          {
            "index": 1,
            "variable": "dGapTopHorizontal",
            "type": "PropDouble",
            "displayName": "Top Horizontal",
            "defaultValue": 10.0,
            "inputType": "number",
            "options": [],
            "category": "Gap values",
            "description": "Defines the top horizontal gap"
          },
          {
            "index": 2,
            "variable": "dGapBottomVertical",
            "type": "PropDouble",
            "displayName": "Bottom Vertical",
            "defaultValue": 10.0,
            "inputType": "number",
            "options": [],
            "category": "Gap values",
            "description": "Defines the bottom vertical gap"
          },
          {
            "index": 3,
            "variable": "dGapBottomHorizontal",
            "type": "PropDouble",
            "displayName": "Bottom Horizontal",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": "Gap values",
            "description": "Defines the bottom horizontal gap"
          },
          {
            "index": 4,
            "variable": "dGapMainVertical",
            "type": "PropDouble",
            "displayName": "Main Vertical",
            "defaultValue": 10.0,
            "inputType": "number",
            "options": [],
            "category": "Gap values",
            "description": "Defines the main vertical gap"
          },
          {
            "index": 5,
            "variable": "dGapFacet",
            "type": "PropDouble",
            "displayName": "Facet",
            "defaultValue": 15.0,
            "inputType": "number",
            "options": [],
            "category": "Gap values",
            "description": "Defines the facet gap"
          },
          {
            "index": 6,
            "variable": "dGapBeam",
            "type": "PropDouble",
            "displayName": "Beam",
            "defaultValue": 10.0,
            "inputType": "number",
            "options": [],
            "category": "Gap values",
            "description": "Defines the longitudinal gap at the start and end of beam"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Select new profile beam",
            "handler": "Select new profile beam",
            "action": "Prompts user to select a new beam to replace _Beam[0]",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9164,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a profile pocket (cutout) in a CLT or SIP panel to wrap around or connect to a steel beam, applying specific dimensional clearances (gaps) to the top flange, bottom flange, and web.",
          "category": "Machining/Connection",
          "typicalUseCase": "Used when a timber floor or wall panel needs to slot over a steel beam (e.g., a dropped beam or rim beam connection), ensuring the panel fits without touching the steel due to tolerance, insulation, or expansion requirements."
        },
        "parameters": [
          {
            "name": "dGapTopVertical",
            "technicalDefault": 10.0,
            "businessMeaning": "The vertical clearance space between the top surface of the steel beam's top flange and the timber panel. Ensures the panel does not rest directly on the steel flange.",
            "validRange": "0 to 50 mm",
            "unit": "mm",
            "affectsOutput": "Increases the depth of the cutout pocket above the top flange."
          },
          {
            "name": "dGapTopHorizontal",
            "technicalDefault": 10.0,
            "businessMeaning": "The horizontal clearance along the length of the beam at the top flange connection.",
            "validRange": "0 to 50 mm",
            "unit": "mm",
            "affectsOutput": "Lengthens the cutout slot along the beam axis at the top flange level."
          },
          {
            "name": "dGapBottomVertical",
            "technicalDefault": 10.0,
            "businessMeaning": "The vertical clearance space between the bottom surface of the steel beam's bottom flange and the timber panel.",
            "validRange": "0 to 50 mm",
            "unit": "mm",
            "affectsOutput": "Increases the depth of the cutout pocket below the bottom flange."
          },
          {
            "name": "dGapBottomHorizontal",
            "technicalDefault": 0.0,
            "businessMeaning": "The horizontal clearance along the length of the beam at the bottom flange connection.",
            "validRange": "0 to 50 mm",
            "unit": "mm",
            "affectsOutput": "Lengthens the cutout slot along the beam axis at the bottom flange level."
          },
          {
            "name": "dGapMainVertical",
            "technicalDefault": 10.0,
            "businessMeaning": "The clearance space associated with the main body (web) of the steel beam profile.",
            "validRange": "0 to 50 mm",
            "unit": "mm",
            "affectsOutput": "Adjusts the width or offset of the cutout around the beam's web."
          },
          {
            "name": "dGapFacet",
            "technicalDefault": 15.0,
            "businessMeaning": "The distance defining the size of the 45-degree chamfer (facet) at the corners of the cutout where the panel meets the beam.",
            "validRange": "0 to 100 mm",
            "unit": "mm",
            "affectsOutput": "Creates or enlarges beveled edges at the intersection of vertical and horizontal cuts."
          },
          {
            "name": "dGapBeam",
            "technicalDefault": 10.0,
            "businessMeaning": "The longitudinal clearance added to the start and end of the entire beam cutout (along the beam's axis).",
            "validRange": "0 to 100 mm",
            "unit": "mm",
            "affectsOutput": "Extends the total length of the pocket so the beam does not fit tight against the ends of the panel slot."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Modification of Beam Profile",
            "effect": "The script recalculates cutout geometry based on the new beam's physical dimensions (flange width, height). The Gap values are added to these physical dimensions.",
            "cascade": [
              "dGapTopVertical",
              "dGapBottomVertical",
              "dGapFacet"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "BeamCut / Pocket",
            "description": "A subtractive volume (pocket) cut into the panel geometry that matches the shape of the steel beam profile plus the defined gaps. Includes chamfered facets.",
            "appliedTo": "Selected Sip/Panel element"
          },
          {
            "type": "Visualization Body",
            "description": "A wireframe or solid representation displayed in the model to show the extent of the connection.",
            "appliedTo": "ModelSpace"
          }
        ]
      },
      "tokens_used": 9882,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launched via command or catalog",
          "2. Check execution state (Insert vs Recalc)",
          "3. On Insert: Check if _kExecuteKey is set (Catalog vs Dialog)",
          "4. [If Dialog] Show Properties Palette for user to input Gap values",
          "5. Prompt user to select entities (Panels and Beam)",
          "6. Validate selection: Ensure at least 1 Beam and 1 Panel (Sip) are selected",
          "7. Separate selected entities into 'Beams' and 'Sips' arrays",
          "8. Loop through each selected Panel (Sip)",
          "9. For each Panel: Create a new TSL instance linked to the first Beam and the current Panel",
          "10. Erase the temporary insertion instance",
          "11. [Instance Execution] Verify specific Beam and Sip links exist",
          "12. Extract Beam geometry (Vectors, Length, Profile) and Panel geometry (Edges, Vectors)",
          "13. Calculate intersection points between Panel and Beam coordinate systems",
          "14. Determine cutout strategy based on profile bounds and alignment (Simple vs Complex cut)",
          "15. Generate Tooling volumes (BeamCut) for Top Flange, Bottom Flange, Web, and Facets based on Gap properties",
          "16. Apply subtractions to the Panel geometry",
          "17. Generate visualization lines at the midpoint of the connection"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Input Method (_kExecuteKey check)",
            "path1": {
              "name": "Catalog Entry",
              "steps": [
                "Load properties from specified catalog entry",
                "Skip Dialog"
              ]
            },
            "path2": {
              "name": "Manual Input",
              "steps": [
                "Execute showDialog()",
                "User inputs Gap values in Properties Palette",
                "User confirms"
              ]
            }
          },
          {
            "condition": "Selection Count Validation",
            "path1": {
              "name": "Valid Selection",
              "steps": [
                "Split entities into Beams and Sips",
                "Proceed to instance creation loop"
              ]
            },
            "path2": {
              "name": "Invalid Selection",
              "steps": [
                "Report error message",
                "Erase current instance",
                "Stop execution"
              ]
            }
          },
          {
            "condition": "Geometry Calculation (ptBounds.length check)",
            "path1": {
              "name": "Complex Bottom Flange (> 1 bounds)",
              "steps": [
                "Calculate intersection with secondary beam wall plane",
                "Create dual BeamCuts for bottom flange",
                "Apply diagonal facets (45 deg)"
              ]
            },
            "path2": {
              "name": "Simple Bottom Flange (<= 1 bounds)",
              "steps": [
                "Calculate standard distance to wall",
                "Create single rectangular BeamCut",
                "Apply standard facet"
              ]
            }
          },
          {
            "condition": "Context Menu Trigger (Recalc)",
            "path1": {
              "name": "Select new profile beam",
              "steps": [
                "Prompt user to pick a new Beam entity",
                "Update internal _Beam[0] reference",
                "Set execution loops to 2",
                "Recalculate geometry based on new beam profile"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Minimum Entity Count",
            "errorMessage": "there are needed at least a beam and a panel",
            "recovery": "User must select at least one Beam and one Sip/Panel and restart script"
          },
          {
            "check": "Entity Types",
            "errorMessage": "At least a beam and a panel are needed",
            "recovery": "Ensure selection contains valid Beam and Sip objects"
          },
          {
            "check": "Runtime Instance Integrity",
            "errorMessage": "no panel in selection / no beam in selection",
            "recovery": "Script erases itself if linked entities are deleted or invalid"
          },
          {
            "check": "Geometric Intersection (iHasInter1)",
            "errorMessage": "unexpected error...",
            "recovery": "Script erases instance; implies geometric impossibility of cut"
          },
          {
            "check": "Alignment (vec.dotProduct check)",
            "errorMessage": "unexpected error...",
            "recovery": "Script erases instance; implies beam alignment is outside expected parameters"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Profile Beam",
            "how": "Right-click context menu > 'Select new profile beam'",
            "effect": "Prompts for new beam selection, updates the connection geometry to match the new beam's profile dimensions."
          },
          {
            "action": "Adjust Gap Values",
            "how": "Select TSL > Object Properties Palette (OPM)",
            "effect": "Updates the clearance dimensions (Top/Bottom/Vertical/Horizontal/Facet) and immediately regenerates the cutout in the panel."
          },
          {
            "action": "Update via Beam Modification",
            "how": "Stretch/Move the referenced Beam in CAD",
            "effect": "The TSL, having a dependency set on the beam, recalculates and moves the cutout to follow the beam."
          }
        ]
      },
      "tokens_used": 10345,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-ProfileConnection.mcr\n\n## Overview\nThis script automatically creates a profile pocket (cutout) in a CLT or SIP panel to fit over a steel beam connection. It calculates the necessary cutout geometry based on the beam's profile dimensions and applies user-defined clearance gaps to the top flange, web, and bottom flange.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D model entities. |\n| Paper Space | No | Not designed for 2D layout or detailing views. |\n| Shop Drawing | No | Does not generate shop drawings directly. |\n\n## Prerequisites\n- **Required Entities**: At least one Beam (typically a steel profile) and one Panel (Sip/CLT element).\n- **Minimum Beam Count**: 1.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCLT-ProfileConnection.mcr`\n\n### Step 2: Select Elements\n```\nCommand Line: Select panel and beam\nAction: Select the CLT/SIP panel(s) and the connecting steel beam. \nNote: You can select multiple panels to connect to a single beam simultaneously.\n```\n\n### Step 3: Configure Properties\nAfter selection, the script inserts and the **Properties Palette** will appear. Adjust the gap values as needed for your specific connection details (e.g., insulation thickness, tolerance).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Top Vertical** | Number | 10.0 mm | Vertical clearance between the top flange of the beam and the panel. |\n| **Top Horizontal** | Number | 10.0 mm | Horizontal clearance along the beam length at the top flange level. |\n| **Bottom Vertical** | Number | 10.0 mm | Vertical clearance between the bottom flange of the beam and the panel. |\n| **Bottom Horizontal** | Number | 0.0 mm | Horizontal clearance along the beam length at the bottom flange level. |\n| **Main Vertical** | Number | 10.0 mm | Clearance around the main body (web) of the steel beam profile. |\n| **Facet** | Number | 15.0 mm | Size of the 45-degree chamfer (bevel) at the corners of the cutout. |\n| **Beam** | Number | 10.0 mm | Longitudinal clearance added to the start and end of the beam cutout. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Select new profile beam** | Allows you to select a different beam to update the connection without deleting and re-running the script. |\n\n## Settings Files\n- No external settings files are required for this script.\n\n## Tips\n- **Multiple Panels**: You can select several panels at once during insertion. The script will create a separate instance for each panel linked to the selected beam.\n- **Visualization**: The script displays a symbol at the midpoint of the connection edge to indicate where the connection is applied.\n- **Update Automatically**: If you move or stretch the connected beam, the cutout in the panel will automatically update to match the new position.\n\n## FAQ\n- **Q: Why is there a chamfer (facet) in the cutout?**\n  A: The facet prevents sharp 90-degree internal corners in the wood, which are weak points, and helps the panel slide over the steel beam flanges during installation.\n- **Q: Can I use this on timber beams?**\n  A: This script is designed for profile connections (typically steel) interacting with CLT/SIP panels. While it may work on timber beams, the \"profile\" logic is best suited for steel sections like I-beams or U-channels.\n- **Q: The script erased itself after selection. What happened?**\n  A: Ensure you selected at least one valid Panel and one valid Beam. If the selection contains only beams or only panels, the script will cancel and erase itself."
      },
      "tokens_used": 6257,
      "error": null
    }
  }
}