{
  "filename": "hsbCLT-Slot.mcr",
  "status": "completed",
  "total_tokens": 50034,
  "processing_time": 247.22948122024536,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9334,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script interacts with Sip (Solid Inner Part/Panel) entities using 3D geometric operations (Point3d, Vector3d, Body, Slot). It lacks 'sd_' or 'Multipage*' prefixes, does not use _Viewport, and does not use ShopDrawing-specific patterns like '#Type E'. It inserts geometry into the 3D model."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip (Panel)"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5681,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getSip",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Start Point|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrPoint.goJig",
              "promptOriginal": "|Select end point [Start/Mid/End/Left/Center/Right/FlipSide]|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 4,
              "function": "PrEntity",
              "promptOriginal": "|Select panels|",
              "condition": "_bOnRecalc && _kExecuteKey==|Add Panels|",
              "required": false
            },
            {
              "step": 5,
              "function": "PrEntity",
              "promptOriginal": "|Select panels|",
              "condition": "_bOnRecalc && _kExecuteKey==|Remove Panels|",
              "required": false
            }
          ],
          "keywordOptions": [
            {
              "prompt": "|Select end point [Start/Mid/End/Left/Center/Right/FlipSide]|",
              "options": [
                "Start",
                "Mid",
                "End",
                "Left",
                "Center",
                "Right",
                "FlipSide"
              ]
            }
          ]
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "_bOnInsert",
            "title": "Standard Properties Dialog",
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "Catalog Browser",
            "trigger": "_bOnInsert (via _kExecuteKey)",
            "title": "Catalog Entry",
            "dataSource": "TslInst().getListOfCatalogNames(scriptName())",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dLength",
            "type": "PropDouble",
            "displayName": "|Length|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the length of the slot.|"
          },
          {
            "index": 1,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": 8,
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the Width|"
          },
          {
            "index": 2,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "|Depth|",
            "defaultValue": 100,
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the Depth|"
          },
          {
            "index": 0,
            "variable": "sAlignment",
            "type": "PropString",
            "displayName": "|Alignment|",
            "defaultValue": "|Center|",
            "inputType": "dropdown",
            "options": [
              "|Left|",
              "|Center|",
              "|Right|"
            ],
            "category": "|Alignment|",
            "description": "|Defines the Alignment|"
          },
          {
            "index": 1,
            "variable": "sFace",
            "type": "PropString",
            "displayName": "|Face|",
            "defaultValue": "|Reference Side|",
            "inputType": "dropdown",
            "options": [
              "|Reference Side|",
              "|Opposite Side|"
            ],
            "category": "|Alignment|",
            "description": "|Defines the Face|"
          },
          {
            "index": 3,
            "variable": "dAngle",
            "type": "PropDouble",
            "displayName": "|Angle|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|Alignment|",
            "description": "|Defines the angle of the slot to the normal of the face|, |must be in range of -90 > Value < 90|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Flip Side|",
            "handler": "|Flip Side|",
            "action": "Switches the Face property between Reference Side and Opposite Side.",
            "alsoTriggeredBy": "TslDoubleClick"
          },
          {
            "menuItem": "|Add Panels|",
            "handler": "|Add Panels|",
            "action": "Prompts the user to select additional panels to include in the slot operation.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Remove Panels|",
            "handler": "|Remove Panels|",
            "action": "Prompts the user to select panels to remove from the slot operation.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8293,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a parametric slot (rectangular cutout) on the face of a CLT or timber panel, typically used for receiving beams or connecting hardware.",
          "category": "Machining/CNC",
          "typicalUseCase": "Creating a precise pocket in a CLT panel to seat a timber beam, steel plate, or another panel section."
        },
        "parameters": [
          {
            "name": "dLength",
            "technicalDefault": 0,
            "businessMeaning": "The longitudinal dimension of the slot along the panel surface. If set to 0, the length is dynamically determined by the start and end points clicked by the user.",
            "validRange": "0 to Panel Length (0 = Dynamic)",
            "unit": "mm",
            "affectsOutput": "Determines how long the cutout is along the defined axis."
          },
          {
            "name": "dWidth",
            "technicalDefault": 8,
            "businessMeaning": "The lateral dimension of the slot, perpendicular to its length. This typically corresponds to the width of the element being inserted into the slot.",
            "validRange": "1mm to Panel Width",
            "unit": "mm",
            "affectsOutput": "Determines the width of the cutout across the panel face."
          },
          {
            "name": "dDepth",
            "technicalDefault": 100,
            "businessMeaning": "The distance the slot cuts into the panel from the selected face. For a through-slot, this must match or exceed the panel thickness.",
            "validRange": "1mm to Panel Thickness",
            "unit": "mm",
            "affectsOutput": "Determines the depth of penetration into the material."
          },
          {
            "name": "sAlignment",
            "technicalDefault": "|Center|",
            "businessMeaning": "Defines the lateral positioning of the slot relative to the vector created by the start and end points.",
            "validRange": "|Left|, |Center|, |Right|",
            "unit": "enum",
            "affectsOutput": "Offsets the slot to the left, center, or right of the picked axis line."
          },
          {
            "name": "sFace",
            "technicalDefault": "|Reference Side|",
            "businessMeaning": "Specifies which side of the panel the slot originates from.",
            "validRange": "|Reference Side|, |Opposite Side|",
            "unit": "enum",
            "affectsOutput": "Flips the slot normal to the opposite face of the panel."
          },
          {
            "name": "dAngle",
            "technicalDefault": 0,
            "businessMeaning": "Rotates the slot around its longitudinal axis. This allows for angled slots (e.g., for tapered connections or drainage).",
            "validRange": "-90 to 90",
            "unit": "degrees",
            "affectsOutput": "Angled the cut relative to the perpendicular of the face."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User moves grip points (_PtG) defining start/end",
            "effect": "Recalculates the dLength property based on the new distance between points.",
            "cascade": [
              "dLength"
            ]
          },
          {
            "trigger": "User changes dLength property value",
            "effect": "Moves the grip points symmetrically around the center to match the new length.",
            "cascade": [
              "_PtG[0]",
              "_PtG[1]"
            ]
          },
          {
            "trigger": "Context menu 'Flip Side' or Double Click",
            "effect": "Toggles the sFace property between Reference Side and Opposite Side.",
            "cascade": [
              "sFace"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Slot",
            "description": "A prismatic void cut into the solid panel geometry.",
            "appliedTo": "Selected Panels (Sip entities)"
          }
        ]
      },
      "tokens_used": 9524,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script (hsbCLT-Slot)",
          "2. Display Properties Dialog (or load from Catalog if command key is present)",
          "3. User adjusts initial properties (Length, Width, Depth, Alignment, Face, Angle) and clicks OK",
          "4. Prompt user to select a Panel (Sip)",
          "5. Prompt user to select Start Point",
          "6. Start Dynamic Jig (Preview) for End Point selection",
          "7. [Loop] User moves cursor to adjust visual preview",
          "8. [Branch] User selects End Point OR enters a Keyword (Start/Mid/End/Left/Center/Right/FlipSide)",
          "9. Calculate final geometry and Slot position based on points and properties",
          "10. Generate Slot body and subtract from Panel",
          "11. Finish Insertion"
        ],
        "conditionalBranches": [
          {
            "condition": "Script Initialization Source",
            "path1": {
              "name": "Catalog Entry",
              "steps": [
                "Check if _kExecuteKey exists in catalog list",
                "Load properties from specific catalog entry"
              ]
            },
            "path2": {
              "name": "Manual Input",
              "steps": [
                "Open standard Properties Dialog",
                "User manually inputs dimensions and settings",
                "Click OK"
              ]
            }
          },
          {
            "condition": "Length Input Method (dLength property)",
            "path1": {
              "name": "Dynamic Length (0)",
              "steps": [
                "Length is determined by the distance between Start and End points clicked in model",
                "dLength property is updated to match this distance"
              ]
            },
            "path2": {
              "name": "Fixed Length (> 0)",
              "steps": [
                "Length is fixed to the property value",
                "Grip points are adjusted symmetrically around the center or aligned to Start/End based on Alignment X setting"
              ]
            }
          },
          {
            "condition": "Jig Keyword Input (Alignment)",
            "path1": {
              "name": "X-Alignment (Start/Mid/End)",
              "steps": [
                "User selects keyword 'Start', 'Mid', or 'End'",
                "Script updates nAlignmentX variable",
                "Visual preview updates the anchor point of the slot relative to the clicked points"
              ]
            },
            "path2": {
              "name": "Y-Alignment (Left/Center/Right)",
              "steps": [
                "User selects keyword 'Left', 'Center', or 'Right'",
                "Script updates nAlignmentY variable",
                "Visual preview shifts the slot laterally relative to the vector"
              ]
            },
            "path3": {
              "name": "Flip Side",
              "steps": [
                "User selects keyword 'FlipSide'",
                "Script toggles nAlignmentZ (Face direction)",
                "Visual preview flips to the opposite side of the panel"
              ]
            }
          },
          {
            "condition": "Post-Insertion Panel Management",
            "path1": {
              "name": "Add Panels",
              "steps": [
                "Execute context menu 'Add Panels'",
                "Prompt user to select additional Sip entities",
                "Check if new panels intersect the slot cutting body",
                "Add valid panels to _Sip collection"
              ]
            },
            "path2": {
              "name": "Remove Panels",
              "steps": [
                "Execute context menu 'Remove Panels'",
                "Prompt user to select Sip entities",
                "Remove selected panels from _Sip collection (if present)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Panel Selection",
            "errorMessage": "Invalid reference. Tool will be deleted.",
            "recovery": "Script auto-deletes the instance. User must restart and select a valid Panel."
          },
          {
            "check": "Slot Dimensions (dLength, dWidth, dDepth)",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script calls eraseInstance() if any dimension is less than or equal to epsilon (dEps)."
          },
          {
            "check": "Alignment Property String",
            "errorMessage": "None (Auto-correction)",
            "recovery": "If the sAlignment string is not found in the valid list, it resets to '|Center|' and sets execution loops to 2."
          },
          {
            "check": "Grip Point Modification",
            "errorMessage": "None",
            "recovery": "Dragging Start/End points automatically recalculates the Length property. Changing Length property automatically moves Start/End points."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Flip Side",
            "how": "Context Menu ('|Flip Side|') or Double Click",
            "effect": "Toggles the 'Face' property between '|Reference Side|' and '|Opposite Side|', moving the slot to the other side of the panel."
          },
          {
            "action": "Modify Geometry",
            "how": "OPM Properties Palette",
            "effect": "Changing Length, Width, Depth, Angle, or Alignment updates the slot geometry immediately."
          },
          {
            "action": "Adjust Position/Length",
            "how": "Grip Points (Start/End)",
            "effect": "Dragging grips updates the slot position. If length was 0 (dynamic), the length property updates. If length was fixed, the center point moves."
          },
          {
            "action": "Add/Remove Panels",
            "how": "Context Menu ('|Add Panels|', '|Remove Panels|')",
            "effect": "Extends or restricts the slot operation to multiple selected panels."
          }
        ]
      },
      "tokens_used": 10845,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-Slot.mcr\n\n## Overview\nThis script creates a parametric slot (rectangular cutout) on the face of a CLT or timber panel. It is designed to create precise pockets for seating beams, steel plates, or other connecting elements.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates in 3D model space to cut panel geometry. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | Does not generate 2D drawing views directly. |\n\n## Prerequisites\n- **Required Entities**: A Solid Inner Part or Panel (Sip entity).\n- **Minimum Panels**: 1\n- **Required Settings**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCLT-Slot.mcr`\n\n### Step 2: Configure Properties\n```\nCommand Line: [Dialog or Catalog Opens]\nAction: A properties dialog appears. You can either load a preset from the catalog or manually set the initial dimensions (Width, Depth, Alignment). Click OK to proceed.\n```\n\n### Step 3: Select Panel\n```\nCommand Line: Select panels:\nAction: Click on the CLT or timber panel where you want the slot to be cut.\n```\n\n### Step 4: Select Start Point\n```\nCommand Line: Start Point:\nAction: Click a point on the face of the panel to define the start of the slot.\n```\n\n### Step 5: Define End Point and Orientation\n```\nCommand Line: Select end point [Start/Mid/End/Left/Center/Right/FlipSide]:\nAction: Move your cursor to preview the slot. Click to set the end point. \nNote: You can type keywords at the command line before clicking to adjust alignment:\n- Start/Mid/End: Adjusts longitudinal anchor.\n- Left/Center/Right: Adjusts lateral alignment.\n- FlipSide: Switches the cut to the opposite face.\n```\n\n### Step 6: Finish\nThe slot is calculated and subtracted from the panel geometry.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Length | Number | 0 | Defines the length of the slot. Set to 0 to define length dynamically by clicking start/end points. |\n| Width | Number | 8 | Defines the width of the slot (perpendicular to the length). |\n| Depth | Number | 100 | Defines how deep the slot cuts into the panel. Set >= Panel Thickness for a through-cut. |\n| Alignment | Dropdown | Center | Sets the lateral position of the slot relative to the axis line (Left, Center, Right). |\n| Face | Dropdown | Reference Side | Determines which side of the panel the cut starts from (Reference Side or Opposite Side). |\n| Angle | Number | 0 | Rotates the slot relative to the normal of the face (-90 to 90 degrees). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip Side | Switches the slot to the opposite face of the panel (Toggles the \"Face\" property). |\n| Add Panels | Allows you to select additional panels to apply the same slot cut to. |\n| Remove Panels | Removes selected panels from the slot operation. |\n\n## Settings Files\n- **Filename**: None specific\n- **Location**: N/A\n- **Purpose**: Standard script properties are used; no external settings file is required.\n\n## Tips\n- **Dynamic Length**: Leave the `Length` property as 0 during insertion to let the distance between your clicked points determine the size automatically.\n- **Quick Flip**: Double-click the script instance in the model to quickly flip the slot to the opposite side.\n- **Grip Points**: After insertion, use the blue grip points to drag the start or end of the slot. The `Length` property will update automatically.\n- **Through Cuts**: To ensure the slot goes all the way through, check your panel thickness in the Properties palette and set the `Depth` slightly higher than that value.\n\n## FAQ\n- Q: Why did the tool disappear after I selected a panel?\n  A: The script requires a valid Panel (Sip entity). If you selected a line or a different element type, or if the dimensions were set too small (epsilon), the script will delete itself automatically.\n- Q: Can I cut a slot at an angle?\n  A: Yes. Use the `Angle` property in the palette to rotate the slot, or use the visual rotation options during the insertion jig.\n- Q: How do I cut the same slot in multiple stacked panels?\n  A: Insert the slot on the first panel. Then, right-click the script instance and select \"Add Panels\" to select the other panels in the stack."
      },
      "tokens_used": 6357,
      "error": null
    }
  }
}