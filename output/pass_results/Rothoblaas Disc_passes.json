{
  "filename": "Rothoblaas Disc.mcr",
  "status": "completed",
  "total_tokens": 51105,
  "processing_time": 377.0534176826477,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.4",
            "date": "29.02.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-21528 thickness dic corrected"
          },
          {
            "version": "1.3",
            "date": "08aug17",
            "author": "florian.wuermseer@hsbcad.com",
            "changes": "assignment changed to Z layer (to make the TSL visible when plotting)"
          },
          {
            "version": "1.0",
            "date": "28jan16",
            "author": "florian.wuermseer@hsbcad.com",
            "changes": "initial version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8576,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _Beam0 and _Beam1 references typical of Model Space connections. The _bOnInsert block explicitly creates instances using 'tslNew.dbCreate(..., _kModelSpace, ...);'. No 'sd_' prefixes, no '#Type E' declarations, and no '_Viewport' usage found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 5901,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select male beam(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select female beam(s)|",
              "condition": "_bOnInsert",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnInsert (if not using catalog)",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sArticle",
            "type": "PropString",
            "displayName": "A - |Article|",
            "defaultValue": "DISC55",
            "inputType": "dropdown",
            "options": [
              "DISC55",
              "DISC80",
              "DISC120"
            ],
            "category": "|Category|",
            "description": "|Defines the type of the connector|"
          },
          {
            "index": 1,
            "variable": "dMillDepth",
            "type": "PropDouble",
            "displayName": "B - |Additional mill depth|",
            "defaultValue": "0.0",
            "inputType": "number",
            "options": [],
            "category": "|Tooling male beam|",
            "description": "|Defines the additional milling depth. (mm)|\n|Negative values| --> |Main plate will be milled into female beam|"
          },
          {
            "index": 2,
            "variable": "dTopDrillDiaOversize",
            "type": "PropDouble",
            "displayName": "C - |Oversize mill|",
            "defaultValue": "1.0",
            "inputType": "number",
            "options": [],
            "category": "|Tooling male beam|",
            "description": "|Defines the extra diameter of the milling. (mm)|"
          },
          {
            "index": 3,
            "variable": "dYOff",
            "type": "PropDouble",
            "displayName": "D - |Offset Lateral|",
            "defaultValue": "0.0",
            "inputType": "number",
            "options": [],
            "category": "|Tooling male beam|",
            "description": "|Defines the lateral offset of the connector. (mm)|"
          },
          {
            "index": 4,
            "variable": "dZOff",
            "type": "PropDouble",
            "displayName": "E - |Offset Vertical|",
            "defaultValue": "0.0",
            "inputType": "number",
            "options": [],
            "category": "|Tooling male beam|",
            "description": "|Defines the vertical offset of the connector. (mm)|"
          },
          {
            "index": 5,
            "variable": "sFemaleTool",
            "type": "PropString",
            "displayName": "F - |Tools in female beam|",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Tooling female beam|",
            "description": "|Insert tools and hardware in female beam?|"
          },
          {
            "index": 6,
            "variable": "dExitDepth",
            "type": "PropDouble",
            "displayName": "G - |Extra depth sink hole|",
            "defaultValue": "0.0",
            "inputType": "number",
            "options": [],
            "category": "|Tooling female beam|",
            "description": "|Defines the extra depth of the sink hole. (mm)|"
          },
          {
            "index": 7,
            "variable": "dExitDiaOversize",
            "type": "PropDouble",
            "displayName": "H  - |Oversize sink hole|",
            "defaultValue": "4.0",
            "inputType": "number",
            "options": [],
            "category": "|Tooling female beam|",
            "description": "|Defines the extra diameter of the sink hole. (mm)|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8199,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a concealed timber-to-timber connection using Rothoblaas DISC hardware, including tooling for the top plate, pipe, and countersunk bolt, as well as the hardware components themselves.",
          "category": "Hardware / Connection",
          "typicalUseCase": "Connecting perpendicular or intersecting timber beams (e.g., post to beam, purlin to rafter) where a flush surface or high shear capacity is required using the Rothoblaas DISC system."
        },
        "parameters": [
          {
            "name": "sArticle",
            "technicalDefault": "DISC55",
            "businessMeaning": "Selects the specific model of the Rothoblaas DISC connector, which determines its physical dimensions (diameter, thickness) and load capacity.",
            "validRange": "DISC55, DISC80, DISC120 (Dropdown)",
            "unit": "Enum",
            "affectsOutput": "Changes the diameter of the plate/pipe, drill depths, screw sizes, and quantity of fixings. Updates all related hardware geometry."
          },
          {
            "name": "dMillDepth",
            "technicalDefault": "0.0",
            "businessMeaning": "Controls the vertical depth of the connector plate relative to the male beam's surface. Allows sinking the plate into the beam for a flush finish or protruding it.",
            "validRange": "-15 to 15 (approximate, constrained by plate thickness)",
            "unit": "mm",
            "affectsOutput": "Offsets the tooling depth in the male beam and the vertical position of the visual connector body. Negative values push the plate into the female beam."
          },
          {
            "name": "dTopDrillDiaOversize",
            "technicalDefault": "1.0",
            "businessMeaning": "Defines the clearance (tolerance) added to the diameter of the main hole drilled into the male beam.",
            "validRange": "0.0 to 5.0",
            "unit": "mm",
            "affectsOutput": "Increases the diameter of the cylinder/drill hole in the male beam to ensure easy insertion of the connector."
          },
          {
            "name": "dYOff",
            "technicalDefault": "0.0",
            "businessMeaning": "Moves the connector laterally (sideways) from the automatic intersection point of the beams.",
            "validRange": "-500 to 500 (Beam width dependent)",
            "unit": "mm",
            "affectsOutput": "Translates the position of all tooling and hardware along the Y-axis of the coordinate system."
          },
          {
            "name": "dZOff",
            "technicalDefault": "0.0",
            "businessMeaning": "Moves the connector vertically from the automatic intersection point of the beams.",
            "validRange": "-500 to 500 (Beam height dependent)",
            "unit": "mm",
            "affectsOutput": "Translates the position of all tooling and hardware along the Z-axis of the coordinate system."
          },
          {
            "name": "sFemaleTool",
            "technicalDefault": "Yes",
            "businessMeaning": "Determines if the opposing (female) beam should be machined for the connecting bolt and washer.",
            "validRange": "No, Yes",
            "unit": "Bool/String",
            "affectsOutput": "Toggles the creation of the drill hole for the threaded bolt and the countersink hole for the washer in the female beam. Also toggles the generation of the bolt/washer hardware."
          },
          {
            "name": "dExitDepth",
            "technicalDefault": "0.0",
            "businessMeaning": "Adjusts the depth of the countersink (sink hole) for the washer on the female beam side.",
            "validRange": "0.0 to 20.0",
            "unit": "mm",
            "affectsOutput": "Deepens or shallows the cylindrical void in the female beam intended to hide the washer."
          },
          {
            "name": "dExitDiaOversize",
            "technicalDefault": "4.0",
            "businessMeaning": "Defines the clearance (tolerance) added to the diameter of the washer countersink hole in the female beam.",
            "validRange": "2.0 to 10.0",
            "unit": "mm",
            "affectsOutput": "Increases the diameter of the sink hole in the female beam to accommodate washer tolerances."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sArticle changes",
            "effect": "Resets internal dimension variables (dThreadDia, dTopPlateDia, dPipeLength, etc.) to match the selected catalog item.",
            "cascade": [
              "dMillDepth",
              "dExitDepth",
              "dTopDrillDiaOversize",
              "dExitDiaOversize"
            ]
          },
          {
            "trigger": "sFemaleTool set to 'No'",
            "effect": "Disables tooling and hardware generation for the female beam.",
            "cascade": [
              "dExitDepth",
              "dExitDiaOversize"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Drill",
            "description": "Large clearance hole for the Disc body and pipe.",
            "appliedTo": "Male Beam (_Beam0)"
          },
          {
            "type": "Drill",
            "description": "Through hole for the threaded rod.",
            "appliedTo": "Female Beam (_Beam1)"
          },
          {
            "type": "Drill",
            "description": "Countersink hole for the washer.",
            "appliedTo": "Female Beam (_Beam1)"
          },
          {
            "type": "Hardware",
            "description": "Main Rothoblaas Disc assembly (Plate + Pipe).",
            "appliedTo": "Model Space (associated with Male Beam)"
          },
          {
            "type": "Hardware",
            "description": "Threaded bolt (KOS) and Washer (ULS).",
            "appliedTo": "Model Space (associated with Female Beam)"
          },
          {
            "type": "Hardware",
            "description": "Wood construction screws to fix the Disc to the male beam.",
            "appliedTo": "Model Space (associated with Male Beam)"
          }
        ]
      },
      "tokens_used": 9956,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches script via command or catalog",
          "Script checks for execution key (Catalog vs Manual)",
          "[Branch] Load properties from Catalog OR Show Dynamic Dialog to user",
          "Prompt user to select Male beam(s)",
          "Prompt user to select Female beam(s)",
          "Script iterates through all combinations of Male and Female selections",
          "Check geometric validity (Intersection, Bounds, Parallelism)",
          "Create new TSL instance for each valid pair",
          "Instance calculates coordinates based on intersection points",
          "Validate Mill Depth (Check against plate thickness)",
          "Generate Tooling for Male beam (Cylinder/Drill)",
          "Check Female Tooling configuration",
          "[Branch] Generate Tooling for Female beam (Drill/Sink) OR Skip",
          "Generate Hardware Components (Plate, Screws, Bolts, Washers)",
          "Draw visual representation in Model Space"
        ],
        "conditionalBranches": [
          {
            "condition": "Script Execution Mode",
            "path1": {
              "name": "Catalog Execution",
              "steps": [
                "Detect _kExecuteKey",
                "Match key against available catalogs",
                "Call setPropValuesFromCatalog(sCat)"
              ]
            },
            "path2": {
              "name": "Manual Execution",
              "steps": [
                "Detect no matching catalog key",
                "Call showDialog(sLastEntry)",
                "User inputs properties manually"
              ]
            }
          },
          {
            "condition": "Beam Geometry (During Loop)",
            "path1": {
              "name": "Valid Intersection",
              "steps": [
                "Beams are not parallel",
                "Lines intersect (bHasContact is true)",
                "Intersection point is within Female beam length",
                "Create TSL Instance"
              ]
            },
            "path2": {
              "name": "Invalid Geometry",
              "steps": [
                "Beams are parallel OR No contact OR Outside bounds",
                "Continue to next beam pair (Skip creation)"
              ]
            }
          },
          {
            "condition": "sFemaleTool Property",
            "path1": {
              "name": "Enabled (Yes)",
              "steps": [
                "Calculate thread drill diameter",
                "Add Drill for threaded bolt to Female beam",
                "Add Drill/Countersink for Washer to Female beam",
                "Generate Bolt and Washer Hardware components",
                "Draw Bolt and Washer visuals"
              ]
            },
            "path2": {
              "name": "Disabled (No)",
              "steps": [
                "Skip all tooling on Female beam",
                "Skip Bolt and Washer hardware generation",
                "Skip drawing of Bolt and Washer"
              ]
            }
          },
          {
            "condition": "dMillDepth Property",
            "path1": {
              "name": "Standard Range",
              "steps": [
                "Value is greater than or equal to negative plate thickness",
                "Apply tooling to Male beam",
                "Apply tooling to Female beam (if depth < 0)"
              ]
            },
            "path2": {
              "name": "Out of Range (Too Negative)",
              "steps": [
                "Value detected as < -dTopPlateThick",
                "Report error message to user",
                "Reset dMillDepth to -dTopPlateThick automatically",
                "Proceed with corrected value"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Parallelism",
            "errorMessage": "None (Silent skip)",
            "recovery": "User must select non-parallel beams. Script skips parallel pairs automatically."
          },
          {
            "check": "Intersection Bounds",
            "errorMessage": "None (Silent skip)",
            "recovery": "User must ensure beams physically intersect within their lengths. Script skips non-touching pairs."
          },
          {
            "check": "Mill Depth vs Plate Thickness",
            "errorMessage": "Additional mill depth out of range -> value corrected to [thickness]",
            "recovery": "Script automatically clamps the value to the minimum allowed (negative plate thickness)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Article Type",
            "how": "OPM (Object Properties Palette)",
            "effect": "Updates connector dimensions (Diameter, Pipe Length), Screw quantities, and Drill diameters. Regenerates hardware."
          },
          {
            "action": "Adjust Mill Depth / Offsets",
            "how": "OPM",
            "effect": "Moves the connector position vertically/laterally and updates drill depths in the beams."
          },
          {
            "action": "Toggle Female Tooling",
            "how": "OPM (Dropdown: Yes/No)",
            "effect": "Adds or removes the threaded bolt, washer, and associated drill holes from the female beam."
          },
          {
            "action": "Adjust Oversize Tolerances",
            "how": "OPM",
            "effect": "Increases or decreases the diameter of drill holes for clearance."
          }
        ]
      },
      "tokens_used": 11522,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Rothoblaas Disc.mcr\n\n## Overview\nThis script generates a concealed timber-to-timber connection using Rothoblaas DISC hardware, including the top plate, pipe, and countersunk bolt. It automatically creates the necessary tooling (drills and countersinks) in both the male and female beams based on the selected article size.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used for 3D detailing and connection generation. |\n| Paper Space | No | Not applicable for drawing views. |\n| Shop Drawing | No | Not applicable for 2D layouts. |\n\n## Prerequisites\n- **Required Entities**: At least 2 Timber Beams (`GenBeam`).\n- **Minimum Beam Count**: 2 (One Male, One Female).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT` â†’ Select `Rothoblaas Disc.mcr` from the list.\nAlternatively, double-click the script if it is loaded in a catalog palette.\n\n### Step 2: Select Male Beams\n```\nCommand Line: Select male beam(s)\nAction: Click the beam(s) where the main Disc plate (the side with the pipe) will be mounted. Press Enter to confirm selection.\n```\n\n### Step 3: Select Female Beams\n```\nCommand Line: Select female beam(s)\nAction: Click the intersecting beam(s) where the connecting bolt and washer will be inserted. Press Enter to confirm.\n```\n\n### Step 4: Configuration (If not using a Catalog preset)\n```\nDialog: Rothoblaas Disc Properties\nAction: \n1. Select the Article type (e.g., DISC55) from the dropdown.\n2. Adjust offsets or tooling depths if necessary.\n3. Click OK to generate the connection.\n```\n*Note: If you use an Execution Key from a catalog, this dialog may be skipped.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| A - Article | Dropdown | DISC55 | Selects the model of the Rothoblaas DISC connector. Options: DISC55, DISC80, DISC120. |\n| B - Additional mill depth | Number | 0.0 | Defines how deep the plate sits relative to the surface. Negative values push it further into the beam. |\n| C - Oversize mill | Number | 1.0 | Adds extra diameter (tolerance) to the main hole in the male beam (mm). |\n| D - Offset Lateral | Number | 0.0 | Moves the connector sideways along the beam width (Y-axis) in mm. |\n| E - Offset Vertical | Number | 0.0 | Moves the connector up/down along the beam height (Z-axis) in mm. |\n| F - Tools in female beam | Dropdown | Yes | Toggles tooling and hardware for the female beam. Select \"No\" to only machine the male side. |\n| G - Extra depth sink hole | Number | 0.0 | Increases the depth of the countersink for the washer in the female beam (mm). |\n| H - Oversize sink hole | Number | 4.0 | Adds extra diameter (tolerance) to the washer countersink in the female beam (mm). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific context menu options are added by this script. Use the Properties Palette (OPM) to modify parameters. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on internal dimension tables and does not require external XML settings files.\n\n## Tips\n- **Batch Processing**: You can select multiple Male beams and multiple Female beams in steps 2 and 3. The script will automatically generate connections for every valid intersection found.\n- **Intersection Check**: The beams must physically intersect. If the connector does not appear, check if the beams are actually touching in the 3D model.\n- **Depth Safety**: If you set the \"Additional mill depth\" too negative (trying to recess the plate deeper than its thickness), the script will automatically correct the value to prevent geometry errors.\n\n## FAQ\n- **Q: Why didn't the connector appear on my selected beams?**\n- **A**: The script silently skips beam pairs that are parallel or do not intersect within their length. Ensure your beams cross each other.\n  \n- **Q: Can I use this to connect a beam to a column?**\n- **A**: Yes, as long as the entities are standard `GenBeam` elements and they intersect, the angle does not matter.\n\n- **Q: How do I stop the script from drilling the female side?**\n- **A**: Select the instance in the model, open the Properties palette (Ctrl+1), and change \"F - Tools in female beam\" to \"No\"."
      },
      "tokens_used": 6951,
      "error": null
    }
  }
}