{
  "filename": "hsbTraufschalung.mcr",
  "status": "completed",
  "total_tokens": 51805,
  "processing_time": 283.3254909515381,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.3",
            "date": "20.02.2013",
            "author": "th@hsbCAD.de",
            "changes": "bugfix distribution"
          },
          {
            "version": "1.2",
            "date": "14.01.2010",
            "author": "th@hsbCAD.de",
            "changes": ""
          },
          {
            "version": "1.1",
            "date": "09.08.2009",
            "author": "th@hsbCAD.de",
            "changes": "english terminology corrected supports now offset location if rafters have a plump cut any overlapping of the beams regarding the roofplane outline will be trimmed to fit"
          },
          {
            "version": "1.0",
            "date": "07.08.2009",
            "author": "th@hsbCAD.de",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "mapIO_LayerAssignment"
        ]
      },
      "tokens_used": 7541,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _kModelSpace for tsl.dbCreate and Beam creation. No usage of _Viewport, sd_*, or Multipage* prefixes. No #Type E tag. Contains logic specifically for 3D geometry (ERoofPlane, Beam, Body, PlaneProfile)."
        },
        "prerequisites": {
          "requiredEntities": [
            "ERoofPlane",
            "EntPLine (optional, for closed polyline selection)",
            "GenBeam (optional, for intersection/stretching logic)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "mapIO_LayerAssignment"
          ]
        }
      },
      "tokens_used": 5895,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select Roofplane|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select pline(s)|",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "|Point near end of distribution|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sExtrusionProfile",
            "type": "PropString",
            "displayName": "Extrusion profile",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dVisWidth",
            "type": "PropDouble",
            "displayName": "visible Width",
            "defaultValue": "121",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Determines the visible width of an extrusion profile or the width of rectangular shapes. Changing this property will regenerate all Exposed Rafter Eaves."
          },
          {
            "index": 1,
            "variable": "dHeight",
            "type": "PropDouble",
            "displayName": "Height",
            "defaultValue": "21",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dAdditionalWidth",
            "type": "PropDouble",
            "displayName": "Additional Width",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sMat",
            "type": "PropString",
            "displayName": "Material",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sGrade",
            "type": "PropString",
            "displayName": "Grade",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sName",
            "type": "PropString",
            "displayName": "Name",
            "defaultValue": "Exposed Rafter Eaves",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sLabel",
            "type": "PropString",
            "displayName": "Label",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sSublabel",
            "type": "PropString",
            "displayName": "Sublabel",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "65",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sLayerGroup",
            "type": "PropString",
            "displayName": "Group, Layername or Zone Character",
            "defaultValue": "Exposed Rafter Eaves",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Valid entries are existing group names (i.e. House\\Roof\\Rafter), Layernames or zone characters."
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Generate Beams",
            "handler": "|Generate Beams|",
            "action": "Deletes all existing Exposed Rafter Eaves and creates a new distribution.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Delete Beams",
            "handler": "|Delete Beams|",
            "action": "Deletes all existing Exposed Rafter Eaves.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Toggle Direct Editing",
            "handler": "|Toggle Direct Editing|",
            "action": "Toggles direct editing of grips.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8578,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a distribution of decorative eaves boards (Exposed Rafter Eaves/Soffit boards) along a roof slope, handling profile or rectangular geometries and complex cuts at hips, valleys, and roof boundaries.",
          "category": "Framing/Finishing",
          "typicalUseCase": "Generating the visual row of boards attached to the bottom of rafters or the roof structure at the eaves, often used for architectural detailing."
        },
        "parameters": [
          {
            "name": "sExtrusionProfile",
            "technicalDefault": "",
            "businessMeaning": "The cross-sectional shape profile of the board (e.g., ogee, cove). If blank, the tool uses a simple rectangular cross-section defined by Width and Height.",
            "validRange": "Any valid profile name in the catalog",
            "unit": "string",
            "affectsOutput": "Cross-sectional geometry. If selected, the dVisWidth and dHeight properties may effectively define the bounding box rather than the exact shape."
          },
          {
            "name": "dVisWidth",
            "technicalDefault": "121",
            "businessMeaning": "The visible width of the board facing outwards/downwards (perpendicular to the rafter run), determining the spacing between rows.",
            "validRange": "50 to 300",
            "unit": "mm",
            "affectsOutput": "Regenerates the distribution of boards. Determines the step-over distance for the row of boards."
          },
          {
            "name": "dHeight",
            "technicalDefault": "21",
            "businessMeaning": "The thickness of the board (the dimension extending up into the roof structure or away from the visible face).",
            "validRange": "12 to 100",
            "unit": "mm",
            "affectsOutput": "Extrusion depth of the board. Affects the physical size of the timber element."
          },
          {
            "name": "dAdditionalWidth",
            "technicalDefault": "0",
            "businessMeaning": "An extra width added to the board, typically used for overlapping details or extension calculations.",
            "validRange": "0 to 50",
            "unit": "mm",
            "affectsOutput": "Adjusts the geometric width of the board during creation."
          },
          {
            "name": "sMat",
            "technicalDefault": "",
            "businessMeaning": "The timber material code (e.g., C24, GL24).",
            "validRange": "Any valid material string",
            "unit": "string",
            "affectsOutput": "Assigns material properties to the generated beams for reports and machining."
          },
          {
            "name": "sGrade",
            "technicalDefault": "",
            "businessMeaning": "The timber strength grade.",
            "validRange": "Any valid grade string",
            "unit": "string",
            "affectsOutput": "Assigns grade properties to the generated beams."
          },
          {
            "name": "sName",
            "technicalDefault": "Exposed Rafter Eaves",
            "businessMeaning": "The identifying name of the element used in lists and BIM data.",
            "validRange": "Text string",
            "unit": "string",
            "affectsOutput": "Nomenclature in output."
          },
          {
            "name": "sLabel",
            "technicalDefault": "",
            "businessMeaning": "A short code for the element, used for marking/labeling.",
            "validRange": "Text string",
            "unit": "string",
            "affectsOutput": "Label tags in drawings."
          },
          {
            "name": "sSublabel",
            "technicalDefault": "",
            "businessMeaning": "An additional classification label.",
            "validRange": "Text string",
            "unit": "string",
            "affectsOutput": "Sub-classification data."
          },
          {
            "name": "nColor",
            "technicalDefault": "65",
            "businessMeaning": "The CAD display color (AutoCAD Color Index).",
            "validRange": "0 to 255",
            "unit": "index",
            "affectsOutput": "Visual appearance in the model."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "The specific dimension style to use for this element.",
            "validRange": "Existing DimStyle name",
            "unit": "string",
            "affectsOutput": "Dimension formatting in drawings."
          },
          {
            "name": "sLayerGroup",
            "technicalDefault": "Exposed Rafter Eaves",
            "businessMeaning": "Controls Layer management via Group name, specific Layer name, or Zone Character (C, I, J, T, Z).",
            "validRange": "Valid Group path or Zone Character",
            "unit": "string",
            "affectsOutput": "Layer assignment of the generated beams."
          },
          {
            "name": "_Pt0",
            "technicalDefault": "User Selection",
            "businessMeaning": "The reference point on the roof defining the end of the distribution area (near the fascia/gable).",
            "validRange": "Point on Roof Plane",
            "unit": "coordinates",
            "affectsOutput": "Defines the boundary where the row of boards stops or starts."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sExtrusionProfile is set to a valid profile",
            "effect": "The geometric generation switches from using dVisWidth/dHeight as direct dimensions to using the profile's bounding box, though dVisWidth is still used for distribution spacing calculations.",
            "cascade": [
              "dVisWidth",
              "dHeight",
              "Beam Geometry"
            ]
          },
          {
            "trigger": "Change in dVisWidth, dHeight, sExtrusionProfile, or _Pt0",
            "effect": "Forces the script to run 'Generate Beams' logic (regen), deleting old beams and creating new ones.",
            "cascade": [
              "All Generated Beams"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam",
            "description": "The individual eaves boards, created as solid beams or extrusions.",
            "appliedTo": "Model Space"
          },
          {
            "type": "Cut",
            "description": "Angled cuts where boards intersect Hip rafters.",
            "appliedTo": "Generated Beams"
          },
          {
            "type": "Cut",
            "description": "Angled cuts where boards intersect Valley rafters.",
            "appliedTo": "Generated Beams"
          },
          {
            "type": "Cut",
            "description": "Trimming cuts where boards overlap the roof plane envelope boundary.",
            "appliedTo": "Generated Beams"
          }
        ]
      },
      "tokens_used": 9967,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch (Insert) - Check insertCycleCount to prevent recursion.",
          "2. Show Initial Dialog (optional properties).",
          "3. Prompt User: Select Roofplane(s).",
          "4. Validation: Check if Roofplane count >= 1. If not, erase instance.",
          "5. Prompt User: Select Pline(s) (Optional).",
          "6. [Conditional Branch] Determine distribution end geometry (Pline vs Point).",
          "7. If Pline selected: Calculate profile intersection and spawn sub-instances for each roofplane.",
          "8. If No Pline: Prompt for Point near end of distribution (_Pt0).",
          "9. Finalize Insertion.",
          "10. Recalculation Loop (Triggered by property change, context menu, or database load).",
          "11. Validate Roofplane Entity and Geometry validity.",
          "12. Determine Regeneration Strategy (Delete Only vs. Generate/Regen).",
          "13. Analyze Context: Detect Rafters or rely on Roof Plane Envelope.",
          "14. Geometry Calculation: Construct PlaneProfile for the distribution area.",
          "15. Loop: Calculate board positions stepping along the roof slope (using dVisWidth).",
          "16. Geometry Intersection: Check if board position intersects valid Rafter/Beam geometry.",
          "17. Create Board Geometry: Generate Body and apply Height/Extrusion.",
          "18. Apply Advanced Cuts: Trim against Hip/Valley rafters and Roof outline.",
          "19. Entity Management: Delete old beams and Create new beams in ModelSpace.",
          "20. Visuals: Draw simplified outline representation for the TSL instance."
        ],
        "conditionalBranches": [
          {
            "condition": "User Selection of Pline during Insert",
            "path1": {
              "name": "Pline Selected",
              "steps": [
                "Validate Pline is closed (>2 vertices).",
                "Iterate through selected Roofplanes.",
                "Calculate intersection of Roofplane and Pline.",
                "Create new TSL instances via dbCreate for each valid intersection.",
                "Store 'wallOverlap' in map for new instances."
              ]
            },
            "path2": {
              "name": "No Pline Selected",
              "steps": [
                "Assign single selected Roofplane to _Entity.",
                "Prompt user to pick point '_Pt0' defining the end of the distribution.",
                "Continue with single instance creation."
              ]
            }
          },
          {
            "condition": "Presence of Rafter Beams (GenBeam)",
            "path1": {
              "name": "Rafters Detected",
              "steps": [
                "Filter beams intersecting the Roofplane.",
                "Construct PlaneProfile 'ppRafter' based on the planes of these beams.",
                "Add Roofplane outline to profile.",
                "Use this combined profile to define the board boundaries."
              ]
            },
            "path2": {
              "name": "No Rafters Detected",
              "steps": [
                "Use Roofplane Envelope (plEnvelope) as the primary profile.",
                "Handle specific offset logic if map contains 'wallOverlap'."
              ]
            }
          },
          {
            "condition": "Context Menu / Recalc Trigger",
            "path1": {
              "name": "Delete Beams",
              "steps": [
                "Retrieve existing beam references from _Map.",
                "Erase physical beams.",
                "Stop execution (do not regenerate)."
              ]
            },
            "path2": {
              "name": "Generate Beams (or Property Change)",
              "steps": [
                "Retrieve existing beam references from _Map.",
                "Erase physical beams.",
                "Execute full geometry regeneration and creation logic."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Roofplane Selection Count",
            "errorMessage": "(Implicit) Script erases instance.",
            "recovery": "User must run command again and select at least one valid Roofplane."
          },
          {
            "check": "Roofplane Entity Validity",
            "errorMessage": "(Implicit) Script erases instance on recalc.",
            "recovery": "Ensure the referenced Roofplane entity exists in the drawing and is not deleted."
          },
          {
            "check": "Pline Topology",
            "errorMessage": "No instance created (Logic skips creation).",
            "recovery": "User must select a closed polyline (vertex count > 2) during insertion or select no polyline."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions (Width/Height)",
            "how": "OPM Properties (Properties Palette)",
            "effect": "Triggers 'Generate Beams' workflow. Deletes old boards and recreates them with new dimensions."
          },
          {
            "action": "Change Profile",
            "how": "OPM Properties (Extrusion profile dropdown)",
            "effect": "Triggers regeneration. Switches geometry from rectangular to profile extrusion."
          },
          {
            "action": "Change Distribution Point",
            "how": "Grip Edit (Direct Editing)",
            "effect": "Moves _Pt0, triggering recalculation of the board distribution along the slope."
          },
          {
            "action": "Force Update",
            "how": "Context Menu -> 'Generate Beams'",
            "effect": "Forces a full regeneration of all boards associated with the instance."
          },
          {
            "action": "Remove Output",
            "how": "Context Menu -> 'Delete Beams'",
            "effect": "Deletes all generated beams but keeps the TSL instance (script) in the drawing."
          },
          {
            "action": "Move/Rotate Script",
            "how": "AutoCAD Move/Rotate commands",
            "effect": "Recalculates the board positions relative to the new script origin/coordinate system."
          }
        ]
      },
      "tokens_used": 12315,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbTraufschalung.mcr\n\n## Overview\nThis script generates a row of decorative eaves boards (often called \"Exposed Rafter Eaves\" or soffit boards) along a selected roof slope. It handles both simple rectangular boards and custom profile shapes, automatically trimming them to fit hips, valleys, and roof boundaries.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script creates 3D beams and bodies. |\n| Paper Space | No | Not designed for 2D drawing generation. |\n| Shop Drawing | No | Not a shop drawing script. |\n\n## Prerequisites\n- **Required Entities:** At least one `RoofPlane` (ERoofPlane).\n- **Optional Entities:**\n  - `Rafters` (GenBeam): Used to determine precise trimming at hips and valleys.\n  - `Polylines` (EntPLine): Can be used to define the boundary area for the boards.\n- **Required Settings:** `mapIO_LayerAssignment` (for layer management).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbTraufschalung.mcr` from the list.\n\n### Step 2: Select Roofplane\n```\nCommand Line: |Select Roofplane|\nAction: Click on the roof plane (slope) where you want to generate the eaves boards.\n```\n\n### Step 3: Select Pline(s) (Optional)\n```\nCommand Line: |Select pline(s)|\nAction: \n- If you have a closed polyline defining a specific area (e.g., a gable end or dormer outline), select it now.\n- If you want to cover the whole eave based on a point, press ENTER to skip this step.\n```\n\n### Step 4: Define Distribution End\n```\nCommand Line: |Point near end of distribution|\nAction: Click a point on the roof plane near the fascia or gutter line. This defines where the row of boards stops.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Extrusion profile | dropdown | (Empty) | Select a catalog profile for the board shape. If left empty, the script uses a rectangular cross-section based on Width and Height. |\n| visible Width | Number | 121 | The width of the board visible from below (spacing). Changing this regenerates the entire row. |\n| Height | Number | 21 | The thickness of the board. |\n| Additional Width | Number | 0 | Extra width added to the board (typically for overlaps). |\n| Material | String | (Empty) | The material code for the boards (e.g., C24). |\n| Grade | String | (Empty) | The timber grade. |\n| Name | String | Exposed Rafter Eaves | The name identifier for the element. |\n| Label | String | (Empty) | Short code for marking/labeling. |\n| Sublabel | String | (Empty) | Additional classification label. |\n| Color | Number | 65 | The CAD display color (AutoCAD Color Index). |\n| Dimstyle | dropdown | (Empty) | The dimension style to use. |\n| Group, Layername or Zone Character | String | Exposed Rafter Eaves | Determines the layer assignment (e.g., \"House\\Roof\\Rafter\" or a Zone Character like \"C\"). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Generate Beams | Deletes all existing boards generated by this script and creates a new distribution based on current properties. |\n| Delete Beams | Deletes the generated boards but keeps the script instance in the drawing. |\n| Toggle Direct Editing | Enables or disables the grip point used to move the distribution end point. |\n\n## Settings Files\n- **Filename**: `mapIO_LayerAssignment`\n- **Location**: Company or Install path\n- **Purpose**: Maps the script's internal entities to the correct CAD layers based on your project standards.\n\n## Tips\n- **Adjusting Spacing:** To change how close the boards are to each other, modify the `visible Width` property in the Properties Palette.\n- **Complex Roofs:** The script automatically cuts boards where they meet Hip or Valley rafters. For best results, ensure your Rafter beams (GenBeams) are drawn and intersect the roof plane correctly.\n- **Moving the Row:** Use the \"Toggle Direct Editing\" option to reveal a grip point at the end of the distribution. You can drag this point to shorten or lengthen the row of boards.\n- **Using Profiles:** If you select an `Extrusion profile`, the `visible Width` property is still used to calculate the spacing between boards, but the physical shape will match the profile.\n\n## FAQ\n- **Q: Why did my boards disappear?**\n  A: You might have deleted the reference Roofplane or the script instance. Check that the Roofplane entity still exists in the model. Alternatively, you may have selected \"Delete Beams\" from the right-click menu; select \"Generate Beams\" to bring them back.\n- **Q: Can I use this for curved roofs?**\n  A: This script is designed for planar roof planes. For curved surfaces, the boards will be placed linearly based on the plane's slope.\n- **Q: How do I change the board shape after insertion?**\n  A: Select the script instance, open the Properties Palette, and change the `Extrusion profile` dropdown. The script will automatically regenerate the geometry."
      },
      "tokens_used": 7509,
      "error": null
    }
  }
}