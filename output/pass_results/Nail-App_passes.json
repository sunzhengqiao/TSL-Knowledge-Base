{
  "filename": "Nail-App.mcr",
  "status": "completed",
  "total_tokens": 39277,
  "processing_time": 472.00196146965027,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.5",
            "date": "23.12.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-12218 plugin mode supported"
          },
          {
            "version": "1.4",
            "date": "21.09.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-13235 bugfix erasing tsls on insert"
          },
          {
            "version": "1.3",
            "date": "05.03.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-10428 existing naillines and nailing tsls within the rule set will be removed prior creation"
          },
          {
            "version": "1.2",
            "date": "28oct2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-9191 preview image updated"
          },
          {
            "version": "1.1",
            "date": "19oct2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-8764 bugfix"
          },
          {
            "version": "1.0",
            "date": "13oct2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-8764 initial"
          }
        ],
        "settingsFiles": [
          "Nail-Configuration.xml"
        ],
        "dependencies": [
          "Nail-SheetOnBeam",
          "Nail-SheetOnSheet"
        ]
      },
      "tokens_used": 6628,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script creates instances explicitly in Model Space via 'tslNew.dbCreate(..., _kModelSpace, mapTsl);'. It prompts for 'Element()' selection using PrEntity. No usage of '_kPaperSpace', '_Viewport', 'sd_', or 'Multipage' prefixes found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "Nail-Configuration.xml",
            "Nail-SheetOnBeam",
            "Nail-SheetOnSheet"
          ]
        }
      },
      "tokens_used": 5298,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "if (sConfigurations.length() > 1) during _bOnInsert OR _bOnMapIO",
            "title": null,
            "dataSource": "Properties Palette / mapIO",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": "nStringIndex",
            "variable": "sConfiguration",
            "type": "PropString",
            "displayName": "|Configuration|",
            "defaultValue": "sConfigurations",
            "inputType": "dropdown",
            "options": [
              "Dynamic list from Nail-Configuration.xml"
            ],
            "category": "|General|",
            "description": "|Defines the name of a configuration|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "Nail-Configuration.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings\\"
            ],
            "purpose": "Stores nailing rule configurations and associated TSL properties",
            "required": true
          }
        ]
      },
      "tokens_used": 7211,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the application of nailing patterns to selected elements by spawning and configuring sub-scripts based on predefined engineering configurations.",
          "category": "Pre-Processing / Automation",
          "typicalUseCase": "A detailer selects a set of wall or floor panels and chooses a specific nailing standard (e.g., 'Roof Sheathing 150/300') to apply consistent nailing rules across all selected elements instantly."
        },
        "parameters": [
          {
            "name": "sConfiguration",
            "technicalDefault": "sConfigurations (Dynamic List)",
            "businessMeaning": "Selects the specific Nailing Rule Set (Configuration) to apply. This configuration determines which sub-scripts (like Nail-SheetOnBeam) are used and defines all nailing parameters (spacing, nail type, offsets) for the selected elements.",
            "validRange": "List of configuration names defined in 'Nail-Configuration.xml' (e.g., 'Standard Floor', 'Bracing Wall').",
            "unit": "String",
            "affectsOutput": "Determines the specific geometry and density of nailing lines generated by the spawned child TSLs. Changing this clears existing nails and replaces them with the new pattern defined in the configuration."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change of sConfiguration",
            "effect": "The script reads the new configuration map from the XML and passes specific property values (Ints, Doubles, Strings) to the generated TSL instances.",
            "cascade": [
              "Child TSL Properties (Nail-SheetOnBeam / Nail-SheetOnSheet)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TSL Instance (Sub-scripts)",
            "description": "Spawns instances of helper scripts (Nail-SheetOnBeam, Nail-SheetOnSheet) which generate the actual nailing geometry.",
            "appliedTo": "Selected Element(s)"
          },
          {
            "type": "Nail Lines",
            "description": "Geometric representations of nailing patterns created by the spawned sub-scripts on the sheets within the elements.",
            "appliedTo": "Sheets belonging to the selected Element(s)"
          }
        ]
      },
      "tokens_used": 6585,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Initialization & Settings Load: Script loads 'Nail-Configuration.xml' from Company or Install path into a MapObject.",
          "2. Configuration Validation: Checks if the loaded settings contain valid configuration names.",
          "3. Insertion Logic: Checks for ExecuteKey (catalog mode) or displays Dynamic Dialog (if multiple configs exist).",
          "4. Entity Selection: Prompts user to select Elements (PrEntity).",
          "5. Rule Retrieval: Retrieves the specific Map for the selected configuration name.",
          "6. Element Processing Loop: Iterates through selected elements.",
          "7. Cleanup: For each element, erases existing NailLines and supported TSL instances (Nail-SheetOnBeam, etc.).",
          "8. TSL Generation: Reads 'Rule[]' from configuration and spawns new TSL instances on the elements with specified properties.",
          "9. Termination: The Nail-App instance erases itself (self-destructs), leaving only the generated child TSLs."
        ],
        "conditionalBranches": [
          {
            "condition": "Configuration List Empty",
            "path1": {
              "name": "No Configurations",
              "steps": [
                "Display Report Notice listing supported TSLs required to create configurations.",
                "Erase instance immediately.",
                "Exit script."
              ]
            },
            "path2": {
              "name": "Configurations Found",
              "steps": [
                "Populate 'sConfiguration' property drop-down.",
                "Proceed to insertion logic."
              ]
            }
          },
          {
            "condition": "Insertion Trigger (ExecuteKey vs Standard)",
            "path1": {
              "name": "ExecuteKey Present (Catalog/Silent)",
              "steps": [
                "Load properties from matching catalog entry or '_LastInserted'.",
                "Skip showing the dynamic dialog."
              ]
            },
            "path2": {
              "name": "Standard Insertion",
              "steps": [
                "Check if 'sConfigurations' list has more than 1 entry.",
                "If yes, invoke 'showDialog()'.",
                "Prompt user for Element selection."
              ]
            }
          },
          {
            "condition": "Element Sheet Content",
            "path1": {
              "name": "No Sheets Found",
              "steps": [
                "Log debug message.",
                "Skip processing this element (Continue loop)."
              ]
            },
            "path2": {
              "name": "Sheets Found",
              "steps": [
                "Perform cleanup of existing nails/TSLs.",
                "Spawn new TSL instances based on rules."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of Configurations in Settings",
            "errorMessage": "No configurations found... Tool will be deleted.",
            "recovery": "User must run dependent scripts (Nail-SheetOnBeam, etc.) to create and save configurations to the XML settings file before running Nail-App."
          },
          {
            "check": "Settings Version Match",
            "errorMessage": "Notice: A different Version of the settings has been found...",
            "recovery": "Informational alert; no blocking failure, but suggests updating the drawing's settings map."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Instance Self-Deletion",
            "how": "Automatic Script Execution",
            "effect": "The Nail-App instance is removed from the drawing immediately after execution. The user cannot modify the Nail-App instance later; they must modify the resulting child TSLs or run the tool again."
          }
        ]
      },
      "tokens_used": 8489,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Nail-App\n\n## Overview\nAutomatically applies nailing patterns to selected timber elements (such as walls or floors) based on predefined engineering configurations. This script spawns detailed sub-scripts to generate the geometry and then deletes itself.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the model. |\n| Paper Space | No | Not supported in layouts. |\n| Shop Drawing | No | Not intended for shop drawing generation. |\n\n## Prerequisites\n- **Required Entities**: Element (e.g., a Wall or Floor panel).\n- **Minimum Beam Count**: N/A (Requires an Element containing beams/sheets).\n- **Required Settings**:\n  - `Nail-Configuration.xml` (Must exist in Company or Install settings path).\n  - Helper scripts `Nail-SheetOnBeam` and `Nail-SheetOnSheet` must be installed.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Nail-App.mcr` from the list.\n\n### Step 2: Select Configuration\n```\nCommand Line: (Dynamic Dialog appears if multiple configurations exist)\nAction: Select the desired Nailing Rule Set from the drop-down list (e.g., \"Roof Sheathing 150/300\").\n```\n*Note: If only one configuration exists in the settings file, this step may be skipped automatically.*\n\n### Step 3: Select Elements\n```\nCommand Line: |Select elements|\nAction: Click on the Element(s) (Walls/Floors) you wish to apply nailing to. Press Enter to confirm selection.\n```\n\n### Step 4: Processing\nThe script will automatically remove any existing nail lines and TSL instances on the selected elements and generate the new nailing patterns.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Configuration | dropdown | (First item in list) | Defines the name of the configuration (Rule Set) to apply. This determines nailing spacing, offsets, and nail types. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | The script instance erases itself immediately after execution, so there are no right-click menu options available after insertion. |\n\n## Settings Files\n- **Filename**: `Nail-Configuration.xml`\n- **Location**: `_kPathHsbCompany\\TSL\\Settings` or `_kPathHsbInstall\\Content\\General\\TSL\\Settings\\`\n- **Purpose**: Stores the nailing rule configurations, including specific parameters for different connection types (Sheet to Beam, Sheet to Sheet).\n\n## Tips\n- **Self-Deleting Tool**: This script removes itself from the drawing immediately after running. To modify the nailing, you must edit the generated child TSLs or run the Nail-App tool again.\n- **Cleanup**: The script automatically deletes existing nail lines and associated nailing TSLs on the selected elements before applying the new pattern.\n- **Preparation**: Ensure your configurations are created in the XML file first (usually done by running the helper scripts individually and saving settings).\n\n## FAQ\n- **Q: Why did the tool disappear after I selected the elements?**\n  A: This is intentional behavior. The \"Nail-App\" acts as a generator tool. It creates the specific nailing instances required and then self-destructs to keep the drawing clean.\n- **Q: I get an error saying \"No configurations found\". What do I do?**\n  A: The `Nail-Configuration.xml` file is likely empty or missing. You need to run the dependent scripts (like `Nail-SheetOnBeam`) to generate and save configurations to the settings file first.\n- **Q: Can I edit the nails later?**\n  A: Yes, but you cannot edit the \"Nail-App\" instance (since it is gone). You must modify the properties of the individual nailing instances (e.g., `Nail-SheetOnBeam`) that were created on the element, or re-run the Nail-App tool with a different configuration."
      },
      "tokens_used": 5066,
      "error": null
    }
  }
}