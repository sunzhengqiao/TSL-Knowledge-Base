{
  "filename": "hsb_SetGenBeamColorByMaterial.mcr",
  "status": "completed",
  "total_tokens": 27348,
  "processing_time": 271.45758843421936,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [
          "Materials.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 2423,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses PrEntity to select Element() objects and iterates GenBeams; no sd_ prefix, Viewport, or PaperSpace references found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "_kPathHsbCompany\\Abbund\\Materials.xml"
          ]
        }
      },
      "tokens_used": 2880,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sMaterial1",
            "type": "PropString",
            "displayName": "Material 1",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "sMaterials (Dynamic from XML)",
            "category": "Material 1",
            "description": null
          },
          {
            "index": 0,
            "variable": "sColor1",
            "type": "PropInt",
            "displayName": "Color 1",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": "Material 1",
            "description": null
          },
          {
            "index": 1,
            "variable": "sMaterial2",
            "type": "PropString",
            "displayName": "Material 2",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "sMaterials (Dynamic from XML)",
            "category": "Material 2",
            "description": null
          },
          {
            "index": 1,
            "variable": "sColor2",
            "type": "PropInt",
            "displayName": "Color 2",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": "Material 2",
            "description": null
          },
          {
            "index": 2,
            "variable": "sMaterial3",
            "type": "PropString",
            "displayName": "Material 3",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "sMaterials (Dynamic from XML)",
            "category": "Material 3",
            "description": null
          },
          {
            "index": 2,
            "variable": "sColor3",
            "type": "PropInt",
            "displayName": "Color 3",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": "Material 3",
            "description": null
          },
          {
            "index": 3,
            "variable": "sMaterial4",
            "type": "PropString",
            "displayName": "Material 4",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "sMaterials (Dynamic from XML)",
            "category": "Material 4",
            "description": null
          },
          {
            "index": 3,
            "variable": "sColor4",
            "type": "PropInt",
            "displayName": "Color 4",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": "Material 4",
            "description": null
          },
          {
            "index": 4,
            "variable": "sMaterial5",
            "type": "PropString",
            "displayName": "Material 5",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "sMaterials (Dynamic from XML)",
            "category": "Material 5",
            "description": null
          },
          {
            "index": 4,
            "variable": "sColor5",
            "type": "PropInt",
            "displayName": "Color 5",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": "Material 5",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "Materials.xml",
            "searchPaths": [
              "_kPathHsbCompany\\Abbund"
            ],
            "purpose": "Provides the list of valid material names for the Property dropdowns",
            "required": true
          }
        ]
      },
      "tokens_used": 5290,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically assigns specific visual colors to General Beams based on their material property to differentiate timber grades in the model.",
          "category": "Visualization/Model Management",
          "typicalUseCase": "When a user wants to visually distinguish between different timber grades (e.g., C24 vs GL28h) or specific material zones in a 3D view or drawing to verify design intent."
        },
        "parameters": [
          {
            "name": "sMaterial1",
            "technicalDefault": "",
            "businessMeaning": "The name of the first timber material type to identify (e.g., 'C24'). Any beam with this material will be assigned Color 1.",
            "validRange": "Must match a name defined in the company Materials.xml file",
            "unit": "String",
            "affectsOutput": "Determines which subset of beams receives Color 1."
          },
          {
            "name": "sColor1",
            "technicalDefault": -1,
            "businessMeaning": "The AutoCAD color index applied to beams matching Material 1. (-1 usually implies 'ByLayer' or no change).",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the display color of beams defined in Material 1."
          },
          {
            "name": "sMaterial2",
            "technicalDefault": "",
            "businessMeaning": "The name of the second timber material type to identify.",
            "validRange": "Must match a name defined in the company Materials.xml file",
            "unit": "String",
            "affectsOutput": "Determines which subset of beams receives Color 2."
          },
          {
            "name": "sColor2",
            "technicalDefault": -1,
            "businessMeaning": "The AutoCAD color index applied to beams matching Material 2.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the display color of beams defined in Material 2."
          },
          {
            "name": "sMaterial3",
            "technicalDefault": "",
            "businessMeaning": "The name of the third timber material type to identify.",
            "validRange": "Must match a name defined in the company Materials.xml file",
            "unit": "String",
            "affectsOutput": "Determines which subset of beams receives Color 3."
          },
          {
            "name": "sColor3",
            "technicalDefault": -1,
            "businessMeaning": "The AutoCAD color index applied to beams matching Material 3.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the display color of beams defined in Material 3."
          },
          {
            "name": "sMaterial4",
            "technicalDefault": "",
            "businessMeaning": "The name of the fourth timber material type to identify.",
            "validRange": "Must match a name defined in the company Materials.xml file",
            "unit": "String",
            "affectsOutput": "Determines which subset of beams receives Color 4."
          },
          {
            "name": "sColor4",
            "technicalDefault": -1,
            "businessMeaning": "The AutoCAD color index applied to beams matching Material 4.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the display color of beams defined in Material 4."
          },
          {
            "name": "sMaterial5",
            "technicalDefault": "",
            "businessMeaning": "The name of the fifth timber material type to identify.",
            "validRange": "Must match a name defined in the company Materials.xml file",
            "unit": "String",
            "affectsOutput": "Determines which subset of beams receives Color 5."
          },
          {
            "name": "sColor5",
            "technicalDefault": -1,
            "businessMeaning": "The AutoCAD color index applied to beams matching Material 5.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the display color of beams defined in Material 5."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Materials.xml file location/content",
            "effect": "Populates the dropdown options for sMaterial1-5.",
            "cascade": [
              "sMaterial1",
              "sMaterial2",
              "sMaterial3",
              "sMaterial4",
              "sMaterial5"
            ]
          },
          {
            "trigger": "Matching sMaterialX to a GenBeam",
            "effect": "Triggers the application of sColorX to that specific beam.",
            "cascade": [
              "sColor1",
              "sColor2",
              "sColor3",
              "sColor4",
              "sColor5"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Visual Attribute (Color)",
            "description": "Modifies the display color of existing beams; no geometry is created or cut.",
            "appliedTo": "GenBeams within the selected Elements whose material names match the defined properties."
          }
        ]
      },
      "tokens_used": 4972,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch",
          "Check for Materials.xml at _kPathHsbCompany\\Abbund\\Materials.xml",
          "[Conditional] If file missing: Report error 'Materials not been set, please run hsbMaterial Utility or contact SupportDesk', eraseInstance(), and exit",
          "Read Materials.xml into Map",
          "Extract all non-DEFAULT material names, convert to Uppercase, and store in sMaterials array",
          "Define Properties (OPM): 5 pairs of Material dropdowns (populated from sMaterials) and Color Integers",
          "[Event] _bOnDbCreated: Restore property values from catalog if available",
          "[Event] _bOnInsert (Initial Insertion):",
          "[Conditional] Check insertCycleCount(): If > 1, eraseInstance() and exit (prevent multi-insert loops)",
          "[Conditional] If _kExecuteKey is empty, show Dialog once",
          "Prompt User: Select a set of elements via PrEntity",
          "[Conditional] If selection successful: Append elements to internal _Element list",
          "Exit script (wait for recalculation/update)",
          "Post-Insertion / Recalculation (if _Element.length() > 0):",
          "Loop through each selected Element",
          "Loop through each GenBeam within the Element",
          "Get GenBeam material name, convert to Uppercase, and trim whitespace",
          "[Conditional] Search for material name in Property list (sAllMaterials)",
          "[Conditional] If match found (Index != -1): Apply corresponding Color (sAllColors[Index]) to GenBeam",
          "Script Completion: eraseInstance() and return"
        ],
        "conditionalBranches": [
          {
            "condition": "Materials.xml file exists at specified path",
            "path1": {
              "name": "File Found",
              "steps": [
                "Parse XML file",
                "Populate Material Dropdowns",
                "Proceed to insertion"
              ]
            },
            "path2": {
              "name": "File Not Found",
              "steps": [
                "Display Report Notice",
                "Erase Script Instance",
                "Terminate Execution"
              ]
            }
          },
          {
            "condition": "Beam Material matches a defined Property (sMaterial1-5)",
            "path1": {
              "name": "Material Match",
              "steps": [
                "Identify Index (0-4) of the matching material property",
                "Retrieve the corresponding Color value from sAllColors",
                "Apply Color to the GenBeam"
              ]
            },
            "path2": {
              "name": "No Match",
              "steps": [
                "Skip beam (Color remains unchanged)"
              ]
            }
          },
          {
            "condition": "_bOnInsert flag state",
            "path1": {
              "name": "True (During Insertion)",
              "steps": [
                "Check insertCycleCount",
                "Prompt User for Entity Selection",
                "Store Selection",
                "Return"
              ]
            },
            "path2": {
              "name": "False (During Recalculation)",
              "steps": [
                "Iterate stored Elements",
                "Process Beams",
                "Apply Colors"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of Materials.xml in the specific hsbCompany directory",
            "errorMessage": "\n Materials not been set, please run hsbMaterial Utility or contact SupportDesk",
            "recovery": "Run hsbMaterial Utility to generate the file or contact support."
          },
          {
            "check": "Element Selection made during Insertion",
            "errorMessage": "None (Silent failure)",
            "recovery": "If _Element.length() == 0 on recalculation, the script erases itself. User must re-run script and select entities."
          },
          {
            "check": "insertCycleCount > 1",
            "errorMessage": "None",
            "recovery": "Script automatically erases duplicate instances to prevent infinite loops."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Material Mapping",
            "how": "Properties Palette (OPM)",
            "effect": "Updating the 'Material X' or 'Color X' properties in the palette allows changing mapping rules. Changing a property triggers a recalculation, immediately updating the beam colors in the model."
          },
          {
            "action": "Update Model Colors",
            "how": "AutoCAD REGEN or moving the script object (if it remains as an entity, though this script self-erases, changes are effectively permanent until the beams are regenerated by other means or the script is re-run on them)",
            "effect": "Since the script uses eraseInstance() at the end, the color change is a 'fire and forget' action. To change colors again, the user must re-insert the script or use a persistent variant."
          }
        ]
      },
      "tokens_used": 5585,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SetGenBeamColorByMaterial.mcr\n\n## Overview\nThis script automatically assigns specific colors to General Beams (GenBeams) based on their material property. It is designed to help users visually distinguish different timber grades or material types directly within the 3D model.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on elements in the 3D model. |\n| Paper Space | No | Not intended for layout views. |\n| Shop Drawing | No | Not intended for production drawings. |\n\n## Prerequisites\n- **Required Entities**: `Elements` containing `GenBeams`.\n- **Minimum Beams**: 0 (Script processes all beams found in selected elements).\n- **Required Settings**: `Materials.xml` must be present in your company folder (`...\\_kPathHsbCompany\\Abbund\\Materials.xml`).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_SetGenBeamColorByMaterial.mcr`\n\n### Step 2: Configure Properties (Optional)\nBefore selecting elements, you can open the **Properties Palette (OPM)** in AutoCAD.\n- Set the desired **Material X** (e.g., \"C24\") and the corresponding **Color X** (AutoCAD Color Index) for up to 5 different material types.\n\n### Step 3: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the desired Elements (e.g., walls, roofs) in the model that contain the beams you want to colorize. Press Enter to confirm selection.\n```\n\n### Step 4: Execution\nThe script will immediately scan the selected elements. Any beam with a material matching your settings will change color. The script instance will then delete itself automatically.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Material 1 | Dropdown | (Empty) | Select the first material name (e.g., C24) from the company materials list. |\n| Color 1 | Number | -1 | Enter the AutoCAD Color Index (0-255) to apply to Material 1. (-1 = ByLayer). |\n| Material 2 | Dropdown | (Empty) | Select the second material name. |\n| Color 2 | Number | -1 | Enter the AutoCAD Color Index to apply to Material 2. |\n| Material 3 | Dropdown | (Empty) | Select the third material name. |\n| Color 3 | Number | -1 | Enter the AutoCAD Color Index to apply to Material 3. |\n| Material 4 | Dropdown | (Empty) | Select the fourth material name. |\n| Color 4 | Number | -1 | Enter the AutoCAD Color Index to apply to Material 4. |\n| Material 5 | Dropdown | (Empty) | Select the fifth material name. |\n| Color 5 | Number | -1 | Enter the AutoCAD Color Index to apply to Material 5. |\n\n## Right-Click Menu Options\n*(None available)*\n\n## Settings Files\n- **Filename**: `Materials.xml`\n- **Location**: `_kPathHsbCompany\\Abbund\\`\n- **Purpose**: This file provides the list of valid material names (e.g., GL24h, C24) that appear in the Property dropdowns.\n\n## Tips\n- **Fire and Forget**: This script deletes itself immediately after running. If you need to change the color mapping later, you must re-run the script.\n- **Standard Undo**: You can use the standard AutoCAD `U` (Undo) command to revert the color changes if the result is not as expected.\n- **Material Match**: The script compares material names without case sensitivity (e.g., \"c24\" will match \"C24\"). Ensure the names in your model match the names in `Materials.xml`.\n\n## FAQ\n- **Q: I get an error \"Materials not been set...\" when running the script.**\n  **A:** The `Materials.xml` file is missing from your `Abbund` folder. Ensure you have run the `hsbMaterial` utility or contact your support desk to generate this file.\n\n- **Q: The color didn't change on my beam.**\n  **A:** Check that the material name assigned to the beam exactly matches one of the \"Material X\" properties you configured in the palette. Also, ensure the beam is inside an Element that you selected during Step 3.\n\n- **Q: How do I find the AutoCAD Color Index number?**\n  **A:** In AutoCAD, type `COLOR` to open the Select Color dialog. The index number (1-255) is displayed next to the color swatch."
      },
      "tokens_used": 6198,
      "error": null
    }
  }
}