{
  "filename": "HSB-ElementDefinitionCatalog.mcr",
  "status": "completed",
  "total_tokens": 50276,
  "processing_time": 294.0189776420593,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 5,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "This tsl shows manages the element definition catalog. There are context menu option available to add, edit or remove entries. The name of the catalog can be specified, e.g. to have project specific catalogs.",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "03.02.2011",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "19.06.2013",
            "author": "AS",
            "changes": "Corrected text for \"Zone 4\""
          },
          {
            "version": "1.02",
            "date": "14.07.2014",
            "author": "AS",
            "changes": "Make catalog a property"
          },
          {
            "version": "1.03",
            "date": "22.09.2014",
            "author": "AS",
            "changes": "Send catalog name as an argument to property tsl"
          },
          {
            "version": "1.04",
            "date": "22.09.2014",
            "author": "AS",
            "changes": "Check if file exists and show catalog title. Add rename option"
          },
          {
            "version": "1.05",
            "date": "24.12.2015",
            "author": "AS",
            "changes": "Catalog is outputted to new location. Read from old location, if available."
          }
        ],
        "settingsFiles": [
          "HSB-ElementDefinitionCatalog.xml"
        ],
        "dependencies": [
          "HSB-ElementDefinitionCatalogProps.mcr"
        ]
      },
      "tokens_used": 8485,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script executes getPoint() for interactive placement in the current drawing space. It uses Display classes to draw catalog text directly at the selected point. No usage of Viewport APIs, Multipage logic, or ShopDrawing (#Type E) filtering. Explicit usage of _kModelSpace during helper script creation."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (Interactive insertion required)",
          "requiredSettings": [
            "HSB-ElementDefinitionCatalog.xml (Managed by script, created if missing)",
            "HSB-ElementDefinitionCatalogProps.mcr (Required for input dialogs)"
          ]
        }
      },
      "tokens_used": 6975,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select a position|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Properties Dialog",
            "trigger": "Insertion and Context Menu Actions",
            "title": "Properties",
            "dataSource": "HSB-ElementDefinitionCatalogProps.mcr (Dependency)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 1,
            "variable": "sSeparatorCatalog",
            "type": "PropString",
            "displayName": "|Catalog|",
            "defaultValue": "",
            "inputType": "readonly",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sFileName",
            "type": "PropString",
            "displayName": "     |Catalog name|",
            "defaultValue": "HSB-ElementDefinitionCatalog",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sSeparatorStyle",
            "type": "PropString",
            "displayName": "|Style|",
            "defaultValue": "",
            "inputType": "readonly",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "     |Dimension style|",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Add entry|",
            "handler": "|Add entry|",
            "action": "Opens a dialog to create a new catalog entry with Type, Subtype, and Zone definitions.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Edit entry|",
            "handler": "|Edit entry|",
            "action": "Selects an existing entry from a list and opens a dialog to modify its properties.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Remove entry|",
            "handler": "|Remove entry|",
            "action": "Selects an existing entry from a list and deletes it from the catalog.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Rename entry|",
            "handler": "|Rename entry|",
            "action": "Selects an existing entry and opens a dialog to change its Type/Subtype name.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Clear catalog|",
            "handler": "|Clear catalog|",
            "action": "Deletes all entries from the current catalog XML file.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "{sFileName}.xml",
            "searchPaths": [
              "_kPathHsbCompany\\Abbund",
              "_kPathHsbCompany\\Content\\Dutch\\Element"
            ],
            "purpose": "Stores the Element Definition Catalog data (Types, Subtypes, Zone mappings).",
            "required": true
          }
        ]
      },
      "tokens_used": 9626,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Manages a configuration catalog that maps Element Types and Subtypes to specific Construction Zones (e.g., logical layers or positions within an element).",
          "category": "Data Management / Configuration",
          "typicalUseCase": "Used by BIM managers or engineers to define standard configurations for automated element generation, ensuring specific wall/floor types utilize the correct material build-up or layer mappings."
        },
        "parameters": [
          {
            "name": "sFileName",
            "technicalDefault": "HSB-ElementDefinitionCatalog",
            "businessMeaning": "The specific name of the XML database file used to store the catalog definitions. This enables users to maintain separate catalogs for different projects, clients, or standards (e.g., 'ProjectA_Catalog' vs 'StandardCatalog').",
            "validRange": "Valid filename string (alphanumeric, underscores). Must correspond to an existing XML file or a new file to be created.",
            "unit": "String",
            "affectsOutput": "Determines which data set is loaded into memory for viewing/editing and which file is updated when changes are saved. Changing this effectively switches the active database."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Controls the visual appearance (font, text size, arrow style) of the catalog table drawn in the CAD model.",
            "validRange": "List of available dimension styles in the current drawing.",
            "unit": "N/A",
            "affectsOutput": "Alters the height, font, and legibility of the generated text display in the Model Space. Does not change the underlying data."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sFileName is modified",
            "effect": "The script attempts to load an XML file with the new name from the 'Abbund' or 'Content\\Dutch\\Element' folders. If the file does not exist, a new empty catalog is initialized.",
            "cascade": [
              "Displayed Catalog Content"
            ]
          },
          {
            "trigger": "Context Menu Action (Add/Edit/Remove/Rename)",
            "effect": "Modifies the internal data map (_Map) and writes the changes to the file specified by 'sFileName'.",
            "cascade": [
              "XML File Content",
              "Visual Display Table"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text Annotation / Visualization",
            "description": "Draws a formatted table in Model Space listing all Types, Subtypes, and their assigned Zones (00-10) based on the current catalog data.",
            "appliedTo": "Model Space (at user selected point _Pt0)"
          },
          {
            "type": "XML Data File",
            "description": "Creates or updates an XML file containing the Element Definition mappings. This file acts as a lookup table for other scripts.",
            "appliedTo": "Disk (_kPathHsbCompany location)"
          }
        ]
      },
      "tokens_used": 8945,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User launches script insertion.",
          "2. Script checks insertion cycle; if > 1, instance is erased to prevent duplicates.",
          "3. Properties Dialog opens (initializes Catalog Name and Dimension Style).",
          "4. User confirms properties and selects an insertion point in Model Space.",
          "5. Script attempts to load the XML catalog file.",
          "6. [Internal] If file missing in new location, checks legacy location; if found, migrates data to new location.",
          "7. Script calculates layout based on text style and draws the catalog table.",
          "8. Workflow completes. Instance remains in Model Space for viewing and management."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase current instance",
                "Return (Stop execution)"
              ]
            },
            "path2": {
              "name": "Cycle = 1",
              "steps": [
                "Show Properties Dialog",
                "Get Insertion Point",
                "Proceed to File Loading"
              ]
            }
          },
          {
            "condition": "Catalog XML File Availability",
            "path1": {
              "name": "File found in new location",
              "steps": [
                "Read map from XML file"
              ]
            },
            "path2": {
              "name": "File not in new location",
              "steps": [
                "Check legacy location (_kPathHsbCompany\\Content\\Dutch\\Element)",
                "If legacy file exists: Read data, Write to new location, Report Notice",
                "If legacy missing: Initialize empty Map"
              ]
            }
          },
          {
            "condition": "Add Entry - Duplicate Name Check",
            "path1": {
              "name": "Type-Subtype Already Exists",
              "steps": [
                "Report Warning: 'The catalog already contains a definition with this type-subtype.'",
                "Abort Save",
                "Map remains unchanged"
              ]
            },
            "path2": {
              "name": "New Type-Subtype",
              "steps": [
                "Add entry to internal Map",
                "Write Map to XML file"
              ]
            }
          },
          {
            "condition": "Edit/Remove/Rename - Selection",
            "path1": {
              "name": "Valid Entry Selected",
              "steps": [
                "Perform specific action (Modify Map, Remove from Map, or Rename Key)",
                "Write changes to XML file"
              ]
            },
            "path2": {
              "name": "Selection Failed/Cancelled",
              "steps": [
                "Exit execution without changes"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Duplicate Entry Key (Type - Subtype) during Add Entry",
            "errorMessage": "|The catalog already contains a definition with this type-subtype.| |Please use another type-subtype combination, or edit the existing definition|",
            "recovery": "User must cancel and choose 'Edit entry' for the existing item, or pick a unique Type/Subtype combination."
          },
          {
            "check": "File Write Permissions during Migration or Save",
            "errorMessage": "|Cannot write the catalog to:| <FilePath>",
            "recovery": "User should check file permissions or ensure the target directory is not read-only."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Add Catalog Entry",
            "how": "Context Menu -> '|Add entry|'",
            "effect": "Opens input form to define a new Element Type/Subtype and its Zone mappings (00-10). Updates XML and redraws table."
          },
          {
            "action": "Edit Existing Entry",
            "how": "Context Menu -> '|Edit entry|'",
            "effect": "Selects an entry from a list, opens form with current values, and updates the XML upon confirmation."
          },
          {
            "action": "Remove Entry",
            "how": "Context Menu -> '|Remove entry|'",
            "effect": "Selects an entry and deletes it permanently from the XML catalog."
          },
          {
            "action": "Rename Entry",
            "how": "Context Menu -> '|Rename entry|'",
            "effect": "Changes the Type/Subtype name of an existing entry while preserving its Zone data."
          },
          {
            "action": "Clear Catalog",
            "how": "Context Menu -> '|Clear catalog|'",
            "effect": "Deletes all entries from the XML file, effectively resetting it to empty."
          },
          {
            "action": "Change Catalog Source",
            "how": "Properties Palette (OPM) -> '|Catalog name|'",
            "effect": "Switches the data source to a different XML file immediately (if it exists) or starts a new catalog."
          },
          {
            "action": "Update Visual Style",
            "how": "Properties Palette (OPM) -> '|Dimension style|'",
            "effect": "Regenerates the visual table using the selected Dimension Style (text height, font)."
          },
          {
            "action": "Relocate Visualization",
            "how": "Grip Edit or Move Command",
            "effect": "Moves the table to a new position in Model Space."
          }
        ]
      },
      "tokens_used": 10306,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB-ElementDefinitionCatalog.mcr\n\n## Overview\nThis script manages a configuration catalog that maps Element Types and Subtypes to specific Construction Zones. It provides a visual table in Model Space and allows users to add, edit, remove, or rename catalog entries via a right-click context menu.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script requires interactive placement in Model Space. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | Not intended for manufacturing details. |\n\n## Prerequisites\n- **Required entities:** None\n- **Minimum beam count:** 0\n- **Required settings files:** \n  - `HSB-ElementDefinitionCatalogProps.mcr` (Required for input dialogs)\n  - `{sFileName}.xml` (Created automatically if missing)\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB-ElementDefinitionCatalog.mcr`\n\n### Step 2: Configure Properties\n```\nAction: A properties dialog appears upon insertion.\n```\n- Set the **Catalog name** to define or load a specific XML file (e.g., \"ProjectA_Catalog\").\n- Select a **Dimension style** to control the text appearance of the table.\n\n### Step 3: Select Insertion Point\n```\nCommand Line: Select a position\nAction: Click in the Model Space to place the catalog visualization table.\n```\n\n### Step 4: Automatic Migration (If applicable)\n```\nAction: The script checks if the catalog file exists in the new location.\n```\n- If found, it loads the data.\n- If not found in the new location but found in the legacy location, it automatically migrates the data to the new location and notifies you.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Catalog name | Text | HSB-ElementDefinitionCatalog | Specifies the filename of the XML database to use. Change this to switch between different project catalogs or create a new one. |\n| Dimension style | Dropdown | _DimStyles | Determines the font, text size, and arrow style used for the visual catalog table. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add entry | Opens a dialog to create a new catalog entry by defining a Type, Subtype, and Zone assignments. |\n| Edit entry | Select an existing entry from a list to modify its Zone definitions or properties. |\n| Remove entry | Select an existing entry to permanently delete it from the catalog. |\n| Rename entry | Select an entry to change its Type or Subtype name while keeping its Zone data intact. |\n| Clear catalog | Deletes all entries from the currently loaded XML file, effectively resetting the catalog. |\n\n## Settings Files\n- **Filename**: `{Catalog Name}.xml`\n- **Location**: `_kPathHsbCompany\\Abbund` or `_kPathHsbCompany\\Content\\Dutch\\Element`\n- **Purpose**: Stores the Element Definition mappings (Types, Subtypes, and Zones 00-10). This file serves as the database for the catalog.\n\n## Tips\n- **Project Management:** Use the **Catalog name** property to maintain separate catalogs for different clients or standards (e.g., type \"StandardWall\" to load `StandardWall.xml`).\n- **Visual Updates:** If the table text is too small or large, change the **Dimension style** in the properties palette; the table will automatically regenerate.\n- **Duplicate Handling:** If you try to add an entry with a Type/Subtype combination that already exists, the script will warn you and abort the save. Use \"Edit entry\" instead.\n- **File Migration:** If you recently updated hsbCAD, the script will automatically find and move your old catalog files to the new folder structure.\n\n## FAQ\n- **Q: Why did my catalog entries disappear?**\n  - A: You likely changed the \"Catalog name\" property. Ensure the name matches the XML file containing your data.\n  \n- **Q: Can I use this script to link different wall types to specific layers?**\n  - A: Yes, by defining Zones (00-10) in the catalog entries, you can map specific Element Types/Subtypes to logical construction layers used by other scripts.\n\n- **Q: What happens if I run the insert command twice in the same session?**\n  - A: The script automatically erases the previous instance to prevent duplicates in the drawing.\n\n- **Q: I received a message \"Cannot write the catalog to...\"**\n  - A: Check your file permissions. The folder where the XML is being saved might be read-only."
      },
      "tokens_used": 5939,
      "error": null
    }
  }
}