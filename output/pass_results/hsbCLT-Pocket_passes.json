{
  "filename": "hsbCLT-Pocket.mcr",
  "status": "partial",
  "total_tokens": 41948,
  "processing_time": 1595.1166100502014,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 8868,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Header command definition uses `hsb_ScriptInsert`. Dialog creation explicitly uses `_kModelSpace`. Script logic uses `eraseInstance()`, typical of dynamic Model Space tools. Comments indicate the script 'publishes' data (bounding contours, dimrequests) for shopdrawings rather than executing within them. No sd_* prefixes or #Type E definitions found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space with a selected CLT panel.",
          "requiredSettings": [
            "hsbCLT-Freeprofile.xml"
          ]
        }
      },
      "tokens_used": 7138,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getString",
              "promptOriginal": "Are you sure to overwrite existing settings? [No/Yes]",
              "condition": "Exporting settings via context menu",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowMultilineNotice",
            "trigger": "Inconsistent Tool Parameters",
            "title": "Inconsistent Tool Parameters",
            "dataSource": "Internal logic",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dDiameter",
            "type": "PropDouble",
            "displayName": "|Diameter|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Tool Definition|",
            "description": "|Defines the diameter of the tool|"
          },
          {
            "index": 1,
            "variable": "dLength",
            "type": "PropDouble",
            "displayName": "|Length|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Tool Definition|",
            "description": "|Defines the length of the tool|"
          },
          {
            "index": 0,
            "variable": "nToolIndex",
            "type": "PropInt",
            "displayName": "|ToolIndex|",
            "defaultValue": "2",
            "inputType": "number",
            "options": [],
            "category": "|Tool Definition|",
            "description": "|Defines the toolindex|"
          },
          {
            "index": 0,
            "variable": "sName",
            "type": "PropString",
            "displayName": "|Name|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "sToolNames"
            ],
            "category": "|Tool Definition|",
            "description": "|Defines the name of the tool|"
          },
          {
            "index": 0,
            "variable": "sName",
            "type": "PropString",
            "displayName": "|Name|",
            "defaultValue": "|Name of Tool|",
            "inputType": "text",
            "options": [],
            "category": "|Tool Definition|",
            "description": "|Defines the name of the tool|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Add Tool Definition|",
            "handler": "|Add Tool Definition|",
            "action": "Opens dialog to add a new tool definition",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Edit Tool Definition|",
            "handler": "|Edit Tool Definition|",
            "action": "Opens dialog to edit existing tool definition",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Remove Tool Definition|",
            "handler": "|Remove Tool Definition|",
            "action": "Opens dialog to remove a tool definition",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Import Settings|",
            "handler": "|Import Settings|",
            "action": "Imports tool settings from XML file",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Export Settings|",
            "handler": "|Export Settings|",
            "action": "Exports current tool settings to XML file",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Stretch Dimension|",
            "handler": "|Stretch Dimension|",
            "action": "Initiates dimension stretching (defined in header)",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Remove Panel|",
            "handler": "|Remove Panel|",
            "action": "Removes panel association (defined in header)",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Add Panel|",
            "handler": "|Add Panel|",
            "action": "Adds panel association (defined in header)",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Extend Radius in Direction|",
            "handler": "|Extend Radius in Direction|",
            "action": "Extends the radius geometry (defined in header)",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Remove Extended Radius|",
            "handler": "|Remove Extended Radius|",
            "action": "Removes extended radius geometry (defined in header)",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Select pocket|",
            "handler": "Select pocket",
            "action": "General selector for the specific command",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "TslDoubleClick",
            "handler": "TslDoubleClick",
            "action": "Toggles tool face between reference and opposite side",
            "alsoTriggeredBy": "Double Click"
          }
        ],
        "settingsFiles": [
          {
            "filename": "hsbCLT-Freeprofile.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings"
            ],
            "purpose": "Stores tool definitions (Diameter, Length, Name, ToolIndex)",
            "required": true
          }
        ]
      },
      "tokens_used": 7873,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates and manages CNC pockets (milled holes or recesses) with optional radius rounding in CLT (Cross Laminated Timber) panels, including tool definition management.",
          "category": "Machining/CNC",
          "typicalUseCase": "Creating circular or rounded rectangular pockets in CLT panels to receive bolts, connectors, or other structural elements, ensuring the correct tool diameter and CNC parameters are assigned."
        },
        "parameters": [
          {
            "name": "dDiameter",
            "technicalDefault": "0",
            "businessMeaning": "Defines the diameter of the cutting tool used to create the pocket. This determines the width of milled areas or the size of circular drill holes.",
            "validRange": "6mm to 500mm (typical CNC tool ranges)",
            "unit": "mm",
            "affectsOutput": "Controls the width of the pocket geometry and the specific CNC tool selected for machining. If the pocket width exceeds the tool diameter, the tool path will be offset (contoured) to achieve the desired width."
          },
          {
            "name": "dLength",
            "technicalDefault": "0",
            "businessMeaning": "Defines the cutting length or depth capacity of the tool. This ensures the tool can penetrate deep enough into the material without breaking.",
            "validRange": "20mm to 300mm (depending on tool type and collet)",
            "unit": "mm",
            "affectsOutput": "Validates that the selected tool can physically reach the required depth of the pocket. While it may not change the geometric shape directly, it acts as a constraint for valid tool selection in the CAM process."
          },
          {
            "name": "nToolIndex",
            "technicalDefault": "2",
            "businessMeaning": "Unique identifier mapping this pocket to a specific tool number in the CNC machine's tool changer or post-processor configuration.",
            "validRange": "1 to 99 (or specific machine limit)",
            "unit": "count",
            "affectsOutput": "Determines the specific tool number (e.g., T2, T5) written to the CNC output file (BTL, PFX, etc.). Incorrect mapping can cause the machine to use the wrong cutter."
          },
          {
            "name": "sName",
            "technicalDefault": "\"Name of Tool\" or Dropdown list",
            "businessMeaning": "Human-readable label for the tool configuration (e.g., '30mm Spiral Cutter'), allowing users to select tools by name rather than just numbers.",
            "validRange": "Text string from the loaded settings XML",
            "unit": "string",
            "affectsOutput": "Serves as a visual reference in the UI. Selecting a name automatically loads the associated Diameter, Length, and ToolIndex from the XML settings into the current instance."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User selects a Tool Name (sName) from the dropdown",
            "effect": "The script loads the corresponding Diameter (dDiameter), Length (dLength), and Index (nToolIndex) from the 'hsbCLT-Freeprofile.xml' settings file.",
            "cascade": [
              "dDiameter",
              "dLength",
              "nToolIndex"
            ]
          },
          {
            "trigger": "User edits Diameter or Length and saves via 'Add/Edit Tool Definition'",
            "effect": "The internal MapObject and XML settings are updated. If the name already exists, it is overwritten; otherwise, a new tool entry is created.",
            "cascade": [
              "sToolNames array",
              "dDiameters array",
              "dLengths array",
              "nToolIndices array"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Pocket / Milling",
            "description": "A void cut into the CLT panel, which can be circular (if using a drill path) or a defined profile (freeprofile). The shape can include rounded corners based on the tool radius.",
            "appliedTo": "Selected CLT Element (GenBeam)"
          },
          {
            "type": "CNC Operations (BTL/PFX)",
            "description": "Exports machining instructions defining the contour and depth of the cut, linking the operation to the specified ToolIndex.",
            "appliedTo": "Manufacturing Data Export"
          }
        ]
      },
      "tokens_used": 8161,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts via hsb_ScriptInsert",
          "Check for Debug mode via hsbTSLDebugController",
          "Initialize Settings: Locate or create MapObject from hsbCLT-Freeprofile.xml",
          "Read Tool Definitions: Parse XML for ToolNames, Diameters, Lengths, and ToolIndices",
          "Check DialogMode: If mode is 2, 3, or 4, display specific property sheet and return",
          "Standard Mode: Display main properties in OPM (Geometry, Tool Definition, Visualization, etc.)",
          "User Interaction: User selects Panel (Element) via OPM or command line prompt (on insert)",
          "Geometry Calculation: Calculate pocket position based on coordinates and reference face",
          "Geometry Generation: Create Pocket/ExtrusionBody depending on dimensions and radius",
          "Publishing: Generate graphics, dimrequests, and bounding contours for CAD and ShopDrawings",
          "Completion: Script waits for recalculation trigger or user modification"
        ],
        "conditionalBranches": [
          {
            "condition": "DialogMode is set (internal state for tool management)",
            "path1": {
              "name": "Tool Management Mode",
              "steps": [
                "Check DialogMode value",
                "If Mode=2 (Edit): Show Read-Only Name, Editable Diameter/Length/Index properties",
                "If Mode=3 (Add): Show Editable Name, Diameter, Length, Index properties",
                "If Mode=4 (Remove): Show Dropdown Name list (Read-Only other fields)",
                "Return immediately (skip geometry creation)"
              ]
            },
            "path2": {
              "name": "Standard Execution Mode",
              "steps": [
                "Initialize all main properties",
                "Proceed to Geometry generation",
                "Process Context Menu commands if any"
              ]
            }
          },
          {
            "condition": "User invokes 'Add Tool Definition' or 'Edit Tool Definition'",
            "path1": {
              "name": "Edit Existing Tool",
              "steps": [
                "Set DialogMode to 2",
                "Launch temporary TSL instance dialog",
                "User modifies parameters",
                "Check if ToolIndex is unique",
                "Update internal arrays and MapObject",
                "Rewrite XML settings"
              ]
            },
            "path2": {
              "name": "Add New Tool",
              "steps": [
                "Set DialogMode to 3",
                "Launch temporary TSL instance dialog",
                "User enters new parameters",
                "Check if Name and ToolIndex are unique",
                "Append to internal arrays",
                "Rewrite XML settings"
              ]
            }
          },
          {
            "condition": "User invokes 'Export Settings'",
            "path1": {
              "name": "Overwrite Existing",
              "steps": [
                "Check if settings file exists",
                "Prompt user: 'Are you sure to overwrite existing settings? [No/Yes]'",
                "If Yes: Write MapObject to XML"
              ]
            },
            "path2": {
              "name": "New Export",
              "steps": [
                "Check if settings file exists",
                "If No: Write MapObject to XML immediately"
              ]
            }
          },
          {
            "condition": "Context Menu 'Remove Tool Definition'",
            "path1": {
              "name": "Tool Count > 1",
              "steps": [
                "Enable 'Remove Tool Definition' menu item",
                "On selection: Show DialogMode 4 (Name Dropdown)",
                "Remove selected entry from arrays",
                "Update MapObject"
              ]
            },
            "path2": {
              "name": "Tool Count <= 1",
              "steps": [
                "Hide 'Remove Tool Definition' menu item (code conditional check)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Tool Index Uniqueness",
            "errorMessage": "ShowMultilineNotice: 'The tool could not be set as index is already used for another tool'",
            "recovery": "User must choose a different ToolIndex or select a different Tool Name to edit."
          },
          {
            "check": "Settings File Dependency",
            "errorMessage": "(Implicit) Script may lack tool definitions if XML is missing/corrupt",
            "recovery": "Use 'Import Settings' context menu to reload valid XML file."
          },
          {
            "check": "Tool Parameter Validity (during XML Read)",
            "errorMessage": "(Silent failure) Tools with missing Diameter, Length, Name, or Index are ignored during load.",
            "recovery": "Edit XML manually or remove and re-add the tool definition via the script."
          },
          {
            "check": "GenBeam Selection",
            "errorMessage": "(Implicit) No geometry generated if Element is not assigned or invalid",
            "recovery": "Use 'Add Panel' context menu to select a valid CLT panel."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Tool Selection",
            "how": "OPM Property 'Name' dropdown",
            "effect": "Updates Diameter, Length, and ToolIndex properties automatically based on the selected preset."
          },
          {
            "action": "Modify Geometry",
            "how": "OPM Properties (Height, Width, Depth, Angle, Radius) or Grips",
            "effect": "Recalculates pocket shape and size immediately."
          },
          {
            "action": "Toggle Side",
            "how": "Double Click or Context Menu 'TslDoubleClick'",
            "effect": "Switches the pocket between the Reference Side and Opposite Side of the panel."
          },
          {
            "action": "Stretch Dimensions",
            "how": "Context Menu 'Stretch Dimension'",
            "effect": "Initiates a command-line grip edit to stretch the dimension lines/values."
          },
          {
            "action": "Manage Tools",
            "how": "Context Menu (Add/Edit/Remove Tool Definition, Import/Export Settings)",
            "effect": "Modifies the persistent tool library stored in 'hsbCLT-Freeprofile.xml' and the MapObject."
          },
          {
            "action": "Extend/Remove Radius",
            "how": "Context Menu 'Extend Radius in Direction' or 'Remove Extended Radius'",
            "effect": "Extends the geometric boundary of the radius for representation or machining needs."
          }
        ]
      },
      "tokens_used": 9908,
      "error": null
    },
    "6": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "API error 429: {\"error\":{\"code\":\"1302\",\"message\":\"您的账户已达到速率限制，请您控制请求频率\"}}"
    }
  }
}