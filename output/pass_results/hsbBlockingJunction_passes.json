{
  "filename": "hsbBlockingJunction.mcr",
  "status": "completed",
  "total_tokens": 51080,
  "processing_time": 231.67721390724182,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9215,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly sets 'int bForceModelSpace = true;' during instance creation. It creates physical GenBeam entities using 'bm.dbCreate(...)'. It operates on ElementWallSF and 3D coordinates (CoordSys, Vector3d, Body). No ShopDrawing specific API (sd_*, Sheet, Viewport) or #Type E directives are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF",
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 6873,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select elements|<Enter> to select pair of outer beams|",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select a pair of outer beams|",
              "condition": "_bOnInsert (if no elements selected in step 1)",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Properties Dialog",
            "trigger": "Insertion (if no key used) and MapIO",
            "title": null,
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dLength",
            "type": "PropDouble",
            "displayName": "|Length|",
            "defaultValue": 300,
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the Length of the Blocking|"
          },
          {
            "index": 0,
            "variable": "sDistributionMode",
            "type": "PropString",
            "displayName": "|Mode|",
            "defaultValue": "|Center Offset|",
            "inputType": "dropdown",
            "options": [
              "|Center Offset|",
              "|Interdistance|",
              "|Quantity|"
            ],
            "category": "|Distribution|",
            "description": "|Defines the DistributionMode|"
          },
          {
            "index": 1,
            "variable": "dDistributionValue",
            "type": "PropDouble",
            "displayName": "|Value|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": "|Defines the value specified by the distribution mode|"
          },
          {
            "index": 2,
            "variable": "dOffsetTop",
            "type": "PropDouble",
            "displayName": "|Offset Top|",
            "defaultValue": 479,
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": "|Defines the OffsetTop|"
          },
          {
            "index": 3,
            "variable": "dOffsetBottom",
            "type": "PropDouble",
            "displayName": "|Offset Bottom|",
            "defaultValue": 479,
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": "|Defines the OffsetBottom|"
          },
          {
            "index": 1,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "_DimStyles.sorted()"
            ],
            "category": "|Display|",
            "description": "|Defines the Dimstyle|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Erase Blockings|",
            "handler": "|Erase Blockings|",
            "action": "Erases all generated blocking beams and the script instance",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9253,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates vertical blocking (noggings) at wall junctions or intersections to close wall cavities or provide additional nailing surfaces.",
          "category": "Framing",
          "typicalUseCase": "Inserting vertical timber blockings between intersecting walls or between specific beams in a wall frame to fire-stop the cavity or support sheathing edges."
        },
        "parameters": [
          {
            "name": "dLength",
            "technicalDefault": "300",
            "businessMeaning": "The length of the blocking beam, typically corresponding to the width of the wall or the depth of the cavity to be closed.",
            "validRange": "45 - 600",
            "unit": "mm",
            "affectsOutput": "Determines the physical size of the blocking beams along the wall's X-axis (width). Affects spacing calculation when using 'Interdistance' mode."
          },
          {
            "name": "sDistributionMode",
            "technicalDefault": "|Center Offset|",
            "businessMeaning": "Defines the algorithm used to position the blocking beams vertically along the junction.",
            "validRange": "N/A",
            "unit": "enum",
            "affectsOutput": "Changes how the 'Value' property is interpreted and how the blocking pattern is calculated (Center-based, Spacing-based, or Count-based)."
          },
          {
            "name": "dDistributionValue",
            "technicalDefault": "0",
            "businessMeaning": "The numerical input that drives the distribution. In 'Center Offset' mode, it is the distance from the centerline. In 'Interdistance', it is the gap between blockings. In 'Quantity', it is the number of blockings.",
            "validRange": "0 - 5000",
            "unit": "mm or count",
            "affectsOutput": "Controls the vertical placement and frequency of the generated blocking beams."
          },
          {
            "name": "dOffsetTop",
            "technicalDefault": "479",
            "businessMeaning": "The distance from the top boundary of the junction (e.g., bottom of floor header or top plate) to the top edge of the highest blocking.",
            "validRange": "0 - 1000",
            "unit": "mm",
            "affectsOutput": "Sets the upper vertical limit for the blocking distribution, creating a clear zone if needed."
          },
          {
            "name": "dOffsetBottom",
            "technicalDefault": "479",
            "businessMeaning": "The distance from the bottom boundary of the junction (e.g., floor plate or sill) to the bottom edge of the lowest blocking.",
            "validRange": "0 - 1000",
            "unit": "mm",
            "affectsOutput": "Sets the lower vertical limit for the blocking distribution, creating a clear zone if needed."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "null",
            "businessMeaning": "The CAD dimension style used to display preview dimensions and markers during insertion.",
            "validRange": "N/A",
            "unit": "string",
            "affectsOutput": "Visual representation only; does not change physical geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User changes sDistributionMode",
            "effect": "The display name and functional meaning of dDistributionValue changes dynamically.",
            "cascade": [
              "dDistributionValue"
            ]
          },
          {
            "trigger": "User changes dLength",
            "effect": "In 'Interdistance' mode, this changes the effective center-to-center spacing (Gap + Length).",
            "cascade": [
              "Blocking geometry"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam",
            "description": "Vertical blocking beams (noggings) created at the wall junction.",
            "appliedTo": "The selected ElementWallSF or the element associated with the selected beams."
          }
        ]
      },
      "tokens_used": 9172,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User executes script (hsbBlockingJunction)",
          "2. Script checks insertCycleCount; terminates if > 1 (cleanup check)",
          "3. Script checks for Execution Key (Catalog load) or executes standard Properties Dialog",
          "4. Prompt: 'Select elements <Enter> to select pair of outer beams' (Target: ElementWallSF)",
          "5. [Decision] Did user select Elements?",
          "6. [Path Yes - Element Plugin]: Script iterates selected Elements. For each Element, spawns a new script instance in 'Scan Mode' (Mode 0). Original instance erased.",
          "7. [Path No - Manual Insertion]: User presses Enter. Prompt changes to 'Select a pair of outer beams' (Target: Beam).",
          "8. User selects Beams.",
          "9. Script validates selection (Must be >= 2 beams, belonging to same Element).",
          "10. [Validation Fail]: Instance erased. Workflow ends.",
          "11. [Validation Success]: Element and Beams stored. Mode set to 1 (Distribution).",
          "12. Script calculates geometry based on Properties (Length, Offsets, Distribution Mode).",
          "13. Script creates GenBeam entities (Blocking) and assigns them to Element.",
          "14. Script attaches grips and dimensions if applicable.",
          "15. Instance completes and remains in model for future updates."
        ],
        "conditionalBranches": [
          {
            "condition": "User Input at first prompt",
            "path1": {
              "name": "Element Selection (Automatic)",
              "steps": [
                "Select ElementWallSF entities",
                "Script creates attached instances (Mode 0) to scan wall",
                "Script identifies junctions/intersections",
                "Child instances generated for specific blocking locations"
              ]
            },
            "path2": {
              "name": "Beam Selection (Manual)",
              "steps": [
                "Press Enter at first prompt",
                "Select 2 or more beams",
                "Script filters beams (must be same Element, perpendicular to Wall X)",
                "Sets Mode to 1 (Direct Distribution)",
                "Generates blocking between selected beams only"
              ]
            }
          },
          {
            "condition": "sDistributionMode Property Value",
            "path1": {
              "name": "Center Offset",
              "steps": [
                "Interpret dDistributionValue as distance from center",
                "Place blockings symmetrically around centerline"
              ]
            },
            "path2": {
              "name": "Interdistance",
              "steps": [
                "Interpret dDistributionValue as gap between blockings",
                "Calculate array of blockings based on fixed spacing"
              ]
            },
            "path3": {
              "name": "Quantity",
              "steps": [
                "Interpret dDistributionValue as count of blockings",
                "Calculate equal spacing to fit the quantity within the range"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection Count",
            "errorMessage": "Script implicitly fails if beams < 2 (erases instance).",
            "recovery": "Select at least 2 beams belonging to the same wall element."
          },
          {
            "check": "Beam Element Association",
            "errorMessage": "Script filters out beams from different elements. If resulting array < 2, instance erases.",
            "recovery": "Ensure selected beams are all part of the same timber element."
          },
          {
            "check": "Offset Properties",
            "errorMessage": "Properties (dOffsetTop, dOffsetBottom) reset to 0 if negative value entered.",
            "recovery": "Enter positive values for offsets."
          },
          {
            "check": "Distribution Mode Index",
            "errorMessage": "If sDistributionMode is invalid (index < 0), it resets to Default ('Center Offset').",
            "recovery": "Script handles recovery automatically by resetting to default."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry via OPM",
            "how": "Change properties (Length, Offsets, Distribution Value) in AutoCAD Properties Palette",
            "effect": "Script recalculates and regenerates the blocking beams immediately."
          },
          {
            "action": "Interactive Grip Edit",
            "how": "Select script instance, drag the square grip point appearing on the blocking dimension",
            "effect": "Updates the 'Distribution Value' (spacing or offset) dynamically. Does not apply if Mode is 'Quantity'."
          },
          {
            "action": "Erase Blockings",
            "how": "Right-click context menu -> 'Erase Blockings'",
            "effect": "Deletes all generated GenBeam blockings associated with the script and removes the script instance."
          },
          {
            "action": "Change Distribution Mode",
            "how": "Right-click context menu commands (e.g., 'Change Distribution to Interdistance')",
            "effect": "Updates the 'Mode' property and forces a recalculation."
          }
        ]
      },
      "tokens_used": 10713,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbBlockingJunction\n\n## Overview\nAutomatically generates vertical blocking (noggings) at wall junctions or intersections. This script is used to close wall cavities or provide additional nailing surfaces by placing timber between selected beams.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script only works in Model Space. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: `ElementWallSF` (Wall) or `GenBeam` (Beams).\n- **Minimum Beam Count**: 2 beams (when using manual beam selection).\n- **Required Settings**: None required; all settings are managed via script properties.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbBlockingJunction.mcr`\n\n### Step 2: Select Elements or Beams\n```\nCommand Line: Select elements <Enter> to select pair of outer beams\nAction: You have two options:\n```\n1. **Automatic (Element Mode)**: Select one or more Wall elements (`ElementWallSF`). The script will automatically scan the wall and create blockings at junctions.\n2. **Manual (Beam Mode)**: Press **Enter**. The prompt will change to ask for beams.\n\n### Step 3: Select Beams (Manual Mode Only)\nIf you pressed Enter in Step 2:\n```\nCommand Line: Select a pair of outer beams\nAction: Select at least two beams that belong to the same wall element.\n```\n*Note: If you select beams from different elements, the script will fail and erase itself.*\n\n### Step 4: Configure Properties\nOnce the beams or elements are selected, the **Properties Palette** will appear. Adjust the parameters (Length, Distribution Mode, Offsets) as needed. The blockings will generate automatically based on these settings.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Length | number | 300 | Defines the length of the blocking beams (mm). |\n| Mode | dropdown | Center Offset | Defines how blockings are distributed vertically. Options: Center Offset, Interdistance, Quantity. |\n| Value | number | 0 | The specific value for the selected Mode (e.g., distance from center, gap between blockings, or number of blockings). |\n| Offset Top | number | 479 | Distance from the top boundary to the top edge of the highest blocking (mm). |\n| Offset Bottom | number | 479 | Distance from the bottom boundary to the bottom edge of the lowest blocking (mm). |\n| Dimstyle | dropdown | (Current) | The CAD dimension style used for preview dimensions. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Erase Blockings | Deletes all generated blocking beams and removes the script instance from the drawing. |\n| Change Distribution to [Mode] | Quickly switches the Distribution Mode (e.g., to Interdistance or Quantity) and recalculates the layout. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not use external settings files; all configuration is done via the Properties Palette.\n\n## Tips\n- **Grip Editing**: After insertion, select the script instance and drag the **square grip** on the dimension line to dynamically adjust the spacing (Value).\n- **Mode Behavior**:\n    - **Interdistance**: The script calculates spacing as `Gap + Length`.\n    - **Center Offset**: Places blockings symmetrically around the wall's centerline based on the Value.\n- **Same Element Rule**: When manually selecting beams, ensure they are all part of the same timber element. Mixing elements will cause the script to exit.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected beams?**\n  - A: This usually happens if you selected fewer than 2 beams, or if the selected beams belong to different elements. Ensure all beams are part of the same wall element.\n- **Q: Can I change the spacing after inserting without opening the properties?**\n  - A: Yes, select the script instance in the model and use the square grip to slide the blockings up/down or adjust spacing interactively.\n- **Q: What does \"Interdistance\" mode actually do?**\n  - A: It creates a repeating pattern of blockings where the \"Value\" represents the gap between the blockings. The script adds the blockings length to this value to determine the center-to-center spacing."
      },
      "tokens_used": 5854,
      "error": null
    }
  }
}