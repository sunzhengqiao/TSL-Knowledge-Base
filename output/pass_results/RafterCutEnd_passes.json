{
  "filename": "RafterCutEnd.mcr",
  "status": "completed",
  "total_tokens": 30210,
  "processing_time": 316.91116070747375,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "04.11.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Pilot version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5303,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly creates instances in Model Space using 'tsl.dbCreate(..., _kModelSpace, ...)'. It selects 'Beam()' entities, operates on 'bm.quader()', and performs 'BeamCut' operations. No Paper Space indicators ('_Viewport', 'sd_' prefixes, or #Type E) are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 2617,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select one or more beams|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dDepthMayor",
            "type": "PropDouble",
            "displayName": "|Main Depth|",
            "defaultValue": "U(50)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dLengthMayor",
            "type": "PropDouble",
            "displayName": "|Main Lenght|",
            "defaultValue": "U(200)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dDepthMinor",
            "type": "PropDouble",
            "displayName": "|Second Depth|",
            "defaultValue": "U(10)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dLengthMinor",
            "type": "PropDouble",
            "displayName": "|Second Length|",
            "defaultValue": "U(100)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5725,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a complex stepped or bird's-mouth style cut at the end of a rafter or beam, consisting of two distinct horizontal cuts connected by a sloped surface.",
          "category": "Hardware/Machining",
          "typicalUseCase": "Preparing a rafter tail to sit on a top plate or creating a specific notch to accommodate another structural member intersecting at an angle."
        },
        "parameters": [
          {
            "name": "dDepthMayor",
            "technicalDefault": "U(50)",
            "businessMeaning": "The depth of the primary (first) cut measured vertically from the top surface of the beam.",
            "validRange": "0mm to Beam Depth",
            "unit": "mm",
            "affectsOutput": "Determines how far down the first cutting volume removes material. If set to 0, the first cut is omitted."
          },
          {
            "name": "dLengthMayor",
            "technicalDefault": "U(200)",
            "businessMeaning": "The horizontal distance along the beam axis from the reference end to the end of the first cut.",
            "validRange": "0mm to Beam Length",
            "unit": "mm",
            "affectsOutput": "Positions the corner point where the first cut ends and the sloped section begins."
          },
          {
            "name": "dDepthMinor",
            "technicalDefault": "U(10)",
            "businessMeaning": "The depth of the secondary (second) cut measured vertically from the top surface of the beam, defining the seat height of the notch.",
            "validRange": "0mm to Beam Depth",
            "unit": "mm",
            "affectsOutput": "Determines the vertical position of the second cutting volume. If set to 0, the second cut is omitted."
          },
          {
            "name": "dLengthMinor",
            "technicalDefault": "U(100)",
            "businessMeaning": "The additional horizontal extension of the second cut beyond the first cut.",
            "validRange": "0mm to Beam Length",
            "unit": "mm",
            "affectsOutput": "Determines the total length of the notch (LengthMayor + LengthMinor) and the steepness of the connecting slope."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dDepthMayor is 0",
            "effect": "The first cutting body is skipped, potentially altering the calculation of the connecting slope.",
            "cascade": []
          },
          {
            "trigger": "dDepthMinor is 0",
            "effect": "The second cutting body is skipped.",
            "cascade": []
          },
          {
            "trigger": "Both depths are > 0",
            "effect": "The connecting sloped cut is generated between the two cut endpoints.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "BeamCut",
            "description": "Generates up to three subtractive volumes to create a stepped profile: two primary cuts perpendicular to the beam face and a connecting angled cut.",
            "appliedTo": "The selected GenBeam."
          },
          {
            "type": "VisualizationSymbol",
            "description": "Draws 3D crosshairs at the intersection of the first depth and first length to mark the critical geometry corner.",
            "appliedTo": "Model Space (visual reference)."
          }
        ]
      },
      "tokens_used": 4417,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script (Master Instance initialized)",
          "2. Check insertion cycle count (Cleanup phase for ghost instances)",
          "3. Show Property Dialog (User inputs Depth/Length parameters)",
          "4. Prompt User to Select Beams via Command Line",
          "5. If selection is valid, iterate through selected beams",
          "6. For each beam, create a Satellite Instance in Model Space attached to that specific beam",
          "7. Transfer current property values from Master to Satellite via Catalog",
          "8. Master Instance erases itself and terminates",
          "9. [Satellite] Initialize and retrieve properties from Catalog",
          "10. [Satellite] Validate that a beam is attached and valid",
          "11. [Satellite] Calculate Coordinate System relative to beam (aligning X to beam axis, Z to vertical)",
          "12. [Satellite] Project insertion point to the start face of the beam",
          "13. [Satellite] Conditionally generate Primary Cut (if dDepthMayor > 0)",
          "14. [Satellite] Conditionally generate Secondary Cut (if dDepthMinor > 0)",
          "15. [Satellite] Conditionally generate Connecting Slope Cut (if either depth > 0)",
          "16. [Satellite] Draw visual crosshairs at intersection point"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count > 1",
            "path1": {
              "name": "Cleanup Path",
              "steps": [
                "Erase current instance",
                "Return immediately"
              ]
            },
            "path2": {
              "name": "Normal Execution Path",
              "steps": [
                "Show Dialog",
                "Prompt for Entity Selection"
              ]
            }
          },
          {
            "condition": "User Selection (PrEntity)",
            "path1": {
              "name": "Selection Confirmed",
              "steps": [
                "Loop through selected beams",
                "Create satellite instances"
              ]
            },
            "path2": {
              "name": "Selection Cancelled/Empty",
              "steps": [
                "Script terminates"
              ]
            }
          },
          {
            "condition": "Value of 'dDepthMayor' Property",
            "path1": {
              "name": "Greater than 0",
              "steps": [
                "Calculate Cut 1 geometry",
                "Execute BeamCut for main volume"
              ]
            },
            "path2": {
              "name": "Equal to 0",
              "steps": [
                "Skip Cut 1 generation"
              ]
            }
          },
          {
            "condition": "Value of 'dDepthMinor' Property",
            "path1": {
              "name": "Greater than 0",
              "steps": [
                "Calculate Cut 2 geometry",
                "Execute BeamCut for second volume"
              ]
            },
            "path2": {
              "name": "Equal to 0",
              "steps": [
                "Skip Cut 2 generation"
              ]
            }
          },
          {
            "condition": "Calculation of Connecting Slope",
            "path1": {
              "name": "dDepthMinor > 0 OR dDepthMayor > 0",
              "steps": [
                "Calculate vector between Cut 1 and Cut 2",
                "Create angled cutting body (Cut 3)"
              ]
            },
            "path2": {
              "name": "Both depths are 0",
              "steps": [
                "No cuts generated",
                "Beam remains unchanged"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Attachment Validity",
            "errorMessage": "None (Silent)",
            "recovery": "Ensure a valid GenBeam is selected during insertion. If the beam is deleted or invalid, the satellite instance erases itself."
          },
          {
            "check": "Insertion Point Projection",
            "errorMessage": "None (Internal Calculation)",
            "recovery": "The script automatically projects the origin to the beam face. No user recovery is needed as this is calculated programmatically."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Cut Dimensions",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing 'Main Depth', 'Main Length', 'Second Depth', or 'Second Length' triggers a recalculation of the cutting bodies, resizing or removing the cuts and slope dynamically."
          },
          {
            "action": "Move Script Instance",
            "how": "Grip Edit",
            "effect": "No effect. The script overrides the grip position by recalculating the insertion point (`_Pt0`) to the nearest beam face coordinate system on every update."
          }
        ]
      },
      "tokens_used": 6750,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# RafterCutEnd.mcr\n\n## Overview\nCreates a complex stepped or bird's-mouth style cut at the end of a rafter or beam. This script generates two distinct horizontal cuts connected by a sloped surface, useful for seating rafters on top plates or creating specific notches.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be run in the 3D model to modify beam geometry. |\n| Paper Space | No | Not designed for 2D drawings or viewports. |\n| Shop Drawing | No | Does not generate 2D views or dimensions. |\n\n## Prerequisites\n- **Required Entities**: At least one `GenBeam` (General Beam) present in the model.\n- **Minimum Beam Count**: 1.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT`\n**Action**: Browse to the script location and select `RafterCutEnd.mcr`.\n\n### Step 2: Configure Cut Parameters\n**Action**: A dialog or property palette appears upon insertion. Enter the dimensions for the cut:\n- **Main Depth**: The vertical depth of the first cut from the top of the beam.\n- **Main Length**: The horizontal length of the first cut.\n- **Second Depth**: The vertical depth of the second (seat) cut.\n- **Second Length**: The additional horizontal extension of the second cut.\nConfirm the values to proceed.\n\n### Step 3: Select Beams\n```\nCommand Line: Select one or more beams\n```\n**Action**: Click on the beam(s) you wish to modify in the 3D model. Press `Enter` to confirm selection.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Main Depth | Number | 50 mm | Vertical depth of the primary cut measured from the top surface. |\n| Main Length | Number | 200 mm | Horizontal distance of the primary cut from the beam end. |\n| Second Depth | Number | 10 mm | Vertical depth of the secondary cut (seat height). |\n| Second Length | Number | 100 mm | Additional horizontal length of the secondary cut. |\n\n## Right-Click Menu Options\nNone. The script does not add custom items to the context menu.\n\n## Settings Files\nNone. This script operates independently of external XML or settings files.\n\n## Tips\n- **Modify Existing Cuts**: You can change the dimensions at any time by selecting the script instance in the model and updating the values in the **Properties (OPM)** palette.\n- **Remove Cuts**: Setting a Depth value to `0` will skip that specific cut, allowing you to create simple notches or just a sloped cut.\n- **Visual Reference**: The script draws 3D crosshairs at the intersection of the first depth and length to help visualize the corner point.\n\n## FAQ\n- **Q: Can I move the cut to the other end of the beam?**\n  A: No. Moving the script instance via grips has no effect; the script automatically snaps the cut geometry to the beam's start face. To cut the other end, you must use a different tool or script designed for that purpose.\n- **Q: How do I create a simple 90-degree cut?**\n  A: Set the \"Second Depth\" and \"Second Length\" to `0`. This will generate only the first perpendicular cut.\n- **Q: Why did my beam disappear?**\n  A: The script generates a cutting operation. If the cut dimensions exceed the size of the beam, the beam geometry might be completely removed. Check the dimensions in the Properties panel and reduce them to fit within the beam's physical size."
      },
      "tokens_used": 5398,
      "error": null
    }
  }
}