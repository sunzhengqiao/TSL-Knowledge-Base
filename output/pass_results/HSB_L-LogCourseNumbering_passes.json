{
  "filename": "HSB_L-LogCourseNumbering.mcr",
  "status": "completed",
  "total_tokens": 32047,
  "processing_time": 326.20037293434143,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "23.01.2008",
            "author": "",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "11.02.2008",
            "author": "",
            "changes": "Erase implemented / Made the Scriptnames variables"
          },
          {
            "version": "1.02",
            "date": "20.02.2008",
            "author": "",
            "changes": "Adjust layout of table"
          },
          {
            "version": "2.00",
            "date": "09.10.2012",
            "author": "",
            "changes": "Add to Content-Dutch"
          },
          {
            "version": "2.01",
            "date": "10.10.2012",
            "author": "",
            "changes": "Add insertpoint. Scriptname is shown at this point."
          },
          {
            "version": "2.02",
            "date": "10.10.2012",
            "author": "",
            "changes": "Add offset"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5393,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly prompts for a viewport using '_Viewport.append(getViewport(...))', retrieves the viewport coordinate system via 'vp.coordSys()', and transforms points between Model Space and Paper Space using 'ms2ps'. It processes 'ElementLog' data to generate annotations within the selected viewport context."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Viewport"
          ],
          "minimumBeams": 0,
          "requiredSpace": "The script must be inserted in a Layout (Paper Space) containing a viewport that links to a valid hsbCAD Element of type 'ElementLog'.",
          "requiredSettings": []
        }
      },
      "tokens_used": 2239,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select a position",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeperator01",
            "type": "PropString",
            "displayName": "Style",
            "defaultValue": "",
            "inputType": "text",
            "category": "Style",
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension Style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": "Style",
            "description": null
          },
          {
            "index": 0,
            "variable": "nColorText",
            "type": "PropInt",
            "displayName": "Color text",
            "defaultValue": "-1",
            "inputType": "integer",
            "category": "Style",
            "description": null
          },
          {
            "index": 2,
            "variable": "sSeperator02",
            "type": "PropString",
            "displayName": "Positioning",
            "defaultValue": "",
            "inputType": "text",
            "category": "Positioning",
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffsetText",
            "type": "PropDouble",
            "displayName": "Offset text",
            "defaultValue": "2mm",
            "inputType": "number",
            "category": "Positioning",
            "description": null
          },
          {
            "index": 3,
            "variable": "sPosition",
            "type": "PropString",
            "displayName": "Position",
            "defaultValue": "Vertical left",
            "inputType": "dropdown",
            "options": [
              "Vertical left",
              "Vertical right"
            ],
            "category": "Positioning",
            "description": null
          },
          {
            "index": 4,
            "variable": "sUsePSUnits",
            "type": "PropString",
            "displayName": "Offset in paperspace units",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "Positioning",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5925,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates numerical labels for each log course in a log wall, projected onto a 2D layout view.",
          "category": "ShopDrawing",
          "typicalUseCase": "Creating production drawings for log homes where individual logs need to be identified for assembly or manufacturing lists."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "\"\"",
            "businessMeaning": "Selects the visual style (font, arrow type, text size) for the annotation labels from the CAD system's available dimension styles.",
            "validRange": "Any Dimension Style currently loaded in the drawing",
            "unit": "Style Name",
            "affectsOutput": "Changes the font, height, and overall appearance of the course numbers."
          },
          {
            "name": "nColorText",
            "technicalDefault": "-1",
            "businessMeaning": "Defines the display color of the log course numbers.",
            "validRange": "-1 (Default/ByLayer) to 255 (Standard AutoCAD Colors)",
            "unit": "Color Index",
            "affectsOutput": "Visual visibility of the annotations on the drawing layout."
          },
          {
            "name": "dOffsetText",
            "technicalDefault": "2mm",
            "businessMeaning": "Sets the distance between the log wall and the course number labels.",
            "validRange": "1mm to 50mm depending on drawing scale and wall size",
            "unit": "mm",
            "affectsOutput": "Moves the label column closer to or further from the wall geometry."
          },
          {
            "name": "sPosition",
            "technicalDefault": "Vertical left",
            "businessMeaning": "Determines which side of the log wall the labels are placed on.",
            "validRange": "Vertical left, Vertical right",
            "unit": "Enumerated",
            "affectsOutput": "Flips the side of the wall where the numbering sequence appears."
          },
          {
            "name": "sUsePSUnits",
            "technicalDefault": "Yes",
            "businessMeaning": "Determines if the text offset is calculated based on Paper Space (print size) or Model Space (real-world size).",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If 'Yes', the gap remains constant on paper regardless of viewport zoom. If 'No', the gap represents a fixed physical distance."
          },
          {
            "name": "sSeperator01",
            "technicalDefault": "\"\"",
            "businessMeaning": "UI separator header for the 'Style' category.",
            "validRange": "N/A",
            "unit": "N/A",
            "affectsOutput": "None (UI Organization only)."
          },
          {
            "name": "sSeperator02",
            "technicalDefault": "\"\"",
            "businessMeaning": "UI separator header for the 'Positioning' category.",
            "validRange": "N/A",
            "unit": "N/A",
            "affectsOutput": "None (UI Organization only)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sUsePSUnits set to 'Yes'",
            "effect": "The value of dOffsetText is multiplied by the Viewport Scale factor to calculate the final physical offset.",
            "cascade": [
              "dOffsetText"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Annotation",
            "description": "Numerical text labels (1, 2, 3...) aligned with the vertical height (Y-axis) of each log course in the selected wall.",
            "appliedTo": "Paper Space Layout (via selected Viewport)"
          }
        ]
      },
      "tokens_used": 5303,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script inserted into Paper Space",
          "2. Configuration dialog displays (showDialog)",
          "3. User prompted to select an insertion point (_Pt0) in Paper Space",
          "4. User prompted to select a viewport (_Viewport) containing the log wall element",
          "5. Script validates viewport attachment",
          "6. Script retrieves Element and Coordinate System from selected Viewport",
          "7. Script retrieves 'ElementLog' data (log courses) and wall outline",
          "8. Script determines Label Position (Left/Right) based on 'sPosition' property",
          "9. Script calculates text offset based on 'dOffsetText' and 'sUsePSUnits' property",
          "10. Script draws numerical labels (1, 2, 3...) at each log course height in Paper Space"
        ],
        "conditionalBranches": [
          {
            "condition": "Viewport attached to script instance",
            "path1": {
              "name": "No Viewport",
              "steps": [
                "Script detects _Viewport.length() == 0",
                "Script executes eraseInstance()",
                "Execution halts"
              ]
            },
            "path2": {
              "name": "Viewport Found",
              "steps": [
                "Script retrieves element from viewport",
                "Checks if element is valid (el.bIsValid())",
                "Proceeds to calculation"
              ]
            }
          },
          {
            "condition": "Element Validity Check",
            "path1": {
              "name": "Invalid Element",
              "steps": [
                "Script detects el.bIsValid() is false",
                "Script returns (halts execution)",
                "No geometry drawn"
              ]
            },
            "path2": {
              "name": "Valid Element",
              "steps": [
                "Extracts ElementLog data",
                "Calculates outline points",
                "Proceeds to draw loop"
              ]
            }
          },
          {
            "condition": "Offset Unit Setting (sUsePSUnits)",
            "path1": {
              "name": "Paper Space Units (Yes)",
              "steps": [
                "dOffsetText is multiplied by Viewport Scale (dVpScale)",
                "Result determines physical gap from wall"
              ]
            },
            "path2": {
              "name": "Model Space Units (No)",
              "steps": [
                "dOffsetText used as raw Model Space value",
                "Result determines physical gap from wall"
              ]
            }
          },
          {
            "condition": "Text Position Setting (sPosition)",
            "path1": {
              "name": "Vertical Left",
              "steps": [
                "Calculates ptSide relative to ptLeft of wall",
                "Sets alignment flag dxFlag to -1",
                "Text aligns right"
              ]
            },
            "path2": {
              "name": "Vertical Right",
              "steps": [
                "Calculates ptSide relative to ptRight of wall",
                "Sets alignment flag dxFlag to 1",
                "Text aligns left"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "None (Silent Failure)",
            "recovery": "The script instance is automatically erased. User must re-insert the script and ensure a viewport is selected."
          },
          {
            "check": "Viewport Data Integrity",
            "errorMessage": "None (Silent Failure)",
            "recovery": "Ensure the selected viewport links to a valid hsbCAD Element (ElementLog). If the viewport is empty or invalid, the script stops without drawing."
          },
          {
            "check": "Wall Outline Availability",
            "errorMessage": "None (Silent Failure)",
            "recovery": "If the element has no valid outline points (arPtElX.length == 0), the script stops. Ensure the log wall has valid geometry."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Insertion Point",
            "how": "Grip Edit",
            "effect": "Moving the insertion point (_Pt0) shifts the horizontal location of the entire number column in Paper Space while maintaining alignment with the projected wall geometry."
          },
          {
            "action": "Change Label Side",
            "how": "OPM Property (sPosition)",
            "effect": "Switches the column of numbers between the Left side and Right side of the log wall projection."
          },
          {
            "action": "Adjust Offset Gap",
            "how": "OPM Property (dOffsetText)",
            "effect": "Increases or decreases the distance between the log wall and the numbers."
          },
          {
            "action": "Change Visual Style",
            "how": "OPM Properties (sDimStyle, nColorText)",
            "effect": "Updates the font style, text height, and color of the numbers immediately."
          }
        ]
      },
      "tokens_used": 7102,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_L-LogCourseNumbering.mcr\n\n## Overview\nThis script automatically generates numerical labels (1, 2, 3...) for each log course in a log wall. It projects these numbers onto a 2D layout view to assist with assembly planning and manufacturing lists.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for annotations in layouts. |\n| Paper Space | Yes | Must be inserted in a Layout tab. |\n| Shop Drawing | Yes | Specifically used for creating production drawings. |\n\n## Prerequisites\n- **Required Entities**: A valid `ElementLog` (Log Wall) must exist in the model.\n- **Minimum Beam Count**: N/A (The script reads the entire log wall element, not individual beams).\n- **Required Settings**: A Layout (Paper Space) containing a viewport that is linked to the log wall element.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Browse and select `HSB_L-LogCourseNumbering.mcr`.\n3. Click **Open**.\n\n### Step 2: Configure Initial Settings\nA dialog may appear to set the initial Dimension Style. Configure as needed and confirm.\n\n### Step 3: Set Insertion Point\n```\nCommand Line: Select a position\nAction: Click in the Paper Space layout where you want the column of numbers to start (usually aligned with the top or bottom of the wall).\n```\n\n### Step 4: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the border (frame) of the viewport that displays the log wall you wish to number.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimension Style | Dropdown | (Current) | Selects the text style and height from the drawing's available dimension styles. |\n| Color text | Integer | -1 | Sets the color of the numbers. (-1 = ByLayer, 1-255 = Specific AutoCAD color). |\n| Offset text | Number | 2mm | The distance between the log wall and the number labels. |\n| Position | Dropdown | Vertical left | Determines which side of the wall the numbers are placed (Vertical left or Vertical right). |\n| Offset in paperspace units | Dropdown | Yes | If \"Yes\", the offset is a fixed distance on the printed paper. If \"No\", the offset is a real-world Model Space distance. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are available for this script. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: This script relies on standard AutoCAD dimension styles and does not require external XML configuration files.\n\n## Tips\n- **Consistent Offsets**: Keep \"Offset in paperspace units\" set to **Yes** if you want the gap between the wall and the text to look the same on paper, regardless of the viewport zoom scale.\n- **Moving Labels**: If you need to shift the entire column of numbers horizontally, select the script instance and drag the grip point (the insertion point).\n- **Visibility**: If the numbers do not appear, ensure the selected viewport is actually attached to a valid log wall element (`ElementLog`). If the viewport is empty, the script will erase itself.\n\n## FAQ\n- **Q: Why are my numbers huge or tiny?**\n- A: Check the **Dimension Style** property. Ensure the text height defined in that style is appropriate for your drawing scale.\n- **Q: I moved the viewport, but the numbers stayed in the same place.**\n- A: The numbers are created in Paper Space, while the wall is in Model Space. You must move the script insertion point (the grip) or re-select the viewport to update the association.\n- **Q: What does \"Color text -1\" mean?**\n- A: It means the color is controlled by the Layer color property. Change the script's layer color to change the number color."
      },
      "tokens_used": 6085,
      "error": null
    }
  }
}