{
  "filename": "hsb_DrawPosNum&DimSpaceStud.mcr",
  "status": "completed",
  "total_tokens": 33725,
  "processing_time": 355.53103518486023,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.5",
            "date": "08.01.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-21034 bugfix compile error"
          },
          {
            "version": "1.4",
            "date": "16.06.2023",
            "author": "Marsel Nakuci",
            "changes": "HSB-18065: Include \"Lowfield-SpaceStudAssembly\" TSLs"
          },
          {
            "version": "1.3",
            "date": "22.06.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-15357: Include \"GC-SpaceStudAssembly\" TSLs"
          },
          {
            "version": "1.0",
            "date": "28.08.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "21.09.2011",
            "author": "",
            "changes": "Add running dimension on top"
          },
          {
            "version": "1.2",
            "date": "21.09.2011",
            "author": "",
            "changes": "Add the display of the metalparts"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "hsb_SpaceStudAssembly",
          "GC-SpaceStudAssembly",
          "Lowfield-SpaceStudAssembly",
          "hsb_NailPlate"
        ]
      },
      "tokens_used": 6175,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getShopDrawView for input, casts _Entity[0] to ShopDrawView, retrieves ViewData using _kOnGenerateShopDrawing, and performs transformBy(ms2ps) to draw geometry and dimensions in Paper Space."
        },
        "prerequisites": {
          "requiredEntities": [
            "ShopDrawView",
            "hsb_SpaceStudAssembly or GC-SpaceStudAssembly or Lowfield-SpaceStudAssembly"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be inserted into a Paper Space layout containing a valid ShopDrawView with the specific SpaceStud assemblies.",
          "requiredSettings": []
        }
      },
      "tokens_used": 4953,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Pick a point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getShopDrawView",
              "promptOriginal": "|Select the view entity from which the information is taken|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dim Style PosNom",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dTextH",
            "type": "PropDouble",
            "displayName": "Text Height",
            "defaultValue": "U(40)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimStyleDims",
            "type": "PropString",
            "displayName": "Dim Style Dimensions",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Offset dim Lines",
            "defaultValue": "U(100)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "3",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4422,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Annotates shop drawings with position numbers, nail plate representations, and dimensions (width/height) for Space Stud assemblies in a selected view.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used during production detailing to automatically generate 2D layout labels and dimensions for wall panels in Paper Space, ensuring position numbers and assembly extents are clearly documented."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "\"\"",
            "businessMeaning": "The dimension style used for the Position Number text label formatting.",
            "validRange": "Any standard dimension style configured in the drawing template",
            "unit": "Style Name (String)",
            "affectsOutput": "Determines the font, arrow style (if any), and text format of the position labels."
          },
          {
            "name": "dTextH",
            "technicalDefault": "U(40)",
            "businessMeaning": "The text height for the Position Number labels.",
            "validRange": "2.0 - 10.0 mm (typical paper heights)",
            "unit": "mm",
            "affectsOutput": "Directly scales the size of the position number text in the drawing."
          },
          {
            "name": "sDimStyleDims",
            "technicalDefault": "\"\"",
            "businessMeaning": "The dimension style used for the linear measurement lines (top, bottom, left dimensions).",
            "validRange": "Any standard dimension style configured in the drawing template",
            "unit": "Style Name (String)",
            "affectsOutput": "Controls the appearance (arrows, ticks, precision) of the dimension lines indicating stud spacing and overall height."
          },
          {
            "name": "dOffset",
            "technicalDefault": "U(100)",
            "businessMeaning": "The clearance distance between the physical assembly and the dimension lines.",
            "validRange": "10 - 200 mm (depending on drawing scale and clutter)",
            "unit": "mm",
            "affectsOutput": "Moves the dimension lines closer to or further away from the wall geometry to prevent overlaps."
          },
          {
            "name": "nColor",
            "technicalDefault": "3",
            "businessMeaning": "The CAD color used for drawing the position numbers and nail plate representations.",
            "validRange": "1 - 255 (CAD Color Index)",
            "unit": "Color Index",
            "affectsOutput": "Changes the visual color of the generated annotations and metal parts."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sDimStyle or sDimStyleDims is changed",
            "effect": "If the selected style enforces a fixed text height, it may override the value set in dTextH.",
            "cascade": [
              "dTextH"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "DimensionLine",
            "description": "Linear dimensions showing the overall width (top/bottom) and height (left) of the stud assembly.",
            "appliedTo": "Space Stud Assembly bounding box."
          },
          {
            "type": "Text",
            "description": "Position number label placed at the user-defined insertion point.",
            "appliedTo": "Space Stud Assembly."
          },
          {
            "type": "MetalPartRepresentation",
            "description": "2D outlines of nail plates found within the assembly, projected into the view.",
            "appliedTo": "hsb_NailPlate instances inside the assembly."
          }
        ]
      },
      "tokens_used": 5116,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution triggered (Insert or Recalculate)",
          "[Insert Phase] User prompted to pick a point for text location",
          "[Insert Phase] User prompted to select a ShopDrawView entity",
          "[Insert Phase] Script saves selected ShopDrawView and Point, then terminates",
          "[Generate Phase] Script checks for linked entities (ShopDrawView)",
          "Validate: Check if _Entity array contains elements. If empty, erase instance and exit",
          "Retrieve linked ShopDrawView and validate",
          "Retrieve ViewData associated with the ShopDrawView from _Map",
          "Extract transformation matrix (ms2ps) and visible entities from ViewData",
          "Iterate through visible entities to find Space Stud Assemblies (hsb_SpaceStudAssembly, GC-SpaceStudAssembly, Lowfield-SpaceStudAssembly)",
          "For each valid Assembly found: Extract position number, coordinate system, sub-entities, and beams",
          "Filter sub-entities to find 'hsb_NailPlate' instances",
          "Nail Plate Projection: Transform NailPlate real bodies to PaperSpace and draw outlines",
          "Annotation: Draw Position Number text at user-inserted point using current text height and color",
          "Dimension Calculation: Collect all vertices from assembly beams",
          "Calculate geometric center of the panel",
          "Determine extreme bounding points: Left, Right, Top, Bottom relative to assembly coordinate system",
          "Create dimension points: Project points onto top and bottom edges for width, left edge for height",
          "Generate Dimensions: Left (Height), Bottom (Overall Width), Top (Detailed/Running Width)",
          "Apply transformation (ms2ps) to dimensions and draw them in Paper Space"
        ],
        "conditionalBranches": [
          {
            "condition": "Is the script in Insert Mode (_bOnInsert)?",
            "path1": {
              "name": "Insert Flow",
              "steps": [
                "Execute showDialog()",
                "Prompt user for insertion point (getPoint)",
                "Prompt user for ShopDrawView (getShopDrawView)",
                "Append view to _Entity array",
                "Return (terminate execution)"
              ]
            },
            "path2": {
              "name": "Generation/Drawing Flow",
              "steps": [
                "Check _Entity length",
                "Retrieve ViewData from _Map",
                "Process geometry and draw annotations"
              ]
            }
          },
          {
            "condition": "Are there entities linked to the script instance?",
            "path1": {
              "name": "Valid Instance",
              "steps": [
                "Cast _Entity[0] to ShopDrawView",
                "Proceed with data extraction"
              ]
            },
            "path2": {
              "name": "Orphaned/Empty Instance",
              "steps": [
                "Execute eraseInstance()",
                "Return immediately"
              ]
            }
          },
          {
            "condition": "Is the found ShopDrawView valid?",
            "path1": {
              "name": "Valid View",
              "steps": [
                "Retrieve ViewData map",
                "Proceed to entity iteration"
              ]
            },
            "path2": {
              "name": "Invalid View",
              "steps": [
                "Return immediately (No action)"
              ]
            }
          },
          {
            "condition": "Does ViewData contain valid information for the current Viewport?",
            "path1": {
              "name": "Data Found",
              "steps": [
                "Extract transformation matrix (ms2ps)",
                "Extract visible entity list (showSetEntities)"
              ]
            },
            "path2": {
              "name": "Data Not Found (nIndFound < 0)",
              "steps": [
                "Return immediately"
              ]
            }
          },
          {
            "condition": "Is the entity a recognized Space Stud Assembly type?",
            "path1": {
              "name": "Target Assembly",
              "steps": [
                "Extract position number and beams",
                "Search internal entities for NailPlates",
                "Add to global lists for drawing"
              ]
            },
            "path2": {
              "name": "Other Entity",
              "steps": [
                "Skip entity (Do nothing)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "_Entity array length > 0",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script erases itself (eraseInstance) if linked entity is missing."
          },
          {
            "check": "ShopDrawView validity (bIsValid)",
            "errorMessage": "None (Silent failure)",
            "recovery": "Ensure a valid ShopDrawView is selected during insertion. Script stops processing if invalid."
          },
          {
            "check": "ViewData existence for the specific Viewport",
            "errorMessage": "None (Silent failure)",
            "recovery": "Regenerate the shop drawing view to ensure ViewData is populated in the _Map."
          },
          {
            "check": "Presence of 'hsb_SpaceStudAssembly', 'GC-SpaceStudAssembly', or 'Lowfield-SpaceStudAssembly' in the view",
            "errorMessage": "None",
            "recovery": "If no assemblies are found, loops complete without drawing annotations or dimensions."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Annotation Style",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing 'sDimStyle' or 'sDimStyleDims' updates the dimension styles used for text and lines. Changing 'dTextH' updates text size."
          },
          {
            "action": "Move Text Location",
            "how": "Grip Edit (via _Pt0)",
            "effect": "Relocates the Position Number text label. (Note: Logic suggests this is only update-able if script is set to update on point move, though code only shows reading _Pt0 on initial insert, TSL standard behavior usually allows grip updates if properties trigger recalc)."
          },
          {
            "action": "Update Drawing Content",
            "how": "Recalculate / Refresh View",
            "effect": "If the underlying model changes or the view regenerates, the script re-runs the 'Generation Flow' to update dimensions and metal part outlines."
          }
        ]
      },
      "tokens_used": 6917,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_DrawPosNum&DimSpaceStud.mcr\n\n## Overview\nThis script automates the annotation of shop drawings in Paper Space by placing Position Numbers, drawing outlines for Nail Plates, and generating dimension lines for width and height. It reads geometry from a selected Shop Drawing view containing Space Stud assemblies.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for production drawings. |\n| Paper Space | Yes | Must be used on a layout containing a ShopDrawView. |\n| Shop Drawing | Yes | Requires a valid ShopDrawView entity to function. |\n\n## Prerequisites\n- **Required Entities**: A valid **ShopDrawView** entity in Paper Space.\n- **Assembly Content**: The selected view must contain at least one of the following assembly types:\n  - `hsb_SpaceStudAssembly`\n  - `GC-SpaceStudAssembly`\n  - `Lowfield-SpaceStudAssembly`\n- **Minimum Beam Count**: None.\n- **Required Settings**: None (Uses standard CAD dimension styles).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_DrawPosNum&DimSpaceStud.mcr`\n\n### Step 2: Pick Text Location\n```\nCommand Line: Pick a point\nAction: Click in the Paper Space layout where you want the Position Number text to appear.\n```\n\n### Step 3: Select Shop Drawing View\n```\nCommand Line: |Select the view entity from which the information is taken|\nAction: Click on the border (frame) of the Shop Drawing View that contains the Space Stud assembly you wish to annotate.\n```\n\n### Step 4: Automatic Generation\nThe script will automatically calculate the bounding box of the assembly, detect any nail plates, and draw the dimensions and text in Paper Space.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dim Style PosNom | dropdown | (Current) | Selects the Dimension Style to use for the Position Number text formatting. |\n| Text Height | number | U(40) | Sets the height of the Position Number text. |\n| Dim Style Dimensions | dropdown | (Current) | Selects the Dimension Style to use for the measurement lines (width/height). |\n| Offset dim Lines | number | U(100) | Sets the distance between the wall geometry and the dimension lines. |\n| Color | number | 3 | Sets the color index for the text and nail plate outlines. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are defined for this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Moving Text**: If the Position Number lands in a bad spot, simply select the script instance and use the grip point to drag the text to a new location.\n- **View Updates**: If you modify the 3D model (e.g., change wall height or width), refresh your Shop Drawing View. The script will automatically update the dimensions and nail plate positions upon the next regeneration.\n- **Layer Management**: The created entities (text and dimensions) will inherit the color property defined in the script, but layer control depends on your current CAD standards.\n\n## FAQ\n- **Q: I inserted the script, but no dimensions or text appeared.**\n  **A:** Ensure that the Shop Drawing View you selected actually contains one of the supported Space Stud assemblies. If the view is empty or contains standard beams only, the script has nothing to dimension.\n- **Q: Can I use this on regular walls or roofs?**\n  **A:** No, this script is specifically designed to detect `hsb_SpaceStudAssembly`, `GC-SpaceStudAssembly`, or `Lowfield-SpaceStudAssembly` entities. It will ignore other element types.\n- **Q: How do I change the arrow style of the dimensions?**\n  **A:** You cannot change the arrow style directly inside this script's properties. Instead, change the \"Dim Style Dimensions\" property to point to a different Dimension Style in your drawing template that has your preferred arrow settings."
      },
      "tokens_used": 6142,
      "error": null
    }
  }
}