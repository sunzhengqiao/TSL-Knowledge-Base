{
  "filename": "hsb_CheckingTable.mcr",
  "status": "completed",
  "total_tokens": 50824,
  "processing_time": 173.885751247406,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "08.09.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "14.09.2010",
            "author": "",
            "changes": "Fix issue with multiple angles"
          },
          {
            "version": "1.2",
            "date": "16.09.2010",
            "author": "",
            "changes": "Change the way to calculate the height of the wall"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8614,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getPoint() to define an insertion point (_Pt0) in the active UCS and PrEntity() to select Elements. The display logic uses Display dp() to draw lines and text relative to _Pt0. There is no usage of _Viewport, Sheet objects, or the sd_ prefix characteristic of Shop Drawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": null,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "TSL script 'hsb_Apply Naillines to Elements' must be attached to elements to populate Nailing info",
            "ElemText with code 'WINDOW' and subCode 'HEADER' must exist on elements to populate Lintel info"
          ]
        }
      },
      "tokens_used": 7741,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Pick a Point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Please select Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 5,
            "variable": "sTitle",
            "type": "PropString",
            "displayName": "Table Title",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Table Text Color",
            "defaultValue": "7",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "nTitleColor",
            "type": "PropInt",
            "displayName": "Title Color",
            "defaultValue": "4",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "nHeaderColor",
            "type": "PropInt",
            "displayName": "Header Color",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "nLineColor",
            "type": "PropInt",
            "displayName": "Line Color",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7601,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 2D schedule table in Model Space that summarizes structural and manufacturing properties (Height, Pitch, Lintel, Nailing) of selected wall elements.",
          "category": "Annotation/Reporting",
          "typicalUseCase": "Creating a summary checklist or 'wall schedule' in the model to verify design parameters (like wall heights and nail spacing) for production or engineering review without generating full shop drawings."
        },
        "parameters": [
          {
            "name": "sTitle",
            "technicalDefault": "Checking Table",
            "businessMeaning": "The descriptive header text displayed at the top of the table to identify the specific group of elements or the drawing context (e.g., 'Ground Floor Walls').",
            "validRange": "Any alphanumeric string (e.g., 'North Wall Schedule', 'Package A').",
            "unit": "Text String",
            "affectsOutput": "Updates the main title text drawn above the grid."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "The CAD dimension style standard used to format numeric values (specifically Pitch angles) and determine text height/font size for the table.",
            "validRange": "Any Dimension Style defined in the current drawing.",
            "unit": "N/A (Style Name)",
            "affectsOutput": "Controls the format of pitch angles and, critically, the physical size of the table (row height and column width) as the script auto-sizes cells based on the DimStyle's text settings."
          },
          {
            "name": "nColor",
            "technicalDefault": "7",
            "businessMeaning": "The CAD color index for the data content text (the actual values for Group, Type, Height, etc.).",
            "validRange": "1 to 255 (Standard CAD Colors), or -1 for 'ByLayer'.",
            "unit": "Color Index",
            "affectsOutput": "Changes the display color of the table body text."
          },
          {
            "name": "nTitleColor",
            "technicalDefault": "4",
            "businessMeaning": "The CAD color index for the main table title text.",
            "validRange": "1 to 255 (Standard CAD Colors), or -1 for 'ByLayer'.",
            "unit": "Color Index",
            "affectsOutput": "Changes the display color of the top header string."
          },
          {
            "name": "nHeaderColor",
            "technicalDefault": "-1",
            "businessMeaning": "The CAD color index for the column headers (Group, Type, Height, Pitch, Lintel, Nailing).",
            "validRange": "1 to 255 (Standard CAD Colors), or -1 for 'ByLayer'.",
            "unit": "Color Index",
            "affectsOutput": "Changes the display color of the column title row."
          },
          {
            "name": "nLineColor",
            "technicalDefault": "-1",
            "businessMeaning": "The CAD color index for the grid lines and borders of the table.",
            "validRange": "1 to 255 (Standard CAD Colors), or -1 for 'ByLayer'.",
            "unit": "Color Index",
            "affectsOutput": "Changes the display color of the lines forming the table structure."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change in sDimStyle",
            "effect": "Alters the text height and length calculation, resulting in a different physical width and row height for the generated table.",
            "cascade": [
              "Row Height",
              "Column Width",
              "Table Geometry"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "2D Display Elements (Lines & Text)",
            "description": "A formatted grid drawn in Model Space containing text entities for headers and data, and lines for borders. The table auto-sizes based on content length.",
            "appliedTo": "Model Space (at the insertion point _Pt0)"
          }
        ]
      },
      "tokens_used": 9697,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Execution: User launches the hsb_CheckingTable script.",
          "2. Cycle Check: Script checks if insertCycleCount() > 1 to prevent multiple executions.",
          "3. Initial Input: If _kExecuteKey is empty, the Properties Palette (dialog) is shown for initial configuration.",
          "4. Point Placement: User is prompted via command line to 'Pick a Point' (_Pt0) for the table origin.",
          "5. Element Selection: User is prompted via command line to 'Please select Elements'.",
          "6. Selection Validation: Script verifies if elements were selected.",
          "7. Element Parsing: Script iterates through selected elements to determine unique Group/Code combinations.",
          "8. Data Sorting: The unique list of walls is sorted alphabetically by Code, then by Group.",
          "9. Data Aggregation: Script iterates through unique Group/Code entries to calculate properties (Height, Pitch, Nailing, Lintel).",
          "10. Table Geometry Calculation: Script calculates row heights and column widths based on the selected DimStyle and text content length.",
          "11. Rendering: The 2D Display constructs the Title, Header, and Data Rows based on calculated geometry.",
          "12. Final Validation: Script checks if _Element array is still populated (sanity check)."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase current instance",
                "Return (Exit script)"
              ]
            },
            "path2": {
              "name": "Cycle = 1 (Normal Insertion)",
              "steps": [
                "Proceed to getPoint input"
              ]
            }
          },
          {
            "condition": "Entity Selection Result",
            "path1": {
              "name": "No Entities Selected / Selection Cancelled",
              "steps": [
                "Erase current instance",
                "Return (Exit script)"
              ]
            },
            "path2": {
              "name": "Entities Selected",
              "steps": [
                "Populate _Element array",
                "Proceed to processing"
              ]
            }
          },
          {
            "condition": "Group Name Uniqueness (During Row Drawing)",
            "path1": {
              "name": "Current Group == Previous Group",
              "steps": [
                "Set flag nFlag to FALSE",
                "Leave 'Group' column cell blank (Visual merge)"
              ]
            },
            "path2": {
              "name": "Current Group != Previous Group",
              "steps": [
                "Set flag nFlag to TRUE",
                "Draw Group Name in 'Group' column"
              ]
            }
          },
          {
            "condition": "Angled Top Plate Presence (Pitch Calculation)",
            "path1": {
              "name": "Angled Plates Found",
              "steps": [
                "Calculate angle between Element X and Beam X",
                "Format string based on sDimStyle",
                "Append to Pitch list"
              ]
            },
            "path2": {
              "name": "No Angled Plates",
              "steps": [
                "Pitch list remains empty for this element/group"
              ]
            }
          },
          {
            "condition": "Nailing TSL Attachment",
            "path1": {
              "name": "TSL 'hsb_Apply Naillines to Elements' found",
              "steps": [
                "Extract Map 'NailingInfo'",
                "Retrieve dPerimeter1 and dIntermediate1",
                "Format string 'Perimeter Xmm/Intermediate Ymm'"
              ]
            },
            "path2": {
              "name": "TSL Not Found",
              "steps": [
                "Nailing string remains empty"
              ]
            }
          },
          {
            "condition": "Window Header ElemText",
            "path1": {
              "name": "ElemText (Code='WINDOW', SubCode='HEADER') found",
              "steps": [
                "Retrieve text content",
                "Append to Lintel list"
              ]
            },
            "path2": {
              "name": "ElemText Not Found",
              "steps": [
                "Lintel string remains empty"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection Count",
            "errorMessage": "(None - Script silently deletes itself)",
            "recovery": "User must re-run the script and ensure elements are selected in the PrEntity step."
          },
          {
            "check": "Data Availability (Nailing/Lintel)",
            "errorMessage": "Empty columns in the generated table.",
            "recovery": "Attach 'hsb_Apply Naillines to Elements' script to walls for nailing info. Add ElemText with code 'WINDOW' and subCode 'HEADER' for lintel info."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Table Title",
            "how": "OPM (Object Properties Manager)",
            "effect": "Updates the main title string at the top of the table."
          },
          {
            "action": "Change DimStyle",
            "how": "OPM (Dropdown selection)",
            "effect": "Recalculates text height, text length, column widths, and row heights. Pitch values update to match the new style format (e.g., decimal vs degrees/minutes)."
          },
          {
            "action": "Change Colors",
            "how": "OPM (Integer input)",
            "effect": "Updates the color index for Table Text, Title, Header, and Lines."
          }
        ]
      },
      "tokens_used": 10918,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_CheckingTable.mcr\n\n## Overview\nGenerates a 2D schedule table in Model Space that summarizes structural and manufacturing properties (Height, Pitch, Lintel, Nailing) of selected wall elements.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The table is inserted at a user-defined point in the active UCS. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: Wall Elements.\n- **Specific Requirements**:\n    - To populate **Nailing** info: The script `hsb_Apply Naillines to Elements` must be attached to the elements.\n    - To populate **Lintel** info: An ElemText with Code `WINDOW` and SubCode `HEADER` must exist on the elements.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_CheckingTable.mcr`\n\n### Step 2: Configure Properties (Initial)\n```\nDialog: Properties Palette (if appearing)\nAction: (Optional) Set the Table Title, select a Dimstyle, or adjust colors before placing the table.\n```\n\n### Step 3: Place Table\n```\nCommand Line: Pick a Point\nAction: Click in the Model Space to define the insertion point (top-left corner) of the table.\n```\n\n### Step 4: Select Elements\n```\nCommand Line: Please select Elements\nAction: Select the wall elements you wish to include in the schedule. Press Enter to confirm selection.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Table Title | text | [Empty] | The descriptive header text displayed at the top of the table. |\n| Dimstyle | dropdown | _DimStyles | The dimension style used to format text. This controls the text height and overall scale of the table. |\n| Table Text Color | number | 7 | CAD Color Index for the data content text. |\n| Title Color | number | 4 | CAD Color Index for the main table title text. |\n| Header Color | number | -1 | CAD Color Index for the column headers (e.g., \"Group\", \"Height\"). -1 = ByLayer. |\n| Line Color | number | -1 | CAD Color Index for the table grid lines. -1 = ByLayer. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are added by this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not rely on external XML settings files.\n\n## Tips\n- **Resizing the Table**: To change the physical size of the table, change the `Dimstyle` property to a style with larger or smaller text settings.\n- **Visual Grouping**: The table automatically groups rows by element code. If the \"Group\" name is identical to the row above it, the cell is left blank to create a cleaner, grouped visual effect.\n- **Data Validation**: If columns appear empty, verify that the prerequisite TSL scripts or ElemTexts are correctly applied to the source wall elements.\n\n## FAQ\n- **Q: Why is the \"Nailing\" column empty?**\n- **A:** Ensure the script `hsb_Apply Naillines to Elements` is attached to the selected wall elements.\n\n- **Q: Why is the \"Lintel\" column empty?**\n- **A:** You must add an ElemText with Code `WINDOW` and SubCode `HEADER` to your wall elements to display this data."
      },
      "tokens_used": 6253,
      "error": null
    }
  }
}