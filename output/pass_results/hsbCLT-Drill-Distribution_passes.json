{
  "filename": "hsbCLT-Drill-Distribution.mcr",
  "status": "completed",
  "total_tokens": 48732,
  "processing_time": 249.4390926361084,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "01.03.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-14825 dimension requests prepared"
          },
          {
            "version": "1.0",
            "date": "16.02.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-14729 initial version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7198,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates in Model Space (indicated by `int bForceModelSpace = true;` and `TslInst...dbCreate(..., bForceModelSpace, ...);`). It performs geometric calculations and creates physical entities (`Drill`, `Sinkhole`) based on `GenBeam` and `Sip` intersections. While it interacts with `MultiPageStyle` and dimension stereotypes via a specific dialog mode (`DialogMode` 1), it does not generate shop drawing views or elements directly (no `sd_` prefixes, `#Type E`, or `_Viewport` usage)."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip (Panel/CLT element)",
            "GenBeam or EntPLine (Secondary intersecting objects)"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "TslUtilities.dll"
          ]
        }
      },
      "tokens_used": 5839,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Context Menu Item 'Configure Shopdrawing' is clicked",
            "title": "DialogMode 1 Properties",
            "dataSource": "Script Properties: Format, Stereotype",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sFormat",
            "type": "PropString",
            "displayName": "|Format|",
            "defaultValue": "@(Quantity-2)x @(|Diameter|)",
            "inputType": "text",
            "options": [],
            "category": "|Dimension|",
            "description": "|Defines the Format|"
          },
          {
            "index": 1,
            "variable": "sStereotype",
            "type": "PropString",
            "displayName": "|Stereotype|",
            "defaultValue": "<|Disabled|>",
            "inputType": "dropdown",
            "options": [
              "<|Disabled|>",
              "*",
              "<from MultiPageStyle entries>"
            ],
            "category": "|Dimension|",
            "description": "|Defines the stereotype|"
          },
          {
            "index": 0,
            "variable": "dDiameter",
            "type": "PropDouble",
            "displayName": "|Diameter|",
            "defaultValue": 12.0,
            "inputType": "number",
            "options": [],
            "category": "|Drill|",
            "description": "|Defines the Diameter|"
          },
          {
            "index": 1,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "|Depth|",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": "|Drill|",
            "description": "|Defines the depth| |0 = complete through|"
          },
          {
            "index": 2,
            "variable": "dDiameterSink",
            "type": "PropDouble",
            "displayName": "|Diameter|",
            "defaultValue": 63.0,
            "inputType": "number",
            "options": [],
            "category": "|Sinkhole|",
            "description": "|Defines the diameter of the sinkhole|"
          },
          {
            "index": 3,
            "variable": "dDepthSink",
            "type": "PropDouble",
            "displayName": "|Depth|",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": "|Sinkhole|",
            "description": "|Defines the depth of the sinkhole|"
          },
          {
            "index": 4,
            "variable": "sDistributionMode",
            "type": "PropString",
            "displayName": "|Mode|",
            "defaultValue": "|Fixed|",
            "inputType": "dropdown",
            "options": [
              "|Fixed|",
              "|Even|"
            ],
            "category": "|Distribution|",
            "description": "|Defines the DistributionMode|"
          },
          {
            "index": 5,
            "variable": "dInterdistance",
            "type": "PropDouble",
            "displayName": "|Interdistance|",
            "defaultValue": 1000.0,
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": "|Defines the interdistance or the quantity of connectors|"
          },
          {
            "index": 0,
            "variable": "nNumRow",
            "type": "PropInt",
            "displayName": "|Rows|",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": "|Defines the number of rows|"
          },
          {
            "index": 6,
            "variable": "sRowOffsetList",
            "type": "PropString",
            "displayName": "|Row Offsets|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Distribution|",
            "description": "|Specify offset, separate multiple by a semicolon, i.e. '200;150;200'|"
          },
          {
            "index": 7,
            "variable": "sColumnOffsetList",
            "type": "PropString",
            "displayName": "|Column Offsets|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Distribution|",
            "description": "|Specify offset, separate multiple by a semicolon, i.e. '200;150;200'|"
          },
          {
            "index": 8,
            "variable": "sFace",
            "type": "PropString",
            "displayName": "|Face|",
            "defaultValue": "|Reference Face|",
            "inputType": "dropdown",
            "options": [
              "|Reference Face|",
              "|Top Face|"
            ],
            "category": "|Alignment|",
            "description": "|Defines the Face|"
          },
          {
            "index": 9,
            "variable": "dBevel",
            "type": "PropDouble",
            "displayName": "|Bevel|",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": "|Alignment|",
            "description": "|Defines the angle of the drill axis in relation to the selected face.| -90° <|Bevel| < 90°"
          },
          {
            "index": 10,
            "variable": "dRotation",
            "type": "PropDouble",
            "displayName": "|Rotation|",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": "|Alignment|",
            "description": "|Defines the rotation of the drill axis perpendicular to the segment on the selected face.| -90° <|Rotation| < 90°"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Edit In Place|",
            "handler": "|Edit In Place|",
            "action": "Erases the instance and presumably allows editing the underlying entities or clones.",
            "alsoTriggeredBy": "Double Click"
          },
          {
            "menuItem": "|Add Panels|",
            "handler": "|Add Panels|",
            "action": "Prompts user to select panels (Sip) to add to the script."
          },
          {
            "menuItem": "|Add secondary objects|",
            "handler": "|Add secondary objects|",
            "action": "Prompts user to select genbeams (GenBeam) to add as secondary intersecting objects."
          },
          {
            "menuItem": "|Remove genbeams|",
            "handler": "|Remove genbeams|",
            "action": "Prompts user to select genbeams to remove from the script."
          },
          {
            "menuItem": "|Convert To Polyline|",
            "handler": "|Convert To Polyline|",
            "action": "Converts the internal polyline definitions to physical Entity Polylines (EntPLine)."
          },
          {
            "menuItem": "|Convert To Grip Points|",
            "handler": "|Convert To Grip Points|",
            "action": "Converts the current configuration into a new instance using Grip Points based on the polyline vertices, then erases the current instance."
          },
          {
            "menuItem": "|Revert Direction|",
            "handler": "|Revert Direction|",
            "action": "Toggles a boolean flag (bRevertDirection) in the map to reverse the direction of operation."
          },
          {
            "menuItem": "|Configure Shopdrawing|",
            "handler": "|Configure Shopdrawing|",
            "action": "Opens a dynamic dialog to configure dimension format and stereotype settings."
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9459,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 9048,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Insertion / Recalculation",
          "2. Check for 'DialogMode' in Map",
          "3. [Branch] DialogMode == 1: Open Shopdrawing Configuration Dialog (Format, Stereotype) -> Update Map -> Exit",
          "4. [Branch] Main Execution: Load Properties (Drill, Sinkhole, Distribution, Alignment) and References (Panels, GenBeams, Polylines) from Map",
          "5. [Branch] Jig Mode: If user is defining points during insertion, project mouse point to face plane and update preview polyline",
          "6. Calculate Drill Distribution: Determine points based on intersection with GenBeams, Polylines, or user-defined grip points",
          "7. [Branch] Distribution Mode: Apply 'Fixed' or 'Even' spacing logic based on 'Interdistance' and Offset lists",
          "8. Generate Geometry: Create Drill and Sinkhole entities on the calculated points",
          "9. Apply Dimensions: Generate dimension text based on configured Format and Stereotype (if enabled)",
          "10. Update Visuals: Draw preview or final geometry in Model Space"
        ],
        "conditionalBranches": [
          {
            "condition": "User triggers 'Configure Shopdrawing' (DialogMode 1)",
            "path1": {
              "name": "Configuration Flow",
              "steps": [
                "Suspend normal execution",
                "Retrieve MultiPageStyle entries for Stereotypes",
                "Display Dynamic Dialog with Format and Stereotype options",
                "Update Map with new Format/Stereotype values on OK",
                "Recalculate script"
              ]
            }
          },
          {
            "condition": "Secondary Object Selection (Insertion)",
            "path1": {
              "name": "Intersection Mode",
              "steps": [
                "User selects GenBeams or Polylines",
                "Script calculates intersection points with Panel",
                "Generates drills along these intersections"
              ]
            },
            "path2": {
              "name": "Manual Definition Mode",
              "steps": [
                "User selects no secondary objects",
                "Script enters Jig mode",
                "User draws points/polyline on the panel face",
                "Generates drills based on drawn path"
              ]
            }
          },
          {
            "condition": "Convert Action Triggered",
            "path1": {
              "name": "Convert To Polyline",
              "steps": [
                "Clear Grip Points (_PtG)",
                "Clear Female[] Map",
                "Create physical Entity Polylines (EntPLine) from logical definitions",
                "Assign to Panel groups"
              ]
            },
            "path2": {
              "name": "Convert To Grip Points",
              "steps": [
                "Extract vertices from existing Polylines",
                "Create new Script Instance",
                "Pass vertices as Grip Points (ptsTsl) to new instance",
                "Erase current instance"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Panel Coplanarity (Add Panels)",
            "errorMessage": "Implicit (Panel is ignored)",
            "recovery": "The script skips panels that are not parallel to the reference face or have a different Z-vector offset."
          },
          {
            "check": "Entity Existence (Remove Genbeams)",
            "errorMessage": "Implicit",
            "recovery": "Prevents removal if the collection length is <= 1 (checked in code `_Sip.length()>1`)."
          },
          {
            "check": "Duplicate Entities (Add Secondary)",
            "errorMessage": "None",
            "recovery": "Script checks if GenBeam already exists in `gbFemales` or `_Sip` arrays using `.find()` and skips duplicates."
          }
        ],
        "postInsertionActions": [
          {
            "action": "|Edit In Place|",
            "how": "Context Menu / Double Click",
            "effect": "Erases the script instance to allow manual editing of underlying elements."
          },
          {
            "action": "|Add Panels|",
            "how": "Context Menu",
            "effect": "Prompts selection of new Panels (Sip). Validates coplanarity and adds them to the script's processing list."
          },
          {
            "action": "|Add secondary objects|",
            "how": "Context Menu",
            "effect": "Prompts selection of GenBeams. Adds them to the intersection list and removes existing physical polylines to revert to logic-based generation."
          },
          {
            "action": "|Remove genbeams|",
            "how": "Context Menu",
            "effect": "Prompts selection of GenBeams to remove from the script's internal list."
          },
          {
            "action": "|Convert To Polyline|",
            "how": "Context Menu",
            "effect": "Transforms the generated drill paths into physical polylines (EntPLine) and disconnects them from the logic (clears grip points/beam references)."
          },
          {
            "action": "|Convert To Grip Points|",
            "how": "Context Menu",
            "effect": "Replaces the current definition (likely based on beams/polylines) with a new instance defined by grip points based on the current path vertices."
          },
          {
            "action": "|Revert Direction|",
            "how": "Context Menu",
            "effect": "Toggles the `revertDirection` flag in the map, which likely flips the drill calculation vector."
          },
          {
            "action": "|Configure Shopdrawing|",
            "how": "Context Menu",
            "effect": "Opens a specific dialog to set Dimension Format and Stereotype properties."
          },
          {
            "action": "Property Modification",
            "how": "OPM (Object Properties Manager)",
            "effect": "Real-time update of Drill Diameter, Depth, Sinkhole settings, Distribution offsets, and Alignment angles."
          }
        ]
      },
      "tokens_used": 10170,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-Drill-Distribution\n\n## Overview\nThis script automates the creation and distribution of drills and sinkholes on CLT panels (Sip elements). It allows users to generate hole patterns based on intersections with structural beams or manually defined paths, with advanced options for spacing, alignment, and shop drawing dimensioning.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be run in Model Space. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported, but it can configure stereotypes for use in shop drawings. |\n\n## Prerequisites\n- **Required Entities**: At least one CLT Panel (Sip). Optionally, GenBeams or Polylines for automatic intersection.\n- **Minimum Beam Count**: N/A (Depends on whether using intersection mode or manual definition).\n- **Required Settings**: `TslUtilities.dll` must be loaded in the hsbCAD environment.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsbCLT-Drill-Distribution.mcr`\n\n### Step 2: Select Panel\n```\nCommand Line: Select Sip (Panel)\nAction: Click on the CLT panel where you want to add holes.\n```\n\n### Step 3: Define Drill Path\n```\nAction: You will be prompted to select secondary objects (GenBeams or Polylines) that intersect the panel to define the drill line.\nOR\nAction: If no secondary objects are selected, you can manually draw points/polylines on the face of the panel to define the path.\n```\n\n### Step 4: Configure Properties\n```\nAction: Use the Properties Palette (OPM) to adjust hole diameters, depths, distribution modes (Fixed/Even), and alignment angles.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Drill** | | | |\n| Diameter | Number | 12.0 | Defines the diameter of the drill. |\n| Depth | Number | 0.0 | Defines the depth of the drill (0 = complete through). |\n| **Sinkhole** | | | |\n| Diameter | Number | 63.0 | Defines the diameter of the sinkhole. |\n| Depth | Number | 0.0 | Defines the depth of the sinkhole. |\n| **Distribution** | | | |\n| Mode | Dropdown | Fixed | Defines the distribution mode (Fixed or Even). |\n| Interdistance | Number | 1000.0 | Defines the spacing between drills (or quantity in specific modes). |\n| Rows | Number | 1 | Defines the number of rows for the drill pattern. |\n| Row Offsets | Text | | Specify row offsets, separated by semicolons (e.g., '200;150;200'). |\n| Column Offsets | Text | | Specify column offsets, separated by semicolons (e.g., '200;150;200'). |\n| **Alignment** | | | |\n| Face | Dropdown | Reference Face | Defines the working face (Reference Face or Top Face). |\n| Bevel | Number | 0.0 | Defines the angle of the drill axis relative to the face (-90° to 90°). |\n| Rotation | Number | 0.0 | Defines the rotation of the drill axis perpendicular to the segment (-90° to 90°). |\n| **Dimension** | | | |\n| Format | Text | @(Quantity-2)x @(|Diameter|) | Defines the dimension string format. |\n| Stereotype | Dropdown | \\<Disabled\\> | Defines the dimension stereotype (select from MultiPageStyle entries). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Edit In Place** | Erases the script instance and allows manual editing of the underlying elements. Can also be triggered by Double Click. |\n| **Add Panels** | Prompts you to select additional CLT panels (Sip) to include in the drill distribution. |\n| **Add secondary objects** | Prompts you to select GenBeams or Polylines to calculate new intersection points for drills. |\n| **Remove genbeams** | Prompts you to select specific GenBeams to remove from the calculation. |\n| **Convert To Polyline** | Converts the calculated drill path into physical polylines and disconnects them from the script logic. |\n| **Convert To Grip Points** | Replaces the current logic-based definition with a new instance defined by grip points at the current vertices. |\n| **Revert Direction** | Toggles the direction of the drill calculation vector (flips the operation side). |\n| **Configure Shopdrawing** | Opens a dynamic dialog to configure Dimension Format and Stereotype settings. |\n\n## Settings Files\n- **Filename**: `TslUtilities.dll`\n- **Location**: hsbCAD Install path\n- **Purpose**: Provides functionality for dynamic dialogs and utilities used by the script.\n\n## Tips\n- **Staggered Patterns**: Use the \"Row Offsets\" and \"Column Offsets\" parameters to create complex staggered drilling patterns (e.g., for nail plates).\n- **Fixed vs. Even**: Use \"Fixed\" mode to set a specific gap between holes. Use \"Even\" mode to distribute a calculated number of holes equally across the length.\n- **Angled Drilling**: You can drill at an angle by adjusting the \"Bevel\" and \"Rotation\" properties under Alignment, which is useful for connections.\n- **Freezing Geometry**: If you want to stop the holes from updating automatically when beams move, use the \"Convert To Polyline\" option.\n\n## FAQ\n- **Q: What does Depth 0 mean?**\n  **A**: A depth of 0.0 means the drill (or sinkhole) will go completely through the panel thickness.\n- **Q: Can I use this on curved walls?**\n  **A**: The script works on Sip (CLT) elements. Ensure the panels are coplanar; the script may skip panels that are not parallel to the reference face.\n- **Q: How do I add holes to multiple panels at once?**\n  **A**: After inserting the script on one panel, use the \"Add Panels\" right-click menu option to select additional panels to process."
      },
      "tokens_used": 7018,
      "error": null
    }
  }
}