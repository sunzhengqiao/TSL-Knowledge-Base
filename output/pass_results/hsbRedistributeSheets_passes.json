{
  "filename": "hsbRedistributeSheets.mcr",
  "status": "completed",
  "total_tokens": 48977,
  "processing_time": 1336.7670226097107,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.10",
            "date": "07.11.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-16939: Support canceling tsl during insertion jig"
          },
          {
            "version": "1.9",
            "date": "20jan21",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-8707: improve prompt in jig, symbol not outside the envelope"
          },
          {
            "version": "1.8",
            "date": "19jan21",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-8707: support jig, multiple enhancements"
          },
          {
            "version": "1.7",
            "date": "20.09.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5536: only one tsl possible for a particular distribution area of an element"
          },
          {
            "version": "1.6",
            "date": "19.09.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5536: remove openings from all the sheets of the element"
          },
          {
            "version": "1.5",
            "date": "19.09.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5536: add property distribution area"
          },
          {
            "version": "1.4",
            "date": "18.09.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "HSB-5536: prompt a click point for each distribution area and generate a TSL"
          },
          {
            "version": "1.3",
            "date": "27.08.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "add display symbol in plan view"
          },
          {
            "version": "1.2",
            "date": "26.08.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "guard if (iTypical < 0)"
          },
          {
            "version": "1.1",
            "date": "26.08.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "working version"
          },
          {
            "version": "1.0",
            "date": "23.08.2019",
            "author": "marsel.nakuci@hsbcad.com",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8272,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script modifies 3D geometry by creating, deleting, and assigning 'Sheet' objects to an 'Element'. It uses 'Display' for 3D visualization of the jig and result symbols. There is no usage of 'sd_' functions, Viewport handling, or 2D drawing generation logic, which are characteristic of ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Sheet"
          ],
          "minimumBeams": 0,
          "requiredSpace": "The script must be executed on an Element that contains at least one Zone with Sheets. It relies on the Element being calculated enough to have sheet geometry to redistribute.",
          "requiredSettings": []
        }
      },
      "tokens_used": 8098,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Select insertion point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select distribution point",
              "condition": "nDistributionArea == 0 && _bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nZone",
            "type": "PropInt",
            "displayName": "Zone",
            "defaultValue": 5,
            "inputType": "dropdown",
            "options": [
              "Zone-5",
              "zOne-4",
              "zoNe-3",
              "zonE-2",
              "ZOne-1",
              "1",
              "2",
              "3",
              "4",
              "5"
            ],
            "category": "General",
            "description": "Defines the Zone where the sheets are to be redestributed"
          },
          {
            "index": 1,
            "variable": "nDistributionArea",
            "type": "PropInt",
            "displayName": "Distribution Range",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "General",
            "description": "Defines the Distribution Area"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7556,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Allows manual redistribution and splitting of structural sheeting (panels) on a wall element by interactively defining cut locations.",
          "category": "Framing",
          "typicalUseCase": "Used when the automatic sheet generation places panel joints in undesirable locations (e.g., at window openings) or when specific panel lengths are required for transportation constraints."
        },
        "parameters": [
          {
            "name": "nZone",
            "technicalDefault": "5",
            "businessMeaning": "Selects the specific construction layer or zone within the wall element (e.g., external sheathing, internal lining) to be modified.",
            "validRange": "-5 to 5 (excluding 0, depending on element setup)",
            "unit": "Index",
            "affectsOutput": "Determines which set of sheets in the wall element are deleted and regenerated. The script will fail if the selected zone does not exist in the target element."
          },
          {
            "name": "nDistributionArea",
            "technicalDefault": "0",
            "businessMeaning": "Identifies a specific logical area of the wall to modify. A value of 0 enables interactive mode to place new split points. Non-zero values target a specific pre-existing area index.",
            "validRange": "Integer (0 for interactive, >=1 for specific area)",
            "unit": "Index",
            "affectsOutput": "When set to 0, the script enters a Jig mode prompting the user to click points to define where sheets should be cut. When non-zero, it applies logic only to that specific distribution area."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "nDistributionArea is set to 0",
            "effect": "Triggers an interactive getPoint command line prompt for the user to select split locations.",
            "cascade": [
              "_Pt0 (Insertion Point)"
            ]
          },
          {
            "trigger": "nZone is set to an invalid index",
            "effect": "Script reports an error 'selected zone does not exist' and erases the instance.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Sheet",
            "description": "New structural sheeting panels are generated based on the calculated typical width and the user-defined split points. Openings are automatically subtracted from these new sheets.",
            "appliedTo": "The selected Element within the specified Zone."
          }
        ]
      },
      "tokens_used": 9023,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches script and selects an Element",
          "User sets properties (Zone, Distribution Range) via OPM or dialog",
          "Script prompts for Insertion Point (_Pt0) to define symbol location",
          "Conditional: If Distribution Range is 0 (Interactive), Script prompts for Distribution Point (PtSheet) to define the sheet cut line",
          "Conditional: If Distribution Range > 0, Script skips the point prompt and uses the property index",
          "Jig triggers: User moves cursor; Script dynamically highlights the area and sheet intersection to preview the cut",
          "User confirms points (if interactive)",
          "Validation: Script checks if the selected Element is valid",
          "Validation: Script checks if the specified Zone exists in the Element (Height > 0)",
          "Validation: Script checks if Sheets exist in the specified Zone (waits if calculating, errors if missing)",
          "Script calculates the geometry: Identifies existing sheets, openings, and determines the 'Typical' width",
          "Script creates new PlaneProfiles for the sheets based on the split point (if interactive) or range logic",
          "Script deletes the original sheets in the affected area",
          "Script generates new Sheet entities and assigns them to the Element's Zone",
          "Script subtracts openings from the new sheets",
          "Script draws the finished symbol (Circle with X) at the insertion point and assigns TSL to Element"
        ],
        "conditionalBranches": [
          {
            "condition": "Distribution Range (nDistributionArea) property value",
            "path1": {
              "name": "Interactive Mode (0)",
              "steps": [
                "Prompts user for a Distribution Point (PtSheet)",
                "Activates Jig to visualize the cut line on the sheets",
                "Calculates sheet split based on the exact clicked point"
              ]
            },
            "path2": {
              "name": "Specific Area Mode (> 0)",
              "steps": [
                "Skips the point prompt",
                "Uses the integer index from Distribution Range property",
                "Regenerates sheets based on the predefined area logic"
              ]
            }
          },
          {
            "condition": "Zone Existence Validation",
            "path1": {
              "name": "Valid Zone",
              "steps": [
                "Proceeds to sheet retrieval and geometry calculation"
              ]
            },
            "path2": {
              "name": "Invalid Zone",
              "steps": [
                "Reports error 'selected zone does not exist'",
                "Erases the TSL instance immediately"
              ]
            }
          },
          {
            "condition": "Sheet Availability in Zone",
            "path1": {
              "name": "Sheets Found",
              "steps": [
                "Continues execution to modify/redistribute sheets"
              ]
            },
            "path2": {
              "name": "No Sheets Found (Zero length)",
              "steps": [
                "Script returns immediately (Waiting state)",
                "If status persists, reports error 'no sheet found for zone'",
                "Erases the TSL instance"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Entity Validity",
            "errorMessage": "Implicit error (Instance erased)",
            "recovery": "Select a valid wall or floor element."
          },
          {
            "check": "Zone Index (nZone)",
            "errorMessage": "selected zone does not exist",
            "recovery": "Change the 'Zone' property to a value that exists in the target element (e.g., 1, 2, 3, -1)."
          },
          {
            "check": "Sheet Generation Status",
            "errorMessage": "no sheet found for zone [x]",
            "recovery": "Ensure the element is calculated and has sheets generated for that zone."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move TSL (Grip Edit)",
            "how": "Select the TSL instance and drag the grip point",
            "effect": "Updates the Insertion Point (_Pt0). In interactive mode (Range=0), this also updates the Distribution Point, shifting the sheet cut location dynamically."
          },
          {
            "action": "Change Zone Property",
            "how": "Select TSL, modify 'Zone' property in OPM",
            "effect": "Switches the redistribution logic to a different construction layer (e.g., from inner sheathing to outer sheathing)."
          },
          {
            "action": "Change Distribution Range Property",
            "how": "Select TSL, modify 'Distribution Range' property",
            "effect": "Switches between Interactive mode (0) and Specific Area mode (> 0). Changing to 0 re-enables the point selection workflow."
          }
        ]
      },
      "tokens_used": 10462,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbRedistributeSheets.mcr\n\n## Overview\nThis script allows you to manually split and redistribute structural sheeting (panels) on a wall element. It is useful when automatic sheet generation places joints in undesirable locations, or when you need to define specific panel lengths manually.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script modifies 3D geometry and sheet assignments. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: An Element (Wall or Floor) that already contains generated Sheets.\n- **Minimum Beam Count**: 0\n- **Required Settings**: None. The Element must be calculated enough to have sheet geometry available.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbRedistributeSheets.mcr`\n\n### Step 2: Select Element\nClick on the Wall or Floor element where you want to modify the sheeting distribution.\n\n### Step 3: Configure Properties (Optional)\nBefore or during insertion, open the **Properties Palette** (Ctrl+1) to adjust settings:\n- Set **Zone** to the layer you wish to modify (e.g., external sheathing).\n- Set **Distribution Range** to `0` for interactive mode.\n\n### Step 4: Select Insertion Point\n```\nCommand Line: Select insertion point\nAction: Click in the drawing to place the symbol indicating the modification area.\n```\n\n### Step 5: Select Distribution Point (Interactive Mode)\nIf **Distribution Range** is set to 0:\n```\nCommand Line: Select distribution point\nAction: Click on the sheets where you want the new joint/cut to be located.\nNote: A dynamic preview (Jig) will show the proposed cut line as you move your cursor.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Zone | dropdown | 5 | Selects the construction layer (Zone index) within the element to be modified. Ensure the selected zone exists in the element. |\n| Distribution Range | number | 0 | Defines the area to modify. **0** enables interactive mode (prompts for a click point). Values > 1 target a specific distribution area index. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are defined by this script. Use standard AutoCAD grip edits to modify the position. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Interactive Adjustment**: Set **Distribution Range** to `0`. After insertion, you can select the script instance and drag its grip point to slide the sheet cut line along the wall dynamically.\n- **Validation**: If the script disappears immediately after insertion, check the command line. It usually means the selected **Zone** does not exist in the element or no sheets were found.\n- **Visualizing Changes**: During insertion, look for the dynamic preview highlight to ensure the cut line intersects the sheets correctly.\n\n## FAQ\n- **Q: Why did the script delete itself immediately?**\n  **A**: This usually happens if the selected **Zone** number does not exist in the target wall element, or if the element has not generated sheets for that zone yet. Try changing the Zone property in the properties palette before insertion.\n\n- **Q: Can I move the cut line after I have placed it?**\n  **A**: Yes. If **Distribution Range** is set to `0`, simply select the TSL instance in the model and drag the blue grip point to relocate the distribution point. The sheets will update automatically.\n\n- **Q: What does \"Zone\" mean?**\n  **A**: It refers to the specific layer of the wall construction (e.g., inner lining, structure, outer sheathing). Common values range from -5 to 5, depending on how the wall was constructed."
      },
      "tokens_used": 5566,
      "error": null
    }
  }
}