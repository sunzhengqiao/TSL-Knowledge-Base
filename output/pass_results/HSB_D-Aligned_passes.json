{
  "filename": "HSB_D-Aligned.mcr",
  "status": "completed",
  "total_tokens": 55404,
  "processing_time": 299.43787384033203,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9263,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "Both",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script contains distinct logic paths for both environments. In `_bOnInsert`, it prompts the user to 'Select a Viewport' if <ENTER> is pressed, storing it in `_Viewport`. Later, it checks `if (_Viewport.length() != 0)` to apply Paper Space specific logic, including coordinate system transformations (`vp.coordSys()`) and scale calculation (`dVpScale = ps2ms.scale()`) to adjust dimension text. If no viewport is selected, it operates in Model Space. History version 1.12 explicitly confirms 'Added a option to use this TSL in paperspace'."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "None specific; script prompts user for points in Model Space or a Viewport in Paper Space.",
          "requiredSettings": [
            "Dimension Styles (referenced via _DimStyles)"
          ]
        }
      },
      "tokens_used": 7484,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Select first dimension point or <ENTER> for PaperSpace",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select a Viewport",
              "condition": "_bOnInsert && _PtG.length() == 0",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "Select first dimension point",
              "condition": "_bOnInsert && _PtG.length() == 0",
              "required": true
            },
            {
              "step": 4,
              "function": "getPoint",
              "promptOriginal": "Select next point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 5,
              "function": "getPoint",
              "promptOriginal": "Select a position for the dimension line",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 6,
              "function": "getPoint",
              "promptOriginal": "Select a position for the direction",
              "condition": "_bOnInsert",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": "General",
            "description": null
          },
          {
            "index": 1,
            "variable": "sLayer",
            "type": "PropString",
            "displayName": "Layer",
            "defaultValue": "0",
            "inputType": "text",
            "options": [],
            "category": "General",
            "description": null
          },
          {
            "index": 11,
            "variable": "sAssignToGroup",
            "type": "PropString",
            "displayName": "Assign to group",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "Groupnames",
            "category": "General",
            "description": "The dimension line is assigned exclusively to this group."
          },
          {
            "index": 10,
            "variable": "sLinkToObjects",
            "type": "PropString",
            "displayName": "Link to objects",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "General",
            "description": "Are the points taken from the objects?"
          },
          {
            "index": 12,
            "variable": "showInDisplayRepresentation",
            "type": "PropString",
            "displayName": "Show in display representation",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "DisplayRepNames",
            "category": "General",
            "description": "Sets the display representation for drawing the dimension lines."
          },
          {
            "index": 3,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": "Dimension",
            "description": null
          },
          {
            "index": 4,
            "variable": "sDimMethod",
            "type": "PropString",
            "displayName": "Dimension method",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "Delta perpendicular",
              "Delta parallel",
              "Continuous perpendicular",
              "Continuous parallel",
              "Both perpendicular",
              "Both parallel",
              "Delta parallel, Continuous perpendicular",
              "Delta perpendicular, Continuous parallel"
            ],
            "category": "Dimension",
            "description": null
          },
          {
            "index": 5,
            "variable": "sTextOverrideDelta",
            "type": "PropString",
            "displayName": "Text override delta",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Text",
            "description": null
          },
          {
            "index": 6,
            "variable": "sTextOverrideContinuous",
            "type": "PropString",
            "displayName": "Text override continuous",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Text",
            "description": null
          },
          {
            "index": 8,
            "variable": "sDescription",
            "type": "PropString",
            "displayName": "Description",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Text",
            "description": null
          },
          {
            "index": 9,
            "variable": "sSideDescription",
            "type": "PropString",
            "displayName": "Side description",
            "defaultValue": "Left",
            "inputType": "dropdown",
            "options": [
              "Left",
              "Right"
            ],
            "category": "Text",
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffsetDescription",
            "type": "PropDouble",
            "displayName": "Offset description",
            "defaultValue": "100",
            "inputType": "number",
            "options": [],
            "category": "Text",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Add points",
            "handler": "arSTrigger[0]",
            "action": "Prompts the user to select new dimension points to append to the list.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Remove points",
            "handler": "arSTrigger[1]",
            "action": "Prompts the user to select points to delete from the dimension list.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Set direction",
            "handler": "arSTrigger[3]",
            "action": "Prompts the user to select a position for the direction.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Set reference point",
            "handler": "arSTrigger[4]",
            "action": "Prompts the user to select a point to act as the new reference (first) point.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8892,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates aligned dimension lines in Model Space or Paper Space, capable of measuring distances along or perpendicular to a user-defined axis.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used to annotate construction drawings with specific measurements, such as the spacing between studs, the total length of a wall plate, or offsets in complex roof geometries. It supports both model space annotations and viewport-specific scaled dimensions in layouts."
        },
        "parameters": [
          {
            "name": "nColor",
            "technicalDefault": "1",
            "businessMeaning": "Sets the color index (AutoCAD ACI) of the dimension lines and text.",
            "validRange": "1-255 (standard AutoCAD color indices)",
            "unit": "Index",
            "affectsOutput": "Changes the visual color of the dimension lines and description text in the CAD drawing."
          },
          {
            "name": "sLayer",
            "technicalDefault": "0",
            "businessMeaning": "Specifies the CAD layer on which the TSL instance and its graphics are drawn. In Paper Space mode, this might be overridden to the current viewport layer.",
            "validRange": "Any existing layer name in the drawing",
            "unit": "String",
            "affectsOutput": "Determines layer organization and visibility of the dimensions."
          },
          {
            "name": "sAssignToGroup",
            "technicalDefault": "",
            "businessMeaning": "Assigns the dimension entity to a specific hsbCAD construction group (e.g., a specific floor or element group).",
            "validRange": "List of existing floor or element groups in the project",
            "unit": "String",
            "affectsOutput": "Controls the logical grouping of the dimension, affecting how it is managed or exported relative to specific building parts."
          },
          {
            "name": "sLinkToObjects",
            "technicalDefault": "Yes",
            "businessMeaning": "Determines if the dimension points are 'snapped' to and dependent on 3D objects (beams, elements). If linked, dimensions move with the objects.",
            "validRange": "Yes, No",
            "unit": "Enumeration",
            "affectsOutput": "If 'Yes', points are stored as entities and update automatically when the timber object moves or changes size. If 'No', points are static coordinates."
          },
          {
            "name": "showInDisplayRepresentation",
            "technicalDefault": "",
            "businessMeaning": "Filters the visibility of the dimension based on the selected display representation (e.g., Model, Shop Floor, Layout).",
            "validRange": "Available display representations in the current catalog/project",
            "unit": "String",
            "affectsOutput": "Hides or shows the dimension lines depending on the current view mode selected in the CAD environment."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "Selects the visual style for the dimension (arrows, ticks, text size, font) as defined in the hsbCAD drawing styles.",
            "validRange": "Available dimension styles in the drawing",
            "unit": "String",
            "affectsOutput": "Changes the graphical appearance of arrows, extension lines, and text formatting."
          },
          {
            "name": "sDimMethod",
            "technicalDefault": "",
            "businessMeaning": "Defines how the distances are calculated and displayed: either as individual deltas between points or as a running continuous total, aligned perpendicular or parallel to the dimension line.",
            "validRange": "Delta perpendicular, Delta parallel, Continuous perpendicular, Continuous parallel, Both perpendicular, Both parallel, etc.",
            "unit": "Enumeration",
            "affectsOutput": "Changes the numerical values shown on the dimension line (e.g., segment length vs. cumulative length) and the orientation of the measurement."
          },
          {
            "name": "sTextOverrideDelta",
            "technicalDefault": "",
            "businessMeaning": "Replaces the automatic measurement text for the individual segments (deltas) with a custom string.",
            "validRange": "Any alphanumeric string",
            "unit": "String",
            "affectsOutput": "Displays the custom text instead of the calculated length for delta measurements."
          },
          {
            "name": "sTextOverrideContinuous",
            "technicalDefault": "",
            "businessMeaning": "Replaces the automatic cumulative measurement text with a custom string.",
            "validRange": "Any alphanumeric string",
            "unit": "String",
            "affectsOutput": "Displays the custom text instead of the calculated total length for continuous measurements."
          },
          {
            "name": "sDescription",
            "technicalDefault": "",
            "businessMeaning": "Adds an additional text label or description near the dimension line.",
            "validRange": "Any text string",
            "unit": "String",
            "affectsOutput": "Draws the specified text at a calculated offset from the dimension line."
          },
          {
            "name": "sSideDescription",
            "technicalDefault": "Left",
            "businessMeaning": "Defines on which side of the dimension line the description text is placed.",
            "validRange": "Left, Right",
            "unit": "Direction",
            "affectsOutput": "Moves the description text to the left or right side of the dimension line relative to its direction."
          },
          {
            "name": "dOffsetDescription",
            "technicalDefault": "100",
            "businessMeaning": "Sets the distance between the dimension line and the description text.",
            "validRange": ">0 (typical drafting units)",
            "unit": "mm",
            "affectsOutput": "Moves the description text closer to or further away from the dimension line."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User changes points via 'Add points' or 'Remove points'",
            "effect": "If 'sLinkToObjects' was 'Yes', it automatically switches to 'No' to prevent conflicts with the manual overrides.",
            "cascade": [
              "sLinkToObjects"
            ]
          },
          {
            "trigger": "Script used in Paper Space (Viewport selected)",
            "effect": "The script calculates 'dVpScale' to adjust dimension text values to the printed scale, and ignores the 'sLayer' assignment to use the current viewport layer.",
            "cascade": [
              "dVpScale (internal)",
              "sLayer (ignored)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "DimensionLine",
            "description": "2D graphical lines, arrows, and text representing measurements. In Paper Space, text values are scaled.",
            "appliedTo": "Model Space or Paper Space Viewport"
          },
          {
            "type": "Text",
            "description": "The optional description text associated with the dimension.",
            "appliedTo": "Model Space or Paper Space Viewport"
          }
        ]
      },
      "tokens_used": 9991,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script execution begins and checks insertCycleCount (clears if > 1).",
          "2. Properties Palette (OPM) dialog is displayed via showDialog().",
          "3. Command line prompt: 'Select first dimension point or <ENTER> for PaperSpace'.",
          "4. [Decision Branch] User picks a point OR presses Enter.",
          "5. [Branch - Enter] Prompt: 'Select a Viewport'.",
          "6. [Loop] Command line prompts for 'Select first/next dimension points'. User selects points to add to list.",
          "7. [Validation] Checks if at least 2 points were selected. If not, reports error and erases instance.",
          "8. Command line prompt: 'Select a position for the dimension line' (defines origin).",
          "9. Command line prompt: 'Select a position for the direction' (defines rotation/vector).",
          "10. Script calculates geometry, handles scaling (if Paper Space), and draws dimension lines."
        ],
        "conditionalBranches": [
          {
            "condition": "User input at 'Select first dimension point or <ENTER> for PaperSpace'",
            "path1": {
              "name": "Model Space Mode",
              "steps": [
                "User selects a point.",
                "Script continues to collect more points.",
                "Assigns TSL instance to the layer specified in 'sLayer'.",
                "Calculates dimensions using standard Model Space coordinates."
              ]
            },
            "path2": {
              "name": "Paper Space Mode",
              "steps": [
                "User presses <ENTER>.",
                "Prompt: 'Select a Viewport'.",
                "Viewport is stored in _Viewport.",
                "Prompt: 'Select first dimension point'.",
                "Script retrieves Viewport coordinate system and scale (dVpScale).",
                "Assigns TSL to the current layer (ignores 'sLayer').",
                "Calculates dimensions scaled to viewport size."
              ]
            }
          },
          {
            "condition": "Number of dimension points collected (_PtG.length())",
            "path1": {
              "name": "Error State",
              "steps": [
                "Count is < 2.",
                "Report Error: 'Can't make a dimension with one point...'",
                "eraseInstance() is called.",
                "Script terminates."
              ]
            },
            "path2": {
              "name": "Success State",
              "steps": [
                "Count is >= 2.",
                "Proceeds to prompts for Dimension Line position and Direction."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Number of points collected during insertion",
            "errorMessage": "Can't make a dimension with one point, please try inserting this TSL again.'",
            "recovery": "User must erase the failed instance (handled automatically by script) and re-insert the TSL, selecting at least two points."
          },
          {
            "check": "Number of points available during recalculation (post-insertion)",
            "errorMessage": "Not enough points found, dimline cannot be created!",
            "recovery": "User must use the context menu 'Add points' to add more points to the instance."
          },
          {
            "check": "Viewport selection in Paper Space mode",
            "errorMessage": "Implicit (getViewport function handles cancellation)",
            "recovery": "If user cancels viewport selection, the insertion cycle effectively stops or requires restart depending on CAD behavior, but the script logic implies a viewport is required for the subsequent prompts."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Add points",
            "how": "Context Menu -> Add points",
            "effect": "Prompts user to select new points. Appends them to the existing dimension list. If 'Link to objects' was Yes, it remains unchanged, but manually added points are just coordinates."
          },
          {
            "action": "Remove points",
            "how": "Context Menu -> Remove points",
            "effect": "Prompts user to select points on the dimension to delete. Removes them from the list. Automatically sets 'Link to objects' property to 'No'."
          },
          {
            "action": "Set direction",
            "how": "Context Menu -> Set direction",
            "effect": "Prompts user to pick a new point defining the dimension vector (X-axis). Updates the rotation of the dimension text and line."
          },
          {
            "action": "Set reference point",
            "how": "Context Menu -> Set reference point",
            "effect": "Prompts user to select a point. The closest existing dimension point is moved to the first position (index 0) in the list, becoming the new origin (0.00) for measurements."
          },
          {
            "action": "Move Dimension Line",
            "how": "Grip Edit (Drag _Pt0)",
            "effect": "Moving the origin grip (_Pt0) moves the dimension line. The script automatically adjusts the extension lines (_PtG) inversely so the dimensions stay relative to the measured objects while the line moves."
          },
          {
            "action": "Update Properties",
            "how": "Object Properties Palette (OPM)",
            "effect": "Changing 'sDimStyle', 'sDimMethod', text overrides, or colors immediately updates the graphic representation."
          }
        ]
      },
      "tokens_used": 11880,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_D-Aligned.mcr\n\n## Overview\nThis script creates aligned dimension lines in both Model Space and Paper Space. It allows for flexible measurement methods (perpendicular or parallel) and can display individual segment lengths or continuous totals, with options for linking dimensions to 3D objects.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Standard dimensioning in the 3D model. |\n| Paper Space | Yes | Press `<ENTER>` at the start to select a Viewport for scaled dimensions. |\n| Shop Drawing | Yes | Ideal for annotating layouts and construction details. |\n\n## Prerequisites\n- **Required entities**: None specific (script prompts for point selection).\n- **Minimum beam count**: 0.\n- **Required settings**: Dimension Styles (must be available in the drawing catalog).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_D-Aligned.mcr`\n\n### Step 2: Select Mode (Model vs Paper Space)\n```\nCommand Line: Select first dimension point or <ENTER> for PaperSpace\nAction: \n- Pick a point in Model Space to start dimensioning.\n- OR press <ENTER> to place dimensions in a Layout/Viewport.\n```\n\n### Step 3: Select Viewport (If Paper Space)\n```\nCommand Line: Select a Viewport\nAction: Click on the border of the viewport where you want the dimension to appear.\n```\n\n### Step 4: Select First Point\n```\nCommand Line: Select first dimension point\nAction: Click the starting location for your measurement (snap to an object endpoint if desired).\n```\n\n### Step 5: Select Additional Points\n```\nCommand Line: Select next point\nAction: Click subsequent points to define the segments of the dimension. \nNote: You can select multiple points. Press Enter or Right-click to finish selecting points.\n```\n\n### Step 6: Position Dimension Line\n```\nCommand Line: Select a position for the dimension line\nAction: Click to define where the main dimension line runs through.\n```\n\n### Step 7: Set Direction\n```\nCommand Line: Select a position for the direction\nAction: Click a point to define the rotation/orientation of the dimension text and line.\n```\n\n## Properties Panel Parameters\n\n### General\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Color | number | 1 | Sets the color index (1-255) of the dimension lines and text. |\n| Layer | text | 0 | Specifies the CAD layer for the dimension (ignored in Paper Space, uses current layer). |\n| Assign to group | dropdown | [Empty] | Assigns the dimension to a specific project group (e.g., Floor 1). |\n| Link to objects | dropdown | Yes | If 'Yes', dimensions update automatically if the snapped objects move. |\n| Show in display representation | dropdown | [Empty] | Filters visibility based on the selected display representation (e.g., Model, Layout). |\n\n### Dimension\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimension style | dropdown | [Drawing Default] | Selects the visual style (arrows, text size) from defined styles. |\n| Dimension method | dropdown | [Drawing Default] | Determines how distances are calculated (e.g., Delta perpendicular, Continuous parallel, etc.). |\n\n### Text\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Text override delta | text | [Empty] | Custom text to replace the individual segment measurements. |\n| Text override continuous | text | [Empty] | Custom text to replace the total cumulative measurement. |\n| Description | text | [Empty] | Adds an additional text label near the dimension line. |\n| Side description | dropdown | Left | Places the description text on the 'Left' or 'Right' side of the dimension line. |\n| Offset description | number | 100 | Distance between the dimension line and the description text (in mm). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Add points** | Prompts you to select new points to append to the existing dimension chain. |\n| **Remove points** | Prompts you to select points on the dimension to delete them. (Note: This sets 'Link to objects' to 'No'). |\n| **Set direction** | Allows you to re-pick the point that defines the angle/rotation of the dimension line. |\n| **Set reference point** | Allows you to pick a new point to act as the start (0.00) of the dimension. |\n\n## Settings Files\n- **Dimension Styles**: Referenced from the `_DimStyles` list in the current drawing.\n- **Location**: Defined within your hsbCAD project or drawing template.\n\n## Tips\n- **Moving the Dimension Line**: You can drag the dimension line using the grip point at the origin without moving the measurement points (the extension lines will adjust automatically).\n- **Automatic Updates**: Keep \"Link to objects\" set to \"Yes\" to ensure dimensions update when you modify your timber structure.\n- **Paper Space Scaling**: When using the script in Paper Space, ensure you select the correct Viewport so the script calculates the correct scale factor for the text.\n\n## FAQ\n- **Q: Can I change the dimension from individual segments to a total length after inserting?**\n  - A: Yes, select the dimension, open the Properties Palette, and change the \"Dimension method\" (e.g., to \"Continuous perpendicular\").\n- **Q: Why did my dimension disappear immediately after insertion?**\n  - A: The script requires at least two points to create a dimension. If you selected fewer than two points, the instance is erased automatically.\n- **Q: What happens if I move a beam I snapped to?**\n  - A: If \"Link to objects\" was \"Yes\" during insertion, the dimension point will move with the beam. If you manually edited points via the context menu, the link might be broken."
      },
      "tokens_used": 7894,
      "error": null
    }
  }
}