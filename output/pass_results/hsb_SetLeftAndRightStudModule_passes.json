{
  "filename": "hsb_SetLeftAndRightStudModule.mcr",
  "status": "completed",
  "total_tokens": 21301,
  "processing_time": 188.82244229316711,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "02.11.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4679,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"usageEnvironment\": {\n    \"primarySpace\": \"ModelSpace\",\n    \"supportsPaperSpace\": false,\n    \"isShopDrawingScript\": false,\n    \"isMultipageScript\": false,\n    \"detectionEvidence\": \"PrEntity ssE(T('Select one or More Elements'), ElementWall());\",\n    \"Beam bmAll[]=el.beam();\",\n    \"bmLeft.setModule(...);\",\n    \"bmLeft.setColor(...);\"\n  },\n  \"prerequisites\": {\n    \"requiredEntities\": [\n      \"Element\",\n      \"Beam\"\n    ],\n    \"minimumBeams\": 2,\n    \"requiredSpace\": \"3D Model Space with Wall Elements containing beams\",\n    \"requiredSettings\": []\n  }\n}\n```"
      },
      "tokens_used": 2490,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one or More Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnInsert (via showDialogOnce)",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Module Color",
            "defaultValue": 32,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2328,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically assigns a unique module name and specific color to the outermost studs (leftmost and rightmost) of selected wall elements to distinguish them from internal framing.",
          "category": "Framing/Organization",
          "typicalUseCase": "A user needs to quickly identify or separate boundary studs in a wall for downstream processing, such as export filtering, CNC lists, or visual QC in the model."
        },
        "parameters": [
          {
            "name": "nColor",
            "technicalDefault": 32,
            "businessMeaning": "The visual color assigned to the left and right studs to make them stand out in the model and drawings.",
            "validRange": "1-255 (AutoCAD Color Index)",
            "unit": "Color Index",
            "affectsOutput": "Changes the display color of the boundary studs. Does not alter geometry, but modifies the visual entity attributes."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "Data Attribute (Module Name)",
            "description": "A unique identifier is assigned to the 'Module' property of the outermost studs.",
            "appliedTo": "The first and last perpendicular beam (stud) found within the selected wall elements."
          },
          {
            "type": "Visual Attribute (Color)",
            "description": "The display color of the identified studs is updated to the parameter value.",
            "appliedTo": "The first and last perpendicular beam (stud) found within the selected wall elements."
          }
        ]
      },
      "tokens_used": 2360,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts execution triggered by user launch.",
          "System checks if in insertion mode (_bOnInsert).",
          "If inserting, system checks if insertCycleCount > 1. If yes, script erases itself and terminates immediately (prevents duplicate runs).",
          "If inserting for the first time, system checks _kExecuteKey. If empty, properties dialog (ShowDynamicDialog via showDialogOnce) opens for user to set 'Module Color'.",
          "Prompt appears: 'Select one or More Elements'. User selects one or more wall elements (ElementWall).",
          "Selected elements are appended to the script's internal element list, and the script instance saves itself to the database. Script returns (execution pauses/suspends).",
          "Script resumes execution (Database created / Element constructed event).",
          "System checks if the execute key was used (loading from catalog) and updates property values if applicable.",
          "System validates if any elements are stored in _Element. If empty, script erases instance and terminates.",
          "Script generates a unique string identifier (sModule) based on the script instance handle.",
          "Script iterates through each selected element.",
          "Inside loop: Element validity is checked. Invalid elements are skipped.",
          "Inside loop: Element coordinate system is extracted to determine local X, Y, Z axes.",
          "Inside loop: All beams within the element are collected.",
          "Inside loop: Beams are filtered to keep only those perpendicular to the local X axis (vx), and they are sorted.",
          "Inside loop: System checks if the number of perpendicular beams is greater than 1.",
          "If > 1 beams exist: The first beam in the sorted list (Left Stud) is processed.",
          "If Left Stud has no existing module name (''), it is assigned a unique module name (sModule + nID) and colored with 'nColor'. nID is incremented.",
          "The last beam in the sorted list (Right Stud) is processed.",
          "If Right Stud has no existing module name (''), it is assigned a unique module name (sModule + nID) and colored with 'nColor'. nID is incremented.",
          "Flag 'nErase' is set to true to indicate successful modification.",
          "After loop: System checks 'nErase' flag or if the event was '_bOnElementConstructed'.",
          "If true, the script instance erases itself from the model (leaving only the modified beams), and execution terminates."
        ],
        "conditionalBranches": [
          {
            "condition": "Duplicate Insertion Check (insertCycleCount)",
            "path1": {
              "name": "Count > 1",
              "steps": [
                "Script detects re-run cycle.",
                "eraseInstance() is called.",
                "Script terminates immediately."
              ]
            },
            "path2": {
              "name": "Count = 1",
              "steps": [
                "Script proceeds to Dialog and Selection phase."
              ]
            }
          },
          {
            "condition": "Number of Perpendicular Beams Found",
            "path1": {
              "name": "0 or 1 Beam Found",
              "steps": [
                "Loop continues to next element.",
                "No modules or colors are set for this element.",
                "nErase flag remains false for this iteration."
              ]
            },
            "path2": {
              "name": "> 1 Beams Found",
              "steps": [
                "First beam (Left) is checked/updated.",
                "Last beam (Right) is checked/updated.",
                "nErase flag is set to true."
              ]
            }
          },
          {
            "condition": "Existing Module Name Check",
            "path1": {
              "name": "Module is NOT Empty",
              "steps": [
                "Beam is skipped.",
                "Existing module name and color are preserved.",
                "nID counter is NOT incremented."
              ]
            },
            "path2": {
              "name": "Module is Empty",
              "steps": [
                "New module name is assigned.",
                "Color is updated to 'nColor'.",
                "nID counter is incremented."
              ]
            }
          },
          {
            "condition": "Element Storage Validation (_Element.length)",
            "path1": {
              "name": "Length is 0",
              "steps": [
                "eraseInstance() is called.",
                "Script terminates."
              ]
            },
            "path2": {
              "name": "Length > 0",
              "steps": [
                "Main processing loop begins."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "None explicitly shown to user, but script self-terminates.",
            "recovery": "User must re-run the command and ensure valid Wall Elements are selected."
          },
          {
            "check": "Element Validity (bIsValid)",
            "errorMessage": "None (Silent skip).",
            "recovery": "Script continues processing other valid elements."
          },
          {
            "check": "Beam Count (>1 perpendicular)",
            "errorMessage": "None (Silent skip).",
            "recovery": "Wall must contain at least 2 perpendicular beams to have a 'Left' and 'Right' boundary defined."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Script Parameters (Color)",
            "how": "Select the script instance (if it existed persistently, but this script auto-erases) or properties *before* selection. Since the script erases itself after execution, post-insertion modification of the *instance* is not applicable. The user must change the color setting in the dialog during the 'Select Elements' phase of a new run, or use a catalog entry.",
            "effect": "Changes the color applied to the boundary studs in the next execution."
          },
          {
            "action": "Re-run Script on same elements",
            "how": "Execute command again and select the wall elements.",
            "effect": "Conditional: If beams already have a module name, they are ignored. If empty, they are updated. This allows partial updates or safe re-runs."
          }
        ]
      },
      "tokens_used": 4534,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SetLeftAndRightStudModule.mcr\n\n## Overview\nThis script automatically identifies the outermost studs (leftmost and rightmost) of selected wall elements and assigns them a unique module name and a specific color. It is used to visually distinguish or flag boundary studs for filtering in exports, CNC lists, or quality control.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This is the primary environment for selecting wall elements. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: Valid Wall Elements (`ElementWall`) containing beams.\n- **Minimum Beam Count**: The selected wall must contain at least two beams perpendicular to the wall's local X-axis to define a \"Left\" and \"Right\" stud.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Browse and select `hsb_SetLeftAndRightStudModule.mcr`\n\n### Step 2: Configure Properties\n```\nDialog: Properties Palette / Dynamic Dialog\nAction: Set the 'Module Color' to the desired AutoCAD Color Index (e.g., 32).\nNote: This determines the color of the boundary studs.\n```\n\n### Step 3: Select Wall Elements\n```\nCommand Line: Select one or More Elements\nAction: Click on the wall elements in the model you wish to process. You can select multiple walls.\n```\n\n### Step 4: Execute\n```\nAction: Press Enter or Right-click to finish selection.\nResult: The script identifies the first and last studs of the selected walls, applies the unique module name and color, and then erases itself from the model.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Module Color | Number (0-255) | 32 | The AutoCAD Color Index applied to the left and right boundary studs. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add persistent right-click menu items as it auto-erases after execution. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Safe Re-running**: You can run this script multiple times on the same elements. If a boundary stud already has a module name assigned, the script will skip it and preserve the existing name. It only modifies studs with empty module fields.\n- **Visualization**: Use the color setting (default is 32) to quickly verify which studs have been flagged by the script in your 3D model.\n- **Self-Cleaning**: The script instance automatically removes itself from the drawing after processing. Do not look for it in the model after the command finishes.\n\n## FAQ\n- **Q: Why didn't the script change the color of my end studs?**\n  - **A:** The script only processes beams that are perpendicular to the wall's local X-axis. Ensure your studs are oriented correctly. Additionally, if a beam already has a \"Module\" name assigned, it will be skipped.\n- **Q: Can I change the color after I have run the script?**\n  - **A:** No, because the script instance deletes itself immediately after running. You must set the desired color in the properties dialog *before* selecting the elements during the command execution.\n- **Q: What happens if I select a wall with only one stud?**\n  - **A:** The script requires at least two perpendicular beams to identify a \"Left\" and \"Right\" boundary. If a wall has fewer than two valid beams, it will be skipped without modification."
      },
      "tokens_used": 4910,
      "error": null
    }
  }
}