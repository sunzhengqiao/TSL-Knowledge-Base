{
  "filename": "Rothoblaas WHT.mcr",
  "status": "completed",
  "total_tokens": 48696,
  "processing_time": 833.6953845024109,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 8849,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of `_kModelSpace` in `tslDialog.dbCreate` call; defines standard `PropDouble`/`PropString` properties for Object Property Manager (OPM) which is typical for Model Space TSL insertions; logic focuses on map/setting management and fixture insertion rather than drawing generation."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element",
            "StickFrame Wall"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "FixtureDefinition.xml (Expected in hsbCompany\\TSL\\Settings or hsbInstall\\Content\\General\\TSL\\Settings)"
          ]
        }
      },
      "tokens_used": 7073,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Context Menu: 'Add Fixing'",
            "title": "scriptName()",
            "dataSource": "mapTsl (DialogMode 1)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "ShowDynamicDialog",
            "trigger": "Context Menu: 'Add Fixture to [Script Name]'",
            "title": "scriptName()",
            "dataSource": "mapTsl (DialogMode 3)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "ShowDynamicDialog",
            "trigger": "Context Menu: 'Delete Fixing'",
            "title": "scriptName()",
            "dataSource": "mapTsl (DialogMode 2)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": null,
            "variable": "sArticle",
            "type": "PropString",
            "displayName": "Article",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "General",
            "description": "Defines the Article"
          },
          {
            "index": null,
            "variable": "sManufacturer",
            "type": "PropString",
            "displayName": "Manufacturer",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "General",
            "description": "Defines the Manufacturer"
          },
          {
            "index": null,
            "variable": "sDescription",
            "type": "PropString",
            "displayName": "Description",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "General",
            "description": "Defines the Description"
          },
          {
            "index": null,
            "variable": "sCategory",
            "type": "PropString",
            "displayName": "Category",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "General",
            "description": "Defines the Category"
          },
          {
            "index": null,
            "variable": "sModel",
            "type": "PropString",
            "displayName": "Model",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "General",
            "description": "Defines the Model"
          },
          {
            "index": null,
            "variable": "dScaleX",
            "type": "PropDouble",
            "displayName": "Scale X",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the Scale X"
          },
          {
            "index": null,
            "variable": "dScaleY",
            "type": "PropDouble",
            "displayName": "Scale Y",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the Scale Y"
          },
          {
            "index": null,
            "variable": "dScaleZ",
            "type": "PropDouble",
            "displayName": "Scale Z",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the Scale Z"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Add Fixing",
            "handler": "sTriggerAddFixing",
            "action": "Opens dialog to define a new fixture article and geometry to add to settings.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Add Fixture to [Script Name]",
            "handler": "sTriggerTagFixture",
            "action": "Opens dialog to select an existing fixture from the general list to make available in this script.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Delete Fixing",
            "handler": "sTriggerDeleteFixing",
            "action": "Opens dialog to select an article to be removed from the script's available fixtures.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Export Settings",
            "handler": "sTriggerExportSettings",
            "action": "Prompts to overwrite, then saves current fixture settings to XML.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "FixtureDefinition.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings"
            ],
            "purpose": "Stores definitions of fixture articles (geometry, application scripts, manufacturer info).",
            "required": false
          }
        ]
      },
      "tokens_used": 7706,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts and configures Rothoblaas WHT hold-down anchors (shear wall tension anchors) onto timber beams, panels, or StickFrame Walls, managing geometry, drilling, and non-nail zones.",
          "category": "Hardware",
          "typicalUseCase": "Engineers or detailers apply hold-down anchors to shear walls to resist uplift forces, specifying the exact WHT model and its placement within the timber structure."
        },
        "parameters": [
          {
            "name": "sArticle",
            "technicalDefault": "",
            "businessMeaning": "The specific product code (e.g., WHT340) identifying the Rothoblaas WHT hardware model to be inserted.",
            "validRange": "WHT340, WHT440, WHT540, WHT620, WHT740 (or custom definitions added via settings)",
            "unit": "string",
            "affectsOutput": "Determines the 3D representation geometry (height, width, depth), drilling positions, and plan symbol size of the anchor."
          },
          {
            "name": "sManufacturer",
            "technicalDefault": "",
            "businessMeaning": "The name of the hardware supplier (e.g., Rothoblaas).",
            "validRange": "Text (e.g., 'Rothoblaas')",
            "unit": "string",
            "affectsOutput": "Metadata for BIM/scheduling; does not change geometry."
          },
          {
            "name": "sDescription",
            "technicalDefault": "",
            "businessMeaning": "A detailed text description of the fixture's function or characteristics.",
            "validRange": "Free text",
            "unit": "string",
            "affectsOutput": "Metadata for labeling or lists; does not change geometry."
          },
          {
            "name": "sCategory",
            "technicalDefault": "",
            "businessMeaning": "Functional group for the fixture (e.g., 'HoldDown', 'Anchor') used for filtering or organization.",
            "validRange": "Free text",
            "unit": "string",
            "affectsOutput": "Organization within selection dialogs or reports; does not change geometry."
          },
          {
            "name": "sModel",
            "technicalDefault": "",
            "businessMeaning": "The specific model designation or variant.",
            "validRange": "Free text",
            "unit": "string",
            "affectsOutput": "Metadata; used to distinguish variants if sArticle is generic."
          },
          {
            "name": "dScaleX",
            "technicalDefault": "0",
            "businessMeaning": "Scaling factor for the fixture's geometry along the local X-axis (typically width or length perpendicular to beam axis).",
            "validRange": "0.5 to 2.0 (0 usually implies 1.0 or use default dimensions)",
            "unit": "ratio",
            "affectsOutput": "Stretches or shrinks the 3D body and drilling pattern horizontally."
          },
          {
            "name": "dScaleY",
            "technicalDefault": "0",
            "businessMeaning": "Scaling factor for the fixture's geometry along the local Y-axis (often thickness or depth into the material).",
            "validRange": "0.5 to 2.0",
            "unit": "ratio",
            "affectsOutput": "Stretches or shrinks the 3D body depth."
          },
          {
            "name": "dScaleZ",
            "technicalDefault": "0",
            "businessMeaning": "Scaling factor for the fixture's geometry along the local Z-axis (typically height or vertical axis).",
            "validRange": "0.5 to 2.0",
            "unit": "ratio",
            "affectsOutput": "Stretches or shrinks the 3D body height and vertical drill spacing."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sArticle selection",
            "effect": "Auto-populates geometry (Height/Width/Depth) and machining data from the internal settings map or hardcoded arrays.",
            "cascade": [
              "dScaleX",
              "dScaleY",
              "dScaleZ"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "MetalPart / 3D Body",
            "description": "A visual representation of the WHT anchor shape (steel bracket), scaled according to scale properties.",
            "appliedTo": "Insertion point on Beam, Element, or StickFrame Wall"
          },
          {
            "type": "Drill / Bore",
            "description": "Holes for fasteners (bolts/screws) required to attach the anchor to the timber, including rod clearance holes.",
            "appliedTo": "Host timber element (Beam/Plate)"
          },
          {
            "type": "Contour / Cutout",
            "description": "Cut-outs in the timber to allow for the anchor thickness or specific hardware interlocks (e.g., non-nail areas).",
            "appliedTo": "Host timber element"
          },
          {
            "type": "Plan Symbol",
            "description": "2D representation in layout drawings for production or installation plans.",
            "appliedTo": "Plan Views"
          }
        ]
      },
      "tokens_used": 8456,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Constants defined, environment checked, and debug flags set.",
          "2. Settings Management: Script loads 'FixtureDefinition.xml' from hsbCompany or hsbInstall paths. If missing, it may create or load defaults.",
          "3. Dialog Mode Check: Script checks if 'DialogMode' is set in the instance map (passed via context menu triggers).",
          "4. Branch A (Management Mode): If DialogMode > 0, display a specific dialog (Add, Delete, or Tag fixture), update the XML/MapObject settings, and exit execution.",
          "5. Branch B (Standard Execution): If DialogMode == 0, proceed to insertion logic.",
          "6. Entity Identification: Script identifies the host element (GenBeam, Element, or StickFrame Wall).",
          "7. Data Collection: Determines dimensions and drilling data based on selected 'sArticle' (lookup in Settings or Hardcoded defaults).",
          "8. Geometry Generation: Creates 3D bodies, applies scaling (dScaleX/Y/Z), and generates plan symbols.",
          "9. Machining Application: Applies Drills (bores), Contours (cutouts), and Non-Nail areas to the host timber.",
          "10. Finalization: Script finishes, storing properties in the instance."
        ],
        "conditionalBranches": [
          {
            "condition": "DialogMode flag (Internal State)",
            "path1": {
              "name": "Settings Management Flow",
              "steps": [
                "User selects a context menu item (Add/Delete/Tag/Export).",
                "Script sets internal 'DialogMode' (1, 2, or 3) and triggers a recalc.",
                "Properties (PropString/PropDouble) are defined dynamically.",
                "ShowDynamicDialog displays the form.",
                "User input updates the global 'FixtureDefinition.xml' settings.",
                "Script exits without modifying geometry."
              ]
            },
            "path2": {
              "name": "Standard Insertion Flow",
              "steps": [
                "Script runs normally with DialogMode = 0.",
                "Reads 'sArticle' and Scale properties.",
                "Draws geometry and applies machining."
              ]
            }
          },
          {
            "condition": "Fixture Data Source",
            "path1": {
              "name": "Custom/Settings Data",
              "steps": [
                "'sArticle' matches an entry in the loaded 'FixtureDefinition.xml'.",
                "Geometry and machining parameters are pulled from the XML map.",
                "Supports custom user-defined hardware."
              ]
            },
            "path2": {
              "name": "Hardcoded Fallback Data",
              "steps": [
                "No matching XML entry found.",
                "Script falls back to internal arrays (sArticleNames: WHT340, WHT440, etc.).",
                "Uses default dimensions defined in the script code."
              ]
            }
          },
          {
            "condition": "Export Settings Trigger",
            "path1": {
              "name": "File Exists",
              "steps": [
                "Path to XML contains an existing file.",
                "User prompted: 'Are you sure to overwrite existing settings?'.",
                "If 'Yes', file is overwritten with current MapObject data."
              ]
            },
            "path2": {
              "name": "File Does Not Exist",
              "steps": [
                "Path is empty or file missing.",
                "Script creates folder structure if necessary.",
                "File is written immediately without confirmation prompt."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "File Overwrite Confirmation",
            "errorMessage": "Are you sure to overwrite existing settings? [No/Yes]",
            "recovery": "User must type 'Yes' (or localized equivalent) to proceed with overwriting the settings file; 'No' cancels the operation."
          },
          {
            "check": "Settings Path Availability",
            "errorMessage": "Failed to write to [Path] (Implicit)",
            "recovery": "Ensure write permissions exist in the hsbCompany\\TSL\\Settings directory or that the drive is available."
          },
          {
            "check": "Beam/Element Compatibility",
            "errorMessage": "(Implicit) Drill or Contour geometry falls outside host boundaries.",
            "recovery": "Adjust the insertion point or ensure the host beam/element is large enough for the selected fixture dimensions."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Article Model",
            "how": "Properties Palette (OPM) - 'Article' property",
            "effect": "Updates the 3D body, drilling pattern, and plan symbol to match the new WHT model dimensions."
          },
          {
            "action": "Scale Fixture Geometry",
            "how": "Properties Palette (OPM) - 'Scale X/Y/Z' properties",
            "effect": "Stretches the 3D representation and associated machining along the respective local axes."
          },
          {
            "action": "Add Custom Fixtures",
            "how": "Right-Click Context Menu -> 'Add Fixing'",
            "effect": "Opens a dialog to define a new fixture which is then saved to 'FixtureDefinition.xml' for future use."
          },
          {
            "action": "Export Configuration",
            "how": "Right-Click Context Menu -> 'Export Settings'",
            "effect": "Saves the current set of fixtures and settings to an XML file, allowing for backup or sharing of configurations."
          }
        ]
      },
      "tokens_used": 9641,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Rothoblaas WHT\n\n## Overview\nThis script inserts and configures Rothoblaas WHT hold-down anchors (shear wall tension anchors) onto timber beams, panels, or StickFrame Walls. It automatically manages the 3D geometry, drilling positions, and non-nail zones based on the selected hardware model.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates within the 3D model. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | Does not generate shop drawings directly. |\n\n## Prerequisites\n- **Required Entities**: A `GenBeam`, `Element`, or `StickFrame Wall` must exist in the model to host the anchor.\n- **Minimum Beam Count**: 1 (you must select a timber element to attach the fixture).\n- **Required Settings**: `FixtureDefinition.xml` (Expected in `hsbCompany\\TSL\\Settings` or `hsbInstall\\Content\\General\\TSL\\Settings`). If missing, the script will use hardcoded defaults.\n\n## Usage Steps\n\n### Step 1: Launch Script\n```\nCommand Line: TSLINSERT\nAction: Select \"Rothoblaas WHT.mcr\" from the list of available scripts.\n```\n\n### Step 2: Select Host Element\n```\nCommand Line: Select beam/element/wall:\nAction: Click on the timber beam, wall panel, or StickFrame Wall where you want to place the WHT anchor.\n```\n\n### Step 3: Configure Properties\n```\nAction: Press `Esc` to finish selection, then select the inserted script instance.\nAction: Open the Properties Palette (Ctrl+1).\nAction: Change the \"Article\" property to select the specific WHT model (e.g., WHT340).\nAction: Adjust Scale X/Y/Z if necessary to stretch the fixture geometry.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Article | String | \"\" | The specific product code (e.g., WHT340, WHT440) defining the geometry and drilling. |\n| Manufacturer | String | \"\" | The name of the hardware supplier (e.g., Rothoblaas). |\n| Description | String | \"\" | A detailed text description of the fixture. |\n| Category | String | \"\" | Functional group for the fixture (e.g., HoldDown). |\n| Model | String | \"\" | The specific model designation or variant. |\n| Scale X | Double | 0 | Scaling factor for width (0 implies default dimensions). |\n| Scale Y | Double | 0 | Scaling factor for thickness/depth. |\n| Scale Z | Double | 0 | Scaling factor for height. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add Fixing | Opens a dialog to define a new custom fixture article and geometry, adding it to the settings file. |\n| Add Fixture to Rothoblaas WHT | Opens a dialog to select an existing fixture from the general list to make available in this specific script. |\n| Delete Fixing | Opens a dialog to select and remove an article from the script's available fixtures. |\n| Export Settings | Prompts to save the current fixture configuration to `FixtureDefinition.xml` (useful for backups). |\n\n## Settings Files\n- **Filename**: `FixtureDefinition.xml`\n- **Location**: `hsbCompany\\TSL\\Settings` or `hsbInstall\\Content\\General\\TSL\\Settings`\n- **Purpose**: Stores custom definitions of fixture articles, including their geometry dimensions, machining data, and manufacturer info.\n\n## Tips\n- **Scaling**: If the standard dimensions of a WHT model do not match your specific requirement, use the `Scale X`, `Scale Y`, and `Scale Z` properties to stretch the 3D body and drilling pattern without creating a new fixture definition.\n- **Custom Fixtures**: Use the \"Add Fixing\" context menu option to create definitions for non-standard or modified anchors that you use frequently.\n- **Backup**: Before making bulk changes to fixtures, use \"Export Settings\" to ensure your configurations can be restored or shared with colleagues.\n\n## FAQ\n- **Q: How do I switch between different WHT sizes (e.g., from WHT340 to WHT540)?**\n  - A: Select the inserted anchor in the model, open the Properties Palette (Ctrl+1), and type the new model code (e.g., \"WHT540\") into the \"Article\" field.\n- **Q: What happens if the XML settings file is missing?**\n  - A: The script will fall back to a built-in list of standard Rothoblaas WHT models (WHT340, WHT440, etc.) with default dimensions.\n- **Q: Can I use this on walls other than StickFrame Walls?**\n  - A: Yes, the script supports standard `GenBeam` entities and timber `Elements` (panels) in addition to StickFrame Walls."
      },
      "tokens_used": 6971,
      "error": null
    }
  }
}