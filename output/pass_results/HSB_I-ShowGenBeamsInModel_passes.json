{
  "filename": "HSB_I-ShowGenBeamsInModel.mcr",
  "status": "completed",
  "total_tokens": 39325,
  "processing_time": 500.8870017528534,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "16.05.2018",
            "author": "DR",
            "changes": "Release"
          },
          {
            "version": "1.01",
            "date": "17.05.2018",
            "author": "FA",
            "changes": "Added a working secondary filter which makes it filter on beamcodes over filter definitions."
          },
          {
            "version": "1.02",
            "date": "17.05.2018",
            "author": "FA",
            "changes": "Added custom commands, for adding and removing beams."
          },
          {
            "version": "1.03",
            "date": "18.05.2018",
            "author": "DR",
            "changes": "Added option to show all selected GenBeams - Tokens trimmed - Custom commands (add/remove beams) expanded to work with genBeams"
          },
          {
            "version": "1.04",
            "date": "18.05.2018",
            "author": "DR",
            "changes": "Report of filter results added"
          },
          {
            "version": "1.05",
            "date": "22.05.2018",
            "author": "DR",
            "changes": "Removed text field for beam code, all selection filtered by HSB_G-FilterGenBeams. Set initial values for proper catalog definitions"
          },
          {
            "version": "1.06",
            "date": "22.05.2018",
            "author": "DR",
            "changes": "Adding option for empty value for filter definition"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "HSB_G-FilterGenBeams"
        ]
      },
      "tokens_used": 6555,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script interacts with GenBeam entities and uses 3D drawing primitives (envelopeBody). No 'sd_' prefix, '_Viewport', or '#Type E' patterns found indicating it is not a ShopDrawing or Paper Space script."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "HSB_G-FilterGenBeams"
          ]
        }
      },
      "tokens_used": 3569,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Select genbeams to filter\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"Point insertion point\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sColor\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Color\",\n      \"defaultValue\": \"Green\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Default\",\n        \"White\",\n        \"Red\",\n        \"Yellow\",\n        \"Green\",\n        \"Cyan\",\n        \"Blue\",\n        \"Magenta\",\n        \"Black\",\n        \"Gray\",\n        \"Dark brown\",\n        \"Light brown\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sShowEnvelope\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Show Envelope\",\n      \"defaultValue\": \"Yes\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Show filtered GenBeams\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sShowPointer\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Show Pointer\",\n      \"defaultValue\": \"Yes\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Displays a line from insertion point to filtered GenBeam's center\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sShowAllSelected\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Show All GenBeams Selected\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Show all GenBeams selected (no filter applied)\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"beamFilterDefinition\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Filter definition for GenBeams\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": \"<dynamic from catalog HSB_G-FilterGenBeams>\",\n      \"category\": \"Filter GenBeams\",\n      \"description\": \"Filter definition for GenBeams. Use HSB_G-FilterGenBeams to define the filters.\"\n    }\n  ],\n  \"contextMenu\": [\n    {\n      \"menuItem\": \"Add genBeams\",\n      \"handler\": \"Add genBeams\",\n      \"action\": \"Prompts user to select GenBeams to add to the instance list.\",\n      \"alsoTriggeredBy\":"
      },
      "tokens_used": 7955,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A visualization tool used to filter, highlight, and identify specific General Beams (GenBeams) in the 3D model based on custom filter definitions.",
          "category": "Visualization/ModelCheck",
          "typicalUseCase": "Used during the design phase to visually verify specific groups of elements (e.g., 'Show me all rafters longer than 4m' or 'Highlight all columns') using visual envelopes and leader lines without modifying the actual beam geometry."
        },
        "parameters": [
          {
            "name": "sColor",
            "technicalDefault": "Green",
            "businessMeaning": "Sets the display color for the filtered beams and pointer lines to distinguish them from the normal model geometry.",
            "validRange": "Default, White, Red, Yellow, Green, Cyan, Blue, Magenta, Black, Gray, Dark brown, Light brown",
            "unit": "Index",
            "affectsOutput": "Changes the color of the drawn beam envelopes, pointer lines, and the insertion crosshair."
          },
          {
            "name": "sShowEnvelope",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the 3D solid/shell representation of the filtered beams on or off.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If 'Yes', draws the 3D body (envelope) of the GenBeams. If 'No', only the insertion point and potentially pointers are shown."
          },
          {
            "name": "sShowPointer",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the display of leader lines connecting the script's insertion point to the center of each filtered beam.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If 'Yes', draws line segments identifying the location of specific beams relative to the script's origin."
          },
          {
            "name": "sShowAllSelected",
            "technicalDefault": "No",
            "businessMeaning": "Determines whether to visualize the entire original selection set or only the subset of beams that match the filter criteria.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If 'Yes', ignores the filter results and highlights every beam selected during insertion. If 'No', highlights only the beams passing the filter."
          },
          {
            "name": "beamFilterDefinition",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific criteria (catalog entry) used to filter the selected GenBeams (e.g., filtering by name, code, or property).",
            "validRange": "Entries defined in 'HSB_G-FilterGenBeams' catalog",
            "unit": "String",
            "affectsOutput": "Controls which specific beams within the selection set are actually processed and displayed."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "beamFilterDefinition is changed",
            "effect": "Recalculates the list of beams to be displayed; may result in zero beams if the filter excludes all selected items.",
            "cascade": [
              "sShowEnvelope",
              "sShowPointer"
            ]
          },
          {
            "trigger": "sShowAllSelected is set to 'Yes'",
            "effect": "Overrides the 'beamFilterDefinition' for visualization purposes, showing all originally selected beams instead of the filtered subset.",
            "cascade": [
              "beamFilterDefinition"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Visualization Element",
            "description": "3D Envelope bodies (solids) representing the filtered beams.",
            "appliedTo": "GenBeams matching the filter criteria (or all selected if 'Show All' is active)."
          },
          {
            "type": "Visualization Element",
            "description": "Line segments (Pointers) connecting the script insertion point to beam centers.",
            "appliedTo": "GenBeams matching the filter criteria."
          },
          {
            "type": "Visualization Element",
            "description": "Crosshair marker at the script insertion point.",
            "appliedTo": "Model Space (at insertion coordinates)."
          }
        ]
      },
      "tokens_used": 7000,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script started (Insert or Update)",
          "Check if triggered by Catalog Execution Key",
          "[Conditional] If not by Catalog Key: Show Properties Dialog",
          "Save properties to '_LastInserted' catalog",
          "Prompt user to select GenBeams",
          "Validate selection (check if _GenBeam array is populated)",
          "Prompt user for Insertion Point (_Pt0)",
          "Execute Filter Logic using HSB_G-FilterGenBeams",
          "Validate Filter Result (Check if external TSL loaded successfully)",
          "Report results (Total Selected vs Total Filtered)",
          "Draw Crosshair at Insertion Point",
          "[Conditional] If 'Show All Selected' is Yes: Draw all selected GenBeams (Red)",
          "Draw Filtered GenBeams in selected color",
          "[Conditional] If 'Show Envelope' is Yes: Draw 3D Envelopes",
          "[Conditional] If 'Show Pointer' is Yes: Draw Leader Lines"
        ],
        "conditionalBranches": [
          {
            "condition": "Initial Execution Mode",
            "path1": {
              "name": "Catalog Execution",
              "steps": [
                "Load properties from Catalog entry",
                "Skip Properties Dialog",
                "Proceed to selection"
              ]
            },
            "path2": {
              "name": "Manual Insertion",
              "steps": [
                "Show Properties Dialog",
                "User confirms settings",
                "Proceed to selection"
              ]
            }
          },
          {
            "condition": "Selection Validation during Insert",
            "path1": {
              "name": "Valid Selection",
              "steps": [
                "Store GenBeams in _GenBeam array",
                "Ask for Insertion Point",
                "Create Instance"
              ]
            },
            "path2": {
              "name": "Empty Selection",
              "steps": [
                "Erase Instance immediately",
                "Script ends without error message"
              ]
            }
          },
          {
            "condition": "Show All GenBeams Selected (Property)",
            "path1": {
              "name": "Yes (No Filter)",
              "steps": [
                "Ignore beamFilterDefinition",
                "Draw all beams in _GenBeam array",
                "Draw them in Red (Color Index 1)"
              ]
            },
            "path2": {
              "name": "No (Filter Applied)",
              "steps": [
                "Run beamFilterDefinition",
                "Draw only matching beams",
                "Draw them in user-defined 'Color' property"
              ]
            }
          },
          {
            "condition": "Context Menu Command",
            "path1": {
              "name": "Add genBeams",
              "steps": [
                "Prompt user for GenBeam selection",
                "Append valid GenBeams to internal list",
                "Recalculate display"
              ]
            },
            "path2": {
              "name": "Remove genBeams by selection",
              "steps": [
                "Prompt user for GenBeam selection",
                "Remove found GenBeams from internal list",
                "Recalculate display"
              ]
            },
            "path3": {
              "name": "Remove all genBeams",
              "steps": [
                "Clear internal list",
                "Recalculate display (Effectively hides everything)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Selection during Insert",
            "errorMessage": "",
            "recovery": "Script silently erases the instance; user must run command again and select beams."
          },
          {
            "check": "Filter Dependency (HSB_G-FilterGenBeams)",
            "errorMessage": "Beams could not be filtered! Make sure that the tsl HSB_G-FilterGenBeams is loaded in the drawing.",
            "recovery": "Load/Install the HSB_G-FilterGenBeams script, update the instance, or select a valid Filter Definition."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Visualization Settings",
            "how": "OPM (Properties Palette)",
            "effect": "Updates Color, toggles Envelope visibility, or toggles Pointer visibility immediately."
          },
          {
            "action": "Change Filter Definition",
            "how": "OPM (Properties Palette) -> 'Filter definition for GenBeams'",
            "effect": "Re-runs the filter logic and updates which beams are highlighted."
          },
          {
            "action": "Modify Beam Selection Set",
            "how": "Right-click Context Menu -> 'Add genBeams' or 'Remove genBeams by selection'",
            "effect": "Adds or removes specific beams from the script's internal list without restarting the script."
          },
          {
            "action": "Reset Beam Selection",
            "how": "Right-click Context Menu -> 'Remove all genBeams'",
            "effect": "Clears all beams from the display list."
          }
        ]
      },
      "tokens_used": 8039,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_I-ShowGenBeamsInModel.mcr\n\n## Overview\nThis script allows users to visually filter, highlight, and identify specific General Beams (GenBeams) in the 3D model based on custom criteria. It creates visual envelopes and leader lines to verify the location and properties of filtered elements without modifying the actual beam geometry.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model environment. |\n| Paper Space | No | Not intended for layout views. |\n| Shop Drawing | No | Not intended for manufacturing drawings. |\n\n## Prerequisites\n- **Required entities**: GenBeams must exist in the model.\n- **Minimum beam count**: At least 1 GenBeam must be selected during insertion to see results.\n- **Required settings**: The script `HSB_G-FilterGenBeams` must be loaded and available to define filter criteria.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Select `HSB_I-ShowGenBeamsInModel.mcr` from the file list.\n\n### Step 2: Select GenBeams\n```\nCommand Line: Select genbeams to filter\nAction: Click on the beams you wish to analyze or use a window selection. Press Enter to confirm.\n```\n\n### Step 3: Set Insertion Point\n```\nCommand Line: Point insertion point\nAction: Click in the model space to place the script's reference point (a crosshair).\n```\n*Note: If you did not select any beams in Step 2, the instance will erase itself automatically.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Color** | dropdown | Green | Sets the color for the highlighted beams and pointer lines. Options include Default, White, Red, Yellow, Green, Cyan, Blue, Magenta, Black, Gray, Dark brown, and Light brown. |\n| **Show Envelope** | dropdown | Yes | Toggles the 3D solid representation of the filtered beams. If \"No\", only the insertion point and pointers are drawn. |\n| **Show Pointer** | dropdown | Yes | Displays a leader line connecting the script insertion point to the center of each filtered beam. |\n| **Show All GenBeams Selected** | dropdown | No | If \"Yes\", displays *all* beams originally selected during insertion (ignoring the filter). If \"No\", only beams matching the filter definition are shown. |\n| **Filter definition for GenBeams** | dropdown | [Empty] | Selects the specific filter criteria to apply (e.g., filter by specific beam codes or lengths). Options are populated by the HSB_G-FilterGenBeams catalog. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Add genBeams** | Prompts you to select additional GenBeams from the model to add to the current visualization list. |\n| **Remove genBeams by selection** | Prompts you to select GenBeams currently in the list to remove them from the visualization. |\n| **Remove all genBeams** | Clears the entire list of beams, effectively hiding all visualizations until new beams are added. |\n\n## Settings Files\n- **Dependency**: `HSB_G-FilterGenBeams.mcr`\n- **Location**: TSL Catalog / Script folder\n- **Purpose**: This external script provides the logic and catalog entries for the \"Filter definition for GenBeams\" dropdown. It defines how beams are filtered (e.g., by name, length, or property).\n\n## Tips\n- **Visual Check**: Use the \"Show All GenBeams Selected\" property set to \"Yes\" to verify exactly which beams you initially picked before applying complex filters.\n- **Filtering**: Ensure `HSB_G-FilterGenBeams` is loaded in the drawing; otherwise, the script will report that beams could not be filtered.\n- **Organization**: Place the insertion point near the cluster of beams you are analyzing to make the pointer lines easier to read.\n\n## FAQ\n- **Q: Why do I see the error \"Beams could not be filtered!\"?**\n  **A**: The script `HSB_G-FilterGenBeams` is likely not loaded or found in your TSL search path. Load this dependency script to enable filtering.\n- **Q: The script disappeared immediately after I placed it.**\n  **A**: You likely pressed Enter without selecting any beams during the \"Select genbeams to filter\" step. Run the command again and ensure you select at least one beam.\n- **Q: Can I change the color of the beams after inserting the script?**\n  **A**: Yes. Select the script instance, open the Properties palette (OPM), and change the \"Color\" parameter to update the display instantly."
      },
      "tokens_used": 6207,
      "error": null
    }
  }
}