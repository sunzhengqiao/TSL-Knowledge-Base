{
  "filename": "GE_HDWR_ANCHOR_EMBEDDED.mcr",
  "status": "completed",
  "total_tokens": 33922,
  "processing_time": 374.6846842765808,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "v1.3",
            "date": "15.jun.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "TSL can now be inserted by other hardware systems"
          },
          {
            "version": "v1.2",
            "date": "05.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Avoided printing map to DXX file"
          },
          {
            "version": "v1.1",
            "date": "27.nov.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Version control (several enhancements, coordinated with Manish Patel and Marcelo Quevedo)"
          },
          {
            "version": "*v1.0",
            "date": "14.nov.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release. Created as dummy only, insertion yet to be coded. Will be useful inserted from outside"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5604,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses Body and Display classes to generate 3D geometry (rod, nuts, washers). No sd_ functions, Viewport usage, or 2D drawing generation patterns detected. Logic depends on _Pt0 and coordinate system vectors for construction."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5181,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"reportMessage\",\n        \"promptOriginal\": \"\\n\"+T(\"|Message from|\")+\" GE_HDWR_ANCHOR_EMBEDDED TSL: \"+ T(\"|This TSL has not yet a manual insertion defined. It can be inserted only by other script. Instance will be erased|\")+\"\\n\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Anchor type\",\n      \"defaultValue\": \"1/2 Embedded Anchor\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"1/2 Embedded Anchor\",\n        \"5/8 Embedded Anchor\",\n        \"7/8 Embedded Anchor\"\n      ],\n      \"category\": null,\n      \"description\": null\n    }\n  ],\n  \"contextMenu\": [],\n  \"settingsFiles\": []\n}\n```"
      },
      "tokens_used": 3740,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Generates a 3D model of an embedded threaded rod anchor assembly (including rod, hex nuts, and square washers) for concrete-to-timber connections.\",\n    \"category\": \"Hardware\",\n    \"typicalUseCase\": \"Used as a sub-component (nested TSL) inserted by other scripts (e.g., foundation or wall generation tools) to represent hold-down anchors cast into concrete.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sType\",\n      \"technicalDefault\": \"\\\"1/2 Embedded Anchor\\\"\",\n      \"businessMeaning\": \"Specifies the commercial size and diameter of the threaded rod anchor.\",\n      \"validRange\": \"1/2\\\", 5/8\\\", 7/8\\\"\",\n      \"unit\": \"Inches (Nominal)\",\n      \"affectsOutput\": \"Selects the intended hardware standard. While the provided geometry in the snippet is static, this property is used by the parent script to classify the anchor size.\"\n    },\n    {\n      \"name\": \"bHideWasherAndNuts\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Controls the visibility of the top-side hardware (nut and washer) that is typically exposed outside the concrete.\",\n      \"validRange\": \"0 (Show), 1 (Hide)\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"If set to 1, the script omits drawing the top nut and top square washer, leaving only the rod and embedded components.\"\n    },\n    {\n      \"name\": \"InsertedByDirective\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Flag indicating the anchor was placed by an automated system rather than manual user selection.\",\n      \"validRange\": \"0 (False), 1 (True)\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"When True, locks the 'sType' property to Read-Only mode to prevent user modification of the automated specification.\"\n    },\n    {\n      \"name\": \"vx, vy, vz\",\n      \"technicalDefault\": \"Derived from World Coordinate System (WCS)\",\n      \"businessMeaning\": \"Defines the orientation vectors for the anchor assembly (X, Y, and Z axes of the local context).\",\n      \"validRange\": \"Unit Vector3d\",\n      \"unit\": \"Vector3d\",\n      \"affectsOutput\": \"Rotates the entire rod and hardware geometry to align with the parent element's coordinate system (e.g., vertical, horizontal, or angled).\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"InsertedByDirective = 1 (in"
      },
      "tokens_used": 7224,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization and Variable Declaration",
          "2. [Conditional] Check Insertion Mode (_bOnInsert)",
          "3. [Conditional] Manual Insertion Termination (If _bOnInsert is True)",
          "4. Coordinate System Setup (vx, vy, vz from WCS)",
          "5. Read Configuration from Input Map (Type, Vectors, Flags)",
          "6. [Conditional] Lock Property Read-Only Status",
          "7. [Conditional] Establish Element Dependency",
          "8. Define Hardware Dimensions (Nuts, Washers, Rod)",
          "9. Construct Rod Body Geometry",
          "10. Construct Embedded Hardware Geometry (Bottom Nut, Washer, Intermediate Nut)",
          "11. [Conditional] Construct Top Hardware Geometry (Nut, Washer)",
          "12. Render 3D Geometry (Draw Bodies)"
        ],
        "conditionalBranches": [
          {
            "condition": "Manual Insertion Attempt (_bOnInsert == true)",
            "path1": {
              "name": "Manual Insertion Block",
              "steps": [
                "Display error message: 'This TSL has not yet a manual insertion defined. It can be inserted only by other script.'",
                "Execute eraseInstance()",
                "Terminate script"
              ]
            },
            "path2": {
              "name": "Scripted Insertion / Recalculation",
              "steps": [
                "Initialize vectors based on World Coordinate System",
                "Continue to Map reading phase"
              ]
            }
          },
          {
            "condition": "Map Input Availability (_Map has data)",
            "path1": {
              "name": "Map Data Present",
              "steps": [
                "Overwrite sType with ANCHORTYPE from Map",
                "Overwrite vx, vy, vz vectors from Map",
                "Retrieve HideWasherAndNuts flag from Map"
              ]
            },
            "path2": {
              "name": "Map Data Missing",
              "steps": [
                "Use default or previously set Property values",
                "Use WCS-derived vectors"
              ]
            }
          },
          {
            "condition": "Insertion Source (InsertedByDirective flag)",
            "path1": {
              "name": "System Inserted (Flag == 1)",
              "steps": [
                "Set sType property to Read-Only mode"
              ]
            },
            "path2": {
              "name": "User/Manual Config (Flag == 0)",
              "steps": [
                "Keep sType property editable"
              ]
            }
          },
          {
            "condition": "Visibility of Top Hardware (!bHideWasherAndNuts)",
            "path1": {
              "name": "Show Hardware (Flag == 0)",
              "steps": [
                "Append Top Nut coordinates to drawing array",
                "Append Top Square Washer coordinates to drawing array"
              ]
            },
            "path2": {
              "name": "Hide Hardware (Flag == 1)",
              "steps": [
                "Skip appending top hardware coordinates",
                "Proceed to draw only rod and embedded parts"
              ]
            }
          },
          {
            "condition": "Element Linking (_Element.length() == 1)",
            "path1": {
              "name": "Linked to Element",
              "steps": [
                "Set dependency on specific element",
                "Monitor for deletion event"
              ]
            },
            "path2": {
              "name": "Not Linked",
              "steps": [
                "Skip dependency logic"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Manual Insertion Attempt",
            "errorMessage": "This TSL has not yet a manual insertion defined. It can be inserted only by other script. Instance will be erased",
            "recovery": "Do not run manually; ensure this TSL is called programmatically by a parent script/manager."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Anchor Type",
            "how": "OPM (Object Properties Manager)",
            "effect": "Updates the sType property value. If 'InsertedByDirective' was true, this action is disabled (Read-Only)."
          },
          {
            "action": "Visual Update on Recalc",
            "how": "Script Recalculation (Automatic or Manual)",
            "effect": "Rebuilds the rod, nuts, and washers based on current Property values and Map data."
          }
        ]
      },
      "tokens_used": 6637,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_ANCHOR_EMBEDDED.mcr\n\n## Overview\nThis script generates a 3D model of an embedded threaded rod anchor assembly, including the rod, hex nuts, and square washers. It is designed primarily as a sub-component to be inserted automatically by other scripts (such as foundation or wall generation tools) rather than being manually inserted by the user.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Generates 3D geometry for hardware representation. |\n| Paper Space | No | Not designed for 2D layout or detailing. |\n| Shop Drawing | No | Does not generate shop drawing views. |\n\n## Prerequisites\n- **Required Entities**: None (geometry is generated internally based on coordinates).\n- **Minimum Beam Count**: 0.\n- **Required Settings**: None.\n- **Note**: This script is intended to be called programmatically by a parent script or hardware manager.\n\n## Usage Steps\n\n### Step 1: Script Execution\n**Command:** Run via parent script or attempt `TSLINSERT`\n- **Action:** The script is typically launched automatically by a master script (e.g., a foundation tool) when an anchor point is calculated.\n- **Result:** If executed correctly with proper input data (coordinates and type), the anchor geometry is drawn.\n\n### Step 2: Manual Insertion Attempt (Blocked)\nIf you attempt to run this script manually:\n- **Command Line:** `TSLINSERT` -> Select `GE_HDWR_ANCHOR_EMBEDDED.mcr`\n- **Command Line Message:** \"This TSL has not yet a manual insertion defined. It can be inserted only by other script. Instance will be erased\"\n- **Action:** The script detects it was not called by a parent system and deletes the instance immediately. You must use a parent script to insert this component.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Anchor type** | Dropdown | 1/2 Embedded Anchor | Selects the commercial size of the threaded rod anchor. Options include 1/2\", 5/8\", and 7/8\" diameters. |\n\n*Note: Depending on how the script was inserted, the \"Anchor type\" property may be Read-Only.*\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | No custom context menu items are defined for this script. |\n\n## Settings Files\n- **Filename**: None.\n- **Location**: N/A.\n- **Purpose**: All configuration is handled via script properties or input maps from parent scripts.\n\n## Tips\n- **Automated Use**: Do not try to insert this script manually. Ensure your main generation tool (e.g., a floor or wall plugin) is configured to call this TSL.\n- **Modifying Size**: To change the anchor size after insertion, select the object in the model and change the \"Anchor type\" dropdown in the Properties palette (AutoCAD Object Properties Manager).\n- **Read-Only Status**: If the \"Anchor type\" dropdown is grayed out, it means the anchor was inserted by a directive system (`InsertedByDirective` flag). You must adjust the settings in the parent script or manager to change the size.\n- **Visibility**: Some instances may hide the top nut and washer (controlled by internal flags) depending on the specific construction requirements defined by the calling script.\n\n## FAQ\n- **Q: Why does the script disappear immediately after I try to insert it?**\n  - A: This script does not support manual insertion. It requires coordinate data and configuration passed from a parent script. The erase functionality is intentional to prevent \"dumb\" placement.\n\n- **Q: Can I change the anchor size manually?**\n  - A: Yes, provided the property is not locked. Select the anchor object and look for the \"Anchor type\" property in the Properties palette. If it is locked (Read-Only), the size is controlled by the macro that inserted it.\n\n- **Q: What happens if I delete the timber element this anchor is attached to?**\n  - A: The script establishes an element dependency if an element is provided during insertion. If the linked element is deleted, the anchor instance will also be removed."
      },
      "tokens_used": 5536,
      "error": null
    }
  }
}