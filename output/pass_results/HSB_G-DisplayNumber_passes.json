{
  "filename": "HSB_G-DisplayNumber.mcr",
  "status": "completed",
  "total_tokens": 30505,
  "processing_time": 388.06969022750854,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 1,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl displays the number of the element.",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "02.05.2017",
            "author": "YB",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "02.05.2017",
            "author": "YB",
            "changes": "Attached the TSL to the element."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4742,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses _kModelSpace explicitly in dbCreate. Operates on Element entities to determine dimensions via plEnvelope(). No sd_ prefixes, no _Viewport usage, and does not use '#Type E' shop drawing constructs. Geometry is calculated in 3D using Vector3d and PlaneProfile."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 2198,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && ( _kExecuteKey == \"\" || catalogNames.find(_kExecuteKey) == -1 )",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Property Dialog",
            "trigger": "On Insert (if no catalog key provided)",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "displayColor",
            "type": "PropInt",
            "displayName": "|Display color|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Display|",
            "description": null
          },
          {
            "index": 1,
            "variable": "displayHeight",
            "type": "PropInt",
            "displayName": "|Text height|",
            "defaultValue": "U(10)",
            "inputType": "number",
            "options": [],
            "category": "|Display|",
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimension style|",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [],
            "category": "|Display|",
            "description": null
          },
          {
            "index": 0,
            "variable": "displayLocation",
            "type": "PropString",
            "displayName": "|Display positioning|",
            "defaultValue": "|No display|",
            "inputType": "dropdown",
            "options": [
              "|No display|",
              "|Bottom left|",
              "|Bottom center|",
              "|Bottom right|",
              "|Center left|",
              "|Center|",
              "|Center right|",
              "|Top left|",
              "|Top center|",
              "|Top right|"
            ],
            "category": "|Positioning|",
            "description": null
          },
          {
            "index": 0,
            "variable": "horizontalOffset",
            "type": "PropDouble",
            "displayName": "|Horizontal offset|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Positioning|",
            "description": null
          },
          {
            "index": 1,
            "variable": "verticalOffset",
            "type": "PropDouble",
            "displayName": "|Vertical offset|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Positioning|",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5633,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically labels elements in the 3D model with their unique Element Number for identification and verification.",
          "category": "Annotation/Labeling",
          "typicalUseCase": "Used during the design or assembly phase to visually identify specific wall or floor panels directly in the model space without needing to check properties or 2D drawings."
        },
        "parameters": [
          {
            "name": "displayColor",
            "technicalDefault": "U(0)",
            "businessMeaning": "Sets the color of the element number text to ensure visibility or contrast against the 3D model background or timber material.",
            "validRange": "0-255 (AutoCAD Color Index), where 0 is ByBlock",
            "unit": "Color Index",
            "affectsOutput": "Changes the visual color of the text entity in the CAD view."
          },
          {
            "name": "displayHeight",
            "technicalDefault": "U(10)",
            "businessMeaning": "Defines the physical size (height) of the text characters in the model to ensure legibility at typical zoom levels.",
            "validRange": "5 mm to 100 mm (typically 10-20 mm for model visibility)",
            "unit": "mm",
            "affectsOutput": "Scales the text geometry size up or down."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Selects a specific dimension/text style (defined in the CAD or hsbCAD standards) to control font type, line weight, and specific text formatting.",
            "validRange": "Any existing Dimension Style name in the project",
            "unit": "String",
            "affectsOutput": "Alters the font face and line styling of the text."
          },
          {
            "name": "displayLocation",
            "technicalDefault": "|No display|",
            "businessMeaning": "Determines the anchor point of the text relative to the element's bounding box (e.g., Center, Top-Right, Bottom-Left).",
            "validRange": "Selection list: No display, Bottom/Center/Top + Left/Center/Right combinations",
            "unit": "Enumeration",
            "affectsOutput": "Calculates the specific X/Y coordinate insertion point for the text on the element envelope."
          },
          {
            "name": "horizontalOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "Shifts the text position along the element's length (X-axis) from the origin, useful for moving text away from edges or specific machining.",
            "validRange": "-1000 mm to 1000 mm",
            "unit": "mm",
            "affectsOutput": "Translates the text insertion point along the element's local X-axis."
          },
          {
            "name": "verticalOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "Shifts the text position across the element's width (Y-axis) from the origin.",
            "validRange": "-1000 mm to 1000 mm",
            "unit": "mm",
            "affectsOutput": "Translates the text insertion point along the element's local Y-axis."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Modification of horizontalOffset or verticalOffset",
            "effect": "These offsets are applied to the element origin (_Pt0) *before* the Display Location alignment logic is calculated.",
            "cascade": [
              "displayLocation"
            ]
          },
          {
            "trigger": "Setting displayLocation to '|No display|'",
            "effect": "Suppresses all geometry generation; displayColor, displayHeight, and offset values are ignored visually.",
            "cascade": [
              "displayColor",
              "displayHeight",
              "horizontalOffset",
              "verticalOffset"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text/Annotation",
            "description": "A text object displaying the Element Number, drawn on the element's local plane.",
            "appliedTo": "The selected Element (_Element[0])"
          }
        ]
      },
      "tokens_used": 5785,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script invocation (User starts command or inserts from catalog)",
          "2. [Conditional] Check insertCycleCount; if > 1, erase instance and exit (Recursive protection)",
          "3. [Conditional] Check for valid _kExecuteKey; if valid, load properties from catalog",
          "4. [Conditional] If no catalog key, show Properties Dialog for user configuration",
          "5. Save current properties to '_LastInserted' catalog entry",
          "6. Prompt user to select Elements (PrEntity selection set)",
          "7. Iterate through selected elements and generate a new TSL instance for each using dbCreate",
          "8. Erase the original 'master' instance used for the command",
          "9. For each generated instance: Validate that exactly one Element is attached",
          "10. [Conditional] If manually inserted, load properties from '_LastInserted' catalog",
          "11. Retrieve Element geometry (Origin, VecX, VecY, Envelope)",
          "12. Calculate initial insertion point applying Horizontal and Vertical Offsets",
          "13. Calculate Element Width and Height from envelope grips",
          "14. [Conditional] Check 'Display positioning' property; if 'No display', stop execution",
          "15. Calculate final insertion point based on 9-point grid alignment logic",
          "16. Configure Display object (Color, DimStyle, Text Height)",
          "17. Draw Element Number text at calculated point"
        ],
        "conditionalBranches": [
          {
            "condition": "Display Location (displayIndex) == 0 ('|No display|')",
            "path1": {
              "name": "Invisible Mode",
              "steps": [
                "Script execution halts",
                "No geometry is drawn",
                "Instance remains attached but dormant"
              ]
            },
            "path2": {
              "name": "Visible Mode",
              "steps": [
                "Calculate grid coordinates (Center/Top/Bottom, Left/Right/Center)",
                "Apply grid offsets to origin",
                "Draw text"
              ]
            }
          },
          {
            "condition": "Insertion Cycle Count (insertCycleCount())",
            "path1": {
              "name": "Recursive Call (> 1)",
              "steps": [
                "Erase current instance immediately",
                "Return to prevent infinite loops"
              ]
            },
            "path2": {
              "name": "First Call (== 1)",
              "steps": [
                "Proceed to Dialog/Selection phase",
                "Spawn new instances on elements"
              ]
            }
          },
          {
            "condition": "Catalog Key Availability (_kExecuteKey)",
            "path1": {
              "name": "Catalog Execution",
              "steps": [
                "Load properties directly from catalog entry",
                "Skip interactive Dialog"
              ]
            },
            "path2": {
              "name": "Manual Execution",
              "steps": [
                "Show Properties Dialog (showDialog)",
                "Wait for user input"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "_Element array length",
            "errorMessage": "TN(\"|No element selected!\")",
            "recovery": "The script erases itself. User must attach the script to a valid Element entity."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Positioning or Appearance",
            "how": "Object Properties Palette (OPM)",
            "effect": "Script recalculates text position/size immediately. Changing 'Display positioning' moves the text to the new anchor point (e.g., from Center to Top-Right)."
          },
          {
            "action": "Modify Element Geometry",
            "how": "Grip edit or Element properties",
            "effect": "The script detects the new envelope size/shape and adjusts the text position relative to the new bounding box dimensions."
          },
          {
            "action": "Change Element Number",
            "how": "Element numbering command or manual override",
            "effect": "The displayed text content updates to reflect the new el.number()."
          }
        ]
      },
      "tokens_used": 6600,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-DisplayNumber.mcr\n\n## Overview\nThis script labels selected elements in the 3D model with their unique Element Number. It allows for customizable text positioning and styling to clearly identify walls, floors, or roof panels directly in Model Space.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates in 3D to place labels on elements. |\n| Paper Space | No | Not designed for 2D layout sheets. |\n| Shop Drawing | No | Does not generate shop drawing views. |\n\n## Prerequisites\n- **Required Entities**: Element (Wall, Floor, or Roof).\n- **Minimum Beam Count**: 0 (Attaches to the Element entity, not individual beams).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\n- Browse and select `HSB_G-DisplayNumber.mcr`.\n\n### Step 2: Configure Properties\n- A properties dialog appears automatically upon insertion.\n- Set the **Display positioning** (e.g., \"Center\", \"Top left\").\n- Adjust **Text height** and **Display color** as needed.\n- Click **OK** to confirm.\n\n### Step 3: Select Elements\n```\nCommand Line: Select elements\nAction:\n1. Click on the desired Wall, Floor, or Roof elements in the 3D model.\n2. Press Enter to finalize the selection.\n```\nThe script will attach to each selected element and display the number.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| |Display positioning| |dropdown| |No display| |Select the anchor point for the text on the element (e.g., Bottom left, Center, Top right). |\n| |Display color| |number| |0| |Sets the color index of the text (0 = ByBlock). |\n| |Text height| |number| |U(10)| |Defines the height of the text characters in model units (typically mm). |\n| |Dimension style| |dropdown| |_DimStyles| |Selects the text style/ font to be used from the project standards. |\n| |Horizontal offset| |number| |0| |Shifts the text position along the element's length (X-axis). |\n| |Vertical offset| |number| |0| |Shifts the text position across the element's width (Y-axis). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are defined for this script. Use the Properties palette to modify settings. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Visibility**: The default setting is \"No display\". If you insert the script and see no change, open the Element properties and change \"Display positioning\" to a location like \"Center\".\n- **Updates**: If you renumber your elements using a numbering command, the labels on the elements will automatically update to the new numbers.\n- **Adjustment**: You can select the element, open the Properties palette (Ctrl+1), and tweak the Horizontal/Vertical offsets to fine-tune the label position without re-running the script.\n\n## FAQ\n- **Q: Why didn't text appear when I inserted the script?**\n  **A:** The default setting for \"Display positioning\" is \"No display\". Select the element, open Properties, and change the positioning option (e.g., to \"Center\").\n- **Q: How do I change the font size?**\n  **A:** Select the element, open the Properties palette, and modify the \"Text height\" parameter.\n- **Q: Can I use this on individual beams?**\n  **A:** No, this script is designed to attach to Element entities (Walls/Floors). For beams, use a beam-specific label script."
      },
      "tokens_used": 5547,
      "error": null
    }
  }
}