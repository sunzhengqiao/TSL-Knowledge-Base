{
  "filename": "GE_WALL_SECTION_BLOCKING.mcr",
  "status": "completed",
  "total_tokens": 56725,
  "processing_time": 998.0021889209747,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9523,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getElement() to select an ElementWall and generates 3D GenBeam entities using bm.dbCreate(). It handles _bOnElementListModified and _bOnElementDeleted which are lifecycle events for Model Space elements. No ShopDrawing prefixes (sd_), Viewport handling, or #Type E directives found."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "ModelSpace",
          "requiredSettings": [
            "hsbFramingDefaults.Inventory.dll",
            "GE_WALL_SECTION_BLOCKING_CUSTOM_PROPS (XML)"
          ]
        }
      },
      "tokens_used": 7622,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getElement",
              "promptOriginal": "Select Wall",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "\nSelect a start Point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "\nSelect the end Point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 4,
              "function": "getPoint",
              "promptOriginal": "Select Side of Wall",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strEmpty0",
            "type": "PropString",
            "displayName": "- - - - - - - - - - - - - - - -",
            "defaultValue": "BLOCK PROPERTIES",
            "inputType": "readonly",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "strType1",
            "type": "PropString",
            "displayName": "  Blocking 1",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strType2",
            "type": "PropString",
            "displayName": "  Blocking 2",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "strType3",
            "type": "PropString",
            "displayName": "  Blocking 3",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "strType4",
            "type": "PropString",
            "displayName": "  Blocking 4",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "dMinLgt",
            "type": "PropDouble",
            "displayName": "  Minimum block length",
            "defaultValue": "3 inches",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "strEmpty1",
            "type": "PropString",
            "displayName": "- - - - - - - - - - - - - - - -",
            "defaultValue": "BLOCK ELEVATION (0 will not place block)",
            "inputType": "readonly",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "dElev1",
            "type": "PropDouble",
            "displayName": "  Elevation of block 1",
            "defaultValue": "36 inches",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "strOrient1",
            "type": "PropString",
            "displayName": "  Orientation 1",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Edge",
              "Flat"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "dElev2",
            "type": "PropDouble",
            "displayName": "  Elevation of block 2",
            "defaultValue": "84 inches",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 10,
            "variable": "strOrient2",
            "type": "PropString",
            "displayName": "  Orientation 2",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Edge",
              "Flat"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 11,
            "variable": "dElev3",
            "type": "PropDouble",
            "displayName": "  Elevation of block 3",
            "defaultValue": "0 inches",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 12,
            "variable": "strOrient3",
            "type": "PropString",
            "displayName": "  Orientation 3",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Edge",
              "Flat"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 13,
            "variable": "dElev4",
            "type": "PropDouble",
            "displayName": "  Elevation of block 4",
            "defaultValue": "0 inches",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 14,
            "variable": "strOrient4",
            "type": "PropString",
            "displayName": "  Orientation 4",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Edge",
              "Flat"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 15,
            "variable": "strEmpty2",
            "type": "PropString",
            "displayName": "- - - - - - - - - - - - - - - -",
            "defaultValue": "DISPLAY",
            "inputType": "readonly",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 16,
            "variable": "strDim",
            "type": "PropString",
            "displayName": "  DimStyle",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "GE_WALL_SECTION_BLOCKING_CUSTOM_PROPS",
            "searchPaths": [
              "_kPathHsbCompany\\Tsl\\Catalog\\"
            ],
            "purpose": "Stores and retrieves custom property settings for Blocking types (strType1-4) to maintain state across insertions/cloning.",
            "required": false
          }
        ]
      },
      "tokens_used": 10187,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates blocking (fire stops/bridging) between wall studs at user-defined elevations within a specific wall section.",
          "category": "Framing",
          "typicalUseCase": "Adding structural blocking for handrails, cabinets, or fire regulations within a framed wall cavity."
        },
        "parameters": [
          {
            "name": "strType1",
            "technicalDefault": "null",
            "businessMeaning": "Lumber material/size specification for the first row of blocking.",
            "validRange": "Inventory items (e.g., 2x4 S-P-F)",
            "unit": "Catalog Item",
            "affectsOutput": "Defines cross-section and material for blocks at Elevation 1."
          },
          {
            "name": "strType2",
            "technicalDefault": "null",
            "businessMeaning": "Lumber material/size specification for the second row of blocking.",
            "validRange": "Inventory items",
            "unit": "Catalog Item",
            "affectsOutput": "Defines cross-section and material for blocks at Elevation 2."
          },
          {
            "name": "strType3",
            "technicalDefault": "null",
            "businessMeaning": "Lumber material/size specification for the third row of blocking.",
            "validRange": "Inventory items",
            "unit": "Catalog Item",
            "affectsOutput": "Defines cross-section and material for blocks at Elevation 3."
          },
          {
            "name": "strType4",
            "technicalDefault": "null",
            "businessMeaning": "Lumber material/size specification for the fourth row of blocking.",
            "validRange": "Inventory items",
            "unit": "Catalog Item",
            "affectsOutput": "Defines cross-section and material for blocks at Elevation 4."
          },
          {
            "name": "dMinLgt",
            "technicalDefault": "3 inches",
            "businessMeaning": "Shortest allowable length for a blocking piece.",
            "validRange": "3 inches to 24 inches",
            "unit": "Inches",
            "affectsOutput": "Suppresses generation of blocks in stud bays smaller than this value."
          },
          {
            "name": "dElev1",
            "technicalDefault": "36 inches",
            "businessMeaning": "Height from the bottom plate for the first row of blocking.",
            "validRange": "> 0 (0 disables)",
            "unit": "Inches",
            "affectsOutput": "Vertical position of Blocking 1."
          },
          {
            "name": "strOrient1",
            "technicalDefault": "null",
            "businessMeaning": "Rotation of the timber cross-section for the first row.",
            "validRange": "Edge, Flat",
            "unit": "Enum",
            "affectsOutput": "Determines if the block is installed vertical (Edge) or horizontal (Flat) relative to the wall face."
          },
          {
            "name": "dElev2",
            "technicalDefault": "84 inches",
            "businessMeaning": "Height from the bottom plate for the second row of blocking.",
            "validRange": "> 0",
            "unit": "Inches",
            "affectsOutput": "Vertical position of Blocking 2."
          },
          {
            "name": "strOrient2",
            "technicalDefault": "null",
            "businessMeaning": "Rotation of the timber cross-section for the second row.",
            "validRange": "Edge, Flat",
            "unit": "Enum",
            "affectsOutput": "Determines if the block is installed vertical (Edge) or horizontal (Flat)."
          },
          {
            "name": "dElev3",
            "technicalDefault": "0 inches",
            "businessMeaning": "Height from the bottom plate for the third row of blocking.",
            "validRange": "> 0",
            "unit": "Inches",
            "affectsOutput": "Vertical position of Blocking 3."
          },
          {
            "name": "strOrient3",
            "technicalDefault": "null",
            "businessMeaning": "Rotation of the timber cross-section for the third row.",
            "validRange": "Edge, Flat",
            "unit": "Enum",
            "affectsOutput": "Determines if the block is installed vertical (Edge) or horizontal (Flat)."
          },
          {
            "name": "dElev4",
            "technicalDefault": "0 inches",
            "businessMeaning": "Height from the bottom plate for the fourth row of blocking.",
            "validRange": "> 0",
            "unit": "Inches",
            "affectsOutput": "Vertical position of Blocking 4."
          },
          {
            "name": "strOrient4",
            "technicalDefault": "null",
            "businessMeaning": "Rotation of the timber cross-section for the fourth row.",
            "validRange": "Edge, Flat",
            "unit": "Enum",
            "affectsOutput": "Determines if the block is installed vertical (Edge) or horizontal (Flat)."
          },
          {
            "name": "strDim",
            "technicalDefault": "null",
            "businessMeaning": "Dimension style for visual representation (if applicable).",
            "validRange": "System DimStyles",
            "unit": "Style",
            "affectsOutput": "Controls the look of dimensions/text associated with the script display."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dElev1-4 set to 0",
            "effect": "Disables creation of that specific blocking row.",
            "cascade": [
              "strType1",
              "strOrient1"
            ]
          },
          {
            "trigger": "strType selection",
            "effect": "Provides the raw dimensions (Width/Height) that Orientation manipulates.",
            "cascade": [
              "strOrient1"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam",
            "description": "Timber blocking pieces cut to fit between studs.",
            "appliedTo": "Selected Wall Element"
          }
        ]
      },
      "tokens_used": 10175,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Initialization: Load inventory items via .NET DLL",
          "Insertion Sequence Start (_bOnInsert)",
          "Check insertion cycle count (prevent multiple instances)",
          "Prompt: Select Wall (getElement)",
          "Prompt: Select Start Point (getPoint)",
          "Prompt: Select End Point (PrPoint with rubber-banding)",
          "Prompt: Select Side of Wall (getPoint) - Sets coordinate origin",
          "Show Properties Dialog",
          "Script Execution (Recalculation)",
          "Property Change Detection: Update internal Map if props changed",
          "Catalog Check: Load props from XML if 'SET_PROPS_FROM_CATALOG' flag is set",
          "Event Check: _bOnElementDeleted (Draw 'B' icon and exit)",
          "Event Check: _bOnElementListModified (Wall Split)",
          "  - Clone script instance",
          "  - Copy properties and geometry points",
          "  - Attach to new wall elements",
          "  - Erase original instance",
          "Security Validation: Check Entity count == 1 and Point count == 2",
          "Geometry Processing: Extract wall coordinate system and collect Studs/Horizontals",
          "Blocking Loop (Iterate 1 to 4):",
          "  - Check Elevation > 0",
          "  - Determine Dimensions based on Type and Orientation",
          "Generation Trigger (_bOnElementConstructed, ExecuteKeys, _bOnInsert, etc.):",
          "  - Delete existing blocks if triggered by command",
          "  - Define blocking area line",
          "  - Find stud intersection points",
          "  - Iterate stud bays",
          "  - Validate: Minimum length, Interference (horizontals/holes), Bounds (user selection)",
          "  - Create GenBeam and Stretch to adjacent studs",
          "  - Store in internal Map"
        ],
        "conditionalBranches": [
          {
            "condition": "Wall Modification Event",
            "path1": {
              "name": "Standard Update",
              "steps": [
                "Validate inputs",
                "Recalculate blocking geometry based on current wall state"
              ]
            },
            "path2": {
              "name": "Wall Split Handling",
              "steps": [
                "Intercept split event",
                "Replicate TSL instance to resulting wall segments",
                "Preserve original properties",
                "Remove original instance"
              ]
            }
          },
          {
            "condition": "Blocking Elevation (dElev1-4)",
            "path1": {
              "name": "Active Row",
              "steps": [
                "Elevation > 0",
                "Generate blocking at specified height"
              ]
            },
            "path2": {
              "name": "Disabled Row",
              "steps": [
                "Elevation == 0",
                "Skip generation for this row"
              ]
            }
          },
          {
            "condition": "Block Orientation (strOrient)",
            "path1": {
              "name": "Edge",
              "steps": [
                "Use inventory Height as Y-depth, Width as Z-height",
                "Apply legacy hsbId '12'"
              ]
            },
            "path2": {
              "name": "Flat",
              "steps": [
                "Use inventory Width as Y-depth, Height as Z-height",
                "Apply dynamic hsbId from Type"
              ]
            }
          },
          {
            "condition": "Execute Key (Context Menu)",
            "path1": {
              "name": "Create Blocks",
              "steps": [
                "Clear old blocks",
                "Run full generation routine"
              ]
            },
            "path2": {
              "name": "Delete Blocks",
              "steps": [
                "Erase blocks from Map",
                "Clear Map storage",
                "Keep script instance"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Count",
            "errorMessage": "Must have 1 entity selected",
            "recovery": "Script self-destructs; user must re-select correct wall."
          },
          {
            "check": "Grip Point Count",
            "errorMessage": "Must have 2 grip points",
            "recovery": "Script self-destructs; user must re-insert and define points correctly."
          },
          {
            "check": "Minimum Block Length (dMinLgt)",
            "errorMessage": "None (Silent skip)",
            "recovery": "User reduces Minimum Block Length property or accepts the gap."
          },
          {
            "check": "Cavity Bounds",
            "errorMessage": "None (Silent skip)",
            "recovery": "User adjusts Start/End points to cover desired area."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties",
            "how": "OPM (Properties Palette)",
            "effect": "Changing Type, Elevation, or Orientation triggers immediate recalculation and geometry regeneration."
          },
          {
            "action": "Move Selection Region",
            "how": "Grip Edit (Dragging Start/End points)",
            "effect": "Updates the projection area used to determine which stud bays receive blocking."
          },
          {
            "action": "Move Wall Side Origin",
            "how": "Grip Edit (Origin point)",
            "effect": "Shifts the reference point used to calculate block positions relative to wall geometry."
          },
          {
            "action": "Split Wall",
            "how": "CAD Split Command",
            "effect": "Script automatically propagates to new wall segments, maintaining settings relative to new wall origins."
          },
          {
            "action": "Refresh Blocks",
            "how": "Context Menu (Create Blocks)",
            "effect": "Forces regeneration of blocking beams (useful if studs were manually modified)."
          }
        ]
      },
      "tokens_used": 11479,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_WALL_SECTION_BLOCKING.mcr\n\n## Overview\nGenerates timber blocking (fire stops or bridging) between wall studs at specific elevations. This script allows you to define a section of a wall and insert up to four rows of blocking with configurable material sizes and orientations.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script works exclusively in the 3D model. |\n| Paper Space | No | Not applicable for drawings/layouts. |\n| Shop Drawing | No | This is a model generation script. |\n\n## Prerequisites\n- **Required Entities**: One existing `ElementWall` (Wall).\n- **Minimum Beam Count**: 0 (Script generates new beams, does not require existing ones).\n- **Required Settings**:\n  - `hsbFramingDefaults.Inventory.dll` (Standard hsbCAD inventory).\n  - `GE_WALL_SECTION_BLOCKING_CUSTOM_PROPS.xml` (Optional, for saving preset configurations).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT`\n**Action**: Browse and select `GE_WALL_SECTION_BLOCKING.mcr`.\n\n### Step 2: Select Wall\n```\nCommand Line: Select Wall\nAction: Click on the Wall element in the model where you want to add blocking.\n```\n\n### Step 3: Define Section Start\n```\nCommand Line: Select a start Point\nAction: Click a point in the model to define the start of the blocking area (usually along the bottom plate).\n```\n\n### Step 4: Define Section End\n```\nCommand Line: Select the end Point\nAction: Click a point to define the end of the blocking area. A rubber-band line will appear from the start point.\n```\n\n### Step 5: Define Wall Side\n```\nCommand Line: Select Side of Wall\nAction: Click on the desired face of the wall (Left/Right or Interior/Exterior) to set the coordinate origin.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Blocking 1** | Dropdown | *Empty* | Select the lumber material/size (e.g., 2x4) for the first row of blocking. |\n| **Blocking 2** | Dropdown | *Empty* | Select the lumber material/size for the second row. |\n| **Blocking 3** | Dropdown | *Empty* | Select the lumber material/size for the third row. |\n| **Blocking 4** | Dropdown | *Empty* | Select the lumber material/size for the fourth row. |\n| **Minimum block length** | Number | 3 inches | Blocking smaller than this length will not be generated (avoids tiny scraps). |\n| **Elevation of block 1** | Number | 36 inches | Height from the bottom plate to place Blocking 1. Set to `0` to disable this row. |\n| **Orientation 1** | Dropdown | *Edge* | Rotation of the timber: `Edge` (vertical) or `Flat` (horizontal) relative to the wall face. |\n| **Elevation of block 2** | Number | 84 inches | Height from the bottom plate to place Blocking 2. Set to `0` to disable this row. |\n| **Orientation 2** | Dropdown | *Edge* | Rotation of the timber: `Edge` (vertical) or `Flat` (horizontal). |\n| **Elevation of block 3** | Number | 0 inches | Height from the bottom plate to place Blocking 3. Set to `0` to disable this row. |\n| **Orientation 3** | Dropdown | *Edge* | Rotation of the timber: `Edge` (vertical) or `Flat` (horizontal). |\n| **Elevation of block 4** | Number | 0 inches | Height from the bottom plate to place Blocking 4. Set to `0` to disable this row. |\n| **Orientation 4** | Dropdown | *Edge* | Rotation of the timber: `Edge` (vertical) or `Flat` (horizontal). |\n| **DimStyle** | Dropdown | *Current* | Select the dimension style for visual markers (if used by your setup). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Create Blocks** | Forces the script to regenerate the blocking beams based on current properties and wall geometry. |\n| **Delete Blocks** | Removes the generated blocking beams but keeps the script instance active on the wall. |\n\n## Settings Files\n- **Filename**: `GE_WALL_SECTION_BLOCKING_CUSTOM_PROPS.xml`\n- **Location**: `...\\Company\\Tsl\\Catalog\\`\n- **Purpose**: Stores the last used material types and settings. When enabled, it allows you to load standard configurations automatically without re-selecting materials every time.\n\n## Tips\n- **Disabling Rows**: To temporarily turn off a specific row of blocking without losing the settings, set its **Elevation** to `0`.\n- **Grip Editing**: After insertion, you can drag the **Start** and **End** grip points to resize the area where blocking is applied. Drag the **Origin** grip to shift the reference side.\n- **Wall Splits**: If you split the wall using the CAD Split command, the script will automatically copy itself to the new wall segments, preserving the blocking configuration.\n- **Orientation**: Use **Flat** orientation if you need the block to lie flat against the studs (e.g., for nailing wide siding), or **Edge** for standard fire-stopping.\n\n## FAQ\n- **Q: Why didn't any blocks generate?**\n- **A:** Check the following: Is the **Elevation** set to greater than 0? Is the **Blocking Type** selected? Is the distance between studs larger than the **Minimum block length**?\n- **Q: What is the difference between Edge and Flat orientation?**\n- **A:** **Edge** stands the timber up (e.g., a 2x4 is 3.5\" wide and 1.5\" thick on face). **Flat** lays it down (e.g., a 2x4 is 1.5\" wide and 3.5\" thick on face).\n- **Q: Can I use this for curved walls?**\n- **A:** This script is designed for linear wall sections. It calculates straight blocking distances between studs."
      },
      "tokens_used": 7739,
      "error": null
    }
  }
}