{
  "filename": "I-joist Hanger Display.mcr",
  "status": "completed",
  "total_tokens": 41224,
  "processing_time": 406.9919729232788,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7319,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getBeam() to select beams and constructs 3D Body objects for display using Display(154). No Shop Drawing (sd_*), Viewport, or Element specific commands found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 5062,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialogOnce\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getBeam\",\n        \"promptOriginal\": \"Select beam\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"getBeam\",\n        \"promptOriginal\": \"Select beam\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"stType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Hanger Type\",\n      \"defaultValue\": \"Face Hanger\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Heavy Universal\",\n        \"Mini Hanger\",\n        \"Face Hanger\",\n        \"Top Fix\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"stCode\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Hanger Code\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"stModel\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Hanger Model\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"iPosNum\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"PosNum\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"strDisplay\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Display Model\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \""
      },
      "tokens_used": 8254,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 3D symbolic representation of various I-joist hanger types attached to supporting and carried beams, with optional text labeling for identification in drawings.",
          "category": "Hardware",
          "typicalUseCase": "Used during the design or detailing phase to visually indicate the presence and type of joist hangers at beam intersections, ensuring the correct hardware is specified for manufacturing or ordering."
        },
        "parameters": [
          {
            "name": "stType",
            "technicalDefault": "Face Hanger",
            "businessMeaning": "Selects the specific geometry configuration of the metal hanger (e.g., standard face mount, top flange, mini, or heavy-duty) to match the structural connection requirements.",
            "validRange": "Heavy Universal, Mini Hanger, Face Hanger, Top Fix",
            "unit": "Enumeration",
            "affectsOutput": "Determines the 3D shape drawn via the Display(154) command. It controls the lengths, widths, and presence of side flanges, face plates, and top connection flanges."
          },
          {
            "name": "stCode",
            "technicalDefault": "",
            "businessMeaning": "The specific manufacturer part number or catalog code for the hanger (e.g., 'MHU12'). Used for BOM generation and purchasing.",
            "validRange": "Alphanumeric string (e.g., 'LUS26', 'HU50')",
            "unit": "String",
            "affectsOutput": "Does not affect geometry. Populates the 'Name' field in the internal TSLBOM Map and is exported to DXI for reports."
          },
          {
            "name": "stModel",
            "technicalDefault": "",
            "businessMeaning": "The manufacturer name or product series name (e.g., 'Simpson Strong-Tie', 'MiTek'). Used for labeling in the 3D model if display is enabled.",
            "validRange": "Alphanumeric string",
            "unit": "String",
            "affectsOutput": "If 'Display Model' is Yes, this text is drawn in 3D space near the hanger. Also populates the 'Type' field in the TSLBOM Map."
          },
          {
            "name": "iPosNum",
            "technicalDefault": "0 (linked to _ThisInst.posnum())",
            "businessMeaning": "The position number of the script instance, automatically inherited from the hsbCAD entity properties to maintain assembly organization.",
            "validRange": "Integer (>0)",
            "unit": "Count",
            "affectsOutput": "Read-only property used for data organization. Does not change geometry."
          },
          {
            "name": "strDisplay",
            "technicalDefault": "No",
            "businessMeaning": "Toggles the visibility of the 3D text label showing the 'Hanger Model' near the hardware.",
            "validRange": "Yes, No",
            "unit": "Boolean (Enumeration)",
            "affectsOutput": "If 'Yes', calculates a point near the hanger and draws the string from 'stModel' using the specified dimension style and offset."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "Current Dimstyle",
            "businessMeaning": "Specifies the dimension style (text height, font, etc.) to be used for the 3D model label.",
            "validRange": "Any dimension style defined in the drawing",
            "unit": "Style Name",
            "affectsOutput": "Controls the appearance (font, size) of the 'stModel' text when 'strDisplay' is Yes."
          },
          {
            "name": "dOffset",
            "technicalDefault": "0",
            "businessMeaning": "Adjusts the horizontal distance of the text label from the hanger geometry, preventing overlap with other elements.",
            "validRange": "Numeric (usually 0-5000mm depending on scale)",
            "unit": "mm",
            "affectsOutput": "Moves the text label location along a calculated vector perpendicular to the view direction."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing strDisplay to 'Yes'",
            "effect": "Enables the logic to draw text labels.",
            "cascade": [
              "sDimStyle",
              "dOffset",
              "stModel"
            ]
          },
          {
            "trigger": "Changing stType",
            "effect": "Switches the geometric construction branch used to draw the Body.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "3D Representation Body",
            "description": "A visual representation of the metal connector (Sheet metal part) constructed using Body primitives (boxes, swept profiles based on PLine). It is purely visual (Display 154) and does not create tooling for CNC.",
            "appliedTo": "Intersecting point between the first selected beam (carrier) and the second selected beam (supported)."
          },
          {
            "type": "3D Text Label",
            "description": "Text drawn in ModelSpace displaying the Hanger Model, visible in 3D views and rendered output.",
            "appliedTo": "Offset location relative to the hanger."
          },
          {
            "type": "BOM Data",
            "description": "Exports map data containing Name (Code), Type (Model), and Qty to hsbCAD BOM systems and DXI output.",
            "appliedTo": "Project Reports / Lists."
          }
        ]
      },
      "tokens_used": 6755,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script ('Insert TSL' command)",
          "Execute Initial Configuration (Unit set to 'mm', Properties defined)",
          "Check Insertion Flag (_bOnInsert)",
          "Show Dialog (showDialogOnce)",
          "Prompt User: Select first beam (Supporting Beam/Carrier) via getBeam()",
          "Prompt User: Select second beam (Supported Beam/Joist) via getBeam()",
          "Calculate Local Coordinate System (vX, vY, vZ) based on script insertion point and beam geometry",
          "Determine Orientation (Normal or Flipped) based on Reference Direction Map flag",
          "Calculate Dimensions (Width, Height, Face Depth) from selected beams",
          "Evaluate 'Hanger Type' Property (stType)",
          "[Conditional] Construct 3D Body geometry using primitives (Body, PLine) specific to the selected hanger type",
          "[Conditional] If 'Display Model' (strDisplay) is Yes, Calculate Text Position and Draw Label",
          "Set Dependency and Assign to Groups (links script to first beam)",
          "Write Data to Map (TSLBOM) and DXI Export",
          "Finish Execution"
        ],
        "conditionalBranches": [
          {
            "condition": "Hanger Type (stType) Selection",
            "path1": {
              "name": "Heavy Universal",
              "steps": [
                "Calculate start point based on mid-height of carrier beam",
                "Create Base Back Plate (Body)",
                "Create Side Flanges (2x)",
                "Create Face Flanges (2x on each side)",
                "Create Top Fixing Plate (2x)",
                "Merge parts and Draw"
              ]
            },
            "path2": {
              "name": "Mini Hanger",
              "steps": [
                "Calculate start point based on mid-height of carrier beam",
                "Create Base Back Plate (Body)",
                "Create Side Flanges (2x)",
                "Create Face Flanges (2x)",
                "Merge parts and Draw"
              ]
            },
            "path3": {
              "name": "Face Hanger",
              "steps": [
                "Calculate start point based on mid-height of carrier beam",
                "Create Base Back Plate (Body)",
                "Create complex Side Profile using PLine (swept)",
                "Create Face Profile using PLine (swept)",
                "Mirror Side and Face profiles to opposite side",
                "Merge parts and Draw"
              ]
            },
            "path4": {
              "name": "Top Fix",
              "steps": [
                "Calculate start point based on mid-height of carrier beam",
                "Create Base Back Plate (Body)",
                "Create complex Side Profile using PLine (swept) including Face and Top components",
                "Mirror Side assembly to opposite side",
                "Merge parts and Draw"
              ]
            }
          },
          {
            "condition": "Display Model (strDisplay) Property",
            "path1": {
              "name": "Yes (Show Label)",
              "steps": [
                "Calculate base position below the hanger",
                "Calculate offset vector perpendicular to view direction",
                "Apply offset (dOffset) to text position",
                "Draw text string (stModel) using DimStyle (sDimStyle)"
              ]
            },
            "path2": {
              "name": "No (Hide Label)",
              "steps": [
                "Skip text drawing logic"
              ]
            }
          },
          {
            "condition": "Orientation Context Menu ('Change orientation')",
            "path1": {
              "name": "Standard Orientation",
              "steps": [
                "Calculate Coordinate System",
                "Ensure vZ aligns with World Z",
                "Swap vY/vZ if necessary based on dot product"
              ]
            },
            "path2": {
              "name": "Flipped Orientation",
              "steps": [
                "Force vY to local Y0 and vZ to local Z0",
                "Inverts the calculated Coordinate System axes"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Valid GenBeam Selection",
            "errorMessage": "Script will likely fail or produce geometry at (0,0,0) if getBeam() returns nothing or invalid entity.",
            "recovery": "Ensure two valid beams are selected during insertion."
          },
          {
            "check": "Beam Dimensions",
            "errorMessage": "If beams have 0 dimensions (flat), geometry may look incorrect.",
            "recovery": "Check beam properties in hsbCAD."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Hanger Type",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Script recalculates immediately. Geometry switches between Heavy Universal, Mini, Face, or Top Fix configurations."
          },
          {
            "action": "Edit Text Display (Model/Code/Offset)",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "If Display Model is 'Yes', updates the 3D text label content and position. 'Hanger Code' and 'Model' update BOM export data."
          },
          {
            "action": "Toggle Orientation",
            "how": "Right-click Context Menu -> 'Change orientation'",
            "effect": "Swaps the local Y and Z axes used for construction, effectively rotating the hanger 90 degrees around the beam axis."
          },
          {
            "action": "Move Script",
            "how": "Grip Edit / Move Command",
            "effect": "Script moves relative to coordinate system. Geometry remains attached to beams if beams are referenced, but explicit movement updates the insertion point (_Pt0)."
          }
        ]
      },
      "tokens_used": 7967,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# I-joist Hanger Display\n\n## Overview\nGenerates 3D symbolic representations of various I-joist hanger types at beam intersections. This script is used to visually identify hardware and export BOM data, but it does not generate CNC machining data.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for 3D visualization. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: Two GenBeams (beams).\n- **Minimum Beam Count**: 2 (One supporting/carrier beam and one supported/joist beam).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `I-joist Hanger Display.mcr`\n\n### Step 2: Select Supporting Beam\n```\nCommand Line: Select beam\nAction: Click on the beam that will carry the load (the main beam or ledger).\n```\n\n### Step 3: Select Supported Beam\n```\nCommand Line: Select beam\nAction: Click on the beam that will be supported (the joist or secondary beam).\n```\n\n### Step 4: Configure Properties\nAfter insertion, select the script instance and open the **Properties Palette** (Ctrl+1) to set the specific Hanger Type and enter Manufacturer Codes.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Hanger Type | Dropdown | Face Hanger | Select the geometry type: Heavy Universal, Mini Hanger, Face Hanger, or Top Fix. |\n| Hanger Code | Text | [Blank] | Enter the specific manufacturer part number (e.g., \"LUS26\") for BOM reports. |\n| Hanger Model | Text | [Blank] | Enter the manufacturer name or series (e.g., \"Simpson Strong-Tie\") for labeling. |\n| PosNum | Number | 0 | Read-only position number inherited from the project. |\n| Display Model | Dropdown | No | Set to \"Yes\" to show the Hanger Model text as a 3D label in the drawing. |\n| DimStyle | Text | Current Dimstyle | Select the dimension style to control the font and height of the 3D text label. |\n| Offset | Number | 0 | Adjusts the distance of the text label from the hanger to avoid overlapping other elements. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change orientation | Rotates the hanger 90 degrees around the beam axis, swapping the vertical and horizontal orientation. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- Use the **Properties Palette** to quickly switch between hanger types (e.g., from \"Face Hanger\" to \"Top Fix\") without re-inserting the script.\n- Enable **Display Model** set to \"Yes\" during design reviews to visualize exactly which hardware model is specified.\n- The script automatically updates if you move the connected beams, as it links to the first selected beam (carrier).\n\n## FAQ\n- **Q: Does this script cut holes or rout the beams?**\n  - A: No, this script creates a visual representation (Sheet metal part) and BOM data only. It does not modify the beam geometry for manufacturing.\n- **Q: Why is my text label not showing up?**\n  - A: Ensure the \"Display Model\" property is set to \"Yes\" and that the \"Hanger Model\" field contains text. Check your DimStyle if the text is too small to see.\n- **Q: How do I fix the hanger if it is facing the wrong direction?**\n  - A: Select the hanger, right-click, and choose \"Change orientation\" from the context menu."
      },
      "tokens_used": 5867,
      "error": null
    }
  }
}