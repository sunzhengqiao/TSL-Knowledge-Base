{
  "filename": "StackEntity.mcr",
  "status": "completed",
  "total_tokens": 55484,
  "processing_time": 319.9643211364746,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": 3,\n    \"minorVersion\": 2,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": null,\n  \"versionHistory\": [\n    {\n      \"version\": \"3.2\",\n      \"date\": \"12.02.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-23372 fully supporting new behaviour of controlling properties\"\n    },\n    {\n      \"version\": \"3.1\",\n      \"date\": \"10.01.2025\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"HSB-22732: Add Axle load calculation\"\n    },\n    {\n      \"version\": \"3.0\",\n      \"date\": \"22.11.2024\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-21733 supports relocation of attached spacers when moved\"\n    },\n    {\n      \"version\": \"2.9\",\n      \"date\": \"24.09.2024\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-22717 element references improved\"\n    },\n    {\n      \"version\": \"2.8\",\n      \"date\": \"17.09.2024\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-21161 debug messages removed\"\n    },\n    {\n      \"version\": \"2.7\",\n      \"date\": \"06.09.2024\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-22636 tag also visible in model view\"\n    },\n    {\n      \"version\": \"2.6\",\n      \"date\": \"22.08.2024\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-21998 settings introduced to enable custom color coding\"\n    },\n    {\n      \"version\": \"2.5\",\n      \"date\": \"16.08.2024\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-21677 jigging items improved\"\n    },\n    {\n      \"version\": \"2.4\",\n      \"date\": \"26.07.2024\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-22260 Z-load dimension measured from base point, bugfix on insert with no truck definitions present\"\n    },\n    {\n      \"version\": \"2.3\",\n      \"date\": \"16.07.2024\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-22260 load dimensions exposed: @(LoadLength), @(LoadWidth), @(LoadHeight)\"\n    },\n    {\n      \"version\": \"2.2\",\n      \"date\": \"25.06.2024\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-22260 oversizes and load dimensions prepared\"\n    },\n    {\n      \"version\": \"2.1\",\n      \"date\": \"27.02.2024\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-21199 A new property 'Number' has been added. The number can be used for formatting and specifies a fixed unique number.\"\n    },\n    {\n      \"version\": \"2.0\",\n      \"date\": \"21.12.2023\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-20205 wireframe display improved, new format property and grips to display tag\"\n    },\n    {\n      \"version\": \"1.9\",\n      \"date\": \"24.11.2023\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-20724 bugfix pack model display\"\n    },\n    {\n      \"version\": \"1.8\",\n      \"date\": \"24.11.2023\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-20724 debug messages removed\"\n    },\n    {\n      \"version\": \"1.7\",\n      \"date\": \"17.11.2023\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-19662 drag behaviour, parent nesting updated\"\n    },\n    {\n      \"version\": \""
      },
      "tokens_used": 9079,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of `_kModelSpace` in `tslDialog.dbCreate(..., _kModelSpace, mapTsl)`. Script manages 3D logistics entities (Truck definitions, Stacks) using 3D display properties (grips, true color, hide directions). No Paper Space specific commands (`_Viewport`, `sd_` prefix) or ShopDrawing indicators (#Type E generation) found."
        },
        "prerequisites": {
          "requiredEntities": [
            "None (Inserts as a standalone entity based on point selection)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "TruckDefinition styles",
            "TslUtilities.dll (referenced for dialog services)"
          ]
        }
      },
      "tokens_used": 7969,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"Pick insertion point.\",\n        \"condition\": \"_bOnInsert (Comment instruction)\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select items to be removed|\",\n        \"condition\": \"_bOnRecalc && _kExecuteKey==sTriggerRemoveItems\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"PrPoint\",\n        \"promptOriginal\": \"|Pick location|\",\n        \"condition\": \"Within sTriggerRemoveItems loop\",\n        \"required\": true\n      },\n      {\n        \"step\": 4,\n        \"function\": \"getString\",\n        \"promptOriginal\": \"|Are you sure to overwrite existing settings?| [|No|]/|Yes|\",\n        \"condition\": \"If settings file exists during Export\",\n        \"required\": false\n      }\n"
      },
      "tokens_used": 10894,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Simulates the loading of timber packages onto transport trucks to verify spatial fit, calculate axle loads, and manage packaging definitions for logistics.",
          "category": "Logistics / Production Management",
          "typicalUseCase": "Used by production planners to ensure a collection of timber elements (a pack) fits on a specific truck configuration and complies with road weight regulations (axle loads) before physical loading."
        },
        "parameters": [
          {
            "name": "Length",
            "technicalDefault": "13600.0",
            "businessMeaning": "The usable length of the truck bed or loading area.",
            "validRange": "5000.0 - 24000.0",
            "unit": "mm",
            "affectsOutput": "Defines the X-axis boundary for the 3D truck visualization and the maximum linear extent for stacked elements."
          },
          {
            "name": "Width",
            "technicalDefault": "2480.0",
            "businessMeaning": "The usable width of the truck bed.",
            "validRange": "2000.0 - 3000.0",
            "unit": "mm",
            "affectsOutput": "Defines the Y-axis boundary. Used to check if the stacked load exceeds the truck width (including packaging oversizes)."
          },
          {
            "name": "Height",
            "technicalDefault": "2700.0",
            "businessMeaning": "The maximum allowed height for the loaded truck (from ground to top of load).",
            "validRange": "2500.0 - 4800.0",
            "unit": "mm",
            "affectsOutput": "Defines the Z-axis limit. Critical for verifying clearance under bridges or legal height restrictions."
          },
          {
            "name": "Tara",
            "technicalDefault": "0.0",
            "businessMeaning": "The unladen weight of the vehicle (curb weight).",
            "validRange": "3000.0 - 15000.0",
            "unit": "kg",
            "affectsOutput": "Subtracted from the Gross Weight limit to determine the remaining capacity for timber elements. Used in Net/Gross weight calculations."
          },
          {
            "name": "Gross Weight",
            "technicalDefault": "0.0",
            "businessMeaning": "The maximum legally permissible total weight (Truck + Cargo).",
            "validRange": "18000.0 - 60000.0",
            "unit": "kg",
            "affectsOutput": "Serves as the validation limit for the sum of the truck's Tara and the calculated weight of the stacked timber."
          },
          {
            "name": "Color Rule",
            "technicalDefault": "byLayer",
            "businessMeaning": "Determines the visual color logic for stacked items in the 3D model to aid identification.",
            "validRange": "byLayer, byPackNumber, byStackLayer",
            "unit": "Enumeration",
            "affectsOutput": "Changes the color of entities in the model view to distinguish between different layers, packs, or source layers of the timber."
          },
          {
            "name": "Asynchronous Oversize Width",
            "technicalDefault": "False",
            "businessMeaning": "Toggles how width-wise packaging clearances (oversizes) are calculated relative to the stack.",
            "validRange": "True/False",
            "unit": "Boolean",
            "affectsOutput": "Alters the calculation of the effective load width, potentially changing how tightly packs are visualized or validated against truck walls."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change in Truck Dimensions (Length, Width, Height)",
            "effect": "Updates the bounding box for collision detection and stack visualization.",
            "cascade": [
              "LoadLength",
              "LoadWidth",
              "LoadHeight",
              "Stack Visualization"
            ]
          },
          {
            "trigger": "Addition/Removal of Stacked Items",
            "effect": "Recalculates total Weight, Volume, and Center of Gravity (COG).",
            "cascade": [
              "Axle Weights",
              "Total Weight",
              "COG Position"
            ]
          },
          {
            "trigger": "Change in Axle Positions (in Definition)",
            "effect": "Redistributes the load weight across the new axle configuration based on the COG.",
            "cascade": [
              "Axle Weights Calculation"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Visualization",
            "description": "Wireframe or solid representation of the truck chassis and the stacked timber load.",
            "appliedTo": "Model Space"
          },
          {
            "type": "Calculated Logistics Data",
            "description": "Properties such as Total Weight, Volume, COG coordinates, and individual Axle Loads.",
            "appliedTo": "Element Properties / Data Export"
          },
          {
            "type": "Informational Tag",
            "description": "A text label displaying the Stack Number and dimensions, visible in plan and model views.",
            "appliedTo": "StackEntity instance"
          }
        ]
      },
      "tokens_used": 10549,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script (Command: TSLCONTENT)",
          "2. [Insertion Phase] Prompt user: 'Pick insertion point.' (getPoint)",
          "3. Create initial StackEntity instance at selected point",
          "4. Enter Recalculation Loop",
          "5. Check for _kExecuteKey (Triggered Action) vs Standard Recalc",
          "6. [Standard Recalc] Calculate Axle Loads based on COG and Axle positions",
          "7. [Standard Recalc] Store logistics data (Weight, Volume, COG, Dimensions) to SubMap",
          "8. [Standard Recalc] Generate 3D Visualization (Wireframe/Solids) and Apply Colors",
          "9. Exit (Wait for next event)"
        ],
        "conditionalBranches": [
          {
            "condition": "User triggers 'Remove Items' (sTriggerRemoveItems) via Context Menu",
            "path1": {
              "name": "Valid Selection",
              "steps": [
                "Prompt: Select items to be removed (PrEntity)",
                "Filter selection for valid StackItem/StackPack entities",
                "Prompt: Pick location (PrPoint with Jig)",
                "Remove entity mapping (subMapX removal)",
                "Transform selected entities to new location",
                "Reset entity color to default (0)"
              ]
            },
            "path2": {
              "name": "Invalid/Empty Selection",
              "steps": [
                "Prompt: Select items to be removed (PrEntity)",
                "Filter selection finds 0 valid items",
                "Show Error: 'The selection set does not contain removable items.'",
                "Restart execution loop (setExecutionLoops(2))"
              ]
            }
          },
          {
            "condition": "User triggers 'Export Settings' (sTriggerExportSettings)",
            "path1": {
              "name": "File Does Not Exist",
              "steps": [
                "Initialize write flag (bWrite = true)",
                "Ensure target directory exists",
                "Write Map to XML file",
                "Report Success"
              ]
            },
            "path2": {
              "name": "File Exists (Overwrite Check)",
              "steps": [
                "Prompt: 'Are you sure to overwrite existing settings? [No]/[Yes]' (getString)",
                "If Input == 'Yes': Write Map to XML, Report Success",
                "If Input != 'Yes': Abort write"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Selection contains valid removable items (linked to StackEntity)",
            "errorMessage": "The selection set does not contain removable items.",
            "recovery": "Select items that are currently stacked (children of the StackEntity) and retry."
          },
          {
            "check": "Overwrite confirmation for settings file",
            "errorMessage": "Prompt interrupts flow: 'Are you sure to overwrite existing settings?'",
            "recovery": "Enter 'Y' to overwrite or 'N' to cancel the export operation."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Remove Items from Stack",
            "how": "Context Menu -> 'Remove Items' -> Select Entities",
            "effect": "Unlinks selected timber items from the truck stack, resets their layer/color, and moves them to a new user-defined location."
          },
          {
            "action": "Edit Stack Settings",
            "how": "Context Menu -> 'Settings'",
            "effect": "Opens a dialog to change display preferences (e.g., Color Rule: byLayer, byPackNumber, byStackLayer)."
          },
          {
            "action": "Toggle Width Calculation Mode",
            "how": "Context Menu -> 'Asynchronous/Synchronous Oversize Width'",
            "effect": "Toggles the boolean property for oversize calculation, triggering a recalculation of load width and layout."
          },
          {
            "action": "Import/Export Configuration",
            "how": "Context Menu -> 'Import Settings' or 'Export Settings'",
            "effect": "Loads the current truck configuration from an XML file or saves the current configuration to an XML file for reuse."
          },
          {
            "action": "Modify Geometry Properties",
            "how": "Properties Palette (OPM)",
            "effect": "Changing Length, Width, Height, or Tara updates the truck boundary visualization and recalculates load capacity and axle weights."
          }
        ]
      },
      "tokens_used": 10290,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# StackEntity.mcr\n\n## Overview\nThis script simulates the loading of timber packages onto transport trucks to verify spatial fit and calculate logistics data. It manages 3D visualizations of truck loads, calculates axle loads based on weight distribution, and validates dimensions against truck configurations.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used for 3D visualization and placement of the truck loading area. |\n| Paper Space | No | Not applicable for 2D drawings. |\n| Shop Drawing | No | Not intended for manufacturing drawings. |\n\n## Prerequisites\n- **Required entities:** None (Inserts as a standalone entity).\n- **Minimum beam count:** 0.\n- **Required settings files:** `TslUtilities.dll` must be available. (Optional: XML configuration files for saving/loading truck settings).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `StackEntity.mcr`\n\n### Step 2: Pick Insertion Point\n```\nCommand Line: Pick insertion point.\nAction: Click in the Model Space to place the StackEntity (truck base).\n```\n\n*(Note: After insertion, the script runs automatically. Further configuration is done via the Properties Palette and Right-Click Context menus.)*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Length | Double | 13600.0 | The usable length of the truck bed in mm. |\n| Width | Double | 2480.0 | The usable width of the truck bed in mm. |\n| Height | Double | 2700.0 | The maximum allowed height for the loaded truck in mm. |\n| Tara | Double | 0.0 | The unladen weight (curb weight) of the vehicle in kg. |\n| Gross Weight | Double | 0.0 | The maximum legally permissible total weight (Truck + Cargo) in kg. |\n| Number | Integer | 0 | A fixed unique number used for identification or formatting. |\n| Color Rule | String | byLayer | Determines visual color coding for stacked items (options: byLayer, byPackNumber, byStackLayer). |\n| Asynchronous Oversize Width | Boolean | False | Toggles how width-wise packaging clearances are calculated relative to the stack. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Remove Items** | Allows you to select items currently in the stack to remove them. Prompts for a new location to place the removed items. |\n| **Settings** | Opens a dialog box to configure display preferences, such as the Color Rule. |\n| **Asynchronous/Synchronous Oversize Width** | Toggles the calculation mode for oversize widths without opening the full settings dialog. |\n| **Export Settings** | Saves the current truck configuration (dimensions, weights, etc.) to an XML file. |\n| **Import Settings** | Loads a truck configuration from a previously saved XML file. |\n\n## Settings Files\n- **Filename**: User-defined (e.g., `TruckConfig.xml`)\n- **Location**: User-specified directory path.\n- **Purpose**: Stores truck definition parameters (Length, Width, Height, Tara, Gross Weight) and display settings to ensure consistency across different loading plans without manual re-entry.\n\n## Tips\n- **Visualizing Layers:** Change the \"Color Rule\" property to `byStackLayer` or `byPackNumber` in the Properties Palette to visually distinguish different groups of timber in the 3D model.\n- **Weight Validation:** The script calculates axle loads based on the Center of Gravity (COG). If you are exceeding weight limits, try redistributing the packages closer to the center of the truck.\n- **Reuse Configurations:** If you frequently use the same truck type, use \"Export Settings\" once to save it, and then use \"Import Settings\" on new StackEntity instances to save time.\n\n## FAQ\n- **Q: How do I put timber packages onto the truck?**\n- **A:** This script defines the truck boundary and logic. You typically attach your timber packages (elements) to this StackEntity using your standard production workflow or nesting tools.\n- **Q: What do the load dimensions (Length, Width, Height) represent?**\n- **A:** These define the maximum allowable volume for the truck. The script will visualize the load relative to these boundaries to check for clearance.\n- **Q: What happens if I change the \"Tara\" property?**\n- **A:** Updating the \"Tara\" (curb weight) will immediately recalculate the Net Cargo Weight and Axle Loads, helping you determine how much more material you can legally load."
      },
      "tokens_used": 6703,
      "error": null
    }
  }
}