{
  "filename": "hsb_LiftingHolesAutomatic.mcr",
  "status": "completed",
  "total_tokens": 43202,
  "processing_time": 351.1010010242462,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 5,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.5",
            "date": "22.06.2021",
            "author": "Marsel Nakuci",
            "changes": "HSB-12290: fix bug when calculationg the closest top plate"
          },
          {
            "version": "1.0",
            "date": "08.12.2014",
            "author": "Alberto Jena (alberto.jena@hsbcad.com)",
            "changes": "Release Version"
          }
        ],
        "settingsFiles": [
          "Materials.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 7495,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script lacks 'sd_' or 'Multipage' prefix. Logic involves 3D geometric calculations (centroids, volumes, density) using GenBeam and Element entities. No usage of _Viewport or Paper Space specific drawing commands."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing a Wall Element (ElementWallSF).",
          "requiredSettings": [
            "Materials.xml (must exist in the hsbCompany\\Abbund folder)"
          ]
        }
      },
      "tokens_used": 6109,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "showDialogOnce() called during _bOnInsert",
            "title": null,
            "dataSource": "Implicitly created from PropDouble variables",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dDistanceBetweenStraps",
            "type": "PropDouble",
            "displayName": "Distance between straps",
            "defaultValue": "1200 mm",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dEdgeOffset",
            "type": "PropDouble",
            "displayName": "Min Distance from edge of the wall",
            "defaultValue": "600 mm",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "nCenterHookBeam",
            "type": "PropDouble",
            "displayName": "Centers lifting beam hooks",
            "defaultValue": "600 mm",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "4",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "Materials.xml",
            "searchPaths": [
              "_kPathHsbCompany\\Abbund"
            ],
            "purpose": "Provides material density data used to calculate wall weight and centroid for lifting hole placement.",
            "required": true
          }
        ]
      },
      "tokens_used": 6399,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically calculates and marks the optimal locations for lifting holes on a wall element based on its physical center of gravity to ensure balanced lifting during transport.",
          "category": "Process/Production",
          "typicalUseCase": "Used in the pre-assembly phase to mark where lifting straps or hooks should attach to a wall panel so it lifts level and doesn't tip, accounting for varying material densities and openings."
        },
        "parameters": [
          {
            "name": "dDistanceBetweenStraps",
            "technicalDefault": "1200 mm",
            "businessMeaning": "The distance between the two lifting points on a single lifting set (e.g., the width of a spreader bar or the spacing between hooks on a lifting strap).",
            "validRange": "800 mm - 2500 mm",
            "unit": "mm",
            "affectsOutput": "Offsets the calculated drill points left and right from the calculated center point of each lifting set."
          },
          {
            "name": "dEdgeOffset",
            "technicalDefault": "600 mm",
            "businessMeaning": "The mandatory minimum safety distance between the lifting hole and the nearest left or right edge of the wall.",
            "validRange": "300 mm - 1000 mm",
            "unit": "mm",
            "affectsOutput": "Constrains the placement of holes. If the calculated position is closer to the edge than this value, the script adjusts the pattern (e.g., reduces the number of holes or shifts them)."
          },
          {
            "name": "nCenterHookBeam",
            "technicalDefault": "600 mm",
            "businessMeaning": "The module/spacing unit used to determine how far apart the lifting sets are placed from the center of gravity. Typically corresponds to the spacing of hooks on the crane beam.",
            "validRange": "400 mm - 1200 mm",
            "unit": "mm",
            "affectsOutput": "Determines the multiplier used to calculate the distance of the lifting sets from the wall's centroid. A higher value pushes the lifting sets further apart."
          },
          {
            "name": "nColor",
            "technicalDefault": "4",
            "businessMeaning": "The CAD color index used to draw the lifting hole markers in the model and shop drawings.",
            "validRange": "1 - 255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the visual color of the graphical markers on screen."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Wall Length (Calculated) vs (dEdgeOffset + nCenterHookBeam)",
            "effect": "Determines the lifting pattern (1 hole, 2 holes, or 4 holes).",
            "cascade": [
              "dDistanceBetweenStraps",
              "nCenterHookBeam"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Graphical Markers (PLine)",
            "description": "Draws visual symbols (chevrons/arrows) on the front face of the wall indicating the exact points where lifting holes should be machined.",
            "appliedTo": "Element (Wall)"
          }
        ]
      },
      "tokens_used": 8332,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launched via command or catalog execution.",
          "2. If _bOnInsert: Check for duplicate insert cycles.",
          "3. Show Dynamic Dialog (Properties) to configure parameters (Distances, Offsets).",
          "4. Prompt user to select a set of Wall Elements (ElementWallSF).",
          "5. Iterate through selected elements and attach a new instance of the script to each.",
          "6. Erase the temporary 'command' instance.",
          "7. [Attached Instance Execution] Validate the Element is a valid wall.",
          "8. Locate and load 'Materials.xml' to retrieve material densities.",
          "9. Iterate through all GenBeams in the wall, categorize by Zone, and calculate Volume and Density.",
          "10. Calculate the Center of Gravity (CoG) of the wall (including factory-fitted openings).",
          "11. Determine the length of the wall and identify all Top Plate beams.",
          "12. Calculate the optimal hole pattern (1, 2, or 4 holes) based on CoG position relative to edges and wall length.",
          "13. Cast rays from calculated points to intersect with Top Plates.",
          "14. If rays miss Top Plates, find the geometrically closest Top Plate and project onto it.",
          "15. Draw Chevron (V-shape) markers at the projected points on the front face of the wall."
        ],
        "conditionalBranches": [
          {
            "condition": "Calculated Module (nValue) vs Wall Length",
            "path1": {
              "name": "Single Hole Pattern",
              "steps": [
                "Condition: (nValue <= 0) AND (Wall Length <= 1200mm)",
                "Result: Single lifting hole placed exactly at the calculated Center of Gravity."
              ]
            },
            "path2": {
              "name": "Double Hole Pattern (Standard)",
              "steps": [
                "Condition: (nValue <= 0) AND (Wall Length > 1200mm)",
                "Result: Two lifting holes placed at CoG +/- 'Centers lifting beam hooks'."
              ]
            },
            "path3": {
              "name": "Four Hole Pattern (Outrigger)",
              "steps": [
                "Condition: nValue > 0",
                "Result: Four lifting holes forming two sets.",
                "Left Set centered at (CoG - nValue * HookCenter) +/- (StrapDist / 2).",
                "Right Set centered at (CoG + nValue * HookCenter) +/- (StrapDist / 2)."
              ]
            }
          },
          {
            "condition": "Top Plate Intersection (Vertical Projection)",
            "path1": {
              "name": "Direct Intersection",
              "steps": [
                "Condition: Raycast from hole point intersects a Top Plate Envelope Body.",
                "Result: Drill position set to the intersection point."
              ]
            },
            "path2": {
              "name": "Closest Plate Projection",
              "steps": [
                "Condition: Raycast does not intersect any Top Plate (e.g., due to openings or geometry).",
                "Result: Calculate distance to all Top Plates, find the closest one, and project point onto that plane (Fix HSB-12290)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Validity",
            "errorMessage": "(Implicit - Script Erases)",
            "recovery": "Ensure the selected entity is a valid ElementWallSF generated by hsbCAD."
          },
          {
            "check": "Materials.xml Existence",
            "errorMessage": "hsbMaterial Table not found, please set the right company folder and rerun this command.",
            "recovery": "Verify the path _kPathHsbCompany\\Abbund\\Materials.xml exists and contains valid density data."
          },
          {
            "check": "Material Lookup",
            "errorMessage": "(Implicit - Default used)",
            "recovery": "If a specific beam material is not found in the XML, the script defaults to a density of 500."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Parameters",
            "how": "Properties Palette (OPM)",
            "effect": "Modifying 'Distance between straps', 'Min Distance from edge', or 'Centers lifting beam hooks' triggers a recalculation of the hole positions and updates the graphics."
          },
          {
            "action": "Change Visuals",
            "how": "Properties Palette (OPM)",
            "effect": "Changing 'Color' updates the color of the Chevron markers immediately."
          },
          {
            "action": "Wall Modification",
            "how": "Modify Wall Geometry or Beams",
            "effect": "Changing the wall dimensions or adding/removing beams/openings updates the Center of Gravity, which triggers the script to re-calculate and move the lifting holes accordingly."
          }
        ]
      },
      "tokens_used": 9280,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_LiftingHolesAutomatic.mcr\n\n## Overview\nAutomatically calculates and marks the optimal locations for lifting holes on a wall element based on its physical center of gravity. This ensures balanced lifting during transport by accounting for material densities, wall openings, and dimensions.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run on 3D wall elements in the model. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | Not applicable for generating 2D drawings directly. |\n\n## Prerequisites\n- **Required Entities**: An existing Wall Element (`ElementWallSF`) containing structural beams (studs, top/bottom plates).\n- **Minimum Beam Count**: 0 (Script checks existing beams).\n- **Required Settings**: `Materials.xml` must exist in your `hsbCompany\\Abbund` folder to provide material density for weight calculations.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_LiftingHolesAutomatic.mcr` from the catalog.\n\n### Step 2: Configure Parameters\n```\nAction: A Dynamic Dialog appears (or check the Properties Palette).\nAction: Adjust lifting settings (Distances, Offsets, Color) as needed for your lifting gear.\nAction: Click OK to confirm.\n```\n\n### Step 3: Select Wall Elements\n```\nCommand Line: \\nSelect a set of elements\nAction: Click on the wall elements you wish to process.\nAction: Press Enter to complete the selection.\n```\n*Note: The script will attach to the selected elements and automatically calculate the hole positions.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Distance between straps | Number | 1200 mm | The distance between the two lifting points on a single lifting set (e.g., width of a spreader bar). |\n| Min Distance from edge of the wall | Number | 600 mm | The mandatory safety distance between the lifting hole and the nearest left or right edge of the wall. |\n| Centers lifting beam hooks | Number | 600 mm | The module/spacing unit used to determine how far apart the lifting sets are placed from the center of gravity. |\n| Color | Number | 4 | The CAD color index used to draw the lifting hole markers on the wall. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not add specific custom context menu items. Use the Properties Palette to modify parameters. |\n\n## Settings Files\n- **Filename**: `Materials.xml`\n- **Location**: `hsbCompany\\Abbund` (Company folder)\n- **Purpose**: Provides material density data (e.g., for wood, concrete) used to calculate the wall's physical weight and center of gravity.\n\n## Tips\n- **Automatic Updates**: If you modify the wall geometry (add/remove beams or openings) or change the wall dimensions, the script will automatically recalculate the hole positions to maintain balance.\n- **Edge Safety**: The script ensures holes are never placed closer than the \"Min Distance from edge,\" potentially switching from a 4-hole pattern to a 2-hole pattern if the wall is too short.\n- **Visualizing Points**: If the calculated vertical projection misses a top plate (e.g., due to a large opening), the script automatically finds the geometrically closest top plate to ensure the marker is still drawn on valid timber.\n- **Verification**: Always verify that the generated markers align with your specific crane and lifting gear configuration before machining.\n\n## FAQ\n- Q: Why did the script fail or show an error about a table?\n- A: Ensure `Materials.xml` is present in your `hsbCompany\\Abbund` folder. Without density data, the center of gravity cannot be calculated accurately.\n- Q: Why are there 4 holes on one wall and only 2 on another?\n- A: The pattern is determined by the wall length and the \"Centers lifting beam hooks\" parameter. Longer walls or specific spacing settings trigger the 4-hole (outrigger) pattern for better stability.\n- Q: Can I move the markers manually?\n- A: No. The markers are calculated based on physics. To move them, you must adjust the parameters in the Properties Palette or modify the wall structure itself, which shifts the center of gravity."
      },
      "tokens_used": 5587,
      "error": null
    }
  }
}