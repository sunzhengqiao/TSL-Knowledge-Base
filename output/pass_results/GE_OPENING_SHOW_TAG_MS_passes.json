{
  "filename": "GE_OPENING_SHOW_TAG_MS.mcr",
  "status": "completed",
  "total_tokens": 43768,
  "processing_time": 914.0051488876343,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.4",
            "date": "20.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Added informative text when no stylename or description available\nAdded option to make it visible on top view only"
          },
          {
            "version": "1.3",
            "date": "19.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Renamed from GE_PLOT_OPENING_TAG_MS to GE_OPENING_SHOW_TAG_MS"
          },
          {
            "version": "1.2",
            "date": "17.apr.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Property updated: \"Exclude load bearing walls\" to \"Exclude non load bearing walls\"\nSet dependency on Wall entity\nAssigned to element group\nAdded display PLine (rectangle) (no/yes) (default value yes) and color for it (default value: magenta)\nAdded alignment (Horizontal/Free to rotate and relocate) (default value: horizontal)"
          },
          {
            "version": "1.1",
            "date": "07.feb.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Enhanced, display will follow this priorities: \n- Fisrt value: Stylename\n- if SF description is found, last value will be override\n- if Custom description is found, last value will be override\nDefault value for disp. rep. set to be empty (meanning will be Model Space)"
          },
          {
            "version": "1.0",
            "date": "26.jan.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6802,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Filename suffix '_MS', property sDisplayRep description 'If empty will be shown in model space', script operates on OpeningSF and ElementWallSF entities using 3D geometry (Point3d/Vector3d), no ShopDrawing logic or Viewport usage."
        },
        "prerequisites": {
          "requiredEntities": [
            "Opening",
            "ElementWall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5239,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect openings",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Insertion (via showDialogOnce)",
            "title": null,
            "dataSource": "Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Tag color",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Offset from wall outline",
            "defaultValue": 10,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sShowOpPline",
            "type": "PropString",
            "displayName": "Show opening outline",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sFilterLoadBearings",
            "type": "PropString",
            "displayName": "Exclude non load bearing walls",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sDisplayLine",
            "type": "PropString",
            "displayName": "Display line pointing to opening",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sDisplayRectangle",
            "type": "PropString",
            "displayName": "Display PLine",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nPLineColor",
            "type": "PropInt",
            "displayName": "PLine color",
            "defaultValue": 6,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sDisplayRep",
            "type": "PropString",
            "displayName": "Show in display representation",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "If empty will be shown in model space"
          },
          {
            "index": 6,
            "variable": "sAlignment",
            "type": "PropString",
            "displayName": "Tag orientation",
            "defaultValue": "Horizontal",
            "inputType": "dropdown",
            "options": [
              "Horizontal",
              "Free to rotate and relocate"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sTopViewOnly",
            "type": "PropString",
            "displayName": "Visible on top view only",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6310,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates 3D model space labels for wall openings to visualize style names, dimensions, or descriptions, optionally including bounding boxes and leader lines.",
          "category": "Annotation/Visualization",
          "typicalUseCase": "Used to quickly identify window or door types directly in the 3D model or exported CAD plans without generating full 2D layouts."
        },
        "parameters": [
          {
            "name": "nColor",
            "technicalDefault": 1,
            "businessMeaning": "Sets the AutoCAD color index for the text label content.",
            "validRange": "1-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the color of the displayed text string."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "Selects the dimension style used to determine the font, text height, and aspect ratio of the label.",
            "validRange": "Any valid DimStyle defined in the current drawing",
            "unit": "String",
            "affectsOutput": "Controls the font size and appearance of the text, as well as the calculated size of the optional border rectangle."
          },
          {
            "name": "dOffset",
            "technicalDefault": 10,
            "businessMeaning": "The distance the label is placed away from the face of the wall.",
            "validRange": "0 - 1000",
            "unit": "mm",
            "affectsOutput": "Moves the text and graphics further from or closer to the wall surface along the wall's normal vector."
          },
          {
            "name": "sShowOpPline",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the visibility of the polyline outlining the exact shape of the opening on the wall.",
            "validRange": "No, Yes",
            "unit": "Option",
            "affectsOutput": "If 'Yes', draws a rectangle representing the opening cut in the wall."
          },
          {
            "name": "sFilterLoadBearings",
            "technicalDefault": "Yes",
            "businessMeaning": "Determines whether to generate tags for non-load-bearing walls. If 'Yes', non-load-bearing walls are ignored.",
            "validRange": "No, Yes",
            "unit": "Option",
            "affectsOutput": "Filters which wall openings receive a tag based on the wall's structural property."
          },
          {
            "name": "sDisplayLine",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the leader line connecting the text label to the opening.",
            "validRange": "No, Yes",
            "unit": "Option",
            "affectsOutput": "Draws a line from the text/box to the center point of the opening if 'Yes'."
          },
          {
            "name": "sDisplayRectangle",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles a rectangular border box around the text label.",
            "validRange": "No, Yes",
            "unit": "Option",
            "affectsOutput": "Draws a colored rectangle around the text if 'Yes'."
          },
          {
            "name": "nPLineColor",
            "technicalDefault": 6,
            "businessMeaning": "Sets the AutoCAD color index for the optional border rectangle.",
            "validRange": "1-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the color of the border rectangle (if enabled)."
          },
          {
            "name": "sDisplayRep",
            "technicalDefault": "",
            "businessMeaning": "Specifies the Display Representation (e.g., 'Standard', 'Reflected') in which the tag is visible.",
            "validRange": "Any valid Display Representation name",
            "unit": "String",
            "affectsOutput": "Controls visibility based on the current hsbCAD view configuration. Empty implies Model Space visibility."
          },
          {
            "name": "sAlignment",
            "technicalDefault": "Horizontal",
            "businessMeaning": "Sets the rotation orientation of the text label relative to the world or the wall.",
            "validRange": "Horizontal, Free to rotate and relocate",
            "unit": "Option",
            "affectsOutput": "If 'Horizontal', text is aligned with World X/Y. If 'Free', text aligns with the wall's local coordinate system or opening direction."
          },
          {
            "name": "sTopViewOnly",
            "technicalDefault": "No",
            "businessMeaning": "Restricts the visibility of the tag to Top views (Plan views) only.",
            "validRange": "No, Yes",
            "unit": "Option",
            "affectsOutput": "If 'Yes', the tag is hidden in 3D views, elevations, and sections, only appearing when looking down the Z-axis."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sDisplayRectangle is 'No'",
            "effect": "The PLineColor parameter becomes functionally irrelevant as no rectangle is drawn.",
            "cascade": [
              "nPLineColor"
            ]
          },
          {
            "trigger": "sDimStyle change",
            "effect": "The calculated size of the Display Rectangle changes to fit the new text height and width.",
            "cascade": [
              "sDisplayRectangle"
            ]
          },
          {
            "trigger": "sFilterLoadBearings is 'Yes' and Wall is Non-Load-Bearing",
            "effect": "The script erases the instance, rendering all other visual parameters (color, offset, text) irrelevant for that specific wall.",
            "cascade": [
              "nColor",
              "dOffset",
              "sDisplayLine",
              "sAlignment"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text/Annotation",
            "description": "Displays the opening's Style Name, Description, or a default message indicating no info is available.",
            "appliedTo": "Model Space (associated with specific OpeningSF instances)"
          },
          {
            "type": "PLine (Polyline)",
            "description": "Optional leader line connecting text to opening, optional bounding box around text, and optional outline of the opening geometry.",
            "appliedTo": "Model Space"
          }
        ]
      },
      "tokens_used": 8044,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch: User executes GE_OPENING_SHOW_TAG_MS.",
          "2. Insert Cycle Check: Script checks if insertCycleCount() > 1. If yes, it erases the instance and returns to prevent recursion.",
          "3. Entity Selection: User is prompted to select opening entities (PrEntity).",
          "4. Selection Validation: Script checks if any entities were selected. If not, the instance is erased.",
          "5. Property Dialog: Properties dialog is shown once to configure initial settings (Tag color, Offset, Filters, etc.).",
          "6. Instance Management Loop: For each selected OpeningSF:",
          "   a. Validates the OpeningSF. Invalid entities are skipped.",
          "   b. Retrieves the parent Element. If invalid, the loop continues.",
          "   c. Cleanup: Searches for existing instances of this script attached to the opening and erases them to prevent duplicates.",
          "   d. Instance Creation: A new TslInst is created (dbCreate) linked to the OpeningSF and Element, passing all properties.",
          "7. Master Instance Erasure: The initial instance used for selection is erased. The script now runs in the context of the newly created instances.",
          "8. Context Execution (Per Instance):",
          "   a. Display Setup: Sets Display object properties (color, dimstyle, display rep, view direction).",
          "   b. Dependency: Establishes dependency on the OpeningSF and Element.",
          "   c. Filtering: Checks 'Exclude non load bearing walls' filter. If enabled and the wall is non-load-bearing, the instance erases itself.",
          "   d. Geometry Extraction: Calculates the OpeningSF width, height, depth, and coordinate system. It projects the opening polyline vertices to determine the accurate midpoint.",
          "   e. Opening Outline: If 'Show opening outline' is Yes, draws a polyline representing the opening on the wall.",
          "   f. Text Resolution: Determines the text to display: prioritizes Custom Description, then SF Description, then Style Name. Defaults to a message if none exist.",
          "   g. Alignment Calculation: Calculates the text position based on offset and alignment settings ('Horizontal' vs 'Free to rotate').",
          "   h. Text Drawing: Draws the text string using the calculated alignment vectors.",
          "   i. Leader Line: If 'Display line pointing to opening' is Yes, draws a connecting line from the text to the opening center.",
          "   j. Border Rectangle: If 'Display PLine' is Yes, draws a rectangle around the text based on text dimensions."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Re-insertion detected (Count > 1)",
              "steps": [
                "Erase instance",
                "Terminate script"
              ]
            },
            "path2": {
              "name": "First Insertion",
              "steps": [
                "Proceed to Entity Selection"
              ]
            }
          },
          {
            "condition": "Entity Selection Result",
            "path1": {
              "name": "Selection Successful",
              "steps": [
                "Show Dialog",
                "Process Entities"
              ]
            },
            "path2": {
              "name": "No Entities Selected / Cancelled",
              "steps": [
                "Erase instance",
                "Terminate script"
              ]
            }
          },
          {
            "condition": "Entity Validity (Loop)",
            "path1": {
              "name": "Valid OpeningSF and Element",
              "steps": [
                "Clean up old instances",
                "Create new instance"
              ]
            },
            "path2": {
              "name": "Invalid Entity",
              "steps": [
                "Skip to next entity in selection list"
              ]
            }
          },
          {
            "condition": "Load Bearing Filter",
            "path1": {
              "name": "Filter Enabled AND Wall is Non-Load-Bearing",
              "steps": [
                "Erase instance",
                "Terminate script"
              ]
            },
            "path2": {
              "name": "Filter Disabled OR Wall is Load-Bearing",
              "steps": [
                "Proceed to Geometry Extraction"
              ]
            }
          },
          {
            "condition": "Text Content Priority",
            "path1": {
              "name": "Custom Description exists",
              "steps": [
                "Display Custom Description"
              ]
            },
            "path2": {
              "name": "No Custom Description, SF Description exists",
              "steps": [
                "Display SF Description"
              ]
            },
            "path3": {
              "name": "No Descriptions, Style Name exists",
              "steps": [
                "Display Style Name"
              ]
            },
            "path4": {
              "name": "No Info Available",
              "steps": [
                "Display 'No stylename or description available'"
              ]
            }
          },
          {
            "condition": "Alignment Setting",
            "path1": {
              "name": "Horizontal (nAlignment == 0)",
              "steps": [
                "Set Read X to World X",
                "Set Read Y to World Y",
                "Anchor point based on World Coords"
              ]
            },
            "path2": {
              "name": "Free to rotate (nAlignment == 1)",
              "steps": [
                "Calculate Read X based on Opening Direction relative to World X",
                "Calculate Read Y rotated 90 deg from Read X",
                "Anchor point relative to Opening"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Selection",
            "errorMessage": "(None - Silent failure)",
            "recovery": "Script exits cleanly if the user cancels or selects nothing."
          },
          {
            "check": "OpeningSF Integrity",
            "errorMessage": "(None - Silent skip)",
            "recovery": "Invalid or deleted openings in the selection set are skipped during the insertion loop."
          },
          {
            "check": "Parent Element Integrity",
            "errorMessage": "(None - Silent skip)",
            "recovery": "If a selected opening has no valid parent wall/element, it is skipped."
          },
          {
            "check": "Load Bearing Status",
            "errorMessage": "(None - Silent erasure)",
            "recovery": "If the property 'Exclude non load bearing walls' is Yes, the instance self-destructs if attached to a non-load-bearing wall."
          },
          {
            "check": "Text Content",
            "errorMessage": "(None - Default Text)",
            "recovery": "If no style, description, or custom text is found, the script displays 'No stylename or description available' instead of an empty string."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Appearance Settings",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing 'Tag color', 'PLine color', 'Dimstyle', 'Offset', or toggles like 'Display PLine' or 'Display line' immediately updates the graphics."
          },
          {
            "action": "Change Text Content Logic",
            "how": "Editing the Source Entity (Wall/Opening) properties in hsbCAD",
            "effect": "Updating the 'Description' or 'Style Name' on the actual OpeningSF or Element automatically updates the text displayed by the tag upon recalculation."
          },
          {
            "action": "Relocate Tag",
            "how": "Grip Edit",
            "effect": "If 'Tag orientation' is set to 'Free to rotate and relocate', moving the grips (_PtG) allows repositioning the text and leader line manually. The text alignment remains locked to the calculated vectors unless the script code allows full transformation (based on vReadX/Y logic, the script seems to calculate these dynamically, but grips allow point movement)."
          },
          {
            "action": "Update Geometry",
            "how": "Modify Wall or Opening Geometry",
            "effect": "Because dependencies are set (setDependencyOnEntity), any change to the wall or opening size triggers a recalculation, moving the tag to the new correct position."
          }
        ]
      },
      "tokens_used": 9632,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_OPENING_SHOW_TAG_MS\n\n## Overview\nThis script creates customizable annotation tags in Model Space for wall openings. It displays information such as the Style Name or Description, with optional graphical elements like leader lines, bounding boxes, and opening outlines.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script is designed specifically for Model Space usage. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | Not intended for use within hsbCAD Shop Drawings. |\n\n## Prerequisites\n- **Required Entities**: Wall Openings (OpeningSF) belonging to Wall Elements (ElementWall).\n- **Minimum beam count**: 0.\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse to the script location and select `GE_OPENING_SHOW_TAG_MS.mcr`.\n\n### Step 2: Select Openings\n```\nCommand Line: Select openings\nAction: Click on the wall openings (windows or doors) you wish to tag. Press Enter to confirm selection.\n```\n\n### Step 3: Configure Initial Settings (Optional)\nAction: A properties dialog may appear automatically upon insertion. You can configure the tag color, offset, and visibility settings here, or change them later in the Properties Palette.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Tag color | number | 1 | Sets the AutoCAD color index (1-255) for the text label. |\n| Dimstyle | dropdown | - | Selects the dimension style to determine text font and height. |\n| Offset from wall outline | number | 10 | Distance (in mm) the tag is placed away from the wall face. |\n| Show opening outline | dropdown | Yes | If \"Yes\", draws a polyline representing the exact shape of the opening on the wall. |\n| Exclude non load bearing walls | dropdown | Yes | If \"Yes\", tags are **NOT** created on non-load-bearing walls. If \"No\", tags are created on all selected walls. |\n| Display line pointing to opening | dropdown | Yes | If \"Yes\", draws a leader line connecting the tag to the center of the opening. |\n| Display PLine | dropdown | Yes | If \"Yes\", draws a rectangular border box around the text. |\n| PLine color | number | 6 | Sets the AutoCAD color index for the rectangle border. |\n| Show in display representation | text | - | Specifies the Display Representation (e.g., 'Reflected') where the tag is visible. Leave empty for standard Model Space visibility. |\n| Tag orientation | dropdown | Horizontal | Sets the text alignment. \"Horizontal\" aligns with World X/Y. \"Free to rotate and relocate\" aligns with the wall and allows manual grip editing. |\n| Visible on top view only | dropdown | No | If \"Yes\", the tag is hidden in 3D views, elevations, and sections, only visible in Top/Plan views. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific context menu options are added by this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not require external settings files.\n\n## Tips\n- **Text Content Priority**: The script displays text based on this priority:\n    1. Custom Description (if available).\n    2. SF Description (if available).\n    3. Style Name.\n    4. \"No stylename or description available\" (if none of the above exist).\n- **Adjusting Text Size**: Change the `Dimstyle` property to a different style defined in your CAD template to globally change text size and font.\n- **Manual Relocation**: If you need to move a tag manually, set the `Tag orientation` property to \"Free to rotate and relocate\". You can then use the grip points to drag the tag to a new position.\n- **Performance**: Use the \"Exclude non load bearing walls\" and \"Visible on top view only\" options to keep your 3D model views clean and uncluttered.\n\n## FAQ\n- **Q: Why did the tag disappear after I changed a wall property?**\n  A: The script updates automatically. If you changed the wall to \"Non-load-bearing\" and the property \"Exclude non load bearing walls\" is set to \"Yes\", the tag will remove itself.\n- **Q: Can I use this in my Section/Elevation views?**\n  A: By default, yes. However, if you want to hide these tags in sections to reduce clutter, set the \"Visible on top view only\" property to \"Yes\".\n- **Q: The text is too small to read.**\n  A: Select the tag and change the `Dimstyle` property to a dimension style that uses a larger text height."
      },
      "tokens_used": 7741,
      "error": null
    }
  }
}