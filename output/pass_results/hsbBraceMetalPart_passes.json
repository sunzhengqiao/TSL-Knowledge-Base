{
  "filename": "hsbBraceMetalPart.mcr",
  "status": "completed",
  "total_tokens": 46420,
  "processing_time": 175.89281153678894,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "Creates a brace metalpart for 2 beams",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "27ene2019",
            "author": "david.rueda@hsbcad.com",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8747,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates 3D solid bodies (Body bdDrill, Body bdPlate) and hardware (HardWrComp) based on 3D vector calculations relative to selected beams. It uses PrEntity and PrPoint for user interaction, which are standard for Model Space insertion logic. No sd_* prefix, Viewport, or #Type E patterns found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space with at least 2 existing perpendicular beams.",
          "requiredSettings": []
        }
      },
      "tokens_used": 7070,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "T(\"|Select 2 perpendicular beam(s)|\")",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrPoint",
              "promptOriginal": "T(\"|Select location|\")",
              "condition": "_bOnInsert && nRegions > 1",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dSize",
            "type": "PropDouble",
            "displayName": "T(\"|Size|\")",
            "defaultValue": "U(600)",
            "inputType": "number",
            "options": [],
            "category": "T(\"|General|\")",
            "description": "T(\"|Defines the Size|\")"
          },
          {
            "index": 0,
            "variable": "sMaker",
            "type": "PropString",
            "displayName": "T(\"|Maker|\")",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "T(\"|General|\")",
            "description": "T(\"|Defines the Maker|\")"
          },
          {
            "index": 1,
            "variable": "sProductName",
            "type": "PropString",
            "displayName": "T(\"|Product Name|\")",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "T(\"|General|\")",
            "description": "T(\"|Defines the Product Name|\")"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9586,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a diagonal brace metal part connection (typically a hanger or angle brace) between two perpendicular timber beams.",
          "category": "Hardware",
          "typicalUseCase": "Reinforcing the junction of two perpendicular beams (e.g., post-to-beam or beam-to-beam connections) where a diagonal structural brace is required for stability."
        },
        "parameters": [
          {
            "name": "dSize",
            "technicalDefault": "U(600)",
            "businessMeaning": "The nominal size or length of the diagonal brace metal part.",
            "validRange": "200 mm - 2000 mm (Typically matches standard timber depths or required spans)",
            "unit": "mm",
            "affectsOutput": "Scales the length of the diagonal brace geometry and determines the offset position of the base plates on the beams. It updates the X-scale of the hardware component."
          },
          {
            "name": "sMaker",
            "technicalDefault": "\"\"",
            "businessMeaning": "The manufacturer or supplier of the metal brace component.",
            "validRange": "Text string (e.g., 'Simpson', 'MiTek')",
            "unit": "text",
            "affectsOutput": "Updates the 'Manufacturer' property of the hardware component and contributes to the Article Number in BOMs."
          },
          {
            "name": "sProductName",
            "technicalDefault": "\"\"",
            "businessMeaning": "The specific product model or commercial name of the brace.",
            "validRange": "Text string (e.g., 'H2.5A', 'UBR-600')",
            "unit": "text",
            "affectsOutput": "Updates the 'Name' property of the hardware component and contributes to the Article Number for production lists."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User changes dSize",
            "effect": "The geometry of the diagonal brace body (bdDrill, bdDrillComb) is recalculated to stretch or shrink, and the position of the base plates (bdPlate0, bdPlate1) shifts along the beams to accommodate the new size.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Drill/Machining (Body Representation)",
            "description": "A cylindrical body representing the diagonal brace volume, used to visualize the part and potentially subtract from timber.",
            "appliedTo": "N/A (Visual/Material representation)"
          },
          {
            "type": "Metal Plate (Body Representation)",
            "description": "Rectangular plates generated at the connection points on both beams, representing the flanges or feet of the brace.",
            "appliedTo": "Beam 0 and Beam 1"
          },
          {
            "type": "Hardware Component (BOM)",
            "description": "Logical data attached to the element for reporting in lists and exports, utilizing Maker, Product Name, and Dimensions.",
            "appliedTo": "Element associated with the selected beams"
          }
        ]
      },
      "tokens_used": 7397,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch / Insertion",
          "Check for multiple insert cycles (erase if cycle > 1)",
          "Check execution key or debug mode (Load properties from catalog or show dialog)",
          "Prompt user to select 2 perpendicular beams",
          "Validate selection: Exactly 2 beams?",
          "Validate geometry: Beams perpendicular?",
          "Calculate beam intersection and axis directions (vecX0, vecX1)",
          "Generate shadow profiles of beams on intersection plane",
          "Determine valid regions for brace placement (Up to 4 quadrants: A-A, A-B, B-A, B-B)",
          "Count valid regions found",
          "Prompt user for location if multiple valid regions exist (PrPoint)",
          "Determine placement quadrant and calculate brace position",
          "Validate that selected point lies within a valid region",
          "Generate geometry: Diagonal body (Drill) and Base plates",
          "Create/Update Hardware Component (HardWrComp) with Maker, Product Name, and Size",
          "Visualize geometry (Body.draw) and finish"
        ],
        "conditionalBranches": [
          {
            "condition": "Number of Beams Selected",
            "path1": {
              "name": "Valid (2 Beams)",
              "steps": [
                "Proceed to perpendicular check",
                "Calculate intersection",
                "Continue to generation"
              ]
            },
            "path2": {
              "name": "Invalid (Not 2 Beams)",
              "steps": [
                "Report Error: 'wrong number of selected beams'",
                "Continue selection loop"
              ]
            }
          },
          {
            "condition": "Beam Orientation",
            "path1": {
              "name": "Perpendicular",
              "steps": [
                "Calculate Intersection",
                "Define Regions",
                "Prompt Location (if needed)"
              ]
            },
            "path2": {
              "name": "Not Perpendicular",
              "steps": [
                "Report Error: 'beams are not perpendicular'",
                "Continue selection loop"
              ]
            }
          },
          {
            "condition": "Number of Valid Placement Regions",
            "path1": {
              "name": "Single Region",
              "steps": [
                "Automatically calculate reference point (midpoint)",
                "Skip location prompt"
              ]
            },
            "path2": {
              "name": "Multiple Regions (>1)",
              "steps": [
                "Prompt user to pick specific location (PrPoint)",
                "Validate selected region"
              ]
            }
          },
          {
            "condition": "Location Validity",
            "path1": {
              "name": "Valid Region Selected",
              "steps": [
                "Calculate brace coordinates (pt0, pt1)",
                "Generate Solid Bodies and Hardware"
              ]
            },
            "path2": {
              "name": "Invalid Region Selected",
              "steps": [
                "Report Error: 'cannot be placed in this location'",
                "Erase Instance",
                "Abort Insertion"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Selection Count",
            "errorMessage": "wrong number of selected beams (2 are needed)",
            "recovery": "Select exactly 2 beams and try again."
          },
          {
            "check": "Perpendicularity",
            "errorMessage": "beams are not perpendicular",
            "recovery": "Select two beams that form a 90-degree angle."
          },
          {
            "check": "Spatial Placement",
            "errorMessage": "cannot be placed in this location",
            "recovery": "Select a different point within the highlighted valid region/quadrant."
          },
          {
            "check": "Beam Intersection",
            "errorMessage": "(Implicit - Script erases instance if lines don't intersect)",
            "recovery": "Ensure beams physically overlap or cross in 3D space."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Resize Brace (Size)",
            "how": "OPM Property Palette (Change 'Size' value)",
            "effect": "Recalculates `dOffset`, moves base plates (pt0, pt1), updates body length, and updates Hardware Scale X."
          },
          {
            "action": "Update Product Info",
            "how": "OPM Property Palette (Change 'Maker' or 'Product Name')",
            "effect": "Updates the Hardware Component Article Number, Manufacturer, and Name properties for BOMs."
          },
          {
            "action": "Move Script Instance",
            "how": "Standard CAD Move/Grip Edit",
            "effect": "Re-calculates geometry relative to new position on beams (though script primarily relies on initial beam attachment)."
          }
        ]
      },
      "tokens_used": 8767,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbBraceMetalPart.mcr\n\n## Overview\nThis script generates a diagonal brace metal part connection between two perpendicular timber beams. It creates the physical representation (plates and diagonal volume) and assigns hardware properties for BOMs.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script calculates 3D geometry based on beam intersections. |\n| Paper Space | No | Not designed for 2D detailing layouts. |\n| Shop Drawing | No | Model space insertion only. |\n\n## Prerequisites\n- **Required Entities**: 2 Timber Beams.\n- **Minimum Beam Count**: 2 beams must be selected.\n- **Configuration**: The two beams must be perpendicular (90 degrees) and physically intersect in 3D space.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbBraceMetalPart.mcr`\n\n### Step 2: Select Beams\n```\nCommand Line: Select 2 perpendicular beam(s)\nAction: Click on the first beam, then click on the second beam.\n```\n\n### Step 3: Select Location (If Required)\n```\nCommand Line: Select location\nAction: If there are multiple valid quadrants around the beam intersection, click in the desired area to place the brace. If only one valid placement exists, this step is skipped automatically.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Size | Number | 600 mm | Defines the length/size of the diagonal brace metal part. Updates geometry and hardware scale. |\n| Maker | Text | (Empty) | Defines the Manufacturer name (e.g., \"Simpson\", \"MiTek\"). Used for BOM reporting. |\n| Product Name | Text | (Empty) | Defines the specific Product Name or model code. Used for BOM reporting. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None defined | This script does not add specific items to the right-click context menu. Use the Properties Palette to modify settings. |\n\n## Settings Files\n- **Filename**: None required\n- **Location**: N/A\n- **Purpose**: This script operates independently without external settings files.\n\n## Tips\n- **Beam Intersection**: Ensure your beams actually cross each other in the 3D model. If they just touch at corners or miss each other slightly, the script may fail.\n- **Perpendicularity**: The script strictly checks for 90-degree angles. If you receive a \"beams are not perpendicular\" error, check your beam rotations in the model.\n- **Adjusting Size**: After insertion, you can select the generated brace and simply type a new value in the \"Size\" field in the Properties palette (Ctrl+1) to lengthen or shorten the brace without re-inserting.\n\n## FAQ\n- **Q: Why does the command fail saying \"wrong number of selected beams\"?**\n  - A: You must select exactly two beams. If you pre-selected more or fewer than two before running the command, or if you clicked the same beam twice, it will error.\n- **Q: The script runs but then disappears immediately.**\n  - A: This usually happens if the selected point for location falls outside a valid region (e.g., you clicked too far from the intersection) or if the beams do not actually intersect. Try picking a point closer to where the beams cross.\n- **Q: How do I get the brace to show up in my Material List?**\n  - A: Ensure you fill in the \"Maker\" and \"Product Name\" fields in the Properties Palette after insertion. These fields link the visual part to the BOM data."
      },
      "tokens_used": 4853,
      "error": null
    }
  }
}