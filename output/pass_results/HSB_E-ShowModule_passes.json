{
  "filename": "HSB_E-ShowModule.mcr",
  "status": "completed",
  "total_tokens": 41962,
  "processing_time": 292.9811282157898,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "Description",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "22-06-2018",
            "author": "RP",
            "changes": "Pilot version."
          },
          {
            "version": "1.01",
            "date": "18-07-2018",
            "author": "RP",
            "changes": "Set display on elemzone"
          },
          {
            "version": "1.02",
            "date": "19-07-2018",
            "author": "RP",
            "changes": "Set display to only do hatch"
          },
          {
            "version": "1.03",
            "date": "15-10-2018",
            "author": "RP",
            "changes": "Show text always in device view and only in z of element"
          },
          {
            "version": "1.04",
            "date": "05-04-2019",
            "author": "RVW",
            "changes": "Make text movable by using _PtG"
          },
          {
            "version": "1.05",
            "date": "22-08-2019",
            "author": "RVW",
            "changes": "Add option to show module name yes/no. And add option to assign the hatching to a certain zone."
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "HSB_G-FilterEntities"
        ]
      },
      "tokens_used": 6311,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates on Element and GenBeam entities found in the 3D model. It calculates geometry using GenBeam.realBody() and PlaneProfile to draw hatching and text in 3D space. Visibility is controlled via elemZone (Element Display Zones), which is used to manage visibility in 3D model views (e.g., device view vs. detailed view). There are no references to Viewports, Sheets, or 2D layout generation functions typical of ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be inserted into an Element in Model Space.",
          "requiredSettings": []
        }
      },
      "tokens_used": 5989,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select element(s)",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select entity(s)",
              "condition": "_kExecuteKey == \"Add GenBeams\"",
              "required": false
            },
            {
              "step": 3,
              "function": "PrEntity",
              "promptOriginal": "Select entity(s)",
              "condition": "_kExecuteKey == \"Remove GenBeams\"",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "_bOnInsert (if no execute key)",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dimStyle",
            "type": "PropString",
            "displayName": "Dimension style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": "General",
            "description": "Set the dimstyle for the module name text"
          },
          {
            "index": 0,
            "variable": "bodyColor",
            "type": "PropInt",
            "displayName": "Body Color",
            "defaultValue": 2,
            "inputType": "number",
            "options": null,
            "category": "General",
            "description": "Set the color of the body visualisation"
          },
          {
            "index": 1,
            "variable": "nameColor",
            "type": "PropInt",
            "displayName": "Name Color",
            "defaultValue": -1,
            "inputType": "number",
            "options": null,
            "category": "General",
            "description": "Set the color of the module text"
          },
          {
            "index": 2,
            "variable": "hatchColor",
            "type": "PropInt",
            "displayName": "Hatch Color",
            "defaultValue": -1,
            "inputType": "number",
            "options": null,
            "category": "General",
            "description": "Set the color of the module hatch"
          },
          {
            "index": 3,
            "variable": "sShowModuleName",
            "type": "PropString",
            "displayName": "Show module name",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "General",
            "description": "Select to show the module name Yes / No"
          },
          {
            "index": 1,
            "variable": "moduleName",
            "type": "PropString",
            "displayName": "Module name",
            "defaultValue": "Auto",
            "inputType": "text",
            "options": null,
            "category": "General",
            "description": "Set the module name"
          },
          {
            "index": 2,
            "variable": "hatchPattern",
            "type": "PropString",
            "displayName": "Module hatch",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "_HatchPatterns",
            "category": "General",
            "description": "Set the module hatch pattern"
          },
          {
            "index": 0,
            "variable": "patternScale",
            "type": "PropDouble",
            "displayName": "Hatch scale",
            "defaultValue": 1,
            "inputType": "number",
            "options": null,
            "category": "General",
            "description": "Set the module hatch scale"
          },
          {
            "index": 3,
            "variable": "hatchZone",
            "type": "PropInt",
            "displayName": "Show hatch in zone",
            "defaultValue": 8,
            "inputType": "dropdown",
            "options": [
              0,
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10
            ],
            "category": "General",
            "description": "Set the zone for the hatch to show"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Add GenBeams",
            "handler": "Add GenBeams",
            "action": "Prompt user to select GenBeams to add to the current module instance.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Remove GenBeams",
            "handler": "Remove GenBeams",
            "action": "Prompt user to select GenBeams to remove from the current module instance.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Remove all GenBeams",
            "handler": "Remove all GenBeams",
            "action": "Clear all GenBeams from the current module instance.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 6565,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates visual identifiers (hatching and text labels) for specific groups of timber beams (modules) within the 3D model to distinguish assembly or delivery packages.",
          "category": "Visualization/Modeling",
          "typicalUseCase": "Used during design or detailing to graphically highlight and label specific assemblies (e.g., 'Module A') in the 3D model, often for production planning or site logistics."
        },
        "parameters": [
          {
            "name": "dimStyle",
            "technicalDefault": "\"\"",
            "businessMeaning": "Defines the text style (font, size) used for the module label in the model views.",
            "validRange": "Any standard dimension style name available in the drawing.",
            "unit": "String (Style Name)",
            "affectsOutput": "Changes the font and height of the module name text."
          },
          {
            "name": "bodyColor",
            "technicalDefault": "2",
            "businessMeaning": "Sets the color used for the solid body visualization of the selected beams.",
            "validRange": "0-255 (AutoCAD Color Index), -1 for ByBlock.",
            "unit": "Integer",
            "affectsOutput": "Visual color of the beam bodies in the module."
          },
          {
            "name": "nameColor",
            "technicalDefault": "-1",
            "businessMeaning": "Determines the color of the text label displaying the module name.",
            "validRange": "0-255 (AutoCAD Color Index), -1 for ByBlock.",
            "unit": "Integer",
            "affectsOutput": "Visual color of the module name text."
          },
          {
            "name": "hatchColor",
            "technicalDefault": "-1",
            "businessMeaning": "Sets the color of the hatch pattern applied over the module.",
            "validRange": "0-255 (AutoCAD Color Index), -1 for ByBlock.",
            "unit": "Integer",
            "affectsOutput": "Visual color of the hatch overlay."
          },
          {
            "name": "sShowModuleName",
            "technicalDefault": "\"Yes\"",
            "businessMeaning": "Toggle to show or hide the text label of the module name.",
            "validRange": "\"Yes\", \"No\"",
            "unit": "String",
            "affectsOutput": "Visibility of the module name text label."
          },
          {
            "name": "moduleName",
            "technicalDefault": "\"Auto\"",
            "businessMeaning": "The identifier for the module group. If set to 'Auto', it reads the name from the assigned beams; otherwise, it overrides the beam module names.",
            "validRange": "Alphanumeric string.",
            "unit": "String",
            "affectsOutput": "Updates the text label content and the 'Module' property of linked GenBeams."
          },
          {
            "name": "hatchPattern",
            "technicalDefault": "\"\"",
            "businessMeaning": "Selects the graphic pattern (e.g., solid, lines, dots) used to fill the module area.",
            "validRange": "Available pattern names in _HatchPatterns.",
            "unit": "String",
            "affectsOutput": "Texture/style of the surface hatch drawn on the module."
          },
          {
            "name": "patternScale",
            "technicalDefault": "1.0",
            "businessMeaning": "Adjusts the density or size of the hatch pattern.",
            "validRange": "> 0 (e.g., 0.5 for dense, 2.0 for sparse).",
            "unit": "Scale Factor",
            "affectsOutput": "Scale of the hatch pattern repetition."
          },
          {
            "name": "hatchZone",
            "technicalDefault": "8",
            "businessMeaning": "Assigns the graphics to a specific Element Display Zone (e.g., Device view, specific floor plan), controlling when they are visible.",
            "validRange": "0 to 10 (Maps to display zones 0-5 and -1 to -5).",
            "unit": "Integer",
            "affectsOutput": "Visibility of the hatch and text depending on the current view's active zones."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sShowModuleName is \"No\"",
            "effect": "The text label is suppressed, regardless of the moduleName value.",
            "cascade": []
          },
          {
            "trigger": "hatchZone is changed",
            "effect": "Both the hatch pattern and the text label are assigned to the new visibility zone.",
            "cascade": []
          },
          {
            "trigger": "moduleName is changed",
            "effect": "The linked GenBeams have their 'Module' property updated to match the new name.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "HatchProfile",
            "description": "A 2D graphic pattern projected onto the top surface of the collective beams in the module.",
            "appliedTo": "The group of GenBeams assigned to the script."
          },
          {
            "type": "Text",
            "description": "A 3D text label placed at the calculated center of the module beams.",
            "appliedTo": "Model Space (relative to element coordinates)."
          }
        ]
      },
      "tokens_used": 7384,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Start: Initialize properties (Styles, Colors, Hatch settings, Zones).",
          "Insertion Cycle Check: If insertCycleCount > 1, erase instance and exit to prevent duplicates.",
          "Property Loading: If an Execute Key is present, load properties from the corresponding Catalog entry. If not, show the Properties Palette (Dialog).",
          "Element Selection: User prompted to select Element(s) from the drawing.",
          "Module Analysis: Script scans all GenBeams within the selected Element(s) to identify unique values in the 'Module' property.",
          "Batch Cloning: For each unique Module name found, the script clones itself, attaching the new instance specifically to the GenBeams belonging to that module.",
          "Original Cleanup: The initial 'host' instance is erased, leaving only the cloned instances running.",
          "Execution (Cloned Instances):",
          "  - Verify Element reference exists; erase instance if missing.",
          "  - Handle Context Menu triggers (Add/Remove GenBeams).",
          "  - Sync GenBeam 'Module' property to match the script's 'moduleName' property.",
          "  - Calculate Geometry: Determine top profile of beams for hatching and average center point for text.",
          "  - Draw Hatch: Apply hatch pattern to calculated profiles in the designated Element Zone.",
          "  - Draw Text: If enabled, place module name label at calculated location in the designated Element Zone."
        ],
        "conditionalBranches": [
          {
            "condition": "User Interaction with GenBeams (Post-Insertion)",
            "path1": {
              "name": "Add GenBeams Triggered",
              "steps": [
                "Prompt user to select GenBeams.",
                "Filter selected beams not already in list.",
                "Append beams to internal _GenBeam list.",
                "Set 'Module' property of new beams to script's moduleName."
              ]
            },
            "path2": {
              "name": "Remove GenBeams Triggered",
              "steps": [
                "Prompt user to select GenBeams.",
                "Find selected beams in internal _GenBeam list.",
                "Remove beams from list.",
                "Clear 'Module' property of removed beams."
              ]
            },
            "path3": {
              "name": "Remove all GenBeams Triggered",
              "steps": [
                "Iterate through all beams in internal _GenBeam list.",
                "Clear 'Module' property.",
                "Empty internal _GenBeam list."
              ]
            }
          },
          {
            "condition": "Show Module Name Property",
            "path1": {
              "name": "Yes",
              "steps": [
                "Create Display object for text.",
                "Draw moduleName at point _PtG."
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skip text generation logic."
              ]
            }
          },
          {
            "condition": "Instance Creation (Insertion Phase)",
            "path1": {
              "name": "First Insertion",
              "steps": [
                "Proceed with property loading.",
                "Execute Element selection.",
                "Perform cloning logic."
              ]
            },
            "path2": {
              "name": "Subsequent Insertion (Cycle > 1)",
              "steps": [
                "Erase instance.",
                "Exit script."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Reference",
            "errorMessage": "Element reference not found.",
            "recovery": "Script executes eraseInstance() and terminates."
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Silent failure).",
            "recovery": "Script detects insertCycleCount() > 1, erases itself, and returns immediately to prevent recursive or duplicate cloning."
          },
          {
            "check": "GenBeam Validity",
            "errorMessage": "None (Silent).",
            "recovery": "Script checks genBeam.bIsValid() inside the processing loop. If false, it uses 'continue' to skip that specific beam without failing the script."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Module Name",
            "how": "OPM Property Palette (Module name)",
            "effect": "Updates the text label in the model and immediately updates the 'Module' property of all GenBeams linked to this script instance."
          },
          {
            "action": "Adjust Visualization",
            "how": "OPM Property Palette (Colors, Hatch Pattern, Scale, Zone, DimStyle)",
            "effect": "Regenerates the hatch and text display immediately with new visual settings."
          },
          {
            "action": "Toggle Label Visibility",
            "how": "OPM Property Palette (Show module name)",
            "effect": "Shows or hides the text label in the model view."
          },
          {
            "action": "Move Label Position",
            "how": "Grip Edit (Drag Point _PtG)",
            "effect": "Relocates the text label to the user-defined position."
          },
          {
            "action": "Modify Assembly Composition",
            "how": "Right-click Context Menu (Add GenBeams / Remove GenBeams / Remove all GenBeams)",
            "effect": "Allows dynamic addition or removal of GenBeams from the module group, updating their properties accordingly."
          }
        ]
      },
      "tokens_used": 8524,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-ShowModule\n\n## Overview\nCreates visual identifiers (hatching and text labels) for specific groups of timber beams (modules) within the 3D model. It is used to graphically highlight and label assembly or delivery packages for production planning or site logistics.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model environment. |\n| Paper Space | No | |\n| Shop Drawing | No | Not intended for generating 2D layout views. |\n\n## Prerequisites\n- **Required entities**: An `Element` containing `GenBeams`.\n- **Minimum beam count**: 0 (The script scans elements for beams with assigned \"Module\" names).\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_E-ShowModule.mcr`\n\n### Step 2: Select Element\n```\nCommand Line: Select element(s)\nAction: Click on the construction Element(s) in the model that contain the beams you want to visualize.\n```\n\n### Step 3: Configure Properties\n```\nAction: The Properties Palette will appear automatically. Adjust settings like Module Name, Colors, or Hatch Pattern if desired.\nNote: The script will automatically detect beams with unique \"Module\" property values and create a visualization for each group.\n```\n\n### Step 4: Position Label (Optional)\n```\nAction: Click and drag the blue grip point (square) on the text label to reposition it within the module.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimension style | dropdown | (current) | Sets the text style (font/size) for the module label. |\n| Body Color | number | 2 | Sets the color of the solid body visualization of the selected beams. |\n| Name Color | number | -1 | Sets the color of the module name text (-1 = ByBlock). |\n| Hatch Color | number | -1 | Sets the color of the hatch pattern (-1 = ByBlock). |\n| Show module name | dropdown | Yes | Toggles the visibility of the module name text label (Yes/No). |\n| Module name | text | Auto | The identifier for the group. \"Auto\" uses the name from the beams; otherwise, it overrides them. |\n| Module hatch | dropdown | (current) | Selects the graphic pattern used to fill the module area. |\n| Hatch scale | number | 1.0 | Adjusts the density or size of the hatch pattern. |\n| Show hatch in zone | dropdown | 8 | Sets the Element Display Zone (0-10) where the hatch and text are visible. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add GenBeams | Prompts you to select beams in the model to add to the current module visualization. |\n| Remove GenBeams | Prompts you to select beams currently in the module to remove them from the group. |\n| Remove all GenBeams | Removes all beams from the module instance, clearing the visualization. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on standard AutoCAD dimension styles and hatch patterns available in the current drawing.\n\n## Tips\n- **Grip Edit**: You can move the text label to a clearer location by clicking and dragging the blue square grip point (_PtG) displayed in the model.\n- **Auto-Naming**: Keep the \"Module name\" property set to \"Auto\" to let the script read and display the names already assigned to your beams.\n- **View Control**: Use the \"Show hatch in zone\" property to hide the module labels in detailed views while keeping them visible in device or assembly views (e.g., Zone 8).\n- **Batch Processing**: When you insert the script, it scans the entire selected Element and automatically creates separate visual instances for every unique \"Module\" name found on the beams.\n\n## FAQ\n- **Q: Why did the script seem to disappear after I selected an element?**\n  **A:** The script automatically clones itself for every unique module name found in the element. The original \"host\" instance is erased, leaving only the specific visualizations for the modules found.\n  \n- **Q: How do I change the name of a module?**\n  **A:** Select the module visualization (hatch or text), open the Properties Palette, and change the \"Module name\" field. This will update the text label and the \"Module\" property on all linked beams.\n  \n- **Q: The text label is in the wrong spot. How do I fix it?**\n  **A:** Select the module entity, click the blue square grip point on the text, and drag it to the desired position."
      },
      "tokens_used": 7189,
      "error": null
    }
  }
}