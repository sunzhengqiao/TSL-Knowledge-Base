{
  "filename": "hsbPanelWalllRabbet.mcr",
  "status": "completed",
  "total_tokens": 37785,
  "processing_time": 202.01772570610046,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "19.05.2010",
            "author": "th@hsbCAD.de",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6492,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of `_kModelSpace` in `tslNew.dbCreate(..., _kModelSpace, mapTsl)`. The script performs physical modifications to 3D geometry using methods like `dbSplit`, `dbJoin`, `stretchEdgeTo`, and `addTool(BeamCut)`, which are operations exclusive to the 3D model environment. There is no usage of `_Viewport`, `_kPaperSpace`, or shop drawing specific prefixes like `sd_`."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Sip"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 4663,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && _kExecuteKey == \"\"",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getElement",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Insertion (if no execute key is provided)",
            "title": null,
            "dataSource": "Script Properties (PropDouble, PropString)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": "50",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "|Depth|",
            "defaultValue": "30",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dGapWidth1",
            "type": "PropDouble",
            "displayName": "|Gap| |reference side|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dGapDepth",
            "type": "PropDouble",
            "displayName": "|Gap| |Depth|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dGapWidth2",
            "type": "PropDouble",
            "displayName": "|Gap| |opposite side|",
            "defaultValue": "5",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sSide",
            "type": "PropString",
            "displayName": "|Side|",
            "defaultValue": "|reference side|",
            "inputType": "dropdown",
            "options": [
              "|reference side|",
              "|opposite side|"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Join| + |Erase|",
            "handler": "|Join| + |Erase|",
            "action": "Joins the connected panels (sip[0] and sip[1]) and erases the tool instance.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 5353,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a lap joint (rabbet) between wall-based structural insulated panels (SIPs) by splitting a wall element and machining the edges to overlap.",
          "category": "Framing/Joinery",
          "typicalUseCase": "Joining two wall panels together where a strong interlocking edge is required, or creating a spline/rebate connection to ensure structural continuity and weather tightness."
        },
        "parameters": [
          {
            "name": "dWidth",
            "technicalDefault": "50",
            "businessMeaning": "The depth of the rabbet cut perpendicular to the wall face (thickness of the overlap material).",
            "validRange": "0 to Panel Thickness",
            "unit": "mm",
            "affectsOutput": "Determines how deep the notch is cut into the panel material relative to the split plane. Controls the remaining material thickness of the 'tongue'."
          },
          {
            "name": "dDepth",
            "technicalDefault": "30",
            "businessMeaning": "The length of the rabbet cut along the wall edge.",
            "validRange": "0 to Panel Length",
            "unit": "mm",
            "affectsOutput": "Defines the longitudinal dimension of the overlapping section of the joint."
          },
          {
            "name": "dGapWidth1",
            "technicalDefault": "0",
            "businessMeaning": "Expansion or play gap on the reference side of the split line.",
            "validRange": "0 to 20 (Typically 0-5)",
            "unit": "mm",
            "affectsOutput": "Offsets the start of the rabbet cut away from the split plane on the reference panel, allowing for tolerance or insulation material."
          },
          {
            "name": "dGapDepth",
            "technicalDefault": "0",
            "businessMeaning": "Expansion or play gap along the depth of the cut.",
            "validRange": "0 to 20",
            "unit": "mm",
            "affectsOutput": "Reduces the effective length of the cut to prevent material binding at the inner corner of the rabbet."
          },
          {
            "name": "dGapWidth2",
            "technicalDefault": "5",
            "businessMeaning": "Expansion or play gap on the opposite side of the split line.",
            "validRange": "0 to 20 (Typically 0-5)",
            "unit": "mm",
            "affectsOutput": "Offsets the start of the rabbet cut away from the split plane on the opposite panel."
          },
          {
            "name": "sSide",
            "technicalDefault": "|reference side|",
            "businessMeaning": "Determines which panel receives the specific cut geometry relative to the wall orientation.",
            "validRange": "Reference side / Opposite side",
            "unit": "enum",
            "affectsOutput": "Swaps the values of GapWidth1 and GapWidth2 and flips the machining vectors to apply the cuts to the correct panel."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sSide changed to '|opposite side|'",
            "effect": "Swaps the effective application of dGapWidth1 and dGapWidth2 and inverts the cutting direction.",
            "cascade": [
              "dGapWidth1",
              "dGapWidth2"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Sip (Structural Insulated Panel)",
            "description": "The original element is split into two distinct panels if it was initially a single element.",
            "appliedTo": "Selected Wall Element"
          },
          {
            "type": "BeamCut",
            "description": "Machining operation that removes material to create the rabbet shape (L-shape) on the panel edges.",
            "appliedTo": "Split Panels (Sip[0] and Sip[1])"
          },
          {
            "type": "Cut",
            "description": "Additional trimming operation applied to the second panel to finish the joint geometry.",
            "appliedTo": "Sip[1]"
          }
        ]
      },
      "tokens_used": 7822,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User starts script (hsbPanelWalllRabbet.mcr).",
          "Insertion Phase: Script checks if it's a fresh insert (_bOnInsert).",
          "Dialog Phase: If no Execute Key (catalog entry) is provided, the ShowDynamicDialog appears for user input (Width, Depth, Gaps, Side). If an Execute Key is provided, properties are loaded automatically.",
          "Input Phase: User selects a split location point (_Pt0).",
          "Selection Phase: User selects a wall Element.",
          "Mode Initialization: Script checks the internal 'mode' map value (default 0).",
          "Element Split Mode (Mode 0): Script identifies the Element and Sip(s) at the split location.",
          "Splitting Logic: The script splits the found Sip using a defined Plane at _Pt0. This creates two new panels (SipSplit).",
          "Instance Cloning: The original script instance erases itself and creates a new, dependent script instance (Mode 1) linked to the two split panels.",
          "Sip Tool Mode (Mode 1): The new instance validates it has 2 associated Sip entities.",
          "Geometry Generation: The script calculates the rabbet geometry (BeamCuts and Cuts) based on properties (Width, Depth, Gaps) and the panel orientation.",
          "Machining: Tools are applied to the panels to create the lap joint.",
          "Completion: The join is created. The user can now modify parameters or move the split point."
        ],
        "conditionalBranches": [
          {
            "condition": "Script Initialization (_bOnInsert)",
            "path1": {
              "name": "Manual Insert",
              "steps": [
                "_kExecuteKey is empty",
                "Show Dialog for user input",
                "Proceed to Point Selection"
              ]
            },
            "path2": {
              "name": "Catalog Insert",
              "steps": [
                "_kExecuteKey is set",
                "Load properties from catalog",
                "Skip Dialog, Proceed to Point Selection"
              ]
            }
          },
          {
            "condition": "Internal Logic Mode (Map 'mode')",
            "path1": {
              "name": "Element Mode (Mode 0)",
              "steps": [
                "Attached to a single Wall Element",
                "Detects Sip at split location",
                "Splits Sip into two parts",
                "Creates new TSL instance in Sip Tool Mode",
                "Erases current instance"
              ]
            },
            "path2": {
              "name": "Sip Tool Mode (Mode 1)",
              "steps": [
                "Attached to two split Sip entities",
                "Calculates joint geometry",
                "Applies BeamCuts",
                "Handles updates and grip edits"
              ]
            }
          },
          {
            "condition": "Side Selection (sSide property)",
            "path1": {
              "name": "Reference Side",
              "steps": [
                "Use dGapWidth1 for reference side",
                "Use dGapWidth2 for opposite side",
                "Cut orientation is standard"
              ]
            },
            "path2": {
              "name": "Opposite Side",
              "steps": [
                "Swap dGapWidth1 and dGapWidth2 values",
                "Invert Z-vector (vzT) for cut direction",
                "Apply swapped gaps"
              ]
            }
          },
          {
            "condition": "Split Point Modification (_Pt0 changed)",
            "path1": {
              "name": "Move Forward/Backward",
              "steps": [
                "Calculate movement vector relative to stored reference",
                "Stretch panel edges to new plane",
                "Subtract material to clear overlap (addOpening)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases itself if no element is found immediately after insertion."
          },
          {
            "check": "Sip Count in Tool Mode",
            "errorMessage": "None (Silent)",
            "recovery": "Script halts execution if fewer than 2 Sips are linked to the tool instance."
          },
          {
            "check": "Insert Cycle",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases itself if insertCycleCount > 1, preventing recursive execution."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Split Location",
            "how": "Grip edit on the insertion point (_Pt0)",
            "effect": "The split location updates. The panel edges stretch to meet the new location, and material is automatically subtracted (via addOpening) to maintain the rabbet geometry."
          },
          {
            "action": "Modify Joint Parameters",
            "how": "Properties Palette (OPM)",
            "effect": "Changing Width, Depth, or Gaps updates the size and position of the BeamCuts. Changing Side swaps the gap values and cut direction."
          },
          {
            "action": "Join and Erase",
            "how": "Right-click Context Menu",
            "effect": "The two split panels are joined back into a single Element, and the TSL instance is erased, removing the rabbet."
          }
        ]
      },
      "tokens_used": 7371,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbPanelWalllRabbet.mcr\n\n## Overview\nThis script creates a rabbet (lap joint) between Structural Insulated Panels (SIPs) by automatically splitting a selected wall element and machining the edges to overlap. It is used to create strong interlocking joints or spline connections for structural continuity and weather tightness.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script splits 3D geometry and applies machining tools. |\n| Paper Space | No | Not applicable for 2D drawings. |\n| Shop Drawing | No | This is a model generation script. |\n\n## Prerequisites\n- **Required Entities**: A single Wall Element (which must contain a Sip entity).\n- **Minimum Beam Count**: 1\n- **Required Settings**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbPanelWalllRabbet.mcr`\n\n### Step 2: Configure Joint Parameters\n```\nDialog: Dynamic Properties\nAction: A dialog appears allowing you to set the Width, Depth, and Gaps before insertion. Adjust values as needed and click OK.\n```\n\n### Step 3: Select Split Location\n```\nCommand Line: Select split location:\nAction: Click a point on the wall where you want the joint to divide the panel.\n```\n\n### Step 4: Select Wall Element\n```\nCommand Line: Select element:\nAction: Click the wall element (SIP) that needs to be split and machined.\n```\n\n### Result\nThe script automatically splits the selected element into two separate panels and applies the rabbet machining to the edges.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Width | Number | 50 | The depth of the rabbet cut perpendicular to the wall face (thickness of the overlapping material). |\n| Depth | Number | 30 | The length of the rabbet cut along the wall edge. |\n| Gap | reference side | Number | 0 | Expansion or play gap on the reference side of the split line. |\n| Gap | Depth | Number | 0 | Expansion or play gap along the depth of the cut (prevents binding). |\n| Gap | opposite side | Number | 5 | Expansion or play gap on the opposite side of the split line. |\n| Side | Dropdown | reference side | Determines which panel receives the specific cut geometry relative to the wall orientation. Swaps the reference and opposite gap values if changed. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Join + Erase | Joins the two split panels back into a single Element and removes the tool instance. |\n\n## Settings Files\n- None\n\n## Tips\n- **Moving the Split:** After insertion, you can click and drag the split point (grip) to move the joint along the wall. The panel edges and machining will update automatically.\n- **Adjusting Tolerances:** Use the \"Gap\" parameters to create space for sealants or insulation materials within the joint.\n- **Flipping the Joint:** If the cut is applied to the wrong panel edge, change the \"Side\" property in the palette to \"opposite side\".\n\n## FAQ\n- **Q: Can I change the rabbet size after I have created it?**\n  - A: Yes, simply select the tool instance in the model and change the Width or Depth values in the Properties Palette.\n- **Q: What happens if I delete the tool instance?**\n  - A: The machining (rabbet cuts) will be removed, but the panels will remain split as separate elements. You would need to manually join them or use the \"Join + Erase\" right-click option before deleting.\n- **Q: Why did the script disappear after I selected the element?**\n  - A: The script operates in two phases. First, it splits the element and replaces itself with a new instance linked to the two new panels. This is normal behavior."
      },
      "tokens_used": 6084,
      "error": null
    }
  }
}