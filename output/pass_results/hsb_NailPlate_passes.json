{
  "filename": "hsb_NailPlate.mcr",
  "status": "completed",
  "total_tokens": 40155,
  "processing_time": 283.4303014278412,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": 1,\n    \"minorVersion\": 16,\n    \"dxaOut\": 0,\n    \"implInsert\": 0\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.0\",\n      \"date\": \"25.05.2008\",\n      \"author\": \"Alberto Jena\",\n      \"changes\": \"Release Version\"\n    },\n    {\n      \"version\": \"1.1\",\n      \"date\": \"12.06.2008\",\n      \"author\": \"\",\n      \"changes\": \"Pull Down for the Models\"\n    },\n    {\n      \"version\": \"1.2\",\n      \"date\": \"17.07.2008\",\n      \"author\": \"\",\n      \"changes\": \"Renaming this TSL from hsb_MP to hsb_Nailplate\"\n    },\n    {\n      \"version\": \"1.3\",\n      \"date\": \"10.05.2010\",\n      \"author\": \"\",\n      \"changes\": \"Change the Table and some small fixes on export\"\n    },\n    {\n      \"version\": \"1.4\",\n      \"date\": \"03.09.2010\",\n      \"author\": \"\",\n      \"changes\": \"Add Properties for other Nail Plate type so the customer can define it\"\n    },\n    {\n      \"version\": \"1.5\",\n      \"date\": \"11.02.2011\",\n      \"author\": \"\",\n      \"changes\": \"Add group for the new data base\"\n    },\n    {\n      \"version\": \"1.7\",\n      \"date\": \"04.04.2011\",\n      \"author\": \"\",\n      \"changes\": \"Add support for the space stud clip and A9 NailPlate and blocks\"\n    },\n    {\n      \"version\": \"1.8\",\n      \"date\": \"15.04.2011\",\n      \"author\": \"\",\n      \"changes\": \"Added functionality to export nailplate with an element if the element is valid\"\n    },\n    {\n      \"version\": \"1.9\",\n      \"date\": \"03.06.2011\",\n      \"author\": \"\",\n      \"changes\": \"Fix location of the content blocks\"\n    },\n    {\n      \"version\": \"1.10\",\n      \"date\": \"07.06.2011\",\n      \"author\": \"\",\n      \"changes\": \"Remove the use of blocks until version 16 is adopted by Customer\"\n    },\n    {\n      \"version\": \"1.11\",\n      \"date\": \"29.06.2011\",\n      \"author\": \"\",\n      \"changes\": \"Update Nailplate Model from List\"\n    },\n    {\n      \"version\": \"1.12\",\n      \"date\": \"03.08.2011\",\n      \"author\": \"\",\n      \"changes\": \"Bugfix in IF statement for drawing of blocks/metaparts\"\n    },\n    {\n      \"version\": \"1.13\",\n      \"date\": \"24.11.2011\",\n      \"author\": \"\",\n      \"changes\": \"Bugfix in IF statement for drawing of blocks/metaparts\"\n    },\n    {\n      \"version\": \"1.14\",\n      \"date\": \"02.02.2012\",\n     "
      },
      "tokens_used": 6421,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates 3D Body geometry (PLine/Body), uses getBeam and getPoint for user input during _bOnInsert, and calculates orientation based on _Beam vectors. No 'sd_' prefix, _Viewport checks, or #Type E logic found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing at least one beam.",
          "requiredSettings": []
        }
      },
      "tokens_used": 4775,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialogOnce",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Pick a Point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getBeam",
              "promptOriginal": "Select a Beam",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Property Dialog",
            "trigger": "showDialogOnce called during _bOnInsert",
            "title": "Properties",
            "dataSource": "Script Properties (OPM)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dTh",
            "type": "PropDouble",
            "displayName": "Thickness",
            "defaultValue": "2.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dWi",
            "type": "PropDouble",
            "displayName": "Width",
            "defaultValue": "36.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dLe",
            "type": "PropDouble",
            "displayName": "Length",
            "defaultValue": "100.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDispRep",
            "type": "PropString",
            "displayName": "Show in Disp Rep",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sModel",
            "type": "PropString",
            "displayName": "Model Type",
            "defaultValue": "NP-80-100",
            "inputType": "dropdown",
            "options": [
              "Other Model Type",
              "NP-80-100",
              "NP-80-200",
              "NP-80-300",
              "NP-100-100",
              "NP-100-200",
              "NP-100-300",
              "NP-150-100",
              "NP-150-200",
              "NP-150-300"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strCustomNailPlateModel",
            "type": "PropString",
            "displayName": "Other Nail Plate Type",
            "defaultValue": "**Other Type**",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Please fill this value if you choose 'Other Model Type' above"
          },
          {
            "index": 3,
            "variable": "sFace",
            "type": "PropString",
            "displayName": "Select the Face",
            "defaultValue": "Face 1",
            "inputType": "dropdown",
            "options": [
              "Face 1",
              "Face 2",
              "Face 3",
              "Face 4"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5557,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Inserts a parametric or predefined metal nail plate/connector onto a timber beam for structural reinforcement or connection points.\",\n    \"category\": \"Hardware\",\n    \"typicalUseCase\": \"Adding nail plates (e.g., MiTek, Simpson) or specialized clips (SpaceStud) to wall studs or truss chords where timber members join or require strengthening.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"dTh\",\n      \"technicalDefault\": \"2.0\",\n      \"businessMeaning\": \"The gauge (thickness) of the metal plate material.\",\n      \"validRange\": \"0.8 - 4.0 mm (Typical light gauge steel plates)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Controls the depth (Z-axis) of the 3D body geometry and how far it protrudes from the beam surface.\"\n    },\n    {\n      \"name\": \"dWi\",\n      \"technicalDefault\": \"36.0\",\n      \"businessMeaning\": \"The width of the nail plate (perpendicular to the beam's length).\",\n      \"validRange\": \"25 - 300 mm (Depending on plate design)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Controls the size of the plate along the local Y-axis of the insertion point.\"\n    },\n    {\n      \"name\": \"dLe\",\n      \"technicalDefault\": \"100.0\",\n      \"businessMeaning\": \"The length of the nail plate (typically parallel to the beam's length).\",\n      \"validRange\": \"50 - 600 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Controls the size of the plate along the local X-axis of the insertion point.\"\n    },\n    {\n      \"name\": \"sDispRep\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Filter controlling in which drawing views or display representations the plate is visible.\",\n      \"validRange\": \"Standard hsbCAD display rep names (e.g., 'Model', 'ShopDrawing').\",\n      \"unit\": \"text\",\n      \"affectsOutput\": \"Toggles visibility. If empty, shows in all. If set, plate only appears in the specified view style.\"\n    },\n    {\n      \"name\": \"sModel\",\n      \"technicalDefault\": \"NP-80-100\",\n      \"businessMeaning\": \"The commercial model number or type of the connector. Determines BOM reporting and switches geometry to specific CAD blocks for certain types.\",\n      \"validRange\": \"List of presets (e.g., NP-100-200) or 'Other Model Type'.\",\n      \"unit\": \"text\",\n      \"affectsOutput\": \"Sets the BOM name/Key. If matches specific types (SpaceStud, M20), it replaces the parametric box with a detailed 3D Block representation.\"\n    },\n    {\n      \"name\": \"strCustomNailPlateModel\",\n      \"technicalDefault\": \"**Other Type**\",\n      \"businessMeaning \"user-defined text field to specify a manufacturer part number not in the standard list.\",\n      \"validRange\": \"Alphanumeric string (Part Number).\",\n      \"unit\": \"text\",\n      \"affectsOutput\": \"Updates the BOM export data (U_MODEL field) when 'Other Model Type' is selected.\"\n    },\n    {\n      \"name\": \"sFace\",\n      \"technicalDefault\": \"Face 1\",\n      \"businessMeaning\": \"Specifies which side of the timber beam the plate is attached to (orientation relative to beam cross-section).\",\n      \"validRange\": \"Face 1, 2, 3, or 4 (mapping to beam sides: Top/Right/Bottom/Left or similar).\",\n      \"unit\": \"count\",\n      \"affectsOutput\": \"Rotates the coordinate system of the plate so it sits flush against the correct beam surface.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"sModel is set to 'Other Model Type'\",\n      \"effect\": \"User should fill in strCustomNailPlateModel to ensure correct BOM reporting. Geometry remains based on dLe/dWi/dTh.\",\n      \"cascade\": [\n        \"strCustomNailPlateModel\"\n      ]\n    },\n    {\n      \"trigger\": \"sModel is set to specific Block types (e.g., 'SpaceStud 80mm', 'M20 Nailplate')\",\n      \"effect\": \"Script ignores dLe, dWi, and dTh dimensions and draws a pre-made CAD Block (DWG) instead.\",\n      \"cascade\": [\n        \"dLe\",\n        \"dWi\",\n        \"dTh\"\n      ]\n    },\n    {\n      \"trigger\": \"sFace changes\",\n      \"effect\": \"The orientation vectors (vy, vz) are recalculated relative to the selected beam's local axes to flip the plate to the new side.\",\n      \"cascade\": [\n        \"Geometry Orientation\"\n      ]\n    }\n  ],\n  \"outputEntities\": [\n    {\n      \"type\": \"Body / Block\",\n      \"description\": \"A 3D solid metal plate or a referenced AutoCAD Block representing a specific connector clip.\",\n      \"appliedTo\": \"Model Space, grouped and associated with the selected GenBeam.\"\n    },\n    {\n      \"type\": \"BOM Data\",\n      \"description\": \"Exports attributes U_MODEL (Part Number) and U_QUANTITY (Count) to production lists (DXI/DXA).\",\n      \"appliedTo\": \"Element associated with the selected beam.\"\n    }\n  ]\n}\n```"
      },
      "tokens_used": 7432,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launched",
          "2. Properties Palette (OPM) displayed automatically (showDialogOnce)",
          "3. User prompted to select insertion point (getPoint)",
          "4. User prompted to select target beam (getBeam)",
          "5. Script checks for existing coordinate vectors in Map; if missing, calculates orientation based on 'sFace' property",
          "6. Script determines geometry source based on 'sModel' property",
          "7. Script generates 3D geometry (Parametric Body or Reference Block) at insertion point",
          "8. Script exports BOM data to DXI/DXA based on Element validity"
        ],
        "conditionalBranches": [
          {
            "condition": "Model Type selection (sModel)",
            "path1": {
              "name": "Specific Block Types",
              "steps": [
                "Check if sModel matches: 'SpaceStud 80mm', 'SpaceStud 55mm', 'A9 Nail Plate', or 'M20 Nailplate'",
                "Construct file path to specific DWG block in hsbCAD Content folder",
                "Draw Block using current coordinate system (vx, vy, vz)",
                "Ignore dTh, dWi, dLe parameters (Geometry is fixed)"
              ]
            },
            "path2": {
              "name": "Standard or Custom Type",
              "steps": [
                "Check if sModel is 'Other Model Type' or a standard NP preset (e.g., NP-80-100)",
                "Create PLine rectangle using dLe (Length) and dWi (Width)",
                "Extrude PLine to Body using dTh (Thickness)",
                "Draw Body at insertion point"
              ]
            }
          },
          {
            "condition": "Element Association",
            "path1": {
              "name": "Valid Element",
              "steps": [
                "Verify _Beam[0].element().bIsValid() returns true",
                "Call exportWithElementDxa(el)",
                "Output U_MODEL and U_QUANTITY associated with the element"
              ]
            },
            "path2": {
              "name": "Invalid Element",
              "steps": [
                "Element verification fails",
                "Output U_MODEL and U_QUANTITY as standalone data",
                "No element association in export"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Existence",
            "errorMessage": "None (Silent)",
            "recovery": "Script executes eraseInstance() immediately if _Beam array is empty"
          },
          {
            "check": "Insertion Cycle",
            "errorMessage": "None",
            "recovery": "Script executes eraseInstance() if insertCycleCount() > 1 to prevent duplicate instances"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions",
            "how": "Properties Palette (OPM) -> dTh, dWi, dLe",
            "effect": "Updates the size of the parametric box body (ignored if using specific Block type)"
          },
          {
            "action": "Switch Geometry Type",
            "how": "Properties Palette (OPM) -> Model Type",
            "effect": "Swaps between parametric box and detailed CAD block representations"
          },
          {
            "action": "Change Orientation",
            "how": "Properties Palette (OPM) -> Select the Face",
            "effect": "Recalculates vy and vz vectors to rotate the plate to Face 1, 2, 3, or 4"
          },
          {
            "action": "Move Location",
            "how": "Grip edit on insertion point",
            "effect": "Relocates the plate geometry along the beam"
          }
        ]
      },
      "tokens_used": 9359,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_NailPlate.mcr\n\n## Overview\nInserts a parametric or predefined metal nail plate onto a timber beam for structural reinforcement. It supports standard dimensional plates, specific manufacturer blocks (like SpaceStud), and BOM export for production lists.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the 3D model where beams are located. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | Not supported for 2D drawings. |\n\n## Prerequisites\n- **Required Entities**: At least one GenBeam (Timber Beam) must exist in the model.\n- **Minimum Beam Count**: 1\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or use the hsbCAD insert menu)\nAction: Browse and select `hsb_NailPlate.mcr`.\n\n### Step 2: Configure Properties\n```\nAction: The Properties Palette (OPM) opens automatically upon first insertion.\n```\nSelect the desired **Model Type** (e.g., NP-80-100 or SpaceStud) and adjust dimensions if necessary.\n\n### Step 3: Pick Insertion Point\n```\nCommand Line: Pick a Point\nAction: Click on the beam location where you want to center the nail plate.\n```\n\n### Step 4: Select Host Beam\n```\nCommand Line: Select a Beam\nAction: Click on the timber beam that will hold the nail plate.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Thickness | number | 2.0 | Sets the material gauge (thickness) of the plate. |\n| Width | number | 36.0 | Sets the width of the plate (perpendicular to beam length). |\n| Length | number | 100.0 | Sets the length of the plate (parallel to beam length). |\n| Show in Disp Rep | text | [Empty] | Filter to hide the plate in specific display representations (leave empty to show always). |\n| Model Type | dropdown | NP-80-100 | Select a standard preset, \"Other Model Type\", or a specific block (e.g., SpaceStud 80mm). |\n| Other Nail Plate Type | text | **Other Type** | Enter a custom part number here if \"Other Model Type\" is selected (used for BOM). |\n| Select the Face | dropdown | Face 1 | Chooses which side of the beam the plate attaches to (Face 1-4). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add specific items to the right-click context menu. Use grip edits to move. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script uses internal settings and does not require external XML files.\n\n## Tips\n- **Block vs. Parametric**: If you select specific **Model Types** like \"SpaceStud 80mm\" or \"M20 Nailplate\", the script ignores the manual Width/Length/Thickness inputs and draws a detailed 3D block instead.\n- **Orientation**: Use the **Select the Face** property to flip the plate around the beam without needing to delete and reinsert it.\n- **BOM Export**: To ensure your production lists (MIS) show the correct code, select \"Other Model Type\" and type your specific part code in the **Other Nail Plate Type** field.\n\n## FAQ\n- **Q: I changed the Width/Length, but the plate size didn't update. Why?**\n  **A:** You likely have a specific **Model Type** selected (like a SpaceStud or A9). These use fixed 3D blocks. Change the Model Type to a standard \"NP\" option or \"Other Model Type\" to enable manual dimensions.\n- **Q: How do I put the plate on the side of the beam instead of the top?**\n  **A:** Select the plate in the model, open the Properties Palette, and change **Select the Face** to \"Face 2\", \"Face 3\", or \"Face 4\"."
      },
      "tokens_used": 6611,
      "error": null
    }
  }
}