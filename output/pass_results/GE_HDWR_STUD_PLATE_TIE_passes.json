{
  "filename": "GE_HDWR_STUD_PLATE_TIE.mcr",
  "status": "completed",
  "total_tokens": 45609,
  "processing_time": 239.04475784301758,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7208,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No prefixes 'sd_' or 'Multipage*'. No usage of '_Viewport'. The script creates 3D geometry (Body) and uses `Display` objects with views like 'Engineering Components Model' and 'Engineering Components Top', which are standard for model generation. It performs insertion logic using `dbCreate` and `eraseInstance` which is typical for model-space interaction."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element (Wall)",
            "Beam (Stud or Header)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space context containing a Wall Element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 5676,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a Stud or Header",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getString",
              "promptOriginal": "\nSelect a size for the '2x4' wall [SP1/SP4/SPH4/SPH4R]",
              "condition": "_bOnInsert (Loop per unique wall size)",
              "required": true
            },
            {
              "step": 3,
              "function": "getString",
              "promptOriginal": "\nInsert Location [Top/BOttom/Both]",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": [
            {
              "prompt": "\nInsert Location [Top/BOttom/Both]",
              "options": [
                "Top",
                "Bottom",
                "Both"
              ]
            }
          ]
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "stCode",
            "type": "PropString",
            "displayName": "SP Tie",
            "defaultValue": "Depends on Wall Size (No Selection if no wall)",
            "inputType": "dropdown",
            "options": [
              "Dynamic list based on wall size (e.g., SP1, SP4, SPH4)"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "stLocation",
            "type": "PropString",
            "displayName": "Location",
            "defaultValue": "Top",
            "inputType": "dropdown",
            "options": [
              "Top",
              "Bottom"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "stInstall",
            "type": "PropString",
            "displayName": "Installation",
            "defaultValue": "Shop Installed",
            "inputType": "dropdown",
            "options": [
              "Site Installed",
              "Shop Installed"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8152,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates parametric 3D models and BOM data for metal Stud Plate Ties (straps) connecting studs or headers to top or bottom wall plates.",
          "category": "Hardware",
          "typicalUseCase": "Used during the engineering phase to specify uplift or lateral load resistance straps at wall corners, ends, or adjacent to openings."
        },
        "parameters": [
          {
            "name": "stCode",
            "technicalDefault": "First valid match for wall size (e.g., SP1, SP4, SPH4)",
            "businessMeaning": "The specific catalog model number of the stud plate tie (e.g., Simpson SP or SPH series). This determines the physical dimensions of the strap.",
            "validRange": "Restricted list based on Wall Width (2x3: SP1/SP2; 2x4: SP4/SPH4/SPH4R; 2x6: SP6/SPH6/SPH6R; 2x8: SP8/SPH8).",
            "unit": "N/A (Model ID)",
            "affectsOutput": "Controls the length of the vertical legs and the width of the horizontal flange of the 3D metal body, as well as the hardware article number reported in BOMs."
          },
          {
            "name": "stLocation",
            "technicalDefault": "Top",
            "businessMeaning": "Specifies whether the tie is installed on the Top Plate or the Bottom Plate of the wall assembly.",
            "validRange": "Top, Bottom",
            "unit": "N/A",
            "affectsOutput": "Determines the orientation of the tie legs relative to the insertion point (extending up for Top, down for Bottom) and the position of the flange on the wall plate."
          },
          {
            "name": "stInstall",
            "technicalDefault": "Shop Installed",
            "businessMeaning": "Indicates the construction phase where the hardware is applied, impacting material logistics and shop drawing filtering.",
            "validRange": "Site Installed, Shop Installed",
            "unit": "N/A",
            "affectsOutput": "Sets the display color (Shop=Yellow), assigns the part to specific element groups ('Z' for Shop, 'I' for Site), and controls whether the part is exported to panel shop drawings."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Wall Element Width (Parent Element)",
            "effect": "Filters the available options in stCode.",
            "cascade": [
              "stCode"
            ]
          },
          {
            "trigger": "stInstall",
            "effect": "Toggles visibility in Shop Drawings and assigns Material Group codes.",
            "cascade": [
              "Model Representation (Color)",
              "BOM / Export Data"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Body (Metal Plate)",
            "description": "A U-shaped or flat strap geometry with a horizontal flange (nailing plate) and vertical legs extending down the stud. Dimensions vary by stCode.",
            "appliedTo": "Wall Element (Top/Bottom Plate) and selected Beam (Stud/Header)"
          },
          {
            "type": "HardWrComp (Logical Hardware)",
            "description": "Logical component for BOM exports containing the model name, article number, and quantity.",
            "appliedTo": "Wall Element"
          },
          {
            "type": "Text Label",
            "description": "2D text displaying the strap code (e.g., 'SP1') in the Top view plan.",
            "appliedTo": "Insertion Point on Wall"
          }
        ]
      },
      "tokens_used": 8486,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script via command or catalog",
          "2. Prompt User to select Studs or Headers (PrEntity)",
          "3. Validate selection: Filter for Beams belonging to valid Wall Elements",
          "4. Detect Wall Widths from selection (e.g., 2x4, 2x6)",
          "5. Loop through each unique Wall Width detected:",
          "   5a. Prompt user for specific Tie Code (e.g., SP4, SPH4)",
          "6. Prompt user for Insertion Location: Top, Bottom, or Both",
          "7. Loop through selected Beams:",
          "   7a. Calculate intersection points with Wall Envelope (Top & Bottom plates)",
          "   7b. Filter points based on Insertion Location",
          "   7c. Create new TSL Instance (dbCreate) for each valid point with properties (Code, Location, Install)",
          "8. Erase original command instance",
          "9. New Instances execute:",
          "   9a. Retrieve properties and geometry context",
          "   9b. Validate insertion point geometry (Wall intersection)",
          "   9c. [Dynamic] Search for and snap to nearest Stud if within range",
          "   9d. Generate 3D Body (Flange + Legs) and 2D Symbol",
          "   9e. Assign Layers, Element Groups ('Z' or 'I'), and BOM Data"
        ],
        "conditionalBranches": [
          {
            "condition": "Wall Width Detection",
            "path1": {
              "name": "Known Size (e.g., 2x4)",
              "steps": [
                "Filter inventory array for matching '2x4'",
                "Present specific options (e.g., SP4, SPH4) to user"
              ]
            },
            "path2": {
              "name": "Unknown/Custom Size",
              "steps": [
                "Set 'stWallSize' to numeric width",
                "No specific codes offered (fallback to inventory or default)",
                "User manually handles compatibility"
              ]
            }
          },
          {
            "condition": "Insertion Location Input",
            "path1": {
              "name": "Top or Bottom",
              "steps": [
                "Filter intersection points to keep only Top OR Bottom",
                "Create single instance per selected beam"
              ]
            },
            "path2": {
              "name": "Both",
              "steps": [
                "Keep Top and Bottom intersection points",
                "Create two instances per selected beam"
              ]
            }
          },
          {
            "condition": "Beam Orientation relative to Wall",
            "path1": {
              "name": "Perpendicular (Standard Stud)",
              "steps": [
                "Order points along Wall Y-axis",
                "Filter strictly by Top/Bottom index"
              ]
            },
            "path2": {
              "name": "Parallel (e.g., Header/Rim)",
              "steps": [
                "Calculate midpoint of beam relative to wall",
                "Select the plate nearest to the beam center"
              ]
            }
          },
          {
            "condition": "Geometry Validation (Intersection Points)",
            "path1": {
              "name": "Valid Intersection (2 points found)",
              "steps": [
                "Proceed to generate Body and Display"
              ]
            },
            "path2": {
              "name": "Invalid Intersection (0 or 1 point)",
              "steps": [
                "Attempt fix using Wall Start/End outline points",
                "If still invalid: Draw visual error (Circle + Cross line)",
                "Abort further execution (return)"
              ]
            }
          },
          {
            "condition": "Installation Type (stInstall)",
            "path1": {
              "name": "Shop Installed",
              "steps": [
                "Set Display Color to Yellow (226)",
                "Assign Element Group 'Z'",
                "Populate 'mpPanelShop' Map for labels"
              ]
            },
            "path2": {
              "name": "Site Installed",
              "steps": [
                "Use Default Display Color",
                "Assign Element Group 'I'",
                "Remove 'mpPanelShop' Map data"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Valid Beam & Element Selection",
            "errorMessage": "None explicit, but invalid entities are ignored via continue;",
            "recovery": "User must select valid Beams that are part of a Wall Element."
          },
          {
            "check": "Property stCode exists in allowed list",
            "errorMessage": "None (Handled silently)",
            "recovery": "Script automatically resets stCode to the first valid item in the list (arStList[0])."
          },
          {
            "check": "Geometry Intersection (arPt.length == 2)",
            "errorMessage": "Visual Marker: Red Circle and Cross at insertion point.",
            "recovery": "User needs to move the script (Pt0) or ensure the Element geometry is valid."
          },
          {
            "check": "Element Existence on Recalculate",
            "errorMessage": "Instance Erased",
            "recovery": "User must ensure the Wall Element is not deleted."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Insertion Point (Grip Edit)",
            "how": "Drag the TSL grip (_Pt0)",
            "effect": "Triggers Stud Attachment search; script snaps to nearest perpendicular stud within 8\" range and updates geometry."
          },
          {
            "action": "Change Properties (OPM)",
            "how": "AutoCAD Properties Palette",
            "effect": "Changing 'stCode' resizes the 3D Body; Changing 'stLocation' moves the tie to Top/Bottom plate; Changing 'Installation' updates Color, Layer Group, and BOM export status."
          },
          {
            "action": "Modify Wall Element",
            "how": "Edit Wall/Element geometry",
            "effect": "_bOnElementListModified triggered; script attempts to re-associate with valid wall outline."
          }
        ]
      },
      "tokens_used": 10172,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_STUD_PLATE_TIE.mcr\n\n## Overview\nThis script automates the insertion of metal stud plate ties (straps), such as Simpson SP or SPH series, connecting wall studs or headers to top or bottom plates. It generates parametric 3D bodies, assigns BOM data, and handles shop or site installation settings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in 3D model context. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | This is a modeling script, though it controls shop drawing visibility via properties. |\n\n## Prerequisites\n- **Required Entities**: An existing Wall Element containing Stud or Header beams.\n- **Minimum Beam Count**: 1 (The script can process multiple beams in one session).\n- **Required Settings**: None (Uses internal logic to map wall widths to strap codes).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_HDWR_STUD_PLATE_TIE.mcr` from the catalog.\n\n### Step 2: Select Studs or Headers\n```\nCommand Line: Select a Stud or Header\nAction: Click on one or multiple studs/headers within your wall assembly.\n```\n*Note: If you select beams belonging to different wall sizes (e.g., 2x4 and 2x6 walls), the script will group them by size.*\n\n### Step 3: Specify Tie Size (Looped)\n```\nCommand Line: Select a size for the '2x4' wall [SP1/SP4/SPH4/SPH4R]\nAction: Type the desired code (e.g., SP4) and press Enter.\n```\n*Note: If you selected beams from multiple wall sizes, this prompt repeats for each unique wall width.*\n\n### Step 4: Select Insertion Location\n```\nCommand Line: Insert Location [Top/BOttom/Both]\nAction: Type T, B, or select Both and press Enter.\n```\n*Note: Selecting \"Both\" will generate two separate hardware instances (one top, one bottom) for every stud selected.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| SP Tie | Dropdown | SP4 (Example) | Selects the specific hardware model number. Options are filtered automatically based on the width of the wall (e.g., 2x4 walls show SP4/SPH4 options). |\n| Location | Dropdown | Top | Sets the vertical position of the tie. Options: **Top** (flange on top plate, legs down) or **Bottom** (flange on bottom plate, legs up). |\n| Installation | Dropdown | Shop Installed | Determines logistics and representation. **Shop Installed** sets color to Yellow and assigns Element Group 'Z'. **Site Installed** uses default color and Element Group 'I'. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add custom items to the right-click context menu. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A (Dimensions are embedded in the script logic).\n\n## Tips\n- **Batch Processing**: You can window select an entire row of studs. The script will calculate the correct quantity and placement for all selected beams.\n- **Dynamic Snapping**: If you use the grip to move the hardware after insertion, the script will automatically snap to the nearest perpendicular stud within an 8-inch range.\n- **Color Coding**: Shop installed ties appear **Yellow** by default, making them easy to distinguish from field installed hardware in the model.\n- **Troubleshooting**: If you see a **Red Circle with a Cross** at the insertion point, the tie could not find a valid intersection with the wall plates. Move the grip closer to the plate or check the wall geometry.\n\n## FAQ\n- **Q: Why did the script ask me for the size twice?**\n  **A**: You likely selected studs from two different wall types (e.g., a 2x4 partition and a 2x6 exterior wall). The script prompts you separately for each wall width to ensure the correct strap length is used.\n- **Q: Can I change the strap size after inserting it?**\n  **A**: Yes. Select the strap, open the Properties Palette (Ctrl+1), and change the \"SP Tie\" dropdown to the desired model.\n- **Q: What happens if I change the wall width after the ties are placed?**\n  **A**: The ties are intelligent. If the wall geometry changes, the script attempts to re-associate with the wall. If the new wall size is incompatible with the selected tie code, you may need to manually update the \"SP Tie\" property."
      },
      "tokens_used": 5915,
      "error": null
    }
  }
}