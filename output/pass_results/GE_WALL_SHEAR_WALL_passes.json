{
  "filename": "GE_WALL_SHEAR_WALL.mcr",
  "status": "completed",
  "total_tokens": 53319,
  "processing_time": 562.8728988170624,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\":"
      },
      "tokens_used": 8825,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getElement() to select a Wall Element and assigns the TSL instance to it via assignToElementGroup(). It creates an ElemConstructionMap ('ElementShearwallInsertDirective') to influence framing and attaches Property Sets to the element. It does not use _Viewport, Sheet entities, or sd_ prefixes typical of Paper Space or Shop Drawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element (Wall)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "\\Utilities\\hsbFramingDefaultsEditor\\hsbFramingDefaults.Shearwalls.dll"
          ]
        }
      },
      "tokens_used": 6306,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getElement",
              "promptOriginal": "Select wall",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select start point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "Select end point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": ".NET Form",
            "trigger": "On Insertion or via 'Change style' context menu",
            "title": "Shearwall Style Editor",
            "dataSource": "hsbFramingDefaults.Shearwalls.dll",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sStyle",
            "type": "PropString",
            "displayName": "SHEAR WALL STYLE",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Shear wall style can be changed from right click on the TSL instance -> Custom -> Change style"
          },
          {
            "index": 1,
            "variable": "sEmpty51",
            "type": "PropString",
            "displayName": "SYMBOL",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sNote",
            "type": "PropString",
            "displayName": "     Note",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sSymbolColor",
            "type": "PropString",
            "displayName": "     Symbol color",
            "defaultValue": "Cyan",
            "inputType": "dropdown",
            "options": [
              "From layer",
              "Red",
              "Yellow",
              "Green",
              "Cyan",
              "Blue",
              "Magenta",
              "White",
              "Gray"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sShape",
            "type": "PropString",
            "displayName": "     Tag shape",
            "defaultValue": "Diamond",
            "inputType": "dropdown",
            "options": [
              "Triangle",
              "Diamond",
              "None"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "dDistanceFromWall",
            "type": "PropDouble",
            "displayName": "     Offset from wall/hatch depth",
            "defaultValue": "25",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sDisplayP1P2",
            "type": "PropString",
            "displayName": "     Display start and end points",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sDisplayType",
            "type": "PropString",
            "displayName": "     Display ",
            "defaultValue": "Dashed line",
            "inputType": "dropdown",
            "options": [
              "Hatch",
              "Dashed line",
              "none"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "sDimstyleSymbol",
            "type": "PropString",
            "displayName": "     Dimension style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "sEmpty61",
            "type": "PropString",
            "displayName": "DIMENSION",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 10,
            "variable": "sDimensionType",
            "type": "PropString",
            "displayName": "     Dimension type",
            "defaultValue": "Tag string",
            "inputType": "dropdown",
            "options": [
              "Tag string",
              "Dimension line",
              "None"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 11,
            "variable": "sRoundOption",
            "type": "PropString",
            "displayName": "     Round down options",
            "defaultValue": "Nearest cm (Imperial: Nearest inch)",
            "inputType": "dropdown",
            "options": [
              "Nearest cm",
              "Nearest m",
              "Actual dimension"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 12,
            "variable": "sDimstyleDimensionLine",
            "type": "PropString",
            "displayName": "     Dimension style ",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 13,
            "variable": "sDimColors",
            "type": "PropString",
            "displayName": "     Dimension color ",
            "defaultValue": "Cyan",
            "inputType": "dropdown",
            "options": [
              "From layer",
              "Red",
              "Yellow",
              "Green",
              "Cyan",
              "Blue",
              "Magenta",
              "White",
              "Gray"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Change style",
            "handler": "sChangeStyle",
            "action": "Opens the Shearwall Style Editor dialog to modify style parameters.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "hsbFramingDefaults.Shearwalls.dll",
            "searchPaths": [
              "\\Utilities\\hsbFramingDefaultsEditor"
            ],
            "purpose": "Provides the Shearwall Style Editor and style data mapping.",
            "required": true
          }
        ]
      },
      "tokens_used": 8572,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts a shear wall definition onto a wall segment to control structural framing (nailing, sheathing, hardware) and generate visual annotations (tags, dimensions) for drawings.",
          "category": "Framing/Structural",
          "typicalUseCase": "Used by an engineer or detailer to designate specific segments of a wall as shear walls to resist lateral loads, ensuring the wall is framed with the correct materials and hardware, and labeled correctly on the floor plan."
        },
        "parameters": [
          {
            "name": "sStyle",
            "technicalDefault": "",
            "businessMeaning": "The engineering catalog entry defining the shear wall's structural properties (e.g., sheathing type, nailing pattern, hold-down hardware, post sizing). Changing this updates the framing directives.",
            "validRange": "Valid entries from hsbFramingDefaults.Shearwalls.dll",
            "unit": "String",
            "affectsOutput": "Updates the 'ElementShearwallInsertDirective' map, which alters the generated framing materials, machining, and schedule data."
          },
          {
            "name": "sNote",
            "technicalDefault": "",
            "businessMeaning": "User-defined text annotation displayed near the shear wall tag, often used for additional notes not covered by the tag name.",
            "validRange": "Any alphanumeric string",
            "unit": "Text",
            "affectsOutput": "Updates the text label displayed in the CAD model and drawings."
          },
          {
            "name": "sSymbolColor",
            "technicalDefault": "Cyan",
            "businessMeaning": "The display color of the shear wall symbol and associated text.",
            "validRange": "Standard AutoCAD colors (Red, Yellow, Green, Cyan, Blue, Magenta, White, Gray, or ByLayer)",
            "unit": "Color Index",
            "affectsOutput": "Visual only; changes the color of the 3D tag and text entities."
          },
          {
            "name": "sShape",
            "technicalDefault": "Diamond",
            "businessMeaning": "The geometric shape of the marker used to identify the shear wall location on plans.",
            "validRange": "Triangle, Diamond, None",
            "unit": "Enum",
            "affectsOutput": "Visual only; generates a Triangle or Diamond body (or no body) at the shear wall location."
          },
          {
            "name": "dDistanceFromWall",
            "technicalDefault": "25",
            "businessMeaning": "The offset distance from the wall face to the shear wall symbol/hatch. Used to push the annotation clear of the wall geometry.",
            "validRange": "0 to 5000 mm (Typically 20-100mm)",
            "unit": "mm (or inches in imperial)",
            "affectsOutput": "Moves the graphic entities (tag, text, hatch) along the wall's normal vector."
          },
          {
            "name": "sDisplayP1P2",
            "technicalDefault": "No",
            "businessMeaning": "Toggles the visibility of the specific start and end points of the shear wall segment.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "Visual only; adds or removes point markers at the user-selected start/end coordinates."
          },
          {
            "name": "sDisplayType",
            "technicalDefault": "Dashed line",
            "businessMeaning": "Controls how the shear wall area is highlighted on the drawing.",
            "validRange": "Hatch (solid pattern), Dashed line (outline), None",
            "unit": "Enum",
            "affectsOutput": "Generates a hatch pattern, a dashed outline, or no graphical area indicator between start and end points."
          },
          {
            "name": "sDimstyleSymbol",
            "technicalDefault": "",
            "businessMeaning": "The AutoCAD dimension style applied to the symbol text (Tag String).",
            "validRange": "Existing DimStyles in the drawing",
            "unit": "String",
            "affectsOutput": "Text style and height of the Shear Wall Tag."
          },
          {
            "name": "sDimensionType",
            "technicalDefault": "Tag string",
            "businessMeaning": "Determines how the length of the shear wall is communicated.",
            "validRange": "Tag string (e.g., 'SW-1'), Dimension line (numeric length), None",
            "unit": "Enum",
            "affectsOutput": "Switches between displaying a text label or a CAD dimension line measuring the wall segment."
          },
          {
            "name": "sRoundOption",
            "technicalDefault": "Nearest cm (Imperial: Nearest inch)",
            "businessMeaning": "Rounding rule for the dimension line if 'Dimension line' is selected.",
            "validRange": "Nearest cm/m (or inch/foot), Actual dimension",
            "unit": "Rounding Logic",
            "affectsOutput": "Rounds the numeric value displayed on the dimension line."
          },
          {
            "name": "sDimstyleDimensionLine",
            "technicalDefault": "",
            "businessMeaning": "The AutoCAD dimension style applied to the length dimension line.",
            "validRange": "Existing DimStyles in the drawing",
            "unit": "String",
            "affectsOutput": "Arrow style, text size, and precision of the length dimension."
          },
          {
            "name": "sDimColors",
            "technicalDefault": "Cyan",
            "businessMeaning": "Color of the dimension line or tag text.",
            "validRange": "Standard AutoCAD colors",
            "unit": "Color Index",
            "affectsOutput": "Visual color of the dimension or tag text."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sDimensionType is set to 'None' or 'Tag string'",
            "effect": "The 'Dimension style' and 'Round down options' are effectively ignored for length display purposes.",
            "cascade": [
              "sDimstyleDimensionLine",
              "sRoundOption"
            ]
          },
          {
            "trigger": "sDimensionType is set to 'Dimension line'",
            "effect": "The visual representation changes from text to a measured line, utilizing rounding and dimstyle settings.",
            "cascade": [
              "sDimstyleDimensionLine",
              "sRoundOption",
              "sDimColors"
            ]
          },
          {
            "trigger": "Context Menu 'Change style'",
            "effect": "Reloads the sStyle property and overwrites display parameters (Note, Color, Shape, etc.) to match the saved Style definition.",
            "cascade": [
              "sStyle",
              "sNote",
              "sSymbolColor",
              "sShape",
              "dDistanceFromWall",
              "sDisplayP1P2",
              "sDisplayType",
              "sDimensionType",
              "sRoundOption"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "ElemConstructionMap",
            "description": "ElementShearwallInsertDirective. A data packet attached to the wall element containing the start/end points and the Style Map. This is read by the hsb Framing engine to determine post placements, nailing patterns, and hardware insertion.",
            "appliedTo": "Selected Wall Element"
          },
          {
            "type": "Property Set",
            "description": "'Shearwall' Property Set. Contains detailed schedule data (Sheathing thickness, nailing patterns, hold-down specs, etc.) derived from the Style Map for export to BIM/CAM.",
            "appliedTo": "Wall Element and TSL Instance"
          },
          {
            "type": "3D Primitives / Visualization",
            "description": "Graphical entities including Tags (Triangle/Diamond), Text (Notes/Dimensions), Lines (Dashed outline), and Hatches.",
            "appliedTo": "Model Space (associated with the TSL instance)"
          }
        ]
      },
      "tokens_used": 9969,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script: User executes the TSL command.",
          "2. Select Entity: Prompt 'Select wall' appears.",
          "3. Input Geometry: User selects a Wall Element.",
          "4. Define Start Point: Prompt 'Select start point' appears.",
          "5. Input Geometry: User picks a point (usually on the wall face or outline).",
          "6. Define End Point: Prompt 'Select end point' appears.",
          "7. Input Geometry: User picks a point defining the shear wall segment length.",
          "8. Configure Style: 'Shearwall Style Editor' (.NET dialog) opens automatically.",
          "9. User Action: User selects a style from the library and configures parameters (optional), then clicks OK or Cancel.",
          "10. Processing: Script calculates coordinate system, projects points to wall plane, and retrieves style map from DLL.",
          "11. Generation: Script updates OPM properties, generates visual entities (tags/dimensions), creates Property Sets, and attaches 'ElementShearwallInsertDirective' to the wall.",
          "12. Completion: Instance is inserted into the model."
        ],
        "conditionalBranches": [
          {
            "condition": "User response in 'Shearwall Style Editor' during Insertion",
            "path1": {
              "name": "Confirm Selection",
              "steps": [
                "User clicks OK with a valid style selected.",
                "Script generates mapNewStyleMap.",
                "Properties (sStyle, sNote, sShape, etc.) are updated from the Style Map.",
                "Structural directive is added to the wall.",
                "Visual representation is generated."
              ]
            },
            "path2": {
              "name": "Cancel Dialog",
              "steps": [
                "User clicks Cancel.",
                "callDotNetFunction returns empty map.",
                "Script detects mapNewStyleMap.length() == 0.",
                "eraseInstance() is called.",
                "Script terminates without creating geometry."
              ]
            }
          },
          {
            "condition": "Script Execution Mode",
            "path1": {
              "name": "Initial Insert (_bOnInsert)",
              "steps": [
                "insertCycleCount check.",
                "Prompt for Wall Element.",
                "Prompt for Start Point.",
                "Prompt for End Point.",
                "Invoke Style Editor Dialog."
              ]
            },
            "path2": {
              "name": "Update/Recalc (_bOnRecalc)",
              "steps": [
                "Skip prompts (getPoint/getElement).",
                "Retrieve stored points and element from memory.",
                "Re-calculate geometry based on current wall position.",
                "Regenerate visuals.",
                "Skip Dialog invocation (unless triggered by context menu)."
              ]
            }
          },
          {
            "condition": "Context Menu Trigger 'Change style'",
            "path1": {
              "name": "Execute Change Style",
              "steps": [
                "User right-clicks TSL -> Custom -> Change style.",
                "_kExecuteKey matches 'Change style'.",
                "Invoke Style Editor Dialog.",
                "Update properties from new Style Map.",
                "Report message: 'Wall [Code] must be framed to apply changes'."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Wall Element Selection",
            "errorMessage": "None (Script handles silently)",
            "recovery": "If _Element.length() == 0, script calls eraseEntity() and exits."
          },
          {
            "check": "Element Validity",
            "errorMessage": "None (Script handles silently)",
            "recovery": "If !el.bIsValid(), script calls eraseInstance() and exits."
          },
          {
            "check": "Style Map Availability",
            "errorMessage": "None (Script handles silently)",
            "recovery": "If the DLL returns an empty map (e.g., user cancels or no styles found) during Insert, eraseInstance() is called."
          },
          {
            "check": "Point Projection",
            "errorMessage": "None (Automatic correction)",
            "recovery": "Script automatically realigns selected points (_PtG[0], _PtG[1]) to the wall's Element Coordinate System (Zone 1) using vector projection."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Visual Properties",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Updates display settings (Color, Note, Shape, Offset, Dimension Type) instantly. Note: If 'Change style' is used later, these may be overwritten by the style definition."
          },
          {
            "action": "Change Structural Style",
            "how": "Right-click Context Menu -> Custom -> Change style",
            "effect": "Opens the .NET Style Editor. Selecting a new style updates the 'ElementShearwallInsertDirective' map (affecting framing/engineering data) and resets visual properties to the new style's defaults."
          },
          {
            "action": "Move Wall",
            "how": "Grip edit or Move command on the Wall Element",
            "effect": "Since assignToElementGroup is used, the TSL instance moves with the wall. The shear wall start/end points update relative to the wall's new position on next recalc."
          },
          {
            "action": "Framing Update",
            "how": "Run wall framing generation",
            "effect": "The 'ElementShearwallInsertDirective' is read by the framing engine to apply specific nailing patterns, sheathing, and hardware defined in the selected style."
          }
        ]
      },
      "tokens_used": 11297,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_WALL_SHEAR_WALL\n\n## Overview\nInserts a shear wall definition onto a wall segment to control structural framing (such as nailing patterns, sheathing, and hardware) and generates visual annotations (tags and dimensions) for drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D Wall Elements. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required entities:** A Wall Element must exist in the model.\n- **Minimum beam count:** 0\n- **Required settings:** `hsbFramingDefaults.Shearwalls.dll` (located in `\\\\Utilities\\\\hsbFramingDefaultsEditor`).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_WALL_SHEAR_WALL.mcr`\n\n### Step 2: Select Wall\n```\nCommand Line: Select wall\nAction: Click on the Wall Element in the model where you want to apply the shear wall definition.\n```\n\n### Step 3: Define Start Point\n```\nCommand Line: Select start point\nAction: Click a point on the wall to mark the start of the shear wall segment (usually at a corner or opening).\n```\n\n### Step 4: Define End Point\n```\nCommand Line: Select end point\nAction: Click a point on the wall to mark the end of the shear wall segment.\n```\n\n### Step 5: Configure Style\n```\nAction: The \"Shearwall Style Editor\" dialog appears automatically. Select a predefined engineering style from the list and configure parameters if necessary. Click OK to confirm or Cancel to abort.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| SHEAR WALL STYLE | Text | | The engineering catalog entry defining structural properties. Can be changed via right-click menu. |\n| SYMBOL | Text | | Symbol identifier text. |\n| Note | Text | | User-defined text annotation displayed near the shear wall tag. |\n| Symbol color | Dropdown | Cyan | Display color of the shear wall symbol and text. |\n| Tag shape | Dropdown | Diamond | Shape of the marker: Triangle, Diamond, or None. |\n| Offset from wall/hatch depth | Number | 25 | Distance from the wall face to the annotation/hatch. |\n| Display start and end points | Dropdown | No | Toggles visibility of the segment start and end point markers. |\n| Display | Dropdown | Dashed line | Visual style: Hatch, Dashed line, or None. |\n| Dimension style | Dropdown | | AutoCAD dimension style applied to the symbol text. |\n| DIMENSION | Text | | Dimension label text. |\n| Dimension type | Dropdown | Tag string | Controls length display: Tag string, Dimension line, or None. |\n| Round down options | Dropdown | Nearest cm | Rounding rule if 'Dimension line' is used. |\n| Dimension style | Dropdown | | AutoCAD dimension style applied to the dimension line. |\n| Dimension color | Dropdown | Cyan | Color of the dimension line or tag text. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change style | Opens the Shearwall Style Editor dialog. Selecting a new style updates the structural data and resets visual properties (colors, shapes, offsets) to the new style's defaults. |\n\n## Settings Files\n- **Filename**: `hsbFramingDefaults.Shearwalls.dll`\n- **Location**: `\\\\Utilities\\\\hsbFramingDefaultsEditor`\n- **Purpose**: Provides the Shearwall Style Editor interface and the database of engineering styles (nailing, sheathing, hardware).\n\n## Tips\n- **Moving Walls**: If you move or stretch the Wall Element using standard AutoCAD grips, the shear wall instance and annotations will move with it automatically.\n- **Style Overrides**: If you manually change properties (like Color or Shape) in the Properties Palette, avoid using the \"Change style\" right-click option afterward, as it will reset your manual changes to the style's default values.\n- **Framing Application**: This script sets the *directives* for the wall. You must run the wall framing generation process separately to see the physical changes (studs, nailing, etc.) in the model.\n\n## FAQ\n- **Q: Why did my custom tag color disappear after I updated the style?**\n  - **A:** Using the \"Change style\" context menu item reloads all display parameters from the selected style definition. You will need to manually adjust the color again in the Properties Palette if you wish to deviate from the style default.\n- **Q: Does this script actually cut holes or add studs to my wall?**\n  - **A:** No. It attaches a construction map (`ElementShearwallInsertDirective`) to the wall. The hsb Framing engine reads this map during the framing generation process to determine the correct materials and hardware.\n- **Q: What happens if I cancel the Style Editor dialog during insertion?**\n  - **A:** The script detects the cancellation and erases the instance immediately. No geometry or properties will be created."
      },
      "tokens_used": 8350,
      "error": null
    }
  }
}