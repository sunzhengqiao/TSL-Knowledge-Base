{
  "filename": "hsbOpeningZone.mcr",
  "status": "completed",
  "total_tokens": 43370,
  "processing_time": 217.70365381240845,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 8067,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses `getElement()` and applies `ElemMill`, `ElemSaw`, and `SolidSubtract` operations to the element's sheets. No `sd_` prefix, `Viewport` usage, or 2D dimensioning/drawing generation commands found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5449,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && insertCycleCount()>1",
              "required": false
            },
            {
              "step": 2,
              "function": "getElement",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nZone",
            "type": "PropInt",
            "displayName": "|Zone|",
            "defaultValue": 5,
            "inputType": "dropdown",
            "options": [
              "-5",
              "-4",
              "-3",
              "-2",
              "-1",
              "1",
              "2",
              "3",
              "4",
              "5"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": "100mm",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dHeight",
            "type": "PropDouble",
            "displayName": "|Height|",
            "defaultValue": "200mm",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sCNCTool",
            "type": "PropString",
            "displayName": "|Tool|",
            "defaultValue": "|Milling|",
            "inputType": "dropdown",
            "options": [
              "|Milling|",
              "|Saw|"
            ],
            "category": "|Tooling|",
            "description": null
          },
          {
            "index": 1,
            "variable": "nToolingIndex",
            "type": "PropInt",
            "displayName": "|Tooling Index|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|Tooling|",
            "description": null
          },
          {
            "index": 1,
            "variable": "sOverShoot",
            "type": "PropString",
            "displayName": "|Overshoot|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Tooling|",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Link to Entity|",
            "handler": "|Link to Entity|",
            "action": "Prompts user to select a beam or TSL instance to link the opening zone to.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Remove Link|",
            "handler": "|Remove Link|",
            "action": "Prompts user to select a linked entity to remove the dependency.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 6169,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a rectangular milling or saw cut opening (e.g., for services or beam recesses) in a timber wall element, with support for dynamic resizing based on linked beams or other TSL instances.",
          "category": "Machining",
          "typicalUseCase": "Creating service holes in CLT panels or stud walls, or creating a recess for a crossing beam/plate connection where the opening size is dictated by the intersecting member."
        },
        "parameters": [
          {
            "name": "nZone",
            "technicalDefault": "5",
            "businessMeaning": "Specifies the construction layer (Zone index) within the element to apply the machining. This determines exactly which sheet or layer of a composite wall gets cut.",
            "validRange": "-5 to 5",
            "unit": "Index",
            "affectsOutput": "Filters the sheets within the element; only sheets belonging to the specified zone index receive the cut tool."
          },
          {
            "name": "dWidth",
            "technicalDefault": "100mm",
            "businessMeaning": "The width of the rectangular opening along the element's X-axis.",
            "validRange": "> 0mm",
            "unit": "mm",
            "affectsOutput": "Sets the horizontal dimension of the rectangular cut. Becomes read-only if linked to a cross-beam."
          },
          {
            "name": "dHeight",
            "technicalDefault": "200mm",
            "businessMeaning": "The height of the rectangular opening along the element's Y-axis (usually vertical on a wall).",
            "validRange": "> 0mm",
            "unit": "mm",
            "affectsOutput": "Sets the vertical dimension of the rectangular cut. Becomes read-only if linked to a cross-beam."
          },
          {
            "name": "sCNCTool",
            "technicalDefault": "|Milling|",
            "businessMeaning": "Selects the type of CNC machining operation to perform.",
            "validRange": "|Milling|, |Saw|",
            "unit": "Enumeration",
            "affectsOutput": "Determines whether an 'ElemMill' (for pockets/recesses) or 'ElemSaw' (for through-cuts) is generated in the production data."
          },
          {
            "name": "nToolingIndex",
            "technicalDefault": "0",
            "businessMeaning": "The specific tool number from the CNC machine's library to use for this operation.",
            "validRange": "Integer (Machine specific)",
            "unit": "Index",
            "affectsOutput": "Directs the CNC machine to use a specific cutter/saw blade diameter defined in the machine configuration."
          },
          {
            "name": "sOverShoot",
            "technicalDefault": "|No|",
            "businessMeaning": "Controls whether the tool path should extend (overcut) beyond the theoretical contour intersection points.",
            "validRange": "|Yes|, |No|",
            "unit": "Boolean",
            "affectsOutput": "If Yes, the tool path extends slightly past the corners to ensure a clean cut without tabs. If No, the tool stops exactly at the geometry boundaries."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User links a Beam via 'Link to Entity'",
            "effect": "The Width and Height parameters become read-only and automatically update to match the projected cross-section of the linked beam.",
            "cascade": [
              "dWidth",
              "dHeight"
            ]
          },
          {
            "trigger": "User moves the insertion point (_Pt0) while linked to specific TSLs (e.g., RUB-Anker-Aufsatzwand)",
            "effect": "The parent TSL instance moves to maintain the connection, and the script re-calculates to update geometry.",
            "cascade": []
          },
          {
            "trigger": "User changes 'Zone' while linked to specific TSLs (e.g., RUB-GV)",
            "effect": "The Zone property of the linked TSL is updated to match this script's Zone.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "ElemMill / ElemSaw",
            "description": "Machining operation added to the element's production data.",
            "appliedTo": "The specific sheets within the Element that match the 'Zone' parameter."
          },
          {
            "type": "SolidSubtract",
            "description": "3D geometry used to visually represent the void cut out of the sheets in the model.",
            "appliedTo": "Sheets within the Element matching the 'Zone' parameter."
          }
        ]
      },
      "tokens_used": 7867,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch",
          "Check Insertion Cycle (if > 1, erase instance and exit)",
          "Display Properties Dialog (showDialog)",
          "Prompt User to Select Element (getElement)",
          "Prompt User to Pick Insertion Point (getPoint)",
          "Validate Element Exists (if missing, erase instance)",
          "Validate Width and Height (reset if negative/zero)",
          "Process Entity Dependencies (check for Element Override in linked TSLs)",
          "Check Context Menu Triggers (Add/Remove Link)",
          "Check Property Change Events (Point Move or Zone Change)",
          "Calculate Geometry (Loop through linked entities)",
          "Validate Reference Entity (erase if previously linked entity is deleted)",
          "Generate Toolpath (Mill or Saw)",
          "Identify Target Sheets based on Zone Index",
          "Apply Machining Operations (ElemMill/ElemSaw) and Visual Solid"
        ],
        "conditionalBranches": [
          {
            "condition": "User initiates 'Link to Entity' and selects an entity type",
            "path1": {
              "name": "Linked to TSL Instance",
              "steps": [
                "Read TSL Origin or 'ptMount' from Map",
                "Update Opening Position ('_Pt0') to match TSL",
                "Check 'HasSleeve' status (if false, delete self)",
                "Handle specific scripts (e.g., RUB-Anker-Aufsatzwand) for coordinate transforms"
              ]
            },
            "path2": {
              "name": "Linked to Beam",
              "steps": [
                "Check if Beam is NOT parallel to Element X-Axis",
                "Create PLine from Beam Cross-Section",
                "Project Contour onto Element Plane",
                "Verify Projected Contour intersects Element Envelope",
                "Update '_Pt0' to Beam Center",
                "Update 'dWidth' and 'dHeight' to Beam dimensions",
                "Set 'dWidth' and 'dHeight' to Read-Only"
              ]
            }
          },
          {
            "condition": "CNC Tool Selection ('sCNCTool')",
            "path1": {
              "name": "Milling",
              "steps": [
                "Create Offset Toolpath (offset first vertex by 10mm)",
                "Generate 'ElemMill' operation"
              ]
            },
            "path2": {
              "name": "Saw",
              "steps": [
                "Use exact Contour geometry",
                "Generate 'ElemSaw' operation"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Assignment",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases itself if no Element is assigned (_Element.length() < 1). User must re-insert."
          },
          {
            "check": "Width/Height Values",
            "errorMessage": "None (Auto-correct)",
            "recovery": "If Width or Height is changed to < 0.1mm, it is reset to 100mm automatically. If dimensions are invalid during calculation, execution stops to wait for valid input."
          },
          {
            "check": "Reference Entity Integrity",
            "errorMessage": "None (Auto-delete)",
            "recovery": "If the script is linked to an Entity (Beam or TSL) that is deleted, the script erases itself automatically."
          },
          {
            "check": "Beam Intersection",
            "errorMessage": "None (Ignored)",
            "recovery": "If a linked Beam does not intersect the Element's envelope, the link is ignored for geometry generation (preserves existing size/location)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Insertion Point (_Pt0)",
            "how": "Grip Edit / Drag",
            "effect": "Relocates the opening zone. If linked to a specific TSL (e.g., RUB-Anker-Aufsatzwand), the parent TSL is also moved to maintain the connection."
          },
          {
            "action": "Modify Width/Height",
            "how": "Properties Palette (OPM)",
            "effect": "Resizes the rectangular opening. If linked to a Beam, these properties are Read-Only and update automatically based on the Beam size."
          },
          {
            "action": "Change Zone",
            "how": "Properties Palette (OPM)",
            "effect": "Moves the machining operation to a different layer of the wall element. If linked to 'RUB-GV' TSL, the parent TSL's Zone property is also updated."
          },
          {
            "action": "Link to Entity",
            "how": "Right-click Context Menu",
            "effect": "Prompts user to select a Beam or TSL. Establishes a dependency causing dimensions/position to update based on the selected entity."
          },
          {
            "action": "Remove Link",
            "how": "Right-click Context Menu",
            "effect": "Prompts user to select a linked entity to remove the dependency, restoring manual control over dimensions and position."
          }
        ]
      },
      "tokens_used": 10054,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbOpeningZone.mcr\n\n## Overview\nThis script creates a rectangular machining opening (mill or saw cut) within a timber wall or floor element. It is designed for creating service holes or recesses and can dynamically resize itself when linked to crossing beams or other TSL instances.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used for creating 3D machining and visual solids. |\n| Paper Space | No | Not applicable for 2D drawing generation. |\n| Shop Drawing | No | Does not generate 2D views or dimensions directly. |\n\n## Prerequisites\n- **Required Entities**: An existing Element (e.g., CLT panel, stud wall) must exist in the model to apply the opening.\n- **Minimum Beam Count**: 0 (but requires an Element host).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Browse to and select `hsbOpeningZone.mcr`.\n\n### Step 2: Configure Properties\nA properties dialog may appear upon first insertion. You can configure the initial settings here or modify them later in the Properties Palette.\n- **Action**: Review settings for Zone, Width, Height, and Tool type. Click OK to proceed.\n\n### Step 3: Select Element\n```\nCommand Line: Select Element\nAction: Click on the timber wall or floor element where you want the opening to appear.\n```\n- **Note**: If you do not select an element, the script instance will be automatically erased.\n\n### Step 4: Locate Insertion Point\n```\nCommand Line: Specify insertion point\nAction: Click inside the element to place the center of the opening.\n```\n- The opening will be previewed at this location.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| \\|Zone\\| | dropdown | 5 | Specifies the construction layer (Zone index) within the element to cut. Only sheets matching this index will be machined. Range: -5 to 5. |\n| \\|Width\\| | number | 100mm | The width of the rectangular opening. This becomes read-only if linked to a beam. |\n| \\|Height\\| | number | 200mm | The height of the rectangular opening. This becomes read-only if linked to a beam. |\n| \\|Tool\\| | dropdown | \\|Milling\\| | Selects the CNC operation type. Choose between Milling (for pockets) or Saw (for through-cuts). |\n| \\|Tooling Index\\| | number | 0 | Specifies the tool number from the CNC machine library to use for this cut. |\n| \\|Overshoot\\| | dropdown | \\|No\\| | Determines if the tool path should extend beyond the geometry corners (Overcut) to ensure clean cuts. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| \\|Link to Entity\\| | Prompts you to select a beam or another TSL instance. The opening will then update its size and position based on the selected object. |\n| \\|Remove Link\\| | Prompts you to select a currently linked entity to break the dependency, restoring manual control over size and position. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Dynamic Linking**: If you link the opening to a beam crossing the element, the script automatically calculates the width and height based on the beam's cross-section. This is useful for creating precise recesses for joists or beams.\n- **Zone Control**: If working with multi-layer walls (e.g., a stud wall with sheathing), ensure the **Zone** parameter matches the specific layer you wish to cut.\n- **Auto-Cleanup**: If you delete the host element or a linked beam, this script instance will automatically erase itself to prevent errors.\n- **Visual Feedback**: The opening creates a `SolidSubtract` in the 3D model, allowing you to visually verify the cut location before manufacturing.\n\n## FAQ\n- **Q: Why can't I change the Width or Height values?**\n  A: The opening is likely linked to a beam or another TSL instance. Use the \"Remove Link\" context menu option to regain manual control.\n- **Q: Why did the opening disappear from my model?**\n  A: This happens if the host Element was deleted or if a linked entity (like a beam) was removed. You will need to re-insert the script.\n- **Q: What is the difference between Milling and Saw tools?**\n  A: Milling typically creates a pocket or recess (does not go all the way through), while Sawing performs a through-cut. Choose based on your construction requirements."
      },
      "tokens_used": 5764,
      "error": null
    }
  }
}