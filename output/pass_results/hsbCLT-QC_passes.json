{
  "filename": "hsbCLT-QC.mcr",
  "status": "completed",
  "total_tokens": 53559,
  "processing_time": 386.58767652511597,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.7",
            "date": "30.10.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-22166 island strategy will always mill 4 sides, extension mode enhanced"
          },
          {
            "version": "1.6",
            "date": "08.07.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-22166 island strategy revised"
          },
          {
            "version": "1.5",
            "date": "03.07.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-22166 bugfix corner duplex mode"
          },
          {
            "version": "1.4",
            "date": "03.07.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-22166 new bridgin mode and offset property to mill on 4 sides, NOTE not applicable for openings"
          },
          {
            "version": "1.3",
            "date": "10.04.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-21850 bugfix assigning automatic tool indices"
          },
          {
            "version": "1.2",
            "date": "10.04.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-21850 new property 'bridge mode' supports duplex bridging"
          },
          {
            "version": "1.1",
            "date": "21.03.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-21725 placement considers panels nested within openings"
          },
          {
            "version": "1.0",
            "date": "21.03.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-19026 Initial version"
          }
        ],
        "settingsFiles": [
          "hsbCLT-QC.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 8582,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script targets MasterPanel entities and generates tool operations (milling) for CNC production. It explicitly uses `_kModelSpace` in `TslInst.dbCreate` calls. There are no `sd_` or `Multipage` prefixes, and no interaction with `_Viewport` or shop drawing entities (e.g., `#Type E`)."
        },
        "prerequisites": {
          "requiredEntities": [
            "MasterPanel"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbCLT-QC.xml"
          ]
        }
      },
      "tokens_used": 5894,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "insertion",
              "promptOriginal": "Select masterpanels",
              "condition": null,
              "required": true
            }
          ],
          "keywordOptions": [
            {
              "prompt": "Are you sure to overwrite existing settings? [|No|]/[|Yes|]",
              "options": [
                "No",
                "Yes"
              ]
            }
          ]
        },
        "dialogs": [
          {
            "type": "ShowMultilineNotice",
            "trigger": "Script Insertion (if settings version mismatch)",
            "title": null,
            "dataSource": "Internal version comparison",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nQuantity",
            "type": "PropInt",
            "displayName": "|Quantity|",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": "|Specifies the number of test panels that must be generated.|"
          },
          {
            "index": 1,
            "variable": "dLength",
            "type": "PropDouble",
            "displayName": "|Length|",
            "defaultValue": 100,
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the length of the test piece in grain direction|"
          },
          {
            "index": 2,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": 100,
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the width of the test piece in perpendicular to grain direction|"
          },
          {
            "index": 3,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "|Offset|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines an additional offset from the masterpanel edge.| |This offset only applies to outer edges and will be ignored within openings or on inner edges of cut outs.|"
          },
          {
            "index": 4,
            "variable": "dBridgeThickness",
            "type": "PropDouble",
            "displayName": "|Bridge Thickness|",
            "defaultValue": 10,
            "inputType": "number",
            "options": [],
            "category": "|Tooling|",
            "description": "|Small items such as test pieces have a tendency to disrupt tooling devices upon detachment.| |In order to mitigate this issue, it is advisable to maintain a connection to the master by means of a bridge, thus thwarting any inadvertent damage.| |The bridge will consistently"
          },
          {
            "index": 5,
            "variable": "sBridgeMode",
            "type": "PropString",
            "displayName": "|Bridge Mode|",
            "defaultValue": "|None|",
            "inputType": "dropdown",
            "options": [
              "|None|",
              "|Simple|",
              "|Duplex|"
            ],
            "category": "|Tooling|",
            "description": "|Select the bridging strategy for the test pieces. Simple cuts one bridge per side. Duplex cuts two bridges per side to allow nesting with a second masterpanel.|"
          },
          {
            "index": 6,
            "variable": "dToolDiameter",
            "type": "PropDouble",
            "displayName": "|Tool Diameter|",
            "defaultValue": 10,
            "inputType": "number",
            "options": [],
            "category": "|Tooling|",
            "description": "|Sets the diameter for the cutting tool.|"
          },
          {
            "index": 7,
            "variable": "nToolIndex",
            "type": "PropInt",
            "displayName": "|Tool Index|",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": "|Tooling|",
            "description": "|Sets the tool index for the cutting operation. -1 for automatic assignment based on thickness and diameter mapping.|"
          },
          {
            "index": 8,
            "variable": "bDebug",
            "type": "PropInt",
            "displayName": "|Debug|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Enable debug mode for visual verification of calculation steps.|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Stretch Masterpanel|",
            "handler": "|Stretch Masterpanel|",
            "action": "Stretches the masterpanel to fit the QC panel placement.",
            "alsoTriggeredBy": "TslDoubleClick"
          },
          {
            "menuItem": "|Import Settings|",
            "handler": "|Import Settings|",
            "action": "Imports tool mappings from XML file.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Export Settings|",
            "handler": "|Export Settings|",
            "action": "Exports tool mappings to XML file.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Add Tool|",
            "handler": "|Add Tool|",
            "action": "Placeholder for adding tools (commented out).",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "hsbCLT-QC.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings"
            ],
            "purpose": "Stores tool configurations (Thickness, Diameter, Index).",
            "required": false
          }
        ]
      },
      "tokens_used": 8877,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates CNC milling operations to cut quality control (QC) test samples from CLT master panels.",
          "category": "Production / Machining",
          "typicalUseCase": "Used during production planning to extract small material samples for glue bond verification or density testing without wasting the full panel, optionally holding them in place with bridges."
        },
        "parameters": [
          {
            "name": "nQuantity",
            "technicalDefault": "2",
            "businessMeaning": "Specifies the number of test samples (coupons) to generate from the selected master panel.",
            "validRange": "1 - 10 (Limited by panel size)",
            "unit": "count",
            "affectsOutput": "Determines how many separate TSL instances or cutout regions are distributed across the panel surface. If > 1, triggers auto-distribution logic."
          },
          {
            "name": "dLength",
            "technicalDefault": "100",
            "businessMeaning": "Defines the size of the test sample along the panel's grain direction (usually the long axis of the panel).",
            "validRange": "100 mm - 600 mm (Common QC sizes)",
            "unit": "mm",
            "affectsOutput": "Controls the X-axis dimension of the rectangular milling path."
          },
          {
            "name": "dWidth",
            "technicalDefault": "100",
            "businessMeaning": "Defines the size of the test sample perpendicular to the grain direction.",
            "validRange": "100 mm - 600 mm",
            "unit": "mm",
            "affectsOutput": "Controls the Y-axis dimension of the rectangular milling path."
          },
          {
            "name": "dOffset",
            "technicalDefault": "0",
            "businessMeaning": "Additional clearance distance applied to the tool path, typically used to compensate for tool radius or ensure a clean edge finish.",
            "validRange": "0 mm - 20 mm",
            "unit": "mm",
            "affectsOutput": "Shifts the milling contour outward from the theoretical edge. Critical for ensuring the final physical piece matches the exact specified Length/Width after the tool passes."
          },
          {
            "name": "dBridgeThickness",
            "technicalDefault": "10",
            "businessMeaning": "The width of the uncut material tabs (bridges) that hold the test piece to the main panel so it doesn't fall during machining.",
            "validRange": "5 mm - 20 mm",
            "unit": "mm",
            "affectsOutput": "Creates gaps in the milling contour. Too thin and the piece breaks; too thick and it's hard to remove manually."
          },
          {
            "name": "sBridgeMode",
            "technicalDefault": "|None|",
            "businessMeaning": "Strategy for retaining the test piece. 'None' cuts it free. 'Simple' adds one bridge per side. 'Duplex' adds two bridges per side for nesting support.",
            "validRange": "|None|, |Simple|, |Duplex|",
            "unit": "enum",
            "affectsOutput": "Changes the topology of the milling path. Duplex mode allows panels to be stacked/nested face-to-face without the bridges interfering."
          },
          {
            "name": "dToolDiameter",
            "technicalDefault": "10",
            "businessMeaning": "The diameter of the milling cutter (tool bit) used for the operation.",
            "validRange": "6 mm - 40 mm",
            "unit": "mm",
            "affectsOutput": "Used to calculate the path offset. Incorrect diameter leads to undersized or oversized samples."
          },
          {
            "name": "nToolIndex",
            "technicalDefault": "-1",
            "businessMeaning": "The specific tool number in the CNC machine's library. -1 instructs the script to automatically select the tool based on thickness and diameter mappings.",
            "validRange": "-1 (Auto) or Positive Integers",
            "unit": "index",
            "affectsOutput": "Determines which tool is called in the CNC G-code/MPR."
          },
          {
            "name": "bDebug",
            "technicalDefault": "0",
            "businessMeaning": "Visual verification mode that displays geometry and placement without generating final tooling or distributed instances.",
            "validRange": "0 (Off) - 1 (On)",
            "unit": "boolean",
            "affectsOutput": "Suppresses creation of `TslInst` entities and modifies visual display colors/transparency for analysis."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "nQuantity > 1",
            "effect": "The script enters a distribution routine to place multiple copies of the TSL around the master panel, effectively nesting the QC marks.",
            "cascade": [
              "dLength",
              "dWidth",
              "dOffset"
            ]
          },
          {
            "trigger": "nToolIndex = -1",
            "effect": "The script looks up the 'hsbCLT-QC.xml' settings file to find a tool index matching the MasterPanel's thickness and the specified dToolDiameter.",
            "cascade": [
              "dToolDiameter",
              "MasterPanel.Thickness"
            ]
          },
          {
            "trigger": "sBridgeMode = |Duplex|",
            "effect": "Alters the bridge placement geometry to allow for back-to-back nesting of master panels.",
            "cascade": [
              "dBridgeThickness"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Tooling / Contour Milling",
            "description": "A rectangular milling path with optional bridges to cut the QC sample from the stock.",
            "appliedTo": "MasterPanel"
          },
          {
            "type": "TSL Instance",
            "description": "If Quantity > 1, new instances of this script are distributed on the MasterPanel to represent multiple samples.",
            "appliedTo": "ModelSpace (Child of MasterPanel)"
          },
          {
            "type": "SubMap Data",
            "description": "Stores the 'ppQC' profile shape for downstream recognition or other scripts to detect the test area.",
            "appliedTo": "TSL Instance Map"
          }
        ]
      },
      "tokens_used": 10901,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User executes script command.",
          "User selects a MasterPanel entity.",
          "Script loads settings from 'hsbCLT-QC.xml' or Dictionary Object.",
          "Script validates loaded tool mappings (Thickness, Diameter, Index).",
          "Script initializes properties (Geometry, Tooling, Quantity).",
          "Script calculates the initial placement and coordinate system on the panel.",
          "[Conditional Branch] Is Quantity > 1?",
          "If YES (Distribution Mode): Script calculates optimal positions for N instances, creates new TSL instances at those positions, and erases the original script instance.",
          "If NO (Single Instance Mode): Script proceeds to calculate the tool path for one QC sample.",
          "[Conditional Branch] Is Tool Index set to -1 (Auto)?",
          "If YES: Script searches settings for a tool matching the MasterPanel's thickness and the specified tool diameter.",
          "Script generates the milling contour based on Length, Width, and Offset.",
          "[Conditional Branch] Which Bridge Mode is selected?",
          "Script applies the specific bridge geometry (None, Simple, or Duplex) to the contour.",
          "Script assigns the calculated or manual Tool Index to the operation.",
          "Script writes the tooling operation to the MasterPanel.",
          "Script publishes 'ppQC' and 'Shape' SubMaps for downstream usage.",
          "Script draws preview/debug geometry."
        ],
        "conditionalBranches": [
          {
            "condition": "Property 'Quantity' > 1",
            "path1": {
              "name": "Distribution Mode",
              "steps": [
                "Calculate 'Hull' of available space (opening or panel boundary).",
                "Distribute placement points based on N quantity (Linear for 2-4, Radial for >4).",
                "Create child TSL instances at calculated points.",
                "Erase the current (parent) script instance."
              ]
            },
            "path2": {
              "name": "Single Generation Mode",
              "steps": [
                "Proceed with generating geometry for the single insertion point.",
                "Calculate tool path.",
                "Apply bridges.",
                "Output tooling."
              ]
            }
          },
          {
            "condition": "Property 'Tool Index' == -1",
            "path1": {
              "name": "Automatic Tool Assignment",
              "steps": [
                "Retrieve MasterPanel thickness.",
                "Iterate through loaded tool mappings.",
                "Find match for Thickness and 'Tool Diameter'.",
                "Assign resulting Index; defaults to 0 if no match found."
              ]
            },
            "path2": {
              "name": "Manual Tool Assignment",
              "steps": [
                "Use the integer value specified in the 'Tool Index' property directly."
              ]
            }
          },
          {
            "condition": "Context Menu 'Stretch Masterpanel' or Double Click",
            "path1": {
              "name": "Stretch Active",
              "steps": [
                "Collect geometry of current QC instance.",
                "Union with geometry of sibling instances.",
                "Create a bounding rectangle of the union.",
                "Resize the parent MasterPanel to this bounding rectangle.",
                "Restart script execution to re-align."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Tool Mapping Parameters (from XML/Map)",
            "errorMessage": "Invalid parameters detected: Specified Thickness invalid, must be > 0; Specified Diameter invalid, must be > 0; Specified ToolIndex invalid, must be >= 0.",
            "recovery": "User must correct the settings file or import a valid one via 'Import Settings'."
          },
          {
            "check": "Duplicate Tool Thickness",
            "errorMessage": "Thickness already defined: [Value]",
            "recovery": "User must edit the XML settings to remove duplicate thickness entries."
          },
          {
            "check": "Settings File Version Mismatch",
            "errorMessage": "A different Version of the settings has been found for hsbCLT-QC...",
            "recovery": "Script continues with existing settings. User can manually 'Import Settings' to update if desired."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry",
            "how": "OPM Properties Palette",
            "effect": "Changing Length, Width, Offset, or Bridge properties recalculates the milling path and redraws the tooling."
          },
          {
            "action": "Stretch Masterpanel",
            "how": "Context Menu or Double Click",
            "effect": "Resizes the parent MasterPanel to encompass all QC test pieces distributed on it."
          },
          {
            "action": "Update Tool Mappings",
            "how": "Context Menu (Import/Export Settings)",
            "effect": "Updates the internal tool database used for automatic tool index assignment."
          }
        ]
      },
      "tokens_used": 11500,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-QC.mcr\n\n## Overview\nGenerates CNC milling operations to cut quality control (QC) test samples from CLT master panels. It is used during production planning to extract material samples for glue bond verification or density testing, optionally holding them in place with bridges to prevent them from falling into the machine bed.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script targets MasterPanel entities in the 3D model. |\n| Paper Space | No | Not designed for 2D layouts. |\n| Shop Drawing | No | Not intended for generating views or dimensions. |\n\n## Prerequisites\n- **Required Entities**: `MasterPanel` (CLT Panel)\n- **Minimum Beam Count**: 1 (One MasterPanel)\n- **Required Settings Files**: `hsbCLT-QC.xml` (Recommended for automatic tool assignment)\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCLT-QC.mcr` from the list.\n\n### Step 2: Select Masterpanel\n```\nCommand Line: Select masterpanels\nAction: Click on the CLT MasterPanel entity in your drawing where you want to generate the test sample(s).\n```\n\n### Step 3: Configure Properties\nAfter selection, the script attaches to the panel. Open the **Properties Palette** (Ctrl+1) to adjust the size, quantity, and tooling settings for the test pieces.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Quantity** | number | 2 | Specifies the number of test samples to generate. If greater than 1, the script automatically distributes them across the panel. |\n| **Length** | number | 100 | Defines the size of the test piece along the panel's grain direction (in mm). |\n| **Width** | number | 100 | Defines the size of the test piece perpendicular to the grain direction (in mm). |\n| **Offset** | number | 0 | Adds an additional clearance distance from the masterpanel edge. This only applies to outer edges and is ignored within openings. |\n| **Bridge Thickness** | number | 10 | The width of the uncut material tabs holding the piece to the panel. Prevents the piece from falling loose during machining. |\n| **Bridge Mode** | dropdown | None | Strategy for retaining the test piece: **None** (cut free), **Simple** (one bridge per side), or **Duplex** (two bridges per side for nesting). |\n| **Tool Diameter** | number | 10 | The diameter of the milling cutter used for the operation (in mm). |\n| **Tool Index** | number | -1 | The CNC tool number. Set to **-1** for automatic assignment based on the settings file and panel thickness. |\n| **Debug** | number | 0 | Set to **1** to visualize the calculation steps and geometry without generating final tooling. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Stretch Masterpanel** | Automatically resizes the parent MasterPanel to fit the bounding box of all generated QC test pieces. Also triggered by double-clicking the script. |\n| **Import Settings** | Loads tool configuration mappings (Thickness, Diameter, Index) from the `hsbCLT-QC.xml` file. |\n| **Export Settings** | Saves the current tool configuration mappings to the `hsbCLT-QC.xml` file. |\n\n## Settings Files\n- **Filename**: `hsbCLT-QC.xml`\n- **Location**: \n  - `_kPathHsbCompany\\TSL\\Settings`\n  - `_kPathHsbInstall\\Content\\General\\TSL\\Settings`\n- **Purpose**: Stores tool configurations mapping Thickness and Diameter to specific Tool Indices. This allows the script to automatically select the correct CNC tool when `Tool Index` is set to -1.\n\n## Tips\n- **Auto-Distribution**: If you need multiple samples (e.g., for statistical testing), set the **Quantity** property to the desired number (e.g., 4 or 6). The script will automatically calculate the best positions to nest them on the panel.\n- **Prevent Falling Parts**: For small or light test pieces, always use **Bridge Mode: Simple** or **Duplex**. If the piece is cut completely loose, it may shift or get damaged by the CNC spindle.\n- **Nesting Panels**: If you plan to nest two master panels face-to-face on the CNC machine, use **Bridge Mode: Duplex**. The double bridges ensure the panels do not collide when stacked.\n- **Verify Size**: Change the **Debug** property to `1` to see the exact contour and placement before committing to production data.\n\n## FAQ\n- **Q: Why did my test piece disappear?**\n  - A: Check the **Offset** property. If the offset is too large or the placement is near an opening, the geometry might be invalid or moved outside the panel bounds.\n  \n- **Q: How do I change which CNC tool is used?**\n  - A: You can manually enter a specific **Tool Index** in the properties, or ensure `hsbCLT-QC.xml` contains the correct mapping for your panel thickness and set **Tool Index** to `-1`.\n\n- **Q: Can I use this on openings inside the panel?**\n  - A: The script calculates placement based on available space. The **Offset** property only applies to outer edges, not inner edges of cut-outs.\n\n- **Q: What happens if I set \"Quantity\" to 1?**\n  - A: The script generates a single test piece at the insertion point. If you set it higher than 1, the script distributes multiple instances and deletes the original one."
      },
      "tokens_used": 7805,
      "error": null
    }
  }
}