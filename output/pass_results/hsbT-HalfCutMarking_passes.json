{
  "filename": "hsbT-HalfCutMarking.mcr",
  "status": "completed",
  "total_tokens": 51472,
  "processing_time": 370.19340920448303,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"This tsl creates halfcuts at t-connections of 2 beams It can be inserted by element or by beam selection set\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.4\",\n      \"date\": \"04.07.2022\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"HSB-15824: add option {both} for alignment, add beamcut at female beam when negative gap\"\n    },\n    {\n      \"version\": \"1.3\",\n      \"date\": \"23.feb2017\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"new option to stretch male beam dynamically, tool cleanup enhanced\"\n    },\n    {\n      \"version\": \"1.2\",\n      \"date\": \"22.feb2017\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"silent catalog entry based insert supported\"\n    },\n    {\n      \"version\": \"1.1\",\n      \"date\": \"22.feb2017\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"the positive element x-axis expresses the default view direction of horizontal connections within elements\"\n    },\n    {\n      \"version\": \"1.0\",\n      \"date\": \"21.feb2017\",\n      \"author\": \"thorsten"
      },
      "tokens_used": 9136,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly creates instances in ModelSpace using `tslNew.dbCreate(..., _kModelSpace, ...)`. It creates 3D geometry modifications using `HalfCut` and `Cut` tools via `Beam.addTool()`. No ShopDrawing or PaperSpace specific tokens (sd_, _Viewport, Sheet) are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam",
            "Element"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 6966,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity.go()",
              "promptOriginal": "|Select elements and/or beams|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Standard Dialog",
            "trigger": "_bOnInsert (if not silent)",
            "title": "Properties",
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSide",
            "type": "PropString",
            "displayName": "(A)   |Side|",
            "defaultValue": "|Contact face|",
            "inputType": "dropdown",
            "options": [
              "|Contact face|",
              "|Opposite contact face|",
              "|Z-axis|",
              "-|Z-axis|"
            ],
            "category": "|Tooling|",
            "description": "|Defines the Side|"
          },
          {
            "index": 1,
            "variable": "sAlignment",
            "type": "PropString",
            "displayName": "(B)   |Alignment|",
            "defaultValue": "|Left|",
            "inputType": "dropdown",
            "options": [
              "|Left|",
              "|Right|",
              "|Both|"
            ],
            "category": "|Tooling|",
            "description": "|Defines the location of the tool|"
          },
          {
            "index": 0,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "(C)   |Depth|",
            "defaultValue": 4.0,
            "inputType": "number",
            "options": [],
            "category": "|Tooling|",
            "description": "|Specifies the depth of the halfcut|"
          },
          {
            "index": 1,
            "variable": "dGap",
            "type": "PropDouble",
            "displayName": "(D)   |Gap|",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Specifies wether the marking is allowed on non touching beams|"
          },
          {
            "index": 2,
            "variable": "sContact",
            "type": "PropString",
            "displayName": "(E)   |Contact|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Geometry|",
            "description": "|Defines wether the tool should stretch the male beam|"
          },
          {
            "index": 3,
            "variable": "sPosition",
            "type": "PropString",
            "displayName": "(F)   |Position|",
            "defaultValue": "|Outside|",
            "inputType": "dropdown",
            "options": [
              "|Outside|",
              "|Inside|"
            ],
            "category": "|Tooling|",
            "description": "|Defines the Position of the half cut.|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Flip Side|",
            "handler": "|Flip Side|",
            "action": "Swaps the Side property between Contact face/Opposite or Z-axis/-Z-axis",
            "alsoTriggeredBy": "TslDoubleClick"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9136,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates half-cut notches at T-connections between beams, commonly used to support purlins or joists on main beams or walls.",
          "category": "Machining/Joinery",
          "typicalUseCase": "Creating notches in secondary beams (purlins) where they intersect perpendicular main beams or walls."
        },
        "parameters": [
          {
            "name": "sSide",
            "technicalDefault": "|Contact face|",
            "businessMeaning": "Selects which face of the beam receives the notch, typically the top face (Z-axis) for purlins resting on a wall, or the face touching the intersecting beam.",
            "validRange": "Contact face, Opposite contact face, Z-axis, -Z-axis",
            "unit": "Selection",
            "affectsOutput": "Moves the tool to the specified side of the beam cross-section."
          },
          {
            "name": "sAlignment",
            "technicalDefault": "|Left|",
            "businessMeaning": "Controls the lateral placement of the notch along the beam width relative to the connection center.",
            "validRange": "Left, Right, Both",
            "unit": "Selection",
            "affectsOutput": "Calculates cut coordinates on the left or right side, or creates two separate cuts if 'Both' is selected."
          },
          {
            "name": "dDepth",
            "technicalDefault": "4.0",
            "businessMeaning": "The depth of the half-cut notch into the beam material.",
            "validRange": "1.0mm to (Beam Height / 2)",
            "unit": "mm",
            "affectsOutput": "Determines the length of the tool vector cutting into the beam."
          },
          {
            "name": "dGap",
            "technicalDefault": "0.0",
            "businessMeaning": "Tolerance for beam spacing. Positive allows machining on non-touching beams; Negative cuts a recess into the supporting (female) beam.",
            "validRange": "Any Double (Negative implies cut into female beam)",
            "unit": "mm",
            "affectsOutput": "Expands the search volume for intersections; if negative, applies a cut to the female beam."
          },
          {
            "name": "sContact",
            "technicalDefault": "|No|",
            "businessMeaning": "If Yes, physically stretches the male beam to touch the female beam and adds a cut.",
            "validRange": "Yes, No",
            "unit": "Selection",
            "affectsOutput": "Modifies the length of the male beam and adds a 'Cut' tool operation."
          },
          {
            "name": "sPosition",
            "technicalDefault": "|Outside|",
            "businessMeaning": "Defines whether the notch cuts towards the outside or inside of the T-connection angle.",
            "validRange": "Outside, Inside",
            "unit": "Selection",
            "affectsOutput": "Inverts the direction vector of the half-cut tool."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dGap < 0",
            "effect": "Triggers a cut on the female (supporting) beam to receive the male beam.",
            "cascade": [
              "sSide"
            ]
          },
          {
            "trigger": "sContact == Yes",
            "effect": "Stretches the male beam geometry and adds a planar Cut tool.",
            "cascade": [
              "dGap"
            ]
          },
          {
            "trigger": "sAlignment == Both",
            "effect": "Attempts to generate two distinct half-cuts if the contact face geometry allows.",
            "cascade": [
              "sSide",
              "sPosition"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "HalfCut",
            "description": "The primary notch operation on the male beam.",
            "appliedTo": "Male Beam (the beam being notched, typically _Beam[1])"
          },
          {
            "type": "Cut",
            "description": "A planar cut used to shorten the male beam (if Contact=Yes) or recess the female beam (if Gap<0).",
            "appliedTo": "Male Beam or Female Beam depending on parameters"
          },
          {
            "type": "Visualization",
            "description": "Lines and circles indicating the location and depth of the tooling.",
            "appliedTo": "ModelSpace (Drafting entities)"
          }
        ]
      },
      "tokens_used": 8497,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Execution Started",
          "2. Check for Insert Cycle",
          "3. Check Execute Key (Catalog vs Dialog)",
          "4. [Silent Mode] Set properties from Catalog Entry or LastInserted",
          "5. [Dialog Mode] Show Properties Dialog",
          "6. Prompt user to select Elements and/or Beams",
          "7. Separate selection into Male Beams and Elements",
          "8. Calculate Creation Cycles (one per Element + one for loose Beams)",
          "9. Loop through Creation Cycles",
          "10. For each Male Beam in scope, find intersecting Female Beams",
          "11. Refine contact list using Body Intersection and Vector Parallelism",
          "12. Group contacts by Side (Positive X vs Negative X direction)",
          "13. Create TSL Instances for every valid T-connection found",
          "14. Erase the temporary Insertion Instance",
          "15. Initialize Individual Instance Logic (Color, Dependencies)",
          "16. Check for Duplicate Instances (Purge if found)",
          "17. Validate T-Connection Geometry",
          "18. [Contact=Yes] Add Cut tool to Female Beam",
          "19. Calculate Reference Planes and Vectors (Element link adjustment)",
          "20. Loop Alignment Sides (Left/Right or Both)",
          "21. Calculate Cut Locations based on Geometry (Perpendicular vs Skewed)",
          "22. Validate locations against Contact Face Profile",
          "23. [Locations Found] Add HalfCut tool to Male Beam",
          "24. Draw Visualization Geometry",
          "25. [Contact=Yes] Draw Contact Symbol"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Trigger (_bOnInsert)",
            "path1": {
              "name": "Insertion Workflow",
              "steps": [
                "Check Execute Key for silent load",
                "Prompt for Entity Selection",
                "Generate TSL Instances",
                "Erase Self"
              ]
            },
            "path2": {
              "name": "Calculation Workflow",
              "steps": [
                "Load Beam References from _Beam array",
                "Validate Connection",
                "Apply Tools (Cut/HalfCut)",
                "Draw Visuals"
              ]
            }
          },
          {
            "condition": "Execute Key (sKey) found?",
            "path1": {
              "name": "Silent Insert",
              "steps": [
                "Lookup Catalog Entry",
                "Load Properties",
                "Skip Dialog"
              ]
            },
            "path2": {
              "name": "Interactive Insert",
              "steps": [
                "Show Properties Dialog",
                "Wait for User Input",
                "Proceed with Selection"
              ]
            }
          },
          {
            "condition": "Selection Type",
            "path1": {
              "name": "Elements Selected",
              "steps": [
                "Iterate Elements",
                "Get all Beams in Element",
                "Find connections inside Element"
              ]
            },
            "path2": {
              "name": "Loose Beams Selected",
              "steps": [
                "Use selected Beams as Males",
                "Use selected Beams as Females",
                "Find connections between selection set"
              ]
            }
          },
          {
            "condition": "Intersection Geometry (Perpendicular vs Skewed)",
            "path1": {
              "name": "Perpendicular Beams",
              "steps": [
                "Calculate Center Point",
                "Project to Reference Plane",
                "Use single calculated point"
              ]
            },
            "path2": {
              "name": "Skewed Beams",
              "steps": [
                "Extract Contact Face Profile",
                "Calculate Extent in Z",
                "Project specific corner points"
              ]
            }
          },
          {
            "condition": "Gap (dGap) Value",
            "path1": {
              "name": "Positive Gap",
              "steps": [
                "Allow non-touching beams",
                "Marking only (no female cut)"
              ]
            },
            "path2": {
              "name": "Negative Gap",
              "steps": [
                "Calculate Recess",
                "Cut Female Beam (Pocketing)"
              ]
            }
          },
          {
            "condition": "Alignment (sAlignment)",
            "path1": {
              "name": "Left or Right",
              "steps": [
                "Execute logic for single side",
                "Create one HalfCut"
              ]
            },
            "path2": {
              "name": "Both",
              "steps": [
                "Iterate Left logic",
                "Iterate Right logic",
                "Create up to two HalfCuts"
              ]
            }
          },
          {
            "condition": "Context Trigger (Flip Side)",
            "path1": {
              "name": "Flip Action",
              "steps": [
                "Toggle Side Index (0<->1, 2<->3)",
                "Update Property",
                "Set Recalc Loop",
                "Exit Early"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Duplicate TSL Instance",
            "errorMessage": "duplicate will be purged.",
            "recovery": "System automatically erases the new instance. Existing instance handles the connection."
          },
          {
            "check": "Valid T-Connection Geometry",
            "errorMessage": "Invalid connection.",
            "recovery": "Script erases itself. Check beam intersection and ensure they form a T-shape."
          },
          {
            "check": "Dummy Beams",
            "errorMessage": "Invalid connection.",
            "recovery": "Script erases itself. Ensure beams are valid structural members, not construction lines."
          },
          {
            "check": "Valid Tooling Location (Profile Intersection)",
            "errorMessage": "No location found. / Tool will be deleted.",
            "recovery": "Adjust Depth, Side, or Alignment properties. Check if contact face is too small."
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Internal Logic)",
            "recovery": "None. Script ensures it only runs insertion logic once per command."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Parameters",
            "how": "OPM (Object Properties Palette)",
            "effect": "Updates tool geometry (Depth, Position, Gap) and recalculates cuts immediately."
          },
          {
            "action": "Flip Side",
            "how": "Right-click Context Menu 'Flip Side' or Double Click",
            "effect": "Inverts the side property (e.g., Top becomes Bottom) and recalculates the cut."
          },
          {
            "action": "Toggle Contact",
            "how": "OPM Property 'Contact'",
            "effect": "If set to Yes, stretches Male Beam to Female and adds planar Cut. If set back to No, removes stretch but keeps cut geometry if previously added."
          },
          {
            "action": "Change Alignment",
            "how": "OPM Property 'Alignment'",
            "effect": "Switches cut between Left, Right, or Both sides of the connection."
          },
          {
            "action": "Move/Rotate Beams",
            "how": "CAD Grips/Move Commands",
            "effect": "The TSL is linked to beam IDs. If beams move, the TSL detects coordinate changes and recalculates the tool position."
          }
        ]
      },
      "tokens_used": 10637,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbT-HalfCutMarking.mcr\n\n## Overview\nThis script automatically creates half-cut notches at T-connections between two beams (e.g., purlins resting on a main beam or wall). It can be applied to selected elements or individual beams to generate joinery details and markings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in 3D model space. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | Not applicable for 2D drawings. |\n\n## Prerequisites\n- **Required Entities**: Two intersecting beams forming a T-connection (a Male beam crossing a Female beam).\n- **Minimum Beam Count**: 2 (one crossing, one supporting).\n- **Required Settings Files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbT-HalfCutMarking.mcr` from the list.\n\n### Step 2: Configure Properties\nA properties dialog will appear (unless run in silent mode via catalog entry). Adjust settings like depth and alignment here.\n- **Action**: Set your desired options (e.g., Depth, Side) and click OK.\n\n### Step 3: Select Beams or Elements\n```\nCommand Line: Select elements and/or beams\nAction: Click to select the beams or elements containing the T-connections you want to process. Press Enter to confirm.\n```\n\n### Step 4: Generation\nThe script scans the selection, finds valid intersections, and creates the half-cut instances. The temporary insertion instance is removed, and the tooling is applied to the specific beams found.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| (A) Side | dropdown | Contact face | Determines which face of the beam receives the notch (e.g., Top/Z-axis, Bottom/-Z-axis, or the face touching the other beam). |\n| (B) Alignment | dropdown | Left | Sets the lateral placement of the notch: Left, Right, or Both sides of the connection center. |\n| (C) Depth | number | 4.0 mm | Specifies how deep the half-cut notch goes into the beam material. |\n| (D) Gap | number | 0.0 mm | Defines the tolerance for beam spacing. Use 0 for touching beams. Use a positive value for non-touching beams. Use a **negative value** to cut a recess/pocket into the female (supporting) beam. |\n| (E) Contact | dropdown | No | If set to \"Yes\", the script physically stretches the male beam to touch the female beam and adds a planar cut. |\n| (F) Position | dropdown | Outside | Defines whether the notch cuts towards the outside or inside of the T-connection angle. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip Side | Swaps the Side property (e.g., from Top to Bottom) and recalculates the cut. This can also be triggered by double-clicking the TSL instance. |\n\n## Settings Files\nNone required.\n\n## Tips\n- **Negative Gap for Pockets**: If you need the supporting beam to have a pocket (recess) for the crossing beam to sit in, enter a negative value for the **Gap** parameter (e.g., -10mm).\n- **Batch Processing**: You can select an entire Element (wall/floor) to process all internal purlin connections at once.\n- **Dynamic Updates**: If you move the beams using AutoCAD grips or move commands, the TSL will detect the movement and automatically recalculate the cut positions.\n- **Both Sides**: Use the **Alignment** \"Both\" option if you need to create two distinct notches on the beam relative to the connection point.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the beams?**\n  A: The script likely found duplicate instances already assigned to those beams or detected invalid geometry. Check that the beams actually form a T-connection and are not just crossing in the same plane.\n  \n- **Q: How do I cut a slot into the main beam instead of just notching the purlin?**\n  A: Change the **Gap** property to a negative number. This tells the script to cut into the female (supporting) beam.\n\n- **Q: Can I change the notch from the top face to the bottom face without deleting the script?**\n  A: Yes. Select the script instance (or the beam), open the Properties palette, change the **Side** parameter, or simply double-click the script to trigger the \"Flip Side\" command."
      },
      "tokens_used": 7100,
      "error": null
    }
  }
}