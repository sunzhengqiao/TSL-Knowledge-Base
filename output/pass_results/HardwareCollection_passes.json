{
  "filename": "HardwareCollection.mcr",
  "status": "completed",
  "total_tokens": 47760,
  "processing_time": 395.5764527320862,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.2",
            "date": "19.09.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-22699 new responibilty added, exports to notes"
          },
          {
            "version": "1.1",
            "date": "19.07.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-22439 new commands and properties added"
          },
          {
            "version": "1.0",
            "date": "05.07.2024",
            "author": "Thorsten Huck",
            "changes": "HSB-22374 initial version"
          }
        ],
        "settingsFiles": [
          "HardwareCollection.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 7862,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of `_kModelSpace` in the `FilterTslsByName` function: `ents = Group().collectEntities(true, TslInst(), _kModelSpace);`. The script handles `getPoint` for insertion and manages `HardWrComp` instances, typical of 3D model detailing scripts. No PaperSpace or ShopDrawing specific tokens (`sd_`, `_Viewport`, `#Type E`) found."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "HardwareCollection.xml"
          ]
        }
      },
      "tokens_used": 6616,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": [
            {
              "prompt": "|Are you sure to overwrite existing settings?|",
              "options": [
                "No",
                "Yes"
              ]
            }
          ]
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [
          {
            "menuItem": "|Show Article Dialog|",
            "handler": "|Show Article Dialog|",
            "action": "Displays dialog for selecting hardware collection articles.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Set Dependency|",
            "handler": "|Set Dependency|",
            "action": "Sets the coordinate system dependency for the instance.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Set Alignment|",
            "handler": "|Set Alignment|",
            "action": "Sets the alignment of the hardware component.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Rotate|",
            "handler": "|Rotate|",
            "action": "Rotates the hardware component.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Set Block Definition|",
            "handler": "|Set Block Definition|",
            "action": "Opens a file dialog to select a DWG block for the current article.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Remove Block Definition|",
            "handler": "|Remove Block Definition|",
            "action": "Removes the associated block definition from the current article.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Add Article|",
            "handler": "|Add Article|",
            "action": "Adds a new hardware article definition to the settings.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Edit Article|",
            "handler": "|Edit Article|",
            "action": "Edits the hardware components and block definition of the current article.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Delete Articles|",
            "handler": "|Delete Articles|",
            "action": "Removes selected articles from the settings if they are not in use.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Import Settings|",
            "handler": "|Import Settings|",
            "action": "Imports article definitions from an XML file.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Export Settings|",
            "handler": "|Export Settings|",
            "action": "Exports current article definitions to an XML file.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|TslDoubleClick|",
            "handler": "TslDoubleClick",
            "action": "Triggers the 'Show Article Dialog' command on double-click.",
            "alsoTriggeredBy": "Double Click"
          }
        ],
        "settingsFiles": [
          {
            "filename": "HardwareCollection.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings"
            ],
            "purpose": "Stores the map of hardware articles, including block paths and hardware component properties.",
            "required": false
          }
        ]
      },
      "tokens_used": 7333,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Inserts and manages standardized hardware articles, combining visual representations (DWG blocks) with functional manufacturing data (Hardware Wrapper Components) in the 3D model.\",\n    \"category\": \"Hardware\",\n    \"typicalUseCase\": \"Placing specific fasteners, brackets, or connection plates into a timber structure to ensure accurate visualization in drawings and correct data in production lists (BOM/CAM).\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sArticle (PropString 0)\",\n      \"technicalDefault\": \"\\\"\\\"\",\n      \"businessMeaning\": \"The unique identifier for the specific hardware assembly to be used (e.g., 'Simpson H10', 'Coach Screw M12x200').\",\n      \"validRange\": \"Any string key defined in the loaded 'HardwareCollection.xml' settings file.\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Drives the loading of the specific visual DWG block and the associated hardware component properties (Supplier, Code, Dimensions) attached to the instance.\"\n    },\n    {\n      \"name\": \"Dependency Entity\",\n      \"technicalDefault\": \"None\",\n      \"businessMeaning\": \"The host construction element (typically a beam or wall) to which the hardware is logically attached.\",\n      \"validRange\": \"Any valid Entity handle in ModelSpace.\",\n      \"unit\": \"Entity\",\n      \"affectsOutput\": \"Links the hardware script lifecycle to the host element; useful for propagation and hierarchical organization.\"\n    },\n    {\n      \"name\": \"Block Definition Path\",\n      \""
      },
      "tokens_used": 10239,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Define constants (units, colors), load TslUtilities dialog service methods, and set up file paths for 'HardwareCollection.xml'.",
          "2. Settings Loading: Check for existing Dictionary Object ('hsbTSL', 'HardwareCollection'). If valid, load map. If invalid (or on Insert/Debug), search and load from XML (Company or Install path) and create Dictionary Object.",
          "3. Context Check: Determine if execution is Insertion (_bOnInsert), Recalculation (_bOnRecalc), or Database Creation (_bOnDbCreated).",
          "4. [Insertion Path] User Input: Prompt user for insertion point (pt).",
          "5. [Insertion Path] Dependency Selection: Prompt user to select an entity (Beam/Wall) to attach to, or allow empty selection.",
          "6. [Insertion Path] Article Selection: Invoke 'Show Article Dialog'. If user selects an article, set property sArticle. If user selects 'Add Article', run AddArticleDialog.",
          "7. [Insertion Path] Instance Creation: Create the TSL instance at point pt with the selected properties.",
          "8. [Recalculation Path] Data Retrieval: Fetch the current article map (block path, hardware components) based on the instance's sArticle property.",
          "9. [Recalculation Path] Dependency Logic: If a dependency entity exists, update the script's local coordinate system to match the host.",
          "10. [Recalculation Path] Visual Generation: Insert/Update the DWG Block representation defined in the article settings.",
          "11. [Recalculation Path] Manufacturing Data: Update the HardWrComp array attached to the instance for BOM/CAM export.",
          "12. [Recalculation Path] Interaction Setup: Define and draw grips for moving (translation) and rotating the instance."
        ],
        "conditionalBranches": [
          {
            "condition": "Source of Settings Data",
            "path1": {
              "name": "Dictionary Object Exists",
              "steps": [
                "Read mapSetting from the existing Dictionary Object.",
                "Skip XML file reading unless updating."
              ]
            },
            "path2": {
              "name": "Dictionary Object Missing",
              "steps": [
                "Search for XML in _kPathHsbCompany or _kPathHsbInstall.",
                "Read XML into mapSetting.",
                "Create and persist new Dictionary Object."
              ]
            }
          },
          {
            "condition": "Article Selection Action",
            "path1": {
              "name": "Select Existing",
              "steps": [
                "User picks an article name from the list.",
                "Instance uses the corresponding Block and HardWrComp settings."
              ]
            },
            "path2": {
              "name": "Add New Article",
              "steps": [
                "User triggers 'Add Article' command.",
                "Input requested for Article Name and Component details.",
                "Map is updated with new entry.",
                "Instance is set to the new Article."
              ]
            }
          },
          {
            "condition": "Dependency Entity Status",
            "path1": {
              "name": "Dependency Set",
              "steps": [
                "Script coordinates update based on host entity transformation.",
                "Propagates if host changes."
              ]
            },
            "path2": {
              "name": "No Dependency",
              "steps": [
                "Script retains its local coordinate system.",
                "Position is static unless manually moved via grips."
              ]
            }
          },
          {
            "condition": "Export Settings Overwrite",
            "path1": {
              "name": "File Exists",
              "steps": [
                "Prompt user: 'Are you sure to overwrite existing settings? [No/Yes]'.",
                "If 'Yes', overwrite file. If 'No', cancel export."
              ]
            },
            "path2": {
              "name": "File Does Not Exist",
              "steps": [
                "Proceed directly to write XML file.",
                "Ensure directory structure exists using ValidateBlockPath."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Settings Version Mismatch",
            "errorMessage": "A different Version of the settings has been found for [ScriptName] Current Version: X ... Other Version: Y ... [Path]",
            "recovery": "Notice is reported to the user. The script loads the version found in the drawing/Dict. User should verify manually or re-import if needed."
          },
          {
            "check": "Block Definition Folder",
            "errorMessage": "Implicit error if folder creation fails.",
            "recovery": "Script attempts to create missing folders in `ValidateBlockPath` function using `makeFolder`."
          },
          {
            "check": "Article Deletion Constraint",
            "errorMessage": "[Article Name] refers to instances in the dwg and cannot be deleted.",
            "recovery": "The specific article is not removed from the map. User must remove or change the article property of the instances using it before deleting."
          },
          {
            "check": "File Write Permission (Export)",
            "errorMessage": "Failed to write to [Path] (if file check fails after write).",
            "recovery": "Check file permissions and write protection status."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Hardware Article",
            "how": "Context Menu: 'Show Article Dialog' or Double Click",
            "effect": "Opens a dialog to select a different article, immediately updating the geometry and manufacturing data of the instance."
          },
          {
            "action": "Move Instance",
            "how": "Grip: Point Grip",
            "effect": "Relocates the instance in the model. If not dependent, it moves freely in WCS."
          },
          {
            "action": "Rotate Instance",
            "how": "Context Menu: 'Rotate'",
            "effect": "Prompts for an angle to rotate the hardware component around its Z-axis."
          },
          {
            "action": "Set Dependency",
            "how": "Context Menu: 'Set Dependency'",
            "effect": "Links the instance to a new host element (Beam/Wall), updating its coordinate system to match the host."
          },
          {
            "action": "Set Alignment",
            "how": "Context Menu: 'Set Alignment'",
            "effect": "Aligns the instance to a selected face or plane in the model."
          },
          {
            "action": "Assign Custom Block",
            "how": "Context Menu: 'Set Block Definition'",
            "effect": "Opens file dialog to link a DWG file to the current article, changing its visual representation."
          },
          {
            "action": "Edit Manufacturing Data",
            "how": "Context Menu: 'Edit Article'",
            "effect": "Opens the HardWrComp dialog to modify dimensions, codes, and notes for the current article definition."
          },
          {
            "action": "Manage Global Settings",
            "how": "Context Menu: 'Import Settings' / 'Export Settings'",
            "effect": "Imports configuration from an external XML or exports the current library configuration to XML."
          }
        ]
      },
      "tokens_used": 9553,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HardwareCollection.mcr\n\n## Overview\nThis script manages and inserts standardized hardware articles (such as fasteners, brackets, or connection plates) into the 3D model. It combines visual representations using DWG blocks with functional manufacturing data (Hardware Wrapper Components) to ensure accurate visualization and production listing (BOM/CAM).\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates in the 3D model environment to place hardware components. |\n| Paper Space | No | Not intended for 2D detailing layouts. |\n| Shop Drawing | No | Not intended for generating shop drawings directly. |\n\n## Prerequisites\n- **Required Entities**: None (requires a point for insertion).\n- **Minimum Beam Count**: 0.\n- **Required Settings Files**: `HardwareCollection.xml` (must be located in the Company or Install TSL Settings folder).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HardwareCollection.mcr` from the file browser.\n\n### Step 2: Specify Insertion Point\n```\nCommand Line: Insert point:\nAction: Click in the Model Space to define where the hardware will be placed.\n```\n\n### Step 3: Set Dependency (Optional)\n```\nCommand Line: Select entity (Beam/Wall) or press Enter to continue:\nAction: Select a beam, wall, or other element to link the hardware to. \nNote: If selected, the hardware will move/rotate if the host element changes. Press Enter to place hardware independently.\n```\n\n### Step 4: Select Hardware Article\n```\nDialog: Show Article Dialog\nAction: Select an article from the list (e.g., \"Simpson H10\") to insert it.\nAlternative: Click \"Add Article\" to define a new hardware item on the fly.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sArticle | String | \"\" | The unique identifier (Name) of the hardware article selected from the settings map. Changing this updates the block and manufacturing data. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Show Article Dialog** | Opens the selection list to choose a different hardware article for this instance. (Also triggered by Double-Click). |\n| **Set Dependency** | Allows you to link the hardware to a new host element (Beam/Wall) after insertion. |\n| **Set Alignment** | Aligns the hardware component to a selected face or plane in the model. |\n| **Rotate** | Prompts for an angle to rotate the hardware around its local Z-axis. |\n| **Set Block Definition** | Opens a file dialog to link a specific DWG file as the visual representation for the current article. |\n| **Remove Block Definition** | Removes the DWG block link, leaving only the manufacturing data point. |\n| **Add Article** | Opens a dialog to create a new hardware definition in the current settings. |\n| **Edit Article** | Opens the Hardware Component dialog to modify dimensions, codes, and notes for the currently selected article. |\n| **Delete Articles** | Removes unused articles from the settings library. (Fails if the article is currently used in the drawing). |\n| **Import Settings** | Loads article definitions from an external XML file. |\n| **Export Settings** | Saves the current library of article definitions to an XML file. |\n\n## Settings Files\n\n- **Filename**: `HardwareCollection.xml`\n- **Location**: Searches in `_kPathHsbCompany\\TSL\\Settings` first, then `_kPathHsbInstall\\Content\\General\\TSL\\Settings`.\n- **Purpose**: Stores the library of hardware articles, mapping Article Names to DWG block paths and Hardware Component properties (Supplier, Code, Dimensions, Notes).\n\n## Tips\n- **Dependency Handling**: Always use the \"Set Dependency\" option if the hardware is attached to a beam. This ensures that if the beam is resized or moved, the hardware updates automatically.\n- **Editing Articles**: Use \"Edit Article\" to update manufacturing details (like length or material code) which will then propagate to all instances of that article in the project.\n- **Managing Libraries**: Use \"Export Settings\" to back up your custom hardware library to a shared location so other users can import it.\n\n## FAQ\n\n- **Q: Can I delete an article from the list?**\n  **A:** Only if it is not currently used by any instance in the drawing. If you try to delete an active article, the script will report an error.\n  \n- **Q: How do I change the visual look of a screw?**\n  **A:** Select the hardware instance, right-click, and choose \"Set Block Definition\". Browse to your custom DWG file.\n  \n- **Q: Why did my hardware disappear after I changed the article?**\n  **A:** The new article selection might point to a Block Definition path that does not exist or is empty. Check the file path in \"Edit Article\" or assign a valid block using \"Set Block Definition\"."
      },
      "tokens_used": 6157,
      "error": null
    }
  }
}