{
  "filename": "hsb_HatchSheets.mcr",
  "status": "completed",
  "total_tokens": 27378,
  "processing_time": 298.0591344833374,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "10.11.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Add Spline Hatch"
          },
          {
            "version": "1.1",
            "date": "12.11.2010",
            "author": "",
            "changes": "Filter the sheets by sublabel"
          },
          {
            "version": "1.2",
            "date": "03.19.2013",
            "author": "",
            "changes": "Allow sheets of zone 0 to be hatch"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4916,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly prompts for a Viewport using getViewport(T(\"Select a viewport\")) inside the _bOnInsert block and accesses the first viewport via _Viewport[0]. It retrieves the Model Space to Paper Space coordinate transformation using vp.coordSys() and transforms geometry using ms2ps. The drawing command dpHatch.draw(pp, hatch) executes after transforming the shadow profile to Paper Space coordinates."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Sheet",
            "Viewport"
          ],
          "minimumBeams": 0,
          "requiredSpace": "The script must be executed on a Layout (Paper Space) where a Viewport containing a valid hsbCAD Element exists. The Element must contain Sheets in the specified Zone (or Zone 0).",
          "requiredSettings": []
        }
      },
      "tokens_used": 2016,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "pHatchPattern",
            "type": "PropString",
            "displayName": "Hatch pattern",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_HatchPatterns"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dAngle",
            "type": "PropDouble",
            "displayName": "Hatch Angle",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dHatchScale",
            "type": "PropDouble",
            "displayName": "Hatch Scale",
            "defaultValue": "U(20)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColorHatch",
            "type": "PropInt",
            "displayName": "Hatch Color",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nZones",
            "type": "PropInt",
            "displayName": "Zone to hatch",
            "defaultValue": "1",
            "inputType": "dropdown",
            "options": [
              "0",
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "10"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sComment",
            "type": "PropString",
            "displayName": "Filter Sheet with SubLabel",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Only the sheetings with this comment value will be hatch on the layout of the zone define above"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3414,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically hatches specific cladding or sheeting layers in Paper Space Layouts based on the selected construction zone or sublabel.",
          "category": "ShopDrawing/Annotation",
          "typicalUseCase": "Creating production drawings where specific cladding zones (e.g., external sheathing) need to be visually distinguished with a hatch pattern without manually hatching every outline."
        },
        "parameters": [
          {
            "name": "pHatchPattern",
            "technicalDefault": "_HatchPatterns",
            "businessMeaning": "Defines the visual pattern style (e.g., ANSI31, SOLID, User-defined) used to fill the sheet outlines on the drawing.",
            "validRange": "System dependent AutoCAD hatch patterns",
            "unit": "N/A",
            "affectsOutput": "Changes the visual appearance of the filled area in the layout."
          },
          {
            "name": "dAngle",
            "technicalDefault": "0",
            "businessMeaning": "Sets the rotation angle of the hatch pattern lines relative to the horizontal axis.",
            "validRange": "0 - 360 degrees",
            "unit": "degrees",
            "affectsOutput": "Rotates the hatch pattern applied to the sheet projections."
          },
          {
            "name": "dHatchScale",
            "technicalDefault": "U(20)",
            "businessMeaning": "Controls the spacing or density of the hatch pattern. A higher number makes the pattern larger or more spread out.",
            "validRange": "0.1 - 100+ (depending on pattern requirements)",
            "unit": "Scale factor",
            "affectsOutput": "Adjusts the density/size of the hatch pattern, preventing it from appearing too solid or too dense."
          },
          {
            "name": "nColorHatch",
            "technicalDefault": "1",
            "businessMeaning": "Determines the AutoCAD Color Index (ACI) used to draw the hatch lines.",
            "validRange": "1 - 255",
            "unit": "Color Index",
            "affectsOutput": "Changes the color of the hatched area for plotting or screen visibility."
          },
          {
            "name": "nZones",
            "technicalDefault": "1",
            "businessMeaning": "Selects the specific construction layer (Zone) to hatch. The script maps standard zones (0-5) and specific logical zones (-1 to -5) used for floor cladding or internal finishes.",
            "validRange": "0 to 10 (Dropdown)",
            "unit": "Index",
            "affectsOutput": "Determines which set of physical sheets (by zone) are selected for hatching. Changing this excludes sheets from other zones."
          },
          {
            "name": "sComment",
            "technicalDefault": "\"\"",
            "businessMeaning": "Filters the sheets within the selected zone based on their 'Sublabel' property. Allows hatching only specific material types (e.g., 'PLY' or 'OSB') within a zone.",
            "validRange": "Text String (matching sublabel exactly)",
            "unit": "Text",
            "affectsOutput": "If not empty, reduces the set of hatched sheets to only those matching the sublabel. If empty, all sheets in the zone are hatched."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sComment is populated",
            "effect": "Activates filtering logic on the collection of sheets retrieved by nZones.",
            "cascade": [
              "nZones"
            ]
          },
          {
            "trigger": "nZones selection",
            "effect": "Defines the primary pool of sheets retrieved via el.sheet(nZone).",
            "cascade": [
              "sComment"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Hatch (2D Annotation)",
            "description": "A 2D hatch pattern drawn in Paper Space, representing the projected outline of timber sheets/cladding. The outline is shrunk by 1mm internally to prevent edge overlap issues.",
            "appliedTo": "Paper Space Layout (projected from Model Space Sheets)"
          }
        ]
      },
      "tokens_used": 5188,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched or properties modified (recalc triggered)",
          "Check if creating from database (_bOnDbCreated) -> load catalog values if true",
          "Check if inserting script (_bOnInsert) -> prompt user to select a viewport on the current layout",
          "Display Properties Dialog (showDialog) to allow initial configuration",
          "Validate that a Viewport was selected",
          "Extract the Element linked to the selected Viewport",
          "Validate Element contains beams (arBm.length >= 1)",
          "Calculate the target construction Zone (nZone) based on user selection (mapping UI index 0-10 to logical zones 0-5, -1 to -5)",
          "Retrieve all Sheets belonging to the calculated Zone from the Element",
          "Check Filter Sheet with SubLabel (sComment) property",
          "Transform Sheet geometry from Model Space to Paper Space using Viewport transformation matrix",
          "Create shadow projection of the Sheet body onto a horizontal plane",
          "Shrink the projected profile by 1mm (internal offset) to prevent edge overlap",
          "Draw the Hatch pattern using specified pattern, scale, angle, and color",
          "Script finishes or waits for next property change"
        ],
        "conditionalBranches": [
          {
            "condition": "User input provided in 'Filter Sheet with SubLabel' (sComment)",
            "path1": {
              "name": "Filter Active",
              "steps": [
                "Retrieve sublabel value for each sheet in the selected zone",
                "Compare sheet sublabel with user input (case-insensitive, trimmed)",
                "Add sheet to hatch list only if sublabel matches exactly"
              ]
            },
            "path2": {
              "name": "Filter Inactive",
              "steps": [
                "Add all sheets from the selected zone to the hatch list"
              ]
            }
          },
          {
            "condition": "Viewport selection during Insert",
            "path1": {
              "name": "Viewport Selected",
              "steps": [
                "Store viewport in _Viewport array",
                "Proceed to Element extraction"
              ]
            },
            "path2": {
              "name": "Viewport Not Selected / Cancelled",
              "steps": [
                "_Viewport array remains empty (length 0)",
                "Erase the script instance immediately",
                "Terminate execution"
              ]
            }
          },
          {
            "condition": "Element contains Beams",
            "path1": {
              "name": "Beams Found",
              "steps": [
                "Proceed to calculate Sheet geometry and hatching"
              ]
            },
            "path2": {
              "name": "No Beams Found",
              "steps": [
                "Script terminates (return) without drawing anything"
              ]
            }
          },
          {
            "condition": "Zone Selection (nZones mapping)",
            "path1": {
              "name": "Standard Zones (Index 0-5)",
              "steps": [
                "Maps to logical zones 0, 1, 2, 3, 4, 5",
                "Retrieves standard wall/floor sheets"
              ]
            },
            "path2": {
              "name": "Logical/Floor Zones (Index 6-10)",
              "steps": [
                "Maps to logical zones -1, -2, -3, -4, -5",
                "Retrieves specific floor cladding or internal finish sheets"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "None explicitly shown (Script Erases silently)",
            "recovery": "User must insert the script again and select a valid viewport."
          },
          {
            "check": "Viewport contains valid Element",
            "errorMessage": "None explicitly shown (Script Returns silently)",
            "recovery": "User must select a viewport that displays a valid hsbCAD Element."
          },
          {
            "check": "Element contains Beams",
            "errorMessage": "None explicitly shown (Script Returns silently)",
            "recovery": "Ensure the selected Element is not empty and has structural members."
          },
          {
            "check": "Zone contains Sheets",
            "errorMessage": "None explicitly shown (Loop draws nothing if array empty)",
            "recovery": "Select a Zone that exists in the element, or leave SubLabel filter blank if sheets have different labels."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Hatch Appearance",
            "how": "OPM (Object Properties Manager)",
            "effect": "Updating 'Hatch pattern', 'Hatch Angle', 'Hatch Scale', or 'Hatch Color' properties triggers a redraw of the hatched sheets with new visual settings."
          },
          {
            "action": "Change Filtered Zone",
            "how": "OPM - Modify 'Zone to hatch' dropdown",
            "effect": "Script recalculates and retrieves sheets from the new logical zone, removing hatches from the old zone and adding them to the new zone."
          },
          {
            "action": "Refine Sheet Selection",
            "how": "OPM - Modify 'Filter Sheet with SubLabel' text",
            "effect": "If text is entered, the sheet collection is filtered by the 'Sublabel' attribute. If cleared, all sheets in the zone are re-hatched."
          },
          {
            "action": "Move/Update Viewport",
            "how": "Standard AutoCAD Viewport manipulation",
            "effect": "Since the script relies on _Viewport[0].coordSys(), moving the viewport or changing its view scale will likely require a manual update (recalc) or re-insertion to align the hatches correctly in Paper Space (depending on if the script detects viewport changes automatically)."
          }
        ]
      },
      "tokens_used": 5743,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_HatchSheets.mcr\n\n## Overview\nThis script automates the hatching of sheeting or cladding layers on your Layout (Paper Space). It allows you to visually highlight specific construction zones (like external sheathing or flooring) by projecting their outlines from the model view and applying a customizable hatch pattern directly on the drawing.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed to work on Layout tabs. |\n| Paper Space | Yes | Requires a Viewport displaying an hsbCAD Element. |\n| Shop Drawing | No | This is an annotation tool for Layouts. |\n\n## Prerequisites\n- **Required Entities**: An hsbCAD Element containing sheets/cladding.\n- **Viewport**: A Viewport on a Layout tab that is currently displaying the Element you wish to annotate.\n- **Minimum Beam Count**: None (script checks if element contains geometry).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `hsb_HatchSheats.mcr`.\n\n### Step 2: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the border of the viewport in Paper Space that contains the model you want to hatch.\n```\n\n### Step 3: Configure Hatch\nAction: After selecting the viewport, the script will run. Press `Esc` once to deselect the script if it is highlighted, then select the script instance (or ensure it is selected) to open the **Properties Palette**. Adjust the settings (Zone, Pattern, Color) as needed.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Hatch pattern | dropdown | (Current) | Select the visual style of the hatch (e.g., ANSI31, SOLID). |\n| Hatch Angle | number | 0 | Sets the rotation angle of the hatch pattern (0-360 degrees). |\n| Hatch Scale | number | 20 | Controls the density/size of the hatch pattern. |\n| Hatch Color | number | 1 | Sets the AutoCAD Color Index (ACI) for the hatch lines. |\n| Zone to hatch | dropdown | 1 | Selects the construction layer to hatch. <br>**0-5**: Standard zones.<br>**6-10**: Logical zones (maps to -1 to -5, e.g., for floor cladding). |\n| Filter Sheet with SubLabel | text | (Empty) | Enter a SubLabel (e.g., \"OSB\", \"PLY\") to only hatch sheets with that specific label. Leave empty to hatch all sheets in the zone. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add custom right-click menu items. Use the Properties Palette to modify settings. |\n\n## Settings Files\n- **Filename**: None used.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Filtering Materials**: Use the *Filter Sheet with SubLabel* property if you only want to hatch specific types of sheets within a zone (e.g., hatch only the plywood sheathing, ignoring the rigid insulation in the same zone).\n- **Visual Clarity**: If your hatch looks too solid or too busy, increase the *Hatch Scale* value.\n- **Updating Layouts**: If you move or scale the Viewport after inserting the script, you may need to select the script and toggle a property (like *Hatch Scale*) or use the \"Recalculate\" option to force the hatch to update its position to match the new view.\n- **Zone Mapping**: If you are looking for floor finishes or specific logical layers that don't appear in standard zones, try selecting options 6 through 10 in the *Zone to hatch* dropdown.\n\n## FAQ\n- **Q: I selected the viewport, but no hatch appeared.**\n- A: Check that the selected Element actually contains sheets in the *Zone to hatch* you selected. Also, verify that the *Filter Sheet with SubLabel* isn't filtering out all sheets (try clearing the text).\n- **Q: The hatch pattern is rotated the wrong way.**\n- A: Change the *Hatch Angle* property in the Properties Palette to rotate the pattern lines.\n- **Q: Why is the hatch not perfectly aligned with the sheet edges?**\n- A: The script automatically shrinks the hatch outline by 1mm internally to prevent edge overlap and display issues. This is intentional behavior to ensure drawing cleanliness."
      },
      "tokens_used": 6101,
      "error": null
    }
  }
}