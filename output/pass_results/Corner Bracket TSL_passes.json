{
  "filename": "Corner Bracket TSL.mcr",
  "status": "completed",
  "total_tokens": 28565,
  "processing_time": 244.4810037612915,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3202,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script instantiates `Drill` objects and adds them to beams using `bm.addTool()`, which is a Model Space fabrication operation. It uses `ElementWallSF` entities and `Display dp(-1)` for 3D visualization. It lacks any `sd_` functions, `_Viewport` usage, or 2D dimensioning/drawing logic typical of Paper Space scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (Script attaches to Wall Elements via ElementWallSF)",
          "requiredSettings": []
        }
      },
      "tokens_used": 4189,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3169,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the placement of specific through-drills (27mm and 11mm diameters) at fixed heights on the end studs of a timber wall frame for corner bracket assembly.",
          "category": "Hardware/Machining",
          "typicalUseCase": "Preparing wall panels for the attachment of specific corner brackets or structural fasteners that require precise pre-drilling at standard heights."
        },
        "parameters": [
          {
            "name": "dDiameter27",
            "technicalDefault": "27.0",
            "businessMeaning": "Diameter of the larger set of drill holes intended for main bracket bolts or structural fasteners.",
            "validRange": "20.0 - 40.0",
            "unit": "mm",
            "affectsOutput": "Changes the radius of the Drill objects created at the specified d27mm locations."
          },
          {
            "name": "dDiameter11",
            "technicalDefault": "11.0",
            "businessMeaning": "Diameter of the smaller set of drill holes intended for secondary fasteners, dowels, or alignment pins.",
            "validRange": "8.0 - 16.0",
            "unit": "mm",
            "affectsOutput": "Changes the radius of the Drill objects created at the specified d11mm locations."
          },
          {
            "name": "dLen",
            "technicalDefault": "100.0",
            "businessMeaning": "Visual length of the indicator lines drawn in the CAD view to show drill positions (does not affect drill depth).",
            "validRange": "50.0 - 200.0",
            "unit": "mm",
            "affectsOutput": "Alters the length of the line segments (LineSeg) drawn to visualize the drill centers."
          },
          {
            "name": "d27mmFromBase[] / d27mmFromTop[]",
            "technicalDefault": "108.4, 198.4, 267.4, 273.4, 279.4, 285.4, 291.4, 333.4, 375.4, 381.4, 387.4, 393.4, 399.4, 1144.4",
            "businessMeaning": "Fixed vertical heights (offsets) from the bottom or top of the stud where the 27mm diameter holes are drilled. These correspond to specific bracket mounting heights.",
            "validRange": "Hardcoded (requires script edit to change)",
            "unit": "mm",
            "affectsOutput": "Determines the Y-axis coordinate of the drill points along the stud height."
          },
          {
            "name": "d11mmFromBase[] / d11mmFromTop[]",
            "technicalDefault": "153.4, 560.9, 1110.9",
            "businessMeaning": "Fixed vertical heights (offsets) from the bottom or top of the stud where the 11mm diameter holes are drilled.",
            "validRange": "Hardcoded (requires script edit to change)",
            "unit": "mm",
            "affectsOutput": "Determines the Y-axis coordinate of the drill points along the stud height."
          },
          {
            "name": "User Selection (PrEntity)",
            "technicalDefault": "N/A",
            "businessMeaning": "The wall element(s) to be processed. The script identifies the two end studs (perpendicular beams) of this wall.",
            "validRange": "Valid Timber Wall Elements",
            "unit": "Entity",
            "affectsOutput": "Defines the target beams (end studs) that will receive the drilling operations."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing dDiameter27 or dDiameter11",
            "effect": "Updates the size of the specific drill holes.",
            "cascade": []
          },
          {
            "trigger": "Changing the Hardcoded Offset Arrays",
            "effect": "Relocates the drill positions vertically along the studs.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Drill",
            "description": "Through-holes for bracket assembly. 27mm holes for main structural connections and 11mm holes for secondary connections. Drilled 100mm inwards from the face (X offset) and 400mm deep.",
            "appliedTo": "The first and last beam (end studs) of the selected Wall Element, sorted perpendicular to the wall's X-axis."
          },
          {
            "type": "LineSeg",
            "description": "Visual indicators (markers) displaying the center location of the drilled holes on the 3D model.",
            "appliedTo": "Model Space visualization (Display dp)."
          }
        ]
      },
      "tokens_used": 4726,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launches (Command Start)",
          "2. Check Insertion State (_bOnInsert)",
          "3. [Insertion Mode] Prompt user to select Wall Elements (PrEntity)",
          "4. [Insertion Mode] Parse selected entities into Element list",
          "5. [Insertion Mode] Loop through elements and create a cloned TSL instance for each using dbCreate",
          "6. [Insertion Mode] Erase the original 'command' instance and Exit",
          "7. [Execution Mode] Cloned instance starts: Verify attached element exists",
          "8. [Execution Mode] Cast element to ElementWallSF and validate",
          "9. [Execution Mode] Extract all beams from the wall element",
          "10. [Execution Mode] Filter and sort beams perpendicular to wall X-axis",
          "11. [Execution Mode] Identify the first and last beam in the sorted list (End Studs)",
          "12. [Execution Mode] Loop through identified studs (Base and Top extremes)",
          "13. [Execution Mode] Generate 27mm drills at hardcoded offsets from Base",
          "14. [Execution Mode] Generate 27mm drills at hardcoded offsets from Top",
          "15. [Execution Mode] Generate 11mm drills at hardcoded offsets from Base",
          "16. [Execution Mode] Generate 11mm drills at hardcoded offsets from Top",
          "17. [Execution Mode] Draw visual indicator lines for each drill center",
          "18. [Execution Mode] Assign script to Element Group"
        ],
        "conditionalBranches": [
          {
            "condition": "Check if script is in Insertion Mode (_bOnInsert)",
            "path1": {
              "name": "Insertion Path",
              "steps": [
                "Execute PrEntity selection prompt",
                "Instantiate TSL on selected elements",
                "Erase self"
              ]
            },
            "path2": {
              "name": "Execution Path",
              "steps": [
                "Read attached Element properties",
                "Calculate geometry and generate tools"
              ]
            }
          },
          {
            "condition": "Check if attached Element is valid (ElementWallSF)",
            "path1": {
              "name": "Valid Wall",
              "steps": [
                "Proceed to beam extraction",
                "Filter for end studs"
              ]
            },
            "path2": {
              "name": "Invalid/No Element",
              "steps": [
                "Erase Instance",
                "Stop execution"
              ]
            }
          },
          {
            "condition": "Check Wall Beam Count (bmAll.length())",
            "path1": {
              "name": "Beams Found (>0)",
              "steps": [
                "Filter and Sort beams",
                "Select first and last beam"
              ]
            },
            "path2": {
              "name": "No Beams (<=0)",
              "steps": [
                "Return (Silent failure)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Selection of Entity during Insertion",
            "errorMessage": "None (Script waits for input)",
            "recovery": "User must select at least one entity from the CAD model."
          },
          {
            "check": "Element Type (ElementWallSF)",
            "errorMessage": "None (Instance disappears)",
            "recovery": "Ensure the script is attached to a valid Timber Wall element."
          },
          {
            "check": "Presence of Beams in Wall",
            "errorMessage": "None (Processing stops)",
            "recovery": "Ensure the selected Wall element has generated beams/studs."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Regenerate Machining",
            "how": "Wall Geometry Change / Script Recalculation",
            "effect": "Re-calculates stud positions and drill points based on new wall dimensions."
          },
          {
            "action": "Delete Machining",
            "how": "Erase TSL Instance",
            "effect": "Removes the drill tools and visual markers from the wall."
          },
          {
            "action": "Modify Parameters (Not Available)",
            "how": "N/A - Variables are hardcoded in script",
            "effect": "User cannot change drill diameters or heights via OPM. Script must be edited or replaced to change parameters."
          }
        ]
      },
      "tokens_used": 6536,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Corner Bracket TSL\n\n## Overview\nAutomates the placement of specific through-drills (27mm and 11mm diameters) at fixed heights on the end studs of a timber wall frame for corner bracket assembly. This script prepares wall panels for structural fasteners by applying precise pre-drilling operations.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be run in Model Space and attaches to Wall Elements. |\n| Paper Space | No | Not designed for Shop Drawings or 2D views. |\n| Shop Drawing | No | Operations are applied to the physical model for production. |\n\n## Prerequisites\n- **Required Entities**: `ElementWallSF` (Timber Wall Element).\n- **Minimum Beam Count**: The selected wall element must contain generated beams (studs).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `Corner Bracket TSL.mcr` from the script list.\n\n### Step 2: Select Wall Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the desired Wall Elements in your model and press Enter.\n```\n*Note: The script will automatically process all selected elements.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **(None Exposed)** | N/A | N/A | **No editable properties are displayed in the Properties Palette.**<br><br>However, the script applies the following fixed configurations internally: |\n| **27mm Diameter** | Fixed | 27.0 mm | Size of the main structural holes. |\n| **11mm Diameter** | Fixed | 11.0 mm | Size of the secondary/dowel holes. |\n| **Drill Depths** | Fixed | 400.0 mm | Drills penetrate 400mm into the material. |\n| **Heights (27mm)** | Fixed | Specific Set | Holes placed at offsets 108.4, 198.4, 267.4, etc., from Base/Top. |\n| **Heights (11mm)** | Fixed | Specific Set | Holes placed at offsets 153.4, 560.9, 1110.9 from Base/Top. |\n\n> **Note:** To change drill sizes or heights, the script code must be edited by a TSL developer.\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not add custom options to the right-click context menu. Standard options like *Erase* or *Update* apply. |\n\n## Settings Files\n- No external settings files are used. All configurations are hardcoded within the script.\n\n## Tips\n- **Target Selection**: The script specifically targets the first and last beam (end studs) of the wall element, sorted perpendicular to the wall's X-axis. Intermediate studs are ignored.\n- **Visualization**: Blue indicator lines will appear in the model showing the center points of the drilled holes to help verify placement.\n- **Regeneration**: If you modify the wall geometry (e.g., change height or stud spacing), the machining positions will update automatically upon recalculation.\n\n## FAQ\n- **Q: Why can't I change the drill diameter in the Properties Palette?**\n  - A: The script parameters are not exposed as editable properties. The diameters (27mm and 11mm) are fixed constants in this version of the script.\n- **Q: The script didn't create any holes. What went wrong?**\n  - A: Ensure you selected a valid `ElementWallSF` (Wall) and that the wall has already been generated/expanded to show its internal beams (studs). The script requires valid studs to function.\n- **Q: Can I use this on a single beam?**\n  - A: No, this script is designed to attach to Wall Elements (`ElementWallSF`) and specifically looks for the end studs within that wall assembly."
      },
      "tokens_used": 6743,
      "error": null
    }
  }
}