{
  "filename": "HSB_I-ShowElementQuantity.mcr",
  "status": "completed",
  "total_tokens": 26794,
  "processing_time": 318.3649814128876,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "08.07.2016",
            "author": "AS",
            "changes": "Pilot version."
          },
          {
            "version": "1.01",
            "date": "09.05.2017",
            "author": "David Rueda (david.rueda@hsbcad.com)",
            "changes": "_Pt0 set to elOrg (for easy debug)"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5108,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of `_kModelSpace` in the `dbCreate` function call. The script operates on `Element` entities and uses `assignToElementGroup`, indicating it is designed to annotate 3D model elements rather than generate or modify 2D drawings."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 2824,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity.go",
              "promptOriginal": "Select elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "_bOnInsert && (_kExecuteKey == \"\" || catalogNames.find(_kExecuteKey) == -1)",
            "title": null,
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 1,
            "variable": "prefix",
            "type": "PropString",
            "displayName": "Prefix",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dimStyle",
            "type": "PropString",
            "displayName": "Dimension style",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [],
            "category": "Style",
            "description": null
          },
          {
            "index": 0,
            "variable": "textSize",
            "type": "PropDouble",
            "displayName": "Text size",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": "Style",
            "description": null
          },
          {
            "index": 0,
            "variable": "textColor",
            "type": "PropInt",
            "displayName": "Text color",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": "Style",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4620,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Displays the quantity count of a specific construction element (like a wall or floor panel) as a text label in the 3D model.",
          "category": "Annotation",
          "typicalUseCase": "Used when creating a material list or assembly overview in the model to quickly visualize how many times a specific wall or floor element occurs in the project."
        },
        "parameters": [
          {
            "name": "prefix",
            "technicalDefault": "",
            "businessMeaning": "A custom text label added before the quantity number (e.g., 'Qty:' or 'No.').",
            "validRange": "Any alphanumeric string",
            "unit": "text",
            "affectsOutput": "Changes the text content displayed in the model. Adds context to the numeric quantity."
          },
          {
            "name": "dimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Defines the visual appearance of the text (font, line weight, arrow style) based on the CAD system's standard dimension styles.",
            "validRange": "List of available dimension styles in the drawing/template",
            "unit": "style name",
            "affectsOutput": "Alters the font, line type, and general graphical properties of the quantity label to match company or project standards."
          },
          {
            "name": "textSize",
            "technicalDefault": -1,
            "businessMeaning": "The height of the text label. A value of -1 usually implies using the default setting from the selected dimStyle.",
            "validRange": "Typically 10mm to 100mm for model visibility, or -1 to use style default.",
            "unit": "mm",
            "affectsOutput": "Scales the text label up or down. If too small, it's unreadable; if too large, it obscures the element."
          },
          {
            "name": "textColor",
            "technicalDefault": -1,
            "businessMeaning": "The color index used to draw the text. A value of -1 usually implies using the default setting from the selected dimStyle or layer.",
            "validRange": "AutoCAD color index (1-255) or -1 for default.",
            "unit": "color index",
            "affectsOutput": "Changes the visibility and contrast of the label against the 3D model background and geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dimStyle selection",
            "effect": "Determines the default appearance for textSize and textColor if they are set to -1.",
            "cascade": [
              "textSize",
              "textColor"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text Annotation",
            "description": "A text entity displaying the Element quantity, placed at the element's origin.",
            "appliedTo": "Selected Element(s) in Model Space"
          }
        ]
      },
      "tokens_used": 3428,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launched via Insert command or Execute Key.",
          "2. System checks if an Execute Key (Catalog Entry) triggered the launch.",
          "3. [Conditional] If no valid Execute Key is found, display the Properties Dialog to user.",
          "4. Prompt user to select Elements (e.g., walls or floors) using PrEntity.",
          "5. [Conditional] If user makes a valid selection, proceed; otherwise, exit and erase temporary instance.",
          "6. Iterate through every selected Element.",
          "7. For each Element, generate a new script instance linked to that Element in Model Space.",
          "8. Erase the original temporary script instance used for selection.",
          "9. **Instance Execution**: Verify the linked Element is valid.",
          "10. Retrieve Element's coordinate system (Origin, X, Y, Z vectors) and quantity data.",
          "11. Construct display text combining 'Prefix' property and 'Element Quantity'.",
          "12. Draw the text annotation at the Element origin, aligned to Element axes."
        ],
        "conditionalBranches": [
          {
            "condition": "Check for Execute Key / Catalog usage",
            "path1": {
              "name": "Standard Insert",
              "steps": [
                "Prompt shows Properties Dialog.",
                "User enters Prefix, Style, etc. manually.",
                "Proceed to selection."
              ]
            },
            "path2": {
              "name": "Catalog Insert",
              "steps": [
                "Execute Key matches a Catalog Name.",
                "Properties are loaded from Catalog.",
                "Skip Dialog.",
                "Proceed to selection."
              ]
            }
          },
          {
            "condition": "Text Size configuration",
            "path1": {
              "name": "Custom Size",
              "steps": [
                "User sets 'textSize' > 0.",
                "Display uses specific numeric height."
              ]
            },
            "path2": {
              "name": "Default Size",
              "steps": [
                "User leaves 'textSize' at -1 (default).",
                "Display uses height defined in 'dimStyle'."
              ]
            }
          },
          {
            "condition": "Element Validation",
            "path1": {
              "name": "Valid Element",
              "steps": [
                "Element exists and is valid.",
                "Script calculates geometry and draws text."
              ]
            },
            "path2": {
              "name": "Invalid Element",
              "steps": [
                "Element array is empty or invalid.",
                "Script reports warning.",
                "Script instance erases itself."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Check if _Element array contains valid data.",
            "errorMessage": "invalid or no element selected.",
            "recovery": "The script instance will self-delete. User must re-run the selection process or ensure the target element is not deleted."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Text Appearance",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing 'prefix', 'dimStyle', 'textSize', or 'textColor' updates the text entity immediately in the model."
          },
          {
            "action": "Update Quantity",
            "how": "System Calculation (Element update)",
            "effect": "If the Element's quantity property changes (e.g., due to design changes), the text label automatically updates to reflect the new number."
          },
          {
            "action": "Move Label",
            "how": "Move Source Element / Grips",
            "effect": "The label is assigned to the Element group. Moving the Element moves the label automatically to the new Element origin."
          }
        ]
      },
      "tokens_used": 5403,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_I-ShowElementQuantity.mcr\n\n## Overview\nThis script creates a text annotation in the 3D model that displays the quantity count of a selected construction element (such as a wall or floor panel). It helps visualize how many times a specific element is used in the project directly in the model view.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model environment. |\n| Paper Space | No | Not supported for 2D drawings. |\n| Shop Drawing | No | Not supported for shop drawings. |\n\n## Prerequisites\n- **Required Entities**: An existing Element (Wall, Floor, or Roof) in the model.\n- **Minimum Beam Count**: 0 (This script works on Elements, not individual beams).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_I-ShowElementQuantity.mcr` from the list.\n\n### Step 2: Configure Properties\n- **Action**: If you are not using a pre-set catalog entry, a dialog will appear.\n- **Settings**:\n  - Enter a **Prefix** if desired (e.g., \"Qty: \" or \"No. \").\n  - Select a **Dimension style** to control the text appearance.\n  - Set specific **Text size** and **Text color** if you want to override the dimension style defaults (leave as -1 to use defaults).\n- Click **OK** to proceed.\n\n### Step 3: Select Element\n```\nCommand Line: Select elements\nAction: Click on the desired Wall, Floor, or Roof element in the drawing area.\n```\n- Select one or multiple elements to label.\n- Press **Enter** or **Right-Click** to confirm selection.\n\n### Step 4: Placement\n- The script will automatically generate a text label at the origin (insertion point) of the selected element(s).\n- The label will display the element's quantity (e.g., \"Qty: 2\").\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Prefix | text | | Custom text added before the quantity number (e.g., \"Qty: \"). |\n| Dimension style | dropdown | _DimStyles | The CAD standard style that defines the font and line type for the text. |\n| Text size | number | -1 | The height of the text. Enter a value in mm, or leave as -1 to use the Dimension style default. |\n| Text color | number | -1 | The color of the text (AutoCAD Color Index). Leave as -1 to use the Dimension style default. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific custom options to the right-click menu. Use the Properties palette to modify settings. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A (This script relies on standard CAD Dimension Styles).\n\n## Tips\n- **Prefix Usage**: Use the \"Prefix\" property to distinguish between different types of labels in the same model (e.g., \"Walls: \" vs \"Floors: \").\n- **Visibility**: If the text is too small to see, increase the **Text size** property or check your current view zoom level.\n- **Movement**: The label is assigned to the Element. If you move the element using grips or the Move command, the label will move with it automatically.\n- **Style Consistency**: Keep **Text size** and **Text color** set to -1 to ensure your labels automatically update if you change your project's global Dimension style.\n\n## FAQ\n- **Q: Where exactly is the label placed?**\n  A: The label is placed at the element's origin (elOrg), which is usually the insertion point defined when the element was created or drawn.\n- **Q: Can I change the text after inserting it?**\n  A: Yes. Select the label in the model, open the **Properties (OPM)** palette, and modify the \"Prefix\" or other style settings. The label will update immediately.\n- **Q: What does \"-1\" mean for size and color?**\n  A: A value of -1 tells the script to ignore the manual setting and use whatever is defined in the selected \"Dimension style\". This is useful for maintaining consistent drafting standards.\n- **Q: The number is wrong. How do I fix it?**\n  A: The script displays the internal quantity of the Element. You must modify the Element properties (e.g., in hsbCAD Element Manager) to change the actual quantity; the label will update automatically."
      },
      "tokens_used": 5411,
      "error": null
    }
  }
}