{
  "filename": "GE_WDET_CLEANUP_KING_OVERLAP.mcr",
  "status": "completed",
  "total_tokens": 29798,
  "processing_time": 623.0980610847473,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "15.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Copied from hsb_CleanupOverlapWithRipStud, to keep US content folder naming standards\n- Thumbnail added"
          },
          {
            "version": "1.2",
            "date": "15.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Version control from 1.0 to 1.2, to keep updated with hsb_CleanupOverlapWithRipStud"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4396,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses `PrEntity` to select `ElementWallSF` and performs 3D geometric operations such as `el.beam()`, `bm.realBody()`, `transformBy()`, and `setD()` on `Beam` objects. No `sd_` prefix, `_Viewport` handling, or `Sheet` generation logic found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Wall Elements",
          "requiredSettings": []
        }
      },
      "tokens_used": 3815,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one or More Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5172,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically resolves framing conflicts in Wall Elements by trimming King Studs (identified as Modules) to fit within wall boundaries and trimming/moving adjacent standard studs to prevent overlaps with these King Studs.",
          "category": "Framing / Automation",
          "typicalUseCase": "Used after modifying wall dimensions or inserting King Stud sub-assemblies (modules) to clean up the surrounding frame geometry, ensuring studs butt correctly against king studs and do not extend past wall plates."
        },
        "parameters": [
          {
            "name": "_Element",
            "technicalDefault": "Empty (User Selection)",
            "businessMeaning": "The specific Wall Elements (Model Space) that require cleanup of King Stud overlaps and boundary conditions.",
            "validRange": "1 or more Wall Elements",
            "unit": "Selection Set",
            "affectsOutput": "Defines the scope of the script. Only beams within the selected elements are analyzed for King Studs and overlap conditions."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Script execution",
            "effect": "Filters beams within selected elements based on specific type and properties.",
            "cascade": [
              "Beam Type",
              "Beam Module Property"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam Geometry Modifications",
            "description": "Standard studs adjacent to King Studs are moved and shortened to eliminate overlap. King Studs extending past wall boundaries are shortened to fit flush with the wall plates or erased if entirely outside.",
            "appliedTo": "Standard Beams (Studs) and King Studs (Modules) within the selected Wall Elements."
          }
        ]
      },
      "tokens_used": 5610,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch / Insertion",
          "Check: Is insertCycleCount > 1?",
          "If Yes: Erase script instance and exit.",
          "If No: Display dialog (if needed).",
          "Prompt User to Select Wall Elements (ElementWallSF).",
          "Store selected Elements in _Element array.",
          "Script ends initial insertion phase and waits for recalculation.",
          "Recalculation / Execution Phase Start",
          "Check: Is _Element array empty?",
          "If Yes: Erase script instance and exit.",
          "If No: Iterate through each selected Element.",
          "Initialize Element Coordinate System and Geometry (Min/Max Segment).",
          "Collect all Beams within the Element.",
          "Filter Beams: Select those perpendicular to Element X-axis (Verticals).",
          "Construct 'Outside' Profile (Regions beyond Start and End of Wall).",
          "Classify Beams: Filter for King Studs (Modules) vs. Standard Studs.",
          "Loop through each King Stud (Module).",
          "Calculate Shadow Profiles and Dimensions.",
          "Filter for neighboring standard studs (excluding current King Stud).",
          "Loop through neighboring standard studs.",
          "Check: Is neighbor a standard stud (Module is empty)?",
          "If Yes: Calculate overlap area with King Stud.",
          "Check: Is overlap area > 5 mm²?",
          "If Yes: Transform (Move) neighbor stud half the overlap distance.",
          "Resize neighbor stud length by subtracting overlap amount.",
          "End Loop through neighbors.",
          "Boundary Check: Does King Stud intersect with 'Outside' Profile?",
          "If Yes: Calculate intersection area.",
          "Check: Is King Stud entirely outside (Area difference < 0.5)?",
          "If Yes: Mark King Stud for Erasure.",
          "If No (Partial): Calculate width to reduce.",
          "Determine cut direction relative to Wall Center.",
          "Transform (Move) King Stud to keep it inside boundary.",
          "Resize King Stud width.",
          "End Boundary Check.",
          "End Loop through King Studs.",
          "Erase all beams marked in bmToErase array.",
          "End Loop through Elements.",
          "Check: Was _bOnElementConstructed triggered?",
          "If Yes: Erase script instance and exit.",
          "Script Finish."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase Instance",
                "Return (Exit)"
              ]
            },
            "path2": {
              "name": "Cycle = 1",
              "steps": [
                "Show Dialog (once)",
                "PrEntity Prompt (Select Elements)",
                "Store Elements",
                "Return (Wait for Recalc)"
              ]
            }
          },
          {
            "condition": "Element Selection Validation",
            "path1": {
              "name": "No Elements Selected",
              "steps": [
                "Erase Instance",
                "Exit"
              ]
            },
            "path2": {
              "name": "Elements Selected",
              "steps": [
                "Process Beams in Elements",
                "Perform Cleanup Operations"
              ]
            }
          },
          {
            "condition": "Beam Classification",
            "path1": {
              "name": "King Stud (Module + Type Match)",
              "steps": [
                "Add to bmModules array",
                "Processed as Master/Reference beam"
              ]
            },
            "path2": {
              "name": "Standard Stud",
              "steps": [
                "Add to bmValids array",
                "Processed as Dependent/Moveable beam"
              ]
            }
          },
          {
            "condition": "Neighbor Overlap Check (Standard Stud vs King Stud)",
            "path1": {
              "name": "Overlap Detected (> 5mm²)",
              "steps": [
                "Calculate Move Distance",
                "Move Stud away from King Stud",
                "Shorten Stud Length"
              ]
            },
            "path2": {
              "name": "No Overlap",
              "steps": [
                "Skip Stud"
              ]
            }
          },
          {
            "condition": "King Stud Boundary Check (vs Outside Profile)",
            "path1": {
              "name": "Entirely Outside Wall",
              "steps": [
                "Mark for Erasure"
              ]
            },
            "path2": {
              "name": "Partially Outside / Crossing Boundary",
              "steps": [
                "Calculate protruding width",
                "Calculate Direction to Wall Center",
                "Resize Width",
                "Shift Position"
              ]
            },
            "path3": {
              "name": "Inside Wall",
              "steps": [
                "No Modification"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "insertCycleCount > 1",
            "errorMessage": "None (Silent Exit)",
            "recovery": "N/A - Prevents recursive loops."
          },
          {
            "check": "_Element.length() == 0 after selection",
            "errorMessage": "None (Silent Exit)",
            "recovery": "User must run the command again and select valid elements."
          },
          {
            "check": "Element Validity (el.bIsValid())",
            "errorMessage": "None",
            "recovery": "Script skips invalid elements in the loop."
          },
          {
            "check": "Beam Classification (bm.module() != \"\" && bm.type() == _kKingStud)",
            "errorMessage": "None",
            "recovery": "If beams don't meet this criteria, they are treated as standard studs (valids) or ignored (horizontal)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Automatic Geometry Recalculation",
            "how": "Script triggers on recalculation (implicit TSL behavior).",
            "effect": "Re-runs the overlap and boundary cleanup logic if the wall or studs change."
          },
          {
            "action": "Context Menu / Recalc",
            "how": "Right-click -> Recalculate (if instance remains, though script attempts self-erasure on construct).",
            "effect": "Re-applies trimming logic to current geometry."
          }
        ]
      },
      "tokens_used": 5667,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_WDET_CLEANUP_KING_OVERLAP.mcr\n\n## Overview\nThis script automatically resolves framing conflicts in Wall Elements by adjusting King Studs and surrounding standard studs. It ensures King Studs (defined as specific Modules) fit within wall boundaries and trims or moves adjacent studs to eliminate overlaps.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script is designed for use in the 3D Model environment. |\n| Paper Space | No | Not intended for layout or detailing views. |\n| Shop Drawing | No | This script modifies 3D model geometry, not 2D drawings. |\n\n## Prerequisites\n- **Required Entities**: Wall Elements (`ElementWallSF`) containing beams.\n- **Specific Content**: The Wall Elements must contain King Studs defined as \"Modules\" with the specific Type property matching the script's internal criteria (typically `type() == _kKingStud`).\n- **Minimum Beam Count**: Not applicable (Script processes existing beams).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** Type `TSLINSERT` in the command line and press Enter.\n**Action:** In the file dialog, navigate to the script location and select `GE_WDET_CLEANUP_KING_OVERLAP.mcr`.\n\n### Step 2: Select Wall Elements\n**Command Line:** `Select one or More Elements`\n**Action:** Click on the Wall Elements in your model that contain the King Studs you wish to clean up. You can select multiple elements.\n**Completion:** Press Enter to confirm selection and run the script.\n\n**Note:** The script will process the geometry, modify the beams, and then automatically erase its own instance from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| None | N/A | N/A | This script does not expose user-editable properties in the Properties Palette. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | The script executes immediately upon insertion and erases itself. There are no persistent right-click menu options for an active instance. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not rely on external XML settings files. It operates based on the geometric properties of the selected elements and beams.\n\n## Tips\n- **Catalog Setup**: Ensure your King Studs are defined in the catalog as Modules. The script identifies King Studs specifically by checking if a beam has a Module name and matches the specific Type property. Standard studs are treated as \"valids\" and will be moved/trimmed to accommodate King Studs.\n- **Post-Insertion**: This tool is best used after modifying wall dimensions or inserting King Stud sub-assemblies to clean up the resulting overlaps automatically.\n- **Boundary Handling**: If a King Stud is found partially outside the wall plate boundaries, the script will resize it to fit. If it is entirely outside, the script will erase it.\n\n## FAQ\n- **Q: Why did the script disappear after I ran it?**\n  - A: This is designed behavior. The script runs as a \"command\" script. Once the cleanup calculations are performed and the beams are modified, the script instance deletes itself to keep the drawing clean.\n- **Q: The script didn't move a stud that is overlapping my King Stud. Why?**\n  - A: The script only moves beams classified as \"Standard Studs\". If the overlapping beam is also defined as a King Stud (Module) or a different type, it may not be moved. Ensure your beam types in the catalog are correctly assigned.\n- **Q: What happens if the wall is shortened and the King Stud is now too long?**\n  - A: The script detects if a King Stud extends past the \"Outside Profile\" of the wall. It will shorten the King Stud width to ensure it remains fully within the wall boundaries."
      },
      "tokens_used": 5138,
      "error": null
    }
  }
}