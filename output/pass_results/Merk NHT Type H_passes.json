{
  "filename": "Merk NHT Type H.mcr",
  "status": "completed",
  "total_tokens": 33514,
  "processing_time": 227.0477433204651,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4596,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No sd_* or Multipage prefix found. No _Viewport logic found. The script defines 3D geometry (Body, House, Drill) and manipulates GenBeams (_Beam0, _Beam1) directly in the model. It also generates dxaout and BOM data, which are typical for model-space detailing/processing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space containing at least two beams where the script creates a connection (NHT hanger/connector).",
          "requiredSettings": []
        }
      },
      "tokens_used": 2739,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 1,
            "variable": "sAutoSelect",
            "type": "PropString",
            "displayName": "Auto Select",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDrillNail",
            "type": "PropString",
            "displayName": "Drill Nailhole",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dSPN",
            "type": "PropDouble",
            "displayName": "Diameter Nailhole",
            "defaultValue": 6.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dZOff",
            "type": "PropDouble",
            "displayName": "Z-Offset",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 9,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "ListNr",
            "type": "PropInt",
            "displayName": "NHT Nr.",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4106,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a Type H NHT (Nagelplatte/Hanger) steel connector to join two timber beams, creating the necessary cutouts, drillings, and hardware symbols.",
          "category": "Hardware/Connection",
          "typicalUseCase": "Used when connecting a timber joist or post (Beam 0) to a main supporting beam (Beam 1) using a specific Type H heavy-duty hanger plate."
        },
        "parameters": [
          {
            "name": "sAutoSelect",
            "technicalDefault": "Yes",
            "businessMeaning": "Filters the available hanger sizes based on the height of the target beam to ensure fit.",
            "validRange": "No, Yes",
            "unit": "Boolean/String",
            "affectsOutput": "If 'Yes', the 'NHT Nr.' dropdown only shows hanger sizes compatible with the beam height. If 'No', all sizes are shown regardless of beam height."
          },
          {
            "name": "sDrillNail",
            "technicalDefault": "No",
            "businessMeaning": "Determines whether to create a nailing hole in the supported beam for additional fixation.",
            "validRange": "No, Yes",
            "unit": "Boolean/String",
            "affectsOutput": "If 'Yes', a diagonal nail hole (diameter dSPN) is drilled into the first beam. If 'No', only the main connection hole is drilled."
          },
          {
            "name": "dSPN",
            "technicalDefault": "6.0",
            "businessMeaning": "Diameter of the optional nailing hole.",
            "validRange": "4.0 - 12.0 (typical timber screw/nail diameters)",
            "unit": "mm",
            "affectsOutput": "Changes the diameter of the drill operation (bdr2) on the first beam. Only active if 'Drill Nailhole' is Yes."
          },
          {
            "name": "dZOff",
            "technicalDefault": "0.0",
            "businessMeaning": "Vertical adjustment (offset) of the hanger position relative to the beam center.",
            "validRange": "-100.0 - 100.0",
            "unit": "mm",
            "affectsOutput": "Moves the entire hanger assembly (metal plate, cutouts, and holes) up or down along the Z-axis of the beam."
          },
          {
            "name": "nColor",
            "technicalDefault": "9",
            "businessMeaning": "Display color of the hanger visualization and text in the CAD model.",
            "validRange": "0 - 255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Only affects the visual representation (layer color) of the generated Body and Text, not the geometry itself."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "The dimension style used for the label text displaying the hanger size.",
            "validRange": "Any existing Dimension Style name in the drawing",
            "unit": "String",
            "affectsOutput": "Controls the font, size, and arrow style of the 'NHT [Height]' text label."
          },
          {
            "name": "ListNr",
            "technicalDefault": "Dynamic (based on sAutoSelect)",
            "businessMeaning": "The specific part number/height of the NHT hanger to be generated (e.g., 240mm, 220mm).",
            "validRange": "120 - 240 (depends on sAutoSelect and beam height)",
            "unit": "mm (Height of hanger)",
            "affectsOutput": "Controls the height (GF) of the steel plate, the quantity of screws associated with the hardware, and the depth/position of the cutouts."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sAutoSelect changes from 'Yes' to 'No'",
            "effect": "The 'ListNr' dropdown population changes from a filtered list (specific to beam height) to a full list of available sizes (120, 140...240).",
            "cascade": [
              "ListNr"
            ]
          },
          {
            "trigger": "ListNr changes",
            "effect": "Updates the internal variable 'GF' (Hanger Height) and 'SStk' (Screw Count) used for BOM and geometry generation.",
            "cascade": [
              "Geometry (Body height)",
              "BOM Data (Screw count)"
            ]
          },
          {
            "trigger": "sDrillNail is set to 'No'",
            "effect": "The parameter dSPN is ignored in the script logic.",
            "cascade": [
              "dSPN"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "MetalPart (Body)",
            "description": "A 3D solid representing the Type H NHT steel hanger plate. Includes vertical plate geometry and a base seat.",
            "appliedTo": "Model Space (Generated at intersection point)"
          },
          {
            "type": "House (Mortise)",
            "description": "A rectangular subtraction in the main beam to accommodate the thickness of the steel hanger.",
            "appliedTo": "_Beam1 (The supporting beam)"
          },
          {
            "type": "Drill (Hole)",
            "description": "A large vertical clearance hole (approx 31.5mm) through the supported beam.",
            "appliedTo": "_Beam0 (The supported beam)"
          },
          {
            "type": "Drill (Optional Nail Hole)",
            "description": "A diagonal hole for a nail or screw, toggled by 'Drill Nailhole'.",
            "appliedTo": "_Beam0 (The supported beam)"
          },
          {
            "type": "Cut (Notch)",
            "description": "A planar cut on the supported beam to align with the hanger geometry.",
            "appliedTo": "_Beam0 (The supported beam)"
          },
          {
            "type": "Text/Symbol",
            "description": "A label displaying 'NHT [Height]' and dimensions for shop drawings.",
            "appliedTo": "Model Space"
          },
          {
            "type": "BOM/Hardware Data",
            "description": "Exports data (Name, Material, Screw count) to production lists and element maps.",
            "appliedTo": "Element linked to _Beam1"
          }
        ]
      },
      "tokens_used": 6870,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Execution Started",
          "2. Properties Initialized (Auto Select, Drill Nailhole, Diameter Nailhole, Z-Offset, Color, Dimstyle)",
          "3. Evaluate 'Auto Select' property to determine available 'NHT Nr.' (ListNr) options",
          "4. [Conditional] Populate 'ListNr' dropdown based on beam height (H0) if 'Auto Select' is Yes, or show full list if No",
          "5. User selects 'NHT Nr.' from the populated dropdown",
          "6. Script maps 'ListNr' selection to Hanger Height (GF) and Screw Count (SStk)",
          "7. Calculate key geometric points (ptm1, ptm2, etc.) based on GF and Z-Offset",
          "8. Generate Cut tool on _Beam0 (Supported Beam)",
          "9. Generate House tool on _Beam1 (Supporting Beam) to create mortise",
          "10. Construct Body (Steel Plate) with primary drilling holes",
          "11. Apply main Drill (bdr1) to _Beam0",
          "12. [Conditional] Apply secondary Drill (bdr2) to _Beam0 if 'Drill Nailhole' is Yes",
          "13. Generate BOM and Element Map data based on calculated GF and SStk",
          "14. Display Body (Metal Part) and Label text"
        ],
        "conditionalBranches": [
          {
            "condition": "Check 'Auto Select' property value",
            "path1": {
              "name": "Manual Mode (No)",
              "steps": [
                "Script populates 'NHT Nr.' list with static full range (240, 220, 200, 180, 160, 140, 120)",
                "User can select any size regardless of beam geometry"
              ]
            },
            "path2": {
              "name": "Auto Mode (Yes)",
              "steps": [
                "Script compares Beam 0 height (_H0) against defined ranges (e.g., 258-280mm)",
                "Populates 'NHT Nr.' list with compatible sizes only (e.g., only 240 and 220 for a 260mm beam)",
                "Limits user selection to prevent hanger from being too tall for the beam"
              ]
            }
          },
          {
            "condition": "Check 'Drill Nailhole' property value",
            "path1": {
              "name": "Yes (Drill)",
              "steps": [
                "Script executes Drill bdr2 command",
                "Diagonal hole (Diameter dSPN) is created in _Beam0"
              ]
            },
            "path2": {
              "name": "No (Skip)",
              "steps": [
                "Script skips Drill bdr2 command",
                "No diagonal hole is created"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Height vs Hanger Size (Auto Mode)",
            "errorMessage": "Implicitly handled via empty dropdown. If beam height is outside the defined ranges (e.g., <138mm or >280mm), the 'NHT Nr.' dropdown may remain empty or limited.",
            "recovery": "User must either set 'Auto Select' to 'No' to pick a size manually, or modify the beam height to fit the standard hanger ranges."
          },
          {
            "check": "Beam Selection",
            "errorMessage": "Script requires two valid GenBeams (_Beam0 and _Beam1) to calculate insertion points.",
            "recovery": "Ensure two beams intersect or are positioned correctly before running script."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Hanger Size (ListNr)",
            "how": "OPM (Properties Palette) - Select new NHT Nr.",
            "effect": "Script recalculates GF (Hanger Height) and SStk (Screw count). Updates Body height, Cut position, House size, and BOM data."
          },
          {
            "action": "Toggle Nailhole (sDrillNail)",
            "how": "OPM - Switch 'Drill Nailhole' to Yes/No",
            "effect": "Adds or removes the diagonal drill operation (bdr2) in the supported beam."
          },
          {
            "action": "Adjust Position (dZOff)",
            "how": "OPM - Modify 'Z-Offset' value",
            "effect": "Moves the hanger assembly vertically along the beam Z-axis, recalculating all insertion points (ptm1, ptm2, etc.)."
          },
          {
            "action": "Visual Updates",
            "how": "OPM - Change 'Color' or 'Dimstyle'",
            "effect": "Updates the visual color of the metal body and the style of the dimension label text."
          }
        ]
      },
      "tokens_used": 8609,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Merk NHT Type H.mcr\n\n## Overview\nThis script inserts a Type H NHT steel hanger connection between two timber beams. It automatically generates the 3D representation of the steel plate, creates the necessary mortise (cutout) in the supporting beam, and adds drillings (holes) to the supported beam for a complete connection detail.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the 3D model where beams are located. |\n| Paper Space | No | Not designed for layout/views generation. |\n| Shop Drawing | No | Not a multipage or detailing script for drawings. |\n\n## Prerequisites\n- **Required Entities**: Two `GenBeam` entities (beams).\n- **Minimum Beam Count**: 2 (one supported beam and one supporting beam).\n- **Required Settings**: None. The script uses internal logic to determine sizes.\n\n## Usage Steps\n\n### Step 1: Launch Script\nExecute the insert command in the CAD environment.\n```\nCommand: TSLINSERT\nAction: Browse and select \"Merk NHT Type H.mcr\" from the script list.\n```\n\n### Step 2: Select Beams\nThe script requires two beams to define the connection geometry.\n```\nCommand Line: Select the supported beam (joist/post).\nAction: Click the beam that will be held by the hanger.\n```\n```\nCommand Line: Select the supporting beam (main beam).\nAction: Click the beam that the hanger attaches to.\n```\n*Note: The script will insert the hanger based on default properties immediately after selection.*\n\n### Step 3: Configure Properties\nOnce inserted, the script can be configured via the Properties Palette (OPM). Select the script instance in the model to see its properties. Adjust the **NHT Nr.** to resize the hanger.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Auto Select** | dropdown | Yes | If \"Yes\", filters the NHT Nr. list to show only hangers that fit the beam height. If \"No\", shows all available sizes. |\n| **Drill Nailhole** | dropdown | No | If \"Yes\", creates an additional diagonal nail/screw hole in the supported beam. |\n| **Diameter Nailhole** | number | 6.0 | Sets the diameter (in mm) for the optional nail hole. Only active if \"Drill Nailhole\" is Yes. |\n| **Z-Offset** | number | 0.0 | Moves the hanger assembly vertically (up or down) relative to the beam center. |\n| **Color** | number | 9 | Sets the display color index (0-255) for the hanger body and label. |\n| **Dimstyle** | dropdown | *empty* | Selects the CAD dimension style to use for the text label indicating the hanger size. |\n| **NHT Nr.** | dropdown | *Dynamic* | Selects the specific height (e.g., 120, 140... 240) of the hanger to generate. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *Standard Recalculate* | Refreshes the script geometry if beams are moved or properties are changed. (No specific custom menu items were detected). |\n\n## Settings Files\n- **Filename**: None detected.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Filtering Sizes**: Keep **Auto Select** set to \"Yes\" to prevent selecting a hanger that is physically taller than your timber beam.\n- **Vertical Adjustment**: If the hanger clashes with another connection or hardware, use the **Z-Offset** to shift it up or down without changing the beam geometry.\n- **Production Data**: The script automatically outputs BOM data (Screw count and Material name) to the element map. Ensure your export templates are set up to read this data.\n\n## FAQ\n- **Q: Why is the \"NHT Nr.\" dropdown empty?**\n  **A:** This usually happens if **Auto Select** is \"Yes\" and your beam height is outside the range of defined hangers (e.g., too small or too large). Switch **Auto Select** to \"No\" to see the full list of available sizes.\n  \n- **Q: How do I add a nail hole for additional fixing?**\n  **A:** Select the script instance, go to the Properties Palette, set **Drill Nailhole** to \"Yes\", and ensure the **Diameter Nailhole** is set to the correct size (e.g., 6mm for a standard screw).\n\n- **Q: The hanger is inserted in the wrong vertical position.**\n  **A:** You do not need to move the script manually. Change the **Z-Offset** value in the Properties Palette to slide it into the correct position."
      },
      "tokens_used": 6594,
      "error": null
    }
  }
}