{
  "filename": "hsbCLT-Dovetail-G.mcr",
  "status": "completed",
  "total_tokens": 51075,
  "processing_time": 600.0448973178864,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.3",
            "date": "24may17",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "article name of hardware changed to X-fix L"
          },
          {
            "version": "1.2",
            "date": "23may17",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "article name of hardware changed to XFix-L"
          },
          {
            "version": "1.1",
            "date": "13jun16",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "bugfix, image updated"
          },
          {
            "version": "1.0",
            "date": "30may16",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8384,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script calls 'dbCreate' with the argument '_kModelSpace', indicating it generates instances in the 3D model. It uses 'PrEntity' to prompt user selection of panels ('Sip'), which is a model-space interaction. The script applies 3D tools ('Dove') and hardware ('HardWrComp') to the geometry, which are model-space operations."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip",
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 7288,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert (if not run from catalog)",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select male panel(s)",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrEntity",
              "promptOriginal": "|Select female panel(s)",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "Insertion (if not loaded from catalog)",
            "title": "Properties",
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dXWidth",
            "type": "PropDouble",
            "displayName": "(A)   |Width|",
            "defaultValue": "U(50)",
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the depth of the lap joint seen from reference side| |0 = 50% of thickness|"
          },
          {
            "index": 1,
            "variable": "dZDepth",
            "type": "PropDouble",
            "displayName": "(B)   |Depth|",
            "defaultValue": "U(20)",
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the depth|"
          },
          {
            "index": 2,
            "variable": "dAlfa",
            "type": "PropDouble",
            "displayName": "(C)  |Angle|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the angle dovetail.|"
          },
          {
            "index": 3,
            "variable": "dGap",
            "type": "PropDouble",
            "displayName": "(D)   |Gap|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the gap in depth of the joint|"
          },
          {
            "index": 4,
            "variable": "dAxisOffset",
            "type": "PropDouble",
            "displayName": "(E)  |Axis Offset| X",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Alignment|",
            "description": "|Defines horizontal offset of the tool.|"
          },
          {
            "index": 5,
            "variable": "dBottomOffset",
            "type": "PropDouble",
            "displayName": "(F)  |Bottom Offset|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Alignment|",
            "description": "|Defines bottom offset of the tool.| |0 = complete through|"
          },
          {
            "index": 0,
            "variable": "sTool",
            "type": "PropString",
            "displayName": "(G)  |Open Tool Side|",
            "defaultValue": "|bottom|",
            "inputType": "dropdown",
            "options": [
              "|bottom|",
              "|top|",
              "|Both|"
            ],
            "category": "|Alignment|",
            "description": "|Defines the extension of the tool if panels have different extents.|"
          },
          {
            "index": 1,
            "variable": "sDoveMode",
            "type": "PropString",
            "displayName": "(H)  |Connection Type|",
            "defaultValue": "|Dovetail|",
            "inputType": "dropdown",
            "options": [
              "|Dovetail|",
              "|Butterfly Spline|"
            ],
            "category": null,
            "description": "|Specifies if the dove is added to the male set or if two female doves are added"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Flip Direction|",
            "handler": "|Flip Direction|",
            "action": "Flips the direction of the connection between male and female panels",
            "alsoTriggeredBy": "TslDoubleClick"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8461,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a dovetail joint or butterfly spline connection (G-Connection) between CLT or timber panels to create a perpendicular, interlocking assembly.",
          "category": "Joinery/Machining",
          "typicalUseCase": "Connecting wall panels or floor panels where a strong, interlocking structural joint is required, often in pre-fabricated timber construction."
        },
        "parameters": [
          {
            "name": "dXWidth",
            "technicalDefault": "U(50)",
            "businessMeaning": "The width of the tenon (the male part) of the dovetail, effectively controlling how wide the slot is cut into the panel.",
            "validRange": "30 mm to 150 mm (often related to panel thickness)",
            "unit": "mm",
            "affectsOutput": "Changes the horizontal width of the milled groove. Too narrow weakens the joint; too wide reduces the remaining material strength."
          },
          {
            "name": "dZDepth",
            "technicalDefault": "U(20)",
            "businessMeaning": "The depth of the cut perpendicular to the panel reference surface.",
            "validRange": "10 mm to 100 mm",
            "unit": "mm",
            "affectsOutput": "Determines how deep the router/CNC cuts into the panel face. This is critical for the shear capacity of the joint."
          },
          {
            "name": "dAlfa",
            "technicalDefault": "U(0)",
            "businessMeaning": "The angle of the dovetail taper. 0 degrees creates a rectangular slot; higher angles create a trapezoidal mechanical lock.",
            "validRange": "0 to 15 degrees",
            "unit": "degrees",
            "affectsOutput": "Modifies the side slope of the tool. A 0-degree angle results in a simple lap joint (no mechanical lock), while angles > 0 create a true dovetail that resists pull-out."
          },
          {
            "name": "dGap",
            "technicalDefault": "0",
            "businessMeaning": "Clearance added to the depth of the female slot to accommodate glue tolerances or swelling.",
            "validRange": "0 mm to 5 mm",
            "unit": "mm",
            "affectsOutput": "Ensures the male and female parts do not bind against each other. In Butterfly mode, it accommodates the spline thickness."
          },
          {
            "name": "dAxisOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "Shifts the centerline of the joint horizontally along the panel's length.",
            "validRange": "-200 mm to 200 mm",
            "unit": "mm",
            "affectsOutput": "Moves the position of the slot relative to the panel's origin or centerline."
          },
          {
            "name": "dBottomOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "Restricts the cut from going all the way through the panel height (blind joint).",
            "validRange": "0 mm to Panel Height",
            "unit": "mm",
            "affectsOutput": "If set to 0, the cut goes through the entire height (or depth of the interaction). If > 0, it stops short, creating a bottom stop."
          },
          {
            "name": "sTool",
            "technicalDefault": "bottom",
            "businessMeaning": "Defines which side the machining extends towards if the connected panels have different heights/depths.",
            "validRange": "bottom, top, Both",
            "unit": "enum",
            "affectsOutput": "Controls the vertical bounds of the machining operation to ensure the joint covers the necessary area on uneven panels."
          },
          {
            "name": "sDoveMode",
            "technicalDefault": "Dovetail",
            "businessMeaning": "Selects between a direct panel-to-panel dovetail or a Butterfly Spline connection (using a separate loose tenon).",
            "validRange": "Dovetail, Butterfly Spline",
            "unit": "enum",
            "affectsOutput": "Switches the machining strategy. 'Dovetail' mills matching profiles on panels. 'Butterfly Spline' mills two female grooves and inserts hardware data for a spline."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sDoveMode changes to 'Butterfly Spline'",
            "effect": "Disables the 'Flip Direction' context menu; Generates Hardware (X-fix L); dZDepth is applied symmetrically for two grooves.",
            "cascade": [
              "HardWrComp",
              "Context Menu",
              "dStretch"
            ]
          },
          {
            "trigger": "sDoveMode is 'Dovetail' and dAlfa = 0",
            "effect": "The joint becomes a simple lap joint without mechanical locking capability.",
            "cascade": [
              "Dove Geometry"
            ]
          },
          {
            "trigger": "Context Menu: Flip Direction",
            "effect": "Swaps the Male and Female panel assignments, effectively reversing the joint orientation.",
            "cascade": [
              "Male[] Map",
              "vecDir",
              "Dove Direction"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Dove (Machining)",
            "description": "Subtractive geometry (milling) applied to the panels to create the interlocking shape.",
            "appliedTo": "Selected Male and Female panels (Sip entities)."
          },
          {
            "type": "HardWrComp (Hardware)",
            "description": "Metadata for the 'X-fix L' butterfly spline connector, generated only when 'Butterfly Spline' mode is selected.",
            "appliedTo": "The TSL instance (for BOM/lists and production reports)."
          },
          {
            "type": "PLine/PlaneProfile (Symbol)",
            "description": "A visual 2D representation of the joint drawn in the model for identification.",
            "appliedTo": "Model Space visual layer."
          }
        ]
      },
      "tokens_used": 9530,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch / Insert",
          "2. Check Insertion Cycle (ignore if not first run)",
          "3. Determine Input Source (Catalog vs. Manual)",
          "4. [Catalog] Load Properties OR [Manual] Show Dialog",
          "5. Prompt User: Select Male Panel(s)",
          "6. Validate Male Selection (Orientation/Parallelism)",
          "7. Prompt User: Select Female Panel(s)",
          "8. Validate Female Selection (Must not be parallel to Male)",
          "9. Calculate Joint Vectors (vecDir, ptRef) based on selection centers",
          "10. Clone TSL Instance onto Male Panels",
          "11. Map Female Panels to Instance Data Store",
          "12. Erase Temporary Insert Script",
          "13. Instance Execution: Retrieve Male/Female sets from Map",
          "14. Determine Connection Type (Dovetail vs Butterfly)",
          "15. Generate Machining (Dove Tools) based on Properties",
          "16. [Butterfly Only] Generate Hardware Data (X-fix L)",
          "17. Draw Visual Symbol",
          "18. Finalize"
        ],
        "conditionalBranches": [
          {
            "condition": "Input Source (Catalog vs. Manual)",
            "path1": {
              "name": "Catalog",
              "steps": [
                "Check if _kExecuteKey exists in catalog entries",
                "Load properties using setPropValuesFromCatalog"
              ]
            },
            "path2": {
              "name": "Manual",
              "steps": [
                "Call showDialog()",
                "User confirms properties"
              ]
            }
          },
          {
            "condition": "Selection Validation",
            "path1": {
              "name": "Valid Panels Found",
              "steps": [
                "Filter for parallel normals",
                "Filter for coplanarity (thickness check)",
                "Add to selection set"
              ]
            },
            "path2": {
              "name": "Invalid/Empty Selection",
              "steps": [
                "Report 'Invalid selection set'",
                "Erase Instance",
                "Exit Script"
              ]
            }
          },
          {
            "condition": "Connection Type (sDoveMode)",
            "path1": {
              "name": "Dovetail (0)",
              "steps": [
                "Enable 'Flip Direction' context menu trigger",
                "Add Male Dove tool to Male panels",
                "Add Female Dove tool to Female panels",
                "Clear Hardware components"
              ]
            },
            "path2": {
              "name": "Butterfly Spline (1)",
              "steps": [
                "Disable 'Flip Direction' trigger",
                "Add Female Dove tool to Male panels",
                "Add Female Dove tool to Female panels",
                "Create and add HardWrComp (X-fix L)"
              ]
            }
          },
          {
            "condition": "Recalculation Trigger (Context Menu/DoubleClick)",
            "path1": {
              "name": "Flip Direction",
              "steps": [
                "Invert vecDir",
                "Swap Male and Female entities in Map storage",
                "Force execution loop 2 to update geometry"
              ]
            },
            "path2": {
              "name": "Standard Update",
              "steps": [
                "Retrieve existing Male/Female map",
                "Re-apply tools with updated property values"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Male selection set count",
            "errorMessage": "[ScriptName] Invalid selection set.",
            "recovery": "Select at least one valid panel."
          },
          {
            "check": "Female selection set count",
            "errorMessage": "[ScriptName] Invalid selection set.",
            "recovery": "Select at least one valid panel."
          },
          {
            "check": "Panel Parallelism (within selection group)",
            "errorMessage": "None (filtered silently)",
            "recovery": "Select panels aligned within the same plane."
          },
          {
            "check": "Male vs Female Parallelism",
            "errorMessage": "None (filtered silently)",
            "recovery": "Ensure Male and Female panels are not parallel; they should form an angle (typically 90 degrees)."
          },
          {
            "check": "Panel Thickness/Height compatibility",
            "errorMessage": "None (Script filters based on dH)",
            "recovery": "Select panels of similar thickness relative to the joint center."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry Parameters",
            "how": "OPM Properties Palette (Dimensions, Offsets)",
            "effect": "Updates the width, depth, angle, and position of the dovetail machining."
          },
          {
            "action": "Flip Connection Direction",
            "how": "Right-click Context Menu ('Flip Direction') or Double Click",
            "effect": "Swaps Male and Female panel assignments, reversing the machining direction."
          },
          {
            "action": "Change Connection Type",
            "how": "OPM Properties Palette (Connection Type dropdown)",
            "effect": "Switches between a solid dovetail and a butterfly spline (adds/removes hardware and adjusts tool geometry)."
          },
          {
            "action": "Move Script",
            "how": "Grip Edit / Move Command",
            "effect": "Re-calculates the intersection point and updates the tool position along the panels."
          }
        ]
      },
      "tokens_used": 10587,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# CLT Dovetail G-Connection (hsbCLT-Dovetail-G.mcr)\n\n## Overview\nThis script generates a dovetail joint or butterfly spline connection (G-Connection) between CLT or timber panels. It creates a perpendicular, interlocking assembly, offering options for direct panel-to-panel machining or hardware-based butterfly spline connections.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used for generating 3D joinery and machining operations. |\n| Paper Space | No | Not applicable for 2D drawing generation. |\n| Shop Drawing | No | Machining is visible in Model Space only. |\n\n## Prerequisites\n- **Required Entities**: Two sets of structural panels (Sip or GenBeam entities).\n- **Minimum Count**: At least one Male panel and one Female panel.\n- **Configuration**: Panels should generally be perpendicular (e.g., wall-to-floor) to form a valid connection.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Select the script file `hsbCLT-Dovetail-G.mcr` from the file browser.\n\n### Step 2: Select Male Panels\n```\nCommand Line: Select male panel(s)\nAction: Click on the panel(s) that will receive the \"male\" part of the joint (the tenon or the primary side). Press Enter to confirm.\n```\n\n### Step 3: Select Female Panels\n```\nCommand Line: Select female panel(s)\nAction: Click on the panel(s) that will receive the \"female\" part of the joint (the slot or receiving side). Press Enter to confirm.\n```\n\n### Step 4: Adjust Connection\nAction: The script will automatically generate the joint based on default settings. You can now select the generated element to modify dimensions via the Properties palette or right-click to flip the direction.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| (A) Width | Number | 50 mm | Defines the width/depth of the lap joint seen from the reference side. Set to 0 for 50% of panel thickness. |\n| (B) Depth | Number | 20 mm | Defines the depth of the cut perpendicular to the panel surface. |\n| (C) Angle | Number | 0 deg | Defines the taper of the dovetail. Use 0 for a simple rectangular lap joint; increase for a mechanical lock. |\n| (D) Gap | Number | 0 mm | Defines the clearance in the depth of the joint to accommodate glue or swelling. |\n| (E) Axis Offset X | Number | 0 mm | Shifts the centerline of the joint horizontally along the panel's length. |\n| (F) Bottom Offset | Number | 0 mm | Defines a bottom stop for the cut. Set to 0 for a through-cut; increase to make it a blind joint. |\n| (G) Open Tool Side | Dropdown | bottom | Controls how the tool extends if panels have different heights (Options: bottom, top, Both). |\n| (H) Connection Type | Dropdown | Dovetail | Switches between a solid Dovetail joint or a Butterfly Spline (uses hardware). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip Direction | Swaps the Male and Female panel assignments, effectively reversing the machining direction of the joint. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies entirely on OPM properties and does not require external settings files.\n\n## Tips\n- **Quick Fix**: If the machining is applied to the wrong side of the panels, select the script instance and choose \"Flip Direction\" from the right-click menu instead of deleting and re-starting.\n- **Butterfly Mode**: When using the \"Butterfly Spline\" mode, the script automatically generates hardware data for the \"X-fix L\" connector. Ensure your BOM lists are configured to read this hardware.\n- **Simple Lap Joints**: For non-locking connections, set the Angle (C) to 0. This creates a simple straight slot instead of a dovetail.\n\n## FAQ\n- **Q: Why did my script disappear after selection?**\n  A: This usually happens if the selected panels are parallel to each other. The script requires panels to meet at an angle (typically 90 degrees) to calculate the joint vector.\n  \n- **Q: How do I include the X-fix L connector in my reports?**\n  A: Change the \"Connection Type\" property to \"Butterfly Spline\". The script will create the necessary hardware component linked to the instance.\n\n- **Q: Can I use this on curved walls?**\n  A: The script is designed for linear intersections. It filters for parallel normals within a selection set, so complex curved geometries may result in invalid selection sets."
      },
      "tokens_used": 6825,
      "error": null
    }
  }
}