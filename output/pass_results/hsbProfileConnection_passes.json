{
  "filename": "hsbProfileConnection.mcr",
  "status": "completed",
  "total_tokens": 53861,
  "processing_time": 1083.6706659793854,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.12",
            "date": "07.03.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-14770: use envelopeBody"
          },
          {
            "version": "1.11",
            "date": "12.04.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-11497 facet gap corrected"
          },
          {
            "version": "1.10",
            "date": "03may18",
            "author": "kris.riemslagh@hsbcad.com",
            "changes": "bugfix corner beamcuts"
          },
          {
            "version": "1.9",
            "date": "08jan18",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "bugfix TJI alike connections"
          },
          {
            "version": "1.8",
            "date": "27oct17",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "bugfix drilled extrusion profiles"
          },
          {
            "version": "1.7",
            "date": "26apr16",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "bugfix location facet beamcuts, cut only added for beam males"
          },
          {
            "version": "1.6",
            "date": "26feb16",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "bugfix facet beamcuts on asymmetric intersections"
          },
          {
            "version": "1.5",
            "date": "07oct14",
            "author": "th@hsbCAD.de",
            "changes": "bugfix if axis of female beam is not centered with envelope body"
          },
          {
            "version": "1.4",
            "date": "07jan14",
            "author": "th@hsbCAD.de",
            "changes": "bugfix for facets of certain profiles"
          },
          {
            "version": "1.3",
            "date": "26sep13",
            "author": "th@hsbCAD.de",
            "changes": "tolerance issue for meter drawings solved"
          },
          {
            "version": "1.2",
            "date": "10sep13",
            "author": "th@hsbCAD.de",
            "changes": "bugfix facet beamcut"
          },
          {
            "version": "1.1",
            "date": "05sep13",
            "author": "th@hsbCAD.de",
            "changes": "bugfix panel/sheets"
          },
          {
            "version": "1.0",
            "date": "04sep13",
            "author": "th@hsbCAD.de",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8991,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit use of _kModelSpace in tslNew.dbCreate() call within _bOnInsert block. Script processes 3D geometry (Body, GenBeam, BeamCut) to create joinery in the model."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Beam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space with intersecting male and female beams",
          "requiredSettings": []
        }
      },
      "tokens_used": 7832,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity.go",
              "promptOriginal": "Select male beams, sheets or panels",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity.go",
              "promptOriginal": "Select female (profiled) beams",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert (if _kExecuteKey is empty)",
            "title": null,
            "dataSource": "OPM Properties (Gaps)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dGapLength",
            "type": "PropDouble",
            "displayName": "Length",
            "defaultValue": 0.0,
            "inputType": "number",
            "category": "Gaps",
            "description": "Defines the gap in length in relation to the cross piece"
          },
          {
            "index": 1,
            "variable": "dGapTopVertical",
            "type": "PropDouble",
            "displayName": "Top Vertical",
            "defaultValue": 0.0,
            "inputType": "number",
            "category": "Gaps",
            "description": "Defines the vertical gap to the flange on the top side"
          },
          {
            "index": 2,
            "variable": "dGapTopHorizontal",
            "type": "PropDouble",
            "displayName": "Top Horizontal",
            "defaultValue": 0.0,
            "inputType": "number",
            "category": "Gaps",
            "description": "Defines the horizontal gap to the flange on the top side"
          },
          {
            "index": 3,
            "variable": "dGapBottomHorizontal",
            "type": "PropDouble",
            "displayName": "Bottom Horizontal",
            "defaultValue": 0.0,
            "inputType": "number",
            "category": "Gaps",
            "description": "Defines the horizontal gap to the flange on the bottom side"
          },
          {
            "index": 4,
            "variable": "dGapFacet",
            "type": "PropDouble",
            "displayName": "Facet",
            "defaultValue": 0.0,
            "inputType": "number",
            "category": "Gaps",
            "description": "Defines the gap of detected facets"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 10341,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically cuts and joins timber beams, sheets, or panels to fit against profiled metal beams (like open-web joists or steel profiles) with defined clearance gaps.",
          "category": "Joinery/Connection",
          "typicalUseCase": "When connecting timber floor joists or walls to steel girders or profiled joists, ensuring the timber is cut to match the profile with specific dimensional gaps for expansion or manufacturing tolerances."
        },
        "parameters": [
          {
            "name": "dGapLength",
            "technicalDefault": 0.0,
            "businessMeaning": "Controls the longitudinal distance between the end of the timber element (male) and the theoretical reference face of the profiled beam (female). Effectively shortens the timber.",
            "validRange": "0 to 50 mm",
            "unit": "mm",
            "affectsOutput": "Shifts the endpoint of the male beam along its axis away from the female beam, creating a gap parallel to the male beam's length."
          },
          {
            "name": "dGapTopVertical",
            "technicalDefault": 0.0,
            "businessMeaning": "The vertical clearance between the top surface of the timber element and the bottom face of the top flange of the profiled beam.",
            "validRange": "0 to 20 mm",
            "unit": "mm",
            "affectsOutput": "Moves the top horizontal cut downwards, ensuring the timber does not touch the top flange of the metal profile."
          },
          {
            "name": "dGapTopHorizontal",
            "technicalDefault": 0.0,
            "businessMeaning": "The horizontal clearance between the top edge of the timber element and the vertical web of the profiled beam's top flange.",
            "validRange": "0 to 20 mm",
            "unit": "mm",
            "affectsOutput": "Reduces the depth of the top horizontal cut (perpendicular to the female beam axis), effectively notching the timber less deep at the top."
          },
          {
            "name": "dGapBottomHorizontal",
            "technicalDefault": 0.0,
            "businessMeaning": "The horizontal clearance between the bottom edge of the timber element and the vertical web of the profiled beam's bottom flange.",
            "validRange": "0 to 20 mm",
            "unit": "mm",
            "affectsOutput": "Reduces the depth of the bottom horizontal cut (perpendicular to the female beam axis), effectively notching the timber less deep at the bottom."
          },
          {
            "name": "dGapFacet",
            "technicalDefault": 0.0,
            "businessMeaning": "Clearance applied to angled or vertical segments of the profile (like the webs of an open-web joist) that connect the top and bottom flanges.",
            "validRange": "0 to 10 mm",
            "unit": "mm",
            "affectsOutput": "Moves the facet cuts inward or outward relative to the detected profile geometry, preventing the timber from interfering with the web structure."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Selection of Male/Female beams",
            "effect": "Determines the coordinate system used to interpret the gap directions (Length vs Horizontal/Vertical).",
            "cascade": [
              "dGapLength",
              "dGapTopVertical",
              "dGapTopHorizontal",
              "dGapBottomHorizontal",
              "dGapFacet"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "BeamCut",
            "description": "Complex 3D cuts applied to the male beam (or sheet/panel) to match the cross-section profile of the female beam. This includes vertical cuts at flange locations, horizontal cuts for depth, and angled cuts for web facets.",
            "appliedTo": "The selected male beams, sheets, or panels."
          }
        ]
      },
      "tokens_used": 8995,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization (User runs hsbProfileConnection)",
          "2. Determine Configuration Source (Check for Catalog Key)",
          "[Conditional] If Catalog Key exists: Load properties from catalog",
          "[Conditional] If No Catalog Key: Show Dynamic Dialog (Gap parameters)",
          "3. User Selection: Select Male Entities (Beams, Sheets, Panels)",
          "4. User Selection: Select Female Entities (Profiled Beams)",
          "5. Entity Processing Loop: Filter invalid entities and remove duplicates",
          "6. Pair Processing Loop: Iterate through all Male x Female combinations",
          "7. Parallelism Check: Validate Male and Female beams are not parallel",
          "8. Instance Generation: Create new TSL instance for each valid pair",
          "9. Parent Instance Deletion: Original script instance erases itself",
          "10. Child Instance Execution: Define Male/Female geometry types",
          "11. Coordinate System Calculation: Establish reference plane based on entity type (Panel vs Beam)",
          "12. Intersection Validation: Check if Male and Female bodies intersect",
          "[Conditional] If No Intersection: Delete child instance and report error",
          "13. Geometry Analysis: Calculate intersection body and shadow profile",
          "14. Segment Classification: Identify profile segments (Top Flange, Bottom Flange, Webs)",
          "15. Tooling Generation: Apply Vertical, Horizontal, and Facet cuts with calculated gaps",
          "16. Completion: Draw debug symbols (if enabled) and finish"
        ],
        "conditionalBranches": [
          {
            "condition": "Configuration Source",
            "path1": {
              "name": "Catalog Execution",
              "steps": [
                "System detects _kExecuteKey",
                "Script reads properties from catalog entry",
                "Skips interactive dialog"
              ]
            },
            "path2": {
              "name": "Interactive Insertion",
              "steps": [
                "_kExecuteKey is empty",
                "ShowDynamicDialog() displays OPM properties (Gaps)",
                "User confirms or modifies default values (0.0)"
              ]
            }
          },
          {
            "condition": "Male Entity Type",
            "path1": {
              "name": "Sheet or Panel",
              "steps": [
                "Set nMaleType = 0",
                "Use envelopeBody for test body",
                "Calculate specific coordinate system based on bounding box projection"
              ]
            },
            "path2": {
              "name": "Straight Beam",
              "steps": [
                "Set nMaleType = 1",
                "Set nStretch flag",
                "Use Quader (Bbox) for test body calculation"
              ]
            },
            "path3": {
              "name": "Curved Beam",
              "steps": [
                "Set nMaleType = 2",
                "Extract CurvedStyle",
                "Generate body using PLine (closedCurve) extrusion"
              ]
            }
          },
          {
            "condition": "Geometric Intersection",
            "path1": {
              "name": "Valid Intersection",
              "steps": [
                "bdFemale.hasIntersection(bdTestMale) returns true",
                "Script proceeds to calculate cuts",
                "PlaneProfile and shadow analysis executed"
              ]
            },
            "path2": {
              "name": "No Intersection",
              "steps": [
                "bdFemale.hasIntersection(bdTestMale) returns false",
                "reportMessage() triggered",
                "eraseInstance() called immediately",
                "Script terminates"
              ]
            }
          },
          {
            "condition": "Beam Parallelism",
            "path1": {
              "name": "Parallel Beams",
              "steps": [
                "vxMale.isParallelTo(vxFemale) is true",
                "Loop continues (skips this specific pair)",
                "No instance created for this pair"
              ]
            },
            "path2": {
              "name": "Intersecting/Perpendicular Beams",
              "steps": [
                "vxMale.isParallelTo(vxFemale) is false",
                "tslNew.dbCreate() is called",
                "Instance created to process connection"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Validity",
            "errorMessage": "Internal check: if (!gb.bIsValid())",
            "recovery": "Script silently skips the invalid entity during the loop."
          },
          {
            "check": "Spatial Intersection",
            "errorMessage": "\"\\nNo intersection found between [PosNum1]/[PosNum2] Tool will be deleted.\"",
            "recovery": "Ensure selected Male and Female entities physically overlap in 3D space. The tool deletes itself automatically."
          },
          {
            "check": "Parallelism",
            "errorMessage": "None (Silent skip)",
            "recovery": "If beams are parallel, the script assumes no profile connection is needed and skips the pair. Select beams that cross or meet at an angle."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Gap Parameters",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Updating 'Length', 'Top Vertical', 'Top Horizontal', 'Bottom Horizontal', or 'Facet' gaps triggers an immediate recalculation of the BeamCut sizes and positions."
          },
          {
            "action": "Move/Stretch Beams",
            "how": "Grip edits or standard AutoCAD Move/Rotate commands",
            "effect": "The associative TSL updates the cutting geometry to match the new intersection profile automatically."
          },
          {
            "action": "Delete Connected Entities",
            "how": "Erase command",
            "effect": "The TSL instance detects the loss of the linked beam and deletes itself or reports an error depending on the context of the deletion."
          }
        ]
      },
      "tokens_used": 11246,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbProfileConnection\n\n## Overview\nThis script automatically cuts timber beams, sheets, or panels to fit against profiled beams (such as open-web joists or steel profiles). It calculates complex 3D cuts based on the intersection and allows you to define precise clearance gaps for manufacturing tolerances.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the 3D model where beams intersect. |\n| Paper Space | No | Not supported for 2D layouts. |\n| Shop Drawing | No | Not applicable for shop drawing generation. |\n\n## Prerequisites\n- **Required entities**:\n  - **Male elements**: Timber beams, sheets, or panels that will be cut.\n  - **Female elements**: Profiled beams (e.g., steel joists) that define the cutting shape.\n- **Minimum beam count**: 2 (One male element and one female element).\n- **Required settings**: None.\n- **Spatial requirement**: The male and female entities must physically intersect or touch in 3D space. Beams running parallel to each other will be ignored.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `hsbProfileConnection.mcr`.\n\n### Step 2: Select Male Elements\n```\nCommand Line: Select male beams, sheets or panels\nAction: Click on the timber beams, sheets, or panels you want to cut.\n```\nPress **Enter** when selection is complete.\n\n### Step 3: Select Female Elements\n```\nCommand Line: Select female (profiled) beams\nAction: Click on the profiled beam (e.g., steel joist) that the male elements connect to.\n```\nPress **Enter** when selection is complete.\n\n### Step 4: Configure Gaps (Dialog)\nAction: A dialog box appears displaying the default gap values (usually 0.00). If you require manufacturing tolerances, adjust the values here. Click **OK** to generate the connection.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Length** | Number | 0.0 | Defines the gap in length relative to the cross piece (effectively shortens the timber). |\n| **Top Vertical** | Number | 0.0 | Defines the vertical clearance between the timber and the top flange of the profile. |\n| **Top Horizontal** | Number | 0.0 | Defines the horizontal clearance to the flange on the top side. |\n| **Bottom Horizontal** | Number | 0.0 | Defines the horizontal clearance to the flange on the bottom side. |\n| **Facet** | Number | 0.0 | Defines the gap applied to angled or vertical segments (webs) of the profile. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add custom items to the right-click context menu. Use the Properties Palette to modify parameters. |\n\n## Settings Files\n- No external settings files are used by this script.\n\n## Tips\n- **Tolerances**: Use the **Length** or **Facet** gap properties to add small allowances (e.g., 2mm) to ensure easy assembly on-site.\n- **Moving Elements**: If you move or stretch the connected beams using AutoCAD grips or commands, the cuts will update automatically to match the new position.\n- **Intersection Check**: Ensure the beams clearly cross each other. If they are only touching at a single edge or are perfectly parallel, the script may skip the connection.\n- **Deletion**: If you move the beams far apart so they no longer intersect, the script instance will delete itself and report \"No intersection found\" on the command line.\n\n## FAQ\n- **Q: Why did the connection disappear?**\n  - A: The tool requires the beams to intersect. If you moved the beams apart, the tool deletes itself. Re-run the script after repositioning the beams.\n- **Q: Can I use this for timber-to-timber connections?**\n  - A: While technically possible if the \"female\" beam has a complex profile, this tool is primarily designed for connecting timber to profiled metal beams or joists.\n- **Q: How do I change the gap size after inserting?**\n  - A: Select the TSL instance (or the beam), open the **Properties Palette** (Ctrl+1), locate the \"Gaps\" category, and modify the values. The 3D model will update instantly."
      },
      "tokens_used": 6456,
      "error": null
    }
  }
}