{
  "filename": "_hsbReport.mcr",
  "status": "completed",
  "total_tokens": 53967,
  "processing_time": 243.13258600234985,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9077,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "Both",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": true,
          "detectionEvidence": "Documentation comments explicitly state: 'Diese TSL kann im Modellbereich, in einer Einzelzeichnung oder im Elementlayout verwendet werden' and 'This TSL can be used in model, in multipage definitions or in element layout'. Version history 3.5 mentions outputting values in 'paperspace'. Version 4.3 mentions 'consumes showset of multipage'."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element",
            "MasterPanel"
          ],
          "minimumBeams": 0,
          "requiredSpace": "None (Runs in Model, Paper Space, or Element Layout)",
          "requiredSettings": [
            "hsbExcel.dll",
            "Report Definitions created with hsbExcelReport Designer"
          ]
        }
      },
      "tokens_used": 7188,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "SelectFromList",
            "trigger": "Script Insert (_bOnInsert)",
            "title": "Report Name",
            "dataSource": "List of report definitions from hsbExcel.dll ('Reports' method)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "SelectFromList",
            "trigger": "Script Insert (_bOnInsert) / Recalculation (if dynamic)",
            "title": "Sub Report",
            "dataSource": "List of sections/sections within the selected Report Name",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 4,
            "variable": "sReportEntry",
            "type": "PropString",
            "displayName": "Report Name",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "Dynamically populated from Report Definitions (hsbExcel.dll)",
            "category": "General",
            "description": "Defines the parent report name"
          },
          {
            "index": 5,
            "variable": "sSectionEntry",
            "type": "PropString",
            "displayName": "Sub Report",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "Dynamically populated based on selected Report Name",
            "category": "General",
            "description": null
          },
          {
            "index": 6,
            "variable": "dTxtH",
            "type": "PropDouble",
            "displayName": "Text Height",
            "defaultValue": 2.5,
            "inputType": "number",
            "options": [],
            "category": "Size",
            "description": null
          },
          {
            "index": 7,
            "variable": "nAlign",
            "type": "PropInt",
            "displayName": "Alignment",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              "Horizontal",
              "Vertical"
            ],
            "category": "Alignment",
            "description": null
          },
          {
            "index": 8,
            "variable": "nDir",
            "type": "PropInt",
            "displayName": "Direction",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              "Bottom",
              "Top"
            ],
            "category": "Alignment",
            "description": null
          },
          {
            "index": 9,
            "variable": "sColumnWidths",
            "type": "PropString",
            "displayName": "Column Widths",
            "defaultValue": "50",
            "inputType": "text",
            "options": [],
            "category": "Size",
            "description": null
          },
          {
            "index": 10,
            "variable": "sArDecimals",
            "type": "PropString",
            "displayName": "Decimals",
            "defaultValue": "2",
            "inputType": "text",
            "options": [],
            "category": "Format",
            "description": null
          },
          {
            "index": 11,
            "variable": "sHeaderOverrides",
            "type": "PropString",
            "displayName": "Header Overrides",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Format",
            "description": null
          },
          {
            "index": 12,
            "variable": "sDescription",
            "type": "PropString",
            "displayName": "Description",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "General",
            "description": null
          },
          {
            "index": 13,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 7,
            "inputType": "number",
            "options": [],
            "category": "Format",
            "description": null
          },
          {
            "index": 14,
            "variable": "nColor2",
            "type": "PropInt",
            "displayName": "Color Child Entities",
            "defaultValue": 7,
            "inputType": "number",
            "options": [],
            "category": "Format",
            "description": null
          },
          {
            "index": 15,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "_Standard",
            "inputType": "dropdown",
            "options": "Dynamically populated from AutoCAD Dimstyles",
            "category": "Format",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Change Report Definition",
            "handler": "../|Change Report Definition|",
            "action": "Allows changing the parent report name and sub report post-insertion.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Toggle visible items",
            "handler": "../|Toggle visible items|",
            "action": "Toggles the visibility of specific items/rows in the report.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Disable first column as subheader",
            "handler": "../|Disable first column as subheader|",
            "action": "Disables the subheader formatting for the first column.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Set first column as subheader",
            "handler": "../|Set first column as subheader|",
            "action": "Enables the first column to act as a subheader (groups rows based on value).",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Add Entities",
            "handler": "../|Add Entities|",
            "action": "Adds entities (Beams/Elements/MasterPanels) to the report definition.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Remove Entities",
            "handler": "../|Remove Entities|",
            "action": "Removes entities from the report definition.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Sort",
            "handler": "../|Sort|",
            "action": "Initiates sorting of the report data.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Swap Columns",
            "handler": "../|Swap Columns|",
            "action": "Swaps the position of two columns in the report.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "hsbExcel.dll",
            "searchPaths": [
              "_kPathHsbInstall\\Utilities\\hsbExcel"
            ],
            "purpose": "Contains Report Definitions and logic to generate data.",
            "required": true
          },
          {
            "filename": "Report Definitions (XML/Data)",
            "searchPaths": [
              "_kPathHsbCompany"
            ],
            "purpose": "Storage for custom report layouts created with hsbExcelReport Designer.",
            "required": true
          }
        ]
      },
      "tokens_used": 8891,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates dynamic construction reports, cut lists, and bill of materials (BOM) tables directly in the CAD drawing based on predefined XML report definitions.",
          "category": "ShopDrawing / Annotation",
          "typicalUseCase": "Creating a material list or cutting list in an element layout or shop drawing to summarize beam lengths, quantities, and machining details for manufacturing or invoicing."
        },
        "parameters": [
          {
            "name": "sReportEntry",
            "technicalDefault": "",
            "businessMeaning": "Selects the master template (Report Definition) that determines the data structure and content of the table (e.g., 'Element Overview', 'Wall Studs', 'Hardware List').",
            "validRange": "List of available report names in the hsbExcel configuration",
            "unit": "Selection",
            "affectsOutput": "Determines which columns are available, which entities are collected, and the default sorting/filtering logic."
          },
          {
            "name": "sSectionEntry",
            "technicalDefault": "",
            "businessMeaning": "Selects a specific subset or view within the chosen Report Definition (e.g., 'Top Plates', 'Bottom Plates' within a Wall report).",
            "validRange": "Dependent on the selected Report Name",
            "unit": "Selection",
            "affectsOutput": "Filters the data rows displayed in the table."
          },
          {
            "name": "dTxtH",
            "technicalDefault": "2.5",
            "businessMeaning": "The height of the text characters in the table.",
            "validRange": "1.5 to 10.0 (depending on plot scale)",
            "unit": "mm",
            "affectsOutput": "Scales the size of the text and the row height of the table."
          },
          {
            "name": "nAlign",
            "technicalDefault": "0 (Horizontal)",
            "businessMeaning": "The orientation of the table data relative to the insertion point.",
            "validRange": "0 (Horizontal) or 1 (Vertical)",
            "unit": "Integer",
            "affectsOutput": "Rotates the table layout 90 degrees (Vertical places headers along the Y-axis)."
          },
          {
            "name": "nDir",
            "technicalDefault": "0 (Bottom)",
            "businessMeaning": "The growth direction of the table from the user-selected insertion point.",
            "validRange": "0 (Bottom/Up) or 1 (Top/Down)",
            "unit": "Integer",
            "affectsOutput": "Determines if new rows are added above or below the insertion point."
          },
          {
            "name": "sColumnWidths",
            "technicalDefault": "50",
            "businessMeaning": "Defines the width for each column in the table, usually as a comma-separated string.",
            "validRange": "Positive numbers (e.g., '20,50,100')",
            "unit": "mm",
            "affectsOutput": "Stretches or shrinks individual columns to improve readability or fit within drawing borders."
          },
          {
            "name": "sArDecimals",
            "technicalDefault": "2",
            "businessMeaning": "Specifies the number of decimal places for numerical columns.",
            "validRange": "0 to 4 (typically integers for counts, 1 or 2 for lengths)",
            "unit": "Count",
            "affectsOutput": "Rounds numerical values displayed in the report."
          },
          {
            "name": "sHeaderOverrides",
            "technicalDefault": "",
            "businessMeaning": "Allows manual renaming of column headers without editing the underlying Report Definition XML.",
            "validRange": "Text string (pipe '|' or comma separated)",
            "unit": "String",
            "affectsOutput": "Changes the text in the header row of the table."
          },
          {
            "name": "sDescription",
            "technicalDefault": "",
            "businessMeaning": "A user-defined comment or label to identify this specific instance of the report in the properties palette.",
            "validRange": "Alphanumeric text",
            "unit": "String",
            "affectsOutput": "None (Metadata only)."
          },
          {
            "name": "nColor",
            "technicalDefault": "7",
            "businessMeaning": "The AutoCAD color index for the main text and lines of the report.",
            "validRange": "1 to 255 (Standard AutoCAD colors)",
            "unit": "Color Index",
            "affectsOutput": "Visual appearance of the table (lines and text)."
          },
          {
            "name": "nColor2",
            "technicalDefault": "7",
            "businessMeaning": "The color used for child entities or sub-header rows (indented items).",
            "validRange": "1 to 255",
            "unit": "Color Index",
            "affectsOutput": "Visual distinction for grouped or hierarchical data rows."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_Standard",
            "businessMeaning": "The AutoCAD Dimension Style used to determine the text font and basic formatting properties.",
            "validRange": "List of Dimstyles defined in the drawing",
            "unit": "Style Name",
            "affectsOutput": "Font type and specific text style properties of the report content."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change sReportEntry",
            "effect": "The list of available options for sSectionEntry is updated to match the sections defined in the new report. Default column widths and formats may also reset.",
            "cascade": [
              "sSectionEntry"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "2D Text",
            "description": "The report content (values, headers, summaries) drawn as text entities.",
            "appliedTo": "Current Space (Model, Paper Space, or Element Layout)"
          },
          {
            "type": "PLine (Polyline)",
            "description": "Grid lines and borders forming the table structure.",
            "appliedTo": "Current Space (Model, Paper Space, or Element Layout)"
          }
        ]
      },
      "tokens_used": 9956,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Inserted / Recalculated",
          "Check Insert Cycle Count (if >1, erase instance and exit)",
          "Check for Catalog Entry in _kExecuteKey",
          "[Branch] If Catalog Entry exists: Load properties from catalog and skip dialogs",
          "[Branch] If No Catalog Entry: Show 'SelectFromList' dialog to choose 'Report Name'",
          "Show 'SelectFromList' dialog to choose 'Sub Report' (based on Report Name)",
          "User selects Insertion Point (getPoint)",
          "Script calls hsbExcel.dll ('ExecuteReport') to generate data",
          "Loop through Report Rows and Columns",
          "[Branch] Check Text Length vs Column Width (Trim if necessary)",
          "[Branch] Check for Invalid Characters (e.g. '@') in Shopdraw mode",
          "Draw Table Content (Text, Lines, Subheaders)",
          "Draw Summary Rows (if enabled in definition)",
          "Store current configuration to _Map for portability",
          "Finish"
        ],
        "conditionalBranches": [
          {
            "condition": "Is a valid Catalog Entry provided in _kExecuteKey?",
            "path1": {
              "name": "Catalog Execution",
              "steps": [
                "Read catalog name from execute key",
                "Set properties from catalog entry",
                "Validate report name exists in available definitions",
                "Skip interactive dialogs"
              ]
            },
            "path2": {
              "name": "Interactive Execution",
              "steps": [
                "Display list of available Report Names",
                "User selects Report Name",
                "Display list of Sub Reports for selected Report",
                "User selects Sub Report"
              ]
            }
          },
          {
            "condition": "Is 'First column as subheader' enabled via Context Menu?",
            "path1": {
              "name": "Subheader Grouping",
              "steps": [
                "Compare current cell value with previous cell value in column 0",
                "If value matches previous: Clear text, draw left border line only",
                "If value differs: Draw full cell with top border line"
              ]
            },
            "path2": {
              "name": "Standard List",
              "steps": [
                "Draw every cell with full border rectangle (or standard grid)",
                "Display all text values"
              ]
            }
          },
          {
            "condition": "Does text length exceed column width?",
            "path1": {
              "name": "Text Fits",
              "steps": [
                "Draw full text string in cell"
              ]
            },
            "path2": {
              "name": "Text Truncation",
              "steps": [
                "Calculate max width (Column width - '...' width)",
                "Loop to remove characters from end of string",
                "Append '...' to truncated string",
                "Draw modified string"
              ]
            }
          },
          {
            "condition": "Invalid Data Validation (Shopdraw Mode)",
            "path1": {
              "name": "Data Valid",
              "steps": [
                "Proceed with drawing the cell"
              ]
            },
            "path2": {
              "name": "Data Invalid (Contains '@')",
              "steps": [
                "Display Report Message ('Invalid data found, instance will be deleted')",
                "Execute eraseInstance() command",
                "Stop script execution"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Silent)",
            "recovery": "Script self-terminates and erases instance if cycle count > 1 to prevent recursion errors."
          },
          {
            "check": "Catalog Entry Validity",
            "errorMessage": "None (Fallback)",
            "recovery": "If the specified catalog entry's report name is not found in the current hsbExcel configuration, the script attempts to use the report name stored in the Map Object. If that fails, it likely defaults to the first available report or errors gracefully."
          },
          {
            "check": "Cell Content for Invalid Characters (Shopdraw/Block Space)",
            "errorMessage": "\n_hsbReport Invalid data found, instance will be deleted",
            "recovery": "The instance is immediately erased. The user must check the source data (likely Element Properties or linked data) for invalid characters like '@'."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Report Definition",
            "how": "Context Menu",
            "effect": "Resets the 'Report Name' and 'Sub Report' properties, prompting the user to select a new definition. Refreshes the table structure."
          },
          {
            "action": "Toggle visible items",
            "how": "Context Menu",
            "effect": "Shows or hides specific rows in the generated table without deleting the data."
          },
          {
            "action": "Set/Disable first column as subheader",
            "how": "Context Menu",
            "effect": "Toggles visual grouping logic on the first column, changing borders and text repetition based on identical values."
          },
          {
            "action": "Add / Remove Entities",
            "how": "Context Menu",
            "effect": "Allows adding or removing specific Beams, Elements, or MasterPanels from the data calculation scope."
          },
          {
            "action": "Sort / Swap Columns",
            "how": "Context Menu",
            "effect": "Reorders the data rows or swaps the position of two columns in the visual layout."
          },
          {
            "action": "Modify OPM Properties",
            "how": "Properties Palette",
            "effect": "Updates Text Height, Alignment, Colors, Column Widths, Decimals, and Header Overrides, triggering a redraw of the table."
          }
        ]
      },
      "tokens_used": 11311,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# _hsbReport.mcr\n\n## Overview\nGenerates dynamic construction reports, cut lists, and bill of materials (BOM) tables directly in the CAD drawing. It uses predefined report definitions from the `hsbExcel` module to display data related to beams, elements, or master panels.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Can generate reports for the entire model or selection sets. |\n| Paper Space | Yes | Can output reports onto drawing sheets. |\n| Shop Drawing | Yes | Can be used within single drawing views or Element Layouts (ELO). |\n\n## Prerequisites\n- **Required Entities**: GenBeams, Elements, or MasterPanels to generate data from.\n- **Minimum Beam Count**: 0 (Reports can be empty).\n- **Required Settings**:\n  - `hsbExcel.dll`: Required for accessing report logic.\n  - Report Definitions: Pre-configured XML templates created with the hsbExcel Report Designer.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `_hsbReport.mcr` from the list.\n\n### Step 2: Select Report Definition\nA dialog box appears titled \"Report Name\".\n- **Action**: Select the desired report template (e.g., \"Element Overview\", \"Cut List\", \"Hardware List\") from the dropdown list.\n- **Note**: The list is populated from your company's hsbExcel configuration.\n\n### Step 3: Select Sub Report\nA second dialog box appears titled \"Sub Report\".\n- **Action**: Select a specific section or subset of the main report (e.g., \"Top Plates\", \"Studs\") if applicable.\n- **Note**: Options vary depending on the Report Name selected in the previous step.\n\n### Step 4: Place the Table\n```\nCommand Line: Pick insertion point:\nAction: Click in the drawing (Model or Paper Space) to place the top-left or bottom-left corner of the table.\n```\nThe table is automatically generated based on the entities in the current scope.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Report Name | dropdown | (Empty) | Selects the master report template. Changing this resets the Sub Report options. |\n| Sub Report | dropdown | (Empty) | Selects the specific data subset or section within the chosen report. |\n| Text Height | number | 2.5 | Sets the height of the text in the table (in millimeters). |\n| Alignment | dropdown | Horizontal | Sets the table orientation. Options: Horizontal or Vertical. |\n| Direction | dropdown | Bottom | Determines growth direction from the insertion point. Options: Bottom (grows up) or Top (grows down). |\n| Column Widths | text | 50 | Defines the width for each column (comma-separated, e.g., \"20,50,100\"). |\n| Decimals | text | 2 | Sets the number of decimal places for numerical values. |\n| Header Overrides | text | (Empty) | Renames column headers manually using text (e.g., \"Length|Qty|Mark\"). |\n| Description | text | (Empty) | A user-defined label to identify this specific report instance. |\n| Color | number | 7 | AutoCAD color index for the main table lines and text. |\n| Color Child Entities | number | 7 | AutoCAD color index for sub-rows or child items. |\n| Dimstyle | dropdown | _Standard | Specifies the AutoCAD dimension style to use for text font properties. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change Report Definition | Opens the dialog to select a different Report Name or Sub Report. Useful for switching the table type without re-inserting. |\n| Toggle visible items | Hides or shows specific rows in the report. |\n| Set first column as subheader | Groups rows based on the value in the first column. Repeating values in the first column are hidden to create a grouped view. |\n| Disable first column as subheader | Removes the grouping effect, showing all values in the first column. |\n| Add Entities | Adds selected Beams, Elements, or MasterPanels to the data calculation scope. |\n| Remove Entities | Removes selected entities from the report calculation. |\n| Sort | Opens options to sort the report data by a specific column. |\n| Swap Columns | Swaps the position of two selected columns in the table layout. |\n\n## Settings Files\n- **Filename**: `hsbExcel.dll`\n- **Location**: `_kPathHsbInstall\\Utilities\\hsbExcel`\n- **Purpose**: Contains the engine that processes report definitions and extracts data from the model.\n\n- **Filename**: Report Definitions (XML)\n- **Location**: `_kPathHsbCompany` (or configured Company path)\n- **Purpose**: Stores the layout, column logic, and filtering rules for specific reports (created by an administrator).\n\n## Tips\n- **Quick Formatting**: Use `sHeaderOverrides` to rename column headers directly in the Properties Palette without needing to edit the XML definition file.\n- **Grouping**: For long lists of studs or similar items, use the \"Set first column as subheader\" context menu option to group them visually.\n- **Fit to Frame**: If a column is too narrow, the script automatically truncates text with \"...\" (ellipsis). Adjust the `Column Widths` property (string format like \"30,60,40\") to fit your content.\n\n## FAQ\n- **Q: Why did the report table disappear immediately after inserting?**\n  - **A**: This usually happens in Shop Drawing mode if the data source contains invalid characters (such as the '@' symbol). Check the properties of the elements or referenced data for invalid characters.\n- **Q: How do I change the text font?**\n  - **A**: The script uses the selected `Dimstyle`. Change the `Dimstyle` property in the palette to one that uses your desired font.\n- **Q: Can I export this data to Excel?**\n  - **A**: This specific script draws the table as CAD entities (Text and Polylines). To export raw data, you would typically use the \"Export to Excel\" functions within the hsbExcel toolbar, rather than this drawing script."
      },
      "tokens_used": 7544,
      "error": null
    }
  }
}