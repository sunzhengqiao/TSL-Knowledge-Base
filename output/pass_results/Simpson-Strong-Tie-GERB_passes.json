{
  "filename": "Simpson-Strong-Tie-GERB.mcr",
  "status": "completed",
  "total_tokens": 50667,
  "processing_time": 367.71302795410156,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9516,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity to select Beam() entities, constructs 3D Bodies for visualization, applies Cuts to beams using addToolStatic, and creates HardWrComps. No 2D drawing commands (sd_) or Paper Space logic (_Viewport) is present."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": [
            "Catalog entries for script name 'Simpson-Strong-Tie-GERB'"
          ]
        }
      },
      "tokens_used": 7172,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select beam(s)|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert (if no execute key is provided)",
            "title": null,
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "|Type|",
            "defaultValue": "|Automatic|",
            "inputType": "dropdown",
            "options": [
              "|Automatic|",
              "GERB125",
              "GERB150",
              "GERB160",
              "GERB175",
              "GERB180",
              "GERB200-DE",
              "GERB220"
            ],
            "category": "|General|",
            "description": "|Defines the model of the connector|"
          },
          {
            "index": 0,
            "variable": "dGap",
            "type": "PropDouble",
            "displayName": "|Gap|",
            "defaultValue": "10 (mm)",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the Gap|"
          },
          {
            "index": 1,
            "variable": "sNailPattern",
            "type": "PropString",
            "displayName": "|Nailing Pattern|",
            "defaultValue": "|Full Nailing|",
            "inputType": "dropdown",
            "options": [
              "|Full Nailing|",
              "|Part Nailing|"
            ],
            "category": "|Nailing|",
            "description": "|Defines the nail pattern|"
          },
          {
            "index": 2,
            "variable": "sNail",
            "type": "PropString",
            "displayName": "|Nail type|",
            "defaultValue": "CNA4,0x40",
            "inputType": "dropdown",
            "options": [
              "CNA4,0x40",
              "CNA4,0x50",
              "CNA4,0x60"
            ],
            "category": "|Nailing|",
            "description": "|Defines the Nail type|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Swap X-(-X)|",
            "handler": "|Swap X-(-X)|",
            "action": "Toggles the orientation of the connector along the X-axis (mirroring)",
            "alsoTriggeredBy": "Double Click"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8723,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically inserts Simpson Strong-Tie Gerber Hangers (GERB series) to create a suspended connection between two timber beams, including the gap, metal plates, and nail registration in the BOM.",
          "category": "Hardware / Connection",
          "typicalUseCase": "Creating a cantilevered connection (e.g., balcony decks) or beam splices where the load is transferred via a metal hanger rather than direct wood-to-wood contact."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "|Automatic|",
            "businessMeaning": "Selects the specific Simpson Strong-Tie product model (e.g., GERB125). 'Automatic' attempts to detect the correct model based on the beam height (Z-dimension).",
            "validRange": "Automatic, GERB125, GERB150, GERB160, GERB175, GERB180, GERB200-DE, GERB220",
            "unit": "Model ID",
            "affectsOutput": "Determines the 3D geometry of the metal plates (width, height, thickness) and the total number of nails required."
          },
          {
            "name": "dGap",
            "technicalDefault": "10",
            "businessMeaning": "The physical clearance space between the end of the supported beam and the supporting beam. This accommodates the thickness of the metal connector and allows for dimensional tolerances.",
            "validRange": "0 - 50",
            "unit": "mm",
            "affectsOutput": "Adjusts the position of the vertical cuts applied to the timber beams."
          },
          {
            "name": "sNailPattern",
            "technicalDefault": "|Full Nailing|",
            "businessMeaning": "Defines the density of nails used. 'Full Nailing' uses maximum nails for maximum load capacity. 'Part Nailing' uses fewer nails for lower load requirements or faster installation.",
            "validRange": "|Full Nailing|, |Part Nailing|",
            "unit": "Configuration",
            "affectsOutput": "Updates the Quantity (count) of the Nail Hardware Component in the Bill of Materials (BOM)."
          },
          {
            "name": "sNail",
            "technicalDefault": "CNA4,0x40",
            "businessMeaning": "The specific fastener product (Simpson Strong-Tie CNA series screw) used to attach the hanger.",
            "validRange": "CNA4,0x40, CNA4,0x50, CNA4,0x60",
            "unit": "Product Designation",
            "affectsOutput": "Updates the Material Entry in the BOM and sets geometric parameters for the screw (length/diameter)."
          },
          {
            "name": "Swap X-(-X)",
            "technicalDefault": "False",
            "businessMeaning": "Mirrors the connector assembly 180 degrees along the beam axis.",
            "validRange": "True/False",
            "unit": "State",
            "affectsOutput": "Flips the orientation of the metal plates geometry."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Beam Height/Width changes",
            "effect": "If 'sType' is set to 'Automatic', the script recalculates and attempts to switch to the matching GERB model based on the new dimensions.",
            "cascade": [
              "sType"
            ]
          },
          {
            "trigger": "sType changes",
            "effect": "Updates the predefined nail counts and plate dimensions.",
            "cascade": [
              "sNailPattern",
              "Metal Plate Geometry"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (Visual)",
            "description": "3D representation of the left and right metal plates of the Gerber hanger.",
            "appliedTo": "Model Space (Visualization layer)"
          },
          {
            "type": "Cut (Machining)",
            "description": "Vertical cuts at the end of the beams to create the required gap (dGap) and opening for the hanger.",
            "appliedTo": "Selected Beams"
          },
          {
            "type": "HardWrComp (BOM)",
            "description": "The main connector plate (e.g., GERB150) added to the material list with manufacturer details.",
            "appliedTo": "Element/Group of the host beam"
          },
          {
            "type": "HardWrComp (BOM)",
            "description": "The fasteners (Nails) added to the material list with the correct quantity based on the selected pattern.",
            "appliedTo": "Element/Group of the host beam"
          }
        ]
      },
      "tokens_used": 9410,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script (via Command or Catalog)",
          "Check Insert Cycle (eraseInstance if cycle > 1)",
          "Check Execute Key: If valid Catalog Key found, load properties; otherwise, default to Automatic and Show Dynamic Dialog",
          "Command Line Prompt: Select beam(s) (PrEntity)",
          "Validate Selection: If less than 1 beam selected, report error and erase instance",
          "Internal Processing: Iterate through selected beams to find valid pairs (parallel, co-linear, matching cross-section)",
          "Instance Creation: Create new TSL instance for every valid pair detected",
          "Instance Execution (Recalc):",
          "  -> Analyze geometry to find beam centers and direction vectors (vecXC)",
          "  -> Select Model: If 'Automatic', match beam height (dZ) to predefined array; else use manual selection",
          "  -> Validate Model: If no match found for beam height, report 'Invalid geometry' and erase",
          "  -> Locate Origin (_Pt0): Calculate midpoint between beam ends (or snap if dragging grip)",
          "  -> Apply Machining: Add Cut tool to Beam 0 and Beam 1 based on _Pt0 and dGap",
          "  -> Construct 3D Bodies: Generate Left and Right metal plates based on dimensions of selected model",
          "  -> Apply Transforms: Mirror bodies if 'Swap X-(-X)' flag is active",
          "  -> Generate BOM: Clear old hardware, add Connector Plate (HardWrComp), add Nails (HardWrComp) based on pattern",
          "Finalize: Visual display of bodies and update BOM"
        ],
        "conditionalBranches": [
          {
            "condition": "Selection Content",
            "path1": {
              "name": "Valid Pair Found",
              "steps": [
                "Identify 2 beams that are parallel, on same axis, and have same section",
                "Calculate connection point",
                "Create TSL instance linking these two beams"
              ]
            },
            "path2": {
              "name": "Invalid/Empty Selection",
              "steps": [
                "If < 1 beam: Erase instance immediately",
                "If valid beams exist but no pairs found (e.g., skew/offset): Script finishes without creating connection"
              ]
            }
          },
          {
            "condition": "sType (Type) Property",
            "path1": {
              "name": "Automatic",
              "steps": [
                "Compare Beam Height (Z-dimension) against predefined dAs array",
                "Set sType to the matching GERB model (e.g., GERB150)"
              ]
            },
            "path2": {
              "name": "Manual Selection (e.g., GERB125)",
              "steps": [
                "Use the dimensions (dA, dB, dC) associated with the specific manual index",
                "Proceed with geometry generation regardless of actual beam height"
              ]
            }
          },
          {
            "condition": "Swap X-(-X) Trigger",
            "path1": {
              "name": "Activated (Double Click or Context Menu)",
              "steps": [
                "Toggle internal 'swapX' integer state",
                "Set Execution Loops to 2 to force recalculation",
                "Mirror geometry across the YZ plane at the next execution loop"
              ]
            },
            "path2": {
              "name": "Not Activated",
              "steps": [
                "Use standard orientation",
                "Do not apply mirroring transform"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Count",
            "errorMessage": "Select at least one beam",
            "recovery": "User must select valid beams and restart script"
          },
          {
            "check": "Geometric Compatibility",
            "errorMessage": "None explicitly shown to user (only debug report)",
            "recovery": "Script silently skips pairs that are not parallel, not aligned, or have mismatched sections. User must correct beam geometry."
          },
          {
            "check": "Model Availability",
            "errorMessage": "Invalid geometry Tool will be deleted.",
            "recovery": "Ensure beam height matches a supported GERB height (125, 150, 160, 175, 180, 200, 220mm) or manually set Type property."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Mirror Connector (Swap X)",
            "how": "Context Menu: 'Swap X-(-X)' or Double Click",
            "effect": "Toggles the orientation of the connector 180 degrees along the beam axis."
          },
          {
            "action": "Adjust Gap",
            "how": "OPM Property: 'Gap'",
            "effect": "Updates the position of the cuts on the beams to increase/decrease clearance."
          },
          {
            "action": "Change Connector Model",
            "how": "OPM Property: 'Type'",
            "effect": "Changes the 3D geometry size and the BOM material entry."
          },
          {
            "action": "Change Nailing Configuration",
            "how": "OPM Property: 'Nailing Pattern' or 'Nail type'",
            "effect": "Updates the quantity and product code of the nails in the BOM."
          },
          {
            "action": "Move Connection Point",
            "how": "Grip Edit on Insertion Point (_Pt0)",
            "effect": "Slides the connection along the beam axis (snaps to midpoint if dragged outside valid range)."
          }
        ]
      },
      "tokens_used": 9820,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Simpson-Strong-Tie-GERB.mcr\n\n## Overview\nAutomatically inserts Simpson Strong-Tie Gerber Hangers (GERB series) to create suspended connections between two timber beams. It manages 3D visualization, applies necessary cuts to the timber, and generates material lists (BOM) for the connector and nails.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates in the 3D model environment. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required entities**: Beam or GenBeam.\n- **Minimum beam count**: 2 (must be a valid pair of beams).\n- **Required settings**: Catalog entries for the script name 'Simpson-Strong-Tie-GERB'.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Simpson-Strong-Tie-GERB.mcr`\n\n### Step 2: Configure Properties (If applicable)\n```\nAction: If no specific execute key is preset, a dialog box appears.\nAction: Select the Connector 'Type' (default is Automatic) and 'Nailing Pattern' in the dialog.\nAction: Click OK to proceed.\n```\n\n### Step 3: Select Beams\n```\nCommand Line: Select beam(s)\nAction: Click on the two beams you wish to connect end-to-end.\nNote: The beams must be parallel, aligned on the same axis, and have the same cross-section for the script to detect a valid pair.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | dropdown | Automatic | Defines the model of the connector (e.g., GERB125, GERB150). 'Automatic' detects the correct size based on beam height. |\n| Gap | number | 10 mm | Defines the clearance space between the end of the supported beam and the supporting beam. |\n| Nailing Pattern | dropdown | Full Nailing | Defines the nail density. 'Full Nailing' uses maximum nails; 'Part Nailing' uses fewer nails. |\n| Nail type | dropdown | CNA4,0x40 | Defines the specific screw product used to attach the hanger (e.g., CNA4,0x50). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Swap X-(-X) | Toggles the orientation of the connector 180 degrees along the beam axis (mirrors the hanger). This can also be triggered by Double-Clicking the connector. |\n\n## Settings Files\n- **Catalog Entries**: Required for 'Simpson-Strong-Tie-GERB'\n- **Location**: Company or Install path\n- **Purpose**: Provides default configurations and execute keys for the script.\n\n## Tips\n- **Automatic Detection**: Use the 'Automatic' Type setting to let the script select the correct hanger size based on your beam height (supports 125, 150, 160, 175, 180, 200, and 220 mm heights).\n- **Beam Alignment**: Ensure the two beams are perfectly collinear and parallel; otherwise, the script will not create a connection.\n- **Quick Flip**: Double-click the connector in the model to quickly flip its orientation instead of using the right-click menu.\n\n## FAQ\n- **Q: Why did the connector not appear after I selected the beams?**\n  **A**: The script requires a pair of beams that are parallel, aligned, and have the same cross-section. If the beams are skewed or have different heights, the connection will not be generated.\n\n- **Q: Can I adjust the space between the beams after insertion?**\n  **A**: Yes. Select the connector, open the Properties palette (Ctrl+1), and change the 'Gap' value.\n\n- **Q: What happens if my beam height doesn't match a standard GERB size?**\n  **A**: If 'Type' is set to 'Automatic' and no match is found, the tool will report \"Invalid geometry\" and delete itself. You must manually select a specific 'Type' that fits your construction context."
      },
      "tokens_used": 6026,
      "error": null
    }
  }
}