{
  "filename": "hsb_Anchor.mcr",
  "status": "completed",
  "total_tokens": 29823,
  "processing_time": 184.09883379936218,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 5575,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No sd_* prefix. No usage of _Viewport.length() or _kPaperSpace. Script creates 3D geometry (Body/PLine) based on beam coordinate systems (vecX, vecY, vecZ) and insertion points, consistent with Model Space generation."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 1894,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Pick a Point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getBeam",
              "promptOriginal": "Select a Beam",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dTh",
            "type": "PropDouble",
            "displayName": "Thickness",
            "defaultValue": "U(2)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dWi",
            "type": "PropDouble",
            "displayName": "Width",
            "defaultValue": "U(36)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dLe",
            "type": "PropDouble",
            "displayName": "Length",
            "defaultValue": "U(100)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nQty",
            "type": "PropInt",
            "displayName": "Quantity",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDispRep",
            "type": "PropString",
            "displayName": "Show in Disp Rep",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sModel",
            "type": "PropString",
            "displayName": "Model Type",
            "defaultValue": "SP90",
            "inputType": "dropdown",
            "options": [
              "Other Model Type",
              "SP90",
              "SP240",
              "SPU90",
              "SPU96",
              "SPU240",
              "SPA38",
              "SPA50"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strCustomAnchorModel",
            "type": "PropString",
            "displayName": "Other Anchor Type",
            "defaultValue": "**Other Type**",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Please fill this value if you choose 'Other Model Type' above"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3517,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Generates a 3D parametric steel anchor or bracket plate with a stiffener flange, typically used for connecting timber beams to concrete foundations or other structural elements.\",\n    \"category\": \"Hardware/Connections\",\n    \"typicalUseCase\": \"Inserting a specific hold-down anchor (like a Simpson Strong-Tie type) onto a beam to prepare manufacturing lists and export data for CNC or shop drawings.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"dTh\",\n      \"technicalDefault\": \"U(2)\",\n      \"businessMeaning\": \"The gauge or thickness of the steel plate material.\",\n      \"validRange\": \"2 mm - 10 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Controls the extrusion depth of both the main plate and the stiffener plate in the 3D model.\"\n    },\n    {\n      \"name\": \"dWi\",\n      \"technicalDefault\": \"U(36)\",\n      \"businessMeaning\": \"The width of the anchor plate, measured along the longitudinal axis of the beam.\",\n      \"validRange\": \"30 mm - 300 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Determines the horizontal spread of the plate geometry relative to the beam's length.\"\n    },\n    {\n      \"name\": \"dLe\",\n      \"technicalDefault\": \"U(100)\",\n      \"businessMeaning\": \"The vertical height of the main anchor plate and the projection depth of the secondary stiffener.\",\n      \"validRange\": \"50 mm - 600 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Sets the height of the vertical plate and the depth/length of the perpendicular stiffener plate.\"\n    },\n    {\n      \"name\": \"nQty\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"The count of identical anchors required at the specific insertion location.\",\n      \"validRange\": \"1 - 10\",\n      \"unit\": \"count\",\n      \"affectsOutput\": \"Updates the 'U_QUANTITY' field in DXF exports and BOM data; does not create multiple visual copies.\"\n    },\n    {\n      \"name\": \"sDispRep\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Filter to control in which drawing views or display representations the anchor is visible.\",\n      \"validRange\": \"Any valid Display Representation name (e.g., 'Hardware', 'Presentation')\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Toggles visibility of the 3D bodies in specific CAD viewports.\"\n    },\n    {\n      \"name\": \"sModel\",\n      \"technicalDefault\": \"SP90\",\n      \"businessMeaning\": \"The commercial product code or model type of the anchor (e.g., SP90, SP240).\",\n      \"validRange\": \"List of standard presets (SP90, SP240, SPU90, etc.) or 'Other Model Type'\",\n      \"unit\": \"enum\",\n      \"affectsOutput\": \"Sets the 'U_MODEL' attribute for production reports. Note: Selecting a model here does not automatically update dimensions; dWi, dLe, and dTh must be entered manually to match the physical product.\"\n    },\n    {\n      \"name\": \"strCustomAnchorModel\",\n      \"technicalDefault\": \"**Other Type**\",\n      \"businessMeaning\": \"A user-defined text field for entering a manufacturer code not listed in the standard dropdown.\",\n      \"validRange\": \"Text string\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Overrides the dropdown value in the 'U_MODEL' export field when 'Other Model Type' is selected.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"User selects 'Other Model Type' in the sModel dropdown\",\n      \"effect\": \"The script logic switches to use the text entered in strCustomAnchorModel for the export label.\",\n      \"cascade\": [\n        \"strCustomAnchorModel\"\n      ]\n    }\n  ],\n"
      },
      "tokens_used": 6507,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch script insertion (hsb_Anchor).",
          "2. System checks for catalog entry (_bOnDbCreated) to load default properties if available.",
          "3. System detects insertion mode (_bOnInsert).",
          "4. Check insertCycleCount: if count > 1, erase instance (prevent duplicate) and exit.",
          "5. Display Properties Dialog (showDialogOnce) to allow initial parameter configuration.",
          "6. Prompt user: 'Pick a Point' to define the insertion origin (_Pt0).",
          "7. Prompt user: 'Select a Beam' to define orientation and dependency context.",
          "8. Return and regenerate script.",
          "9. Determine Anchor Model Label: Check if 'sModel' is 'Other Model Type' to decide between dropdown value or custom text string.",
          "10. Validation Check: Verify if a beam exists in the _Beam array.",
          "11. Coordinate System Setup: Retrieve local axes (vx, vy, vz) from the selected beam or Map overrides.",
          "12. Establish Dependency: Link script lifecycle to the selected beam entity.",
          "13. Generate 3D Geometry: Create main plate (Body bdMP) and stiffener plate (Body bdMP2) based on dimensions (dTh, dWi, dLe).",
          "14. Display Logic: Apply display representation filter if specified.",
          "15. Export Data: Write attributes (U_MODEL, U_QUANTITY) to DXI and TSLBOM Map."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Cycle Count > 1",
              "steps": [
                "Erase current script instance",
                "Return (Terminate)"
              ]
            },
            "path2": {
              "name": "Cycle Count = 1",
              "steps": [
                "Show Properties Dialog",
                "Request Point insertion",
                "Request Beam selection"
              ]
            }
          },
          {
            "condition": "Model Type Selection (sModel)",
            "path1": {
              "name": "Standard Model Selected",
              "steps": [
                "Set sAnchorModel to value selected from sModel dropdown",
                "Export standard model code"
              ]
            },
            "path2": {
              "name": "'Other Model Type' Selected",
              "steps": [
                "Set sAnchorModel to the content of strCustomAnchorModel",
                "Export custom string code"
              ]
            }
          },
          {
            "condition": "Beam Availability",
            "path1": {
              "name": "Beam Missing (_Beam.length < 1)",
              "steps": [
                "Erase script instance",
                "Return (Exit without drawing)"
              ]
            },
            "path2": {
              "name": "Beam Present",
              "steps": [
                "Extract vectors from beam",
                "Generate geometry"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection Existence",
            "errorMessage": "(Implicit) None displayed to user, script disappears.",
            "recovery": "User must re-insert the script and select a valid beam during the 'Select a Beam' prompt. If beam is deleted post-insertion, the anchor is automatically removed."
          },
          {
            "check": "Point Insertion",
            "errorMessage": "Script pauses until a valid point is picked.",
            "recovery": "User must click in Model Space to define _Pt0."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions (Thickness, Width, Length)",
            "how": "OPM (Object Properties Palette)",
            "effect": "Script regenerates 3D Body geometry immediately to reflect new size."
          },
          {
            "action": "Change Model Type / Quantity",
            "how": "OPM (Object Properties Palette)",
            "effect": "Updates export attributes (U_MODEL, U_QUANTITY) for BOM/DXF; geometry remains unchanged unless dimensions are manually updated to match new model."
          },
          {
            "action": "Update Visibility",
            "how": "OPM (Object Properties Palette)",
            "effect": "Toggles visibility of the anchor bodies based on the 'Show in Disp Rep' string matching the current viewport configuration."
          },
          {
            "action": "Move Reference Beam",
            "how": "CAD Grip/Edit",
            "effect": "Script regenerates to update the Orientation (vx, vy, vz) of the anchor. Note: The insertion point (_Pt0) is absolute and does not move with the beam unless the script defines explicit coordinate linking, so the anchor rotates but stays fixed in world space."
          }
        ]
      },
      "tokens_used": 6780,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_Anchor.mcr\n\n## Overview\nGenerates a parametric steel anchor plate with a stiffener flange, typically used to connect timber beams to concrete foundations. It allows users to define dimensions and assign manufacturer codes for hardware lists and CNC exports.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Primary working environment. |\n| Paper Space | No | Script generates 3D geometry only. |\n| Shop Drawing | No | Not a shop drawing layout script. |\n\n## Prerequisites\n- **Required Entities**: At least one Timber Beam (`GenBeam`) must exist in the model.\n- **Minimum Beam Count**: 1\n- **Required Settings**: None (script is self-contained).\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Browse and select `hsb_Anchor.mcr`.\n\n### Step 2: Pick a Point\n```\nCommand Line: Pick a Point\nAction: Click in the Model Space to define the insertion origin (bottom corner) of the anchor.\n```\n\n### Step 3: Select a Beam\n```\nCommand Line: Select a Beam\nAction: Click on a timber beam. The anchor will orient itself based on this beam's coordinate system.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Thickness | Number | 2 mm | The material gauge of the steel plate. |\n| Width | Number | 36 mm | The horizontal width of the anchor plate (along the beam axis). |\n| Length | Number | 100 mm | The vertical height of the anchor plate. |\n| Quantity | Number | 1 | Number of anchors for BOM/export lists. Does not create multiple visual copies. |\n| Show in Disp Rep | Text | [Empty] | Filters visibility based on the current Display Representation name. |\n| Model Type | Dropdown | SP90 | Manufacturer code (e.g., SP90, SP240, SPU90). Selecting a code sets the label only; dimensions must be set manually. |\n| Other Anchor Type | Text | **Other Type** | Enter a custom model name if \"Other Model Type\" is selected in the dropdown above. |\n\n## Right-Click Menu Options\nNo custom context menu options are defined for this script.\n\n## Settings Files\nNo external settings files are required.\n\n## Tips\n- **Manual Dimensioning**: Selecting a \"Model Type\" (e.g., SP90) does not automatically resize the anchor. You must manually enter the correct Width, Length, and Thickness to match the physical product.\n- **Beam Dependency**: The anchor is linked to the selected beam. If you delete the beam, the anchor will also be removed.\n- **Orientation**: If you move or rotate the reference beam using AutoCAD grips, the anchor will update its rotation to match. However, the insertion point remains fixed in world space; it does not translate with the beam automatically.\n- **BOM Export**: The Quantity parameter affects the data in `U_QUANTITY` for exports but only draws one object visually.\n\n## FAQ\n- **Q: Why did the anchor disappear after I deleted a beam?**\n  A: The script requires a valid beam to exist for orientation. Deleting the associated beam causes the script to erase itself.\n- **Q: I changed the Model Type to SP240, but the size didn't change.**\n  A: The Model Type property is for labeling/export purposes only. You must manually adjust the Width (`dWi`) and Length (`dLe`) properties to match the dimensions of an SP240 anchor.\n- **Q: How do I hide the anchor in specific views?**\n  A: Enter the name of the Display Representation (e.g., \"Presentation\") into the \"Show in Disp Rep\" property. The anchor will only be visible when that Display Representation is active."
      },
      "tokens_used": 5550,
      "error": null
    }
  }
}