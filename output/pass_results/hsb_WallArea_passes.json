{
  "filename": "hsb_WallArea.mcr",
  "status": "completed",
  "total_tokens": 28794,
  "processing_time": 228.83189940452576,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "02.02.2011",
            "author": "Chirag Sawjani (csawjani@itw-industry.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "14.02.2011",
            "author": "Alberto Jena (ajena@itw-industry.com)",
            "changes": "Remove the Area of the openings"
          },
          {
            "version": "1.2",
            "date": "17.02.2011",
            "author": "",
            "changes": "Fix issue with opening area"
          },
          {
            "version": "1.3",
            "date": "13.04.2012",
            "author": "",
            "changes": "Fix issue with panel not close"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4415,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses getViewport() to prompt the user to select a viewport and stores it in the _Viewport list. It accesses the underlying 3D Element via _Viewport[0].element() to perform calculations and uses Display.draw() to annotate the drawing, which is typical for manual annotation scripts in Layouts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Paper Space (Layout) containing a viewport displaying an Element",
          "requiredSettings": []
        }
      },
      "tokens_used": 4319,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Select Point for insert",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select the viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Set Dimstyle",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Enter Colour",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4133,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Calculates the net surface area (in square meters) of a selected timber wall element, subtracting openings, and annotates the result on the layout.",
          "category": "ShopDrawing",
          "typicalUseCase": "Labeling a wall panel on a drawing sheet to show the net cladding or material area for estimating and manufacturing lists."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Selects the dimension style definition (controlling text height, font, and arrow style) to be used for the area annotation, ensuring consistency with drafting standards.",
            "validRange": "Any existing Dimension Style name available in the current drawing",
            "unit": "String (Name)",
            "affectsOutput": "Alters the visual appearance (size, font) of the text label displaying the area."
          },
          {
            "name": "nColor",
            "technicalDefault": -1,
            "businessMeaning": "Determines the color of the area annotation text. A value of -1 typically forces the text to take the color of the layer it is placed on.",
            "validRange": "-1 (ByLayer) or 0-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the display color of the 'Area: [value] sq.m' text label."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "Annotation",
            "description": "A single-line text label displaying the calculated net wall area in square meters.",
            "appliedTo": "Paper Space (Layout) at the user-selected insertion point."
          }
        ]
      },
      "tokens_used": 5030,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script initialization in Paper Space.",
          "2. Check if execution is in Insertion mode (_bOnInsert).",
          "3. [If Inserting] Prompt user for an insertion point (_Pt0).",
          "4. [If Inserting] Prompt user to select a Viewport displaying the 3D wall.",
          "5. [If Inserting] Store Viewport in list and pause (waiting for recalculation).",
          "6. [If Recalculating] Validate that a Viewport is present in the stored list.",
          "7. Retrieve the Element associated with the selected Viewport.",
          "8. Iterate through all GenBeams in the Element to build a unified PlaneProfile of the wall elevation.",
          "9. Filter the unified profile to identify and remove rings defined as 'openings' to get the gross outline.",
          "10. Calculate the area of the gross outline polylines.",
          "11. Iterate through all Opening entities in the Element and subtract their area from the gross outline area.",
          "12. Check if the resulting area is negative (indicating potential geometry overlap or calculation error).",
          "13. [If Negative] Fallback calculation: Use Element Envelope Area minus Total Opening Area.",
          "14. [If Positive] Use the calculated GenBeam Area (Gross Outline minus Openings).",
          "15. Convert final area from square millimeters to square meters.",
          "16. Draw the text label 'Area: [Value] sq.m' at the insertion point using the defined Dimension Style and Color."
        ],
        "conditionalBranches": [
          {
            "condition": "Script execution state (_bOnInsert flag)",
            "path1": {
              "name": "Insertion Mode",
              "steps": [
                "Prompt for insertion point",
                "Prompt for Viewport selection",
                "Store data and return"
              ]
            },
            "path2": {
              "name": "Recalculation Mode",
              "steps": [
                "Validate Viewport existence",
                "Perform geometric calculations",
                "Draw/Update annotation"
              ]
            }
          },
          {
            "condition": "Viewport list validation (_Viewport.length)",
            "path1": {
              "name": "Viewport Missing",
              "steps": [
                "Report 'No Viewport found'",
                "Erase script instance",
                "Stop execution"
              ]
            },
            "path2": {
              "name": "Viewport Found",
              "steps": [
                "Extract Element from Viewport",
                "Continue to calculation"
              ]
            }
          },
          {
            "condition": "GenBeam Loop Logic (Index j)",
            "path1": {
              "name": "First Beam (j == 0)",
              "steps": [
                "Initialize PlaneProfile with first beam's shadow profile"
              ]
            },
            "path2": {
              "name": "Subsequent Beams (j > 0)",
              "steps": [
                "Union current beam's shadow profile with existing PlaneProfile"
              ]
            }
          },
          {
            "condition": "Calculated Area Integrity (dGenBeamArea < 0)",
            "path1": {
              "name": "Negative/Error State",
              "steps": [
                "Calculate Element Envelope Area",
                "Subtract Total Opening Area",
                "Use result as final Area"
              ]
            },
            "path2": {
              "name": "Valid Positive State",
              "steps": [
                "Use existing GenBeam Area (Outline minus Openings)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Existence",
            "errorMessage": "No Viewport found",
            "recovery": "Script instance is automatically erased; user must re-run the command and ensure a viewport is selected."
          },
          {
            "check": "Geometry Calculation Integrity",
            "errorMessage": null,
            "recovery": "If the calculated beam area is negative (due to complex geometry or opening overlap), the script automatically switches to calculating area based on the Element's overall envelope minus the area of openings."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Annotation Style",
            "how": "OPM (Object Properties Manager) - Change 'Set Dimstyle' property",
            "effect": "The text label regenerates using the selected dimension style (updating font, height, etc.)."
          },
          {
            "action": "Update Annotation Color",
            "how": "OPM (Object Properties Manager) - Change 'Enter Colour' property",
            "effect": "The color of the text label changes to the specified AutoCAD Color Index."
          },
          {
            "action": "Move Annotation",
            "how": "Grip Edit (Drag Text)",
            "effect": "The text label moves to the new location while maintaining its link to the calculated data."
          }
        ]
      },
      "tokens_used": 6289,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_WallArea.mcr\n\n## Overview\nThis script calculates the net surface area (in square meters) of a wall element and annotates the result on your drawing layout. It automatically subtracts the area of openings (windows and doors) from the total wall surface to provide an accurate material or cladding area.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for 2D Layouts. |\n| Paper Space | Yes | This script must be run in a Layout tab. |\n| Shop Drawing | No | It is used for annotating layouts, not generating shop drawings. |\n\n## Prerequisites\n- **Required Entities:** A Layout tab containing a **Viewport** that is currently displaying a 3D Wall **Element**.\n- **Minimum Beam Count:** The Element must contain at least one beam (GenBeam).\n- **Required Settings:** None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Select `hsb_WallArea.mcr` from the file list.\n\n### Step 2: Select Insertion Point\n```\nCommand Line: Select Point for insert\nAction: Click in the Paper Space layout where you want the area label to appear.\n```\n\n### Step 3: Select Viewport\n```\nCommand Line: Select the viewport\nAction: Click on the viewport frame that displays the wall element you wish to measure.\n```\n*Note: The script will automatically calculate the area based on the element shown in that viewport and display the text label.*\n\n## Properties Panel Parameters\n\nOnce the script is inserted, select the text label and open the **Properties** palette (Ctrl+1) to adjust the following settings:\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Set Dimstyle | dropdown | _DimStyles | Select the Dimension Style to control the text height, font, and appearance of the area label. |\n| Enter Colour | number | -1 | Sets the color of the text. Enter `-1` to use the current Layer's color (ByLayer), or enter a number from 0-255 for a specific AutoCAD Color Index. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add custom options to the right-click context menu. |\n\n## Settings Files\nNo external settings files are required for this script.\n\n## Tips\n- **Changing Text Size:** To change the size of the text, do not scale the object. Instead, select the label, open the **Properties** palette, and change the **Set Dimstyle** property to a dimension style with a different text height.\n- **Moving the Label:** You can click and drag the text label to reposition it anywhere on the layout without affecting the calculation.\n- **Geometry Accuracy:** The script uses the shadow profiles of the wall beams. If beams overlap significantly, the script has a built-in fallback to calculate area using the Element's bounding box minus openings.\n\n## FAQ\n- **Q: Does the area include windows and doors?**\n  - **A:** No. The script calculates the \"Net Area\" by subtracting the area of any openings found in the element from the gross wall surface.\n- **Q: Why is my text the wrong color?**\n  - **A:** Check the **Enter Colour** property in the Properties palette. If it is set to a specific number (e.g., 1 for Red), it overrides the layer color. Set it to `-1` to make it follow the layer color.\n- **Q: Can I update the area if I modify the wall?**\n  - **A:** Yes. The script links to the element. If you change the wall length or add/remove openings in the model, update the viewport, and the script will recalculate the area automatically."
      },
      "tokens_used": 4608,
      "error": null
    }
  }
}