{
  "filename": "hsbCLT-RebateOpening.mcr",
  "status": "completed",
  "total_tokens": 54781,
  "processing_time": 314.79906582832336,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "This tsl creates a single or double rebate around an opening. It can be attached to any opening or the minmal size can be filtered during insert",
        "versionHistory": [
          {
            "version": "1.5",
            "date": "24jul2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "during edit in place all tools are grouped, new map based radial dimension added"
          },
          {
            "version": "1.4",
            "date": "23jul2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "renamed and new custom command 'edit in place' separates toolings into individual tools"
          },
          {
            "version": "1.3",
            "date": "11jul2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "revised, new property and context commands to manipulate the tool shape"
          },
          {
            "version": "1.2",
            "date": "30aug2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "new property 'Radius' specifies an override of the tool width if the radius is greater than the width"
          },
          {
            "version": "1.1",
            "date": "28jul2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "added flag not to modify the CNC section, rebates will result into single pockets"
          },
          {
            "version": "1.0",
            "date": "21jul2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "hsbCLT-RebateEdge"
        ]
      },
      "tokens_used": 8662,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "tslNew.dbCreate uses _kModelSpace. Logic involves creating 3D tools (Mortise, BeamCut) and adding them to a Sip entity using sip.addTool(). No sd_ prefix, no #Type E, no _Viewport usage."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space",
          "requiredSettings": [
            "hsbCLT-RebateEdge"
          ]
        }
      },
      "tokens_used": 7470,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select panel(s)",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 1,
            "variable": "sEdgeMode",
            "type": "PropString",
            "displayName": "Edge Mode",
            "defaultValue": "all",
            "inputType": "dropdown",
            "options": [
              "all",
              "not bottom (-Y)",
              "not left (-X)",
              "not top (Y)",
              "not right (X)",
              "bottom + top (-Y+Y)",
              "left + right (-X+X)",
              "bottom (-Y)",
              "left (-X)",
              "top (Y)",
              "right (X)"
            ],
            "category": "General",
            "description": "Defines the EdgeMode"
          },
          {
            "index": 0,
            "variable": "sFace",
            "type": "PropString",
            "displayName": "Face",
            "defaultValue": "Reference Side",
            "inputType": "dropdown",
            "options": [
              "Reference Side",
              "Opposite Side"
            ],
            "category": "General",
            "description": null
          },
          {
            "index": 0,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "Depth",
            "defaultValue": 20,
            "inputType": "number",
            "options": [],
            "category": "Rebate 1",
            "description": "Defines the depth of the rebate."
          },
          {
            "index": 1,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "Width",
            "defaultValue": 40,
            "inputType": "number",
            "options": [],
            "category": "Rebate 1",
            "description": "Defines the width of the rebate."
          },
          {
            "index": 2,
            "variable": "dRadius",
            "type": "PropDouble",
            "displayName": "Tool Radius",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "Rebate 1",
            "description": "Defines the radius of the tool.This option will enlarge the tool regarding to the specified value. 0 = irrelevant"
          },
          {
            "index": 3,
            "variable": "dDepth2",
            "type": "PropDouble",
            "displayName": "Depth ",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "Rebate 2",
            "description": "Defines the depth of the rebate."
          },
          {
            "index": 4,
            "variable": "dWidth2",
            "type": "PropDouble",
            "displayName": "Width ",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "Rebate 2",
            "description": "Defines the width of the rebate."
          },
          {
            "index": 5,
            "variable": "dRadius2",
            "type": "PropDouble",
            "displayName": "Tool Radius ",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "Rebate 2",
            "description": "Defines the radius of the tool.This option will enlarge the tool regarding to the specified.value. 0 = irrelevant"
          },
          {
            "index": 6,
            "variable": "dMinArea",
            "type": "PropDouble",
            "displayName": "Minimal Area",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "Filter",
            "description": "Defines the mininmal area of an opening to be processed 0 = all openingsA negative value filters any opening being greater, positive values filter smaller openings."
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Flip Side (Doubleclick)",
            "handler": "Flip Side (Doubleclick)",
            "action": "Toggles the Face property between Reference Side and Opposite Side",
            "alsoTriggeredBy": "TslDoubleClick"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 10057,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically applies single or double-stepped rebates (grooves) around openings in CLT panels, such as doors or windows, to allow for the installation of additional frames, gaskets, or overlapping elements.",
          "category": "Machining/CNC",
          "typicalUseCase": "Preparing a wall panel opening to receive a timber sub-frame or to allow for a specific connection detail where the panel thickness needs to be reduced locally."
        },
        "parameters": [
          {
            "name": "sEdgeMode",
            "technicalDefault": "all",
            "businessMeaning": "Selects which sides of the opening are rebated. Allows for configurations like 'Top only' or 'Left and Right' to suit different connection requirements.",
            "validRange": "Dropdown list (11 options)",
            "unit": "enum",
            "affectsOutput": "Determines on which segments of the opening perimeter the machining tools are generated."
          },
          {
            "name": "sFace",
            "technicalDefault": "Reference Side",
            "businessMeaning": "Specifies whether the rebate is cut from the 'Reference Side' (usually the exterior or defined main face) or the 'Opposite Side' of the panel.",
            "validRange": "Dropdown list (Reference Side, Opposite Side)",
            "unit": "enum",
            "affectsOutput": "Flips the Z-direction of the machining tools so they cut into the correct face of the panel."
          },
          {
            "name": "dDepth",
            "technicalDefault": "20",
            "businessMeaning": "The depth of the primary rebate cut (how far into the panel the material is removed).",
            "validRange": "5 - 100 (depending on panel thickness)",
            "unit": "mm",
            "affectsOutput": "Controls the vertical depth of the subtractive volume."
          },
          {
            "name": "dWidth",
            "technicalDefault": "40",
            "businessMeaning": "The horizontal width of the primary rebate (the distance from the edge of the opening towards the panel interior).",
            "validRange": "10 - 200",
            "unit": "mm",
            "affectsOutput": "Controls the setback/depth of the cut perpendicular to the opening edge."
          },
          {
            "name": "dRadius",
            "technicalDefault": "0",
            "businessMeaning": "The radius of the milling tool used for the corners. If set, the internal corners of the rebate become rounded.",
            "validRange": "0 - 50 (0 implies sharp corners)",
            "unit": "mm",
            "affectsOutput": "Switches tool generation from simple square cuts (BeamCut) to profiled cuts (Mortise) with rounded corners."
          },
          {
            "name": "dDepth2",
            "technicalDefault": "0",
            "businessMeaning": "The depth of a second, inner rebate step. Creates a double rebate (stepped profile) if greater than 0.",
            "validRange": "0 - 100",
            "unit": "mm",
            "affectsOutput": "Activates the creation of a second machining layer inside the primary rebate."
          },
          {
            "name": "dWidth2",
            "technicalDefault": "0",
            "businessMeaning": "The width of the second rebate step.",
            "validRange": "0 - 200",
            "unit": "mm",
            "affectsOutput": "Defines the geometry of the secondary step in a double rebate configuration."
          },
          {
            "name": "dRadius2",
            "technicalDefault": "0",
            "businessMeaning": "The corner radius for the second rebate step.",
            "validRange": "0 - 50",
            "unit": "mm",
            "affectsOutput": "Rounds the corners of the secondary rebate tool."
          },
          {
            "name": "dMinArea",
            "technicalDefault": "0",
            "businessMeaning": "Filters openings by area to prevent applying rebates to small service holes or drill holes.",
            "validRange": "0 - 1,000,000 (0 = all openings)",
            "unit": "mm²",
            "affectsOutput": "Prevents the script from executing on openings smaller than the specified threshold."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sEdgeMode is set to specific sides (e.g., 'bottom + top')",
            "effect": "Disables machining on the excluded sides of the opening.",
            "cascade": [
              "bStretchs array logic"
            ]
          },
          {
            "trigger": "dRadius > 0",
            "effect": "Changes the tool type from a standard rectangular cut to a rounded mortise.",
            "cascade": [
              "Mortise creation logic",
              "Dimension requests for radius"
            ]
          },
          {
            "trigger": "dDepth2 or dWidth2 > 0",
            "effect": "Triggers the calculation of a second tooling pass to create a stepped rebate.",
            "cascade": [
              "Second loop in tool generation"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Mortise / BeamCut",
            "description": "Subtractive volumes added to the Sip entity to represent the rebate. 'Mortise' is used for rounded profiles (Radius > 0), 'BeamCut' for square profiles.",
            "appliedTo": "Sip (Panel)"
          },
          {
            "type": "TslInst (hsbCLT-RebateEdge)",
            "description": "In 'Edit in Place' mode, creates individual TSL instances for each edge of the opening to manage the tools separately.",
            "appliedTo": "Sip (Panel)"
          },
          {
            "type": "Dimension Request",
            "description": "Generates requests for radial dimensions on the drawing if the tool radius is significant.",
            "appliedTo": "Drawing/Annotation Layer"
          }
        ]
      },
      "tokens_used": 9574,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Start Script Insertion (_bOnInsert)\",\n    \"2. Display Dialog (or apply Catalog settings)\",\n    \"3. Prompt User to Select Panel(s) (PrEntity)\",\n    \"4. Iterate through selected Panels and their Openings\",\n    \"5. [Branch] Check 'Minimal Area' filter (dMinArea)\",\n    \"6. If opening passes filter, Attach Script Instance to Sip at Opening Center\",\n    \"7. Erase Original Insert Script Instance\",\n    \"8. Start Recalculation (_bOnRecalc) of Attached Instance\",\n    \"9. Validate Sip Entity exists (erase if invalid)\",\n    \"10. Determine Tool Coordinate System based on Panel orientation (Horizontal/Vertical)\",\n    \"11. Parse Properties: Set Face direction and Edge Mode flags (bStretchs)\",\n    \"12. Iterate Tool Passes (Rebate 1 and potentially Rebate 2)\",\n    \"13. Calculate Rebate Contour geometry (plContour) with offsets and bulges\",\n    \"14. Iterate through Contour Segments\",\n    \"15. [Branch] Check Segment validity and Edge Mode (is stretch enabled?)\",\n    \"16. [Branch] Check 'Edit In Place' mode\",\n    \"17. [Branch] Check Tool Radius (Mortise vs BeamCut)\",\n    \"18. Add Machining Tools to Sip OR Spawn Child TSLs\",\n    \"19. Add Dimension Requests (if Radius > 0)\",\n    \"20. Finalize and Update Display\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Minimal Area Filter (dMinArea)\",\n      \"path1\": {\n        \"name\": \"Filter Active\",\n        \"steps\": [\n          \"Calculate Opening Area\",\n          \"If dMinArea < 0: Skip if Area > abs(dMinArea)\",\n          \"If dMinArea > 0: Skip if Area < dMinArea\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No Filter (0)\",\n        \"steps\": [\n          \"Process all openings regardless of size\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Edge Mode Selection (sEdgeMode)\",\n      \"path1\": {\n        \"name\": \"Specific Sides\",\n        \"steps\": [\n          \"Disable machining flags (bStretchs) for excluded sides (e.g. Bottom, Top)\",\n          \"Only generate tools on enabled sides\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"All\",\n        \"steps\": [\n          \"Enable machining flags for all four sides (-Y, -X, Y, X)\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Edit In Place Mode\",\n      \"path1\": {\n        \"name\": \"Edit In Place Enabled\",\n        \"steps\": [\n          \"Create child instances of 'hsbCLT-RebateEdge' for each segment\",\n          \"Pass geometry and parameters to child instances\",\n          \"Erase Parent Instance after creation\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Standard Mode\",\n        \"steps\": [\n          \"Proceed to create native Machining tools (Mortise/BeamCut)\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Tool Radius (dRadius/dRadius2)\",\n      \"path1\": {\n        \"name\": \"Radius > 0\",\n        \"steps\": [\n          \"Create Mortise tool\",\n          \"Set RoundType to ExplicitRadius\",\n          \"Add Radial Dimension Request\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Radius == 0\",\n        \"steps\": [\n          \"Create BeamCut tool\",\n          \"Set ModifySectionForCnC to false\"\n        ]\n      }\n    },\n"
      },
      "tokens_used": 12356,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-RebateOpening.mcr\n\n## Overview\nThis script automatically creates single or double-stepped rebates (grooves) around openings in CLT panels, such as doors or windows. It prepares panel openings for the installation of frames, gaskets, or overlapping elements by machining the material edges.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the 3D model. |\n| Paper Space | No | Not applicable for 2D drawings. |\n| Shop Drawing | No | Machining is applied to the model, not the drawing layout. |\n\n## Prerequisites\n- **Required Entities**: Sip (Panel/Wall element).\n- **Minimum Beam Count**: 0 (Attached to Panels, not beams).\n- **Required Settings/Dependencies**: \n    - Dependent script: `hsbCLT-RebateEdge` (required for specific editing features).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsbCLT-RebateOpening.mcr` from the list.\n\n### Step 2: Select Panels\n```\nCommand Line: Select panel(s)\nAction: Click on the CLT panels or walls that contain the openings you wish to apply rebates to.\n```\n*Note: The script will automatically detect openings within the selected panels and apply the configuration based on the properties.*\n\n### Step 3: Configure Properties\nAfter insertion, select the script instance (or the panel) and modify the rebate dimensions in the Properties Palette (Ctrl+1).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **General** | | | |\n| Face | dropdown | Reference Side | Selects whether the rebate is cut from the Reference Side or the Opposite Side of the panel. |\n| Edge Mode | dropdown | all | Defines which sides of the opening receive the rebate (e.g., all, not bottom, left + right, etc.). |\n| **Filter** | | | |\n| Minimal Area | number | 0 | Filters openings by size. If set, only openings larger than this value (in mm²) are processed. Useful to exclude small drill holes. |\n| **Rebate 1** | | | |\n| Depth | number | 20 | The depth of the primary rebate cut (how far into the panel). |\n| Width | number | 40 | The horizontal width of the primary rebate (setback from the opening edge). |\n| Tool Radius | number | 0 | The radius for internal corners. Set to > 0 for rounded corners; 0 for sharp corners. |\n| **Rebate 2** | | | |\n| Depth | number | 0 | The depth of the second rebate step. Leave as 0 for a single rebate. |\n| Width | number | 0 | The width of the second rebate step. |\n| Tool Radius | number | 0 | The radius for the internal corners of the second rebate step. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip Side (Doubleclick) | Toggles the rebate between the Reference Side and Opposite Side of the panel. |\n\n## Settings Files\n- **Filename**: None specified (Internal defaults used).\n- **Dependency**: `hsbCLT-RebateEdge.mcr`\n  - **Purpose**: Required for \"Edit in Place\" functionality where individual tools are grouped into separate edge instances.\n\n## Tips\n- **Filtering Small Holes**: Use the **Minimal Area** property to avoid creating rebates on small service openings or drill holes (e.g., set to 10000 mm² to ignore holes smaller than 10cm x 10cm).\n- **Partial Rebates**: Use the **Edge Mode** to apply rebates only where needed (e.g., select \"not bottom\" if the bottom sill requires a different detail).\n- **Double Rebates**: To create a stepped profile, enter dimensions for **Rebate 2** (Depth and Width > 0).\n\n## FAQ\n- **Q: How do I create a double-stepped rebate?**\n- **A:** Enter values greater than 0 for the **Depth** and **Width** properties in the \"Rebate 2\" section of the Properties Palette.\n\n- **Q: Why are the corners of my rebate sharp?**\n- **A:** The **Tool Radius** is set to 0. Increase the **Tool Radius** (Rebate 1 or 2) to create rounded corners based on the milling tool size.\n\n- **Q: Can I apply this to just the top of a window opening?**\n- **A:** Yes. Change the **Edge Mode** property from \"all\" to \"top (Y)\" to restrict the rebate to just the top edge."
      },
      "tokens_used": 6662,
      "error": null
    }
  }
}