{
  "filename": "hsb_BattenDistributionSettings.mcr",
  "status": "completed",
  "total_tokens": 33048,
  "processing_time": 232.3473002910614,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "20.10.2015",
            "author": "Chirag Sawjani (chirag.sawjani@hsbcad.com)",
            "changes": "Initial settings for batten distribution construction plugin"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4302,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select ElementWall objects (ElementWallSF) and directly modifies their zone properties and SubMaps (el.setZone, el.setSubMapX). It lacks the sd_ prefix, _Viewport usage, and #Type E definitions characteristic of ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3479,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 6819,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Injects batten configuration parameters (widths, offsets, gaps) into selected Wall elements to prepare them for automated batten generation.\",\n    \"category\": \"Configuration/Framing\",\n    \"typicalUseCase\": \"Used before generating vertical battens on a wall to specify batten sizes, top/bottom plates, and edge clearances without manually drawing them.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"nZoneCount\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Selects the specific construction layer (Zone) on the wall where these batten settings will be applied.\",\n      \"validRange\": \"1 to 10\",\n      \"unit\": \"count\",\n      \"affectsOutput\": \"Determines which `ElemZone` of the wall receives the updated batten data.\"\n    },\n    {\n      \"name\": \"nColour\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"The display color index used for the battens/zone in the CAD model.\",\n      \"validRange\": \"1 to 255 (CAD Index)\",\n      \"unit\": \"index\",\n      \"affectsOutput\": \"Visual representation of the generated elements.\"\n    },\n    {\n      \"name\": \"sMaterial\",\n      \"technicalDefault\": \"CLS\",\n      \"businessMeaning\": \"Defines the material code (e.g., CLS for Canadian Lumber Standard) assigned to the battens.\",\n      \"validRange\": \"Any valid material string in the catalog\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Material property listing and potentially scheduling/costing.\"\n    },\n    {\n      \"name\": \"dZoneThickness\",\n      \"technicalDefault\": \"10\",\n      \"businessMeaning\": \"The thickness (depth) of the construction zone/battens perpendicular to the wall face.\",\n      \"validRange\": \"20 to 200\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"The Z-depth of the generated battens.\"\n    },\n    {\n      \"name\": \"dBattenWidth\",\n      \"technicalDefault\": \"38\",\n      \"businessMeaning\": \"The width (cross-section size) of the vertical battens.\",\n      \"validRange\": \"25 to 100\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Cross-section geometry of vertical battens.\"\n    },\n    {\n      \"name\": \"dTopBattenWidth\",\n      \"technicalDefault\": \"38\",\n      \"businessMeaning\": \"The width of the horizontal plate running along the top of the wall. If 0, no top plate is generated.\",\n      \"validRange\": \"0 to 200\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Presence and geometry of the top horizontal batten.\"\n    },\n    {\n      \"name\": \"dBottomBattenWidth\",\n      \"technicalDefault\": \"38\",\n      \"businessMeaning\": \"The width of the horizontal plate running along the bottom of the wall. If 0, no bottom plate is generated.\",\n      \"validRange\": \"0 to 200\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Presence and geometry of the bottom horizontal batten.\"\n    },\n    {\n      \"name\": \"dLeftOffset\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Distance from the left wall edge to the start of the vertical batten layout.\",\n      \"validRange\": \"0 to 1000\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Horizontal positioning of the first vertical batten.\"\n    },\n    {\n      \"name\": \"dRightOffset\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Distance from the right wall edge to the end of the vertical batten layout.\",\n      \"validRange\": \"0 to 1000\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Horizontal positioning of the last vertical batten.\"\n    },\n    {\n      \"name\": \"dTopOffset\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Distance from the top of the wall zone to the top of the vertical battens (usually aligns with top plate thickness).\",\n      \"validRange\": \"0 to 500\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Vertical positioning of the vertical battens.\"\n    },\n    {\n      \"name\": \"dBottomOffset\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Distance from the bottom of the wall zone to the bottom of the vertical battens.\",\n      \"validRange\": \"0 to 500\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Vertical positioning of the vertical battens.\"\n    },\n    {\n      \"name\": \"dTopGap\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Gap between the top horizontal plate and the start of the vertical battens.\",\n      \"validRange\": \"0 to 100\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Spacing at the top intersection.\"\n    },\n    {\n      \"name\": \"dBottomGap\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Gap between the bottom horizontal plate and the end of the vertical battens.\",\n      \"validRange\": \"0 to 100\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Spacing at the bottom intersection.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"dTopBattenWidth is set to 0\",\n      \"effect\": \"Disables the generation of the top plate (TopPlate flag set to 0).\",\n      \"cascade\": [\n        \"TopPlate\"\n      ]\n    },\n    {\n      \"trigger\": \"dBottomBattenWidth is set to 0\",\n      \""
      },
      "tokens_used": 6399,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User executes script (Insert or Execute)",
          "System checks if event is 'OnInsert'",
          "System checks insertCycleCount to prevent duplicate executions",
          "System displays properties dialog (showDialogOnce)",
          "User selects target Wall elements via PrEntity prompt",
          "Script appends selected elements to internal _Element array",
          "Script returns (saving element references for next cycle)",
          "System triggers recalculation (execution phase)",
          "Script iterates through all elements in _Element",
          "Script calculates Real Zone index based on user selection",
          "Script retrieves and updates properties for the specific Zone on the Element",
          "Script builds a Map containing batten distribution parameters (widths, offsets, gaps, flags)",
          "Script checks if 'ElemZone[]' SubMap already exists on the element",
          "If SubMap exists: Script searches for existing entry matching current ZoneIndex",
          "If Zone entry exists: Script overwrites the existing Map with new parameters",
          "If Zone entry missing: Script appends new Map to existing SubMap collection",
          "If SubMap missing: Script creates new SubMap and appends the Zone Map",
          "Script writes updated Map structure back to Element SubMap",
          "Script erases the instance",
          "Workflow Complete"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Event Check (_bOnInsert)",
            "path1": {
              "name": "Initial Insertion Cycle",
              "steps": [
                "Check insertCycleCount > 1",
                "If true: Erase instance and exit (prevent loops)",
                "If false: Show Dialog",
                "Prompt for Entity Selection",
                "Store Elements in _Element",
                "Return"
              ]
            },
            "path2": {
              "name": "Execution Cycle (Recalc)",
              "steps": [
                "Check if _Element array is empty",
                "Process elements",
                "Apply settings to SubMaps",
                "Erase instance"
              ]
            }
          },
          {
            "condition": "SubMap Existence (elementSubMap.hasMap)",
            "path1": {
              "name": "SubMap Exists",
              "steps": [
                "Loop through existing SubMap keys",
                "Check if entry with matching ZoneIndex exists",
                "Update existing entry or append new entry",
                "Save modified SubMap"
              ]
            },
            "path2": {
              "name": "No SubMap",
              "steps": [
                "Create new Map structure",
                "Append Zone data",
                "Save new SubMap"
              ]
            }
          },
          {
            "condition": "Top/Bottom Plate Generation Logic",
            "path1": {
              "name": "Plate Width > 0",
              "steps": [
                "Set Plate flag (TopPlate/BottomPlate) to 1 (True)"
              ]
            },
            "path2": {
              "name": "Plate Width = 0",
              "steps": [
                "Set Plate flag (TopPlate/BottomPlate) to 0 (False)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "insertCycleCount > 1",
            "errorMessage": "None (Silent)",
            "recovery": "Script automatically erases duplicate instance to prevent infinite loops."
          },
          {
            "check": "User cancels PrEntity selection",
            "errorMessage": "None (Silent)",
            "recovery": "If 'go()' returns false, elements are not added, and the script exits without error."
          },
          {
            "check": "_Element.length() == 0 on execution",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases instance immediately."
          },
          {
            "check": "Element validity (!el.bIsValid)",
            "errorMessage": "None (Silent)",
            "recovery": "Script skips the invalid element in the loop and continues to the next."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Batten Settings",
            "how": "Properties Palette (OPM)",
            "effect": "User can change widths, offsets, gaps, or material. Changing a property value triggers a recalc, re-writing the SubMap data to the selected wall elements."
          },
          {
            "action": "Change Zone Assignment",
            "how": "Properties Palette (OPM) - 'Zone to apply battens to'",
            "effect": "The script calculates the 'RealZone' (handling negative indices) and writes the settings to the new Zone layer on the wall."
          }
        ]
      },
      "tokens_used": 5690,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_BattenDistributionSettings.mcr\n\n## Overview\nThis script allows you to configure and save batten distribution parameters (such as sizes, offsets, and materials) directly onto selected Wall elements. It acts as a setup tool, injecting configuration data into the wall's properties to prepare it for automated batten generation processes.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in Model Space where Wall elements exist. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Not a shop drawing detailing script. |\n\n## Prerequisites\n- **Required entities**: ElementWall (Wall) entities must exist in the drawing.\n- **Minimum beam count**: 0 (This script works on Wall elements, not individual beams).\n- **Required settings**: None required.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Browse to and select `hsb_BattenDistributionSettings.mcr`.\n\n### Step 2: Configure Settings\n1. Upon launching, the script parameters will appear in the **Properties Palette** (or a dynamic dialog).\n2. Adjust the batten dimensions, offsets, and material codes to match your design requirements.\n3. Set the **Zone to apply battens to (`nZoneCount`)** to target the specific construction layer of the wall.\n\n### Step 3: Select Walls\n```\nCommand Line: Select ElementWall entities:\nAction: Click on the Wall elements you wish to apply the batten settings to. Press Enter to confirm selection.\n```\n*Note: You can select multiple walls at once to apply the same settings to all of them.*\n\n### Step 4: Execution\n1. Once selected, the script automatically writes the configuration data to the selected walls.\n2. The script instance will automatically erase itself from the drawing upon completion.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Zone to apply battens to | Integer | 0 | Selects the construction layer (Zone) on the wall (Range 1-10). |\n| Colour | Integer | 1 | The display color index (1-255) for the battens/zone. |\n| Material | String | CLS | Defines the material code (e.g., CLS) for the battens. |\n| Zone Thickness | Double | 10 mm | The thickness (depth) of the construction zone perpendicular to the wall face. |\n| Batten Width | Double | 38 mm | The width (cross-section size) of the vertical battens. |\n| Top Batten Width | Double | 38 mm | Width of the top horizontal plate (Set to 0 to disable). |\n| Bottom Batten Width | Double | 38 mm | Width of the bottom horizontal plate (Set to 0 to disable). |\n| Left Offset | Double | 0 mm | Distance from the left wall edge to the start of the layout. |\n| Right Offset | Double | 0 mm | Distance from the right wall edge to the end of the layout. |\n| Top Offset | Double | 0 mm | Distance from the top of the wall zone to the top of vertical battens. |\n| Bottom Offset | Double | 0 mm | Distance from the bottom of the wall zone to the bottom of vertical battens. |\n| Top Gap | Double | 0 mm | Gap between the top plate and the vertical battens. |\n| Bottom Gap | Double | 0 mm | Gap between the bottom plate and the vertical battens. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | The script instance removes itself immediately after execution, so no persistent right-click options are available. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not rely on external XML settings files; all configuration is handled via Properties Panel parameters.\n\n## Tips\n- **Batch Processing**: You can select multiple walls in a single command to apply standard batten settings across an entire floor plan.\n- **Plate Control**: If you do not require a top or bottom horizontal plate, simply set the **Top Batten Width** or **Bottom Batten Width** to `0`.\n- **Re-running**: If you need to change settings, simply run the script again, adjust the parameters in the Properties Palette, and select the walls again. The new settings will overwrite the old ones.\n\n## FAQ\n- **Q: Why did the script disappear after I selected the walls?**\n  **A:** This is a configuration script. Its job is to write data to the wall elements and then clean up by removing itself from the drawing.\n- **Q: I don't see any battens drawn in the model.**\n  **A:** This script only sets the *parameters* for battens. You must run your batten generation/construction plugin afterwards to visualize and create the actual timber elements based on these settings.\n- **Q: How do I apply settings to a different layer of the wall?**\n  **A:** Change the **Zone to apply battens to** parameter to the desired zone index (e.g., 1, 2, 3) before selecting the walls."
      },
      "tokens_used": 6359,
      "error": null
    }
  }
}