{
  "filename": "sd_LabelColEntInView.mcr",
  "status": "completed",
  "total_tokens": 40067,
  "processing_time": 288.8120608329773,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "2.5",
            "date": "01.03.2011",
            "author": "th@hsbCAD.de",
            "changes": "supports genbeams in no BOM mode"
          },
          {
            "version": "2.4",
            "date": "11.05.2010",
            "author": "th@hsbCAD.de",
            "changes": ""
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7984,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ShopDrawing",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": false,
          "detectionEvidence": "Filename starts with 'sd_'. On insert executes getShopDrawView(). Logic iterates _Entity[] to find ShopDrawView(). Script accesses _Map using _kOnGenerateShopDrawing. Performs coordinate transformations using ms2ps (Model to Paper Space)."
        },
        "prerequisites": {
          "requiredEntities": [
            "ShopDrawView",
            "MetalPartCollectionEnt"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be attached to a ShopDrawing Viewport",
          "requiredSettings": []
        }
      },
      "tokens_used": 6288,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getShopDrawView",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "TslUtilities (Generic)",
            "trigger": "On Insert",
            "title": null,
            "dataSource": "script parameters",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 1,
            "variable": "sShowBOM",
            "type": "PropString",
            "displayName": "Show List",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": "Controls whether the list is shown or not."
          },
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "Standard",
            "inputType": "dropdown",
            "options": [
              "System _DimStyles"
            ],
            "category": null,
            "description": "The dimstyle controls the textstyle and size of all texts being displayed."
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "The color of the instance."
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6034,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a Bill of Materials (BOM) schedule or individual labels for metal parts (connectors) within a specific Shop Drawing view.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used during detailing to annotate metal parts in 2D layout drawings, providing a schedule of their positions, names, quantities, and dimensions, or simple tags if a schedule is not required."
        },
        "parameters": [
          {
            "name": "sShowBOM",
            "technicalDefault": "|No|",
            "businessMeaning": "Toggles the display mode between a detailed tabular schedule (BOM) of metal parts and simple individual position labels.",
            "validRange": "Dropdown: |No|, |Yes|",
            "unit": "Enumeration",
            "affectsOutput": "If set to '|Yes|', draws a formatted table containing Pos, Name, Qty, Profile, Material, Length, Width, Height, and Weight for all metal parts in the view. If set to '|No|', only draws the position number tag at the center of each part."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "Standard",
            "businessMeaning": "Defines the text style and size for all annotations and table headers generated by the script to match drafting standards.",
            "validRange": "Any valid Dimension Style name existing in the current AutoCAD drawing.",
            "unit": "String (Name)",
            "affectsOutput": "Scales the text height and determines the font used for the labels and BOM table text."
          },
          {
            "name": "nColor",
            "technicalDefault": "1",
            "businessMeaning": "Sets the CAD color index for all graphical elements (text and lines) produced by the script.",
            "validRange": "1-255 (AutoCAD Color Index)",
            "unit": "Integer",
            "affectsOutput": "Changes the display color of the BOM table, text labels, and connector markers."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sShowBOM is set to |Yes|",
            "effect": "The script activates logic to calculate table geometry. It uses the grip point distance from the insertion point to determine the total width of the table.",
            "cascade": [
              "_PtG"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text Annotation",
            "description": "Position numbers (e.g., 'M1') placed at the center of metal parts in the view.",
            "appliedTo": "MetalPartCollectionEnt (Connectors) transformed to Paper Space."
          },
          {
            "type": "PLine Table",
            "description": "A grid of rectangles and text lines listing metal part properties.",
            "appliedTo": "Paper Space at the script insertion point."
          }
        ]
      },
      "tokens_used": 6409,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Initialization & Properties Loading",
          "Insert Cycle Check: If insertCycleCount > 1, eraseInstance and exit",
          "Insertion Logic: If _kExecuteKey is empty, show Dialog; else load Catalog properties",
          "User Input: Select ShopDrawView entity (getShopDrawView)",
          "User Input: Select Insertion Point (getPoint)",
          "Post-Insert Execution: Iterate _Entity to find attached ShopDrawView",
          "View Data Lookup: Find corresponding ViewData in _Map for current Viewport",
          "Validation: Check if ShopDrawView is valid and ViewData exists",
          "Entity Collection: Filter view entities for MetalPartCollectionEnt",
          "Branch Evaluation: Check 'sShowBOM' property (Yes/No)",
          "Display Execution: Either generate BOM Table or draw simple labels"
        ],
        "conditionalBranches": [
          {
            "condition": "_bOnInsert (First Run vs Update)",
            "path1": {
              "name": "Insertion Path",
              "steps": [
                "Check insertCycleCount() > 1",
                "Check _kExecuteKey (Catalog usage)",
                "Show Dialog or Set Props from Catalog",
                "Prompt for ShopDrawView",
                "Prompt for Point",
                "Return (End Script)"
              ]
            },
            "path2": {
              "name": "Update/Regen Path",
              "steps": [
                "Find ShopDrawView in _Entity array",
                "Find ViewData for Viewport",
                "Validate Data Integrity",
                "Process MetalPartCollections",
                "Draw Output (Table or Labels)"
              ]
            }
          },
          {
            "condition": "View Data Validation",
            "path1": {
              "name": "Valid View",
              "steps": [
                "Set bError = 0",
                "Extract ms2ps transformation",
                "Populate mpcAr array"
              ]
            },
            "path2": {
              "name": "Invalid/Missing View",
              "steps": [
                "Set bError = 1 (Invalid ShopDrawView) or 2 (No ViewData)",
                "Skip processing",
                "Result: No graphics generated"
              ]
            }
          },
          {
            "condition": "sShowBOM Property Value",
            "path1": {
              "name": "BOM Table Mode (sShowBOM == '|Yes|')",
              "steps": [
                "Verify/Set _PtG (Grip Point) for width calculation",
                "Define column structure (Widths, Headers, Data Indices)",
                "Calculate Table Width and Scaling Factor based on _PtG distance",
                "Count required lines (Collections + internal Beams)",
                "Draw Table Header (Rectangles and Text)",
                "Iterate Collections and Beams",
                "Draw Position Tag on part in View (Paper Space)",
                "Draw Data Rows in Table (Profile, Dimensions, Weight, etc.)",
                "Calculate and sum totals"
              ]
            },
            "path2": {
              "name": "Label Only Mode (sShowBOM == '|No|')",
              "steps": [
                "Iterate MetalPartCollections",
                "Iterate internal GenBeams",
                "Check if GenBeam is dummy (skip if yes)",
                "Get Center Point (ptCen)",
                "Transform Point to Paper Space (ms2ps)",
                "Draw Position Number Text"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "ShopDrawView Validity",
            "errorMessage": "No explicit error message to user",
            "recovery": "Script sets internal flag bError=1. User must attach script to a valid ShopDrawing Viewport."
          },
          {
            "check": "ViewData Availability",
            "errorMessage": "No explicit error message to user",
            "recovery": "Script sets internal flag bError=2. Requires valid _Map entry (_kOnGenerateShopDrawing) for the current viewport."
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None",
            "recovery": "Script automatically erases duplicate instances if run multiple times in one insert command."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Resize BOM Table",
            "how": "Grip Edit (Modifying _PtG)",
            "effect": "Calculates new width based on distance between _Pt0 and _PtG. Scales all column widths and text size proportionally."
          },
          {
            "action": "Toggle Schedule Mode",
            "how": "OPM Property 'Show List' (sShowBOM)",
            "effect": "Switches between detailed Table generation and simple individual labels."
          },
          {
            "action": "Adjust Visual Style",
            "how": "OPM Properties 'Dimstyle' and 'Color'",
            "effect": "Updates text font, height, and color for all generated elements."
          },
          {
            "action": "Move Instance",
            "how": "AutoCAD Move/Grips on _Pt0",
            "effect": "Relocates the table origin or label reference point."
          }
        ]
      },
      "tokens_used": 8070,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# sd_LabelColEntInView.mcr\n\n## Overview\nThis script generates a Bill of Materials (BOM) schedule or simple position labels for metal parts (connectors) within a specific Shop Drawing view. It automatically annotates connectors visible in the selected viewport with their position numbers, dimensions, and material properties.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for annotation in layouts. |\n| Paper Space | Yes | Requires a valid Shop Drawing viewport to function. |\n| Shop Drawing | Yes | It detects entities specific to Shop Drawings (ShopDrawView). |\n\n## Prerequisites\n- **Required Entities**: A valid Shop Drawing viewport (`ShopDrawView`) and Metal Parts (Connectors) inside that view.\n- **Minimum Beam Count**: 0 (This script focuses on metal parts, not structural beams).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `sd_LabelColEntInView.mcr` from the file dialog.\n\n### Step 2: Select Shop Drawing View\n```\nCommand Line: (No specific prompt text detected)\nAction: Click on the border of the Shop Drawing viewport you wish to annotate.\n```\n\n### Step 3: Specify Insertion Point\n```\nCommand Line: (No specific prompt text detected)\nAction: Click in Paper Space to define the origin point for the table or label reference.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Show List | dropdown | \\|No\\| | Determines the output mode. Select `|No|` to draw simple position tags on parts only. Select `|Yes|` to generate a full BOM table in addition to the tags. |\n| Dimstyle | dropdown | Standard | Selects the text style and size for the annotations. It uses the system's available dimension styles to control text height and font. |\n| Color | number | 1 | Sets the CAD color index (1-255) for all text and lines generated by the script. |\n\n## Right-Click Menu Options\nThis script does not add custom items to the right-click context menu. Editing is done via the Properties Panel and grips.\n\n## Settings Files\nNo external settings files (XML) are required or used by this script.\n\n## Tips\n- **Resizing the Table**: If `Show List` is set to `|Yes|`, you can select the script instance and drag the **Grip Point** (usually the second point) to adjust the width of the BOM table. The text and columns will scale automatically.\n- **Switching Modes**: If your drawing becomes too cluttered, change `Show List` to `|No|`. This removes the table but keeps the position markers (e.g., \"M1\", \"M2\") on the metal parts.\n- **Text Consistency**: Ensure your selected `Dimstyle` is set to the correct height for your drawing scale; otherwise, the text may appear too large or too small in the viewport.\n- **Placement**: Place the insertion point where there is enough empty space for the table to expand if you plan to use the BOM mode.\n\n## FAQ\n- **Q: I inserted the script, but no text or table appeared. Why?**\n  A: Ensure you selected a valid Shop Drawing viewport that contains Metal Parts (Connectors). If the viewport has no connectors or the view data is not fully generated, the script will produce no output.\n- **Q: Can I label beams with this script?**\n  A: No, this script is specifically designed to label `MetalPartCollectionEnt` (connectors/hardware). It does not label structural timber beams.\n- **Q: How do I change the text font?**\n  A: You cannot change the font directly in the script properties. Instead, create or modify an AutoCAD Dimension Style with your desired font and assign that style to the `Dimstyle` property of this script."
      },
      "tokens_used": 5282,
      "error": null
    }
  }
}