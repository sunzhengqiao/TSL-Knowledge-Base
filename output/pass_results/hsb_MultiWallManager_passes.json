{
  "filename": "hsb_MultiWallManager.mcr",
  "status": "completed",
  "total_tokens": 43791,
  "processing_time": 387.9624035358429,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "22.08.2012",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "First version"
          },
          {
            "version": "1.2",
            "date": "14.11.2012",
            "author": "",
            "changes": "Add the option to choose group and also now it's independant from the version of hsb that it's running on"
          },
          {
            "version": "1.04",
            "date": "15.09.2016",
            "author": "",
            "changes": "Also trigger hsb_DrawMultiElement for recalc."
          },
          {
            "version": "1.6",
            "date": "13.12.2021",
            "author": "Nils Gregor",
            "changes": "HSB-13941 Provide default export group."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6047,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "PrEntity prompt selects Element(). Code collects entities using _kModel. TslInst recalculation collects from _kModelSpace. Manipulates ModelMap (dbComposeMap/dbInterpretMap). No sd_ prefix, Multipage, or Paper Space usage found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbMultiwallExporter.dll",
            "MultiElementTools.dll"
          ]
        }
      },
      "tokens_used": 5633,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one or More Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowNotice",
            "trigger": "DLL not found or no result returned",
            "title": "Notice",
            "dataSource": "Script Logic",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "ShowNotice",
            "trigger": "License check failure (hsbMultiwallComposer)",
            "title": "Warning",
            "dataSource": "DotNet Function Return",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "ShowNotice",
            "trigger": "Failure to create default export group",
            "title": "Warning",
            "dataSource": "DotNet Function Return",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sMWExport",
            "type": "PropString",
            "displayName": "Export Group",
            "defaultValue": "First available group containing 'MW' or Default",
            "inputType": "dropdown",
            "options": "Dynamic list from ModelMap exporter groups",
            "category": null,
            "description": "Select an export group. Only groups containing \"MW\" and separated by \"_\"  or groups that contain the  \"Multiwall Export Starter\" export are shown. If \"Default export group\" is selected, a new group called \"hsb_MW_Export_Group_for_Multiwalls\" is created."
          },
          {
            "index": 1,
            "variable": "nameFormat",
            "type": "PropString",
            "displayName": "Name Format",
            "defaultValue": "@(Code)_@(SW)",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "The name format for naming the multi elements. @(Code)_@(SW) will be used when left blank. Other example for a name format is: MW_@(Seq)"
          },
          {
            "index": 2,
            "variable": "sUpDateExisting",
            "type": "PropString",
            "displayName": "Update existing multi elements",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "Defines if existing multi elements are updated and loose all changes."
          },
          {
            "index": 3,
            "variable": "sClearMetaData",
            "type": "PropString",
            "displayName": "Clear multi element meta data",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "Deletes all existing multi elements and clears the data."
          },
          {
            "index": 4,
            "variable": "sRecalcExistingTsls",
            "type": "PropString",
            "displayName": "Recalc existing multi element tsls",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "Defines if existing multi element tsls recalculated"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8255,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Manages the configuration, creation, and naming of Multiwall (prefab wall) assemblies, including handling export groups and updating element metadata.",
          "category": "Data Management / Prefab / Framing",
          "typicalUseCase": "Used when converting individual timber wall elements into a unified Multiwall assembly for manufacturing export or drawing generation."
        },
        "parameters": [
          {
            "name": "sMWExport",
            "technicalDefault": "First available group containing 'MW' or 'Default export group'",
            "businessMeaning": "Selects the manufacturing interface configuration to apply. This defines how the wall data is structured for the specific machine or production software (e.g., Multiwall Exporter).",
            "validRange": "Dynamic list of available Export Groups (filtered for 'MW' or specific export starters)",
            "unit": "String",
            "affectsOutput": "Determines the data structure and metadata generated for the Multiwall elements, ensuring compatibility with downstream production tools."
          },
          {
            "name": "nameFormat",
            "technicalDefault": "@(Code)_@(SW)",
            "businessMeaning": "Defines the naming convention used to identify the generated Multiwall elements in the model and on drawings.",
            "validRange": "String with hsbCAD tokens (e.g., @(Code), @(SW), @(Seq), MW_@(Seq))",
            "unit": "String",
            "affectsOutput": "Updates the Element Number or Name property of the Multiwall assembly."
          },
          {
            "name": "sUpDateExisting",
            "technicalDefault": "Yes",
            "businessMeaning": "Controls how existing Multiwall scripts are recalculated. 'Yes' forces a full refresh (potentially losing manual edits), while 'No' attempts a standard update.",
            "validRange": "No, Yes",
            "unit": "Boolean",
            "affectsOutput": "Influences the calculation state of dependent drawing scripts (HSB_MULTIWALLDRAW, etc.), specifically whether they execute a 'Refresh all' command or a standard update."
          },
          {
            "name": "sClearMetaData",
            "technicalDefault": "No",
            "businessMeaning": "Functions as a reset or deletion tool for Multiwall intelligence. It removes the specific multiwall data links from the elements.",
            "validRange": "No, Yes",
            "unit": "Boolean",
            "affectsOutput": "Deletes the 'hsb_Multiwall' sub-map data from the selected elements, effectively disassociating them from the Multiwall configuration."
          },
          {
            "name": "sRecalcExistingTsls",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the automatic regeneration of visual representations (drawings/3D previews) of the multiwalls.",
            "validRange": "No, Yes",
            "unit": "Boolean",
            "affectsOutput": "If 'Yes', triggers the recalculation of TSL instances responsible for drawing the multiwalls. If 'No', data updates occur but visuals may remain stale."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sMWExport selection",
            "effect": "If 'Default export group' is chosen, the script creates a new group named 'hsb_MW_Export_Group_for_Multiwalls' via .NET function.",
            "cascade": [
              "ModelMap Export Settings"
            ]
          },
          {
            "trigger": "sRecalcExistingTsls set to 'No'",
            "effect": "Changes made to other parameters (like nameFormat) might update the metadata but will not automatically update the drawing scripts to reflect the new names or geometry.",
            "cascade": [
              "Visual Output (TslInst)"
            ]
          },
          {
            "trigger": "sClearMetaData set to 'Yes'",
            "effect": "Removes existing maps immediately. The script continues to re-compose maps based on current settings, effectively resetting the multiwalls to default.",
            "cascade": [
              "Element Metadata"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Element Map Data",
            "description": "Updates the hsb_Multiwall sub-map within the Element entity, containing composition and export data.",
            "appliedTo": "Selected Elements"
          },
          {
            "type": "Export Group",
            "description": "Potentially creates a new Export Group configuration in the ModelMap if the default option is used.",
            "appliedTo": "Project Configuration"
          },
          {
            "type": "TslInst Trigger",
            "description": "Forces recalculation of Multiwall drawing scripts (e.g., HSB_DRAWMULTIELEMENT) to update geometry and labels.",
            "appliedTo": "Model Space TSL Instances associated with the elements"
          }
        ]
      },
      "tokens_used": 7737,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Initialization and License Check\",\n    \"2. Retrieve and Filter Export Groups (MW specific)\",\n    \"3. Define Properties (Export Group, Name Format, Flags)\",\n    \"4. Check for Insertion State (_bOnInsert)\",\n    \"5. [If Inserting]: Show Dialog Once -> Prompt for Element Selection -> Store Elements in _Element -> Return\",\n    \"6. [Execution Phase]: Check 'Clear multi element meta data' property\",\n    \"7. [If Clear Metadata = Yes]: Iterate ALL Model Elements and remove 'hsb_Multiwall' sub-maps\",\n    \"8. Check if 'Export Group' property equals 'Default export group'\",\n    \"9. [If Default]: Call DotNet function to create default group -> Update 'Export Group' property with new name\",\n    \"10. Iterate selected Elements (_Element) and collect their Group Entities\",\n    \"11. Compose ModelMap (Solids, Tools, Hardware, Analysis info)\",\n    \"12. Call DotNet function (MultiElementTools.dll) to compose Multiwall metadata\",\n    \"13. Check hsbCAD Version string for 'hsbCAD18'\",\n    \"14. [If Version 18]: Manually parse map data -> Match Element Numbers -> Apply sub-maps via setSubMapX\",\n    \"15. [If Not Version 18]: Interpret ModelMap via dbInterpretMap\",\n    \"16. Check 'Recalc existing multi element tsls' property\",\n    \"17. [If Recalc = Yes]: Collect all TslInsts in Model Space -> Filter for Multiwall scripts\",\n    \"18. Check 'Update existing multi elements' property (inside Recalc loop)\",\n    \"19. [If Update = Yes]: Recalc with 'Refresh all Multielements' command\",\n    \"20. [If Update = No]: Recalc with 'update Multielements' command\",\n    \"21. Erase Script Instance and Exit\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"License Check during Initialization\",\n      \"path1\": {\n        \"name\": \"License Error\",\n        \"steps\": [\n          \"DotNet function returns Error code\",\n          \"Report Warning: 'The hsbMultiwallComposer license is missing'\",\n          \"Erase Instance\",\n          \"Return\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"License Valid\",\n        \"steps\": [\n          \"Continue to Property Definition\",\n          \"Populate Export Group list\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Clear Metadata Property (sClearMetaData)\",\n      \"path1\": {\n        \"name\": \"Yes (Clear Data)\",\n        \"steps\": [\n          \"Collect ALL Elements in Model Space\",\n          \"Loop through every Element\",\n          \"Remove 'hsb_Multiwall' sub-map if present\",\n          \"Proceed to new group creation logic\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No (Preserve Data)\",\n        \"steps\": [\n          \"Skip data removal loop\",\n          \"Proceed to new group creation logic\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Export Group Selection (sMWExport)\",\n      \"path1\": {\n        \"name\": \"Default Group Selected\",\n        \"steps\": [\n          \"Call DotNet CreateDefaultGroup\",\n          \"Check for creation errors\",\n          \"Update sMWExport variable to actual group name created\",\n          \"Proceed to ModelMap composition\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Existing Group Selected\",\n        \"steps\": [\n          \"Use sMWExport value directly\",\n          \"Proceed to ModelMap composition\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"hsbCAD Version Check\",\n      \"path1\": {\n        \"name\": \"hsbCAD 18 or earlier (Legacy Map Handling)\",\n        \"steps\": [\n          \"Extract specific map paths (ElementWall...ElementNumber)\",\n          \"Match result numbers to selected Element numbers\",\n          \"Apply map directly to Element using el.setSubMapX\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Newer Versions (Standard Interpretation)\",\n        \"steps\": [\n          \"Load Map into ModelMap object\",\n          \"Run mm.dbInterpretMap to process entities automatically\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Recalc TSLs Flag (sRecalcExistingTsls)\",\n      \"path1\": {\n        \"name\": \"Yes (Update Visuals)\",\n        \"steps\": [\n          \"Collect TslInst entities\",\n          \"Filter by script names (HSB_MULTI"
      },
      "tokens_used": 9675,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_MultiWallManager.mcr\n\n## Overview\nThis script configures, names, and updates Multiwall (prefab wall) assemblies for manufacturing export. It manages element metadata, assigns export groups, and controls the regeneration of associated drawings for selected wall elements.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in Model Space. |\n| Paper Space | No | Not supported in Layouts. |\n| Shop Drawing | No | This is a model configuration tool. |\n\n## Prerequisites\n- **Required entities**: Element (Timber walls).\n- **Minimum beam count**: 0 (Operates on Element level).\n- **Required settings**: \n  - `hsbMultiwallExporter.dll`\n  - `MultiElementTools.dll`\n  - Valid Export Groups configured in the ModelMap.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_MultiWallManager.mcr` from the list.\n\n### Step 2: Select Wall Elements\n```\nCommand Line: Select one or More Elements\nAction: Click on the wall elements (Element entities) you wish to include in the Multiwall assembly, then press Enter.\n```\n\n### Step 3: Configure Properties\n```\nAction: With the script instance selected, open the Properties Palette (Ctrl+1) to configure the Multiwall settings.\n```\n\n### Step 4: Apply Updates\n```\nAction: Modify the parameters in the Properties Panel. The script will automatically process the changes based on the flags set (e.g., recalc drawings, update metadata).\nNote: The script instance may erase itself after execution depending on the specific workflow context.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Export Group | dropdown | First available 'MW' group | Select the manufacturing interface configuration. If \"Default export group\" is selected, a new group is created automatically. |\n| Name Format | text | `@(Code)_@(SW)` | Defines the naming convention for the Multiwall elements (e.g., `MW_@(Seq)`). |\n| Update existing multi elements | dropdown | Yes | If \"Yes\", forces a full refresh of existing multi elements (this may overwrite manual changes). |\n| Clear multi element meta data | dropdown | No | **Warning:** If \"Yes\", deletes all existing multiwall data from *all* elements in the model, effectively resetting the configuration. |\n| Recalc existing multi element tsls | dropdown | Yes | If \"Yes\", forces the associated drawing scripts to regenerate to reflect geometry and name changes. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add specific items to the right-click context menu. All interactions are handled via the Properties Palette. |\n\n## Settings Files\n- **Dependencies**: `hsbMultiwallExporter.dll`, `MultiElementTools.dll`\n- **Location**: hsbCAD Application Directory.\n- **Purpose**: These DLLs handle the logic for composing Multiwall maps and interacting with the manufacturing export configuration. No specific XML settings file is required for the script itself beyond standard ModelMap configurations.\n\n## Tips\n- **Resetting Data**: Use the \"Clear multi element meta data\" property with caution. It scans the *entire* model, not just your selection, to remove multiwall links.\n- **Naming Tokens**: Ensure your \"Name Format\" uses valid hsbCAD tokens like `@(Code)`, `@(SW)`, or `@(Seq)` to guarantee correct numbering.\n- **Drawing Updates**: If you change the Name Format but your drawing labels do not update, ensure \"Recalc existing multi element tsls\" is set to \"Yes\".\n- **Export Groups**: The list of Export Groups is automatically filtered to show only those containing \"MW\" or specific export starters.\n\n## FAQ\n- **Q: What happens if I choose \"Default export group\"?**\n- **A**: The script will automatically create a new Export Group in your ModelMap named `hsb_MW_Export_Group_for_Multiwalls` and assign it to the elements.\n\n- **Q: My Multiwall names changed in the model, but the drawings are still showing the old names.**\n- **A**: Check the \"Recalc existing multi element tsls\" property. If it is set to \"No\", the drawing scripts will not automatically update to reflect the new name format or geometry.\n\n- **Q: I received a license warning during insertion.**\n- **A**: Ensure your license dongle includes the `hsbMultiwallComposer` module. The script will stop functioning if this specific license is not found."
      },
      "tokens_used": 6444,
      "error": null
    }
  }
}