{
  "filename": "sd_MetalPartChildPageCreate.mcr",
  "status": "completed",
  "total_tokens": 36738,
  "processing_time": 371.89163088798523,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "Creates nested multipages in dependency of the content of the metalpart collection entity and of the given styles",
        "versionHistory": [
          {
            "version": "1.2",
            "date": "01.03.2011",
            "author": "th@hsbCAD.de",
            "changes": "supports childpages of genBeams"
          },
          {
            "version": "1.1",
            "date": "19.10.2010",
            "author": "th@hsbCAD.de",
            "changes": ""
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5766,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ShopDrawing",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "Filename 'sd_MetalPartChildPageCreate.mcr', conditional logic for _bOnGenerateShopDrawing, usage of keys _kShopDrawChildPageCreate and _kShopDrawChildPageArea, appending Maps to 'Page[]' keys, and properties defining sShopDrawStyle."
        },
        "prerequisites": {
          "requiredEntities": [
            "MetalPartCollectionEnt",
            "EntPline"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (for insertion/definition) / ShopDrawing Event (for execution)",
          "requiredSettings": [
            "sShopDrawStyleCE",
            "sShopDrawStyleCESingle",
            "sShopDrawStyleBM"
          ]
        }
      },
      "tokens_used": 5379,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getEntPLine",
              "promptOriginal": "Select pline area where child pages can be placed",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowNotice",
            "trigger": "When a metal part GenBeam is found without a position number (posnum == -1) during ShopDrawing generation",
            "title": "Warning",
            "dataSource": "Static warning text",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sShopDrawStyleCE",
            "type": "PropString",
            "displayName": "Shopdraw style Metalpart Assembly",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sShopDrawStyleBM",
            "type": "PropString",
            "displayName": "Shopdraw style GenBeam",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sShopDrawStyleCESingle",
            "type": "PropString",
            "displayName": "Shopdraw style Metalpart Single",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Select pline area where child pages can be placed",
            "handler": "_kExecuteKey == strChangeEntity",
            "action": "Prompts user to select a new polyline to redefine the child page area",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 6752,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of detail drawings (child pages) for metal parts during shop drawing generation, separating assemblies from individual single parts.",
          "category": "ShopDrawing",
          "typicalUseCase": "When generating production drawings for timber frames with steel connections (brackets, gussets), this script automatically adds specific detail pages for the steelwork to the layout sheet."
        },
        "parameters": [
          {
            "name": "sShopDrawStyleCE",
            "technicalDefault": "",
            "businessMeaning": "The name of the Shop Drawing Style (template) used to generate detail views for Metal Part Assemblies (connections consisting of multiple steel parts welded or bolted together).",
            "validRange": "Any valid Shop Drawing Style name configured in the hsbCAD environment.",
            "unit": "String",
            "affectsOutput": "Determines the scale, view projection, and labeling of the detail drawing for complex metal connections."
          },
          {
            "name": "sShopDrawStyleBM",
            "technicalDefault": "",
            "businessMeaning": "The name of the Shop Drawing Style used to generate detail views for the individual GenBeams (steel members) contained within a larger Metal Part Assembly.",
            "validRange": "Any valid Shop Drawing Style name configured in the hsbCAD environment.",
            "unit": "String",
            "affectsOutput": "Determines how individual steel components (plates, profiles) inside an assembly are detailed when exploded into separate child pages."
          },
          {
            "name": "sShopDrawStyleCESingle",
            "technicalDefault": "",
            "businessMeaning": "The name of the Shop Drawing Style used to generate detail views for Metal Parts that consist of only a single piece (e.g., a simple steel plate).",
            "validRange": "Any valid Shop Drawing Style name configured in the hsbCAD environment.",
            "unit": "String",
            "affectsOutput": "Determines the drawing style for simple single-part metal connections, optimizing the drawing process by using a simpler template than the assembly style."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Metal Part Geometry Analysis",
            "effect": "The script inspects the Metal Part Collection. If it contains multiple beams, 'sShopDrawStyleCE' is used for the assembly view and 'sShopDrawStyleBM' for the components. If it contains only one beam, 'sShopDrawStyleCESingle' is used instead.",
            "cascade": [
              "sShopDrawStyleCE",
              "sShopDrawStyleCESingle",
              "sShopDrawStyleBM"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "ShopDrawing ChildPage",
            "description": "Automatically generated detail pages inserted into the drawing layout.",
            "appliedTo": "Metal Part Collections and their sub-components found in the design."
          },
          {
            "type": "Map Entry (Page)",
            "description": "Internal map data defining the content and style of the child pages to be rendered by the shopdrawing engine.",
            "appliedTo": "The current drawing's Page Map."
          }
        ]
      },
      "tokens_used": 6366,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script: User runs sd_MetalPartChildPageCreate.mcr",
          "2. Select Anchor: User selects insertion point (_Pt0) in model space",
          "3. Define Area: User selects a polyline representing the boundary for child page placement",
          "4. Store Geometry: Selected polyline is stored in the TSL internal map ('myPL') and erased from model space",
          "5. Property Configuration: User (optionally) configures Shop Drawing Styles via Properties Palette",
          "6. Generate Drawing: User triggers Shop Drawing generation",
          "7. Area Export: Script exports the stored polyline to the '_kShopDrawChildPageArea' map key",
          "8. Entity Processing: Script iterates through entities connected to the script/host element",
          "9. Tool Inspection: Identifies 'MetalPartCollectionEnt' entities within the design",
          "10. Filtering: Checks for visibility filters (intersection tests) defined in sub-components",
          "11. Page Generation: Determines component count (Single vs Assembly) and creates Map entries for Child Pages",
          "12. Rendering: Shopdrawing engine renders the generated child pages within the defined area"
        ],
        "conditionalBranches": [
          {
            "condition": "Metal Part Component Count (beams within the Metal Part Collection)",
            "path1": {
              "name": "Single Part",
              "steps": [
                "Detected 1 GenBeam inside Metal Part Collection",
                "Uses 'sShopDrawStyleCESingle' property for the view",
                "Creates one Child Page entry",
                "Skips creation of individual component pages"
              ]
            },
            "path2": {
              "name": "Multi-Part Assembly",
              "steps": [
                "Detected >1 GenBeams inside Metal Part Collection",
                "Uses 'sShopDrawStyleCE' property for the Assembly view",
                "Creates Assembly Child Page entry",
                "Loops through individual beams",
                "Uses 'sShopDrawStyleBM' for each component",
                "Creates individual Child Page entries for each beam"
              ]
            }
          },
          {
            "condition": "Visibility Filter (defined by 'HSBDEFINESHOPDRAWSHOWSETMETALPART' TSL)",
            "path1": {
              "name": "Visible",
              "steps": [
                "Filter TSL is present",
                "Geometry intersects with the host GenBeam",
                "Proceeds to Page Generation logic"
              ]
            },
            "path2": {
              "name": "Hidden/Filtered",
              "steps": [
                "Filter TSL is present",
                "Geometry does NOT intersect with host GenBeam",
                "Script skips processing this specific Metal Part Collection",
                "No page is generated for this entity"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Metal Part Position Numbering",
            "errorMessage": "Warning: 'The shopdrawing might be incomplete due to missing numbers of the metal part entities.'",
            "recovery": "User must edit the block definition of the metal part, assign position numbers (PosNum), and regenerate the multipage."
          },
          {
            "check": "Entity Availability",
            "errorMessage": "Report Message: 'No entities to shopdraw.'",
            "recovery": "Ensure metal parts are connected to the element or that the script is attached to the correct entity."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Redefine Child Page Area",
            "how": "Right-click Context Menu -> Select 'Select pline area where child pages can be placed'",
            "effect": "Prompts user to select a new polyline. The new geometry replaces the old area in the internal map, changing where subsequent child pages are placed on the drawing."
          },
          {
            "action": "Update Drawing Styles",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Modifies 'sShopDrawStyleCE', 'sShopDrawStyleCESingle', or 'sShopDrawStyleBM' strings. Changes the visual style/scale used for the metal parts in the next shopdrawing regeneration."
          }
        ]
      },
      "tokens_used": 7357,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# sd_MetalPartChildPageCreate\n\n## Overview\nAutomates the creation of detail drawings (child pages) for metal parts during shop drawing generation. This script intelligently separates simple single steel plates from complex assemblies and places them into a specific area on your layout sheet.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used to insert the script and define the drawing area. |\n| Paper Space | Yes | The child pages are generated here during the Shop Drawing process. |\n| Shop Drawing | Yes | The script executes automatically when generating a multipage shop drawing. |\n\n## Prerequisites\n- **Required Entities**: Metal Part Collections (steel connections) must be present in the model.\n- **Minimum Beam Count**: 0 (This script is geometry-independent but relies on attached metal parts).\n- **Required Settings**: Valid Shop Drawing Style names must exist in your hsbCAD environment for \"Assemblies\", \"Single Parts\", and \"GenBeams\".\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `sd_MetalPartChildPageCreate.mcr` from the list.\n\n### Step 2: Set Insertion Point\n```\nCommand Line: (No specific prompt, usually accepts default or click)\nAction: Click a point in the model to anchor the script instance.\n```\n\n### Step 3: Define Drawing Area\n```\nCommand Line: Select pline area where child pages can be placed\nAction: Select a closed polyline in the Model Space.\nNote: This polyline defines the boundary (frame) on the layout sheet where the metal details will be placed. The script will remember this shape and remove the original line from the model.\n```\n\n### Step 4: Configure Properties (Optional)\nSelect the script instance and open the **Properties Palette**. Enter the names of the Shop Drawing Styles you wish to use for different types of metal parts.\n\n### Step 5: Generate Shop Drawing\nRun the standard `Generate Shopdrawing` command. The script will automatically scan for metal parts and populate the child pages based on your configuration.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Shopdraw style Metalpart Assembly | Text | \"\" | The name of the Shop Drawing Style used for complex metal connections (assemblies consisting of multiple parts). |\n| Shopdraw style Metalpart Single | Text | \"\" | The name of the Shop Drawing Style used for simple metal parts (a single steel plate or item). |\n| Shopdraw style GenBeam | Text | \"\" | The name of the Shop Drawing Style used for individual components (beams) inside a metal assembly. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Select pline area where child pages can be placed | Allows you to redefine the boundary area for the child pages. Select a new polyline in the model to update the layout frame. |\n\n## Settings Files\nThis script relies on standard hsbCAD Shop Drawing Styles rather than specific external XML settings files. Ensure the styles referenced in the Properties Panel are defined in your project or database configuration.\n\n## Tips\n- **Area Definition**: The polyline you select acts as a \"container.\" Ensure it is large enough to fit the expected details, or the shop drawing engine might overlap content.\n- **Styles Logic**: The script checks the number of components in a metal part. If it finds multiple parts, it uses the \"Assembly\" style for the group and the \"GenBeam\" style for the pieces. If it finds only one part, it uses the \"Single\" style.\n- **Filtering**: If you use the `HSBDEFINESHOPDRAWSHOWSETMETALPART` script, ensure your metal parts intersect correctly with the host beam, or they will be filtered out and not drawn.\n\n## FAQ\n- **Q: I see a warning \"The shopdrawing might be incomplete due to missing numbers...\"**\n  **A:** This means one or more of your metal parts does not have a Position Number assigned. Edit the metal part block to assign a Position Number (PosNum) and regenerate the drawing.\n- **Q: How do I move the details to a different spot on the sheet?**\n  **A:** Use the Right-Click menu option \"Select pline area where child pages can be placed\" and draw a new polyline in the desired location. Regenerate the shop drawing to apply the change.\n- **Q: Why are some of my steel parts not showing up?**\n  **A:** Check if a visibility filter script is applied. The script filters out metal parts whose geometry does not physically intersect with the host GenBeam."
      },
      "tokens_used": 5118,
      "error": null
    }
  }
}