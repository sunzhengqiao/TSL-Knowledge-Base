{
  "filename": "CC.mcr",
  "status": "completed",
  "total_tokens": 56341,
  "processing_time": 364.82892203330994,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 5,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl creates concealed connectors\nIt supports Knapp Walco Z40, Z32\nWalco Z connectors are identical brackets made out of blue-galvanized steel. \nCommonly used gaskets can be installed on the prefabricated wall panels.\nWhen sliding the wall panels together, the brackets hook into each other in a dovetail-like manner and tighten up the joint. \nThe tsl can be inserted at 2 parallel beams\nThe 2 parallel beams can be part of 2 walls that will be connected\nThe first selected beam will serve as the main principal beam",
        "versionHistory": [
          {
            "version": "1.5",
            "date": "01/04/2025",
            "author": "Marsel Nakuci",
            "changes": "Fix group assignment"
          },
          {
            "version": "1.4",
            "date": "01/04/2025",
            "author": "Marsel Nakuci",
            "changes": "Fix position of connector"
          },
          {
            "version": "1.3",
            "date": "20.03.2025",
            "author": "Marsel Nakuci",
            "changes": "Add property \"Marking\"; Add color parameter in xml"
          },
          {
            "version": "1.2",
            "date": "24/06/2024",
            "author": "Marsel Nakuci",
            "changes": "Add tooling (Drill,milling) parameters as instance properties"
          },
          {
            "version": "1.1",
            "date": "21.06.2024",
            "author": "Marsel Nakuci",
            "changes": "Add mode distribution at 2 studs"
          },
          {
            "version": "1.0",
            "date": "10.04/2024",
            "author": "Marsel Nakuci",
            "changes": "Initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 9046,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses 3D geometric entities (GenBeam, Beam, Element, Point3d, Vector3d, Body) and creates 3D tooling (Drill, BeamCut, HardWrComp). No references to ShopDrawing functions (sd_*), Viewport logic, or Paper Space (_kPaperSpace) are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space (requires 2 parallel beams belonging to 2 stick frame walls)",
          "requiredSettings": [
            "Block files (e.g., Z40, Z32) located in the path defined by _kPathHsbCompany\\Block"
          ]
        }
      },
      "tokens_used": 7749,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getGenBeam",
              "promptOriginal": "Select first beam",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getGenBeam",
              "promptOriginal": "select second parallel beam",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "insertionMode",
            "type": "PropInt",
            "displayName": "insertionMode",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sManufacturer",
            "type": "PropString",
            "displayName": "Manufacturer",
            "defaultValue": "Knapp Walco",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sConnectorType",
            "type": "PropString",
            "displayName": "ConnectorType",
            "defaultValue": "Z40",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dConnectorOffsetX",
            "type": "PropDouble",
            "displayName": "ConnectorOffsetX",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dConnectorOffsetZ",
            "type": "PropDouble",
            "displayName": "ConnectorOffsetZ",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "bWriteToElement",
            "type": "PropInt",
            "displayName": "Write to element",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sGroupCode",
            "type": "PropString",
            "displayName": "GroupCode",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "dDrillDiameter",
            "type": "PropDouble",
            "displayName": "DrillDiameter",
            "defaultValue": -1.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "dDrillDepth",
            "type": "PropDouble",
            "displayName": "DrillDepth",
            "defaultValue": -1.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "dMillingWidth",
            "type": "PropDouble",
            "displayName": "MillingWidth",
            "defaultValue": -1.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 10,
            "variable": "dMillingDepth",
            "type": "PropDouble",
            "displayName": "MillingDepth",
            "defaultValue": -1.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 11,
            "variable": "bMarking",
            "type": "PropInt",
            "displayName": "Marking",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Swap Connectors|",
            "handler": "|Swap Connectors|",
            "action": "Swaps the connector orientation between the two beams and inverts offset properties.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "<ConnectorType>.xml",
            "searchPaths": [
              "_kPathHsbCompany\\Block"
            ],
            "purpose": "Provides geometric definitions and block names for the specific connector type (e.g., Z40, Z32).",
            "required": true
          }
        ]
      },
      "tokens_used": 8879,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the insertion and tooling of concealed shear connectors (specifically Knapp Walco Z-type brackets) used to join two parallel timber wall panels.",
          "category": "Hardware",
          "typicalUseCase": "When designing prefabricated timber walls that need to be connected on-site via sliding dovetail mechanisms."
        },
        "parameters": [
          {
            "name": "insertionMode",
            "technicalDefault": 0,
            "businessMeaning": "Determines the insertion context. Currently, 0 is the standard mode requiring 2 parallel beams (studs) from stick frame walls.",
            "validRange": "0",
            "unit": "count",
            "affectsOutput": "Validates that the correct number and type of beams are selected before generation."
          },
          {
            "name": "sManufacturer",
            "technicalDefault": "Knapp Walco",
            "businessMeaning": "Specifies the brand of the connector, which dictates the specific geometry and machining rules to apply.",
            "validRange": "Manufacturer names matching XML filenames (e.g., 'Knapp Walco')",
            "unit": "text",
            "affectsOutput": "Determines which XML configuration file is searched for geometric data."
          },
          {
            "name": "sConnectorType",
            "technicalDefault": "Z40",
            "businessMeaning": "The specific model number of the connector (e.g., Z40, Z32), defining its size, shape, and required clearance.",
            "validRange": "String values matching XML filenames (e.g., 'Z40', 'Z32')",
            "unit": "text",
            "affectsOutput": "Loads the specific 3D block geometry and default machining parameters from the corresponding XML file."
          },
          {
            "name": "dConnectorOffsetX",
            "technicalDefault": 0.0,
            "businessMeaning": "Shifts the connector position along the length of the beam (longitudinal axis).",
            "validRange": "-500 to 500 mm (depending on beam length and design requirements)",
            "unit": "mm",
            "affectsOutput": "Moves the connector geometry and the associated milling/drilling operations along the beam."
          },
          {
            "name": "dConnectorOffsetZ",
            "technicalDefault": 0.0,
            "businessMeaning": "Shifts the connector position vertically relative to the beam's height.",
            "validRange": "-200 to 200 mm (depending on beam height and design requirements)",
            "unit": "mm",
            "affectsOutput": "Moves the connector geometry and the associated milling/drilling operations up or down within the beam profile."
          },
          {
            "name": "bWriteToElement",
            "technicalDefault": 0,
            "businessMeaning": "Determines if the tooling data is written to the parent Wall Element (for production) or kept local to the specific beams.",
            "validRange": "0 (No), 1 (Yes)",
            "unit": "bool",
            "affectsOutput": "If Yes, ensures CNC data is exported at the Wall Element level; if No, data remains associated with individual beams."
          },
          {
            "name": "sGroupCode",
            "technicalDefault": "",
            "businessMeaning": "A user-defined code to group this connector instance for reporting, filtering, or scheduling purposes.",
            "validRange": "Alphanumeric string",
            "unit": "text",
            "affectsOutput": "Metadata only; used in BOMs or lists."
          },
          {
            "name": "dDrillDiameter",
            "technicalDefault": -1.0,
            "businessMeaning": "Diameter of the drill holes for fasteners. A value of -1.0 forces the use of the default diameter defined in the XML.",
            "validRange": "-1 (Default) or typical metric drill sizes (e.g., 5, 6, 8, 10 mm)",
            "unit": "mm",
            "affectsOutput": "Size of the Drill entities generated on the beams."
          },
          {
            "name": "dDrillDepth",
            "technicalDefault": -1.0,
            "businessMeaning": "Depth of the drill holes for fasteners. A value of -1.0 forces the use of the default depth defined in the XML.",
            "validRange": "-1 (Default) or 0 to beam width",
            "unit": "mm",
            "affectsOutput": "Length of the Drill entities generated on the beams."
          },
          {
            "name": "dMillingWidth",
            "technicalDefault": -1.0,
            "businessMeaning": "Width of the slot/routout required to recess the connector body. A value of -1.0 uses the XML default.",
            "validRange": "-1 (Default) or width matching connector size",
            "unit": "mm",
            "affectsOutput": "Width of the milling/cutout operations."
          },
          {
            "name": "dMillingDepth",
            "technicalDefault": -1.0,
            "businessMeaning": "Depth of the slot/routout required to recess the connector body. A value of -1.0 uses the XML default.",
            "validRange": "-1 (Default) or depth matching connector thickness",
            "unit": "mm",
            "affectsOutput": "Depth of the milling/cutout operations."
          },
          {
            "name": "bMarking",
            "technicalDefault": 0,
            "businessMeaning": "Enables the creation of a visual marking (text or symbol) on the timber to indicate the connector location.",
            "validRange": "0 (No), 1 (Yes)",
            "unit": "bool",
            "affectsOutput": "Adds a marking entity to the beam if enabled."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Context Menu: 'Swap Connectors'",
            "effect": "Swaps the assignment of the connector halves (Male/Female) between Beam 0 and Beam 1. It also inverts the sign of the offset parameters to maintain relative position.",
            "cascade": [
              "dConnectorOffsetX",
              "dConnectorOffsetZ"
            ]
          },
          {
            "trigger": "Changing 'sConnectorType'",
            "effect": "Loads new geometric definitions and default machining values from the corresponding XML file.",
            "cascade": [
              "dDrillDiameter",
              "dDrillDepth",
              "dMillingWidth",
              "dMillingDepth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Visual Block/Body",
            "description": "Represents the physical connector (Male and Female parts) in the 3D model for visualization and collision detection.",
            "appliedTo": "Model Space (visual representation attached to TSL instance)"
          },
          {
            "type": "Milling/Slot",
            "description": "Rectangular routout milled into the beam to recess the connector body.",
            "appliedTo": "Both selected Beams"
          },
          {
            "type": "Drill",
            "description": "Cylindrical holes for fastening screws or nails to secure the connector.",
            "appliedTo": "Both selected Beams"
          },
          {
            "type": "Hardware",
            "description": "Data entity tracking the connector part number and quantity for production lists (BOM).",
            "appliedTo": "Both selected Beams"
          },
          {
            "type": "Marking",
            "description": "Text or line scribing to identify the connector location on the shop floor.",
            "appliedTo": "Both selected Beams (if bMarking is enabled)"
          }
        ]
      },
      "tokens_used": 10645,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initiation: Start TSL execution, set constants (Units: mm, Epsilon), and initialize properties.",
          "2. Input Selection (Insertion): Prompt user to select first beam (getGenBeam).",
          "3. Input Selection (Insertion): Prompt user to select second parallel beam (getGenBeam).",
          "4. Pre-Validation: Run checkInsertion function to verify 2 GenBeams exist and are valid.",
          "5. Validation (Mode 0): Verify 2 valid Beams exist within the GenBeams.",
          "6. Geometry Check: Validate beams are parallel (using vector dot product).",
          "7. Structural Check: Ensure beams belong to 2 different Stick Frame Walls (Elements).",
          "8. Geometry Calculation: Determine connection vector (Y or Z axis direction) and mid-point between beams using validate2Beams.",
          "9. XML Loading: Read configuration file based on Manufacturer (e.g., 'Knapp Walco') and ConnectorType (e.g., 'Z40') from _kPathHsbCompany\\Block.",
          "10. Parameter Application: Apply offsets (dConnectorOffsetX, dConnectorOffsetZ) and override default tooling dimensions (Drill/Milling) if properties are set >= 0.",
          "11. Geometry Generation: Calculate 3D transformations for Male and Female connector bodies based on beam local coordinate systems.",
          "12. Visualization: Draw connector representations (Blocks if found in XML, otherwise fallback Bodies).",
          "13. Tooling Application: Apply Milling, Drilling, and Marking to the beams using applyTools function.",
          "14. Hardware Assignment: Add HardWrComp entries to the instance for BOM reporting using applyHardware.",
          "15. Finalize: Write hardware components to instance and exit."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Mode (insertionMode)",
            "path1": {
              "name": "Mode 0 (Default): Two Studs",
              "steps": [
                "Select 2 Beams",
                "Validate Beams are parallel",
                "Validate Beams belong to separate Stick Frame Walls",
                "Proceed with connector generation."
              ]
            },
            "path2": {
              "name": "Other Modes",
              "steps": [
                "The script structure suggests potential for other modes, but currently, only Mode 0 logic is explicitly implemented and detailed in the code provided."
              ]
            }
          },
          {
            "condition": "XML Block Availability",
            "path1": {
              "name": "Block Found",
              "steps": [
                "Search for <ConnectorType>.xml in Company Block folder",
                "Load Block Name and Orientation definitions",
                "Draw the specific 3D Block representation aligned to beam."
              ]
            },
            "path2": {
              "name": "Block Not Found (Fallback)",
              "steps": [
                "XML not found or Block entry missing",
                "Generate procedural Body geometry",
                "Draw generic body shape."
              ]
            }
          },
          {
            "condition": "Tooling Parameter Overrides",
            "path1": {
              "name": "User Defined (>0)",
              "steps": [
                "Check dDrillDiameter, dDrillDepth, dMillingWidth, dMillingDepth",
                "If value >= 0, use the user input value.",
                "Apply specific custom size to Drill/Milling entities."
              ]
            },
            "path2": {
              "name": "Default (-1)",
              "steps": [
                "Check parameters",
                "If value is -1.0, ignore user property",
                "Use dimensions defined in the loaded XML configuration."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "GenBeam Count",
            "errorMessage": "2 genbeams needed",
            "recovery": "User must select exactly 2 GenBeams during the initial prompts."
          },
          {
            "check": "GenBeam Validity",
            "errorMessage": "2 valid genbeams needed",
            "recovery": "Ensure the selected entities are valid, un-deleted GenBeams."
          },
          {
            "check": "Beam Count (Mode 0)",
            "errorMessage": "2 beams needed",
            "recovery": "The GenBeams must contain valid Beam geometry (e.g., valid wall studs)."
          },
          {
            "check": "Beam Validity",
            "errorMessage": "2 valid beams needed",
            "recovery": "Ensure the underlying beam entities are valid."
          },
          {
            "check": "Beam Alignment",
            "errorMessage": "2 beams not parallel",
            "recovery": "Select two beams that are parallel (or nearly parallel within tolerance)."
          },
          {
            "check": "Wall Assignment",
            "errorMessage": "2 beams must belong to 2 SF walls",
            "recovery": "Ensure each beam is part of a valid Element (Stick Frame Wall), and preferably two different walls."
          },
          {
            "check": "Connection Feasibility",
            "errorMessage": "2 Beams can not be connected",
            "recovery": "Beams are too far apart or not aligned in a way that allows a perpendicular connection vector (Y or Z)."
          },
          {
            "check": "Section Orientation",
            "errorMessage": "2 beams are not properly aligned for connection",
            "recovery": "Beams must be oriented consistently (e.g., not flipped relative to each other) to allow the connector to align."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Swap Connectors",
            "how": "Right-click Context Menu -> 'Swap Connectors'",
            "effect": "Swaps the connector assignment (Beam 0 becomes Female, Beam 1 becomes Male). Inverts dConnectorOffsetX and dConnectorOffsetZ signs to maintain relative position."
          },
          {
            "action": "Adjust Offsets",
            "how": "Properties Palette (OPM)",
            "effect": "Modifies 'ConnectorOffsetX' (along beam length) and 'ConnectorOffsetZ' (vertical). Visuals and tooling update immediately."
          },
          {
            "action": "Change Connector Type",
            "how": "Properties Palette (OPM) -> 'ConnectorType' or 'Manufacturer'",
            "effect": "Reloads geometry and default tooling from a different XML file (e.g., switching from Z40 to Z32). Resets tooling if they were set to default."
          },
          {
            "action": "Customize Tooling",
            "how": "Properties Palette (OPM) -> Drill/Milling properties",
            "effect": "Overrides the XML defaults for hole sizes and slot dimensions. Set to -1 to revert to XML default."
          },
          {
            "action": "Edit Geometry",
            "how": "Grip Edit (if enabled, though code sets setAllowGripAtPt0(false))",
            "effect": "Script explicitly disables grip point at the insertion point (_Pt0) to prevent unintended dragging of the calculation origin, relying instead on offset properties."
          }
        ]
      },
      "tokens_used": 12058,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# CC.mcr\n\n## Overview\nThis script automates the insertion and tooling of concealed shear connectors (specifically Knapp Walco Z-type brackets) to join two parallel timber wall panels. It calculates the required milling and drilling for precise on-site assembly using dovetail-like mechanisms.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script requires 3D context with two parallel beams (studs). |\n| Paper Space | No | Not applicable. |\n| Shop Drawing | No | This script focuses on 3D model generation and CNC tooling. |\n\n## Prerequisites\n- **Required Entities:** Two GenBeams (e.g., wall studs) belonging to stick frame walls.\n- **Minimum Beam Count:** 2 parallel beams.\n- **Required Settings Files:** XML configuration files (e.g., `Z40.xml`, `Z32.xml`) must be present in the folder `_kPathHsbCompany\\Block`.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `CC.mcr`\n\n### Step 2: Select First Beam\n```\nCommand Line: Select first beam\nAction: Click on the first wall stud (principal beam) that will hold the connector.\n```\n\n### Step 3: Select Second Beam\n```\nCommand Line: select second parallel beam\nAction: Click on the parallel wall stud located on the adjacent wall panel.\n```\n\n*Note: The script will automatically validate that the beams are parallel and belong to valid wall elements before generating the connector and tooling.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Insertion Mode | number | 0 | Determines the insertion logic (Mode 0 = Two Studs). |\n| Manufacturer | text | Knapp Walco | The brand of the connector (must match XML folder name). |\n| ConnectorType | text | Z40 | The specific model number (e.g., Z40, Z32). Loads specific geometry. |\n| ConnectorOffsetX | number | 0.0 | Shifts the connector position along the length of the beam (mm). |\n| ConnectorOffsetZ | number | 0.0 | Shifts the connector position vertically relative to the beam (mm). |\n| Write to element | number | 0 | If set to 1, tooling data is written to the parent Wall Element. |\n| GroupCode | text | (empty) | User-defined code for grouping in reports or BOMs. |\n| DrillDiameter | number | -1.0 | Diameter of drill holes. Set to -1 to use XML default. |\n| DrillDepth | number | -1.0 | Depth of drill holes. Set to -1 to use XML default. |\n| MillingWidth | number | -1.0 | Width of the slot for the connector. Set to -1 to use XML default. |\n| MillingDepth | number | -1.0 | Depth of the slot for the connector. Set to -1 to use XML default. |\n| Marking | number | 0 | If set to 1, adds a visual marking/scribing on the timber. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Swap Connectors | Swaps the male and female connector halves between the two beams. It also inverts the offset values (X and Z) to maintain the connector's relative position. |\n\n## Settings Files\n- **Filename**: `<ConnectorType>.xml` (e.g., `Z40.xml`)\n- **Location**: `_kPathHsbCompany\\Block`\n- **Purpose**: Defines the 3D block geometry, default dimensions, and machining rules (drills/milling) for the specific connector model.\n\n## Tips\n- **Offset Adjustment**: Use `ConnectorOffsetX` and `ConnectorOffsetZ` to slide the connector along the beam or up/down without moving the beam itself.\n- **Tooling Defaults**: Keep Drill and Milling dimensions set to `-1` to automatically use the manufacturer's recommended specifications found in the XML file.\n- **Orientation**: If the connector is facing the wrong way for your assembly sequence, use the Right-Click \"Swap Connectors\" option instead of re-selecting beams.\n\n## FAQ\n- **Q: I get an error \"2 beams not parallel\".**\n  A: Ensure the two studs you selected are perfectly parallel (or within a very small tolerance). They must belong to two separate wall panels intended to be connected.\n  \n- **Q: The connector geometry is missing.**\n  A: Verify that the XML file matching your `ConnectorType` (e.g., `Z40.xml`) exists in your company block folder (`_kPathHsbCompany\\Block`).\n\n- **Q: How do I change the connector size after insertion?**\n  A: Select the script instance in the model, open the Properties Palette, and change the `ConnectorType` property (e.g., from \"Z40\" to \"Z32\"). The script will reload the new geometry and tooling."
      },
      "tokens_used": 7964,
      "error": null
    }
  }
}