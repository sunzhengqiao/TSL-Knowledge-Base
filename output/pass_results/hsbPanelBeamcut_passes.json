{
  "filename": "hsbPanelBeamcut.mcr",
  "status": "completed",
  "total_tokens": 44112,
  "processing_time": 246.66988372802734,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 8212,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _kModelSpace in tslNew.dbCreate() and operates on 3D Sip (Panel) and GenBeam/Entity geometry. It performs 3D boolean operations (Body.intersectWith), creates BeamCut objects, and modifies panel contours via sip.addTool() and sip.addOpening()."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip",
            "Entity (GenBeam or Tooling Solid)"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5501,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && _kExecuteKey == \"\"",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity.go",
              "promptOriginal": "Select Panel(s)",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrEntity.go",
              "promptOriginal": "Select Tooling Solid(s)",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Properties Dialog (Default TSL)",
            "trigger": "During script insertion if no catalog key is active (_kExecuteKey == \"\")",
            "title": null,
            "dataSource": "Script Properties (sToolMode, dGapX, etc.)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dGapX",
            "type": "PropDouble",
            "displayName": "|Gap| X",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "The gap properties allow to specify a gap in the given direction."
          },
          {
            "index": 1,
            "variable": "dGapY",
            "type": "PropDouble",
            "displayName": "|Gap| Y",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "The gap properties allow to specify a gap in the given direction."
          },
          {
            "index": 2,
            "variable": "dGap_X",
            "type": "PropDouble",
            "displayName": "|Gap| -X",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "The gap properties allow to specify a gap in the given direction."
          },
          {
            "index": 3,
            "variable": "dGap_Y",
            "type": "PropDouble",
            "displayName": "|Gap| -Y",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "The gap properties allow to specify a gap in the given direction."
          },
          {
            "index": 4,
            "variable": "dGapZ",
            "type": "PropDouble",
            "displayName": "|Gap| Z",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "The gap properties allow to specify a gap in the given direction."
          },
          {
            "index": 5,
            "variable": "dGap_Z",
            "type": "PropDouble",
            "displayName": "|Gap| -Z",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "The gap properties allow to specify a gap in the given direction."
          },
          {
            "index": 0,
            "variable": "sToolMode",
            "type": "PropString",
            "displayName": "|Tool Mode|",
            "defaultValue": "|Auto|",
            "inputType": "dropdown",
            "options": [
              "|Beamcut|",
              "|Vertex Adjustment|",
              "|Auto|"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6551,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically creates cutouts or openings in structural timber panels (SIPs/CLT) to accommodate intersecting beams or tooling solids, with configurable clearance gaps.",
          "category": "Joinery/Machining",
          "typicalUseCase": "Used when a beam passes through or butts into a panel. The user defines the required spacing (gaps) between the beam and the panel cutout to ensure proper fit, allow for glue, or accommodate manufacturing tolerances."
        },
        "parameters": [
          {
            "name": "sToolMode",
            "technicalDefault": "|Auto|",
            "businessMeaning": "Determines the strategy used to cut the panel. 'Beamcut' creates a standard rectangular boolean cut object. 'Vertex Adjustment' modifies the actual panel geometry/envelope edges. 'Auto' detects if the cut goes fully through the panel (Vertex Adjustment) or is a partial notch (Beamcut).",
            "validRange": "|Beamcut|, |Vertex Adjustment|, |Auto|",
            "unit": "Enum",
            "affectsOutput": "Switches the calculation logic between applying a GenBeam-style BeamCut object and physically stretching the panel's envelope vertices to create the opening."
          },
          {
            "name": "dGapX",
            "technicalDefault": "U(0)",
            "businessMeaning": "Clearance (gap) on the Positive side of the Beam's Local X-axis (usually the beam's length). Increases the hole size or shifts the cut center asymmetrically.",
            "validRange": "-20.0 to 50.0",
            "unit": "mm",
            "affectsOutput": "Expands the cutout geometry in the direction of the beam's positive local X-axis. In 'Beamcut' mode, it expands the rectangular cut width; in 'Vertex' mode, it stretches the panel edges."
          },
          {
            "name": "dGapY",
            "technicalDefault": "U(0)",
            "businessMeaning": "Clearance on the Positive side of the Beam's Local Y-axis (usually the beam's width).",
            "validRange": "-20.0 to 50.0",
            "unit": "mm",
            "affectsOutput": "Expands the cutout geometry in the direction of the beam's positive local Y-axis."
          },
          {
            "name": "dGapZ",
            "technicalDefault": "U(0)",
            "businessMeaning": "Clearance on the Positive side of the Beam's Local Z-axis (usually the beam's height).",
            "validRange": "-20.0 to 50.0",
            "unit": "mm",
            "affectsOutput": "Expands the cutout geometry vertically in the direction of the beam's positive local Z-axis."
          },
          {
            "name": "dGap_X",
            "technicalDefault": "U(0)",
            "businessMeaning": "Clearance on the Negative side of the Beam's Local X-axis (opposite to beam length direction).",
            "validRange": "-20.0 to 50.0",
            "unit": "mm",
            "affectsOutput": "Expands the cutout geometry in the direction of the beam's negative local X-axis. Allows for asymmetric gaps (e.g., tight fit on left, loose on right)."
          },
          {
            "name": "dGap_Y",
            "technicalDefault": "U(0)",
            "businessMeaning": "Clearance on the Negative side of the Beam's Local Y-axis.",
            "validRange": "-20.0 to 50.0",
            "unit": "mm",
            "affectsOutput": "Expands the cutout geometry in the direction of the beam's negative local Y-axis."
          },
          {
            "name": "dGap_Z",
            "technicalDefault": "U(0)",
            "businessMeaning": "Clearance on the Negative side of the Beam's Local Z-axis (downwards relative to beam height).",
            "validRange": "-20.0 to 50.0",
            "unit": "mm",
            "affectsOutput": "Expands the cutout geometry vertically in the direction of the beam's negative local Z-axis."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sToolMode is set to |Auto|",
            "effect": "The script calculates the intersection depth. If the tool passes entirely through the panel thickness, it forces 'Vertex Adjustment' mode. If it is a partial intersection, it forces 'Beamcut' mode.",
            "cascade": []
          },
          {
            "trigger": "Changing dGap... values",
            "effect": "In 'Beamcut' mode, gaps expand the rectangular box dimensions symmetrically or asymmetrically. In 'Vertex Adjustment' mode, gaps translate the intersection profile edges outward along the detected normal vectors.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "BeamCut",
            "description": "A parametric cutting object applied to the panel. Used when the intersecting beam does not pass fully through the panel (notch) or when forced.",
            "appliedTo": "Sip (Panel)"
          },
          {
            "type": "Opening/Contour Modification",
            "description": "A direct geometric modification of the panel's envelope and material body. Used when the tool passes fully through the panel (penertrating) in Auto mode.",
            "appliedTo": "Sip (Panel)"
          }
        ]
      },
      "tokens_used": 8203,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Insertion Started (_bOnInsert)",
          "[Conditional] Check _kExecuteKey (Catalog Usage)",
          "Show Properties Dialog (if manual insert)",
          "Prompt User: Select Panel(s)",
          "Prompt User: Select Tooling Solid(s)",
          "Loop: Iterate through selected Panels and Tools",
          "Calculate Intersection Volume between Tool and Panel",
          "[Conditional] Validate Intersection Volume",
          "Generate TSL Instance for valid intersections (Cloning)",
          "Erase Macro Instance",
          "Instance Execution: Retrieve Sip and Entity geometry",
          "Calculate Intersection Body (bdIntersect)",
          "[Conditional] Determine Cut Mode (Through vs. Partial)",
          "Apply Gaps (dGapX, dGapY, etc.) to Cutting Body/Vertices",
          "Apply Modification to Panel (AddTool or StretchEdge/AddOpening)",
          "Generate Display Graphics"
        ],
        "conditionalBranches": [
          {
            "condition": "Intersection Depth vs. Panel Thickness",
            "path1": {
              "name": "Vertex Adjustment Mode (Through Cut)",
              "steps": [
                "nMode set to 1 (Intersection depth approx equals panel thickness)",
                "Extract slice profile of intersection",
                "Calculate tool vectors and profile rings",
                "Apply gaps to profile vertices",
                "Execute sip.addOpening() for perpendicular openings",
                "Execute sip.stretchEdgeTo() to modify panel envelope"
              ]
            },
            "path2": {
              "name": "Beamcut Mode (Partial/Notch)",
              "steps": [
                "nMode set to 0 (Intersection depth less than panel thickness)",
                "Wrap solid in GenBeam (if not already)",
                "Calculate BeamCut dimensions including gaps",
                "Create BeamCut object",
                "Execute sip.addTool(BeamCut)"
              ]
            }
          },
          {
            "condition": "Tool Entity Type",
            "path1": {
              "name": "GenBeam",
              "steps": [
                "Cast entity directly to GenBeam",
                "Extract dimensions using .solidLength(), .solidWidth(), etc."
              ]
            },
            "path2": {
              "name": "Generic Entity/Solid",
              "steps": [
                "Create temporary GenBeam from Body",
                "Use temporary GenBeam for calculation",
                "Erase temporary GenBeam after processing"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Intersection Volume and Validity",
            "errorMessage": "Entity (type) does not intersect the panel or is an invalid tool",
            "recovery": "User must select a different tool or panel that physically intersects."
          },
          {
            "check": "Entity/Panel Availability on Reload",
            "errorMessage": "ScriptName No panel or no tool available",
            "recovery": "Script erases itself; user must restore deleted entities or re-insert the connection."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Properties (Gaps)",
            "how": "OPM (Object Properties Palette)",
            "effect": "Updates the size/position of the cutout or opening geometry immediately upon recalculation."
          },
          {
            "action": "Move Beam or Panel",
            "how": "Grip Edit / AutoCAD Move Command",
            "effect": "Script recalculates intersection. Note: Connection type (Beamcut vs Vertex) must remain the same, otherwise script may fail or behave unexpectedly."
          }
        ]
      },
      "tokens_used": 9690,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbPanelBeamcut.mcr\n\n## Overview\nAutomatically creates cutouts or openings in structural timber panels (SIPs/CLT) to accommodate intersecting beams or tooling solids. This script handles both notches (partial cuts) and through-holes, with configurable clearance gaps to ensure proper fit.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D Panel and Beam geometry. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | Not applicable. |\n\n## Prerequisites\n- **Required Entities**: At least one Panel (Sip) and one intersecting Entity (GenBeam or Tooling Solid).\n- **Minimum Beams**: 1 intersecting beam or solid.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbPanelBeamcut.mcr` from the file dialog.\n\n### Step 2: Configure Properties\n```\nCommand Line: (Properties Dialog appears)\nAction: Adjust the Tool Mode and Clearance Gaps in the dialog that appears, then click OK.\n```\n*Note: If launched via a catalog key, this step may be skipped.*\n\n### Step 3: Select Panels\n```\nCommand Line: Select Panel(s)\nAction: Click on the panel(s) (Sip) where you want the cutout to occur and press Enter.\n```\n\n### Step 4: Select Tooling Solids\n```\nCommand Line: Select Tooling Solid(s)\nAction: Click on the beam or solid that passes through the panel and press Enter.\n```\nThe script will now calculate the intersection and apply the cut to the panel.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Tool Mode | dropdown | Auto | Determines how the cut is applied.<br>**Auto**: Detects if the cut goes fully through the panel (Vertex Adjustment) or is a partial notch (Beamcut).<br>**Beamcut**: Forces a standard rectangular notch.<br>**Vertex Adjustment**: Forces a modification of the panel's envelope edges (for through-holes). |\n| Gap X | number | 0 | Clearance on the Positive side of the Beam's Local X-axis (length direction). |\n| Gap Y | number | 0 | Clearance on the Positive side of the Beam's Local Y-axis (width direction). |\n| Gap Z | number | 0 | Clearance on the Positive side of the Beam's Local Z-axis (height direction). |\n| Gap -X | number | 0 | Clearance on the Negative side of the Beam's Local X-axis (length direction). |\n| Gap -Y | number | 0 | Clearance on the Negative side of the Beam's Local Y-axis (width direction). |\n| Gap -Z | number | 0 | Clearance on the Negative side of the Beam's Local Z-axis (height direction). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are added by this script. Use the Properties Palette to modify settings. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Use \"Auto\" Mode**: Keep the Tool Mode set to \"Auto\" to let the script intelligently decide between creating a through-hole (Vertex Adjustment) or a notch (Beamcut) based on whether the beam penetrates the entire panel.\n- **Asymmetric Gaps**: You can set different values for positive (+X) and negative (-X) gaps. This is useful if you need a tight fit on one side of the beam but extra clearance on the other.\n- **Moving Geometry**: If you move the beam or the panel using AutoCAD grips or the Move command, the script will recalculate and update the cutout automatically.\n\n## FAQ\n- **Q: What is the difference between \"Beamcut\" and \"Vertex Adjustment\"?**\n  - A: \"Beamcut\" adds a separate cutting object (like a router toolpath) to the panel, typically used for notches where the beam doesn't go all the way through. \"Vertex Adjustment\" physically reshapes the panel's 3D body, typically used for holes where the beam passes completely through.\n- **Q: Why did my panel not get cut?**\n  - A: Ensure the beam or tooling solid actually physically intersects the 3D volume of the panel. If they are just touching or have a gap without intersection, the script will not generate a cut.\n- **Q: Can I use this for circular beams?**\n  - A: Yes, the script calculates based on the intersection body, so it handles generic solid shapes, not just rectangular beams."
      },
      "tokens_used": 5955,
      "error": null
    }
  }
}