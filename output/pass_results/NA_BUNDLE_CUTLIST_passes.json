{
  "filename": "NA_BUNDLE_CUTLIST.mcr",
  "status": "completed",
  "total_tokens": 31470,
  "processing_time": 220.44676280021667,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3736,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "Both",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses generic `Display` commands (`dp.draw`) to generate a schedule at user-selected coordinates (`_Pt0`) relative to `_XW`/`_YW`. It does not utilize ShopDrawing specific APIs (`sd_` prefixes, `Sheet`), `_Viewport` logic, or `#Type E` entry points."
        },
        "prerequisites": {
          "requiredEntities": [
            "TslInst (Specifically a 'bundle' TSL containing a subMap named 'Hsb_StackingParent')",
            "Element (Stored within the target subMap)",
            "Beam (Contained within the elements)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Insertion point selected by user via `getPoint`. Can function in Model Space or Paper Space.",
          "requiredSettings": [
            "DimStyle (Must exist in current drawing)",
            "Painter Definition (Must exist in hsbCAD catalog)"
          ]
        }
      },
      "tokens_used": 4604,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getTslInst",
              "promptOriginal": "\\n Select a bundle TSL",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "\\n Select a point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "psDimStyle",
            "type": "PropString",
            "displayName": "DimStyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles (System Variable)"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "psPainter",
            "type": "PropString",
            "displayName": "Painter Definition",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "allPainter (Dynamic List from Catalog)"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "pdTextHeight",
            "type": "PropDouble",
            "displayName": "Text Height",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6813,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a formatted 2D cutlist schedule on screen displaying quantity, size, and length of timber components contained within a selected bundle (TSL).",
          "category": "ShopDrawing",
          "typicalUseCase": "Used during detailing or preparation to produce a visual summary of materials (studs, plates, headers, etc.) required for a specific wall panel or floor bundle."
        },
        "parameters": [
          {
            "name": "psDimStyle",
            "technicalDefault": "(First available DimStyle)",
            "businessMeaning": "Determines the specific format and units (e.g., Imperial fractional, Metric decimal) used to display dimensions and text in the generated cutlist.",
            "validRange": "Any existing DimStyle in the current drawing",
            "unit": "N/A (String/Reference)",
            "affectsOutput": "Changes the formatting of length and size values in the table and the overall font style."
          },
          {
            "name": "psPainter",
            "technicalDefault": "(First available Painter)",
            "businessMeaning": "Acts as a filter to select which specific timber parts within the bundle are included in the cutlist.",
            "validRange": "Any Painter Definition from the hsbCAD catalog",
            "unit": "N/A (String/Reference)",
            "affectsOutput": "Filters the list of beams included in the schedule; if a beam does not match the painter criteria, it is excluded from the cutlist."
          },
          {
            "name": "pdTextHeight",
            "technicalDefault": "0",
            "businessMeaning": "Sets the explicit text size for the cutlist. A value of 0 lets the script calculate the height automatically based on the DimStyle.",
            "validRange": ">0 (e.g., 2.5mm to 10mm depending on drawing scale)",
            "unit": "Drawing Units (mm or inch)",
            "affectsOutput": "Scales the text and row height in the generated schedule table."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "psDimStyle changes",
            "effect": "The text formatting of dimensions (Length/Size) updates to match the new DimStyle. If pdTextHeight is 0, text size may also recalculate.",
            "cascade": [
              "pdTextHeight"
            ]
          },
          {
            "trigger": "psPainter changes",
            "effect": "The script re-evaluates which beams inside the bundle match the new filter.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Text/PLine Geometry",
            "description": "A tabular schedule drawn at the selected insertion point containing columns for Timber Type, Size, Quantity, and Length.",
            "appliedTo": "Model Space or Paper Space (at user selected point _Pt0)"
          }
        ]
      },
      "tokens_used": 4387,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch: User runs command, triggers `showDialog()` to set initial properties (DimStyle, TextHeight, Painter).",
          "2. Entity Selection: User selects a Bundle TSL via command line prompt (`getTslInst`).",
          "3. Placement: User selects an insertion point (`_Pt0`) via command line prompt (`getPoint`).",
          "4. Input Validation: Script checks if a valid TSL was selected and if the 'Hsb_StackingParent' submap contains elements.",
          "5. Dependency Setup: Script sets dependencies on the selected TSL and the Painter Definition.",
          "6. Beam Iteration: Script loops through all elements and their beams within the bundle.",
          "7. Filtering & Classification: Each beam is filtered by the Painter Definition and classified as 'Filler' or 'Timber' (checking Material/Grade/Type).",
          "8. Dimension Logic: Script determines if dimensions should be 'Actual Size' (based on material) or 'Nominal' (rounded up).",
          "9. Aggregation: Beams with matching Type, Size, and Length are grouped together, and quantities are summed.",
          "10. Layout Calculation: Script calculates column widths and row heights based on text content and specified Text Height/DimStyle.",
          "11. Generation: Script draws the schedule headers, rows, and border lines (PLine/Text) at the insertion point."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count (Redo Guard)",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase Instance",
                "Exit Script"
              ]
            },
            "path2": {
              "name": "First Run",
              "steps": [
                "Execute insertion logic"
              ]
            }
          },
          {
            "condition": "Input Entity Selection",
            "path1": {
              "name": "No Entity Selected / Cancel",
              "steps": [
                "Erase Instance",
                "Exit Script"
              ]
            },
            "path2": {
              "name": "Valid TSL Selected",
              "steps": [
                "Proceed to SubMap validation"
              ]
            }
          },
          {
            "condition": "Beam Material/Grade Check",
            "path1": {
              "name": "Is Filler/Special (OSB, GYP, etc.)",
              "steps": [
                "Set Type to 'Filler'",
                "Use Exact Dimensions (Actual Size)"
              ]
            },
            "path2": {
              "name": "Is Standard Timber",
              "steps": [
                "Standardize Type Name (e.g., 'Left stud' -> 'Stud')",
                "Round dimensions UP to nearest integer"
              ]
            }
          },
          {
            "condition": "Item Aggregation",
            "path1": {
              "name": "New Unique Item",
              "steps": [
                "Add entry to `arInfo` array",
                "Initialize Quantity to 1"
              ]
            },
            "path2": {
              "name": "Existing Item Match",
              "steps": [
                "Locate existing index",
                "Increment Quantity by 1"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "TSL Selection",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases itself if the user cancels the `getTslInst` prompt."
          },
          {
            "check": "TSL Validity",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases itself if the selected object is not a valid TSL Instance."
          },
          {
            "check": "SubMap Content",
            "errorMessage": "\n No elements in a bundle",
            "recovery": "User must select a bundle that contains the submap 'Hsb_StackingParent' with valid elements."
          },
          {
            "check": "Painter Definition",
            "errorMessage": "\n Painter definition is not valid!",
            "recovery": "User must select a valid Painter Definition from the OPM properties or ensure the catalog is loaded."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Appearance",
            "how": "OPM (Properties Palette)",
            "effect": "Changing `psDimStyle`, `pdTextHeight`, or `psPainter` triggers a recalculation, updating the table's content, filtering, or scale."
          },
          {
            "action": "Relocate Schedule",
            "how": "Grip Edit",
            "effect": "Moving the TSL insertion point (`_Pt0`) moves the entire drawn schedule to the new location."
          }
        ]
      },
      "tokens_used": 6927,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# NA_BUNDLE_CUTLIST.mcr\n\n## Overview\nGenerates a formatted 2D cutlist schedule on screen displaying the quantity, size, and length of timber components contained within a selected hsbCAD bundle (TSL). This allows for quick material summaries of wall panels or floor cassettes directly in the drawing.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Schedule is placed at a user-selected coordinate. |\n| Paper Space | Yes | Schedule can be placed directly onto layout sheets. |\n| Shop Drawing | No | This script generates geometry (Text/Lines) rather than Shop Drawing entities. |\n\n## Prerequisites\n- **Required Entities**: A hsbCAD Bundle TSL already inserted in the drawing (specifically one containing a subMap named `Hsb_StackingParent`).\n- **Minimum Beams**: 0 (An empty bundle will generate a header only).\n- **Required Settings**:\n    - At least one **DimStyle** loaded in the current drawing.\n    - At least one **Painter Definition** available in the hsbCAD catalog.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `NA_BUNDLE_CUTLIST.mcr` from the file dialog.\n\n### Step 2: Select Bundle\n```\nCommand Line: Select a bundle TSL\nAction: Click on the TSL instance (e.g., a wall or floor panel) that you want to generate a cutlist for.\n```\n\n### Step 3: Place Schedule\n```\nCommand Line: Select a point\nAction: Click in the Model or Paper Space to define the top-left insertion point of the cutlist table.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| DimStyle | dropdown | (First Available) | Sets the dimension format (e.g., metric vs imperial) and text style used for the schedule. |\n| Painter Definition | dropdown | (First Available) | Filters which timber parts are included in the list. Only beams matching this painter will be displayed. |\n| Text Height | number | 0 | Sets the text size for the schedule. A value of 0 lets the script calculate the height automatically based on the DimStyle. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (Standard Grips) | Select the script insertion point to use the grip to move the entire schedule to a new location. |\n\n## Settings Files\n- **None**: This script relies on standard drawing DimStyles and the hsbCAD Catalog; it does not use external XML settings files.\n\n## Tips\n- **Filtering Content**: Use the **Painter Definition** property to control what appears in the list. For example, set it to exclude sheathing or metal parts if you only want a timber cutlist.\n- **Auto-Sizing**: Leave **Text Height** set to `0` to automatically scale the text size based on your selected DimStyle. This helps maintain consistency with your drawing standards.\n- **Dimension Rounding**: Standard timber parts (e.g., Studs) will have their dimensions rounded UP to the nearest integer (e.g., 47mm becomes 50mm). Filler materials (like OSB) will show exact dimensions.\n- **Moving the List**: If the schedule is in the way, simply select the script instance and drag the grip point to move the table to a clearer area of the drawing.\n\n## FAQ\n- **Q: Why does my list show fewer parts than I expect?**\n  **A:** Check the **Painter Definition** in the properties palette. It may be filtering out specific material grades or types that are present in your bundle.\n- **Q: Why is the text too small or too large?**\n  **A:** Adjust the **Text Height** property. If it is set to 0, change the **DimStyle** to one with larger text settings, or manually enter a specific height (in drawing units).\n- **Q: Can I use this in a layout viewport?**\n  **A:** Yes, you can run this script directly in Paper Space to place the schedule onto your title block."
      },
      "tokens_used": 5003,
      "error": null
    }
  }
}