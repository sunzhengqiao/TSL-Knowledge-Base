{
  "filename": "hsb_CreateElement.mcr",
  "status": "completed",
  "total_tokens": 34868,
  "processing_time": 199.1098988056183,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.8",
            "date": "20apr20",
            "author": "nils.gregor@hsbcad.com",
            "changes": "HSB-7318 Committed last version again"
          },
          {
            "version": "1.7",
            "date": "01apr20",
            "author": "nils.gregor@hsbcad.com",
            "changes": "HSB-6318 Coordinate system is taken by Collection entity"
          },
          {
            "version": "1.6",
            "date": "26mar20",
            "author": "nils.gregor@hsbcad.com",
            "changes": "HSB-6318 all Entities can be selected for zone 0"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5856,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script operates on 3D entities (Beams, Sheets) to create an ElementRoof. It uses getPoint for 3D input and constructs geometry (Plane, PlaneProfile) based on realBody(). No ShopDrawing (sd_) prefixes, #Type E, or Viewport interactions found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Sheet",
            "CollectionEntity"
          ],
          "minimumBeams": 1,
          "requiredSpace": "A valid Floor Group must be current (gr.namePart(0) and gr.namePart(1) must not be empty).",
          "requiredSettings": []
        }
      },
      "tokens_used": 3494,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select a set of beams and sheets",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Get origin point|",
              "condition": "_bOnInsert AND !bOriginSet AND !CollectionEntity isValid",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "|Get secound point for x-directionof the element|",
              "condition": "_bOnInsert AND !bOriginSet AND !CollectionEntity isValid",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Default Properties Dialog",
            "trigger": "On Insert (_bOnInsert)",
            "title": null,
            "dataSource": "TSL Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 171,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sCompName",
            "type": "PropString",
            "displayName": "Component Name",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sNotes",
            "type": "PropString",
            "displayName": "SubType",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6453,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Wraps selected beams and sheets into a single manufacturing Element (e.g., a roof or floor panel) by calculating their combined contour and assigning them to a new group.",
          "category": "Organization / Model Prep",
          "typicalUseCase": "Used after modeling loose structural members to group them into a logical production unit (Element) for naming, nesting, and listing."
        },
        "parameters": [
          {
            "name": "sCompName",
            "technicalDefault": "\"\"",
            "businessMeaning": "The unique identifier (Name) for the manufactured element (e.g., 'EL-1', 'Roof-A'). This typically updates the third segment of the Group Name.",
            "validRange": "Alphanumeric string adhering to project naming standards",
            "unit": "String",
            "affectsOutput": "Sets the Group Name Part 2 (Element ID) in the project tree. Mandatory field; script fails if empty."
          },
          {
            "name": "sNotes",
            "technicalDefault": "\"\"",
            "businessMeaning": "The SubType or Category of the element (e.g., 'FlatRoof', 'Gable', 'Floor'). Used for filtering in production lists and CNC logic.",
            "validRange": "String (Configured SubTypes in hsbCAD)",
            "unit": "String",
            "affectsOutput": "Sets the Element SubType property, which may trigger specific calculation rules or report filters."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "Current DimStyle",
            "businessMeaning": "Determines the text size and style used for the 3D label displayed in the model indicating the element name.",
            "validRange": "Any existing Dimension Style in the drawing",
            "unit": "N/A",
            "affectsOutput": "Visual appearance of the text label in the CAD viewport. Does not affect geometry."
          },
          {
            "name": "nColor",
            "technicalDefault": "171",
            "businessMeaning": "The color index used to display the element marker/label in the 3D model.",
            "validRange": "0-255 (AutoCAD Color Index) or -1 for ByLayer",
            "unit": "Index",
            "affectsOutput": "Visual color of the text and marker line. Does not affect physical manufacturing."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Script Start",
            "effect": "Validates Group context",
            "cascade": [
              "sCompName"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "ElementRoof",
            "description": "A logical container representing a manufactured panel. It is defined by the unioned outer contour of all selected entities.",
            "appliedTo": "The current Floor Group (creates a new sub-group/element)"
          },
          {
            "type": "Group Update",
            "description": "Updates the Group Name to include the specified Component Name (Name Part 2).",
            "appliedTo": "The created ElementRoof's Group"
          }
        ]
      },
      "tokens_used": 6242,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script",
          "Verify Current Group (Check if Floor Group exists)",
          "Show Properties Dialog (DimStyle, Color, Component Name, SubType)",
          "Validate Component Name",
          "Prompt User to Select Entities (Beams/Sheets)",
          "Analyze Selection to Determine Coordinate System",
          "Calculate Unioned Contour (Shadow Profile) of Selection",
          "Validate Contour Area and Plane Orientation",
          "Create ElementRoof Entity in Database",
          "Assign Selected Entities to New Element",
          "Draw 3D Label (Component Name & SubType)",
          "Erase Script Instance"
        ],
        "conditionalBranches": [
          {
            "condition": "Check Floor Group Status",
            "path1": {
              "name": "Invalid Group",
              "steps": [
                "Report Error: 'Make a floor group current'",
                "Erase Instance",
                "Exit"
              ]
            },
            "path2": {
              "name": "Valid Group",
              "steps": [
                "Continue to Show Dialog"
              ]
            }
          },
          {
            "condition": "Component Name Input",
            "path1": {
              "name": "Empty Name",
              "steps": [
                "Report Error: 'You must give a component name'",
                "Erase Instance",
                "Exit"
              ]
            },
            "path2": {
              "name": "Name Provided",
              "steps": [
                "Prompt for Entity Selection"
              ]
            }
          },
          {
            "condition": "Coordinate System Detection",
            "path1": {
              "name": "Beam in Selection",
              "steps": [
                "Extract CS from first Beam found",
                "Set Origin to Beam Center Top",
                "Set Z to Beam Direction"
              ]
            },
            "path2": {
              "name": "No Beam / Collection Only",
              "steps": [
                "Check if CollectionEntity exists",
                "If Yes: Extract CS from Collection",
                "If No: Prompt user for Origin and X-Direction Points",
                "Set Plane based on result"
              ]
            }
          },
          {
            "condition": "Contour Validation",
            "path1": {
              "name": "Failed Geometry",
              "steps": [
                "Check Area < 10mm OR Plane Not Parallel",
                "Erase Instance",
                "Exit"
              ]
            },
            "path2": {
              "name": "Valid Geometry",
              "steps": [
                "Determine Element Direction (X vs Y extent)",
                "Create ElementRoof",
                "Assign Entities"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Current Group Name Parts",
            "errorMessage": "Make a floor group current before inserting this TSL.",
            "recovery": "User must set a valid Floor Group current in the CAD tree."
          },
          {
            "check": "sCompName Property",
            "errorMessage": "You must give a component name",
            "recovery": "User must fill in the 'Component Name' property in the dialog."
          },
          {
            "check": "Calculated Contour Area",
            "errorMessage": "None (Silent failure/erase)",
            "recovery": "User must ensure selected entities form a valid projection area > 10mm²."
          },
          {
            "check": "nColor Property",
            "errorMessage": "None (Auto-corrected)",
            "recovery": "Script automatically resets invalid color indices (< -1 or > 255) to default 171."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Element Geometry/Name",
            "how": "Edit OPM Properties (sCompName, sNotes, sDimStyle, nColor)",
            "effect": "Updates Group Name Part 2, SubType, and Label appearance immediately upon next recalculation."
          }
        ]
      },
      "tokens_used": 6216,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_CreateElement.mcr\n\n## Overview\nWraps selected beams and sheets into a single manufacturing Element (e.g., a roof or floor panel). It calculates the combined outer contour of the selection, assigns a Component Name, and updates the project tree structure.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D entities (GenBeams, Sheets). |\n| Paper Space | No | Not applicable for paper space. |\n| Shop Drawing | No | This is a model preparation/organization tool. |\n\n## Prerequisites\n- **Floor Group**: A valid Floor Group must be set as current in the hsbCAD explorer before running the script.\n- **Entities**: At least one beam, sheet, or collection entity must be available to be selected.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or via Toolbar) → Select `hsb_CreateElement.mcr`.\n\n### Step 2: Verify Group Context\n**Action**: Ensure the correct Floor Group is active in your hsbCAD tree.\n*   If no Floor Group is current, the script will report: \"Make a floor group current\" and exit.\n\n### Step 3: Configure Properties\n**Action**: The Properties palette will appear. You must define the element details before proceeding.\n- **Component Name**: Enter a unique ID (e.g., `EL-01`). *This field is mandatory.*\n- **SubType**: Enter the category (e.g., `FlatRoof`).\n- **DimStyle/Color**: Adjust visual settings for the 3D label if desired.\n\n### Step 4: Select Entities\n```\nCommand Line: Select a set of beams and sheets\nAction: Click the structural members (beams, sheets) that belong to this panel. Press Enter to confirm selection.\n```\n\n### Step 5: Define Orientation (Conditional)\nIf the selected entities do not contain a clear coordinate system (e.g., only Sheets were selected, or a generic Collection), you will be prompted to define the plane manually:\n```\nCommand Line: |Get origin point|\nAction: Click a point to set the start (0,0,0) of the element.\n```\n```\nCommand Line: |Get secound point for x-directionof the element|\nAction: Click a second point to define the X-axis direction and slope of the element.\n```\n\n### Step 6: Completion\nThe script automatically calculates the shadow contour, creates the `ElementRoof` entity, assigns the selected members to the new element group, and draws a 3D label. The script instance then erases itself.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Component Name** | text | (empty) | The unique name for the element (e.g., ' Roof-A'). Updates Group Name Part 2. This is mandatory. |\n| **SubType** (sNotes) | text | (empty) | The specific type or category of the element (e.g., 'Gable', 'Floor'). Used for filtering in lists. |\n| **DimStyle** | dropdown | Current | Determines the text size and appearance of the 3D label in the model. |\n| **Color** (nColor) | number | 171 | The color index (0-255) used for the element label/marker. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script uses standard OPM (Object Properties Model) editing. Select the created Element and use the Properties palette to modify names or styles. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies entirely on standard drawing entities and user input; no external settings files are required.\n\n## Tips\n- **Naming**: Always fill in the **Component Name**. If left empty, the script will display an error and delete itself.\n- **Selection Speed**: You can window select multiple beams and sheets at once.\n- **Automatic Orientation**: If you select at least one **GenBeam**, the script will automatically use that beam's coordinate system. You only need to click points if you are selecting Sheets or Collections without a dominant beam direction.\n- **Label Visibility**: If the 3D label is too small or large, change the **DimStyle** property in the palette and re-trigger the calculation (if applicable) or modify the text style settings in AutoCAD.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the objects?**\n  A: This is normal behavior. This is an \"Insert-and-Forget\" script. Its job is to create the Element and update the database, after which it removes itself from the drawing. The result is the new Element Group in your tree.\n- **Q: I got an error \"Make a floor group current\". What do I do?**\n  A: Go to your hsbCAD Project Manager/Tree, right-click on the relevant **Floor** (or Story) level, and select \"Set Current\" or \"Make Active\". Then run the script again.\n- **Q: How do I change the name of the element later?**\n  A: Select the ElementRoof object in the model (or the group in the tree), open the Properties palette (Ctrl+1), and change the **Component Name** value.\n- **Q: The script failed to create an element.**\n  A: Ensure your selected entities actually form a valid 3D contour with an area larger than 10mm². If the selected items are disjointed or overlapping incorrectly, the contour calculation might fail."
      },
      "tokens_used": 6607,
      "error": null
    }
  }
}