{
  "filename": "HSB_G-NumberGenBeams.mcr",
  "status": "completed",
  "total_tokens": 22339,
  "processing_time": 475.7668294906616,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "14.08.2020",
            "author": "RP",
            "changes": "Pilot version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4791,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of `_kModelSpace` in `Group().collectEntities(true, GenBeam(), _kModelSpace)`. No usage of `_Viewport`, `_kPaperSpace`, or `sd_` prefixes. The script processes `GenBeam` objects directly and erases itself upon completion, typical of a model-space utility script."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space (_kModelSpace)",
          "requiredSettings": []
        }
      },
      "tokens_used": 2162,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "T(\"|Select one or more genbeams|\") + T(\", <|ENTER|>\") + T(\" |to select all genbeams|\")",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3562,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically assigns or resets position numbers (PosNum) for generic beams to ensure unique identification for fabrication lists.",
          "category": "Utility/DataManagement",
          "typicalUseCase": "Run after inserting new beams or modifying the structure to update production numbering before generating material lists or shop drawings."
        },
        "parameters": [
          {
            "name": "ssGenBeams",
            "technicalDefault": "All GenBeams in ModelSpace (if no specific selection is made)",
            "businessMeaning": "The specific set of timber beams that require position numbering updates.",
            "validRange": "One or more GenBeam entities",
            "unit": "Selection",
            "affectsOutput": "Defines the scope of the numbering operation. Only beams in this set will have their PosNum attributes reset and recalculated."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User presses ENTER without selecting specific beams",
            "effect": "The script automatically defaults the selection scope to include all Generic Beams found in the Model Space.",
            "cascade": [
              "All GenBeams"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Property Update (PosNum)",
            "description": "Updates the internal Position Number (PosNum) attribute used for sorting and listing elements in production data and drawings.",
            "appliedTo": "Selected GenBeams or all GenBeams in ModelSpace"
          }
        ]
      },
      "tokens_used": 3440,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script instance launched in ModelSpace",
          "2. System checks if insertCycleCount() > 1 (Safety check for re-triggering)",
          "3. User prompted via command line to select GenBeams or press ENTER",
          "4. User completes selection (Picks objects or presses ENTER)",
          "5. Script evaluates the size of the selection set",
          "6. Target GenBeams are appended to the internal _Entity array",
          "7. Calculation loop initiated (max 50 iterations)",
          "8. Loop Pass 1: Iterate through _Entity and reset PosNum to 0 for all valid GenBeams",
          "9. Loop Pass 2: Iterate through _Entity and check if PosNum has been assigned (value > -1)",
          "10. If any beam is unlabeled, flag set to false; loop repeats or continues based on flag",
          "11. Script instance calls eraseInstance()",
          "12. Script terminates"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion cycle frequency",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase instance immediately",
                "Return (Exit)"
              ]
            },
            "path2": {
              "name": "Cycle == 1 (First run)",
              "steps": [
                "Execute PrEntity prompt",
                "Process selection"
              ]
            }
          },
          {
            "condition": "User selection input (Entity count)",
            "path1": {
              "name": "Length == 0 (User pressed ENTER)",
              "steps": [
                "Execute Group().collectEntities(true, GenBeam(), _kModelSpace)",
                "Select all GenBeams in drawing"
              ]
            },
            "path2": {
              "name": "Length > 0 (User picked objects)",
              "steps": [
                "Use specifically selected GenBeams"
              ]
            }
          },
          {
            "condition": "Beam Validity Check",
            "path1": {
              "name": "Beam is Valid (bIsValid)",
              "steps": [
                "Reset PosNum to 0",
                "Check current PosNum status"
              ]
            },
            "path2": {
              "name": "Beam is Invalid (!bIsValid)",
              "steps": [
                "Continue to next entity in loop"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity validity (bIsValid)",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script automatically skips invalid entities in the collection and processes the rest."
          },
          {
            "check": "PosNum Assignment Success (Is posnum > -1?)",
            "errorMessage": "None (Implicit retry)",
            "recovery": "Script enters a retry loop (up to 50 times) to allow the CAD engine time to calculate and assign the position numbers automatically."
          }
        ],
        "postInsertionActions": [
          {
            "action": "No Post-Insertion Interaction",
            "how": "N/A",
            "effect": "The script executes `eraseInstance()` immediately after processing. The script object removes itself from the drawing database; only the modified GenBeam properties (PosNum) persist. User cannot re-edit the script instance."
          }
        ]
      },
      "tokens_used": 4367,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-NumberGenBeams.mcr\n\n## Overview\nThis script automatically assigns or resets Position Numbers (PosNum) for generic beams in your model. It ensures unique identification for fabrication lists, processing either a user-selected set of beams or all beams in the drawing.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script is designed to run exclusively in Model Space. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required entities:** Generic Beams (`GenBeam`) must exist in the drawing.\n- **Minimum beam count:** 0 (You can run this on an empty selection to process all beams).\n- **Required settings files:** None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: Type `TSLINSERT` in the command line and select `HSB_G-NumberGenBeams.mcr` from the file browser, or use your assigned custom toolbar button.\n\n### Step 2: Select Beams\n```\nCommand Line: Select one or more genbeams, <ENTER> to select all genbeams\nAction: Click on the specific beams you want to number, or press ENTER without selecting anything to process every Generic Beam in the Model Space.\n```\n\n### Step 3: Processing\nThe script will automatically reset the position numbers to 0 and then trigger the calculation to assign the correct unique numbers.\n\n### Step 4: Completion\nOnce finished, the script instance will automatically erase itself from the drawing. Only the updated Position Numbers on your beams will remain.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| N/A | N/A | N/A | This script has no user-editable properties in the Properties Palette. It runs entirely via command line interaction. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| N/A | This script does not add any custom options to the right-click context menu. |\n\n## Settings Files\n- **Filename:** None\n- **Location:** N/A\n- **Purpose:** This script operates independently of external XML or settings files.\n\n## Tips\n- **Global Renumbering:** If you want to renumber the entire project, simply press `ENTER` immediately when prompted. This selects all Generic Beams in the Model Space.\n- **Validation:** The script includes an automatic check (up to 50 retries) to ensure the CAD engine successfully assigns the numbers. You do not need to run the script multiple times manually if there is a slight delay.\n- **Clean Up:** Do not be alarmed if the script object disappears after running; this is intended behavior to keep your drawing clean.\n\n## FAQ\n- **Q: What happens if I select nothing?**\n- **A:** If you press ENTER without selecting any beams, the script will automatically select and process every Generic Beam currently in the Model Space.\n\n- **Q: Why did the script disappear after I used it?**\n- **A:** The script is designed to \"erase itself\" (`eraseInstance`) immediately after updating the beam properties. It is a utility tool, not a permanent object in your design.\n\n- **Q: Can I use this in a shop drawing layout?**\n- **A:** No, this script only detects and processes entities in the 3D Model Space."
      },
      "tokens_used": 4017,
      "error": null
    }
  }
}