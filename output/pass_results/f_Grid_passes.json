{
  "filename": "f_Grid.mcr",
  "status": "completed",
  "total_tokens": 49201,
  "processing_time": 280.18474197387695,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl creates a bedding grid",
        "versionHistory": [
          {
            "version": "1.5",
            "date": "28oct2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " HSB-8967 supports left side of container design  "
          },
          {
            "version": "1.4",
            "date": "18aug2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " HSB-8560 new property height to specify bedding sizes "
          },
          {
            "version": "1.3",
            "date": "12aug2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " HSB-8456 new property distribution mode supports distribution by center of gravity, stack extents or truck extents "
          },
          {
            "version": "1.2",
            "date": "24jul2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " HSB-8384 new property width visualizes the bedding location with width, grip positioniing supported "
          },
          {
            "version": "1.1",
            "date": "25jul2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " dim offset added "
          },
          {
            "version": "1.0",
            "date": "12may2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " initial "
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8145,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses `_kModelSpace` in `dbCreate` to insert instances. No `sd_` prefix or `#Type E` declaration. Logic is based on `TslInst` entities and geometric generation, not on drawing views or sheet generation."
        },
        "prerequisites": {
          "requiredEntities": [
            "TslInst (specifically a Truck Grid with `isGrid` map flag)"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbTSL dictionary entry 'f_Stacking' containing map settings under 'Truck.BeddingGrid'"
          ]
        }
      },
      "tokens_used": 5541,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select item(s)",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sGridSize",
            "type": "PropString",
            "displayName": "Grid Size",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "2x Grid",
              "3x Grid",
              "4x Grid",
              "5x Grid",
              "6x Grid",
              "7x Grid",
              "8x Grid",
              "9x Grid",
              "10x Grid",
              "11x Grid",
              "12x Grid",
              "13x Grid"
            ],
            "category": "Alignment",
            "description": "Defines the Grid Size"
          },
          {
            "index": 1,
            "variable": "sMode",
            "type": "PropString",
            "displayName": "Mode",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Center of Gravity",
              "Stack Extents",
              "Truck Extents"
            ],
            "category": "Alignment",
            "description": "Defines the distribution mode of hte bedding grid."
          },
          {
            "index": 0,
            "variable": "dEdgeOffset",
            "type": "PropDouble",
            "displayName": "Edge Offset",
            "defaultValue": 300,
            "inputType": "number",
            "options": [],
            "category": "Alignment",
            "description": "Defines the Edge Offset"
          },
          {
            "index": 1,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "Width",
            "defaultValue": 60,
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the width of the bedding, 0 = show only axis location"
          },
          {
            "index": 2,
            "variable": "dHeight",
            "type": "PropDouble",
            "displayName": "Height",
            "defaultValue": 80,
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the height of the bedding"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9638,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a visualization of bedding supports (squared timber) for stacked timber packages on a truck/trailer to ensure stability during transport.",
          "category": "Logistics/Planning",
          "typicalUseCase": "Used during the creation of truck loading plans to determine the optimal placement of support beams (beddings) based on the stack's center of gravity or the truck's legal dimensions."
        },
        "parameters": [
          {
            "name": "sGridSize",
            "technicalDefault": "2x Grid",
            "businessMeaning": "Specifies the number of bays or spacings for the beddings along the length of the load. A '2x Grid' typically means the load is divided into 2 equal sections supported by 3 beddings (edges + middle).",
            "validRange": "2x - 13x",
            "unit": "count (integer)",
            "affectsOutput": "Determines the number of bedding points generated and the spacing distance between them."
          },
          {
            "name": "sMode",
            "technicalDefault": "Center of Gravity",
            "businessMeaning": "Defines the calculation logic for positioning the bedding grid along the truck's length to ensure load security or compliance with transport dimensions.",
            "validRange": "Center of Gravity, Stack Extents, Truck Extents",
            "unit": "enum",
            "affectsOutput": "Alters the reference bounding box used for calculations. 'Center of Gravity' aligns beddings relative to the weight center; 'Stack Extents' uses the package length; 'Truck Extents' uses the full available vehicle length."
          },
          {
            "name": "dEdgeOffset",
            "technicalDefault": "300.0",
            "businessMeaning": "The distance from the outermost edge of the load (or truck) to the center of the first and last bedding. This prevents the timber from cantilevering too far off the supports.",
            "validRange": "0 - 1000",
            "unit": "mm",
            "affectsOutput": "Moves the start and end bedding positions inward from the boundaries, reducing the effective length used for spacing calculations."
          },
          {
            "name": "dWidth",
            "technicalDefault": "60.0",
            "businessMeaning": "The physical width of the timber bedding or support block to be placed under the stack.",
            "validRange": "0 - 200",
            "unit": "mm",
            "affectsOutput": "Controls the graphical representation of the bedding. If 0, only a centerline axis is drawn. If >0, a rectangular block of this width is drawn."
          },
          {
            "name": "dHeight",
            "technicalDefault": "80.0",
            "businessMeaning": "The height (thickness) of the timber bedding block used for support.",
            "validRange": "60 - 150",
            "unit": "mm",
            "affectsOutput": "Defines the property for the bedding size, typically used for material lists or subsequent processing, though the visual representation is primarily 2D."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing sMode to 'Center of Gravity'",
            "effect": "The grid calculates its range and position based on the stack's Center of Gravity (COG) rather than geometric bounds.",
            "cascade": [
              "sGridSize",
              "dEdgeOffset"
            ]
          },
          {
            "trigger": "Increasing dEdgeOffset",
            "effect": "Reduces the effective distance available for the grid spacing calculation, potentially compressing the intermediate beddings.",
            "cascade": [
              "sGridSize"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "2D Geometry (Visualization)",
            "description": "Draws rectangles representing the bedding blocks and axis lines for their placement locations relative to the truck grid.",
            "appliedTo": "Model Space (associated with the parent Truck Grid TslInst)"
          },
          {
            "type": "Dimension Lines",
            "description": "Draws cumulative dimensions indicating the spacing between bedding supports.",
            "appliedTo": "Model Space"
          },
          {
            "type": "COG Marker",
            "description": "Draws a symbol representing the Center of Gravity of the stack if the data is available.",
            "appliedTo": "Model Space"
          }
        ]
      },
      "tokens_used": 9569,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launched via command or catalog selection",
          "2. [Insertion Cycle] Check Execution Key: if valid key exists, load catalog entry; else show property dialog",
          "3. Prompt user to select Truck Grid entities (PrEntity)",
          "4. [Validation] Filter selected entities: remove any entity that is not a TslInst or does not have map flag 'isGrid'",
          "5. Iterate through valid parent entities",
          "6. [Creation] dbCreate new instance of f_Grid attached to parent, passing current property values",
          "7. Erase temporary insertion script instance",
          "8. [Execution] Instance reads Parent Map data (PlaneProfile, COG, X-Extremes, Alignment)",
          "9. Calculate geometry extents and reference axis",
          "10. [Branch] Determine Grid Logic based on 'sMode' (Center of Gravity vs. Extents)",
          "11. Calculate initial grid points based on 'sGridSize' and 'dEdgeOffset'",
          "12. [Branch] Check Point Spacing: if distance between points < 'dWidth', shift points to prevent overlap",
          "13. [Branch] Visualization: if 'dWidth' > 0 draw Rectangles, else draw Axis Lines only",
          "14. Draw Dimensions (Cumulative style if spacing is even, otherwise individual)",
          "15. [Branch] Draw COG Marker if COG data exists in parent map"
        ],
        "conditionalBranches": [
          {
            "condition": "sMode Property Value",
            "path1": {
              "name": "Center of Gravity (0)",
              "steps": [
                "Read CogGrid[] from parent map",
                "Calculate offset based on distance between profile mid-point and COG",
                "Align grid range centered on COG, respecting edge offset"
              ]
            },
            "path2": {
              "name": "Truck Extents (2)",
              "steps": [
                "Ignore ptXExtreme[] data from parent map",
                "Use full Truck Grid PlaneProfile extents for calculation range"
              ]
            },
            "path3": {
              "name": "Stack Extents (1)",
              "steps": [
                "Use ptXExtreme[] data if available",
                "Fallback to Truck Grid Profile extents if data missing"
              ]
            }
          },
          {
            "condition": "dWidth Property Value",
            "path1": {
              "name": "dWidth > 0",
              "steps": [
                "Calculate 4 corner points for each bedding location",
                "Draw PLine (Rectangle) representing physical bedding block"
              ]
            },
            "path2": {
              "name": "dWidth <= 0",
              "steps": [
                "Draw LineSeg representing the center axis of the bedding location only"
              ]
            }
          },
          {
            "condition": "Grid Point Spacing (Calculated vs Physical Width)",
            "path1": {
              "name": "Spacing >= dWidth",
              "steps": [
                "Keep calculated equidistant positions"
              ]
            },
            "path2": {
              "name": "Spacing < dWidth (Overlap)",
              "steps": [
                "Detect overlap between adjacent points",
                "Shift subsequent points along X-axis by (dWidth - currentSpacing) to prevent collision",
                "Flag bHasEvenDistance as false (affects dimensioning style)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Parent Entity Type and Map",
            "errorMessage": "Script erases self silently or reports 'invalid entity reference' in debug mode.",
            "recovery": "User must select a valid TslInst entity that contains an 'isGrid' integer map flag (Truck Grid)."
          },
          {
            "check": "Parent Data Availability",
            "errorMessage": "Calculations may fallback to zero or profile origin if 'Grid' profile or 'CogGrid' points are missing.",
            "recovery": "Ensure the parent Truck Grid script has generated and mapped the required geometric data."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Grid Size",
            "how": "OPM (Object Properties Manager) - 'Grid Size' dropdown",
            "effect": "Changes the number of bedding points (inter-distance recalculates to fit range)."
          },
          {
            "action": "Adjust Alignment",
            "how": "OPM - 'Mode' dropdown or 'Edge Offset' number",
            "effect": "Re-calculates the start position and range of the grid based on COG or new offsets."
          },
          {
            "action": "Change Bedding Dimensions",
            "how": "OPM - 'Width' or 'Height' inputs",
            "effect": "'Width' toggles between 2D lines and 3D blocks and adjusts collision spacing. 'Height' updates the property value for material lists."
          }
        ]
      },
      "tokens_used": 10451,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# f_Grid.mcr\n\n## Overview\nThis script generates a visual bedding grid for stacked timber packages on a truck or trailer. It is used to calculate and visualize the optimal placement of support beams (beddings) to ensure load stability during transport.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used in the 3D model to visualize load planning. |\n| Paper Space | No | Not applicable for drawing views. |\n| Shop Drawing | No | Not applicable for manufacturing drawings. |\n\n## Prerequisites\n- **Required Entities**: A valid \"Truck Grid\" TslInst entity with the `isGrid` map flag must already exist in the model.\n- **Required Settings**: The `hsbTSL` dictionary must contain configuration data (specifically `f_Stacking` settings under `Truck.BeddingGrid`).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `f_Grid.mcr` from the catalog.\n\n### Step 2: Select Parent Entity\n```\nCommand Line: Select item(s)\nAction: Click on the existing Truck Grid entity in the model to which you want to attach the bedding grid.\n```\n\n### Step 3: Configure Properties\nAfter insertion, select the newly created grid instance and open the **Properties Palette** (Ctrl+1) to adjust the bedding layout (e.g., Grid Size, Mode, Width).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Grid Size** | dropdown | 2x Grid | Defines the number of bays for the bedding along the load length. Options range from 2x to 13x. |\n| **Mode** | dropdown | Center of Gravity | Determines how the grid is aligned. Options: *Center of Gravity* (aligns to weight center), *Stack Extents* (aligns to package length), or *Truck Extents* (aligns to full vehicle length). |\n| **Edge Offset** | number | 300 | The distance (in mm) from the outer edge of the load to the center of the first bedding. |\n| **Width** | number | 60 | The physical width (in mm) of the bedding block. If set to 0, only the center axis line is drawn. |\n| **Height** | number | 80 | The height (in mm) of the bedding block, used for size reference and material lists. |\n\n## Right-Click Menu Options\nThis script relies primarily on the Properties Palette for configuration. Standard TSL context menu options for recalculating or deleting the instance apply.\n\n## Settings Files\n- **Location**: hsbTSL Dictionary (`f_Stacking` map)\n- **Key**: `Truck.BeddingGrid`\n- **Purpose**: Stores default settings and mapping data required for the script to interpret truck and stack dimensions correctly.\n\n## Tips\n- **Visualizing Layout**: Set the **Width** property to `0` if you only want to see the centerline positions of the supports without the physical blocks obscuring the view.\n- **Stability Check**: Use the **Mode: Center of Gravity** setting to ensure your beddings align correctly with the heaviest part of the load.\n- **Collision Handling**: If the calculated spacing between beddings is smaller than the **Width**, the script will automatically shift the positions to prevent overlap and switch the dimensioning style to show individual distances.\n\n## FAQ\n- **Q: Why did the grid not appear after I ran the script?**\n  A: Ensure you selected a valid Truck Grid entity during the insertion prompt. The script requires a parent entity with specific map data to function.\n- **Q: What does \"2x Grid\" mean?**\n  A: A \"2x Grid\" typically divides the load length into 2 equal sections, resulting in 3 bedding positions (one at each end and one in the middle).\n- **Q: How do I change the number of supports?**\n  A: Select the grid in the model, open the Properties Palette, and change the **Grid Size** dropdown to a higher value (e.g., \"4x Grid\")."
      },
      "tokens_used": 5857,
      "error": null
    }
  }
}