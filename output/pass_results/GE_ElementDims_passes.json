{
  "filename": "GE_ElementDims.mcr",
  "status": "completed",
  "total_tokens": 48697,
  "processing_time": 591.6833028793335,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 10,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "0.10",
            "date": "12October2017",
            "author": "Craig Colomb",
            "changes": "Inception. Converting existing Shopdraw dimensioning script"
          },
          {
            "version": "1.12",
            "date": "11/01/2022",
            "author": "Robert Pol",
            "changes": "Add check with vectortolerance"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7319,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Documentation explicitly states 'Use to do per-zone dimensions in Layout space' and 'Insert in Layout space on a single Hsb enabled viewport'. The script utilizes _DimStyles and unit conversions suitable for 2D detailing."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space (Layout) with an active hsbCAD viewport",
          "requiredSettings": []
        }
      },
      "tokens_used": 6530,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"piZone\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"Zone to Dimension\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"psDimstyle\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Dimstyle\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"_DimStyles\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"psDimFormat\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Dimension Format\",\n      \"defaultValue\": \"Decimal mm\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Decimal mm\",\n        \"Fractional Ft-In\",\n        \"Inches Fractional\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"pdTextHeight\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Text Height Override\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"pdTextPadding\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Text Height Padding\",\n      \"defaultValue\": 1,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"piLineColor\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"Line Color\",\n      \"defaultValue\": 7,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"piTextColor\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"Text Color\",\n      \"defaultValue\": 4,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"piPrecision\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"Dimension Value Precision\",\n      \"defaultValue\": 1,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"pdDimensionResolution\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Dimension Point Resolution\",\n      \"defaultValue\": 1,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"psLimitExtensionLines\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Limit Extention Lines\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Yes\",\n        \"No\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"pdExtensionLineOffset\",\n      \"type\": \"PropDouble\",\n     "
      },
      "tokens_used": 9454,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automatically generates per-zone elevation dimensions for timber elements in Paper Space (Layout) viewports.\",\n    \"category\": \"ShopDrawing\",\n    \"typicalUseCase\": \"Creating automated dimension sets for wall panels or floor plans in 2D layout drawings to annotate timber lengths and positions.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"piZone\",\n      \"technicalDefault\": 0,\n      \"businessMeaning\": \"Identifies the specific construction zone (e.g., specific wall or floor assembly) within the viewport to dimension.\",\n      \"validRange\": \"Integer (0 to 5, or negative zones -1 to -5)\",\n      \"unit\": \"count\",\n      \"affectsOutput\": \"Filters which elements are dimensioned based on their zone property assignment.\"\n    },\n    {\n      \"name\": \"psDimstyle\",\n      \"technicalDefault\": \"_DimStyles\",\n      \"businessMeaning\": \"Selects the AutoCAD dimension style (text font, arrow style, units) to use for the generated dimensions.\",\n      \"validRange\": \"Existing AutoCAD Dimstyles in the drawing\",\n      \"unit\": \"string\",\n      \"affectsOutput\": \"Visual appearance of the dimension text and lines (compliance with drafting standards).\"\n    },\n    {\n      \"name\": \"psDimFormat\",\n      \"technicalDefault\": \"Decimal mm\",\n      \"businessMeaning\": \"Unit system and format for displaying length measurements.\",\n      \"validRange\": \"Decimal mm, Fractional Ft-In, Inches Fractional\",\n      \"unit\": \"enum\",\n      \"affectsOutput\": \"The numerical value and unit suffix displayed in the dimension text.\"\n    },\n    {\n      \"name\": \"pdTextHeight\",\n      \"technicalDefault\": 0,\n      \"businessMeaning\": \"Manually sets the height of the dimension text characters.\",\n      \"validRange\": \"0 (use dimstyle"
      },
      "tokens_used": 9975,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initiation: Verify execution in Paper Space (Layout) within an active hsbCAD viewport.",
          "2. Property Initialization: Load default values for Zone, Dimstyles, Text settings, and offsets. Apply global overrides to individual directional properties if set.",
          "3. Data Collection: Identify visible timber elements within the specified viewport and Zone (or all Zones if 'Consider all Zones for Extents' is enabled).",
          "4. Viewpoint Processing: Filter elements based on the current view direction (Up, Down, Left, or Right).",
          "5. Point Calculation: Generate dimension points (top, bottom, or center) based on 'On Center' and 'Extent' settings.",
          "6. Sorting & Filtering: Sort dimension points along the dimension axis.",
          "7. Overlap Resolution: Iteratively check for text overlap between dimension points, grouping them into clusters if necessary (up to a safety limit of 1000 iterations).",
          "8. Geometry Generation: Draw extension lines (respecting 'Limit Extension Lines' toggle), dimension lines, and leader lines.",
          "9. Text Placement: Insert dimension text, formatted according to the selected unit system (mm/Ft-In/Inches) and precision.",
          "10. Completion: Finalize the entity in the drawing."
        ],
        "conditionalBranches": [
          {
            "condition": "Global Dimension Type/Extent properties changed",
            "path1": {
              "name": "Sync Global Settings",
              "steps": [
                "Update 'Up', 'Down', 'Left', and 'Right' individual properties to match the Global setting automatically."
              ]
            }
          },
          {
            "condition": "Dimension Format Selection",
            "path1": {
              "name": "Decimal mm",
              "steps": [
                "Calculate conversion factor (25.4 if imperial drawing).",
                "Format text as standard decimal string."
              ]
            },
            "path2": {
              "name": "Fractional Ft-In",
              "steps": [
                "Calculate conversion factor (0.03937 if metric).",
                "Format text using String().formatUnit with type 4."
              ]
            },
            "path3": {
              "name": "Inches Fractional",
              "steps": [
                "Calculate conversion factor (0.03937 if metric).",
                "Format text using String().formatUnit with type 5.",
                "Append a quotation mark (\\\") to the string."
              ]
            }
          },
          {
            "condition": "Limit Extension Lines Property",
            "path1": {
              "name": "Yes (Limit)",
              "steps": [
                "Draw extension line to a fixed offset defined by 'Extension Line Offset' from the dimension point."
              ]
            },
            "path2": {
              "name": "No (Standard)",
              "steps": [
                "If 'Ordinate' type is active: Project a line from the dim point and filter for intersections with other geometry using 'dFilterTolerance'.",
                "Draw extension line to the nearest intersecting geometry plus the offset."
              ]
            }
          },
          {
            "condition": "Dimension Extent / Zone Logic",
            "path1": {
              "name": "Specific Zone / Near Points",
              "steps": [
                "Filter elements strictly by 'piZone' property.",
                "Use only the extreme edges or nearest points defined by the extent settings."
              ]
            },
            "path2": {
              "name": "All Zones / All Points",
              "steps": [
                "If 'Consider all Zones for Extents' is Yes: Scan all elements to define the total bounding box.",
                "Process every valid dimension point found on the visible element faces."
              ]
            }
          },
          {
            "condition": "Text Overlap Detection (Clustering)",
            "path1": {
              "name": "Overlap Detected",
              "steps": [
                "Combine overlapping dimension points into a single 'mpDimCluster'.",
                "Re-calculate text positions to distribute text within the cluster area.",
                "Loop back to check for new overlaps caused by re-positioning.",
                "Break and report error if iterations exceed 1000."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Execution Environment",
            "errorMessage": "Implicit failure (no output).",
            "recovery": "Ensure script is inserted in an active hsbCAD Layout viewport."
          },
          {
            "check": "Precision Input",
            "errorMessage": "None (handled silently).",
            "recovery": "Script automatically clamps 'Dimension Value Precision' between 0 and 5."
          },
          {
            "check": "Clustering Logic",
            "errorMessage": "Message 'iSafe exceeded 1,000' reported to console.",
            "recovery": "Increase 'Dimension Point Resolution' or reduce the number of elements to simplify the dimensioning geometry."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensioned Zone",
            "how": "OPM -> 'Zone to Dimension'",
            "effect": "Script recalculates and redraws dimensions for the new zone ID."
          },
          {
            "action": "Adjust Dimension Offsets",
            "how": "OPM -> 'Dimension Offset Up/Down/Left/Right' or 'Dim Text Offset...'",
            "effect": "Moves the dimension lines and text closer/further from the geometry."
          },
          {
            "action": "Change Dimension Style/Type",
            "how": "OPM -> 'Dimstyle', 'Dimension Type [Direction]', 'Dimension Format'",
            "effect": "Updates visual appearance and measurement units (e.g., switching from Decimal mm to Fractional Inches)."
          },
          {
            "action": "Toggling Extension Lines",
            "how": "OPM -> 'Limit Extention Lines'",
            "effect": "Switches between short fixed extension lines and dynamic lines that snap to nearby geometry."
          }
        ]
      },
      "tokens_used": 8966,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_ElementDims.mcr\n\n## Overview\nAutomatically generates elevation dimensions for timber elements within a specific zone in Paper Space. It allows users to create organized, per-zone dimension sets for wall panels or floor layouts in 2D drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed exclusively for detailing in Layouts. |\n| Paper Space | Yes | Must be inserted in an active hsbCAD Layout viewport. |\n| Shop Drawing | N/A | Used for manual detailing in Layouts, not automatic shop drawing generation. |\n\n## Prerequisites\n- **Required Entities**: An active hsbCAD enabled viewport in a Layout tab.\n- **Minimum Beam Count**: 0 (Dimensions existing visible elements).\n- **Required Settings**: Elements must have valid Zone assignments if `Zone to Dimension` is set to a non-zero value.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_ElementDims.mcr`\n*Note: Ensure you are in a Layout tab and double-click inside the viewport to make it active before running the script.*\n\n### Step 2: Configure Properties\nSince there are no command line prompts, the script inserts immediately. Open the **Properties Palette (Ctrl+1)** to configure the dimension settings.\n\n1.  Select the script entity in the drawing.\n2.  In the Properties Palette, set the **Zone to Dimension**.\n3.  Adjust the **Dimstyle** and **Dimension Format** as required.\n4.  The script will automatically update and draw dimensions based on these settings.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Zone to Dimension | Integer | 0 | Filters which elements are dimensioned. Set `0` for all zones (if allowed) or specific integers (e.g., 1, 2, -1) to target specific wall/floor assemblies. |\n| Dimstyle | Dropdown | _DimStyles | Selects the AutoCAD dimension style to control text font, arrows, and general appearance. |\n| Dimension Format | Dropdown | Decimal mm | Selects the unit display format. Options: **Decimal mm**, **Fractional Ft-In**, **Inches Fractional**. |\n| Text Height Override | Number | 0 | Manually sets the dimension text height. Enter `0` to use the height defined in the selected Dimstyle. |\n| Text Height Padding | Number | 1 | Adjusts the spacing/margin around the dimension text. |\n| Line Color | Integer | 7 | Sets the AutoCAD color index (ACI) for dimension lines and extension lines. |\n| Text Color | Integer | 4 | Sets the color for the dimension text. |\n| Dimension Value Precision | Integer | 1 | Sets the number of decimal places (for mm) or precision level for fractional units. |\n| Dimension Point Resolution | Number | 1 | Controls the snapping/tolerance for dimension points. Increase this value if dimensions are overlapping or cluttering. |\n| Limit Extension Lines | Dropdown | No | **Yes**: Shortens extension lines to a fixed offset. **No**: Extension lines extend dynamically until they hit other geometry (Ordinate style). |\n| Extension Line Offset | Number | [Value] | The gap between the geometry and the start of the extension line. |\n\n*Note: Additional directional properties (Up, Down, Left, Right) for offsets and specific dimension types may appear depending on script configuration.*\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Refreshes the dimensions based on changes to the model or properties. |\n\n## Settings Files\nNone specific to this script. It relies on standard AutoCAD Dimstyles available in the current drawing.\n\n## Tips\n- **Cluttered Dimensions?**: If multiple dimension texts overlap, increase the **Dimension Point Resolution** value. This forces the script to cluster points further apart.\n- **Viewport Context**: This script calculates dimensions based on the *current view* of the active viewport. If you change the view direction (e.g., from Front to Side), the dimensions will update accordingly.\n- **Dynamic Extensions**: Use **Limit Extension Lines** set to \"No\" for cleaner drawings where dimension lines should stop exactly at intersecting timber elements, rather than floating in space.\n\n## FAQ\n- **Q: I inserted the script, but nothing happened.**\n  - A: Ensure you are inside an active hsbCAD viewport in a Layout tab. The script does not work in Model Space.\n- **Q: How do I switch between Metric (mm) and Imperial (Ft-In)?**\n  - A: Change the **Dimension Format** property in the Properties Palette to \"Fractional Ft-In\" or \"Inches Fractional\".\n- **Q: The dimensions are showing the wrong length.**\n  - A: Check the **Dimension Value Precision** and ensure the **Dimstyle** selected matches your drawing units (e.g., metric dimstyle for metric drawings).\n- **Q: My console reports \"iSafe exceeded 1,000\".**\n  - A: This means the overlap resolution loop got stuck trying to fit too many dimensions in one spot. Increase the **Dimension Point Resolution** to simplify the geometry or reduce the number of elements being dimensioned."
      },
      "tokens_used": 6453,
      "error": null
    }
  }
}