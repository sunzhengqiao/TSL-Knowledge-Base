{
  "filename": "hsbInkjet.mcr",
  "status": "completed",
  "total_tokens": 45524,
  "processing_time": 261.63996720314026,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.3",
            "date": "30apr18",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " element insertion and format variables supported "
          },
          {
            "version": "1.2",
            "date": "10apr18",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " maximum allowed text length validated "
          },
          {
            "version": "1.1",
            "date": "04aug15",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " Dialog added "
          },
          {
            "version": "1.0",
            "date": "04aug15",
            "author": "thorsten.huck@hsbcad.com",
            "changes": " initial "
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7798,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly creates instances using the constant _kModelSpace during the _bOnInsert phase. It interacts directly with Beam objects (_Beam[0]) and uses the bm.addTool() method to apply markings, which is specific to 3D model entities. The visualization uses Display dp(3), which is reserved for model space entities. There are no references to Viewports, sd_ functions, or paper space constants."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam",
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 6786,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 9691,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the application of inkjet text markings onto timber beams for production identification, positioning, or quality control.",
          "category": "Hardware",
          "typicalUseCase": "Used during detailing to apply readable labels (e.g., Position Numbers, dimensions) onto specific faces of beams for use by factory staff or assembly crews."
        },
        "parameters": [
          {
            "name": "sAttribute",
            "technicalDefault": "\"@(Posnum)\"",
            "businessMeaning": "The text content to be printed. Supports dynamic attributes (like PosNum, Length, Name) and static text. Can be customized via context menu.",
            "validRange": "0 to 32 characters (trimmed automatically if longer)",
            "unit": "String",
            "affectsOutput": "Changes the actual text string rendered on the beam surface."
          },
          {
            "name": "sHAlignment",
            "technicalDefault": "\"Center\"",
            "businessMeaning": "Defines the horizontal justification of the text block relative to the insertion point.",
            "validRange": "Left, Center, Right",
            "unit": "Enum",
            "affectsOutput": "Aligns the text to the left, right, or center of the marking position."
          },
          {
            "name": "sVAlignment",
            "technicalDefault": "\"Center\"",
            "businessMeaning": "Defines the vertical justification of the text block relative to the insertion point.",
            "validRange": "Bottom, Center, Top",
            "unit": "Enum",
            "affectsOutput": "Aligns the text to the bottom, top, or center of the marking position."
          },
          {
            "name": "sOrientation",
            "technicalDefault": "\"X-Axis\"",
            "businessMeaning": "Defines the reading direction of the text relative to the beam's axis.",
            "validRange": "X-Axis, Y-Axis, Perpendicular (and their negatives)",
            "unit": "Enum",
            "affectsOutput": "Rotates the text orientation to run along the beam, across the beam, or perpendicular to the face."
          },
          {
            "name": "dHeight",
            "technicalDefault": "U(60)",
            "businessMeaning": "The physical height of the characters.",
            "validRange": "20mm to 150mm",
            "unit": "mm",
            "affectsOutput": "Scales the font size of the inkjet mark."
          },
          {
            "name": "sFace",
            "technicalDefault": "\"Top\"",
            "businessMeaning": "The specific side of the beam cross-section where the marking is applied.",
            "validRange": "Top, Left, Bottom, Right",
            "unit": "Enum",
            "affectsOutput": "Moves the marking to the selected face of the timber."
          },
          {
            "name": "dLocationOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "The distance from the center of the beam along its length (X-axis).",
            "validRange": "-Length/2 to Length/2",
            "unit": "mm",
            "affectsOutput": "Moves the text mark longitudinally along the beam."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User moves the grip point (_Pt0)",
            "effect": "The script recalculates the 'Location Offset' based on the new grip position relative to the beam center.",
            "cascade": [
              "dLocationOffset"
            ]
          },
          {
            "trigger": "Changing 'Location Offset' property",
            "effect": "The script updates the grip point (_Pt0) position along the beam's X-axis.",
            "cascade": [
              "_Pt0"
            ]
          },
          {
            "trigger": "Element association (Beam inside an Element)",
            "effect": "The orientation logic may automatically flip alignment settings (H/V) if the beam's local X-axis opposes the Element's system, ensuring text remains readable.",
            "cascade": [
              "nHAlignment",
              "nVAlignment",
              "nOrientation"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Mark (Inkjet)",
            "description": "A non-geometric text entity used for CNC inkjet printing.",
            "appliedTo": "The selected Beam(s)."
          }
        ]
      },
      "tokens_used": 7059,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched",
          "Check if Insert Mode (_bOnInsert)",
          "[Insert Mode] Check if Catalog entry exists",
          "[Insert Mode] Load properties from Catalog (if exists) OR Show Dialog (if no catalog)",
          "[Insert Mode] Validate Format string (default to @(Posnum) if empty)",
          "[Insert Mode] Prompt user to select Beam(s) or Element(s)",
          "[Insert Mode] Extract all beams from selected Elements and combine with manually selected Beams",
          "[Insert Mode] For each Beam: Create a new instance of the script attached to the beam using the defined properties (Cloning)",
          "[Insert Mode] Erase the initial 'command' instance and exit",
          "[Runtime Mode - Element] Check if attached to an Element with Property Map (Catalog/Template)",
          "[Runtime Mode - Element] If Map exists: Load properties, show Dialog, return Map to system",
          "[Runtime Mode - Element] If Element constructed: Create script instances for all beams within the Element, erase self, exit",
          "[Runtime Mode - Single Beam] Retrieve Beam object and associated Element (if any)",
          "[Runtime Mode - Single Beam] Determine Coordinate System (Beam local vs Element global)",
          "[Runtime Mode - Single Beam] Check 'Set Format Expression' trigger (Context Menu)",
          "[Runtime Mode - Trigger] List available beam variables to command line",
          "[Runtime Mode - Trigger] Prompt user for index to Add/Remove variable",
          "[Runtime Mode - Trigger] Update Format string and Recalculate",
          "[Runtime Mode - Standard] Parse Format string and Generate Text",
          "[Runtime Mode - Standard] Validate Text Length (max 32 chars, trim if longer)",
          "[Runtime Mode - Standard] Calculate Orientation (check Element flipping)",
          "[Runtime Mode - Standard] Calculate Location Point (from Offset or Grip)",
          "[Runtime Mode - Standard] Apply Inkjet Mark to Beam",
          "[Runtime Mode - Standard] Draw Visualization"
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count > 1",
            "path1": {
              "name": "Subsequent Cycle",
              "steps": [
                "Erase Instance",
                "Return (Exit)"
              ]
            },
            "path2": {
              "name": "First Cycle",
              "steps": [
                "Continue with Insertion Logic"
              ]
            }
          },
          {
            "condition": "Catalog Entry exists for _kExecuteKey",
            "path1": {
              "name": "Catalog Found",
              "steps": [
                "Load properties from catalog entry"
              ]
            },
            "path2": {
              "name": "No Catalog",
              "steps": [
                "Show Property Dialog"
              ]
            }
          },
          {
            "condition": "Entity Selection (Insert)",
            "path1": {
              "name": "Beam Selected",
              "steps": [
                "Add beam to processing list"
              ]
            },
            "path2": {
              "name": "Element Selected",
              "steps": [
                "Get all beams from Element",
                "Add to processing list (avoiding duplicates)"
              ]
            }
          },
          {
            "condition": "Element Association (Runtime)",
            "path1": {
              "name": "Element Valid",
              "steps": [
                "Adopt Element Coordinate System",
                "Check if Beam X-axis opposes Element X-axis",
                "Flip Orientation and Alignment if opposing"
              ]
            },
            "path2": {
              "name": "No Element",
              "steps": [
                "Use Beam Coordinate System"
              ]
            }
          },
          {
            "condition": "Variable Index Input (Set Format)",
            "path1": {
              "name": "Variable not in Format",
              "steps": [
                "Append variable to Format string"
              ]
            },
            "path2": {
              "name": "Variable exists in Format",
              "steps": [
                "Remove variable from Format string"
              ]
            }
          },
          {
            "condition": "Location Change Source",
            "path1": {
              "name": "Property 'Location Offset' Changed",
              "steps": [
                "Update Grip Point (_Pt0) based on new offset"
              ]
            },
            "path2": {
              "name": "Grip Point (_Pt0) Moved",
              "steps": [
                "Calculate new offset from grip position",
                "Update Property 'Location Offset'"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Format String Length/Content on Insert",
            "errorMessage": "None explicitly shown, defaults to @(Posnum)",
            "recovery": "Script auto-corrects to default if empty."
          },
          {
            "check": "Generated Text Length (> 32 chars)",
            "errorMessage": "The inkjet supports only 32 characters. The marking text has been trimmed to: [text]",
            "recovery": "Text is automatically trimmed to the first 32 characters. User must change Format string via properties to include different info."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Text Format",
            "how": "Context Menu: 'Set Format Expression' OR Properties Palette: 'Format'",
            "effect": "Adds or removes dynamic attributes (e.g., PosNum, Length) to the text printed on the beam."
          },
          {
            "action": "Adjust Alignment/Orientation/Face",
            "how": "Properties Palette: 'Horizontal', 'Vertical', 'Orientation', 'Face'",
            "effect": "Rotates and moves the text to the specified side and alignment on the beam."
          },
          {
            "action": "Move Mark along Beam",
            "how": "Grip Edit (Drag grip symbol) OR Properties Palette: 'Location Offset'",
            "effect": "Moves the inkjet mark longitudinally along the beam."
          },
          {
            "action": "Change Text Height",
            "how": "Properties Palette: 'Text Height'",
            "effect": "Scales the font size of the marking."
          }
        ]
      },
      "tokens_used": 8587,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbInkjet.mcr\n\n## Overview\nThis script automates the application of inkjet text markings onto timber beams for production identification and positioning. It allows users to place dynamic labels (such as Position Numbers or dimensions) or static text on specific faces of beams in the 3D model.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script runs exclusively in 3D Model Space. |\n| Paper Space | No | Not supported for layout or drawing views. |\n| Shop Drawing | No | Not applicable to 2D generation. |\n\n## Prerequisites\n- **Required entities**: At least one Beam or Element.\n- **Minimum beam count**: 1\n- **Required settings**: None (supports standard catalogs).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT`\n**Action:** Browse and select `hsbInkjet.mcr` from the script list.\n\n### Step 2: Configuration (if not preset)\n**Dialog:** If no catalog entry is found, the configuration dialog appears.\n**Action:** Set the desired Text Format, Height, Alignment, and Face. Click OK to proceed.\n\n### Step 3: Select Target\n**Command Line:** `Select beams/elements:`\n**Action:**\n- Click on individual **Beams** to mark them.\n- OR click on an **Element** to mark all beams contained within it.\n- Press **Enter** to confirm selection.\n\n### Step 4: Generation\n**Action:** The script attaches itself to the selected beams. The initial command instance will disappear, and the inkjet markings will be visualized on the beams.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Format | String | @(Posnum) | The text content to print. Supports dynamic attributes (e.g., `@(Length)`, `@(Name)`) and static text. Max 32 characters. |\n| Horizontal Alignment | Enum | Center | Horizontal justification of the text block: Left, Center, or Right. |\n| Vertical Alignment | Enum | Center | Vertical justification of the text block: Bottom, Center, or Top. |\n| Orientation | Enum | X-Axis | Reading direction of the text relative to the beam (e.g., X-Axis, Y-Axis, Perpendicular). |\n| Text Height | Double | 60 mm | Physical height of the characters (Range: 20mm - 150mm). |\n| Face | Enum | Top | The side of the beam where the marking is applied: Top, Left, Bottom, or Right. |\n| Location Offset | Double | 0 mm | Distance from the center of the beam along its length. Positive values move the grip/text towards the beam end. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Set Format Expression | Opens a command-line interface to list available beam variables and add/remove them from the current Format string by index number. |\n\n## Settings Files\n- **Filename**: None (Standalone script, though compatible with hsbCAD Catalogs).\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Grip Edit:** Use the grip point (square symbol) on the beam in the 3D model to drag the inkjet mark longitudinally. The *Location Offset* property updates automatically.\n- **Batch Processing:** Selecting an Element allows you to apply the inkjet marking to all beams within that element simultaneously.\n- **Text Trimming:** If the generated text exceeds 32 characters, the script will automatically trim it and display a message. You may need to abbreviate your Format string.\n- **Dynamic Variables:** Use the `Set Format Expression` context menu option to quickly add variables like `@(Length)` or `@(Height)` without typing the syntax manually.\n\n## FAQ\n- **Q: Why is my text not showing up?**\n  **A:** Check the *Face* property to ensure the mark is applied to a visible side of the beam (e.g., Top vs Bottom). Also, ensure the *Text Height* is not too small for the scale of your beam.\n\n- **Q: Can I combine static text and variables?**\n  **A:** Yes. In the *Format* property, you can type static text mixed with variables. Example: `Pos: @(Posnum) L: @(Length)`.\n\n- **Q: What happens if I move the beam?**\n  **A:** The inkjet mark is parametric and will move with the beam. If you stretch or modify the beam length, the mark will attempt to maintain its relative offset."
      },
      "tokens_used": 5603,
      "error": null
    }
  }
}