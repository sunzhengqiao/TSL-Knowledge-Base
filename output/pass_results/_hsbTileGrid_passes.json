{
  "filename": "_hsbTileGrid.mcr",
  "status": "completed",
  "total_tokens": 48289,
  "processing_time": 369.3248281478882,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null"
      },
      "tokens_used": 8937,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses `getPoint` and `Element` (roofplane) selection within a 3D context (references to `_kModelSpace` behaviors, vector math with `vecZ`/`vecY` for 3D orientation). It creates visual grids (`dpGrid`, `dpPlan`) and dimensions relative to 3D coordinates. No usage of `_Viewport`, `#Type E`, or `sd_` prefixes indicating Paper Space or Shop Drawing generation."
        },
        "prerequisites": {
          "requiredEntities": [
            "Roofplane (Element)"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "RoofTilingManager.dll (referenced via _kPathHsbInstall)",
            "Tile Map Data (mapStandardTile, mapHalfTile, mapFamilyDefinition)",
            "Unit system consistency (mm/inch handling via U())"
          ]
        }
      },
      "tokens_used": 5420,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 9736,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Calculates and visualizes the optimal layout grid for roof tiles on a selected roof plane, handling horizontal and vertical distribution to ensure accurate coverage and material take-off.\",\n    \"category\": \"Roofing/Visualization\",\n    \"typicalUseCase\": \"Architects or engineers use this to determine tile layout, check coverage at eaves and ridges, and generate reports for tile quantities (full vs. half tiles) based on a specific tile manufacturer's specifications.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"nDisplayContent\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Controls the visibility of the tile layout. Allows toggling between seeing the full visualization (grid + dimensions), only the dimensions, or only the grid lines to clean up the drawing view.\",\n      \"validRange\": \"0 (All), 1 (Dimensions only), 2 (Grid only)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Visibility of `dpGrid` (lines) and `dpPlan`/`dpDimModel` (dimensions).\"\n    },\n    {\n      \"name\": \"nMode\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"Defines the calculation axis for the tiling distribution. Switches between optimizing the layout horizontally (across the roof slope) or vertically (up/down the roof slope).\",\n      \"validRange\": \"1 (Horizontal), 2 (Vertical)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Orientation of the generated grid lines and the direction of dimension chains.\"\n    },\n    {\n      \"name\": \"sFamilyName\",\n      \"technicalDefault\": \"\\\"\\\"\",\n      \"businessMeaning\": \"The specific brand and model of the roof tile (e.g., 'Braas Classic', 'Nelskamp'). This selection loads the physical dimensions (Length/Width) and batten requirements from the database to generate the grid.\",\n      \"validRange\": \"Any tile family name present in the RoofTilingManager database.\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Grid spacing (gauge and width), tile counts in BOM, and material properties assigned to the roof plane.\"\n    },\n    {\n      \"name\": \"dOverhang\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"The distance the roof structure extends beyond the external wall. This value offsets the start of the tile grid relative to the roof plane's theoretical edge to account for fascia and drainage.\",\n      \"validRange\": \"0 mm to 1000 mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Shifts the reference point (`ptRefDim`) and the starting position of the grid lines.\"\n    },\n    {\n      \"name\": \"sDimStyle\",\n      \"technicalDefault\": \"\\\"AR\\\"\",\n      \"businessMeaning\": \"Sets the drafting standard for the dimension lines (e.g., arrow style, text font, precision), ensuring the grid documentation matches the project's CAD standards.\",\n      \"validRange\": \"Valid dimension style names defined in the drawing template.\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Visual appearance and formatting of the dimension entities.\"\n    },\n    {\n      \"name"
      },
      "tokens_used": 9316,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches the TSL script.",
          "Prompt: 'Select a roofplane' (Dachfläche wählen).",
          "User selects a valid Roofplane Element.",
          "Script initializes and links to the selected Roofplane.",
          "Script loads Tile dimensions and properties from 'RoofTilingManager.dll' based on the 'sFamilyName' setting.",
          "Script calculates the geometric layout of the tile grid (spacing, start/end points) based on 'nMode' (Horizontal/Vertical) and roof geometry (Eaves/Ridge/Verges).",
          "Script calculates tile quantities (Full/Half) for the BOM.",
          "Script generates visual entities: Grid lines and Dimension lines based on 'nDisplayContent'.",
          "Script exports data to '_Map' (mapTiles, mapHardware) for external processing/export."
        ],
        "conditionalBranches": [
          {
            "condition": "Property 'nMode' value (Distribution Axis)",
            "path1": {
              "name": "Horizontal Distribution (nMode=1)",
              "steps": [
                "Calculates tile gauge across the roof slope (between Eaves and Ridge).",
                "Generates grid lines parallel to the Eaves/Ridge edges.",
                "Draws standard dimensions perpendicular to the grid."
              ]
            },
            "path2": {
              "name": "Vertical Distribution (nMode=2)",
              "steps": [
                "Calculates tile gauge down the roof slope (between Verges).",
                "Generates grid lines perpendicular to the Eaves/Ridge edges.",
                "Draws complex dimension set: Model dimensions, Projected Plan dimensions, and Sectional dimensions."
              ]
            }
          },
          {
            "condition": "Property 'nDisplayContent' value (Visualization)",
            "path1": {
              "name": "Show All (0)",
              "steps": [
                "Draw Grid lines ('dpGrid').",
                "Draw Dimensions ('dpPlan', 'dpDimModel')."
              ]
            },
            "path2": {
              "name": "Dimensions Only (1)",
              "steps": [
                "Skip Grid lines.",
                "Draw Dimensions."
              ]
            },
            "path3": {
              "name": "Grid Only (2)",
              "steps": [
                "Draw Grid lines.",
                "Skip Dimensions."
              ]
            }
          },
          {
            "condition": "Tile Family configuration ('bHalfTile' logic)",
            "path1": {
              "name": "Half Tiles Supported",
              "steps": [
                "Distribution logic allows for half-width tiles at edges.",
                "Counts 'FullTiles' and 'HalfTiles' separately in export."
              ]
            },
            "path2": {
              "name": "Half Tiles Not Supported",
              "steps": [
                "Distribution logic uses only full tile widths.",
                "Counts all tiles as 'FullTiles'."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Roofplane Geometry Validity",
            "errorMessage": "Calculation errors if the selected element has no area or undefined vector data.",
            "recovery": "Ensure the selected element is a valid, planar Roofplane with defined Eaves and Ridge edges."
          },
          {
            "check": "Tile Family Existence",
            "errorMessage": "Script fails to load dimensions if 'sFamilyName' does not exist in the RoofTilingManager database.",
            "recovery": "Select a valid Tile Family from the property list or ensure the database DLL is correctly installed."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Toggle Visibility Mode",
            "how": "Double-click the TSL instance",
            "effect": "Cycles 'nDisplayContent' (All -> Dim Only -> Grid Only -> All)."
          },
          {
            "action": "Edit Configuration",
            "how": "Change properties in Object Properties Palette (OPM)",
            "effect": "Updates grid calculations, tile family data, and geometry instantly upon change."
          },
          {
            "action": "Save Current Settings",
            "how": "Right-click Context Menu -> 'Save defaults'",
            "effect": "Stores the current property values (Tile Family, Overhang, Mode) as the default for future script insertions."
          },
          {
            "action": "Move Reference Point",
            "how": "Drag the instance Grip ('_PtG')",
            "effect": "Moves the dimensional reference point ('ptRefDim'), shifting the dimension lines relative to the grid."
          }
        ]
      },
      "tokens_used": 10027,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# _hsbTileGrid.mcr\n\n## Overview\nThis script calculates and visualizes the optimal layout grid for roof tiles on a selected roof plane. It handles horizontal and vertical distribution to ensure accurate coverage, batten positioning, and material take-off.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in 3D Model Space. |\n| Paper Space | No | Not supported for layout generation. |\n| Shop Drawing | No | Not intended for shop drawing views. |\n\n## Prerequisites\n- **Required Entities**: A valid Roofplane (Element) with defined Eaves and Ridge edges.\n- **Minimum Beam Count**: N/A (Single element selection).\n- **Required Settings**: \n  - `RoofTilingManager.dll` must be installed in the hsbCAD path.\n  - Tile definitions must exist in the database.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `_hsbTileGrid.mcr` from the file dialog.\n\n### Step 2: Select Roofplane\n```\nCommand Line: Select a roofplane\nAction: Click on the desired Roofplane element in the 3D model.\n```\n\n### Step 3: Configure Tile Layout\nOnce the script attaches to the roofplane, it generates a default grid. To customize:\n1. Select the inserted script instance.\n2. Open the **Properties Palette** (Ctrl+1).\n3. Change the `sFamilyName` to load specific tile dimensions.\n4. Adjust `dOverhang` or `nMode` as needed.\n\n### Step 4: Adjust Visualization\n- **Double-click** the script instance to cycle through display modes (Show All → Dimensions Only → Grid Only).\n- **Drag** the visible grip point (usually labeled `_PtG`) to move the reference point for dimensions.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sFamilyName | String | \"\" | Select the specific tile manufacturer and model (e.g., \"Braas Classic\"). This determines the grid spacing. |\n| nMode | Index | 1 | **1**: Horizontal distribution (across slope). <br> **2**: Vertical distribution (down slope). |\n| dOverhang | Length | 0 | The distance the roof structure extends beyond the external wall. Offsets the grid start. |\n| sDimStyle | String | \"AR\" | The dimension style name to be used for generated dimensions (Arrow style, text height, etc.). |\n| nDisplayContent | Index | 0 | **0**: Show All (Grid + Dimensions). <br> **1**: Show Dimensions Only. <br> **2**: Show Grid Only. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Save defaults | Saves the current property configuration (Tile Family, Overhang, etc.) as the new default for future insertions. |\n\n## Settings Files\n- **Filename**: `RoofTilingManager.dll`\n- **Location`: `_kPathHsbInstall` (hsbCAD installation directory)\n- **Purpose**: Contains the database of tile families, including physical dimensions (Length/Width) and batten requirements used to calculate the grid.\n\n## Tips\n- **Toggle Views Quickly**: If the drawing becomes too cluttered, double-click the script to hide the grid lines and show only dimensions.\n- **Check Orientation**: If your tiles are running the wrong way, change the `nMode` property between Horizontal (1) and Vertical (2).\n- **Moving Dimensions**: Use the grip point to slide the dimension lines away from the roof edge for better visibility in crowded plans.\n\n## FAQ\n- Q: Why does the grid not appear after I change the tile family?\n  A: Ensure the `nDisplayContent` is set to `0` (All) or `2` (Grid Only). Also verify that the `sFamilyName` exactly matches a name in the RoofTilingManager database.\n- Q: How do I account for fascia boards?\n  A: Use the `dOverhang` property to shift the start of the grid outward from the roof plane's theoretical edge.\n- Q: What happens if I select an invalid element?\n  A: The script will prompt you to \"Select a roofplane\" again. Ensure you select a valid planar Roof element with area."
      },
      "tokens_used": 4853,
      "error": null
    }
  }
}