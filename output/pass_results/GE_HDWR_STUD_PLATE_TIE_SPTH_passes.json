{
  "filename": "GE_HDWR_STUD_PLATE_TIE_SPTH.mcr",
  "status": "completed",
  "total_tokens": 43727,
  "processing_time": 438.77374148368835,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 1,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "v1.1",
            "date": "02.jun.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Added features to make possible reset TXT source file using GE_HDWR_RESET_CATALOG_ENTRY tsl"
          },
          {
            "version": "v1.0",
            "date": "06.mar.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6951,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getPoint() for 3D point selection and creates 3D Body geometry (bdFront, bdBack, bdBase). It filters beams by type (_kBottom, _kTopPlate) and uses GenBeam properties. No ShopDrawing (sd_), Viewport, or Paper Space specific patterns detected."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "TSL_Read_Metalpart_Family_Props.dll (located in Utilities\\TslCustomSettings)",
            "TXT file containing SPTR/SPTH families details"
          ]
        }
      },
      "tokens_used": 6183,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select stud(s) and plate(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Pick a point to define on what face of studs place hardware|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "DotNetFunction (External)",
            "trigger": "_bOnInsert OR _kExecuteKey == 'Change type'",
            "title": "Select Hardware Type",
            "dataSource": "TSL_Read_Metalpart_Family_Props.dll / fnReadFamilyPropsFromTXT",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "ShowNotice",
            "trigger": "_kExecuteKey == 'Help'",
            "title": "Help Information",
            "dataSource": "Script String",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "|Type|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dBeamWidth",
            "type": "PropDouble",
            "displayName": "|Beam Width|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dHeightFromBase",
            "type": "PropDouble",
            "displayName": "|Height from base|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Change type",
            "handler": "sChangeType",
            "action": "Opens interface to select a different hardware type from the SPTH family.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Help",
            "handler": "sHelp",
            "action": "Displays description of the SPTH Stud Tie Hardware Family functionality.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "TSL_HARDWARE_FAMILY_LIST.dxx",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Catalog\\"
            ],
            "purpose": "Catalog listing hardware families.",
            "required": true
          },
          {
            "filename": "TSL_Read_Metalpart_Family_Props.dll",
            "searchPaths": [
              "_kPathHsbInstall\\Utilities\\TslCustomSettings"
            ],
            "purpose": "External library to read hardware properties from TXT files.",
            "required": true
          },
          {
            "filename": "TXT file containing SPTR/SPTH families details",
            "searchPaths": [
              "Any folder (Path prompted if not found)"
            ],
            "purpose": "Contains specific dimension and property data for hardware types.",
            "required": true
          }
        ]
      },
      "tokens_used": 6963,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates 3D geometry for a 'Stud Plate Tie' hardware (SPTH family), which connects vertical studs to horizontal top or bottom plates in timber framing to resist uplift or shear forces.",
          "category": "Hardware",
          "typicalUseCase": "Used in timber wall panel design to mechanically anchor studs to plates (e.g., for wind load resistance), equivalent to Simpson Strong-Tie SPH-type ties."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "\"\"",
            "businessMeaning": "The specific model code of the hardware from the manufacturer catalog (e.g., 'SPH44', 'SPH66').",
            "validRange": "Any string code defined in the external TXT catalog file.",
            "unit": "String",
            "affectsOutput": "Selects the specific hardware configuration. When changed, it triggers a lookup in the external catalog file to update all associated dimensions (width, height, thickness)."
          },
          {
            "name": "dBeamWidth",
            "technicalDefault": "U(115, 4.5)",
            "businessMeaning": "The depth/thickness of the stud (or the combined width of the stud plus hardware legs) that the hardware wraps around.",
            "validRange": "Typically 45mm to 300mm (based on standard timber stud depths).",
            "unit": "mm",
            "affectsOutput": "Controls the distance (offset) between the front plate and the back plate of the hardware. It effectively scales the hardware to fit the specific stud size."
          },
          {
            "name": "dHeightFromBase",
            "technicalDefault": "U(29, 2.125)",
            "businessMeaning": "The vertical height of the hardware plate measured from the plate (base) connection point.",
            "validRange": "Typically 20mm to 100mm depending on the load capacity of the tie.",
            "unit": "mm",
            "affectsOutput": "Defines the length of the vertical legs of the hardware in the vertical direction (parallel to the stud)."
          },
          {
            "name": "dWidth",
            "technicalDefault": "U(35, 1.375)",
            "businessMeaning": "The width of the hardware strap perpendicular to the wall face (the heel width).",
            "validRange": "Typically 20mm to 100mm.",
            "unit": "mm",
            "affectsOutput": "Determines the width of the metal plate visible from the side."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sType is set via 'Change type' dialog",
            "effect": "Reads values from the external TXT catalog file and updates the Map.",
            "cascade": [
              "dBeamWidth",
              "dHeightFromBase",
              "dWidth"
            ]
          },
          {
            "trigger": "Geometry of selected Plate Beam (Top/Bottom)",
            "effect": "Calculates internal variables 'PlateWidth' and 'VeryPlateWidth' to offset the hardware start position.",
            "cascade": [
              "Insertion Point (_Pt0)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (3D Geometry)",
            "description": "Generates three separate Body objects: 'bdFront' (front plate), 'bdBack' (back plate), and 'bdBase' (bottom plate connecting them), forming a continuous strap tie.",
            "appliedTo": "Graphically represented at the intersection of the selected Stud and the selected Plate (Top or Bottom)."
          }
        ]
      },
      "tokens_used": 7218,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts execution. Checks if 'Help' key was triggered.",
          "[Conditional] If 'Help' triggered: Display notice describing SPTH Stud Tie functionality. Script pauses/returns.",
          "[Conditional] If 'Change type' triggered, Insert, or Recalc: Proceed to main logic.",
          "Check `insertCycleCount()`. If > 1, erase instance and return (prevents multiple runs).",
          "Setup parameters for external DotNet library (Family Name: SPTH).",
          "[Decision] Is `_bOnRecalc` true?",
          "  [Yes] Use existing `_Map` for properties.",
          "  [No] Call `TSL_Read_Metalpart_Family_Props.dll` to fetch hardware properties (opens selection dialog if needed).",
          "Update `_Map` with new properties. Verify map is not empty (exit if invalid on insert).",
          "[Decision] Is `_bOnInsert` true?",
          "  [Yes - Manual Insertion Workflow]",
          "  Prompt user to 'Select stud(s) and plate(s)' using `PrEntity`.",
          "  Validate selection: If no beams selected, erase instance and exit.",
          "  Prompt user to 'Pick a point to define on what face of studs place hardware'.",
          "  Sort selected beams into groups: Vertical Studs, Bottom Plates, Top Plates.",
          "  [Validation] Check for presence of Verticals AND (Bottom or Top plates). If missing, report error and erase instance.",
          "  Loop through each valid Vertical Stud.",
          "    [Conditional] If Bottom Plates exist: Create a new instance of the script linked to the Stud and Bottom Plates.",
          "    [Conditional] If Top Plates exist: Create a new instance of the script linked to the Stud and Top Plates.",
          "  Erase the original 'manager' instance and return.",
          "  [No - Instance Calculation Workflow]",
          "  Validate `_Beam` array (must not be empty).",
          "  Retrieve the Stud (Beam 0) and associated Plates.",
          "  [Conditional] Check `bOnInsert` flag in map.",
          "    [Yes - First Calc after Manager spawn]",
          "    Determine Plate Width and Very Plate Width based on beam intersections.",
          "    Calculate Local Coordinate System (vx, vy, vz) based on Stud and Plate geometry.",
          "    Relocate `_Pt0` to the top/face of the stud based on user pick.",
          "    Set dependencies on Stud and Plates.",
          "    [No - Recalculation]",
          "    Retrieve Local Coordinate System and Widths directly from `_Map`.",
          "  [Common Geometry Step]",
          "  Extract hardware dimensions (Beam Width, Height, Width) from Map.",
          "  [Validation] If dimensions are invalid/missing, set default dimensions and draw in Color 1 (Red).",
          "  Cleanup duplicates: Search for other instances of this script on the same beam at the same location and erase them.",
          "  Generate 3D Geometry (PLine and Body) for Front plate, Back plate, and Base plate.",
          "  Draw geometry to Display.",
          "Finish."
        ],
        "conditionalBranches": [
          {
            "condition": "Trigger Context (Help vs Change Type vs Standard Run)",
            "path1": {
              "name": "Help Trigger",
              "steps": [
                "Execute if `_kExecuteKey == sHelp`",
                "Show ReportNotice with description",
                "Return (Skip rest of script)"
              ]
            },
            "path2": {
              "name": "Change Type / Insert / Recalc",
              "steps": [
                "Execute if `_bOnInsert`, `_bOnRecalc`, or `_kExecuteKey == sChangeType`",
                "Proceed to hardware loading logic"
              ]
            }
          },
          {
            "condition": "Execution Mode (Initial Manager vs Single Instance)",
            "path1": {
              "name": "Initial Manager (_bOnInsert == true)",
              "steps": [
                "Prompt for Beams and Point",
                "Filter Beams into Studs and Plates",
                "Spawn child instances for every Stud/Plate combination",
                "Erase Self"
              ]
            },
            "path2": {
              "name": "Single Instance (_bOnInsert == false in Map)",
              "steps": [
                "Read specific Beam/Plate geometry",
                "Calculate local coordinates",
                "Draw Hardware"
              ]
            }
          },
          {
            "condition": "Beam Selection Configuration",
            "path1": {
              "name": "Stud + Bottom Plate Only",
              "steps": [
                "Identify Bottom Plate",
                "Spawn one instance per Stud",
                "Calculate geometry based on Bottom Plate dimensions"
              ]
            },
            "path2": {
              "name": "Stud + Top Plate Only",
              "steps": [
                "Identify Top Plate",
                "Spawn one instance per Stud",
                "Calculate geometry based on Top Plate dimensions"
              ]
            },
            "path3": {
              "name": "Stud + Both Plates",
              "steps": [
                "Identify both Plate types",
                "Spawn two instances per Stud (one tied to Bottom, one tied to Top)",
                "Calculate geometry independently for each instance"
              ]
            }
          },
          {
            "condition": "Property Map Validity",
            "path1": {
              "name": "Valid Map Data",
              "steps": [
                "Read 'Beam Width', 'Height from base', 'WIDTH'",
                "Generate geometry using catalog dimensions"
              ]
            },
            "path2": {
              "name": "Invalid/Empty Map Data",
              "steps": [
                "Set Display Color to Red (1)",
                "Apply default dimensions (115mm, 29mm, 35mm)",
                "Generate geometry using defaults"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection Count",
            "errorMessage": "|Not valid vertical studs provided| OR |Not valid top or bottom plates provided|",
            "recovery": "Select at least one vertical stud and one plate (Top or Bottom) before running script."
          },
          {
            "check": "Map Content after Load",
            "errorMessage": "Silent failure (Instance erased)",
            "recovery": "Ensure the TXT catalog file is found and valid. Ensure a type was selected in the dialog."
          },
          {
            "check": "Hardware Dimensions from Map",
            "errorMessage": "Geometry draws in Red (Color 1)",
            "recovery": "Use 'Change type' context menu to select a valid hardware type from the catalog."
          },
          {
            "check": "Beam/Plate Intersection",
            "errorMessage": "Instance erased",
            "recovery": "Ensure selected stud actually intersects physically with the plate in the 3D model."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Hardware Type",
            "how": "Right-click Context Menu -> 'Change type'",
            "effect": "Opens DotNet dialog to select new Type. Updates all dimensions (Width, Height, Thickness) from the catalog and redraws geometry."
          },
          {
            "action": "Relocate Hardware",
            "how": "Move the Element/TSL instance grips",
            "effect": "Script recalculates `vz` vector to ensure the hardware stays attached to the 'face' of the stud defined by the new location relative to the plate."
          },
          {
            "action": "Refresh from Catalog",
            "how": "Recalculate (or interact with GE_HDWR_RESET_CATALOG_ENTRY if path was lost)",
            "effect": "Re-loads properties from TXT file if the source file path or contents changed."
          }
        ]
      },
      "tokens_used": 9758,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_STUD_PLATE_TIE_SPTH.mcr\n\n## Overview\nGenerates 3D geometry for \"Stud Plate Tie\" hardware (SPTH family), which connects vertical studs to horizontal top or bottom plates in timber framing to resist uplift or shear forces.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script is designed for 3D modeling in Model Space. |\n| Paper Space | No | Not supported in layout views. |\n| Shop Drawing | No | Not intended for generating 2D shop drawings directly. |\n\n## Prerequisites\n- **Required Entities**: \n  - GenBeam entities representing vertical studs.\n  - GenBeam entities representing Top or Bottom plates.\n- **Minimum Beam Count**: 2 (1 Stud + 1 Plate).\n- **Required Settings**:\n  - `TSL_Read_Metalpart_Family_Props.dll` (located in `Utilities\\TslCustomSettings`)\n  - A TXT file containing SPTH family details (dimensions and properties).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_HDWR_STUD_PLATE_TIE_SPTH.mcr`\n\n### Step 2: Select Structural Members\n```\nCommand Line: Select stud(s) and plate(s)\nAction: Use a window or select individual beams to pick the vertical studs and the horizontal plates (Top or Bottom) you wish to connect.\n```\n\n### Step 3: Define Placement Face\n```\nCommand Line: Pick a point to define on what face of studs place hardware\nAction: Click on or near the face of a stud where you want the hardware strap to be located.\n```\n\n### Step 4: Select Hardware Type\n```\nDialog: Select Hardware Type\nAction: A dialog box will appear listing available SPTH types. Search or select the desired model code (e.g., SPH44) and confirm.\n```\n*(Note: This step may be skipped if the script detects existing catalog properties).*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | Text | \"\" | The specific model code of the hardware (e.g., 'SPH44'). Changing this reloads dimensions from the catalog. |\n| Beam Width | Number | 0 | The depth/thickness of the stud (or combined width) that the hardware wraps around. |\n| Height from base | Number | 0 | The vertical height of the hardware plate measured from the plate connection point. |\n| Width | Number | 0 | The width of the hardware strap perpendicular to the wall face (heel width). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change type | Opens the selection interface to choose a different hardware model from the SPTH catalog. |\n| Help | Displays a description of the SPTH Stud Tie Hardware Family functionality. |\n\n## Settings Files\n- **Filename**: `TSL_HARDWARE_FAMILY_LIST.dxx`\n  - **Location**: `_kPathHsbCompany\\TSL\\Catalog\\`\n  - **Purpose**: Catalog listing available hardware families.\n\n- **Filename**: `TSL_Read_Metalpart_Family_Props.dll`\n  - **Location**: `_kPathHsbInstall\\Utilities\\TslCustomSettings`\n  - **Purpose**: External library used to read hardware properties from TXT files.\n\n- **Filename**: TXT File (User defined)\n  - **Location**: Any folder (Prompted if not found)\n  - **Purpose**: Contains specific dimension and property data for the hardware types.\n\n## Tips\n- **Batch Processing**: You can select multiple studs and multiple plates in Step 2. The script will automatically calculate valid intersections and create hardware for all of them.\n- **Visual Error Handling**: If the hardware geometry appears **Red**, it means the script could not load the correct dimensions from the catalog. Use the \"Change type\" context menu to select a valid type.\n- **Moving Hardware**: You can use standard AutoCAD move grips on the element to reposition the hardware along the stud or plate. The script will attempt to maintain orientation relative to the beams.\n\n## FAQ\n- **Q: Can I use this to connect studs to both top and bottom plates simultaneously?**\n  - A: Yes. If you select studs along with both top and bottom plates in Step 2, the script will generate separate instances for every valid connection (stud-to-bottom and stud-to-top).\n\n- **Q: What happens if the path to the TXT catalog file is lost?**\n  - A: You can use the `GE_HDWR_RESET_CATALOG_ENTRY` script to reset the source file path for this hardware family.\n\n- **Q: Why did my hardware disappear?**\n  - A: This usually happens if the associated Stud or Plate beam is deleted or if the intersection between them is no longer valid. Check that your structural members are still present and intersecting correctly."
      },
      "tokens_used": 6654,
      "error": null
    }
  }
}