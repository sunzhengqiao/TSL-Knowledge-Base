{
  "filename": "FreeDrill.mcr",
  "status": "completed",
  "total_tokens": 43455,
  "processing_time": 261.3852610588074,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "02.06.2023",
            "author": "Thorsten Huck",
            "changes": "HSB-19105 initial version of free drill tool"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5963,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses GenBeam selection, 3D point input (getPoint), envelopeBody calculations, and Drill tooling objects. No ShopDrawing (sd_) functions, Viewport checks, or #Type E definitions found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 5156,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select genbeams|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"default\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"PrPoint\",\n        \"promptOriginal\": \"|Select point|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"ShowDialog\",\n      \"trigger\": \"_bOnInsert (if _kExecuteKey is empty)\",\n      \"title\": null,\n      \"dataSource\": \"OPM Properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"dDiameter\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Diameter|\",\n      \"defaultValue\": \"U(10)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the Diameter|\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dDiameter1\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Diameter| \",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Sinkhole| 1\",\n      \"description\": \"|Defines the diameter of a sinkhole at start|\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dDepth1\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Depth|\",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Sinkhole| 1\",\n      \"description\": \"|Defines the depth of a sinkhole at start|\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"dDiameter2\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Diameter|  \",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Sinkhole| 2\",\n      \"description\": \"|Defines the diameter of a sinkhole at end|\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"dDepth2\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Depth| \",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Sinkhole| 2\",\n      \"description\": \"|Defines the depth of a sinkhole at end|\"\n    }\n  ],\n  \"contextMenu\": [\n    {\n      \"menuItem\": \"|Add Genbeams|\",\n      \"handler\": \"|Add Genbeams|\",\n      \"action\": \"Prompts user to select additional GenBeams to add to the drill operation\",\n      \"alsoTriggeredBy\": null\n    },\n    {\n      \"menuItem\": \"|Remove Genbeams|\",\n      \"handler\": \"|Remove Genbe"
      },
      "tokens_used": 8543,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a straight cylindrical drill (hole) through one or multiple selected beams, with optional countersinks (sinkholes) at the start and end positions.",
          "category": "Machining / Tooling",
          "typicalUseCase": "Drilling bolt holes or dowel holes through multiple structural timber members (e.g., passing through a column and beams) where the drill axis is defined freely in 3D space by two points."
        },
        "parameters": [
          {
            "name": "dDiameter",
            "technicalDefault": "U(10)",
            "businessMeaning": "The diameter of the main drill hole.",
            "validRange": "6mm to 120mm (Standard bolt/dowel sizes)",
            "unit": "mm",
            "affectsOutput": "Defines the thickness of the cylinder cut through the selected beams."
          },
          {
            "name": "dDiameter1",
            "technicalDefault": "U(0)",
            "businessMeaning": "Diameter of the countersink (enlarged hole) at the start point of the drill.",
            "validRange": "Must be greater than 'Diameter' (e.g., 24mm for M20 bolt head)",
            "unit": "mm",
            "affectsOutput": "Creates a wider bore at the start of the hole to accommodate bolt heads or washers. Requires Depth1 > 0."
          },
          {
            "name": "dDepth1",
            "technicalDefault": "U(0)",
            "businessMeaning": "Depth of the countersink at the start point, measured along the drill axis.",
            "validRange": "0mm to beam thickness (e.g., 20mm-50mm for standard recesses)",
            "unit": "mm",
            "affectsOutput": "Determines how far back the wider diameter (Diameter1) extends from the start point."
          },
          {
            "name": "dDiameter2",
            "technicalDefault": "U(0)",
            "businessMeaning": "Diameter of the countersink (enlarged hole) at the end point of the drill.",
            "validRange": "Must be greater than 'Diameter'",
            "unit": "mm",
            "affectsOutput": "Creates a wider bore at the end of the hole. Requires Depth2 > 0."
          },
          {
            "name": "dDepth2",
            "technicalDefault": "U(0)",
            "businessMeaning": "Depth of the countersink at the end point, measured backwards along the drill axis.",
            "validRange": "0mm to beam thickness",
            "unit": "mm",
            "affectsOutput": "Determines how far the wider diameter (Diameter2) extends back from the end point."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dDiameter1 is set > 0",
            "effect": "Sinkhole at start is only generated if dDiameter1 > dDiameter AND dDepth1 > 0.",
            "cascade": [
              "dDiameter",
              "dDepth1"
            ]
          },
          {
            "trigger": "dDiameter2 is set > 0",
            "effect": "Sinkhole at end is only generated if dDiameter2 > dDiameter AND dDepth2 > 0.",
            "cascade": [
              "dDiameter",
              "dDepth2"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Drill",
            "description": "The main cylindrical borehole defined by the two selection points.",
            "appliedTo": "All GenBeams intersecting the drill path."
          },
          {
            "type": "Drill",
            "description": "Countersink at the start point (optional, wider diameter).",
            "appliedTo": "All GenBeams intersecting the start of the drill path."
          },
          {
            "type": "Drill",
            "description": "Countersink at the end point (optional, wider diameter).",
            "appliedTo": "All GenBeams intersecting the end of the drill path."
          }
        ]
      },
      "tokens_used": 7860,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. User launches script (command or catalog insertion).\",\n    \"2. System checks execution context (_bOnInsert).\",\n    \"3. Branch: If executed via Catalog/Key, load preset properties. Otherwise, open Properties Dialog (OPM).\",\n    \"4. User confirms Properties (or defaults are used).\",\n    \"5. Command Line Prompt: Select GenBeams (Single or Multiple allowed).\",\n    \"6. Command Line Prompt: Pick Start Point (getPoint).\",\n    \"7. Command Line Prompt: Pick End Point (PrPoint).\",\n    \"8. Script calculates midpoint (_Pt0) and vector (vecX).\",\n    \"9. Script validates: Are beams selected? Is Diameter > 0?\",\n    \"   -> If NO: Erase Instance and Exit.\",\n    \"10. Script performs Geometry Check: Intersects drill line with beam envelope bodies.\",\n    \"11. Branch: Check result (bIsInside).\",\n    \"   -> If Valid (!bIsInside): Create Main Drill, Check/Create Sinkholes, Visualize Blue.\",\n    \"   -> If Invalid (bIsInside): Create NO Drill, Visualize Red, enable 'Adjust Grip' menu options.\",\n    \"12. Script finishes, displaying drill representation and updating Context Menu.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Execution Trigger (Catalog vs Manual)\",\n      \"path1\": {\n        \"name\": \"Catalog/Silent Mode\",\n        \"steps\": [\n          \"Check if _kExecuteKey exists in catalog names\",\n          \"Execute setPropValuesFromCatalog(_kExecuteKey)\",\n          \"Skip dialog display\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Standard Insertion\",\n        \"steps\": [\n          \"Execute showDialog()\",\n          \"Wait for user input in Properties Palette\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Drill Geometry Validity (Inside Check)\",\n      \"path1\": {\n        \"name\": \"Valid Drill Path\",\n        \"steps\": [\n          \"Start/End points are logically outside or flush with beam intersections\",\n          \"Generate Drill object (pt1 to pt2)\",\n          \"Generate Sinkhole 1 (if parameters allow)\",\n          \"Generate Sinkhole 2 (if parameters allow)\",\n          \"Set visualization color to Blue/Default\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Invalid Drill Path\",\n        \"steps\": [\n          \"Start/End points are buried inside the solid volume (bIsInside == true)\",\n          \"Suppress Drill generation\",\n          \"Suppress Sinkhole generation\",\n          \"Set visualization color to Red\",\n          \"Add 'Adjust Grip' items to context menu\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Sinkhole Parameters\",\n      \"path1\": {\n        \"name\": \"Sinkhole Created\",\n        \"steps\": [\n          \"Check: Depth > 0 AND Diameter > Main Diameter\",\n          \"Create additional Drill object for sink\",\n          \"Add to beam intersections\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Sinkhole Ignored\",\n        \"steps\": [\n          \"Check: Depth <= 0 OR Diameter <= Main Diameter\",\n          \"Skip creation of additional Drill object\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Beam Selection Count\",\n      \"logic\": \"_GenBeam.length() < 1\",\n      \"errorMessage\": \"None (Silent)\",\n      \"recovery\": \"Script erases itself if no beams are selected upon recalculation.\"\n    },\n    {\n      \"check\": \"Diameter Size\",\n      \"logic\": \"dDiameter < dEps (approx 0.1mm)\",\n      \"errorMessage\": \"None (Silent)\",\n      \"recovery\": \"Script erases itself. User must insert again and set a positive diameter.\"\n    },\n    {\n      \"check\": \"Drill Start/End Position\",\n      \"logic\": \"Intersection logic determines bIsInside == true\",\n      \"errorMessage\": \"Drill visualizes in Red color.\",\n      \"recovery\": \"Use 'Adjust closest grip' or 'Adjust grip 1/2' context menu commands to snap points to the beam surface, or manually move grips.\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Modify Geometry\",\n      \"how"
      },
      "tokens_used": 9912,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# FreeDrill.mcr\n\n## Overview\nCreates a straight cylindrical drill (hole) through one or multiple selected beams, with optional countersinks (sinkholes) at the start and end positions. Ideal for drilling bolt holes or dowel holes through multiple structural timber members defined by a 3D axis.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script uses 3D points and GenBeam selection. |\n| Paper Space | No | Not designed for 2D layouts. |\n| Shop Drawing | No | Does not generate shop drawing views. |\n\n## Prerequisites\n- **Required entities**: GenBeams (structural timber elements).\n- **Minimum beam count**: 1.\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `FreeDrill.mcr` from the file dialog.\n\n### Step 2: Configure Properties (Optional)\nUpon insertion, the Properties palette will open. You can adjust the drill diameter and optional sinkhole dimensions here, or accept the defaults (10mm diameter).\n\n### Step 3: Select GenBeams\n```\nCommand Line: Select genbeams\nAction: Click on the beam(s) you wish to drill through and press Enter.\n```\n\n### Step 4: Pick Start Point\n```\nCommand Line: [Default Prompt]\nAction: Click in 3D space to define the start point of the drill.\n```\n\n### Step 5: Pick End Point\n```\nCommand Line: Select point\nAction: Click in 3D space to define the end point of the drill.\n```\n\n*Result*: The drill is generated. If the geometry is valid, the drill color will be **Blue**. If the start/end points are buried inside the beam volume, it will turn **Red**.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Diameter** | Number | 10 mm | The diameter of the main through-hole. |\n| **Diameter** (Sinkhole 1) | Number | 0 mm | Diameter of the countersink at the **Start** point (must be > 0 to create). |\n| **Depth** (Sinkhole 1) | Number | 0 mm | Depth of the countersink at the **Start** point along the drill axis. |\n| **Diameter** (Sinkhole 2) | Number | 0 mm | Diameter of the countersink at the **End** point (must be > 0 to create). |\n| **Depth** (Sinkhole 2) | Number | 0 mm | Depth of the countersink at the **End** point along the drill axis. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Add Genbeams** | Prompts you to select additional beams to add to the existing drill operation. |\n| **Remove Genbeams** | Prompts you to select specific beams to remove from the drill operation. |\n| **Adjust closest grip** | Automatically snaps the nearest drill point (start or end) to the surface of the beam to fix invalid (red) geometry. |\n| **Adjust grip 1 / Adjust grip 2** | Specifically adjusts the Start or End point to the beam surface. |\n\n## Settings Files\nNone required.\n\n## Tips\n- **Creating Countersinks**: To create a sinkhole (counterbore) for a bolt head, ensure the Sinkhole Diameter is larger than the main Diameter, and the Depth is greater than 0.\n- **Visual Feedback**: A **Red** drill indicates the start or end point is mathematically \"inside\" the beam volume rather than on the surface. Use the Right-Click \"Adjust grip\" options to fix this automatically.\n- **Unit Independence**: The script handles unit conversions automatically, but values in the Properties palette are displayed in your current CAD units (typically millimeters).\n\n## FAQ\n- **Q: Why did my drill disappear?**\n  - A: The script erases itself if the Diameter is set to 0 or if no beams are selected. Re-insert the script and check your properties.\n- **Q: The sinkhole isn't appearing even though I set a diameter.**\n  - A: Check that the **Depth** for that sinkhole is also greater than 0. Both Diameter and Depth must be positive values.\n- **Q: Can I drill through non-parallel beams?**\n  - A: Yes. As long as the 3D axis defined by your start and end points intersects the envelope bodies of the selected beams, the drill will be created."
      },
      "tokens_used": 6021,
      "error": null
    }
  }
}