{
  "filename": "HSB_E-CheckMaximumAllowedSpacing.mcr",
  "status": "completed",
  "total_tokens": 28981,
  "processing_time": 1076.934643983841,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "22.04.2015",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "24.02.2016",
            "author": "RP",
            "changes": "Add message when spacing is not exceeded, add studs when maxspacing is exceeded"
          },
          {
            "version": "1.02",
            "date": "25.02.2016",
            "author": "RP",
            "changes": "Add colors"
          },
          {
            "version": "1.03",
            "date": "26.02.2016",
            "author": "RP",
            "changes": "Add options to skip some properties"
          },
          {
            "version": "1.04",
            "date": "05.08.2016",
            "author": "RP",
            "changes": "Add display instead of colour and a filter"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7133,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "tsl.dbCreate(..., _kModelSpace, mapTsl); Element el = _Element[0]; Beam beams[] = el.beam(); Logic relies on 3D geometry and Element/Beam objects rather than Sheets or Viewports."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space containing hsbCAD Elements",
          "requiredSettings": []
        }
      },
      "tokens_used": 4937,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On insert if no execute key is provided",
            "title": null,
            "dataSource": "Properties defined in script (General, Dimensions, Color)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sequenceNumber",
            "type": "PropInt",
            "displayName": "Sequence number",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "General",
            "description": "The sequence number is used to sort the list of tsl's during generate construction"
          },
          {
            "index": 6,
            "variable": "sFilterBC",
            "type": "PropString",
            "displayName": "Filter beams with beamcode",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "General",
            "description": "Specify beamcode's that can be excluded from the calculation"
          },
          {
            "index": 1,
            "variable": "dMaximumAllowedSpacing",
            "type": "PropDouble",
            "displayName": "Maximum allowed spacing",
            "defaultValue": "U(600)",
            "inputType": "number",
            "options": [],
            "category": "Dimensions",
            "description": "This is the maximum spacing allowed between vertical beams"
          },
          {
            "index": 2,
            "variable": "SAddBeams",
            "type": "PropString",
            "displayName": "Automatic add Studs",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": "Dimensions",
            "description": "Automaticaaly add vertical beams until the maimum spacing is not exceeded"
          },
          {
            "index": 4,
            "variable": "nWrongBeamColor",
            "type": "PropInt",
            "displayName": "Color of the wrong beam",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": "Color",
            "description": "Sets the color of all the beams that are at an incorrect spacing distance"
          },
          {
            "index": 5,
            "variable": "nAddedBeamColor",
            "type": "PropInt",
            "displayName": "Color of the added beam",
            "defaultValue": 3,
            "inputType": "number",
            "options": [],
            "category": "Color",
            "description": "Sets the color of all the beams that are added"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "MasterToSatellite",
            "handler": "MasterToSatellite",
            "action": "Sets properties from 'MasterToSatellite' catalog entry",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 5607,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically validates the spacing between vertical studs in a wall element against a maximum limit and inserts intermediate studs if the gap is too wide.",
          "category": "Framing",
          "typicalUseCase": "Ensuring structural compliance or nailing zone requirements by checking stud spacing (e.g., max 600mm) and filling gaps automatically."
        },
        "parameters": [
          {
            "name": "sequenceNumber",
            "technicalDefault": 0,
            "businessMeaning": "Determines the processing order of this script during the automated 'Generate Construction' phase. This ensures stud checking happens after the main wall framing is generated.",
            "validRange": "0 - 1000",
            "unit": "Integer",
            "affectsOutput": "Runtime execution order. If set too low, the script might check beams before they exist; if too high, it might interfere with later processes like sheathing or machining."
          },
          {
            "name": "sFilterBC",
            "technicalDefault": "",
            "businessMeaning": "Allows the user to exclude specific beam types (based on their BeamCode) from the spacing check. Useful for ignoring special stiffeners, trimmers, or post-beams that do not count as standard studs.",
            "validRange": "String list (e.g., 'STUD;POST;') or '*' wildcards",
            "unit": "String",
            "affectsOutput": "Filters which beams are included in the spacing calculation. Matching beams are skipped, meaning they don't trigger spacing errors and studs won't be added relative to them."
          },
          {
            "name": "dMaximumAllowedSpacing",
            "technicalDefault": "U(600)",
            "businessMeaning": "The maximum allowable clear distance between the faces of adjacent vertical members (studs).",
            "validRange": "300 - 1200",
            "unit": "mm",
            "affectsOutput": "Acts as the threshold for the logic. If the distance between two studs exceeds this value, they are flagged as 'Wrong' and new studs are generated (if enabled) to close the gap."
          },
          {
            "name": "SAddBeams",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggle to enable or disable the automatic physical generation of new studs to fix spacing violations.",
            "validRange": "Yes, No",
            "unit": "Option",
            "affectsOutput": "If 'Yes', the script creates new Beam entities. If 'No', the script only reports violations and highlights existing beams without modifying the geometry."
          },
          {
            "name": "nWrongBeamColor",
            "technicalDefault": 1,
            "businessMeaning": "The color index used to visually highlight existing beams that are spaced too far apart.",
            "validRange": "0 - 255 (AutoCAD Color Index)",
            "unit": "Integer",
            "affectsOutput": "Visual indication in the CAD model. Beams violating the spacing rule will be drawn in this color to alert the user."
          },
          {
            "name": "nAddedBeamColor",
            "technicalDefault": 3,
            "businessMeaning": "The color index used to visually distinguish the new studs added by the script from the existing structure.",
            "validRange": "0 - 255 (AutoCAD Color Index)",
            "unit": "Integer",
            "affectsOutput": "Visual indication. Any beams automatically generated by this script will be displayed in this color."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "SAddBeams is set to 'Yes'",
            "effect": "Activates the geometric creation logic, making 'nAddedBeamColor' relevant. It also relies on 'dMaximumAllowedSpacing' to determine how many beams to add.",
            "cascade": [
              "nAddedBeamColor",
              "dMaximumAllowedSpacing"
            ]
          },
          {
            "trigger": "sFilterBC is populated",
            "effect": "Reduces the set of beams checked by 'dMaximumAllowedSpacing'. Only beams not matching the filter are considered vertical studs for spacing purposes.",
            "cascade": [
              "dMaximumAllowedSpacing"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam (Stud)",
            "description": "New vertical structural members inserted between existing studs. These are copies of the first stud in the spacing pair, transformed linearly along the wall X-axis and stretched to fit between top/bottom plates.",
            "appliedTo": "Inside the Element bounding box, specifically filling gaps between filtered vertical beams."
          },
          {
            "type": "Visual Display Feedback",
            "description": "Temporary or persistent coloring of beam bodies in the 3D model to indicate status (Red for spacing errors, Green for new additions).",
            "appliedTo": "Existing beams with excessive spacing and newly generated beams."
          }
        ]
      },
      "tokens_used": 6503,
      "error": null
    },
    "5": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "Request timeout after retries"
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-CheckMaximumAllowedSpacing.mcr\n\n## Overview\nThis script verifies the spacing between vertical studs within a wall element against a defined maximum limit. If gaps are too wide, it visually highlights the error and optionally inserts new studs to ensure compliance with structural or manufacturing requirements.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in the 3D model on hsbCAD Elements. |\n| Paper Space | No | Not intended for 2D drawings or layouts. |\n| Shop Drawing | No | Does not generate shop drawing views. |\n\n## Prerequisites\n- **Required Entities:** An existing hsbCAD **Element** (e.g., a wall) containing **GenBeams** (studs).\n- **Minimum Beam Count:** The element should contain at least vertical members to calculate spacing.\n- **Required Settings:** None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Navigate to the script location and select `HSB_E-CheckMaximumAllowedSpacing.mcr`.\n\n### Step 2: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the wall element(s) you wish to check and press Enter.\n```\n*Note: Once selected, the script will process the beams within those elements based on the current property settings.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Sequence number** | Number | 0 | Determines the execution order during automatic generation. Higher numbers run later. |\n| **Filter beams with beamcode** | Text | [Blank] | Enter beam codes (e.g., `STUD;POST;`) to exclude specific beams from the spacing check. Leave blank to check all vertical beams. |\n| **Maximum allowed spacing** | Number | 600 | The maximum distance allowed between two vertical studs (in current document units, usually mm). |\n| **Automatic add Studs** | Dropdown | Yes | If \"Yes\", the script will insert new studs to fix spacing violations. If \"No\", it only reports errors visually. |\n| **Color of the wrong beam** | Number | 1 | The AutoCAD color index used to highlight existing beams that are too far apart. |\n| **Color of the added beam** | Number | 3 | The AutoCAD color index used to highlight any new studs that are automatically created. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| MasterToSatellite | Loads property settings from a pre-defined catalog entry, allowing you to quickly switch between different spacing standards (e.g., 400mm vs 600mm centers). |\n\n## Settings Files\n- No external settings files are required for this script.\n\n## Tips\n- **Check Before Fixing:** Set **Automatic add Studs** to \"No\" initially. This allows you to visualize where the spacing violations are (via the wrong beam color) before the script actually modifies your wall geometry.\n- **Filtering:** If your wall has posts or window trimmers that are naturally spaced further apart than studs, use the **Filter beams with beamcode** option to exclude them so they don't trigger false errors.\n- **Order of Operations:** If running automatically via \"Generate Construction\", ensure the **Sequence number** is higher than your wall generation scripts so the studs exist before this script checks them.\n\n## FAQ\n- **Q: Can I undo the changes if the script adds unwanted studs?**\n- **A: Yes, simply use the standard AutoCAD `UNDO` command after the script runs to remove the newly added beams.\n- **Q: Why are some beams ignored even if the spacing is large?**\n- **A: Check the **Filter beams with beamcode** property. You may have defined a filter that excludes specific beam types from the calculation.\n- **Q: What unit does the spacing value use?**\n- **A: The script uses the internal unit system (usually millimeters), but the input in the Properties palette should respect your current hsbCAD configuration. The default `U(600)` typically represents 600 mm."
      },
      "tokens_used": 4801,
      "error": null
    }
  }
}