{
  "filename": "GE_HDWR_STRAP_ANCHOR_SSAD.mcr",
  "status": "completed",
  "total_tokens": 47449,
  "processing_time": 323.0100989341736,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "02.jun.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Added features to make possible reset TXT source file using GE_HDWR_RESET_CATALOG_ENTRY tsl"
          },
          {
            "version": "1.0",
            "date": "13.apr.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "GE_HDWR_RESET_CATALOG_ENTRY"
        ]
      },
      "tokens_used": 7134,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select GenBeam objects (Studs and Plates) and creates 3D Body geometry for hardware. It includes 3D vector math (vecX, vecY, vecZ) and visualizes the result using Display dp(-1). There are no references to sd_*, Viewport, Sheet, or 2D drawing generation."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "TSL_Read_Metalpart_Family_Props.dll",
            "TXT file containing SPTR families details (located in Company TSL Catalog path)"
          ]
        }
      },
      "tokens_used": 6553,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select stud(s) and plate(s)|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"|Pick a point to define on what face of studs place hardware|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Type|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null,\n      \"readOnly\": true\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"dLength\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Lenght|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null,\n      \"readOnly\": true\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dEmbedment\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Embedment|\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null,\n      \"readOnly\": false\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dWidth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Width|\",\n"
      },
      "tokens_used": 9464,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts a steel Strap Anchor (SSAD family, equivalent to Simpson Strong-Tie STHD) that wraps over top and bottom plates to secure wall studs to the foundation or structure.",
          "category": "Hardware / Structural Connector",
          "typicalUseCase": "Anchoring shear walls or framing members to concrete foundations or ledgers where high tension (uplift) and shear loads are present, typically in seismic or hurricane zones."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "\"\"",
            "businessMeaning": "The catalog model name of the strap anchor (e.g., 'STHD10'). It defines the geometry based on manufacturer specifications loaded from an external TXT catalog file.",
            "validRange": "List of valid manufacturer codes (e.g., ST, HD, STHD series)",
            "unit": "String",
            "affectsOutput": "Updates all physical dimensions (Length, Width, Embedment) to match the specific catalog profile selected via the dotNet dialog."
          },
          {
            "name": "dLength",
            "technicalDefault": "U(533,21)",
            "businessMeaning": "The vertical height of the strap anchor leg that runs along the face of the wall stud.",
            "validRange": "100mm - 1500mm (approx. 4\" - 60\")",
            "unit": "mm",
            "affectsOutput": "Controls the height of the vertical body plate (bdFront). Does not include the wrap-over section or the base embedment."
          },
          {
            "name": "dWidth",
            "technicalDefault": "U(75,3)",
            "businessMeaning": "The width (or gauge breadth) of the steel strap material.",
            "validRange": "50mm - 150mm (approx. 2\" - 6\")",
            "unit": "mm",
            "affectsOutput": "Controls the width of the vertical plate and the base plate (the distance perpendicular to the wall face)."
          },
          {
            "name": "dEmbedment",
            "technicalDefault": "U(200,8)",
            "businessMeaning": "The length of the horizontal anchor leg that extends into the concrete foundation or over the support structure.",
            "validRange": "100mm - 600mm (approx. 4\" - 24\")",
            "unit": "mm",
            "affectsOutput": "Determines how far the base body (bdBase/bdBase2) extends horizontally from the wall face."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User executes 'Change type' context menu or on Insert",
            "effect": "The script calls a DotNet utility to read a TXT catalog. The selected Type overwrites the internal Map, which then updates dLength, dWidth, and dEmbedment.",
            "cascade": [
              "sType",
              "dLength",
              "dWidth",
              "dEmbedment"
            ]
          },
          {
            "trigger": "Selection of Plate entities during Insert",
            "effect": "The geometry is offset based on the combined thickness of the Bottom Plate and Top/VeryTop Plate to ensure the strap sits flush against the stud face.",
            "cascade": [
              "Internal: dPlateWidth",
              "Internal: dVeryPlateWidth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Body (MetalPart)",
            "description": "A rigid L-shaped or wrap-shaped strap anchor consisting of a vertical face plate and a horizontal base plate. Includes visual cutouts or bends defined by the hard-coded gauge thickness and corner lengths.",
            "appliedTo": "Model Space (assigned to the Element Group of the primary Stud)"
          }
        ]
      },
      "tokens_used": 8816,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script: User executes command to insert Strap Anchor.",
          "2. Catalog Load: Script calls DotNet utility to load 'SSAD' family properties from TSL_HARDWARE_FAMILY_LIST.dxx.",
          "3. Entity Selection: User prompted to select Studs and Plates (PrEntity).",
          "4. Face Definition: User picks a point (getPoint) to indicate which side of the studs the hardware is placed on.",
          "5. Classification: Script separates selected beams into 'Verticals' (Studs) and 'Plates' (Top/Bottom/VeryTop/VeryBottom).",
          "6. Validation: Script checks if at least one vertical stud and at least one plate type exist. Fails if missing.",
          "7. Cloning Loop: For each valid vertical stud found, the script spawns a new instance of itself (TslInst).",
          "8. Branching Creation: If Bottom plates exist, a child instance is created for Stud+Bottom. If Top plates exist, a separate child instance is created for Stud+Top.",
          "9. Master Erasure: The original 'Master' script instance erases itself, leaving only the generated child instances.",
          "10. Child Execution: Each child instance identifies its specific stud and intersecting plate to calculate exact orientation.",
          "11. Geometry Generation: Child instance generates the 3D Body (Vertical leg + Embedment base) and cleans up duplicates."
        ],
        "conditionalBranches": [
          {
            "condition": "Context Trigger (How the script is running)",
            "path1": {
              "name": "Insert Mode (_bOnInsert)",
              "steps": [
                "Prompts for entity selection",
                "Prompts for reference point",
                "Sorts beams into verticals and plates",
                "Validates selection",
                "Clones child instances",
                "Erases self"
              ]
            },
            "path2": {
              "name": "Recalc / Change Type Mode",
              "steps": [
                "Skips selection prompts",
                "Loads catalog properties from Map or DotNet",
                "Updates OPM properties (Length, Width, etc.)",
                "Regenerates geometry based on existing beam references"
              ]
            }
          },
          {
            "condition": "Plate Configuration (during Cloning)",
            "path1": {
              "name": "Bottom Plate Only",
              "steps": [
                "Sets 'bTieBottom' flag",
                "Passes Stud + Bottom Plates list to child instance"
              ]
            },
            "path2": {
              "name": "Top Plate Only",
              "steps": [
                "Sets 'bTieTop' flag",
                "Passes Stud + Top Plates list to child instance"
              ]
            },
            "path3": {
              "name": "Top and Bottom Plates",
              "steps": [
                "Sets both flags",
                "Creates two separate child instances per stud (one tied to bottom, one tied to top)"
              ]
            }
          },
          {
            "condition": "Initialization State (Child Instance)",
            "path1": {
              "name": "Fresh Child Insert (Map.bOnInsert == 1)",
              "steps": [
                "Analyzes geometry of Stud and intersecting Plate",
                "Calculates vectors (vx, vy, vz) and offsets (dPlateWidth) dynamically",
                "Stores these calculated values into the Map for future recalcs"
              ]
            },
            "path2": {
              "name": "Recalculated Child (Map.bOnInsert != 1)",
              "steps": [
                "Retrieves vectors and offsets directly from saved Map data",
                "Skips geometric intersection analysis to save performance"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Selection Count",
            "errorMessage": "|Not valid top or bottom plates provided| OR |Not valid vertical studs provided|",
            "recovery": "User must re-select the set including at least one vertical beam (Stud) and one horizontal beam (Top or Bottom Plate)."
          },
          {
            "check": "Catalog/Data Availability",
            "errorMessage": "Script erases silently if DotNet call returns empty map on insert.",
            "recovery": "Ensure TSL_Read_Metalpart_Family_Props.dll exists and the TXT catalog path is correct in Company TSL folder."
          },
          {
            "check": "Plate Intersection (Child)",
            "errorMessage": "Script erases instance if intersecting plate calculation fails.",
            "recovery": "Ensure plates are properly touching or intersecting the stud volume so the script can find the intersection point."
          },
          {
            "check": "Cycle Count",
            "errorMessage": "None (Script erases self)",
            "recovery": "Built-in protection against infinite loops during array cloning."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Hardware Type",
            "how": "Right-click context menu -> 'Change type'",
            "effect": "Re-opens the DotNet catalog selection, allowing the user to swap the strap model (e.g., from STHD10 to STHD14), automatically updating Length, Width, and Embedment."
          },
          {
            "action": "Move/Edit Geometry",
            "how": "Standard AutoCAD grips or Move command on the Studs/Plates",
            "effect": "The TSL has setDependencyOnEntity, so moving the stud or plates triggers a recalc and the strap follows the new position/orientation."
          },
          {
            "action": "View Help",
            "how": "Right-click context menu -> 'Help'",
            "effect": "Displays a reportNotice dialog explaining the script's purpose (SSAD Strap Anchor) and usage."
          }
        ]
      },
      "tokens_used": 9499,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_STRAP_ANCHOR_SSAD.mcr\n\n## Overview\nThis script inserts a steel Strap Anchor (SSAD family, similar to Simpson Strong-Tie STHD) that wraps over top and bottom plates to secure wall studs. It is designed for anchoring shear walls to foundations or ledgers where high tension (uplift) and shear loads are present.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script generates 3D Body geometry for hardware. |\n| Paper Space | No | Not applicable for drawing views. |\n| Shop Drawing | No | Not applicable for 2D generation. |\n\n## Prerequisites\n- **Required Entities**: \n  - `GenBeam` entities representing Studs (vertical).\n  - `GenBeam` entities representing Plates (Top, Bottom, or VeryTop/VeryBottom).\n- **Minimum Beam Count**: At least 1 Stud and 1 Plate.\n- **Required Settings**:\n  - `TSL_Read_Metalpart_Family_Props.dll` must be available.\n  - A TXT file containing SSAD family specifications located in the Company TSL Catalog path.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_HDWR_STRAP_ANCHOR_SSAD.mcr`\n\n### Step 2: Select Studs and Plates\n```\nCommand Line: Select stud(s) and plate(s)\nAction: Click to select the wall studs and the plates (top/bottom) they connect to. Press Enter to confirm selection.\n```\n\n### Step 3: Define Hardware Face\n```\nCommand Line: Pick a point to define on what face of studs place hardware\nAction: Click a point on the desired side of the wall (e.g., left exterior face) to determine where the strap anchor will be generated.\n```\n\n### Step 4: Select Model\n- A dialog window will appear prompting you to select the specific hardware model (e.g., STHD10, STHD14) from the catalog.\n- Select the desired model and click OK.\n\n*(Note: The script will automatically generate connectors for every valid stud/plate combination found in your selection and erase the original \"Master\" instance.)*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | String | (Catalog Selection) | The manufacturer model code (e.g., \"STHD10\"). Read-only; change via the right-click menu \"Change type\". |\n| Lenght | Number | 0 | The vertical height of the strap anchor leg. Updated automatically based on the Type selection. |\n| Embedment | Number | 0 | The length of the horizontal anchor leg extending into the foundation. This can be manually edited. |\n| Width | Number | 0 | The width (gauge breadth) of the steel strap material. Updated automatically based on the Type selection. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change type | Opens a dialog to re-select the hardware model from the catalog. This automatically updates Length, Width, and Embedment properties. |\n| Help | Displays a message box with a brief description of the script (SSAD Strap Anchor). |\n| Reset TXT source | Reloads the catalog data from the source TXT file (useful if catalog definitions have changed). |\n\n## Settings Files\n- **Filename**: `TSL_Read_Metalpart_Family_Props.dll`\n- **Location**: hsbCAD application folder (DLLs)\n- **Purpose**: Handles the loading and parsing of metalwork family properties.\n- **Filename**: `*.txt` (Catalog files)\n- **Location**: Company TSL Catalog path\n- **Purpose**: Contains the dimensional data (Length, Width, Embedment) for specific hardware models.\n\n## Tips\n- **Bulk Insertion**: You can select multiple studs and multiple plates in one go. The script calculates all intersections and creates a connector for each stud relative to the top and bottom plates separately.\n- **Double Plates**: The script automatically detects \"VeryTop\" or \"VeryBottom\" plates and calculates the correct offset so the strap sits flush against the stud face, accounting for the extra plate thickness.\n- **Moving Walls**: Because the script uses `setDependencyOnEntity`, if you move or modify the studs/plates using standard AutoCAD commands, the strap anchors will automatically update to the new position.\n\n## FAQ\n- **Q: Why does the script instance seem to disappear immediately after I run it?**\n  - A: This is normal behavior. The script acts as a \"Master\" that spawns individual child instances for every stud/plate connection and then erases itself to avoid duplicates.\n- **Q: Can I modify the dimensions manually?**\n  - A: While you can manually edit the \"Embedment\" value in the properties palette, the \"Length\" and \"Width\" are strictly controlled by the selected Catalog Type. Use the \"Change type\" menu option to switch to a different size.\n- **Q: What happens if I only select studs and no plates?**\n  - A: The script will display an error \"Not valid top or bottom plates provided\" and abort the insertion. You must select at least one plate."
      },
      "tokens_used": 5983,
      "error": null
    }
  }
}