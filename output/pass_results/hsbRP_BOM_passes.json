{
  "filename": "hsbRP_BOM.mcr",
  "status": "completed",
  "total_tokens": 33934,
  "processing_time": 324.5318021774292,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5332,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No #Type E, sd_* prefix, or Multipage prefix detected. Uses standard insertion via getPoint() and selects TslInst entities from the drawing. The script generates a BOM (Bill of Materials) visualization at a user-selected point in Model Space."
        },
        "prerequisites": {
          "requiredEntities": [
            "TslInst",
            "hsbRP_Roofline",
            "hsbRP_EaveArea"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (requires insertion point)",
          "requiredSettings": []
        }
      },
      "tokens_used": 3281,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": "null",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "null",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrEntity",
              "promptOriginal": "Select rooflines and/or eave areas",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "Insert",
            "title": "Properties",
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 2,
            "variable": "sUnit",
            "type": "PropString",
            "displayName": "Unit",
            "defaultValue": "mm",
            "inputType": "dropdown",
            "options": [
              "mm",
              "cm",
              "m",
              "inch",
              "feet"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nDecimals",
            "type": "PropInt",
            "displayName": "Decimals Length",
            "defaultValue": 2,
            "inputType": "dropdown",
            "options": [
              0,
              1,
              2,
              3,
              4
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "nDecimalsArea",
            "type": "PropInt",
            "displayName": "Decimals Area",
            "defaultValue": 2,
            "inputType": "dropdown",
            "options": [
              0,
              1,
              2,
              3,
              4
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 143,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Add entity",
            "handler": "sTrigger[0]",
            "action": "Opens PrEntity selection to filter and append Rooflines or Eave Areas to the BOM list",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 4996,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a Bill of Materials (BOM) report in Model Space that aggregates and lists the total lengths of rooflines and the total surface areas of eave areas.",
          "category": "Reporting",
          "typicalUseCase": "Used by designers or estimators to place a summary table in the model view showing material quantities (e.g., total fascia length or gutter area) for ordering or scheduling."
        },
        "parameters": [
          {
            "name": "sUnit",
            "technicalDefault": "mm",
            "businessMeaning": "Determines the unit of measurement used for displaying the calculated quantities (Metric or Imperial).",
            "validRange": "mm, cm, m, inch, feet",
            "unit": "string (enum)",
            "affectsOutput": "Scales the numerical values displayed in the report and updates the unit label suffix."
          },
          {
            "name": "nDecimals",
            "technicalDefault": 2,
            "businessMeaning": "Controls the precision (number of decimal places) for the displayed linear measurements (roofline lengths).",
            "validRange": "0 to 4",
            "unit": "integer (count)",
            "affectsOutput": "Rounds the length values shown in the report to the specified precision."
          },
          {
            "name": "nDecimalsArea",
            "technicalDefault": 2,
            "businessMeaning": "Controls the precision (number of decimal places) for the displayed area measurements (eave areas).",
            "validRange": "0 to 4",
            "unit": "integer (count)",
            "affectsOutput": "Rounds the area values shown in the report to the specified precision."
          },
          {
            "name": "nColor",
            "technicalDefault": 143,
            "businessMeaning": "Defines the visual color of the generated text report.",
            "validRange": "0 to 255 (AutoCAD Color Index), -1 (ByBlock)",
            "unit": "index",
            "affectsOutput": "Changes the on-screen color of the BOM text for visibility or adherence to layer standards."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific Dimension Style from the drawing to control text font, size, and appearance.",
            "validRange": "Any Dimension Style currently loaded in the drawing",
            "unit": "string (reference)",
            "affectsOutput": "Alters the font type and height of the text, and potentially the spacing of the report layout."
          },
          {
            "name": "_Entity",
            "technicalDefault": "Empty",
            "businessMeaning": "The collection of specific 'Roofline' or 'Eave Area' elements selected to be included in this report.",
            "validRange": "TslInst entities of type hsbRP_Roofline or hsbRP_EaveArea",
            "unit": "array (entities)",
            "affectsOutput": "Directly determines the data source. Adding entities updates the totals; removing entities reduces them."
          },
          {
            "name": "_Pt0",
            "technicalDefault": "User Click",
            "businessMeaning": "The insertion point (anchor) in Model Space where the top-left of the BOM list is placed.",
            "validRange": "Any 3D coordinate in Model Space",
            "unit": "coordinates (mm/inch)",
            "affectsOutput": "Relocates the entire text report to the specified position in the drawing."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sUnit is changed",
            "effect": "The conversion factor applied to the raw internal Length and Area data changes before display.",
            "cascade": [
              "Length Values",
              "Area Values",
              "Column Width"
            ]
          },
          {
            "trigger": "nDecimals or nDecimalsArea is changed",
            "effect": "The string formatting of the numeric values changes, potentially altering the width required for the value column.",
            "cascade": [
              "Column Width",
              "Text Alignment"
            ]
          },
          {
            "trigger": "sDimStyle is changed",
            "effect": "The font characteristics (width factor, height) are updated, requiring a recalculation of text widths to align columns.",
            "cascade": [
              "Column Width",
              "Report Layout"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text Annotation",
            "description": "A formatted table in Model Space displaying headers ('Length of Rooflines', 'Eave Areas'), material names, and calculated totals.",
            "appliedTo": "Model Space (at user specified point)"
          },
          {
            "type": "Logic Reference",
            "description": "Internal aggregation of 'TSLBOM' map data from linked roofline and eave area instances.",
            "appliedTo": "N/A (Data Source)"
          }
        ]
      },
      "tokens_used": 6077,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script initializes properties (Unit, Decimals, Color, DimStyle).",
          "2. System checks execution context: Is this a new insertion (_bOnInsert)?",
          "3. [If New Insertion] Show Properties Dialog to user.",
          "4. [If New Insertion] Prompt user to select Insertion Point (_Pt0).",
          "5. [If New Insertion] Prompt user to select Entities (Rooflines/Eave Areas).",
          "6. [If New Insertion] Filter selection: Accept only TslInst of type 'hsbRP_Roofline' or 'hsbRP_EaveArea'.",
          "7. [If New Insertion] Populate internal _Entity list and pause script.",
          "8. [If Update/Recalc] Validate Color property (clamp between -1 and 255).",
          "9. [If Update/Recalc] Register Context Menu triggers ('Add entity').",
          "10. [If Context Trigger 'Add entity'] Prompt user to select additional entities.",
          "11. [If Context Trigger 'Add entity'] Append valid, non-duplicate entities to _Entity list.",
          "12. Iterate through all linked entities in _Entity list to aggregate data.",
          "13. Retrieve 'TSLBOM' map data (Length for Rooflines, Area for Eave Areas) and Names.",
          "14. Sort collected data alphabetically (Bubble sort).",
          "15. Calculate layout parameters (Column widths based on DimStyle and string lengths).",
          "16. Draw BOM Report in Model Space starting at _Pt0 (Headers, Names, Values).",
          "17. Reassign instance to Info Layer (replaces '+T0~' with '+I0~')."
        ],
        "conditionalBranches": [
          {
            "condition": "New Insertion vs. Recalculation",
            "path1": {
              "name": "Insertion Path",
              "steps": [
                "Show Dialog",
                "Get Insertion Point",
                "Select Initial Entities",
                "Filter and Store Entities",
                "Return (Wait for event)"
              ]
            },
            "path2": {
              "name": "Recalculation Path",
              "steps": [
                "Validate Color",
                "Check Context Menu Triggers",
                "Process Data",
                "Draw/Update Report"
              ]
            }
          },
          {
            "condition": "Entity Script Name Filter",
            "path1": {
              "name": "Valid Entity",
              "steps": [
                "Accept Entity",
                "Extract BOM Data (Length or Area)",
                "Add to aggregation arrays"
              ]
            },
            "path2": {
              "name": "Invalid Entity",
              "steps": [
                "Ignore Entity (Skip processing)"
              ]
            }
          },
          {
            "condition": "Data Aggregation (Duplicate Name Check)",
            "path1": {
              "name": "Existing Material/Name Found",
              "steps": [
                "Add quantity to existing array index",
                "Update text width calculation"
              ]
            },
            "path2": {
              "name": "New Material/Name",
              "steps": [
                "Create new entry in array",
                "Initialize quantity",
                "Update text width calculation"
              ]
            }
          },
          {
            "condition": "Presence of Eave Areas",
            "path1": {
              "name": "Areas Present",
              "steps": [
                "Draw 'Eave Areas' Header",
                "Draw Material Names",
                "Draw Area Values"
              ]
            },
            "path2": {
              "name": "No Areas",
              "steps": [
                "Skip Eave Area section drawing entirely"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Color Index Range",
            "errorMessage": "(No explicit error, silent correction)",
            "recovery": "Script automatically resets nColor to 143 if it is < -1 or > 255."
          },
          {
            "check": "Entity Type during Selection",
            "errorMessage": "(No explicit error, silent filtering)",
            "recovery": "User selects objects; script filters out anything that is not a 'hsbRP_Roofline' or 'hsbRP_EaveArea'."
          },
          {
            "check": "Duplicate Entry (Context Menu Add)",
            "errorMessage": "(No explicit error)",
            "recovery": "Script checks if entity already exists in _Entity list using .find(). If found, it is not added again."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Properties (OPM)",
            "how": "AutoCAD Properties Palette",
            "effect": "Changing Unit/Decimals updates displayed numbers. Changing Color updates text color. Changing DimStyle updates font/size/spacing."
          },
          {
            "action": "Move Report",
            "how": "Grip edit on insertion point (_Pt0)",
            "effect": "Relocates the entire BOM text block in Model Space."
          },
          {
            "action": "Add Data",
            "how": "Right-click Context Menu -> 'Add entity'",
            "effect": "Opens selection prompt to append more Rooflines/Eave Areas to the existing totals."
          },
          {
            "action": "Update Source Data",
            "how": "Modify the linked Roofline or Eave Area entities",
            "effect": "Because 'setDependencyOnEntity' is called, modifying the geometry or properties of the source elements triggers a recalc of this BOM to update totals."
          }
        ]
      },
      "tokens_used": 8323,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbRP_BOM.mcr\n\n## Overview\nThis script generates a formatted Bill of Materials (BOM) table in Model Space. It calculates and displays the total lengths of selected rooflines and the total surface areas of selected eave areas.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The BOM report is placed at a user-selected coordinate in the model. |\n| Paper Space | No | Not designed for Paper Space layouts. |\n| Shop Drawing | No | Not a shop drawing generation script. |\n\n## Prerequisites\n- **Required entities**: `hsbRP_Roofline` and/or `hsbRP_EaveArea` elements must exist in the drawing.\n- **Minimum beam count**: 0\n- **Required settings files**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbRP_BOM.mcr`\n\n### Step 2: Configure Properties\n```\nDialog: Properties\nAction: Review the default settings for Unit, Decimals, Color, and Dimstyle. Click OK to proceed.\n```\n\n### Step 3: Specify Insertion Point\n```\nCommand Line: [Implicitly asks for insertion point]\nAction: Click in the Model Space to define the top-left location where the BOM table will be placed.\n```\n\n### Step 4: Select Elements\n```\nCommand Line: Select rooflines and/or eave areas\nAction: Click on the desired Roofline or Eave Area elements in your drawing. Press Enter to confirm selection and generate the report.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Unit | dropdown | mm | Sets the measurement unit for the report (Metric: mm, cm, m or Imperial: inch, feet). |\n| Decimals Length | dropdown | 2 | Sets the number of decimal places for linear dimensions (Rooflines). |\n| Decimals Area | dropdown | 2 | Sets the number of decimal places for surface dimensions (Eave Areas). |\n| Color | number | 143 | Determines the color of the generated text (AutoCAD Color Index). |\n| Dimstyle | dropdown | [Current] | Selects a Dimension Style from the drawing to control the text font, size, and appearance. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add entity | Allows you to select additional Rooflines or Eave Areas to append to the existing BOM calculation without recreating it. |\n\n## Settings Files\nNone\n\n## Tips\n- **Automatic Updates**: The BOM is linked to the source elements. If you modify a Roofline length or Eave Area geometry, the BOM will automatically recalculate.\n- **Positioning**: You can move the entire table by clicking and dragging the grip at the original insertion point (_Pt0).\n- **Styling**: To match your office standards, change the \"Dimstyle\" property in the Properties palette to use your company's standard text style.\n- **Unit Conversion**: Switching the \"Unit\" property will instantly convert all values in the report without needing to reselect elements.\n\n## FAQ\n- **Q: How do I remove an item from the list?**\n  A: Currently, you must delete the BOM instance and re-run the script, selecting only the desired elements.\n- **Q: Why is my text too small or large?**\n  A: The text size is controlled by the \"Dimstyle\" property. Change this to a Dimension Style that has the text height defined according to your plotting scale.\n- **Q: Can I mix Imperial and Metric units?**\n  A: No, the \"Unit\" property applies globally to the entire report instance."
      },
      "tokens_used": 5925,
      "error": null
    }
  }
}