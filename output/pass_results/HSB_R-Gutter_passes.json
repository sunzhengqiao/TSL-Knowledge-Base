{
  "filename": "HSB_R-Gutter.mcr",
  "status": "completed",
  "total_tokens": 44904,
  "processing_time": 292.2204580307007,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "03.12.2014",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "11.12.2014",
            "author": "AS",
            "changes": "Assign entities to specified group"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6496,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates 3D geometry using Beam.dbCreate and utilizes world coordinate variables (_PtW, _ZW). Inputs are obtained via getEntPLine and getPoint in the model context. No ShopDrawing API (sd_) or Paper Space keywords (_Viewport, _kPaperSpace) are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "EntPLine"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 5555,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getEntPLine",
              "promptOriginal": "|Select the gutter|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select the position of the drain.|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "During insertion if _kExecuteKey is empty or not found in catalog",
            "title": null,
            "dataSource": "Properties (sAssignEntitiesTo, dSlopePercentage, etc.)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 2,
            "variable": "sAssignEntitiesTo",
            "type": "PropString",
            "displayName": "|Assign gutter to group|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": "Dynamically generated from existing groups",
            "category": "|Gutter|",
            "description": "|Sets the group to assign the entities to.|"
          },
          {
            "index": 0,
            "variable": "dSlopePercentage",
            "type": "PropDouble",
            "displayName": "|Slope| [%]",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": "|Gutter|",
            "description": "|Sets the slope| [%]."
          },
          {
            "index": 5,
            "variable": "dReferenceHeight",
            "type": "PropDouble",
            "displayName": "|Reference height|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Gutter|",
            "description": null
          },
          {
            "index": 1,
            "variable": "dStartHGutterLath",
            "type": "PropDouble",
            "displayName": "|Start height|",
            "defaultValue": "U(20)",
            "inputType": "number",
            "options": [],
            "category": "|Gutter laths|",
            "description": null
          },
          {
            "index": 4,
            "variable": "dWGutterLath",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": "U(48)",
            "inputType": "number",
            "options": [],
            "category": "|Gutter laths|",
            "description": null
          },
          {
            "index": 2,
            "variable": "dOffsetGutterLathsFromDrain",
            "type": "PropDouble",
            "displayName": "|Offset from drain|",
            "defaultValue": "U(150)",
            "inputType": "number",
            "options": [],
            "category": "|Gutter laths|",
            "description": null
          },
          {
            "index": 3,
            "variable": "dMiniumLengthGutterLaths",
            "type": "PropDouble",
            "displayName": "|Minimum length|",
            "defaultValue": "U(150)",
            "inputType": "number",
            "options": [],
            "category": "|Gutter laths|",
            "description": null
          },
          {
            "index": 6,
            "variable": "dOffsetSelectedGutterArea",
            "type": "PropDouble",
            "displayName": "|Offset from selected area|",
            "defaultValue": "U(5)",
            "inputType": "number",
            "options": [],
            "category": "|Gutter laths|",
            "description": "|Sets the offset from the selected area.|"
          },
          {
            "index": 1,
            "variable": "nColorGutterLaths",
            "type": "PropInt",
            "displayName": "|Color gutter laths|",
            "defaultValue": 5,
            "inputType": "number",
            "options": [],
            "category": "|Gutter laths|",
            "description": null
          },
          {
            "index": 0,
            "variable": "nColorDrain",
            "type": "PropInt",
            "displayName": "|Color drain|",
            "defaultValue": 5,
            "inputType": "number",
            "options": [],
            "category": "|Drain|",
            "description": null
          },
          {
            "index": 7,
            "variable": "dDiameterDrain",
            "type": "PropDouble",
            "displayName": "|Diameter drain|",
            "defaultValue": "U(80)",
            "inputType": "number",
            "options": [],
            "category": "|Drain|",
            "description": null
          },
          {
            "index": 0,
            "variable": "sDescriptionDrain",
            "type": "PropString",
            "displayName": "|Description|",
            "defaultValue": "RWP",
            "inputType": "text",
            "options": [],
            "category": "|Drain|",
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimension style|",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": "|Drain|",
            "description": null
          },
          {
            "index": 8,
            "variable": "dTxtSize",
            "type": "PropDouble",
            "displayName": "|Text size|",
            "defaultValue": "-U(1)",
            "inputType": "number",
            "options": [],
            "category": "|Drain|",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7114,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates structural timber gutter laths based on a 2D outline and a drain position, automatically calculating sloped cuts.",
          "category": "Framing/Structural",
          "typicalUseCase": "Creating a custom timber box gutter or roof drainage channel where the sides are formed by structural timber planks cut to the correct fall percentage."
        },
        "parameters": [
          {
            "name": "sAssignEntitiesTo",
            "technicalDefault": "null (Dynamic dropdown)",
            "businessMeaning": "Specifies the construction group (e.g., Floor, Roof) to which the generated gutter beams belong, ensuring proper BIM organization and listing.",
            "validRange": "Any existing group name in the project",
            "unit": "String",
            "affectsOutput": "Group assignment of the generated timber beams."
          },
          {
            "name": "dSlopePercentage",
            "technicalDefault": "1",
            "businessMeaning": "The pitch or fall of the gutter towards the drain to ensure water flow.",
            "validRange": "0.5 - 2.0 (standard roofing fall)",
            "unit": "%",
            "affectsOutput": "Determines the angle of the top cut on the gutter laths and the variation in height from the drain outwards."
          },
          {
            "name": "dReferenceHeight",
            "technicalDefault": "U(0)",
            "businessMeaning": "The vertical Z-height (elevation) at which the gutter geometry is generated relative to the working plane.",
            "validRange": "Project specific Z-values",
            "unit": "mm",
            "affectsOutput": "Vertical position of the entire gutter assembly."
          },
          {
            "name": "dStartHGutterLath",
            "technicalDefault": "U(20)",
            "businessMeaning": "The height (thickness) of the timber lath at the lowest point (near the drain).",
            "validRange": "18 - 50 (depending on timber size)",
            "unit": "mm",
            "affectsOutput": "Cross-sectional size of the lath at the drain end."
          },
          {
            "name": "dWGutterLath",
            "technicalDefault": "U(48)",
            "businessMeaning": "The width (depth) of the timber plank used to form the gutter wall.",
            "validRange": "45 - 100 (standard timber widths)",
            "unit": "mm",
            "affectsOutput": "Cross-sectional width of the generated beams."
          },
          {
            "name": "dOffsetGutterLathsFromDrain",
            "technicalDefault": "U(150)",
            "businessMeaning": "The distance from the center of the drain to the point where the timber gutter laths begin.",
            "validRange": "100 - 300",
            "unit": "mm",
            "affectsOutput": "The gap between the drain symbol and the start of the timber construction."
          },
          {
            "name": "dMiniumLengthGutterLaths",
            "technicalDefault": "U(150)",
            "businessMeaning": "The shortest allowable length for a gutter lath segment to be generated.",
            "validRange": "50 - 300",
            "unit": "mm",
            "affectsOutput": "Prevents the creation of very small, unusable timber fragments if the gutter is too short."
          },
          {
            "name": "dOffsetSelectedGutterArea",
            "technicalDefault": "U(5)",
            "businessMeaning": "Sets an inset distance from the selected outline polyline to the inner edge of the gutter.",
            "validRange": "0 - 20",
            "unit": "mm",
            "affectsOutput": "Adjusts the width of the gutter channel if the outline represents the outer fascia edge."
          },
          {
            "name": "nColorGutterLaths",
            "technicalDefault": "5",
            "businessMeaning": "The display color (AutoCAD Color Index) for the generated timber beams.",
            "validRange": "0 - 255",
            "unit": "Index",
            "affectsOutput": "Visual representation only."
          },
          {
            "name": "nColorDrain",
            "technicalDefault": "5",
            "businessMeaning": "The display color for the drain marker.",
            "validRange": "0 - 255",
            "unit": "Index",
            "affectsOutput": "Visual representation only."
          },
          {
            "name": "dDiameterDrain",
            "technicalDefault": "U(80)",
            "businessMeaning": "The visual diameter of the drain symbol drawn on the model.",
            "validRange": "60 - 150",
            "unit": "mm",
            "affectsOutput": "Visual size of the drain circle marker."
          },
          {
            "name": "sDescriptionDrain",
            "technicalDefault": "RWP",
            "businessMeaning": "Text label to identify the drain (e.g., 'RWP' for Rain Water Pipe).",
            "validRange": "Text string",
            "unit": "String",
            "affectsOutput": "Text label next to the drain symbol."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "The dimensioning style used for the drain label.",
            "validRange": "Existing dim styles in drawing",
            "unit": "String",
            "affectsOutput": "Font/Style of the drain text."
          },
          {
            "name": "dTxtSize",
            "technicalDefault": "-U(1)",
            "businessMeaning": "The height of the text label for the drain.",
            "validRange": "Project text standards",
            "unit": "mm",
            "affectsOutput": "Size of the drain text."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dSlopePercentage",
            "effect": "Alters the calculated height of the gutter lath at the far end from the drain (Start Height + Length * Slope).",
            "cascade": []
          },
          {
            "trigger": "dOffsetGutterLathsFromDrain",
            "effect": "Affects the effective length of the lath, which in turn changes the height calculation based on slope.",
            "cascade": [
              "dSlopePercentage"
            ]
          },
          {
            "trigger": "dMiniumLengthGutterLaths",
            "effect": "If the distance from the drain to the gutter end minus the offset is less than this value, no lath is generated.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Beam",
            "description": "Rectangular timber beams representing the gutter walls/laths, running up-slope from the drain.",
            "appliedTo": "New entities created by the script."
          },
          {
            "type": "Cut",
            "description": "A planar cut applied to the top of the gutter laths to match the specified slope percentage.",
            "appliedTo": "Gutter Lath Beams."
          },
          {
            "type": "Drawing",
            "description": "2D geometry (Circle and Text) representing the drain location.",
            "appliedTo": "Model Space (Visual only)."
          }
        ]
      },
      "tokens_used": 9256,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch / Property Initialization",
          "Check for Execute Key (Catalog Entry)",
          "[Conditional] Show Dynamic Dialog if no valid Execute Key found",
          "Prompt user: Select Gutter Pline (EntPLine)",
          "Prompt user: Select Drain Position (Point3d)",
          "Calculate Geometry: Determine Gutter Vectors (X, Y, Z) and Extremes",
          "Calculate Geometry: Shrink Pline by offset distance",
          "Calculate Geometry: Determine Start and End points of gutter channel",
          "[Conditional] Generate Start Side Laths (towards drain start)",
          "[Conditional] Generate End Side Laths (away from drain)",
          "Generate Drain Visuals (Circle, Text, Arrows)",
          "Script Completion"
        ],
        "conditionalBranches": [
          {
            "condition": "Check for valid Execute Key (_kExecuteKey) during insert",
            "path1": {
              "name": "Catalog Insertion",
              "steps": [
                "Properties set from catalog values",
                "Skip Dialog",
                "Proceed to input prompts"
              ]
            },
            "path2": {
              "name": "Manual Insertion",
              "steps": [
                "Show Properties Dialog",
                "User modifies parameters",
                "Proceed to input prompts"
              ]
            }
          },
          {
            "condition": "Distance from Drain to Gutter Start (vs Offset + MinLength)",
            "path1": {
              "name": "Create Start Side Laths",
              "steps": [
                "Check distance > (Offset + MinLength)",
                "Create two parallel laths running towards Start",
                "Apply slope cut (angled down towards drain)"
              ]
            },
            "path2": {
              "name": "Skip Start Side",
              "steps": [
                "Distance check fails",
                "No laths generated on this side"
              ]
            }
          },
          {
            "condition": "Distance from Drain to Gutter End (vs Offset + MinLength)",
            "path1": {
              "name": "Create End Side Laths",
              "steps": [
                "Check distance > (Offset + MinLength)",
                "Create two parallel laths running towards End",
                "Apply slope cut (angled down towards drain)"
              ]
            },
            "path2": {
              "name": "Skip End Side",
              "steps": [
                "Distance check fails",
                "No laths generated on this side"
              ]
            }
          },
          {
            "condition": "Source Entity Validity (on recalculation)",
            "path1": {
              "name": "Use Source Entity",
              "steps": [
                "Source EntPLine is valid",
                "Extract Pline geometry from Entity"
              ]
            },
            "path2": {
              "name": "Use Cached Geometry",
              "steps": [
                "Source EntPLine is invalid/deleted",
                "Retrieve Pline from internal Map storage",
                "Continue generation"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Selected Entity (EntPLine) exists or is stored in Map",
            "errorMessage": "None (Script erases instance silently if found)",
            "recovery": "Re-insert script or select valid polyline."
          },
          {
            "check": "Gutter Extremes Calculation (Start/End points)",
            "errorMessage": "|Extremes cannot be calculated for this gutter!|",
            "recovery": "Select a polyline with clear X/Y orientation relative to drain point."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Gutter Dimensions",
            "how": "OPM Properties Palette",
            "effect": "Updating Slope, Height, Width, or Offsets triggers regeneration of laths and recalculation of cuts."
          },
          {
            "action": "Change Drain Location",
            "how": "Grip Edit (Point input)",
            "effect": "Moving the drain point updates the position of the drain symbol and recalculates the lengths and angles of all gutter laths."
          },
          {
            "action": "Change Group Assignment",
            "how": "OPM Dropdown (sAssignEntitiesTo)",
            "effect": "Reassigns the generated gutter laths and the script instance to a different Floor/Group."
          }
        ]
      },
      "tokens_used": 8799,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_R-Gutter.mcr\n\n## Overview\nThis script generates structural timber gutter laths (box gutters) based on a selected 2D polyline outline and a specified drain position. It automatically calculates and applies sloped cuts to the timber beams to ensure correct water flow towards the drain.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script creates 3D beams and visual markers. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: A Polyline representing the gutter outline.\n- **Minimum Beam Count**: None.\n- **Required Settings Files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_R-Gutter.mcr`\n\n### Step 2: Select Gutter Outline\n```\nCommand Line: |Select the gutter|\nAction: Click on the Polyline that defines the shape of the gutter area.\n```\n\n### Step 3: Position Drain\n```\nCommand Line: |Select the position of the drain.|\nAction: Click a point in the model where the rainwater pipe (drain) is located. This point determines the direction and start of the slope calculation.\n```\n\n### Step 4: Configure Properties (Optional)\nIf you are inserting the script manually (not from a catalog), a dialog box may appear allowing you to adjust the slope, dimensions, and group assignment before generation.\n\n## Properties Panel Parameters\n\n### Gutter\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Assign gutter to group | dropdown | - | Sets the group (e.g., Roof, Floor) to assign the generated entities to. |\n| Slope [%] | number | 1 | Sets the pitch or fall of the gutter towards the drain. |\n| Reference height | number | 0 | Sets the vertical Z-height (elevation) for the gutter geometry. |\n\n### Gutter laths\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Start height | number | 20 mm | The height (thickness) of the timber lath at the lowest point (near the drain). |\n| Width | number | 48 mm | The width (depth) of the timber plank used for the gutter wall. |\n| Offset from drain | number | 150 mm | The distance from the center of the drain to the start of the timber laths. |\n| Minimum length | number | 150 mm | The shortest allowable length for a gutter lath segment. (Shorter segments are skipped). |\n| Offset from selected area | number | 5 mm | Sets the inset distance from the selected polyline to the inner edge of the gutter. |\n| Color gutter laths | number | 5 | The display color (AutoCAD Index) for the generated laths. |\n\n### Drain\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Color drain | number | 5 | The display color for the drain marker. |\n| Diameter drain | number | 80 mm | The visual diameter of the drain circle drawn in the model. |\n| Description | text | RWP | Text label for the drain (e.g., \"RWP\"). |\n| Dimension style | dropdown | _DimStyles | The dimensioning style used for the drain label. |\n| Text size | number | -1 mm | The height of the text label. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not define custom context menu items. Use the Properties Palette to modify parameters and trigger recalculation. |\n\n## Settings Files\nNo external settings files are required for this script.\n\n## Tips\n- **Lath Visibility**: If the gutter laths do not appear on one side of the drain, check if the distance from the drain to the gutter edge is greater than the **Offset from drain** + **Minimum length**.\n- **Slope Calculation**: The script calculates the height of the lath at the far end based on the **Start height**, the length of the gutter, and the **Slope [%]**. Increase the slope percentage if water flow is a concern.\n- **Grouping**: Use the **Assign gutter to group** property immediately after insertion to ensure the generated beams appear in the correct Lists/Exports.\n\n## FAQ\n- **Q: Why does the script show \"Extremes cannot be calculated for this gutter!\"?**\n  A: This usually happens if the selected polyline is irregular (e.g., self-intersecting or a circle) or if the drain point is placed in a geometrically ambiguous location relative to the polyline segments. Try using a rectangular polyline.\n- **Q: How do I change the location of the drain after insertion?**\n  A: You cannot directly grip-edit the drain point in the standard version of this script behavior (depending on specific hsbCAD version constraints), but you can erase the instance and re-insert it, or modify the properties if the drain point was mapped to a grip.\n- **Q: Can I use a curved polyline for the gutter?**\n  A: The script is primarily designed for linear gutters where \"Start\" and \"End\" sides can be clearly determined relative to the drain. Complex curves may result in unexpected behavior."
      },
      "tokens_used": 7684,
      "error": null
    }
  }
}