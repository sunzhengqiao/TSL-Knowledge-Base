{
  "filename": "NA_FLOOR_HOLES.mcr",
  "status": "completed",
  "total_tokens": 51859,
  "processing_time": 690.0132381916046,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6643,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses `getElementRoof` to select a Floor Element and `addTool` to apply `ElemMill` and `ElemDrill` to `Sheet` objects, which are Model Space manufacturing operations. It collects entities using `_kModelSpace`. It creates a display representation for `LayoutDisplay`, but the script execution and logic are tied to the 3D Model Space Element."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Sheet"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space containing a Floor Element",
          "requiredSettings": []
        }
      },
      "tokens_used": 7525,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialogOnce",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getElementRoof",
              "promptOriginal": "Select an floor element",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "Select insertion point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "During Insertion (_bOnInsert) via showDialogOnce()",
            "title": null,
            "dataSource": "OPM Properties (PropString, PropInt, PropDouble)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sHoleName",
            "type": "PropString",
            "displayName": "Hole type",
            "defaultValue": "2-1\"Drills Spaced at 3-3/4\"",
            "inputType": "dropdown",
            "options": [
              "2-1\"Drills Spaced at 3-3/4\"",
              "2-1\"Drills Spaced at 1-3/4\"",
              "2-1\"Drills Spaced at 3\"",
              "Circular Hole 1.25",
              "Circular Hole 1.5",
              "Circular Hole 4",
              "Circular Hole 5",
              "Circular Hole 6",
              "Circular Hole 9",
              "Circular Hole 10",
              "Ellipse 3x1",
              "Ellipse 3x2",
              "Ellipse 4x2",
              "Ellipse 4x1.5",
              "Diamond Hole 4 1/2",
              "Diamond Hole 5 1/2",
              "Diamond Hole 8",
              "Rectangle Hole 6X9",
              "Rectangle Hole 5.5x8",
              "Rectangle Hole 5.5x10",
              "Rectangle Hole 3.5x14.5",
              "Rectangle Hole 4.25x10.25",
              "Square Hole 5",
              "Square Hole 6",
              "Square Hole 8",
              "Square Hole 10",
              "Text"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "pDirection",
            "type": "PropString",
            "displayName": "Orientaion of Hole",
            "defaultValue": "Joist Direction",
            "inputType": "dropdown",
            "options": [
              "Joist Direction",
              "Perpendicular to Joist Direction"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "iRotation",
            "type": "PropInt",
            "displayName": "Additional Rotation",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strText",
            "type": "PropString",
            "displayName": "Text Output",
            "defaultValue": "TEXT",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "strDrill",
            "type": "PropString",
            "displayName": "Add Drill to Joist",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dDrillDiam",
            "type": "PropDouble",
            "displayName": "Drill Diameter",
            "defaultValue": "1.5",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8186,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Creates customized cutouts and holes in floor sheathing (sheets), with options to drill through underlying joists and add text labels for manufacturing.\",\n    \"category\": \"Manufacturing/Framing\",\n    \"typicalUseCase\": \"Adding HVAC vents, pipe chases, or utility penetrations to a floor panel during the detailing phase.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sHoleName\",\n      \"technicalDefault\": \"2-1\\\"Drills Spaced at 3-3/4\\\"\",\n      \"businessMeaning\": \"Selects the specific profile or template for the floor penetration (e.g., circular duct, rectangular chase, vent slots, or text label).\",\n      \"validRange\": \"Predefined list of 28 options (Drill pairs, Circles, Ellipses, Diamonds, Rectangles, Squares, Text)\",\n      \"unit\": \"Selection\",\n      \"affectsOutput\": \"Determines the shape (PLine geometry), size, and type of machining (Mill vs Drill) applied to the floor sheets. If 'Text' is selected, it suppresses cutting and generates a Mark instead.\"\n    },\n    {\n      \"name\": \"pDirection\",\n      \"technicalDefault\": \"Joist Direction\",\n      \"businessMeaning\": \"Aligns the orientation of the hole relative to the primary structural members (joists) of the floor element.\",\n      \"validRange\": \"\\\"Joist Direction\\\", \\\"Perpendicular to Joist Direction\\\"\",\n      \"unit\": \"Selection\",\n      \"affectsOutput\": \"Rotates the coordinate system used to generate the hole geometry. Adds 90 degrees to the rotation if 'Joist Direction' is selected.\"\n    },\n    {\n      \"name\": \"iRotation\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"Allows for a manual fine-tuning adjustment to the angle of the hole, typically to align with specific field conditions or non-standard obstructions.\",\n      \"validRange\": \"0 - 360 (Integer)\",\n      \"unit\": \"Degrees\",\n      \"affectsOutput\": \"Adds an additional rotation offset to the hole's coordinate system before geometry is generated.\"\n    },\n    {\n      \"name\": \"strText\",\n      \"technicalDefault\": \"TEXT\",\n      \"businessMeaning \"content\": \"The custom string or label to be written on the floor sheet when 'Text' is selected as the Hole Type.\",\n      \"validRange\": \"Alphanumeric String\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Defines the content of the Mark entity drawn on the Sheet. Combined with the Element number (e.g., 'FLOOR01TEXT').\"\n    },\n    {\n      \"name\": \"strDrill\",\n      \"technicalDefault\": \"Yes\",\n      \"businessMeaning\": \"Toggles whether the script should also drill holes through the floor joists (beams) located directly beneath the floor sheet cutout.\",\n      \"validRange\": \"\\\"Yes\\\", \\\"No\\\"\",\n      \"unit\": \"Boolean/Selection\",\n      \"affectsOutput\": \"If 'Yes', searches for '_kDakCenterJoist' beams intersecting the hole location and applies a Drill tool to them.\"\n    },\n    {\n      \"name\": \"dDrillDiam\",\n      \"technicalDefault\": \"1.5\",\n      \"businessMeaning\": \"Specifies the diameter of the hole to be drilled through the underlying joists.\",\n      \"validRange\": \"1.0 - 12.0 (Typical joist drilling range)\",\n      \"unit\": \"Inches\",\n      \"affectsOutput\": \"Sets the diameter of the Drill tool applied to intersecting joists.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"sHoleName is set to 'Text'\",\n      \"effect\": \"The script switches from creating machining cuts to creating a text Mark (label). Geometric cutting parameters are ignored.\",\n      \"cascade\": [\"strText\"]\n    },\n    {\n      \"trigger\": \"strDrill is set to 'No'\",\n      \"effect\": \"The joist drilling logic is skipped entirely.\",\n      \"cascade\": [\"dDrillDiam\"]\n    },\n    {\n      \"trigger\": \"sHoleName is changed\",\n      \"effect\": \"Updates internal dimensions (width, height, spacing) and display text (e.g., 'DR' or '4d') associated with the specific hole profile.\",\n      \"cascade\": [\"Geometry Generation\"]\n    }\n  ],\n  \"outputEntities\": [\n    {\n      \"type\": \"ElemMill\",\n      \"description\": \"A profile-based cut operation through the thickness of the floor sheeting. Used for Rectangles, Ellipses, and Diamonds.\",\n      \"appliedTo\": \"Sheet entities within the selected Floor Element.\"\n    },\n    {\n      \"type\": \"ElemDrill\",\n      \"description\": \"A circular hole operation applied to the floor element definition and individual sheets. Used for Circular Holes.\",\n      \"appliedTo\": \"Sheet entities and the parent Floor Element.\"\n    },\n    {\n      \"type\": \"Drill\",\n      \"description\": \"A cylindrical hole operation applied specifically to structural framing members.\",\n      \"appliedTo\": \"Beams (type _kDakCenterJoist) located beneath the insertion point.\"\n    },\n    {\n      \"type\": \"Mark\",\n      \"description\": \"Text annotation drawn on the sheet surface for labeling or layout instructions.\",\n      \"appliedTo\": \"Sheet entities (and LayoutDisplay).\"\n    },\n    {\n      \"type\": \"Display\",\n      \"description\": \"Visual representation of the hole shape or text in the 3D model and 2D drawings.\",\n      \"appliedTo\": \"Model Space and LayoutDisplay.\"\n    }\n  ]\n}\n```"
      },
      "tokens_used": 10521,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch: User runs TSL 'NA_FLOOR_HOLES'.",
          "Insert Mode Check: Script detects '_bOnInsert' is true.",
          "Dialog Display: 'showDialogOnce()' opens dynamic dialog for initial parameters.",
          "Element Selection: 'getElementRoof' prompts user to select a floor element.",
          "Point Selection: 'getPoint' prompts user to select an insertion point on the floor.",
          "Initial Exit: Script returns, saving initial state.",
          "Re-entry (Calculation): Script runs again with saved Element and Point.",
          "Element Validation: Checks if Element exists; if not, erases instance.",
          "Geometry Collection: Collects Beams and Trusses from the Element's group into bounding boxes (Quaders).",
          "Sheet Collection: Collects all Sheets associated with the Element.",
          "Property Mapping: Reads 'sHoleName' to determine shape (Circle, Ellipse, etc.), dimensions (X, Y), and shape index.",
          "Coordinate System Setup: Establishes local coordinate system based on Element orientation.",
          "Rotation Calculation: Calculates rotation based on 'Additional Rotation' and 'Orientation of Hole'.",
          "Joist Snapping (Conditional): If point moved or created, checks for intersection with Joists. If found, snaps point to Joist centerline.",
          "Elevation Adjustment: Projects the insertion point onto the Element's Z-plane.",
          "Geometry Generation (Conditional):",
          "   - Circle/Ellipse/Rect/Diamond: Creates PLine geometry for Milling.",
          "   - Double Drill: Creates two PLine circles.",
          "   - Text: Creates Mark entities and skips cutting.",
          "Joist Drilling (Conditional): If 'Add Drill to Joist' is Yes, detects intersecting '_kDakCenterJoist' and adds Drill tool.",
          "Tooling Application (Sheets):",
          "   - Intersects generated cutting bodies with Sheet envelopes.",
          "   - Applies 'ElemMill' (for PLines) or 'Drill' (for Circles) to the Element and individual Sheets.",
          "Display Creation: Draws PLine or Text in Model Space and Layout Display.",
          "Data Export: Updates Map entities for DXF export.",
          "Completion: Instance is fully generated and visible in model."
        ],
        "conditionalBranches": [
          {
            "condition": "Shape Selection (nShape)",
            "path1": {
              "name": "Circular Hole (nShape=0)",
              "steps": [
                "Create single PLine circle.",
                "Generate Drill point list.",
                "Apply ElemDrill to Element.",
                "Apply Drill to Sheets."
              ]
            },
            "path2": {
              "name": "Double Drill (nShape=5)",
              "steps": [
                "Calculate two center points based on spacing.",
                "Create two PLine circles.",
                "Generate Drill point list for both.",
                "Apply Drill tools for both points."
              ]
            },
            "path3": {
              "name": "Ellipse (nShape=1)",
              "steps": [
                "Calculate vertices and bulges.",
                "Create PLine profile.",
                "Apply ElemMill to Element."
              ]
            },
            "path4": {
              "name": "Diamond (nShape=2)",
              "steps": [
                "Create Rectangle PLine.",
                "Rotate PLine by 45 degrees.",
                "Apply ElemMill to Element."
              ]
            },
            "path5": {
              "name": "Rectangle/Square (nShape=3)",
              "steps": [
                "Create Rectangle PLine.",
                "Apply ElemMill to Element."
              ]
            },
            "path6": {
              "name": "Text Only (nShape=4)",
              "steps": [
                "Skip PLine creation.",
                "Create ElemItem for visibility.",
                "Create Mark entity.",
                "Check Sheet intersection.",
                "Add Mark to intersecting Sheets."
              ]
            }
          },
          {
            "condition": "Joist Intersection on Move (_kNameLastChangedProp == '_Pt0')",
            "path1": {
              "name": "Intersecting Joist Found",
              "steps": [
                "Create vertical Body check at point.",
                "Loop through Quaders.",
                "If Body intersects Quader and is parallel to Element Y.",
                "Snap insertion point to Joist centerline."
              ]
            },
            "path2": {
              "name": "No Intersection",
              "steps": [
                "Preserve original insertion point location."
              ]
            }
          },
          {
            "condition": "Add Drill to Joist (strDrill)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Create vertical Body check.",
                "Loop through Beams.",
                "Check for intersection and type '_kDakCenterJoist'.",
                "Calculate drill point on beam centerline.",
                "Add Drill tool to Beam."
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skip Joist drilling logic entirely."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "None specific in code (Script Erasure)",
            "recovery": "User must re-insert the script and select a valid Element."
          },
          {
            "check": "Array Index Consistency",
            "errorMessage": "Script crash/Incorrect geometry",
            "recovery": "Developer must ensure 'sarHoleNames', 'dHoleDiams', and 'nShapes' arrays are synchronized."
          },
          {
            "check": "Sheet Intersection for Milling",
            "errorMessage": "Mill tool not applied (if no intersection)",
            "recovery": "User moves insertion point (Grip Edit) until it intersects a Sheet."
          },
          {
            "check": "Joist Type",
            "errorMessage": "Drill not applied to non-center joist",
            "recovery": "Ensure selected beam is type '_kDakCenterJoist'."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Insertion Point",
            "how": "Grip Edit (Dragging the script handle/point)",
            "effect": "Triggers Joist Snapping logic. Re-calculates cutout location. Re-evaluates Joist Drilling intersection. Updates Sheet tooling."
          },
          {
            "action": "Change Properties (OPM)",
            "how": "AutoCAD Properties Palette",
            "effect": "Changing 'Hole type' regenerates geometry shape. Changing 'Orientation' or 'Additional Rotation' rotates the cutout. Changing 'Drill Diameter' updates hole size."
          },
          {
            "action": "Text Content Update",
            "how": "OPM 'Text Output' field",
            "effect": "Updates the Mark entity string on the sheet."
          }
        ]
      },
      "tokens_used": 11958,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# NA_FLOOR_HOLES\n\n## Overview\nThis script creates customized cutouts, holes, and text labels on floor sheathing (sheets). It includes options to automatically drill through underlying floor joists and snap to joist centerlines for precise placement.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for selecting Floor Elements and placing points. |\n| Paper Space | No | Script operates on 3D model entities. |\n| Shop Drawing | No | Modifications occur in the model, which update drawings automatically. |\n\n## Prerequisites\n- **Required Entities**: A Floor Element containing Sheets (sheathing).\n- **Minimum Beam Count**: 0 (Script works on sheets, but optional joist drilling requires joists).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or custom alias) â†’ Select `NA_FLOOR_HOLES.mcr`\n\n### Step 2: Configure Hole Settings\n```\nInterface: Dynamic Dialog\nAction: Select the desired Hole Type, Orientation, and Drill settings. Click OK to confirm.\n```\n\n### Step 3: Select Floor Element\n```\nCommand Line: Select an floor element\nAction: Click on the Floor Element (panel) where you want to place the hole.\n```\n\n### Step 4: Select Insertion Point\n```\nCommand Line: Select insertion point\nAction: Click on the surface of the floor to place the hole. The script will automatically project the point onto the floor plane.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Hole type | dropdown | 2-1\"Drills Spaced at 3-3/4\" | Select the profile for the cutout. Options include Drill pairs, Circles, Ellipses, Diamonds, Rectangles, Squares, or Text labels. |\n| Orientaion of Hole | dropdown | Joist Direction | Aligns the hole rotation relative to the floor joists. Options: \"Joist Direction\" or \"Perpendicular to Joist Direction\". |\n| Additional Rotation | number | 0 | Fine-tunes the angle of the hole in degrees (0-360). |\n| Text Output | text | TEXT | The text string to display on the sheet when \"Text\" is selected as the Hole type. |\n| Add Drill to Joist | dropdown | Yes | If \"Yes\", the script searches for joists beneath the hole and adds a drill operation to them. |\n| Drill Diameter | number | 1.5 | The diameter (in inches) of the hole to drill through the joists (if enabled). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not use specific right-click context menu triggers. All modifications are made via the Properties Palette or Grip Editing. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Snapping to Joists**: If you drag the script's insertion point (Grip Edit) after placement, it will automatically snap to the centerline of the nearest floor joist.\n- **Switching to Text**: If you only need a label and not a physical hole, change \"Hole type\" to \"Text\" and update the \"Text Output\" property.\n- **Perpendicular Adjustments**: Use the \"Orientaion of Hole\" property to quickly rotate the cutout 90 degrees relative to the joists without calculating angles manually.\n\n## FAQ\n- **Q: The hole appears in the sheet but not the joist. Why?**\n- **A:** Check the \"Add Drill to Joist\" property in the palette. It must be set to \"Yes\". Also, ensure the insertion point is actually intersecting a joist (try dragging the point to trigger the snap).\n- **Q: Can I use this for circular HVAC vents?**\n- **A:** Yes, select one of the \"Circular Hole\" options in the \"Hole type\" dropdown.\n- **Q: How do I rotate a rectangular hole?**\n- **A:** Use the \"Additional Rotation\" property to specify a specific angle, or change \"Orientaion of Hole\" to toggle between the two main axes."
      },
      "tokens_used": 7026,
      "error": null
    }
  }
}