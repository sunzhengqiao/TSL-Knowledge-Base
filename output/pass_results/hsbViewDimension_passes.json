{
  "filename": "hsbViewDimension.mcr",
  "status": "completed",
  "total_tokens": 52463,
  "processing_time": 344.75120878219604,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9006,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": false,
          "detectionEvidence": "The script header explicitly states: 'Select any view entity (Viewport, Section, Shopdrawing Viewport)'. The code contains logic to detect and process Viewports, Sections, and Shopdrawing Viewports (e.g., calls to getViewport, getSection, getShopdrawingViewport). It calculates view-specific coordinate systems (vecXView, vecYView, vecZView) and publishes a 'ViewProtect' submap, which are behaviors specific to Paper Space annotations within hsbCAD."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Section",
            "Shopdrawing Viewport"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space (Layouts)",
          "requiredSettings": [
            "Valid AutoCAD DimStyle",
            "References to Elements/GenBeams visible in the selected View"
          ]
        }
      },
      "tokens_used": 5453,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrPoint.goJig\",\n        \"promptOriginal\": \"|Pick point near dimline|\",\n        \"condition\": \"_bOnRecalc && _kExecuteKey==T(\\\"|Set Location|\\\")\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"PrPoint.goJig\",\n        \"promptOriginal\": \"|Pick new location|\",\n        \"condition\": \"_bOnRecalc && _kExecuteKey==T(\\\"|Set Location|\\\")\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sCatalog\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Catalog\",\n      \"defaultValue\": \"|_Default|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|_Default|\",\n        \"|_LastInserted|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"nSequence\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"Sequence\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dTextHeight\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"TextHeight\",\n      \"defaultValue\": 2.5,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sDimStyle\",\n      \"type\": \"PropString\",\n      \"displayName\": \"DimStyle\",\n      \"defaultValue\": \"Standard\",\n      \"inputType\": \"dropdown\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"nChainMode\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"ChainMode\",\n      \"defaultValue\": 1,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Continuous|\",\n        \"|Baseline|\",\n        \"|Offset|\",\n        \"|Individual|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"nDeltaMode\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"DeltaMode\",\n      \"defaultValue\": 0,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Off|\",\n        \"|Chain|\",\n        \"|Individual|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 6,\n      \"variable\": \"sReference\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Reference\",\n      \"defaultValue\": \"|byElement|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|byElement|\",\n        \"|byUser|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 7,\n      \"variable\": \"sType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Type\",\n      \"defaultValue\": \"|Beam|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Beam|\",\n        \"|Opening|\",\n        \"|TSL|\",\n        \"|Panel|\",\n        \"|Sheet|\",\n        \"|Element|\",\n        \"|GenBeam|\",\n        \"|Wirechase|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 8,\n      \"variable\": \"sSubType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"SubType\",\n      \"defaultValue\": \"|All|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 9,\n      \"variable\": \"sLayer\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Layer\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 10,\n      \"variable\": \"bShowAllViews\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"ShowAllViews\",\n      \"defaultValue\": 0,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No|\",\n        \"|Yes|\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 11,\n      \""
      },
      "tokens_used": 9765,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation and management of dimension lines in Paper Space (Layouts) for Viewports and Section views, allowing detailed annotation of timber elements like beams, panels, and openings.",
          "category": "ShopDrawing",
          "typicalUseCase": "When creating production drawings, a detailer uses this script to automatically generate dimensions for timber components shown in a specific view, ensuring consistent text height, dimension style, and avoiding overlapping text through sequence management."
        },
        "parameters": [
          {
            "name": "sCatalog",
            "technicalDefault": "|_Default|",
            "businessMeaning": "Selects a predefined set of dimensioning configurations (presets) to standardize drawing appearance across different projects or drawing types.",
            "validRange": "N/A (List of available catalogs)",
            "unit": "N/A",
            "affectsOutput": "Changes all other property settings to match the selected catalog's values (e.g., TextHeight, DimStyle, ChainMode)."
          },
          {
            "name": "nSequence",
            "technicalDefault": "0",
            "businessMeaning": "Defines the stacking order or collision priority of the dimension line relative to other annotations to prevent text overlap.",
            "validRange": "0 - 1000",
            "unit": "Integer (Priority Index)",
            "affectsOutput": "Higher values push the dimension line further away from the model or closer to other high-sequence items to maintain readability."
          },
          {
            "name": "dTextHeight",
            "technicalDefault": "2.5",
            "businessMeaning": "Sets the physical height of the dimension text on the drawing sheet.",
            "validRange": "1.5 - 5.0",
            "unit": "mm",
            "affectsOutput": "Directly scales the size of numbers and labels in the dimension line. Larger values may increase spacing requirements."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "Standard",
            "businessMeaning": "Selects the AutoCAD Dimension Style (arrowheads, text font, precision, color) used for rendering the dimension.",
            "validRange": "Any valid DimStyle in the current drawing",
            "unit": "N/A",
            "affectsOutput": "Changes the visual appearance of ticks, arrows, and text formatting of the dimension line."
          },
          {
            "name": "nChainMode",
            "technicalDefault": "1",
            "businessMeaning": "Determines how successive dimensions are arranged relative to each other.",
            "validRange": "0=Individual, 1=Continuous, 2=Baseline, 3=Offset",
            "unit": "Integer",
            "affectsOutput": "Individual: separate lines for each; Continuous: end-to-end (chain); Baseline: all measured from a common origin; Offset: spaced out individually."
          },
          {
            "name": "nDeltaMode",
            "technicalDefault": "0",
            "businessMeaning": "Controls whether the dimension displays cumulative lengths (total) or incremental lengths (differences between points).",
            "validRange": "0=Off (Total), 1=Chain (Incremental), 2=Individual (Incremental)",
            "unit": "Integer",
            "affectsOutput": "Off shows absolute position; Chain/Individual show the distance between adjacent entities (e.g., stud spacing)."
          },
          {
            "name": "sReference",
            "technicalDefault": "|byElement|",
            "businessMeaning": "Selects the strategy for calculating which points on the timber elements are dimensioned.",
            "validRange": "|byElement|, |byUser|",
            "unit": "N/A",
            "affectsOutput": "ByElement automatically finds logical points (ends, centers); ByUser allows manual selection of dimension reference points."
          },
          {
            "name": "sType",
            "technicalDefault": "|Beam|",
            "businessMeaning": "Filters the specific type of construction entity to be dimensioned within the selected view.",
            "validRange": "|Beam|, |Opening|, |TSL|, |Panel|, |Sheet|, |Element|, |GenBeam|, |Wirechase|",
            "unit": "N/A",
            "affectsOutput": "Restricts dimensioning to only the selected category (e.g., only 'Opening' dimensions will ignore structural beams)."
          },
          {
            "name": "sSubType",
            "technicalDefault": "|All|",
            "businessMeaning": "Further filters the selected entity Type (e.g., specific beam functions or opening types) to refine dimension targets.",
            "validRange": "Depends on sType (e.g., '|All|', '|Stud|', '|Rim|')",
            "unit": "N/A",
            "affectsOutput": "Narrows down the set of dimensioned entities to specific sub-categories."
          },
          {
            "name": "sLayer",
            "technicalDefault": "",
            "businessMeaning": "Assigns the dimension geometry to a specific CAD layer for layer-based control of visibility and plotting.",
            "validRange": "Any valid layer name",
            "unit": "N/A",
            "affectsOutput": "Moves the generated dimension lines and text to the specified layer."
          },
          {
            "name": "bShowAllViews",
            "technicalDefault": "0",
            "businessMeaning": "Determines if the dimensions apply to the currently selected view only or propagate to all similar views in the layout.",
            "validRange": "0=No, 1=Yes",
            "unit": "Boolean",
            "affectsOutput": "If Yes, creates dimensions in multiple viewports simultaneously; if No, only the active viewport is annotated."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sCatalog is changed",
            "effect": "Overwrites other properties",
            "cascade": [
              "dTextHeight",
              "sDimStyle",
              "nChainMode",
              "nDeltaMode",
              "sType",
              "sSubType",
              "sLayer"
            ]
          },
          {
            "trigger": "sType is set to |Opening|",
            "effect": "Adjusts valid SubType options",
            "cascade": [
              "sSubType"
            ]
          },
          {
            "trigger": "nSequence is increased",
            "effect": "Adjusts collision detection priority",
            "cascade": [
              "ViewProtect submap"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "DimensionLine",
            "description": "Standard AutoCAD dimension entities (aligned, linear, or angular) representing sizes of timber components.",
            "appliedTo": "Paper Space (Layouts) relative to Viewport content."
          },
          {
            "type": "ViewProtect Region",
            "description": "Invisible collision zones that prevent other dimensions or annotations from overlapping the current dimension line.",
            "appliedTo": "Paper Space surrounding the dimension line."
          }
        ]
      },
      "tokens_used": 9550,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User launches script (hsbViewDimension).",
          "2. Command line prompts: '|Pick point near dimline|'.",
          "3. User clicks in Paper Space (within a Viewport, Section, or Shopdrawing Viewport).",
          "4. Script detects the active View entity and establishes the view coordinate system (vecXView, vecYView, vecZView).",
          "5. Script filters entities in the view based on 'sType', 'sSubType', and 'sLayer' properties.",
          "6. [Branch] Reference Mode Check:",
          "   - If 'sReference' is '|byElement|': Script automatically calculates reference points for detected entities.",
          "   - If 'sReference' is '|byUser|': Script waits for user interaction (grips/selection) to define points.",
          "7. Script generates dimension geometry based on 'nChainMode' and 'nDeltaMode'.",
          "8. Script draws AutoCAD Dimension entities in Paper Space.",
          "9. Script calculates collision protection zone and publishes 'ViewProtect' submap."
        ],
        "conditionalBranches": [
          {
            "condition": "User Right-Click Context Menu Selection",
            "path1": {
              "name": "Set Location",
              "steps": [
                "Trigger '|Set Location|' fires.",
                "Jig starts (JigAction).",
                "User picks point near existing dimension line.",
                "Visual feedback shows connection line.",
                "User picks new target point.",
                "Script updates 'CustomLocation[]' map with new coordinate.",
                "Instance recalculates."
              ]
            },
            "path2": {
              "name": "Swap Delta/Chain",
              "steps": [
                "Trigger '|Swap Delta/Chain|' fires.",
                "Script toggles 'SwapDeltaChain' boolean in map.",
                "Dimension display switches between cumulative (Chain) and incremental (Delta) lengths.",
                "Instance recalculates."
              ]
            },
            "path3": {
              "name": "Add/Remove Entities (Grip Edit)",
              "steps": [
                "User interacts with grips (_PtG).",
                "Script calculates 'vecAdd[]' or 'vecRemoval[]' based on new grip positions.",
                "If all custom points are removed, 'sReference' automatically reverts to '|byElement|'.",
                "Script updates internal point maps.",
                "Instance recalculates."
              ]
            }
          },
          {
            "condition": "Catalog Property Change",
            "path1": {
              "name": "Catalog Selected",
              "steps": [
                "User selects a specific Catalog entry.",
                "Script overwrites current properties (TextHeight, DimStyle, ChainMode, etc.) with catalog presets.",
                "Dimension style updates to match the catalog."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Valid Viewport/Section Detection",
            "errorMessage": "None explicitly visible (Script typically fails silently or creates empty instance if no view is found at picked point).",
            "recovery": "Ensure pick point is strictly inside a valid Viewport or Section viewport in Paper Space."
          },
          {
            "check": "Entity Availability",
            "errorMessage": "No dimension entities generated.",
            "recovery": "Change 'sType' or 'sSubType' to match entities present in the model view, or check visibility/layer settings."
          },
          {
            "check": "DimStyle Existence",
            "errorMessage": "Dimension rendering fails or defaults to Standard.",
            "recovery": "Ensure the 'sDimStyle' string matches an existing DimStyle in the current AutoCAD drawing."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Dimension Line",
            "how": "Right-click context menu -> '|Set Location|'",
            "effect": "Invokes a jig to interactively drag the dimension line to a new position while maintaining connection to the model."
          },
          {
            "action": "Toggle Measurement Type",
            "how": "Right-click context menu -> '|Swap Delta/Chain|'",
            "effect": "Switches dimension text between showing total run length (Chain) and individual segment spacing (Delta)."
          },
          {
            "action": "Modify Configuration",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Updating properties like 'dTextHeight', 'nSequence', or 'sDimStyle' immediately regenerates the dimension appearance."
          },
          {
            "action": "Reset Custom Locations",
            "how": "Right-click context menu -> '|Reset locations of all elements|'",
            "effect": "Clears all manually moved dimension lines and reverts them to their automatically calculated positions."
          },
          {
            "action": "Filter Dimensioned Entities",
            "how": "Grip Edits (implied by Add/Remove logic)",
            "effect": "Modifying the grips (_PtG) adds or removes specific reference points from the dimension set."
          }
        ]
      },
      "tokens_used": 11502,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbViewDimension.mcr\n\n## Overview\nAutomates the creation and management of dimension lines in Paper Space (Layouts) for hsbCAD viewports. It allows detailed annotation of timber elements like beams, panels, and openings with automatic collision management and style standardization.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for Paper Space annotations. |\n| Paper Space | Yes | Selects Viewports, Sections, or Shopdrawing Viewports. |\n| Shop Drawing | Yes | Optimized for production drawings and detailing. |\n\n## Prerequisites\n- **Required Entities**: A Viewport, Section, or Shopdrawing Viewport must exist in the Layout.\n- **Visible Elements**: The selected view must contain visible timber elements (Beams, Panels, etc.) to dimension.\n- **Required Settings**: A valid AutoCAD DimStyle (e.g., \"Standard\") must exist in the drawing.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbViewDimension.mcr` from the list.\n\n### Step 2: Select Location\n```\nCommand Line: |Pick point near dimline|\nAction: Click in Paper Space inside or near the Viewport/Section you wish to dimension.\n```\nThe script will automatically detect the view boundaries and place the dimension line based on the current default properties.\n\n### Step 3: Adjust Properties (Optional)\nAfter insertion, select the dimension instance and open the **Properties Palette** (Ctrl+1) to change the dimension style, text height, or filter specific elements (e.g., change from Beam to Opening).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Catalog | dropdown | `_Default` | Selects a predefined configuration preset to standardize dimension settings. |\n| Sequence | number | 0 | Determines the stacking order (priority) to prevent overlapping text with other dimensions. Higher values push the dimension further out. |\n| TextHeight | number | 2.5 | Sets the height of the dimension text in mm. |\n| DimStyle | string | Standard | The AutoCAD Dimension Style used for arrows, text font, and color. |\n| ChainMode | dropdown | Continuous | Arranges successive dimensions: `Continuous`, `Baseline`, `Offset`, or `Individual`. |\n| DeltaMode | dropdown | Off | Controls dimension logic: `Off` (Total length), `Chain` (Incremental spacing), or `Individual` (Incremental spacing). |\n| Reference | dropdown | byElement | `byElement` auto-calculates points; `byUser` allows manual selection of reference points. |\n| Type | dropdown | Beam | Filters the entity type to dimension (e.g., Beam, Opening, Panel, TSL). |\n| SubType | dropdown | All | Further filters the selected Type (e.g., specific wall functions or opening types). |\n| Layer | text | [Empty] | Assigns the dimension geometry to a specific CAD layer. |\n| ShowAllViews | dropdown | No | If `Yes`, applies the dimensioning logic to all similar views in the layout. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Set Location | Invokes a jig to interactively drag the dimension line to a new position while maintaining its connection to the model. |\n| Swap Delta/Chain | Toggles the dimension text between showing total run length (Chain) and individual segment spacing (Delta). |\n| Reset locations of all elements | Clears all manually moved dimension lines and reverts them to their automatically calculated positions. |\n\n## Settings Files\n- **Catalog Data**: Uses internal catalogs (`_Default` or `_LastInserted`) to store property presets.\n- **Location**: Defined by the `sCatalog` property mapping within the hsbCAD environment.\n\n## Tips\n- **Avoid Overlapping**: Increase the `Sequence` value if your dimension text overlaps with other annotations or dimensions. This pushes the dimension line outward automatically.\n- **Stud Spacing**: Use the `Swap Delta/Chain` right-click option to quickly toggle between overall wall length and individual stud spacing measurements.\n- **Layer Control**: Leave the `Layer` property empty to use the current layer, or specify a layer (e.g., \"D-ANNO-DIMS\") to isolate dimensions for plotting.\n\n## FAQ\n- **Q: No dimensions appeared when I inserted the script.**\n  - **A:** Check the `Type` property in the Properties Palette. If set to \"Opening\" but there are no openings in the view, nothing will generate. Ensure the view contains the type of elements selected.\n- **Q: The dimension text is too small to read.**\n  - **A:** Increase the `TextHeight` property in the Properties Palette.\n- **Q: I cannot see the dimension line after moving it.**\n  - **A:** It may have been moved into an area restricted by `ViewProtect` or another dimension. Try the \"Reset locations of all elements\" right-click option to start over."
      },
      "tokens_used": 7187,
      "error": null
    }
  }
}