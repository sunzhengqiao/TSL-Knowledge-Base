{
  "filename": "sd_ModelTslCreator.mcr",
  "status": "completed",
  "total_tokens": 29978,
  "processing_time": 507.13260984420776,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "26.04.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-15328 inital version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4543,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "The script explicitly checks Viewport().inLayoutTab() and Viewport().inPaperSpace(). It collects entities of type ShopDrawView() within _kMySpace. It contains an _bOnGenerateShopDrawing block which uses dbCreate to generate TSL instances. The header comments mention 'Fire the command in block space of a multipage'."
        },
        "prerequisites": {
          "requiredEntities": [
            "ShopDrawView"
          ],
          "minimumBeams": 0,
          "requiredSpace": "The script must be inserted in the block definition of a multipage containing at least one shopdraw viewport.",
          "requiredSettings": []
        }
      },
      "tokens_used": 2653,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "|Pick pint to place setup info|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "OPM Properties (sScript, sEntry)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sScript",
            "type": "PropString",
            "displayName": "|Script|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "List of scripts starting with 'sdMS_'",
              "DrillPatternDimension"
            ],
            "category": "|General|",
            "description": "|Defines the Script|"
          },
          {
            "index": 1,
            "variable": "sEntry",
            "type": "PropString",
            "displayName": "|Catalog Entry|",
            "defaultValue": "|_Default|",
            "inputType": "dropdown",
            "options": [
              "Catalog entries for the selected Script"
            ],
            "category": "|General|",
            "description": "|Defines the catalog name to specify the property values|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5552,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Acts as a configuration tool to automatically generate specific TSL instances (such as dimensions or markers) in Model Space when a Shop Drawing is generated.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used in multipage setups to automatically add drill pattern dimensions or other specific annotations to the 3D model automatically when a manufacturing drawing is created."
        },
        "parameters": [
          {
            "name": "sScript",
            "technicalDefault": "null (first item in dynamic list)",
            "businessMeaning": "Selects the specific TSL script (tool) to be executed in the model during the shop drawing generation process.",
            "validRange": "List of installed scripts starting with 'sdMS_' or the specific script 'DrillPatternDimension'.",
            "unit": "N/A",
            "affectsOutput": "Determines which type of geometry or annotation is generated (e.g., creates dimensions if 'DrillPatternDimension' is selected)."
          },
          {
            "name": "sEntry",
            "technicalDefault": "|_Default|",
            "businessMeaning": "Selects the specific catalog preset (configuration) that defines the properties (size, layer, style) for the selected script.",
            "validRange": "Valid catalog entries associated with the selected sScript.",
            "unit": "N/A",
            "affectsOutput": "Modifies the specific parameters (visual style, measurement rules) of the generated entity."
          },
          {
            "name": "_Pt0",
            "technicalDefault": "User selected point",
            "businessMeaning": "The reference location in the Paper Space layout where the script's configuration label is drawn and serves as the anchor point for generation.",
            "validRange": "Any 3D coordinate within the Paper Space block definition.",
            "unit": "mm",
            "affectsOutput": "Defines the position of the text label in the layout and potentially the insertion origin of the generated model-space TSL."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Selection of sScript",
            "effect": "Updates the available options in the Catalog Entry list to match the chosen script.",
            "cascade": [
              "sEntry"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TSL Instance",
            "description": "An instance of the user-defined script (e.g., DrillPatternDimension) created in the Model Space of the element being detailed.",
            "appliedTo": "The Model Space of the element associated with the ShopDrawView detected in the multipage."
          }
        ]
      },
      "tokens_used": 5745,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Insertion Command Initiated",
          "2. Validate Environment (Check if in Multipage Block Space with ShopDrawViews)",
          "3. [Conditional] Check Execution Mode (Silent Key vs. Interactive)",
          "4. [Conditional] Configure Script and Catalog Entries",
          "5. User selects placement point for setup info (_Pt0)",
          "6. Instance created in Paper Space (Configuration Object)",
          "7. [Deferred Event] Shop Drawing Generated",
          "8. Check map state to prevent duplicate creation",
          "9. Create Target TSL Instance in Model Space using dbCreate",
          "10. Update Map state to confirm creation"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase current instance",
                "Return immediately"
              ]
            },
            "path2": {
              "name": "Cycle <= 1",
              "steps": [
                "Proceed to Environment Validation"
              ]
            }
          },
          {
            "condition": "Environment Validation (Viewport and ShopDrawView existence)",
            "path1": {
              "name": "Invalid Environment",
              "steps": [
                "Display Error Notice: 'Tool will not be inserted'",
                "Erase Instance",
                "Return"
              ]
            },
            "path2": {
              "name": "Valid Environment",
              "steps": [
                "Proceed to Property Input"
              ]
            }
          },
          {
            "condition": "Execution Source (_kExecuteKey presence)",
            "path1": {
              "name": "Silent Mode (_kExecuteKey exists)",
              "steps": [
                "Attempt to set properties from specific catalog key",
                "Fallback to '_LastInserted' if key not found",
                "Skip to Point Input"
              ]
            },
            "path2": {
              "name": "Interactive Mode (Standard)",
              "steps": [
                "Show initial Dialog (Script Selection)",
                "Check Script Count"
              ]
            }
          },
          {
            "condition": "Number of Available Scripts (scriptNames.length)",
            "path1": {
              "name": "Multiple Scripts Available (>1)",
              "steps": [
                "Set 'Script' property to ReadOnly",
                "Refresh 'Catalog Entry' list based on selected Script",
                "Show second Dialog for Catalog Entry selection",
                "Proceed to Point Input"
              ]
            },
            "path2": {
              "name": "Single/No Script Available",
              "steps": [
                "Proceed to Point Input"
              ]
            }
          },
          {
            "condition": "Shop Drawing Generation Status",
            "path1": {
              "name": "_bOnGenerateShopDrawing is True",
              "steps": [
                "Check if TSL already created via Map",
                "If not created, execute dbCreate for target Script",
                "Update Map flag"
              ]
            },
            "path2": {
              "name": "_bOnGenerateShopDrawing is False",
              "steps": [
                "Draw visual reference text in Paper Space",
                "Display configured Script and Entry name"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Current Space and Content",
            "errorMessage": "can only be inserted in the block definition of a multipage with at least one shopdraw viewport.",
            "recovery": "User must navigate to the correct Paper Space block definition containing ShopDrawView entities."
          },
          {
            "check": "Insertion Cycle",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script handles this internally by erasing the duplicate instance."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Configuration",
            "how": "OPM Properties Palette",
            "effect": "Changing 'sScript' or 'sEntry' updates the internal logic, so the next Shop Drawing generation will use the new settings. The visual label in Paper Space updates immediately."
          },
          {
            "action": "Relocate Label",
            "how": "Grip Edit (Point _Pt0)",
            "effect": "Moves the position of the text label in the layout. Note: This point is also passed as ptsTsl to dbCreate, potentially affecting insertion point of the generated model space TSL."
          }
        ]
      },
      "tokens_used": 5909,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# sd_ModelTslCreator.mcr\n\n## Overview\nThis script serves as a configuration anchor within a multipage layout block. It automatically generates specified TSL instances (such as drill pattern dimensions) in Model Space whenever a shop drawing is generated.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No (Output Only) | The script inserts into Paper Space but generates geometry into Model Space. |\n| Paper Space | Yes | Specifically inside the block definition of a Multipage. |\n| Shop Drawing | Yes | The script triggers specifically during shop drawing generation. |\n\n## Prerequisites\n- **Required Entities:** The multipage block must contain at least one `ShopDrawView` (shopdrawing viewport).\n- **Minimum Beam Count:** 0.\n- **Required Settings:** A valid Catalog entry for the selected target script.\n\n## Usage Steps\n\n### Step 1: Enter Multipage Block\nAction: Right-click on the multipage layout border and select \"Block Editor\" or use the `BEDIT` command to open the block definition containing the shop drawing viewports.\n\n### Step 2: Insert Script\nCommand: `TSLINSERT` â†’ Select `sd_ModelTslCreator.mcr`\n\n### Step 3: Select Placement Point\n```\nCommand Line: |Pick point to place setup info|\nAction: Click a location in the layout to place the configuration label.\n```\n*Note: This point defines where the setup text is displayed in the layout.*\n\n### Step 4: Configure Properties\nAction: With the script instance selected, open the **Properties Palette** (Ctrl+1).\n1.  **Script**: Select the tool you want to run (e.g., `DrillPatternDimension`).\n2.  **Catalog Entry**: Select the specific preset configuration for that tool.\n\n### Step 5: Generate Shop Drawing\nAction: Close the block editor and generate the shop drawing. The script will automatically create the selected geometry (e.g., dimensions) in the 3D model.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Script | Dropdown | (First available) | Selects the TSL tool to execute in the model (e.g., DrillPatternDimension). Options include scripts starting with 'sdMS_'. |\n| Catalog Entry | Dropdown | _Default | Selects the preset configuration from the catalog that defines the properties (size, layer, etc.) for the selected script. |\n\n## Right-Click Menu Options\n*(No custom context menu options defined for this script)*\n\n## Settings Files\n*(No specific settings file defined for this script; it relies on catalogs associated with the target scripts)*\n\n## Tips\n- **Error Handling:** If you see a message \"Tool will not be inserted,\" ensure you are editing the block definition of a multipage that contains shop drawing viewports.\n- **Visual Feedback:** A text label appears in the layout showing the selected Script and Entry. You can move this label using its grip point.\n- **Updates:** You can change the 'Script' or 'Catalog Entry' properties at any time. The changes will apply the next time the shop drawing is generated.\n\n## FAQ\n- **Q: I inserted the script, but I don't see any dimensions in the model?**\n  **A:** This script works during the shop drawing generation process. You must generate the shop drawing for the script to create the model space entities.\n- **Q: Where should I insert this script?**\n  **A:** It must be inserted inside the block definition of the multipage layout, not directly in the main drawing Paper Space.\n- **Q: What does the \"Pick point\" do?**\n  **A:** It determines where the text label is drawn in your layout to show you which configuration is active."
      },
      "tokens_used": 5576,
      "error": null
    }
  }
}