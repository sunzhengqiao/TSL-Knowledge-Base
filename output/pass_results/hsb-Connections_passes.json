{
  "filename": "hsb-Connections.mcr",
  "status": "completed",
  "total_tokens": 56002,
  "processing_time": 429.5739018917084,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": 1,\n    \"minorVersion\": 13,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.00\",\n      \"date\": \"31.03.2011\",\n      \"author\": \"\",\n      \"changes\": \"Pilot version\"\n    },\n    {\n      \"version\": \"1.01\",\n      \"date\": \"07.04.2011\",\n      \"author\": \"\",\n      \"changes\": \"Staggered blocking (hsbID == 1112) always have connection code E\"\n    },\n    {\n      \"version\": \"1.02\",\n      \"date\": \"20.04.2011\",\n      \"author\": \"\",\n      \"changes\": \"Add support for angled connections\"\n    },\n    {\n      \"version\": \"1.03\",\n      \"date\": \"26.04.2011\",\n      \"author\": \"\",\n      \"changes\": \"Renamed a prop in FFB-SteelTool\"\n    },\n    {\n      \"version\": \"1.04\",\n      \"date\": \"26.04.2011\",\n      \"author\": \"\",\n      \"changes\": \"Re\"\n    },\n    {\n      \"version\": \"1.05\",\n      \"date\": \"01.07.2011\",\n      \"author\": \"\",\n      \"changes\": \"Check if created tsl is valid.\"\n    },\n    {\n      \"version\": \"1.06\",\n      \"date\": \"08.11.2011\",\n      \"author\": \"\",\n      \"changes\": \"Increase tollerance\"\n    },\n    {\n      \"version\": \"1.07\",\n      \"date\": \"05.04.2012\",\n      \"author\": \"\",\n      \"changes\": \"Add PS to list of codes for invalid beams\"\n    },\n    {\n      \"version\": \"1.08\",\n      \"date\": \"06.04.2012\",\n      \"author\": \"\",\n      \"changes\": \"Cornerconnection always has angled beam as female.\"\n    },\n    {\n      \"version\": \"1.09\",\n      \"date\": \"08.06.2012\",\n      \"author\": \"\",\n      \"changes\": \"Add property to make connections squared\"\n    },\n    {\n      \"version\": \"1.10\",\n      \"date\": \"22.01.2013\",\n      \"author\": \"\",\n      \"changes\": \"Add hsbID for fixed E connecction\"\n    },\n    {\n      \"version\": \"1.11\",\n      \"date\": \"14.02.2014\",\n      \"author\": \"\",\n      \"changes\": \"Add option to make only male or female squared\"\n    },\n    {\n      \"version\": \"1.12\",\n      \"date\": \"07.01.2016\",\n      \"author\": \"\",\n      \"changes\": \"Catalogs for different connection types can now be set through properties."
      },
      "tokens_used": 9121,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of '_kModelSpace' argument within tsl.dbCreate(). The script performs 3D geometric calculations using envelopeBody() and intersectPoints() on Beams and Elements to detect connections. No 'sd_' prefixes, '_Viewport' references, or shopdrawing specific entities were found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": [
            "Script 'hsb-SteelTool' (or variants SFT-SteelTool/FFB-SteelTool)",
            "Catalog entries for connection types (Corner, X, T, etc.)"
          ]
        }
      },
      "tokens_used": 7629,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": \"\",\n        \"condition\": \"_bOnInsert && _kExecuteKey == \\\"\\\"\",\n        \"required\": false\n      },\n      {\n        \"step\": 2,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Select a set of elements\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"ShowDialog\",\n      \"trigger\": \"On Insert\",\n      \""
      },
      "tokens_used": 10615,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the batch detection and generation of structural steel connections between timber beams based on geometric intersection rules (Corner, T, X, Angled, etc.) within a selected Element.",
          "category": "Hardware/Connection",
          "typicalUseCase": "Used to quickly apply steel plates, bolts, or angles to an entire wall or roof element. The user selects an element, previews where connections will be generated, and then finalizes the creation of the specific hardware sub-scripts."
        },
        "parameters": [
          {
            "name": "sPreviewMode",
            "technicalDefault": "Enabled",
            "businessMeaning": "Toggles the script between a visual preview state (showing connection types/locations) and a production state (actually creating the steel connection TSLs).",
            "validRange": "Enabled, Disabled",
            "unit": "state",
            "affectsOutput": "If 'Enabled', the script only draws text labels and erases itself. If 'Disabled', it spawns instances of 'hsb-SteelTool' at connection points, which then generate the actual geometry and machining."
          },
          {
            "name": "sMakeSquared",
            "technicalDefault": "Do not make square",
            "businessMeaning": "Controls how angled beam ends are handled at connections, allowing specific logic to force square cuts (90 degrees to the beam axis) where the geometry might otherwise be angled or skewed.",
            "validRange": "Do not make square, Only male, Only female, Make both square",
            "unit": "logic",
            "affectsOutput": "Modifies the end-cut geometry of the timber beams (squaring them) before the connection tool is applied."
          },
          {
            "name": "catalogNameCornerConnections",
            "technicalDefault": "<hsb-SteelTool Default>",
            "businessMeaning": "Selects the specific catalog preset (material, sizes, drill patterns) to use for standard 90-degree corner connections.",
            "validRange": "Any catalog entry available in hsb-SteelTool",
            "unit": "catalog name",
            "affectsOutput": "Determines the geometry and properties of the steel plate/angle used at corners."
          },
          {
            "name": "catalogNameXConnections",
            "technicalDefault": "<hsb-SteelTool Default>",
            "businessMeaning": "Selects the catalog preset for cross connections where one beam runs completely through another (passing through).",
            "validRange": "Any catalog entry available in hsb-SteelTool",
            "unit": "catalog name",
            "affectsOutput": "Determines the hardware for crossing beams (e.g., through bolts or plates)."
          },
          {
            "name": "catalogNameTConnectionsWithVerticalMale",
            "technicalDefault": "<hsb-SteelTool Default>",
            "businessMeaning": "Selects the catalog preset for T-connections where a vertical beam (column) meets a horizontal beam (vertical is the 'male' penetrating the horizontal 'female').",
            "validRange": "Any catalog entry available in hsb-SteelTool",
            "unit": "catalog name",
            "affectsOutput": "Sets the hardware for column-to-beam T-joints."
          },
          {
            "name": "catalogNameTConnectionsWithHorizontalMale",
            "technicalDefault": "<hsb-SteelTool Default>",
            "businessMeaning": "Selects the catalog preset for T-connections where a horizontal beam meets another beam (e.g., a joist hanger or splice plate).",
            "validRange": "Any catalog entry available in hsb-SteelTool",
            "unit": "catalog name",
            "affectsOutput": "Sets the hardware for beam-to-beam T-joints."
          },
          {
            "name": "catalogNameBackConnections",
            "technicalDefault": "<hsb-SteelTool Default>",
            "businessMeaning": "Selects the catalog preset for connections where the male beam enters the female beam from the web side (side connection) rather than the end.",
            "validRange": "Any catalog entry available in hsb-SteelTool",
            "unit": "catalog name",
            "affectsOutput": "Defines hardware for side-plates or similar lateral connections."
          },
          {
            "name": "catalogNameAngledCornerConnections",
            "technicalDefault": "<hsb-SteelTool Default>",
            "businessMeaning": "Selects the catalog preset for corner connections where the beams meet at a non-90-degree angle.",
            "validRange": "Any catalog entry available in hsb-SteelTool",
            "unit": "catalog name",
            "affectsOutput": "Defines hardware for angled corners (e.g., skew plates)."
          },
          {
            "name": "catalogNameAngledTConnections",
            "technicalDefault": "<hsb-SteelTool Default>",
            "businessMeaning": "Selects the catalog preset for T-connections involving angled beams (generic).",
            "validRange": "Any catalog entry available in hsb-SteelTool",
            "unit": "catalog name",
            "affectsOutput": "Defines hardware for generic angled T-joints."
          },
          {
            "name": "catalogNameAngledTConnectionsWithVerticalMale",
            "technicalDefault": "<hsb-SteelTool Default>",
            "businessMeaning": "Selects the catalog preset for T-connections where a vertical column meets an angled beam.",
            "validRange": "Any catalog entry available in hsb-SteelTool",
            "unit": "catalog name",
            "affectsOutput": "Defines hardware for rafter-to-column or similar angled connections."
          },
          {
            "name": "catalogNameAngledTConnectionsWithHorizontalMale",
            "technicalDefault": "<hsb-SteelTool Default>",
            "businessMeaning": "Selects the catalog preset for T-connections where a horizontal beam meets an angled beam.",
            "validRange": "Any catalog entry available in hsb-SteelTool",
            "unit": "catalog name",
            "affectsOutput": "Defines hardware for purlin-to-rafter or similar connections."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Insertion of script",
            "effect": "Creates 'MasterToSatellite' flag to propagate properties from this master script to the generated connection instances.",
            "cascade": [
              "hsb-SteelTool instances"
            ]
          },
          {
            "trigger": "Context menu 'End preview mode'",
            "effect": "Switches PreviewMode to Disabled and forces generation of connection entities.",
            "cascade": [
              "hsb-SteelTool instances",
              "sPreviewMode"
            ]
          },
          {
            "trigger": "Geometric Analysis (Beam Orientation)",
            "effect": "Determines which Catalog property to use (e.g., Vertical vs Horizontal T-connection).",
            "cascade": [
              "catalogNameTConnectionsWithVerticalMale",
              "catalogNameTConnectionsWithHorizontalMale",
              "catalogNameAngledCornerConnections"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TslInst (hsb-SteelTool)",
            "description": "Instances of the steel connection tool that generate metal plates, bolts, and machining.",
            "appliedTo": "Pairs of GenBeams intersecting within the selected Element."
          },
          {
            "type": "Visual Preview (Text)",
            "description": "Text labels drawn in 3D space indicating the connection type (e.g., 'Tm', 'X', 'G') selected.",
            "appliedTo": "Model Space at the intersection points."
          }
        ]
      },
      "tokens_used": 9400,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. User launches script command\",\n    \"2. Check insert cycle count (Safety check for duplicate execution)\",\n    \"3. Show configuration dialog (if executing from command line)\",\n    \"4. Prompt user to select elements (PrEntity)\",\n    \"5. [Branch] Selection Verification\",\n    \"6. If selected: Remove existing connection scripts ('hsb-Connections', 'hsb-SteelTool', variants) from element\",\n    \"7. Create 'Master' instance of hsb-Connections attached to the selected element\",\n    \"8. 'Master' instance synchronizes properties from the temporary insert instance\",\n    \"9. 'Master' instance retrieves beams from element and filters out invalid profiles/codes\",\n    \"10. Classify beams into Vertical, Horizontal, and Angled lists\",\n    \"11. Analyze intersections (Vertical vs All, then Angled vs All) to determine connection types (Corner, T, X)\",\n    \"12. [Branch] Check Execution Mode (Preview vs Production)\",\n    \"13. If Preview Mode: Draw text labels (e.g., 'Tm', 'G') at connection points\",\n    \"14. If Production Mode: Generate 'hsb-SteelTool' instances for each valid connection\",\n    \"15. If Production Mode: Erase 'Master' instance from drawing\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Insertion Safety Check (insertCycleCount)\",\n      \"path1\": {\n        \"name\": \"Cycle > 1\",\n        \"steps\": [\n          \"Erase current instance immediately\",\n          \"Return (Exit)\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Cycle == 1\",\n        \"steps\": [\n          \"Proceed to Dialog/Selection\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Element Selection (ssE.go())\",\n      \"path1\": {\n        \"name\": \"User selects elements\",\n        \"steps\": [\n          \"Iterate through selected elements\",\n          \"Clean up old TSLs on elements\",\n          \"Create new Master instances\",\n          \"Erase insert instance\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"User cancels/escapes\",\n        \"steps\": [\n          \"Erase insert instance\",\n          \"Exit without changes\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Execution Mode (sPreviewMode / Context Trigger)\",\n      \"path1\": {\n        \"name\": \"Preview Mode (Enabled)\",\n        \"steps\": [\n          \"Set nPreviewMode = Yes\",\n          \"Analyze geometry\",\n          \"Draw text labels indicating connection types and catalog keys\",\n          \"Keep Master instance in drawing\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Production Mode (Disabled)\",\n        \"steps\": [\n          \"Set nPreviewMode = No\",\n          \"Analyze geometry\",\n          \"Instantiate 'hsb-SteelTool' scripts at connection points\",\n          \"Apply specific catalog properties to each tool\",\n          \"Erase Master instance\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Geometric Classification\",\n      \"path1\": {\n        \"name\": \"Beam is Angled\",\n        \"steps\": [\n          \"Use Angled Catalogs (e.g., catalogNameAngledCornerConnections)\",\n          \"Calculate intersection using vector planes\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Beam is Vertical or Horizontal\",\n        \"steps\": [\n          \"Use Standard Catalogs (e.g., catalogNameCornerConnections)\",\n          \"Calculate intersection based on bounding box logic\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Beam Profile\",\n      \"errorMessage\": \"None (Silent exclusion)\",\n      \"recovery\": \"Beams with 'Rectangular' extrusion profile are automatically skipped.\"\n    },\n    {\n      \"check\": \"Beam Code\",\n      \"errorMessage\": \"None (Silent exclusion)\",\n      \"recovery\": \""
      },
      "tokens_used": 11985,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb-Connections.mcr\n\n## Overview\nThis script automates the batch detection and generation of structural steel connections between timber beams within a selected Element. It analyzes geometric intersections to apply specific steel tools (like plates or angles) based on connection types (Corner, T, X, etc.).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Calculates geometry based on 3D beam intersections. |\n| Paper Space | No | Not designed for 2D layouts. |\n| Shop Drawing | No | This is a model generation script, not a detailing tool. |\n\n## Prerequisites\n- **Required Entities**: Element and GenBeams (Timber beams).\n- **Minimum Beam Count**: 0 (Though intersecting beams are required to create connections).\n- **Required Settings**: \n  - The script `hsb-SteelTool` (or variants like SFT-SteelTool/FFB-SteelTool) must be installed.\n  - Valid catalog entries within hsb-SteelTool for various connection types (Corner, X, T, Angled).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT`\n**Action:** Select `hsb-Connections.mcr` from the file browser.\n\n### Step 2: Configuration (Optional)\n**Action:** If running the script for the first time or if triggered, a configuration dialog may appear. Select the desired catalogs for different connection types. You can also modify these later in the Properties Palette.\n\n### Step 3: Select Element\n```\nCommand Line: Select a set of elements\nAction: Click on the Element (e.g., a wall or roof plane) containing the beams you want to process. Press Enter to confirm selection.\n```\n\n### Step 4: Preview or Generate\n**Action:** \n- By default, the script runs in **Preview Mode**. It will draw text labels (e.g., \"Tm\", \"X\", \"G\") at connection points to show you where connections will be made.\n- To generate the actual steel connections, select the script instance in the model, open the **Properties Palette**, and change `sPreviewMode` to \"Disabled\", or use the Right-Click menu option described below.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sPreviewMode | Dropdown | Enabled | **Enabled**: Shows only text labels for connections. **Disabled**: Generates actual steel connection tools. |\n| sMakeSquared | Dropdown | Do not make square | Controls if angled beam ends are forced to be square cuts (90Â°). Options: Do not make square, Only male, Only female, Make both square. |\n| catalogNameCornerConnections | String | <hsb-SteelTool Default> | The catalog preset used for standard 90-degree corner connections. |\n| catalogNameXConnections | String | <hsb-SteelTool Default> | The catalog preset used for cross connections where one beam passes through another. |\n| catalogNameTConnectionsWithVerticalMale | String | <hsb-SteelTool Default> | The catalog preset for T-connections where a vertical beam (column) meets a horizontal beam. |\n| catalogNameTConnectionsWithHorizontalMale | String | <hsb-SteelTool Default> | The catalog preset for T-connections between horizontal beams (e.g., joist to beam). |\n| catalogNameBackConnections | String | <hsb-SteelTool Default> | The catalog preset for connections entering from the web/side of a beam. |\n| catalogNameAngledCornerConnections | String | <hsb-SteelTool Default> | The catalog preset for corners where beams meet at an angle other than 90 degrees. |\n| catalogNameAngledTConnections | String | <hsb-SteelTool Default> | The catalog preset for generic angled T-connections. |\n| catalogNameAngledTConnectionsWithVerticalMale | String | <hsb-SteelTool Default> | The catalog preset for T-connections with a vertical column meeting an angled beam. |\n| catalogNameAngledTConnectionsWithHorizontalMale | String | <hsb-SteelTool Default> | The catalog preset for T-connections with a horizontal beam meeting an angled beam. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| End preview mode | Switches the script from Preview Mode to Production Mode. This generates the actual `hsb-SteelTool` instances and removes the temporary preview labels. |\n\n## Settings Files\n- **Catalog Entries**: Defined within the `hsb-SteelTool` (or SFT/FFB variant) configuration.\n- **Location**: Usually stored in the company folder or hsbCAD installation directory.\n- **Purpose**: These files contain the geometric and material data (plate sizes, bolt patterns) used by the generated connection tools.\n\n## Tips\n- **Verify Connections First**: Always run the script in `Preview Mode` (Enabled) first. Check the text labels to ensure the script has correctly identified the connection types (Corner vs. T vs. X) before generating the heavy 3D steel geometry.\n- **Beam Filtering**: The script automatically filters out beams with specific profiles or connection codes (like \"PS\") that are designated as invalid.\n- **Grouping**: This script processes entire Elements at once. It is efficient for applying connections to whole walls or roof panels rather than single beams.\n\n## FAQ\n- **Q: I ran the script, but I don't see any steel plates.**\n- A: Check the `sPreviewMode` property. If it is set to \"Enabled\", the script only draws text labels. Change it to \"Disabled\" or use the \"End preview mode\" right-click option.\n- **Q: Some connections are missing.**\n- A: Ensure your beams are actually intersecting within the Element. The script also ignores beams marked as \"Rectangular\" profiles or with specific excluded connection codes.\n- **Q: How do I change the size of the steel plates?**\n- A: You do not change this directly in `hsb-Connections`. Instead, modify the specific Catalog Name properties (e.g., `catalogNameCornerConnections`) to point to a different catalog preset defined in `hsb-SteelTool`."
      },
      "tokens_used": 7252,
      "error": null
    }
  }
}