{
  "filename": "hsb_OverwriteTConnection.mcr",
  "status": "completed",
  "total_tokens": 30557,
  "processing_time": 283.0298082828522,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "06.10.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6281,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select ElementWallSF in the 3D model, manipulates Beam entities using geometric operations (CoordSys, Vector3d), and instantiates another TSL script ('hsb_Wall to Wall Connection') directly into the database. There are no references to ShopDrawing (#Type E), Paper Space specific classes (_Viewport, _kPaperSpace), or sd_* prefixes."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing at least two connected wall elements.",
          "requiredSettings": [
            "Map entry 'Catalog' (optional, for _kExecuteKey)",
            "Map entry 'Wall' (optional, used to filter connections)",
            "Map entry 'Stud' (optional, determines if new studs are generated or a connection script is used)"
          ]
        }
      },
      "tokens_used": 3259,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect 2 Walls Connected",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4907,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically detects T-connections between timber walls and either inserts a new stud to close the framing or applies a specific connection script/hardware detail.",
          "category": "Framing/Connection",
          "typicalUseCase": "Used to resolve structural gaps at wall intersections, ensuring either continuous framing or proper mechanical connection (like metal plates) is applied where two walls meet."
        },
        "parameters": [
          {
            "name": "Catalog",
            "technicalDefault": "\"\"",
            "businessMeaning": "Specifies the catalog entry containing the default properties (sizes, materials) for the connection hardware or sub-script.",
            "validRange": "Any valid catalog name string present in the hsbCAD database",
            "unit": "String",
            "affectsOutput": "If 'Stud' is FALSE, this determines the configuration of the 'hsb_Wall to Wall Connection' script instance (e.g., plate dimensions, screw patterns)."
          },
          {
            "name": "Wall",
            "technicalDefault": "\"\"",
            "businessMeaning": "The wall code used to identify which intersecting walls should trigger a connection update.",
            "validRange": "Valid Element Wall Codes (e.g., 'EXT', 'INT', 'PART')",
            "unit": "String",
            "affectsOutput": "Filters the connections processed; only intersections with walls matching this code will generate a stud or connection script."
          },
          {
            "name": "Stud",
            "technicalDefault": "FALSE",
            "businessMeaning": "Determines the method of resolving the T-connection: generating a new timber stud versus applying a mechanical connection.",
            "validRange": "TRUE / FALSE",
            "unit": "Boolean",
            "affectsOutput": "If TRUE, a new stud beam is created. If FALSE, the 'hsb_Wall to Wall Connection' script is executed to create hardware/machining."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Stud is FALSE",
            "effect": "The script relies on the 'Catalog' parameter to configure the connection instance. Without a catalog, default values may be used.",
            "cascade": [
              "Catalog"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam",
            "description": "A new vertical stud generated to fill the gap in the main wall where the intersecting wall meets it.",
            "appliedTo": "The primary wall element selected by the user."
          },
          {
            "type": "TSL Instance",
            "description": "An instance of 'hsb_Wall to Wall Connection' which typically generates metalwork (plates/brackets) and machining (drills/cuts) for the joint.",
            "appliedTo": "The pair of connected wall elements."
          },
          {
            "type": "PLine (Visual)",
            "description": "A red circle visual aid drawn at the center of a newly generated stud to indicate successful creation.",
            "appliedTo": "Model Space (Temporary/Debug visualization)."
          }
        ]
      },
      "tokens_used": 4536,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User launches script and command prompts for selection ('Select 2 Walls Connected').",
          "2. User selects two wall elements in the model.",
          "3. Script validates selection count (must be exactly 2). If invalid, instance is erased.",
          "4. Script re-initializes (_bOnDbCreated) and loads parameters ('Catalog', 'Wall', 'Stud').",
          "5. Script iterates through the selected elements to identify valid vertical studs (Studs, SF Studs).",
          "6. Script retrieves connected elements for each wall.",
          "7. Script filters connected elements based on the 'Wall' parameter (Code match).",
          "8. Script calculates the intersection point and defines a connection search zone.",
          "9. [Conditional] Script checks if valid studs currently occupy the connection zone.",
          "10. [Conditional] If occupied, script checks the gap between the nearest left and right studs.",
          "11. [Conditional] If gap > beam spacing + 5mm, script proceeds to modify the joint.",
          "12. [Conditional] Branch A: If 'Stud' parameter is TRUE, generate a new vertical stud.",
          "13. [Conditional] Branch B: If 'Stud' parameter is FALSE, insert 'hsb_Wall to Wall Connection' script.",
          "14. Script erases its own instance from the database."
        ],
        "conditionalBranches": [
          {
            "condition": "Entity Selection Count",
            "path1": {
              "name": "Valid Selection",
              "steps": [
                "User selects 2 Elements",
                "Script proceeds to processing phase"
              ]
            },
            "path2": {
              "name": "Invalid Selection",
              "steps": [
                "User selects < 2 or > 2 Elements",
                "Script displays error",
                "Script erases instance and exits"
              ]
            }
          },
          {
            "condition": "Existing Studs in Connection Zone",
            "path1": {
              "name": "Intersection Found (nOverWrite=TRUE)",
              "steps": [
                "Identifies beams overlapping the T-connection zone",
                "Finds nearest neighbor beams to left and right",
                "Calculates gap distance"
              ]
            },
            "path2": {
              "name": "No Intersection",
              "steps": [
                "Script skips this specific connection",
                "Continues to next connected wall or element"
              ]
            }
          },
          {
            "condition": "Parameter 'Stud' Value",
            "path1": {
              "name": "Generate Stud (Stud=TRUE)",
              "steps": [
                "Validates gap between left/right beams",
                "Copies Left or Right beam type",
                "Transforms new beam to center of gap",
                "Draws visual helper (Red Circle)"
              ]
            },
            "path2": {
              "name": "Generate Hardware (Stud=FALSE)",
              "steps": [
                "Validates gap between left/right beams",
                "Collects Wall and Connected Wall elements",
                "Instantiates 'hsb_Wall to Wall Connection' TSL",
                "Passes 'Catalog' execution key to sub-script"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Selection",
            "errorMessage": "(Implicit) Script erases itself silently.",
            "recovery": "User must re-run script and select exactly two walls."
          },
          {
            "check": "Wall Code Match",
            "errorMessage": "None",
            "recovery": "Ensure connected wall has the code specified in the 'Wall' parameter (if 'Wall' parameter is set)."
          },
          {
            "check": "Beam Type Validity",
            "errorMessage": "None",
            "recovery": "Ensure main wall contains valid stud types (Standard Stud, SF Stud Left/Right). If none found, script returns early."
          },
          {
            "check": "Gap Size",
            "errorMessage": "None",
            "recovery": "If the distance between left/right beams is too small (< spacing + 5mm), no modification is made."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Script Self-Destruction",
            "how": "Internal Logic (eraseInstance)",
            "effect": "The script instance is removed from the drawing immediately after processing. It is a utility script, not a persistent smart object."
          }
        ]
      },
      "tokens_used": 6408,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_OverwriteTConnection\n\n## Overview\nThis script automatically detects T-connections between two timber walls and resolves the intersection by either inserting a new timber stud or applying a specific connection script (e.g., for metalwork plates). It is a utility script that processes the selected walls and then removes itself from the drawing.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the 3D model. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | Not applicable to 2D generation. |\n\n## Prerequisites\n- **Required Entities**: At least two connected wall elements (`ElementWallSF`) in the model.\n- **Minimum Requirements**: The walls must form a T-junction or intersection where a connection is needed.\n- **Configuration**: Map entries (Execution Keys) should be configured beforehand if you need to filter by specific wall codes or use a specific hardware catalog.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_OverwriteTConnection.mcr` from the list.\n\n### Step 2: Select Walls\n```\nCommand Line: Select 2 Walls Connected\nAction: Click on the first wall element, then click on the second connected wall element to form a pair.\n```\n\n### Step 3: Automatic Processing\nOnce two walls are selected, the script automatically validates the connection, calculates the required gaps, and applies the solution (new stud or hardware). The script instance will immediately disappear from the database upon completion.\n\n## Configuration Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Catalog | String | Empty | Specifies the catalog name to be used for the connection hardware (e.g., metal plates). This is used if 'Stud' is set to FALSE. |\n| Wall | String | Empty | Filters which wall connections are processed. Only walls matching this code (e.g., 'EXT', 'INT') will trigger the connection update. |\n| Stud | Boolean | FALSE | Determines the solution type. If TRUE, the script creates a new timber stud. If FALSE, it runs the 'hsb_Wall to Wall Connection' script to generate hardware. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not provide persistent right-click menu options as it erases itself after running. |\n\n## Settings Files\n- **Type**: Map Entries / Execution Keys\n- **Purpose**: These entries allow you to pre-define the 'Catalog', 'Wall', and 'Stud' settings so the script runs with specific parameters without manual input every time.\n\n## Tips\n- **Self-Cleaning**: Do not be alarmed if the script icon disappears from the insertion point immediately after running; this is intended behavior. It is a \"fire and forget\" utility.\n- **Gap Requirements**: The script calculates the gap between existing studs. It will only insert a new stud or connection if the gap is larger than the current beam spacing plus 5mm.\n- **Wall Codes**: If the script seems to do nothing, check if the 'Wall' parameter is set to a specific code that your selected walls do not match. Leaving it empty usually allows it to process any wall.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the walls?**\n  - A: The script is designed to process the geometry and then erase itself (`eraseInstance`). It does not remain as a persistent object in the drawing tree.\n- **Q: I selected two walls, but no stud or connection was created. Why?**\n  - A: Check that the gap between existing studs is large enough (greater than beam spacing + 5mm). Also, verify that the connected walls match the filter code defined in the 'Wall' parameter.\n- **Q: Can I use this to add metal plates instead of studs?**\n  - A: Yes. Set the 'Stud' parameter to FALSE and ensure the 'Catalog' parameter points to a valid catalog containing your connection details."
      },
      "tokens_used": 5166,
      "error": null
    }
  }
}