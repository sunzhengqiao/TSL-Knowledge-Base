{
  "filename": "hsbGenBeamDensity.mcr",
  "status": "completed",
  "total_tokens": 33525,
  "processing_time": 776.2285361289978,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.3",
            "date": "07.12.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-17225: add support as element and beam plugin TSL"
          },
          {
            "version": "1.2",
            "date": "20.09.2011",
            "author": "th@hsbCAD.de",
            "changes": "auto insert shopdrawings enabled"
          },
          {
            "version": "1.1",
            "date": "19.08.2011",
            "author": "th@hsbCAD.de",
            "changes": "Vorgabe Eigenschaftsname gesetzt"
          },
          {
            "version": "1.0",
            "date": "19.08.2011",
            "author": "th@hsbCAD.de",
            "changes": "inital"
          }
        ],
        "settingsFiles": [
          "hsbGenBeamDensityConfig.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 5967,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script logic iterates through _Element and _Beam collections to attach property sets to GenBeam objects. It uses PrEntity to select structural elements (Beam, Sheet, Sip). There are no sd_* functions, viewport interactions, or drawing-specific (#Type E) constructs found in the code. It modifies entity properties based on a material lookup, which is a 3D model operation."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element",
            "Beam",
            "Sheet",
            "Sip"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space with elements that have material assignments.",
          "requiredSettings": [
            "hsbCompany\\Abbund\\hsbGenBeamDensityConfig.xml",
            "Property Set Definition with a numeric density property"
          ]
        }
      },
      "tokens_used": 3130,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "T(\"|Select entities|\")",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Standard Property Dialog",
            "trigger": "Shown on insert if _kExecuteKey is empty, on _bOnMapIO, or if validation fails",
            "title": null,
            "dataSource": "OPM Properties (sPropertySet, sPropertyName)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sPropertySet",
            "type": "PropString",
            "displayName": "T(\"|Property Set Name|\")",
            "defaultValue": "hsbDensity",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sPropertyName",
            "type": "PropString",
            "displayName": "T(\"|Property Name Density|\")",
            "defaultValue": "Density",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "hsbGenBeamDensityConfig.xml",
            "searchPaths": [
              "_kPathHsbCompany + \"\\Abbund\\\""
            ],
            "purpose": "Maps material names to density values",
            "required": true
          }
        ]
      },
      "tokens_used": 6147,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically assigns physical density values (e.g., kg/m³) to timber beams and sheets based on their assigned material, utilizing a lookup table to populate a specific Property Set.",
          "category": "Data Management",
          "typicalUseCase": "Used to prepare a timber model for structural weight calculations, shipping logistics, or BIM data export by ensuring every beam has accurate density data attached to it."
        },
        "parameters": [
          {
            "name": "sPropertySet",
            "technicalDefault": "hsbDensity",
            "businessMeaning": "The name of the Property Set Definition (collection of data fields) that will be attached to the beam to store the density value. It acts as the container for the data.",
            "validRange": "Must match an existing Property Set Definition name in the current project or AutoCAD standard library.",
            "unit": "String (Text)",
            "affectsOutput": "If the name is invalid or the definition does not exist, the script will fail and display an error. If valid, the beam will have this specific data set attached to it."
          },
          {
            "name": "sPropertyName",
            "technicalDefault": "Density",
            "businessMeaning": "The specific attribute label (field) within the selected Property Set where the numeric density value will be written.",
            "validRange": "Must be a valid property name defined within the 'sPropertySet' definition and must be of a type that accepts numeric (double) values.",
            "unit": "String (Text)",
            "affectsOutput": "Determines the exact label under which the density value is stored in the beam's properties (visible in the Properties Palette). If invalid, the script fails."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sPropertySet is changed",
            "effect": "The new value must exist in the drawing's Property Set definitions; otherwise, the script aborts.",
            "cascade": []
          },
          {
            "trigger": "sPropertyName is changed",
            "effect": "The new property must exist inside the definition of sPropertySet; otherwise, the script aborts.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Property Set Data",
            "description": "Attaches a Property Set to the selected entities (Beam, Sheet, Sip) and populates a specific numeric field with the density value found in the configuration XML.",
            "appliedTo": "Selected GenBeam, Sheet, or Sip entities (or all GenBeams within a selected Element)."
          }
        ]
      },
      "tokens_used": 5341,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launched via command or catalog.",
          "2. [Insert Phase] Determine property source: Check if _kExecuteKey (Catalog) exists.",
          "3. [Insert Phase] If Catalog key exists: Load properties from catalog; Else: Show standard Property Dialog.",
          "4. [Insert Phase] Prompt user to select structural entities (Beam, Sheet, Sip) using PrEntity.",
          "5. [Execution Phase] Resolve target entities: Prioritize Single Beam -> Element (all GenBeams) -> Selected Entities.",
          "6. [Execution Phase] Validate 'sPropertySet': Check if definition exists in current drawing.",
          "7. [Execution Phase] If 'sPropertySet' invalid: Show Dialog to allow correction -> Re-check -> Abort if still invalid.",
          "8. [Execution Phase] Load density mapping table from 'hsbGenBeamDensityConfig.xml'.",
          "9. [Execution Phase] Iterate through target entities to process density assignment.",
          "10. [Execution Phase] Attach Property Set to entity.",
          "11. [Execution Phase] Validate 'sPropertyName': Check if property exists in the attached set (Check on first entity only).",
          "12. [Execution Phase] If 'sPropertyName' invalid: Show Dialog -> Abort.",
          "13. [Execution Phase] Retrieve entity Material name.",
          "14. [Execution Phase] Search XML map for Material (case-insensitive).",
          "15. [Execution Phase] If found: Write density value to Property Set; Else: Log warning to command line.",
          "16. [Execution Phase] Report summary of missing materials (if any).",
          "17. [Execution Phase] Erase script instance (Run-once behavior)."
        ],
        "conditionalBranches": [
          {
            "condition": "Invocation Mode during Insert",
            "path1": {
              "name": "Catalog Execution",
              "steps": [
                "Load properties from _kExecuteKey catalog entry",
                "Skip standard dialog",
                "Proceed to selection prompt"
              ]
            },
            "path2": {
              "name": "Manual Execution",
              "steps": [
                "Display standard OPM Property Dialog",
                "Wait for user confirmation",
                "Proceed to selection prompt"
              ]
            }
          },
          {
            "condition": "Target Entity Source (Priority)",
            "path1": {
              "name": "Single Beam",
              "steps": [
                "Check if _Beam array contains exactly 1 beam",
                "Set target list to that specific beam"
              ]
            },
            "path2": {
              "name": "Element",
              "steps": [
                "Check if _Element array contains exactly 1 element",
                "Get all GenBeams inside the element",
                "Set target list to these beams"
              ]
            },
            "path3": {
              "name": "Selection Set",
              "steps": [
                "Use _Entity collected during PrEntity prompt",
                "Process all selected entities"
              ]
            }
          },
          {
            "condition": "Property Set Name Validation",
            "path1": {
              "name": "Valid Definition",
              "steps": [
                "Name found in availablePropSetNames()",
                "Continue execution"
              ]
            },
            "path2": {
              "name": "Invalid Definition",
              "steps": [
                "Name not found",
                "Force show Property Dialog",
                "Re-validate",
                "Abort and delete instance if still invalid"
              ]
            }
          },
          {
            "condition": "Material Lookup in XML",
            "path1": {
              "name": "Match Found",
              "steps": [
                "Material string matches XML key (case-insensitive)",
                "Retrieve Double value",
                "Update Property Set on entity"
              ]
            },
            "path2": {
              "name": "No Match",
              "steps": [
                "Material string not found in map",
                "Report Entity Name, PosNum, and Material to console",
                "Continue to next entity (Set bMissingMaterials flag)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of Property Set Definition",
            "errorMessage": "invalid Property Set Name. Tool will be deleted.",
            "recovery": "Dialog opens to allow user to correct the 'sPropertySet' value to match an existing definition in the drawing."
          },
          {
            "check": "Existence of Property Name in Definition",
            "errorMessage": "Enter valid property name and try again.",
            "recovery": "Dialog opens to allow user to correct the 'sPropertyName' value. The property must exist within the previously selected Property Set."
          },
          {
            "check": "XML Configuration File Availability",
            "errorMessage": "No Density list found in [Path]. Tool will be deleted.",
            "recovery": "Ensure 'hsbGenBeamDensityConfig.xml' exists in the hsbCompany\\Abbund\\ directory and is not empty."
          },
          {
            "check": "Material Coverage",
            "errorMessage": "[Entity Info] not found in [Path]. Please update density table and try again.",
            "recovery": "User must manually edit the XML configuration file to add the missing material and its density, then run the script again."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None (Script Instance Erased)",
            "how": "N/A",
            "effect": "The script calls eraseInstance() at the end of execution. The script instance is removed from the drawing, but the modified Property Set data remains on the entities. To run again, the user must re-execute the command."
          }
        ]
      },
      "tokens_used": 7313,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbGenBeamDensity.mcr\n\n## Overview\nThis script automatically assigns physical density values (e.g., kg/m³) to timber beams and sheets based on their material properties. It uses an external lookup table (XML) to populate a specific Property Set field, facilitating accurate weight calculations and BIM data export.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D structural elements (Beams, Sheets, Panels). |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | Not applicable for 2D drawings. |\n\n## Prerequisites\n- **Required Entities**: GenBeam, Element, Sheet, or Structural Insulated Panels (Sip).\n- **Minimum Beam Count**: 1 (or an Element containing at least one beam).\n- **Required Settings**: \n  - The configuration file `hsbGenBeamDensityConfig.xml` must exist in your `hsbCompany\\Abbund\\` folder.\n  - A Property Set Definition (with a numeric property) must exist in your drawing to store the density data.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsbGenBeamDensity.mcr` from the list.\n\n### Step 2: Configure Properties\n```\nProperties Palette: Set Property Set Name and Property Name Density\nAction: \n1. Ensure \"Property Set Name\" matches the Property Set Definition in your drawing (Default: hsbDensity).\n2. Ensure \"Property Name Density\" matches the specific field label within that set (Default: Density).\n3. Close the palette to proceed.\n```\n\n### Step 3: Select Entities\n```\nCommand Line: Select entities\nAction: \n- Click on a single Beam, an Element (to process all beams inside), or multiple Sheets/Sips.\n- Press Enter to confirm selection.\n```\n\n### Step 4: Review Processing\nThe script will automatically:\n1. Read the material assigned to each selected entity.\n2. Look up the material in the configuration XML file.\n3. Write the density value to the entity's properties.\n4. Report any missing materials to the command line.\n\n### Step 5: Completion\nThe script instance deletes itself automatically after processing. The density data is now attached to your elements.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Property Set Name | text | hsbDensity | The name of the Property Set Definition that will be attached to the entities to store the density. |\n| Property Name Density | text | Density | The exact field name (attribute) within the Property Set where the numeric value will be written. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are defined for this script. |\n\n## Settings Files\n- **Filename**: `hsbGenBeamDensityConfig.xml`\n- **Location**: `hsbCompany\\Abbund\\`\n- **Purpose**: Contains the mapping database. It lists Material Names (e.g., \"C24\", \"GL24h\") alongside their corresponding Density values. If a material in your model is not in this list, the script cannot assign a density to it.\n\n## Tips\n- **Verify Property Sets**: Before running the script, use AutoCAD's `PROPERTIES` command to check if your target beams already have the Property Set defined. If the script fails to find the set, it will abort.\n- **Material Spelling**: Ensure the Material names assigned to your beams (in the General properties) exactly match the keys in the XML file. The check is case-insensitive, but spelling must be precise (e.g., \"Spruce\" vs. \"Spruce \").\n- **Batch Processing**: You can select multiple entities or a whole Element (wall/roof) at once to speed up the process.\n\n## FAQ\n- **Q: The script reports \"invalid Property Set Name\" and stops. What is wrong?**\n  **A:** The name you entered in the \"Property Set Name\" parameter does not exist in the current drawing's Property Set Definitions. Check the drawing settings or correct the spelling in the script properties.\n- **Q: The command line says a material was \"not found\" in the XML path. How do I fix this?**\n  **A:** Your model uses a material that is not defined in `hsbGenBeamDensityConfig.xml`. You must edit that XML file (usually located in your company folder) to add the missing material and its density value.\n- **Q: Can I run this on a single beam?**\n  **A:** Yes. If you select a single GenBeam, the script processes only that beam. If you select an Element, it processes all beams inside that element."
      },
      "tokens_used": 5627,
      "error": null
    }
  }
}