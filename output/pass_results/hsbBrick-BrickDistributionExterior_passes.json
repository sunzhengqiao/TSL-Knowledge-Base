{
  "filename": "hsbBrick-BrickDistributionExterior.mcr",
  "status": "completed",
  "total_tokens": 48924,
  "processing_time": 461.0287163257599,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"2.14\",\n      \"date\": \"02oct2020\",\n      \"author\": \"marsel.nakuci@hsbcad.com\",\n      \"changes\": \"HSB-9023: After 3 attempts if the distribution region is very small, delete the TSL\"\n    },\n    {\n      \"version\": \"2.13\",\n      \"date\": \"19.08.2019\",\n      \"author\": \"marsel.n"
      },
      "tokens_used": 9013,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses dbCreate with _kModelSpace (e.g., 'tslNew.dbCreate(\"hsbBrick-3dBricks\" , ..., _kModelSpace, mapTsl);'). Collects entities using 'grp.collectEntities(true, TslInst(), _kModelSpace);'. No references to _kPaperSpace, Viewports, or sd_ prefixes."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall",
            "TslInst (Course Distribution)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "ModelSpace",
          "requiredSettings": [
            "A valid 'Course Distribution' TSL instance containing 'hsbBrickData' map",
            "Map 'hsbBrickData' must contain 'Family' map with brick dimensions",
            "Point3d 'ptRefBuilding' from parent TSL"
          ]
        }
      },
      "tokens_used": 6401,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "T(\"|Select element(s)|\")",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getTslInst",
              "promptOriginal": "T(\"|Select course distribution|\")",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dButtJointMin",
            "type": "PropDouble",
            "displayName": "T(\"|Minimum|\")",
            "defaultValue": "U(9)",
            "inputType": "number",
            "options": [],
            "category": "T(\"|Mortar Butt Joint|\")",
            "description": "T(\"|Defines the minmal butt joint|\")"
          },
          {
            "index": 1,
            "variable": "dButtJointMax",
            "type": "PropDouble",
            "displayName": "T(\"|Maximum|\")",
            "defaultValue": "U(15)",
            "inputType": "number",
            "options": [],
            "category": "T(\"|Mortar Butt Joint|\")",
            "description": "T(\"|Defines the maximal butt joint|\")"
          },
          {
            "index": 2,
            "variable": "dButtJointProp",
            "type": "PropDouble",
            "displayName": "T(\"|calculated|\")",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "T(\"|Mortar Butt Joint|\")",
            "description": "T(\"|The calculated Butt Joint|\")"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "T(\"|AddPLine|\")",
            "handler": "T(\"|AddPLine|\")",
            "action": "Appends a PLine entity for debugging visualization (Debug Mode only)",
            "alsoTriggeredBy": "TslDoubleClick"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9835,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically calculates the optimal horizontal layout and distribution of bricks (masonry) for exterior wall segments, ensuring vertical mortar joints stay within specified aesthetic tolerances.",
          "category": "Covering/Cladding",
          "typicalUseCase": "Used to generate brick schedules and 3D brick visualizations for timber frame walls, ensuring that cuts at corners and openings are minimized and joints are uniform."
        },
        "parameters": [
          {
            "name": "dButtJointMin",
            "technicalDefault": "U(9)",
            "businessMeaning": "Defines the smallest allowable width for the vertical mortar joint (butt joint) between bricks. The algorithm will try to increase the number of bricks to prevent the joint from being smaller than this value.",
            "validRange": "5 - 12 mm",
            "unit": "mm",
            "affectsOutput": "Determines the minimum brick count in a row. If the wall length forces a joint smaller than this, the script adds another brick, resulting in a smaller 'cut' brick at the end of the run."
          },
          {
            "name": "dButtJointMax",
            "technicalDefault": "U(15)",
            "businessMeaning": "Defines the largest allowable width for the vertical mortar joint. The algorithm will try to decrease the number of bricks to prevent the joint from exceeding this value.",
            "validRange": "12 - 25 mm",
            "unit": "mm",
            "affectsOutput": "Determines the maximum brick count in a row. If the calculated joint exceeds this, the script removes a brick, resulting in a larger 'cut' brick at the end of the run."
          },
          {
            "name": "dButtJointProp",
            "technicalDefault": "U(0)",
            "businessMeaning": "The resulting, mathematically calculated width of the vertical mortar joint based on the final brick count selected to satisfy the Min/Max constraints.",
            "validRange": "Read-only (Result of calculation)",
            "unit": "mm",
            "affectsOutput": "None. This is a read-only status property showing the user the exact joint width that will be used for fabrication."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Wall segment length changes (e.g. moving an opening or corner)",
            "effect": "Recalculates the number of whole bricks and cut bricks required to fit the new length.",
            "cascade": [
              "dButtJointProp"
            ]
          },
          {
            "trigger": "Parent 'Course Distribution' TSL changes (Brick Length/Height)",
            "effect": "Updates the brick dimensions used in the horizontal distribution calculation.",
            "cascade": [
              "dButtJointProp"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "HardWrComp (Hardware Component)",
            "description": "Schematic representations of bricks in 2D drawings. Includes attributes for size, rotation, position, and whether the brick is a 'cut' or 'special' shape.",
            "appliedTo": "The selected ElementWall."
          },
          {
            "type": "TslInst (hsbBrick-3dBricks)",
            "description": "3D geometry instances representing individual bricks. These are generated to visualize the brick facade in 3D model space.",
            "appliedTo": "ModelSpace, aligned to the ElementWall coordinate system."
          }
        ]
      },
      "tokens_used": 8207,
      "error": null
    },
    "5": {
      "success": true,
      "data": {},
      "tokens_used": 10785,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbBrick-BrickDistributionExterior\n\n## Overview\nThis script automatically calculates the optimal horizontal layout and distribution of bricks (masonry) for exterior wall segments. It ensures that vertical mortar joints remain within specified aesthetic tolerances and generates 3D brick visualizations.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model environment. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | This is a detailing/modeling script, not a drawing generator. |\n\n## Prerequisites\n- **Required Entities**: An existing `ElementWall` (timber frame wall) and a `Course Distribution` TSL instance already inserted in the drawing.\n- **Minimum Beam Count**: 0.\n- **Required Settings**: The parent \"Course Distribution\" TSL must contain valid brick dimensions within the `hsbBrickData` map (Family data) and a reference building point (`ptRefBuilding`).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT`\n**Action**: Browse and select `hsbBrick-BrickDistributionExterior.mcr`.\n\n### Step 2: Select Element\n```\nCommand Line: Select element(s)\nAction: Click on the wall element(s) where you want to apply the brick distribution and press Enter.\n```\n\n### Step 3: Select Course Distribution\n```\nCommand Line: Select course distribution\nAction: Click on the existing TSL instance that defines the vertical courses (e.g., \"Course Distribution\" script).\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Minimum | Number | 9 mm | Defines the smallest allowable width for the vertical mortar joint (butt joint). If the wall length forces a joint smaller than this, the script adds another brick to increase the joint size. |\n| Maximum | Number | 15 mm | Defines the largest allowable width for the vertical mortar joint. If the calculated joint exceeds this value, the script removes a brick to decrease the joint size. |\n| calculated | Number | 0 mm | The resulting width of the mortar joint based on the final brick count (Read-only). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| AddPLine | Appends a PLine entity to the drawing for debugging visualization (Debug Mode only). |\n\n## Settings Files\n*Note: This script relies on data maps passed from the parent \"Course Distribution\" TSL instance rather than a standalone external XML settings file.*\n\n## Tips\n- **Aesthetic Control**: To achieve a specific look, adjust the **Minimum** and **Maximum** joint parameters. The script algorithm will automatically find the best number of bricks to fit within these bounds.\n- **Dynamic Updates**: If you modify the wall length (e.g., moving a window or adjusting a corner), the script will automatically recalculate the brick layout to maintain the joint constraints.\n- **Failed Insertion**: If the distribution region is extremely small and the script fails to find a valid layout after several attempts, it will automatically delete itself to prevent errors.\n\n## FAQ\n- **Q: Why did the script disappear after I inserted it?**\n  **A:** The script may have determined the distribution region is too small to fit any bricks within the specified joint tolerances. It deletes itself after 3 failed calculation attempts (Version 2.14+).\n\n- **Q: How do I change the size of the mortar joints?**\n  **A:** Select the script instance in the model, open the Properties Palette (Ctrl+1), and modify the \"Minimum\" or \"Maximum\" values under the \"Mortar Butt Joint\" category.\n\n- **Q: What does the \"calculated\" property show?**\n  **A:** This shows the exact mathematical width of the vertical joint that will be used based on the number of bricks selected to fit your wall."
      },
      "tokens_used": 4683,
      "error": null
    }
  }
}