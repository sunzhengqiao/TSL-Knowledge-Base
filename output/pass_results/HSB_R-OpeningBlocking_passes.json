{
  "filename": "HSB_R-OpeningBlocking.mcr",
  "status": "completed",
  "total_tokens": 40566,
  "processing_time": 283.37734508514404,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 3,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "16.04.2012",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "19.04.2012",
            "author": "AS",
            "changes": "Add blocking on both sides (top, bottom)"
          },
          {
            "version": "1.02",
            "date": "19.04.2012",
            "author": "AS",
            "changes": "Add support for toolpalette"
          },
          {
            "version": "2.00",
            "date": "14.02.2013",
            "author": "AS",
            "changes": "Add to localizer"
          },
          {
            "version": "2.01",
            "date": "19.08.2015",
            "author": "AS",
            "changes": "Add tolerance to find horizontal and vertical beams"
          },
          {
            "version": "2.02",
            "date": "21.08.2015",
            "author": "AS",
            "changes": "Add beam filters"
          },
          {
            "version": "3.00",
            "date": "22.12.2016",
            "author": "AS",
            "changes": "Use HSB_G-FilterGenBeams as filter."
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "HSB_G-FilterGenBeams"
        ]
      },
      "tokens_used": 6454,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _kModelSpace explicitly in `TslInst().dbCreate(..., _kModelSpace, ...)` and `grpFloor.collectEntities(..., _kModelSpace)`. No patterns for sd_*, Multipage*, #Type E, or _Viewport found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "OpeningRoof",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Elements with Openings (Roof) and GenBeams.",
          "requiredSettings": [
            "HSB_G-FilterGenBeams (Catalog/Script)"
          ]
        }
      },
      "tokens_used": 4545,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": "Properties",
              "condition": "_bOnInsert && (_kExecuteKey == \"\" || arSCatalogNames.find(_kExecuteKey) == -1)",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select one or more elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sFilterOpening",
            "type": "PropString",
            "displayName": "Filter openings with description",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Filters",
            "description": "Filter openings with specified descriptions."
          },
          {
            "index": 1,
            "variable": "filterDefinition",
            "type": "PropString",
            "displayName": "Filter definition female beams",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "<Empty>",
              "<Catalog Entries: HSB_G-FilterGenBeams>"
            ],
            "category": "Filters",
            "description": "Filter definition for beams. Use HSB_G-FilterGenBeams to define the filters."
          },
          {
            "index": 0,
            "variable": "dBlockingL",
            "type": "PropDouble",
            "displayName": "Length",
            "defaultValue": "300",
            "inputType": "number",
            "options": [],
            "category": "Blocking",
            "description": "Specifies the blocking length."
          },
          {
            "index": 3,
            "variable": "sReferenceSide",
            "type": "PropString",
            "displayName": "Reference side",
            "defaultValue": "Outside",
            "inputType": "dropdown",
            "options": [
              "Outside",
              "Inside"
            ],
            "category": "Blocking",
            "description": "Specifies the reference side."
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8226,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates blocking timber between roof rafters and the top/bottom trimmer beams of roof openings.",
          "category": "Framing",
          "typicalUseCase": "Used during element generation to add structural noggins/stiffeners around roof dormers or skylight openings to prevent rafter deflection and provide fixing points."
        },
        "parameters": [
          {
            "name": "sFilterOpening",
            "technicalDefault": "",
            "businessMeaning": "Filters which roof openings receive blocking based on their description text (e.g., only 'Dormer' openings).",
            "validRange": "Text string (semicolon separated for multiple values)",
            "unit": "String",
            "affectsOutput": "Determines if blocking is generated for a specific opening. If the opening description does not match, no blocking is created."
          },
          {
            "name": "filterDefinition",
            "technicalDefault": "<Empty>",
            "businessMeaning": "Selects a beam filter configuration to identify which rafters/trimmers interact with the blocking.",
            "validRange": "Catalog entries of HSB_G-FilterGenBeams",
            "unit": "Selection",
            "affectsOutput": "Controls which beams are recognized as 'rafters' or 'trimmers' to calculate the blocking geometry. Incorrect filters may miss beams entirely."
          },
          {
            "name": "dBlockingL",
            "technicalDefault": 300,
            "businessMeaning": "The length of the blocking piece extending from the trimmer towards the rafter.",
            "validRange": "100 - 1000 mm",
            "unit": "mm",
            "affectsOutput": "Physically changes the length of the generated blocking beam. Longer blocking provides more surface area for nailing but uses more material."
          },
          {
            "name": "sReferenceSide",
            "technicalDefault": "Outside",
            "businessMeaning": "Defines which side of the element (cladding side) the blocking calculation is referenced from.",
            "validRange": "Outside, Inside",
            "unit": "Selection",
            "affectsOutput": "Offsets the blocking position along the Z-axis (thickness) of the roof element. This is critical for ensuring the blocking aligns with the structural depth of the rafters."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sFilterOpening is changed",
            "effect": "Filters the list of openings processed in the loop.",
            "cascade": [
              "arOpRf",
              "arPlOp"
            ]
          },
          {
            "trigger": "filterDefinition is changed",
            "effect": "Re-runs the HSB_G-FilterGenBeams script to classify beams into horizontal (trimmers) and vertical (rafters).",
            "cascade": [
              "arBmHor",
              "arBmVer",
              "arBmOther"
            ]
          },
          {
            "trigger": "sReferenceSide is changed",
            "effect": "Calculates a new reference plane (`pnElReference`) based on element thickness and the side selection.",
            "cascade": [
              "ptBlock"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam",
            "description": "Blocking timber inserted between the trimmer and rafter.",
            "appliedTo": "The current Element (as a sub-element)."
          }
        ]
      },
      "tokens_used": 6368,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Start: Initialize properties and check for deletion event.\",\n    \"2. [Conditional - Insert Mode] Check if _bOnInsert is true.\",\n    \"3. [Insert Mode] Check insertCycleCount to prevent recursion.\",\n    \"4. [Insert Mode] Check _kExecuteKey to determine if properties are loaded from a catalog or via a dialog.\",\n    \"5. [Insert Mode] Prompt user to select one or more Elements (PrEntity).\",\n    \"6. [Insert Mode] Iterate through selected elements: Remove existing script instances, then create new Satellite TSL instances attached to the elements.\",\n    \"7. [Insert Mode] Report insertion count, erase Master TSL instance, and exit.\",\n    \"8. [Satellite Mode] Set properties from Master (if applicable) and check Element validity.\",\n    \"9. [Satellite Mode] Parse sFilterOpening string into array (Note: Filtering is parsed but not strictly applied in the generation loop in this specific code version).\",\n    \"10. [Satellite Mode] Calculate Reference Plane (pnElReference) based on 'Outside' or 'Inside' setting.\",\n    \"11. [Satellite Mode] Collect OpeningRoof entities from the"
      },
      "tokens_used": 9685,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_R-OpeningBlocking\n\n## Overview\nAutomatically generates blocking timber (noggins/stiffeners) between roof rafters and the top/bottom trimmer beams of roof openings. This script helps stabilize roof structures around dormers or skylights by adding structural connections based on specific geometric rules.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be run in the 3D model where Elements and Openings exist. |\n| Paper Space | No | Not supported in layout views. |\n| Shop Drawing | No | Not intended for 2D drawing generation. |\n\n## Prerequisites\n- **Required entities**: Roof Elements (Element) containing valid Roof Openings (`OpeningRoof`) and GenBeams (rafters/trimmers).\n- **Minimum beam count**: 1 (though typically requires multiple beams forming a roof structure).\n- **Required settings**: The catalog or script `HSB_G-FilterGenBeams` must be available and configured to define which beams are treated as rafters versus trimmers.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or select from hsbCAD Toolpalette)\nAction: Browse and select `HSB_R-OpeningBlocking.mcr`.\n\n### Step 2: Select Elements\n```\nCommand Line: Select one or more elements\nAction: Click on the roof element(s) that contain the openings where you want to add blocking.\n```\n\n### Step 3: Configure Parameters\nAction: After insertion, select the generated instance (or the Element) and press `Ctrl+1` to open the Properties Palette. Adjust the blocking length or filters as needed.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Filters** | | | |\n| Filter openings with description | Text | \"\" | Enter a description text (e.g., \"Dormer\") to only generate blocking for openings matching this name. |\n| Filter definition female beams | Dropdown | <Empty> | Select a filter preset from `HSB_G-FilterGenBeams` to identify which beams are trimmers (horizontal) and rafters (vertical). |\n| **Blocking** | | | |\n| Length | Number | 300 | The length of the blocking timber extending from the trimmer towards the rafter (in mm). |\n| Reference side | Dropdown | Outside | Determines if the blocking geometry is calculated from the \"Outside\" or \"Inside\" face of the roof element. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the blocking geometry based on changes to the roof, openings, or properties. |\n\n## Settings Files\n- **Dependency**: `HSB_G-FilterGenBeams`\n- **Purpose**: This script/catalog provides the logic to filter beams. Ensure the desired filter (e.g., specific beam names or layers) is defined there so the \"Filter definition female beams\" dropdown has valid options.\n\n## Tips\n- **Beam Recognition**: If blocking appears in the wrong place or not at all, check the **Filter definition female beams** setting. The script relies on correctly identifying which beams are horizontal (trimmers) and which are vertical (rafters).\n- **Positioning**: If the blocking is generated inside the roof sheathing instead of flush with the structural rafters, toggle the **Reference side** between \"Outside\" and \"Inside\".\n- **Multiple Elements**: You can select several roof elements during insertion to apply blocking to all of them simultaneously.\n\n## FAQ\n- **Q: Why is no blocking generated even though I have openings?**\n  - A: Check the **Filter openings with description** field. If it is not empty, only openings matching that text exactly will be processed. Also, ensure the `HSB_G-FilterGenBeams` filter is correctly identifying the beams surrounding the opening.\n- **Q: The blocking length is too short/long.**\n  - A: Change the **Length** property in the Properties Palette. The value is in millimeters.\n- **Q: Can I use this for wall openings?**\n  - A: No, this script is specifically designed for Roof Openings (`OpeningRoof` entities) and their associated geometry."
      },
      "tokens_used": 5288,
      "error": null
    }
  }
}