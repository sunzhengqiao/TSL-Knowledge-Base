{
  "filename": "hsb_WallPanelSchedule.mcr",
  "status": "completed",
  "total_tokens": 54856,
  "processing_time": 298.4143533706665,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": \"\",\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.0\",\n      \"date\": \"10.06.2008\",\n      \"author\": \"Alberto Jena"
      },
      "tokens_used": 9519,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses `getPoint` for manual placement and `PrEntity` to select `Element` objects during `_bOnInsert`. It generates 2D geometry (table) using standard `Display`, `PLine`, and `dp.draw()` commands relative to the script's local coordinate system (`_XW`, `_YW`, `_Pt0`). There are no references to `_Viewport`, `#Type E`, `sd_` functions, or Paper Space attributes."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "ElementWall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 7635,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10369,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a 2D schedule (table) in Model Space listing dimensions, area, weight, and description of selected wall panels.",
          "category": "ShopDrawing / Reporting",
          "typicalUseCase": "Creating a bill of materials or production list for wall panels to be used for fabrication or estimation."
        },
        "parameters": [
          {
            "name": "_Pt0",
            "technicalDefault": "getPoint()",
            "businessMeaning": "The insertion point for the top-left corner of the schedule table in the CAD drawing.",
            "validRange": "Any valid 3D coordinate in Model Space",
            "unit": "mm (coordinates)",
            "affectsOutput": "Defines the spatial location of the generated table geometry."
          },
          {
            "name": "_Element",
            "technicalDefault": "PrEntity selection",
            "businessMeaning": "The set of wall panels (Element or ElementWall) to be included in the schedule.",
            "validRange": "1 or more hsbCAD Wall Elements",
            "unit": "Entity List",
            "affectsOutput": "Determines the rows of data generated in the table."
          },
          {
            "name": "nPropZone",
            "technicalDefault": "5 (which maps to index 0 in arNZone, value 0)",
            "businessMeaning": "Selects the specific material layer (Zone) used to calculate the 'Area' of the panel. 0 uses the overall outline (ignoring openings), while other values calculate the area of specific sheeting layers defined in the wall composition.",
            "validRange": "-5 to 5 (Selected via dropdown mapped to index)",
            "unit": "Index",
            "affectsOutput": "Alters the calculated value displayed in the 'Area' column."
          },
          {
            "name": "sShowDescription",
            "technicalDefault": "1 (Yes)",
            "businessMeaning": "Toggles the visibility of the 'Description' column (Element Code) in the schedule.",
            "validRange": "Yes / No",
            "unit": "Boolean",
            "affectsOutput": "Adds or removes the 'Description' column and associated header from the table."
          },
          {
            "name": "sShowHeight",
            "technicalDefault": "1 (Yes)",
            "businessMeaning": "Toggles the visibility of the 'Height' column.",
            "validRange": "Yes / No",
            "unit": "Boolean",
            "affectsOutput": "Adds or removes the 'Height' column from the table."
          },
          {
            "name": "sShowLength",
            "technicalDefault": "1 (Yes)",
            "businessMeaning": "Toggles the visibility of the 'Length' column.",
            "validRange": "Yes / No",
            "unit": "Boolean",
            "affectsOutput": "Adds or removes the 'Length' column from the table."
          },
          {
            "name": "sShowThickness",
            "technicalDefault": "1 (Yes)",
            "businessMeaning": "Toggles the visibility of the 'Thickness' column (calculated as the sum of all zone heights).",
            "validRange": "Yes / No",
            "unit": "Boolean",
            "affectsOutput": "Adds or removes the 'Thickness' column from the table."
          },
          {
            "name": "sShowWeight",
            "technicalDefault": "1 (Yes)",
            "businessMeaning": "Toggles the visibility of the 'Weight' column (read from the element's MapX data).",
            "validRange": "Yes / No",
            "unit": "Boolean",
            "affectsOutput": "Adds or removes the 'Max Weight' column from the table."
          },
          {
            "name": "sShowArea",
            "technicalDefault": "1 (Yes)",
            "businessMeaning": "Toggles the visibility of the 'Area' column.",
            "validRange": "Yes / No",
            "unit": "Boolean",
            "affectsOutput": "Adds or removes the 'Area' column from the table."
          },
          {
            "name": "sTitle",
            "technicalDefault": "\"Panel Schedule\"",
            "businessMeaning": "The header text displayed at the top of the table.",
            "validRange": "Any text string",
            "unit": "String",
            "affectsOutput": "Changes the title text content."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles (Current standard)",
            "businessMeaning": "The CAD dimension style used to determine font and text properties for the table content.",
            "validRange": "Available Dimension Styles in the drawing",
            "unit": "String",
            "affectsOutput": "Changes the font appearance and text size of the schedule data."
          },
          {
            "name": "nColor",
            "technicalDefault": "7 (White/Black)",
            "businessMeaning": "The CAD color index for the main data rows in the table.",
            "validRange": "0-255 (ACI) or -1 (ByLayer)",
            "unit": "Color Index",
            "affectsOutput": "Changes the color of the data text."
          },
          {
            "name": "nTitleColor",
            "technicalDefault": "4 (Cyan)",
            "businessMeaning": "The CAD color index for the Table Title.",
            "validRange": "0-255 (ACI) or -1 (ByLayer)",
            "unit": "Color Index",
            "affectsOutput": "Changes the color of the title text."
          },
          {
            "name": "nHeaderColor",
            "technicalDefault": "-1 (ByLayer)",
            "businessMeaning": "The CAD color index for the column header row.",
            "validRange": "0-255 (ACI) or -1 (ByLayer)",
            "unit": "Color Index",
            "affectsOutput": "Changes the color of the header text."
          },
          {
            "name": "nLineColor",
            "technicalDefault": "-1 (ByLayer)",
            "businessMeaning": "The CAD color index for the grid lines and borders of the table.",
            "validRange": "0-255 (ACI) or -1 (ByLayer)",
            "unit": "Color Index",
            "affectsOutput": "Changes the color of the table lines."
          },
          {
            "name": "sPrimarySortKey",
            "technicalDefault": "0 (Wall Number)",
            "businessMeaning": "The primary data field used to order the panels in the list (e.g., Wall Number, Length, or Weight).",
            "validRange": "Wall, Description, Height, Length, Weight, Area",
            "unit": "Enum",
            "affectsOutput": "Reorders the rows of the schedule based on this criteria."
          },
          {
            "name": "sSecondarySortKey",
            "technicalDefault": "0 (Wall Number)",
            "businessMeaning": "The secondary data field used to order panels when the Primary Sort Key values are identical.",
            "validRange": "Wall, Description, Height, Length, Weight, Area",
            "unit": "Enum",
            "affectsOutput": "Refines the row ordering."
          },
          {
            "name": "sTertiarySortKey",
            "technicalDefault": "0 (Wall Number)",
            "businessMeaning": "The third level data field used to order panels.",
            "validRange": "Wall, Description, Height, Length, Weight, Area",
            "unit": "Enum",
            "affectsOutput": "Further refines the row ordering."
          },
          {
            "name": "sSortMode",
            "technicalDefault": "Ascending",
            "businessMeaning": "The direction of the sorting logic.",
            "validRange": "Ascending / Descending",
            "unit": "Enum",
            "affectsOutput": "Reverses the sort order of the rows."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sShowDescription",
            "effect": "Enables/Disables the calculation of column width and rendering for the Description column.",
            "cascade": [
              "dColumnWidthAr",
              "nNumberOfColumns"
            ]
          },
          {
            "trigger": "nPropZone",
            "effect": "Switches logic between using the 'Shadow Profile' of all beams (Zone 0) or the Sheet profiles of a specific Zone index to calculate Area.",
            "cascade": [
              "dArea",
              "sWallArea"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "2D Geometry",
            "description": "A formatted table consisting of Text entities (for Title, Headers, and Data) and Polyline entities (for Grid/Borders) drawn in Model Space.",
            "appliedTo": "Model Space at user selected point _Pt0"
          }
        ]
      },
      "tokens_used": 9324,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched via hsbCAD toolbar or catalog",
          "[Conditional] Display Properties Dialog if '_kExecuteKey' is empty",
          "User prompted to select insertion point ('Pick a Point')",
          "User prompted to select Wall Elements ('Please select Elements')",
          "Script validates selection",
          "Script initializes Display object and draws insertion crosshairs",
          "Script iterates through each selected Element",
          "For each Element: Retrieve basic data (Code, Number, Coordinates)",
          "For each Element: Retrieve Weight from MapX ('HSB_ElementInfo')",
          "For each Element: Construct outline profile from beam shadow profiles",
          "For each Element: [Conditional Branch] Calculate Area based on Zone selection",
          "For each Element: Format all values (Height, Length, Thickness, Area, Weight)",
          "Script sorts collected data based on Primary, Secondary, and Tertiary sort keys",
          "Script calculates column widths based on text length and visibility flags",
          "Script draws Table Title",
          "Script draws Header Row (Column names)",
          "Script draws Data Rows (One row per selected Element)",
          "Script finishes execution"
        ],
        "conditionalBranches": [
          {
            "condition": "User Element Selection (PrEntity)",
            "path1": {
              "name": "Elements Selected",
              "steps": [
                "Extract entities from selection set",
                "Loop through entities and append to internal '_Element' array",
                "Continue to processing"
              ]
            },
            "path2": {
              "name": "Selection Empty / Cancelled",
              "steps": [
                "Execute 'eraseInstance()'",
                "Terminate script immediately"
              ]
            }
          },
          {
            "condition": "Area Calculation Method (nPropZone)",
            "path1": {
              "name": "Zone 0 (General Outline)",
              "steps": [
                "Use union of beam shadow profiles ('shadowProfile')",
                "Find largest ring from the resulting profile",
                "Calculate Area based on this outline"
              ]
            },
            "path2": {
              "name": "Specific Zone (1-5 or -1 to -5)",
              "steps": [
                "Retrieve sheet entities for the specific zone index",
                "Use sheet envelopes ('plEnvelope') to create profile",
                "Union these sheet profiles to calculate Area"
              ]
            }
          },
          {
            "condition": "Column Visibility Flags (sShowDescription, sShowHeight, etc.)",
            "path1": {
              "name": "Column Visible (Yes)",
              "steps": [
                "Include column in width calculation loop",
                "Draw column header text",
                "Draw data text for every row",
                "Draw vertical grid lines"
              ]
            },
            "path2": {
              "name": "Column Hidden (No)",
              "steps": [
                "Skip column in width calculation",
                "Skip header drawing",
                "Skip data drawing",
                "Skip vertical grid lines"
              ]
            }
          },
          {
            "condition": "Weight Data Availability",
            "path1": {
              "name": "MapX Data Present",
              "steps": [
                "Read 'TotalWeight' from 'HSB_ElementInfo' submap",
                "Format value for display"
              ]
            },
            "path2": {
              "name": "MapX Data Missing",
              "steps": [
                "Set weight value to 0",
                "Display '0 Kg'"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection Count",
            "errorMessage": "None (Script exits silently)",
            "recovery": "User must re-run the script and ensure elements are selected."
          },
          {
            "check": "Entity Type",
            "errorMessage": "None (Handled via PrEntity filter)",
            "recovery": "User must select valid hsbCAD Elements (Walls)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Table Content/Order",
            "how": "Properties Palette (OPM)",
            "effect": "Modifying 'Show...' properties toggles columns. Modifying 'Sort Key' properties re-orders the rows. Modifying 'Zone' recalculates Areas. The table redraws automatically."
          },
          {
            "action": "Change Visual Style",
            "how": "Properties Palette (OPM)",
            "effect": "Changing 'Color', 'Title Color', 'Dimstyle', or 'Line Color' updates the appearance of the table text and lines."
          },
          {
            "action": "Move Table",
            "how": "Grip Edit or Re-insertion",
            "effect": "Since '_Pt0' is not exposed as a PropPoint, moving the table typically requires selecting the script instance and dragging the grip (if available/added by system) or deleting and re-inserting the script at a new point."
          }
        ]
      },
      "tokens_used": 10945,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_WallPanelSchedule.mcr\n\n## Overview\nThis script generates a 2D schedule table in Model Space listing dimensions, area, weight, and descriptions of selected hsbCAD wall panels. It is typically used for creating production lists, bill of materials, or estimation reports directly in the CAD model.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The table is generated as 2D geometry (Text and Polylines) at the user's selected location. |\n| Paper Space | No | This script does not function in Layout viewports. |\n| Shop Drawing | No | This is a reporting tool for the model, not an automated shop drawing detailer. |\n\n## Prerequisites\n- **Required Entities**: At least one hsbCAD Wall Element (`Element` or `ElementWall`) must exist in the model.\n- **Minimum Beam Count**: N/A (Script operates on Elements, not individual beams).\n- **Required Settings**: None. The script uses the current drawing's Dimension Styles for text formatting.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Select `hsb_WallPanelSchedule.mcr` from the file dialog or TSL Catalog.\n\n### Step 2: Set Insertion Point\n```\nCommand Line: Pick a Point\nAction: Click in the Model Space to define the top-left corner of the schedule table.\n```\n\n### Step 3: Select Wall Elements\n```\nCommand Line: Please select Elements\nAction: Select one or more Wall Elements from the model and press Enter.\n```\n*Note: If no elements are selected, the script will exit and erase itself.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **General Settings** |\n| sTitle | String | Panel Schedule | The header text displayed at the top of the table. |\n| sDimStyle | String | Current Standard | The dimension style used to determine text font and size. |\n| nPropZone | Index | 0 | The material layer used to calculate Area. `0` uses the outer outline. `1-5` calculates area based on specific sheeting layers. |\n| **Column Visibility** |\n| sShowDescription | Yes/No | Yes | Shows the Element Code/Description column. |\n| sShowHeight | Yes/No | Yes | Shows the Height column. |\n| sShowLength | Yes/No | Yes | Shows the Length column. |\n| sShowThickness | Yes/No | Yes | Shows the Thickness column (sum of all zones). |\n| sShowWeight | Yes/No | Yes | Shows the Weight column (reads from Element MapX data). |\n| sShowArea | Yes/No | Yes | Shows the Area column. |\n| **Appearance** |\n| nColor | Integer | 7 (White) | Color index for the main data text. |\n| nTitleColor | Integer | 4 (Cyan) | Color index for the Table Title. |\n| nHeaderColor | Integer | -1 (ByLayer) | Color index for the column header text. |\n| nLineColor | Integer | -1 (ByLayer) | Color index for the table grid lines. |\n| **Sorting** |\n| sPrimarySortKey | Enum | Wall Number | The first criteria to sort the panel list (e.g., Wall, Length, Weight). |\n| sSecondarySortKey | Enum | Wall Number | The criteria used if Primary values are identical. |\n| sTertiarySortKey | Enum | Wall Number | The criteria used if Primary and Secondary values are identical. |\n| sSortMode | Enum | Ascending | Determines if the list sorts Ascending or Descending. |\n\n## Right-Click Menu Options\nStandard AutoCAD/TSL context menus apply. To modify the table content or appearance, select the script instance and use the **Properties Palette**. Changes to properties automatically trigger a redraw of the table.\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Area Calculation**: Use `nPropZone = 0` to get the overall bounding box area of the wall. Use a specific zone index (e.g., `1`, `2`) to report the area of specific sheeting material layers (like OSB or Plasterboard).\n- **Sorting**: To create a cutting list or packing list, set the Primary Sort Key to `Length` or `Area` to group similar-sized panels together.\n- **Updating Data**: If wall dimensions change in the model, select the schedule and click the \"Refresh\" (Recalculate) button in the Properties palette or type `REGEN` to update the values.\n- **Weight Data**: Ensure your Elements have been processed/updated so that MapX weight data is available; otherwise, the Weight column will show \"0 Kg\".\n\n## FAQ\n- **Q: Why does the Area column show 0?**\n  A: Check the `nPropZone` property. If set to a specific zone (e.g., 1), ensure the wall actually has a material layer defined at that index. If set to 0, ensure the wall elements have valid geometry.\n- **Q: Can I move the table after inserting it?**\n  A: Yes. Select the table object and use standard AutoCAD Move commands (grips or `MOVE` command).\n- **Q: Why is the text too small or huge?**\n  A: The text size is controlled by the `sDimStyle` property. Change the Dimension Style to one with appropriate text height settings for your current scale."
      },
      "tokens_used": 7064,
      "error": null
    }
  }
}