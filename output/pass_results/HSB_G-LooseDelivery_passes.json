{
  "filename": "HSB_G-LooseDelivery.mcr",
  "status": "completed",
  "total_tokens": 48714,
  "processing_time": 283.99319887161255,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 5,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This moves beams to loose delivery groups",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "22.05.2012",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "20.06.2012",
            "author": "AS",
            "changes": "Add support for 4 different loose provide groups"
          },
          {
            "version": "1.02",
            "date": "12.07.2012",
            "author": "AS",
            "changes": "Erase intersecting beams in the specified floorgroups"
          },
          {
            "version": "1.03",
            "date": "19.11.2012",
            "author": "AS",
            "changes": "Add floorgroup as default group"
          },
          {
            "version": "1.04",
            "date": "27.12.2012",
            "author": "AS",
            "changes": "Correct bug on intersection check."
          },
          {
            "version": "1.05",
            "date": "29.01.2013",
            "author": "AS",
            "changes": "Add option to add loose delivery beams to schwelle group"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7781,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _kModelSpace in TslInst.dbCreate and Group.collectEntities calls. No detection of 'sd_' prefix, Multipage prefix, _Viewport usage, or #Type E with _Entity[] which are indicative of ShopDrawing or PaperSpace scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Group"
          ],
          "minimumBeams": 1,
          "requiredSpace": "ModelSpace (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 4739,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert && (_kExecuteKey == \\\"\\\" || arSCatalogNames.find(_kExecuteKey) == -1)\",\n        \"required\": false\n      },\n      {\n        \"step\": 2,\n        \"function\": \"PrEntity.go\",\n        \"promptOriginal\": \"|Select one or more elements|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"showDialog\",\n      \"trigger\": \"On Insert (if not executed via key)\",\n      \"title\": \"Properties\",\n      \"dataSource\": \"OPM Properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sSeperator01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     |Loose delivery 1|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null,\n      \"readOnly\": true\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sNameGroup01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     |Group| 1\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Parent floorgroup|\",\n        \"|Schwelle of parent floorgroup|\",\n        \"<Dynamic: Groups containing 'Los' or 'Loose'>\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sBeamCodes01\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     |Beamcodes| 1\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sSeperator02\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     |Loose delivery 2|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null,\n      \"readOnly\": true\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sNameGroup02\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     |Group| 2\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Parent floorgroup|\",\n        \"|Schwelle of parent floorgroup|\",\n        \"<Dynamic: Groups containing 'Los' or 'Loose'>\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"sBeamCodes02\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     |Beamcodes| 2\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 6,\n      \"variable\": \"sSeperator03\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     |Loose delivery 3|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null,\n      \"readOnly\": true\n    },\n    {\n      \"index\": 7,\n      \"variable\": \"sNameGroup03\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     |Group| 3\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Parent floorgroup|\",\n        \"|Schwelle of parent floorgroup|\",\n        \"<Dynamic: Groups containing 'Los' or 'Loose'>\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 8,\n      \"variable\": \"sBeamCodes03\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     |Beamcodes| 3\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 9,\n      \"variable\": \"sSeperator04\",\n      \"type\": \"PropString\",\n      \"displayName\": \"     |Loose delivery 4|\",\n      \"defaultValue\":"
      },
      "tokens_used": 9126,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automates the organization of loose timber components by moving specific beams (based on their codes) from main elements into designated 'Loose Delivery' or 'Sill' groups, replacing outdated versions in the process.\",\n    \"category\": \"Data Management / Production Logistics\",\n    \"typicalUseCase\": \"Updating packaging lists for loose parts (e.g., studs, blocking, or splines) to ensure they are grouped correctly for delivery lists or shop drawings, separate from the main wall/roof assemblies.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sSeperator01\",\n      \"technicalDefault\": \"\\\"\\\"\",\n      \"businessMeaning\": \"Visual separator label for the first rule set in the Properties palette.\",\n      \"validRange\": \"N/A (Static Text)\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"None (UI Only)\"\n    },\n    {\n      \"name\": \"sNameGroup01\",\n      \"technicalDefault\": \"|Parent floorgroup|\",\n      \"businessMeaning\": \"Selects the target destination group where the first set of identified beams will be moved.\",\n      \"validRange\": \"Groups found in the project containing 'Los' or 'Loose', or the options '|Parent floorgroup|' and '|Schwelle of parent floorgroup|'.\",\n      \"unit\": \"N/A (Selection)\",\n      \"affectsOutput\": \"Determines the group ownership of the beams matching the first set of codes.\"\n    },\n    {\n      \"name\": \"sBeamCodes01\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Defines the filter criteria for the first rule set. Beams with these codes will be moved to the target group.\",\n      \"validRange\": \"Semicolon-separated string of Beam Codes (e.g., 'STUD;BLOCK;TRIM').\",\n      \"unit\": \"N/A (Text)\",\n      \"affectsOutput\": \"Determines which specific beams are moved and which existing beams in the target group are checked for replacement.\"\n    },\n    {\n      \"name\": \"sSeperator02\",\n      \"technicalDefault\": \"\\\"\\\"\",\n      \"businessMeaning\": \"Visual separator label for the second rule set in the Properties palette.\",\n      \"validRange\": \"N/A (Static Text)\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"None (UI Only)\"\n    },\n    {\n      \"name\": \"sNameGroup02\",\n      \"technicalDefault\": \"|Parent floorgroup|\",\n      \"businessMeaning\": \"Selects the target destination group for the second set of identified beams.\",\n      \"validRange\": \"Groups found in the project containing 'Los' or 'Loose', or the options '|Parent floorgroup|' and '|Schwelle of parent floorgroup|'.\",\n      \"unit\": \"N/A (Selection)\",\n      \"affectsOutput\": \"Determines the group ownership of the beams matching the second set of codes.\"\n    },\n    {\n      \"name\": \"sBeamCodes02\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Defines the filter criteria for the second rule set.\",\n      \"validRange\": \"Semicolon-separated string of Beam Codes.\",\n      \"unit\": \"N/A (Text)\",\n      \"affectsOutput\": \"Determines which specific beams are moved for the second rule set.\"\n    },\n    {\n      \"name\": \"sSeperator03\",\n      \"technicalDefault\": \"\\\"\\\"\",\n      \"businessMeaning\": \"Visual separator label for the third rule set in the Properties palette.\",\n      \"validRange\": \"N/A (Static Text)\",\n      \"unit\": \"N/A\",\n      \"affectsOutput\": \"None (UI Only)\"\n    },\n    {\n      \"name\": \"sNameGroup03\",\n      \"technicalDefault\": \"|Parent floorgroup|\",\n      \"businessMeaning\": \"Selects the target destination group for the third set of identified beams.\",\n      \"validRange\": \"Groups found in the project containing 'Los' or 'Loose', or the options '|Parent floorgroup|' and '|Schwelle of parent floorgroup|'.\",\n      \"unit\": \"N/A (Selection)\",\n      \"affectsOutput\": \"Determines the group ownership of the beams matching the third set of codes.\"\n    },\n    {\n      \"name\": \"sBeamCodes03\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Defines the filter criteria for the third rule set.\",\n      \"validRange"
      },
      "tokens_used": 9942,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script (Insert or ExecuteKey)",
          "2. Check 'OnInsert' Status",
          "3. [Conditional: Master Instance] Initialize Group Selection Arrays (Parent Floor, Schwelle, 'Los'/'Loose' groups)",
          "4. [Conditional: Master Instance] Define 4 Sets of Properties (Seperator, Group Name, Beam Codes)",
          "5. [Conditional: Master Instance] Check for ExecuteKey Catalog presets",
          "6. [Conditional: Master Instance] Check Cycle Count (>1 implies recursion, stop)",
          "7. [Conditional: Master Instance] Show Dialog for Input (if no ExecuteKey)",
          "8. [Conditional: Master Instance] Prompt User to Select Elements (PrEntity)",
          "9. [Conditional: Master Instance] Clean up existing TSL instances on selected elements",
          "10. [Conditional: Master Instance] Create Satellite TSL instances on selected elements with current properties",
          "11. [Conditional: Master Instance] Report count of inserted TSLs",
          "12. [Conditional: Master Instance] Erase Master Instance",
          "13. [Conditional: Satellite Instance] Check Map for 'MasterToSatellite' flag",
          "14. [Conditional: Satellite Instance] Apply Properties from Master",
          "15. [Conditional: Satellite Instance] Validate Host Element existence",
          "16. [Conditional: Satellite Instance] Parse Properties into Target Groups and Beam Code Lists",
          "17. [Conditional: Satellite Instance] Scan Host Element Beams",
          "18. [Conditional: Satellite Instance] Move matching Beams to Target Groups",
          "19. [Conditional: Satellite Instance] Detect existing Beams in Target Groups",
          "20. [Conditional: Satellite Instance] Check for Intersections between New and Existing Beams",
          "21. [Conditional: Satellite Instance] Erase Existing Beams if Intersection Volume >= 85%",
          "22. [Conditional: Satellite Instance] Erase Satellite Instance (Self-destruct)"
        ],
        "conditionalBranches": [
          {
            "condition": "Is this a Master Insert or Satellite Execution?",
            "path1": {
              "name": "Master Insert Flow",
              "steps": [
                "Define Properties and Group Options",
                "Show Dialog (if needed)",
                "Select Elements",
                "Create Satellite TSLs",
                "Erase Self"
              ]
            },
            "path2": {
              "name": "Satellite Execution Flow",
              "steps": [
                "Receive Properties from Master",
                "Validate Host Element",
                "Parse Configuration",
                "Process Beams (Move & Replace)",
                "Erase Self"
              ]
            }
          },
          {
            "condition": "Does a selected Element contain this Script already?",
            "path1": {
              "name": "Clean Re-insert",
              "steps": [
                "Find existing TSL instance",
                "Erase old instance",
                "Create new instance with current props"
              ]
            },
            "path2": {
              "name": "Fresh Insert",
              "steps": [
                "No cleanup required",
                "Create new instance"
              ]
            }
          },
          {
            "condition": "Is the Target Group a Special Keyword (Parent/Schwelle) or a Real Group?",
            "path1": {
              "name": "Special Group Logic",
              "steps": [
                "Construct Group object based on Host Element's name parts",
                "Target: Floor (NamePart 1) or Schwelle (NamePart 1 + 'Schwelle')"
              ]
            },
            "path2": {
              "name": "Specific Group Logic",
              "steps": [
                "Retrieve Group object from pre-filtered array",
                "Target: The specific group selected from dropdown"
              ]
            }
          },
          {
            "condition": "Does a Beam from the Element match any Beam Code list?",
            "path1": {
              "name": "Match Found",
              "steps": [
                "Identify matching Rule Set (1-4)",
                "Assign Beam to the corresponding Target Group",
                "Add to 'New Beams' list for replacement check"
              ]
            },
            "path2": {
              "name": "No Match",
              "steps": [
                "Beam remains in original group",
                "No further action for this beam"
              ]
            }
          },
          {
            "condition": "Does a New Beam intersect significantly with an Existing Beam in the Target Group?",
            "path1": {
              "name": "Significant Intersection (>= 85%)",
              "steps": [
                "Calculate intersection volume",
                "Verify volume ratio",
                "Erase Existing Beam (Replacement)"
              ]
            },
            "path2": {
              "name": "No Intersection or Minor Intersection",
              "steps": [
                "Keep Existing Beam",
                "New Beam is added to group"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Recursion / Cycle Count",
            "errorMessage": "None (Silent Exit)",
            "recovery": "Script prevents re-entry during its own insert cycle."
          },
          {
            "check": "Selected Element Validity (Satellite)",
            "errorMessage": "|Invalid selection|!",
            "recovery": "User selects valid Element. Script erases self if invalid."
          },
          {
            "check": "Group Existence (Configuration)",
            "errorMessage": "|Group not found|! [Script] is not executed for element [Code]",
            "recovery": "User must select a valid group from the dropdown (or ensure the named group exists). Script erases self."
          },
          {
            "check": "Execute Key Validity",
            "errorMessage": "None (Defaults to Dialog)",
            "recovery": "If the key used to insert isn't a valid catalog name, the Properties dialog opens."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Beam Codes / Groups",
            "how": "Select Element -> Properties Palette (OPM)",
            "effect": "Updating 'Beamcodes' or 'Group' properties and forcing a recalc (or re-running the script) re-processes the element, moving beams and replacing old ones based on new rules."
          },
          {
            "action": "Re-run on same Elements",
            "how": "Re-insert script and select previously processed elements",
            "effect": "The script detects old instances, erases them, and applies the current configuration settings freshly."
          }
        ]
      },
      "tokens_used": 9697,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-LooseDelivery.mcr\n\n## Overview\nThis tool reorganizes loose timber parts within selected construction elements. It automatically moves specific beams (based on their beam codes) from the main element into designated \"Loose Delivery\" or \"Sill\" groups, replacing any existing outdated beams in the destination groups to ensure your packaging lists are accurate.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Not designed for 2D detailing generation. |\n\n## Prerequisites\n- **Required Entities**: You must have Elements (e.g., Walls, Roofs) already drawn in the model.\n- **Group Structure**: The destination groups (e.g., groups named \"Los\" or \"Loose\") must exist in your project structure if you intend to use specific groups, rather than the \"Parent floorgroup\" option.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\n- Select `HSB_G-LooseDelivery.mcr` from the file dialog.\n\n### Step 2: Configure Properties\n- Immediately after selection, the **Properties Palette** will appear.\n- **Action**: Set up the rules for moving beams (see *Properties Panel Parameters* below).\n- Once configured, close the Properties Palette to proceed.\n\n### Step 3: Select Elements\n```\nCommand Line: Select one or more elements\nAction: Click on the Elements (walls/floors) in the model or draw a selection window.\n```\n- Press **Enter** to confirm selection.\n\n### Step 4: Execution\n- The script will attach to the selected elements, scan the beams inside them, and move any matching beams to the specified groups.\n- Existing beams in the target groups that intersect with the new beams (by more than 85%) will be automatically deleted.\n\n## Properties Panel Parameters\n\nYou can define up to 4 different rule sets (Loose delivery 1 through 4) to move beams to different locations simultaneously.\n\n### Common Parameters for Loose Delivery 1-4\n\n| Parameter | Type | Options / Default | Description |\n|-----------|------|-------------------|-------------|\n| **Group** (e.g., Group 1) | Dropdown | Parent floorgroup<br>Schwelle of parent floorgroup<br>[Dynamic List] | Select the destination where the identified beams should be moved.<br>- **Parent floorgroup**: Moves beams to the main group of the element.<br>- **Schwelle...**: Moves beams to the sill plate group associated with the element.<br>- **Dynamic List**: Shows any existing group in the project containing \"Los\" or \"Loose\" in its name. |\n| **Beamcodes** (e.g., Beamcodes 1) | Text | Empty | Enter the beam codes to filter. Separate multiple codes with a semicolon (;).<br>Example: `STUD;BLOCK;TRIM` |\n\n*(Note: Parameters labeled \"Separator\" are visual headers only and cannot be edited.)*\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Forces the script to re-scan the element. Use this if you have changed the Beam Codes or Group settings in the properties. |\n\n## Settings Files\n- No external settings files are used for this script.\n\n## Tips\n- **Updating Lists**: If you modify the element and new loose parts are generated, simply right-click the element and select **Recalculate**. The script will update the loose delivery groups accordingly.\n- **Replacing Old Parts**: The script automatically deletes overlapping beams in the target group. This prevents duplicates when updating packaging lists.\n- **Code Matching**: Ensure your Beam Codes are entered exactly as they appear in the Element or Beams. The check is case-sensitive based on your database settings.\n\n## FAQ\n- **Q: What does \"Schwelle of parent floorgroup\" mean?**\n  - A: It refers to a specific group named after the floor level with the suffix \"Schwelle\" (e.g., if the floor is \"01_GF\", the target group would be \"01_GFSchwelle\"). This is useful for separating sill plates from the main structure.\n\n- **Q: Can I use this to move beams to a completely new group?**\n  - A: The dropdown dynamically looks for groups with \"Los\" or \"Loose\" in the name. Create a group in your project tree with one of these keywords (e.g., \"DeliveryLoose\") before running the script, and it will appear in the list.\n\n- **Q: Why did some beams not move?**\n  - A: Check the **Beamcodes** field. Ensure the codes of the beams you want to match are spelled correctly and separated by semicolons. If the beam code in the model does not match the list, it will remain in the original group."
      },
      "tokens_used": 7429,
      "error": null
    }
  }
}