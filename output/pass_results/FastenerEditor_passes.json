{
  "filename": "FastenerEditor.mcr",
  "status": "completed",
  "total_tokens": 49262,
  "processing_time": 241.54906797409058,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": null,\n  \"versionHistory\": [\n    {\n      \"version\": \"2.1\",\n      \"date\": \"17.10.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-24011 fastener types are cached, graphics on drag improved\"\n    },\n    {\n      \"version\": \"2.0\",\n      \"date\": \"15.10.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-24011 When inserting the fastener editor without any existing styles, the user will be prompted to create styles from the database.\"\n    },\n    {\n      \"version\": \"1.9\",\n      \"date\": \"14.10.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-24419 sequence of head components fixed when saving the style\"\n    },\n    {\n      \"version\": \"1.8\",\n      \"date\": \"10.10.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-24043 FastenerEditor style import improved, condensed display of length list when dragging\"\n    },\n    {\n      \"version\": \"1.7\",\n      \"date\": \"20.05.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-24054 type bolt set as default when creating styles\"\n    },\n    {\n      \"version\": \"1.6\",\n      \"date\": \"19.05.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-24054 location property set to 'closing end' when using with bolts and nuts\"\n    },\n    {\n      \"version\": \"1.5\",\n      \"date\": \"16."
      },
      "tokens_used": 8964,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No sd_* or Multipage* prefixes detected. No #Type E with _Entity[] found. Script utilizes GenBeam and Point3d in a general 3D context. Uses 'Model Space' context for creating TSL instances (bForceModelSpace = true)."
        },
        "prerequisites": {
          "requiredEntities": [
            "FastenerAssemblyDef"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "TslUtilities.dll",
            "FastenerManager.dll"
          ]
        }
      },
      "tokens_used": 5792,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10164,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A configuration tool used to create, import, and manage fastener assembly styles (such as bolts, screws, and dowels) from a central database for use in timber connections.",
          "category": "Hardware / Configuration",
          "typicalUseCase": "Used by engineers or detailers to define the geometric and material properties of a fastener type before applying it to structural timber connections via hsbCAD's automation tools."
        },
        "parameters": [
          {
            "name": "kManufacturer / sFManufacturer",
            "technicalDefault": "Any",
            "businessMeaning": "The brand or supplier of the fastener (e.g., Simpson, SFS, MTC). This filters the available database entries.",
            "validRange": "Specific manufacturers available in the FastenerManager database",
            "unit": "String",
            "affectsOutput": "Filters the list of available fastener models and families presented to the user."
          },
          {
            "name": "kType (FastenerType)",
            "technicalDefault": "kFTBolt (Bolt)",
            "businessMeaning": "The general category of the fastener assembly (Screw, Bolt, Threaded Rod, Anchor Bolt, Dowel Rod).",
            "validRange": "Screw, Bolt, ThreadedRod, AnchorBolt, DowelRod",
            "unit": "Enumeration",
            "affectsOutput": "Determines the structural calculation method, available sub-components (e.g., nuts for bolts), and default visual representation."
          },
          {
            "name": "kDiameter",
            "technicalDefault": "--All--",
            "businessMeaning": "The nominal diameter of the fastener shaft.",
            "validRange": "4mm to 30mm (Typical timber fasteners: M6, M8, M10, M12, M14, M16, M20, M24)",
            "unit": "mm",
            "affectsOutput": "Sets the physical thickness of the shaft and the required drill hole size in the timber components."
          },
          {
            "name": "kHeadType (SelectedHeadType)",
            "technicalDefault": "--All--",
            "businessMeaning": "The shape of the fastener head (e.g., Hex, Flat, Pan, Washer Head).",
            "validRange": "FlatHead, HexHead, PanHead, RoundHead, WasherHead, etc.",
            "unit": "String",
            "affectsOutput": "Controls the 3D geometry of the fastener head and the visual clearance required on the timber surface."
          },
          {
            "name": "kLength",
            "technicalDefault": "Not Defined",
            "businessMeaning": "The total length of the fastener shaft.",
            "validRange": "20mm to 1000mm+ (Commonly in 5mm or 10mm increments)",
            "unit": "mm",
            "affectsOutput": "Determines the penetration depth through timber layers."
          },
          {
            "name": "sLocations (Location)",
            "technicalDefault": "Closing end",
            "businessMeaning": "Specifies where closing components (like washers and nuts) are placed relative to the timber assembly.",
            "validRange": "Head Component, Closing Component, Head+Closing Component",
            "unit": "String",
            "affectsOutput": "Stacks washers/nuts on the driving side (Head), the exit side (Closing/Tail), or both sides of the timber beam."
          },
          {
            "name": "nMode",
            "technicalDefault": "0",
            "businessMeaning": "Operational mode of the editor. 0 = General Style Editor; 1 = Editing Head Components; 2 = Editing Tail Components; 98 = Edit Style Mode.",
            "validRange": "0, 1, 2, 98",
            "unit": "Integer",
            "affectsOutput": "Changes the context menu options and the specific properties available for editing (e.g., only head washers in Mode 1)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "kType set to 'Bolt'",
            "effect": "Enables availability of 'Nut' and 'Washer' components in the style.",
            "cascade": [
              "sLocations",
              "kCTNut",
              "kCTWasher"
            ]
          },
          {
            "trigger": "kType set to 'Screw'",
            "effect": "Typically disables closing components (nuts) as screws thread into the material.",
            "cascade": [
              "sLocations"
            ]
          },
          {
            "trigger": "nMode changes (0 -> 1 or 2)",
            "effect": "Filters the component list to show only Head or Tail parts.",
            "cascade": [
              "kCTypes"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "FastenerAssemblyDef",
            "description": "A persistent style definition stored in the drawing database that describes the complete makeup of a fastener (shaft, head, washers, nuts).",
            "appliedTo": "Global Drawing Database"
          },
          {
            "type": "SimpleFastener (TSL)",
            "description": "Visual preview instances created when selecting styles from the database to allow the user to verify the configuration.",
            "appliedTo": "Model Space (Temporary/Preview)"
          }
        ]
      },
      "tokens_used": 9043,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Initialization: Verify FastenerManager.dll exists. If missing, report error and exit.",
          "Determine Execution Mode: Check 'mode' property in _Map (0=General, 1=Head Edit, 2=Tail Edit, 98=Style Edit).",
          "Check Recalc Triggers: If _bOnRecalc is true, check for specific ExecuteKeys from context menus.",
          "Trigger: Open Database Manager: Calls FastenerManager to open external configuration.",
          "Trigger: Show Style Manager: Pushes AutoCAD command to open the Aec Style Manager palette.",
          "Trigger: Load Graphical Ruleset: Pushes AutoCAD command to import graphical rules.",
          "Trigger: Import Styles: Prompts user to select a DWG file. Reads FastenerAssemblyDef strings from the file, prompts for overwrite strategy (Overwrite/Skip), imports definitions, and updates existing fasteners in the drawing.",
          "Trigger: Create Styles from Database: Launches 'SimpleFastener' TSL in 'edit style' mode (98) with a filter map (defaulting to Bolt type). This allows the user to visually select components to generate new styles.",
          "Standard Insert/Recalc Loop: If no triggers are active, the script proceeds to manage the current state of the Fastener Editor instance.",
          "Dynamic Mode Handling: The script adjusts available 'Location' options based on 'nMode'. Mode 0 allows 'Head+Closing Component', while Modes 1 & 2 restrict to Head or Tail only.",
          "Preview Generation: Script instances are created to visually represent the fastener configuration based on selected properties (Manufacturer, Type, Diameter, etc.)."
        ],
        "conditionalBranches": [
          {
            "condition": "DLL Availability Check",
            "path1": {
              "name": "Success",
              "steps": [
                "Script continues initialization.",
                "Load functions from FastenerManager.dll."
              ]
            },
            "path2": {
              "name": "Failure",
              "steps": [
                "Report error 'Could not find file: [Path]'.",
                "Terminate script execution."
              ]
            }
          },
          {
            "condition": "Import Styles - Overwrite Conflict",
            "path1": {
              "name": "Overwrite",
              "steps": [
                "User selects 'Yes' to overwrite.",
                "Existing styles in drawing are replaced by imported definitions.",
                "Fasteners using old styles are recalculated."
              ]
            },
            "path2": {
              "name": "Skip",
              "steps": [
                "User selects 'No' to keep existing.",
                "Imported styles that conflict are ignored.",
                "Only new styles are added."
              ]
            }
          },
          {
            "condition": "Execution Mode (nMode)",
            "path1": {
              "name": "General Editor (0)",
              "steps": [
                "Full range of fastener properties available.",
                "Locations includes 'Head+Closing Component'."
              ]
            },
            "path2": {
              "name": "Component Editor (1 or 2)",
              "steps": [
                "Editing specific Head (1) or Tail (2) components.",
                "Locations restricted to specific side.",
                "Context menu options filtered for components."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "FastenerManager.dll Existence",
            "errorMessage": "Could not find file: [InstallPath]\\Utilities\\FastenerManager\\FastenerManager.dll",
            "recovery": "Ensure hsbCAD is correctly installed and the FastenerManager module is present."
          },
          {
            "check": "File Selection for Import",
            "errorMessage": "None",
            "recovery": "If user cancels file dialog, the import process aborts silently without error."
          },
          {
            "check": "Map Keys and Integrity",
            "errorMessage": "None explicit in code",
            "recovery": "Script handles missing Map entries using defaults (e.g., 'Not Defined', empty strings)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Import Styles from another drawing",
            "how": "Right-click Context Menu -> 'Import Styles'",
            "effect": "Opens file dialog to select a DWG, imports fastener definitions, and updates model instances."
          },
          {
            "action": "Create new styles from Database",
            "how": "Right-click Context Menu -> 'Create Styles from Database'",
            "effect": "Launches a graphical selector to pick parts and generate a new FastenerAssemblyDef."
          },
          {
            "action": "Open external database configuration",
            "how": "Right-click Context Menu -> 'Open Database Manager'",
            "effect": "Opens the FastenerManager configuration window."
          },
          {
            "action": "Modify Fastener Type / Configuration",
            "how": "Properties Palette (OPM) / Right-click Context Menu",
            "effect": "Changes Manufacturer, Type, Diameter, etc., and updates the visual preview/instances."
          }
        ]
      },
      "tokens_used": 8893,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# FastenerEditor.mcr\n\n## Overview\nThis script serves as a configuration tool to create, import, and manage fastener assembly styles (such as bolts, screws, and dowels) from a central database. It allows users to define the geometric and material properties of fasteners before applying them to structural timber connections.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script runs in Model Space to manage fastener definitions and previews. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: None (Creates `FastenerAssemblyDef` styles).\n- **Minimum Beam Count**: 0.\n- **Required Settings Files**:\n    - `TslUtilities.dll`\n    - `FastenerManager.dll` (Must be present in the hsbCAD Utilities folder).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `FastenerEditor.mcr` from the list.\n*Note: Upon insertion, if no existing fastener styles are detected in the drawing, you will be automatically prompted to create styles from the database.*\n\n### Step 2: Initial Insertion\n```\nCommand Line: Select insertion point:\nAction: Click in the Model Space to place the Fastener Editor instance.\n```\n\n### Step 3: Configure Fastener Styles\nOnce inserted, use the **Properties Palette** (Ctrl+1) to filter available fasteners or use the **Right-Click Context Menu** to manage styles.\n1.  Select the inserted `FastenerEditor` object.\n2.  In the Properties Palette, select the **Manufacturer**, **Type** (Bolt, Screw, etc.), and **Diameter** to filter the list of available fasteners.\n3.  Select a specific **Fastener Style** from the list to generate a visual preview.\n\n### Step 4: Import or Create New Styles (Optional)\nIf the required fastener is not in the list:\n1.  Right-click the `FastenerEditor` object.\n2.  Select **Create Styles from Database** to launch the graphical selector and generate new styles.\n3.  OR select **Import Styles** to load definitions from an external DWG file.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **kManufacturer** | String | Any | Filters the fastener list by supplier/brand (e.g., Simpson, SFS). |\n| **kType** | Dropdown | Bolt | Defines the fastener category (Screw, Bolt, ThreadedRod, AnchorBolt, DowelRod). |\n| **kDiameter** | Number | --All-- | The nominal diameter of the fastener shaft (e.g., M12, M16). |\n| **kHeadType** | String | --All-- | The shape of the fastener head (e.g., Hex, Flat, Pan). |\n| **kLength** | Number | Not Defined | The total length of the fastener shaft. |\n| **sLocations** | String | Closing end | Defines where washers and nuts are placed (Head, Closing Component, or Both). |\n| **nMode** | Integer | 0 | Operational mode: 0=General, 1=Edit Head Components, 2=Edit Tail Components. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Open Database Manager** | Launches the external FastenerManager configuration window to edit the central database. |\n| **Show Style Manager** | Opens the AutoCAD Style Manager palette to manage Aec styles. |\n| **Load Graphical Ruleset** | Imports graphical rules for fasteners. |\n| **Import Styles** | Prompts you to select a DWG file to import fastener definitions into the current drawing. |\n| **Create Styles from Database** | Launches a visual selector allowing you to pick components and generate new FastenerAssemblyDef styles. |\n\n## Settings Files\n- **Filename**: `FastenerManager.dll`\n- **Location**: `hsbCAD Install Path\\Utilities\\FastenerManager\\`\n- **Purpose**: This library provides the connection to the fastener database and handles the logic for creating and managing fastener styles.\n\n## Tips\n- **Importing Styles**: Use the \"Import Styles\" function to copy fastener configurations from a standard template drawing to your current project, ensuring consistency across the team.\n- **Visual Preview**: The script creates visual preview instances (`SimpleFastener`) in the model space when you select a style. This allows you to verify the geometry (head type, washer location) before using the fastener in connections.\n- **Component Editing**: If you need to adjust only the head (e.g., change a washer) without affecting the tail, change the `nMode` property to **1**. Use **2** for the tail components.\n\n## FAQ\n- **Q: I get an error \"Could not find file... FastenerManager.dll\".**\n  **A:** Ensure hsbCAD is installed correctly and the `FastenerManager.dll` is present in the Utilities folder. Without this file, the script cannot access the fastener database.\n- **Q: Can I use my own custom fastener shapes?**\n  **A:** You can import styles from other drawings that contain custom `FastenerAssemblyDef` definitions using the \"Import Styles\" context menu option.\n- **Q: What happens if I import a style that already exists?**\n  **A:** The script will ask if you want to **Overwrite** the existing style or **Skip** it. Select \"Overwrite\" to update the style to the imported version."
      },
      "tokens_used": 6406,
      "error": null
    }
  }
}