{
  "filename": "HSB_E-TimberPercentageArea.mcr",
  "status": "completed",
  "total_tokens": 49482,
  "processing_time": 562.6938142776489,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl visualizes the outline of zone 0 and calculates the volume of the timbers as a percentage of the total volume",
        "versionHistory": [
          {
            "version": "4.0",
            "date": "15/07/2025",
            "author": "Robert Pol",
            "changes": "First version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7786,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script targets hsbCAD Elements (Walls/Roofs) using _Element[] and accesses 3D geometry via element.coordSys() and beam.realBody(). It calculates areas using PlaneProfile and stores data in Element ExtendedProperties. There are no Paper Space indicators (Viewport, sd_ prefix, #Type E) or 2D layout generation logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element (Wall, Floor, or Roof)",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": [
            "PainterDefinition (referenced by name)",
            "HatchPatterns (referenced by name)",
            "DimStyles (referenced by name)"
          ]
        }
      },
      "tokens_used": 6400,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 9512,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Calculates and visualizes the percentage of a specific planar area that is covered by structural timber, used for verifying solidity or insulation coverage.",
          "category": "Analysis",
          "typicalUseCase": "Determining the timber coverage ratio for specific wall or floor sections (e.g., ensuring a floor has enough material for structural integrity or acoustic requirements)."
        },
        "parameters": [
          {
            "name": "sPainter",
            "technicalDefault": "|Beam Painter Filter|",
            "businessMeaning": "Filters which beams are included in the percentage calculation based on specific attributes (e.g., excluding metal plates or specific wood types).",
            "validRange": "Any valid Painter Definition name",
            "unit": "String",
            "affectsOutput": "Changes the numerator (Timber Area) in the calculation by excluding non-matching beams from the analysis."
          },
          {
            "name": "sProfile",
            "technicalDefault": "|PLINE|",
            "businessMeaning": "A unique label for this specific analysis area (e.g., 'Zone A', 'Core'), allowing multiple different calculations on the same element.",
            "validRange": "Any alphanumeric string",
            "unit": "String",
            "affectsOutput": "Acts as a key to store/retrieve data in Extended Properties. Does not change geometry directly but distinguishes calculations."
          },
          {
            "name": "sDimensionStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Controls the font size, text style, and arrow type of the percentage label displayed in the CAD model.",
            "validRange": "Any existing Dimension Style in the project",
            "unit": "String",
            "affectsOutput": "Visual appearance of the result text only."
          },
          {
            "name": "sShowPlaneProfile",
            "technicalDefault": "|No|",
            "businessMeaning": "Toggles the visibility of the individual beam outlines within the analysis zone.",
            "validRange": "|No|, |Yes|",
            "unit": "Boolean",
            "affectsOutput": "Visual display of the timber geometry cross-sections."
          },
          {
            "name": "iColor",
            "technicalDefault": "-1",
            "businessMeaning": "Sets the display color for the analysis boundary and the percentage text.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "ACI",
            "affectsOutput": "Visual color of the generated geometry."
          },
          {
            "name": "sTextLayer",
            "technicalDefault": "Information",
            "businessMeaning": "Assigns the resulting percentage text to a specific CAD layer for drawing organization.",
            "validRange": "Tooling, Information, Zone, Element",
            "unit": "Layer Name",
            "affectsOutput": "Layer property of the text entity."
          },
          {
            "name": "sBodyLayer",
            "technicalDefault": "Zone",
            "businessMeaning": "Assigns the boundary profile (the outline of the calculation zone) to a specific CAD layer.",
            "validRange": "Tooling, Information, Zone, Element",
            "unit": "Layer Name",
            "affectsOutput": "Layer property of the boundary polyline."
          },
          {
            "name": "sShowHatch",
            "technicalDefault": "|No|",
            "businessMeaning": "Toggles a hatch pattern to visually highlight the timber-covered areas.",
            "validRange": "|No|, |Yes|",
            "unit": "Boolean",
            "affectsOutput": "Visual representation of the solid timber areas."
          },
          {
            "name": "hatchPattern",
            "technicalDefault": "_HatchPatterns",
            "businessMeaning": "Selects the specific graphic pattern (e.g., SOLID, ANSI31) used to fill the timber areas.",
            "validRange": "Any loaded Hatch Pattern",
            "unit": "String",
            "affectsOutput": "Visual style of the hatch."
          },
          {
            "name": "patternScale",
            "technicalDefault": "U(1)",
            "businessMeaning": "Adjusts the density or size of the hatch pattern.",
            "validRange": "0.1 to 1000+ (depending on pattern and drawing scale)",
            "unit": "Scale",
            "affectsOutput": "Visual density of the hatch."
          },
          {
            "name": "hatchColor",
            "technicalDefault": "-1",
            "businessMeaning": "Sets the color of the hatch pattern.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "ACI",
            "affectsOutput": "Visual color of the hatch."
          },
          {
            "name": "hatchZone",
            "technicalDefault": "0",
            "businessMeaning": "Designates the hsbCAD zone in which the hatch entities are generated, affecting their visibility in filtered views.",
            "validRange": "0 to 8",
            "unit": "Zone Index",
            "affectsOutput": "Visibility grouping of the hatch entities."
          },
          {
            "name": "dDepth",
            "technicalDefault": "- U(1)",
            "businessMeaning": "Offsets the calculation plane from the element origin along the Z-axis (thickness/height). Negative values default to the element center.",
            "validRange": "Any real number (negative for auto-center)",
            "unit": "mm",
            "affectsOutput": "Determines the 3D slice location where the area is calculated, which can significantly affect the percentage if beams taper or vary in depth."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sShowHatch is set to '|Yes|'",
            "effect": "Enables the use of hatchPattern, patternScale, and hatchColor parameters. If '|No|', these are ignored.",
            "cascade": [
              "hatchPattern",
              "patternScale",
              "hatchColor"
            ]
          },
          {
            "trigger": "dDepth <= 0",
            "effect": "The calculation plane automatically snaps to the center of the element's bounding box.",
            "cascade": [
              "PlaneProfile intersection"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "PlaneProfile (PLine)",
            "description": "The user-defined boundary of the area to be analyzed.",
            "appliedTo": "Model Space (attached to the Element)"
          },
          {
            "type": "PlaneProfile (PLine)",
            "description": "The projection of the actual beams onto the calculation plane.",
            "appliedTo": "Model Space (if sShowPlaneProfile is Yes)"
          },
          {
            "type": "Hatch",
            "description": "Graphic fill representing the timber area.",
            "appliedTo": "Model Space (if sShowHatch is Yes)"
          },
          {
            "type": "Text",
            "description": "The calculated percentage value (e.g., '65%').",
            "appliedTo": "Model Space"
          },
          {
            "type": "Extended Properties (Map)",
            "description": "Data stored on the Element: 'TimberPercentage' (Percentage, Area, AreaBrutto, AreaWood, Name).",
            "appliedTo": "Element (Wall/Floor/Roof)"
          }
        ]
      },
      "tokens_used": 8281,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script executed by user on an Element.\",\n    \"2. Script checks for an Execute Key (Catalog preset) or Manual insertion.\",\n    \"3. User is prompted to select one or more Polylines to define the analysis zone boundary.\",\n    \"4. Script creates a new TSL instance attached to the Element and stores the selected Polylines in a Map.\",\n    \"5. Script validates the Element reference and filters beams based on the selected Painter Definition.\",\n    \"6. Script calculates the slice plane for calculation (either at a user-defined depth or automatically centered on the beams).\",\n    \"7. Script projects the filtered beams onto the slice plane to determine their profile area.\",\n    \"8. Script intersects the beam profiles with the user-defined zone profile to calculate the Timber Area.\",\n    \"9. Script calculates the percentage ratio (Timber Area / Total Zone Area).\",\n    \"10. Script generates visual feedback (Text, Hatching, and Outlines) based on display settings.\",\n    \"11. Script writes the calculation results to the Element's Extended Properties.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Does an Execute Key exist during insertion?\",\n      \"path1\": {\n        \"name\": \"Catalog Preset\",\n        \"steps\": [\n          \"Script searches for a Catalog entry matching the Execute Key.\",\n          \"Properties are loaded from the Catalog configuration.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Manual Configuration\",\n        \"steps\": [\n          \"Script opens the Properties Dialog.\",\n          \"User manually selects or inputs properties (Painter, Layers, Hatch styles, etc.).\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Value of 'Profile depth' (dDepth) parameter\",\n      \"path1\": {\n        \"name\": \"Explicit Depth\",\n        \"steps\": [\n          \"Calculation plane is positioned at 'dDepth' offset from the element origin along the Z-axis.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Auto-Center\",\n        \"steps\": [\n          \"Script calculates the center point of the element's beams.\",\n          \"Calculation plane is positioned at this center point.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Does the beam profile intersect with the zone outline?\",\n      \"path1\": {\n        \"name\": \"Intersection Exists\",\n        \"steps\": [\n          \"Beam area is calculated and added to the total Timber Area.\",\n          \"Area value is written to the Beam's Extended Properties.\",\n          \"Visuals (Hatch/Profile) are drawn if enabled.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No Intersection\",\n        \"steps\": [\n          \"Beam area contribution is set to 0.\",\n          \"0 value is written to the Beam's Extended Properties.\",\n          \"Beam is ignored for visual generation.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Setting 'Show Hatch' (sShowHatch)\",\n      \"path1\": {\n        \"name\": \"Enabled (|Yes|)\",\n        \"steps\": [\n          \"Script generates Hatch entities on the calculated beam profiles.\",\n          \"Hatch uses specified pattern, scale, color, and zone.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Disabled (|No|)\",\n        \"steps\": [\n          \"Hatching is skipped.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Context menu command 'Reset Grips' triggered\",\n      \"path1\": {\n        \"name\": \"Reset Executed\",\n        \"steps\": [\n          \"Current grip positions (modified by user) are discarded.\",\n          \"Zone outline is rebuilt from the originally stored Map data (from insertion).\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Valid Element Reference\",\n      \"errorMessage\": \"Element reference not found.\",\n      \"recovery\": \"Ensure the script is executed while a valid hsbCAD Element (Wall/Roof) is selected.\"\n    },\n    {\n      \"check\": \"Existence of Beam Geometry\",\n      \"errorMessage\": \"No beam points found\",\n      \"recovery\": \"Ensure the selected Element contains beams with valid geometry.\"\n    },\n    {\n      \"check\": \"Valid Zone Area\",\n      \"errorMessage\": \"Not a valid area\",\n      \"recovery\": \"The selected Pline(s) must form a closed shape with an area greater than the tolerance (1mm^2).\"\n    },\n    {\n      \"check\": \"Beam Intersection with Zone\",\n      \"errorMessage\": \"No valid beam area found\",\n      \"recovery\": \"Adjust the 'Profile depth', ensure beams intersect the selected Pline zone, or check the Painter filter.\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Modify Analysis Zone Shape\",\n      \"how\": \"Drag the Square Grips displayed on the zone outline.\",\n      \"effect\": \"Recalculates the timber percentage and updates the text/visuals immediately to match the new shape.\"\n    },\n    {\n      \"action\": \"Adjust Calculation Depth\",\n      \"how\": \"Change 'Profile depth' (dDepth) in the Properties Palette (OPM).\",\n     "
      },
      "tokens_used": 10659,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-TimberPercentageArea.mcr\n\n## Overview\nThis script calculates and visualizes the percentage of a specific planar area (defined by a polyline boundary) that is occupied by structural timber. It is useful for verifying solidity ratios, insulation coverage, or material density within a wall, floor, or roof element.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script attaches to an Element and generates 3D/planar geometry. |\n| Paper Space | No | Not designed for layout generation. |\n| Shop Drawing | No | Not designed for manufacturing views. |\n\n## Prerequisites\n- **Required Entities**: An existing hsbCAD Element (Wall, Floor, or Roof).\n- **Minimum Beam Count**: The element must contain beams to calculate a percentage.\n- **Required Settings**:\n  - A valid **Painter Definition** (to filter beams).\n  - **Hatch Patterns** (if hatching is enabled).\n  - **Dimension Styles** (for text display).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `HSB_E-TimberPercentageArea.mcr`.\n\n### Step 2: Select Element\n```\nCommand Line: Select Element:\nAction: Click on the Wall, Floor, or Roof element you wish to analyze.\n```\n\n### Step 3: Define Analysis Zone\n```\nCommand Line: Select Polylines (for profile):\nAction: Select one or more closed polylines that represent the area boundary you want to analyze.\nNote: Press Enter to confirm selection after picking the polylines.\n```\n\n### Step 4: Configure Properties\nAction: The Properties Palette (OPM) will open. Adjust parameters like the Painter filter, visual layers, and depth of calculation as needed. The script will automatically update based on these changes.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **sPainter** | String | \\|Beam Painter Filter\\| | Selects which beams are included in the calculation (e.g., only structural wood, excluding metal plates). |\n| **sProfile** | String | \\|PLINE\\| | A unique name/ID for this specific analysis area. Used to store data in Element properties. |\n| **dDepth** | Double | - U(1) | The distance from the element origin to slice the calculation plane. Use a negative value (e.g., -1) to automatically center the slice on the element thickness. |\n| **sDimensionStyle** | String | _DimStyles | The visual style (font, size) used for the percentage text label. |\n| **iColor** | Integer | -1 | The color index (ACI) for the boundary line and text. |\n| **sTextLayer** | String | Information | The CAD layer on which the percentage text is generated. |\n| **sBodyLayer** | String | Zone | The CAD layer on which the boundary profile (outline) is generated. |\n| **sShowPlaneProfile** | Enum | \\|No\\| | Set to \\|Yes\\| to display the outline of every individual beam included in the calculation. |\n| **sShowHatch** | Enum | \\|No\\| | Set to \\|Yes\\| to hatch the areas covered by timber. |\n| **hatchPattern** | String | _HatchPatterns | The pattern name (e.g., SOLID, ANSI31) used for hatching. |\n| **patternScale** | Double | U(1) | The scale factor for the hatch pattern. |\n| **hatchColor** | Integer | -1 | The color index for the hatch pattern. |\n| **hatchZone** | Integer | 0 | The hsbCAD display zone (0-8) for the hatch entities. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Reset Grips** | Discards any manual modifications made to the analysis zone shape (via dragging) and restores it to the original polyline shape defined during insertion. |\n\n## Settings Files\nThis script references standard hsbCAD definitions by name. Ensure the following exist in your project:\n- **Painter Definitions**: To categorize beams (e.g., \"StructuralWood\").\n- **Hatch Patterns**: Standard AutoCAD/hsbCAD patterns for visual representation.\n- **DimStyles**: Text styles for labeling.\n\n## Tips\n- **Auto-Center Depth**: If your wall or floor has varying thickness, set `dDepth` to a negative value (like `-1`). This ensures the calculation plane is automatically sliced through the center of the element geometry.\n- **Filtering Beams**: Use the `sPainter` parameter to ignore non-structural components (like hardware or cladding) so your percentage reflects true timber coverage.\n- **Interactive Updates**: After insertion, you can select the generated boundary and drag its **Grips** to reshape the analysis area. The percentage will recalculate automatically.\n- **Visual Verification**: If the percentage seems low, turn on `sShowPlaneProfile` to visually verify which beams are actually being intersected by your calculation depth.\n\n## FAQ\n- **Q: Why does my percentage show 0%?**\n  - A: Check your `dDepth`. If the calculation plane is above or below the element, it won't intersect any beams. Also, verify that your `sPainter` filter is actually matching the beams in the element.\n- **Q: Can I analyze multiple separate areas in one element?**\n  - A: Yes. Insert the script multiple times on the same element, providing a unique `sProfile` name for each instance (e.g., \"Zone Left\" and \"Zone Right\").\n- **Q: How do I hide the hatch but keep the percentage text?**\n  - A: Set `sShowHatch` to \\|No\\|. The text and boundary are controlled separately by the `sTextLayer` and `sBodyLayer` parameters."
      },
      "tokens_used": 6844,
      "error": null
    }
  }
}