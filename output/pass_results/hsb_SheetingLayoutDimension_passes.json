{
  "filename": "hsb_SheetingLayoutDimension.mcr",
  "status": "completed",
  "total_tokens": 46781,
  "processing_time": 234.03281140327454,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.3",
            "date": "06.08.2012",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Fix filter for horizontal and vertical battens"
          },
          {
            "version": "1.4",
            "date": "30.08.2012",
            "author": "",
            "changes": "Exclude battens to calculate seze of element"
          },
          {
            "version": "1.5",
            "date": "19.11.2012",
            "author": "",
            "changes": "Add battens to dimension in plan view"
          },
          {
            "version": "1.6",
            "date": "21.11.2012",
            "author": "",
            "changes": "Buggfix dimension vertically the sheet and exclude locating plate"
          },
          {
            "version": "1.7",
            "date": "04.12.2012",
            "author": "",
            "changes": "Bugfix in finding the 4 vertices of the wall"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7610,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly prompts for a Viewport using getViewport() during insert. It manages a _Viewport array and calculates the transformation between Model Space and Paper Space (ms2ps). The final dimension object is transformed via ms2ps and drawn in Paper Space."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space Layout with an active Viewport showing an hsb Element",
          "requiredSettings": []
        }
      },
      "tokens_used": 5961,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select a viewport, you can add others later on with the HSB_LINKTOOLS command.",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strDir",
            "type": "PropString",
            "displayName": "Direction",
            "defaultValue": "Horizontal",
            "inputType": "dropdown",
            "options": [
              "Horizontal",
              "Vertical"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "strSide",
            "type": "PropString",
            "displayName": "Side of beams/sheets",
            "defaultValue": "Left",
            "inputType": "dropdown",
            "options": [
              "Left",
              "Center",
              "Right",
              "Left and right"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strAllZones",
            "type": "PropString",
            "displayName": "Zones to use",
            "defaultValue": "Use zone index",
            "inputType": "dropdown",
            "options": [
              "Use zone index",
              "All"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nZones",
            "type": "PropInt",
            "displayName": "Zone to dimension",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              0,
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sDeltaOnTop",
            "type": "PropString",
            "displayName": "Side of delta dimensioning",
            "defaultValue": "Above",
            "inputType": "dropdown",
            "options": [
              "Above",
              "Below"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension type",
            "defaultValue": "Delta perpendicular",
            "inputType": "dropdown",
            "options": [
              "Delta perpendicular",
              "Delta parallel",
              "Cummulative perpendicular",
              "Cummalative parallel",
              "Both perpendicular",
              "Both parallel",
              "Delta parallel, Cummalative perpendicular",
              "Delta perpendicular, Cummalative parallel"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sDimLayout",
            "type": "PropString",
            "displayName": "Dimension Style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Offset from Element",
            "defaultValue": "100",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8761,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the generation of layout dimensions for wall elements in Paper Space viewports, specifically targeting stud spacing, sheathing, or batten layouts.",
          "category": "ShopDrawing / Annotation",
          "typicalUseCase": "Used during the creation of production drawings to quickly dimension the spacing of studs or sheathing boards on a wall elevation or plan view without manual measurement."
        },
        "parameters": [
          {
            "name": "strDir",
            "technicalDefault": "Horizontal",
            "businessMeaning": "Sets the orientation of the dimension chain relative to the drawing view. 'Horizontal' measures across the wall (typically stud spacing), while 'Vertical' measures up the wall (typically plate heights or horizontal battens).",
            "validRange": "Horizontal, Vertical",
            "unit": "enum",
            "affectsOutput": "Swaps the dimension line axis between the screen X and Y axes and changes which beams are filtered for dimensioning (e.g., filtering beams perpendicular to the dimension line)."
          },
          {
            "name": "strSide",
            "technicalDefault": "Left",
            "businessMeaning": "Defines the specific reference point on the timber components to dimension to (e.g., the left face, centerline, or right face of a stud).",
            "validRange": "Left, Center, Right, Left and right",
            "unit": "enum",
            "affectsOutput": "Offsets the extension lines (witness lines) to snap to the specified face or centerline of the beams."
          },
          {
            "name": "strAllZones",
            "technicalDefault": "Use zone index",
            "businessMeaning": "Determines if the dimensioning applies to all construction layers visible in the viewport or targets a specific single layer (Zone).",
            "validRange": "Use zone index, All",
            "unit": "enum",
            "affectsOutput": "Toggles the beam collection logic between gathering every beam in the element or filtering by a specific zone index."
          },
          {
            "name": "nZones",
            "technicalDefault": "0",
            "businessMeaning": "Selects the specific construction layer (Zone) to dimension when 'Use zone index' is selected. 0 usually represents the main framing (studs), while other numbers represent sheathing or cladding layers.",
            "validRange": "0 to 10 (mapped to internal indices including negative values for cladding)",
            "unit": "index",
            "affectsOutput": "Filters the list of GenBeams to only include those belonging to the specified zone index."
          },
          {
            "name": "sDeltaOnTop",
            "technicalDefault": "Above",
            "businessMeaning": "Controls the vertical placement of the dimension text and ticks relative to the dimension line.",
            "validRange": "Above, Below",
            "unit": "enum",
            "affectsOutput": "Flips the dimension text/arrows to the opposite side of the dimension line."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "Delta perpendicular",
            "businessMeaning": "Defines the logic of the dimension values. 'Delta' shows individual spacings between members (e.g., 600, 600), while 'Cumulative' shows running totals (e.g., 600, 1200).",
            "validRange": "Delta perpendicular, Delta parallel, Cummulative perpendicular, Cummalative parallel, Both perpendicular, Both parallel, etc.",
            "unit": "enum",
            "affectsOutput": "Changes the calculation and display of dimension strings on the line (spacing vs. total length)."
          },
          {
            "name": "sDimLayout",
            "technicalDefault": null,
            "businessMeaning": "Selects the visual CAD style (text height, arrow type, color) from the project's available dimension styles.",
            "validRange": "Defined by project _DimStyles list",
            "unit": "style",
            "affectsOutput": "Updates the graphical properties (font, size, tick marks) of the resulting dimension object."
          },
          {
            "name": "dOffset",
            "technicalDefault": "100",
            "businessMeaning": "Sets the clearance distance between the wall element and the dimension line in Paper Space.",
            "validRange": "10mm - 500mm (depending on drawing scale and clutter)",
            "unit": "mm",
            "affectsOutput": "Moves the dimension line closer to or further from the wall geometry to avoid overlapping with other annotations."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "strAllZones is set to 'All'",
            "effect": "The 'nZones' parameter is ignored as the script processes all beams in the element.",
            "cascade": [
              "nZones"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Dim",
            "description": "A standard CAD dimension object placed in Paper Space, displaying spacing or cumulative lengths of structural members.",
            "appliedTo": "Paper Space Layout (aligned to the selected Viewport)"
          }
        ]
      },
      "tokens_used": 8303,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch script in Paper Space Layout",
          "Execute _bOnInsert block: Prompt user 'Select a viewport'",
          "Store selected Viewport in _Viewport array and terminate script execution",
          "Script re-executes via automatic recalculation (Post-insert)",
          "Retrieve last Viewport from _Viewport array",
          "Validate Viewport contains a valid hsb Element (return if invalid)",
          "Calculate Model Space to Paper Space transformation (ms2ps, ps2ms)",
          "Determine Element orientation in Viewport: Map Element local axes (vx, vy, vz) to Screen axes (_XW, _YW) based on parallelism and codirectionality checks",
          "Collect all Beams from Element to determine bounding box (excluding locating plates in Zone 0)",
          "Project element vertices onto a plane to find extreme corners (Top-Left, Bottom-Left, Top-Right, Bottom-Right)",
          "Calculate origin point for dimension line using Bottom-Left corner and User Offset (dOffset)",
          "Initialize Dimension Line (lnPs) orientation based on 'Direction' property (Horizontal = _XW, Vertical = _YW)",
          "Set filtering vector (vFilter) perpendicular to dimension direction",
          "Branch: Select beams based on 'Zones to use' (strAllZones) property",
          "Filter selected beams based on orientation (dot product check against vFilter)",
          "Collect dimension points (pntsMs) from filtered beams using 'Side of beams/sheets' (nSide)",
          "Append Element boundary corners (BL/BR or TL/BL) to point list",
          "Sort and project points onto the dimension sort line",
          "Generate Dimension object (Dim) in Model Space using calculated points and dimension styles",
          "Transform Dimension object to Paper Space (ms2ps)",
          "Set final visual properties (Read direction, Text side) and Draw",
          "Display output in Viewport"
        ],
        "conditionalBranches": [
          {
            "condition": "Script Execution State",
            "path1": {
              "name": "Insert Mode (_bOnInsert == true)",
              "steps": [
                "Prompt for Viewport selection",
                "Append to _Viewport array",
                "Return immediately"
              ]
            },
            "path2": {
              "name": "Recalculation Mode (_bOnInsert == false)",
              "steps": [
                "Run dimensioning logic",
                "Update graphics"
              ]
            }
          },
          {
            "condition": "Element Axis Alignment",
            "path1": {
              "name": "Element X || Screen X",
              "steps": [
                "vx = Element X",
                "Determine vy from Element Y or Z based on Screen Y alignment"
              ]
            },
            "path2": {
              "name": "Element Y || Screen X",
              "steps": [
                "vx = Element Y",
                "Determine vy from Element X or Z based on Screen Y alignment"
              ]
            },
            "path3": {
              "name": "Element Z || Screen X",
              "steps": [
                "vx = Element Z",
                "Determine vy from Element X or Y based on Screen Y alignment"
              ]
            },
            "path4": {
              "name": "No Alignment",
              "steps": [
                "Report 'Error! Vectors not aligned'",
                "Return (Abort)"
              ]
            }
          },
          {
            "condition": "Zones Selection (strAllZones)",
            "path1": {
              "name": "Use zone index (Specific Zone)",
              "steps": [
                "Check if nZone == 0 (Main Structure)",
                "If 0: Get GenBeams(0), filter out invalid beams, collect dim points",
                "If > 0: Get GenBeams(nZone), filter beams using specific logic (check vecX || Element Y for Beams, accept all others), calculate extreme vertices, collect dim points"
              ]
            },
            "path2": {
              "name": "All Zones",
              "steps": [
                "Get all GenBeams in Element",
                "Filter beams based on global vFilter (perpendicular to dim line)",
                "Collect dim points"
              ]
            }
          },
          {
            "condition": "Direction Property (strDir)",
            "path1": {
              "name": "Horizontal",
              "steps": [
                "Set Dim Line Dir to _XW",
                "Set Filter Vector to Element Y",
                "Append Bottom-Left and Bottom-Right corners to points"
              ]
            },
            "path2": {
              "name": "Vertical",
              "steps": [
                "Set Dim Line Dir to _YW",
                "Set Filter Vector to Element X",
                "Append Top-Left and Bottom-Left corners to points"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "_Viewport array availability",
            "errorMessage": "None (Silent return)",
            "recovery": "Insert script correctly to ensure Viewport is selected"
          },
          {
            "check": "Viewport contains valid hsb Element (vp.element().bIsValid())",
            "errorMessage": "None (Silent return)",
            "recovery": "Select a viewport that contains a valid hsbCAD element/wall"
          },
          {
            "check": "Element vectors align with screen axes",
            "errorMessage": "'Error!\\nVectors not aligned.'",
            "recovery": "Ensure the viewport is rotated to a standard orthographic view (Front, Left, etc.) where the wall is straight vertically/horizontally on screen"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimension Orientation",
            "how": "OPM Property 'Direction' (Horizontal/Vertical)",
            "effect": "Rotates dimension line 90 degrees and swaps the set of members being dimensioned (studs vs plates/battens)."
          },
          {
            "action": "Change Reference Side",
            "how": "OPM Property 'Side of beams/sheets' (Left/Center/Right/Left and right)",
            "effect": "Offsets the dimension witness lines to snap to different faces of the timber members."
          },
          {
            "action": "Filter by Zone",
            "how": "OPM Properties 'Zones to use' and 'Zone to dimension'",
            "effect": "Switches dimensioning target between the main timber frame (Zone 0) and specific sheathing/cladding layers (Zones 1-10)."
          },
          {
            "action": "Adjust Offset",
            "how": "OPM Property 'Offset from Element'",
            "effect": "Moves the dimension line closer to or further from the wall element in Paper Space."
          },
          {
            "action": "Change Dimension Type/Style",
            "how": "OPM Properties 'Dimension type', 'Side of delta dimensioning', 'Dimension Style'",
            "effect": "Alters the numerical format (Delta vs Cumulative), text position, and graphical style (arrows/ticks/text size) of the dimension."
          }
        ]
      },
      "tokens_used": 9152,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SheetingLayoutDimension.mcr\n\n## Overview\nAutomates the generation of layout dimensions for wall elements in Paper Space viewports. It is used to quickly dimension stud spacing, sheathing boards, or battens on production drawings without manual measurement.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for annotations in layouts. |\n| Paper Space | Yes | Script operates inside a layout tab on a selected viewport. |\n| Shop Drawing | Yes | Used for creating production drawings and elevations. |\n\n## Prerequisites\n- **Required Entities:** A Layout tab containing a Viewport that displays an hsbCAD Element (e.g., a wall).\n- **Minimum Beam Count:** 0 (The script detects element boundaries even if no beams are present).\n- **Required Settings:** None.\n- **View Orientation:** The Viewport must be set to an orthographic view (Front, Back, Left, Right, or Plan). The wall must appear perfectly vertical or horizontal on the screen.\n\n## Usage Steps\n\n### Step 1: Launch Script\nNavigate to the desired Layout tab in AutoCAD.\n1. Type `TSLINSERT` in the command line.\n2. Browse and select `hsb_SheetingLayoutDimension.mcr`.\n\n### Step 2: Select Viewport\n```\nCommand Line: Select a viewport, you can add others later on with the HSB_LINKTOOLS command.\nAction: Click inside or on the border of the viewport showing the wall you wish to dimension.\n```\n*Note: Once selected, the script will immediately calculate and place the dimension based on default properties.*\n\n### Step 3: Adjust Properties\n1. Select the dimension object (or the script anchor) if not already selected.\n2. Open the **Properties** palette (Ctrl+1).\n3. Modify parameters such as **Direction**, **Dimension type**, or **Offset** to fit your drawing standards.\n4. The dimension will update automatically as you change properties.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Direction | dropdown | Horizontal | Sets the orientation of the dimension chain. **Horizontal** measures across the wall (stud spacing), **Vertical** measures up the wall (plate heights/battens). |\n| Side of beams/sheets | dropdown | Left | Determines which face of the timber members the dimension lines snap to (Left face, Centerline, Right face, or Both sides). |\n| Zones to use | dropdown | Use zone index | Chooses between dimensioning a specific construction layer or all layers in the element. |\n| Zone to dimension | number | 0 | Selects the specific layer to dimension (when \"Use zone index\" is active). 0 is typically the main frame (studs); 1+ usually indicates sheathing or cladding. |\n| Side of delta dimensioning | dropdown | Above | Controls whether the dimension text/ticks appear above or below the dimension line. |\n| Dimension type | dropdown | Delta perpendicular | Defines the calculation logic. **Delta** shows individual spacing (e.g., 600, 600), while **Cumulative** shows running totals (e.g., 600, 1200). |\n| Dimension Style | dropdown | *(Project List)* | Selects the visual CAD style (text height, arrow style, color) from the project's available dimension styles. |\n| Offset from Element | number | 100 | Sets the distance (in mm) between the wall element and the dimension line in Paper Space. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None available | This script does not add specific custom commands to the right-click context menu. Use the Properties palette to modify settings. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **View Alignment:** If you see an error \"Vectors not aligned,\" check your viewport. The wall must be straight (not rotated relative to the screen edges). Use AutoCAD's `PLAN` command or `UCS` `World` to align the view before running the script.\n- **Clutter Control:** If the dimension overlaps with other notes, increase the **Offset from Element** value in the properties.\n- **Switching Layers:** To dimension sheathing instead of studs, set **Zones to use** to \"Use zone index\" and change **Zone to dimension** to `1` (or the appropriate index for your cladding material).\n- **Multiple Viewports:** You can run the script multiple times on the same layout to dimension different viewports independently.\n\n## FAQ\n- **Q: Why does the script disappear after I select the viewport?**\n  A: The script calculates the position based on the current view. If the view is not perfectly aligned (orthographic), the script may fail to find the wall edges silently or report an error. Ensure the wall is strictly horizontal or vertical in the viewport.\n- **Q: Can I dimension both studs and sheathing at the same time?**\n  A: Not simultaneously on the same line. You must insert the script twice: once configured for Zone 0 (studs) and once configured for Zone 1 (sheathing).\n- **Q: How do I change between \"Delta\" (spacing) and \"Cumulative\" (total length) dimensions?**\n  A: Select the dimension, open Properties, and change the **Dimension type** option (e.g., switch from \"Delta perpendicular\" to \"Cummulative perpendicular\")."
      },
      "tokens_used": 6994,
      "error": null
    }
  }
}