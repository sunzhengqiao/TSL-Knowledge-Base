{
  "filename": "hsb_Lifting Holes.mcr",
  "status": "completed",
  "total_tokens": 58158,
  "processing_time": 495.5373840332031,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "21.05.2008",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "30.05.2008",
            "author": "",
            "changes": "Add property for the weight of each zone"
          },
          {
            "version": "1.2",
            "date": "17.06.2008",
            "author": "",
            "changes": "Add Support for Master Panels"
          },
          {
            "version": "1.3",
            "date": "20.06.2008",
            "author": "",
            "changes": "Set the default values"
          },
          {
            "version": "1.4",
            "date": "20.06.2008",
            "author": "",
            "changes": "Change the display"
          },
          {
            "version": "1.5",
            "date": "06.10.2008",
            "author": "",
            "changes": "Change the display"
          },
          {
            "version": "1.6",
            "date": "12.11.2008",
            "author": "",
            "changes": "Change property name, set of no valid areas from PointLoad"
          },
          {
            "version": "1.7",
            "date": "12.11.2008",
            "author": "",
            "changes": "Works with n number of headPlates"
          },
          {
            "version": "1.8",
            "date": "15.04.2009",
            "author": "",
            "changes": "BugFix when the lifting hole is under an angle Plate"
          },
          {
            "version": "1.9",
            "date": "22.04.2009",
            "author": "",
            "changes": "BugFix when inserted by Split TSL on a Master Panel"
          },
          {
            "version": "1.10",
            "date": "27.04.2009",
            "author": "",
            "changes": "Avoid the interference of the millings with any Timber"
          },
          {
            "version": "1.11",
            "date": "16.02.2009",
            "author": "",
            "changes": "Add Grip Point to the lifting holes"
          },
          {
            "version": "1.12",
            "date": "18.02.2009",
            "author": "",
            "changes": "Bugfix when insert into master panels, and correct the element mill"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 9405,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates on ElementWallSF entities to calculate mass and centroid, then adds Drill and ElemDrill tools to GenBeams and the Element. It modifies physical 3D geometry properties. There is no usage of Viewport, sd_* prefixes, or shop drawing generation logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing valid Wall Elements with constructed geometry (beams/plates)",
          "requiredSettings": []
        }
      },
      "tokens_used": 8108,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert (via showDialogOnce)",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dOffSet",
            "type": "PropDouble",
            "displayName": "Min Distance from Panel Edge",
            "defaultValue": "150",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dOffSetCenters",
            "type": "PropDouble",
            "displayName": "Min Distance between Holes",
            "defaultValue": "300",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "If the Lifting Holes are in a distance less that this one then only one Hole is going to be aplly"
          },
          {
            "index": 2,
            "variable": "dMaxDis",
            "type": "PropDouble",
            "displayName": "Max Distance between Holes",
            "defaultValue": "3000",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dDiam",
            "type": "PropDouble",
            "displayName": "Diameter Drill",
            "defaultValue": "50",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sExternalWalls",
            "type": "PropString",
            "displayName": "Wall Types To Filter",
            "defaultValue": "AA;AB;AC;AD;AG;BH;BG;DH;EA;EB",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Please set the wall types that you want to be Mill, use ; to insert more than 1"
          },
          {
            "index": 4,
            "variable": "dSpecificMassZone00",
            "type": "PropDouble",
            "displayName": "Timber Weight (Kg/m3)",
            "defaultValue": "370",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "dSpecificMassZone01",
            "type": "PropDouble",
            "displayName": "Sheeting Zone 1 (kg/m3)",
            "defaultValue": "600",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "dSpecificMassZone02",
            "type": "PropDouble",
            "displayName": "Sheeting Zone 2 (kg/m3)",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "dSpecificMassZone03",
            "type": "PropDouble",
            "displayName": "Sheeting Zone 3 (kg/m3)",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "dSpecificMassZone04",
            "type": "PropDouble",
            "displayName": "Sheeting Zone 4 (kg/m3)",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 9,
            "variable": "dSpecificMassZone05",
            "type": "PropDouble",
            "displayName": "Sheeting Zone 5 (kg/m3)",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 10,
            "variable": "dSpecificMassZone06",
            "type": "PropDouble",
            "displayName": "Sheeting Zone 6 (kg/m3)",
            "defaultValue": "600",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 11,
            "variable": "dSpecificMassZone07",
            "type": "PropDouble",
            "displayName": "Sheeting Zone 7 (kg/m3)",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 12,
            "variable": "dSpecificMassZone08",
            "type": "PropDouble",
            "displayName": "Sheeting Zone 8 (kg/m3)",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 13,
            "variable": "dSpecificMassZone09",
            "type": "PropDouble",
            "displayName": "Sheeting Zone 9 (kg/m3)",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 14,
            "variable": "dSpecificMassZone10",
            "type": "PropDouble",
            "displayName": "Sheeting Zone 10 (kg/m3)",
            "defaultValue": "60",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9789,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically calculates the center of gravity and inserts lifting holes into wall panels to ensure balanced lifting during transport and installation.",
          "category": "Manufacturing/Transport",
          "typicalUseCase": "Used when preparing production data for pre-fabricated wall panels that need to be lifted by a crane, ensuring holes are placed according to the panel's specific weight distribution."
        },
        "parameters": [
          {
            "name": "dOffSet",
            "technicalDefault": "150",
            "businessMeaning": "The minimum safety margin required between the center of a lifting hole and the nearest edge of the panel.",
            "validRange": "100 - 300",
            "unit": "mm",
            "affectsOutput": "Prevents holes from being placed too close to the edge, which could cause the timber to split under the load of lifting."
          },
          {
            "name": "dOffSetCenters",
            "technicalDefault": "300",
            "businessMeaning": "The minimum distance required between two lifting holes.",
            "validRange": "200 - 600",
            "unit": "mm",
            "affectsOutput": "If the calculated positions for two holes are closer than this value, the script defaults to placing a single hole at the center of gravity to maintain structural integrity."
          },
          {
            "name": "dMaxDis",
            "technicalDefault": "3000",
            "businessMeaning": "The maximum allowed distance between two lifting holes.",
            "validRange": "2000 - 6000",
            "unit": "mm",
            "affectsOutput": "If the optimal holes are further apart than this value, they are moved inward. This ensures the lifting sling forms an adequate angle (e.g., 60 degrees or more) to prevent excessive horizontal stress on the panel."
          },
          {
            "name": "dDiam",
            "technicalDefault": "50",
            "businessMeaning": "The diameter of the drilled lifting hole.",
            "validRange": "40 - 80",
            "unit": "mm",
            "affectsOutput": "Determines the physical size of the hole. Larger diameters accommodate larger lifting hooks but require larger safety margins (offsets)."
          },
          {
            "name": "sExternalWalls",
            "technicalDefault": "AA;AB;AC;AD;AG;BH;BG;DH;EA;EB",
            "businessMeaning": "A filter list of wall type codes (e.g., external wall types) that require lifting holes.",
            "validRange": "String list of wall codes",
            "unit": "text",
            "affectsOutput": "Controls which elements in the selection are processed. Elements not matching these codes are ignored by the script."
          },
          {
            "name": "dSpecificMassZone00",
            "technicalDefault": "370",
            "businessMeaning": "The density of the primary timber material (e.g., C24 timber) used to calculate weight.",
            "validRange": "350 - 600",
            "unit": "kg/m3",
            "affectsOutput": "Affects the Center of Gravity (CoG) calculation. Incorrect density leads to unbalanced lifting if the panel tilts when picked up."
          },
          {
            "name": "dSpecificMassZone01 - dSpecificMassZone10",
            "technicalDefault": "Various (0, 600, 60)",
            "businessMeaning": "The density of specific sheeting or cladding layers applied to the wall zones.",
            "validRange": "0 - 1200",
            "unit": "kg/m3",
            "affectsOutput": "Allows the CoG to account for heavy cladding (e.g., brickwork, concrete panels, or thick OSB) on one side of the wall, shifting the optimal lifting point accordingly."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change in dSpecificMassZone00-10",
            "effect": "Recalculation of the Center of Gravity (CoG) point.",
            "cascade": [
              "ptCentroid",
              "Hole Locations"
            ]
          },
          {
            "trigger": "Increase of dDiam",
            "effect": "Reduces the valid area for hole placement near edges and obstacles.",
            "cascade": [
              "dOffSet",
              "ptValidDrills"
            ]
          },
          {
            "trigger": "Change in dMaxDis",
            "effect": "Adjusts the spread of two-hole configurations.",
            "cascade": [
              "ptAllDrills"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Drill / ElemDrill",
            "description": "Cylindrical holes drilled through the top plate (or specific beams) and the master element geometry to allow insertion of lifting hooks.",
            "appliedTo": "Top Plates (GenBeams) and Wall Element (ElementWallSF)"
          },
          {
            "type": "Visual Marker",
            "description": "Crosshair or dashed line indicators drawn in the CAD model to show the exact calculated center of the lifting holes.",
            "appliedTo": "Model Space Display"
          }
        ]
      },
      "tokens_used": 10738,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch (User executes command)",
          "2. Properties Dialog display (if not executed via key)",
          "3. User Input: PrEntity prompts selection of Elements",
          "4. Script loops through selected Elements",
          "5. Filter Check: Is Element Code in 'Wall Types To Filter' list?",
          "6. Instance Creation: Script attaches to valid Elements",
          "7. Initial Logic: Selector instance erases itself",
          "8. Element Instance Start: Validate ElementWallSF and geometry",
          "9. State Check: Does _Map contain previous drill data?",
          "10. Mass Calculation: Accumulate volume and weight from Zones 0-10 using densities",
          "11. Centroid Calculation: Compute Center of Gravity (CoG) based on mass distribution",
          "12. Geometry Analysis: Identify Wall Bounds and Invalid Areas (PointLoads, Beams)",
          "13. Determine Strategy: Check width vs 'Min Distance between Holes'",
          "14. Positioning: Calculate 1 or 2 hole locations based on strategy",
          "15. Validation: Check if holes intersect Invalid Areas (Obstacles)",
          "16. Vertical Projection: Project hole locations onto Top Plate geometry",
          "17. Generation: Create Drill and ElemDrill tools",
          "18. Visualization: Draw crosshairs and markers at calculated points",
          "19. Save State: Store points and settings in _Map"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Phase vs. Calculation Phase",
            "path1": {
              "name": "Selector Mode (_bOnInsert)",
              "steps": [
                "Show Dialog",
                "Prompt Element Selection",
                "Filter by Wall Type",
                "Create Child Instances",
                "Erase Selector Instance"
              ]
            },
            "path2": {
              "name": "Calculation Mode (Attached Instance)",
              "steps": [
                "Validate Element",
                "Retrieve Map Data",
                "Calculate CoG",
                "Generate Drills",
                "Update Map"
              ]
            }
          },
          {
            "condition": "Hole Quantity Logic (dOffSetCenters vs Available Width)",
            "path1": {
              "name": "Single Hole Configuration",
              "steps": [
                "Calculate distance from CoG to nearest wall edge",
                "If available width < (dOffSetCenters / 2)",
                "Place single hole at CoG"
              ]
            },
            "path2": {
              "name": "Double Hole Configuration",
              "steps": [
                "Calculate distance from CoG to nearest wall edge",
                "If available width >= (dOffSetCenters / 2)",
                "Place two holes at +/- distance along local X axis",
                "Adjust holes inward if distance > dMaxDis"
              ]
            }
          },
          {
            "condition": "Collision with Invalid Areas (Obstacles)",
            "path1": {
              "name": "Clear Path",
              "steps": [
                "Check if calculated point is inside ppAllNoValidAreas",
                "If clear, use calculated point"
              ]
            },
            "path2": {
              "name": "Collision Detected",
              "steps": [
                "Identify intersection with Invalid Area Profile",
                "Project to nearest vertex of the Invalid Area polygon",
                "Move drill point to vertex"
              ]
            }
          },
          {
            "condition": "Top Plate Intersection (Vertical Projection)",
            "path1": {
              "name": "Direct Intersection",
              "steps": [
                "Cast vertical line from hole point",
                "Check intersection with Top Plate Envelope Body",
                "If intersection found, set Z-height"
              ]
            },
            "path2": {
              "name": "Nearest Plate Fallback",
              "steps": [
                "If no direct intersection found",
                "Find closest Top Plate beam by distance",
                "Project Z-height onto that beam's center plane"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Type",
            "errorMessage": "(Silent)",
            "recovery": "Script erases instance if the selected entity is not an ElementWallSF or if bIsValid() returns false."
          },
          {
            "check": "Wall Type Filter",
            "errorMessage": "(Silent)",
            "recovery": "Script skips processing elements whose Code does not appear in the 'sExternalWalls' string list."
          },
          {
            "check": "Top Plate Existence",
            "errorMessage": "Script exits without generating holes",
            "recovery": "User must ensure the wall element contains valid Top Plate beams (GenBeams) of type _kTopPlate, _kSFTopPlate, etc."
          },
          {
            "check": "Valid Geometry Bounds",
            "errorMessage": "Script exits",
            "recovery": "User must check if the wall outline (plOutlineWall) is valid and returns points."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties (OPM)",
            "how": "AutoCAD Properties Palette",
            "effect": "Changing 'Diameter Drill', 'Min Distance', or 'Specific Mass' triggers recalculation. If 'nMaster' is FALSE and Map exists, it attempts to update points; otherwise, it recalculates from scratch."
          },
          {
            "action": "Update Geometry",
            "how": "Modify Wall Geometry (e.g., add windows, change thickness) and refresh/update element",
            "effect": "Triggers _bOnElementConstructed logic, potentially resetting the _Map and forcing a full recalculation of CoG and hole positions."
          },
          {
            "action": "Move Grips (Visual only in code, implied by _PtG)",
            "how": "Grip Edit",
            "effect": "The script exposes _PtG points. Moving these points allows manual override of the calculated drill locations (implementation depends on specific TSL runtime environment support for _PtG grips)."
          }
        ]
      },
      "tokens_used": 12536,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_Lifting Holes\n\n## Overview\nAutomatically calculates the center of gravity and inserts lifting holes into wall panels to ensure balanced lifting during transport and installation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D wall elements (ElementWallSF). |\n| Paper Space | No | Not applicable. |\n| Shop Drawing | No | Not applicable. |\n\n## Prerequisites\n- **Required Entities**: Wall Elements (`ElementWallSF`) with constructed geometry.\n- **Minimum beam count**: Top plates must exist within the wall element.\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_Lifting Holes.mcr`\n\n### Step 2: Configure Properties (Optional)\n```\nDialog: Properties\nAction: Review settings such as Hole Diameter, Offsets, and Material Weights. Click OK to confirm.\n```\n*Note: This dialog typically appears when the script is first inserted. You can also change these later via the Properties Palette.*\n\n### Step 3: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the wall elements you wish to process. Press Enter to confirm selection.\n```\n*Note: The script will filter elements based on the 'Wall Types To Filter' property.*\n\n### Step 4: Processing\nThe script attaches to the selected elements, calculates the Center of Gravity (CoG), and generates the drilling operations automatically.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Min Distance from Panel Edge** | Number | 150 | Safety margin between the hole center and the panel edge (mm). |\n| **Min Distance between Holes** | Number | 300 | If two holes are closer than this, only one hole is created (mm). |\n| **Max Distance between Holes** | Number | 3000 | Maximum allowed spread for two lifting holes (mm). |\n| **Diameter Drill** | Number | 50 | Diameter of the lifting hole to be drilled (mm). |\n| **Wall Types To Filter** | Text | AA;AB;AC... | List of wall codes to process. Separate codes with a semicolon (;). |\n| **Timber Weight (Kg/m3)** | Number | 370 | Density of the timber structure for CoG calculation. |\n| **Sheeting Zone 1 (kg/m3)** | Number | 600 | Density of sheeting material in Zone 1. |\n| **Sheeting Zone 2 - 10** | Number | 0/60/600 | Density of sheeting materials for respective zones. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | No custom menu items defined. Use standard `Recalculate` if parameters are changed. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on internal properties and does not require external settings files.\n\n## Tips\n- **Accurate Weighting**: If your walls have heavy cladding (e.g., brickwork or concrete), ensure the specific `Sheeting Zone` weights are updated so the Center of Gravity is calculated correctly.\n- **Wall Filtering**: If the script skips a wall, check the `Wall Types To Filter` property to ensure the element's code is included in the list.\n- **Top Plates**: The script projects holes onto the top plate. Ensure your wall elements have valid top plates assigned.\n- **Visualizing CoG**: The script draws crosshairs at the calculated lifting points. Use these to visually verify the position before production.\n\n## FAQ\n- **Q: Why did only one hole appear instead of two?**\n  A: The wall width might be too narrow to satisfy the \"Min Distance between Holes\" setting, or the calculated Center of Gravity is too close to an edge.\n\n- **Q: The hole is not in the center of the wall. Is this correct?**\n  A: Yes. The script calculates the **Center of Gravity**, not the geometric center. If the wall has heavier features on one side (windows, doors, extra framing), the hole will shift to balance the load.\n\n- **Q: How do I account for floor sheets or insulation?**\n  A: Use the `Sheeting Zone` properties (Zone 1 through 10) to assign density values to different layers of the wall construction."
      },
      "tokens_used": 7582,
      "error": null
    }
  }
}