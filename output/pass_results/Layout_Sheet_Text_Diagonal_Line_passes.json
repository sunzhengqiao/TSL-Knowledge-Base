{
  "filename": "Layout_Sheet_Text_Diagonal_Line.mcr",
  "status": "completed",
  "total_tokens": 25014,
  "processing_time": 158.14318299293518,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 2884,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly calls getViewport() during _bOnInsert to select a viewport, relies on the _Viewport array, transforms coordinates using vp.coordSys() (ms2ps) to map model space geometry to paper space, and iterates over Sheet entities derived from the Element within the Viewport."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "Sheet"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space (Layout) containing a Viewport linked to a valid hsbCAD Element",
          "requiredSettings": [
            "_DimStyles"
          ]
        }
      },
      "tokens_used": 3382,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select the viewport from which the element, and possibly active zone is taken",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strDimStyle",
            "type": "PropString",
            "displayName": "Dim Style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dbTH",
            "type": "PropDouble",
            "displayName": "Text Heigth",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "iColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 3,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "iColorDia",
            "type": "PropInt",
            "displayName": "Color Diagonal",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "hsb_settings",
            "searchPaths": [
              "_kPathHsbCompany",
              "_kPathHsbInstall"
            ],
            "purpose": "Provides list of dimension styles for 'Dim Style' property",
            "required": true
          }
        ]
      },
      "tokens_used": 3020,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Annotates paper space layouts by drawing a diagonal line and dimension label (Width x Length) across the projected envelope of each timber sheet.",
          "category": "ShopDrawing/Annotation",
          "typicalUseCase": "Creating a clear visual index on floor plans or layout drawings to identify the size of individual wall/floor panels without adding detailed dimensions."
        },
        "parameters": [
          {
            "name": "strDimStyle",
            "technicalDefault": "\"\"",
            "businessMeaning": "The drafting standard used to format the dimension text (e.g., displaying dimensions as '6000' vs '6 m').",
            "validRange": "Any string present in the _DimStyles list (e.g., 'ISO-25', 'mm', 'cm')",
            "unit": "string",
            "affectsOutput": "Determines the formatting, precision, and unit suffix of the dimension text displayed on the sheet."
          },
          {
            "name": "dbTH",
            "technicalDefault": 1,
            "businessMeaning": "The plotted height of the dimension text on the physical drawing sheet.",
            "validRange": "1.5 to 5.0 (standard architectural text sizes)",
            "unit": "mm (Paper Space)",
            "affectsOutput": "Scales the 'Width x Length' text up or down for readability."
          },
          {
            "name": "iColor",
            "technicalDefault": 3,
            "businessMeaning": "The AutoCAD color index for the dimension text. Setting this to 0 hides the text.",
            "validRange": "0 to 255 (0 = Invisible/Off)",
            "unit": "Color Index",
            "affectsOutput": "Changes the color of the sheet dimension label. If set to 0, no text is drawn."
          },
          {
            "name": "iColorDia",
            "technicalDefault": 1,
            "businessMeaning": "The AutoCAD color index for the diagonal line drawn across the sheet. Setting this to 0 hides the line.",
            "validRange": "0 to 255 (0 = Invisible/Off)",
            "unit": "Color Index",
            "affectsOutput": "Changes the color of the diagonal marker line. If set to 0, the diagonal line is not drawn."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "strDimStyle is changed",
            "effect": "Alters the formatting of the width and length values inside the text label.",
            "cascade": []
          },
          {
            "trigger": "iColor is set to 0",
            "effect": "Disables the generation of the dimension text, regardless of dbTH or strDimStyle settings.",
            "cascade": []
          },
          {
            "trigger": "iColorDia is set to 0",
            "effect": "Disables the drawing of the diagonal line across the sheet envelope.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "PLine (Polyline)",
            "description": "A diagonal line drawn from the bottom-left to top-right (min to max) of the sheet's bounding box in Paper Space.",
            "appliedTo": "Paper Space representation of each Sheet in the selected Element."
          },
          {
            "type": "Text",
            "description": "A string formatted as 'Width x Length' (e.g., '125x6000'), centered on the sheet. Rotates 90 degrees if the sheet width is greater than its length.",
            "appliedTo": "Paper Space representation of each Sheet in the selected Element."
          }
        ]
      },
      "tokens_used": 4474,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script executed via hsbCAD command (Insert/Run).",
          "2. Check Insertion Flag (_bOnInsert).",
          "3. [Insert Mode] Prompt user to select a Viewport on the Paper Space layout.",
          "4. [Insert Mode] Store selected Viewport in internal _Viewport array and terminate execution.",
          "5. [Re-calculation Mode] Verify that a valid Viewport exists in the array.",
          "6. Retrieve the Element associated with the Viewport and validate it contains hsbCAD data.",
          "7. Determine coordinate transformation (ms2ps) to project Model Space geometry to Paper Space.",
          "8. Retrieve all Sheets belonging to the Element (and active Zone).",
          "9. Loop through each Sheet in the collection.",
          "10. Calculate the Bounding Box (Min/Max X and Y) of the Sheet's envelope in Paper Space.",
          "11. [Conditional] Draw diagonal line connecting Bounding Box corners (if enabled).",
          "12. [Conditional] Retrieve dimensions, format string, calculate center point, and draw Text label (if enabled)."
        ],
        "conditionalBranches": [
          {
            "condition": "Check Script State (_bOnInsert)",
            "path1": {
              "name": "Initial Insertion",
              "steps": [
                "Execute getViewport() command line prompt",
                "User clicks a viewport in Paper Space",
                "Append viewport to _Viewport array",
                "Exit script (Wait for recalculation trigger)"
              ]
            },
            "path2": {
              "name": "Calculation/Redraw",
              "steps": [
                "Process stored viewport",
                "Iterate through sheets",
                "Generate geometry and text"
              ]
            }
          },
          {
            "condition": "Validate Element Data",
            "path1": {
              "name": "Valid Element",
              "steps": [
                "Proceed to extract Sheets from Element",
                "Continue drawing workflow"
              ]
            },
            "path2": {
              "name": "Invalid/Empty Element",
              "steps": [
                "Script returns immediately",
                "No geometry generated"
              ]
            }
          },
          {
            "condition": "Property: Color Diagonal (iColorDia)",
            "path1": {
              "name": "Visible Line",
              "steps": [
                "Set Display color to iColorDia",
                "Create PLine from ptMin to ptMax",
                "Draw PLine"
              ]
            },
            "path2": {
              "name": "Hidden Line (0 or negative)",
              "steps": [
                "Skip drawing diagonal line"
              ]
            }
          },
          {
            "condition": "Property: Text Color (iColor)",
            "path1": {
              "name": "Visible Text",
              "steps": [
                "Calculate center point of bounding box",
                "Format Width and Length strings (e.g., '50x2000')",
                "Check aspect ratio (Width > Height)",
                "Draw text with calculated rotation"
              ]
            },
            "path2": {
              "name": "Hidden Text (0 or negative)",
              "steps": [
                "Skip drawing text"
              ]
            }
          },
          {
            "condition": "Text Orientation Logic (Width vs Height)",
            "path1": {
              "name": "Wide Sheet (Width > Height)",
              "steps": [
                "Draw text horizontally (Vectors: _XW, _YW)"
              ]
            },
            "path2": {
              "name": "Tall Sheet (Width <= Height)",
              "steps": [
                "Rotate text 90 degrees (Vectors: _YW, -_XW)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "Implicit (Command line prompt loop until valid selection or cancel)",
            "recovery": "User must select a valid Paper Space Viewport."
          },
          {
            "check": "Viewport contains hsbCAD Element",
            "errorMessage": "Silent failure (Script returns without drawing)",
            "recovery": "User must ensure the selected Viewport is looking at a layout with valid hsbCAD Elements (e.g., a Wall or Floor)."
          },
          {
            "check": "Sheets Collection",
            "errorMessage": "Silent failure (Loop does not execute if arSheet.length() is 0)",
            "recovery": "User must ensure the Element has generated sheets/production data."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Dimension Style",
            "how": "OPM (Object Properties Palette) -> Dim Style dropdown",
            "effect": "Updates the text formatting of the Width x Length label (e.g., changing '6000' to '6 m')."
          },
          {
            "action": "Adjust Text Height",
            "how": "OPM -> Text Heigth (PropDouble)",
            "effect": "Scales the size of the text label in Paper Space."
          },
          {
            "action": "Toggle Visibility",
            "how": "OPM -> Color or Color Diagonal",
            "effect": "Setting value to 0 hides the Text or Diagonal Line respectively. Changing to >0 makes them visible and applies the new color."
          },
          {
            "action": "Re-orient Viewport",
            "how": "AutoCAD Viewport commands (Move, Scale, Lock)",
            "effect": "Script re-runs on recalculation; geometry updates position in Paper Space based on the new viewport projection."
          }
        ]
      },
      "tokens_used": 5738,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Layout_Sheet_Text_Diagonal_Line.mcr\n\n## Overview\nAnnotates paper space layouts by drawing a diagonal line and a dimension label (Width x Length) across the projected envelope of each timber sheet within a selected viewport. It is useful for quickly identifying panel sizes on floor plans or layout drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script operates in Paper Space (Layouts). |\n| Paper Space | Yes | Designed to annotate Viewports containing hsbCAD Elements. |\n| Shop Drawing | No | Used for layout/general arrangement drawings rather than detailed production views. |\n\n## Prerequisites\n- **Required Entities**: A Viewport in a Layout tab that is linked to a valid hsbCAD Element (e.g., a Wall or Floor) containing generated Sheets.\n- **Minimum beam count**: 0 (Operates on Sheets/Elements, not specific beams).\n- **Required settings files**: `hsb_settings` (must contain the `_DimStyles` list).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Layout_Sheet_Text_Diagonal_Line.mcr`\n\n### Step 2: Select Viewport\n```\nCommand Line: Select the viewport from which the element, and possibly active zone is taken\nAction: Click on the border of the viewport in your layout that displays the element you wish to annotate.\n```\n*Note: The script will associate itself with this specific viewport.*\n\n## Properties Panel Parameters\n\nAfter inserting the script, select it and modify the following parameters in the AutoCAD Properties Palette (OPM) to control the annotation appearance.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dim Style | dropdown | (Empty) | Select the drafting standard for the dimension text (e.g., 'ISO-25', 'mm', 'cm'). This controls formatting (e.g., '6000' vs '6 m'). |\n| Text Heigth | number | 1 | Sets the height of the dimension text in Paper Space units (usually mm). Increase for larger scale drawings. |\n| Color | number | 3 | The AutoCAD color index for the dimension text. Setting this to **0** hides the text entirely. |\n| Color Diagonal | number | 1 | The AutoCAD color index for the diagonal line. Setting this to **0** hides the line entirely. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not add custom items to the right-click context menu. Use the Properties Palette to modify settings. |\n\n## Settings Files\n- **Filename**: `hsb_settings`\n- **Location`: `_kPathHsbCompany` or `_kPathHsbInstall`\n- **Purpose`: Provides the list of available dimension styles used by the \"Dim Style\" property.\n\n## Tips\n- **Toggle Visibility**: You can turn off the diagonal line or the text independently by setting their respective \"Color\" properties to **0**.\n- **Text Rotation**: The script automatically detects the sheet orientation. If the sheet is wider than it is tall, the text rotates 90 degrees to fit better.\n- **Updating**: If you move or resize the viewport, use the `REGEN` command or update the script properties to force the annotations to recalculate their position.\n\n## FAQ\n- **Q: Why didn't any lines appear when I inserted the script?**\n- **A**: Ensure the \"Color\" and \"Color Diagonal\" properties in the Properties Palette are not set to 0. Also, verify that the selected Viewport actually contains hsbCAD Elements with generated sheets.\n\n- **Q: How do I change the units from millimeters to meters?**\n- **A**: Change the \"Dim Style\" property in the Properties Palette to a style that formats dimensions as meters (e.g., select 'm' if available in your company settings).\n\n- **Q: The text is too small to read on my plot.**\n- **A**: Increase the \"Text Heigth\" value in the Properties Palette. This value is in Paper Space units, so 2.5 or 3.0 are common values for readable text."
      },
      "tokens_used": 5516,
      "error": null
    }
  }
}