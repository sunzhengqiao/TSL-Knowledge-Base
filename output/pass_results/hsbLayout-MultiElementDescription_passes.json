{
  "filename": "hsbLayout-MultiElementDescription.mcr",
  "status": "completed",
  "total_tokens": 25491,
  "processing_time": 239.026216506958,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "22nov2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3818,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script contains 'getViewport()' and '_Viewport' object handling. It explicitly transforms coordinates using 'CoordSys ms2ps = vp.coordSys()'. The filename prefix 'hsbLayout-' and summary text 'in layout' confirm Paper Space operation."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementMulti"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space with an active Viewport linked to a Multi-Element",
          "requiredSettings": [
            "Dimstyle"
          ]
        }
      },
      "tokens_used": 3472,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "|Select a viewport|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDialog",
            "trigger": "During Insertion (_bOnInsert) if _kExecuteKey is empty",
            "title": null,
            "dataSource": "Internal OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": "|Display|",
            "description": "|Defines the Dimstyle|"
          },
          {
            "index": 0,
            "variable": "dTextHeight",
            "type": "PropDouble",
            "displayName": "|Text Height|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Display|",
            "description": "|Defines the Text Height| |0 = byDimstyle|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3107,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically labels the individual component parts (single elements) of a Multi-Element (e.g., a wall or roof panel) directly on the 2D Layout view.",
          "category": "ShopDrawing",
          "typicalUseCase": "When generating production drawings for prefab assemblies where individual timbers (studs, rafters) need to be identified by their element number for assembly or logistics."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "null",
            "businessMeaning": "Selects the drafting standard (Dimstyle) from the CAD drawing to define the visual appearance of the labels, such as font, text color, and line type.",
            "validRange": "Any Dimension Style currently defined in the AutoCAD drawing",
            "unit": "N/A (Style Name)",
            "affectsOutput": "Determines the font and visual style of the element numbers. If the text height is set to 0, this style also dictates the text size."
          },
          {
            "name": "dTextHeight",
            "technicalDefault": "U(0)",
            "businessMeaning": "Explicitly sets the physical height of the element number labels on the paper sheet. A value of 0 defers to the settings defined in the chosen Dimstyle.",
            "validRange": "0 (Auto/Dimstyle Default) or positive values (e.g., 2.5mm to 10mm depending on plot scale)",
            "unit": "mm",
            "affectsOutput": "Scales the size of the text labels in the Layout. Larger values make the numbers easier to read on the plotted plan."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dTextHeight is 0",
            "effect": "The text size is controlled by the default settings of the selected DimStyle.",
            "cascade": [
              "sDimStyle"
            ]
          },
          {
            "trigger": "dTextHeight > 0",
            "effect": "The text size overrides the default settings of the selected DimStyle.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "TextAnnotation",
            "description": "Text strings representing the element numbers (e.g., '1', '2', '3') placed at the center of each single element's bounding box.",
            "appliedTo": "Paper Space (Layout), aligned over the projection of the Multi-Element selected via Viewport."
          }
        ]
      },
      "tokens_used": 4602,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched via Insert command",
          "System checks insertCycleCount to prevent re-insertion loops",
          "System checks if an Execute Key (_kExecuteKey) is provided",
          "[Conditional] If Execute Key is present: Load properties from Catalog or Last Inserted",
          "[Conditional] If Execute Key is absent: Show Dialog for user to configure 'Dimstyle' and 'Text Height'",
          "Command Line: User selects a Viewport on the layout",
          "Command Line: User selects an Insertion Point to define the label alignment",
          "Script instance is created and linked to the Viewport",
          "System validates the Viewport contains a valid hsbCAD Element",
          "System validates the Element is a Multi-Element (e.g., a wall or roof panel)",
          "System transforms Model Space coordinates to Paper Space",
          "System determines Text Height based on property (explicit) or Dimstyle (automatic)",
          "System iterates through all Single Elements (studs/rafters) within the Multi-Element",
          "System projects label positions based on the user-selected Insertion Point",
          "System draws Element Numbers as Text Annotations in Paper Space"
        ],
        "conditionalBranches": [
          {
            "condition": "Text Height Property (dTextHeight) value",
            "path1": {
              "name": "Explicit Height",
              "steps": [
                "User enters a value > 0 in the 'Text Height' property",
                "Script uses this specific value (in mm) for the text size"
              ]
            },
            "path2": {
              "name": "Dimstyle Height",
              "steps": [
                "User sets 'Text Height' to 0",
                "Script retrieves the text size defined in the selected 'Dimstyle' settings"
              ]
            }
          },
          {
            "condition": "Source Element Type in Viewport",
            "path1": {
              "name": "Valid Multi-Element",
              "steps": [
                "Viewport contains a valid Element",
                "Element is cast to ElementMulti successfully",
                "Script proceeds to list and label single elements"
              ]
            },
            "path2": {
              "name": "Invalid or Single Element",
              "steps": [
                "Viewport is empty, or Element is invalid",
                "Element is not a Multi-Element (e.g., a single beam)",
                "Script halts execution and draws nothing"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "None (Script silently waits for input)",
            "recovery": "User must click a valid viewport on the Layout tab"
          },
          {
            "check": "Viewport Data Link",
            "errorMessage": "Script terminates silently",
            "recovery": "Ensure the selected Viewport is linked to a Model Space view containing an hsbCAD Element"
          },
          {
            "check": "Element Type Compatibility",
            "errorMessage": "Script terminates silently",
            "recovery": "Ensure the entity in the viewport is a Multi-Element (Composite), not a single beam or generic object"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Visual Style",
            "how": "OPM (Object Properties Manager)",
            "effect": "Modifying 'Dimstyle' or 'Text Height' triggers an immediate redraw of the labels with new styles or sizes"
          },
          {
            "action": "Update Assembly Geometry",
            "how": "Modify the source Multi-Element in Model Space (e.g., add/remove studs)",
            "effect": "The script recalculates and updates the list of numbers and their positions on the Layout to match the new geometry"
          }
        ]
      },
      "tokens_used": 5714,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbLayout-MultiElementDescription.mcr\n\n## Overview\nThis script automatically labels the individual component parts (such as studs or rafters) of a Multi-Element (e.g., a wall or roof panel) directly on the 2D Layout view. It is used to identify specific elements for assembly and logistics on production drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script operates in Layout (Paper Space) only. |\n| Paper Space | Yes | The script requires the selection of a Viewport. |\n| Shop Drawing | Yes | Designed for annotating manufacturing drawings. |\n\n## Prerequisites\n- **Required Entities**: A Viewport in Paper Space that is linked to a Multi-Element (e.g., an hsbCAD Wall or Roof assembly).\n- **Minimum beam count**: 0 (The script analyzes existing elements, it does not create them).\n- **Required Settings**: At least one Dimension Style (Dimstyle) must be defined in the AutoCAD drawing.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsbLayout-MultiElementDescription.mcr`\n\n### Step 2: Select Viewport\n```\nCommand Line: |Select a viewport|\nAction: Click on a viewport in your layout that displays a wall or roof panel.\n```\n\n### Step 3: Set Label Position\n```\nCommand Line: [Point prompt]\nAction: Click a location in the layout to define the insertion point. This point determines the alignment of the element numbers relative to the view.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimstyle | Dropdown | (Current Dimstyle) | Selects the drafting standard (Dimstyle) to define the visual appearance of the labels (font, color, line type). |\n| Text Height | Number | 0 | Defines the physical height of the text labels. <br>• **0**: Uses the text size defined in the selected Dimstyle.<br>• **>0**: Uses this specific value (in mm) for the text size, overriding the Dimstyle. |\n\n## Right-Click Menu Options\nNo custom context menu options are available for this script.\n\n## Settings Files\nNo external settings files are required for this script.\n\n## Tips\n- **Consistency**: Keep the **Text Height** set to `0` to ensure your labels automatically match the text size settings of your chosen Dimension Style.\n- **Readability**: If your plot scale is very small, manually setting a larger **Text Height** (e.g., 2.5mm or higher) can make element numbers easier to read on paper.\n- **Updating Labels**: If you modify the source wall or roof in Model Space (e.g., add or remove studs), the labels in the Layout will automatically update to reflect the new geometry.\n\n## FAQ\n- **Q: Why does nothing appear when I run the script?**\n  A: Ensure the Viewport you selected is linked to a valid **Multi-Element** (composite wall/roof). The script does not work on single beams or empty viewports.\n  \n- **Q: How do I change the font of the numbers?**\n  A: Change the **Dimstyle** property in the Properties Palette to a Dimstyle that uses your desired font.\n\n- **Q: Can I move the numbers after placing them?**\n  A: The numbers are generated based on the geometry of the elements. To move the entire group, select the script instance in the layout and move the insertion point. To move individual numbers, you would need to explode or edit the generated text entities manually."
      },
      "tokens_used": 4778,
      "error": null
    }
  }
}