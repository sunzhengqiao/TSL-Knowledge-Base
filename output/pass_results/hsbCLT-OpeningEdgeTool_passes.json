{
  "filename": "hsbCLT-OpeningEdgeTool.mcr",
  "status": "completed",
  "total_tokens": 50467,
  "processing_time": 777.6466677188873,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 6,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.6",
            "date": "15.03.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-14939: fix when investigating/counting door alike openings"
          },
          {
            "version": "1.5",
            "date": "02.11.2021",
            "author": "Marsel Nakuci",
            "changes": "HSB-13701: add alignment options {\"horizontal left\",\"horizontal right\",\"horizontal left right\"}"
          },
          {
            "version": "1.4",
            "date": "21.06.2021",
            "author": "Marsel Nakuci",
            "changes": "HSB-12343: add options at alignment \"Vertical extended top\" and \"Vertical extended bottom top\""
          },
          {
            "version": "1.3",
            "date": "16.06.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-12238 mirror and copy added ,"
          },
          {
            "version": "1.2",
            "date": "15.06.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-12238 new property alignment to control alignment and vertical tool extension  ,"
          },
          {
            "version": "1.1",
            "date": "06.05.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-11799 new tool options and check on free directions, renamed from hsbCLT-OpeingRabbet ,"
          },
          {
            "version": "1.0",
            "date": "21.04.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-11618 new tool to create rabbets at straight opening segments ,"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 9055,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script manipulates 3D geometry and creates manufacturing tools (Rabbet, BeamCut, Slot, Housing, Mortise) on a Sip (Structural Interactive Part). It uses Display dp(1) for Model Space preview and standard point geometry math. No ShopDrawing (sd_) prefixes, _Viewport usage, or #Type E entity arrays found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Opening"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 7394,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sTool",
            "type": "PropString",
            "displayName": "|Tool|",
            "defaultValue": "|Rabbet|",
            "inputType": "dropdown",
            "options": [
              "|Beamcut|",
              "|Housing|",
              "|Mortise|",
              "|Rabbet|",
              "|Rabbet + Overshoot|",
              "|Slot|"
            ],
            "category": "|General|",
            "description": "|Defines the Tool|"
          },
          {
            "index": 1,
            "variable": "dLength",
            "type": "PropDouble",
            "displayName": "|Length|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the Length|, |0 = specify length by point|"
          },
          {
            "index": 2,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the Width|"
          },
          {
            "index": 3,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "|Depth|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the Depth|"
          },
          {
            "index": 4,
            "variable": "dAxisOffset",
            "type": "PropDouble",
            "displayName": "|Axis Offset|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the axis offset|"
          },
          {
            "index": 5,
            "variable": "sAlignment",
            "type": "PropString",
            "displayName": "|Alignment|",
            "defaultValue": "|Horizontal|",
            "inputType": "dropdown",
            "options": [
              "|Horizontal|",
              "|Vertical|",
              "|Vertical extended bottom|",
              "|Vertical extended top|",
              "|Vertical extended bottom top|",
              "|Horizontal extended left|",
              "|Horizontal extended right|",
              "|Horizontal extended left right|"
            ],
            "category": "|General|",
            "description": "|Defines if the rabbet is aligned vertical|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7816,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically creates machining tools (rabbets, cuts, slots) on the straight edges of wall or floor openings in CLT/Timber panels.",
          "category": "Machining/Connection",
          "typicalUseCase": "Adding a weather bar rabbet to a door opening, creating a floor rebate, or machining a connection slot along a window jamb."
        },
        "parameters": [
          {
            "name": "sTool",
            "technicalDefault": "|Rabbet|",
            "businessMeaning": "The type of machining operation to perform on the panel edge.",
            "validRange": "Selection List",
            "unit": "enum",
            "affectsOutput": "Determines the specific hsbCAD tool object generated (Rabbet, BeamCut, Slot, Housing, Mortise) and visual color coding. 'Housing' and 'Mortise' require free tool access space."
          },
          {
            "name": "dLength",
            "technicalDefault": "0",
            "businessMeaning": "The length of the machining cut along the opening edge. A value of 0 triggers an interactive point-picking mode.",
            "validRange": "0 to 5000+ (0 for dynamic)",
            "unit": "mm",
            "affectsOutput": "Defines the span of the cut along the edge. If set to 0, the user picks the start/end points graphically."
          },
          {
            "name": "dWidth",
            "technicalDefault": "0",
            "businessMeaning": "The depth of the cut measured perpendicular to the panel surface (often the width of a rebate or groove).",
            "validRange": "1 to Panel Thickness",
            "unit": "mm",
            "affectsOutput": "Controls how far into the material the tool cuts from the surface. Often represents the plate thickness for weather bars."
          },
          {
            "name": "dDepth",
            "technicalDefault": "0",
            "businessMeaning": "The horizontal penetration of the cut into the panel from the edge.",
            "validRange": "1 to 500+",
            "unit": "mm",
            "affectsOutput": "Controls how deep the slot or cut goes from the opening edge into the panel."
          },
          {
            "name": "dAxisOffset",
            "technicalDefault": "0",
            "businessMeaning": "Shifts the tool placement relative to the derived origin point along the panel's plane.",
            "validRange": "-500 to 500",
            "unit": "mm",
            "affectsOutput": "Moves the entire machining profile along the surface, useful for fine-tuning alignment relative to the opening edge."
          },
          {
            "name": "sAlignment",
            "technicalDefault": "|Horizontal|",
            "businessMeaning": "Controls the orientation of the cut (parallel to floor vs. wall) and whether the cut extends to intersect adjacent perpendicular walls.",
            "validRange": "Selection List",
            "unit": "enum",
            "affectsOutput": "Switches the coordinate system used for the tool. 'Extended' options automatically calculate intersections with neighboring walls to create continuous rebates around corners."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sTool change",
            "effect": "If switching to 'Housing' or 'Mortise' in a constrained space (no free direction), the tool resets to 'Beamcut'.",
            "cascade": [
              "sTool"
            ]
          },
          {
            "trigger": "sAlignment change",
            "effect": "Script prevents changing the fundamental orientation (Horizontal vs Vertical) to avoid geometric conflicts, resetting it to the last valid orientation.",
            "cascade": [
              "sAlignment"
            ]
          },
          {
            "trigger": "sAlignment (Extended options)",
            "effect": "Automatically modifies dLength to reach adjacent walls by calculating geometry intersections.",
            "cascade": [
              "dLength"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Rabbet",
            "description": "A stepped recess on the edge of the panel (Standard or with Overshoot).",
            "appliedTo": "Selected Wall/Floor Panels"
          },
          {
            "type": "BeamCut",
            "description": "A generic rectangular cut through the material.",
            "appliedTo": "Selected Wall/Floor Panels"
          },
          {
            "type": "Slot",
            "description": "A rectangular groove/channel.",
            "appliedTo": "Selected Wall/Floor Panels"
          },
          {
            "type": "Housing",
            "description": "A through-cut or pocket requiring specific tool access.",
            "appliedTo": "Selected Wall/Floor Panels"
          },
          {
            "type": "Mortise",
            "description": "A rectangular hole or slot, typically for tenons.",
            "appliedTo": "Selected Wall/Floor Panels"
          }
        ]
      },
      "tokens_used": 8896,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script via command or toolbar",
          "Enter Insertion Mode (Jig)",
          "Hover over Wall/Floor Panel to detect Sip (Structural Interactive Part)",
          "Highlight closest straight opening edge segment",
          "Click to set Start Point (Origin)",
          "[Conditional] If Length property is 0: Move cursor to define End Point/Length dynamically",
          "Click to confirm placement and insert TSL Instance",
          "Generate Machining Tool (Rabbet, Beamcut, Slot, etc.) on the Panel",
          "Exit Insertion Mode"
        ],
        "conditionalBranches": [
          {
            "condition": "User selects 'Housing' or 'Mortise' tool type",
            "path1": {
              "name": "Sufficient Clearance",
              "steps": [
                "Script calculates 'numFree' (free directions for tool access)",
                "If numFree >= 1",
                "Create Housing or Mortise tool",
                "Add to Sip entity"
              ]
            },
            "path2": {
              "name": "Insufficient Space",
              "steps": [
                "Script calculates 'numFree'",
                "If numFree < 1",
                "Display Error: 'Tool type is not supported...'",
                "Automatically switch 'sTool' property to 'Beamcut'",
                "Recalculate and generate Beamcut instead"
              ]
            }
          },
          {
            "condition": "User changes 'Alignment' property",
            "path1": {
              "name": "Valid Orientation Change",
              "steps": [
                "Check if new alignment is within same group (e.g., Horizontal to Horizontal extended)",
                "Update 'nAlignment' variable",
                "Recalculate geometry based on new alignment logic"
              ]
            },
            "path2": {
              "name": "Invalid Orientation Change",
              "steps": [
                "Detect switch between Horizontal group and Vertical group",
                "Display Error: 'Orientation cannot be changed...'",
                "Revert 'sAlignment' property to 'lastAlignment'",
                "Keep existing orientation"
              ]
            }
          },
          {
            "condition": "User selects 'Extended' Alignment option",
            "path1": {
              "name": "Extended Geometry",
              "steps": [
                "Identify panel boundary (ppSipBox)",
                "Calculate intersection points extending from the opening edge",
                "Adjust 'dToolLength' to span the full opening width/height"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Tool Orientation",
            "errorMessage": "Orientation cannot be changed from [Horizontal] -> [Vertical]",
            "recovery": "Script resets property to the previous valid orientation automatically."
          },
          {
            "check": "Tool Clearance (Free Directions)",
            "errorMessage": "The tool type [Housing/Mortise] is not supported because it has no free direction at its location and will be set to 'Beamcut'",
            "recovery": "Script automatically downgrades the tool type to 'Beamcut' which does not require free space."
          },
          {
            "check": "Length Bounds",
            "errorMessage": "None (Automatic correction)",
            "recovery": "If the user picks a point extending beyond the opening segment, the script automatically corrects the length to stop at the segment end (`vecXT.dotProduct(_PtG[0] - seg.ptEnd())`)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions",
            "how": "OPM (Properties Palette)",
            "effect": "Updates dLength, dWidth, dDepth, or dAxisOffset and regenerates the tool body."
          },
          {
            "action": "Change Tool Type",
            "how": "OPM (Properties Palette) -> 'Tool' dropdown",
            "effect": "Switches entity type (e.g., from Rabbet to Slot). Triggers clearance validation."
          },
          {
            "action": "Adjust Alignment",
            "how": "OPM (Properties Palette) -> 'Alignment' dropdown",
            "effect": "Re-orients the tool or extends it to adjacent walls. Blocking logic prevents fundamental Horizontal/Vertical flips."
          },
          {
            "action": "Copy / Mirror",
            "how": "AutoCAD standard commands",
            "effect": "Script detects the new coordinate system and re-projects the tool onto the new panel/edge location."
          }
        ]
      },
      "tokens_used": 10829,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-OpeningEdgeTool.mcr\n\n## Overview\nThis script creates machining tools (such as rabbets, slots, and cuts) along the straight edges of wall or floor openings in CLT and timber panels. It is typically used to add weather bar rebates to door openings or create connection details along window jambs.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script works in 3D Model Space only. |\n| Paper Space | No | Not supported in Layouts/Shop Drawings. |\n| Shop Drawing | No | Not supported for 2D generation. |\n\n## Prerequisites\n- **Required Entities**: An Element (Wall or Floor panel) containing an Opening.\n- **Minimum Beam Count**: 1 (Single panel or element).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCLT-OpeningEdgeTool.mcr` from the list.\n\n### Step 2: Select Panel and Opening Edge\n```\nCommand Line: Select Element:\nAction: Hover over a Wall or Floor panel containing an opening. The script will automatically detect the closest straight edge segment of the opening.\n```\n### Step 3: Set Start Point (Origin)\n```\nCommand Line: Specify insertion point:\nAction: Click to place the start point of the tool on the desired opening edge.\n```\n### Step 4: Define Length (If Required)\n```\nCommand Line: Specify end point / length:\nAction: \n- If the \"Length\" property is set to 0: Move your cursor to visually define the length of the cut and click to set the end point.\n- If the \"Length\" property is a specific number: The tool will insert immediately without this prompt.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Tool** | dropdown | Rabbet | Defines the type of machining operation. Options include Rabbet, Beamcut, Slot, Housing, Mortise, and Rabbet + Overshoot. |\n| **Length** | number | 0 | Defines the length of the cut along the edge. Set to `0` to pick points graphically. |\n| **Width** | number | 0 | Defines the width of the cut (perpendicular to the panel surface). |\n| **Depth** | number | 0 | Defines the depth of the cut (horizontal penetration from the edge into the panel). |\n| **Axis Offset** | number | 0 | Shifts the tool placement relative to the origin point along the panel's surface. |\n| **Alignment** | dropdown | Horizontal | Controls orientation. \"Extended\" options (e.g., Horizontal extended left) will automatically calculate intersections with adjacent walls. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Properties** | Opens the Properties Palette to modify dimensions and tool type. |\n| **Delete** | Removes the tool instance and the associated machining. |\n\n*(Note: This script relies on standard AutoCAD interaction. Custom context menu items are not implemented.)*\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not use external settings files.\n\n## Tips\n- **Dynamic Length**: Keep the **Length** property set to `0` when inserting. This allows you to click the exact start and end points visually on the model, which is useful for following irregular opening shapes.\n- **Extended Alignments**: Use the **Alignment** options with \"Extended\" (e.g., *Horizontal extended left*) to automatically make the rabbet run past the opening edge and intersect with a perpendicular wall.\n- **Tool Constraints**: If you select **Housing** or **Mortise**, the script checks for sufficient space. If the panel is too thick or the space is too tight, the tool will automatically downgrade to a standard **Beamcut**.\n\n## FAQ\n- **Q: Why did my tool change from \"Housing\" to \"Beamcut\" after I inserted it?**\n  - A: Housing and Mortise tools require \"free directions\" (clearance) for the tool to access the cut. If the geometry does not allow this, the script automatically switches to a Beamcut to ensure validity.\n  \n- **Q: Can I change the alignment from Horizontal to Vertical using the Properties palette?**\n  - A: No. The script prevents changing the fundamental orientation (Horizontal to Vertical) after insertion to prevent geometric conflicts. You must delete the instance and re-insert it with the correct orientation.\n\n- **Q: What does \"Rabbet + Overshoot\" do?**\n  - A: This creates a rabbet similar to the standard option but includes an overshoot calculation based on the specific geometry settings defined in the script logic."
      },
      "tokens_used": 6477,
      "error": null
    }
  }
}