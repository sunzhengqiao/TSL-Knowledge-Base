{
  "filename": "GE_PLOT_SIZE_WARNING_STAMP.mcr",
  "status": "completed",
  "total_tokens": 27771,
  "processing_time": 352.05994725227356,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "0.3",
            "date": "19.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Dimstyle applied\nColor set to red"
          },
          {
            "version": "0.2",
            "date": "15.ago.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Description modified\nThumbnail added\nCopyright added"
          },
          {
            "version": "0.1",
            "date": "Nov 31 2011",
            "author": "No author",
            "changes": ""
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3612,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses getViewport() to prompt user selection. Stores viewport in _Viewport[] array. Accesses element geometry via Viewport.element()."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Viewport"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space (Layout with active hsbCAD viewport)",
          "requiredSettings": []
        }
      },
      "tokens_used": 1944,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Select location",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select the viewport from which the element is taken",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Insertion (_bOnInsert)",
            "title": null,
            "dataSource": "Script Properties (showDialog call)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "pDimStyle",
            "type": "PropString",
            "displayName": "DimStyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dTH",
            "type": "PropDouble",
            "displayName": "Text Height (0 Uses DimStyle)",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dMaxSize",
            "type": "PropDouble",
            "displayName": "Max Size",
            "defaultValue": "102.25",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dAngle",
            "type": "PropDouble",
            "displayName": "Angle for Text",
            "defaultValue": "15",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "stDir",
            "type": "PropString",
            "displayName": "Direction To Check",
            "defaultValue": "Element Y(Height)",
            "inputType": "dropdown",
            "options": [
              "Element Y(Height)",
              "Element X(Width)",
              "Both"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strText",
            "type": "PropString",
            "displayName": "Text to Draw",
            "defaultValue": "WIDE LOAD",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3550,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically stamps a warning label (e.g., 'WIDE LOAD') on production drawings if the viewed element exceeds a specific dimensional threshold, typically for transportation or fabrication clearance checks.",
          "category": "ShopDrawing",
          "typicalUseCase": "Flagging wall panels or beams in a layout view that are too large to transport on standard trucks, requiring the drafting team to add transport notices or split the element."
        },
        "parameters": [
          {
            "name": "pDimStyle",
            "technicalDefault": "",
            "businessMeaning": "The CAD standard style applied to the text to ensure it matches company plotting standards (font, layer, etc.) if no manual text height is specified.",
            "validRange": "Any Dimension Style defined in the current CAD template",
            "unit": "N/A",
            "affectsOutput": "Defines the visual attributes of the text when Text Height is overridden to 0."
          },
          {
            "name": "dTH",
            "technicalDefault": "0",
            "businessMeaning": "The explicit height of the warning text. A value of 0 ignores this setting and uses the text height defined in the selected DimStyle.",
            "validRange": "0 (Use DimStyle) to 10 inches",
            "unit": "Model Length Units (inches)",
            "affectsOutput": "Scales the size of the text label for readability on the plotted page."
          },
          {
            "name": "dMaxSize",
            "technicalDefault": "102.25",
            "businessMeaning": "The maximum allowable dimension limit before a warning is triggered. The default value (approx. 8' 6.25\") corresponds to standard US highway width limits for transporting loads without special permits.",
            "validRange": "0 to 240 inches (depending on local transport regulations)",
            "unit": "Inches",
            "affectsOutput": "Acts as the logic trigger. The warning text is only generated if the element's size exceeds this value."
          },
          {
            "name": "dAngle",
            "technicalDefault": "15",
            "businessMeaning": "The rotation angle of the text label on the drawing, often set diagonally to distinguish the warning as a stamp rather than standard dimensioning.",
            "validRange": "0 to 360 degrees",
            "unit": "Degrees",
            "affectsOutput": "Rotates the text orientation around the insertion point."
          },
          {
            "name": "stDir",
            "technicalDefault": "Element Y(Height)",
            "businessMeaning": "Specifies which physical dimension of the element is critical for the check. 'Element Y' checks the vertical height (e.g., for bridge clearance), 'Element X' checks the horizontal width (e.g., for truck width), and 'Both' checks if either dimension exceeds limits.",
            "validRange": "Element Y(Height), Element X(Width), Both",
            "unit": "Enumeration",
            "affectsOutput": "Determines which geometric calculation is compared against dMaxSize."
          },
          {
            "name": "strText",
            "technicalDefault": "WIDE LOAD",
            "businessMeaning": "The specific warning message displayed on the drawing to inform the shop floor or transport team.",
            "validRange": "Any short alphanumeric string",
            "unit": "String",
            "affectsOutput": "The actual content of the text drawn in Paper Space."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dTH is set to 0",
            "effect": "The text height is derived from pDimStyle, ignoring any other height settings.",
            "cascade": [
              "pDimStyle"
            ]
          },
          {
            "trigger": "stDir is set to 'Both'",
            "effect": "The script triggers the warning if the element is too wide OR too tall, based on dMaxSize.",
            "cascade": [
              "dMaxSize"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text/Annotation",
            "description": "A colored text entity drawn in Paper Space at the user-selected location. It is only visible if the linked element exceeds the defined size threshold.",
            "appliedTo": "Paper Space Layouts (linked to Model Elements via a Viewport)"
          }
        ]
      },
      "tokens_used": 5772,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User executes script insertion command.",
          "Script checks insertion cycle; erases duplicate instances if detected.",
          "Script opens Dynamic Dialog for user to configure warning parameters (Text, Max Size, Direction, etc.).",
          "User accepts dialog settings.",
          "Command line prompts user to select location in Paper Space.",
          "Command line prompts user to select the Viewport corresponding to the element.",
          "Script stores the Point and Viewport, then forces a recalculation.",
          "Script retrieves the Element associated with the selected Viewport.",
          "Script collects all vertices from all beams within the Element.",
          "Script calculates the bounding size of the Element based on the 'Direction To Check' setting (Height, Width, or Both).",
          "Script compares calculated size(s) against the 'Max Size' threshold.",
          "Script constructs the display properties (Text Height, DimStyle, Color=Red).",
          "Script applies rotation to the text coordinate system based on the 'Angle' parameter.",
          "If the size threshold is exceeded, the warning text is drawn at the selected location.",
          "If the size threshold is not met, no text is drawn."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Multiple Cycles Detected",
              "steps": [
                "Script calls eraseInstance().",
                "Execution stops immediately to prevent duplicates."
              ]
            },
            "path2": {
              "name": "First Cycle",
              "steps": [
                "Proceed to showDialog().",
                "Prompt for inputs."
              ]
            }
          },
          {
            "condition": "Text Height (dTH) Setting",
            "path1": {
              "name": "dTH > 0",
              "steps": [
                "Display text height is set to the explicit value of dTH."
              ]
            },
            "path2": {
              "name": "dTH == 0",
              "steps": [
                "Display text height is inherited from the selected pDimStyle."
              ]
            }
          },
          {
            "condition": "Direction To Check (stDir)",
            "path1": {
              "name": "Element Y(Height)",
              "steps": [
                "Order vertices along Element Y-axis.",
                "Calculate distance between min and max Y points.",
                "Trigger warning if distance > dMaxSize."
              ]
            },
            "path2": {
              "name": "Element X(Width)",
              "steps": [
                "Order vertices along Element X-axis.",
                "Calculate distance between min and max X points.",
                "Trigger warning if distance > dMaxSize."
              ]
            },
            "path3": {
              "name": "Both",
              "steps": [
                "Calculate extents for both X and Y axes.",
                "Trigger warning if X extent > dMaxSize OR Y extent > dMaxSize."
              ]
            }
          },
          {
            "condition": "Size Threshold vs Max Size",
            "path1": {
              "name": "Size Exceeds Threshold",
              "steps": [
                "Set internal flag iDraw to 1.",
                "Execute dp.draw() command to render text."
              ]
            },
            "path2": {
              "name": "Size Within Threshold",
              "steps": [
                "Set internal flag iDraw to 0.",
                "Skip dp.draw() command (Text is removed or not generated)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "No explicit error message, but script exits silently.",
            "recovery": "User must select a valid hsbCAD Viewport during the insertion prompt."
          },
          {
            "check": "Element Validity (hsb data)",
            "errorMessage": "None (Script stops execution).",
            "recovery": "Ensure the selected Viewport actually contains a valid hsbCAD Element (Wall/Beam) and not just generic CAD geometry."
          },
          {
            "check": "Vertex Existence",
            "errorMessage": "None (Text not drawn).",
            "recovery": "Ensure the Element contains beams with valid geometry/real bodies."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Threshold (dMaxSize)",
            "how": "OPM (Object Properties Palette)",
            "effect": "Increasing the value may hide the text; decreasing it may reveal it. Forces geometry update."
          },
          {
            "action": "Change Direction (stDir)",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changes which dimension is measured. May cause the text to appear/disappear depending on the Element's proportions."
          },
          {
            "action": "Move Warning Stamp",
            "how": "Grip Edit (Select script instance, drag insertion point grip)",
            "effect": "Relocates the text to a new position in Paper Space."
          },
          {
            "action": "Update Text Content",
            "how": "OPM (Object Properties Palette) - 'Text to Draw' property",
            "effect": "Immediately updates the string displayed on the drawing."
          },
          {
            "action": "Rotate Text",
            "how": "OPM (Object Properties Palette) - 'Angle for Text' property",
            "effect": "Rotates the text around the insertion point."
          }
        ]
      },
      "tokens_used": 6783,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_PLOT_SIZE_WARNING_STAMP.mcr\n\n## Overview\nThis script automatically creates a warning stamp (e.g., \"WIDE LOAD\") in Paper Space. It detects if an element viewed through a specific viewport exceeds a defined size limit and displays the warning text only when the limit is surpassed.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script functions specifically in Layouts (Paper Space). |\n| Paper Space | Yes | Script must be inserted on a layout page containing an hsbCAD viewport. |\n| Shop Drawing | No | Designed for production layouts to flag oversized elements. |\n\n## Prerequisites\n- **Required Entities**: A Layout (Paper Space) with an active hsbCAD Viewport displaying an Element (Wall/Beam).\n- **Minimum beam count**: 0 (Checks the entire Element geometry).\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_PLOT_SIZE_WARNING_STAMP.mcr`\n\n### Step 2: Configure Warning Properties\nA dialog appears automatically upon insertion.\n- **Action**: Adjust settings such as the text message (\"WIDE LOAD\"), maximum size limit, and rotation angle. Click OK to confirm.\n\n### Step 3: Select Location\n```\nCommand Line: Select location\nAction: Click in the Paper Space layout where you want the warning text to appear (usually near the element).\n```\n\n### Step 4: Select Viewport\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click the border of the viewport that shows the element you want to monitor.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| DimStyle | dropdown | (Current) | Selects the CAD dimension style to control font and layer properties. |\n| Text Height (0 Uses DimStyle) | number | 0 | Sets the text height in drawing units. Enter 0 to use the height defined in the DimStyle. |\n| Max Size | number | 102.25 | The maximum size allowed in inches. If the element is larger than this, the warning appears. |\n| Angle for Text | number | 15 | The rotation angle of the text stamp in degrees. |\n| Direction To Check | dropdown | Element Y(Height) | Determines which dimension to check: Height, Width, or Both. |\n| Text to Draw | text | WIDE LOAD | The specific message displayed on the drawing. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | No custom context menu items are added. Use the Properties Palette to modify parameters. |\n\n## Settings Files\n- No external settings files are used for this script.\n\n## Tips\n- **Moving the Stamp**: Select the script instance in Paper Space and use the grip point to drag the text to a new location without losing settings.\n- **Dynamic Updates**: If you modify the Element in Model Space (e.g., make it smaller), the script will automatically re-evaluate and may hide the warning text if it no longer exceeds the limit.\n- **Transport Limits**: The default Max Size (102.25 inches) approximates the standard US transport width limit. Adjust this value based on local regulations.\n\n## FAQ\n- **Q: Why is the text not showing up?**\n  **A**: The element in the selected viewport might be smaller than the \"Max Size\" threshold. Try lowering the \"Max Size\" parameter in the Properties Palette or check if the \"Direction To Check\" matches the element's orientation.\n- **Q: Can I change the text color?**\n  **A**: The script hardcodes the color to Red to act as a warning. You can change the layer color in the AutoCAD Layer Properties Manager if necessary.\n- **Q: The text is too small.**\n  **A**: Increase the \"Text Height\" value in the Properties Palette. If it is set to 0, change the Text Height setting in the selected \"DimStyle\" or set a specific number in the script properties.\n\n---"
      },
      "tokens_used": 6110,
      "error": null
    }
  }
}