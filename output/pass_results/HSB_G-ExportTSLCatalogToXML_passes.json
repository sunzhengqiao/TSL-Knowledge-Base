{
  "filename": "HSB_G-ExportTSLCatalogToXML.mcr",
  "status": "completed",
  "total_tokens": 21855,
  "processing_time": 272.4127757549286,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "Description",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "09-10-2020",
            "author": "RP",
            "changes": "Pilot version."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4158,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No specific AutoCAD space variables (_kModelSpace, _kPaperSpace, _Viewport) or ShopDrawing entities (#Type E) referenced. The script processes XML files and erases itself immediately after execution, indicating it is a utility script rather than a geometric generation script."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Requires access to file system paths _kPathHsbCompany to locate Tsl\\Catalog and Tsl\\Settings folders. Operates as a background utility.",
          "requiredSettings": [
            "XML catalog files in the 'Tsl\\Catalog' folder defined by _kPathHsbCompany"
          ]
        }
      },
      "tokens_used": 1838,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnInsert (when _kExecuteKey is empty)",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "catalogToExport",
            "type": "PropString",
            "displayName": "Catalog to export",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Dynamic list of *.xml files found in _kPathHsbCompany\\Tsl\\Catalog"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "*.xml",
            "searchPaths": [
              "_kPathHsbCompany\\Tsl\\Catalog"
            ],
            "purpose": "Provides the list of available catalogs for the dropdown menu and acts as the input file for conversion",
            "required": true
          }
        ]
      },
      "tokens_used": 4592,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Converts legacy or proprietary XML catalog files located in the company catalog folder into a standard XML format, saving them to the settings folder.",
          "category": "Utility/Configuration",
          "typicalUseCase": "An administrator or advanced user uses this to update or migrate TSL catalog definitions to a compatible XML format for distribution or system updates."
        },
        "parameters": [
          {
            "name": "catalogToExport",
            "technicalDefault": "First file found in _kPathHsbCompany\\Tsl\\Catalog",
            "businessMeaning": "The specific TSL catalog definition file to be converted. This determines which set of script properties and default settings will be processed.",
            "validRange": "Any valid filename existing in the _kPathHsbCompany\\Tsl\\Catalog directory with an .xml extension.",
            "unit": "String (Filename)",
            "affectsOutput": "Directly determines the content of the generated XML file in the Settings folder. The content of the output file is a parsed and remapped version of this source file."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "catalogToExport selection",
            "effect": "Sets the source path for reading and determines the output filename (by appending 'Catalog' to the selection name).",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "XML File",
            "description": "A new XML file representing the catalog structure, written to _kPathHsbCompany\\Tsl\\Settings.",
            "appliedTo": "File System (Utility output, not applied to specific CAD entities)"
          }
        ]
      },
      "tokens_used": 2671,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script insertion initiated (e.g., drag-and-drop or command execution).",
          "Check insert cycle count; if > 1, erase instance and exit immediately.",
          "Determine execution mode by checking _kExecuteKey.",
          "[Branch] If _kExecuteKey is present (silent/scripted mode):",
          "   Retrieve list of catalog names associated with the script.",
          "   Compare _kExecuteKey against catalog names (case-insensitive).",
          "   If match found, set properties from the specific catalog.",
          "   If no match found, set properties from '_LastInserted' catalog.",
          "[Branch] If _kExecuteKey is empty (interactive mode):",
          "   Scan _kPathHsbCompany\\Tsl\\Catalog for *.xml files.",
          "   Display 'ShowDynamicDialog' with list of found XML files.",
          "   User selects 'Catalog to export'.",
          "[Merge] Execution proceeds to file processing:",
          "   Construct full file path for the selected source XML.",
          "   Read the text content of the source XML file line by line.",
          "   Parse XML lines to identify HSB_NAME entries and property types (PropString, PropDouble, PropInt).",
          "   Populate a Map structure with the extracted key-value pairs.",
          "   Generate output filename (remove .xml, append 'Catalog.xml').",
          "   Write the Map content to a new XML file in _kPathHsbCompany\\Tsl\\Settings.",
          "Erase the script instance.",
          "End execution."
        ],
        "conditionalBranches": [
          {
            "condition": "Value of _kExecuteKey (Silent vs Interactive launch)",
            "path1": {
              "name": "Silent/Scripted Mode",
              "steps": [
                "Read _kExecuteKey string.",
                "Check if key exists in the script's catalog list.",
                "Load properties from the matched catalog or fall back to default."
              ]
            },
            "path2": {
              "name": "Interactive Mode",
              "steps": [
                "Identify available XML files in the Catalog folder.",
                "Show Dynamic Dialog to user.",
                "Wait for user to select a file from the dropdown list."
              ]
            }
          },
          {
            "condition": "Insert Cycle Count (Startup stability check)",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Execute eraseInstance()",
                "Return immediately"
              ]
            },
            "path2": {
              "name": "Cycle == 1",
              "steps": [
                "Proceed with main logic"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of XML files in _kPathHsbCompany\\Tsl\\Catalog",
            "errorMessage": "Implicit failure if PropString list is empty; user may see empty dropdown.",
            "recovery": "Ensure valid XML catalog files are present in the company path folder."
          },
          {
            "check": "Source XML file structure",
            "errorMessage": "Script assumes specific XML tokens (e.g., '<HSB_NAME', 'PROPSTRING'). If parsing fails, empty output may result.",
            "recovery": "Verify source XML conforms to the expected TSL catalog schema."
          },
          {
            "check": "File I/O permissions",
            "errorMessage": "Implicit failure during readTextFile or writeToXmlFile if folders are read-only.",
            "recovery": "Check write permissions for _kPathHsbCompany\\Tsl\\Settings."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None (Script self-destructs)",
            "how": "N/A",
            "effect": "The script calls eraseInstance() immediately after writing the file. No TSL instance remains in the drawing to be edited via OPM or context menu."
          }
        ]
      },
      "tokens_used": 3952,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-ExportTSLCatalogToXML.mcr\n\n## Overview\nThis utility script converts TSL catalog XML files from the company catalog folder into a standardized XML format and saves them to the settings folder. It is designed for administrators to update or migrate script definitions and automatically removes itself from the drawing after execution.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This is a utility script that operates in the background and does not create geometry. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: None.\n- **Minimum Beam Count**: 0.\n- **Required Settings**:\n  - Valid XML catalog files must exist in the `_kPathHsbCompany\\Tsl\\Catalog` folder.\n  - User must have write permissions for the `_kPathHsbCompany\\Tsl\\Settings` folder.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_G-ExportTSLCatalogToXML.mcr`\n\n### Step 2: Select Catalog to Export\n```\nProperties Palette / Dynamic Dialog: Catalog to export\nAction: Click the dropdown menu and select the desired XML file name from the list found in your Catalog folder.\n```\n*Note: Once a file is selected, the script will immediately process the file.*\n\n### Step 3: Verification\nThe script instance will vanish from the drawing. Check the `Tsl\\Settings` folder to confirm the new XML file has been created.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Catalog to export | dropdown | (First file found) | Select the specific XML catalog file from the `Tsl\\Catalog` folder that you wish to convert and export. |\n\n## Right-Click Menu Options\n*(None - The script erases itself immediately after running, so no context menu is available.)*\n\n## Settings Files\n- **Input Filename**: `*.xml`\n- **Input Location**: `_kPathHsbCompany\\Tsl\\Catalog`\n- **Purpose**: Provides the source data for property definitions (e.g., PropString, PropDouble, HSB_NAME) to be converted.\n\n- **Output Filename**: `[SelectedName]Catalog.xml`\n- **Output Location**: `_kPathHsbCompany\\Tsl\\Settings`\n- **Purpose**: The standardized XML file generated by the script, containing the parsed catalog data.\n\n## Tips\n- **Automatic Cleanup**: Do not be alarmed if the script block disappears immediately after insertion; this is the intended behavior for a utility script.\n- **File Naming**: The output file will be named after the file you selected in the dropdown, with \"Catalog.xml\" appended (e.g., selecting \"Wall.xml\" results in \"WallCatalog.xml\").\n- **Permissions**: If the script seems to fail silently, ensure you have write access to your company's `Tsl\\Settings` folder.\n\n## FAQ\n- **Q: Where did the script go after I inserted it?**\n  A: This is a \"self-destructing\" utility script. It performs the file conversion and deletes its own instance from the drawing immediately afterwards.\n\n- **Q: How do I know if the export was successful?**\n  A: Navigate to your `Tsl\\Settings` folder (defined in your hsbCAD Company Path) and look for the newly created `.xml` file with the timestamp or check the file size to ensure it contains data.\n\n- **Q: Can I use this to modify existing catalogs?**\n  A: This script is primarily for exporting/converting existing catalog definitions into the settings folder format. To modify properties, you would typically edit the source XML or use other configuration tools."
      },
      "tokens_used": 4644,
      "error": null
    }
  }
}