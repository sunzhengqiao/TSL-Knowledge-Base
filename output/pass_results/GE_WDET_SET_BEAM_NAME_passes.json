{
  "filename": "GE_WDET_SET_BEAM_NAME.mcr",
  "status": "completed",
  "total_tokens": 51497,
  "processing_time": 567.6674435138702,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "22.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Copied from hsb_SetBeamName, to keep US content folder naming standards"
          },
          {
            "version": "1.36",
            "date": "22.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Version control from 1.0 to 1.36, to keep updated with hsb_SetBeamName\n\t- Thumbnail added"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7878,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity with ElementWall() filter, iterates through ElementWall and Beam entities to modify properties (setName, setColor, setMaterial). No 'sd_' or 'Multipage' prefix, no usage of _Viewport, no #Type E declaration with _Entity[] array typical of shop drawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "ModelSpace",
          "requiredSettings": []
        }
      },
      "tokens_used": 5206,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Please select Elements\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sColor\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Set Default Color\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Set All the beam with Default Color\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sModule\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Set Module Beam with Default Color\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Overwrite the Module Beam Color\"\n    },\n    {\n      \"index\": 23,\n      \"variable\": \"sSetInfo\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Set Information Field\",\n      \"defaultValue\": \"No\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"No\",\n        \"Yes\"\n      ],\n      \"category\": null,\n      \"description\": \"Set the information field if it doesnt"
      },
      "tokens_used": 9579,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Standardizes beam naming, color coding, material assignment, and labeling properties for timber wall elements based on predefined beam type mappings.\",\n    \"category\": \"Utility / Data Management\",\n    \"typicalUseCase\": \"Used after generating wall elements to enforce specific naming conventions (e.g., 'STUD', 'TOP PLATE'), apply color coding for visual filtering, and fill in material/grade information for production reports.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sColor\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Determines if all beams should be colored with a single default color or retain type-specific colors.\",\n      \"validRange\": \"No (Use type colors), Yes (Use default color)\",\n      \"unit\": \"Option\",\n      \"affectsOutput\": \"If 'Yes', overrides specific beam colors with 'Default Color'. If 'No', applies colors defined internally for each beam type (e.g., Studs vs Plates).\"\n    },\n    {\n      \"name\": \"sModule\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Controls whether to force color updates on beams that belong to a pre-defined module.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Option\",\n      \"affectsOutput\": \"If 'No', beams belonging to a module keep their existing color. If 'Yes', module beams are recolored according to the color rules.\"\n    },\n    {\n      \"name\": \"sSetInfo\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Automatically populates the 'Information' attribute of the beam if it is currently empty.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Option\",\n      \"affectsOutput\": \"Updates the beam's Information field to match its Name, useful for labeling in drawings or data exports.\"\n    },\n    {\n      \"name\": \"sSetLabel\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Populates the beam's SubLabel with the name of the Element Group the wall belongs to.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Option\",\n      \"affectsOutput\": \"Sets the SubLabel property to 'Group\\\\SubGroup' format.\"\n    },\n    {\n      \"name\": \"sWallType\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Appends the Wall Type/Code to the beam's SubLabel.\",\n      \"validRange\": \"No, Yes\",\n      \"unit\": \"Option\",\n      \"affectsOutput\": \"Modifies the SubLabel to include the wall type identifier (e.g., 'ExtWall' or specific code) at the end.\"\n    },\n    {\n      \"name\": \"sFilterBeams\",\n      \"technicalDefault\": \"X;\",\n      \"businessMeaning\": \"A list of beam codes to exclude from color assignment.\",\n      \"validRange\": \"String of codes separated by ';'\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Beams with codes matching this list will not have their color changed by the script.\"\n    },\n    {\n      \"name\": \"nColorDef\",\n      \"technicalDefault\": \"7\",\n      \"businessMeaning\": \"The specific color index to apply to all beams if 'Set Default Color' is enabled.\",\n      \"validRange\": \"1-255 (AutoCAD Color Index)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Changes the visual color of the beam entity in the model to the specified index.\"\n    },\n    {\n      \"name\": \"sbmName00 (Jack Over Opening)\",\n      \"technicalDefault\": \"LINTOL PACKERS\",\n      \"businessMeaning\": \"The name assigned to beams located above an opening.\",\n      \"validRange\": \"Any String\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Sets the 'Name' property of the specific beam type.\"\n    },\n    {\n      \"name\": \"sbmName01 (Jack Under Opening)\",\n      \"technicalDefault\": \"SILL STUDS\",\n      \"businessMeaning\": \"The name assigned to beams located under an opening.\",\n      \"validRange\": \"Any String\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Sets the 'Name' property of the specific beam type.\"\n    },\n    {\n      \"name\": \"sbmName02 (Cripple Stud)\",\n      \"technicalDefault\": \"CRIPPLE\",\n      \"businessMeaning\": \"The name assigned to cripple studs.\",\n      \"validRange\": \"Any String\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Sets the 'Name' property of the specific beam type.\"\n    },\n    {\n      \"name\": \"sbmName04 (King Stud)\",\n      \"technicalDefault\": \"STUD\",\n      \"businessMeaning\": \"The name assigned to king studs.\",\n      \"validRange\": \"Any String\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Sets the 'Name' property of the specific beam type.\"\n    },\n    {\n      \"name\": \"sbmName08 (TopPlate)\",\n      \"technicalDefault\": \"TOP PLATE\",\n      \"businessMeaning\": \"The name assigned to standard top plates.\",\n      \"validRange\": \"Any String\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Sets the 'Name' property of the specific beam type.\"\n    },\n    {\n      \"name\": \"sbmName09 (Bottom Plate)\",\n      \"technicalDefault\": \"BOTTOM PLATE\",\n      \"businessMeaning\": \"The name assigned to bottom plates.\",\n      \"validRange\": \"Any String\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Sets the 'Name' property of the specific beam type.\"\n    },\n    {\n      \"name\": \"sbmName15 (Header)\",\n      \"technicalDefault\": \"LINTOL\",\n      \"businessMeaning\": \"The name assigned to header/linthel beams.\",\n      \"validRange\": \"Any String\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Sets the 'Name' property of headers. If empty, uses the name from the detail generation.\"\n    },\n    {\n      \"name\": \"sMaterialToSet\",\n      \"technicalDefault\": \"CLS\",\n      \"businessMeaning\": \"The default material species/type to assign to beams if their current material is empty or 'PACKER'.\",\n      \"validRange\": \"String (e.g., CLS, SPF, GLULAM)\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Updates the Material property of beams for BOMs and machining logic.\"\n    },\n    {\n      \"name\": \"sGradeToSet\",\n      \"technicalDefault\": \"C16\",\n      \"businessMeaning\": \"The default structural grade to assign to beams if their current grade is empty.\",\n      \"validRange\": \"String (e.g., C16, C24, SS)\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Updates the Grade property of beams for structural calculations and reports.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"sColor is set to 'Yes'\",\n      \"effect\": \"The script uses the value from 'nColorDef' for all beams.\",\n      \"cascade\": [\n        \"nColorDef\"\n      ]\n    },\n    {\n      \"trigger\": \"sColor is set to 'No'\",\n      \"effect\": \"The script uses a hardcoded internal array of colors mapped to beam types.\",\n      \"cascade\": []\n    },\n    {\n      \"trigger\": \"sSetLabel is 'No' and sWallType is 'Yes'\",\n      \"effect\": \"The SubLabel is overwritten with only the Wall Type (no Group Name).\",\n      \"cascade\": []\n    },\n    {\n      \"trigger\": \"sSetLabel is 'Yes' and sWallType is 'Yes'\",\n      \"effect\": \"The SubLabel is set to 'Group Name' + ' ' + 'Wall Type'.\",\n      \"cascade\":"
      },
      "tokens_used": 9570,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch: User executes GE_WDET_SET_BEAM_NAME.mcr. TSL initializes properties (Beam Names, Color options, Filter strings) and arrays mapping internal beam types to names and colors.",
          "2. Insertion Sequence Check: Script checks if it is in insertion mode (_bOnInsert). If not a re-calculation, it checks insertCycleCount to prevent duplicate instances.",
          "3. Dialog Prompt: If execution key is empty, showDialogOnce() is called to display the OPM properties or a configuration dialog.",
          "4. Entity Selection (Insert Mode): Prompt 'Please select Elements' appears. User selects one or more ElementWall entities via PrEntity.",
          "5. Selection Storage: Selected ElementWall entities are appended to the internal _Element array. Script returns, waiting for database creation or next trigger.",
          "6. Database Verification: On subsequent execution (_bOnInsert is false), script checks if _Element array is empty. If empty, the script instance erases itself.",
          "7. Dependency Setting: setDependencyOnEntity is set to the first element in the array to link the script lifecycle to the wall's existence.",
          "8. Filter Preparation: The 'sFilterBeams' property string is parsed into a string array (sBeamFilter) to identify codes to exclude from color changes.",
          "9. Element Processing Loop: Loop iterates through each selected ElementWall.",
          "10. Beam Retrieval: All beams belonging to the current ElementWall are retrieved into the bmAll array.",
          "11. Pre-Processing Loop (Type Correction): A loop checks every beam's HSB ID and Beam Code. If matches are found in specific ID or Code arrays, the beam's type is updated using setType().",
          "12. Grade/Material Inference: The script inspects Studs (Standard or Left) to find the first non-empty Grade and Material. If none found, it defaults to script properties 'sGradeToSet' (C16) and 'sMaterialToSet' (CLS).",
          "13. Main Processing Loop: Iterates through all beams again to apply properties.",
          "14. Name Assignment: Checks beam type against the master list (nBmType). If found (and not excluded), sets the beam Name based on the mapped property. Special logic: if Name is 'LOCATING PLATE', type is forced to Locating Plate.",
          "15. Material Assignment: If beam is not a Header, and material is empty or 'PACKER', sets material to the inferred/specified value.",
          "16. Color Assignment Logic: Determines if the beam is in a Module. If empty or if 'Set Module Beam' property is Yes, proceeds to set color.",
          "17. Color Application: Checks if the beam code is in the exclusion list (sFilterBeams). If not excluded, applies 'nColorDef' (if 'Set Default Color' is Yes) or the specific color from the internal array (nColor).",
          "18. Grade Assignment: If the beam's current grade is empty, sets it to the inferred/specified value.",
          "19. Information Field Update: If 'Set Information Field' is Yes and the Information field is empty, sets it to the determined Name.",
          "20. SubLabel Assignment: If 'Set subLabel' is Yes, sets SubLabel to the Group Name (formatted as 'Group\\SubGroup').",
          "21. Wall Type Label Update: If 'Append Wall Type' is Yes, appends the Wall Type code to the SubLabel. Overwrites SubLabel if 'Set subLabel' was No.",
          "22. Sheet Naming: Loops through various sheet indexes (1, -1, 2, -2, etc.) of the ElementWall and sets the Sheet Name to match the Sheet Material.",
          "23. Completion: After processing all elements, the script instance erases itself to remove the temporary logic instance from the drawing."
        ],
        "conditionalBranches": [
          {
            "condition": "Script Execution Context (_bOnInsert)",
            "path1": {
              "name": "Initial Insertion",
              "steps": [
                "Check insertCycleCount > 1",
                "Show Dialog (showDialogOnce)",
                "Prompt user to select Elements (PrEntity)",
                "Store entities in _Element array",
                "Exit Script (return)"
              ]
            },
            "path2": {
              "name": "Calculation / Update",
              "steps": [
                "Validate _Element array is not empty",
                "Parse Filter String",
                "Loop Elements and Beams",
                "Apply Names, Colors, Grades, Materials",
                "Erase Instance"
              ]
            }
          },
          {
            "condition": "Beam Type Identification (ID vs Code vs Current Type)",
            "path1": {
              "name": "ID/Code Match",
              "steps": [
                "Pre-processing loop finds HSB ID or Beam Code match",
                "Updates Beam Type via setType()"
              ]
            },
            "path2": {
              "name": "No Match",
              "steps": [
                "Beam retains existing type",
                "Proceeds to main loop for property application"
              ]
            }
          },
          {
            "condition": "Color Assignment (sColor - Set Default Color)",
            "path1": {
              "name": "Yes (Use Default)",
              "steps": [
                "Check Module status",
                "Check Exclusion Filter",
                "Apply 'nColorDef' to beam"
              ]
            },
            "path2": {
              "name": "No (Use Type Specific)",
              "steps": [
                "Check Module status",
                "Check Exclusion Filter",
                "Lookup beam type in array",
                "Apply specific color index from array"
              ]
            }
          },
          {
            "condition": "Module Beam Color Override (sModule)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Ignore existing module status",
                "Force apply color rules"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Check if beam has a module name",
                "If module name exists, skip color change"
              ]
            }
          },
          {
            "condition": "SubLabel Logic (sSetLabel vs sWallType)",
            "path1": {
              "name": "Set Label ON, Append Wall ON",
              "steps": [
                "SubLabel = Group Name",
                "SubLabel += ' ' + Wall Type"
              ]
            },
            "path2": {
              "name": "Set Label OFF, Append Wall ON",
              "steps": [
                "SubLabel = Wall Type (Overwrites existing)"
              ]
            },
            "path3": {
              "name": "Set Label ON, Append Wall OFF",
              "steps": [
                "SubLabel = Group Name"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases itself automatically if insertCycleCount > 1 to prevent duplicate execution."
          },
          {
            "check": "Element Selection",
            "errorMessage": "None (Silent failure)",
            "recovery": "If user selects nothing (ssE.go() fails or ents.length() is 0), script exits without storing elements. If elements were previously stored but are now invalid (_Element.length()==0 or bIsValid false), script erases itself."
          },
          {
            "check": "Material/Grade Inference",
            "errorMessage": "None",
            "recovery": "Defaults to script property values 'sMaterialToSet' (CLS) and 'sGradeToSet' (C16) if no studs are found with valid data."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Configuration",
            "how": "Properties Palette (OPM)",
            "effect": "User can change 'Set Default Color', 'Set Module Beam', specific 'Beam Names', 'Material', 'Grade', or 'Filter' strings. Changing a property triggers a recalculation of the script on the linked elements."
          },
          {
            "action": "Geometry Changes to Wall",
            "how": "Grip Edit / hsbCAD Wall Edit",
            "effect": "Since setDependencyOnEntity is used, modifying the geometry of the linked wall triggers the script to re-run, re-assigning names, colors, and materials to new or modified beams within the wall."
          },
          {
            "action": "Right-Click Context Menu",
            "how": "Recalculate (if available/triggered)",
            "effect": "Forces the script to re-evaluate all beams based on current property settings."
          }
        ]
      },
      "tokens_used": 11218,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_WDET_SET_BEAM_NAME.mcr\n\n## Overview\nA utility script that standardizes the naming, color coding, material assignment, and labeling of beams within timber wall elements. It enforces project naming conventions (e.g., \"STUD\", \"TOP PLATE\") and updates properties for BOM and production reports.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used to modify ElementWall entities directly in the 3D model. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | This is a model editing tool. |\n\n## Prerequisites\n- **Required Entities**: ElementWall entities containing beams.\n- **Minimum Beam Count**: 0 (Walls can be empty or fully populated).\n- **Required Settings**: None (all settings are internal script properties).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_WDET_SET_BEAM_NAME.mcr`\n\n### Step 2: Select Wall Elements\n```\nCommand Line: Please select Elements\nAction: Click on one or more timber wall elements (ElementWall) in the model. Press Enter to confirm selection.\n```\n*Note: Once selected, the script will automatically process the walls based on the current Property settings and then erase itself from the drawing.*\n\n### Step 3: Modify Settings (Optional)\nIf you wish to change naming conventions or colors before the script processes (or if you re-insert the script for adjustments):\n```\nAction: Select the script instance (if visible) or use the Properties Palette to change parameters like \"Set Default Color\", \"Material\", or specific beam names.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Set Default Color | dropdown | No | If \"Yes\", applies a single color to all beams. If \"No\", applies type-specific colors. |\n| Set Module Beam with Default Color | dropdown | No | If \"Yes\", forces color updates on beams belonging to a module. If \"No\", module beams retain their current color. |\n| Set Information Field | dropdown | No | If \"Yes\", automatically fills the beam's \"Information\" field with its Name (if empty). |\n| Set subLabel | dropdown | No | If \"Yes\", sets the beam's SubLabel to the Element Group name. |\n| Append Wall Type | dropdown | No | If \"Yes\", appends the Wall Type code to the beam's SubLabel. |\n| Filter Beams | text | X; | A list of beam codes separated by `;` (e.g., `X;BRACE`) to exclude from color changes. |\n| Default Color | number | 7 | The AutoCAD Color Index (1-255) used if \"Set Default Color\" is Yes. |\n| Name (Jack Over Opening) | text | LINTOL PACKERS | Sets the name for beams located above openings. |\n| Name (Jack Under Opening) | text | SILL STUDS | Sets the name for beams located under openings. |\n| Name (Cripple Stud) | text | CRIPPLE | Sets the name for cripple studs. |\n| Name (King Stud) | text | STUD | Sets the name for king studs. |\n| Name (TopPlate) | text | TOP PLATE | Sets the name for top plates. |\n| Name (Bottom Plate) | text | BOTTOM PLATE | Sets the name for bottom plates. |\n| Name (Header) | text | LINTOL | Sets the name for header/linthel beams. |\n| Material To Set | text | CLS | Default material species assigned if the beam has no material or is marked 'PACKER'. |\n| Grade To Set | text | C16 | Default structural grade assigned if the beam has no grade. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Forces the script to re-run and apply the current property settings to the linked wall elements. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: All configuration is handled via the Properties Palette (OPM).\n\n## Tips\n- **Auto-Erase**: This script automatically erases itself from the drawing after processing. Do not be alarmed if it disappears; the changes to the beams remain.\n- **Smart Defaults**: The script attempts to infer the Material and Grade from existing \"Stud\" beams in the wall. If none are found, it uses the values defined in \"Material To Set\" and \"Grade To Set\".\n- **Color Filtering**: Use the `Filter Beams` property to prevent specific elements (like metal braces or hardware) from being recolored. Add their beam codes to the list separated by semicolons.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the walls?**\n  - A: This is intended behavior. The script is a \"run-once\" utility. It processes the data and deletes itself to keep the drawing clean.\n- **Q: Some beams did not change color even though I enabled \"Set Default Color\".**\n  - A: Check if \"Set Module Beam with Default Color\" is set to \"No\". If a beam belongs to a module and this setting is No, the script will skip it. Also, verify the beam code is not listed in the \"Filter Beams\" property.\n- **Q: Can I change the names of the beams after the script has run?**\n  - A: Yes, but you will need to insert the script again, adjust the \"Name\" properties in the palette, and select the walls again to overwrite them."
      },
      "tokens_used": 8046,
      "error": null
    }
  }
}