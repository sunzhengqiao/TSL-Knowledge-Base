{
  "filename": "HSB_W-IntegrateHeader.mcr",
  "status": "completed",
  "total_tokens": 23076,
  "processing_time": 498.89253759384155,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "20.06.2012",
            "author": "AS",
            "changes": "Pilot version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3895,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly targets ModelSpace via _kModelSpace in dbCreate call. No detection of sd_ prefix, _Viewport usage, or #Type E patterns typical of Paper Space or Shop Drawing scripts. The script operates on 3D geometry (Beam, OpeningSF) and modifies GenBeams."
        },
        "prerequisites": {
          "requiredEntities": [
            "OpeningSF",
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Must be run in an environment with 3D model elements (walls/openings) containing beams.",
          "requiredSettings": []
        }
      },
      "tokens_used": 2098,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && _kExecuteKey==\"\"",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select one or more openings|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnInsert (before entity selection)",
            "title": null,
            "dataSource": "Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sBmCodeHeader",
            "type": "PropString",
            "displayName": "|Beamcode Header|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2882,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically notches wall studs to accommodate the header beam located above an opening.",
          "category": "Framing/Joinery",
          "typicalUseCase": "Used after placing a header beam over a door or window opening to cut the vertical studs so they fit correctly under/around the header."
        },
        "parameters": [
          {
            "name": "sBmCodeHeader",
            "technicalDefault": "",
            "businessMeaning": "The 'Beam Code' property value that identifies which beam within the wall is the header beam.",
            "validRange": "Any non-empty string matching the project naming convention for headers (e.g., 'H', 'HDR', 'HEAD').",
            "unit": "String",
            "affectsOutput": "Determines which beam is treated as the header. The script calculates the volume of this beam and subtracts it (via tooling) from intersecting vertical studs."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Model Entity Properties",
            "effect": "The script relies on the 'beamCode' property of existing beams in the model. If the input parameter does not match the beamCode of the actual header, no cuts will be generated.",
            "cascade": [
              "sBmCodeHeader"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "BeamCut (Notch)",
            "description": "A rectangular notch cut from the top end of the vertical studs to create space for the header beam.",
            "appliedTo": "Vertical beams (studs) found within the same element that geometrically intersect with the header beam."
          }
        ]
      },
      "tokens_used": 4188,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches HSB_W-IntegrateHeader script",
          "Script checks insert cycle count (Cycle 1: Proceed; Cycle 2+: Erase)",
          "Properties Dialog displays (User inputs 'Beamcode Header')",
          "Command line prompts user to select one or more OpeningSF entities",
          "Script iterates through selected openings",
          "For each opening, Master script spawns a Satellite instance of itself attached to the opening",
          "Master script passes 'MasterToSatellite' map flag with property values",
          "Master script erases itself",
          "Satellite instance reads properties from map",
          "Satellite retrieves parent Element (Wall) and all contained Beams",
          "Satellite filters Beams: Identifies Headers (by BeamCode) and Vertical Studs (by geometry)",
          "For each Header found, Satellite calculates its volume (Cutting Body)",
          "Satellite checks intersection between Header Cutting Body and Vertical Studs",
          "If intersecting, Satellite adds static tooling (Notch) to the Vertical Stud",
          "Satellite instance erases itself"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Execute eraseInstance()",
                "Terminate script"
              ]
            },
            "path2": {
              "name": "Cycle 1 (Initial Launch)",
              "steps": [
                "Display Property Dialog",
                "Prompt for Entity Selection",
                "Execute Logic"
              ]
            }
          },
          {
            "condition": "Beam Identification Loop",
            "path1": {
              "name": "BeamCode matches input parameter",
              "steps": [
                "Add beam to 'arBmHeader' array",
                "Prepare for Cutting Body calculation"
              ]
            },
            "path2": {
              "name": "BeamCode does not match",
              "steps": [
                "Add beam to 'arBmNoHeader' array",
                "Filter for perpendicular beams (Vertical Studs)"
              ]
            }
          },
          {
            "condition": "Geometric Intersection Check",
            "path1": {
              "name": "Vertical Stud intersects Header Cutting Body",
              "steps": [
                "Execute bmVertical.addToolStatic(bmCutHeader)",
                "Apply notch to stud"
              ]
            },
            "path2": {
              "name": "No geometric intersection",
              "steps": [
                "Skip beam (No modification)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Opening Selection (PrEntity)",
            "errorMessage": "None explicitly printed to console, but script exits if selection is empty/cancelled.",
            "recovery": "User must run script again and select valid OpeningSF entities."
          },
          {
            "check": "Header Beam Detection",
            "errorMessage": "No cuts are generated if no beams in the element possess the 'beamCode' specified in the properties.",
            "recovery": "User must verify the 'beamCode' property on the header beam matches the script input exactly."
          },
          {
            "check": "Entity Validity",
            "errorMessage": "Script instance erases itself if the attached entity is not a valid OpeningSF or has no valid parent Element.",
            "recovery": "Ensure openings are properly part of a wall element (Element) before running."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None (Script is transient)",
            "how": "N/A",
            "effect": "The script instance executes once and erases itself automatically. There are no grips, context menus, or OPM properties available for the script after execution. The resulting notches are static tooling on the beams; to change them, the user must undo or manually modify the beams."
          }
        ]
      },
      "tokens_used": 5621,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_W-IntegrateHeader.mcr\n\n## Overview\nThis script automates the framing process by cutting notches in vertical wall studs to accommodate header beams located above openings (such as windows or doors).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D model elements (Beams, Openings). |\n| Paper Space | No | Not designed for 2D drawing views. |\n| Shop Drawing | No | Does not generate views or dimensions. |\n\n## Prerequisites\n- **Required Entities**: Wall Elements (`Element`) containing Openings (`OpeningSF`) and Beams (`GenBeam`).\n- **Minimum Beam Count**: The wall must contain both a header beam and vertical studs.\n- **Preparation**: The header beam must have a specific \"Beam Code\" assigned to it in the element properties before running this script.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: Type `TSLINSERT` in the command line and select `HSB_W-IntegrateHeader.mcr`.\n\n### Step 2: Configure Properties\n```\nInterface: Dynamic Properties Dialog\nAction: Locate the \"Beamcode Header\" field. Enter the exact string used as the Beam Code property for your header beams (e.g., \"H\", \"HDR\", or \"HEAD\"). Click OK to proceed.\n```\n\n### Step 3: Select Openings\n```\nCommand Line: Select one or more openings\nAction: Click on the OpeningSF entities (window/door symbols) in the drawing that require header integration. Press Enter to confirm selection.\n```\n*Note: The script will automatically process the parent wall elements associated with the selected openings.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Beamcode Header | Text | (Empty) | The \"Beam Code\" property value that identifies which beam within the wall is the header beam. Only beams matching this code will be used to cut the studs. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script executes once and erases itself. There are no editable context menu options after insertion. |\n\n## Settings Files\n- **Filename**: None used.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Verify Beam Codes**: Before running the script, select a header beam in your model and check its Properties Palette to ensure the \"Beam Code\" matches what you plan to type into the script dialog.\n- **Batch Processing**: You can select multiple openings at once during the selection prompt to process several headers in a single operation.\n- **Static Tooling**: The cuts created by this script are static tooling. If you move the header or opening later, the cuts will not automatically update. You must undo and re-run the script if the geometry changes.\n\n## FAQ\n- **Q: I ran the script, but no notches appeared on the studs. Why?**\n- **A:** This usually happens if the \"Beamcode Header\" parameter does not exactly match the \"Beam Code\" property of the header beam in the wall. Check for typos or extra spaces in the code.\n- **Q: Can I edit the notch size after running the script?**\n- **A:** No. The script creates a permanent cut on the beam geometry. To change the integration, you must use the Undo command to revert the script execution, modify your setup, and run it again.\n- **Q: Does this script work on curved walls?**\n- **A:** The script calculates geometric intersections. While designed for standard framing, it will attempt to cut any stud intersecting the header volume, provided the beams are standard GenBeams."
      },
      "tokens_used": 4392,
      "error": null
    }
  }
}