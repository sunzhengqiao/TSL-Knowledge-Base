{
  "filename": "hsb_Wall to Wall Connection.mcr",
  "status": "completed",
  "total_tokens": 57384,
  "processing_time": 261.91009163856506,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": null,\n  \"versionHistory\": [\n    {\n      \"version\": \"1.0\",\n      \"date\": \"25.05.2008\",\n      \"author\": \"Alberto Jena (aj@hsb-cad.com)\",\n      \"changes\": \"Release Version\"\n    },\n    {\n      \"version\": \"1.1\",\n      \"date\": \"24.02.2009\",\n      \"author\": \"\",\n      \"changes\": \"Fully T Connections Support\"\n    },\n    {\n      \"version\": \"1.2\",\n      \"date\": \"25.02.2009\",\n      \"author\": \"\",\n      \"changes\": \"T and Corner Connections Support\"\n    },\n    {\n      \"version\": \"1.3\",\n      \"date\": \"02.06.2009\",\n      \"author\": \"\",\n      \"changes\": \"Bug fix with the definition of Male and Female elements and add a property to center the studs on a L connection\"\n    },\n    {\n      \"version\": \"1.4\",\n      \"date\": \"02.06.2009\",\n      \"author\": \"\",\n      \"changes\": \"Allow the TSL to be insert from the Palette\\n\\t\\t\\tThe conecctions stay available after generation\\n\\t\\t\\tAdd a custom command to regenerate the connection\\n\\t\\t\\tAdd a Display\"\n    },\n    {\n      \"version\": \"1.5\",\n      \"date\": \"31.07.2009\",\n      \"author\": \"\",\n      \"changes\": \"Add double stud option\\n\\t\\t\\tFix the Corner connections\"\n    },\n    {\n      \"version\": \"1.6\",\n      \"date\": \"09.03.2010\",\n      \"author\": \"\",\n      \"changes\": \"Fix issue on invert corner connection\\n\\t\\t\\tRemove Itself if it's insert multiple times in the same connection\"\n    },\n    {\n      \"version\": \"1.7\",\n      \"date\": \"16.03.2012\",\n      \"author\": \"\",\n      \"changes\": \"Fix issue when stretching to an angled top plate\"\n    },\n    {\n      \"version\": \"1.9\",\n      \"date\": \"12.04.2012\",\n      \"author\": \"\",\n      \"changes\": \"Fix issue with the orientation of the multiple studs\"\n    },\n    {\n      \"version\": \"1.10\",\n      \"date\": \"18.04.2012\",\n      \"author\": \"\",\n      \"changes\": \"Changed module of created beams to Handle of TSLInst\"\n    },\n    {\n      \"version\": \"1.11\",\n      \"date\": \"21.11.2012\",\n      \"author\": \"\",\n      \"changes\": \"Add a check so it wont delete Beams that are part of a module in case they overlap"
      },
      "tokens_used": 9445,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script creates physical construction entities using Beam().dbCreate() and manipulates ElementWall objects. It uses PrEntity for model selection and performs geometric calculations (intersectPoints, stretchDynamicTo) on 3D bodies. It lacks ShopDrawing prefixes (sd_*), Viewport handling, or 2D drawing generation logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 7910,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"\\nSelect 2 Walls Connected\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Type|\",\n      \"defaultValue\": \"|L Backer|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|L Backer|\",\n        \"|L Backet Reverse|\",\n        \"|U Shape|\",\n        \"Multiple Studs\"\n      ],\n      \"category\": null,\n      \"description\": \"\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"nStuds\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Studs Qty|\",\n      \"defaultValue\": \"1\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"1\",\n        \"2\",\n        \"3\",\n        \"4\",\n        \"5\",\n        \"6\",\n        \"7\",\n        \"8\",\n        \"9\",\n        \"10\",\n        \"11\",\n        \"12\",\n        \"13\",\n        \"14\",\n        \"15\",\n        \"16\",\n        \"17\",\n        \"18\",\n        \"19\",\n        \"20\"\n      ],\n      \"category\": null,\n      \"description\": \"Only valid when Multiple Studs are selected above\"\n    },\n    {\n      \"index\": 0"
      },
      "tokens_used": 10897,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the generation of structural framing connections (studs and backers) at the intersection of two timber walls, handling both Corner (L) and T-junctions.",
          "category": "Framing",
          "typicalUseCase": "Used during the wall layout phase to automatically place intersecting studs and backing plates where two walls meet, ensuring structural continuity and nailing surfaces for sheathing."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "|L Backer|",
            "businessMeaning": "Specifies the geometric configuration of the wall intersection connection. Determines whether a single backer, a reverse backer, a U-channel, or a column of multiple studs is used.",
            "validRange": "L Backer, L Backer Reverse, U Shape, Multiple Studs",
            "unit": "Enumeration",
            "affectsOutput": "Switches the logic used to generate beams, changing the number, position, and orientation of studs and backers."
          },
          {
            "name": "nStuds",
            "technicalDefault": "1",
            "businessMeaning": "Defines the number of studs to generate when 'Multiple Studs' is selected as the connection type.",
            "validRange": "1 - 20",
            "unit": "Count",
            "affectsOutput": "Controls the loop creating stud beams at the intersection. Creates a dense block of studs for structural transfer or utility chases."
          },
          {
            "name": "dBackerBmHeight",
            "technicalDefault": "89",
            "businessMeaning": "Sets the vertical height (depth in the wall plane) of the backing/nailing beam used in U-shape or L-connection configurations.",
            "validRange": "Standard lumber depths (e.g., 89mm, 140mm, 184mm)",
            "unit": "mm",
            "affectsOutput": "Resizes the generated Backer beam geometry along the wall's Y-axis."
          },
          {
            "name": "dBackerBmWidth",
            "technicalDefault": "38",
            "businessMeaning": "Sets the thickness of the backing/nailing beam.",
            "validRange": "Standard lumber widths (e.g., 38mm, 45mm)",
            "unit": "mm",
            "affectsOutput": "Resizes the generated Backer beam geometry along the wall's X-axis."
          },
          {
            "name": "sLocation",
            "technicalDefault": "No",
            "businessMeaning": "Toggles the alignment of the primary stud in an L-connection. If Yes, centers the stud on the corner axis; if No, aligns it to one side.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "Offsets the insertion point of the stud relative to the wall intersection line."
          },
          {
            "name": "sDoubleStud",
            "technicalDefault": "No",
            "businessMeaning": "Adds a second reinforcing stud adjacent to the primary connection stud in L-connections to increase nailing surface or stiffness.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "Causes the script to generate an additional beam (bmD) parallel to the main stud."
          },
          {
            "name": "sModule",
            "technicalDefault": "No",
            "businessMeaning": "Determines if the generated connection beams are grouped into a logical module controlled by this script instance.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, assigns the beams to the TSL's module handle, allowing them to be deleted or updated together. Sets beam color to the Module Color."
          },
          {
            "name": "nColorModule",
            "technicalDefault": "2",
            "businessMeaning": "Sets the display color of the generated beams when they are created as a module.",
            "validRange": "CAD Index Color (1-255)",
            "unit": "Index",
            "affectsOutput": "Changes the visual color (bm.setColor) of the studs and backers."
          },
          {
            "name": "sNameS",
            "technicalDefault": "STUD",
            "businessMeaning": "The entity name assigned to the vertical studs generated by the connection.",
            "validRange": "Text String",
            "unit": "String",
            "affectsOutput": "Sets the Name property in the CAM/CNC data for the stud beams."
          },
          {
            "name": "sNameB",
            "technicalDefault": "BACKER",
            "businessMeaning": "The entity name assigned to the horizontal/vertical backing beams.",
            "validRange": "Text String",
            "unit": "String",
            "affectsOutput": "Sets the Name property in the CAM/CNC data for the backer beams."
          },
          {
            "name": "nColorDisp",
            "technicalDefault": "12",
            "businessMeaning": "The color of the TSL icon/display symbol that represents this connection in the model.",
            "validRange": "CAD Index Color",
            "unit": "Index",
            "affectsOutput": "Changes the color of the 3D cross icon drawn by the Display class."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sType = 'Multiple Studs'",
            "effect": "Activates the nStuds parameter to determine quantity.",
            "cascade": [
              "nStuds"
            ]
          },
          {
            "trigger": "sType = 'L Backer' or 'L Backer Reverse'",
            "effect": "Activates sLocation and sDoubleStud options specific to corner detailing.",
            "cascade": [
              "sLocation",
              "sDoubleStud"
            ]
          },
          {
            "trigger": "sModule = 'Yes'",
            "effect": "Activates the nColorModule property to control beam appearance.",
            "cascade": [
              "nColorModule"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam (Stud)",
            "description": "Vertical structural elements created at the wall intersection to transfer loads and provide attachment for sheathing.",
            "appliedTo": "The intersecting (Female) wall."
          },
          {
            "type": "Beam (Backer/Nailing)",
            "description": "Blocking elements (L or U shaped) placed against the main wall to provide a nailing fin for the intersecting wall's end or studs.",
            "appliedTo": "The intersecting (Female) wall."
          },
          {
            "type": "Display Symbol",
            "description": "A 3D cross marker indicating the location and presence of the automated connection.",
            "appliedTo": "Model Space (visual only)."
          }
        ]
      },
      "tokens_used": 10298,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution started (Insert or Recalc)",
          "Check if Insert Mode (_bOnInsert)",
          "[If Insert] Prompt user to Select 2 Connected Walls (PrEntity)",
          "Validate selection: Check if exactly 2 Elements selected",
          "[If Valid] Parse ElementWalls and determine connectivity",
          "Identify Male (elM) and Female (elF) walls based on outline intersection geometry",
          "Calculate intersection point and alignment vectors (vDir, vCon)",
          "Filter and erase existing beams associated with this connection instance",
          "Determine connection geometry based on Property sType (Type)",
          "Generate Stud beams based on configuration (L, U, or Multiple)",
          "Generate Backer/Nailing beams based on configuration",
          "Apply Entity Properties (Name, Material, Grade) to new beams",
          "Assign Beams to Female Element Group or Module (if enabled)",
          "Stretch Studs and Backers vertically to Top and Bottom plates",
          "Detect overlaps with existing vertical studs and erase conflicts",
          "Draw 3D Cross Display Symbol at intersection midpoint",
          "Finalize instance"
        ],
        "conditionalBranches": [
          {
            "condition": "Wall Selection Validation",
            "path1": {
              "name": "Invalid Selection",
              "steps": [
                "Check if _Element.length() != 2",
                "Display Error: 'The selected wall connection is not valid...'",
                "Execute eraseInstance()",
                "Terminate Script"
              ]
            },
            "path2": {
              "name": "Valid Selection",
              "steps": [
                "Proceed to Wall Geometry Analysis",
                "Determine elM and elF validity"
              ]
            }
          },
          {
            "condition": "Connection Type (sType Property)",
            "path1": {
              "name": "L Backer / L Backer Reverse",
              "steps": [
                "Check sDoubleStud property",
                "Create primary Stud (bm) at intersection",
                "[If Double Stud] Create secondary Stud (bmD)",
                "Create Nailing Backer (bm2) perpendicular to wall"
              ]
            },
            "path2": {
              "name": "U Shape",
              "steps": [
                "Create Left Stud (bm)",
                "Create Right Stud (bm3)",
                "Create Nailing Backer (bm2) between studs"
              ]
            },
            "path3": {
              "name": "Multiple Studs",
              "steps": [
                "Loop from i = 0 to nStudsQty",
                "Create Stud at calculated offset",
                "Increment offset by Stud Width"
              ]
            }
          },
          {
            "condition": "Geometry Logic (Corner vs T-Junction)",
            "path1": {
              "name": "Corner Connection",
              "steps": [
                "Verify nCorner flag is TRUE",
                "Offset insertion point (ptCreate) by stud width to align studs flush with wall end",
                "Apply specific offset logic for Double Stud or Backer depth"
              ]
            },
            "path2": {
              "name": "T-Junction Connection",
              "steps": [
                "Verify nCorner flag is FALSE",
                "Calculate insertion point based on wall outline intersection (Midpoint)",
                "Center studs or backers on the intersecting wall"
              ]
            }
          },
          {
            "condition": "Module Assignment (sModule Property)",
            "path1": {
              "name": "Yes (Module)",
              "steps": [
                "Set generated beam color to nColorModule",
                "Assign beam.setModule() to TSL Instance handle"
              ]
            },
            "path2": {
              "name": "No (Standard)",
              "steps": [
                "Set generated beam color to default (32)",
                "Assign beam.assignToElementGroup() to Female Wall"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Input Selection Count",
            "errorMessage": "(Implicit) The selected wall connection is not valid, Please check if the 2 outlines match each other!",
            "recovery": "Script erases itself automatically. User must re-run command and select exactly 2 walls."
          },
          {
            "check": "Wall Connectivity/Intersection",
            "errorMessage": "The selected wall connection is not valid, Please check if the 2 outlines match each other!",
            "recovery": "Script erases itself. User must ensure walls physically touch or overlap correctly in the model."
          },
          {
            "check": "Wall Orientation/Validity",
            "errorMessage": "The selected wall connection is not valid...",
            "recovery": "Script attempts to swap Male/Female definitions. If still invalid, erases instance."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Connection Type",
            "how": "OPM Properties Palette (Change 'Type')",
            "effect": "Deletes existing beams generated by script and regenerates based on new type (L vs U vs Multiple)."
          },
          {
            "action": "Edit Stud Quantity",
            "how": "OPM Properties Palette (Change 'Studs Qty')",
            "effect": "If Type is 'Multiple Studs', adjusts the loop count to add/remove studs."
          },
          {
            "action": "Reapply Connection",
            "how": "Right-click Context Menu -> 'Reapply Wall Connection'",
            "effect": "Forces a full regeneration of the connection geometry, useful if wall outlines changed but didn't trigger auto-update."
          },
          {
            "action": "Toggle Double Stud",
            "how": "OPM Properties Palette (Change 'Double Stud On L Backer')",
            "effect": "Adds or removes the secondary stud beam in L-connection types."
          },
          {
            "action": "Modify Beam Properties",
            "how": "OPM Properties Palette (Stud/Backer Name, Material, Grade)",
            "effect": "Updates the CAM data attributes for all beams managed by this connection."
          }
        ]
      },
      "tokens_used": 11878,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_Wall to Wall Connection\n\n## Overview\nAutomates the generation of structural framing connections (studs and backers) at the intersection of two timber walls. It handles both Corner (L) and T-junctions, creating appropriate nailing surfaces and structural blocking.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for selecting 3D wall elements. |\n| Paper Space | No | Not designed for 2D layout or detailing views. |\n| Shop Drawing | No | This is a model generation script, not a drawing generator. |\n\n## Prerequisites\n- **Required Entities**: Two existing `ElementWall` objects that physically touch or overlap.\n- **Minimum Count**: 2 Walls must be selected.\n- **Required Settings**: None required (uses internal defaults and OPM properties).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Select `hsb_Wall to Wall Connection.mcr` from the file dialog.\n\n### Step 2: Select Walls\n```\nCommand Line: Select 2 Walls Connected\nAction: Click on the two walls that form the intersection (Corner or T-junction).\n```\n\n### Step 3: Configure Connection (Optional)\nAction: Press `Esc` to finish the command. Select the newly created connection symbol (3D Cross) and open the **Properties Palette** (Ctrl+1) to adjust the connection type or stud sizes.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Type** | Dropdown | L Backer | Select the connection configuration: L Backer, L Backer Reverse, U Shape, or Multiple Studs. |\n| **Studs Qty** | Integer | 1 | Number of studs to generate (Only valid when Type is set to 'Multiple Studs'). Range: 1-20. |\n| **Backer Height** | Number | 89 | Vertical height (depth) of the backing/nailing beam (in mm). |\n| **Backer Width** | Number | 38 | Thickness of the backing/nailing beam (in mm). |\n| **Center Stud on L** | Yes/No | No | If Yes, centers the primary stud on the corner axis (for L connections). |\n| **Double Stud** | Yes/No | No | Adds a second reinforcing stud adjacent to the primary connection stud (for L Backer types). |\n| **Create Module** | Yes/No | No | If Yes, groups the generated beams into a module linked to this instance. |\n| **Module Color** | Index | 2 | CAD Color index for the generated beams when 'Create Module' is Yes. |\n| **Stud Name** | String | STUD | Entity name assigned to generated studs for CAM/CNC export. |\n| **Backer Name** | String | BACKER | Entity name assigned to generated backers for CAM/CNC export. |\n| **Display Color** | Index | 12 | Color of the 3D cross symbol representing the connection. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Reapply Wall Connection** | Forces a full regeneration of the connection. Useful if the wall geometry has moved or changed but the connection did not update automatically. |\n\n## Settings Files\nNone required. This script relies entirely on Properties Palette inputs and geometric analysis of the selected walls.\n\n## Tips\n- **Selection Validity**: Ensure the two wall outlines physically touch or overlap in the model. If the script deletes itself immediately, it likely could not detect a valid intersection between the two selected outlines.\n- **T vs L Connections**: The script automatically detects if the intersection is a Corner (L) or a T-Junction based on the wall geometry. You do not need to select a specific type for the geometry, only the framing style (e.g., U-Shape vs L-Backer).\n- **Utility Chases**: Use the \"Multiple Studs\" type to create a block of studs, which can serve as a chase for plumbing or electrical runs, or for heavy load transfer points.\n- **Module Management**: Enable \"Create Module\" if you want to delete or move the entire connection assembly easily by selecting the connection symbol.\n\n## FAQ\n- **Q: Why did the script disappear after I selected the walls?**\n  A: The script performs a validation check. If the outlines of the two walls do not match or touch correctly, the script displays an error and deletes itself. Check that your walls are properly joined.\n- **Q: How do I change a corner from a single stud to a U-shape?**\n  A: Select the connection symbol in the model, open the Properties Palette (Ctrl+1), and change the \"Type\" property to \"U Shape\". The connection will update automatically.\n- **Q: Can I use this for walls that are not 90 degrees?**\n  A: Yes, the script calculates intersections based on wall geometry, so angled walls are supported provided they overlap correctly."
      },
      "tokens_used": 6956,
      "error": null
    }
  }
}