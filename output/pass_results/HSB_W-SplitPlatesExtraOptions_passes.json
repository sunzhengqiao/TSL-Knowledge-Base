{
  "filename": "HSB_W-SplitPlatesExtraOptions.mcr",
  "status": "completed",
  "total_tokens": 56711,
  "processing_time": 840.1054635047913,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9278,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script manipulates ElementWallSF and GenBeam/Beam objects using 3D operations (dbSplit). It uses PrEntity to select wall elements. No ShopDrawing API (sd_*) or PaperSpace specific keywords (_Viewport, _kPaperSpace) are found in the script."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing Wall elements (ElementWallSF)",
          "requiredSettings": []
        }
      },
      "tokens_used": 6777,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select element(s)|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "PropertiesDialog",
            "trigger": "_bOnInsert",
            "title": "Properties",
            "dataSource": "OPM Properties defined in script",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dMaxLength",
            "type": "PropDouble",
            "displayName": "Maximum length",
            "defaultValue": "4800 mm",
            "inputType": "number",
            "options": [],
            "category": "General",
            "description": null
          },
          {
            "index": 1,
            "variable": "dSizeOpeningModule",
            "type": "PropDouble",
            "displayName": "Opening module dimensions greater than",
            "defaultValue": "605 mm",
            "inputType": "number",
            "options": [],
            "category": "General",
            "description": null
          },
          {
            "index": 2,
            "variable": "dDistOpeningModule",
            "type": "PropDouble",
            "displayName": "Split distance to opening module",
            "defaultValue": "269 mm",
            "inputType": "number",
            "options": [],
            "category": "General",
            "description": null
          },
          {
            "index": 3,
            "variable": "dDistSmallModule",
            "type": "PropDouble",
            "displayName": "Split distance to small module",
            "defaultValue": "119 mm",
            "inputType": "number",
            "options": [],
            "category": "General",
            "description": null
          },
          {
            "index": 4,
            "variable": "dDistStud",
            "type": "PropDouble",
            "displayName": "Split distance to stud",
            "defaultValue": "119 mm",
            "inputType": "number",
            "options": [],
            "category": "General",
            "description": null
          },
          {
            "index": 0,
            "variable": "sSideClearSpaceStud",
            "type": "PropString",
            "displayName": "Side of Stud Clear Space",
            "defaultValue": "both",
            "inputType": "dropdown",
            "options": [
              "both",
              "left",
              "right"
            ],
            "category": "General",
            "description": "Defines the Side of Side of Stud Clear Space"
          },
          {
            "index": 1,
            "variable": "sSplitLocation",
            "type": "PropString",
            "displayName": "Split Location",
            "defaultValue": "Opposite",
            "inputType": "dropdown",
            "options": [
              "Same",
              "Opposite"
            ],
            "category": "Aditional options",
            "description": "Defines if splits are aligned or opposite from bottom to top plates"
          },
          {
            "index": 2,
            "variable": "sSplitExternalsOnStud",
            "type": "PropString",
            "displayName": "Split on stud",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Aditional options",
            "description": "Defines if splits on very top/bottom plates are over a stud, also can split Blocking"
          },
          {
            "index": 3,
            "variable": "sSpliceBlocks",
            "type": "PropString",
            "displayName": "Create splice blocks",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Aditional options",
            "description": "Will Create Splice blocks in the location of the splits"
          },
          {
            "index": 4,
            "variable": "sSetBeamCode",
            "type": "PropString",
            "displayName": "Set BeamCode",
            "defaultValue": "Left to Right",
            "inputType": "dropdown",
            "options": [
              "No",
              "Left to Right",
              "Right to Left"
            ],
            "category": "Aditional options",
            "description": "Set a beamcode. The direction discribes the raise of the suffix"
          },
          {
            "index": 5,
            "variable": "sAddBeamCodeToLable",
            "type": "PropString",
            "displayName": "Write BeamCode suffix to Label",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Aditional options",
            "description": "Writes the suffix of the beam code to the Label"
          },
          {
            "index": 6,
            "variable": "sReset",
            "type": "PropString",
            "displayName": "Reset plates",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Reset",
            "description": "Reset plates to original lengths"
          },
          {
            "index": 7,
            "variable": "sPreview",
            "type": "PropString",
            "displayName": "Preview mode",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Debug",
            "description": "Allows the user to change settings without removing TSL"
          },
          {
            "index": 8,
            "variable": "sShowRegions",
            "type": "PropString",
            "displayName": "Show non split regions",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Debug",
            "description": "Show non split regions"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "../Split Plates",
            "handler": "|../Split Plates|",
            "action": "Triggers script recalculation to split plates based on current properties",
            "alsoTriggeredBy": "Double-click"
          },
          {
            "menuItem": "../Reset Plates",
            "handler": "|../Reset Plates|",
            "action": "Sets internal reset flag to restore plates to original lengths",
            "alsoTriggeredBy": "Double-click"
          },
          {
            "menuItem": "../Reset Plates And Delete",
            "handler": "|../Reset Plates And Delete|",
            "action": "Resets plates and turns off preview mode (deletes TSL instance)",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "../Delete",
            "handler": "|../Delete|",
            "action": "Turns off preview mode (deletes TSL instance)",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9558,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically splits wall plates (top, bottom, and sill) into manageable lengths while avoiding studs and opening modules to maintain structural integrity and efficient manufacturing.",
          "category": "Framing",
          "typicalUseCase": "Used during wall detailing to split long plates into transportable/manufacturable lengths that align with engineering rules (avoiding studs/obstructions)."
        },
        "parameters": [
          {
            "name": "dMaxLength",
            "technicalDefault": "4800 mm",
            "businessMeaning": "The maximum allowed length for a single plate piece before a split is forced, typically matching raw material stock or transport limits.",
            "validRange": "2400 mm - 12000 mm",
            "unit": "mm",
            "affectsOutput": "Determines the cut points; plates longer than this are segmented."
          },
          {
            "name": "dSizeOpeningModule",
            "technicalDefault": "605 mm",
            "businessMeaning": "Threshold to identify 'large' openings (windows/doors). Splits near openings larger than this use specific spacing rules.",
            "validRange": "400 mm - 1500 mm",
            "unit": "mm",
            "affectsOutput": "Influences split positioning logic relative to the edges of large openings."
          },
          {
            "name": "dDistOpeningModule",
            "technicalDefault": "269 mm",
            "businessMeaning": "Minimum clearance distance required between a split cut and the edge of a large opening module.",
            "validRange": "50 mm - 600 mm",
            "unit": "mm",
            "affectsOutput": "Moves split points away from openings to ensure sufficient bearing surface for jambs."
          },
          {
            "name": "dDistSmallModule",
            "technicalDefault": "119 mm",
            "businessMeaning": "Minimum clearance distance required between a split cut and a small obstruction or module.",
            "validRange": "50 mm - 300 mm",
            "unit": "mm",
            "affectsOutput": "Ensures cuts are not too close to small features within the wall."
          },
          {
            "name": "dDistStud",
            "technicalDefault": "119 mm",
            "businessMeaning": "Minimum clearance distance required between a split cut and a wall stud.",
            "validRange": "50 mm - 300 mm",
            "unit": "mm",
            "affectsOutput": "Prevents splitting the plate directly over or immediately adjacent to a stud (unless overridden)."
          },
          {
            "name": "sSideClearSpaceStud",
            "technicalDefault": "both",
            "businessMeaning": "Defines on which side of a stud the clearance restriction applies when calculating split locations.",
            "validRange": "both, left, right",
            "unit": "enum",
            "affectsOutput": "Biases the split calculation direction relative to the stud's position."
          },
          {
            "name": "sSplitLocation",
            "technicalDefault": "Opposite",
            "businessMeaning": "Determines alignment of splits between top and bottom plates.",
            "validRange": "Same, Opposite",
            "unit": "enum",
            "affectsOutput": "If 'Opposite', splits are staggered vertically for better racking strength. If 'Same', they align."
          },
          {
            "name": "sSplitExternalsOnStud",
            "technicalDefault": "No",
            "businessMeaning": "Allows external plates (single top/bottom) to be split directly over a stud location if necessary.",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "If 'Yes', overrides standard stud clearance rules for exterior plates."
          },
          {
            "name": "sSpliceBlocks",
            "technicalDefault": "Yes",
            "businessMeaning": "Controls the creation of timber blocks (scabs) at the split joints to reconnect the plates.",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "If 'Yes', generates new solid wood beams at split locations."
          },
          {
            "name": "sSetBeamCode",
            "technicalDefault": "Left to Right",
            "businessMeaning": "Assigns a sequential suffix (A, B, C...) to the split plates based on their position.",
            "validRange": "No, Left to Right, Right to Left",
            "unit": "enum",
            "affectsOutput": "Updates the BeamCode property of the plates for sorting and assembly."
          },
          {
            "name": "sAddBeamCodeToLable",
            "technicalDefault": "No",
            "businessMeaning": "Appends the sequential suffix to the visible label on the plate.",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "Modifies the Label property for identification on drawings."
          },
          {
            "name": "sReset",
            "technicalDefault": "No",
            "businessMeaning": "Functionality to revert plates to their original, un-split lengths.",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "Deletes split results and attempts to restore original geometry."
          },
          {
            "name": "sPreview",
            "technicalDefault": "Yes",
            "businessMeaning": "Keeps the script instance active for interactive adjustment of parameters.",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "If 'No', the script executes and deletes itself. If 'Yes', it remains for edits."
          },
          {
            "name": "sShowRegions",
            "technicalDefault": "Yes",
            "businessMeaning": "Visualizes the valid regions where splits can occur (exclusion zones around studs/openings).",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "Displays temporary geometry indicating allowed split zones."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sReset is set to 'Yes'",
            "effect": "Ignores split calculations and restores geometry to original state.",
            "cascade": [
              "dMaxLength",
              "sSpliceBlocks",
              "sSetBeamCode"
            ]
          },
          {
            "trigger": "sSplitExternalsOnStud is set to 'Yes'",
            "effect": "Relaxes the strict distance requirements defined by dDistStud.",
            "cascade": [
              "dDistStud"
            ]
          },
          {
            "trigger": "sSetBeamCode is set to 'No'",
            "effect": "Disables the beam coding logic.",
            "cascade": [
              "sAddBeamCodeToLable"
            ]
          },
          {
            "trigger": "sPreview is set to 'No'",
            "effect": "Commits changes and removes the script instance from the model.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam (Split Plates)",
            "description": "Top and bottom plates split into shorter segments.",
            "appliedTo": "Selected ElementWallSF wall entities"
          },
          {
            "type": "GenBeam (Splice Blocks)",
            "description": "Timber blocks placed at the joints to connect split plates.",
            "appliedTo": "Split locations (if sSpliceBlocks is Yes)"
          },
          {
            "type": "Visualization Geometry",
            "description": "Temporary lines showing valid split regions.",
            "appliedTo": "Model Space (if sShowRegions is Yes)"
          }
        ]
      },
      "tokens_used": 10609,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script: User runs HSB_W-SplitPlatesExtraOptions.mcr",
          "2. Determine Configuration Source: Check if a Catalog Entry Key was passed during launch",
          "3. Load Properties: Either load from selected Catalog, '_LastInserted' catalog, or show default Dialog",
          "4. User Selection: Prompt user to select ElementWallSF (Wall) entities",
          "5. Instance Creation: Attach script instance to selected wall elements and erase the 'launcher' instance",
          "6. Identify Context: Parse wall structure to find plates (Top, Bottom, Sill) and obstructions (Studs, Openings)",
          "7. Check Reset Flag: Determine if 'sReset' property or context menu trigger requests a restoration of original geometry",
          "8. Calculate Regions: Determine valid split zones along the wall length, excluding areas defined by 'dDistStud', 'dDistOpeningModule', etc.",
          "9. Determine Split Points: Calculate split locations based on 'dMaxLength' and valid regions, OR use manually placed grip points",
          "10. Execute Splitting: Perform 'dbSplit' on plates at calculated points",
          "11. Post-Processing: Create Splice Blocks (if enabled) and assign Beam Codes/Labels (if enabled)",
          "12. Finalize: Decide to keep instance for 'Preview' (interactive mode) or erase instance (commit mode)"
        ],
        "conditionalBranches": [
          {
            "condition": "Launch Configuration (Catalog vs Dialog)",
            "path1": {
              "name": "Catalog Key Found",
              "steps": [
                "Load properties from the catalog matching the execution key",
                "Skip dialog display",
                "Proceed to selection"
              ]
            },
            "path2": {
              "name": "No Catalog Key",
              "steps": [
                "Load properties from '_LastInserted' catalog",
                "Show Properties Dialog to user",
                "Proceed to selection"
              ]
            }
          },
          {
            "condition": "Reset Requested",
            "path1": {
              "name": "Yes (sReset=true or Triggered)",
              "steps": [
                "Bypass splitting logic",
                "Restore plates to original pre-split state (geometry reset)",
                "Update instance properties if triggered via menu"
              ]
            },
            "path2": {
              "name": "No (sReset=false)",
              "steps": [
                "Execute full splitting calculation",
                "Generate new split geometry"
              ]
            }
          },
          {
            "condition": "Split Point Source",
            "path1": {
              "name": "Manual Grip Points",
              "steps": [
                "Check if grip points (_PtG) exist on the instance",
                "Override automatic calculation with grip point coordinates",
                "Split at these specific locations"
              ]
            },
            "path2": {
              "name": "Automatic Calculation",
              "steps": [
                "Calculate midpoints of valid split regions",
                "Check distance to studs and openings",
                "Select optimal point within 'dMaxLength' constraints",
                "Split at calculated location"
              ]
            }
          },
          {
            "condition": "Preview Mode (sPreview)",
            "path1": {
              "name": "Yes (Interactive)",
              "steps": [
                "Keep TSL instance active in model",
                "Allow property changes and grip edits",
                "Re-run calculation on every change"
              ]
            },
            "path2": {
              "name": "No (Final)",
              "steps": [
                "Commit geometry changes",
                "Erase TSL instance from model",
                "End script execution"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Selection",
            "errorMessage": "User cancelled selection.",
            "recovery": "Script execution stops; user must restart command and select valid ElementWallSF."
          },
          {
            "check": "Plate Length",
            "errorMessage": "Implicit (No error, logic skip)",
            "recovery": "If a plate segment is shorter than 'dMaxLength', it is not split further."
          },
          {
            "check": "Stud Collision",
            "errorMessage": "Implicit (Logic skip)",
            "recovery": "If a calculated split point coincides with a stud (and 'sSplitExternalsOnStud' is No), the split is skipped for that region to maintain structural integrity."
          },
          {
            "check": "Valid Regions Availability",
            "errorMessage": "Implicit (No split possible)",
            "recovery": "If 'dDistStud' and 'dDistOpeningModule' create exclusion zones that leave no room for a split, the plate remains unsplit."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Split Settings",
            "how": "Properties Palette (OPM)",
            "effect": "Changing dMaxLength, distances, or split options triggers a recalculation and updates the split locations immediately."
          },
          {
            "action": "Manual Split Adjustment",
            "how": "Grip Points (Visualized points on the wall)",
            "effect": "User can drag the blue split point grips to manually override the calculated split position."
          },
          {
            "action": "Reset Geometry",
            "how": "Right-click Context Menu -> '../Reset Plates'",
            "effect": "Temporarily restores plates to original length while keeping the script active (sPreview usually remains active)."
          },
          {
            "action": "Finalize / Remove Script",
            "how": "Properties Palette (Set 'Preview mode' to No) OR Context Menu -> '../Reset Plates And Delete' or '../Delete'",
            "effect": "Script commits the current splits and removes itself from the model, leaving only the modified beams."
          },
          {
            "action": "Refresh Splits",
            "how": "Right-click Context Menu -> '../Split Plates' OR Double-Click",
            "effect": "Forces a recalculation of the split logic based on current wall state and properties."
          }
        ]
      },
      "tokens_used": 12587,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_W-SplitPlatesExtraOptions.mcr\n\n## Overview\nAutomatically splits wall plates (top, bottom, and sill) into manageable lengths based on maximum length constraints while avoiding studs and opening modules to maintain structural integrity. It also handles the creation of splice blocks (scabs) and the labeling of the split segments.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Primary working environment. |\n| Paper Space | No | Not applicable. |\n| Shop Drawing | No | Not applicable. |\n\n## Prerequisites\n- **Required Entities:** ElementWallSF (Wall objects).\n- **Minimum Beam Count:** 1 (The wall must contain plates/beams to split).\n- **Required Settings:** None (uses default internal properties or hsbCAD Catalogs).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_W-SplitPlatesExtraOptions.mcr`\n\n### Step 2: Select Wall Elements\n```\nCommand Line: Select element(s)\nAction: Click on the Wall elements (ElementWallSF) in the model that you wish to process.\n```\n\n### Step 3: Configure Properties\n```\nAction: After selection, the script attaches to the walls. Open the Properties Palette (Ctrl+1) to adjust splitting parameters.\n```\n\n### Step 4: Preview and Adjust\n```\nAction: With Preview mode set to \"Yes\", the wall plates will display calculated split points (often shown as grips or regions).\nAction: Drag the blue grip points to manually adjust split locations if needed, or change properties like Maximum Length.\n```\n\n### Step 5: Finalize\n```\nAction: Set \"Preview mode\" to \"No\" in the Properties Palette or select \"Reset Plates And Delete\" from the right-click menu to commit the changes and remove the script instance.\n```\n\n## Properties Panel Parameters\n\n### General\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Maximum length | number | 4800 mm | The maximum allowed length for a single plate piece before a split is forced. |\n| Opening module dimensions greater than | number | 605 mm | Threshold to identify 'large' openings. Splits near openings larger than this use specific spacing rules. |\n| Split distance to opening module | number | 269 mm | Minimum clearance distance between a split cut and the edge of a large opening module. |\n| Split distance to small module | number | 119 mm | Minimum clearance distance between a split cut and a small obstruction or module. |\n| Split distance to stud | number | 119 mm | Minimum clearance distance between a split cut and a wall stud. |\n| Side of Stud Clear Space | dropdown | both | Defines which side of a stud the clearance restriction applies (both, left, or right). |\n\n### Additional options\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Split Location | dropdown | Opposite | Determines if splits are aligned (\"Same\") or staggered (\"Opposite\") between top and bottom plates. |\n| Split on stud | dropdown | No | If \"Yes\", allows external plates to be split directly over a stud location. |\n| Create splice blocks | dropdown | Yes | If \"Yes\", generates timber blocks at the split joints to reconnect the plates. |\n| Set BeamCode | dropdown | Left to Right | Assigns a sequential suffix (A, B, C...) to the split plates based on position. |\n| Write BeamCode suffix to Label | dropdown | No | Appends the sequential suffix to the visible label on the plate. |\n\n### Reset & Debug\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Reset plates | dropdown | No | If \"Yes\", restores plates to their original, un-split lengths. |\n| Preview mode | dropdown | Yes | Keeps the script active for adjustments. Set to \"No\" to apply changes and delete the script. |\n| Show non split regions | dropdown | Yes | Visualizes the valid regions where splits can occur (exclusion zones). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| ../Split Plates | Triggers a recalculation of split points based on current properties. Can also be triggered by double-clicking the script instance. |\n| ../Reset Plates | Restores the plates to their original lengths but keeps the script active for re-editing. |\n| ../Reset Plates And Delete | Restores plates to original lengths and removes the script instance from the model. |\n| ../Delete | Removes the script instance, committing any current split geometry. |\n\n## Settings Files\n- **Catalogs**: The script attempts to load properties from a Catalog Entry if provided during launch, or defaults to the `_LastInserted` catalog configuration.\n- **Location**: Standard hsbCAD Catalog paths.\n\n## Tips\n- **Interactive Editing**: Keep \"Preview mode\" set to \"Yes\" initially. This allows you to see the \"Show non split regions\" (green/red indicators) and drag the blue split grips to fine-tune positions manually.\n- **Staggering Splits**: Use the \"Split Location\" property set to \"Opposite\" to stagger top and bottom plate joints. This generally improves the structural racking strength of the wall.\n- **Avoiding Studs**: If the script refuses to split a specific long section, check \"Show non split regions\". It may be that the \"Split distance to stud\" is too large for the spacing between studs in that wall, leaving no valid gap to cut.\n\n## FAQ\n- **Q: How do I split a plate directly over a stud?**\n- **A:** Change the property \"Split on stud\" to \"Yes\". This overrides the standard clearance distance.\n- **Q: Why did my plates disappear?**\n- **A:** You likely have \"Reset plates\" set to \"Yes\". Change it back to \"No\" to restore the split geometry.\n- **Q: Can I undo the splits?**\n- **A:** Yes, right-click the script instance and select \"../Reset Plates\". If the script has already been deleted (\"Preview mode\" was No), you will need to use the standard AutoCAD Undo command."
      },
      "tokens_used": 7902,
      "error": null
    }
  }
}