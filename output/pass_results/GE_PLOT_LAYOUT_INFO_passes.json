{
  "filename": "GE_PLOT_LAYOUT_INFO.mcr",
  "status": "completed",
  "total_tokens": 48065,
  "processing_time": 578.3922343254089,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7323,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly calls getViewport() to select a viewport and iterates over the _Viewport array. It calculates transformations between Model Space and Paper Space using vp.coordSys() and ps2ms. The text output is drawn at a location selected via getPoint (implied Paper Space context)."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Viewport"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be executed in a Paper Space layout containing a viewport with a valid hsbCAD element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 5653,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10026,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a parametric text label in Paper Space that displays specific properties (dimensions, weights, project info, etc.) of a timber element visible in a selected viewport.",
          "category": "ShopDrawing/Annotation",
          "typicalUseCase": "Automating the labeling of wall heights, panel weights, or nail schedules on layout sheets to ensure drawing annotations match the current 3D model data."
        },
        "parameters": [
          {
            "name": "pDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Selects the CAD Dimension Style to govern the text appearance (font, units, arrows) for the label, ensuring consistency with drawing standards.",
            "validRange": "Any existing Dimension Style in the drawing",
            "unit": "String",
            "affectsOutput": "Text style, precision format, and unit display of the label."
          },
          {
            "name": "dTH",
            "technicalDefault": "U(0)",
            "businessMeaning": "Specifies the explicit height of the text in Paper Space. If set to 0, the text height defined in the selected Dimension Style is used.",
            "validRange": "0 (use DimStyle) to typical paper space text sizes (e.g., 2.5mm to 5mm)",
            "unit": "Length (mm in Paper Space)",
            "affectsOutput": "Size of the text label."
          },
          {
            "name": "iRotation",
            "technicalDefault": "0",
            "businessMeaning": "Rotates the text label counter-clockwise around its insertion point.",
            "validRange": "0 to 360 (degrees)",
            "unit": "degrees",
            "affectsOutput": "Orientation angle of the text."
          },
          {
            "name": "stJustification",
            "technicalDefault": "Left",
            "businessMeaning": "Aligns the text relative to the insertion point (e.g., Right justification makes the text grow to the left of the clicked point).",
            "validRange": "Left, Right",
            "unit": "Enum",
            "affectsOutput": "Horizontal alignment and direction of the text string."
          },
          {
            "name": "pType",
            "technicalDefault": "strInformation",
            "businessMeaning": "Selects the specific data to extract from the model and display, such as Element Height, Panel Weight, Project Name, or Stud Spacing.",
            "validRange": "Information, Definition, Subtype, Spacing, Element Height, Frame Thickness, Stud Length, Element Length, Element Diagonal, Element Group, First Stud location, Bottom Plate Length, Panel Weight, Project Name, Project Number, Project Street, Project Comment, Designer, Project Revision, Project Special, Element Code, Dwg Name, Dwg Full Name, Material Zone 1, Edge Nail Spacing, Field Nail Spacing, Bundle Info",
            "unit": "String",
            "affectsOutput": "The actual content string of the label."
          },
          {
            "name": "iG",
            "technicalDefault": "0",
            "businessMeaning": "When 'Type of data' is set to 'Element Group', this determines which level of the group hierarchy to display (e.g., Floor, House, Wall Type).",
            "validRange": "0, 1, 2",
            "unit": "Index",
            "affectsOutput": "Which segment of the Group Name path is displayed."
          },
          {
            "name": "strFSL",
            "technicalDefault": "Left",
            "businessMeaning": "When calculating 'First Stud location', defines whether the measurement is taken to the Left face, Center, or Right face of the stud.",
            "validRange": "Left, Center, Right",
            "unit": "Enum",
            "affectsOutput": "The calculated dimension value for stud location."
          },
          {
            "name": "strIgnorVTP",
            "technicalDefault": "No",
            "businessMeaning": "Toggles whether to exclude top plates (code 'A') from the 'Element Height' and 'Element Diagonal' calculations. Useful for measuring clear stud height vs. overall wall height.",
            "validRange": "Yes, No",
            "unit": "Enum",
            "affectsOutput": "The calculated value for Height and Diagonal."
          },
          {
            "name": "strMultiply",
            "technicalDefault": "No",
            "businessMeaning": "Converts dimension outputs from Millimeters (internal) to Inches by multiplying by 25.4. Used when shop drawings require Imperial units.",
            "validRange": "Yes, No",
            "unit": "Enum",
            "affectsOutput": "Numerical values for dimensions (Height, Length, Spacing, etc.) but NOT Weight."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "pType is set to 'Element Group'",
            "effect": "The value of 'iG' is used to determine the string output.",
            "cascade": [
              "iG"
            ]
          },
          {
            "trigger": "pType is set to 'First Stud location'",
            "effect": "The value of 'strFSL' determines the offset added to the dimension.",
            "cascade": [
              "strFSL"
            ]
          },
          {
            "trigger": "pType is set to Height/Diagonal dimensions",
            "effect": "The value of 'strIgnorVTP' determines which beams are included in the bounding box calculation.",
            "cascade": [
              "strIgnorVTP"
            ]
          },
          {
            "trigger": "strMultiply is 'Yes'",
            "effect": "Numeric dimension outputs (Length, Height, Spacing) are converted to inches.",
            "cascade": [
              "strText"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text Entity",
            "description": "A single-line text object drawn in Paper Space at the user-selected location, displaying the calculated property.",
            "appliedTo": "Paper Space (associated with a selected Viewport/Element)"
          },
          {
            "type": "Line Segment (Visual Aid)",
            "description": "If 'Type of data' is 'Element Diagonal', a hidden line is drawn across the wall geometry in Paper Space to represent the diagonal measurement.",
            "appliedTo": "Paper Space"
          }
        ]
      },
      "tokens_used": 8561,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Execution: User launches GE_PLOT_LAYOUT_INFO.mcr.",
          "2. Configuration Dialog: 'showDialog()' prompts user to select Data Type (pType), DimStyle, and formatting options.",
          "3. Location Input: User selects insertion point in Paper Space via 'getPoint'.",
          "4. Viewport Selection: User selects a viewport via 'getViewport' to identify the source Element.",
          "5. Instance Creation: Script initializes with selected viewport and point.",
          "6. Data Retrieval: Script validates Element within viewport and extracts specific data based on 'pType'.",
          "7. Rendering: Text label is drawn at insertion point (transformed by rotation/scale). If 'Element Diagonal', a visual line is drawn.",
          "8. Update: User modifies Properties (OPM) or moves grips, triggering recalculation."
        ],
        "conditionalBranches": [
          {
            "condition": "Property 'pType' (Type of data) selection",
            "path1": {
              "name": "Simple Property Retrieval",
              "steps": [
                "Fetch string directly from Element (e.g., el.code(), projectName()).",
                "Format string.",
                "Draw text."
              ]
            },
            "path2": {
              "name": "Geometric Calculation",
              "steps": [
                "Iterate Element beams/genBeams.",
                "Apply filters (e.g., Ignore Top Plate, Stud type).",
                "Calculate dimension (Height, Length, Diagonal) or Weight.",
                "Draw text (and geometry if Diagonal)."
              ]
            }
          },
          {
            "condition": "Property 'strIgnorVTP' (Ignore Top Plates) during Height/Diagonal calc",
            "path1": {
              "name": "Ignore Top Plates (Yes)",
              "steps": [
                "Iterate beams.",
                "Exclude beams with Code 'A' (or 'V' for Diagonal).",
                "Calculate bounding box based on remaining beams."
              ]
            },
            "path2": {
              "name": "Include Top Plates (No)",
              "steps": [
                "Iterate all beams.",
                "Calculate bounding box using all vertices."
              ]
            }
          },
          {
            "condition": "Property 'strMultiply' (Multiply output by 25.4)",
            "path1": {
              "name": "Imperial Units (Yes)",
              "steps": [
                "Set multiplier dmm = 25.4.",
                "Format output unit multiplied by dmm."
              ]
            },
            "path2": {
              "name": "Metric Units (No)",
              "steps": [
                "Set multiplier dmm = 1.",
                "Format output unit using raw mm values."
              ]
            }
          },
          {
            "condition": "First Stud Location Calculation",
            "path1": {
              "name": "Stud Found",
              "steps": [
                "Identify bottom plate origin.",
                "Find first valid Stud (>39mm).",
                "Apply offset based on 'strFSL' (Left/Center/Right).",
                "Output dimension + Letter (L/C/R)."
              ]
            },
            "path2": {
              "name": "Stud Not Found",
              "steps": [
                "Output string 'None found'."
              ]
            }
          },
          {
            "condition": "Element Diagonal Geometry",
            "path1": {
              "name": "Geometry Valid",
              "steps": [
                "Calculate diagonal length.",
                "Draw hidden line in Paper Space.",
                "Display length in text."
              ]
            },
            "path2": {
              "name": "No Geometry Found",
              "steps": [
                "Output string 'Not Found'.",
                "Skip drawing line."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport contains a valid hsbCAD Element",
            "errorMessage": "None (Script fails silently)",
            "recovery": "Select a viewport that actually contains an element and re-run the script."
          },
          {
            "check": "Dimension Style existence",
            "errorMessage": "Potential formatting error or crash if style does not exist in drawing.",
            "recovery": "Ensure the selected 'DimStyle' exists in the current AutoCAD drawing."
          },
          {
            "check": "First Stud > 39mm offset",
            "errorMessage": "Text displays 'None found'",
            "recovery": "Ensure the wall has a stud located further than 39mm from the origin."
          },
          {
            "check": "Bundle Info availability",
            "errorMessage": "Text displays 'N/A'",
            "recovery": "Ensure the Element is part of a valid 'X - STACKER' export group with stack location maps."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Label Content",
            "how": "Properties Palette (OPM)",
            "effect": "Changing 'pType' immediately recalculates the string to display the new data category (e.g., switching from Height to Weight)."
          },
          {
            "action": "Adjust Text Appearance",
            "how": "Properties Palette (OPM)",
            "effect": "Changing 'Text Heigth', 'Rotation', 'Justification', or 'DimStyle' updates the visual representation without moving the insertion point."
          },
          {
            "action": "Relocate Label",
            "how": "Grip Edit",
            "effect": "Dragging the insertion point grip updates '_Pt0', moving the text in Paper Space."
          },
          {
            "action": "Toggle Unit System",
            "how": "Properties Palette (OPM) -> 'Multiply output by 25.4'",
            "effect": "Switches the numerical output between Millimeters and Inches for applicable data types."
          }
        ]
      },
      "tokens_used": 10370,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_PLOT_LAYOUT_INFO.mcr\n\n## Overview\nThis script creates a parametric text label in Paper Space that displays specific properties (such as dimensions, weights, or project info) of a timber element visible within a selected viewport.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | The script must be run in a Paper Space layout. |\n| Paper Space | Yes | The script creates text entities in Paper Space. |\n| Shop Drawing | Yes | Used to annotate layout sheets with live model data. |\n\n## Prerequisites\n- **Required entities**: A Viewport in Paper Space that displays an hsbCAD Element (Wall/Floor/Roof).\n- **Minimum beam count**: 0 (The script detects the whole element within the viewport).\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_PLOT_LAYOUT_INFO.mcr`\n\n### Step 2: Configure Data Type\n```\nDialog: Select Information Type\nAction: Choose the data you wish to display (e.g., Element Height, Panel Weight, Project Name).\nAction: Select the Dimension Style (pDimStyle) to control text appearance.\n```\n\n### Step 3: Select Insertion Point\n```\nCommand Line: Pick insertion point:\nAction: Click in the Paper Space layout where you want the label to appear.\n```\n\n### Step 4: Select Source Viewport\n```\nCommand Line: Select viewport:\nAction: Click the border of the viewport that contains the element you want to label.\n```\n\n### Step 5: Completion\nThe script automatically retrieves the data from the model and draws the text in Paper Space.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type of data | Dropdown | Information | Selects the specific property to display (e.g., Height, Weight, Project Name). |\n| DimStyle | String | _DimStyles | Determines the text style, units, and font based on a CAD Dimension Style. |\n| Text Heigth | Number | 0 | Sets the text height in Paper Space. Use 0 to adopt the height from the selected DimStyle. |\n| Rotation | Number | 0 | Rotates the text label counter-clockwise (degrees). |\n| Justification | Dropdown | Left | Aligns the text relative to the insertion point (Left or Right). |\n| Index Group | Number | 0 | If Type is 'Element Group', defines which hierarchy level to display (0, 1, or 2). |\n| First Stud location | Dropdown | Left | If Type is 'First Stud location', sets the reference face (Left, Center, Right). |\n| Ignore Top Plate | Dropdown | No | If Yes, excludes top plates from Height and Diagonal calculations. |\n| Multiply output by 25.4 | Dropdown | No | If Yes, converts dimensions from Millimeters to Inches. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the text content if the model geometry or properties have changed. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Imperial Units**: If your shop drawings are in Imperial units, set \"Multiply output by 25.4\" to \"Yes\" to automatically convert dimensions.\n- **Clear Height**: To display the height of the timber frame excluding the top plate, set \"Ignore Top Plate\" to \"Yes\".\n- **Grip Editing**: You can drag the text label to a new position using its grip point without re-running the script.\n- **Updating Labels**: If you modify the 3D model, use the \"Recalculate\" option on the text label to update the value instantly.\n\n## FAQ\n- **Q: Why does my text display \"None found\"?**\n  **A**: This usually occurs when calculating \"First Stud location\" but no stud is found further than 39mm from the start point, or if the selected Viewport does not contain a valid element.\n- **Q: Can I change the text size after insertion?**\n  **A**: Yes. Select the text, open the Properties Palette (Ctrl+1), and modify the \"Text Heigth\" parameter.\n- **Q: How do I switch between displaying Weight and Length?**\n  **A**: Select the label in the drawing, open the Properties Palette, and change the \"Type of data\" dropdown to the desired property."
      },
      "tokens_used": 6132,
      "error": null
    }
  }
}