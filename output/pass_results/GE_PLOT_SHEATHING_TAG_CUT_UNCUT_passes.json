{
  "filename": "GE_PLOT_SHEATHING_TAG_CUT_UNCUT.mcr",
  "status": "completed",
  "total_tokens": 28098,
  "processing_time": 717.1258382797241,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "v1.0",
            "date": "07.jul.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "- Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3731,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _Viewport.append(getViewport(...)) during _bOnInsert, checks if (_Viewport.length()==0), and retrieves Viewport object vp. It uses vp.coordSys() to handle model-to-paper space transformations (ms2ps). The filename 'GE_PLOT_...' indicates a plotting/layout function."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "Sheet"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be inserted in a context allowing Viewport selection (Paper Space/Layout) and linked to a valid Element containing Sheets.",
          "requiredSettings": []
        }
      },
      "tokens_used": 4177,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dL1",
            "type": "PropDouble",
            "displayName": "Sheathing length",
            "defaultValue": "U(96)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dW1",
            "type": "PropDouble",
            "displayName": "Sheathing width",
            "defaultValue": "U(48)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDrawSheathingPLine",
            "type": "PropString",
            "displayName": "Draw Sheathing Perimeter",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sColor",
            "type": "PropString",
            "displayName": "Color",
            "defaultValue": "Dark Brown (32)",
            "inputType": "dropdown",
            "options": [
              "Dark Brown (32)",
              "Light Brown (40)",
              "White",
              "Red",
              "Yellow",
              "Green",
              "Cyan",
              "Blue",
              "Magenta",
              "Black"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3768,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "This script identifies and visually tags sheathing panels on a 2D shop drawing layout (Paper Space). It draws diagonal markers on panels to distinguish between uncut (full) panels and cut/ripped panels.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used during the creation of floor or wall shop drawings to indicate to the framer which sheathing sheets are full size (marked with an X) and which have been cut to fit irregular boundaries (marked with a single diagonal line)."
        },
        "parameters": [
          {
            "name": "dL1",
            "technicalDefault": "U(96)",
            "businessMeaning": "Defines the standard length of a full, uncut sheathing sheet (e.g., 8 feet/96 inches for standard OSB/Plywood).",
            "validRange": "24 to 240 inches (standard sheet lengths)",
            "unit": "Inches (Model Units)",
            "affectsOutput": "Determines the threshold used to decide if a sheet is 'uncut'. If a sheet's solid length and width match dL1 and dW1 (within tolerance), it is marked as uncut with an 'X'."
          },
          {
            "name": "dW1",
            "technicalDefault": "U(48)",
            "businessMeaning": "Defines the standard width of a full, uncut sheathing sheet (e.g., 4 feet/48 inches for standard OSB/Plywood).",
            "validRange": "24 to 60 inches (standard sheet widths)",
            "unit": "Inches (Model Units)",
            "affectsOutput": "Works in conjunction with dL1 to identify uncut sheets. Must match the solid width of the sheet for the 'uncut' logic to trigger."
          },
          {
            "name": "sDrawSheathingPLine",
            "technicalDefault": "No",
            "businessMeaning": "Toggles the visibility of the outline (perimeter) of the sheathing sheets in the layout.",
            "validRange": "No, Yes",
            "unit": "N/A",
            "affectsOutput": "If 'Yes', the script draws the geometric outline (PLine) of every sheathing sheet in the viewport. If 'No', it only draws the identification markers (diagonals)."
          },
          {
            "name": "sColor",
            "technicalDefault": "Dark Brown (32)",
            "businessMeaning": "Controls the display color of the sheathing tags and outlines in the CAD drawing.",
            "validRange": "Standard CAD colors (0-255 or named colors)",
            "unit": "CAD Color Index",
            "affectsOutput": "Changes the color of the drawn lines (diagonals and perimeters) to help distinguish sheathing annotations from other drawing elements."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing dL1 or dW1",
            "effect": "Changes the classification of sheets between 'Uncut' and 'Cut'.",
            "cascade": [
              "dL1",
              "dW1"
            ]
          },
          {
            "trigger": "sDrawSheathingPLine",
            "effect": "Determines if geometry is drawn for every sheet.",
            "cascade": [
              "sColor"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "2D Graphics (PLine)",
            "description": "Draws diagonal lines (single line for cut sheets, 'X' for uncut sheets) and optional perimeters directly in Paper Space.",
            "appliedTo": "Viewport / Layout (representing Sheathing Sheets from the Model)"
          }
        ]
      },
      "tokens_used": 4510,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script is launched in Paper Space.",
          "System checks if the instance is being inserted for the first time (insertCycleCount <= 1).",
          "If inserting, the user is prompted via command line to 'Select a viewport'.",
          "The properties dialog (Default) is shown, allowing configuration of sheathing dimensions (dL1, dW1), outline visibility (sDrawSheathingPLine), and color (sColor).",
          "The script verifies that a valid Viewport exists in the internal array (_Viewport).",
          "The script retrieves the linked Element from the Viewport and checks its validity.",
          "Coordinate transformation systems (Model-to-Paper Space and vice versa) are established based on the Viewport.",
          "The script iterates through all Sheets found within the Element.",
          "For each Sheet, the envelope area and vertex count are compared against the target sheathing dimensions (dL1, dW1) and tolerance.",
          "If the Sheet matches the target dimensions (within tolerance) and has 4 vertices, it is identified as 'Uncut'.",
          "Two diagonal lines ('X') are drawn in Paper Space on the uncut sheet.",
          "If the Sheet does not match the dimensions or has >4 vertices, it is identified as 'Cut/Ripped'.",
          "The script analyzes the geometry of the cut sheet to find the Bottom-Left and Top-Right extreme points.",
          "A single diagonal line is drawn in Paper Space from the Bottom-Left to Top-Right point.",
          "If the property 'Draw Sheathing Perimeter' is set to 'Yes', the sheet's outline is also drawn.",
          "The process repeats for all sheets in the element."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Phase Check (insertCycleCount)",
            "path1": {
              "name": "Re-insertion / Recalculation",
              "steps": [
                "If insertCycleCount > 1, the script erases the current instance.",
                "Process terminates to prevent duplicate inputs."
              ]
            },
            "path2": {
              "name": "Initial Insertion",
              "steps": [
                "Prompts user for Viewport selection.",
                "Shows Dialog for property settings."
              ]
            }
          },
          {
            "condition": "Viewport Validity",
            "path1": {
              "name": "No Viewport",
              "steps": [
                "If _Viewport array is empty, script returns immediately.",
                "No execution."
              ]
            },
            "path2": {
              "name": "Valid Viewport",
              "steps": [
                "Retrieves Viewport object.",
                "Checks for linked hsb Element."
              ]
            }
          },
          {
            "condition": "Element Validity",
            "path1": {
              "name": "Invalid Element",
              "steps": [
                "If vp.element() is not valid, script returns immediately.",
                "No execution."
              ]
            },
            "path2": {
              "name": "Valid Element",
              "steps": [
                "Proceeds to coordinate system setup and sheet iteration."
              ]
            }
          },
          {
            "condition": "Sheet Geometry Classification (Loop Logic)",
            "path1": {
              "name": "Uncut Piece (Full Sheet)",
              "steps": [
                "Checks: 4 Vertices AND Area matches target (dL1*dW1) AND (Solid Length/Width matches dL1/dW1 OR swapped).",
                "Action: Draws an 'X' (two diagonal lines connecting opposite corners)."
              ]
            },
            "path2": {
              "name": "Cut Piece (Ripped/Irregular)",
              "steps": [
                "Checks: NOT (4 Vertices AND Area match).",
                "Action: Calculates bounding box extremes (Min Y/Min X and Max Y/Max X).",
                "Action: Draws a single diagonal line from Bottom-Left to Top-Right."
              ]
            }
          },
          {
            "condition": "Draw Perimeter Setting",
            "path1": {
              "name": "Yes",
              "steps": [
                "Draws the envelope PLine of the sheet in Paper Space."
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skips drawing the perimeter."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Selection",
            "errorMessage": "None explicitly coded, but function fails silently if selection is cancelled.",
            "recovery": "User must select a valid viewport to proceed."
          },
          {
            "check": "Viewport Data Integrity",
            "errorMessage": "None explicitly coded.",
            "recovery": "The Viewport must be a live hsbCAD viewport linked to a valid Element/Model."
          },
          {
            "check": "Sheet Validity",
            "errorMessage": "None.",
            "recovery": "Invalid sheets in the element array are skipped (continue loop)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Sheathing Dimensions",
            "how": "OPM (Object Properties Palette) - Change 'Sheathing length' or 'Sheathing width'",
            "effect": "Script recalculates classification. Sheets previously marked as 'Cut' might become 'Uncut' (X) or vice versa."
          },
          {
            "action": "Toggle Outline",
            "how": "OPM - Change 'Draw Sheathing Perimeter' dropdown",
            "effect": "Sheet outlines appear or disappear immediately in the layout."
          },
          {
            "action": "Change Color",
            "how": "OPM - Change 'Color' dropdown",
            "effect": "All drawn lines (diagonals and outlines) change to the selected color."
          },
          {
            "action": "Delete/Undo",
            "how": "AutoCAD Erase/Undo commands",
            "effect": "Removes the script instance and all generated graphics."
          }
        ]
      },
      "tokens_used": 6263,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_PLOT_SHEATHING_TAG_CUT_UNCUT.mcr\n\n## Overview\nThis script automatically identifies and visually tags sheathing panels on your 2D shop drawings (Layouts). It draws diagonal markers to distinguish between full sheets (marked with an 'X') and cut/ripped sheets (marked with a single diagonal line).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is intended for Layout views. |\n| Paper Space | Yes | Must be run on a Layout tab containing a viewport. |\n| Shop Drawing | Yes | Designed for production drawings. |\n\n## Prerequisites\n- **Required Entities**: A valid hsbCAD Viewport linked to an Element containing sheathing sheets.\n- **Minimum Beam Count**: 0 (Operates on sheet/geometry data within the Element).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_PLOT_SHEATHING_TAG_CUT_UNCUT.mcr` from the list.\n\n### Step 2: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the viewport frame in the Paper Space layout that displays the model you wish to tag.\n```\n\n### Step 3: Configure Properties\nAfter selecting the viewport, the Properties Palette will display the script settings. Adjust the sheathing dimensions or color if necessary.\n*   *Note: The script will automatically process and draw the tags once the viewport is selected and properties are confirmed.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Sheathing length | number | 96\" | The standard length of a full, uncut sheet. Sheets matching this size are marked with an 'X'. |\n| Sheathing width | number | 48\" | The standard width of a full, uncut sheet. Sheets matching this size are marked with an 'X'. |\n| Draw Sheathing Perimeter | dropdown | No | If set to 'Yes', draws the outline of the sheathing sheet in addition to the diagonal markers. |\n| Color | dropdown | Dark Brown (32) | Sets the color of the diagonal markers and perimeter lines. |\n\n## Right-Click Menu Options\n*This script does not add custom items to the right-click context menu. Standard recalculation applies when modifying properties.*\n\n## Settings Files\nNo external settings files are required for this script.\n\n## Tips\n- **Check Your Dimensions**: Ensure the `Sheathing length` and `Sheathing width` match your actual material stock (e.g., 48x96 or 48x120). If these are incorrect, full sheets might be marked as cut.\n- **Corner Logic**: The script checks the number of vertices. A sheet that is mostly full size but has a single notch (creating 5 vertices) will be treated as a \"Cut\" piece and marked with a single line.\n- **Color Coding**: Choose a color (like Dark Brown or Magenta) that stands out against your wall framing lines to make the tags easy to read on the shop floor.\n\n## FAQ\n- **Q: Why is a full sheet marked with a single line instead of an 'X'?**\n  - A: This usually happens if the sheet dimensions in the properties do not exactly match the model geometry, or if the sheet has more than 4 corners (e.g., it is notched or dog-eared). Check the `Sheathing length` and `width` properties.\n- **Q: How do I remove the tags?**\n  - A: Select the script anchor point (usually where you clicked to insert the script) and delete it. All generated lines and tags will disappear.\n- **Q: Can I change the tags after I have placed them?**\n  - A: Yes. Select the script instance, open the Properties palette, change the dimensions or color, and the tags will update automatically."
      },
      "tokens_used": 5649,
      "error": null
    }
  }
}