{
  "filename": "sd_ACutDe.mcr",
  "status": "completed",
  "total_tokens": 48359,
  "processing_time": 571.7159416675568,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 8835,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "Script filename follows 'sd_' convention (sd_ACutDe.mcr). XML comment explicitly states: 'This tsl is only executed by the shopdraw engine and to use it one needs to append it to the ruleset of a multipage style.' Logic interacts with 'Stereotypes' (e.g., 'LeftStart', 'RightStart', 'SectionLeft') and creates 'DimRequest' objects, which are specific to the hsbCAD Shop Drawing engine."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Cut/Tool"
          ],
          "minimumBeams": 1,
          "requiredSpace": "ShopDrawing Layout (generated via Multipage)",
          "requiredSettings": [
            "Multipage Style Ruleset",
            "Execution Map (optional parameters: ShowAllInOneLeft, ShowAllInOneRight, JapaneseStyle, etc.)"
          ]
        }
      },
      "tokens_used": 5294,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getBeam",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select point near tool",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "showAllInOneLeft",
            "type": "PropString",
            "displayName": "showAllInOneLeft",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": "|Will collect all dimpoints in one dimline with a certain stereotype.| |The stereotype name will be concatenated with the side prefix (Left/Right) and indicating if it is the Start or the End of the beam.| |Default is <Side>Start, the separation in to Start/End will only apply if the 'Dimension from Start and End' matches the given length.|"
          },
          {
            "index": 1,
            "variable": "showAllInOneRight",
            "type": "PropString",
            "displayName": "showAllInOneRight",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": "|Will collect all dimpoints in one dimline with a certain stereotype.| |The stereotype name will be concatenated with the side prefix (Left/Right) and indicating if it is the Start or the End of the beam.| |Default is <Side>Start, the separation in to Start/End will only apply if the 'Dimension from Start and End' matches the given length.|"
          },
          {
            "index": 2,
            "variable": "hideAnglesCut",
            "type": "PropString",
            "displayName": "hideAnglesCut",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": "|Disables the display of the angle of the tool in the appropriate view|"
          },
          {
            "index": 3,
            "variable": "dimFromStartEndLength",
            "type": "PropString",
            "displayName": "Dimension from Start and End",
            "defaultValue": "0",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "|Beams which exceed the given value in length will be dimensioned with two dimlines.| |The first dimline will all points from the start to the middle (Stereotype <Side>Start), while the other dimline will collect the remaining points into Stereotype <Side>Right|"
          },
          {
            "index": 4,
            "variable": "japaneseStyle",
            "type": "PropString",
            "displayName": "japaneseStyle",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": null,
            "description": "|Sets japanes options to display dimlines|"
          },
          {
            "index": 5,
            "variable": "setPreferredViewXDim",
            "type": "PropString",
            "displayName": "Show dimpoints on x-axis",
            "defaultValue": "|Default|",
            "inputType": "dropdown",
            "options": [
              "|Default|",
              "|left in side view|",
              "|right in side view|",
              "|on the side most aligned with the tool|",
              "|left in top view|",
              "|right in top view|"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7329,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automates the dimensioning of timber beam cuts (tenons, notches, angles) on shop drawings by calculating dimension points and assigning them to specific drawing layers (stereotypes).\",\n    \"category\": \"ShopDrawing\",\n    \"typicalUseCase\": \"Used within a Multipage Shopdrawing Ruleset to ensure that all cuts on a beam are automatically measured and labeled on the 2D production drawings without manual drafting.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"showAllInOneLeft\",\n      \"technicalDefault\": \"|No|\",\n      \"businessMeaning\": \"Aggregates all dimension points for tools on the left side of the beam into a single continuous dimension line (Stereotype 'LeftStart'), reducing drawing clutter.\",\n      \"validRange\": \"|No|, |Yes|\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Groups multiple individual cut dimensions on the left side into one chain dimension.\"\n    },\n    {\n      \"name\": \"showAllInOneRight\",\n      \"technicalDefault\": \"|No|\",\n      \"businessMeaning\": \"Aggregates all dimension points for tools on the right side of the beam into a single continuous dimension line (Stereotype 'RightStart'), reducing drawing clutter.\",\n      \"validRange\": \"|No|, |Yes|\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Groups multiple individual cut dimensions on the right side into one chain dimension.\"\n    },\n    {\n      \"name\": \"hideAnglesCut\",\n      \"technicalDefault\": \"|No|\",\n      \"businessMeaning\": \"Suppresses the display of cut angle annotations (e.g., 45°) on the drawing views.\",\n      \"validRange\": \"|No|, |Yes|\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Hides text labels indicating the slope or bevel of the cut.\"\n    },\n    {\n      \"name\": \"dimFromStartEndLength\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning \"If the beam length exceeds this value, the script splits the dimensioning into two separate lines: one measuring from the start to the middle, and another from the middle to the end. This prevents dimensions on long beams (e.g., glulam rafters) from becoming too crowded.\",\n      \"validRange\": \"0 (disabled) to typical max beam length (e.g., 20000)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Splits a single long dimension line into two segments (Start and End) and assigns them to different Stereotypes.\"\n    },\n    {\n      \"name\": \"japaneseStyle\",\n      \"technicalDefault\": \"|No|\",\n      \"businessMeaning\": \"Activates dimensioning rules specific to Japanese timber framing, such as prioritizing 'Dove' tail cuts over others, or changing the reference point from the center to the top face for vertical posts.\",\n      \"validRange\": \"|No|, |Yes|\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Alters the selection of dimension points and activates Japanese joinery symbols if supported by the tool.\"\n    },\n    {\n      \"name\": \"setPreferredViewXDim\",\n      \"technicalDefault\": \"|Default|\",\n      \"businessMeaning\": \"Forces the longitudinal dimensions (distance along the beam length) of the cut to appear in a specific view (Side View vs. Top View) rather than letting the system decide automatically.\",\n      \"validRange\": \"|Default|, |left in side view|, |right in side view|, |on the side most aligned with the tool|, |left in top view|, |right in top view|\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Changes the projection view where the cut's location along the X-axis is labeled.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"dimFromStartEndLength is greater than 0 and beam length exceeds value\",\n      \"effect\": \"The aggregation logic for showAllInOneLeft/Right splits into two separate stereotypes.\",\n      \"cascade\": [\n        \"showAllInOneLeft\",\n        \"showAllInOneRight\"\n      ]\n    },\n    {\n      \"trigger\": \"setPreferredViewXDim set to 3 (side most aligned)\",\n      \"effect\": \"Overrides the default view selection logic to project dimensions onto the view plane perpendicular to the cut's surface normal.\",\n      \"cascade\": []\n    }\n  ],\n  \"outputEntities\": [\n    {\n      \"type\": \"DimRequestPoint\",\n      \"description\": \"Requests the placement of a dimension point at a specific coordinate on the beam surface in the drawing.\",\n      \"appliedTo\": \"2D Shop Drawing Layouts (PaperSpace)\"\n    },\n    {\n      \"type\": \"DimRequestLinear\",\n      \"description\": \"Requests a linear dimension between two points (e.g., the depth or width of a cut).\",\n      \"appliedTo\": \"2D Shop Drawing Layouts (PaperSpace)\"\n    },\n    {\n      \"type\": \"DimRequestText\",\n      \"description\": \"Requests text annotations, typically used to display the angle of the cut.\",\n      \"appliedTo\": \"2D Shop Drawing Layouts (PaperSpace)\"\n    }\n  ]\n}\n```"
      },
      "tokens_used": 9288,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Execution Started",
          "Determine Execution Context: Check if running in '_bOnInsert' mode (Manual Insert) or '_bOnMapIO' mode (ShopDraw Engine)",
          "[Manual Mode Only] Prompt user to select a Beam entity",
          "[Manual Mode Only] Prompt user to select a point near the target tool/cut",
          "[ShopDraw Mode Only] Load configuration properties from Execution Map or OPM",
          "Identify the specific Tool entity located at the selected point (_Pt0)",
          "Initialize Dimension Calculation Loop: Iterate through defined View vectors (e.g., Side, Top, Section)",
          "Calculate Dimension Geometry based on View direction and Tool orientation",
          "Apply Dimension Logic: Determine if the tool is part of a collection (Multiple Cuts) or isolated (Single Cut)",
          "[Conditional] Generate Dimension Requests: Create DimRequestPoint, DimRequestLinear, or DimRequestText objects based on logic",
          "[Conditional] Assign Stereotypes: Assign '*' (default), 'LeftStart/End', 'RightStart/End', or 'SectionLeft' based on aggregation settings",
          "Submit Dimension Requests to the ShopDraw Engine",
          "Script Execution Finished"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Mode (_bOnInsert vs ShopDraw Engine)",
            "path1": {
              "name": "Manual Insertion",
              "steps": [
                "Prompt for Beam selection using getBeam()",
                "Prompt for Point location using getPoint('Select point near tool')",
                "Process single instance and exit"
              ]
            },
            "path2": {
              "name": "ShopDraw Batch Processing",
              "steps": [
                "Read properties from Execution Map (e.g., ShowAllInOneLeft;1)",
                "Process automatically for every beam in the layout matching the ruleset",
                "Bypass command line prompts"
              ]
            }
          },
          {
            "condition": "Number of Cuts Detected on Side (cutsOnThisSide.length() > 1)",
            "path1": {
              "name": "Multiple Cuts (Collection)",
              "steps": [
                "Identify the extreme point of the cut collection",
                "Create a DimRequestPoint for the location",
                "Assign Stereotype '*' or aggregated Stereotype (e.g., 'LeftStart')"
              ]
            },
            "path2": {
              "name": "Single Cut",
              "steps": [
                "Calculate body points of the single tool in the current view plane",
                "Create a DimRequestLinear dimensioning the width/depth of the cut",
                "Verify view alignment to prevent duplicate dimensions"
              ]
            }
          },
          {
            "condition": "Aggregation Settings (ShowAllInOneLeft/Right + dimFromStartEndLength)",
            "path1": {
              "name": "Split Dimensioning",
              "steps": [
                "Check if 'dimFromStartEndLength' is enabled and beam exceeds length",
                "Check normal vector direction vs beam axis (vNormal.dotProduct(vxBm))",
                "Assign Stereotype 'LeftStart' or 'LeftEnd' based on cut position relative to beam center"
              ]
            },
            "path2": {
              "name": "Standard Aggregation",
              "steps": [
                "Assign generic Stereotype (e.g., 'LeftStart') for all points on the side"
              ]
            }
          },
          {
            "condition": "JapaneseStyle (Enabled/Disabled)",
            "path1": {
              "name": "Japanese Style Enabled",
              "steps": [
                "Filter tools: Prioritize 'Dove' cuts over Mortise/House",
                "Adjust vertical reference point (Top vs Center) based on beam alignment",
                "Enable specific symbol displays if supported by tool"
              ]
            },
            "path2": {
              "name": "Standard Style",
              "steps": [
                "Dimension all tools individually",
                "Use standard center/top references"
              ]
            }
          },
          {
            "condition": "View Preference (setPreferredViewXDim)",
            "path1": {
              "name": "Preferred View Defined (Index != 0)",
              "steps": [
                "Override default calculation vectors (vyView)",
                "Force dimension projection onto specific view (e.g., left side view or top view)"
              ]
            },
            "path2": {
              "name": "Default View (Index 0)",
              "steps": [
                "Calculate dimension placement based on tool properties and default system logic"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Entity Validity",
            "errorMessage": "Implicit failure if getBeam() returns null",
            "recovery": "User must select a valid GenBeam or similar structural element"
          },
          {
            "check": "Tool Proximity",
            "errorMessage": "No tool found at the selected point",
            "recovery": "User must select a point closer to an existing cut/tenon/notch on the beam surface"
          },
          {
            "check": "Cut Alignment",
            "errorMessage": "Dimension request not generated (Geometry check failed)",
            "recovery": "Adjust tool parameters or view settings; script automatically checks if point is inside profile (pointInProfile)"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensioning Style via OPM",
            "how": "Select the script instance in Model Space or ShopDrawing Layout, open Properties Palette (OPM)",
            "effect": "Changing 'showAllInOneLeft' to 'Yes' immediately regenerates the dimension lines to aggregate points. Changing 'hideAnglesCut' to 'Yes' removes angle text."
          },
          {
            "action": "Update Execution Map",
            "how": "Edit the Multipage Style Ruleset in the CAD configuration",
            "effect": "Changes apply to all beams processed by this style (e.g., forcing 'JapaneseStyle' globally for a project)."
          },
          {
            "action": "Modify Beam Geometry",
            "how": "Edit the associated GenBeam or its tools in the model",
            "effect": "The script recalculates dimensions automatically upon the next ShopDrawing update/refresh."
          }
        ]
      },
      "tokens_used": 10536,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# sd_ACutDe.mcr (Automatic Cut Dimensions)\n\n## Overview\nThis script automates the dimensioning of timber beam cuts, such as tenons, notches, and angles, on hsbCAD shop drawings. It calculates measurement points based on tool geometry and assigns them to specific drawing layers (stereotypes) for consistent production documentation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used primarily for manual insertion and testing. |\n| Paper Space | Yes | Primary environment. Executed by the Shopdrawing engine during layout generation. |\n| Shop Drawing | Yes | Must be added to a Multipage Style Ruleset to function automatically. |\n\n## Prerequisites\n- **Required Entities**: `GenBeam` (with at least one Tool/Cut applied).\n- **Minimum Beam Count**: 1.\n- **Required Settings**: A **Multipage Style Ruleset** (for automatic execution) or manual insertion via command line.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `sd_ACutDe.mcr` from the file list.\n\n### Step 2: Select Beam\n```\nCommand Line: Select beam:\nAction: Click on the timber beam (GenBeam) you wish to dimension.\n```\n\n### Step 3: Select Location\n```\nCommand Line: Select point near tool:\nAction: Click near the specific cut, tenon, or notch on the beam surface to target it for dimensioning.\n```\n*Note: In a production environment, this script is typically triggered automatically by the Shopdrawing engine based on the Multipage Style configuration, skipping these prompts.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **showAllInOneLeft** | dropdown | \\|No\\| | If set to **\\|Yes\\|**, aggregates all dimension points for cuts on the left side into a single continuous dimension line to reduce clutter. |\n| **showAllInOneRight** | dropdown | \\|No\\| | If set to **\\|Yes\\|**, aggregates all dimension points for cuts on the right side into a single continuous dimension line. |\n| **hideAnglesCut** | dropdown | \\|No\\| | If set to **\\|Yes\\|**, suppresses the display of cut angle text (e.g., 45°) in the drawing views. |\n| **Dimension from Start and End** | text | 0 | If the beam length exceeds this value (in mm), dimensions are split into two lines (Start and End) to prevent overcrowding on long beams. Set to 0 to disable. |\n| **japaneseStyle** | dropdown | \\|No\\| | If set to **\\|Yes\\|**, applies specific dimensioning rules for Japanese timber framing (e.g., prioritizing Dove cuts, altering reference points). |\n| **Show dimpoints on x-axis** | dropdown | \\|Default\\| | Forces the longitudinal dimensions to appear in a specific view (e.g., left in side view, right in top view) rather than using the automatic default. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are defined for this script. |\n\n## Settings Files\n- **Configuration**: **Multipage Style Ruleset**\n- **Location**: hsbCAD Company / Project Configuration\n- **Purpose**: Controls the automatic execution of this script during shop drawing generation. You can pass parameters (e.g., `showAllInOneLeft;\\|Yes\\|`) via the Execution Map within the style settings.\n\n## Tips\n- **Clean Up Drawings**: For beams with multiple notches or cuts close together, enable `showAllInOneLeft` and `showAllInOneRight` to create a single chain dimension instead of overlapping individual dimensions.\n- **Long Beams**: If dimensioning long Glulam beams, use `Dimension from Start and End` (e.g., set to `10000`) to split dimensions into a \"Start\" and \"End\" group, making the drawing easier to read.\n- **View Control**: Use `Show dimpoints on x-axis` if the system is placing dimensions on the \"wrong\" side of the beam in the view you are looking at.\n\n## FAQ\n- **Q: Why are my dimensions not appearing on the shop drawing?**\n  **A**: Ensure the script is added to the Ruleset of the Multipage Style you are using to generate the layout. Also, verify that the cuts on the beam are valid tools.\n- **Q: Can I change the dimension style without editing the script?**\n  **A**: Yes. Select the script instance (or the element it is attached to) and change the properties in the AutoCAD Properties Palette (OPM). For global changes, update the parameters in the Multipage Style Execution Map.\n- **Q: What does the \"0\" value mean for Dimension from Start and End?**\n  **A**: A value of \"0\" disables the splitting logic. Dimensions will follow the standard aggregation rules defined by `showAllInOneLeft`/`Right`."
      },
      "tokens_used": 7077,
      "error": null
    }
  }
}