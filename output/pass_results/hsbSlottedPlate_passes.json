{
  "filename": "hsbSlottedPlate.mcr",
  "status": "completed",
  "total_tokens": 47413,
  "processing_time": 334.6498079299927,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.4",
            "date": "12mai2014",
            "author": "th@hsbCAD.de",
            "changes": "new context command to subtract regions from the plate"
          },
          {
            "version": "1.3",
            "date": "29feb2012",
            "author": "th@hsbCAD.de",
            "changes": "bugfix positioning on curved beams and on beams with applied cuts on the relevant surface"
          },
          {
            "version": "1.2",
            "date": "27feb2012",
            "author": "th@hsbCAD.de",
            "changes": "properties on insert bugfix"
          },
          {
            "version": "1.1",
            "date": "14feb2012",
            "author": "th@hsbCAD.de",
            "changes": "publishes Dimrequests"
          },
          {
            "version": "1.0",
            "date": "10feb2012",
            "author": "th@hsbCAD.de",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "hsbDrillPattern"
        ]
      },
      "tokens_used": 7292,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses `_kModelSpace` in `tslNew.dbCreate(..., _kModelSpace, mapTsl);`. There are no references to `sd_`, `Multipage`, `_Viewport`, or `_kPaperSpace`. The script creates 3D geometry (Bodies) and modifies GenBeams with Slots, which are operations performed in the 3D model environment."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "TslInst (hsbDrillPattern)"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space. The script connects multiple beams (at least one main and one secondary) using a generated metal plate based on drill patterns.",
          "requiredSettings": [
            "hsbDrillPattern script"
          ]
        }
      },
      "tokens_used": 5459,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 9775,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a custom-shaped steel slotted connecting plate that joins a main beam to secondary beams, with geometry driven by drill patterns.",
          "category": "Hardware/Connection",
          "typicalUseCase": "Creating a specific metal plate (often a gusset or splice plate) that requires slots in the connecting timber beams for assembly, where the plate size adapts to the arrangement of bolts/screws defined by drill patterns."
        },
        "parameters": [
          {
            "name": "dThickness",
            "technicalDefault": "U(6)",
            "businessMeaning": "The physical thickness of the steel plate to be manufactured.",
            "validRange": "3 mm to 20 mm (Standard steel gauges)",
            "unit": "mm",
            "affectsOutput": "Defines the 3D extrusion depth of the plate Body and the overall weight of the connection."
          },
          {
            "name": "dExtraDiam",
            "technicalDefault": "U(2)",
            "businessMeaning": "The clearance amount added to the fastener diameter for the holes in the steel plate.",
            "validRange": "1 mm to 5 mm",
            "unit": "mm",
            "affectsOutput": "Increases the diameter of Drill holes in the plate. This provides tolerance for misalignment between the timber and the steel plate during assembly."
          },
          {
            "name": "dYSlot",
            "technicalDefault": "U(8)",
            "businessMeaning": "The width of the slot milled into the secondary beams.",
            "validRange": "4 mm to 50 mm (Dependent on fastener head size)",
            "unit": "mm",
            "affectsOutput": "Controls the width dimension of the Slot tool added to the timber beams, ensuring the fastener or plate can pass through."
          },
          {
            "name": "dZOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "The vertical (Z-axis) shift of the entire plate relative to the beam axis.",
            "validRange": "-200 mm to 200 mm (Dependent on beam depth)",
            "unit": "mm",
            "affectsOutput": "Moves the plate and its associated machining (slots in beams) up or down along the beam's height."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "hsbDrillPattern Dimensions (dX, dY)",
            "effect": "The bounding box of the drill patterns defines the base size of the plate.",
            "cascade": [
              "Plate Shape (PlaneProfile)",
              "Slot Length in Beams"
            ]
          },
          {
            "trigger": "dExtraDiam",
            "effect": "Reads the 'Diameter' from the drill pattern map and adds this value to calculate the final hole size.",
            "cascade": [
              "Drill Diameter",
              "Plate Geometry"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body",
            "description": "The solid steel plate shape, extruded to dThickness, derived from the union of drill pattern extents and user-defined contours.",
            "appliedTo": "ModelSpace (New 3D element)"
          },
          {
            "type": "Slot",
            "description": "A rectangular cut milled into the secondary beams to allow the connection.",
            "appliedTo": "_Beam array (Secondary beams defined by drill patterns)"
          },
          {
            "type": "Drill",
            "description": "Cylindrical holes through the steel plate, sized to (Fastener Diameter + dExtraDiam).",
            "appliedTo": "Generated Body (The Steel Plate)"
          }
        ]
      },
      "tokens_used": 8958,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. User executes script (Insert).\",\n    \"2. Script executes _bOnInsert: Displays Property Palette (showDialog).\",\n    \"3. User selects the Main Joist (getBeam).\",\n    \"4. User selects Secondary Beam(s) (PrEntity selection set).\",\n    \"5. Script validates selection (must be >= 2 beams).\",\n    \"6. Script swaps beam array (Main beam moves to index 1).\",\n    \"7. Script creates a temporary instance of 'hsbDrillPattern' to configure bolt settings.\",\n    \"8. User configures drill pattern in the dialog.\",\n    \"9. Script saves pattern settings to catalog and erases temp instance.\",\n    \"10. Script commits insert: Executes _bOnDbCreated.\",\n    \"11. Script loops through selected beams: Creates a permanent 'hsbDrillPattern' instance for each.\",\n    \"12. Script enters Calculation Phase (_bOnRecalc).\",\n    \"13. Script collects internal Additive/Subtractive maps and '_Entity' dependencies.\",\n    \"14. Script loops through collected Drill Patterns to generate the base plate profile.\",\n    \"15. Branch: For each pattern, if beam is Main (index 1) use Rectangle, else use Polygon logic.\",\n    \"16. Script applies Slot tools to the timber beams based on pattern dimensions.\",\n    \"17. Script integrates user-selected Polyline contours (Additive/Subtractive).\",\n    \"18. Script cleans up plate profile (shrink/unshrink).\",\n    \"19. Script generates the 3D Plate Body and applies Drill holes.\",\n    \"20. Script draws final geometry.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Beam Selection Validation\",\n      \"path1\": {\n        \"name\": \"Valid Selection\",\n        \"steps\": [\n          \"User selects >= 2 beams\",\n          \"Workflow proceeds to pattern configuration\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Invalid Selection\",\n        \"steps\": [\n          \"User selects < 2 beams\",\n          \"Script calls eraseInstance()\",\n          \"Script exits immediately\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Dependency Check (hsbDrillPattern)\",\n      \"path1\": {\n        \"name\": \"Dependency Found\",\n        \"steps\": [\n          \"hsbDrillPattern instance created successfully\",\n          \"Dialog shown\",\n          \"Settings cataloged\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Dependency Missing\",\n        \"steps\": [\n          \"dbCreate fails\",\n          \"Script reports notice: 'The creation of a drill pattern instance has failed'\",\n          \"Script calls eraseInstance()\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Geometry Profile Definition (Per Pattern)\",\n      \"path1\": {\n        \"name\": \"Main Beam Pattern (Index 1)\",\n        \"steps\": [\n          \"Identifies pattern beam matches _Beam[1]\",\n          \"Generates rectangular profile for plate\",\n          \"Calculates dimensions based on dX, dY, and Diameter\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Secondary Beam Pattern\",\n        \"steps\": [\n          \"Identifies pattern is secondary\",\n          \"Generates polygon profile\",\n          \"Extends profile intersection towards Reference Plane (_Plf) based on Main Beam depth\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Calculation Dependencies (Patterns)\",\n      \"path1\": {\n        \"name\": \"Patterns Exist\",\n        \"steps\": [\n          \"tslPattern array length > 0\",\n          \"Geometry generation proceeds\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No Patterns\",\n        \"steps\": [\n          \"tslPattern array length < 1\",\n          \"Report Message: 'No drill Pattern found'\",\n          \"eraseInstance()\",\n          \"Exit\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Minimum Beam Count\",\n      \"errorMessage\": \"Implicit check if _Beam.length() < 2. Script simply erases itself.\",\n      \"recovery\": \"User must re-run script and select at least one main and one secondary beam.\"\n    },\n    {\n      \"check\": \"TSL Dependency Availability\",\n      \"errorMessage\": \"The creation of a drill pattern instance has failed. Please ensure that the drill pattern tsl is present in your current drawing.\",\n      \"recovery\": \"Ensure 'hsbDrillPattern.mcr' is loaded in the drawing/ARX path.\"\n    },\n    {\n      \"check\": \"Pattern Existence on Recalc\",\n      \"errorMessage\": \"No drill Pattern found. Tool will be deleted.\",\n      \"recovery\": \"Ensure Drill Pattern instances associated with the metal plate are not deleted manually.\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Modify Parameters\",\n      \"how\": \"Properties Palette (OPM)\",\n      \"effect\": \"Updates dThickness, dYSlot, dExtraDiam, and dZOffset, triggering a recalculation of the plate and slots.\"\n    },\n    {\n      \"action\": \"Add Drill Pattern\",\n      \"how\": \"Context Menu (Right-click) -> 'Add Drill Pattern'\",\n      \"effect\": \"Prompts user to select existing Drill Pattern TSL instances to add to this plate, expanding the plate geometry and adding new connections.\"\n    },\n    {\n      \"action\": \"Add Contour\",\n      \"how\": \"Context Menu (Right-click) -> 'Add Contour'\",\n      \"effect\": \"Prompts user to select Polylines. These shapes are added to the plate volume (Union). Moves the pline from 'Subtractive' to 'Additive' map if it was previously subtracted.\"\n    },\n    {\n      \"action\": \"Subtract Contour\",\n      \"how\": \"Context Menu (Right-click) -> 'Subtract Contour'\",\n      \"effect\": \"Prompts user to select Polylines. These shapes are cut out of the plate"
      },
      "tokens_used": 10129,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbSlottedPlate.mcr\n\n## Overview\nThis script generates a custom-shaped steel slotted connecting plate that joins a main beam to one or more secondary beams. The plate dimensions and shape are automatically calculated based on drill pattern configurations and user-defined parameters.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Operates strictly in 3D Model Space to create geometry. |\n| Paper Space | No | Not designed for 2D layout or detailing views. |\n| Shop Drawing | No | Generates physical 3D bodies and tools, not drawing annotations. |\n\n## Prerequisites\n- **Required Entities**: At least one Main Beam and one Secondary Beam.\n- **Minimum Beam Count**: 2 beams total.\n- **Required Settings**: The `hsbDrillPattern.mcr` script must be loaded and available in the current drawing.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or hsbCAD specific insert command) â†’ Select `hsbSlottedPlate.mcr` from the list.\n\n### Step 2: Select Main Beam\n```\nCommand Line: Select main beam:\nAction: Click on the primary timber beam that will host the main connection point.\n```\n\n### Step 3: Select Secondary Beams\n```\nCommand Line: Select secondary beams:\nAction: Click on the connecting timber beams. Press Enter to finish selection.\nNote: You must select at least one secondary beam.\n```\n\n### Step 4: Configure Drill Pattern\n```\nAction: A dialog box will appear to configure the drill pattern (via the hsbDrillPattern script).\nAction: Set the bolt layout, spacing, and dimensions as required.\nAction: Confirm the dialog settings.\n```\n\n### Step 5: Insertion Complete\n```\nAction: The script calculates the geometry, generates the steel plate body, applies slots to the beams, and inserts the connection into the model.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| dThickness | Number | 6 mm | The physical thickness of the steel plate. |\n| dExtraDiam | Number | 2 mm | The additional clearance added to fastener diameters for the plate holes. |\n| dYSlot | Number | 8 mm | The width of the slot cut into the secondary beams. |\n| dZOffset | Number | 0 mm | The vertical shift of the plate relative to the beam axis. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add Drill Pattern | Prompts you to select existing drill pattern instances in the drawing to add them to the current plate configuration. |\n| Add Contour | Prompts you to select Polylines to add their shape to the plate volume (Union). If a selected polyline was previously subtracting volume, it will be moved to the additive list. |\n| Subtract Contour | Prompts you to select Polylines to cut their shape out of the plate volume (Subtraction). |\n\n## Settings Files\n- **Dependency**: `hsbDrillPattern.mcr`\n- **Location**: hsbCAD TSL directory (Standard Install or Company Folder).\n- **Purpose**: Provides the logic for creating and managing the bolt/drill patterns that drive the plate geometry.\n\n## Tips\n- **Check Dependencies**: If the script deletes itself immediately upon insertion, check that `hsbDrillPattern.mcr` is loaded in the drawing.\n- **Complex Shapes**: Use the \"Add Contour\" or \"Subtract Contour\" right-click options to modify the plate shape with polylines for custom geometries not covered by standard drill patterns.\n- **Beam Order**: Ensure you select the main beam first during the insertion phase, as the script relies on array positioning to determine which beam controls the primary reference plane.\n\n## FAQ\n- **Q: Why did the script disappear after I selected the beams?**\n  A: This usually happens if fewer than 2 beams were selected or if the required `hsbDrillPattern.mcr` script could not be found. Ensure you have at least one main and one secondary beam selected and the dependency script is loaded.\n- **Q: How can I make the holes in the plate larger?**\n  A: Select the generated plate in the model and open the Properties Palette. Increase the `dExtraDiam` value to add more clearance around the bolts.\n- **Q: Can I change the plate shape after insertion?**\n  A: Yes. You can modify the drill pattern properties or use the Right-Click \"Add Contour\" / \"Subtract Contour\" options to modify the plate profile using polylines."
      },
      "tokens_used": 5800,
      "error": null
    }
  }
}