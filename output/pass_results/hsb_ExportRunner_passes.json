{
  "filename": "hsb_ExportRunner.mcr",
  "status": "completed",
  "total_tokens": 37066,
  "processing_time": 374.8063883781433,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.6",
            "date": "12dec2019",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-6199 xref panels are collected if childpanels refer to xref"
          },
          {
            "version": "1.5",
            "date": "21jun17",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "exporter groups ordered"
          },
          {
            "version": "1.4",
            "date": "03may17",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "completely revised, properties combined"
          },
          {
            "version": "1.3",
            "date": "12apr17",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "catalog naming issue fixed"
          },
          {
            "version": "1.2",
            "date": "12apr17",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "minor translation issues fixed, properties categorized"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6198,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses _kModelSpace in the line `Entity entsEl[] = grpElement.collectEntities(true, Entity(), _kModelSpace);`. It does not contain 'sd_' prefix, '#Type E' declarations, or '_Viewport' references. The script explicitly calls `eraseInstance()` after execution, acting as a command utility rather than a generating shopdrawing element."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Beam",
            "Sheet",
            "Sip",
            "Group"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (required for collecting entities and calling the exporter)",
          "requiredSettings": [
            "Exporter Group configuration (must exist in ModelMap to populate sExporterGroups)"
          ]
        }
      },
      "tokens_used": 3680,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one or more elements to export",
              "condition": "sInsertType == Elements",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select entities to export",
              "condition": "sInsertType == Entities",
              "required": true
            },
            {
              "step": 3,
              "function": "PrEntity",
              "promptOriginal": "Select beams to export",
              "condition": "sInsertType == Beams",
              "required": true
            },
            {
              "step": 4,
              "function": "PrEntity",
              "promptOriginal": "Select sheets to export",
              "condition": "sInsertType == Sheets",
              "required": true
            },
            {
              "step": 5,
              "function": "PrEntity",
              "promptOriginal": "Select panels to export",
              "condition": "sInsertType == Panels",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Property Dialog",
            "trigger": "On Insert (if no execute key is provided)",
            "title": "Properties",
            "dataSource": "TSL Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sInsertType",
            "type": "PropString",
            "displayName": "Entity Selection Mode",
            "defaultValue": "Project",
            "inputType": "dropdown",
            "options": [
              "Project",
              "Current floor level",
              "Elements",
              "Entities",
              "Beams",
              "Sheets",
              "Panels",
              "<Floor Groups (Dynamic)>"
            ],
            "category": "General",
            "description": "Defines the type of selection"
          },
          {
            "index": 1,
            "variable": "sExporterGroup",
            "type": "PropString",
            "displayName": "Exporter Group",
            "defaultValue": "<First available from ModelMap>",
            "inputType": "dropdown",
            "options": [
              "<Exporter Groups from ModelMap (Dynamic)>"
            ],
            "category": "General",
            "description": "Defines the Exporter Group"
          },
          {
            "index": 2,
            "variable": "sAllowXRef",
            "type": "PropString",
            "displayName": "Allow XRef Selection",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "General",
            "description": "Specifies wether the seection of XRef entities is allowed."
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6747,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A utility script to automate the export of timber construction data (geometry, machining, and BIM information) to external formats such as BTL, PXML, or Industry Foundation Classes (IFC), using specific configurations defined in the ModelMap.",
          "category": "Data Export/Utilities",
          "typicalUseCase": "Used by detailers or project managers to send manufacturing data to CNC machines, share BIM models with engineers, or archive specific sections of a project (e.g., a single floor or set of walls) by selecting the relevant elements and exporter settings."
        },
        "parameters": [
          {
            "name": "sInsertType",
            "technicalDefault": "Project",
            "businessMeaning": "Determines the scope of the project to be processed by the exporter. It allows the user to filter whether the export covers the entire model, just the current working floor, manually selected entities (like specific walls or beams), or predefined organizational groups.",
            "validRange": "Project, Current floor level, Elements, Entities, Beams, Sheets, Panels, or any specific Floor Group defined in the project structure.",
            "unit": "Selection Filter",
            "affectsOutput": "Controls the quantity and specific subset of geometry and data included in the export file. For example, selecting 'Project' exports everything, while 'Beams' only exports the selected timber studs/beams and ignores sheets or panels unless explicitly selected."
          },
          {
            "name": "sExporterGroup",
            "technicalDefault": "<First available from ModelMap>",
            "businessMeaning": "Selects the specific configuration set (Exporter Group) that dictates how the data is formatted, which attributes are mapped, and what file format is generated (e.g., BTL for Hundegger machines, PXML for Weinmann, or IFC for architectural coordination).",
            "validRange": "Dependent on configuration in the hsbCAD ModelMap. Common values include manufacturer-specific machine names (e.g., 'Weinmann', 'Hundegger', 'Randek') or generic formats (e.g., 'IFC 2x3', 'IFC 4').",
            "unit": "Configuration Selection",
            "affectsOutput": "Directly determines the file format and the specific data content (e.g., specific machining codes, layer names, or material properties) written to the output file. Using the wrong exporter group may result in data that the target machine or software cannot read."
          },
          {
            "name": "sAllowXRef",
            "technicalDefault": "No",
            "businessMeaning": "Defines whether the script should include entities that are referenced from external drawing files (XRefs). This is critical for projects where modular or pre-fabricated components are modeled in separate files and then assembled in the main project.",
            "validRange": "No, Yes",
            "unit": "Boolean",
            "affectsOutput": "If set to 'Yes', the export will traverse into XRef files to retrieve geometry and data for selected components (specifically Panels/SIPs), ensuring a complete export of the assembly. If 'No', XRef components might be missing from the export file or represented only as placeholders."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sInsertType is set to 'Elements', 'Entities', 'Beams', 'Sheets', or 'Panels'",
            "effect": "Activates the user selection prompt on the screen. The prompt text changes based on this selection.",
            "cascade": [
              "sAllowXRef"
            ]
          },
          {
            "trigger": "sInsertType is set to 'Panels' and sAllowXRef is 'Yes'",
            "effect": "The script performs a deep scan of selected MasterPanels and ChildPanels to find associated Sip entities in external XRef definitions.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Export Data File",
            "description": "Generates an external file (types include .btl, .pxml, .ifc, .csv, etc.) containing geometric coordinates, machining operations, material lists, and metadata based on the selected entities and Exporter Group configuration.",
            "appliedTo": "Selected Entities, Groups, or the entire Project depending on 'sInsertType'."
          }
        ]
      },
      "tokens_used": 5985,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script triggered via command or menu.",
          "2. Safety check: If insertCycleCount > 1, erase instance and exit.",
          "3. Check for execution key (_kExecuteKey).",
          "4. [Branch] If key exists, load properties from matching catalog entry; else, show Properties dialog.",
          "5. Read user properties: sInsertType, sExporterGroup, sAllowXRef.",
          "6. [Branch] Execute logic based on sInsertType:",
          "   - Project: Prepare for global export (no selection required).",
          "   - Current floor: Identify _kCurrentGroup.",
          "   - Elements/Entities/Beams/Sheets/Panels: Prompt user for selection.",
          "7. [Conditional] If Elements selected: Automatically collect all entities within those elements.",
          "8. [Conditional] If Entities/Beams/Sheets/Panels selected AND sAllowXRef is 'Yes': Scan for Master/ChildPanels and resolve associated XRef Sip entities.",
          "9. Configure ModelMapComposeSettings (enable solids, tools, hardware, etc.).",
          "10. [Branch] Call Exporter:",
          "    - If specific entities selected: Pass entity array.",
          "    - If Project/Groups selected: Pass group name array.",
          "11. Validate return value of exporter.",
          "12. [Conditional] If export failed: Display error message.",
          "13. Erase script instance from drawing.",
          "14. End."
        ],
        "conditionalBranches": [
          {
            "condition": "Existence of _kExecuteKey (Command Line Switch)",
            "path1": {
              "name": "Silent/Catalog Mode",
              "steps": [
                "Read execution key",
                "Search for catalog entry matching key",
                "Set properties from catalog entry",
                "Skip user dialog"
              ]
            },
            "path2": {
              "name": "Interactive Mode",
              "steps": [
                "Detect no execution key",
                "Open Properties Dialog (OPM)",
                "User manually selects options",
                "User confirms OK to proceed"
              ]
            }
          },
          {
            "condition": "Value of sInsertType (Selection Scope)",
            "path1": {
              "name": "Pre-defined Scope (Project/Floor)",
              "steps": [
                "Skip selection prompts",
                "Determine target Group names internally",
                "Pass Group names to exporter"
              ]
            },
            "path2": {
              "name": "Manual Scope (Elements/Beams/etc)",
              "steps": [
                "Show PrEntity prompt on screen",
                "User selects geometry",
                "Validate selection (collect internal entities for Elements)",
                "Pass Entity array to exporter"
              ]
            }
          },
          {
            "condition": "sAllowXRef is 'Yes' AND selection includes Panels/Sips",
            "path1": {
              "name": "XRef Resolution Enabled",
              "steps": [
                "Iterate selected entities for MasterPanels/ChildPanels",
                "Extract nested ChildPanels",
                "Get SipEntity from ChildPanels",
                "Check if Sip resides in XRef (xrefName != \"\")",
                "Append XRef entities to selection set",
                "Export complete data set"
              ]
            },
            "path2": {
              "name": "XRef Resolution Disabled",
              "steps": [
                "Use only explicitly selected entities",
                "Ignore XRef dependencies",
                "Export partial data set"
              ]
            }
          },
          {
            "condition": "Type of selection collected",
            "path1": {
              "name": "Entity-based Export",
              "steps": [
                "Check if ents.length > 0",
                "Call ModelMap().callExporter with Entity array parameter",
                "Target specific geometry"
              ]
            },
            "path2": {
              "name": "Group-based Export",
              "steps": [
                "Check if groupNames.length > 0 or Project selected",
                "Call ModelMap().callExporter with Group Name array parameter",
                "Target structural hierarchy"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Return status of ModelMap().callExporter",
            "errorMessage": "We apologize, but the call of the exporter has failed.",
            "recovery": "Check sExporterGroup configuration, ensure write permissions to _kPathDwg, and verify selected entities are valid."
          },
          {
            "check": "Current Floor Group Structure (if sInsertType == Current floor level)",
            "errorMessage": "None (Silent failure or empty export)",
            "recovery": "Ensure the active working plane belongs to a valid Floor Group (namePart(2) is empty, namePart(1) is not empty)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None",
            "how": "N/A",
            "effect": "The script executes immediately upon insertion and calls eraseInstance(). No TSL instance remains in the drawing to be modified later."
          }
        ]
      },
      "tokens_used": 8104,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ExportRunner.mcr\n\n## Overview\nThis utility script automates the export of timber construction data (geometry, machining, and BIM information) to external formats such as BTL, PXML, or IFC. It uses specific configurations defined in the ModelMap to filter and format the data for manufacturing or architectural coordination.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be run in Model Space to access the project geometry. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | This is a model export utility, not a drawing generator. |\n\n## Prerequisites\n- **Required Entities**: At least one valid entity (Element, Beam, Sheet, Panel, or Group) must be present, depending on the selection mode chosen.\n- **Configuration**: A valid \"Exporter Group\" must be configured in the hsbCAD ModelMap.\n- **Required Space**: Model Space.\n\n## Usage Steps\n\n### Step 1: Launch Script\nExecute the script using the command line or menu:\n```\nCommand: TSLINSERT\nSelect File: hsb_ExportRunner.mcr\n```\n\n### Step 2: Configure Properties\nUpon insertion, the Properties Palette will appear. Set the following parameters before proceeding:\n\n1.  **Entity Selection Mode**: Choose what to export (e.g., Project, Current floor level, Elements, Panels).\n2.  **Exporter Group**: Select the target configuration (e.g., BTL, IFC) from the dropdown list.\n3.  **Allow XRef Selection**: Set to \"Yes\" if you want to include data from externally referenced files (XRefs), especially for Panels.\n\n### Step 3: Execute Selection\nClose the Properties Palette (or click OK) to trigger the export logic.\n\n- **If \"Project\" or \"Current floor level\" is selected**: The script immediately processes the data without further prompts.\n- **If \"Elements\", \"Beams\", \"Sheets\", or \"Panels\" is selected**: The following command line prompt appears:\n  ```\n  Command Line: Select [entities] to export\n  Action: Click to select the desired objects in the drawing, then press Enter.\n  ```\n\n### Step 4: Completion\nThe script runs the export and automatically removes itself from the drawing. Check the destination folder specified in your Exporter Group configuration for the output file.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Entity Selection Mode | dropdown | Project | Defines the scope of the export. Options include Project, Current floor level, Elements, Entities, Beams, Sheets, Panels, or specific Floor Groups. |\n| Exporter Group | dropdown | <First available> | Selects the configuration set (from ModelMap) that dictates the output format (e.g., BTL, PXML, IFC) and data mapping. |\n| Allow XRef Selection | dropdown | No | If set to \"Yes\", the script scans for and includes data from XRefed drawings (specifically for Panels/SIPs). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script executes immediately upon insertion and does not remain in the drawing for right-click context menu interactions. |\n\n## Settings Files\n- **Source**: hsbCAD ModelMap Configuration\n- **Location**: Defined in your hsbCAD environment (Company or Install path)\n- **Purpose**: Provides the \"Exporter Group\" definitions that control file formats, naming conventions, and attribute mappings used during the export.\n\n## Tips\n- **Quick Export**: Use the \"Project\" or \"Current floor level\" mode to export large amounts of data without manually selecting individual beams or walls.\n- **XRef Handling**: If your project uses modular components modeled in separate files (XRefs), ensure \"Allow XRef Selection\" is set to \"Yes\" to capture the complete geometry of those panels.\n- **Troubleshooting**: If the export fails, verify that the chosen \"Exporter Group\" is correctly configured in the ModelMap and that you have write permissions to the export folder.\n\n## FAQ\n- **Q: The script disappeared after I ran it. Is that normal?**\n  **A:** Yes. This is a \"runner\" script. It performs the task and then deletes itself (`eraseInstance`) automatically to keep your drawing clean.\n- **Q: Why did I get an error \"Call of the exporter has failed\"?**\n  **A:** This usually means the \"Exporter Group\" selected in the properties does not exist in your ModelMap, or the output path is invalid/read-only. Check your ModelMap settings.\n- **Q: Can I export specific walls from different floors at once?**\n  **A:** Yes. Set the \"Entity Selection Mode\" to \"Elements\" or \"Beams\". When prompted, manually select the specific items from various floors, then press Enter."
      },
      "tokens_used": 6352,
      "error": null
    }
  }
}