{
  "filename": "GE_PLOT_SHOW_ELEMENT_DATA.mcr",
  "status": "completed",
  "total_tokens": 40121,
  "processing_time": 419.1983153820038,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": null,\n  \"versionHistory\": [\n    {\n      \"version\": \"v1.0\",\n      \"date\": \"19.mar.2013\",\n      \"author\": \"David Rueda (dr@hsb-cad.com)\",\n      \"changes\": \"- Copied from Layout_ShowElemData, to keep US content folder naming standards\\n\\t- Thumbnail added\"\n    },\n    {\n      \"version\": \"v1.4\",\n      \"date\": \"19.mar.2013\",\n      \"author\": \"David Rueda (dr@hsb-cad.com)\",\n      \"changes\": \"- Version control from 1.0 to 1.4, to keep updated with Layout_ShowElemData\"\n    },\n    {\n      \"version\": \"v1.5\",\n      \"date\": \"21.mar.2013\",\n      \"author\": \"David Rueda (dr@hsb-cad.com)\",\n      \"changes\": \"- \\\"Show data name\\\" (No/Yes) prop added\\n\\t- \\\"Wall code and number\\\" option added\\n\\t- TSL will stop inserting after first attempt (if( insertCycleCount()>1 )\"\n    },\n    {\n      \"version\": \"v1.6\",\n      \"date\": \"07.apr.2013\",\n      \"author\": \"David Rueda (dr@hsb-cad.com)\",\n      \"changes\": \"- \\\"Length\\\" and \\\"Width\\\" options added\"\n    },\n    {\n      \"version\": \"v1.7\",\n      \"date\": \"17.may.2013\",\n      \"author\": \"David Rueda (dr@hsb-cad.com)\",\n      \"changes\": \"- Translators"
      },
      "tokens_used": 6571,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly calls getViewport() and stores the result in the _Viewport array. It accesses the element data via vp.element() which links the Paper Space viewport to the Model Space element. The drawing occurs at user-selected point _Pt0 within the layout context."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space (Layout tab) containing an active hsbCAD viewport showing a valid Element",
          "requiredSettings": [
            "_DimStyles"
          ]
        }
      },
      "tokens_used": 5331,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"|Select location|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"getViewport\",\n        \"promptOriginal\": \"|Select the viewport from which the element is taken|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"pDimStyle\",\n      \"type\": \"PropString\",\n      \"displayName\": \"pDimStyle\",\n      \"defaultValue\": \"hsb-Bom\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"_DimStyles\"\n      ],\n      \"category\": null,\n      \"description\": \"Select dimstyle with proper viewport scaling and dimension format\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"pType\",\n      \"type\": \"PropString\",\n      \"displayName\": \"pType\",\n      \"defaultValue\": \"|Type of"
      },
      "tokens_used": 7766,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Annotates Paper Space layouts with specific dimensional or attribute data (e.g., wall length, height, code) extracted from a selected model viewport.",
          "category": "ShopDrawing/Annotation",
          "typicalUseCase": "Adding text labels to a floor plan or elevation drawing that automatically display the length, height, or stud spacing of the wall visible in a specific viewport."
        },
        "parameters": [
          {
            "name": "pDimStyle",
            "technicalDefault": "hsb-Bom",
            "businessMeaning": "Determines the formatting, precision, and units (mm/inches) of the numerical values displayed in the text label.",
            "validRange": "Any dimension style defined in the current drawing (e.g., hsb-Bom, Standard).",
            "unit": "String (Style Name)",
            "affectsOutput": "Controls the text representation of units and decimal places for all displayed measurements."
          },
          {
            "name": "pType",
            "technicalDefault": "|Type of data|",
            "businessMeaning": "Selects the specific physical property or identifier of the element to be displayed in the label.",
            "validRange": "[Description, Information, Subtype, Stud Spacing, Length, Width, Height, Frame Thickness, Stud Length, Wall Code, Wall Code and number, Length of supporting beam]",
            "unit": "String (Enumeration)",
            "affectsOutput": "Determines the actual content of the text string (e.g., showing '2750' for Height vs '600' for Spacing)."
          },
          {
            "name": "pShowDataName",
            "technicalDefault": "|No|",
            "businessMeaning": "Toggles whether the label includes the descriptive prefix (e.g., 'Height: 2750' vs '2750').",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "Changes the text string length and readability by prepending the data category name."
          },
          {
            "name": "_Pt0",
            "technicalDefault": null,
            "businessMeaning": "The physical location on the layout sheet where the annotation text is placed.",
            "validRange": "Any point in Paper Space coordinates.",
            "unit": "mm (Paper Units)",
            "affectsOutput": "X and Y coordinates of the text entity."
          },
          {
            "name": "_Viewport",
            "technicalDefault": null,
            "businessMeaning": "The specific viewport window on the layout that links the annotation to the correct 3D model element.",
            "validRange": "Any existing hsbCAD viewport on the current layout.",
            "unit": "N/A (Object Reference)",
            "affectsOutput": "Defines the source element from which data is extracted; changing the viewport changes the data displayed."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "pType is set to a geometric value (e.g., Length, Height)",
            "effect": "pDimStyle is required to format the numeric output correctly.",
            "cascade": [
              "pDimStyle"
            ]
          },
          {
            "trigger": "pShowDataName is set to 'Yes'",
            "effect": "The text string includes the localized name of the pType category.",
            "cascade": [
              "pType"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text Entity",
            "description": "A text object drawn in Paper Space displaying the requested element property, formatted according to the selected dimension style.",
            "appliedTo": "Paper Space Layout at user-selected coordinates."
          }
        ]
      },
      "tokens_used": 6248,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution starts.",
          "Check insert cycle count (insertCycleCount).",
          "If cycle count > 1: Erase instance and exit (Prevent auto-repeat).",
          "If cycle count == 1: Continue.",
          "Open Properties Dialog (showDialog) for user configuration.",
          "User sets properties: Type of data (pType), DimStyle (pDimStyle), Show Data Name (pShowDataName).",
          "Prompt user for location point (_Pt0) via getPoint.",
          "Prompt user to select Viewport (_Viewport) via getViewport.",
          "Retrieve Element linked to the selected Viewport.",
          "Validate Element: If invalid, stop execution.",
          "Determine text string based on pType (Branch logic: String retrieval vs Geometric calculation).",
          "Format numerical values using the selected DimStyle.",
          "Check pShowDataName: Prepend localized label (e.g., 'Length: ') if 'Yes'.",
          "Debug check: If text is empty and debug mode is on, set text to '...'.",
          "Draw text entity at _Pt0 using Display dp."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "Count > 1",
              "steps": [
                "eraseInstance()",
                "Return (Script stops)"
              ]
            },
            "path2": {
              "name": "Count == 1",
              "steps": [
                "Proceed with user prompts"
              ]
            }
          },
          {
            "condition": "Selected Viewport Validity",
            "path1": {
              "name": "Viewport contains valid hsbCAD Element",
              "steps": [
                "Cast to Element",
                "Proceed to data extraction"
              ]
            },
            "path2": {
              "name": "Viewport invalid or missing element",
              "steps": [
                "Return (Script draws nothing)"
              ]
            }
          },
          {
            "condition": "Data Type Selection (pType) - Stud Length",
            "path1": {
              "name": "Stud found in element beam list",
              "steps": [
                "Loop through beams",
                "Identify beam where type == _kStud",
                "Store dL() (length) of first matching beam",
                "Break loop"
              ]
            },
            "path2": {
              "name": "No Stud found",
              "steps": [
                "Value remains 0"
              ]
            }
          },
          {
            "condition": "Data Type Selection (pType) - Length of supporting beam",
            "path1": {
              "name": "Supporting beams found",
              "steps": [
                "Loop through element beams",
                "Filter for type == _kSFSupportingBeam",
                "Compare length against list of found lengths (tolerance 1mm)",
                "Append unique lengths to array",
                "Format array as comma-separated string"
              ]
            },
            "path2": {
              "name": "No supporting beams found",
              "steps": [
                "Text remains empty"
              ]
            }
          },
          {
            "condition": "Show Data Name (pShowDataName)",
            "path1": {
              "name": "Yes",
              "steps": [
                "strText = CategoryLabel + \": \" + strText"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "strText = Value only"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Element Link",
            "errorMessage": "None (Silent return)",
            "recovery": "User must select a viewport that is currently linked to a valid model element."
          },
          {
            "check": "Element Type Compatibility (e.g., Stud Spacing)",
            "errorMessage": "None (Silent return/empty text)",
            "recovery": "User must ensure the selected element supports the requested data type (e.g., selecting 'Stud Spacing' for a standard wall with spacing data vs a generic solid)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Annotation",
            "how": "Grip Edit (Drag _Pt0)",
            "effect": "Relocates the text entity in Paper Space."
          },
          {
            "action": "Change Data Type",
            "how": "OPM Properties Palette (pType dropdown)",
            "effect": "Recalculates and displays a different attribute of the element (e.g., switching from 'Height' to 'Wall Code')."
          },
          {
            "action": "Toggle Data Label",
            "how": "OPM Properties Palette (pShowDataName dropdown)",
            "effect": "Adds or removes the text prefix (e.g., toggles between '2750' and 'Height: 2750')."
          },
          {
            "action": "Change Unit Formatting",
            "how": "OPM Properties Palette (pDimStyle dropdown)",
            "effect": "Reformats the number string (e.g., changing metric to imperial or adjusting decimal precision)."
          }
        ]
      },
      "tokens_used": 8184,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_PLOT_SHOW_ELEMENT_DATA.mcr\n\n## Overview\nThis script annotates Paper Space layouts with specific dimensional or attribute data extracted from a selected model viewport. It is used to display element properties—such as Wall Code, Length, Height, or Stud Spacing—as text labels on your production drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | The script extracts data from model elements but operates in the Layout. |\n| Paper Space | Yes | This script must be inserted in a Layout tab containing an active viewport. |\n| Shop Drawing | No | This is a general annotation tool for Layouts. |\n\n## Prerequisites\n- **Required Entities**: A Viewport in Paper Space that is linked to a valid hsbCAD Element (e.g., a Wall or Floor).\n- **Minimum Beam Count**: None (Data is pulled from the Element properties).\n- **Required Settings**: Dimension Styles (e.g., `hsb-Bom`) must exist in the drawing to format numeric values correctly.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Select `GE_PLOT_SHOW_ELEMENT_DATA.mcr` from the file browser.\n\n### Step 2: Configure Properties (Dialog)\nUpon insertion, a configuration dialog may appear (or check the Properties Palette):\n- **Type of data**: Select what you want to show (e.g., Wall Code, Height, Length).\n- **DimStyle**: Select the dimension style to control units (mm/inches) and decimal precision.\n- **Show data name**: Choose \"Yes\" to include a label (e.g., \"Height: 2750\") or \"No\" for just the value.\n\n### Step 3: Select Location\n```\nCommand Line: Select location\nAction: Click the point in Paper Space where you want the text label to be placed.\n```\n\n### Step 4: Select Viewport\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click inside the viewport frame that displays the model element (Wall/Floor) you wish to annotate.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| pDimStyle | Dropdown | hsb-Bom | Select the dimension style that determines unit formatting (e.g., mm vs. inches) and precision for the numerical values. |\n| pType | Dropdown | Type of data | Select the specific property to display. Options include Description, Information, Subtype, Stud Spacing, Length, Width, Height, Frame Thickness, Stud Length, Wall Code, Wall Code and number, and Length of supporting beam. |\n| pShowDataName | Dropdown | No | If set to \"Yes\", the label will include the category name (e.g., \"Length: 5000\"). If \"No\", only the value is shown (e.g., \"5000\"). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Updates the text label if the model geometry has changed or if you have modified the Element properties. |\n\n## Settings Files\n- **Filename**: N/A\n- **Location**: N/A\n- **Purpose**: This script relies on standard AutoCAD/hsbCAD Dimension Styles configured within the current drawing rather than external XML files.\n\n## Tips\n- **Viewport Linking**: Ensure the viewport you select is actually linked to an Element. If the viewport is looking at plain geometry or a non-hsbCAD object, the script will not generate text.\n- **Stud Spacing**: When using \"Stud Spacing\", ensure the selected wall has spacing data defined; otherwise, the result may be blank.\n- **Formatting**: To switch between Metric and Imperial labels, simply change the `pDimStyle` property to a style defined in your drawing for that unit system.\n- **Supporting Beams**: The \"Length of supporting beam\" option is particularly useful for floor panels to list the lengths of the rim beams or trimmers in a single label.\n\n## FAQ\n- **Q: Why did the text not appear after I selected the viewport?**\n- **A:** The selected viewport might not contain a valid hsbCAD Element, or the Element might not support the specific data type selected (e.g., asking for \"Stud Spacing\" on a Floor slab). Try switching the `pType` to a generic property like \"Description\" to test the connection.\n\n- **Q: Can I move the text after inserting it?**\n- **A:** Yes. Select the text in Paper Space and use the standard AutoCAD Move command or drag the grip to reposition it.\n\n- **Q: How do I change the units from mm to inches?**\n- **A:** You do not change this in the script directly. Select the inserted script entity, open the Properties Palette, and change the `pDimStyle` dropdown to a dimension style that is set up for Imperial units."
      },
      "tokens_used": 6021,
      "error": null
    }
  }
}