{
  "filename": "hsbCLT-OpeningSupport.mcr",
  "status": "partial",
  "total_tokens": 36679,
  "processing_time": 2817.2621512413025,
  "passes": {
    "1": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "Request timeout after retries"
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicitly sets 'int bForceModelSpace = true;' in creation mode. Operates on 'Sip' entities (Structural Insulated Panels/CLT) using 3D geometry (PlaneProfile, Vector3d, realBody). No usage of ShopDrawing APIs (sd_*), Sheets, or Viewports."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space containing CLT or SIP panels with openings",
          "requiredSettings": [
            "Catalog entry 'hsbCLT-OpeningSupport' (optional, for property presets)",
            "Catalog entry 'hsbCLT-OpeningSupport-Display' (optional, for display geometry)"
          ]
        }
      },
      "tokens_used": 6807,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog/getSip/PrEntity/getPoint",
              "promptOriginal": "Properties Palette or Command Line",
              "condition": "Depends on 'Opening Mode' property",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "T(\"|Select panels|\")",
              "condition": "Opening Mode is 'All', 'Window', or 'Door/Edge'",
              "required": true
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "TN(\"|Select opening by a point inside or on the opening|\")",
              "condition": "Opening Mode is 'bySelection' (inside while loop)",
              "required": true
            },
            {
              "step": 4,
              "function": "getPoint",
              "promptOriginal": "TN(\"|Pick start point of support|\")",
              "condition": "Opening Mode is 'byLine'",
              "required": true
            },
            {
              "step": 5,
              "function": "PrPoint",
              "promptOriginal": "TN(\"|Pick end point of support|\")",
              "condition": "Opening Mode is 'byLine'",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDialog",
            "trigger": "On Insert (_bOnInsert)",
            "title": "Properties Palette",
            "dataSource": "OPM Properties defined in script",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "T(\"|Width|\")",
            "defaultValue": "U(200)",
            "inputType": "number",
            "options": [],
            "category": "T(\"|Geometry|\")",
            "description": "T(\"|Defines the width of the support perpendicular to the supporting direction.|\")"
          },
          {
            "index": 1,
            "variable": "sAlignment",
            "type": "PropString",
            "displayName": "T(\"|Alignment|\")",
            "defaultValue": "T(\"|Automatic|\")",
            "inputType": "dropdown",
            "options": [
              "T(\"|Automatic|\")",
              "T(\"|Horizontal|\")",
              "T(\"|Vertical|\")"
            ],
            "category": "T(\"|Geometry|\")",
            "description": "T(\"|Defines the Alignment fo the support.|\") + T(\" |Automatic will place the support perpendicular to the open direction in door edge/mode.|\") + T(\"|In window mode automatic will support perpendicular to the largest opening dimension|\")"
          },
          {
            "index": 2,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "T(\"|Offset|\")",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "T(\"|Geometry|\")",
            "description": "T(\"|Defines the offset from center (opening) or edge (door) perpendicular to the selected alignment|\")"
          },
          {
            "index": 3,
            "variable": "sType",
            "type": "PropString",
            "displayName": "T(\"|Opening Mode|\")",
            "defaultValue": "T(\"|All|\")",
            "inputType": "dropdown",
            "options": [
              "T(\"|All|\")",
              "T(\"|bySelection|\")",
              "T(\"|Window|\")",
              "T(\"|Door/Edge|\")",
              "T(\"|byLine|\")"
            ],
            "category": "T(\"|Filter|\")",
            "description": "T(\"|Filters openings by type or selection.|\")"
          },
          {
            "index": 4,
            "variable": "dMinDimension",
            "type": "PropDouble",
            "displayName": "T(\"|Min. Dimension|\")",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "T(\"|Filter|\")",
            "description": "T(\"|Defines the minmal size of the opening perpendicular to the selected alignment|\")"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "T(\"../|Remove Support|\")",
            "handler": "_kExecuteKey",
            "action": "Adds the support area back to the panel as an opening and erases the support instance.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "hsbCLT-OpeningSupport",
            "searchPaths": [
              "Catalog (TslInst)"
            ],
            "purpose": "Provides default property values via setPropValuesFromCatalog",
            "required": false
          },
          {
            "filename": "hsbCLT-OpeningSupport-Display",
            "searchPaths": [
              "Catalog (TslInst)"
            ],
            "purpose": "Optional display geometry for the support instance",
            "required": false
          }
        ]
      },
      "tokens_used": 9736,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates and manages temporary support crosspieces (lintels or stiffeners) for CLT/SIP panel openings during construction handling or installation.",
          "category": "Construction/Assembly",
          "typicalUseCase": "When designing CLT or SIP panels where large openings require temporary stiffening to prevent damage during transport, or where lintels are needed to support structural loads."
        },
        "parameters": [
          {
            "name": "dWidth",
            "technicalDefault": "U(200)",
            "businessMeaning": "The physical width (depth) of the support crosspiece measured perpendicular to the supporting direction (how deep it penetrates into the panel solid).",
            "validRange": "50mm - 1000mm",
            "unit": "mm",
            "affectsOutput": "Controls the depth of the geometric solid generated for the support. Wider values extend further into the panel from the opening edge."
          },
          {
            "name": "sAlignment",
            "technicalDefault": "T(\"|Automatic|\")",
            "businessMeaning": "Determines the orientation of the support crosspiece relative to the panel axes or the opening geometry.",
            "validRange": "Automatic, Horizontal, Vertical",
            "unit": "enum",
            "affectsOutput": "Rotates the support geometry. 'Automatic' aligns it perpendicular to the door opening direction or perpendicular to the longest dimension of a window."
          },
          {
            "name": "dOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "Displaces the support from its default position. For windows, this is offset from the center; for doors, it is offset from the edge.",
            "validRange": "-1000mm - 1000mm",
            "unit": "mm",
            "affectsOutput": "Shifts the location of the support geometry along the axis perpendicular to its length."
          },
          {
            "name": "sType",
            "technicalDefault": "T(\"|All|\")",
            "businessMeaning": "Selects the method for identifying which openings receive supports (Batch processing vs. Manual selection).",
            "validRange": "All, bySelection, Window, Door/Edge, byLine",
            "unit": "enum",
            "affectsOutput": "Determines the user input flow (Point selection vs. Panel selection) and filters which geometric holes in the panel are calculated."
          },
          {
            "name": "dMinDimension",
            "technicalDefault": "U(0)",
            "businessMeaning": "The minimum opening size perpendicular to the support alignment required to generate a support.",
            "validRange": "0mm - 3000mm",
            "unit": "mm",
            "affectsOutput": "Acts as a filter; openings smaller than this dimension will not have a support generated, effectively ignoring small service penetrations."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sType changes to 'Window'",
            "effect": "The 'Alignment' logic (if set to Automatic) calculates based on the largest opening dimension. 'Offset' is calculated from the opening center.",
            "cascade": [
              "sAlignment",
              "dOffset"
            ]
          },
          {
            "trigger": "sType changes to 'Door/Edge'",
            "effect": "The 'Alignment' logic (if set to Automatic) places the support perpendicular to the opening swing/direction. 'Offset' is calculated from the panel edge.",
            "cascade": [
              "sAlignment",
              "dOffset"
            ]
          },
          {
            "trigger": "sType changes to 'byLine'",
            "effect": "Disables opening detection and filtering. User is prompted to define the support start and end points manually.",
            "cascade": [
              "dMinDimension",
              "sAlignment"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TslInst (Smart Instance)",
            "description": "Creates a persistent script instance in the model that visualizes the support geometry and holds the configuration parameters.",
            "appliedTo": "Model Space (Associated with selected Sip/Panel entities)"
          }
        ]
      },
      "tokens_used": 8467,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. User executes script (via Catalog or Command Line).\",\n    \"2. Script opens Properties Palette (OPM) or Dialog.\",\n    \"3. User configures parameters (Width, Alignment, Offset, Opening Mode, Min Dimension).\",\n    \"4. User confirms settings (OK/Apply).\",\n    \"5. Script determines input flow based on 'Opening Mode' property.\",\n    \"6. [Branch] User selects panels or points based on selected mode.\",\n    \"7. Script processes geometry: Identifies openings in selected panels.\",\n    \"8. [Conditional] If 'Automatic' alignment is set, calculates orientation based on opening type (Window vs Door).\",\n    \"9. Script generates 'TslInst' entities to visualize the supports.\",\n    \"10. Script finishes (OnInsert phase ends, OnDbCreated triggers instance updates).\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Value of 'Opening Mode' (sType) property\",\n      \"path1\": {\n        \"name\": \"All / Window / Door/Edge\",\n        \"steps\": [\n          \"Script prompts 'Select panels' (PrEntity).\",\n          \"User selects one or multiple Sip entities.\",\n          \"Script processes all entities to find relevant openings based on mode filter.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"bySelection\",\n        \"steps\": [\n          \"Script prompts 'Select panels' (getSip).\",\n          \"User selects a single Sip entity.\",\n          \"Script enters loop prompting 'Select opening by a point inside or on the opening' (PrPoint).\",\n          \"User picks points.\",\n          \"Script processes only openings containing selected points.\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"byLine\",\n        \"steps\": [\n          \"Script prompts 'Select panels' (getSip).\",\n          \"User selects a single Sip entity.\",\n          \"Script prompts 'Pick start point of support' (getPoint).\",\n          \"Script prompts 'Pick end point of support' (PrPoint).\",\n          \"Script creates support contour based on defined line segment.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Geometric Validation (Calculated Support Area)\",\n      \"path1\": {\n        \"name\": \"Valid Support Area\",\n        \"steps\": [\n          \"Contour area > epsilon.\",\n          \"Draws support visualization.\",\n          \"Keeps instance active.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Invalid/No Support Area\",\n        \"steps\": [\n          \"Contour area <= epsilon.\",\n          \"Reports error: 'could not find any support area.'\",\n          \"Erases instance immediately.\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Duplicate Insertion Cycle\",\n      \"errorMessage\": \"(Silent)\",\n      \"recovery\": \"Script checks 'insertCycleCount()'; if > 1, it erases the new instance to prevent duplicates on drag-drop or rapid execution.\"\n    },\n    {\n      \"check\": \"Panel Selection (byLine mode)\",\n      \"errorMessage\": \"(Silent failure or cancel)\",\n      \"recovery\": \"If user cancels the 'Pick end point' prompt, the script erases the instance.\"\n    },\n    {\n      \"check\": \"Support Area Calculation\",\n      \"errorMessage\": \"[ScriptName]: could not find any support area.\",\n      \"recovery\": \"Script erases the specific instance that failed calculation.\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Edit Properties\",\n      \"how\": \"Properties Palette (OPM)\",\n      \"effect\": \"Modifying Width, Alignment, or Offset triggers a recalculation, updating the support geometry in the model.\"\n    },\n    {\n      \"action\": \"Remove Support\",\n      \"how\": \"Right-click Context Menu -> '../Remove Support'\",\n      \"effect\": \"Adds the support area back to the panel as a defined opening (cleanup) and"
      },
      "tokens_used": 11669,
      "error": null
    },
    "6": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "API error 429: {\"error\":{\"code\":\"1302\",\"message\":\"您的账户已达到速率限制，请您控制请求频率\"}}"
    }
  }
}