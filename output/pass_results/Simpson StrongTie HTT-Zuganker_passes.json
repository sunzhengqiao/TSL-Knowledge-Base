{
  "filename": "Simpson StrongTie HTT-Zuganker.mcr",
  "status": "completed",
  "total_tokens": 45616,
  "processing_time": 284.91968536376953,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 8831,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses _kModelSpace for tslDialog.dbCreate calls. It focuses on modifying GenBeam entities and creating 3D Body objects (hardware/fixtures), which is characteristic of ModelSpace/Element scripts. It lacks 'sd_' prefixes, #Type E structures, or _Viewport handling required for PaperSpace/ShopDrawing environments."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "The script must be inserted onto a GenBeam in Model Space to function. It reads beam geometry and adds milling/surfaces to it.",
          "requiredSettings": [
            "FixtureDefinition.xml (referenced as mapSetting)"
          ]
        }
      },
      "tokens_used": 5233,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getGenBeam",
              "promptOriginal": "Select 1 or more beams",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getString",
              "promptOriginal": "Are you sure to overwrite existing settings? [No/Yes]",
              "condition": "_bOnRecalc && Export Settings",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog (dbCreate)",
            "trigger": "Right-click -> Edit Fixing",
            "title": "scriptName()",
            "dataSource": "Properties set with setOPMKey(\"EditFixing\")",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "ShowDynamicDialog (dbCreate)",
            "trigger": "Right-click -> Delete Fixing",
            "title": "scriptName()",
            "dataSource": "Properties set with setOPMKey(\"RemoveFixing\")",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "ShowDynamicDialog (dbCreate)",
            "trigger": "Right-click -> Add Fixture to scriptName()",
            "title": "scriptName()",
            "dataSource": "Properties set with setOPMKey(\"TagFixture\")",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "|Type|",
            "defaultValue": "HTT5",
            "inputType": "dropdown",
            "options": [
              "HTT5",
              "HTT22"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "|Depth|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|Tooling|",
            "description": "|Specifies the milling depth|"
          },
          {
            "index": 2,
            "variable": "dGap",
            "type": "PropDouble",
            "displayName": "|Gap|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Edit Fixing|",
            "handler": "|Edit Fixing|",
            "action": "Opens dialog to add or edit a fixture definition (Article, Manufacturer, Description, Category, Model, Scales).",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Delete Fixing|",
            "handler": "|Delete Fixing|",
            "action": "Opens dialog to select and remove a fixture definition from the settings.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Add Fixture to| scriptName()",
            "handler": "sTriggerTagFixture",
            "action": "Opens dialog to select a fixture to be available/linked to this script.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Export Settings|",
            "handler": "sTriggerExportSettings",
            "action": "Prompts to overwrite XML file and writes current fixture settings to disk.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "FixtureDefinition.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings\\"
            ],
            "purpose": "Stores fixture definitions (Geometry, Models, Applications) and manages their availability to the script.",
            "required": true
          }
        ]
      },
      "tokens_used": 7321,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts a Simpson Strong-Tie HTT (Heavy Tension Tie) timber connector into a selected beam, generating the 3D hardware model and applying the necessary tooling/milling to the timber element.",
          "category": "Hardware / Connection",
          "typicalUseCase": "Anchoring a timber wall or beam to a concrete foundation or floor slab to resist uplift (tension) loads using the HTT22 or HTT5 strap."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "HTT5",
            "businessMeaning": "Selects the specific model of the Simpson Strong-Tie connector (HTT5 or HTT22). This determines the physical dimensions (height/width/depth) of the hardware.",
            "validRange": "HTT5, HTT22",
            "unit": "Enumeration",
            "affectsOutput": "Swaps the 3D geometry generation between the smaller HTT5 (404mm height) and the larger HTT22 (559mm height)."
          },
          {
            "name": "dDepth",
            "technicalDefault": 0,
            "businessMeaning": "The depth of the milling/recess cut into the timber. Allows the connector to be embedded into the wood rather than surface-mounted.",
            "validRange": "0 mm to 62 mm (0 = surface mounted, >0 = recessed)",
            "unit": "mm",
            "affectsOutput": "Controls the Z-axis position of the hardware model relative to the timber surface and creates a corresponding milling/pocket in the beam."
          },
          {
            "name": "dGap",
            "technicalDefault": 0,
            "businessMeaning": "An offset distance, typically used to create space between the timber element and the concrete anchor point (e.g., accounting for plaster, facade thickness, or concrete tolerance).",
            "validRange": "0 mm to ~200 mm",
            "unit": "mm",
            "affectsOutput": "Shifts the position of the connector and the associated machining relative to the beam's reference point."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sType",
            "effect": "Changes the hardcoded dimensional arrays (Height/Width/Thickness) used for geometry generation.",
            "cascade": [
              "Hardware Dimensions",
              "Milling Contours"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (3D Model)",
            "description": "A 3D representation of the metal Simpson Strong-Tie strap, positioned based on the selected beam and parameters.",
            "appliedTo": "ModelSpace (referenced to the GenBeam)"
          },
          {
            "type": "Milling / Pocket",
            "description": "A rectangular recess cut into the timber to accommodate the thickness of the tie if dDepth > 0.",
            "appliedTo": "Selected GenBeam"
          },
          {
            "type": "Surface/Drilling (Implicit)",
            "description": "While not explicitly shown in the snippet, HTT anchors typically require nail holes or bolt holes through the steel into the timber.",
            "appliedTo": "Selected GenBeam"
          }
        ]
      },
      "tokens_used": 8210,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Load constants and check debug mode.",
          "2. Settings Loading: Locate and read 'FixtureDefinition.xml' (Company path -> Install path -> MapObject fallback).",
          "3. Dialog Mode Check: Determine if script is running in maintenance mode (Edit/Delete/Tag fixture). If yes, show sub-dialog and exit.",
          "4. Entity Selection: Prompt user 'Select 1 or more beams' using getGenBeam.",
          "5. Entity Filtering: Filter beams based on project specials (e.g., BAUFRITZ, RUB). Validate selection.",
          "6. Parameter Assignment: Set initial OPM properties (Type=HTT5, Depth=0, Gap=0).",
          "7. Geometry Calculation: Calculate coordinates based on beam side, type (HTT5/HTT22), and parameters.",
          "8. Double Anchor Detection: Search for existing script on the opposite side of the beam to handle double anchor configurations.",
          "9. Model Generation: Create 3D Body for the strap and Milling/Pocket if Depth > 0.",
          "10. Finish: Visual update and script termination."
        ],
        "conditionalBranches": [
          {
            "condition": "FixtureDefinition.xml availability",
            "path1": {
              "name": "File Found",
              "steps": [
                "Read XML from Company or Install path.",
                "Update MapObject settings.",
                "Populate list of available fixtures."
              ]
            },
            "path2": {
              "name": "File Not Found",
              "steps": [
                "Set 'bUseDefaultFixing' flag.",
                "Proceed with internal hardcoded defaults (if any)."
              ]
            }
          },
          {
            "condition": "Right-click 'Export Settings' Trigger",
            "path1": {
              "name": "File Exists",
              "steps": [
                "Prompt: 'Are you sure to overwrite existing settings? [No/Yes]'.",
                "If Yes: Write current MapObject to XML.",
                "If No: Cancel operation."
              ]
            },
            "path2": {
              "name": "File Does Not Exist",
              "steps": [
                "Create directory path if missing.",
                "Write current MapObject to XML directly."
              ]
            }
          },
          {
            "condition": "Connector Type Selection (sType)",
            "path1": {
              "name": "HTT5",
              "steps": [
                "Load dimensions: Height=404mm, Width=64mm.",
                "Generate smaller strap geometry."
              ]
            },
            "path2": {
              "name": "HTT22",
              "steps": [
                "Load dimensions: Height=559mm, Width=64mm.",
                "Generate larger strap geometry."
              ]
            }
          },
          {
            "condition": "Milling Depth (dDepth)",
            "path1": {
              "name": "Depth > 0",
              "steps": [
                "Calculate offset for hardware to be recessed.",
                "Add Milling operation (pocket) to the GenBeam."
              ]
            },
            "path2": {
              "name": "Depth = 0",
              "steps": [
                "Position hardware flush with timber surface.",
                "No milling operation added."
              ]
            }
          },
          {
            "condition": "Double Anchor Detection",
            "path1": {
              "name": "Partner Found",
              "steps": [
                "Identify partner script instance on opposite beam side.",
                "Calculate position relative to partner to ensure proper pairing."
              ]
            },
            "path2": {
              "name": "Single Anchor",
              "steps": [
                "Place anchor based on single insertion point logic."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection",
            "errorMessage": "(Implicit) Invalid selection or empty selection array.",
            "recovery": "User must select valid GenBeam entities via AutoCAD selection prompt."
          },
          {
            "check": "Project Specials",
            "errorMessage": "(Implicit) Incompatible element type for specific project config.",
            "recovery": "Script filters non-matching elements automatically; user must select compatible beam."
          },
          {
            "check": "Export Overwrite",
            "errorMessage": "User cancels overwrite prompt.",
            "recovery": "Operation aborts without file changes."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Connector Parameters",
            "how": "OPM (Object Properties Manager)",
            "effect": "Changes Type (swaps geometry), Depth (adds/removes milling), or Gap (moves position)."
          },
          {
            "action": "Edit Fixtures (Configuration)",
            "how": "Right-click Context Menu -> 'Edit Fixing'",
            "effect": "Opens dialog to define new fixtures (Article, Manufacturer, Dimensions) and saves them to the shared XML/MapObject."
          },
          {
            "action": "Tag Fixture",
            "how": "Right-click Context Menu -> 'Add Fixture to...'",
            "effect": "Links an existing fixture definition from the global list to this specific script, making it selectable."
          },
          {
            "action": "Delete Fixture",
            "how": "Right-click Context Menu -> 'Delete Fixing'",
            "effect": "Removes a fixture definition from the configuration."
          },
          {
            "action": "Export Settings",
            "how": "Right-click Context Menu -> 'Export Settings'",
            "effect": "Saves the current in-memory configuration to 'FixtureDefinition.xml' on disk."
          }
        ]
      },
      "tokens_used": 9875,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Simpson StrongTie HTT-Zuganker.mcr\n\n## Overview\nInserts a Simpson Strong-Tie HTT (Heavy Tension Tie) timber connector onto a selected beam. It generates the 3D hardware model and applies the necessary tooling/milling to the timber element.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be inserted onto a GenBeam. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required entities:** GenBeam (Timber beam).\n- **Minimum beam count:** 1.\n- **Required settings files:** `FixtureDefinition.xml` (Must exist in Company or Install TSL Settings folder).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Simpson StrongTie HTT-Zuganker.mcr`\n\n### Step 2: Select Beam\n```\nCommand Line: Select 1 or more beams\nAction: Click on the timber beam(s) in the Model Space where you want to install the HTT anchor and press Enter.\n```\n\n### Step 3: Configure Parameters\n```\nAction: After insertion, select the script instance and open the Properties palette (Ctrl+1). Adjust parameters like Type, Depth, or Gap as needed.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | dropdown | HTT5 | Select the connector model: HTT5 (smaller) or HTT22 (larger). |\n| Depth | number | 0 | Milling depth into the timber (mm). Enter 0 for surface-mounted, or a value > 0 to recess the connector into the wood. |\n| Gap | number | 0 | Offset distance (mm) from the reference point, useful for creating space for facade layers or tolerances. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Edit Fixing | Opens a dialog to modify fixture definitions (Article No., Manufacturer, Dimensions). |\n| Delete Fixing | Opens a dialog to remove a specific fixture definition from the list. |\n| Add Fixture to [Script Name] | Opens a dialog to link an existing fixture definition to this script instance. |\n| Export Settings | Saves the current fixture configuration to the `FixtureDefinition.xml` file on disk. |\n\n## Settings Files\n- **Filename**: `FixtureDefinition.xml`\n- **Location**: `...\\TSL\\Settings\\` (Company or Install folder).\n- **Purpose**: Stores the configuration data for fixtures, including geometry references, manufacturer details, and models. If missing, the script may fall back to defaults or fail.\n\n## Tips\n- **Recessing the Anchor**: Set the **Depth** property to the thickness of the steel plate (approx. 2-3mm) to allow the strap to sit flush with or below the timber surface if required by the design.\n- **Facade Clearance**: Use the **Gap** parameter to push the connector away from the beam if you need to account for exterior insulation or plaster layers.\n- **Double Anchors**: The script automatically detects if a partner anchor is installed on the opposite side of the beam and adjusts accordingly.\n- **Project Compatibility**: The script filters beams based on project specials (e.g., BAUFRITZ). Ensure you are selecting the correct beam elements for your specific project configuration.\n\n## FAQ\n- Q: I see an error or nothing happens when I select the beam.\n- A: Ensure `FixtureDefinition.xml` exists in your settings folder. If the file is missing, the script cannot load fixture definitions.\n- Q: How do I switch between the HTT5 and HTT22 models?\n- A: Select the script instance, open the Properties palette, and change the **Type** dropdown from HTT5 to HTT22.\n- Q: What happens when I click \"Export Settings\"?\n- A: The script will ask \"Are you sure to overwrite existing settings?\". Type **Yes** to save your current configuration to the XML file, making it available for other instances or users."
      },
      "tokens_used": 6146,
      "error": null
    }
  }
}