{
  "filename": "hsbCLT-AssignMasterpanelPosnumData.mcr",
  "status": "completed",
  "total_tokens": 34967,
  "processing_time": 207.74111032485962,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "13may2019",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5215,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Collects entities using Group().collectEntities(true,MasterPanel(), _kModelSpace). Script targets MasterPanels and does not use ShopDrawing (sd_) prefixes or Viewport logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "MasterPanel"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3468,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && sKey.length() == 0",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select entity(s)|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nNumber",
            "type": "PropInt",
            "displayName": "|Start Number|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Posnum|",
            "description": "|Defines the start number of the indexing.| |The next available number will be assigned.| |0 = disabled|"
          },
          {
            "index": 0,
            "variable": "sName",
            "type": "PropString",
            "displayName": "|Format|",
            "defaultValue": "@(Style)",
            "inputType": "text",
            "options": [],
            "category": "|Name|",
            "description": "|Defines the name of the masterpanel.| |Use format expressions and/or any text||Besides the properties of panels the following format expressions are supported:|\n@(surfaceQualityBottom)\n@(surfaceQualityTop)\n@(surfaceQuality)\n@(SipComponent.Material)\n@(SipComponent.Name)\n@(SipComponent.Thickness)"
          },
          {
            "index": 1,
            "variable": "nNameIndex",
            "type": "PropInt",
            "displayName": "|Index|",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": "|Name|",
            "description": "|Defines the start number of an increment which is appended to the name.| |0 = disabled|"
          },
          {
            "index": 1,
            "variable": "sInformation",
            "type": "PropString",
            "displayName": "|Format| ",
            "defaultValue": "@(Style)",
            "inputType": "text",
            "options": [],
            "category": "|Information|",
            "description": "|Sets the information of the masterpanel.| |Use format expressions and/or any text||Besides the properties of panels the following format expressions are supported:|\n@(surfaceQualityBottom)\n@(surfaceQualityTop)\n@(surfaceQuality)\n@(SipComponent.Material)\n@(SipComponent.Name)\n@(SipComponent.Thickness)"
          },
          {
            "index": 2,
            "variable": "nInformationIndex",
            "type": "PropInt",
            "displayName": "|Index| ",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "|Information|",
            "description": "|Defines the start number of an increment which is appended to the information.| |0 = disabled|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6619,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Batch assigns Position Numbers (Posnum), Names, and Information to MasterPanels using format strings and automatic incrementing counters.",
          "category": "Data Management / Labeling",
          "typicalUseCase": "Used during the detailing phase to standardize naming and numbering of CLT panels for production lists, exports, or drawing labels, ensuring data consistency across the project."
        },
        "parameters": [
          {
            "name": "nNumber",
            "technicalDefault": "0",
            "businessMeaning": "The starting position number for the selected panels. If set to 0, the numbering feature is disabled, and existing numbers are left untouched.",
            "validRange": "0 to 99999",
            "unit": "count",
            "affectsOutput": "Assigns a unique sequential integer to the MasterPanel's Posnum property, checking against all other panels in the model to avoid duplicates."
          },
          {
            "name": "sName",
            "technicalDefault": "@(Style)",
            "businessMeaning": "A format template defining how the MasterPanel Name is generated. It combines static text with dynamic data tokens (e.g., @(SipComponent.Material), @(surfaceQuality)).",
            "validRange": "Any text string",
            "unit": "text",
            "affectsOutput": "Overwrites the MasterPanel's Name property with the resolved string (e.g., 'C24_200mm_S4S')."
          },
          {
            "name": "nNameIndex",
            "technicalDefault": "1",
            "businessMeaning": "The starting counter value for a numeric suffix appended to the Name. Used to distinguish panels with identical generated names (e.g., Wall_01, Wall_02).",
            "validRange": "0 to 9999",
            "unit": "count",
            "affectsOutput": "Appends a 2-digit (or more) number to the end of the resolved Name string. Set to 0 to disable the suffix."
          },
          {
            "name": "sInformation",
            "technicalDefault": "@(Style)",
            "businessMeaning": "A format template defining the content of the MasterPanel's Information field. Used for additional metadata or handling instructions.",
            "validRange": "Any text string",
            "unit": "text",
            "affectsOutput": "Overwrites the MasterPanel's Information property with the resolved string."
          },
          {
            "name": "nInformationIndex",
            "technicalDefault": "0",
            "businessMeaning": "The starting counter value for a numeric suffix appended to the Information field.",
            "validRange": "0 to 9999",
            "unit": "count",
            "affectsOutput": "Appends a 2-digit (or more) number to the end of the resolved Information string. Set to 0 to disable the suffix."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "nNameIndex > 0",
            "effect": "Enables the automatic appending of an incrementing number to the end of the 'sName' result.",
            "cascade": [
              "sName"
            ]
          },
          {
            "trigger": "nInformationIndex > 0",
            "effect": "Enables the automatic appending of an incrementing number to the end of the 'sInformation' result.",
            "cascade": [
              "sInformation"
            ]
          },
          {
            "trigger": "nNumber > 0",
            "effect": "Scans all other MasterPanels in the Model Space to calculate the next available unique number starting from the defined value.",
            "cascade": [
              "nUsedNumbers"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "MasterPanel (Modified)",
            "description": "Existing MasterPanel entities have their properties (Number, Name, Information) updated based on the input parameters.",
            "appliedTo": "User-selected MasterPanels"
          }
        ]
      },
      "tokens_used": 6842,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launched via command or toolbar (executes _bOnInsert block).",
          "2. Check insertCycleCount(); if > 1, erase instance and exit (prevents re-run).",
          "3. Check for Execute Key (_kExecuteKey) to see if a catalog preset was requested.",
          "4. [Conditional] Branch: Set properties from catalog or show Dialog based on Execute Key.",
          "5. Prompt user to select MasterPanels (PrEntity).",
          "6. [Conditional] Branch: User selects entities (Continue) or cancels (Exit).",
          "7. Erase script instance (sets properties to selected entities).",
          "8. [Script Calculation Loop]: Scan Model Space for all MasterPanels to build exclusion list (nUsedNumbers).",
          "9. [Script Calculation Loop]: Iterate through selected MasterPanels sequentially.",
          "10. [Conditional] Branch: Calculate Posnum (if nNumber > 0) finding next unique number.",
          "11. [Script Calculation Loop]: Extract Nested Panel and Sip/Style data from MasterPanel.",
          "12. [Script Calculation Loop]: Parse format strings (sName, sInformation) replacing tokens (e.g., @(Style), @(surfaceQuality)) with actual data.",
          "13. [Conditional] Branch: Append numeric suffix to Name (if nNameIndex > 0).",
          "14. [Conditional] Branch: Append numeric suffix to Information (if nInformationIndex > 0).",
          "15. Apply updated Number, Name, and Information to the MasterPanel.",
          "16. Exit script (erase instance unless debug mode is active)."
        ],
        "conditionalBranches": [
          {
            "condition": "Presence of _kExecuteKey (Catalog Preset)",
            "path1": {
              "name": "Catalog Load",
              "steps": [
                "Extract Execute Key.",
                "Check if key exists in script's catalog list.",
                "If found, load properties from specific catalog entry.",
                "If not found, load properties from '_LastInserted' catalog entry."
              ]
            },
            "path2": {
              "name": "Manual Input",
              "steps": [
                "Execute showDialog().",
                "User sets Start Number, Formats, and Indices manually.",
                "User clicks OK."
              ]
            }
          },
          {
            "condition": "Start Number (nNumber) Value",
            "path1": {
              "name": "Numbering Enabled",
              "steps": [
                "Collect existing numbers from all non-selected MasterPanels.",
                "Find first integer >= nNumber not in the used list.",
                "Assign number to MasterPanel.",
                "Add new number to used list for the next panel."
              ]
            },
            "path2": {
              "name": "Numbering Disabled (nNumber <= 0)",
              "steps": [
                "Skip Posnum assignment.",
                "Preserve existing Posnum on MasterPanels."
              ]
            }
          },
          {
            "condition": "Index Values (nNameIndex / nInformationIndex)",
            "path1": {
              "name": "Indexing Enabled (>0)",
              "steps": [
                "Resolve the format string to text.",
                "Append zero-padded number (e.g., '01', '12') to the text.",
                "Increment the index counter for the next panel."
              ]
            },
            "path2": {
              "name": "Indexing Disabled (0)",
              "steps": [
                "Resolve the format string to text.",
                "Assign text without suffix."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Nested Panel Existence",
            "errorMessage": "None (Internal check).",
            "recovery": "Script checks 'childs.length()'. If 0, the Sip object is not found, and format strings dependent on Sip data (like @(SipComponent.Material)) likely return empty/unresolved values, but the script does not crash."
          },
          {
            "check": "Selection Validity",
            "errorMessage": "None (Internal filter).",
            "recovery": "The script filters the selection set using 'MasterPanel()' and 'bIsValid()', ignoring any non-MasterPanel entities selected by the user."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Re-run Script on Same Entities",
            "how": "Select MasterPanels and re-run the command.",
            "effect": "If 'Start Number' is > 0, it will likely overwrite existing numbers with new ones (unless logic exists to skip already numbered ones, but code implies finding 'next free', so renaming/re-numbering depends on the global state). If 'Start Number' is 0, it re-applies Names and Information based on current format settings."
          },
          {
            "action": "Properties Palette (OPM) Edit",
            "how": "Select the script instance (if not erased) or the MasterPanels themselves.",
            "effect": "The script instance is erased by default after running. To edit parameters, one would typically modify the catalog entry or re-insert the tool to generate a new instance with new settings. Editing MasterPanel properties directly bypasses the script logic."
          }
        ]
      },
      "tokens_used": 7105,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-AssignMasterpanelPosnumData.mcr\n\n## Overview\nBatch assigns Position Numbers, Names, and Information to selected MasterPanels using customizable format strings and automatic incrementing counters.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates exclusively in Model Space. |\n| Paper Space | No | Not supported for Paper Space entities. |\n| Shop Drawing | No | This script does not process shop drawing views. |\n\n## Prerequisites\n- **Required entities**: MasterPanel entities must exist in the drawing.\n- **Minimum beam count**: 1 (usually used on multiple panels).\n- **Required settings files**: None (internal catalogs may be used for presets).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCLT-AssignMasterpanelPosnumData.mcr`\n\n### Step 2: Configure Properties\n*Note: This step may occur automatically if a specific Catalog preset is chosen, or a dialog may appear.*\n1.  If prompted, set the desired parameters in the dialog (Start Number, Name Format, etc.).\n2.  Alternatively, properties can be adjusted via the Properties Palette if the script instance is selected before selecting panels.\n\n### Step 3: Select Entities\n```\nCommand Line: Select entity(s)\nAction: Click on the MasterPanels you wish to update. Press Enter to confirm selection.\n```\n\n### Step 4: Processing\nThe script automatically processes the selected entities, applies the numbering and naming logic, and then erases itself from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Start Number | number | 0 | Defines the starting number for indexing. The next available number will be assigned. Set to 0 to disable position numbering. |\n| Format (Name) | text | @(Style) | Defines the name of the masterpanel. Use format expressions and/or text. Supports tokens like @(Style), @(SipComponent.Material), @(surfaceQuality). |\n| Index (Name) | number | 1 | Defines the start number for an increment appended to the name (e.g., Wall_01). Set to 0 to disable. |\n| Format (Information) | text | @(Style) | Sets the information field of the masterpanel. Supports the same format expressions as the Name field. |\n| Index (Information) | number | 0 | Defines the start number for an increment appended to the information field. Set to 0 to disable. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific custom context menu items are added by this script. |\n\n## Settings Files\n- **Filename**: N/A (Uses internal script logic or standard catalogs)\n- **Location**: N/A\n- **Purpose**: Script relies on internal properties; no external settings file is strictly required for basic execution.\n\n## Tips\n- **Renaming Only**: If you only want to update the Name or Information fields without changing the Position Numbers, set the **Start Number** to `0`.\n- **Custom Formats**: You can mix static text with dynamic tokens. For example, `Wall-@(Style)` will result in names like `Wall-CLT240`.\n- **Data Availability**: Ensure your panels have valid SIP/Style data assigned. Tokens like `@(SipComponent.Material)` will return empty if the material is not defined in the panel construction.\n- **Avoiding Duplicates**: The script scans the entire Model Space to ensure the Position Number assigned is unique.\n\n## FAQ\n- **Q: What happens if I run the script twice on the same panels?**\n  A: If the Start Number is > 0, the script will attempt to find the next available free number in the model, potentially re-numbering the panels again. If Start Number is 0, it will re-apply the Name/Information formats.\n- **Q: How do I include the panel thickness in the name?**\n  A: Use the token `@(SipComponent.Thickness)` in the Format field.\n- **Q: Can I number panels out of order?**\n  A: The script assigns numbers sequentially based on the selection order and the available numbers in the model. To number out of order, select panels one by one or in specific groups."
      },
      "tokens_used": 5718,
      "error": null
    }
  }
}