{
  "filename": "AdjustableSupport.mcr",
  "status": "completed",
  "total_tokens": 51011,
  "processing_time": 375.5183217525482,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl creates ",
        "versionHistory": [
          {
            "version": "1.3",
            "date": "09.06.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-15668: Add secondary grid, and its properties"
          },
          {
            "version": "1.2",
            "date": "08.06.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-15668: Outter contour defined by the underlying \"RUB-Raum\" instances"
          },
          {
            "version": "1.1",
            "date": "08.06.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-15668: Add commands to Add/delete points"
          },
          {
            "version": "1.0",
            "date": "07.06.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-15668: initial"
          }
        ],
        "settingsFiles": [
          "AdjustableSupport.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 8636,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of '_kModelSpace' in the dbCreate() function call within the 'AddPoint' trigger. The script defines 'PropDouble' properties for physical dimensions (Thickness, Grid spacing) and performs geometric calculations (PLine intersection, PlaneProfile) typical of 3D modeling. No 'sd_' prefixes or ShopDrawing specific patterns are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "RUB-Raum instances (referenced in comments for defining outer contour)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Environment",
          "requiredSettings": [
            "AdjustableSupport.xml"
          ]
        }
      },
      "tokens_used": 7860,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10086,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates a layout of adjustable support feet (screw jacks) within a floor contour, arranging them according to primary and secondary grids and controlling their visual representation.",
          "category": "Hardware/Layout",
          "typicalUseCase": "Placing adjustable feet under a floor slab or cassette to support it on site, specifically allowing for complex grid arrangements or boundary constraints defined by a room contour."
        },
        "parameters": [
          {
            "name": "dLevel",
            "technicalDefault": "300",
            "businessMeaning": "The total vertical construction height or level of the floor system that the supports are holding up.",
            "validRange": "100 - 1000",
            "unit": "mm",
            "affectsOutput": "Defines the vertical position (Z-height) of the support symbols and the floor plane relative to the insertion point."
          },
          {
            "name": "dThicknessTop",
            "technicalDefault": "20",
            "businessMeaning": "Thickness of the top insulation layer within the floor assembly.",
            "validRange": "10 - 200",
            "unit": "mm",
            "affectsOutput": "Adjusts internal geometry calculations for the floor cross-section composition."
          },
          {
            "name": "dGridX",
            "technicalDefault": "600",
            "businessMeaning": "The spacing distance between support feet along the X-axis for the primary (main) grid.",
            "validRange": "300 - 1200",
            "unit": "mm",
            "affectsOutput": "Determines the placement interval of adjustable feet along the local X direction."
          },
          {
            "name": "dGridY",
            "technicalDefault": "600",
            "businessMeaning": "The spacing distance between support feet along the Y-axis for the primary (main) grid.",
            "validRange": "300 - 1200",
            "unit": "mm",
            "affectsOutput": "Determines the placement interval of adjustable feet along the local Y direction."
          },
          {
            "name": "dOffsetX",
            "technicalDefault": "0",
            "businessMeaning": "The horizontal offset from the origin for the start of the primary grid along the X-axis.",
            "validRange": "0 - Max Grid Spacing",
            "unit": "mm",
            "affectsOutput": "Shifts the rows of supports left or right."
          },
          {
            "name": "dOffsetY",
            "technicalDefault": "0",
            "businessMeaning": "The horizontal offset from the origin for the start of the primary grid along the Y-axis.",
            "validRange": "0 - Max Grid Spacing",
            "unit": "mm",
            "affectsOutput": "Shifts the rows of supports forward or backward."
          },
          {
            "name": "dGridXhelp",
            "technicalDefault": "300",
            "businessMeaning": "The spacing distance between support feet along the X-axis for the secondary (helper) grid, used for additional support or edges.",
            "validRange": "150 - 600",
            "unit": "mm",
            "affectsOutput": "Defines the interval of the secondary grid points."
          },
          {
            "name": "dGridYhelp",
            "technicalDefault": "300",
            "businessMeaning": "The spacing distance between support feet along the Y-axis for the secondary (helper) grid.",
            "validRange": "150 - 600",
            "unit": "mm",
            "affectsOutput": "Defines the interval of the secondary grid points."
          },
          {
            "name": "dOffsetXhelp",
            "technicalDefault": "0",
            "businessMeaning": "The horizontal offset for the secondary grid along the X-axis.",
            "validRange": "0 - Max Helper Grid Spacing",
            "unit": "mm",
            "affectsOutput": "Shifts the secondary grid rows left or right."
          },
          {
            "name": "dOffsetYhelp",
            "technicalDefault": "0",
            "businessMeaning": "The horizontal offset for the secondary grid along the Y-axis.",
            "validRange": "0 - Max Helper Grid Spacing",
            "unit": "mm",
            "affectsOutput": "Shifts the secondary grid rows forward or backward."
          },
          {
            "name": "sDisplayGridHelp",
            "technicalDefault": "No",
            "businessMeaning": "Toggles the visibility of the secondary (helper) grid points/lines.",
            "validRange": "Yes/No",
            "unit": "Boolean",
            "affectsOutput": "Controls whether the secondary grid geometry is drawn in the model view."
          },
          {
            "name": "sFootCreateHelp",
            "technicalDefault": "No",
            "businessMeaning": "Determines if physical support feet (or their symbols) are actually placed at the secondary grid intersections.",
            "validRange": "Yes/No",
            "unit": "Boolean",
            "affectsOutput": "If 'Yes', generates support symbols/geometry at the secondary grid locations."
          },
          {
            "name": "dThicknessSeal",
            "technicalDefault": "10",
            "businessMeaning": "Thickness of the sealing layer (e.g., bitumen sheet) in the floor build-up.",
            "validRange": "2 - 30",
            "unit": "mm",
            "affectsOutput": "Used for internal calculation of the floor stack height."
          },
          {
            "name": "sSymbolFoot",
            "technicalDefault": "No",
            "businessMeaning": "Toggles the display of the graphical symbol representing the adjustable foot.",
            "validRange": "Yes/No",
            "unit": "Boolean",
            "affectsOutput": "Hides or shows the 2D/3D representation of the support foot."
          },
          {
            "name": "sTextFoot",
            "technicalDefault": "No",
            "businessMeaning": "Toggles the display of text labels associated with the support feet (e.g., height or ID).",
            "validRange": "Yes/No",
            "unit": "Boolean",
            "affectsOutput": "Hides or shows annotation text near the foot symbols."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing Primary Grid settings (dGridX, dGridY, dOffsetX, dOffsetY)",
            "effect": "Resets all manually added or deleted points, reverting to the standard grid calculation.",
            "cascade": [
              "ptsAll",
              "ptsDeleted",
              "ptsAdded"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Point/Vector Geometry",
            "description": "Representation of adjustable support feet locations calculated via grid intersection or manual placement.",
            "appliedTo": "Model Space (Floor Plan)"
          },
          {
            "type": "Annotation/Text",
            "description": "Text labels for the feet (if enabled).",
            "appliedTo": "Model Space"
          },
          {
            "type": "Visual Grid Lines",
            "description": "Construction lines showing the primary and secondary grid layout.",
            "appliedTo": "Model Space"
          }
        ]
      },
      "tokens_used": 8712,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Initialization",
          "Load Settings (AdjustableSupport.xml) from Company or Install path",
          "Validate Settings Version (if _bOnDbCreated)",
          "Define Properties (PropDouble, PropString) for dimensions and visibility",
          "Execute Insert Logic (if _bOnInsert)",
          "Calculate Contour: Derive outer boundary from underlying 'RUB-Raum' instances",
          "Generate Primary Grid: Calculate points based on X/Y spacing and offsets",
          "Generate Secondary Grid: Calculate points based on helper X/Y spacing and offsets (if applicable)",
          "Filter Points: Remove points outside the derived contour",
          "Check for Manual Modifications: Retrieve previously added/deleted points from _Map",
          "Apply Manual Overrides: Merge calculated grid with manual additions and subtractions",
          "Draw Geometry: Create symbols, text, and grid lines based on display properties",
          "Finalize: Write point arrays back to _Map if modified"
        ],
        "conditionalBranches": [
          {
            "condition": "Primary Grid Properties Changed (dGridX, dGridY, dOffsetX, dOffsetY)",
            "path1": {
              "name": "Reset Points",
              "steps": [
                "Clear 'ptsAll', 'ptsDeleted', 'ptsAdded' from _Map",
                "Force Recalculation (Loop 2)",
                "Regenerate Grid from scratch"
              ]
            },
            "path2": {
              "name": "Standard Update",
              "steps": [
                "Recalculate geometry",
                "Preserve existing manual point modifications"
              ]
            }
          },
          {
            "condition": "User executes 'Add/Delete Point' Context Menu Command",
            "path1": {
              "name": "Insert Mode",
              "steps": [
                "User selects location within contour",
                "Validate point is not duplicate (dist < 100mm)",
                "Add to 'ptsAdded' and 'ptsAll' lists",
                "If point was previously deleted, remove from 'ptsDeleted' instead",
                "Update Dummy TSL instance for visualization"
              ]
            },
            "path2": {
              "name": "Delete Mode",
              "steps": [
                "User selects existing point",
                "Find closest point within tolerance",
                "Remove point from 'ptsAll'",
                "Check if point was previously manually added",
                "If yes, remove from 'ptsAdded'",
                "If no (was default), add to 'ptsDeleted'",
                "Update Dummy TSL instance"
              ]
            }
          },
          {
            "condition": "User executes 'Reset Points' Context Menu Command",
            "path1": {
              "name": "Execute Reset",
              "steps": [
                "Clear 'ptsAll', 'ptsDeleted', 'ptsAdded' from _Map",
                "Force Recalculation (Loop 2)",
                "Restore pure grid layout"
              ]
            }
          },
          {
            "condition": "Inserting Point during Add/Delete Trigger",
            "path1": {
              "name": "Point Inside Contour",
              "steps": [
                "Proceed with adding point"
              ]
            },
            "path2": {
              "name": "Point Outside Contour or Invalid Intersection",
              "steps": [
                "Find closest vertex of the contour polyline",
                "Snap insertion point to that vertex"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Availability of 'RUB-Raum' instances or contour geometry",
            "errorMessage": "Unexpected: No vertex points",
            "recovery": "Script will erase instance and report error if no contour points are found during Jig or initialization."
          },
          {
            "check": "Settings File Version Compatibility",
            "errorMessage": "Notice displayed if XML version differs from installed instance version",
            "recovery": "User notified but script continues; manual update of XML may be required."
          },
          {
            "check": "Duplicate Point Prevention (Manual Add)",
            "errorMessage": "None (Silent rejection)",
            "recovery": "If new point is within 100mm of existing point in 'ptsAll', the addition is ignored."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Grid Layout",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing spacing or offsets triggers a reset of all points to the new default grid, discarding manual changes."
          },
          {
            "action": "Add/Remove Individual Support Feet",
            "how": "Right-click Context Menu -> 'Add/Delete Point'",
            "effect": "Opens an interactive Jig session allowing user to click to add points or click to remove points. Manual changes are persisted."
          },
          {
            "action": "Reset Manual Changes",
            "how": "Right-click Context Menu -> 'Reset Points'",
            "effect": "Removes all manually added points and restores all manually deleted points, reverting to the property-defined grid."
          },
          {
            "action": "Toggle Visibility",
            "how": "OPM (Properties Palette -> 'Darstellung AdjustableSupport' or 'Hilfsraster')",
            "effect": "Immediately hides or shows the helper grid, foot symbols, or text labels without changing geometry."
          }
        ]
      },
      "tokens_used": 9364,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# AdjustableSupport\n\n## Overview\nThis script automatically generates a layout of adjustable support feet (screw jacks) within a floor contour. It calculates placement based on configurable primary and secondary grids, allows for manual adjustments, and visualizes the support structure.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be inserted in the 3D model environment. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities:** The script relies on underlying \"RUB-Raum\" instances to define the outer boundary/contour of the floor.\n- **Minimum Beams:** None.\n- **Required Settings:** `AdjustableSupport.xml` (must be present in the Company or Install path).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `AdjustableSupport.mcr`\n\n### Step 2: Define Origin\n```\nCommand Line: Insertion point:\nAction: Click in the drawing to place the script instance. \nNote: The script will attempt to detect the floor contour based on the location relative to \"RUB-Raum\" instances.\n```\n\n### Step 3: Configure Grid\n```\nAction: Select the script instance and open the Properties Palette (Ctrl+1).\nAction: Adjust `Grid Spacing X` and `Grid Spacing Y` to define the main layout of the supports.\nResult: The script automatically populates the area with support points based on the grid.\n```\n\n### Step 4: Manual Adjustments (Optional)\n```\nAction: Right-click the script instance.\nAction: Select \"Add Point\" to manually place extra supports or \"Delete Point\" to remove specific ones.\nAction: Follow the command line prompts to select locations.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Floor Construction** | | | |\n| dLevel | Number | 300 | The total vertical construction height (Z-level) of the floor system. |\n| dThicknessTop | Number | 20 | Thickness of the top insulation layer within the floor assembly. |\n| dThicknessSeal | Number | 10 | Thickness of the sealing layer (e.g., bitumen sheet). |\n| **Primary Grid** | | | |\n| dGridX | Number | 600 | Spacing between support feet along the X-axis (Main Grid). |\n| dGridY | Number | 600 | Spacing between support feet along the Y-axis (Main Grid). |\n| dOffsetX | Number | 0 | Horizontal offset for the start of the grid along the X-axis. |\n| dOffsetY | Number | 0 | Horizontal offset for the start of the grid along the Y-axis. |\n| **Secondary (Helper) Grid** | | | |\n| dGridXhelp | Number | 300 | Spacing for the secondary grid along the X-axis. |\n| dGridYhelp | Number | 300 | Spacing for the secondary grid along the Y-axis. |\n| dOffsetXhelp | Number | 0 | Horizontal offset for the secondary grid along the X-axis. |\n| dOffsetYhelp | Number | 0 | Horizontal offset for the secondary grid along the Y-axis. |\n| sDisplayGridHelp | Yes/No | No | Toggle visibility of the secondary grid lines/points. |\n| sFootCreateHelp | Yes/No | No | If \"Yes\", creates physical support feet at the secondary grid locations. |\n| **Visual Settings** | | | |\n| sSymbolFoot | Yes/No | No | Toggle the display of the support foot symbol. |\n| sTextFoot | Yes/No | No | Toggle the display of text labels (e.g., height/ID) next to feet. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Add Point** | Enters a mode where you can click anywhere in the contour to add a single support foot. |\n| **Delete Point** | Enters a mode where you can click on existing support points to remove them. |\n| **Reset Points** | Clears all manual additions and deletions, reverting the layout to the standard grid defined in the properties. |\n\n## Settings Files\n- **Filename**: `AdjustableSupport.xml`\n- **Location**: Company or Install path\n- **Purpose**: Stores default values and configuration data for the script parameters.\n\n## Tips\n- **Resetting Layout:** Changing Primary Grid properties (Grid X/Y or Offsets) in the Properties Palette will automatically reset all points, deleting any manual additions or deletions you have made. Adjust the grid first, then add points manually.\n- **Contour Detection:** Ensure \"RUB-Raum\" instances are drawn correctly. If the script displays \"Unexpected: No vertex points,\" check that the room boundary exists at the insertion location.\n- **Secondary Grid:** Use the Secondary Grid (Helper) for tighter spacing at edges or specific zones without changing the overall main layout.\n- **Visuals:** Turn off `sSymbolFoot` and `sTextFoot` if you only need to see the grid layout for planning purposes, to reduce screen clutter.\n\n## FAQ\n- **Q: Why did my manually added points disappear?**\n  **A:** You likely changed a Primary Grid parameter (like `dGridX` or `dGridY`). Modifying these forces a full recalculation of the grid, which overrides manual edits. Use the \"Reset Points\" command first to clear the grid, change settings, and then re-add points.\n- **Q: Can I place a point outside the room contour?**\n  **A:** No, the script restricts point placement to the inside of the detected contour. If you click outside, the script will attempt to snap the point to the nearest contour edge vertex.\n- **Q: What is the Secondary Grid used for?**\n  **A:** It is used for additional support requirements, such as smaller areas under the floor or edge reinforcement. Enable `sFootCreateHelp` to actually generate supports at these locations, otherwise they may just act as visual guides if `sDisplayGridHelp` is on."
      },
      "tokens_used": 6353,
      "error": null
    }
  }
}