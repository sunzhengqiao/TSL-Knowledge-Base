{
  "filename": "sdUK_ShowSIPEdgeDetails.mcr",
  "status": "completed",
  "total_tokens": 50457,
  "processing_time": 509.66139245033264,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 5,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.5",
            "date": "05.08.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-12767 bugfix outlines"
          },
          {
            "version": "1.4",
            "date": "03.08.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-12767 bugfix dimlines"
          },
          {
            "version": "1.0",
            "date": "13.07.2012",
            "author": "Chirag Sawjani",
            "changes": "Release"
          },
          {
            "version": "1.1",
            "date": "07.08.2014",
            "author": "Chirag Sawjani",
            "changes": "Made angle output consistent with other panel CNC output"
          },
          {
            "version": "1.2",
            "date": "11.06.2015",
            "author": "Chirag Sawjani",
            "changes": "Altered vectors to suit new coordsys, valid from 19.1.104"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7874,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "Both",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "Filename prefix 'sd_', PropString sSpace allows selection between 'Model' and 'shopdraw multipage', usage of getShopDrawView() and ViewData.findDataForViewport(), explicit logic handling sShopdrawSpace with CoordSys transforms (ms2ps)."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip",
            "ShopDrawView"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space or Shopdraw Layout",
          "requiredSettings": [
            "DimStyles"
          ]
        }
      },
      "tokens_used": 7419,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Pick a point for edge details|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrEntity",
              "promptOriginal": "|Please select Elements|",
              "condition": "_bOnInsert && (sSpace == sModel)",
              "required": true
            },
            {
              "step": 3,
              "function": "getShopDrawView",
              "promptOriginal": "|Select the view entity from which the module is taken|",
              "condition": "_bOnInsert && (sSpace == sShopdrawSpace)",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSpace",
            "type": "PropString",
            "displayName": "|Drawing space|",
            "defaultValue": "|Model|",
            "inputType": "dropdown",
            "options": [
              "|Model|",
              "|shopdraw multipage|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimLayout",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nDetailColor",
            "type": "PropInt",
            "displayName": "|Detail Color|",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nTextColor",
            "type": "PropInt",
            "displayName": "|Text Color|",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "nMaxRows",
            "type": "PropInt",
            "displayName": "|Maximum Number of Rows|",
            "defaultValue": "5",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dDimOffset",
            "type": "PropDouble",
            "displayName": "|Dimensions offset|",
            "defaultValue": "50.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dExtraOffset",
            "type": "PropDouble",
            "displayName": "|Extra offset between details|",
            "defaultValue": "200.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9949,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates detailed 2D cross-section views of Structural Insulated Panel (SIP) edges, displaying component layers, dimensions, bevel angles, and recess depths.",
          "category": "ShopDrawing / Annotation",
          "typicalUseCase": "Creating detailed manufacturing drawings or assembly notes showing the specific construction of each edge of a SIP panel (e.g., how the spline or rebate is formed)."
        },
        "parameters": [
          {
            "name": "sSpace",
            "technicalDefault": "|Model|",
            "businessMeaning": "Specifies the environment where the details are generated. 'Model' draws details on the 3D object; 'shopdraw multipage' arranges them in a grid on a 2D layout.",
            "validRange": "[\"|Model|\", \"|shopdraw multipage|\"]",
            "unit": "Selection",
            "affectsOutput": "Determines if details are drawn in 3D coordinates or transformed to 2D Paper Space coordinates with automatic grid layout."
          },
          {
            "name": "sDimLayout",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Selects the specific dimension style (text height, arrow style, units) to be used for all measurements.",
            "validRange": "Any valid DimStyle name in the drawing",
            "unit": "String",
            "affectsOutput": "The visual appearance and scale of the dimension lines and text."
          },
          {
            "name": "nDetailColor",
            "technicalDefault": "1",
            "businessMeaning": "Sets the CAD color index for the geometry lines representing the SIP cross-section.",
            "validRange": "0-255",
            "unit": "AutoCAD Color Index",
            "affectsOutput": "The color of the polylines showing the timber and insulation layers."
          },
          {
            "name": "nTextColor",
            "technicalDefault": "0",
            "businessMeaning": "Sets the CAD color index for the textual annotations (labels for Bevel Angle, Recess Depth, etc.).",
            "validRange": "0-255",
            "unit": "AutoCAD Color Index",
            "affectsOutput": "The color of the text labels."
          },
          {
            "name": "nMaxRows",
            "technicalDefault": "5",
            "businessMeaning": "Controls the layout grid in shop drawings; the number of edge details stacked vertically before starting a new column.",
            "validRange": "1-20",
            "unit": "Count",
            "affectsOutput": "The arrangement of details on the page (height vs width of the detail block)."
          },
          {
            "name": "dDimOffset",
            "technicalDefault": "50.0",
            "businessMeaning": "The distance between the edge profile geometry and the dimension lines.",
            "validRange": "10-200 mm",
            "unit": "mm",
            "affectsOutput": "The gap between the drawing of the SIP edge and the numbers indicating its size."
          },
          {
            "name": "dExtraOffset",
            "technicalDefault": "200.0",
            "businessMeaning": "The additional buffer distance used to mask/crop the main panel body, isolating just the specific edge detail.",
            "validRange": "50-500 mm",
            "unit": "mm",
            "affectsOutput": "Determines how much 'blank space' is left between the detailed edge profile and the cut-off line of the rest of the panel."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sSpace == '|shopdraw multipage|'",
            "effect": "Activates layout logic using 'nMaxRows' to calculate column offsets and disables direct 3D placement.",
            "cascade": [
              "nMaxRows",
              "dExtraOffset"
            ]
          },
          {
            "trigger": "nMaxRows count reached",
            "effect": "Resets vertical row counter and increments horizontal column offset.",
            "cascade": [
              "dNewDetailVertOffset",
              "dNewDetailHorizOffset"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Graphical Annotation",
            "description": "2D Polylines representing the SIP cross-section, Dimensions, and Text labels.",
            "appliedTo": "Selected SIP Elements"
          }
        ]
      },
      "tokens_used": 9044,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Execution/Insertion triggered",
          "2. Properties initialized (sSpace, sDimLayout, colors, offsets)",
          "3. Conditional: Check _bOnInsert flag",
          "   3a. Display Dialog",
          "   3b. Prompt user for insertion point (_Pt0)",
          "   3c. Check Property 'sSpace'",
          "       Path A (Model): Prompt to select SIP Elements (PrEntity)",
          "       Path B (Shopdraw): Prompt to select ShopDrawView entity",
          "   3d. Save entity to _Entity array and exit",
          "4. Calculation Phase",
          "   4a. Setup Display and DimStyles",
          "   4b. Check _Entity array content",
          "   4c. Check Property 'sSpace' for Source Data",
          "       Path A (Model): Assign _Entity[0] to sipCurr directly",
          "       Path B (Shopdraw): Extract ViewData, match Viewport, get CoordSys (ms2ps), find SIP entity",
          "   4d. Derive SIP Vectors (vx, vy, vz) and extract Bodies (Components/Envelope)",
          "   4e. Iterate through all SIP Edges",
          "5. Per-Edge Detail Loop",
          "   5a. Calculate Edge geometry (Midpoint, Normal, Vertex Vector)",
          "   5b. Create geometric Slice at Edge Midpoint",
          "   5c. Process Slice (Intersect, Shrink, Clean up rings) to isolate profile",
          "   5d. Create Clipping Rectangle to mask main panel",
          "   5e. Calculate Bevel Angle and format string",
          "   5f. Calculate Recess Depth and format string",
          "   5g. Generate Dimension Lines (Horizontal & Vertical)",
          "   5h. Check Property 'sSpace' for Output",
          "       Path A (Model): Draw dimensions at 3D location",
          "       Path B (Shopdraw): Calculate Grid Position (Row/Col), Transform geometry to 2D Paper Space, Draw Dimensions & Text Labels, Increment counters"
        ],
        "conditionalBranches": [
          {
            "condition": "User Input Phase: Property 'sSpace' selection",
            "path1": {
              "name": "Model Space",
              "steps": [
                "Prompt: Select Elements (SIPs)",
                "Assign selection to sipCurr",
                "Draw details at 3D coordinates"
              ]
            },
            "path2": {
              "name": "Shopdraw Multipage",
              "steps": [
                "Prompt: Select ShopDrawView",
                "Resolve SIP from ViewData mapping",
                "Calculate ms2ps transform",
                "Layout details in 2D Grid"
              ]
            }
          },
          {
            "condition": "Bevel Angle Calculation",
            "path1": {
              "name": "Angle > 90 and <= 180",
              "steps": [
                "Calculate Q1 Angle: 90 - abs(dBevelAngle - 180)"
              ]
            },
            "path2": {
              "name": "Angle <= 90",
              "steps": [
                "Calculate Q1 Angle: 90 - abs(dBevelAngle)"
              ]
            }
          },
          {
            "condition": "Vertical Dimension Direction",
            "path1": {
              "name": "Normal Vector pointing 'down' (dotProduct < 0)",
              "steps": [
                "Locate dimension line below the slice"
              ]
            },
            "path2": {
              "name": "Normal Vector pointing 'up' (dotProduct >= 0)",
              "steps": [
                "Locate dimension line above the slice"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Property Range (nDetailColor, nTextColor)",
            "errorMessage": "None (Silent reset)",
            "recovery": "Script automatically resets invalid values to 0"
          },
          {
            "check": "Entity Selection",
            "errorMessage": "None (Silent exit)",
            "recovery": "User must insert script again and select valid entities"
          },
          {
            "check": "Shopdraw View Data Mapping",
            "errorMessage": "None (Silent exit)",
            "recovery": "User must ensure valid ShopdrawView and ViewData exist"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Appearance",
            "how": "OPM Properties",
            "effect": "Changing sSpace, sDimLayout, nDetailColor, or nTextColor updates the drawing style, colors, and immediately redraws the details."
          },
          {
            "action": "Adjust Layout Spacing",
            "how": "OPM Properties",
            "effect": "Changing nMaxRows, dDimOffset, or dExtraOffset recalculates the grid layout and spacing between edge details."
          },
          {
            "action": "Move Detail Group",
            "how": "Grip Edit (Move)",
            "effect": "Moving the insertion point (_Pt0) relocates the detail block (in Model) or the grid origin (in Shopdraw)."
          }
        ]
      },
      "tokens_used": 9691,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# sdUK_ShowSIPEdgeDetails.mcr\n\n## Overview\nThis script automatically generates detailed 2D cross-sections for Structural Insulated Panel (SIP) edges. It displays the layered construction, dimensions, bevel angles, and recess depths directly in your drawing layout to assist with manufacturing and assembly.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Details are generated at the 3D location of the panel. |\n| Paper Space | Yes | Used in conjunction with the \"shopdraw multipage\" mode to place details in a grid on the layout. |\n| Shop Drawing | Yes | Specifically designed to work with Shopdraw Viewports. |\n\n## Prerequisites\n- **Required entities**: Structural Insulated Panels (SIP).\n- **Minimum beam count**: 1 SIP panel.\n- **Required settings**: Valid AutoCAD Dimension Styles must exist in the drawing.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `sdUK_ShowSIPEdgeDetails.mcr`\n\n### Step 2: Configure Settings\n- A dialog box appears automatically upon insertion.\n- Set your preferred Drawing Space, Dimensions, and Colors.\n- Click OK to proceed.\n\n### Step 3: Set Insertion Point\n```\nCommand Line: Pick a point for edge details\nAction: Click in the drawing area to set the origin for the detail block.\n```\n\n### Step 4: Select Elements\nThe next prompt depends on the **Drawing Space** setting selected in Step 2.\n\n*   **Option A: If set to 'Model'**\n    ```\n    Command Line: Please select Elements\n    Action: Select one or more SIP panels from the model.\n    ```\n\n*   **Option B: If set to 'shopdraw multipage'**\n    ```\n    Command Line: Select the view entity from which the module is taken\n    Action: Click on the Shopdraw Viewport border or the view entity representing the panel.\n    ```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Drawing space | dropdown | Model | Choose where to generate details: **Model** (3D) or **shopdraw multipage** (2D Layout). |\n| Dimstyle | dropdown | _DimStyles | Select the dimension style to control text size and arrow style. |\n| Detail Color | number | 1 | AutoCAD Color Index for the edge profile lines (Red). |\n| Text Color | number | 0 | AutoCAD Color Index for dimension and label text (White/ByBlock). |\n| Maximum Number of Rows | number | 5 | In Shopdraw mode, sets how many edge details stack vertically before starting a new column. |\n| Dimensions offset | number | 50.0 | Distance (mm) between the edge geometry and the dimension lines. |\n| Extra offset between details | number | 200.0 | Buffer distance (mm) used to crop the main panel body, isolating the specific edge detail. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None Specific) | This script relies on the standard AutoCAD Properties Palette for configuration. Select the script instance and press `Ctrl+1` to edit parameters. |\n\n## Settings Files\n- **Filename**: None (Script uses standard AutoCAD DimStyles).\n- **Location**: N/A\n- **Purpose**: The script references standard Dimension Styles available in the current drawing for formatting text and arrows.\n\n## Tips\n- **Layout Control**: When using **shopdraw multipage** mode, adjust the **Maximum Number of Rows** property. If your layout is Portrait, increase this number to use vertical space efficiently. If Landscape, decrease it to force columns to the right.\n- **Clipping**: If the edge details are overlapping too much with the main panel view, increase the **Extra offset between details** to create a larger \"blank\" buffer around the cross-section.\n- **Update Speed**: Changing the **Detail Color** or **Text Color** in the properties palette updates the drawing immediately without needing to delete and re-insert the script.\n\n## FAQ\n- **Q: Why are my dimensions showing as very small or huge?**\n  A: Check the **Dimstyle** property. Ensure the selected Dimension Style has the appropriate text height and scale set for your current drawing units.\n- **Q: Can I use this on standard timber beams?**\n  A: No, this script is specifically designed to read the layered composition of Structural Insulated Panels (SIPs).\n- **Q: The details appear in the wrong location in my shop drawing.**\n  A: Ensure you selected the correct **Shopdraw Viewport** during insertion. Moving the original insertion point (Step 3) will also shift the grid of details."
      },
      "tokens_used": 6480,
      "error": null
    }
  }
}