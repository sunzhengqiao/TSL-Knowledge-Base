{
  "filename": "Rothoblass ALU.mcr",
  "status": "completed",
  "total_tokens": 56953,
  "processing_time": 351.27033853530884,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9852,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script interacts with 3D geometric entities (GenBeam, Point3d, Body, Vector3d) and modifies beams using tools (Slot, House). It contains no 'sd_' prefixes, no '#Type E' declarations, no Multipage prefixes, and no references to _Viewport or drawing layout logic. The logic focuses on calculating 3D intersections, placing hardware, and modifying beam geometry, which are ModelSpace operations."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space with two beam elements (one male, one female) to connect.",
          "requiredSettings": [
            "Catalog entries (optional) for families MINI, MIDI, MAXI"
          ]
        }
      },
      "tokens_used": 6295,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getGenBeam",
              "promptOriginal": "Select one or multiple male beams",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getGenBeam",
              "promptOriginal": "Select a set of female beams",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 1,
            "variable": "sType",
            "type": "PropString",
            "displayName": "Type",
            "defaultValue": "Auto detect",
            "inputType": "dropdown",
            "options": [
              "Auto detect",
              "65",
              "95",
              "125",
              "155",
              "185"
            ],
            "category": null,
            "description": "Sets the type of the bracket."
          },
          {
            "index": 5,
            "variable": "sShankDrills",
            "type": "PropString",
            "displayName": "Shank Drills",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": "Distinguishes between brackets which have drills on the shank or not."
          },
          {
            "index": 3,
            "variable": "sMode",
            "type": "PropString",
            "displayName": "Connection Mode",
            "defaultValue": "Wood/Wood",
            "inputType": "dropdown",
            "options": [
              "Wood/Wood",
              "Wood/Concrete with Screw",
              "Wood/Concrete with chemical Dowel"
            ],
            "category": null,
            "description": "The different family types (AluMini, AluMidi, AluMaxi) are supporting various types of hardware which could be attached to the bracket."
          },
          {
            "index": 0,
            "variable": "dGapBetween",
            "type": "PropDouble",
            "displayName": "Gap between Beams",
            "defaultValue": "3.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dZOffset",
            "type": "PropDouble",
            "displayName": "Offset Z-Direction",
            "defaultValue": "0.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sHousing",
            "type": "PropString",
            "displayName": "Housing Type",
            "defaultValue": "Bottom",
            "inputType": "dropdown",
            "options": [
              "Bottom",
              "Centered",
              "Top",
              "None"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dGapHouse",
            "type": "PropDouble",
            "displayName": "   House gap",
            "defaultValue": "2.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Describes the gap around the metalpart of the housing"
          },
          {
            "index": 3,
            "variable": "dExtraHouseDepth",
            "type": "PropDouble",
            "displayName": "   Extra house depth",
            "defaultValue": "2.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Describes the additional depth of the beamcut"
          },
          {
            "index": 4,
            "variable": "sSlot",
            "type": "PropString",
            "displayName": "Slot",
            "defaultValue": "Top",
            "inputType": "dropdown",
            "options": [
              "Top",
              "Bottom",
              "Full height"
            ],
            "category": null,
            "description": "Describes the location of the slot"
          },
          {
            "index": 5,
            "variable": "dGapSlotX",
            "type": "PropDouble",
            "displayName": "   Gap (X)",
            "defaultValue": "20.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Describes the additional length of the slot"
          },
          {
            "index": 6,
            "variable": "dGapSlotY",
            "type": "PropDouble",
            "displayName": "   Gap (Y)",
            "defaultValue": "2.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Describes the additional width of the slot"
          },
          {
            "index": 7,
            "variable": "dGapSlotZ",
            "type": "PropDouble",
            "displayName": "   Gap (Z)",
            "defaultValue": "2.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Describes the additional depth of the slot"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "MINI",
            "handler": "MINI",
            "action": "Change family type to MINI and auto detect type.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "MIDI",
            "handler": "MIDI",
            "action": "Change family type to MIDI and auto detect type.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "MAXI",
            "handler": "MAXI",
            "action": "Change family type to MAXI and auto detect type.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Extend length to be cut from rod",
            "handler": "Extend length to be cut from rod",
            "action": "Extends the list of available types to maximum length of the available rod.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9286,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates and inserts Rothoblaas ALU connectors (AluMini, AluMidi, AluMaxi) for timber-to-timber or timber-to-concrete connections, including automatic machining and hardware assignment.",
          "category": "Hardware Connection",
          "typicalUseCase": "Creating structural connections between beams (e.g., beam-to-column, beam-to-beam) using Rothoblaas aluminum brackets, ensuring correct cuts and fastener counts."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "Auto detect",
            "businessMeaning": "Determines the height of the aluminum bracket. 'Auto detect' selects the largest possible bracket that fits the geometry.",
            "validRange": "Depends on Family (Mini: 65-185mm, Midi: 120-360mm, Maxi: 384-896mm)",
            "unit": "mm",
            "affectsOutput": "Changes the 3D size of the bracket and scales the number of fasteners required."
          },
          {
            "name": "sShankDrills",
            "technicalDefault": "No",
            "businessMeaning": "Indicates if the vertical shank of the bracket has holes for through-bolting/pins.",
            "validRange": "Yes, No",
            "unit": "boolean",
            "affectsOutput": "Switches the fastener type on the shank between 'Pin' (with drills) and 'Self-perforating pin' (without drills)."
          },
          {
            "name": "sMode",
            "technicalDefault": "Wood/Wood",
            "businessMeaning": "Defines the connection scenario, specifically how the female side is anchored (to wood or concrete).",
            "validRange": "Wood/Wood, Wood/Concrete with Screw, Wood/Concrete with chemical Dowel",
            "unit": "enum",
            "affectsOutput": "Changes the type of hardware assigned to the wing (nails vs screws/dowels) and the hole diameters."
          },
          {
            "name": "dGapBetween",
            "technicalDefault": "3.0",
            "businessMeaning": "The spacing distance maintained between the end of the male beam and the face of the female beam.",
            "validRange": "0.0 - 50.0",
            "unit": "mm",
            "affectsOutput": "Offsets the position of the male beam relative to the female beam."
          },
          {
            "name": "dZOffset",
            "technicalDefault": "0.0",
            "businessMeaning": "Vertical adjustment of the entire connector assembly relative to the beam's local Z-axis.",
            "validRange": "-100.0 - 100.0",
            "unit": "mm",
            "affectsOutput": "Moves the bracket and its cuts up or down along the beam height."
          },
          {
            "name": "sHousing",
            "technicalDefault": "Bottom",
            "businessMeaning": "Specifies the vertical position of the pocket cut into the female beam to accommodate the bracket thickness.",
            "validRange": "Bottom, Centered, Top, None",
            "unit": "enum",
            "affectsOutput": "Creates a 'House' (pocket) operation in the female beam. 'None' places the bracket on the surface."
          },
          {
            "name": "dGapHouse",
            "technicalDefault": "2.0",
            "businessMeaning": "Tolerance clearance added to the width and height of the pocket cut.",
            "validRange": "1.0 - 10.0",
            "unit": "mm",
            "affectsOutput": "Enlarges the pocket dimensions to ensure the bracket fits without force."
          },
          {
            "name": "dExtraHouseDepth",
            "technicalDefault": "2.0",
            "businessMeaning": "Additional depth of the pocket cut beyond the thickness of the bracket.",
            "validRange": "0.0 - 10.0",
            "unit": "mm",
            "affectsOutput": "Deepens the pocket into the female beam."
          },
          {
            "name": "sSlot",
            "technicalDefault": "Top",
            "businessMeaning": "Determines if the male beam receives a slot cut for the connector shank, and where it is positioned vertically.",
            "validRange": "Top, Bottom, Full height",
            "unit": "enum",
            "affectsOutput": "Creates a 'Slot' operation in the male beam. 'Full height' cuts through the entire beam depth."
          },
          {
            "name": "dGapSlotX",
            "technicalDefault": "20.0",
            "businessMeaning": "Extra length added to the slot cut in the male beam.",
            "validRange": "0.0 - 100.0",
            "unit": "mm",
            "affectsOutput": "Lengthens the slot along the beam's axis."
          },
          {
            "name": "dGapSlotY",
            "technicalDefault": "2.0",
            "businessMeaning": "Extra width added to the slot cut in the male beam.",
            "validRange": "0.0 - 10.0",
            "unit": "mm",
            "affectsOutput": "Widens the slot perpendicular to the beam's axis."
          },
          {
            "name": "dGapSlotZ",
            "technicalDefault": "2.0",
            "businessMeaning": "Extra depth added to the slot cut in the male beam.",
            "validRange": "0.0 - 10.0",
            "unit": "mm",
            "affectsOutput": "Deepens the slot vertically."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change of Family (via MINI/MIDI/MAXI command)",
            "effect": "Resets the valid 'sType' ranges (heights) and modifies geometry arrays (width/thickness).",
            "cascade": [
              "sType",
              "sMode"
            ]
          },
          {
            "trigger": "sHousing set to 'None'",
            "effect": "Disables the creation of the pocket cut.",
            "cascade": [
              "dGapHouse",
              "dExtraHouseDepth"
            ]
          },
          {
            "trigger": "sMode set to 'Wood/Concrete'",
            "effect": "Switches fasteners from nails to screws or chemical dowels.",
            "cascade": [
              "Hardware List",
              "Drilling patterns"
            ]
          },
          {
            "trigger": "sType height change",
            "effect": "Calculates new quantities of fasteners based on the size of the bracket.",
            "cascade": [
              "Hardware Count"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Model (Body)",
            "description": "The visual representation of the Aluminum bracket.",
            "appliedTo": "Script Instance"
          },
          {
            "type": "House (Pocket)",
            "description": "A routed recess in the female beam to fit the bracket wing.",
            "appliedTo": "Female Beam"
          },
          {
            "type": "Slot",
            "description": "A rectangular cut in the male beam to accommodate the bracket shank.",
            "appliedTo": "Male Beam"
          },
          {
            "type": "Hardware",
            "description": "BOM entries for the bracket and fasteners (Nails, Pins, Dowels).",
            "appliedTo": "Script Instance"
          },
          {
            "type": "Drills/Operations",
            "description": "Drilling points for the specified fasteners.",
            "appliedTo": "Male and Female Beams"
          }
        ]
      },
      "tokens_used": 10881,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Check Map/ExecuteKey for Family (MINI, MIDI, MAXI).",
          "2. Set Default Family to MIDI if no preset is found.",
          "3. Load Geometric Data (thickness, height limits) for the active Family.",
          "4. Generate List of valid Bracket Heights (sType) based on standard rod lengths or extended rod lengths (if flag set).",
          "5. [On Insert] Prompt user to select Male Beams (Shank side).",
          "6. [On Insert] Prompt user to select Female Beams (Wing side).",
          "7. Determine final Bracket Height (Auto-detect based on geometry or user selection from OPM).",
          "8. Calculate 3D Coordinates and Vector System (Reference point, Local X/Y/Z).",
          "9. Generate Bracket Body (3D Model).",
          "10. Apply Slot Machining to Male Beam (Calculated based on sSlot and Gaps).",
          "11. Apply Housing Machining to Female Beam (Calculated based on sHousing and Gaps).",
          "12. Determine and Assign Shank Hardware (Pin vs Self-perforating based on sShankDrills).",
          "13. Determine and Assign Wing Hardware (Branch based on sMode and Female Beam orientation).",
          "14. Draw Model and Output Hardware to BOM."
        ],
        "conditionalBranches": [
          {
            "condition": "Source of Family Selection",
            "path1": {
              "name": "Execute Key / Catalog",
              "steps": [
                "Check '_kExecuteKey' for 'MINI', 'MIDI', or 'MAXI' substring.",
                "Set Family to match Key."
              ]
            },
            "path2": {
              "name": "Map Recalc / Default",
              "steps": [
                "Check internal '_Map' for stored Family.",
                "If missing, default to 'MIDI'."
              ]
            }
          },
          {
            "condition": "Shank Hardware Configuration (sShankDrills)",
            "path1": {
              "name": "Yes (Drills)",
              "steps": [
                "Use Fixing array index 3 (Pin).",
                "Calculate Peg length based on Male Beam width.",
                "Apply hardware quantity based on Bracket Type increment."
              ]
            },
            "path2": {
              "name": "No (No Drills)",
              "steps": [
                "Use Fixing array index 4 (Self-perforating pin).",
                "Calculate Peg length based on Male Beam width minus 7mm.",
                "Apply hardware quantity based on Bracket Type increment."
              ]
            }
          },
          {
            "condition": "Wing Connection Mode (sMode)",
            "path1": {
              "name": "Wood/Wood",
              "steps": [
                "Check if Female Beam is vertical (Pillar).",
                "If Pillar: Apply 'Partial Nailing' (reduced quantity).",
                "If Beam: Apply 'Total Nailing' (full quantity).",
                "Use Fixing array index 1 (HBS+ Screw / Anker nail)."
              ]
            },
            "path2": {
              "name": "Wood/Concrete",
              "steps": [
                "Check if Family is MIDI and Mode is 'With Screw'.",
                "If Midi Screw: Use 'Screw-in anchor'.",
                "Else: Use 'Chemical dowel' (Fixing array index 2).",
                "Calculate length based on pre-defined array (dArLengthNail2)."
              ]
            }
          },
          {
            "condition": "Housing Type (sHousing)",
            "path1": {
              "name": "None",
              "steps": [
                "Skip House tool creation.",
                "Ignore Gap House and Extra House Depth parameters."
              ]
            },
            "path2": {
              "name": "Bottom, Centered, or Top",
              "steps": [
                "Create House tool in Female Beam.",
                "Adjust origin point (Bottom: -Z, Top: +Z, Centered: 0).",
                "Apply dimensions including Gap House and Extra House Depth."
              ]
            }
          },
          {
            "condition": "Slot Type (sSlot)",
            "path1": {
              "name": "Full height",
              "steps": [
                "Set Slot Depth to 110% of Male Beam depth (dD(vz))."
              ]
            },
            "path2": {
              "name": "Top or Bottom",
              "steps": [
                "Calculate Slot Depth based on Bracket Height + Z Offset + Gap Slot Z."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection",
            "errorMessage": "User must select at least one Male and one Female beam.",
            "recovery": "Script prompts selection again automatically."
          },
          {
            "check": "Geometric Fit",
            "errorMessage": "Bracket height or width exceeds beam dimensions.",
            "recovery": "Script may still place geometry, but machining will be invalid. User should reduce Type size or increase Z offset."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Bracket Family",
            "how": "Context Menu (Right-click) -> Select 'MINI', 'MIDI', or 'MAXI'",
            "effect": "Script recalculates geometry, resets available Types (Heights), and updates OPM properties."
          },
          {
            "action": "Extend Available Types",
            "how": "Context Menu -> 'Extend length to be cut from rod'",
            "effect": "Expands the 'Type' dropdown to include custom lengths up to the max rod length (e.g., up to 2200mm for MIDI)."
          },
          {
            "action": "Modify Dimensions",
            "how": "Properties Palette (OPM)",
            "effect": "Changing 'Gap', 'Offset', 'Housing', or 'Slot' parameters immediately regenerates machining and model position."
          },
          {
            "action": "Change Hardware Mode",
            "how": "Properties Palette -> 'Connection Mode' or 'Shank Drills'",
            "effect": "Updates BOM quantities and fastener types (e.g., switching from Nails to Chemical Dowels)."
          }
        ]
      },
      "tokens_used": 12722,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Rothoblass ALU\n\n## Overview\nGenerates and inserts Rothoblaas ALU connectors (AluMini, AluMidi, AluMaxi) for timber-to-timber or timber-to-concrete connections. The script automatically handles the creation of 3D brackets, beam machining (slots and housings), and hardware assignment (nails, screws, and dowels).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D beams and geometry. |\n| Paper Space | No | Not designed for 2D layout views. |\n| Shop Drawing | No | Does not generate dimensions or labels for drawings. |\n\n## Prerequisites\n- **Required Entities:** At least two `GenBeam` elements.\n- **Minimum Beam Count:** 1 Male beam (shank side) and 1 Female beam (wing side).\n- **Required Settings:** None (Catalog entries for families MINI, MIDI, MAXI are optional but recommended).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Rothoblass ALU.mcr`\n\n### Step 2: Select Male Beams\n```\nCommand Line: Select one or multiple male beams\nAction: Click the beam(s) that will connect into the side of the other beam (the side receiving the connector \"shank\").\n```\n\n### Step 3: Select Female Beams\n```\nCommand Line: Select a set of female beams\nAction: Click the beam(s) that will receive the connection on their face (the side receiving the connector \"wing\").\n```\n\n### Step 4: Configure Properties\nAfter selection, the script inserts the connector. Select the script instance in the model to open the **Properties Palette** and adjust dimensions, modes, and machining gaps as needed.\n\n## Properties Panel Parameters\n\n### Connection Settings\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | dropdown | Auto detect | Sets the height of the bracket. \"Auto detect\" picks the largest size that fits. Options vary by Family (e.g., 65, 95, 125, etc.). |\n| Connection Mode | dropdown | Wood/Wood | Defines the connection scenario. <br>- **Wood/Wood**: Uses nails/screws for timber.<br>- **Wood/Concrete with Screw**: Uses screw-in anchors.<br>- **Wood/Concrete with chemical Dowel**: Uses chemical dowels. |\n| Shank Drills | dropdown | No | \"Yes\" includes holes on the vertical shank for through-bolting/pins. \"No\" uses self-perforating pins. |\n| Gap between Beams | number | 3.0 mm | The spacing distance between the end of the male beam and the face of the female beam. |\n| Offset Z-Direction | number | 0.0 mm | Vertical adjustment of the connector assembly relative to the beam's local Z-axis. |\n\n### Housing Settings (Female Beam)\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Housing Type | dropdown | Bottom | Vertical position of the pocket cut in the female beam. Options: Bottom, Centered, Top, None. |\n| House gap | number | 2.0 mm | Tolerance clearance added to the width and height of the pocket. |\n| Extra house depth | number | 2.0 mm | Additional depth of the pocket cut beyond the bracket thickness. |\n\n### Slot Settings (Male Beam)\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Slot | dropdown | Top | Location of the slot cut in the male beam. Options: Top, Bottom, Full height. |\n| Gap (X) | number | 20.0 mm | Extra length added to the slot cut (along beam axis). |\n| Gap (Y) | number | 2.0 mm | Extra width added to the slot cut. |\n| Gap (Z) | number | 2.0 mm | Extra depth added to the slot cut. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| MINI | Changes the bracket family to MINI and auto-detects the appropriate type. Updates available sizes. |\n| MIDI | Changes the bracket family to MIDI and auto-detects the appropriate type. |\n| MAXI | Changes the bracket family to MAXI and auto-detects the appropriate type. |\n| Extend length to be cut from rod | Extends the list of available types in the Properties Palette to include custom lengths up to the maximum rod length. |\n\n## Settings Files\n- **Catalog Entries**: `MINI`, `MIDI`, `MAXI` (Optional)\n- **Location**: Company standard or hsbCAD installation path.\n- **Purpose**: Pre-define default geometric data and size limits for the different bracket families.\n\n## Tips\n- **Quick Size Change**: Use the Right-Click menu (MINI/MIDI/MAXI) to switch between connector families without re-inserting the script.\n- **Auto Detect**: Leave the **Type** property as \"Auto detect\" initially. The script will calculate the largest possible bracket that fits the geometry.\n- **Concrete Connections**: When attaching to concrete, change the **Connection Mode** to automatically switch fasteners from wood nails to concrete anchors or dowels.\n- **Machining Control**: If you do not want a pocket cut in the female beam, set **Housing Type** to \"None\".\n\n## FAQ\n- **Q: How do I use a custom bracket size not listed in the Type dropdown?**\n  - **A:** Right-click the script instance and select \"Extend length to be cut from rod\". This unlocks the full range of sizes up to the rod's maximum length.\n- **Q: The bracket is floating in the wrong position vertically.**\n  - **A:** Adjust the \"Offset Z-Direction\" property in the Properties Palette to move the connector up or down.\n- **Q: What is the difference between Wood/Wood and Wood/Concrete modes?**\n  - **A:** Wood/Wood applies standard timber fasteners (nails/screws). Wood/Concrete modes switch the hardware list to use anchors or chemical dowels suitable for masonry/concrete."
      },
      "tokens_used": 7917,
      "error": null
    }
  }
}