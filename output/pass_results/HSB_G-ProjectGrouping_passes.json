{
  "filename": "HSB_G-ProjectGrouping.mcr",
  "status": "completed",
  "total_tokens": 22071,
  "processing_time": 273.13365864753723,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 5,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "31.01.2019",
            "author": "AS",
            "changes": "First revision"
          },
          {
            "version": "1.01",
            "date": "31.01.2019",
            "author": "AS",
            "changes": "Trigger show group info tsl."
          },
          {
            "version": "1.02",
            "date": "31.01.2019",
            "author": "AS",
            "changes": "Correct typo in group"
          },
          {
            "version": "1.03",
            "date": "01.04.2019",
            "author": "AS",
            "changes": "Support different grouping types."
          },
          {
            "version": "1.04",
            "date": "21.05.2019",
            "author": "AS",
            "changes": "Trigger new show group info tsl."
          },
          {
            "version": "1.05",
            "date": "31.10.2019",
            "author": "AS",
            "changes": "Remove padding of group name."
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "HSB_I-ShowGroupingInformation",
          "Batch & Stack Info"
        ]
      },
      "tokens_used": 3931,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses Group().collectEntities(true, TslInst(), _kModelSpace) and PrEntity for Element selection, indicating operation in 3D model space. No ShopDrawing (#Type E) or Paper Space specific patterns found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 1718,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "During script insertion (_bOnInsert)",
            "title": null,
            "dataSource": "Internal OPM Properties (standardGroupType, customGroupType, groupName)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "standardGroupType",
            "type": "PropString",
            "displayName": "|Group type|",
            "defaultValue": "Batch",
            "inputType": "dropdown",
            "options": [
              "Batch",
              "Stacking",
              "Truck"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "customGroupType",
            "type": "PropString",
            "displayName": "|Custom group type|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "",
              "SalesOrder"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "groupName",
            "type": "PropString",
            "displayName": "|Group name|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2927,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Assigns logical production grouping metadata (such as Batch, Truck, or Sales Order) to selected Elements for organization and reporting.",
          "category": "Data Management / Production Planning",
          "typicalUseCase": "A user selects a set of wall panels or roof elements and assigns them to 'Batch 1' or 'Truck A' so that subsequent drawings or production lists can filter and group these items together."
        },
        "parameters": [
          {
            "name": "standardGroupType",
            "technicalDefault": "Batch",
            "businessMeaning": "Defines the standard manufacturing or logistics category for the grouping (e.g., which production batch, stacking pile, or transport truck the elements belong to).",
            "validRange": "Batch, Stacking, Truck",
            "unit": "Enum (Text)",
            "affectsOutput": "Determines the internal Map key prefix (e.g., 'Hsb_BatchChild') used to store the data on the Element, allowing other scripts to identify the type of grouping."
          },
          {
            "name": "customGroupType",
            "technicalDefault": "",
            "businessMeaning": "Provides an alternative grouping category outside of standard physical production types, such as a specific Sales Order.",
            "validRange": "Empty, SalesOrder",
            "unit": "Enum (Text)",
            "affectsOutput": "If a value is selected, it overrides the 'standardGroupType'. It changes the internal Map key prefix to 'Hsb_[CustomType]Child' (e.g., 'Hsb_SalesOrderChild')."
          },
          {
            "name": "groupName",
            "technicalDefault": "",
            "businessMeaning": "The specific identifier (Name or ID) for the group instance, such as 'Batch-101', 'Truck-Load-A', or 'Order-500'.",
            "validRange": "Alphanumeric string (no strict limit)",
            "unit": "Text",
            "affectsOutput": "This string is written into the 'ParentUID' attribute of the Element's data map, serving as the actual link between the element and the group."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User selects a non-empty value for 'customGroupType'",
            "effect": "The script ignores 'standardGroupType' and uses 'customGroupType' to define the grouping category and data storage key.",
            "cascade": [
              "standardGroupType"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Element Map Data (Attribute)",
            "description": "Creates or updates a SubMap on the selected Element containing a 'ParentUID' entry with the Group Name. The Map name is dynamically generated based on the selected Group Type (e.g., 'Hsb_BatchChild').",
            "appliedTo": "Elements selected by the user during the insertion command."
          }
        ]
      },
      "tokens_used": 4717,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched (_bOnInsert is true)",
          "Check insert cycle count to prevent duplicate execution",
          "Display dynamic dialog for properties (Group Type, Custom Group Type, Group Name)",
          "Prompt user to select Elements in the model",
          "Validate selection: If elements selected, append to internal list",
          "Determine effective Group Type: Check if 'Custom Group Type' is set; if yes, use it, otherwise use 'Standard Group Type'",
          "Construct Data Map Key: Combine 'Hsb_' + Group Type + 'Child' (e.g., 'Hsb_BatchChild')",
          "Iterate through all selected Elements",
          "Create SubMap for each Element",
          "Set 'ParentUID' attribute to the specified 'Group Name' in the SubMap",
          "Apply SubMap to Element",
          "Find all TslInst entities in Model Space matching specific script names (ShowGroupingInformation, Batch & Stack Info)",
          "Trigger recalc() on found instances to update visual information",
          "Script finishes"
        ],
        "conditionalBranches": [
          {
            "condition": "Insert cycle count check",
            "path1": {
              "name": "Duplicate Cycle",
              "steps": [
                "Erase current instance",
                "Return immediately"
              ]
            },
            "path2": {
              "name": "First Cycle",
              "steps": [
                "Continue to showDialog()",
                "Execute selection prompt"
              ]
            }
          },
          {
            "condition": "Group Type Selection",
            "path1": {
              "name": "Custom Type Used",
              "steps": [
                "Check 'customGroupType' string",
                "If not empty, use 'customGroupType' value",
                "Key format: 'Hsb_' + customType + 'Child'"
              ]
            },
            "path2": {
              "name": "Standard Type Used",
              "steps": [
                "Check 'customGroupType' string",
                "If empty, fallback to 'standardGroupType' value",
                "Key format: 'Hsb_' + standardType + 'Child'"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "None (Script allows empty selection silently)",
            "recovery": "User must re-run the script and select elements if the operation was missed."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Group Data",
            "how": "Select the TSL instance (if persistent) or rely on script re-execution to update properties via OPM. Note: This script uses eraseInstance() logic indirectly via insertCycleCount, suggesting it might not persist in the model in an editable state typical of other TSLs, but rather acts as a command utility.",
            "effect": "Changing 'Group Type' or 'Group Name' and re-running the script (or if the instance persists, updating properties) updates the Map data on the linked elements."
          },
          {
            "action": "Update Visual Info",
            "how": "Automatic via script logic (finds TslInst and calls recalc)",
            "effect": "Any visual scripts showing grouping information (like 'HSB_I-ShowGroupingInformation') refresh immediately to reflect the new group assignments."
          }
        ]
      },
      "tokens_used": 4095,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-ProjectGrouping.mcr\n\n## Overview\nThis script allows you to assign logical production groups (such as Batches, Stacks, or Trucks) to selected Elements in the 3D model. It writes metadata to the elements, enabling better organization for production lists and drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for selecting Elements. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: Element (e.g., walls, roofs).\n- **Minimum beam count**: 0 (Selects Elements, not single beams).\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\n- Browse and select `HSB_G-ProjectGrouping.mcr`.\n\n### Step 2: Configure Properties\n- **Action**: The Properties Palette (OPM) will display the script parameters. Set your desired Group Type and Group Name before proceeding.\n\n### Step 3: Select Elements\n```\nCommand Line: |Select elements|\nAction: Click on the Elements you wish to group, then press Enter.\n```\n- The script will immediately apply the grouping data to the selected elements and refresh any visible grouping labels.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Group type | Dropdown | Batch | Select the standard production category (Batch, Stacking, Truck). This defines the context for the group (e.g., logistics vs. assembly). |\n| Custom group type | Dropdown | [Empty] | Select an alternative category if the standard types do not fit (e.g., SalesOrder). **Note:** If a value is selected here, it overrides \"Group type\". |\n| Group name | Text | [Empty] | Enter the specific identifier for this group (e.g., \"Batch-101\", \"Truck-A\", \"Order-500\"). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific items to the right-click context menu. |\n\n## Settings Files\n- **Filename**: None.\n- **Location**: N/A\n- **Purpose**: This script does not require external settings files.\n\n## Tips\n- **Visual Feedback**: If you have the \"HSB_I-ShowGroupingInformation\" or \"Batch & Stack Info\" scripts loaded in your model, they will automatically update to show the new group names immediately.\n- **Overwriting**: Running the script again on the same elements with a different \"Group name\" will overwrite the previous data.\n- **Custom vs Standard**: Use the \"Custom group type\" dropdown for non-physical groupings (like Sales Orders). If left empty, the script uses the \"Group type\" setting.\n\n## FAQ\n- **Q: Can I group beams individually?**\n  - A: No, this script is designed to group Elements (walls/roofs) as whole units.\n- **Q: Why didn't the group name appear?**\n  - A: Ensure you have entered text in the \"Group name\" property in the Properties Palette before selecting the elements.\n- **Q: Can I undo this action?**\n  - A: Yes, you can use the standard AutoCAD Undo command (Ctrl+Z) immediately after running the script."
      },
      "tokens_used": 4683,
      "error": null
    }
  }
}