{
  "filename": "Dimline.mcr",
  "status": "completed",
  "total_tokens": 146973,
  "processing_time": 709.9128992557526,
  "compression": {
    "original_chars": 311113,
    "compressed_chars": 297320,
    "ratio": 0.04433437368415982,
    "strategies": [
      "collapse_empty_lines",
      "remove_debug_comments",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "remove_dead_code",
      "mark_property_count",
      "normalize_whitespace"
    ]
  },
  "chunking": {
    "total_chunks": 4,
    "chunk_names": [
      "chunk_1",
      "chunk_2",
      "chunk_3",
      "chunk_4"
    ]
  },
  "passes": {
    "1": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "Request timeout after retries"
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "Both",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": true,
          "detectionEvidence": "Script header comment: 'Select entities in modelspace or viewports in paperspace'.\nVariables/Constants: Map references for Viewports and MultiPage.\nConstants include kViewportGrip.\nFunction 'NumViewports' detects viewports in _kMySpace.\nFunction 'GetShopdrawProfiles' processes ShopDrawView entities.\nJig keys: 'SelectViewport'.\nHistory log mentions: 'custom grid can be dimensioned within paperspace', 'viewport: dimpoints outside viewport are ignored', 'element viewports support multiple aligned dimlines'."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element",
            "Opening",
            "Polyline",
            "MetalPartCollectionEnt",
            "CollectionEntity",
            "TrussEntity",
            "BlockRef",
            "Sheet",
            "Panel"
          ],
          "minimumBeams": 0,
          "requiredSpace": "ModelSpace or PaperSpace (Viewports)",
          "requiredSettings": [
            "TslUtilities.dll at _kPathHsbInstall + '\\Utilities\\DialogService\\TslUtilities.dll'"
          ]
        }
      },
      "tokens_used": 33336,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "SelectFromList",
            "trigger": "Global Settings / Drill Visibility (via DialogMode)",
            "title": null,
            "dataSource": "sVSDrills (Any view, Perpendicular, Parallel)",
            "features": {
              "searchable": true,
              "multiSelect": false
            }
          },
          {
            "type": "SelectOption",
            "trigger": "Global Settings / Group Assignment (via DialogMode)",
            "title": null,
            "dataSource": "sGroupings (Default, No group assignment)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sVSBeam",
            "type": "PropString",
            "displayName": "|Beam|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|Any view|",
              "|Perpendicular to View Direction|",
              "|Parallel to View Direction|"
            ],
            "category": "|General|",
            "description": "|Defines the Beam|"
          },
          {
            "index": 1,
            "variable": "sVSSheet",
            "type": "PropString",
            "displayName": "|Sheet|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|Any view|",
              "|Perpendicular to View Direction|",
              "|Parallel to View Direction|"
            ],
            "category": "|General|",
            "description": "|Defines the Sheet|"
          },
          {
            "index": 2,
            "variable": "sVSPanel",
            "type": "PropString",
            "displayName": "|Panel|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|Any view|",
              "|Perpendicular to View Direction|",
              "|Parallel to View Direction|"
            ],
            "category": "|General|",
            "description": "|Defines the Panel|"
          },
          {
            "index": 3,
            "variable": "sVSMetalPart",
            "type": "PropString",
            "displayName": "|MetalPart|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|Any view|",
              "|Perpendicular to View Direction|",
              "|Parallel to View Direction|"
            ],
            "category": "|General|",
            "description": "|Defines the MetalPart|"
          },
          {
            "index": 0,
            "variable": "sGroupAssignment",
            "type": "PropString",
            "displayName": "|Group Assignment|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "<|Default|>",
              "|No group assigment|"
            ],
            "category": "|General|",
            "description": "|Defines to layer to assign the instance|, <|Default|> = |byEntity|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "TslUtilities.dll",
            "searchPaths": [
              "_kPathHsbInstall + \\Utilities\\DialogService\\"
            ],
            "purpose": "Provides dialogs for UI interactions (SelectFromList, SelectOption, GetText, AskYesNo, ShowNotice, ShowMultilineNotice)",
            "required": true
          }
        ]
      },
      "tokens_used": 35066,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automated dimensioning tool for timber construction that creates linear dimensions for beams, panels, sheets, openings, and machining tools in both ModelSpace and PaperSpace viewports.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used during detailing or drawing creation to automatically dimension timber assemblies, including specific tooling like drills or cuts, while respecting view direction and filtering options."
        },
        "parameters": [
          {
            "name": "sVSBeam",
            "technicalDefault": "Any view",
            "businessMeaning": "Defines the visibility strategy for timber beams based on their orientation relative to the current view (e.g., only dimension beams seen from the side vs. beams seen end-on).",
            "validRange": "Any view, Perpendicular to View Direction, Parallel to View Direction",
            "unit": "Enum",
            "affectsOutput": "Determines which beams are detected and included in the dimension calculation."
          },
          {
            "name": "sVSSheet",
            "technicalDefault": "Any view",
            "businessMeaning": "Defines the visibility strategy for sheeting materials (like CLT or sheathing) based on orientation relative to the view.",
            "validRange": "Any view, Perpendicular to View Direction, Parallel to View Direction",
            "unit": "Enum",
            "affectsOutput": "Determines which sheets are detected and included in the dimension calculation."
          },
          {
            "name": "sVSPanel",
            "technicalDefault": "Any view",
            "businessMeaning": "Defines the visibility strategy for structural panels (walls/floors) based on orientation relative to the view.",
            "validRange": "Any view, Perpendicular to View Direction, Parallel to View Direction",
            "unit": "Enum",
            "affectsOutput": "Determines which panels are detected and included in the dimension calculation."
          },
          {
            "name": "sVSMetalPart",
            "technicalDefault": "Any view",
            "businessMeaning": "Defines the visibility strategy for metal plates and hardware based on orientation relative to the view.",
            "validRange": "Any view, Perpendicular to View Direction, Parallel to View Direction",
            "unit": "Enum",
            "affectsOutput": "Determines which metal parts are detected and included in the dimension calculation."
          },
          {
            "name": "sGroupAssignment",
            "technicalDefault": "<Default>",
            "businessMeaning": "Controls the layer management of the generated dimension instance, specifically determining if it should be grouped with the entities it dimensions or handled independently.",
            "validRange": "<Default>, |No group assignment|",
            "unit": "Enum",
            "affectsOutput": "Alters the CAD layer grouping and selection behavior of the dimension object."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Context: ModelSpace vs. PaperSpace",
            "effect": "Activates logic to detect viewports and transform coordinates between Model and Paper space.",
            "cascade": [
              "All VS parameters"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Dim",
            "description": "Standard AutoCAD/hsbCAD dimension object displaying measurements and extension lines.",
            "appliedTo": "Selected construction entities in ModelSpace or Viewport boundaries in PaperSpace."
          }
        ]
      },
      "tokens_used": 35421,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script (TSLCONTENT) or Select Existing Instance",
          "Check Execution Mode: _bOnInsert, _bOnJig, or DialogMode",
          "[DialogMode == 1] Set OPM Key 'DrillVisibility' and expose Beam/Sheet/Panel/MetalPart properties. Exit.",
          "[DialogMode == 2] Set OPM Key 'GlobalSettings' and expose Group Assignment property. Exit.",
          "[Insert Mode] Detect Current Space: ModelSpace or PaperSpace",
          "[PaperSpace] Initialize 'SelectViewport' Jig to define the target viewport.",
          "Select Dimension Entities (GenBeams, Sheets, Panels, Openings, MetalParts, etc.)",
          "Analyze Geometry: Collect bodies/shadow profiles and resolve nested entities (Truss, Collection).",
          "Calculate Dimension Points: Determine intersection points based on entity geometry, tools, or TSL requests.",
          "Filter Points: Apply Visibility Strategy (Perpendicular/Parallel/Any) and Viewport boundaries.",
          "Draw Dimension: Generate Dim entities using calculated points and text settings.",
          "Finalize: Store instance in Map based on Group Assignment setting."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Context (Insert vs. Edit)",
            "path1": {
              "name": "Insert Flow",
              "steps": [
                "Detect space (Model/Paper)",
                "Run Viewport Jig (if PaperSpace)",
                "Select Entities",
                "Run 'SetAlignment' or 'SetTool' Jig to define position and content",
                "Create Dimension"
              ]
            },
            "path2": {
              "name": "Recalc/Edit Flow",
              "steps": [
                "Read properties from Map/OPM",
                "Re-evaluate entities linked to instance",
                "Regenerate geometry and dimensions"
              ]
            }
          },
          {
            "condition": "Dimension Content Type",
            "path1": {
              "name": "Standard Geometry",
              "steps": [
                "Get Body (Real/Basic/Envelope) from selected entities",
                "Calculate shadow profile in View Plane",
                "Determine extreme points for dimension"
              ]
            },
            "path2": {
              "name": "Tools / Machining",
              "steps": [
                "Analyze GenBeams for tools (Drills, Cuts, Slots, etc.)",
                "Filter tools by Type, SubType, and Stereotype",
                "Calculate dimension points based on tool vector logic",
                "Draw dimension for tool features"
              ]
            },
            "path3": {
              "name": "TSL Requests",
              "steps": [
                "Read 'DimRequest[]' or 'Hsb_DimensionInfo' from attached TSLs",
                "Validate Request view direction against current view",
                "Use coordinate nodes defined in request"
              ]
            }
          },
          {
            "condition": "Viewport Interaction (PaperSpace)",
            "path1": {
              "name": "Inside Viewport",
              "steps": [
                "Transform model coordinates to paper space",
                "Draw dimension graphics"
              ]
            },
            "path2": {
              "name": "Outside Viewport",
              "steps": [
                "Identify points falling outside viewport boundary",
                "Ignore/Exclude these points from dimension generation"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Selection",
            "errorMessage": "No valid entities selected.",
            "recovery": "User must select valid GenBeams, Panels, Sheets, or dimensionable TSLs."
          },
          {
            "check": "Viewport Availability (PaperSpace)",
            "errorMessage": "No valid viewport found at selected location.",
            "recovery": "User must select a location inside a valid hsbCAD or AutoCAD viewport."
          },
          {
            "check": "Dimension Points Calculation",
            "errorMessage": "No dimension points could be generated.",
            "recovery": "Adjust View Strategy settings or ensure entities are visible/valid in the current view."
          },
          {
            "check": "Tool Filter Matching",
            "errorMessage": "No tools match the specified subtype/stereotype.",
            "recovery": "Check tool subtype/stereotype filters in script properties."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Realign Dimension",
            "how": "Context Menu / Jig (Key: 'kJigSetAlignment')",
            "effect": "Re-positions the dimension line relative to the geometry."
          },
          {
            "action": "Copy Dimension",
            "how": "Context Menu / Jig (Key: 'kJigCopy')",
            "effect": "Creates a copy of the dimension at a new location."
          },
          {
            "action": "Add/Remove Points",
            "how": "Context Menu / Jig (Keys: 'kJigAddPoints', 'RemovePoints')",
            "effect": "Manually adds specific points to the dimension or removes existing ones."
          },
          {
            "action": "Modify Visibility Settings",
            "how": "Properties Palette (OPM) / DialogMode",
            "effect": "Changes which entities (Beams, Sheets, etc.) are dimensioned based on view direction."
          },
          {
            "action": "Global Settings",
            "how": "Context Menu / TslUtilities Dialog",
            "effect": "Configures drill visibility or group assignment behaviors."
          }
        ]
      },
      "tokens_used": 36687,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Dimline.mcr\n\n## Overview\nAutomated dimensioning tool for timber construction that creates linear dimensions for beams, panels, sheets, openings, and machining tools in both ModelSpace and PaperSpace viewports.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Dimensions 3D model entities directly. |\n| Paper Space | Yes | Supports dimensioning inside viewports; points outside the viewport are ignored. |\n| Shop Drawing | Yes | Suitable for detailing production drawings. |\n\n## Prerequisites\n- **Required Entities**: GenBeam, Element, Opening, Polyline, MetalPartCollectionEnt, CollectionEntity, TrussEntity, BlockRef, Sheet, Panel.\n- **Minimum Beam Count**: 0 (Can dimension sheets, panels, and other entities without beams).\n- **Required Settings Files**: `TslUtilities.dll` located in `_kPathHsbInstall + \\Utilities\\DialogService\\`.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Dimline.mcr`\n\n### Step 2: Select Viewport (If in Paper Space)\n```\nCommand Line: Select viewport\nAction: Click inside the viewport where you want to place the dimension.\n```\n*Note: This step is skipped if you are currently in Model Space.*\n\n### Step 3: Select Entities\n```\nCommand Line: Select entities\nAction: Click on the beams, panels, sheets, or other elements you wish to dimension. Press Enter to confirm selection.\n```\n\n### Step 4: Define Alignment and Position\n```\nCommand Line: Set position\nAction: Move your cursor to position the dimension line. The script will automatically calculate dimension points based on the selected geometry. Click to place the dimension.\n```\n*Tip: You can often move the cursor orthogonally to switch between horizontal and vertical dimensioning.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Beam | dropdown | Any view | Determines which beams are dimensioned based on their orientation relative to the current view (e.g., only beams seen from the side). |\n| Sheet | dropdown | Any view | Determines which sheeting materials (e.g., CLT) are dimensioned based on orientation. |\n| Panel | dropdown | Any view | Determines which structural panels (walls/floors) are dimensioned based on orientation. |\n| MetalPart | dropdown | Any view | Determines which metal plates and hardware are dimensioned based on orientation. |\n| Group Assignment | dropdown | <Default> | Controls the layer management of the dimension instance. <Default> groups it with the dimensioned entities; \"No group assignment\" keeps it independent. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Realign Dimension | Re-positions the dimension line relative to the geometry using a Jig interaction. |\n| Copy Dimension | Creates a copy of the current dimension instance at a new location. |\n| Add Points | Allows manual selection of specific points to include in the dimension. |\n| Remove Points | Removes specific points from the existing dimension. |\n| Global Settings | Opens a dialog to configure drill visibility and default group assignments. |\n\n## Settings Files\n- **Filename**: `TslUtilities.dll`\n- **Location**: `hsbCAD Install Folder\\Utilities\\DialogService\\`\n- **Purpose**: Provides the user interface dialogs for selecting configuration options (like drill visibility and group settings).\n\n## Tips\n- **Filtering by View Direction**: Use the \"Perpendicular to View Direction\" setting in the Properties Panel to avoid dimensioning the ends of beams (cross-sections) and only dimension the lengths.\n- **Drill Visibility**: Access \"Global Settings\" from the right-click menu to configure specific visibility for machining tools (drills/cuts) if they are not appearing automatically.\n- **Paper Space Clipping**: When working in Paper Space, ensure your dimension points fall clearly within the viewport boundaries; points outside are automatically ignored.\n\n## FAQ\n- **Q: Why are some of my beams not being dimensioned?**\n  **A:** Check the \"Beam\", \"Sheet\", or \"Panel\" properties in the palette. If set to \"Perpendicular to View Direction\", beams that are end-on to your view will be excluded.\n- **Q: Can I dimension specific machining tools like drills?**\n  **A:** Yes. Use the \"Global Settings\" option in the right-click menu to adjust drill visibility filters.\n- **Q: Can I add a point to an existing dimension?**\n  **A:** Yes. Select the dimension, right-click, and choose \"Add Points\". You can then select geometry or snap to points to append them to the dimension."
      },
      "tokens_used": 6463,
      "error": null
    }
  }
}