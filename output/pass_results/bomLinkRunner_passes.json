{
  "filename": "bomLinkRunner.mcr",
  "status": "completed",
  "total_tokens": 35357,
  "processing_time": 500.64814734458923,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "23oct2019",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-5806 initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5538,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Entity collection explicitly targets _kModelSpace: '_Entity = Group().collectEntities( true, Entity(), _kModelSpace);'. Uses ModelMapComposeSettings for data extraction. Absence of Paper Space keywords (_Viewport, _kPaperSpace) or Shop Drawing prefixes (sd_)."
        },
        "prerequisites": {
          "requiredEntities": [
            "Entity"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbSoft.BomLink.Tsl.dll (External .NET Assembly)",
            "BOMLink Project configuration (Map Key: HSB_PROJECTSETTINGS -> BOMLINKPROJECT)"
          ]
        }
      },
      "tokens_used": 4281,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select entities|, |<Enter> to select all|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": false\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"_sProject\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Project|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the current bomLink Project|\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sOutput\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Output|\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"dropdown\",\n      \"options\": [],\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the Output"
      },
      "tokens_used": 7107,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Facilitates the export of timber model data (geometry, materials, and machining) to an external BOMLink system or specific production file formats.",
          "category": "Data Management / Export",
          "typicalUseCase": "Used at the end of the detailing process to generate production data for machinery or material lists for procurement from the hsbCAD model."
        },
        "parameters": [
          {
            "name": "_sProject",
            "technicalDefault": "Retrieved from 'BOMLINKPROJECT' key in Project Map, or defaults to the single available project",
            "businessMeaning": "Selects the specific BOMLink Project configuration to use. This determines the factory or company context for the exported data, ensuring the correct standards and mappings are applied.",
            "validRange": "List of available BOMLink projects defined in the external configuration",
            "unit": "String",
            "affectsOutput": "Updates the available 'Output' options and ensures the data is formatted according to the specific project's requirements (e.g., specific factory or ERP system)."
          },
          {
            "name": "sOutput",
            "technicalDefault": "First available output defined for the selected project",
            "businessMeaning": "Defines the specific type of export or destination within the selected BOMLink Project (e.g., 'ProductionData', 'CutList', 'XML_Export').",
            "validRange": "List of outputs provided by the BOMLink DLL for the currently selected project",
            "unit": "String",
            "affectsOutput": "Controls the content and format of the exported file (e.g., filtering for only specific data types like walls or beams, or selecting the file format like CSV/PXML)."
          },
          {
            "name": "ssE (Entity Selection)",
            "technicalDefault": "All entities in Model Space",
            "businessMeaning": "Identifies which specific timber elements (beams, walls, panels) from the model should be included in the export.",
            "validRange": "Any selection of hsbCAD Entities",
            "unit": "Selection Set",
            "affectsOutput": "Limits the scope of the export. If only a few beams are selected, only those are included in the BOM/production file; otherwise, the whole model is processed."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "_sProject is changed during insertion",
            "effect": "The available options for 'sOutput' are regenerated by querying the external BOMLink DLL with the new project context.",
            "cascade": [
              "sOutput"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Data File / Export Stream",
            "description": "Generates an external data file (formats vary by BOMLink configuration) containing Bill of Materials, geometry, and tooling information.",
            "appliedTo": "Selected Entities or Entire Model"
          }
        ]
      },
      "tokens_used": 6002,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Initialization: Load hsbSoft.BomLink.Tsl.dll and retrieve BOMLink projects.",
          "2. Project Detection: Check 'HSB_PROJECTSETTINGS' map for 'BOMLINKPROJECT'.",
          "3. [Conditional] Project Configuration: If no project is set, display dialog to select project; otherwise, use stored setting. If only one project exists and no setting is found, auto-select it.",
          "4. Output Retrieval: Query DLL for available outputs based on the selected project.",
          "5. [Conditional] Output Selection: If multiple outputs exist, display dialog or apply command-line catalog settings. If only one exists, use it by default.",
          "6. Entity Selection: Prompt user to select entities.",
          "7. [Conditional] Selection Scope: If user selects entities, scope is selection. If user presses Enter, scope is all Model Space entities.",
          "8. Export Execution: Generate ModelMap (including solids, tools, hardware) and pass data to external DLL.",
          "9. Result Reporting: Check returned map for errors and report status (Success/Failure) to command line.",
          "10. Termination: Erase script instance (unless debugging mode is active)."
        ],
        "conditionalBranches": [
          {
            "condition": "Is a default BOMLink Project already configured in the Project Map?",
            "path1": {
              "name": "Configured Path",
              "steps": [
                "Read 'BOMLINKPROJECT' from HSB_PROJECTSETTINGS.",
                "Use this project to load Outputs.",
                "Skip Project Selection Dialog."
              ]
            },
            "path2": {
              "name": "Unconfigured Path",
              "steps": [
                "Check if list of available projects contains exactly one entry.",
                "If yes, auto-select and save to map.",
                "If no, show Dialog with list of Projects.",
                "User selects Project.",
                "Save selection to map and refresh Outputs list."
              ]
            }
          },
          {
            "condition": "User Input during Entity Selection",
            "path1": {
              "name": "Manual Selection",
              "steps": [
                "User picks specific entities in drawing.",
                "Export processes only selected entities."
              ]
            },
            "path2": {
              "name": "Select All (Enter)",
              "steps": [
                "User presses Enter at prompt.",
                "Script executes 'Group().collectEntities' on ModelSpace.",
                "Export processes entire model."
              ]
            }
          },
          {
            "condition": "Execution Mode (Dialog vs Command)",
            "path1": {
              "name": "Interactive / Dialog",
              "steps": [
                "System checks '_kExecuteKey' is empty.",
                "Calls 'showDialog()' for user to select Project/Output."
              ]
            },
            "path2": {
              "name": "Command / Catalog",
              "steps": [
                "System detects '_kExecuteKey' (command line argument).",
                "Checks catalog for matching entry name.",
                "Applies properties from catalog silently (no dialog)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Availability of Outputs for Selected Project",
            "errorMessage": "No Projects could be found. Tool will be deleted.",
            "recovery": "Ensure the BOMLink configuration file(s) are correct and the selected project has valid outputs defined in the external DLL configuration."
          },
          {
            "check": "Export Execution Result (DLL Response)",
            "errorMessage": "BOMLink failed [Error Message from DLL]",
            "recovery": "Check the specific error message returned by the BOMLink engine (e.g., file locks, invalid geometry data, connection issues to ERP)."
          },
          {
            "check": "Script Re-insertion Cycle",
            "errorMessage": "(None - Silent)",
            "recovery": "The script automatically erases itself if insertCycleCount > 1 to prevent duplicate execution logic errors."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None (Instance Erasure)",
            "how": "Automatic",
            "effect": "The script instance erases itself immediately after execution ('eraseInstance()'). Therefore, no OPM changes, grip edits, or context menu modifications are possible post-run unless debug mode is enabled."
          }
        ]
      },
      "tokens_used": 6329,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# bomLinkRunner.mcr\n\n## Overview\nThis script facilitates the export of timber model data (geometry, materials, and machining) to an external BOMLink system or specific production file formats. It acts as a bridge between the hsbCAD model and external manufacturing or procurement software.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script explicitly collects entities from Model Space. |\n| Paper Space | No | Not designed for Paper Space entities. |\n| Shop Drawing | No | Not intended for use within Shop Drawing layouts. |\n\n## Prerequisites\n- **Required Entities**: At least one hsbCAD Entity (beams, walls, etc.) in the model.\n- **Minimum Beam Count**: 0 (Can export empty sets if configured, though usually requires data).\n- **Required Settings**:\n  - `hsbSoft.BomLink.Tsl.dll`: The external .NET assembly provided by hsbSoft must be installed and accessible.\n  - **BOMLink Configuration**: Valid BOMLink projects must be defined in the configuration. A default project can be set via the Project Map (`HSB_PROJECTSETTINGS` -> `BOMLINKPROJECT`).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or run via Catalog)\nAction: Select `bomLinkRunner.mcr` from the file dialog or catalog entry.\n\n### Step 2: Select Entities\n```\nCommand Line: Select entities, <Enter> to select all\nAction: Click the specific beams or elements you wish to export, or press Enter to export the entire model.\n```\n\n### Step 3: Configure Project (If required)\n*If a default project is not found in the Project Settings, or if multiple projects are available:*\n- A dialog box will appear listing available BOMLink Projects.\n- Select the appropriate Project (e.g., specific factory or ERP context) and click OK.\n\n### Step 4: Configure Output\n*Once the project is set, a dialog will appear listing available Outputs for that project:*\n- Select the desired Output type (e.g., ProductionData, CutList, XML_Export).\n- Click OK to proceed.\n\n### Step 5: Execution\n- The script will gather the model data and pass it to the BOMLink engine.\n- The script instance will automatically erase itself from the drawing.\n- Check the AutoCAD command line for a \"Success\" or error message.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Project** | dropdown (PropString) | *Retrieved from Project Map* | Defines the current bomLink Project context. Changing this updates the available Output options. |\n| **Output** | dropdown (PropString) | *First available option* | Defines the specific type of export or destination (e.g., CSV, PXML) for the selected Project. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | The script instance erases itself immediately after execution. Standard context menus are not available post-run. |\n\n## Settings Files\n- **BOMLink Configuration**: External configuration files managed by the `hsbSoft.BomLink.Tsl.dll`.\n- **Project Map Key**: `HSB_PROJECTSETTINGS` -> `BOMLINKPROJECT`.\n  - **Purpose**: Stores the default BOMLink project for the drawing, allowing the script to run without prompts if the setting is already defined.\n\n## Tips\n- **Full Model Export**: To export everything quickly, simply press `Enter` immediately when prompted to select entities.\n- **Automation**: If you set the `BOMLINKPROJECT` key in your Project Map settings, the script can skip the Project Selection dialog, speeding up the workflow.\n- **Debugging**: If the script disappears but you suspect an error, check the AutoCAD command line history. Any failure messages from the BOMLink engine will be displayed there.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I inserted it?**\n  - A: This is normal behavior. The script runs the export task and then erases itself (`eraseInstance`) to prevent cluttering the drawing with utility scripts.\n- **Q: How do I export only specific walls?**\n  - A: When the command line prompts \"Select entities\", manually click the specific walls or beams you want. Do not press Enter.\n- **Q: I got an error \"No Projects could be found\". What do I do?**\n  - A: This means the external BOMLink configuration is missing or empty. Contact your CAD Manager to ensure the `hsbSoft.BomLink.Tsl.dll` and its configuration files are correctly installed."
      },
      "tokens_used": 6100,
      "error": null
    }
  }
}