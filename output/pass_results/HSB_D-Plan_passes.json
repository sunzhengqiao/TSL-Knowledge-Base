{
  "filename": "HSB_D-Plan.mcr",
  "status": "completed",
  "total_tokens": 45018,
  "processing_time": 306.0778031349182,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 7972,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses `_kModelSpace` when calling `dimensionLine.dbCreate(...)`. It iterates through `Group().allExistingGroups()` to find floor groups and processes `Element` and `GenBeam` objects. There are no `#Type E` exports, `sd_` function calls, or interactions with `_Viewport`."
        },
        "prerequisites": {
          "requiredEntities": [
            "Group (Floorgroup)",
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Must be executed in a model containing valid floor groups with elements or beams.",
          "requiredSettings": [
            "Catalog entry for 'HSB_D-Aligned' TSL (used for dimension line instances).",
            "Dimension Styles (_DimStyles) must be defined in the drawing.",
            "Grid lines (if 'Use grid as reference' is enabled)."
          ]
        }
      },
      "tokens_used": 4424,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 8742,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automatically generates a complete set of plan dimensions (openings, perimeter, and overall extents) for a selected floor group, aligning them to grid lines or the building envelope.\",\n    \"category\": \"ShopDrawing/Annotation\",\n    \"typicalUseCase\": \"Used during the detailing phase to automatically dimension floor plans or wall layouts for production drawings or architectural layouts.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"floorGroupName\",\n      \"technicalDefault\": \"First available floorgroup\",\n      \"businessMeaning\": \"Identifies the specific floor or assembly level to be dimensioned.\",\n      \"validRange\": \"List of existing Floorgroups in the model\",\n      \"unit\": \"Selection\",\n      \"affectsOutput\": \"Determines which Elements and Beams are analyzed for dimensioning.\"\n    },\n    {\n      \"name\": \"dimensionStyleConstructiveBeams\",\n      \"technicalDefault\": \"Standard dimension style\",\n      \"businessMeaning\": \"Defines the visual appearance (font, arrowheads) of the text labels attached to structural beams.\",\n      \"validRange\": \"Available AutoCAD/hsbCAD Dimension Styles\",\n      \"unit\": \"StyleID\",\n      \"affectsOutput\": \"Visual styling of beam markers in the drawing.\"\n    },\n    {\n      \"name\": \"textSizeConstructiveBeams\",\n      \"technicalDefault\": \"-1\",\n      \"businessMeaning\": \"Overrides the text height for beam labels. A value of zero or negative forces the use of the Dimension Style's default size.\",\n      \"validRange\": \"0 to 50 (mm)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Size of the text labeling individual beams.\"\n    },\n    {\n      \"name\": \"textColorConstructiveBeams\",\n      \"technicalDefault\": \"-1\",\n      \"businessMeaning\": \"Sets the color of the beam label text. -1 typically defaults to the layer or style color.\",\n      \"validRange\": \"0-255 (Color Index) or -1\",\n      \"unit\": \"ColorIndex\",\n      \"affectsOutput\": \"Color of beam text labels.\"\n    },\n    {\n      \"name\": \"offsetDimensionLines\",\n      \"technicalDefault\": \"1000\",\n      \"businessMeaning\": \"The clearance distance between the outermost surface of the building/elements and the first dimension line.\",\n      \"validRange\": \"500 to 5000\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Moves the entire stack of dimension lines closer to or further from the building geometry.\"\n    },\n    {\n      \"name\": \"distanceBetweenDimensionLines\",\n      \"technicalDefault\": \"400\",\n      \"businessMeaning\": \"The vertical spacing between consecutive dimension lines (e.g., between the 'Openings' and 'Perimeter' lines).\",\n      \"validRange\": \"200 to 1000\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Spacing of dimension chains relative to each other.\"\n    },\n    {\n      \"name\": \"showInDisplayRepresentation\",\n      \"technicalDefault\": \"Standard\",\n      \"businessMeaning\": \"Controls in which specific view or display configuration (e.g., Plan, Framing) the dimension lines are visible.\",\n      \"validRange\": \"Available Display Representations\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Visibility of dimensions in different drawing modes.\"\n    },\n    {\n      \"name\": \"floorGroupNameDimensionLines\",\n      \"technicalDefault\": \"Same as floorGroupName\",\n      \"businessMeaning\": \"Assigns the generated dimension entities to a specific group, often used for layer management or isolating dimensions.\",\n      \"validRange\": \"List of existing Groups\",\n      \"unit\": \"Selection\",\n      \"affectsOutput\": \"Grouping and layering of the resulting dimension lines.\"\n    },\n    {\n      \"name\": \"useElementOutlineAsFrameOutlineProp\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Determines the reference point for dimensions. 'Yes' uses the outer surface of panels (cladding); 'No' uses the structural beams (centerline or offset).\",\n      \"validRange\": \"Yes/No\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"Critical for ensuring dimensions represent the 'Net' size (cladding) vs 'Structural' size (beams).\"\n    },\n    {\n      \"name\": \"gridAsReferenceProp\",\n      \"technicalDefault\": \"Yes\",\n      \"businessMeaning\": \"Master switch to use structural grid lines as the reference boundary for dimensions instead of the building edge.\",\n      \"validRange\": \"Yes/No\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"Determines if extension lines stop at the wall or continue to the grid.\"\n    },\n    {\n      \"name\": \"gridTolerance\",\n      \"technicalDefault\": \"1000\",\n      \"businessMeaning\": \"The search radius to detect a grid line. If the building edge is within this distance of a grid, the dimension may snap to the grid.\",\n      \"validRange\": \"0 to 5000\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Sensitivity of grid snapping logic.\"\n    },\n    {\n      \"name\": \"catalogOpeningDimensionLines\",\n      \"technicalDefault\": \"Standard\",\n      \"businessMeaning\": \"Selects the configuration preset (Catalog) for the specific dimension script handling openings.\",\n      \"validRange\": \"Catalog entries for 'HSB_D-Aligned'\",\n      \"unit\": \"CatalogName\",\n      \"affectsOutput\": \"Line type, arrow size, and text height of the 'Openings' dimension chain.\"\n    },\n    {\n      \"name\": \"descriptionOpeningDimensionLines\",\n      \"technicalDefault\": \"Openings\",\n      \"businessMeaning\": \"The text label displayed to identify the specific dimension chain (e.g., 'Window Sizes').\",\n      \"validRange\": \"String\",\n      \"unit\": \"Text\",\n      \"affectsOutput\": \"Label text for opening dimensions.\"\n    },\n    {\n      \"name\": \"gridAsReferenceForOpeningsProp\",\n      \"technicalDefault\": \"No\",\n      \"businessMeaning\": \"Overrides the master grid setting specifically for the 'Openings' dimension chain.\",\n      \"validRange\": \"Yes/No\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"Grid snapping behavior for opening dimensions only.\"\n    },\n    {\n      \"name\": \"catalogPerimeterDimensionLines\",\n      \"technicalDefault\": \"Standard\",\n      \"businessMeaning\": \"Selects the configuration preset for the perimeter dimension script.\",\n      \"validRange\": \"Catalog entries for 'HSB_D-Aligned'\",\n      \"unit\": \"CatalogName\",\n      \"affectsOutput\": \"Styling of the 'Perimeter"
      },
      "tokens_used": 8322,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Initialization: Check for Execute Key (_kExecuteKey).",
          "[Conditional] If Execute Key is valid, load properties from catalog 'Støren_D-Plan'.",
          "Insertion Cycle Check: Verify if insertCycleCount() > 1.",
          "[Conditional] If cycle > 1, erase current instance and stop (Prevents duplicate geometry on regen).",
          "User Input: If no Execute Key, display Properties Dialog (showDialog).",
          "User Input: Prompt user to select insertion point for the script instance (getPoint).",
          "Save current properties to '_LastInserted' catalog.",
          "Processing Phase: Identify target Floorgroup and Dimension Group from property lists.",
          "Geometry Collection: Iterate all Elements and GenBeams in the target Floorgroup.",
          "Boundary Calculation: Determine bounding box (floorMin, floorMax) of collected geometry.",
          "[Conditional] Apply Grid Logic: If enabled, search for grid lines and extend boundaries.",
          "Dimension Calculation: Calculate points for Openings, Perimeter, and Overall extents.",
          "Entity Creation: Spawn 'HSB_D-Aligned' TSL instances for each calculated dimension chain.",
          "Assignment: Assign new dimension lines to the specified Floorgroup and Display Representation.",
          "Completion: Instance updates in ModelSpace."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Key Present",
            "path1": {
              "name": "Catalog Execution",
              "steps": [
                "Load properties from 'Støren_D-Plan' catalog matching the key.",
                "Skip the Properties Dialog.",
                "Proceed to getPoint."
              ]
            },
            "path2": {
              "name": "Manual Execution",
              "steps": [
                "Use default properties.",
                "Show Properties Dialog to user.",
                "User confirms settings.",
                "Proceed to getPoint."
              ]
            }
          },
          {
            "condition": "Geometry Source (useElementOutlineAsFrameOutlineProp)",
            "path1": {
              "name": "Element Outline",
              "steps": [
                "Calculate bounding box and reference lines based on the outer contour of Element/Panel entities.",
                "Typically used for clad dimensions."
              ]
            },
            "path2": {
              "name": "Constructive Beams",
              "steps": [
                "Calculate bounding box and reference lines based on GenBeam centerlines or surfaces.",
                "Typically used for structural dimensions."
              ]
            }
          },
          {
            "condition": "Global Grid Reference (gridAsReferenceProp)",
            "path1": {
              "name": "Use Grid",
              "steps": [
                "Search for GridLines intersecting the floor bounding box.",
                "Extend floorMin/floorMax to include grid lines within 'Grid Tolerance'.",
                "Overall dimensions extend to the grid."
              ]
            },
            "path2": {
              "name": "Ignore Grid",
              "steps": [
                "Dimensions strictly follow the outer surface of the elements/beams.",
                "No extension to grid lines."
              ]
            }
          },
          {
            "condition": "Specific Chain Grid Reference (Perimeter/Openings)",
            "path1": {
              "name": "Override Active",
              "steps": [
                "Appends grid intersection points to the specific dimension chain point list.",
                "Extension lines snap to the grid instead of the wall face for this chain only."
              ]
            },
            "path2": {
              "name": "Inherit Global",
              "steps": [
                "Uses the grid setting defined in 'General dimension settings'.",
                "Snaps according to the master 'Use grid as reference' switch."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of Floor Groups",
            "errorMessage": "The 'Floorgroup' property dropdown will be empty.",
            "recovery": "User must create or assign a valid Floorgroup in the model before running the script."
          },
          {
            "check": "Catalog Availability",
            "errorMessage": "Script fails to spawn dimension lines if 'HSB_D-Aligned' or 'Støren_D-Plan' catalogs are missing.",
            "recovery": "Ensure required TSL catalogs are installed and loaded in the hsbCAD configuration."
          },
          {
            "check": "Dimension Styles",
            "errorMessage": "Text or lines may not display correctly if Dimension Style ID is invalid.",
            "recovery": "Select a valid AutoCAD/hsbCAD Dimension Style from the properties list."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Configuration",
            "how": "Properties Palette (OPM)",
            "effect": "Changing properties (e.g., offsets, styles) triggers a recalculation. The script erases old dimension lines and generates new ones."
          },
          {
            "action": "Recalculate Dimensions",
            "how": "Right-click Context Menu -> 'Recalculate dimensions'",
            "effect": "Forces a full refresh of all dimension lines based on the current geometry and property settings."
          },
          {
            "action": "Move Instance",
            "how": "Grip Edit (Drag)",
            "effect": "Moves the 'Name and Description' text label. The generated dimension lines are anchored to the building geometry and do not move with the instance grip."
          }
        ]
      },
      "tokens_used": 9253,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_D-Plan\n\n## Overview\nAutomatically generates a complete set of plan dimensions (openings, perimeter, and overall extents) for a selected floor group, aligning them to grid lines or the building envelope.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in Model Space. |\n| Paper Space | No | Not supported for Paper Space layouts. |\n| Shop Drawing | No | Not designed for Shop Drawing generation. |\n\n## Prerequisites\n- **Required Entities**: A model containing at least one Floor Group with Elements (panels) or GenBeams.\n- **Minimum Beams**: None, but geometry is required to generate dimensions.\n- **Required Settings**:\n  - The TSL script `HSB_D-Aligned` must be available in the catalog (used to draw the actual dimension lines).\n  - AutoCAD/hsbCAD Dimension Styles must be defined in the drawing.\n  - Grid lines (optional, required if using grid reference features).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `HSB_D-Plan.mcr` from the list.\n\n### Step 2: Configure Properties\n```\nDialog: HSB_D-Plan Properties\nAction:\n1. Select the 'Floorgroup' to dimension from the dropdown list.\n2. Adjust dimension offsets, styles, and grid settings as needed.\n3. Click OK to confirm.\n```\n\n### Step 3: Set Insertion Point\n```\nCommand Line: Pick insertion point:\nAction: Click anywhere in the Model Space (typically near the floor plan) to place the script instance.\n```\n*Note: The script will immediately calculate and spawn the dimension lines based on the selected floor group.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| FloorGroupName | dropdown | First Available | Selects the specific floor group to process for dimensions. |\n| DimensionStyleConstructiveBeams | dropdown | Standard | Sets the visual style (font, arrows) for beam label text. |\n| TextSizeConstructiveBeams | number | -1 | Overrides text height for beam labels. (-1 uses Style default). |\n| OffsetDimensionLines | number | 1000 mm | Distance between the building geometry and the first dimension line. |\n| DistanceBetweenDimensionLines | number | 400 mm | Vertical spacing between subsequent dimension chains. |\n| UseElementOutlineAsFrameOutline | Yes/No | No | **Yes**: Dimensions measure to panel cladding (Net size). **No**: Measures to structural beams. |\n| GridAsReference | Yes/No | Yes | If Yes, extension lines snap to grid lines instead of wall faces. |\n| GridTolerance | number | 1000 mm | Search radius for snapping to grid lines. |\n| CatalogOpeningDimensionLines | dropdown | Standard | Catalog preset for the 'Openings' dimension chain styling. |\n| DescriptionOpeningDimensionLines | text | Openings | Label text identifying the Opening dimension chain. |\n| CatalogPerimeterDimensionLines | dropdown | Standard | Catalog preset for the 'Perimeter' dimension chain styling. |\n| FloorGroupNameDimensionLines | dropdown | Same as Source | Assigns generated dimensions to a specific group for layer management. |\n| ShowInDisplayRepresentation | dropdown | Standard | Controls visibility of dimensions in specific view configurations (e.g., Plan, Framing). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate dimensions | Refreshes all dimension lines based on the current geometry and property settings. |\n\n## Settings Files\n- **Dependent TSL**: `HSB_D-Aligned`\n- **Purpose**: This script acts as a master controller that spawns instances of `HSB_D-Aligned` to draw the individual dimension lines. Ensure this script is present in your TSL catalog path.\n\n## Tips\n- **Net vs. Structural Dimensions**: Use the `UseElementOutlineAsFrameOutline` property to toggle between measuring to the outer cladding (finished size) and the structural timber centerlines/surfaces.\n- **Grid Snapping**: If your dimensions look messy or stop short of the grid, verify the `GridTolerance` value. If the grid is further than this distance from the wall, the script will ignore the grid line.\n- **Updating Dimensions**: You can change offsets or text styles via the Properties Palette (Ctrl+1) after insertion. The script will automatically erase old lines and generate new ones upon updating a property.\n\n## FAQ\n- **Q: Why did the script run but no dimensions appeared?**\n  - A: Ensure you selected a valid `FloorGroupName` that actually contains elements or beams. Also, check if the `HSB_D-Aligned` TSL is available in your catalog.\n- **Q: How do I move the dimension lines?**\n  - A: Do not move the script insertion point to move dimensions. Instead, change the `OffsetDimensionLines` property to move the entire stack closer or further from the building.\n- **Q: Can I dimension multiple floors at once?**\n  - A: No, one instance of `HSB_D-Plan` dimensions one specific Floor Group. Insert multiple instances (one per floor) if needed."
      },
      "tokens_used": 6305,
      "error": null
    }
  }
}