{
  "filename": "MetalDataProperties.mcr",
  "status": "completed",
  "total_tokens": 49592,
  "processing_time": 216.173401594162,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.5",
            "date": "03.06.2025",
            "author": "Thorsten Huck",
            "changes": "HSB-24124 Fasteners are excluded from weight calculation"
          },
          {
            "version": "1.4",
            "date": "30.05.2023",
            "author": "Thorsten Huck",
            "changes": "HSB-19082 style data also written when changing entities. info to command line added"
          },
          {
            "version": "1.3",
            "date": "21.02.2023",
            "author": "Thorsten Huck",
            "changes": "HSB-17970  bugfix volume calculation on complex solids"
          },
          {
            "version": "1.2",
            "date": "21.02.2023",
            "author": "Thorsten Huck",
            "changes": "HSB-17970 weight calculation fixed, requires hsbDesign 25.1.65 or higher"
          },
          {
            "version": "1.1",
            "date": "15.02.2023",
            "author": "Thorsten Huck",
            "changes": "HSB-17970 weight calculation fixed, volume added to style data"
          },
          {
            "version": "1.0",
            "date": "15.12.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-17353 initial version to specify metalpart style and/or entity property data"
          }
        ],
        "settingsFiles": [
          "MetalDataProperties.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 7964,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script interacts with MetalPartCollectionEnt using PrEntity and collects entities using _kModelSpace. It performs volume and weight calculations on 3D Bodies. No sd_ prefixes, #Type E declarations, or ShopDrawing specific logic (e.g., _bOnShopDrawing) are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "MetalPartCollectionEnt"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Metal Part Collections",
          "requiredSettings": [
            "MetalDataProperties.xml"
          ]
        }
      },
      "tokens_used": 7097,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select metalparts, <Enter> to specify by style",
              "condition": "_bOnInsert",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sMaterial",
            "type": "PropString",
            "displayName": "Material",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Loaded from MetalDataProperties.xml (Material[])"
            ],
            "category": "General",
            "description": "Defines the Material"
          },
          {
            "index": 1,
            "variable": "sExcType",
            "type": "PropString",
            "displayName": "Execution Class",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Loaded from MetalDataProperties.xml (ExecutionClass[])",
              "<Varies>"
            ],
            "category": "General",
            "description": "Defines the Execution Class"
          },
          {
            "index": 2,
            "variable": "sMounting",
            "type": "PropString",
            "displayName": "Mounting",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "Loaded from MetalDataProperties.xml (Mounting[])",
              "<Varies>"
            ],
            "category": "General",
            "description": "Defines the Mounting"
          },
          {
            "index": 3,
            "variable": "sInformation",
            "type": "PropString",
            "displayName": "Information",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "General",
            "description": "Defines the Information"
          },
          {
            "index": 4,
            "variable": "sStyle",
            "type": "PropString",
            "displayName": "Style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "All MetalPartCollectionDef entries in drawing"
            ],
            "category": "General",
            "description": "Defines the Style"
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "MetalDataProperties.xml",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Settings",
              "_kPathHsbInstall\\Content\\General\\TSL\\Settings\\"
            ],
            "purpose": "Provides material definitions (Name, Grade, Density, Finish), Execution Classes, and Mounting types.",
            "required": true
          }
        ]
      },
      "tokens_used": 9405,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Assigns structural grades and fabrication attributes to metal connectors while automatically calculating weight and volume based on geometry.",
          "category": "Data Management / Properties",
          "typicalUseCase": "A user selects custom metal plates or brackets to specify the steel grade (e.g., S355) and EN 1090 Execution Class (e.g., EXC2) for production reports and BOMs."
        },
        "parameters": [
          {
            "name": "sMaterial",
            "technicalDefault": "Loaded from MetalDataProperties.xml",
            "businessMeaning": "Specifies the material composition (e.g., S235, Stainless Steel) of the metal part. This determines the density used for weight calculation.",
            "validRange": "Any material name defined in the XML settings file (e.g., Steel S355, Aluminum AlMg3).",
            "unit": "Text (String)",
            "affectsOutput": "Updates the Material attribute on the Style/Entity and recalculates the 'Weight' property stored in the Style definition based on the material's density."
          },
          {
            "name": "sExcType",
            "technicalDefault": "Loaded from MetalDataProperties.xml (EXC1, EXC2, EXC3)",
            "businessMeaning": "Defines the Execution Class according to EN 1090 standards. This indicates the production control category and required inspection rigor for the metal part.",
            "validRange": "EXC1, EXC2, EXC3, EXC4 (depending on XML configuration).",
            "unit": "Text (String)",
            "affectsOutput": "Updates the 'EXC' attribute on the Metal Part Entity instance. Does not change geometry."
          },
          {
            "name": "sMounting",
            "technicalDefault": "Loaded from MetalDataProperties.xml (Factory, On Site)",
            "businessMeaning": "Specifies the installation location or assembly method. Used to filter parts for prefabrication vs. on-site assembly lists.",
            "validRange": "Factory, On Site, or custom logistics terms defined in XML.",
            "unit": "Text (String)",
            "affectsOutput": "Updates the 'Mounting' attribute on the Metal Part Entity instance."
          },
          {
            "name": "sInformation",
            "technicalDefault": "",
            "businessMeaning": "A free-text field for additional fabrication notes, surface treatment requirements, or special instructions.",
            "validRange": "Any alphanumeric text string.",
            "unit": "Text (String)",
            "affectsOutput": "Updates the 'Information' attribute on the Metal Part Entity instance."
          },
          {
            "name": "sStyle",
            "technicalDefault": "Available MetalPartCollectionDef names",
            "businessMeaning": "Selects the specific Definition (Style) to update globally. Used to apply properties to all instances of a specific metal part at once.",
            "validRange": "List of existing Metal Part Styles in the current drawing.",
            "unit": "Text (String)",
            "affectsOutput": "Updates the Style definition, cascading material properties and recalculated weight to all entities using this style in the model."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing sMaterial",
            "effect": "Triggers a background recalculation of the metal part's volume and weight using the density associated with the new material.",
            "cascade": [
              "MetalStyleData_WEIGHT",
              "MetalStyleData_VOLUME"
            ]
          },
          {
            "trigger": "User Input at PrEntity Prompt",
            "effect": "Determines if the script runs in 'Entity Mode' (specific parts selected) or 'Style Mode' (pressed Enter to apply to a whole style).",
            "cascade": [
              "Visibility of sStyle property",
              "Scope of updates (Entity vs Definition)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "MetalPartCollectionEnt",
            "description": "Existing metal part instances are updated with user-defined attributes (Mounting, EXC, Information) and material references.",
            "appliedTo": "User-selected Metal Part Collections in Model Space."
          },
          {
            "type": "MetalPartCollectionDef",
            "description": "The underlying Style definition is updated with Material properties and calculated geometric data (Volume, Weight). This updates the data source for all instances.",
            "appliedTo": "The specific Style selected or associated with the selected entities."
          }
        ]
      },
      "tokens_used": 9821,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script loads and reads MetalDataProperties.xml settings from Company or Install path",
          "Validation checks: Materials list is populated from XML; if empty, script reports error and aborts",
          "Properties are initialized: Material, Execution Class, Mounting, Information, Style (options populated from XML and drawing definitions)",
          "If Insert Mode (_bOnInsert):",
          "Command line prompt: 'Select metalparts, <Enter> to specify by style'",
          "If user selects entities: Entities are stored in array, script enters Entity Mode",
          "If user presses Enter: No entities selected, script enters Style Mode",
          "If Entity Mode:",
          "Script retrieves existing properties (Material, EXC, Mounting, Info) from selected entities and their styles",
          "Analysis checks if properties vary between selected entities (e.g., mixed materials)",
          "If properties vary, corresponding property dropdowns show '<Varies>'",
          "User modifies properties via OPM (Properties Palette)",
          "Script updates selected Entity data (EXC, Mounting, Information)",
          "Script updates Style data (Material, Grade, Finish, Density) if Material changed or differs from style",
          "Script recalculates Volume and Weight for affected Styles based on 3D geometry (excluding fasteners)",
          "Command line reports updated data for entity and style",
          "If Style Mode:",
          "Entity selection is empty, sStyle property is visible and active",
          "User selects Style via OPM dropdown",
          "User modifies properties (typically Material) via OPM",
          "Script updates Style definition globally",
          "Script recalculates Volume and Weight for the Style based on geometry from definition (excluding fasteners)",
          "Script applies a dummy transformation to entities of that style to force update/redraw",
          "Command line reports updated style data and count of affected entities",
          "Script instance is erased (unless Debug mode is active)"
        ],
        "conditionalBranches": [
          {
            "condition": "User selection at command prompt (PrEntity)",
            "path1": {
              "name": "Entity Mode",
              "steps": [
                "Entities selected",
                "sStyle property hidden/readonly",
                "Properties map to selected entities",
                "Updates apply to selected entities only (and their definition if material changes)"
              ]
            },
            "path2": {
              "name": "Style Mode",
              "steps": [
                "User presses <Enter>",
                "sStyle property visible and required",
                "Properties map to Style definition",
                "Updates apply globally to all entities using that style"
              ]
            }
          },
          {
            "condition": "Property consistency across selected entities",
            "path1": {
              "name": "Uniform Selection",
              "steps": [
                "All selected entities share same value for a property (e.g., all S355)",
                "Property dropdown shows that specific value"
              ]
            },
            "path2": {
              "name": "Varied Selection",
              "steps": [
                "Selected entities have mixed values for a property",
                "Property dropdown shows '<Varies>'",
                "Changing the value overwrites all selected entities with new value"
              ]
            }
          },
          {
            "condition": "Material Change",
            "path1": {
              "name": "Material matches Style Definition",
              "steps": [
                "New material is identical to existing style material",
                "Only entity data is updated (if applicable)"
              ]
            },
            "path2": {
              "name": "Material differs from Style Definition",
              "steps": [
                "Style definition is updated with new material properties (Density, etc.)",
                "Weight and Volume are recalculated based on new density",
                "Style data is written back to definition"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of Material definitions in MetalDataProperties.xml",
            "errorMessage": "This tool requires material definitions defined in... Please contact your local support.",
            "recovery": "Ensure XML file exists in configured paths and contains valid 'Material[]' entries."
          },
          {
            "check": "Valid Entity Selection",
            "errorMessage": "None (Script handles empty selection as Style Mode)",
            "recovery": "If user intends to modify specific entities, they must select valid MetalPartCollectionEnt instances."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Entity Properties",
            "how": "Select the script instance in model -> Open Properties Palette (OPM) -> Change Material, EXC, Mounting, or Information",
            "effect": "Updates data on the specific entities referenced during insertion. Recalculates weight if material changes."
          },
          {
            "action": "Modify Style Properties",
            "how": "Insert script with <Enter> (Style Mode) -> Select Script Instance -> Open OPM -> Change Material or Style",
            "effect": "Updates the Style Definition, affecting all entities in the drawing using that style. Recalculates weight and volume for the style."
          }
        ]
      },
      "tokens_used": 9312,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# MetalDataProperties\n\n## Overview\nThis script allows you to assign structural attributes (Material, Execution Class, Mounting) and fabrication information to metal connectors. It automatically calculates weight and volume based on the part's geometry and the specified material density.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the model where metal parts are located. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | This is a model-level data tool, not a detailing script. |\n\n## Prerequisites\n- **Required Entities**: Metal Part Collections (e.g., custom plates or brackets) must exist in the model.\n- **Minimum Beam Count**: 0 (This script works on Metal Parts, not Timber Beams).\n- **Required Settings Files**: `MetalDataProperties.xml` (Must be located in the Company or Install `...\\TSL\\Settings` folder).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `MetalDataProperties.mcr` from the list.\n\n### Step 2: Select Parts or Define Style\n```\nCommand Line: Select metalparts, <Enter> to specify by style\n```\n**Action:** You have two options:\n- **Entity Mode**: Click to select specific metal parts in the model, then press **Enter**.\n- **Style Mode**: Press **Enter** immediately without selecting anything. This allows you to update all parts of a specific style at once.\n\n### Step 3: Configure Properties\n1. With the script object selected, open the **Properties Palette** (press `Ctrl+1`).\n2. Modify the parameters as needed (see Parameters section below).\n3. The script will automatically update the selected entities or the entire style definition and report the changes to the command line.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Material | dropdown | From XML | Defines the material grade (e.g., S355, Stainless Steel). Changing this updates the density used for weight calculation. |\n| Execution Class | dropdown | From XML | Defines the EN 1090 Execution Class (e.g., EXC2) for production standards. |\n| Mounting | dropdown | From XML | Defines where the part is installed (e.g., Factory, On Site). Useful for logistics planning. |\n| Information | text | (Empty) | Free-text field for additional notes, surface treatments, or special instructions. |\n| Style | dropdown | (Active only in Style Mode) | Selects the Metal Part Style to update globally. Only visible if you pressed Enter during insertion. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific context menu items. All interactions are handled via the Properties Palette. |\n\n## Settings Files\n- **Filename**: `MetalDataProperties.xml`\n- **Location**: `_kPathHsbCompany\\TSL\\Settings` or `_kPathHsbInstall\\Content\\General\\TSL\\Settings\\`\n- **Purpose**: Defines available Materials (with specific densities), Execution Classes, and Mounting types. If this file is missing, the script will display an error and abort.\n\n## Tips\n- **Bulk Updates**: To update hundreds of identical brackets at once, use the **Style Mode** (press Enter at the prompt) instead of selecting individual items.\n- **Mixed Selections**: If you select multiple parts that already have different settings (e.g., half are S235 and half are S355), the dropdown will display `<Varies>`. Selecting a new value from the list will overwrite all selected parts with that new value.\n- **Weight Calculation**: The script calculates weight based on the volume of the 3D body. It excludes fasteners (screws/bolts) from this calculation to ensure accurate raw material weight.\n\n## FAQ\n- **Q: Why does the \"Style\" property disappear when I select parts?**\n  A: The \"Style\" property is only available when you run the script in **Style Mode** (no entities selected). If you select specific entities, the script switches to **Entity Mode**, and the style property is hidden to prevent unintended global changes.\n  \n- **Q: I see an error about missing material definitions. What do I do?**\n  A: The script cannot find `MetalDataProperties.xml` in your standard settings folders. Contact your CAD Manager to ensure this file is deployed to the correct network or local location.\n\n- **Q: Does this change the physical shape of the metal part?**\n  A: No. This script only updates data attributes (Material, Grade, Weight, etc.) attached to the part. It does not modify the geometry."
      },
      "tokens_used": 5993,
      "error": null
    }
  }
}