{
  "filename": "hsb_DimensionSolePlate.mcr",
  "status": "completed",
  "total_tokens": 55155,
  "processing_time": 235.64382815361023,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "28.03.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.0",
            "date": "04.04.2011",
            "author": "",
            "changes": "Remove the gap between the dim lines and the object (shrink)"
          },
          {
            "version": "1.3",
            "date": "17.02.2012",
            "author": "",
            "changes": "Added internal openings and excluded walls which are sitting on their own as they were messing up the dimension lines on the external face"
          },
          {
            "version": "1.4",
            "date": "11.02.2013",
            "author": "",
            "changes": "Added check for ARX version to cater for multiple AutoCAD versions"
          },
          {
            "version": "1.5",
            "date": "12.03.2013",
            "author": "",
            "changes": "Bugfix on dimensions coming out with a point in a different Z coordinates so looking scewed"
          },
          {
            "version": "2.0",
            "date": "15.03.2013",
            "author": "",
            "changes": "Changed the way it works. External walls are now found by Wall Flag"
          },
          {
            "version": "2.1",
            "date": "24.08.2015",
            "author": "",
            "changes": "Remove write to file for dxx and changed version of autocad to check to be greater than 2012 instead of specific to 2013"
          },
          {
            "version": "2.2",
            "date": "16.02.2016",
            "author": "",
            "changes": "Added option to include/exclude external openings and splits"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8852,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select Beam or Element entities into _Beam[] and _Element[] during _bOnInsert. It processes geometry using Body and PlaneProfile operations derived from these model entities. It executes eraseInstance() after execution, which is typical of a command/utility script running in Model Space rather than a persistent Shop Drawing element."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam",
            "ElementWall"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsb_TSLDimensions2012.dll or hsb_TSLDimensions2013.dll (in Content\\UK\\TSL\\DLLs\\Dimension\\)",
            "Valid Dimension Styles (sDimStyleOutside, sDimStyleInside)"
          ]
        }
      },
      "tokens_used": 7321,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Please select Elements",
              "condition": "bDimOption == 1 (FloorPlan)",
              "required": true
            },
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Please select Soleplates",
              "condition": "bDimOption == 0 (SolePlate)",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert if _kExecuteKey is empty",
            "title": "Properties",
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimOption",
            "type": "PropString",
            "displayName": "Dimension From",
            "defaultValue": "FloorPlan",
            "inputType": "dropdown",
            "options": [
              "SolePlate",
              "FloorPlan"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimStyleOutside",
            "type": "PropString",
            "displayName": "Dimension style outside elements",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": "|Dimension styles|",
            "description": null
          },
          {
            "index": 2,
            "variable": "sDimStyleInside",
            "type": "PropString",
            "displayName": "Dimension style inside elements",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": "|Dimension styles|",
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffsetFromElementsOnOutside",
            "type": "PropDouble",
            "displayName": "Distance to the outside elements",
            "defaultValue": 500.0,
            "inputType": "number",
            "options": [],
            "category": "|Offsets|",
            "description": null
          },
          {
            "index": 1,
            "variable": "dBetweenLines",
            "type": "PropDouble",
            "displayName": "Distance between dimension lines",
            "defaultValue": 350.0,
            "inputType": "number",
            "options": [],
            "category": "|Offsets|",
            "description": null
          },
          {
            "index": 2,
            "variable": "dOffsetInternal",
            "type": "PropDouble",
            "displayName": "Offset Dimline Internal Wall",
            "defaultValue": 250.0,
            "inputType": "number",
            "options": [],
            "category": "|Offsets|",
            "description": null
          },
          {
            "index": 7,
            "variable": "sGrpNm1",
            "type": "PropString",
            "displayName": "House Level group name",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Grouping|",
            "description": ""
          },
          {
            "index": 8,
            "variable": "sGrpNm2",
            "type": "PropString",
            "displayName": "Floor Level group name",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Grouping|",
            "description": ""
          },
          {
            "index": 9,
            "variable": "sDimensionExternalOpenings",
            "type": "PropString",
            "displayName": "Dimension external openings",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "|Floor plan options|",
            "description": null
          },
          {
            "index": 10,
            "variable": "sDimensionExternalSplits",
            "type": "PropString",
            "displayName": "Dimension external splits",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "|Floor plan options|",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 10185,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates plan-view external dimension lines for timber frame walls, including overall dimensions and details for openings and wall segments.",
          "category": "Documentation / ShopDrawing",
          "typicalUseCase": "Creating or updating floor plan dimension strings for manufacturing or approval drawings. Used to quickly dimension the external envelope of a house or specific wall layouts based on sole plates or wall elements."
        },
        "parameters": [
          {
            "name": "sDimOption",
            "technicalDefault": "FloorPlan",
            "businessMeaning": "Selects the type of entity to base the dimensions on. 'SolePlate' uses the bottom plate beams, while 'FloorPlan' uses the full wall elements.",
            "validRange": "SolePlate, FloorPlan",
            "unit": "enum",
            "affectsOutput": "Determines the command prompt selection (Beams vs Elements) and the geometry source for the dimension calculation."
          },
          {
            "name": "sDimStyleOutside",
            "technicalDefault": "\"\" (Empty)",
            "businessMeaning": "The AutoCAD dimension style (text height, arrowheads, units precision) to apply to the external dimension lines.",
            "validRange": "List of valid AutoCAD Dimension Styles in the current drawing",
            "unit": "string",
            "affectsOutput": "Changes the visual appearance (font size, arrow style) of the generated dimensions."
          },
          {
            "name": "sDimStyleInside",
            "technicalDefault": "\"\" (Empty)",
            "businessMeaning": "The AutoCAD dimension style to apply to internal wall dimensions (if generated).",
            "validRange": "List of valid AutoCAD Dimension Styles in the current drawing",
            "unit": "string",
            "affectsOutput": "Visual appearance of internal dimensions."
          },
          {
            "name": "dOffsetFromElementsOnOutside",
            "technicalDefault": "500.0",
            "businessMeaning": "The gap between the outer face of the wall and the first dimension line.",
            "validRange": "100.0 - 2000.0",
            "unit": "mm",
            "affectsOutput": "Moves the entire dimension string closer to or further from the wall to avoid clashes with notes or other geometry."
          },
          {
            "name": "dBetweenLines",
            "technicalDefault": "350.0",
            "businessMeaning": "The vertical distance between the first dimension line (detail) and the second dimension line (overall).",
            "validRange": "100.0 - 1000.0",
            "unit": "mm",
            "affectsOutput": "Spacing between parallel dimension lines. (Note: Script logic may currently default to the same value as the initial offset, but this parameter controls intended spacing)."
          },
          {
            "name": "dOffsetInternal",
            "technicalDefault": "250.0",
            "businessMeaning": "The offset distance for dimension lines measuring internal wall geometry.",
            "validRange": "100.0 - 1000.0",
            "unit": "mm",
            "affectsOutput": "Controls placement of internal wall dimension strings."
          },
          {
            "name": "sGrpNm1",
            "technicalDefault": "\"\" (Empty)",
            "businessMeaning": "Parent group name (e.g., House Name or Phase) used to organize the dimension entities in the CAD system.",
            "validRange": "Any text string",
            "unit": "string",
            "affectsOutput": "Sets the directory/layer structure path (Part 1) for the generated dimensions. If empty, defaults to Layer 0."
          },
          {
            "name": "sGrpNm2",
            "technicalDefault": "\"\" (Empty)",
            "businessMeaning": "Child group name (e.g., Floor Level) used to organize the dimension entities.",
            "validRange": "Any text string",
            "unit": "string",
            "affectsOutput": "Sets the directory/layer structure path (Part 2) for the generated dimensions (e.g., 'House 1\\Ground Floor')."
          },
          {
            "name": "sDimensionExternalOpenings",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles whether individual window/door openings in external walls are dimensioned on the first line.",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "If Yes, creates detailed dimensions for widths of openings (windows/doors). If No, only provides the overall wall dimension."
          },
          {
            "name": "sDimensionExternalSplits",
            "technicalDefault": "No",
            "businessMeaning": "Toggles whether wall segments (changes in wall plane or material splits) are dimensioned on the first line.",
            "validRange": "No, Yes",
            "unit": "enum",
            "affectsOutput": "If Yes, adds points to the dimension line where walls join or change direction, breaking the dimension into smaller segments."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sGrpNm1 or sGrpNm2 is empty",
            "effect": "The generated dimensions are placed on the default layer '0' instead of a grouped layer path.",
            "cascade": [
              "sLayer"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "AutoCAD Dimensions",
            "description": "Aligned and linear dimensions representing the external envelope of the selected walls or sole plates.",
            "appliedTo": "Model Space (specifically the calculated offset perimeter of the selected entities)."
          }
        ]
      },
      "tokens_used": 10646,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Insertion initiated",
          "Check insertCycleCount; erase if > 1 to ensure single run",
          "Display Properties Dialog (OPM) for configuration (if _kExecuteKey is empty)",
          "Determine Selection Mode based on 'sDimOption' property ('SolePlate' vs 'FloorPlan')",
          "Prompt User to select Entities (Beams for SolePlate, Elements for FloorPlan)",
          "Store selection in _Beam[] or _Element[] arrays and pause for regeneration",
          "Validate selection arrays; erase instance if empty",
          "Calculate Base Point and Plane from selected geometry",
          "Process Geometry: Create shadow profiles, union bodies, and shrink outlines",
          "Filter Elements (FloorPlan mode): Identify External walls and check connectivity (skip isolated walls)",
          "Identify Outer Edges of the combined geometry profile",
          "Iterate through Outer Edges to generate Dimension Points",
          "[Conditional] Add Split Points if 'sDimensionExternalSplits' is Yes",
          "[Conditional] Add Opening Points if 'sDimensionExternalOpenings' is Yes",
          "Calculate Final Line Points (Overall dimensions) offset by 'dBetweenLines'",
          "Construct Map of Dimension data (Points, Styles, Layers)",
          "Detect AutoCAD Version (2012 vs 2013+) to select correct DLL path",
          "Call external .NET function (hsb_TSLDimensions) to generate AutoCAD entities",
          "Report Success or Errors",
          "Erase Script Instance (Self-destruct after execution)"
        ],
        "conditionalBranches": [
          {
            "condition": "Dimension Source Option (sDimOption)",
            "path1": {
              "name": "SolePlate Mode",
              "steps": [
                "Prompt: 'Please select Soleplates'",
                "Filter for Beam entities",
                "Process Beam geometry directly"
              ]
            },
            "path2": {
              "name": "FloorPlan Mode",
              "steps": [
                "Prompt: 'Please select Elements'",
                "Filter for ElementWall entities",
                "Check Wall External Flag (exposed)",
                "Check Wall Connectivity (skip isolated walls)",
                "Collect Openings (Internal vs External)"
              ]
            }
          },
          {
            "condition": "Content of First Dimension Line",
            "path1": {
              "name": "Detailed Dimensions",
              "steps": [
                "Calculate intersections with external wall ends (if Splits enabled)",
                "Calculate intersections with opening geometry (if Openings enabled)",
                "Generate chain of segments along the wall face"
              ]
            },
            "path2": {
              "name": "No Details",
              "steps": [
                "Skip specific split/opening calculation",
                "First line logic effectively skipped or empty, relying on second line for overall dimension"
              ]
            }
          },
          {
            "condition": "Grouping Properties (sGrpNm1 / sGrpNm2)",
            "path1": {
              "name": "Grouped Layer",
              "steps": [
                "Create Group path: 'sGrpNm1\\sGrpNm2'",
                "Generate temporary beam to resolve resulting Layer Name",
                "Assign dimensions to resolved Layer"
              ]
            },
            "path2": {
              "name": "Default Layer",
              "steps": [
                "Assign dimensions to Layer '0'"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Selection",
            "errorMessage": "None (Silent Exit)",
            "recovery": "Script checks if _Beam and _Element arrays are empty immediately after regeneration. If true, it erases itself. User must re-run and select objects."
          },
          {
            "check": "Element Connectivity",
            "errorMessage": "None (Silent Filter)",
            "recovery": "In FloorPlan mode, walls where `getConnectedElements().length()` is 0 are skipped to prevent skewed dimension lines. User must ensure walls are joined correctly in the model."
          },
          {
            "check": "DLL Availability",
            "errorMessage": "Report Notice: 'No Valid dll or path not found'",
            "recovery": "Script checks `arxVersion` against hardcoded paths (2012 vs 2013+). User must ensure 'hsb_TSLDimensions2012.dll' or 'hsb_TSLDimensions2013.dll' exists in the install path."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Parameters",
            "how": "Re-run Script (Command Line)",
            "effect": "Since the script calls `eraseInstance()` at the end of execution, the instance does not remain in the drawing. To change properties (offsets, styles), the user must delete the generated dimensions and re-insert/run the script with new settings."
          },
          {
            "action": "Edit Dimensions",
            "how": "Standard AutoCAD Commands",
            "effect": "The output is standard AutoCAD Dimension entities. Users can edit them using standard AutoCAD tools (Properties, grips) once the TSL script has finished and erased itself."
          }
        ]
      },
      "tokens_used": 10898,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_DimensionSolePlate.mcr\n\n## Overview\nThis script automatically generates external plan-view dimension lines for timber frame walls. It allows you to dimension overall wall lengths based on either Sole Plates or full Wall Elements, with options to include details for openings and wall segments.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script runs in Model Space to generate dimensions. |\n| Paper Space | No | Not designed for use in Paper Space layouts. |\n| Shop Drawing | No | This is a utility script; it does not create Shop Drawing entities. |\n\n## Prerequisites\n- **Required Entities**: \n  - Beams (if using \"SolePlate\" mode)\n  - ElementWalls (if using \"FloorPlan\" mode)\n- **Connectivity**: In FloorPlan mode, walls must be connected to other walls. Isolated walls are skipped to prevent skewed dimensions.\n- **Required Settings**: \n  - Valid AutoCAD Dimension Styles existing in the drawing.\n  - `hsb_TSLDimensions2012.dll` or `hsb_TSLDimensions2013.dll` must be present in the `Content\\UK\\TSL\\DLLs\\Dimension\\` folder.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Browse to and select `hsb_DimensionSolePlate.mcr`.\n\n### Step 2: Configure Properties\nUpon launching, the Properties Palette (OPM) will open automatically.\n1. Set the **Dimension From** option (SolePlate or FloorPlan).\n2. Select your desired **Dimension Styles** for outside and inside lines.\n3. Adjust **Offsets** (distances from walls and between lines) as needed.\n4. Configure **Grouping** names to organize the output layers.\n5. Set **Floor plan options** (e.g., include openings or splits).\n6. Close the Properties Palette when ready.\n\n### Step 3: Select Elements\nDepending on your configuration in Step 2, the command line will prompt you:\n\n**If \"SolePlate\" mode:**\n```\nCommand Line: Please select Soleplates\nAction: Click on the bottom plate beams representing the walls. Press Enter to finish selection.\n```\n\n**If \"FloorPlan\" mode:**\n```\nCommand Line: Please select Elements\nAction: Click on the wall elements you wish to dimension. Press Enter to finish selection.\n```\n\n### Step 4: Generation\nThe script will calculate the geometry, create the dimension lines on the specified layers, and then automatically remove itself from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimension From | dropdown | FloorPlan | Selects the source entity type: \"SolePlate\" uses bottom beams; \"FloorPlan\" uses full wall elements. |\n| Dimension style outside elements | dropdown | *Empty* | Select the AutoCAD Dimension Style for the outer dimension line. |\n| Dimension style inside elements | dropdown | *Empty* | Select the AutoCAD Dimension Style for inner/internal dimension lines. |\n| Distance to the outside elements | number | 500.0 | The gap (in mm) between the outer face of the wall and the first dimension line. |\n| Distance between dimension lines | number | 350.0 | The vertical distance (in mm) between parallel dimension lines. |\n| Offset Dimline Internal Wall | number | 250.0 | The offset distance (in mm) for dimension lines measuring internal wall geometry. |\n| House Level group name | text | *Empty* | Parent group name (e.g., House Name) used to organize layers. |\n| Floor Level group name | text | *Empty* | Child group name (e.g., Floor Level) used to organize layers. |\n| Dimension external openings | dropdown | Yes | If \"Yes\", individual widths of windows/doors are dimensioned. |\n| Dimension external splits | dropdown | No | If \"Yes\", dimensions break at changes in wall direction or material splits. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script runs once and self-deletes. No context menu options are available for a persistent instance. |\n\n## Settings Files\n- **DLL Dependencies**: `hsb_TSLDimensions2012.dll` (for AutoCAD 2012) or `hsb_TSLDimensions2013.dll` (for AutoCAD 2013+).\n- **Location**: `Content\\UK\\TSL\\DLLs\\Dimension\\`\n- **Purpose**: These .NET assemblies handle the actual creation of the AutoCAD dimension entities based on the calculated coordinates.\n\n## Tips\n- **Wall Connectivity**: Ensure external walls are properly joined. The script ignores standalone walls to prevent dimension errors.\n- **Updating Dimensions**: Since the script erases itself after running, you cannot simply right-click to edit. To update dimensions, delete the existing dimensions and run the script again.\n- **Layer Organization**: Use the *House Level* and *Floor Level* group name properties to automatically sort dimensions into the correct layer structure (e.g., `House1\\Ground Floor`).\n\n## FAQ\n- **Q: Why did some walls not get dimensioned?**\n  A: In FloorPlan mode, the script filters out isolated walls that are not connected to other walls to ensure the outer dimension line is continuous. Check your wall joins.\n- **Q: The script reports \"No Valid dll\". What do I do?**\n  A: Ensure your hsbCAD installation contains `hsb_TSLDimensions2012.dll` or `hsb_TSLDimensions2013.dll` in the correct directory path. The script checks your AutoCAD version to load the correct file.\n- **Q: Can I modify the dimensions after they are created?**\n  A: Yes. The script creates standard AutoCAD dimensions. You can use standard AutoCAD grip edits or the Properties palette to tweak them manually after generation."
      },
      "tokens_used": 7253,
      "error": null
    }
  }
}