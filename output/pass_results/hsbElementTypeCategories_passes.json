{
  "filename": "hsbElementTypeCategories.mcr",
  "status": "completed",
  "total_tokens": 36252,
  "processing_time": 365.57677578926086,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "10.06.2015",
            "author": "",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "10.06.2015",
            "author": "",
            "changes": "DbCreate with map if read from file."
          }
        ],
        "settingsFiles": [
          "ElementTypes.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 6198,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script executes entirely within _bOnInsert, updates MapObject dictionaries, and immediately calls eraseInstance(). It generates no geometry and contains no ShopDrawing (sd_) prefixes or viewport logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "None"
          ],
          "minimumBeams": 0,
          "requiredSpace": "hsbCAD Environment (MapObject access)",
          "requiredSettings": [
            "ElementTypes.xml"
          ]
        }
      },
      "tokens_used": 4652,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Script Insert (Step 1)",
            "title": "Step1",
            "dataSource": "Properties pAction, pStyle",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Script Insert (Step 2)",
            "title": "Step2",
            "dataSource": "Properties pNewStyle, pTypes (dependent on Action)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "pAction",
            "type": "PropString",
            "displayName": "|Action|",
            "defaultValue": "|New|",
            "inputType": "dropdown",
            "options": [
              "|New|",
              "|Edit|",
              "|Copy|",
              "|Rename|",
              "|Delete|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "pStyle",
            "type": "PropString",
            "displayName": "|Style to modify|",
            "defaultValue": "<Dynamic>",
            "inputType": "dropdown",
            "options": [
              "<Dynamic list from ElementTypes dictionary>"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "pNewStyle",
            "type": "PropString",
            "displayName": "|New style name|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "|If new style name is given, a new style will be created.|"
          },
          {
            "index": 3,
            "variable": "pTypes",
            "type": "PropString",
            "displayName": "|Element types|",
            "defaultValue": "<Dynamic based on context>",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "ReadFromFile",
            "handler": "ReadFromFile",
            "action": "Reloads the ElementTypes dictionary from the XML file in the company folder.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "ElementTypes.xml",
            "searchPaths": [
              "%_kPathHsbCompany%\\Element\\"
            ],
            "purpose": "Stores the dictionary of element type categories.",
            "required": false
          }
        ]
      },
      "tokens_used": 4806,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Configuration utility for creating, editing, and managing 'Style' libraries that categorize specific Element Types (e.g., Wall Parts, Floor Parts) within the project database.",
          "category": "Configuration/DataManagement",
          "typicalUseCase": "Used by a BIM Manager or Lead Detailer to define standardized groups of hsbCAD element types (like specific member subsets) which can then be selected in other scripts via dropdown menus."
        },
        "parameters": [
          {
            "name": "pAction",
            "technicalDefault": "|New|",
            "businessMeaning": "The administrative operation to perform on the Style library.",
            "validRange": "Fixed List: |New|, |Edit|, |Copy|, |Rename|, |Delete|",
            "unit": "Enum",
            "affectsOutput": "Determines which secondary dialog fields are shown and whether the MapObject database is created, updated, renamed, or deleted."
          },
          {
            "name": "pStyle",
            "technicalDefault": "<Dynamic>",
            "businessMeaning": "The target configuration name (Style) to be modified, copied, or deleted. It acts as the key for retrieving the specific list of element types.",
            "validRange": "Any existing Style name currently stored in the 'ElementTypes' dictionary.",
            "unit": "String",
            "affectsOutput": "Identifies the specific data entry in the database to be acted upon."
          },
          {
            "name": "pNewStyle",
            "technicalDefault": "",
            "businessMeaning": "The unique name for a new Style configuration, or the new name when renaming an existing one.",
            "validRange": "Any unique string not currently existing in the dictionary.",
            "unit": "String",
            "affectsOutput": "Sets the name of the new database entry or the updated name of an existing entry."
          },
          {
            "name": "pTypes",
            "technicalDefault": "<Dynamic>",
            "businessMeaning": "The actual list of Element Types (e.g., construction codes or member names) associated with the Style. This defines which specific timber elements belong to this category.",
            "validRange": "A string containing a list of element types (format dependent on downstream script usage).",
            "unit": "String List",
            "affectsOutput": "Updates the value stored in the MapObject. This value is read by other scripts to filter or assign properties to beams based on this category."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "pAction is set to |New|",
            "effect": "Prompts for pStyle (to copy defaults from), pNewStyle (required), and pTypes.",
            "cascade": [
              "pNewStyle",
              "pTypes"
            ]
          },
          {
            "trigger": "pAction is set to |Edit|",
            "effect": "Prompts for pStyle (required) and pTypes. pNewStyle is hidden/unused.",
            "cascade": [
              "pTypes"
            ]
          },
          {
            "trigger": "pAction is set to |Copy|",
            "effect": "Prompts for pStyle (source) and pNewStyle (target). pTypes is hidden/inherited from source.",
            "cascade": [
              "pNewStyle"
            ]
          },
          {
            "trigger": "pAction is set to |Rename|",
            "effect": "Prompts for pStyle and pNewStyle. pTypes is hidden.",
            "cascade": [
              "pNewStyle"
            ]
          },
          {
            "trigger": "pAction is set to |Delete|",
            "effect": "Prompts for pStyle only. Performs deletion immediately without secondary dialog for content.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "MapObject",
            "description": "Updates or deletes non-geometric data entries in the 'ElementTypes' dictionary stored in the drawing database.",
            "appliedTo": "Project Database (Global)"
          },
          {
            "type": "XML File",
            "description": "Writes the current state of the ElementTypes dictionary to 'ElementTypes.xml' in the company folder to ensure persistence across drawings.",
            "appliedTo": "File System (%_kPathHsbCompany%\\Element\\)"
          }
        ]
      },
      "tokens_used": 6651,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script execution triggered (via Insert or Right-click 'ReadFromFile').",
          "2. Check for Execute Key 'ReadFromFile' or empty local dictionary.",
          "3. [Conditional] Load data from 'ElementTypes.xml' if dictionary is empty or reload requested.",
          "4. [Conditional] If 'ReadFromFile' key was active, display success/failure message and terminate script immediately.",
          "5. Initialize and show 'Step1' Dialog: User selects 'Action' and 'Style to modify'.",
          "6. Lock 'Action' and 'Style' properties to prevent changes in subsequent steps.",
          "7. Branch execution based on selected Action:",
          "   - [New/Copy]: Show 'Step2' Dialog for 'New style name' (and 'Types' if New).",
          "   - [Edit]: Show 'Step2' Dialog for 'Element types'.",
          "   - [Rename]: Show 'Step2' Dialog for 'New style name'.",
          "   - [Delete]: Skip Step2 Dialog, proceed directly to logic.",
          "8. Perform Database Operation (dbCreate, dbRename, setMap, or dbErase).",
          "9. If database was modified, trigger recalculation of all TSLs referencing the 'ElementTypes' dictionary.",
          "10. Write current state of the dictionary to XML file in the company folder.",
          "11. Execute eraseInstance() to remove the script entity from the drawing."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Trigger Method",
            "path1": {
              "name": "Context Menu (ReadFromFile)",
              "steps": [
                "Check if XML file exists",
                "Load XML content into MapObject dictionary",
                "Report notice (Success/Warning)",
                "Erase Instance and Exit"
              ]
            },
            "path2": {
              "name": "Standard Insert",
              "steps": [
                "Proceed to Dialog Workflow (Step 1 -> Step 2 -> DB Operation)"
              ]
            }
          },
          {
            "condition": "Value of 'Action' property in Step 1",
            "path1": {
              "name": "New",
              "steps": [
                "Retrieve defaults from selected Style",
                "Show Step2: Prompt for New Name and Types",
                "Check if Name already exists",
                "Create new MapObject entry"
              ]
            },
            "path2": {
              "name": "Edit",
              "steps": [
                "Retrieve current Types from selected Style",
                "Show Step2: Prompt for Types",
                "Update MapObject entry"
              ]
            },
            "path3": {
              "name": "Copy",
              "steps": [
                "Retrieve Map from selected Style",
                "Show Step2: Prompt for New Name",
                "Check if Name already exists",
                "Create new MapObject entry with copied data"
              ]
            },
            "path4": {
              "name": "Rename",
              "steps": [
                "Show Step2: Prompt for New Name",
                "Rename existing MapObject entry"
              ]
            },
            "path5": {
              "name": "Delete",
              "steps": [
                "Check for references to the Style",
                "Erase MapObject entry or Show Warning"
              ]
            }
          },
          {
            "condition": "Name Existence (Action: New or Copy)",
            "path1": {
              "name": "Name is Unique",
              "steps": [
                "Proceed with dbCreate",
                "Set database changed flag"
              ]
            },
            "path2": {
              "name": "Name Already Exists",
              "steps": [
                "Skip dbCreate",
                "Report Notice: 'Style already exists'",
                "Continue to cleanup phase"
              ]
            }
          },
          {
            "condition": "References Check (Action: Delete)",
            "path1": {
              "name": "No References Found",
              "steps": [
                "Execute dbErase",
                "Report Notice: 'MapObject erased'",
                "Set database changed flag"
              ]
            },
            "path2": {
              "name": "References Found",
              "steps": [
                "Skip dbErase",
                "Report Notice: 'Could not be erased because it has X references'",
                "Continue to cleanup phase"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Target Style Name Uniqueness",
            "errorMessage": "Unable to create new MapObject. [StyleName] in dictionary [DictionaryName] already exists.",
            "recovery": "User must rename the style to a unique identifier."
          },
          {
            "check": "Dependency Integrity (Before Deletion)",
            "errorMessage": "MapObject [StyleName] in dictionary [DictionaryName] could not be erased because it has [X] references.",
            "recovery": "User must remove references to this style in other entities/properties before deletion."
          },
          {
            "check": "XML File Availability",
            "errorMessage": "Dictionary [DictionaryName] could not be updated from [FilePath].",
            "recovery": "Ensure 'ElementTypes.xml' exists in the company folder."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None (Script is Transient)",
            "how": "N/A",
            "effect": "The script calls eraseInstance() immediately after execution. No geometry or editable entity remains in the drawing. Changes are persisted in the MapObject database and XML file."
          }
        ]
      },
      "tokens_used": 8084,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbElementTypeCategories.mcr\n\n## Overview\nThis script serves as a configuration utility for creating, editing, and managing \"Style\" libraries that categorize specific Element Types within the project database. It allows BIM Managers to define standardized groups (categories) of hsbCAD element types which can then be selected in other scripts via dropdown menus.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be inserted in Model Space to access the project database. |\n| Paper Space | No | Not applicable. |\n| Shop Drawing | No | Not applicable. |\n\n## Prerequisites\n- **Required Entities:** None.\n- **Minimum Beam Count:** 0.\n- **Required Settings:** \n  - Access to the `ElementTypes.xml` file (typically located in the Company folder).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbElementTypeCategories.mcr`\n\n### Step 2: Select Action (Dialog 1)\nA dynamic dialog titled \"Step1\" will appear.\n1.  **Action:** Select the desired operation from the dropdown:\n    -   `|New|`: Create a brand new style category.\n    -   `|Edit|`: Modify the element types of an existing style.\n    -   `|Copy|`: Duplicate an existing style to a new name.\n    -   `|Rename|`: Change the name of an existing style.\n    -   `|Delete|`: Remove a style from the database.\n2.  **Style to modify:** Select the target style from the dropdown list (loaded from the current project database).\n3.  Click **OK** to proceed.\n\n### Step 3: Configure Details (Dialog 2)\nA second dialog titled \"Step2\" will appear based on your selected Action. The fields visible will change depending on the context:\n\n*   **If Action is |New|:**\n    *   Enter a **New style name**.\n    *   Enter the **Element types** (list of types/codes to include).\n*   **If Action is |Edit|:**\n    *   Modify the **Element types** field.\n    *   (The Style Name is locked here as it was selected in Step 1).\n*   **If Action is |Copy|:**\n    *   Enter a **New style name** for the copy.\n    *   (Element types are inherited from the source style).\n*   **If Action is |Rename|:**\n    *   Enter the **New style name**.\n*   **If Action is |Delete|:**\n    *   No second dialog appears. The script proceeds immediately to deletion logic.\n\n4.  Click **OK** to confirm changes. The script will update the database and the XML file, then automatically remove itself from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Action | dropdown | \\|New\\| | Select the administrative operation to perform (New, Edit, Copy, Rename, Delete). |\n| Style to modify | dropdown | <Dynamic> | Select the existing configuration name (Style) to act upon. |\n| New style name | text | \"\" | Enter the unique name for a new style or the target name for renaming. |\n| Element types | text | <Dynamic> | Define the list of specific Element Types associated with this Style. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| ReadFromFile | Reloads the ElementTypes dictionary from the `ElementTypes.xml` file located in the company folder. Useful for importing standards shared by other users. |\n\n## Settings Files\n- **Filename**: `ElementTypes.xml`\n- **Location**: `%_kPathHsbCompany%\\Element\\`\n- **Purpose**: Stores the dictionary of element type categories to ensure data persistence across different drawings and sessions.\n\n## Tips\n- **Self-Cleaning Script:** This script does not leave a traceable entity in the drawing. It executes, updates the background database/XML, and erases itself immediately.\n- **Unique Names:** When creating a new style, ensure the \"New style name\" is unique. If a duplicate is detected, the script will notify you and skip the creation.\n- **Safe Deletion:** The script checks for dependencies before deleting. If a style is currently being used by other objects in the project, the deletion will fail with a warning message to prevent data corruption.\n\n## FAQ\n- **Q: Where did the script go after I ran it?**\n  - A: This is a \"transient\" script. It calls `eraseInstance()` immediately after finishing its task. You will not find an entity to click or edit later.\n- **Q: How do I share my configurations with colleagues?**\n  - A: The script automatically writes to `ElementTypes.xml` in the shared company folder. Your colleagues can use the \"ReadFromFile\" right-click option on the script to update their local databases with your changes.\n- **Q: Why did the Delete action fail?**\n  - A: The script prevents deletion if the Style is still referenced by other elements in the project. Remove those references first to delete the style."
      },
      "tokens_used": 5861,
      "error": null
    }
  }
}