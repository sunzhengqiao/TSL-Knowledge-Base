{
  "filename": "hsbT-Connection.mcr",
  "status": "completed",
  "total_tokens": 52038,
  "processing_time": 232.08997225761414,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9248,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No usage of _Viewport, sd_*, Multipage*, or ShopDrawing-specific entities. The script creates tools (Cut, BeamCut) on GenBeam objects and manipulates geometry (Point3d, Vector3d, Body), which is characteristic of 3D model processing. The script uses _bOnInsert and insert logic for interacting with the model database."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space containing at least two intersecting beams (one male, one female)",
          "requiredSettings": []
        }
      },
      "tokens_used": 5599,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dDistance",
            "type": "PropDouble",
            "displayName": "(A) Depth/Distance",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the depth (+) or distance (-) of the connection"
          },
          {
            "index": 1,
            "variable": "dGap",
            "type": "PropDouble",
            "displayName": "(B) Gap",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the Gap"
          },
          {
            "index": 5,
            "variable": "sRotatedBeam",
            "type": "PropString",
            "displayName": "Rotated Beam",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Geometry",
            "description": "Flag to indicate whether the beamcut should follow the rotated beam. If the property is set to No the beamcut is perpendicular to the female beam. If the property is set to Yes the beamcut follows the rotated male beam"
          },
          {
            "index": 2,
            "variable": "dMaxLength",
            "type": "PropDouble",
            "displayName": "(C) Max. Stud Length",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Filter",
            "description": "Defines the maximal allowed length of the male beam"
          },
          {
            "index": 1,
            "variable": "sRule",
            "type": "PropString",
            "displayName": "(D) Element Rule",
            "defaultValue": "Disabled",
            "inputType": "dropdown",
            "options": [
              "Disabled",
              "Exclude bottom, top and angled plate",
              "Only studs against top plate"
            ],
            "category": "Filter",
            "description": "Defines a rule to filter certain types"
          },
          {
            "index": 2,
            "variable": "sColorFilter",
            "type": "PropString",
            "displayName": "(E) byColor/Beamtype",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Filter Male Beams",
            "description": "Defines a filter based on colors and/or beamtypes. Separate multiple entries by a semicolon. (';') negative values are excluding beams with the corresponding color, Positive values will only accept beams with the selected colors. Any negative value will disable potential positive values."
          },
          {
            "index": 3,
            "variable": "sWidthFilter",
            "type": "PropString",
            "displayName": "(F) byWidth",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Filter Male Beams",
            "description": "Defines a filter based on the width. Separate multiple entries by a semicolon. (';') negative values are excluding beams with the corresponding width, Positive values will only accept beams with the selected width. Any negative value will disable potential positive values."
          },
          {
            "index": 6,
            "variable": "sBeamCodeFormat",
            "type": "PropString",
            "displayName": "byBeamCode/byFormat",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Filter Male Beams",
            "description": "Defines a filter based on the beamcode or Format, but not both. Format can have multiple entries separated by a semicolon. (';') When using beamcode the user should only define one string for the bea"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Reset + Erase",
            "handler": "|Reset + Erase|",
            "action": "Adds a static cut tool at the insertion point and erases the script instance",
            "alsoTriggeredBy": "Double-Click"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9529,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of structural T-connections between a male beam (stud/joist) and female beams (plates), generating precise pocket cuts and beam trimming.",
          "category": "Framing/Joinery",
          "typicalUseCase": "Connecting studs to top/bottom plates in timber frame walls, or joists to beams, ensuring proper depth of cut and clearance."
        },
        "parameters": [
          {
            "name": "dDistance",
            "technicalDefault": "0",
            "businessMeaning": "Defines the depth of the pocket/mortise cut into the female beam. A positive value cuts into the female beam to accommodate the male beam. A negative value indicates a gap distance (no cut generated, just a visual symbol).",
            "validRange": "-50 to 300 mm",
            "unit": "mm",
            "affectsOutput": "Controls the depth of the BeamCut on the female beam and the trim length of the male beam. If value <= 0, only a visual contact symbol is drawn; no physical cut is applied to the female beam."
          },
          {
            "name": "dGap",
            "technicalDefault": "0",
            "businessMeaning": "Specifies the clearance tolerance around the male beam within the pocket cut. This ensures the male beam fits loosely without binding.",
            "validRange": "0 to 10 mm",
            "unit": "mm",
            "affectsOutput": "Expands the cutting profile of the BeamCut on the female beam. A value of 0 results in a tight fit (flush with male beam dimensions)."
          },
          {
            "name": "sRotatedBeam",
            "technicalDefault": "No",
            "businessMeaning": "Determines the orientation of the cut face on the female beam relative to the male beam's rotation.",
            "validRange": "Dropdown (No, Yes)",
            "unit": "enum",
            "affectsOutput": "If 'No', the cut face on the female beam is perpendicular to the female beam's axis. If 'Yes', the cut face aligns with the rotation of the male beam (useful for skewed/non-perpendicular connections)."
          },
          {
            "name": "dMaxLength",
            "technicalDefault": "0",
            "businessMeaning": "Filters potential male beams based on length. Only beams shorter than or equal to this length are processed.",
            "validRange": "0 to 6000 mm (0 implies no limit)",
            "unit": "mm",
            "affectsOutput": "Prevents the script from creating connections on long beams (e.g., preventing full-length plates from being treated as studs)."
          },
          {
            "name": "sRule",
            "technicalDefault": "Disabled",
            "businessMeaning": "Applies logical filtering based on the element's structural role (e.g., identifying top plates vs. studs).",
            "validRange": "Dropdown (Disabled, Exclude bottom/top/angled, Only studs against top plate)",
            "unit": "enum",
            "affectsOutput": "Suppresses connection generation if the beam roles do not match the selected rule (e.g., skipping connections on angled plates)."
          },
          {
            "name": "sColorFilter",
            "technicalDefault": "",
            "businessMeaning": "Filters male beams by their assigned color index or beam type string. Allows selective connection of specific material grades or types.",
            "validRange": "String (e.g., '1;2' or 'C24')",
            "unit": "text",
            "affectsOutput": "Restricts processing to only male beams matching the specified color/beamtype codes."
          },
          {
            "name": "sWidthFilter",
            "technicalDefault": "",
            "businessMeaning": "Filters male beams by their cross-sectional width.",
            "validRange": "String (e.g., '60;45')",
            "unit": "text/mm",
            "affectsOutput": "Restricts processing to only male beams matching the specified width(s)."
          },
          {
            "name": "sBeamCodeFormat",
            "technicalDefault": "",
            "businessMeaning": "Filters male beams based on specific tokens within their BeamCode property or their Format name.",
            "validRange": "String (e.g., '@(BeamCode:T1)=BSH')",
            "unit": "text",
            "affectsOutput": "Provides granular filtering based on naming conventions or coding standards of the beams."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dDistance > 0",
            "effect": "Enables the creation of the BeamCut tool on the female beams and the Cut tool on the male beam.",
            "cascade": [
              "dGap"
            ]
          },
          {
            "trigger": "dDistance <= 0",
            "effect": "Suppresses all tooling generation; only displays a graphical contact symbol.",
            "cascade": []
          },
          {
            "trigger": "sRotatedBeam = 'Yes'",
            "effect": "Changes the calculation of the cut length (dX) to follow the male beam's rotation, altering the shape of the BeamCut.",
            "cascade": []
          },
          {
            "trigger": "dGap > 0",
            "effect": "Expands the profile of the cut on the female beam to create clearance.",
            "cascade": [
              "dDistance"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Cut",
            "description": "A trim operation applied to the male beam to shorten it to the intersection point plus the specified distance.",
            "appliedTo": "Male Beam"
          },
          {
            "type": "BeamCut",
            "description": "A pocket/mortise cut into the female beam(s) to accommodate the cross-section of the male beam, adjusted for gap and rotation.",
            "appliedTo": "Female Beam(s)"
          },
          {
            "type": "Visual Symbol",
            "description": "Graphical representation of the connection (circle/lines) when distance is <= 0 or for visual reference.",
            "appliedTo": "Model Space"
          }
        ]
      },
      "tokens_used": 10178,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch: User executes the script from the palette or command line.",
          "2. Input Selection Method Attempt 1: Script checks for a selected Element or Set.",
          "3. Input Selection Method Attempt 2: If no Element, prompts user to select a Male Beam (Stud/Joist).",
          "4. Female Beam Selection: Prompts user to select Female Beam(s) or press Enter to auto-search all intersecting beams.",
          "5. Filtering: Applies filter rules (MaxLength, Color, Width, BeamCode, Element Rule) to the candidate beams.",
          "6. Validation: Checks if exactly one valid Male and at least one valid Female are identified. If not, script enters Wait State or Erases.",
          "7. Geometry Calculation: Calculates intersection points and coordinate systems (Male vs Female).",
          "8. Processing Branch: Checks the 'Depth/Distance' (dDistance) property to determine tooling or visual mode.",
          "9. Tooling Generation: Applies 'Cut' to Male beam and 'BeamCut' to Female beams (if dDistance > 0).",
          "10. Finalize: Assigns script to Element/Group and displays graphical feedback."
        ],
        "conditionalBranches": [
          {
            "condition": "Selection Method during Insertion",
            "path1": {
              "name": "Element/Set Based",
              "steps": [
                "User selects an Element or Set in the model.",
                "Script retrieves beams associated with that Element/Set.",
                "Script attempts to automatically identify Male and Female roles within that collection."
              ]
            },
            "path2": {
              "name": "Manual Beam Selection",
              "steps": [
                "User is prompted to click a specific Male beam.",
                "User is prompted to select specific Female beams.",
                "User presses Enter without selection to trigger global model search for intersecting beams."
              ]
            }
          },
          {
            "condition": "Value of 'Depth/Distance' (dDistance)",
            "path1": {
              "name": "Physical Connection (dDistance > 0)",
              "steps": [
                "Script generates a 'Cut' tool on the Male beam to trim it.",
                "Script generates 'BeamCut' tools on the Female beams to create pockets.",
                "Script applies 'Gap' expansion to the cut profiles."
              ]
            },
            "path2": {
              "name": "Visual Contact Only (dDistance <= 0)",
              "steps": [
                "Script suppresses all physical tooling (Cut/BeamCut).",
                "Script draws graphical symbols (circles/lines) representing the connection location.",
                "If dDistance is negative, draws a gap indicator line."
              ]
            }
          },
          {
            "condition": "Value of 'Rotated Beam' (sRotatedBeam)",
            "path1": {
              "name": "Perpendicular Cut (No)",
              "steps": [
                "Cut length (dX) is calculated based on the Female beam's dimensions.",
                "Cut face is perpendicular to the Female beam axis."
              ]
            },
            "path2": {
              "name": "Rotated Cut (Yes)",
              "steps": [
                "Cut length (dX) is calculated based on the intersection of the Male and Female bodies.",
                "Cut face aligns with the rotation of the Male beam."
              ]
            }
          },
          {
            "condition": "Context Menu / Recalc Trigger",
            "path1": {
              "name": "Standard Recalc",
              "steps": [
                "Updates geometry based on changed properties (OPM) or beam movement.",
                "Re-runs filtering and tooling generation."
              ]
            },
            "path2": {
              "name": "Reset + Erase",
              "steps": [
                "Applies a static 'Cut' tool to the Male beam at the current location.",
                "Erases the script instance from the model.",
                "Leaves only the static geometry behind."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Line-Plane Intersection validity",
            "errorMessage": "Script Name + ' Unexpected'",
            "recovery": "The script automatically erases itself. User must ensure beams intersect correctly or are not parallel."
          },
          {
            "check": "Beam Detection",
            "errorMessage": "None explicit, but script enters 'Wait State'",
            "recovery": "User must add valid beams to the element or select valid beams that match the filter criteria."
          },
          {
            "check": "Filter Criteria (Color, Width, BeamCode)",
            "errorMessage": "None",
            "recovery": "If filters are too restrictive, no connections are made. User must adjust filter properties in the OPM."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Geometry Parameters",
            "how": "Properties Palette (OPM)",
            "effect": "Changing Depth, Gap, or Rotated Beam updates the cut geometry immediately. Changing Distance from <=0 to >0 converts symbols to physical cuts."
          },
          {
            "action": "Adjust Filters",
            "how": "Properties Palette (OPM)",
            "effect": "Changing MaxLength, Color, or Width filters can add or remove connections to nearby beams dynamically."
          },
          {
            "action": "Reset + Erase",
            "how": "Right-click Context Menu or Double-Click",
            "effect": "Freezes the current connection as a static cut and deletes the script instance, preventing further automatic updates."
          }
        ]
      },
      "tokens_used": 10563,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbT-Connection\n\n## Overview\nAutomates the creation of structural T-connections between a male beam (stud/joist) and female beams (plates). It generates precise pocket cuts into the female beams and trims the male beam to length based on specified depth, gap, and rotation parameters.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D GenBeam entities. |\n| Paper Space | No | Not supported in layout views. |\n| Shop Drawing | No | Does not process 2D shop drawings. |\n\n## Prerequisites\n- **Required entities**: At least two `GenBeam` entities (beams).\n- **Minimum beam count**: 2 (one Male beam, one or more Female beams).\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbT-Connection.mcr`\n\n### Step 2: Select Male Beam\n```\nCommand Line: Select male beam:\nAction: Click on the stud or joist that will connect into the other beams.\n```\n\n### Step 3: Select Female Beams\n```\nCommand Line: Select female beams / <Enter> for search:\nAction: Click the plate or beam(s) that need the pocket cut. Alternatively, press Enter to automatically search the model for intersecting beams.\n```\n\n### Step 4: Confirm and Generate\n```\nCommand Line: \nAction: Press Enter to finish selection and generate the connection tools.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| (A) Depth/Distance | Number | 0 | **(+) Depth:** Cuts into the female beam by this amount.<br>**(-) Distance:** Creates a visual symbol only (no physical cut). |\n| (B) Gap | Number | 0 | Defines the clearance tolerance around the male beam within the pocket cut. |\n| Rotated Beam | Dropdown | No | If \"Yes\", the cut face aligns with the rotation of the male beam. If \"No\", the cut is perpendicular to the female beam. |\n| (C) Max. Stud Length | Number | 0 | Filters male beams by length. Only beams shorter than this value are processed (0 = no limit). |\n| (D) Element Rule | Dropdown | Disabled | Logical filter to exclude specific plates (e.g., bottom/top) or only connect studs against top plates. |\n| (E) byColor/Beamtype | Text | | Filter male beams by color index or beam type. Separate entries with semicolons (e.g., \"1;2\"). |\n| (F) byWidth | Text | | Filter male beams by width. Separate entries with semicolons (e.g., \"60;45\"). |\n| byBeamCode/byFormat | Text | | Filter male beams by a specific token in their BeamCode or Format name. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Reset + Erase | Applies a static cut to the male beam at the current location and erases the script instance, preventing further updates. (Also triggered by Double-Click). |\n\n## Settings Files\nNone.\n\n## Tips\n- **Visual Mode**: Set **Depth/Distance** to `0` or a negative value to generate a graphical symbol without cutting the beams. This is useful for planning layouts without committing to geometry changes.\n- **Bulk Processing**: If working with a framed wall, you can use the \"Select female beams / <Enter> for search\" option to automatically find all plates intersecting a single stud, rather than picking them manually.\n- **Locking Connections**: If you want to prevent the script from updating if beams are moved later, double-click the script instance (or use Right-Click > Reset + Erase) to bake the cut into static geometry.\n\n## FAQ\n- **Q: Why did the script generate a symbol but not cut my beams?**\n  A: Check the **(A) Depth/Distance** property. If the value is `0` or negative, the script creates a visual symbol only. Change it to a positive value (e.g., 50mm) to generate physical cuts.\n\n- **Q: The script is missing some studs in my wall.**\n  A: Check your filter settings. If **(C) Max. Stud Length** is set too low, or the **(E) byColor/Beamtype** filter excludes the color/type of your studs, they will be ignored.\n\n- **Q: How do I undo the connection after using \"Reset + Erase\"?**\n  A: You cannot \"undo\" this action via the script because the script instance is deleted. You must manually use the AutoCAD `UNDO` command to revert to the state before the script was erased."
      },
      "tokens_used": 6921,
      "error": null
    }
  }
}