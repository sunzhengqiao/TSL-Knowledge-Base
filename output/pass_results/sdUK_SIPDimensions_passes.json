{
  "filename": "sdUK_SIPDimensions.mcr",
  "status": "completed",
  "total_tokens": 50296,
  "processing_time": 615.9503498077393,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "Consumes any GenBeam and creates several dimrequests in dependency of the contour and containg drills",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "13.07.2012",
            "author": "Chirag Sawjani (csawjani@itw-industry.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "mapIO_GetArcPLine.mcr"
        ]
      },
      "tokens_used": 7289,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ShopDrawing",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "Filename prefix 'sdUK_', explicit comment 'This tsl is only executed by the shopdraw engine', usage of 'addDimRequest()' function, dependency on 'mapIO_GetArcPLine.mcr', and implementation of '_bOnMapIO' for multipage configuration."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Must be attached to a GenBeam processed within a Shopdrawing multipage generation.",
          "requiredSettings": [
            "mapIO_GetArcPLine.mcr",
            "Layout definition containing Stereotypes: Contour, Extremes, Beamcut, Opening"
          ]
        }
      },
      "tokens_used": 6722,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getGenBeam\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"Select point near tool\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"ShowDialog\",\n      \"trigger\": \"On MapIO (_bOnMapIO)\",\n      \"title\": \"Properties\",\n      \"dataSource\": \"OPM Properties defined in script\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"ChainContentDrill\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Chain Content Drill\",\n      \"defaultValue\": \"Chain Dimension\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Chain Dimension\",\n        \"Chain Dimension with Diameter\",\n        \"Diameter only\",\n        \"Diameter at Reference Point\",\n        \"Individual Diameter at Drill Point\",\n        \"Suppress Drill Dimensions\"\n      ],\n      \"category\": null,\n      \"description\": \"Defines the text content of the chain dimension points\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"DiameterUnit\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Diameter Units\",\n      \"defaultValue\": \"DWG Unit\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"DWG Unit\",\n"
      },
      "tokens_used": 9754,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of detailed dimension requests for SIP (Structural Insulated Panel) shop drawings, including linear dimensions, drill sizes, angles, and contours based on specific layout stereotypes.",
          "category": "ShopDrawing",
          "typicalUseCase": "Applied during batch shop drawing generation to ensure beams are dimensioned according to UK timber framing standards, specifically controlling how drills, cuts, and overall extents are annotated."
        },
        "parameters": [
          {
            "name": "ChainContentDrill",
            "technicalDefault": "\"Chain Dimension\"",
            "businessMeaning": "Specifies the textual information displayed at dimension points along a chain dimension for drill holes (e.g., just the position, or position plus diameter).",
            "validRange": "Selection list: Chain Dimension, Chain Dimension with Diameter, Diameter only, etc.",
            "unit": "N/A",
            "affectsOutput": "Alters the text labels on dimension lines associated with drill holes."
          },
          {
            "name": "DiameterUnit",
            "technicalDefault": "\"DWG Unit\"",
            "businessMeaning": "Defines the unit of measurement (mm, inches, etc.) used specifically for displaying diameter or radius values in dimension text.",
            "validRange": "DWG Unit, m, cm, mm, in, ft",
            "unit": "String",
            "affectsOutput": "Converts numerical values for drill diameters to the specified unit."
          },
          {
            "name": "AddExtremes",
            "technicalDefault": "\"No\"",
            "businessMeaning": "Determines whether an additional dimension line is created showing the overall extreme lengths of the beam element.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If Yes, adds an extra dimension request spanning the maximum extents of the beam."
          },
          {
            "name": "AddAngles",
            "technicalDefault": "\"Add\"",
            "businessMeaning": "Controls the generation of angular dimensions for non-orthogonal cuts or contours.",
            "validRange": "Add, Add and suppress same angle near by, Do not show",
            "unit": "Option",
            "affectsOutput": "Adds angular dimensions to the view, potentially filtering out redundant angles."
          },
          {
            "name": "SegmentToArcLength",
            "technicalDefault": "5 mm",
            "businessMeaning": "Sets the maximum length of a straight segment that the script should attempt to interpret as part of an arc (smoothing tolerance).",
            "validRange": "1 mm to 50 mm",
            "unit": "mm",
            "affectsOutput": "Affects how the script interprets the beam contour; small segments are treated as arcs if below this value."
          },
          {
            "name": "ExtrProfDimMode",
            "technicalDefault": "\"Low Detail\"",
            "businessMeaning": "Sets the level of detail for dimensioning the extrusion profile (cross-section) of the beam.",
            "validRange": "Low Detail, High Detail, Do not show",
            "unit": "Option",
            "affectsOutput": "Changes the number of dimension points generated for the profile shape."
          },
          {
            "name": "StereotypeOppositeDrill",
            "technicalDefault": "\"No\"",
            "businessMeaning": "If enabled, applies a specific drawing stereotype to drills located on the side of the beam opposite to the current view.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "Changes the graphical style/layer of opposite-side drills."
          },
          {
            "name": "DrawDrillCircles",
            "technicalDefault": "\"\"",
            "businessMeaning": "A configuration string to force the drawing of 2D circles for drills, allowing specific color codes to be applied.",
            "validRange": "String (e.g., '*;*', '4;5')",
            "unit": "String",
            "affectsOutput": "Generates visual circle entities for drills instead of standard machining symbols."
          },
          {
            "name": "StereotypeContour",
            "technicalDefault": "\"Contour\"",
            "businessMeaning": "Assigns a specific drawing stereotype (style/layer) to dimensions measuring the outer contour of the beam.",
            "validRange": "Any string (matches Layout Definition), or '---' to suppress",
            "unit": "String",
            "affectsOutput": "Links contour dimensions to specific CAD layers/line styles."
          },
          {
            "name": "StereotypeExtremes",
            "technicalDefault": "\"Extremes\"",
            "businessMeaning": "Assigns a specific drawing stereotype to dimensions measuring the overall extremes (length/height) of the beam.",
            "validRange": "Any string, or '---' to suppress",
            "unit": "String",
            "affectsOutput": "Links extreme dimensions to specific CAD layers/line styles."
          },
          {
            "name": "StereotypeBeamcut",
            "technicalDefault": "\"Beamcut\"",
            "businessMeaning": "Assigns a specific drawing stereotype to dimensions measuring machining features like housings or cuts.",
            "validRange": "Any string, or '---' to suppress",
            "unit": "String",
            "affectsOutput": "Links beamcut dimensions to specific CAD layers/line styles."
          },
          {
            "name": "StereotypeOpening",
            "technicalDefault": "\"Opening\"",
            "businessMeaning": "Assigns a specific drawing stereotype to dimensions measuring internal openings or voids.",
            "validRange": "Any string, or '---' to suppress",
            "unit": "String",
            "affectsOutput": "Links opening dimensions to specific CAD layers/line styles."
          },
          {
            "name": "DimAnglesOffset",
            "technicalDefault": "25 mm",
            "businessMeaning": "The offset distance from the beam edge where angular dimension lines are placed.",
            "validRange": "5 mm - 100 mm",
            "unit": "mm",
            "affectsOutput": "Adjusts the position of angular dimension text/lines relative to the geometry."
          },
          {
            "name": "_Pt0",
            "technicalDefault": "User Selection",
            "businessMeaning": "A reference point picked near the tool/element during insertion to define the location of the dimensioning tool relative to the beam.",
            "validRange": "3D Point",
            "unit": "Coord",
            "affectsOutput": "Defines the origin or reference side for calculating dimension lines."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "ChainContentDrill set to 'Suppress Drill Dimensions'",
            "effect": "All logic for generating drill-related dimensions is bypassed.",
            "cascade": [
              "DiameterUnit",
              "StereotypeOppositeDrill",
              "DrawDrillCircles"
            ]
          },
          {
            "trigger": "Any Stereotype parameter set to '---'",
            "effect": "Dimension requests of that specific type (e.g., Beamcut) are not generated.",
            "cascade": []
          },
          {
            "trigger": "DiameterUnit changed",
            "effect": "Numeric display for diameters is recalculated based on the selected unit.",
            "cascade": [
              "ChainContentDrill"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "DimRequestPoint",
            "description": "Points defining linear dimensions for contours, openings, and overall beam extents.",
            "appliedTo": "Processed GenBeam in Shopdrawing"
          },
          {
            "type": "DimRequest",
            "description": "Dimension requests for angles and arcs.",
            "appliedTo": "Processed GenBeam in Shopdrawing"
          },
          {
            "type": "Circle (Entity)",
            "description": "2D graphical circles representing drills (optional, based on configuration).",
            "appliedTo": "Shopdrawing View"
          }
        ]
      },
      "tokens_used": 9308,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched by Shopdrawing Engine or Manual Insert",
          "Check execution context: _bOnInsert vs _bOnMapIO",
          "[Insert Mode] Prompt user to select a GenBeam",
          "[Insert Mode] Prompt user to select a reference point near the tool",
          "[Insert Mode] Attach script instance to GenBeam and store _Pt0",
          "[MapIO Mode] Read existing configuration from _Map (CustomMapSettings)",
          "[MapIO Mode] Initialize Property defaults if not found in _Map",
          "[MapIO Mode] Display Properties Dialog (ShowDialog)",
          "[MapIO Mode] Update _Map with new values from Dialog",
          "[Execution Mode] Retrieve assigned GenBeam and reference point _Pt0",
          "[Execution Mode] Calculate view vectors (vxView, vyView, vzView) based on Plan/Front/Side views",
          "[Execution Mode] Generate envelope polygons (plEnvelope) for contour and inner elements",
          "[Execution Mode] Analyze Drill operations: Filter parallel drills, calculate diameters, apply ChainContentDrill logic",
          "[Execution Mode] Loop through Envelope segments (Outer Contour, Openings)",
          "[Execution Mode] Generate Linear Dimensions for Contour/Openings (checking Stereotype '---' suppression)",
          "[Execution Mode] Analyze Beamcuts (Simple Housing, Dado) for additional dimensions",
          "[Execution Mode] Add Angular Dimensions (based on AddAngles setting)",
          "[Execution Mode] Add Extremes Dimensions (if AddExtremes is Yes)",
          "Submit all generated DimRequests to the Shopdrawing Engine"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Mode: _bOnInsert",
            "path1": {
              "name": "Manual Insertion",
              "steps": [
                "getGenBeam() waits for selection",
                "getPoint() waits for reference point",
                "Script exits (return)"
              ]
            },
            "path2": {
              "name": "Shopdrawing Generation (MapIO)",
              "steps": [
                "Initialize Properties from _Map",
                "Show Configuration Dialog",
                "Proceed to Dimension Generation Logic"
              ]
            }
          },
          {
            "condition": "Stereotype Property Value (Contour/Extremes/Beamcut/Opening)",
            "path1": {
              "name": "Stereotype equals '---'",
              "steps": [
                "Skip generation of dimension requests for that specific category"
              ]
            },
            "path2": {
              "name": "Stereotype is valid string",
              "steps": [
                "Generate dimension requests and assign the specific Stereotype"
              ]
            }
          },
          {
            "condition": "ChainContentDrill Property",
            "path1": {
              "name": "Suppress Drill Dimensions",
              "steps": [
                "Skip all logic related to drilling operations"
              ]
            },
            "path2": {
              "name": "Specific Text Mode Selected",
              "steps": [
                "Generate drill points",
                "Calculate diameter based on DiameterUnit",
                "Attach text/diameter info to dimension node"
              ]
            }
          },
          {
            "condition": "Beamcut Geometry vs Outline (Linear Dimension Check)",
            "path1": {
              "name": "Distance from outline > Size of cut",
              "steps": [
                "Generate linear dimension (x/y) for the beamcut"
              ]
            },
            "path2": {
              "name": "Distance from outline <= Size of cut",
              "steps": [
                "Suppress linear dimension, assume it is implied by outline"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "GenBeam Selection",
            "errorMessage": "Implicit in getGenBeam() prompt",
            "recovery": "User must select a valid GenBeam entity"
          },
          {
            "check": "Reference Point Selection",
            "errorMessage": "Implicit in getPoint() prompt",
            "recovery": "User must pick a point in 3D space to define tool orientation/location"
          },
          {
            "check": "Stereotype Existence",
            "errorMessage": "Dimensions might not appear if Stereotype names do not match Layout Definition",
            "recovery": "User must ensure Layout Definition contains Stereotypes matching the script properties (e.g., 'Contour', 'Extremes')"
          },
          {
            "check": "Dependency Script Availability",
            "errorMessage": "Script 'mapIO_GetArcPLine.mcr' missing",
            "recovery": "Ensure mapIO_GetArcPLine.mcr is in the drawing or search path"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensioning Properties",
            "how": "AutoCAD Properties Palette (OPM) or Right-Click Properties",
            "effect": "Updates behavior immediately upon recalculation (e.g., changing Drill text style, adding/removing extreme dimensions, toggling angle display)."
          },
          {
            "action": "Move/Stretch Script Instance (Grips)",
            "how": "Select script instance in CAD, use grips to move",
            "effect": "Updates the reference point _Pt0, potentially flipping the dimension side if moved across the centerline."
          },
          {
            "action": "Regenerate Shopdrawing",
            "how": "Update the source GenBeam geometry or regenerate the Layout",
            "effect": "Script re-executes, recalculating dimensions based on new geometry (new cuts, holes, sizes)."
          }
        ]
      },
      "tokens_used": 9766,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# sdUK_SIPDimensions.mcr\n\n## Overview\nThis script automates the creation of detailed dimension requests for Structural Insulated Panel (SIP) shop drawings. It generates linear dimensions, drill annotations, angle dimensions, and contour measurements based on specific layout stereotypes and user configurations.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Partial | Script is attached to beams in Model Space but does not generate visible geometry there. |\n| Paper Space | Yes | Dimensions are generated here when the Shopdrawing Layout is processed. |\n| Shop Drawing | Yes | This is the primary environment; the script is executed by the Shopdrawing engine. |\n\n## Prerequisites\n- **Required entities**: One or more `GenBeam` entities (typically representing Structural Insulated Panels).\n- **Minimum beam count**: 1.\n- **Required settings files**: \n  - Dependency script `mapIO_GetArcPLine.mcr` must be available in the TSL search path.\n  - **Layout Definition**: Must contain the Stereotypes: \"Contour\", \"Extremes\", \"Beamcut\", and \"Opening\" (or custom names matching the script properties).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT` â†’ Select `sdUK_SIPDimensions.mcr` from the list.\n\n### Step 2: Select Element\n```\nCommand Line: Select GenBeam\nAction: Click on the timber beam or SIP element you wish to dimension.\n```\n\n### Step 3: Set Reference Point\n```\nCommand Line: Select point near tool\nAction: Click in the 3D model to define the side or location where the dimensioning logic should originate relative to the beam.\n```\n*(Note: After these steps, the script is attached to the element. Actual dimensions appear when the Shopdrawing is generated.)*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| ChainContentDrill | dropdown | Chain Dimension | Defines the text content for chain dimensions at drill points (e.g., position only, or position + diameter). |\n| DiameterUnit | dropdown | DWG Unit | Sets the unit of measurement for drill diameter annotations (mm, in, etc.). |\n| AddExtremes | dropdown | No | If \"Yes\", adds an overall dimension line showing the total length/height of the beam. |\n| AddAngles | dropdown | Add | Controls the display of angular dimensions for non-orthogonal cuts. Options include suppressing duplicate nearby angles. |\n| SegmentToArcLength | number | 5 mm | Maximum length for a straight segment to be treated as an arc (smoothing tolerance). |\n| ExtrProfDimMode | dropdown | Low Detail | Level of detail for dimensioning the beam's cross-section (Low, High, or None). |\n| StereotypeOppositeDrill | dropdown | No | If \"Yes\", applies a specific stereotype to drills located on the side of the beam opposite to the current view. |\n| DrawDrillCircles | text | | Configuration string to force the drawing of 2D circles for drills instead of standard machining symbols. |\n| StereotypeContour | text | Contour | Assigns a specific stereotype (style/layer) to dimensions measuring the outer contour. Use '---' to suppress. |\n| StereotypeExtremes | text | Extremes | Assigns a specific stereotype to overall extreme dimensions. Use '---' to suppress. |\n| StereotypeBeamcut | text | Beamcut | Assigns a specific stereotype to dimensions for machining features like housings. Use '---' to suppress. |\n| StereotypeOpening | text | Opening | Assigns a specific stereotype to dimensions for internal openings. Use '---' to suppress. |\n| DimAnglesOffset | number | 25 mm | The offset distance from the beam edge where angular dimension lines are placed. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Properties | Opens the AutoCAD Properties Palette (OPM) to configure the dimensioning parameters listed above. |\n| Recalculate | Manually forces the script to re-run (useful if the beam geometry changed but the shopdrawing hasn't been regenerated yet). |\n\n## Settings Files\n- **Filename**: `mapIO_GetArcPLine.mcr`\n- **Location**: TSL Search Path (Company or Install folder)\n- **Purpose**: Provides logic to read arc geometry from polylines, which is necessary for accurate dimensioning of curved contours.\n\n## Tips\n- **Stereotypes matter**: Ensure your Layout Definition contains Stereotypes (e.g., \"Contour\", \"Opening\") that exactly match the values in the script properties. If they do not match, dimensions will not be visible in the generated drawing.\n- **Clutter Control**: If a drawing is too busy, set `AddExtremes` to \"No\" or use `StereotypeOpening` set to `---` to hide specific dimension types.\n- **Flipping Dimensions**: You can use the grip on the script instance in the model to move the reference point (`_Pt0`) to the other side of the beam, which may flip the dimension side in the layout.\n\n## FAQ\n- **Q: Why don't I see dimensions immediately after inserting the script?**\n  **A:** This is a Shopdrawing script. Dimensions are generated when you create or update the Shopdrawing Layout (Paper Space), not directly in the Model Space.\n- **Q: My drill holes are not dimensioning.**\n  **A:** Check the `ChainContentDrill` property. If it is set to \"Suppress Drill Dimensions\", no drill annotations will be created.\n- **Q: How do I change the unit for hole sizes only?**\n  **A:** Use the `DiameterUnit` property. This allows you to display hole diameters in a different unit (e.g., inches) than the rest of the drawing."
      },
      "tokens_used": 7457,
      "error": null
    }
  }
}