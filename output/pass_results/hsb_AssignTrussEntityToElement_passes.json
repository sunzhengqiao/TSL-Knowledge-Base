{
  "filename": "hsb_AssignTrussEntityToElement.mcr",
  "status": "completed",
  "total_tokens": 25053,
  "processing_time": 277.9320285320282,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "05.09.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "02.02.2012",
            "author": "",
            "changes": "Added property to set colour to that of the zone"
          },
          {
            "version": "1.2",
            "date": "03.02.2012",
            "author": "",
            "changes": "Bugfix on Insert"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4928,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses hsb_ prefix. Interacts with TrussEntity and Element objects. Uses PrEntity and getElement for user input which operate in the model. Utilizes assignToElementGroup which modifies construction element groups in the 3D model. No sd_ functions, Viewport handling, or sheet references found."
        },
        "prerequisites": {
          "requiredEntities": [
            "TrussEntity",
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Truss Entities and construction Elements",
          "requiredSettings": []
        }
      },
      "tokens_used": 2896,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\\nSelect Truss/Joist entities",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getElement",
              "promptOriginal": "\\nSelect element to link too",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert (_bOnInsert) if _kExecuteKey is empty",
            "title": null,
            "dataSource": "Internal TSL Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nZones",
            "type": "PropInt",
            "displayName": "Zone to Assign the Trusses",
            "defaultValue": "0",
            "inputType": "dropdown",
            "options": [
              "0",
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "10"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2648,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Assigns selected Truss or Joist entities to a specific construction Element and categorizes them into a defined logical zone for manufacturing and reporting.",
          "category": "Data Organization/Construction Management",
          "typicalUseCase": "Used when loose trusses need to be grouped into specific wall or floor elements (e.g., assigning trusses to specific bays, sides, or layers) to ensure correct sorting in production lists and shop drawings."
        },
        "parameters": [
          {
            "name": "nZones",
            "technicalDefault": "0",
            "businessMeaning": "Determines the specific logical 'Zone' index within the target Element that the selected trusses will belong to. This allows users to categorize trusses (e.g., Zone 1, Zone 2) for filtering in reports or CNC export.",
            "validRange": "0 to 10",
            "unit": "Index",
            "affectsOutput": "Sets the grouping ID for the TrussEntity relative to the Element. Internally, inputs 0-5 map to positive indices, while inputs 6-10 map to negative indices (-1 to -5), often used to distinguish between primary and secondary zones."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "ElementAssignment",
            "description": "Creates a logical data link between the TrussEntity and the Element, assigning the entity to the specified zone group.",
            "appliedTo": "Selected Truss/Joist entities"
          }
        ]
      },
      "tokens_used": 4412,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts execution via Insert.",
          "Load configuration defaults from Catalog (if key exists) or use hardcoded value (0).",
          "[Conditional] If executing manually (no catalog key), show Dynamic Dialog for Zone selection.",
          "Command Line Prompt: User selects Truss/Joist entities.",
          "Script iterates through selection to filter and store valid TrussEntities.",
          "Command Line Prompt: User selects the target Element to link to.",
          "Script pauses and returns (Data acquisition phase complete).",
          "Script re-enters for calculation/construction phase.",
          "Check if a valid Element is stored in _Element array.",
          "Check if the stored Element object is valid (bIsValid).",
          "Loop through stored TrussEntities.",
          "Assign TrussEntity to Element Group 'Z' with the calculated Zone index (mapping dropdown 0-10 to indices 0-5, -1 to -5).",
          "Erase Script Instance (Operation is 'fire and forget')."
        ],
        "conditionalBranches": [
          {
            "condition": "Check Execution Source (_kExecuteKey)",
            "path1": {
              "name": "Manual Insert",
              "steps": [
                "_kExecuteKey is empty",
                "Show Dynamic Dialog for user to select 'Zone to Assign the Trusses'"
              ]
            },
            "path2": {
              "name": "Catalog/Scripted Insert",
              "steps": [
                "_kExecuteKey has a value",
                "Skip dialog, use values loaded via setPropValuesFromCatalog"
              ]
            }
          },
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Repeat Cycle Detected",
              "steps": [
                "Check if insertCycleCount() > 1",
                "Call eraseInstance() immediately",
                "Return"
              ]
            },
            "path2": {
              "name": "First Cycle",
              "steps": [
                "Check if insertCycleCount() == 1",
                "Proceed to PrEntity and getElement prompts"
              ]
            }
          },
          {
            "condition": "Target Element Validation",
            "path1": {
              "name": "Valid Element",
              "steps": [
                "_Element.length() > 0 AND el.bIsValid() is true",
                "Proceed to loop through TrussEntities and perform assignment"
              ]
            },
            "path2": {
              "name": "Invalid Element",
              "steps": [
                "_Element.length() == 0 OR el.bIsValid() is false",
                "Call eraseInstance()",
                "Return"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Target Element Selection",
            "errorMessage": "No error message displayed to user.",
            "recovery": "Script silently erases itself. User must re-insert the script and ensure an Element is selected."
          },
          {
            "check": "TrussEntity Validity",
            "errorMessage": "No error message displayed to user.",
            "recovery": "Invalid TrussEntities are skipped within the loop; valid ones are processed. User must ensure selection contains correct entities."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None (Self-Terminating)",
            "how": "N/A",
            "effect": "The script calls eraseInstance() immediately after assigning the entities to the element. It does not remain in the model for further editing via OPM or context menus. To change assignments, the user must run the script again."
          }
        ]
      },
      "tokens_used": 5749,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_AssignTrussEntityToElement.mcr\n\n## Overview\nAssigns selected Truss or Joist entities to a specific construction Element and categorizes them into a defined logical \"Zone\" for manufacturing, reporting, and shop drawing organization.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in the 3D model where Truss Entities and Elements exist. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: Truss Entities (or Joists) and a target construction Element must exist in the model.\n- **Minimum Beam Count**: N/A (Selects entities, not individual beams).\n- **Required Settings Files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Browse to and select `hsb_AssignTrussEntityToElement.mcr`.\n\n### Step 2: Configure Zone\n- A Dynamic Dialog will appear automatically upon insertion.\n- Select the desired **Zone to Assign the Trusses** (Options 0 through 10).\n- Click **OK** to proceed.\n\n### Step 3: Select Trusses\n```\nCommand Line: Select Truss/Joist entities\nAction: Click on the trusses or joists you wish to assign. Press Enter to confirm selection.\n```\n\n### Step 4: Select Target Element\n```\nCommand Line: Select element to link too\nAction: Click on the construction Element (Wall, Floor, Roof) that the trusses belong to.\n```\n\n### Step 5: Completion\n- The script processes the assignment and automatically erases itself from the model.\n- The link is now established in the database.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Zone to Assign the Trusses | Dropdown | 0 | Categorizes the trusses into a specific group within the element. <br>**Mapping:**<br>Options 0-5 assign to positive indices (0-5).<br>Options 6-10 assign to negative indices (-1 to -5), typically used for secondary sides or layers. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not remain in the model after execution; therefore, no right-click menu options are available. |\n\n## Settings Files\nNone required.\n\n## Tips\n- **Script Disappears**: This is a \"fire and forget\" tool. Once it links the entities, it deletes itself. You do not need to (and cannot) delete it manually afterwards.\n- **Zone Logic**: Use the Zone index to differentiate trusses on different sides of a wall or in specific bays.\n    - Example: Use `0` for the \"Left Side\" and `6` (which maps to index -1) for the \"Right Side\".\n- **Verification**: To verify the assignment worked, check your production lists or element properties to ensure the trusses are now grouped under the correct Element and Zone.\n\n## FAQ\n- **Q: The script vanished immediately after I selected the element. Did it fail?**\n  - A: No. This is the intended behavior. The script only exists temporarily to create the data link.\n- **Q: How do I undo the assignment?**\n  - A: There is no automatic \"undo\" button for this specific action. You would need to clear the entity assignments manually or re-run the script to assign them to a different element/zone.\n- **Q: What happens if I select option 6 in the dropdown?**\n  - A: Option 6 maps to internal index **-1**. This is useful if your production logic requires negative numbers for certain conditions (e.g., opposite walls)."
      },
      "tokens_used": 4420,
      "error": null
    }
  }
}