{
  "filename": "EntityTagger.mcr",
  "status": "completed",
  "total_tokens": 50820,
  "processing_time": 216.61062121391296,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.3",
            "date": "19.04.2023",
            "author": "Thorsten Huck",
            "changes": "HSB-18224 new property to specify odering of seqeuntial tagging"
          },
          {
            "version": "1.2",
            "date": "31.03.2023",
            "author": "Thorsten Huck",
            "changes": "HSB-18224 new properties added to support sequential indexing"
          },
          {
            "version": "1.1",
            "date": "06.02.2023",
            "author": "Thorsten Huck",
            "changes": "HSB-16764 minor description enhancement"
          },
          {
            "version": "1.0",
            "date": "22.12.2022",
            "author": "Thorsten Huck",
            "changes": "HSB-16764 initial version to tag and number items by painter definitions"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7127,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity to select GenBeams and TslInsts interactively. It modifies entity properties (Name, Label, Material, Grade, Information, SubLabel, PosNum) using methods like GenBeam.setName() and GenBeam.assignPosnum(). No usage of _Viewport, sd_ prefixes, or ShopDrawing specific headers (#Type E)."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "TslInst"
          ],
          "minimumBeams": 0,
          "requiredSpace": "ModelSpace",
          "requiredSettings": [
            "PainterDefinition collection named 'EntityTagger'"
          ]
        }
      },
      "tokens_used": 6885,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select genebams|\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"\",\n        \"condition\": \"bDebug\",\n        \"required\": false\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"StandardPropertyDialog\",\n      \"trigger\": \"_bOnInsert (via showDialog())\",\n      \"title\": \"EntityTagger Properties\",\n      \"dataSource\": \"OPM Properties defined in script\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 7,\n      \"variable\": \"sSubLabel\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Sublabel|\",\n      \"defaultValue\": \"|_Default|\",\n      \"inputType\": \"dropdown\",\n      \"options\": \"Dynamic (Painter Definitions from 'EntityTagger' collection)\",\n      \"category\": \"|Sequence Tagging|\",\n      \"description\": \"|Defines sequence tagging based on the selected painter definition for the selected entities.| |If a painter collection named 'EntityTagger' is found only painters of this collection are considered.|\"\n    },\n    {\n      \"index\": 9,\n      \"variable\": \"sSeqeuenceSortDirection\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Sort Direction|\",\n      \"defaultValue\": \"|Ascending|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Ascending|\",\n        \"|Descending|\"\n      ],\n      \"category\": \"|Sequence Tagging|\",\n      \"description\": \"|Defines the Sorting Direction of the sequential tag|\"\n    },\n    {\n      \"index\": 8,\n      \"variable\": \"sPrefixTarget\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Prefix Target|\",\n      \"defaultValue\": \"<|Disabled|>\",\n     "
      },
      "tokens_used": 9906,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A tool for batch numbering, tagging, and property assignment of structural timber elements (GenBeams) and TSL instances based on logic defined in Painter Definitions.",
          "category": "DataManagement",
          "typicalUseCase": "Used during the detailing phase to automatically assign production labels, position numbers (PosNums), and material grades to a selection of beams based on specific criteria (e.g., length, layer, cross-section) defined in the Painter palette."
        },
        "parameters": [
          {
            "name": "sSubLabel",
            "technicalDefault": "|_Default|",
            "businessMeaning": "Selects the Painter Definition logic used to group elements for sequential numbering in the SubLabel field.",
            "validRange": "Any Painter Definition name found in the 'EntityTagger' collection, or '|_Default|'",
            "unit": "String",
            "affectsOutput": "Groups elements based on painter criteria and assigns a running number (1, 2, 3...) to the 'SubLabel' property of each element within that group."
          },
          {
            "name": "sSeqeuenceSortDirection",
            "technicalDefault": "|Ascending|",
            "businessMeaning": "Determines the sort order of elements when assigning sequential numbers.",
            "validRange": "|Ascending|, |Descending|",
            "unit": "N/A",
            "affectsOutput": "Changes the order in which sequence numbers are distributed within the tagged groups (e.g., 1,2,3 vs 3,2,1 based on the painter's sort key)."
          },
          {
            "name": "sPrefixTarget",
            "technicalDefault": "<|Disabled|>",
            "businessMeaning": "Specifies which property receives the 'prefix' value if the selected Sequence Painter includes an alias definition (e.g., @(Type:A)).",
            "validRange": "<|Disabled|>, |Label|, |Sublabel| 2, |Information|",
            "unit": "N/A",
            "affectsOutput": "Writes a categorical code or text (the prefix) derived from the painter to the selected destination property (Label, SubLabel 2, or Information)."
          },
          {
            "name": "sName",
            "technicalDefault": "|_Default|",
            "businessMeaning": "Selects a Painter Definition to calculate and assign the 'Name' property of the elements.",
            "validRange": "Any Painter Definition name found in the 'EntityTagger' collection, or '|_Default|'",
            "unit": "String",
            "affectsOutput": "Overwrites the element's Name with the result of the painter format string."
          },
          {
            "name": "sLabel",
            "technicalDefault": "|_Default|",
            "businessMeaning": "Selects a Painter Definition to calculate and assign the 'Label' property of the elements.",
            "validRange": "Any Painter Definition name found in the 'EntityTagger' collection, or '|_Default|'",
            "unit": "String",
            "affectsOutput": "Overwrites the element's Label with the result of the painter format string."
          },
          {
            "name": "sMaterial",
            "technicalDefault": "|_Default|",
            "businessMeaning": "Selects a Painter Definition to calculate and assign the 'Material' property of the elements.",
            "validRange": "Any Painter Definition name found in the 'EntityTagger' collection, or '|_Default|'",
            "unit": "String",
            "affectsOutput": "Overwrites the element's Material assignment with the result of the painter format string."
          },
          {
            "name": "sGrade",
            "technicalDefault": "|_Default|",
            "businessMeaning": "Selects a Painter Definition to calculate and assign the 'Grade' (Strength Class) property of the elements.",
            "validRange": "Any Painter Definition name found in the 'EntityTagger' collection, or '|_Default|'",
            "unit": "String",
            "affectsOutput": "Overwrites the element's Grade with the result of the painter format string."
          },
          {
            "name": "sInformation",
            "technicalDefault": "|_Default|",
            "businessMeaning": "Selects a Painter Definition to calculate and assign the 'Information' (User Notes) property of the elements.",
            "validRange": "Any Painter Definition name found in the 'EntityTagger' collection, or '|_Default|'",
            "unit": "String",
            "affectsOutput": "Overwrites the element's Information field with the result of the painter format string."
          },
          {
            "name": "sPosNumPainter",
            "technicalDefault": "<|Disabled|>",
            "businessMeaning": "Selects the Painter Definition used to group elements for Position Number (PosNum) assignment.",
            "validRange": "Any Painter Definition name found in the 'EntityTagger' collection, or '<|Disabled|>'",
            "unit": "String",
            "affectsOutput": "Elements returning the same value from this painter will receive the same Position Number."
          },
          {
            "name": "sSortDirection",
            "technicalDefault": "|Ascending|",
            "businessMeaning": "Determines the sort order of the unique PosNum groups when assigning numbers.",
            "validRange": "|Ascending|, |Descending|",
            "unit": "N/A",
            "affectsOutput": "Controls the order in which PosNums are assigned to the filtered groups (e.g., A1, A2, A3 vs A3, A2, A1)."
          },
          {
            "name": "nStartNumber",
            "technicalDefault": "-1",
            "businessMeaning": "Sets the starting Position Number for the numbering process.",
            "validRange": "Integer (<0, 0, >0)",
            "unit": "Count",
            "affectsOutput": "Negative numbers clear existing PosNums and start fresh at absolute value. 0 releases/clears PosNums. Positive numbers start incrementing from that value."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sPrefixTarget is set to |Label| or |Info|",
            "effect": "Disables conflicting property mapping in the Property Mapping section (sLabel or sInformation) to prevent overwriting the prefix data.",
            "cascade": [
              "sLabel",
              "sInformation"
            ]
          },
          {
            "trigger": "sSubLabel is not '<|Disabled|>'",
            "effect": "Enables the sequential tagging logic block, utilizing sSeqeuenceSortDirection and sPrefixTarget.",
            "cascade": [
              "sSeqeuenceSortDirection",
              "sPrefixTarget"
            ]
          },
          {
            "trigger": "Painter Collection 'EntityTagger' exists",
            "effect": "Populates dropdown lists with only painters from that collection. Otherwise, lists all painters containing '@('.",
            "cascade": [
              "sName",
              "sLabel",
              "sMaterial",
              "sGrade",
              "sInformation",
              "sSubLabel",
              "sPosNumPainter"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "DataUpdate",
            "description": "Modifies properties (Name, Label, SubLabel, Material, Grade, Information) and assigns Position Numbers to existing GenBeam or TslInst entities.",
            "appliedTo": "GenBeams and TslInsts selected during script insertion."
          }
        ]
      },
      "tokens_used": 9204,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch: User executes command (e.g., TSLCONTENT) or inserts script.",
          "2. Property Initialization: Script scans for PainterDefinitions and 'EntityTagger' collection.",
          "3. Configuration Branch: If executing from a catalog (_kExecuteKey set), properties load from catalog; otherwise, Standard Property Dialog (showDialog) opens.",
          "4. Selection: Prompt 'Select genbeams' allows user to select GenBeam or TslInst entities.",
          "5. Sequence Tagging (Conditional): If 'Sublabel' is not Disabled, calculate and assign sequential numbers and prefixes based on the chosen Painter.",
          "6. PosNum Assignment (Conditional): If 'Filter' (sPosNumPainter) is not Disabled, group entities and assign Position Numbers (or release them if Start Number <= 0).",
          "7. Property Mapping: Iterate through Property Mapping settings (Name, Label, Material, etc.) and apply values if valid painters exist.",
          "8. Cleanup: Script instance is erased from the drawing (unless bDebug is true)."
        ],
        "conditionalBranches": [
          {
            "condition": "Source of Execution (_kExecuteKey)",
            "path1": {
              "name": "Catalog Execution",
              "steps": [
                "Properties are loaded silently from the catalog entry.",
                "Dialog is skipped."
              ]
            },
            "path2": {
              "name": "Manual Execution",
              "steps": [
                "showDialog() is triggered.",
                "User manually configures properties in the OPM or dialog."
              ]
            }
          },
          {
            "condition": "Existence of 'EntityTagger' Painter Collection",
            "path1": {
              "name": "Collection Found",
              "steps": [
                "Dropdowns populate only with painters from 'EntityTagger' collection.",
                "Parent folder name used as a grouping option."
              ]
            },
            "path2": {
              "name": "Collection Not Found",
              "steps": [
                "Dropdowns populate with all available painters.",
                "Filters for painters containing '@(' in their format string."
              ]
            }
          },
          {
            "condition": "PosNum Start Number (nStartNumber)",
            "path1": {
              "name": "Release / Clear",
              "steps": [
                "Condition: nStartNumber <= 0",
                "PosNums are released (cleared) from filtered entities."
              ]
            },
            "path2": {
              "name": "Assign / Renumber",
              "steps": [
                "Condition: nStartNumber > 0",
                "PosNums are assigned starting from the absolute value of nStartNumber."
              ]
            }
          },
          {
            "condition": "Property Mapping Conflicts",
            "path1": {
              "name": "Conflict Detected",
              "steps": [
                "If 'Prefix Target' is set to 'Label', 'Label' Property Mapping is skipped.",
                "If 'Prefix Target' is set to 'Information', 'Information' Property Mapping is skipped."
              ]
            },
            "path2": {
              "name": "No Conflict",
              "steps": [
                "Property mapping proceeds normally for all enabled fields."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases itself if insertCycleCount() > 1 to prevent duplicate execution."
          },
          {
            "check": "Painter Validity",
            "errorMessage": "None (Silent Skip)",
            "recovery": "Invalid painters or those returning empty format strings are ignored during iteration."
          },
          {
            "check": "Entity Type Compatibility",
            "errorMessage": "None",
            "recovery": "Script attempts to cast entities to GenBeam or TslInst. If cast fails, property modification for that entity is skipped."
          },
          {
            "check": "Painter Filter Resolution",
            "errorMessage": "None",
            "recovery": "If a painter returns its own format string (meaning no variables were resolved), the result is treated as empty/invalid."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Script Instance Removal",
            "how": "Automatic (eraseInstance)",
            "effect": "The script instance is deleted from the drawing immediately after execution, leaving only the modified entities."
          },
          {
            "action": "Data Update",
            "how": "Background Execution",
            "effect": "Selected GenBeams and TslInsts have their Name, Label, SubLabel, Material, Grade, Information, and PosNum properties updated based on the configuration."
          }
        ]
      },
      "tokens_used": 10782,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# EntityTagger\n\n## Overview\nThis tool allows for the batch numbering, tagging, and property assignment of structural timber elements (GenBeams) and TSL instances. It uses logic defined in hsbCAD Painter Definitions to automatically calculate and update fields such as Labels, Position Numbers (PosNums), Materials, and Grades.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on GenBeam and TslInst entities in the model. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Not a shop drawing script. |\n\n## Prerequisites\n- **Required Entities**: GenBeams or TslInsts to be modified.\n- **Minimum Beam Count**: 0 (User selects the target group).\n- **Required Settings**: A collection of Painter Definitions named **`EntityTagger`** is recommended to organize and filter the available logic options.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or `TSLCONTENT`) â†’ Select `EntityTagger.mcr`\n\n### Step 2: Configure Properties\n```\nAction: The Properties Palette (OPM) or a dialog window will appear.\nUser Task: Select the desired Painter Definitions for Name, Label, Material, etc.\n          Configure sequential tagging options if needed.\n          Set the Position Number start value.\nNote:     If run from a catalog, these settings may load automatically.\n```\n\n### Step 3: Select Entities\n```\nCommand Line: Select genbeams\nAction: Click on GenBeams or TslInsts in the drawing. Press Enter to confirm selection.\n```\n\n### Step 4: Execution\n```\nAction: The script calculates values based on the selected painters and updates the entities.\nResult: The script instance automatically erases itself from the drawing.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Sublabel** | dropdown | \\|_Default\\| | Selects the Painter Definition used to group elements for sequential numbering in the SubLabel field (e.g., 1, 2, 3...). |\n| **Sort Direction** (Seq) | dropdown | \\|Ascending\\| | Defines the order (Ascending/Descending) in which sequential tags are assigned to the grouped elements. |\n| **Prefix Target** | dropdown | \\<\\|Disabled\\|\\> | Specifies which property receives the 'prefix' value if the Sequence Painter includes an alias definition. Options: Disabled, Label, Sublabel 2, Information. |\n| **Name** | dropdown | \\|_Default\\| | Selects a Painter Definition to calculate and overwrite the 'Name' property of the elements. |\n| **Label** | dropdown | \\|_Default\\| | Selects a Painter Definition to calculate and overwrite the 'Label' property. (Skipped if Prefix Target is Label). |\n| **Material** | dropdown | \\|_Default\\| | Selects a Painter Definition to calculate and assign the 'Material' property. |\n| **Grade** | dropdown | \\|_Default\\| | Selects a Painter Definition to calculate and assign the 'Grade' (Strength Class). |\n| **Information** | dropdown | \\|_Default\\| | Selects a Painter Definition to write user notes into the 'Information' field. (Skipped if Prefix Target is Information). |\n| **PosNum Painter** | dropdown | \\<\\|Disabled\\|\\> | Selects the Painter Definition used to group elements for Position Number assignment. Elements with the same result get the same PosNum. |\n| **Sort Direction** (PosNum) | dropdown | \\|Ascending\\| | Defines the order in which unique PosNum groups are numbered. |\n| **Start Number** | integer | -1 | Sets the starting number for PosNums. **Negative values clear existing PosNums** and start fresh at the absolute value. **0 clears/releases PosNums**. Positive numbers start incrementing from that value. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | The script instance erases itself immediately after execution, leaving no active instance for right-click interactions. |\n\n## Settings Files\n- **Entity**: Painter Definitions (Internal hsbCAD Database)\n- **Location**: hsbCAD Painter Palette\n- **Purpose**: This script does not load external XML files. It relies on Painter Definitions defined within the hsbCAD environment.\n  - It specifically looks for a collection named `EntityTagger`.\n  - If this collection is missing, it lists all painters containing `@(` in their format string.\n\n## Tips\n- **Organization**: Create a Painter Collection named `EntityTagger` and add your relevant painters to it. This keeps the dropdown lists in the script clean and relevant.\n- **Prefix Conflicts**: If you set **Prefix Target** to \"Label\", the script will automatically disable the standard **Label** painter mapping to prevent the sequence logic from being overwritten immediately.\n- **Renumbering**: To completely reset Position Numbers for a selection, set **Start Number** to `0`. To reset and start numbering at 1, set it to `-1`.\n- **Debug Mode**: If the script fails to erase itself (rare), ensure you are not in a debug mode that halts execution.\n\n## FAQ\n- **Q: Why don't I see my specific Painter in the dropdown list?**\n  - A: Ensure your Painter is either inside a collection named `EntityTagger` or contains the characters `@(` in its format string.\n- **Q: Why did my Position Numbers disappear?**\n  - A: Check the **Start Number** parameter. If it is set to `0` or a negative number, it clears existing numbers.\n- **Q: Can I undo the changes?**\n  - A: Yes, use the standard AutoCAD `UNDO` command immediately after running the script.\n- **Q: Where did the script object go after I ran it?**\n  - A: The script is designed to \"fire and forget.\" It erases itself automatically after updating the entities to keep your drawing clean."
      },
      "tokens_used": 6916,
      "error": null
    }
  }
}