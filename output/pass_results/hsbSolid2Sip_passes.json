{
  "filename": "hsbSolid2Sip.mcr",
  "status": "completed",
  "total_tokens": 53325,
  "processing_time": 332.3516798019409,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9584,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit use of _kModelSpace in tslNew.dbCreate() function call. Script checks for '3DSOLID' DXF type. No usage of _kPaperSpace, _Viewport, or sd_ prefixes."
        },
        "prerequisites": {
          "requiredEntities": [
            "3DSOLID"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbPanelDrill.mcr",
            "Sip Styles (Panel Styles)"
          ]
        }
      },
      "tokens_used": 6998,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": \"Properties Dialog\",\n        \"condition\": \"_bOnInsert && insertCycleCount()==1\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getEntity\",\n        \"promptOriginal\": \"Select entity\",\n        \"condition\": \"_bOnInsert && insertCycleCount()==1\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"PrPoint\",\n        \"promptOriginal\": \"|Specify normal of reference side|\",\n        \"condition\": \"_bOnInsert && insertCycleCount()==1\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"showDialog\",\n      \"trigger\": \"Script Insertion\",\n      \"title\": \"Properties\",\n      \"dataSource\": \"OPM\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 2,\n      \"variable\": \"sStyleName\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Panel Style|\",\n      \"defaultValue\": \"Dynamic\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \""
      },
      "tokens_used": 10272,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Converts imported 3D solid geometries (typically from architectural software) into intelligent hsbCAD Structural Insulated Panels (SIPs), including detection and mapping of machining and openings.",
          "category": "Import/Conversion",
          "typicalUseCase": "Used when receiving architectural models (e.g., from Revit or ArchiCAD) to convert raw wall/roof geometry into parametric timber panels for manufacturing, ensuring correct orientation and style assignment."
        },
        "parameters": [
          {
            "name": "sStyleName",
            "technicalDefault": "Dynamic",
            "businessMeaning": "Defines the construction makeup of the SIP (e.g., layer composition, timber type, thickness) based on the predefined hsbCAD Panel Styles catalog. 'Dynamic' attempts to auto-select based on thickness.",
            "validRange": "List of available Panel Styles in the hsbCAD catalog",
            "unit": "Enumeration",
            "affectsOutput": "Determines the physical dimensions, material properties, and default machining allowances of the generated panel."
          },
          {
            "name": "sGrade",
            "technicalDefault": "|Auto|",
            "businessMeaning": "Specifies the surface quality grade of the panel (e.g., Visible, Non-Visible, Reference side). This controls how the surface is treated or labeled for production.",
            "validRange": "NVI, VI-REF, VI-GEG, BVI, Auto",
            "unit": "Enumeration",
            "affectsOutput": "Sets the visual representation and data attributes related to surface finish requirements."
          },
          {
            "name": "sLabel",
            "technicalDefault": "",
            "businessMeaning": "The production identifier or part number for the panel (e.g., 'Wall-1', '10-01'). Used for tracking, labeling, and export data.",
            "validRange": "Alphanumeric string",
            "unit": "Text",
            "affectsOutput": "Updates the text label assigned to the panel instance and export lists."
          },
          {
            "name": "Specify normal of reference side",
            "technicalDefault": "User Input",
            "businessMeaning": "Establishes the 'Top' or 'Reference' face of the panel. This determines the positive Z-direction of the panel's local coordinate system.",
            "validRange": "Any 3D point/vector",
            "unit": "Vector",
            "affectsOutput": "Flips the panel orientation if the calculated normal opposes the selection, affecting which side is considered the reference for dimensions and machining."
          },
          {
            "name": "Set X-Direction",
            "technicalDefault": "Auto-detected",
            "businessMeaning": "Forces the panel's local X-axis (usually the longitudinal axis) to align with a user-defined vector.",
            "validRange": "Any 3D vector",
            "unit": "Vector",
            "affectsOutput": "Reorients the panel geometry so that the X-axis matches the selected direction, swapping Length/Width assignments if necessary."
          },
          {
            "name": "Flip Reference Side",
            "technicalDefault": "Unflipped",
            "businessMeaning": "Inverts the local Z-axis of the panel, effectively swapping the Reference side with the Opposite side.",
            "validRange": "Toggle (Flip/Unflip)",
            "unit": "State",
            "affectsOutput": "Reverses the panel's vertical orientation, shifting machining and openings to the opposite face relative to the coordinate system."
          },
          {
            "name": "Rotate X-Axis 90",
            "technicalDefault": "0 Degrees",
            "businessMeaning": "Rotates the panel's local coordinate system 90 degrees around the Z-axis.",
            "validRange": "Toggle (0 or 90 degrees)",
            "unit": "Angle",
            "affectsOutput": "Swaps the panel's Length and Width axes, affecting how the panel is nested or processed."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing 'Set X-Direction', 'Flip Reference Side', or 'Rotate X-Axis 90'",
            "effect": "Forces a regeneration of the panel geometry and re-evaluation of machining tools (cuts/drills) to match the new orientation.",
            "cascade": [
              "vx",
              "vy",
              "vz",
              "_Sip geometry"
            ]
          },
          {
            "trigger": "Changing 'sStyleName'",
            "effect": "Rebuilds the internal structure of the SIP (thickness/materials), which may obscure or reveal existing machining depending on new dimensions.",
            "cascade": [
              "Beam dimensions",
              "Material assignments"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Sip (Structural Insulated Panel)",
            "description": "The primary parametric timber panel created from the solid geometry, inheriting the calculated bounding box and assigned style.",
            "appliedTo": "New entity created in Model Space"
          },
          {
            "type": "hsbPanelDrill (TSL Instance)",
            "description": "Sub-instances inserted into the panel representing detected circular holes/drills found in the original solid geometry.",
            "appliedTo": "The generated SIP"
          },
          {
            "type": "Cut / Machining",
            "description": "Transfer of non-free cuts and specific edge contours found on the original solid to the new SIP body.",
            "appliedTo": "The generated SIP"
          }
        ]
      },
      "tokens_used": 9908,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"User launches script hsbSolid2Sip.mcr\",\n    \"Properties Dialog displays (Panel Style, Surface Quality, Label)\",\n    \"Command line prompts user to select a 3DSOLID entity\",\n    \"System validates if entity is a valid 3DSOLID\",\n    \"Script creates a temporary 'dummy' GenBeam from the solid geometry to determine initial bounding box and center point\",\n    \"Command line prompts user to 'Specify normal of reference side' (pick a point)\",\n    \"Script calculates dot product between solid normal and user point vector\",\n    \"Script calculates local coordinate system (X, Y, Z) and adjusts orientation based on reference side selection\",\n    \"Script creates the initial Sip (Structural Insulated Panel) entity\",\n    \"Script extracts contact faces and shadow profiles from the original solid\",\n    \"Script analyzes detected cuts and contours, mapping them to the new Sip edges\",\n    \"Script performs 'slice test' on panel faces to detect circular openings\",\n    \"Script inserts 'hsbPanelDrill' TSL instances for valid circular holes\",\n    \"Script enters standby mode, listening for property changes or context menu triggers\",\n    \"User selects 'Accept Conversion' from context menu\",\n    \"Script erases the temporary dummy beam and the script instance, leaving only the finished Sip\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Entity Type Validation\",\n      \"path1\": {\n        \"name\": \"Valid 3DS"
      },
      "tokens_used": 11375,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbSolid2Sip.mcr\n\n## Overview\nConverts imported 3D solid geometries (typically from architectural software like Revit or ArchiCAD) into intelligent hsbCAD Structural Insulated Panels (SIPs). The script automatically detects dimensions, orientation, and machining features such as drills and cuts.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for 3D solid selection and panel creation. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities:** A 3DSOLID entity (imported geometry) must exist in the drawing.\n- **Minimum beam count:** 0 (This script creates new panels from solids; it does not modify existing beams).\n- **Required settings:**\n  - `hsbPanelDrill.mcr`: Required for the detection and creation of circular drill holes.\n  - **Sip Styles (Panel Styles):** A catalog of predefined panel styles (e.g., thickness, material makeup) must be configured in the hsbCAD environment.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbSolid2Sip.mcr`\n\n### Step 2: Configure Properties\n```\nDialog: Properties\nAction: Set the Panel Style, Surface Quality (Grade), and Label as needed. Click OK.\n```\n\n### Step 3: Select Geometry\n```\nCommand Line: Select entity\nAction: Click on the imported 3DSOLID (wall or roof) you wish to convert.\n```\n\n### Step 4: Define Orientation\n```\nCommand Line: Specify normal of reference side\nAction: Click a point in space to indicate which side of the panel is the \"Reference\" or \"Top\" side.\n```\n*Note: The script calculates the panel's local coordinate system based on this selection. If the panel is created upside down, you can flip it later in the properties.*\n\n### Step 5: Finalize Conversion\n```\nAction: Right-click on the new Sip entity.\nMenu Item: Accept Conversion\n```\n*This removes the temporary script instance and leaves the finished parametric panel in the model.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Panel Style (sStyleName) | Dropdown | Dynamic | Selects the construction makeup (layers, material) of the SIP. \"Dynamic\" attempts to auto-select based on the solid's thickness. |\n| Surface Quality (sGrade) | Dropdown | Auto | Defines the finish grade (e.g., Visible, Non-Visible, Reference side). Affects visual representation and labels. |\n| Label (sLabel) | Text | [Empty] | Production identifier or part number for the panel. |\n| Set X-Direction | Vector | Auto-detected | Forces the panel's local X-axis (longitudinal axis) to align with a specific vector direction. |\n| Flip Reference Side | Toggle | Unflipped | Swaps the Reference side with the Opposite side. Use this if the panel orientation is inverted. |\n| Rotate X-Axis 90 | Toggle | 0 Degrees | Rotates the panel's local coordinate system 90 degrees, effectively swapping the Length and Width. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Accept Conversion | Finalizes the process. It erases the temporary script instance and the original solid reference, leaving only the finished parametric SIP. |\n| Properties | Opens the AutoCAD Properties palette to adjust Style, Orientation, and Labels. |\n\n## Settings Files\n- **Filename**: `hsbPanelDrill.mcr`\n- **Location**: hsbCAD Application path (TslScripts folder)\n- **Purpose**: Provides the logic for detecting circular holes in the original solid and converting them into intelligent drill instances on the new panel.\n- **Filename**: Sip Styles (Catalog)\n- **Location**: Company database or hsbCAD Install path\n- **Purpose**: Defines the available options in the \"Panel Style\" dropdown (thickness, material codes).\n\n## Tips\n- **Dynamic Style:** Use the \"Dynamic\" option for Panel Style if you want the script to automatically match a style based on the thickness of the imported solid.\n- **Orientation:** If the panel is generated with the wrong face as the \"Top,\" use the **Flip Reference Side** property instead of re-running the script.\n- **Rotation:** Use **Rotate X-Axis 90** to quickly swap the length and width if the panel comes in \"sideways.\"\n\n## FAQ\n- Q: Why are my drill holes not appearing on the panel?\n  A: Ensure `hsbPanelDrill.mcr` exists in your TSLScripts folder and that the holes in the original solid are perfect cylinders/circles.\n- Q: The panel is too thin or too thick compared to the solid.\n  A: Check the **Panel Style** property. It may have forced a specific thickness that overrides the solid's dimensions. Select a style that matches the imported geometry.\n- Q: How do I align the panel with a specific wall line?\n  A: Use the **Set X-Direction** property. Click the picker button and select two points on the line you want to align with."
      },
      "tokens_used": 5188,
      "error": null
    }
  }
}