{
  "filename": "hsb_ShowWallInformation.mcr",
  "status": "completed",
  "total_tokens": 21528,
  "processing_time": 470.11156606674194,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "21.01.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4451,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses _Viewport.append(), checks _Viewport.length(), prompts user to 'Select a viewport'. Transforms coordinates using ms2ps (Model Space to Paper Space) CoordSys. No 'sd_' prefix or #Type E found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Viewport",
            "Beams (within Element)"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Must be run on an active layout with a viewport containing an Element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 1593,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "Pick a point where the the information is going to be shown",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select a viewport",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimLayout",
            "type": "PropString",
            "displayName": "Dim Style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dFactor",
            "type": "PropDouble",
            "displayName": "Timber density (kg/m3)",
            "defaultValue": "450",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Please fill this information so you can get the weight of the frame"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2494,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically labels a wall frame on a layout sheet with its definition, nominal dimensions, and calculated total weight based on timber volume.",
          "category": "ShopDrawing/Annotation",
          "typicalUseCase": "An engineer or drafter wants to tag a specific wall elevation on a drawing layout (Paper Space) to show the wall size (e.g., 2440x2440) and the estimated weight of the timber for logistics or structural loading calculations."
        },
        "parameters": [
          {
            "name": "dFactor",
            "technicalDefault": "450",
            "businessMeaning": "The material density of the timber used in the wall frame. This value is essential for converting the calculated geometric volume of the wall into a physical mass (weight).",
            "validRange": "350 - 800 (350 for light softwoods like Spruce/Pine, up to 700+ for dense hardwoods or modified timber like LVL/Kerto)",
            "unit": "kg/m³",
            "affectsOutput": "Directly changes the calculated 'Frame weight' value displayed in the text label on the drawing."
          },
          {
            "name": "sDimLayout",
            "technicalDefault": "",
            "businessMeaning": "The drafting standard used to control the visual appearance of the text label (text height, font, arrow styles) to ensure it matches the project's drawing standards.",
            "validRange": "Any Dimension Style defined in the current CAD drawing",
            "unit": "N/A (Style name)",
            "affectsOutput": "Controls the scale, size, and style of the wall information text drawn in Paper Space."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change in wall geometry in Model Space",
            "effect": "Recalculates the total volume and weight, updating the displayed text string.",
            "cascade": [
              "dElVol",
              "nElWeight",
              "strWallDetail"
            ]
          },
          {
            "trigger": "Modification of dFactor",
            "effect": "Recalculates the weight portion of the text string without changing geometric volume.",
            "cascade": [
              "nElWeight",
              "strWallDetail"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text String (Annotation)",
            "description": "A single line of text displaying the Element Definition, Width x Height, and total Frame Weight.",
            "appliedTo": "Paper Space (at the user-selected point _Pt0)"
          }
        ]
      },
      "tokens_used": 3972,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script launched in Paper Space.",
          "2. User prompted to pick a point in Paper Space for the text location (_Pt0).",
          "3. User prompted to select a Viewport.",
          "4. Script instance is created and linked to the selected Viewport.",
          "5. Script retrieves the Element associated with the Viewport.",
          "6. Script iterates through all Beams in the Element to calculate total volume.",
          "7. Script calculates total weight based on volume and Timber Density property (dFactor).",
          "8. Script constructs a display string: [Definition] [Height]x[Width] (Optional: Weight).",
          "9. Script draws the text string in Paper Space at _Pt0 using the specified Dim Style."
        ],
        "conditionalBranches": [
          {
            "condition": "Viewport availability during recalculation",
            "path1": {
              "name": "Viewport Deleted/Empty",
              "steps": [
                "Script detects _Viewport array length is 0.",
                "Script executes eraseInstance().",
                "Script terminates."
              ]
            },
            "path2": {
              "name": "Viewport Present",
              "steps": [
                "Script proceeds to retrieve Element from Viewport."
              ]
            }
          },
          {
            "condition": "Element validity",
            "path1": {
              "name": "Invalid Element",
              "steps": [
                "el.bIsValid() returns false.",
                "Script terminates (silent fail)."
              ]
            },
            "path2": {
              "name": "Valid Element",
              "steps": [
                "Script retrieves element vectors and geometry."
              ]
            }
          },
          {
            "condition": "Beam presence in Element",
            "path1": {
              "name": "Empty Element",
              "steps": [
                "Beam array length < 1.",
                "Script terminates (silent fail)."
              ]
            },
            "path2": {
              "name": "Beams Found",
              "steps": [
                "Script loops through beams to sum up dElVol (Volume)."
              ]
            }
          },
          {
            "condition": "Calculated Weight value",
            "path1": {
              "name": "Weight > 0",
              "steps": [
                "Appends ' (Frame weight: X kg)' to the text string."
              ]
            },
            "path2": {
              "name": "Weight <= 0",
              "steps": [
                "Displays only Definition and Dimensions (Definition HxW)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport assignment",
            "errorMessage": "(None - Silent)",
            "recovery": "Re-insert the script and ensure a valid viewport is selected."
          },
          {
            "check": "Element inside Viewport",
            "errorMessage": "(None - Silent)",
            "recovery": "Ensure the selected viewport contains a valid hsb Element/Wall."
          },
          {
            "check": "Beams inside Element",
            "errorMessage": "(None - Silent)",
            "recovery": "Ensure the Element contains construction beams (it is not an empty group)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Timber Density (dFactor)",
            "how": "OPM (Properties Palette)",
            "effect": "Recalculates 'Frame weight' value in the text string immediately."
          },
          {
            "action": "Change Dim Style (sDimLayout)",
            "how": "OPM (Properties Palette)",
            "effect": "Updates the text style, size, and font of the label to match the selected standard."
          },
          {
            "action": "Move Label",
            "how": "Grip Edit (Drag)",
            "effect": "Relocates the text start point (_Pt0) in Paper Space."
          },
          {
            "action": "Update Wall Geometry",
            "how": "Modify Element in Model Space",
            "effect": "Triggers recalculation of Dimensions, Volume, and Weight; updates text string automatically."
          }
        ]
      },
      "tokens_used": 4657,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ShowWallInformation.mcr\n\n## Overview\nAutomatically labels a wall frame on a layout sheet with its definition, nominal dimensions, and calculated total weight based on timber volume.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is intended for Layouts/Sheets. |\n| Paper Space | Yes | The script must be run on an active layout containing a viewport. |\n| Shop Drawing | No | This is an annotation tool for drawings. |\n\n## Prerequisites\n- **Required Entities**: A Viewport containing a hsb Element (Wall).\n- **Minimum Beam Count**: 1 (The Element must contain construction beams to calculate volume).\n- **Required Settings**: None required, though a Dim Style should exist in the drawing.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsb_ShowWallInformation.mcr`\n\n### Step 2: Pick Location\n```\nCommand Line: Pick a point where the the information is going to be shown\nAction: Click anywhere in the Paper Space layout where you want the wall label to appear.\n```\n\n### Step 3: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the viewport border that displays the wall you wish to label.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dim Style | dropdown | Current Dim Styles | Selects the dimension style to control the text height, font, and appearance of the label to match your drawing standards. |\n| Timber density (kg/m3) | number | 450 | Enter the density of the wood material (e.g., 450 for Spruce/Pine). This is used to calculate the total frame weight. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add custom context menu items. Use the Properties Palette to modify settings. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Updating Weight**: If you change the wall geometry (e.g., add studs or change height) in Model Space, the label will automatically update the dimensions and weight.\n- **Material Types**: Adjust the `Timber density` property in the Properties palette if you are calculating weight for hardwoods (e.g., 600-700 kg/m³) or engineered timber like LVL.\n- **Text Style**: To change the size of the text, either change the `Dim Style` property in the script settings or modify the text height in the selected Dimension Style within AutoCAD.\n\n## FAQ\n- **Q: Why does the label disappear?**\n  A: The script is linked to a specific viewport. If you delete the viewport, the label will also be deleted.\n- **Q: The weight shows as 0.**\n  A: Ensure the Element inside the viewport actually contains beams and that the `Timber density` property is not set to 0.\n- **Q: How do I move the text?**\n  A: Select the script entity in Paper Space and use the grip point to drag it to a new location."
      },
      "tokens_used": 4361,
      "error": null
    }
  }
}