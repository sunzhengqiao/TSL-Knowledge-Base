{
  "filename": "HSB_E-ExtendBeam.mcr",
  "status": "completed",
  "total_tokens": 40677,
  "processing_time": 369.9580945968628,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.3",
            "date": "25/01/2024",
            "author": "Robert Pol",
            "changes": "Add prop to use filter on props"
          },
          {
            "version": "1.2",
            "date": "24/01/2024",
            "author": "Robert Pol",
            "changes": "Also use include exclude on beamtypes"
          },
          {
            "version": "1.1",
            "date": "24/01/2024",
            "author": "Robert Pol",
            "changes": "Add operations"
          },
          {
            "version": "1.00",
            "date": "02.05.2013",
            "author": "AS",
            "changes": "Pilot version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6750,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly creates new TSL instances using `tsl.dbCreate(..., _kModelSpace, mapTsl);`. It interacts directly with `Element` and `GenBeam` objects using methods like `el.beam()` and `bm.addToolStatic()`, which are typical for 3D model manipulation. It also utilizes `eraseInstance()` at the end of execution, which is characteristic of command scripts that modify the 3D model and then remove themselves."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 4928,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && (_kExecuteKey == \"\" || arSCatalogNames.find(_kExecuteKey) == -1)",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "Select a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "PropertyDialog",
            "trigger": "On Insert (unless execute key is used)",
            "title": null,
            "dataSource": "Script Properties (OPM)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeparator01",
            "type": "PropString",
            "displayName": "Filter",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Group Header (Read Only)"
          },
          {
            "index": 1,
            "variable": "sFilterBC",
            "type": "PropString",
            "displayName": "     Filter beams with beamcode",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sFilterLabel",
            "type": "PropString",
            "displayName": "     Filter beams and sheets with label",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sFilterMaterial",
            "type": "PropString",
            "displayName": "     Filter beams and sheets with material",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sFilterOperation",
            "type": "PropString",
            "displayName": "     Filter operation",
            "defaultValue": "Exclude",
            "inputType": "dropdown",
            "options": [
              "Exclude",
              "Include"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sSeparator02",
            "type": "PropString",
            "displayName": "Extend beam",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Group Header (Read Only)"
          },
          {
            "index": 5,
            "variable": "sBeamProperty",
            "type": "PropString",
            "displayName": "     Beam property",
            "defaultValue": "Beam Type",
            "inputType": "dropdown",
            "options": [
              "Beam Type"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sBeamType",
            "type": "PropString",
            "displayName": "     Beam type",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": "Uses _BeamTypes system list"
          },
          {
            "index": 8,
            "variable": "sUsePropsForFiltering",
            "type": "PropString",
            "displayName": "     Use props for filtering",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dExtendWith",
            "type": "PropDouble",
            "displayName": "     Extend with",
            "defaultValue": "2",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6101,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically extends the length of specific beams within an element to create excess material (overlength) for subsequent processing or to ensure overlaps.",
          "category": "Framing / Model Modification",
          "typicalUseCase": "Preparing wall panels where studs or plates need to be longer than the nominal wall size to allow for machining (e.g., tenons) or to ensure they penetrate into an adjacent floor or roof plate for connection."
        },
        "parameters": [
          {
            "name": "sFilterBC",
            "technicalDefault": "",
            "businessMeaning": "A list of Beam Codes to filter which elements are processed. Supports wildcards (e.g., 'ST*' for studs). Used to target specific structural members.",
            "validRange": "Any alphanumeric string, separated by semicolons",
            "unit": "text",
            "affectsOutput": "Determines which beams are considered for extension based on their naming convention."
          },
          {
            "name": "sFilterLabel",
            "technicalDefault": "",
            "businessMeaning": "Filters beams based on their assigned Label (e.g., 'Inner', 'Outer'). Useful for processing only specific layers of a wall.",
            "validRange": "Any alphanumeric string, separated by semicolons",
            "unit": "text",
            "affectsOutput": "Restricts the extension operation to beams matching specific labels."
          },
          {
            "name": "sFilterMaterial",
            "technicalDefault": "",
            "businessMeaning": "Filters beams based on their material code (e.g., 'C24', 'GL24h'). Ensures only specific wood grades are modified.",
            "validRange": "Any material code string, separated by semicolons",
            "unit": "text",
            "affectsOutput": "Only beams with the specified material properties will be extended."
          },
          {
            "name": "sFilterOperation",
            "technicalDefault": "Exclude",
            "businessMeaning": "Defines the logic for the string filters (Code, Label, Material). 'Exclude' processes everything EXCEPT matching beams. 'Include' processes ONLY matching beams.",
            "validRange": "Exclude, Include",
            "unit": "enum",
            "affectsOutput": "Inverts the selection set of beams derived from the filter strings."
          },
          {
            "name": "sBeamType",
            "technicalDefault": "",
            "businessMeaning": "Selects beams based on their structural classification (e.g., 'Stud', 'Plate', 'Rafter').",
            "validRange": "System Beam Types list",
            "unit": "enum",
            "affectsOutput": "Refines the selection to beams of a specific structural function."
          },
          {
            "name": "sUsePropsForFiltering",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggle to enable or disable the 'Beam Type' filter. If 'No', the script ignores the Beam Type setting and relies solely on Code/Label/Material.",
            "validRange": "Yes, No",
            "unit": "enum",
            "affectsOutput": "Controls whether the 'sBeamType' parameter is active."
          },
          {
            "name": "dExtendWith",
            "technicalDefault": "2",
            "businessMeaning": "The physical length to add to both ends of the selected beams. This creates the overlength.",
            "validRange": "0 to 500 (mm)",
            "unit": "mm",
            "affectsOutput": "Directly changes the geometry of the beam solid, making it longer at both start and end points."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sUsePropsForFiltering is set to 'No'",
            "effect": "The script ignores the sBeamType parameter completely.",
            "cascade": [
              "sBeamType"
            ]
          },
          {
            "trigger": "sFilterOperation is set to 'Include'",
            "effect": "Beams must match one of the Code, Label, or Material filters to be processed. Otherwise, they are ignored.",
            "cascade": [
              "sFilterBC",
              "sFilterLabel",
              "sFilterMaterial"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam Modification",
            "description": "Stretches the solid geometry of the beam at both ends by the specified amount.",
            "appliedTo": "Beams matching the filter criteria within the selected Element(s)."
          },
          {
            "type": "Cut",
            "description": "Internal static cuts are added to the beam to define the new end points, effectively acting as a stretch operation.",
            "appliedTo": "Start and End faces of the selected beams."
          }
        ]
      },
      "tokens_used": 7848,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script execution launched (either via catalog key or manual start).",
          "2. Check if an Execute Key was provided.",
          "3. [Conditional] If no Execute Key, display Properties Dialog for user configuration.",
          "4. Prompt user to select Elements (PrEntity).",
          "5. User confirms selection (or cancels).",
          "6. Script iterates through selected Elements, removing any previous instances of itself.",
          "7. Script creates a new 'satellite' instance of itself on each selected Element in ModelSpace.",
          "8. Original 'master' instance erases itself.",
          "9. Satellite instances receive properties from the master.",
          "10. Satellite retrieves all Beams within the host Element.",
          "11. [Conditional] Filter Beams based on Label, Material, and Beam Code using Wildcards.",
          "12. [Conditional] Apply 'Include' or 'Exclude' logic based on matches.",
          "13. [Conditional] If 'Use props for filtering' is Yes, filter by Beam Type.",
          "14. Calculate new start and end points for extending the geometry.",
          "15. Apply Static Cuts (Stretch) to the filtered Beams.",
          "16. Satellite instances erase themselves."
        ],
        "conditionalBranches": [
          {
            "condition": "Invocation Method (Execute Key vs Manual)",
            "path1": {
              "name": "Execute Key",
              "steps": [
                "Properties are loaded automatically from catalog definition.",
                "Skip Properties Dialog.",
                "Proceed to Element selection."
              ]
            },
            "path2": {
              "name": "Manual Start",
              "steps": [
                "Open Properties Dialog.",
                "User adjusts filters and extension length.",
                "User confirms dialog.",
                "Proceed to Element selection."
              ]
            }
          },
          {
            "condition": "Filter Operation (sFilterOperation)",
            "path1": {
              "name": "Exclude",
              "steps": [
                "Check Beam Code, Label, and Material against filter strings.",
                "If a beam matches a filter string, it is SKIPPED (Excluded).",
                "All other beams proceed to Beam Type check."
              ]
            },
            "path2": {
              "name": "Include",
              "steps": [
                "Check Beam Code, Label, and Material against filter strings.",
                "If a beam matches a filter string, it is SELECTED (Included).",
                "Beams matching nothing are SKIPPED.",
                "Selected beams proceed to Beam Type check."
              ]
            }
          },
          {
            "condition": "Property Filtering (sUsePropsForFiltering)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Check if the beam matches the selected 'Beam Type' (sBeamType).",
                "Extend beam only if Beam Type matches."
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Ignore Beam Type setting.",
                "Extend all beams that passed the string filters."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "None (Script simply exits/erases)",
            "recovery": "User must run the script again and ensure at least one Element is selected."
          },
          {
            "check": "Host Element Existence",
            "errorMessage": "None (Satellite erases self)",
            "recovery": "Ensure script is attached to a valid Element."
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None",
            "recovery": "Internal check to prevent duplicate execution on one insertion event."
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 8675,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-ExtendBeam.mcr\n\n## Overview\nThis script automatically extends the length of specific beams within selected elements to create overlength (excess material). It is typically used to ensure beams penetrate into connection points or allow extra material for subsequent machining operations.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script modifies 3D beam geometry directly. |\n| Paper Space | No | Not designed for 2D drawings. |\n| Shop Drawing | No | Not designed for layout generation. |\n\n## Prerequisites\n- **Required entities**: Element (e.g., Wall, Roof, Floor).\n- **Minimum beam count**: 1 (inside the selected element).\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nRun the command `TSLINSERT` in the AutoCAD command line and select `HSB_E-ExtendBeam.mcr` from the file list.\n\n### Step 2: Configure Properties\nOnce loaded, the Properties Palette (OPM) will display the script settings. Adjust the filters and extension values before proceeding.\n\n**Configuration Guide:**\n1.  **Filter Section**: Define which beams to target.\n    *   You can filter by **Beam Code** (e.g., `ST*`), **Label**, or **Material**.\n    *   **Filter Operation**: Choose \"Exclude\" to process everything *except* what matches your text filters, or \"Include\" to process *only* what matches.\n2.  **Extend Beam Section**: Define the extension parameters.\n    *   Select the **Beam Type** (e.g., Stud, Plate) if \"Use props for filtering\" is set to Yes.\n    *   Set **Extend with** to the desired length in millimeters (e.g., `20` mm).\n\n### Step 3: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the Element(s) (Wall, Roof, etc.) containing the beams you wish to modify. Press Enter to confirm.\n```\n\n### Step 4: Execution\nThe script will automatically process the selected elements, apply the extensions to the matching beams, and then remove itself from the drawing.\n\n## Properties Panel Parameters\n\n### Filter Settings\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Filter beams with beamcode | Text | \"\" | Enter a beam code pattern (e.g., `ST*` for studs). Use semicolons `;` for multiple codes. |\n| Filter beams and sheets with label | Text | \"\" | Enter a label pattern to target specific layers. |\n| Filter beams and sheets with material | Text | \"\" | Enter a material code pattern (e.g., `C24`). |\n| Filter operation | Dropdown | Exclude | **Exclude**: Processes all beams *except* those matching the filters above. **Include**: Processes *only* beams matching the filters. |\n\n### Extend Settings\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Beam type | Dropdown | *System Default* | The structural classification of beam to target (e.g., Stud, Rim beam). Only active if \"Use props for filtering\" is Yes. |\n| Use props for filtering | Dropdown | Yes | **Yes**: Uses the \"Beam type\" setting. **No**: Ignores \"Beam type\" and relies only on Code/Label/Material filters. |\n| Extend with | Number | 2 | The length in millimeters to add to **both ends** of the beam. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add persistent right-click menu items to entities. |\n\n## Settings Files\nNone required. This script operates entirely on input properties and selected geometry.\n\n## Tips\n- **Wildcards**: You can use `*` in the filter fields (e.g., `SCL*` to match all scl beams).\n- **Double Extension**: The \"Extend with\" value applies to both the Start and End points of the beam. If you enter `20`, the total beam length increases by `40`.\n- **Undo**: You can use the standard AutoCAD `UNDO` command (Ctrl+Z) immediately after running the script if the result is not as expected.\n- **Exclude vs Include**: If you want to extend \"Everything except plates\", it is often easier to set the Filter Operation to \"Exclude\" and enter the Plate beam code in the filter.\n\n## FAQ\n- **Q: Why did nothing happen?**\n  - A: Check your filters. If \"Filter operation\" is set to \"Include\" and your text fields are empty, or if your text filters do not match any beams, no changes will be made. Also ensure \"Use props for filtering\" is set correctly if you are relying on Beam Type.\n  \n- **Q: Can I extend beams by different amounts at the start and end?**\n  - A: No, this script adds the same length (`dExtendWith`) to both ends of the beam.\n  \n- **Q: Does this script work on individual beams or elements?**\n  - A: You must select the parent **Element** (e.g., the wall). The script will then find and modify the beams inside that element."
      },
      "tokens_used": 6375,
      "error": null
    }
  }
}