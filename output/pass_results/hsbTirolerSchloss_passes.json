{
  "filename": "hsbTirolerSchloss.mcr",
  "status": "completed",
  "total_tokens": 54103,
  "processing_time": 226.54821348190308,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "2.0",
            "date": "19jun17\"",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "tapering enhanced on diagonal notches, negative seatcut values are forcing additional beamcuts"
          },
          {
            "version": "1.9",
            "date": "16.11.2009",
            "author": "th@hsbCAD.de",
            "changes": "DE   bei ungleichen Wandhöhen wird  nun die Start- und Endhöhe korrekt berücksichtigt\n      um auch halbe Verbindungen zu berücksichtigen, stellen Sie bitte sicher, dass die \n      gewählte Endhöhe die Oberkante der betreffenden Bohle überragt\n EN   bugfix for different wall heights and specified start and end height.\n      to ensure also half connections t be included specify end height such that the height at the upper\n      face of the last log is below the given endheight"
          },
          {
            "version": "1.8",
            "date": "10.07.2008",
            "author": "th@hsbCAD.de",
            "changes": "DE   neuer Kontextbefehl zum Wechsel der Y-Richtung\n EN   new context command to swap Y-Alignment"
          },
          {
            "version": "1.7",
            "date": "26.06.2008",
            "author": "th@hsbCAD.de",
            "changes": "DE   Korrektur für komplexe Bauteile, Werkzeug wird nicht mehr gelöscht\n EN   tool will not be deleted on complex beams"
          },
          {
            "version": "1.6",
            "date": "23.06.2008",
            "author": "th@hsbCAD.de",
            "changes": ""
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8950,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates and modifies 3D geometry using Beam.addTool(), BeamCut, and TirolerSchloss tool objects. It operates on Element and GenBeam entities to calculate connections. No 'sd_' prefixes, Viewport logic, or 2D drawing generation code found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 7270,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Select 2 walls, <Enter> to insert with beam mode\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": false\n      },\n      {\n        \"step\": 2,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Select other element\",\n        \"condition\": \"_bOnInsert && (_Element.length() == 1)\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"getBeam\",\n        \"promptOriginal\": \"Select beam (implied)\",\n        \"condition\": \"_bOnInsert && (_Element.length() < 2)\",\n        \"required\": true\n      },\n      {\n        \"step\": 4,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select a other beams|\",\n        \"condition\": \"_bOnInsert && (_Element.length() < 2)\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"ShowNotice\",\n      \"trigger\": \"Duplicate TSL detected on connection\",\n      \"title\": \"Notice\",\n      \"dataSource\": \"scriptName()\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"sMacro\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Tool Shape\",\n      \"defaultValue\": \"Corner convex\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Convex\",\n        \"Concave\",\n        \"Diagonal\"\n      ],\n      \"category\": null,\n      \"description\": \"Shape of the Tiroler Schloss connection (Options vary based on Master/Slave mode)\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dTSGap\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Gap\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": null,\n      \"description\": \"Gap of the tool\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"dOffsetThis\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Seat width\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Seatcut / Tapering\",\n      \"description\": \"The width of the seat cut or the diagonal milling, Negative values forcing an additional beamcut.\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"dOffsetOther\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Tapering / Seat depth\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Seatcut / Tapering\",\n      \"description\": \"The width of the seat cut or the diagonal milling, Negative values forcing an additional beamcut.\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"dDovetailAngle\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Flankenwinkel\",\n      \"defaultValue\": 8,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Seatcut / Tapering\",\n      \"description\": \"The side angle\"\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"dExtraLength\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Protrusion\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n"
      },
      "tokens_used": 10484,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the generation of Tiroler Schloss (Block Dovetail) corner and T-connections for log construction walls.",
          "category": "Joinery/Machining",
          "typicalUseCase": "Connecting intersecting log walls (corner junctions or T-junctions) using traditional interlocking dovetail profiles with optional seating or tapering."
        },
        "parameters": [
          {
            "name": "sMacro",
            "technicalDefault": "Corner convex",
            "businessMeaning": "Defines the geometry type of the connection: the shape (Convex/Male vs Concave/Female) and the configuration (Corner vs T-Connection). This determines how the logs interlock.",
            "validRange": "N/A (Dropdown Selection)",
            "unit": "Selection",
            "affectsOutput": "Swaps the generated solid geometry between a protruding dovetail tail and a receiving socket, and adjusts the orientation for T-junctions."
          },
          {
            "name": "dTSGap",
            "technicalDefault": 0,
            "businessMeaning": "Expansion or assembly gap between the two interlocking logs.",
            "validRange": "0mm to 10mm",
            "unit": "mm",
            "affectsOutput": "Reduces the volume of the tool geometry slightly to ensure loose fit or allow for timber expansion."
          },
          {
            "name": "dOffsetThis",
            "technicalDefault": 0,
            "businessMeaning": "The horizontal offset (seat width) of the dovetail tail on the primary beam relative to its center or face. Negative values create a flat seat cut (horizontal notch) at the bottom of the dovetail.",
            "validRange": "-Beam Width/2 to +Beam Width/2",
            "unit": "mm",
            "affectsOutput": "Moves the dovetail shoulders horizontally. If negative, it triggers an additional 'BeamCut' operation to create a flat seat instead of a sharp angle."
          },
          {
            "name": "dOffsetOther",
            "technicalDefault": 0,
            "businessMeaning": "The horizontal offset (seat depth/tapering) of the mating profile on the intersecting beam. Acts as the width of the socket or diagonal milling.",
            "validRange": "-Beam Width/2 to +Beam Width/2",
            "unit": "mm",
            "affectsOutput": "Adjusts the width of the socket on the secondary beam. In Diagonal mode, this controls the taper width."
          },
          {
            "name": "dDovetailAngle",
            "technicalDefault": 8,
            "businessMeaning": "The wedge angle of the dovetail sides (Flankenwinkel). Controls the 'pull-out resistance' of the joint.",
            "validRange": "5 to 15 degrees",
            "unit": "degrees",
            "affectsOutput": "Changes the slope of the angled faces of the tool. Steeper angles increase resistance but make assembly harder."
          },
          {
            "name": "dExtraLength",
            "technicalDefault": 0,
            "businessMeaning": "The length of material protruding beyond the intersection point (overhang). Used for weather protection or aesthetic detailing.",
            "validRange": "0mm to 200mm",
            "unit": "mm",
            "affectsOutput": "Extends the tool geometry along the beam vector, cutting the intersecting beam shorter while leaving the primary beam longer."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User selects 'Diagonal' in sMacro",
            "effect": "Locks dOffsetThis to match dOffsetOther to ensure symmetry.",
            "cascade": [
              "dOffsetThis"
            ]
          },
          {
            "trigger": "User enters negative value for dOffsetThis",
            "effect": "Script logic switches from standard dovetail generation to adding a secondary 'BeamCut' to create a flat horizontal seat.",
            "cascade": [
              "BeamCut operation"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TirolerSchloss (Solid)",
            "description": "The primary subtractive volume representing the male or female dovetail profile.",
            "appliedTo": "Selected GenBeams (Logs)"
          },
          {
            "type": "BeamCut (Solid)",
            "description": "An additional subtractive volume used for seat cuts (horizontal notches) when offset values are negative.",
            "appliedTo": "Selected GenBeams (Logs)"
          },
          {
            "type": "Display (Graphics)",
            "description": "2D projection of the joint profile for shop drawings.",
            "appliedTo": "ModelSpace View"
          }
        ]
      },
      "tokens_used": 10133,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script (hsbTirolerSchloss.mcr)",
          "Prompt User: Select 2 walls or <Enter> to insert with beam mode",
          "[Branch A: Element Mode] User selects Element 1",
          "Prompt User: Select other element",
          "User selects Element 2 (Must intersect Element 1, non-parallel)",
          "System checks for duplicate TSL instances on selected elements",
          "[Validation] If duplicate found: Delete instance and abort. If not: Proceed.",
          "System sets Master TSL properties (Tool Range, Dimstyle)",
          "System generates TSL instances on intersecting logs within Height Range",
          "[Branch B: Beam Mode] User presses <Enter>",
          "Prompt User: Select beam",
          "User selects Beam 1",
          "System detects Element of Beam 1",
          "Prompt User: Select other beams",
          "User selects Beam 2 (Must intersect Beam 1)",
          "[Validation] If < 2 beams selected: Report notice, delete instance.",
          "System generates single TSL instance on Beams",
          "Calculate Geometry (Tool location, vectors, offsets based on shape selection)",
          "Generate Solid Tool (TirolerSchloss)",
          "[Conditional] Apply Additional BeamCut (if Offset < 0 and not Diagonal)",
          "Apply Stretch (if T-Connection)",
          "Draw Display Symbol",
          "Finish"
        ],
        "conditionalBranches": [
          {
            "condition": "User Input Method (Element Mode vs Beam Mode)",
            "path1": {
              "name": "Element Mode (Wall Mode)",
              "steps": [
                "Select 2 Elements (Walls)",
                "Validate non-parallel and intersection",
                "Check for existing Master TSL on connection",
                "Set 'isMaster' flag",
                "Use Master Properties (Start/End Height, Master Tool Shape)",
                "Iterate logs in height range to spawn Slave TSLs"
              ]
            },
            "path2": {
              "name": "Beam Mode",
              "steps": [
                "Press <Enter> at first prompt",
                "Select 2 individual Beams",
                "Validate count >= 2",
                "Use Standard Properties (Individual Tool Shape, single instance)",
                "Process just the selected beams"
              ]
            }
          },
          {
            "condition": "Tool Shape Selection (Diagonal vs Others)",
            "path1": {
              "name": "Diagonal Mode",
              "steps": [
                "Set 'bDiagonal' flag",
                "Lock 'dOffsetThis' to equal 'dOffsetOther'",
                "Disable additional BeamCut for negative seatcut (logic handled inside diagonal geometry)"
              ]
            },
            "path2": {
              "name": "Standard Modes (Convex/Concave/T-Connection)",
              "steps": [
                "Keep 'dOffsetThis' and 'dOffsetOther' independent",
                "Check for negative 'dOffsetThis'",
                "If negative: Trigger secondary 'BeamCut' for seat cut"
              ]
            }
          },
          {
            "condition": "Joint Configuration (Corner vs T-Connection)",
            "path1": {
              "name": "Corner Connection",
              "steps": [
                "Stretch tool on insert (kStretchOnInsert)",
                "Vector calculations standard intersection"
              ]
            },
            "path2": {
              "name": "T-Connection",
              "steps": [
                "Disable 'StretchOnInsert' (nStretch = 0)",
                "Apply specific vector orientation adjustments",
                "Check for 'MillAbove' (cleanup cuts above)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Duplicate TSL on Connection",
            "errorMessage": "Incorrect user input. An instance of this tsl is already attached to this connection. Tsl will be deleted.",
            "recovery": "User must select existing instance and modify it, or delete existing instance before inserting new one."
          },
          {
            "check": "Parallel Elements (Element Mode)",
            "errorMessage": "Invalid selection. Elements are parallel.",
            "recovery": "User must select a second element that intersects the first at an angle."
          },
          {
            "check": "Insufficient Beams (Beam Mode)",
            "errorMessage": "Incorrect user input. At least 2 beams are required.",
            "recovery": "User must run command again and ensure at least 2 beams are selected."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry Properties",
            "how": "Properties Palette (OPM)",
            "effect": "Updates Gap, Seat width, Tapering, Angle, and Protrusion. Recalculates tool solid immediately."
          },
          {
            "action": "Swap Y-Direction",
            "how": "Right-click Context Menu",
            "effect": "Flips the orientation of the tool along the Y-axis. Useful for connecting tools with same shape for extended protrusion."
          },
          {
            "action": "Swap X-Direction",
            "how": "Right-click Context Menu",
            "effect": "Swaps the direction in X."
          },
          {
            "action": "Adjust Wall Height Range (Element Mode only)",
            "how": "Properties Palette (OPM) -> 'Start at Height' / 'End at Height'",
            "effect": "Adds or removes TSL instances on logs that fall into the new height range."
          }
        ]
      },
      "tokens_used": 10261,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbTirolerSchloss.mcr\n\n## Overview\nThis script automates the creation of Tiroler Schloss (Block Dovetail) joinery for log construction. It generates interlocking corner and T-connections between logs with options for convex/concave shapes, seat cuts, and protrusions.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D GenBeams and Elements. |\n| Paper Space | No | Not applicable for this script. |\n| Shop Drawing | No | Tool geometry is applied in the model. |\n\n## Prerequisites\n- **Required Entities**: Two intersecting `Element` (walls) or two `GenBeam` (logs).\n- **Minimum Beam Count**: 2.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT` → Select `hsbTirolerSchloss.mcr` from the list.\n\n### Step 2: Choose Insertion Mode\n```\nCommand Line: Select 2 walls, <Enter> to insert with beam mode\nAction: \n  - To process entire walls: Select the first wall Element.\n  - To process specific logs: Press <Enter>.\n```\n\n### Step 3: Select Second Element (Wall Mode Only)\n```\nCommand Line: Select other element\nAction: Select the second intersecting wall.\nNote: The walls must intersect and cannot be parallel.\n```\n\n### Step 4: Select Beams (Beam Mode Only)\n```\nCommand Line: Select beam\nAction: Select the first log (GenBeam).\n```\n\n### Step 5: Select Intersecting Beams (Beam Mode Only)\n```\nCommand Line: Select a other beams\nAction: Select the intersecting log(s).\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Tool Shape | Dropdown | Corner convex | Determines the geometry type (Convex/Male, Concave/Female, Diagonal) and configuration (Corner vs T-Connection). |\n| Gap | Number | 0 | Expansion or assembly gap between the interlocking logs (mm). |\n| Seat width | Number | 0 | Horizontal offset of the dovetail tail. Use a **negative value** to create a flat seat cut (horizontal notch) instead of a sharp angle. |\n| Tapering / Seat depth | Number | 0 | Horizontal offset of the mating profile on the intersecting beam. Acts as socket width or tapering. |\n| Flankenwinkel | Number | 8 | The wedge angle of the dovetail sides (degrees). Controls pull-out resistance. |\n| Protrusion | Number | 0 | Length of material protruding beyond the intersection point (mm). |\n| Start at Height | Number | - | *Wall Mode Only*: The lowest Z-height at which the connection is applied. |\n| End at Height | Number | - | *Wall Mode Only*: The highest Z-height at which the connection is applied. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Swap Y-Direction | Flips the orientation of the tool along the Y-axis. Useful for aligning tools with same shapes for extended connections. |\n| Swap X-Direction | Flips the orientation of the tool along the X-axis. |\n\n## Settings Files\n- **Filename**: None detected.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Wall Mode vs Beam Mode**: Use \"Wall Mode\" (selecting Elements) to automatically apply the connection to all logs in the wall within the specified height range. Use \"Beam Mode\" for one-off connections on specific logs.\n- **Flat Seat Cuts**: If you need a horizontal seat (shelf) inside the dovetail, enter a negative number for the **Seat width** property.\n- **Diagonal Connections**: When \"Diagonal\" is selected in Tool Shape, the **Seat width** automatically locks to match the **Tapering / Seat depth** to ensure the cut is symmetrical.\n- **Avoiding Duplicates**: If the script reports a duplicate and deletes itself, delete the existing connection on the selected beams manually before re-inserting.\n\n## FAQ\n- **Q: Why did the tool disappear immediately after I selected the beams?**\n  - A: The most likely cause is that a \"Tiroler Schloss\" tool already exists on that specific connection. Delete the existing tool first, or ensure the elements are not parallel.\n- **Q: How can I apply the connection only to the bottom half of a wall?**\n  - A: Use Wall Mode, and after insertion, open the Properties Palette. Set \"End at Height\" to the desired top level of the bottom section.\n- **Q: What does a negative \"Seat width\" do?**\n  - A: It forces the script to create an additional horizontal cut (a seat) at the bottom of the dovetail profile, rather than a sharp angled point."
      },
      "tokens_used": 7005,
      "error": null
    }
  }
}