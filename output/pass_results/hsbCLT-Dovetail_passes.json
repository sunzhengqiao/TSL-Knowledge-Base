{
  "filename": "hsbCLT-Dovetail.mcr",
  "status": "completed",
  "total_tokens": 49455,
  "processing_time": 317.87584686279297,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl creates a dove tail connection between two panels",
        "versionHistory": [
          {
            "version": "1.4",
            "date": "12dec17",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "helper beamcuts do not export to any machine"
          },
          {
            "version": "1.3",
            "date": "24may17",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "article name of hardware changed to X-fix L"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8031,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _kModelSpace in dbCreate() calls. It operates on ElementWall and GenBeam/Sip entities to generate 3D connections. No references to _Viewport, sd_ prefixes, or #Type E found."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall",
            "Sip"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Must be attached to an ElementWall in the 3D model.",
          "requiredSettings": []
        }
      },
      "tokens_used": 7009,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dXWidth",
            "type": "PropDouble",
            "displayName": "(A)  Width",
            "defaultValue": "50",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the depth of the lap joint seen from reference side 0 = 50% of thickness"
          },
          {
            "index": 1,
            "variable": "dZDepth",
            "type": "PropDouble",
            "displayName": "(B)  Depth",
            "defaultValue": "28",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the width of the lap joint of the main panel"
          },
          {
            "index": 2,
            "variable": "dAlfa",
            "type": "PropDouble",
            "displayName": "(C)  Angle",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the angle dovetail."
          },
          {
            "index": 3,
            "variable": "dGap",
            "type": "PropDouble",
            "displayName": "(D)  Gap X",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the gap in depth."
          },
          {
            "index": 4,
            "variable": "dAxisOffset",
            "type": "PropDouble",
            "displayName": "(E)  Axis Offset X",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Alignment",
            "description": "Defines horizontal offset of the tool."
          },
          {
            "index": 5,
            "variable": "dBottomOffset",
            "type": "PropDouble",
            "displayName": "(F)  Bottom Offset",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Alignment",
            "description": "Defines bottom offset of the tool. 0 = complete through"
          },
          {
            "index": 0,
            "variable": "sDoveMode",
            "type": "PropString",
            "displayName": "(G)  Connection Type",
            "defaultValue": "Dovetail",
            "inputType": "dropdown",
            "options": [
              "Dovetail",
              "Butterfly Spline"
            ],
            "category": null,
            "description": "Specifies if the dove is added to the male set or if two female doves are added"
          },
          {
            "index": 6,
            "variable": "dChamferRef",
            "type": "PropDouble",
            "displayName": "(H)  Chamfer",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Reference Side",
            "description": null
          },
          {
            "index": 7,
            "variable": "dChamferOpp",
            "type": "PropDouble",
            "displayName": "(I)  Chamfer",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "opposite side",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Flip Side",
            "handler": "Flip Side",
            "action": "Inverts the side of the element the connection is applied to.",
            "alsoTriggeredBy": "TslDoubleClick"
          },
          {
            "menuItem": "Flip Direction",
            "handler": "Flip Direction",
            "action": "Toggles the direction of the connection.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7762,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a dovetail or butterfly spline connection between two panels to interlock them mechanically.",
          "category": "Joinery/Machining",
          "typicalUseCase": "Used to join CLT or timber panels where a strong, interlocking connection is required, either for shear resistance or alignment, typically without exposed metal hardware."
        },
        "parameters": [
          {
            "name": "dXWidth",
            "technicalDefault": "50",
            "businessMeaning": "The horizontal width of the dovetail tenon (or slot) along the face of the panel.",
            "validRange": "20 - 150",
            "unit": "mm",
            "affectsOutput": "Adjusts the size of the male/female interlocking part. Increasing this increases the contact area but requires more material removal."
          },
          {
            "name": "dZDepth",
            "technicalDefault": "28",
            "businessMeaning": "The depth of the cut perpendicular to the panel face (how deep the dovetail penetrates the panel).",
            "validRange": "10 - Panel Thickness",
            "unit": "mm",
            "affectsOutput": "Determines the thickness of the interlocking 'fingers'. Deeper cuts provide greater shear capacity but reduce the remaining wall thickness."
          },
          {
            "name": "dAlfa",
            "technicalDefault": "0",
            "businessMeaning": "The taper angle of the dovetail sides (draft angle) to create a friction fit.",
            "validRange": "5 - 15",
            "unit": "degrees",
            "affectsOutput": "Controls the slope of the connection sides. A higher angle eases assembly but reduces the self-locking effect; a lower angle creates a tighter joint."
          },
          {
            "name": "dGap",
            "technicalDefault": "1",
            "businessMeaning": "The clearance gap between the male and female parts to account for glue tolerance and wood swelling.",
            "validRange": "0 - 5",
            "unit": "mm",
            "affectsOutput": "A 0 value creates a tight press-fit; higher values allow for easier assembly and glue squeeze-out."
          },
          {
            "name": "dAxisOffset",
            "technicalDefault": "0",
            "businessMeaning": "Moves the entire connection profile horizontally along the joint line.",
            "validRange": "-PanelWidth to PanelWidth",
            "unit": "mm",
            "affectsOutput": "Shifts the cut location relative to the insertion point without moving the script instance."
          },
          {
            "name": "dBottomOffset",
            "technicalDefault": "0",
            "businessMeaning": "Moves the connection vertically relative to the bottom of the panel or reference plane.",
            "validRange": "0 - PanelHeight",
            "unit": "mm",
            "affectsOutput": "0 implies the joint runs through the full height or aligns to the bottom edge. Increasing this value creates a stopped joint or shifts the connection upward."
          },
          {
            "name": "sDoveMode",
            "technicalDefault": "Dovetail",
            "businessMeaning": "Selects the type of profile: a standard dovetail or a butterfly spline.",
            "validRange": "Dovetail, Butterfly Spline",
            "unit": "enum",
            "affectsOutput": "Switches the geometry generation logic. Dovetail creates a tapered tenon; Butterfly Spline creates a double-tapered key insert (often requiring different machining on both panels)."
          },
          {
            "name": "dChamferRef",
            "technicalDefault": "0",
            "businessMeaning": "Bevels the edges of the cut on the Reference Side (Side 0) of the panel.",
            "validRange": "0 - 10",
            "unit": "mm",
            "affectsOutput": "Adds a chamfer to the entry edges, facilitating assembly and preventing edge chipping."
          },
          {
            "name": "dChamferOpp",
            "technicalDefault": "0",
            "businessMeaning": "Bevels the edges of the cut on the Opposite Side (Side 1) of the panel.",
            "validRange": "0 - 10",
            "unit": "mm",
            "affectsOutput": "Adds a chamfer to the exit or back side edges."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dXWidth > 50% of Panel Thickness",
            "effect": "The structural integrity of the panel may be compromised as the remaining 'web' becomes too thin.",
            "cascade": [
              "dZDepth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Machining/Cut",
            "description": "The material removal for the female slot portion of the joint.",
            "appliedTo": "The Primary ElementWall (Reference Panel)"
          },
          {
            "type": "Machining/Cut",
            "description": "The material removal to create the male tenon or the negative space for a butterfly spline on the secondary panel.",
            "appliedTo": "The Secondary Sip/ElementWall (Adjoining Panel)"
          }
        ]
      },
      "tokens_used": 8859,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Initialization: Declare properties and constants.",
          "Check Execution Context: Is _bOnMapIO active?",
          "[Yes]: Run MapIO logic to detect coplanar touching panels and store connections. Stop.",
          "[No]: Proceed to standard insertion logic.",
          "Check Insertion Key: If _kOnInsert, check for _kExecuteKey (Catalog entry).",
          "Validate Selection: Ensure _Element[0] is a valid ElementWall.",
          "[Invalid]: Report error and erase instance.",
          "[Valid]: Calculate element coordinate system and determine insertion side (nSide).",
          "Check Triggers: Has 'Flip Side' or 'Flip Direction' been triggered via context menu?",
          "[Yes]: Update side or direction state and return.",
          "[No]: Continue to construction check.",
          "Check Construction State: Are there GenBeams (Sips) inside the element?",
          "[No Sips/Preview Mode]: Draw plan symbol at _Pt0 and display script name.",
          "[Sips Found/Construct Mode]:",
          "1. Set execution loops to 2.",
          "2. Define a split plane at _Pt0 perpendicular to the wall.",
          "3. Iterate through Sips to find those intersecting the split plane.",
          "4. Split the intersecting Sip into two parts using dbSplit.",
          "5. Create a new clone instance of the script attached to the split Sip parts.",
          "6. Pass current properties (Width, Depth, Mode) and vector data to the clone.",
          "Script Execution Complete."
        ],
        "conditionalBranches": [
          {
            "condition": "MapIO Mode Active (_bOnMapIO)",
            "path1": {
              "name": "Auto-Connect Logic",
              "steps": [
                "Filter input Sips for coplanarity and thickness.",
                "Identify parallel, touching edges between panels.",
                "Map connection data to _Map.",
                "Return script execution."
              ]
            },
            "path2": {
              "name": "Standard Script Execution",
              "steps": [
                "Check for ElementWall.",
                "Handle properties and user interactions.",
                "Perform splits and geometry generation."
              ]
            }
          },
          {
            "condition": "Construction State (Sips Exist)",
            "path1": {
              "name": "Preview Mode",
              "steps": [
                "If genBeams.length < 1.",
                "Draw dynamic plan symbol at insertion point.",
                "Do not perform splits."
              ]
            },
            "path2": {
              "name": "Construction Mode",
              "steps": [
                "If Sips are present.",
                "Split Sips at insertion point.",
                "Clone script to split parts."
              ]
            }
          },
          {
            "condition": "Context Menu Trigger",
            "path1": {
              "name": "Flip Side",
              "steps": [
                "Trigger: 'Flip Side' or Double Click.",
                "Invert nSide variable.",
                "Transform _Pt0 to opposite side of panel."
              ]
            },
            "path2": {
              "name": "Flip Direction",
              "steps": [
                "Trigger: 'Flip Direction'.",
                "Toggle bFlipDir boolean state.",
                "Invert vecZFace vector."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Type Validation",
            "errorMessage": "hsbCLT-Dovetail could not find reference to element.",
            "recovery": "User must delete the instance and re-select a valid ElementWall."
          },
          {
            "check": "Catalog Entry Validation",
            "errorMessage": "Could not find [CatalogName] in the list of catalog entries. The instance is now created with its default values.",
            "recovery": "Script continues with default property values; user can manually adjust via OPM."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry Parameters",
            "how": "OPM Properties Palette",
            "effect": "Updating Width (dXWidth), Depth (dZDepth), Angle (dAlfa), or other props updates the generated dovetail geometry in the cloned instances."
          },
          {
            "action": "Move Connection Location",
            "how": "Grip Edit _Pt0",
            "effect": "Moves the split plane, causing the Sip to be split at a new location and the connection to shift."
          },
          {
            "action": "Flip Connection Side",
            "how": "Context Menu 'Flip Side' or Double Click",
            "effect": "Inverts the side of the panel the connection is applied to (Front vs Back)."
          },
          {
            "action": "Flip Connection Direction",
            "how": "Context Menu 'Flip Direction'",
            "effect": "Toggles the orientation of the dovetail along the joint axis."
          }
        ]
      },
      "tokens_used": 11196,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-Dovetail.mcr\n\n## Overview\nThis script creates a dovetail or butterfly spline connection between two panels to mechanically interlock them. It is designed for CLT (Cross Laminated Timber) or timber panels to generate strong, glue-free joinery or mechanical connections within the 3D model.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on ElementWall and Sip entities in 3D. |\n| Paper Space | No | Not intended for 2D layout or detailing views. |\n| Shop Drawing | No | Machining data is generated in the model, not directly in drawings. |\n\n## Prerequisites\n- **Required Entities**: Must be applied to an `ElementWall` (CLT Panel).\n- **Minimum Beam Count**: None (script detects internal Sips/Beams within the wall).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT` (or `TSL` depending on environment)\n**Action:** Browse the script list and select `hsbCLT-Dovetail.mcr`.\n\n### Step 2: Select Element\n**Command Line:** `Select Element:`\n**Action:** Click on the `ElementWall` (Panel) where you want the dovetail connection to occur.\n\n### Step 3: Define Insertion Point\n**Command Line:** `Specify insertion point:`\n**Action:** Click on the face of the selected wall at the location where the panel should be split and connected.\n*Note: This point determines where the internal sub-elements (Sips) are split.*\n\n### Step 4: Adjust Configuration\n**Action:** Once placed, select the script instance in the model. Open the **Properties Palette** (Ctrl+1) to adjust dimensions (Width, Depth, Gap) or select the connection type (Dovetail vs. Butterfly Spline).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| (A) Width | Number | 50 | Defines the depth of the lap joint seen from the reference side (0 = 50% of thickness). |\n| (B) Depth | Number | 28 | Defines the width of the lap joint of the main panel. |\n| (C) Angle | Number | 0 | Defines the taper angle (draft) of the dovetail sides. |\n| (D) Gap X | Number | 1 | Defines the clearance gap in depth for glue tolerance. |\n| (E) Axis Offset X | Number | 0 | Defines horizontal offset of the tool profile from the insertion point. |\n| (F) Bottom Offset | Number | 0 | Defines vertical offset (0 = complete through). Shifts the joint up from the bottom. |\n| (G) Connection Type | Dropdown | Dovetail | Select between \"Dovetail\" (standard tenon) or \"Butterfly Spline\" (double-tapered key). |\n| (H) Chamfer (Ref Side) | Number | 0 | Adds a bevel (chamfer) to the edges on the Reference Side (Side 0). |\n| (I) Chamfer (Opp Side) | Number | 0 | Adds a bevel (chamfer) to the edges on the Opposite Side (Side 1). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip Side | Inverts the side of the element the connection is applied to (Front/Back). Also triggered by Double-Clicking the script. |\n| Flip Direction | Toggles the direction/orientation of the dovetail along the joint axis. |\n\n## Settings Files\n- **Filename**: None used.\n\n## Tips\n- **Double-Click to Flip:** You can quickly toggle the connection side by double-clicking the script instance in the model, rather than using the Right-Click menu.\n- **Gap for Glue:** If you plan to glue the joint, ensure the (D) Gap X is set to at least 1mm or 2mm to allow for glue squeeze-out and proper adhesion.\n- **Butterfly Mode:** Use the \"Butterfly Spline\" mode in the Connection Type property if you are creating a separate key piece insert rather than a direct edge-to-edge joint.\n\n## FAQ\n- **Q: Why did my panel disappear?**\n  **A:** The script automatically splits the internal Sips (sub-elements) of the ElementWall at the insertion point. If the visual representation changes, check if the Sips were split correctly. You can Undo (Ctrl+Z) and try a different insertion point if needed.\n- **Q: Can I use this on a single solid beam?**\n  **A:** No, this script is designed specifically for `ElementWall` entities that contain internal `Sip` or `GenBeam` structures. It relies on splitting these internal sub-elements to create the joint.\n- **Q: What does \"0 = 50% of thickness\" mean for Width (A)?**\n  **A:** If you set the (A) Width property to 0, the script will automatically calculate the depth of the joint to be exactly half the thickness of the panel, creating a balanced center connection."
      },
      "tokens_used": 6598,
      "error": null
    }
  }
}