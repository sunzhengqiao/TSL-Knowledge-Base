{
  "filename": "TrussNailPlate.mcr",
  "status": "completed",
  "total_tokens": 28055,
  "processing_time": 442.231609582901,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.3",
            "date": "06jul20",
            "author": "nils.gregor@hsbcad.com",
            "changes": "HSB-7515 bugfix length/depth as double"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 2651,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script instantiates 3D geometry using the Body class and utilizes Display(-1) for visualization. It lacks Paper Space specific calls (e.g., _Viewport), Shop Drawing prefixes (sd_*), and does not handle _Entity[] arrays or #Type E definitions. Logic is driven by _Map properties."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (Insertion based component)",
          "requiredSettings": []
        }
      },
      "tokens_used": 3401,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 1,
            "variable": "strPlateGauge",
            "type": "PropString",
            "displayName": "Plate Gauge",
            "defaultValue": "strGauge",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strPlateLabel",
            "type": "PropString",
            "displayName": "Plate Label",
            "defaultValue": "strLabel",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dPlateLength",
            "type": "PropDouble",
            "displayName": "Plate Length",
            "defaultValue": "dLength",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dPlateHeight",
            "type": "PropDouble",
            "displayName": "Plate Height",
            "defaultValue": "dDepth",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "dPlateThickness",
            "type": "PropDouble",
            "displayName": "Plate Thickness",
            "defaultValue": "dThickness",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4294,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates 3D solid bodies representing metal nail plates used to connect timber members in truss construction.",
          "category": "Hardware/Connector",
          "typicalUseCase": "Automatically inserted by a parent truss generation script to visualize the position, size, and orientation of nail plates at the intersections of chords and webs."
        },
        "parameters": [
          {
            "name": "strPlateGauge",
            "technicalDefault": "strGauge",
            "businessMeaning": "Identifies the gauge or thickness standard of the metal plate (e.g., '20ga', '2.0mm'). Used for material reporting and labeling.",
            "validRange": "Text (Standard gauge codes or thickness values)",
            "unit": "text",
            "affectsOutput": "Non-geometric. Updates the property palette for BIM data extraction and tagging."
          },
          {
            "name": "strPlateLabel",
            "technicalDefault": "strLabel",
            "businessMeaning": "A user-defined identifier or part number for the specific plate profile.",
            "validRange": "Text",
            "unit": "text",
            "affectsOutput": "Non-geometric. Used for identification in drawings and schedules."
          },
          {
            "name": "dPlateLength",
            "technicalDefault": "dLength",
            "businessMeaning": "The physical length of the nail plate (typically along the longitudinal axis of the timber).",
            "validRange": "50 mm - 600 mm",
            "unit": "mm",
            "affectsOutput": "Determines the size of the plate body along the local X-axis."
          },
          {
            "name": "dPlateHeight",
            "technicalDefault": "dDepth",
            "businessMeaning": "The physical width or height of the plate (dimension perpendicular to the plate length).",
            "validRange": "25 mm - 300 mm",
            "unit": "mm",
            "affectsOutput": "Determines the size of the plate body along the local Y-axis (or Z-axis depending on offset configuration)."
          },
          {
            "name": "dPlateThickness",
            "technicalDefault": "2.0",
            "businessMeaning": "The material thickness of the steel plate.",
            "validRange": "1.0 mm - 4.0 mm (Typically 1.0 - 2.5 for nail plates)",
            "unit": "mm",
            "affectsOutput": "Determines the extrusion depth (Z-axis or Y-axis) of the 3D solid body."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Internal Map variable 'vecZOffset' (Plate offset) or 'singlePlate'",
            "effect": "Changes the geometric interpretation of Height and Thickness relative to the plate's coordinate system.",
            "cascade": [
              "dPlateHeight",
              "dPlateThickness"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D Body (Solid)",
            "description": "A rectangular solid representation of a steel nail plate. Can generate one or two plates (doubled) based on internal configuration.",
            "appliedTo": "Model Space (Component Instance)"
          }
        ]
      },
      "tokens_used": 4868,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. <Initialization> Triggered on Insert or Recalculation. Check _bOnDbCreated flag.",
          "2. <One-time Setup> If _bOnDbCreated is true, set the instance color to index 8.",
          "3. <Input Acquisition> Retrieve 'Length' from the _Map.",
          "4. <Validation Check> Validate if 'Length' is greater than 0. If not, abort execution (no geometry drawn).",
          "5. <Coordinate System Resolution> Retrieve Vector X, Y, Z components from _Map.",
          "6. <Branch: CS Source> Check if Map vectors are all zero (Legacy check).",
          "   - <True>: Use _ThisInst.coordSys() for vectors and retrieve 'vecZOffset' from Map.",
          "   - <False>: Use vectors explicitly defined in the Map.",
          "7. <Parameter Loading> Retrieve Width, Gauge, and Label from Map.",
          "8. <Dimension Validation> Check if 'Width' (Depth) is greater than 0.",
          "9. <Thickness Logic> Retrieve 'Thickness' from Map. If missing, default to 2.0mm.",
          "10. <Property Registration> Create PropDouble and PropString entries for OPM. Set all to Read-Only.",
          "11. <Normalization> Normalize Orientation Vectors (VecBX, VecBY, VecBZ).",
          "12. <Branch: Geometry Mode> Check if (vecZOffset > 0.0 OR singlePlate != 0).",
          "   - <True>: Generate 'Offset/Side' Plates (Thickness aligns to local Z).",
          "   - <False>: Generate 'Centered' Plate (Thickness aligns to local Y).",
          "13. <Visualization> Draw the generated Body(s) to the Display buffer."
        ],
        "conditionalBranches": [
          {
            "condition": "Coordinate System Source (_Map vector values)",
            "path1": {
              "name": "Legacy/Explicit Map Mode",
              "steps": [
                "Check XV_X, XV_Y, XV_Z are non-zero.",
                "Assign orientation vectors directly from Map values.",
                "Set vecZOffset to 0.0."
              ]
            },
            "path2": {
              "name": "Current Instance/Model Map Mode",
              "steps": [
                "Detect Map vectors are (0,0,0).",
                "Extract coordinate system from _ThisInst.coordSys().",
                "Extract vecZOffset from Map to allow double-plating."
              ]
            }
          },
          {
            "condition": "Geometry Configuration (Offset vs Single)",
            "path1": {
              "name": "Offset/Doubled Plate Mode",
              "steps": [
                "Enter if vecZOffset > 0 or singlePlate is set.",
                "Create Body at Pt0 + (vecZOffset * VecBZ).",
                "Sub-branch: If !singlePlate, create second Body at Pt0 - (vecZOffset * VecBZ).",
                "Body dimensions: Length(dLength), Depth(dDepth), Thickness(dPlateThickness)."
              ]
            },
            "path2": {
              "name": "Centered Plate Mode",
              "steps": [
                "Enter if vecZOffset is 0 and singlePlate is 0.",
                "Create Body at Pt0.",
                "Body dimensions: Length(dLength), Thickness(dPlateThickness), Depth(dDepth)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "dLength (from Map) > 0",
            "errorMessage": "None (Silent failure)",
            "recovery": "Ensure the parent script passes a valid 'Length' in the Map or the instance map is initialized correctly."
          },
          {
            "check": "dDepth (Width from Map) > 0",
            "errorMessage": "None (Silent failure)",
            "recovery": "Ensure the parent script passes a valid 'Width' in the Map."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move/Rotate Plate",
            "how": "Standard AutoCAD Grips (Positioning handles)",
            "effect": "Updates the insertion point (_Pt0) and orientation (_ThisInst.coordSys), triggering a recalc and redrawing of the plate."
          },
          {
            "action": "Modify Dimensions/Properties",
            "how": "Properties Palette (OPM)",
            "effect": "None. All properties (Gauge, Label, Length, Height, Thickness) are set to Read-Only. Changes must be made via the parent generating script."
          },
          {
            "action": "Context Menu Recalc",
            "how": "Right-click -> Recalculate",
            "effect": "Re-runs the script logic, useful if the Map data was modified externally or coordinate system links need refreshing."
          }
        ]
      },
      "tokens_used": 6388,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# TrussNailPlate.mcr\n\n## Overview\nThis script generates 3D solid bodies representing metal nail plates used to connect timber members in truss construction. It is designed primarily as a sub-component that is automatically inserted by a parent truss generation script to visualize the position, size, and orientation of connectors.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script creates 3D solid geometry in the model. |\n| Paper Space | No | This script does not generate 2D layout views or annotations. |\n| Shop Drawing | No | This is a model-space detail component, not a drawing generator. |\n\n## Prerequisites\n- **Parent Script**: This script relies on map data (Length, Width, Coordinate System) passed to it from a parent script (e.g., a Truss Generator). It does not prompt for dimensions manually.\n- **Required Entities**: None (standalone component, but positioned relative to timber beams via parent script logic).\n- **Minimum Beam Count**: 0.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT` â†’ Select `TrussNailPlate.mcr`\n**Note:** This script is typically called automatically by a truss generation macro. If inserted manually, it requires existing Map data to display geometry.\n\n### Step 2: Execution\n```\nCommand Line: [No prompts appear]\nAction: The script reads data from the Instance Map (Length, Vectors, etc.) and generates the 3D plate geometry automatically.\n```\n*Note: Because this script reads from a Map, there are no interactive command-line inputs for dimensions or position.*\n\n## Properties Panel Parameters\nAll properties listed below are **Read-Only**. To change these values, you must modify the parent generating script or the instance map data.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Plate Gauge | Text | strGauge | Identifies the gauge or thickness standard of the metal plate (e.g., '20ga'). |\n| Plate Label | Text | strLabel | A user-defined identifier or part number for the specific plate profile. |\n| Plate Length | Number | dLength | The physical length of the nail plate (in mm). |\n| Plate Height | Number | dDepth | The physical width or height of the plate (in mm). |\n| Plate Thickness | Number | 2.0 | The material thickness of the steel plate (in mm). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Re-runs the script logic to regenerate the plate body based on the current Map data and coordinate system. |\n| (Standard Options) | Standard AutoCAD/TSL options (Erase, Move, Rotate, Properties, etc.) are available. |\n\n## Settings Files\nNo specific external settings files (`xml`) are used by this script. All configuration is handled via the parent script's Map inputs.\n\n## Tips\n- **Color Indicator**: Upon insertion, the script automatically sets the instance color to **Index 8** (Dark Grey) to distinguish it from timber elements.\n- **Geometry Visibility**: If the plate is not visible, check that the parent script provided a **Length** greater than 0. The script aborts silently if the length is invalid.\n- **Modifying Position**: Use standard AutoCAD **Grips** to move or rotate the plate after insertion. The plate will redraw to match the new orientation.\n- **Double Plates**: The script supports configurations for double-plating (two plates separated by an offset) or single centered plates, determined by the offset vectors passed by the parent script.\n\n## FAQ\n- **Q: Why can't I change the Length or Thickness in the Properties Palette?**\n  - A: This script is designed as a \"child\" component. All dimensions are Read-Only to maintain consistency with the parent truss design. You must edit the source parameters in the truss generation tool.\n- **Q: Why did my plate disappear after updating the truss?**\n  - A: The script performs a validation check. If the calculated length or width is 0 or negative (e.g., beams no longer intersect), the geometry will not be drawn. Check your truss geometry.\n- **Q: Can I use this script manually for a custom plate?**\n  - A: Yes, but you must provide the correct Map data (Length, Depth, Vectors) via the API or a custom setup script, as there are no command-line prompts to enter these values."
      },
      "tokens_used": 6453,
      "error": null
    }
  }
}