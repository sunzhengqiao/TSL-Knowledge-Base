{
  "filename": "Pitzl SPP-Verbinder.mcr",
  "status": "completed",
  "total_tokens": 55941,
  "processing_time": 837.8965299129486,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"This TSL inserts a Pitzl SPP"
      },
      "tokens_used": 9393,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script interacts directly with 3D Beams using PrEntity(..., Beam()) and modifies their geometry using addTool() (Drills/Mills). It calculates 3D intersections via LineBeamIntersect and creates instances in Model Space. There is no usage of 'sd_' prefixes, _Viewport, or View entity types typical of Paper Space or Shop Drawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 7353,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": "N/A (Dialog triggered via sLastEntry variable)",
              "condition": "_bOnInsert (when catalog not used)",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select male beam(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrEntity",
              "promptOriginal": "|Select female beam(s)|",
              "condition": "_bOnInsert",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert (if not executed from catalog) or Double Click",
            "title": "Properties (Inferred from OPM structure)",
            "dataSource": "PropString/PropDouble variables defined in script",
            "features": {
              "searchable": true,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sArticle",
            "type": "PropString",
            "displayName": "A - |Article|",
            "defaultValue": "88710.0000",
            "inputType": "dropdown",
            "options": [
              "88710.0000",
              "88712.0000",
              "88716.0000",
              "88715.0000"
            ],
            "category": "|Category|",
            "description": "|Defines the type of the connector|"
          },
          {
            "index": 1,
            "variable": "dFixingScrewLength",
            "type": "PropDouble",
            "displayName": "B - |Screw Length|",
            "defaultValue": 120,
            "inputType": "dropdown",
            "options": [
              120,
              160
            ],
            "category": "|Category|",
            "description": "|Defines the length of the fixing screws. (mm)|"
          },
          {
            "index": 2,
            "variable": "dMillDepth",
            "type": "PropDouble",
            "displayName": "C - |Additional mill depth|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|Tooling male beam|",
            "description": "|Defines the additional milling depth. (mm)|"
          },
          {
            "index": 3,
            "variable": "dTopDrillDiaOversize",
            "type": "PropDouble",
            "displayName": "D - |Oversize mill|",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": "|Tooling male beam|",
            "description": "|Defines the extra diameter of the milling. (mm)|"
          },
          {
            "index": 4,
            "variable": "dYOff",
            "type": "PropDouble",
            "displayName": "E - |Offset Lateral|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|Tooling male beam|",
            "description": "|Defines the lateral offset of the connector. (mm)|"
          },
          {
            "index": 5,
            "variable": "dZOff",
            "type": "PropDouble",
            "displayName": "F - |Offset Vertical|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|Tooling male beam|",
            "description": "|Defines the vertical offset of the connector. (mm)|"
          },
          {
            "index": 6,
            "variable": "sFemaleTool",
            "type": "PropString",
            "displayName": "G - |Tools in female beam|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Tooling female beam|",
            "description": "|Insert tools and hardware in female beam?|"
          },
          {
            "index": 7,
            "variable": "dExitDepth",
            "type": "PropDouble",
            "displayName": "H - |Extra depth sink hole|",
            "defaultValue": 10,
            "inputType": "number",
            "options": [],
            "category": "|Tooling female beam|",
            "description": "|Defines the extra depth of the sink hole. (mm)|"
          },
          {
            "index": 8,
            "variable": "dExitDiaOversize",
            "type": "PropDouble",
            "displayName": "I  - |Oversize sink hole|",
            "defaultValue": 4,
            "inputType": "number",
            "options": [],
            "category": "|Tooling female beam|",
            "description": "|Defines the extra diameter of the sink hole. (mm)|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "TslDoubleClick",
            "handler": "TslDoubleClick (via sDoubleClick variable)",
            "action": "Opens the Properties dialog via ShowDynamicDialog",
            "alsoTriggeredBy": "Double-clicking the TSL instance"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8491,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts a Pitzl SPP Shear Plate Connector to join timber beams, generating necessary CNC toolpaths and hardware assignments for both the male and female beams.",
          "category": "Hardware / Connection",
          "typicalUseCase": "Connecting structural timber elements (e.g., rafters to purlins or beams to posts) using the Pitzl SPP system where shear capacity and/or tension rods are required."
        },
        "parameters": [
          {
            "name": "sArticle",
            "technicalDefault": "88710.0000",
            "businessMeaning": "Selects the specific Pitzl SPP product model, which determines the connector's physical dimensions (thread size, plate diameter, pipe length) and material (steel vs. aluminum).",
            "validRange": "List of specific catalog numbers (88710, 88712, 88716, 88715)",
            "unit": "Catalog Number",
            "affectsOutput": "Updates connector geometry size, material properties, drill diameters, and assigns the correct Main Hardware Part Number to the BOM."
          },
          {
            "name": "dFixingScrewLength",
            "technicalDefault": "120",
            "businessMeaning": "Length of the wood screws used to attach the shear plate to the male beam.",
            "validRange": "120, 160 (based on available options)",
            "unit": "mm",
            "affectsOutput": "Updates the BOM quantity and description of the wood screws; may implicitly guide penetration depth in manual checks (though drill logic usually just penetrates)."
          },
          {
            "name": "dMillDepth",
            "technicalDefault": "0",
            "businessMeaning": "Adjusts the depth of the milled pocket in the male beam to sink the connector further in or let it protrude.",
            "validRange": "-Plate Thickness to +50mm (Code auto-corrects if negative value exceeds plate thickness)",
            "unit": "mm",
            "affectsOutput": "Modifies the Z-axis position of the cylindrical milling operation on the male beam. Positive values sink the plate deeper; negative values allow the plate to protrude."
          },
          {
            "name": "dTopDrillDiaOversize",
            "technicalDefault": "2",
            "businessMeaning": "Additional clearance diameter added to the top plate size for the milling operation.",
            "validRange": "0 - 10mm",
            "unit": "mm",
            "affectsOutput": "Increases the diameter of the counterbore/mill on the male beam to ensure the plate fits easily or to accommodate dimensional tolerances."
          },
          {
            "name": "dYOff",
            "technicalDefault": "0",
            "businessMeaning": "Lateral offset of the connector center relative to the calculated intersection point.",
            "validRange": "-Width/2 to +Width/2 (approx)",
            "unit": "mm",
            "affectsOutput": "Shifts the connector and all associated machining sideways along the male beam's width axis."
          },
          {
            "name": "dZOff",
            "technicalDefault": "0",
            "businessMeaning": "Vertical offset of the connector center relative to the calculated intersection point.",
            "validRange": "-Height/2 to +Height/2 (approx)",
            "unit": "mm",
            "affectsOutput": "Shifts the connector and all associated machining vertically along the male beam's height axis."
          },
          {
            "name": "sFemaleTool",
            "technicalDefault": "|No|",
            "businessMeaning": "Determines if the intersecting (female) beam should be machined and hardware added to complete the connection (tension rod connection).",
            "validRange": "|No|, |Yes|",
            "unit": "Option",
            "affectsOutput": "If Yes, adds a through-drill for the tension rod and a counterbore for the nut/washer on the female beam, plus generates Rod, Washer, and Nut hardware. If No, only the male beam is toooled."
          },
          {
            "name": "dExitDepth",
            "technicalDefault": "10",
            "businessMeaning": "Extra depth of the counterbore on the female beam side to recess the washer and nut.",
            "validRange": "0 - 50mm",
            "unit": "mm",
            "affectsOutput": "Deepens the cylindrical pocket (sink hole) on the female beam to hide the nut/washer assembly."
          },
          {
            "name": "dExitDiaOversize",
            "technicalDefault": "4",
            "businessMeaning": "Additional clearance diameter for the counterbore on the female beam side (where washer/nut sit).",
            "validRange": "0 - 10mm",
            "unit": "mm",
            "affectsOutput": "Increases the diameter of the counterbore on the female beam to allow easy insertion of the washer and nut."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing 'sArticle' (Article)",
            "effect": "Updates internal geometric variables (Thread Dia, Plate Dia, Pipe Dia/Length) and triggers a recalculation of hardware dimensions.",
            "cascade": [
              "dThreadDia",
              "dTopPlateDia",
              "dMainNutSW",
              "dMainWasherDia",
              "Hardware Generation"
            ]
          },
          {
            "trigger": "Setting 'sFemaleTool' to Yes",
            "effect": "Enables the generation of tools on the female beam and adds Rod/Washer/Nut to the hardware list.",
            "cascade": [
              "Drill drScrew (Female)",
              "Drill drExit (Female)",
              "HardWrComp: Main Screw",
              "HardWrComp: Main Washer",
              "HardWrComp: Main Nut"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Machining (Male Beam)",
            "description": "Cylindrical Mill (Top Plate pocket) and Pipe Drill (if applicable). Can include a welding clearance drill.",
            "appliedTo": "Selected Male Beam(s)"
          },
          {
            "type": "Machining (Female Beam)",
            "description": "Through Drill (for rod) and Counterbore/Sink Hole (for nut/washer). Only generated if 'Tools in female beam' is Yes.",
            "appliedTo": "Selected Female Beam(s)"
          },
          {
            "type": "Hardware (BOM)",
            "description": "Pitzl SPP Connector, Wood Screws (x4). Optionally adds Threaded Rod, Washer, and Nut (DIN standards) if female side is active.",
            "appliedTo": "The TSL Instance (associated with the Male Beam)"
          },
          {
            "type": "Visual Representation",
            "description": "3D Body representation of the SPP Connector (Top plate + Pipe).",
            "appliedTo": "Model Space"
          }
        ]
      },
      "tokens_used": 10798,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"Script Execution Starts\",\n    \"Check if in Insertion Mode (_bOnInsert)\",\n    \"If Inserting: Check execution key for Catalog usage\",\n    \"[Branch] Load Properties from Catalog OR Show Properties Dialog\",\n    \"Prompt User to Select Male Beam(s)\",\n    \"Prompt User to Select Female Beam(s)\",\n    \"Filter Female Beams: Remove any entities already selected as Males\",\n    \"Loop through each Male Beam\",\n    \"Loop through each Female Beam\",\n    \"Validate Pair: Check if beams are parallel (Skip if parallel)\",\n    \"Validate Pair: Check if intersection point lies within Female beam solid length\",\n    \"Validate Pair: Check physical contact/overlap\",\n    \"If Valid: Create TSL Instance linking Male and Female beams\",\n    \"Execution Phase (Every Update): Retrieve linked GenBeams (Male and Female)\",\n    \"Calculate Intersection Points and Reference Planes\",\n    \"Calculate Connector Geometry (Plate, Pipe, Drill depths)\",\n    \"Apply Machining to Male Beam (Mill/Drill based on Article type)\",\n    \"[Branch] Apply Machining to Female Beam (If 'sFemaleTool' == Yes)\",\n    \"Update Hardware List (BOM)\",\n    \"Draw 3D Representation (Body) in Model Space\",\n    \"Execution Ends\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Insertion Trigger Source\",\n      \"path1\": {\n        \"name\": \"Catalog Execution\",\n        \"steps\": [\n          \"Check if _kExecuteKey matches a Catalog Name\",\n          \"Load property presets (Article, Lengths, etc.) from Catalog\",\n          \"Skip interactive Dialog\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Manual Execution\",\n        \"steps\": [\n          \"No matching Catalog Key found\",\n          \"Execute ShowDynamicDialog()\",\n          \"User manually selects Article, Screw Length, and Offsets\",\n          \"Proceed to Entity Selection\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Female Beam Tooling (sFemaleTool)\",\n      \"path1\": {\n        \"name\": \"Yes (Tooling Enabled)\",\n        \"steps\": [\n          \"Calculate reference points for Rod/Nut\",\n          \"Add Drill 'drScrew' (Through drill for rod)\",\n          \"Add Drill 'drExit' (Counterbore for nut/washer)\",\n          \"Add Hardware: Threaded Rod, Washer, Nut\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No (Tooling Disabled)\",\n        \"steps\": [\n          \"Skip drilling operations on Female beam\",\n          \"Skip Rod/Washer/Nut hardware generation\",\n          \"Only tool Male beam\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Article Geometry Type\",\n      \"path1\": {\n        \"name\": \"Pipe Type (e.g., 88712, 88716)\",\n        \"steps\": [\n          \"dPipeDia is non-zero\",\n          \"Add Drill 'drPipe' (deep clearance drill)\",\n          \"Add Drill 'drWelding' (clearance for welding head)\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Standard Type (e.g., 88710, 88715)\",\n        \"steps\": [\n          \"dPipeDia is zero\",\n          \"Add Drill 'drThread' (standard thread clearance drill only)\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Intersection Plane Analysis\",\n      \"path1\": {\n        \"name\": \"Plane Parallel to Beam Axis\",\n        \"steps\": [\n          \"Check Cut Plane Normal vs Beam Vector\",\n          \"Add Mill Tool only if depth condition (dMillDepth > 0 || dMillDepth > -Thickness) is met\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Standard Intersection\",\n        \"steps\": [\n          \"Add Mill Tool unconditionally\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Beam Parallelism\",\n      \"errorMessage\": \"No error message (Silent skip)\",\n      \"recovery\": \"The script automatically skips the beam pair if their centerlines are parallel.\"\n    },\n    {\n      \"check\": \""
      },
      "tokens_used": 12470,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Pitzl SPP-Verbinder.mcr\n\n## Overview\nThis script inserts a Pitzl SPP Shear Plate Connector to join timber beams. It automatically generates the required CNC toolpaths (milling and drilling) and assigns necessary hardware (connectors, screws, rods) to the Bill of Materials.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates on 3D beams in the model. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | Does not generate 2D annotations directly. |\n\n## Prerequisites\n- **Required Entities**: At least one \"Male\" beam and one \"Female\" beam (GenBeam).\n- **Minimum Beam Count**: 2 (1 Male, 1 Female).\n- **Required Settings**: None required for basic execution.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Pitzl SPP-Verbinder.mcr` from the list.\n\n### Step 2: Configure Connector (Dialog)\n```\nDialog: Dynamic Properties Dialog\nAction: Select the Article number (Connector Type) and Screw Length from the dropdowns. Click OK to confirm.\n```\n*Note: If the script is run from a catalog, this step may be skipped and settings loaded automatically.*\n\n### Step 3: Select Male Beam\n```\nCommand Line: Select male beam(s)\nAction: Click on the beam(s) that will host the shear plate (the main beam). Press Enter to finish selection.\n```\n\n### Step 4: Select Female Beam\n```\nCommand Line: Select female beam(s)\nAction: Click on the intersecting beam(s) that will receive the rod/tension connection (if applicable). Press Enter to finish selection.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **A - Article** | dropdown | 88710.0000 | Selects the specific Pitzl SPP product model (defines dimensions and material). |\n| **B - Screw Length** | dropdown | 120 | Length of the wood screws used to attach the shear plate to the male beam (mm). |\n| **C - Additional mill depth** | number | 0 | Adjusts how deep the connector pocket is milled into the male beam (mm). |\n| **D - Oversize mill** | number | 2 | Extra clearance diameter added to the top plate milling (mm). |\n| **E - Offset Lateral** | number | 0 | Shifts the connector sideways (along the beam width) from the calculated intersection (mm). |\n| **F - Offset Vertical** | number | 0 | Shifts the connector vertically (along the beam height) from the calculated intersection (mm). |\n| **G - Tools in female beam** | dropdown | No | If set to \"Yes\", adds drilling and hardware to the female beam. |\n| **H - Extra depth sink hole** | number | 10 | Additional depth for the counterbore on the female beam side to recess the nut/washer (mm). |\n| **I - Oversize sink hole** | number | 4 | Extra clearance diameter for the counterbore on the female beam side (mm). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **TslDoubleClick** | Double-clicking the connector instance in the model re-opens the Properties dialog to allow quick changes. |\n\n## Settings Files\n- **Filename**: None required (Internal Catalogs may be used).\n- **Location**: N/A\n- **Purpose**: The script relies on internal dimensions based on the selected Article number. No external user settings file is mandatory.\n\n## Tips\n- **Beam Orientation**: The script automatically skips parallel beams. Ensure your male and female beams actually cross each other.\n- **Positioning**: If the connector calculates slightly off due to complex geometry, use the **Offset Lateral (E)** and **Offset Vertical (F)** properties to nudge it into place without moving the beams.\n- **Female Tooling**: Remember to set **Tools in female beam (G)** to \"Yes\" if you need the threaded rod and nut machining on the intersecting beam.\n\n## FAQ\n- **Q: Why did the script skip a beam pair I selected?**\n  **A**: The script automatically ignores pairs where the beams are parallel or where the intersection point is outside the physical length of the female beam.\n- **Q: How do I change the connector size after insertion?**\n  **A**: Double-click the connector instance in the model and select a different Article number from the dropdown.\n- **Q: The hardware isn't showing up in my BOM?**\n  **A**: Ensure the TSL instance is not on a frozen layer and that you have updated your BOM list. If female hardware is missing, check if \"Tools in female beam\" is enabled."
      },
      "tokens_used": 7436,
      "error": null
    }
  }
}