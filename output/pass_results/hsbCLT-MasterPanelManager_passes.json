{
  "filename": "hsbCLT-MasterPanelManager.mcr",
  "status": "completed",
  "total_tokens": 46369,
  "processing_time": 407.3560585975647,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 8862,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script acts as a master panel manager within the 3D model (ModelSpace), handling nesting and properties of panel entities. However, it contains specific logic for plot viewports and settings (e.g., PlotView Settings Dialog, 'create plot viewports' in version history), which implies interaction with Paper Space. It lacks the sd_* prefix or explicit #Type E / _Entity[] construction typical of fabrication ShopDrawing scripts, focusing instead on the assembly management phase."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space (hsbCAD) containing panels or references to master panels.",
          "requiredSettings": [
            "Masterpanel Style DWG/Configuration",
            "Global Settings File (optional for import/export)",
            "hsbDesign 24+ (for specific mapX properties)"
          ]
        }
      },
      "tokens_used": 5349,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": [
            {
              "prompt": "|Are you sure to overwrite existing settings?| [|No|/|Yes|]",
              "options": [
                "|No|",
                "|Yes|"
              ]
            }
          ]
        },
        "dialogs": [
          {
            "type": "SelectFromList",
            "trigger": "Context Menu: '|Select Masterstyle Dwg|'",
            "title": "|Selection Masterpanel-Style DWG|",
            "dataSource": "Subfolders of _kPathHsbCompany scanning for *.dwg files containing masterpanel styles.",
            "features": {
              "searchable": true,
              "multiSelect": false
            }
          },
          {
            "type": "ShowNotice",
            "trigger": "Context Menu: '|Select Masterstyle Dwg|' (when no drawings found)",
            "title": null,
            "dataSource": "Static notice message",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [],
        "contextMenu": [
          {
            "menuItem": "|Select Masterstyle Dwg|",
            "handler": "sTriggerSelectMasterstyleDwg",
            "action": "Opens a dialog to scan the company folder for DWG files containing masterpanel styles and select one as the default.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Import Settings|",
            "handler": "sTriggerImportSettings",
            "action": "Imports configuration settings from a standard XML location.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Export Settings|",
            "handler": "sTriggerExportSettings",
            "action": "Exports current configuration settings to a standard XML location, prompting for overwrite confirmation if the file exists.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "hsbCLT-MasterPanelManager.xml",
            "searchPaths": [
              "_kPathHsbCompany + '\\\\' + sFolder",
              "_kPathHsbInstall + '\\\\Company'"
            ],
            "purpose": "Stores global configuration settings for the Master Panel Manager (e.g., Masterpanel Style references).",
            "required": false
          }
        ]
      },
      "tokens_used": 6531,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Manages CLT (Cross Laminated Timber) Master Panels by handling nesting of child panels, controlling visual styles, and managing global configuration settings for stock panel representation.",
          "category": "Model Management / CLT Automation",
          "typicalUseCase": "Used when configuring the visual appearance and behavior of Master Panels in the model, or when sharing standard settings across a project team via import/export."
        },
        "parameters": [
          {
            "name": "Masterpanel Style DWG",
            "technicalDefault": "\"\"",
            "businessMeaning": "Specifies the source drawing file that contains the visual style definitions (layers, hatching, line types) for the Master Panel entity. This determines how the raw CLT stock panel looks in the 3D model and drawings.",
            "validRange": "Valid file path relative to the Company folder (e.g., '\\\\Standards\\\\CLT_Styles.dwg')",
            "unit": "FilePath",
            "affectsOutput": "Updates the graphical representation (layer assignment, color) of the Master Panel entity in the CAD environment."
          },
          {
            "name": "Overwrite Settings Confirmation",
            "technicalDefault": "No",
            "businessMeaning": "A safety prompt asking the user to confirm if they want to replace the existing global configuration file on the disk with the current script settings.",
            "validRange": "Yes, No",
            "unit": "Boolean",
            "affectsOutput": "If 'Yes', overwrites 'hsbCLT-MasterPanelManager.xml' with current data; if 'No', cancels the export operation."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Context Menu: 'Export Settings' is executed",
            "effect": "Checks if 'hsbCLT-MasterPanelManager.xml' already exists. If it exists, triggers the 'Overwrite Settings Confirmation' prompt.",
            "cascade": [
              "Overwrite Settings Confirmation"
            ]
          },
          {
            "trigger": "Context Menu: 'Select Masterstyle Dwg' is executed",
            "effect": "Scans the Company folder for DWG files. Updates the internal 'Masterpanel Style' map setting if a new file is selected.",
            "cascade": [
              "Masterpanel Style DWG"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TslInst (Script Instance)",
            "description": "The script runs as an entity instance associated with a Master Panel, managing its data and display properties.",
            "appliedTo": "Master Panel Elements"
          },
          {
            "type": "Settings File (XML)",
            "description": "Generates or updates 'hsbCLT-MasterPanelManager.xml' to persist configuration settings like default style paths.",
            "appliedTo": "Disk (Company or Project Folder)"
          }
        ]
      },
      "tokens_used": 9139,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"Script execution starts (either on insert or recalculation).\",\n    \"If no specific trigger is active, the script calculates and renders the Master Panel (nesting, graphics, tags).\",\n    \"[Context Menu] User selects 'Select Masterstyle Dwg'.\",\n    \"Script scans subfolders of the Company path (_kPathHsbCompany) for *.dwg files.\",\n    \"Each DWG is queried for valid Masterpanel Style entries (excluding 'Standard' if it is the only entry).\",\n    \"Branch: Valid files found?\",\n    \"  [Yes] Open 'Selection Masterpanel-Style DWG' dialog displaying relative paths.\",\n    \"  [No] Show Notice: 'No drawings with masterpanel styles could be found...'.\",\n    \"[User Action] User selects a file from the list or cancels.\",\n    \"If file selected: Update internal MapSetting 'Masterpanel Style' -> 'StyleDwg' with the full path.\",\n    \"Save settings to the entity (mo.setMap or mo.dbCreate) and trigger a recalculation (setExecutionLoops(2)).\",\n    \"[Context Menu] User selects 'Export Settings'.\",\n    \"Script checks if the target settings file (hsbCLT-MasterPanelManager.xml) already exists.\",\n    \"Branch: File exists?\",\n    \"  [Yes] Prompt user: 'Are you sure to overwrite existing settings? [No/Yes]'.\",\n    \"  [No] Proceed directly to write.\",\n    \"If confirmed: Ensure folder structure exists, then write current mapSetting to XML.\",\n    \"Report success or failure message to the user.\",\n    \"[Context Menu] User selects 'Import Settings'.\",\n    \"Script reads XML content from the standard path into mapSetting.\",\n    \"Update entity with imported settings and report success.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Scanning for Masterpanel Style DWGs\",\n      \"path1\": {\n        \"name\": \"No Valid Styles Found\",\n        \"steps\": [\n          \"Scan completes with 0 valid files.\",\n          \"Execute ShowNotice dialog.\",\n          \"Display message: 'No drawings with masterpanel styles could be found in the subfolders of [CompanyPath]'.\",\n          \"Workflow ends.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Valid Styles Found\",\n        \"steps\": [\n          \"Compile list of file paths.\",\n          \"Open SelectFromList dialog.\",\n          \"User selects a file.\",\n          \"Update 'StyleDwg' property in configuration.\",\n          \"Recalculate script to apply new style.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Exporting Settings\",\n      \"path1\": {\n        \"name\": \"File Exists (Overwrite Protection)\",\n        \"steps\": [\n          \"findFile detects existing XML.\",\n          \"Prompt command line: '|Are you sure to overwrite existing settings?| [|No|/|Yes|]'.\",\n          \"Parse user input.\",\n          \"If 'No', abort write operation.\",\n          \"If 'Yes', write XML to disk.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"File Does Not Exist\",\n        \"steps\": [\n          \"findFile returns empty.\",\n          \"Set bWrite flag to true.\",\n          \"Ensure folder path exists (create if missing).\",\n          \"Write XML to disk.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Updating Plot Viewport Settings (ShowMultiDialog)\",\n      \"path1\": {\n        \"name\": \"No Active Viewports Selected\",\n        \"steps\": [\n          \"Check mapSelections for active entries.\",\n          \"HasActivePlotViewport returns false.\",\n          \"Remove 'PlotViewport[]' entry from mapSetting.\",\n          \"Save settings.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Active Viewports Selected\",\n        \"steps\": [\n          \"Check mapSelections for active entries.\",\n          \"HasActivePlotViewport returns true.\",\n          \"Set 'PlotViewport[]' in mapSetting with selection data.\",\n          \"Save settings.\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"DWG file contains valid Masterpanel Styles\",\n      \"errorMessage\": \"No drawings with masterpanel styles could be found in the subfolders of...\",\n      \"recovery\": \"User must add DWG files with defined styles to the subfolders of _kPathHsb"
      },
      "tokens_used": 10309,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-MasterPanelManager\n\n## Overview\nThis script serves as a configuration manager for CLT (Cross Laminated Timber) Master Panels. It allows you to define visual styles for master panels using external DWG files and manage the import/export of global project settings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Primary environment for managing master panels and styles. |\n| Paper Space | Yes | Contains logic for handling plot viewports and settings. |\n| Shop Drawing | No | This is a model management script, not a detailing script. |\n\n## Prerequisites\n- **Required Entities**: CLT Panels (GenBeam or Element entities) in the model.\n- **Minimum Beams**: 0 (Can be inserted as a standalone configuration entity).\n- **Required Settings**: A valid DWG file containing Masterpanel Styles located in the Company folder structure.\n\n## Usage Steps\n\n### Step 1: Insert the Script\nCommand: `TSLINSERT`\nAction: Browse to the script location and select `hsbCLT-MasterPanelManager.mcr`.\n\n### Step 2: Place in Model\nCommand Line: `Insert point:`\nAction: Click anywhere in the Model Space to place the script instance. The specific location is not critical as it manages global settings and styles rather than geometry at a specific point.\n\n### Step 3: Configure Visual Styles\nAction: Right-click the script instance and select **Select Masterstyle Dwg**.\n- The script scans subfolders of your Company folder for `*.dwg` files.\n- A dialog titled \"Selection Masterpanel-Style DWG\" will appear.\n- Select the desired drawing file from the list and click OK.\n- The script updates the internal settings to use this style for Master Panels.\n\n### Step 4: Save Configuration (Optional)\nAction: Right-click the script instance and select **Export Settings**.\n- If the file `hsbCLT-MasterPanelManager.xml` already exists, the command line will ask: `Are you sure to overwrite existing settings? [No/Yes]`.\n- Type `Yes` to overwrite or `No` to cancel.\n\n## Properties Panel Parameters\nThis script does not expose user-editable parameters directly in the Properties Palette (OPM). All configuration is handled via the Right-Click Context Menu.\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Select Masterstyle Dwg** | Opens a file selection dialog to choose a DWG file from the Company folder that defines the visual style (layers, hatching) for Master Panels. |\n| **Import Settings** | Loads configuration settings from the standard `hsbCLT-MasterPanelManager.xml` file. |\n| **Export Settings** | Saves the current configuration settings to `hsbCLT-MasterPanelManager.xml`. Includes a safety check to prevent accidental overwrites. |\n\n## Settings Files\n- **Filename**: `hsbCLT-MasterPanelManager.xml`\n- **Location**: Searches in `_kPathHsbCompany` or `_kPathHsbInstall\\Company`.\n- **Purpose**: Persists global configuration settings, such as the file path to the active Masterpanel Style DWG, allowing settings to be shared or reloaded.\n\n## Tips\n- **File Location**: Ensure your Masterpanel Style DWG files are stored in subfolders within your Company folder path; otherwise, the \"Select Masterstyle Dwg\" function will not find them.\n- **Standardization**: Use the Export/Import functions to distribute consistent Master Panel settings (e.g., specific hatching or layer colors) across your project team.\n- **Recovery**: If a style file is missing or moved, use \"Select Masterstyle Dwg\" to re-link the correct drawing file.\n\n## FAQ\n- Q: I see a notice \"No drawings with masterpanel styles could be found.\" What do I do?\n- A: This means the script did not find any valid DWG files in your Company subfolders. Check that your style DWGs exist in the correct directory structure defined in your hsbCAD configuration.\n- Q: Can I undo an settings export?\n- A: No, but the system prompts you to confirm before overwriting an existing file. Always select \"No\" if you are unsure to preserve your previous configuration."
      },
      "tokens_used": 6179,
      "error": null
    }
  }
}