{
  "filename": "HSB_G-RemoveReplicatorsAndReplica.mcr",
  "status": "completed",
  "total_tokens": 21061,
  "processing_time": 199.54026532173157,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 1,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.00",
            "date": "12.07.2017",
            "author": "RP",
            "changes": "First version"
          },
          {
            "version": "1.01",
            "date": "17.09.2019",
            "author": "RP",
            "changes": "Replica not deleted"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4489,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly uses _kModelSpace in Group().collectEntities calls. It lacks sd_ prefix, #Type E declarations, and any Viewport handling logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "TslInst"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Elements and/or TSL instances (specifically targets HSB_E-Replicator and HSB_E-Replica scripts).",
          "requiredSettings": []
        }
      },
      "tokens_used": 1503,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "|Select a position|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3344,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Removes all Replicator and Replica TSL instances from the model and clears the associated replication data from all Elements, effectively converting replicated assemblies into individual, static elements.",
          "category": "Utility/Data Management",
          "typicalUseCase": "Used when a user wants to stop using the Replicator workflow, remove broken replication links, or clean up a project to treat replicated elements as unique manual elements."
        },
        "parameters": [
          {
            "name": "_Pt0",
            "technicalDefault": "User selected point (3D coordinates)",
            "businessMeaning": "The trigger location selected by the user to start the cleanup process. The specific coordinates are irrelevant to the result; the script applies its changes globally to the Model Space.",
            "validRange": "Any point within the Model Space",
            "unit": "mm (3D Coordinates)",
            "affectsOutput": "Initiates the script execution. The provided coordinates do not alter the geometry or data cleaning, but the action of selecting the point triggers the deletion of Replicator/Replica scripts and the removal of replication MapX keys."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": []
      },
      "tokens_used": 4006,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched/inserted.",
          "Check if execution is happening during the Insert cycle (_bOnInsert).",
          "If Inserting: Check insertCycleCount(). If > 1, erase the new instance and stop (prevents multi-execution during single insert command).",
          "If Inserting (cycle 1): Prompt user to select a position (Point _Pt0). The specific coordinates are irrelevant; this is purely a trigger.",
          "Return (End of insert cycle). The script instance now resides in the drawing.",
          "[Execution Phase - Post-Insert or Recalc]: Collect all TSL Instances (TslInst) from Model Space.",
          "Loop through all found TSL Instances.",
          "Check if the TSL instance is a 'Replicator' (HSB_E-Replicator) or a 'Replica' (HSB_E-Replica).",
          "If match found: Erase the TSL instance (dbErase).",
          "Collect all Elements from Model Space.",
          "Loop through all found Elements.",
          "Check Element MapX data for specific keys/sub-maps.",
          "If 'Hsb_Production' exists: Remove keys 'MAINELEMENT', 'ORIGINALNUMBER', 'ISMIRRORED', 'Hsb_replicator' from it.",
          "If 'Replica[]' sub-map exists: Remove it entirely.",
          "If 'ReplicaMirrored[]' sub-map exists: Remove it entirely.",
          "Remove Project-level MapX keys 'Delivery[]' and 'Replicators'.",
          "Erase the script instance itself (cleanup).",
          "Return (Script finishes and deletes itself)."
        ],
        "conditionalBranches": [
          {
            "condition": "Is script in _bOnInsert state?",
            "path1": {
              "name": "Insert Mode",
              "steps": [
                "Check if insertCycleCount > 1.",
                "If count > 1: Erase instance and exit.",
                "If count == 1: Prompt user for point (_Pt0).",
                "Exit and wait for next event/recalc."
              ]
            },
            "path2": {
              "name": "Execution Mode (Recalc/Script Run)",
              "steps": [
                "Scan Model Space for TSLs and Elements.",
                "Delete Replicator/Replica instances.",
                "Clean Element MapX data.",
                "Clean Project MapX data.",
                "Delete Self."
              ]
            }
          },
          {
            "condition": "Does Element contain specific MapX keys?",
            "path1": {
              "name": "Data Exists",
              "steps": [
                "Identify specific sub-map (e.g., Hsb_Production, Replica[]).",
                "Remove specific keys or entire sub-map.",
                "Update Element data."
              ]
            },
            "path2": {
              "name": "Data Not Found",
              "steps": [
                "Skip cleaning for that specific data block.",
                "Continue to next Element or check."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Valid point selection during insert.",
            "errorMessage": "None explicitly handled by code (getPoint handles cancellation or default behavior).",
            "recovery": "Standard AutoCAD point input methods."
          },
          {
            "check": "Existence of 'Hsb_Production', 'Replica[]', or 'ReplicaMirrored[]' keys in Elements.",
            "errorMessage": "None (script silently skips elements without these keys).",
            "recovery": "N/A."
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 3267,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-RemoveReplicatorsAndReplica.mcr\n\n## Overview\nThis utility script removes all Replicator and Replica TSL instances from the current model. It clears the associated data links from Elements and Project properties, converting replicated assemblies into individual, static elements that no longer update via the replication logic.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script scans the entire Model Space to find relevant elements and TSL instances. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required entities**: Elements or TSL instances (specifically `HSB_E-Replicator` or `HSB_E-Replica`) must exist in the model.\n- **Minimum beam count**: 0 (Safe to run on an empty or pre-cleaned model).\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_G-RemoveReplicatorsAndReplica.mcr`\n\n### Step 2: Trigger Execution\n```\nCommand Line: |Select a position|\nAction: Click anywhere in the Model Space.\n```\n**Note:** The specific location you click does not matter. This action is simply a trigger to initiate the cleanup process.\n\n## Properties Panel Parameters\nThis script has no editable properties in the Properties Palette.\n\n## Right-Click Menu Options\nNo custom right-click menu options are provided by this script.\n\n## Settings Files\nNo external settings files are required or used by this script.\n\n## Tips\n- **Global Action:** This script processes the *entire* model automatically. You do not need to pre-select the specific replicators or elements you wish to clean.\n- **Self-Cleaning:** The script instance deletes itself from the drawing immediately after finishing its task, so you do not need to erase it manually.\n- **Data Finalization:** Use this script when you want to permanently break the link between a master element and its replicas, effectively \"exploding\" the replication logic while keeping the physical geometry intact.\n\n## FAQ\n- **Q: Will this delete my timber beams?**\n  - **A:** No. It only deletes the \"Replicator\" and \"Replica\" script instances. The physical timber elements (GenBeams) remain in the model.\n- **Q: Why would I use this?**\n  - **A:** This is useful if you want to stop elements from updating automatically, if you are experiencing errors with broken replication links, or if you want to finalize the design and treat all elements as unique.\n- **Q: Do I need to click on the specific Replicator script?**\n  - **A:** No. You can click anywhere in the model space; the script finds all relevant replicator data automatically."
      },
      "tokens_used": 4452,
      "error": null
    }
  }
}