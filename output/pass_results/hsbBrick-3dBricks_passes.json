{
  "filename": "hsbBrick-3dBricks.mcr",
  "status": "completed",
  "total_tokens": 35997,
  "processing_time": 291.5739417076111,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.4\",\n      \"date\": \"14jun2019\",\n      \"author\": \"marsel.nakuci@hsbcad.com\",\n      \"changes\": \"cosmetic\"\n    },\n    {\n      \"version\": \"1.3\",\n      \"date\": \"03jun201"
      },
      "tokens_used": 6539,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script instantiates a 'Body' object using 'Body body(pl, vecExtrusion);' to create 3D geometry and assigns it to an element group using 'assignToElementGroup'. It does not contain any ShopDrawing prefixes ('sd_'), does not iterate over '_Viewport', and does not reference '_kPaperSpace'. Its purpose is explicitly described as creating a '3D body of bricks'."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "TslInst (hsbBrick-BrickDistributionInterior or hsbBrick-BrickDistributionExterior)",
            "TslInst (hsbBrick-CourseDistribution)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "ModelSpace",
          "requiredSettings": [
            "Map data passed from parent TSLs containing: 'planeProfile' (PlaneProfile), 'width' (double), and coordinate offsets ('dOffsetX', 'dOffsetY', 'dOffsetZ')"
          ]
        }
      },
      "tokens_used": 4784,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDialog",
            "trigger": "Insertion (_bOnInsert) if no execute key is present",
            "title": null,
            "dataSource": "Script Properties (PropDouble/PropString)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dPositionX",
            "type": "PropDouble",
            "displayName": "X",
            "defaultValue": "dOffsetX",
            "inputType": "number",
            "options": [],
            "category": "Position",
            "description": "|Defines the PositionX|",
            "readOnly": true
          },
          {
            "index": 1,
            "variable": "dPositionY",
            "type": "PropDouble",
            "displayName": "Y",
            "defaultValue": "dOffsetY",
            "inputType": "number",
            "options": [],
            "category": "Position",
            "description": "|Defines the PositionY|",
            "readOnly": true
          },
          {
            "index": 2,
            "variable": "dPositionZ",
            "type": "PropDouble",
            "displayName": "Z",
            "defaultValue": "dOffsetZ",
            "inputType": "number",
            "options": [],
            "category": "Position",
            "description": "|Defines the PositionZ|",
            "readOnly": true
          },
          {
            "index": 0,
            "variable": "sBrickType",
            "type": "PropString",
            "displayName": "|BrickType|",
            "defaultValue": "|Regular|",
            "inputType": "dropdown",
            "options": [
              "|Regular|",
              "|Special|"
            ],
            "category": "Brick type: Special or not",
            "description": "|Defines the BrickType|",
            "readOnly": true
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6601,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates the 3D geometric body for individual masonry units (bricks) based on coordinates and dimensions passed from distribution scripts.",
          "category": "Modeling/Cladding",
          "typicalUseCase": "Used automatically by 'BrickDistribution' scripts to visualize and quantify the 3D volume of bricks within a wall assembly."
        },
        "parameters": [
          {
            "name": "dPositionX",
            "technicalDefault": "dOffsetX",
            "businessMeaning": "The horizontal (X-axis) location of the brick relative to the wall element's origin.",
            "validRange": "Dependent on wall length (e.g., 0 to 20000 mm)",
            "unit": "mm",
            "affectsOutput": "Determines the placement of the brick along the length of the wall."
          },
          {
            "name": "dPositionY",
            "technicalDefault": "dOffsetY",
            "businessMeaning": "The lateral (Y-axis) offset of the brick relative to the wall element's origin, controlling depth or face alignment.",
            "validRange": "Dependent on wall thickness (e.g., -500 to 500 mm)",
            "unit": "mm",
            "affectsOutput": "Determines the brick's position perpendicular to the wall face."
          },
          {
            "name": "dPositionZ",
            "technicalDefault": "dOffsetZ",
            "businessMeaning": "The vertical (Z-axis) elevation of the brick relative to the wall element's base.",
            "validRange": "Dependent on wall height (e.g., 0 to 10000 mm)",
            "unit": "mm",
            "affectsOutput": "Determines the vertical layer (course) height of the brick."
          },
          {
            "name": "sBrickType",
            "technicalDefault": "|Regular|",
            "businessMeaning": "Specifies if the brick is a standard unit or a special custom shape (e.g., for corners or bonds).",
            "validRange": "List: |Regular|, |Special|",
            "unit": "enum",
            "affectsOutput": "Classifies the brick for reporting or filtering; the geometry is driven by the passed profile, but this label distinguishes brick types."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Map data update from 'hsbBrick-BrickDistribution'",
            "effect": "Updates position coordinates and type definitions.",
            "cascade": [
              "dPositionX",
              "dPositionY",
              "dPositionZ",
              "sBrickType"
            ]
          },
          {
            "trigger": "Change in parent Element vectors",
            "effect": "Re-orients the brick body to match the wall's local coordinate system.",
            "cascade": [
              "3D Geometry Orientation"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body",
            "description": "A 3D solid body created by extruding a planar profile (pl) by the wall width (dWidth) along the negative Z-axis of the element.",
            "appliedTo": "Element Group (E) of the parent Wall Element."
          }
        ]
      },
      "tokens_used": 4887,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Execution Start",
          "Check Insertion State (_bOnInsert)",
          "[Insertion Phase] Check insertCycleCount (Abort if > 1)",
          "[Insertion Phase] Check for Execute Key",
          "[Insertion Phase] Apply Catalog settings or Show Dialog based on Key",
          "[Insertion Phase] Exit Script",
          "[Calculation Phase] Read Map Data (dOffsetX, dOffsetY, dOffsetZ, planeProfile, width, sBrickTypeMap)",
          "[Calculation Phase] Set Properties (Read-only X, Y, Z, BrickType)",
          "[Calculation Phase] Set Compare Key based on coordinates",
          "[Calculation Phase] Validate PlaneProfile Ring Count",
          "[Calculation Phase] Scan Entity List for 'hsbBrick-BrickDistributionInterior' or 'hsbBrick-BrickDistributionExterior'",
          "[Calculation Phase] Set Dependency on Brick Distribution script if found",
          "[Calculation Phase] Scan Entity List for 'hsbBrick-CourseDistribution'",
          "[Calculation Phase] Set Dependency on Course Distribution script if found",
          "[Calculation Phase] Validate that both Parent Scripts and Element exist",
          "[Calculation Phase] Generate 3D Geometry (Body via Extrusion)",
          "[Calculation Phase] Assign Body to Element Group 'E'",
          "Script Execution End"
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Mode: Execute Key Status",
            "path1": {
              "name": "Valid Execute Key",
              "steps": [
                "Search Catalogs for matching key name",
                "Apply properties from Catalog Entry",
                "Finish Insertion"
              ]
            },
            "path2": {
              "name": "No or Invalid Execute Key",
              "steps": [
                "Open Property Dialog (showDialog)",
                "Finish Insertion"
              ]
            }
          },
          {
            "condition": "Profile Validation: Ring Count",
            "path1": {
              "name": "More than 1 Ring (Invalid Profile)",
              "steps": [
                "Report Error: 'more than one ring in brick plane profile, not allowed'",
                "Erase Instance",
                "Exit Script"
              ]
            },
            "path2": {
              "name": "1 Ring (Valid Profile)",
              "steps": [
                "Proceed to Dependency Search"
              ]
            }
          },
          {
            "condition": "Parent Dependency Check",
            "path1": {
              "name": "Missing Parent Scripts",
              "steps": [
                "Detect if 'hsbBrick-BrickDistribution...' OR 'hsbBrick-CourseDistribution' is missing",
                "Erase Instance (Self-Cleanup)",
                "Exit Script"
              ]
            },
            "path2": {
              "name": "Parents Found",
              "steps": [
                "Establish Dependencies",
                "Proceed to Geometry Generation"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "PlaneProfile Rings Count",
            "errorMessage": "|more than one ring in brick plane profile, not allowed|",
            "recovery": "The script erases itself. The user must fix the profile generation logic in the parent 'BrickDistribution' script or the input geometry causing the complex profile."
          },
          {
            "check": "Parent Script Existence",
            "errorMessage": "None (Silent erase)",
            "recovery": "The script erases itself automatically if the parent 'BrickDistribution' or 'CourseDistribution' scripts are deleted or not found on the element. Restore the parent scripts to recover the brick."
          },
          {
            "check": "Element Validity",
            "errorMessage": "|no element found| OR |element of wall not found|",
            "recovery": "The script erases itself. Ensure the TSL is applied to a valid wall element within the drawing."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Geometry Update",
            "how": "System Recalculation (via Dependencies)",
            "effect": "Updating the parent 'BrickDistribution' or 'CourseDistribution' scripts automatically triggers this script to update the 3D brick body position, size, and type."
          },
          {
            "action": "Element Modification",
            "how": "Moving/Resizing Parent Element",
            "effect": "The brick body updates its orientation and position relative to the element's local coordinate system (vecX, vecY, vecZ)."
          },
          {
            "action": "Property Editing",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "None. All properties (X, Y, Z, BrickType) are Read-Only. Changes must be made in the parent scripts."
          }
        ]
      },
      "tokens_used": 7398,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbBrick-3dBricks.mcr\n\n## Overview\nGenerates the 3D geometric body for individual masonry units (bricks) based on coordinates and dimensions passed from distribution scripts. This script is typically executed automatically by parent scripts to visualize and quantify the 3D volume of bricks within a wall assembly.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script creates 3D solid bodies assigned to element groups. |\n| Paper Space | No | Not designed for 2D layout or sheet generation. |\n| Shop Drawing | No | Not a shop drawing generation script. |\n\n## Prerequisites\n- **Required Entities**:\n  - An Element (Wall).\n  - `hsbBrick-BrickDistributionInterior` or `hsbBrick-BrickDistributionExterior` instance.\n  - `hsbBrick-CourseDistribution` instance.\n- **Minimum Beam Count**: 0 (This script generates bodies, not beams).\n- **Required Settings**: \n  - Must receive \"Map data\" from parent TSLs containing the `planeProfile`, `width`, and coordinate offsets (`dOffsetX`, `dOffsetY`, `dOffsetZ`).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT` â†’ Select `hsbBrick-3dBricks.mcr`\n\n> **Note:** This script is normally generated automatically by the Brick Distribution scripts. Manual insertion is rarely required and will only function if the prerequisite parent scripts are already present on the element.\n\n### Step 2: Select Element\n```\nCommand Line: Select element:\nAction: Click on the Wall Element that contains the parent distribution scripts.\n```\n\n### Step 3: Completion\nIf the parent scripts are found, the brick body will be generated. If parent scripts are missing, this script instance will erase itself automatically.\n\n## Properties Panel Parameters\n\nAll properties listed below are **Read-Only**. To modify the brick layout, you must edit the properties of the parent `BrickDistribution` or `CourseDistribution` scripts.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| X | Number | dOffsetX | The horizontal (X-axis) location of the brick relative to the wall element's origin. |\n| Y | Number | dOffsetY | The lateral (Y-axis) offset of the brick relative to the wall element's origin (depth/face alignment). |\n| Z | Number | dOffsetZ | The vertical (Z-axis) elevation of the brick relative to the wall element's base. |\n| BrickType | Dropdown | Regular | Defines the brick type (Regular or Special). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are defined for this script. |\n\n## Settings Files\n- **Filename**: Standard hsbCAD Catalogs (optional)\n- **Location**: Company or Install path\n- **Purpose**: If an Execute Key is used during insertion, the script attempts to load default properties from a catalog entry matching the key name.\n\n## Tips\n- **Automatic Updates**: Moving or resizing the parent wall element automatically updates the position and orientation of the bricks.\n- **Missing Bricks**: If the 3D bricks disappear from your model, check that the `hsbBrick-BrickDistribution...` and `hsbBrick-CourseDistribution` scripts are still present on the element. This script deletes itself if its parents are removed.\n- **Read-Only Data**: You cannot manually drag or change the coordinates of individual bricks in the properties palette. Adjust the distribution settings in the parent scripts to change the layout.\n\n## FAQ\n- **Q: Why can I not change the Brick Type to \"Special\"?**\n  A: The properties are Read-Only and populated by the parent distribution script. You must configure the logic or map data in the parent script to designate specific bricks as \"Special\".\n  \n- **Q: I get an error \"more than one ring in brick plane profile\". What does this mean?**\n  A: The profile shape generated by the parent script is too complex (it has multiple loops/holes). This script requires a single, simple ring profile. Check the input geometry or profile settings in the Brick Distribution script."
      },
      "tokens_used": 5788,
      "error": null
    }
  }
}