{
  "filename": "hsb_SplitBeamsWithScarfJoint.mcr",
  "status": "completed",
  "total_tokens": 32003,
  "processing_time": 276.44636821746826,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "09.06.2015",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5493,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses Element and GenBeam (Beam) objects, performs 3D geometric operations (dbSplit, solidLength, realBody), and adds tools to beams. No 'sd_' prefix, no viewport handling, and no sheet references."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3139,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Called by showDialogOnce() during script insertion if execute key is empty",
            "title": null,
            "dataSource": "Internal TSL script properties (PropDouble)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dMaxLength",
            "type": "PropDouble",
            "displayName": "Maximum length",
            "defaultValue": "U(5000)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dMinLength",
            "type": "PropDouble",
            "displayName": "Minimum length",
            "defaultValue": "U(2500)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4046,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically splits long timber beams into shorter segments joined by a scarf joint (angled overlap) to comply with transport or manufacturing length limitations.",
          "category": "Joinery / Processing",
          "typicalUseCase": "When designing long walls or roof structures where timber stock lengths or transport constraints require beams to be spliced together."
        },
        "parameters": [
          {
            "name": "dMaxLength",
            "technicalDefault": "U(5000)",
            "businessMeaning": "The maximum permissible length of a single timber piece before a splice joint is required. Acts as the primary target length for splitting.",
            "validRange": "3000 - 14000 mm",
            "unit": "mm",
            "affectsOutput": "Controls where the beam is cut. A lower value results in more segments and more joints; a higher value results in fewer cuts (or none if the beam is shorter than the value)."
          },
          {
            "name": "dMinLength",
            "technicalDefault": "U(2500)",
            "businessMeaning": "The shortest acceptable length for the final beam segment or offcut. This prevents the script from creating useless scraps at the end of a beam run.",
            "validRange": "600 - 4000 mm",
            "unit": "mm",
            "affectsOutput": "Adjusts the position of the final cut in a long beam sequence. If the remaining length after a standard cut is too short, the script shifts the cut point to ensure the last segment meets this minimum threshold."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Setting dMinLength",
            "effect": "Must be greater than the internal Scarf Length (300mm) to function correctly; otherwise, the geometric calculation for the split point may result in invalid geometry.",
            "cascade": [
              "Calculated Split Position"
            ]
          },
          {
            "trigger": "Setting dMaxLength",
            "effect": "Determines the loop frequency for splitting. If set significantly larger than the beam length, the script performs no action.",
            "cascade": [
              "Number of Scarf Joints",
              "Number of resulting Beam objects"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "SimpleScarf (Machining)",
            "description": "An angled cut (scarf joint) added to the ends of the split beams to allow them to overlap and connect structurally.",
            "appliedTo": "Both resulting segments of every split beam."
          },
          {
            "type": "Split Beam (GenBeam)",
            "description": "The original beam is physically split into two or more separate GenBeam objects in the model.",
            "appliedTo": "All beams within the selected Element that exceed the Maximum Length."
          }
        ]
      },
      "tokens_used": 6747,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch: User executes the script (Insertion).",
          "2. Dialog Display: If executed manually (empty execute key), the Properties Dialog appears allowing user to set dMaxLength and dMinLength.",
          "3. Entity Selection: User is prompted to select a set of Elements (PrEntity).",
          "4. Master Mode Initialization: Script sets ExecutionMode to 0 (Master) and attaches to selected Elements.",
          "5. Beam Analysis (Master Loop): Iterates through all beams in selected Elements.",
          "6. Filtering: Identifies beams longer than dMaxLength and filters for Rectangular profiles only.",
          "7. Split Calculation: Calculates the split point. Checks if the remaining tail is shorter than dMinLength.",
          "8. Geometry Split: Performs dbSplit on the beam, dividing it into two segments.",
          "9. Slave Instance Creation: Launches a new instance of the script (ExecutionMode 1) attached to the two new beam segments.",
          "10. Master Cleanup: The Master instance erases itself after all processing is complete.",
          "11. Tooling Generation (Slave): The Slave instance calculates orientation and adds SimpleScarf machining tools to both beam ends.",
          "12. Completion: Process repeats until all beams are within length limits."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Mode (stored in internal Map)",
            "path1": {
              "name": "Master Mode (0)",
              "steps": [
                "Iterate selected Elements",
                "Find beams exceeding dMaxLength",
                "Verify beam is Rectangular",
                "Loop until beam length <= dMaxLength",
                "Calculate split point (Standard vs Adjusted for MinLength)",
                "Execute dbSplit",
                "Generate Slave Instance",
                "Erase Self"
              ]
            },
            "path2": {
              "name": "Slave Mode (1)",
              "steps": [
                "Verify _Beam array contains exactly 2 beams",
                "Retrieve beams (_Beam0 and _Beam1)",
                "Determine Scarf orientation (Check existing TSL Map or Calc default)",
                "Create SimpleScarf on both beams",
                "Draw Helper Lines",
                "Store orientation in Map"
              ]
            }
          },
          {
            "condition": "Remaining Length vs Minimum Length (in Master Loop)",
            "path1": {
              "name": "Standard Cut",
              "steps": [
                "Condition: Remaining length >= (dMinLength - dLapSize)",
                "Action: Split beam at distance dMaxLength from start"
              ]
            },
            "path2": {
              "name": "Adjusted Cut",
              "steps": [
                "Condition: Remaining length < (dMinLength - dLapSize)",
                "Action: Shift split point to ensure final segment meets dMinLength"
              ]
            }
          },
          {
            "condition": "Beam Profile Shape",
            "path1": {
              "name": "Rectangular",
              "steps": [
                "Action: Process beam for splitting"
              ]
            },
            "path2": {
              "name": "Non-Rectangular",
              "steps": [
                "Action: Skip beam (Continue loop)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "Implicit (Script does nothing)",
            "recovery": "User must select Elements to proceed; if none selected, script erases instance."
          },
          {
            "check": "Beam Count in Slave Mode",
            "errorMessage": "Implicit (Script erases instance)",
            "recovery": "Requires exactly 2 beams generated by the Master split. If Master fails to pass beams, Slave self-destructs."
          },
          {
            "check": "Beam Profile",
            "errorMessage": "Implicit (Beam skipped)",
            "recovery": "Only Rectangular profiles are processed. Non-rectangular beams are ignored by the Master loop."
          },
          {
            "check": "Recursion Safety",
            "errorMessage": "None (Loop breaks)",
            "recovery": "If nCount > 20, the splitting loop breaks to prevent infinite loops during calculation."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Scarf Joint Geometry",
            "how": "TSL Parameters (OPM)",
            "effect": "Since dLapSize (300mm) and dLapHeight (1/3 beam height) are hardcoded constants, changing OPM properties (dMaxLength/dMinLength) on the *Slave* instances has no geometric effect on the joint, as the split has already occurred. Logic is primarily one-time execution."
          },
          {
            "action": "Remove Scarf Joint",
            "how": "Delete Slave TSL Instance",
            "effect": "Removing the TSL instance removes the machining (SimpleScarf) from the beams, restoring them to split but un-jointed state (or potentially merging them depending on dbSplit behavior, though usually requires manual merge)."
          },
          {
            "action": "Beam Modifications",
            "how": "Grip Edit / Standard AutoCAD commands",
            "effect": "Since SimpleScarf is added as a tool, moving the beam or changing its width/height (which affects the calculated dLapHeight) may require a regeneration or re-execution of the TSL to update the tool orientation correctly."
          }
        ]
      },
      "tokens_used": 7601,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SplitBeamsWithScarfJoint.mcr\n\n## Overview\nAutomatically splits long timber beams into shorter segments joined by a scarf joint (angled overlap) to comply with transport or manufacturing length limitations.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script works in the 3D model environment. |\n| Paper Space | No | Not applicable for layouts or shop drawings. |\n| Shop Drawing | No | Not applicable for 2D drawing generation. |\n\n## Prerequisites\n- **Required Entities**: Elements containing GenBeams.\n- **Minimum Beam Count**: At least 1 beam within the selected Element that exceeds the maximum length setting.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_SplitBeamsWithScarfJoint.mcr` from the list.\n\n### Step 2: Configure Parameters\n```\nDialog: Properties Dialog\nAction: Set the desired Maximum Length and Minimum Length for the splits.\nNote: This dialog appears automatically when first running the script.\n```\n\n### Step 3: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the Elements (e.g., walls, roofs) containing the beams you wish to split.\nAction: Press Enter to confirm selection and start processing.\n```\n\n### Step 4: Processing\nThe script will automatically:\n1. Scan all beams within the selected Elements.\n2. Identify beams longer than the \"Maximum Length\".\n3. Split the beams into segments.\n4. Apply scarf joint machining to the cut ends.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Maximum length | Number | 5000 mm | The maximum permissible length of a single timber piece. Beams longer than this will be split. |\n| Minimum length | Number | 2500 mm | The shortest acceptable length for the final beam segment. Prevents creating short, unusable offcuts. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No specific custom context menu options are defined for this script. Use the Properties Palette to adjust parameters. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not use external settings files. All configuration is done via the Properties Panel.\n\n## Tips\n- **Profile Restriction**: This script only processes beams with **Rectangular** profiles. Other profile shapes will be ignored.\n- **Recursion Safety**: The script includes a safety loop break (at 20 segments) to prevent infinite loops if calculation parameters are invalid.\n- **Modifying Joints**: To remove the scarf joint machining, select the split beam and delete the attached TSL instance (usually visible as a script icon near the beam).\n- **Min Length Logic**: The script intelligently adjusts the cut position so the very last piece of a long beam is never shorter than the defined Minimum Length.\n\n## FAQ\n- **Q: Why did the script not split my beam?**\n  **A:** The beam might already be shorter than the \"Maximum length\" parameter, or it might not have a Rectangular profile.\n- **Q: Can I change the angle or size of the scarf joint?**\n  **A:** No, the scarf joint geometry (300mm lap size) is hardcoded into the script and cannot be changed via parameters.\n- **Q: What happens if I change the parameters after running the script?**\n  **A:** Since the script physically splits the beams and creates new instances, changing the OPM parameters on the *existing* split beams will not retroactively re-split or merge them. You must undo the operation and run the script again with new parameters.\n- **Q: My beams are split but have no machining (cuts).**\n  **A:** Ensure the \"Slave\" instance of the script generated by the split is not deleted or suppressed. The Master instance splits the beam, and the Slave instance adds the cuts."
      },
      "tokens_used": 4977,
      "error": null
    }
  }
}