{
  "filename": "BMF-Winkelverbinder _ T.mcr",
  "status": "completed",
  "total_tokens": 47333,
  "processing_time": 340.13535809516907,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7449,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script lacks 'sd_' prefix, 'Multipage' prefix, and '#Type E' declarations typical of ShopDrawing scripts. It operates directly on Beam objects (3D entities) and generates Body geometry using 'Body()', 'Cut()', and 'Display.draw()' which are standard ModelSpace operations. No '_Viewport' usage found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space requiring two beams selected at insertion to establish the connection point and coordinate system.",
          "requiredSettings": []
        }
      },
      "tokens_used": 5064,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 9440,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates and places various types of steel angle connectors (L-plates) and tension ties at a right-angle connection between two timber beams.",
          "category": "Hardware",
          "typicalUseCase": "Connecting two perpendicular timber beams using specific manufacturer brackets (like BMF or Simpson Strong-Tie), defining geometry for visualization and BOM export."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "Selected from list",
            "businessMeaning": "Selects the specific hardware model (e.g., BMF-Winkel, Simpson HTT22), which automatically sets the plate dimensions (Height, Length, Width, Thickness).",
            "validRange": "List of approx. 54 predefined hardware types.",
            "unit": "String (Enumeration)",
            "affectsOutput": "Determines the 3D geometry of the angle plate and the descriptive text label."
          },
          {
            "name": "sNum",
            "technicalDefault": "Two",
            "businessMeaning": "Determines if the connection uses a single plate on one side or two plates (flanking) on both sides of the beam.",
            "validRange": "One, Two",
            "unit": "String (Enumeration)",
            "affectsOutput": "Controls whether one or two 3D bodies are generated. Locks the 'Side' parameter if set to 'Two'."
          },
          {
            "name": "sSide",
            "technicalDefault": "Left",
            "businessMeaning": "Specifies the side of the beam (Left or Right) where the single hardware piece is positioned.",
            "validRange": "Left, Right",
            "unit": "String (Enumeration)",
            "affectsOutput": "Offsets the 3D geometry laterally along the beam's cross-section axis."
          },
          {
            "name": "sSwitch",
            "technicalDefault": "No",
            "businessMeaning": "Swaps the Height (dH) and Length (dL) dimensions of the bracket.",
            "validRange": "Yes, No",
            "unit": "String (Enumeration)",
            "affectsOutput": "Rotates the bracket geometry 90 degrees relative to the joint centerline."
          },
          {
            "name": "sArt1",
            "technicalDefault": "",
            "businessMeaning": "Commercial article number for the steel angle bracket.",
            "validRange": "Alphanumeric string",
            "unit": "String",
            "affectsOutput": "Appears in BOM/Metalpart lists."
          },
          {
            "name": "sMat1",
            "technicalDefault": "Stahl, feuerverzinkt",
            "businessMeaning": "Material specification for the bracket (e.g., Galvanized Steel).",
            "validRange": "Material names from database",
            "unit": "String",
            "affectsOutput": "Material assignment in reports and BOM."
          },
          {
            "name": "sMod2",
            "technicalDefault": "Kammnagel",
            "businessMeaning": "Type or model of the fastener (nail) used to attach the bracket.",
            "validRange": "Fastener names from database",
            "unit": "String",
            "affectsOutput": "Hardware list generation."
          },
          {
            "name": "dDia",
            "technicalDefault": "4",
            "businessMeaning": "Diameter of the nails.",
            "validRange": "Typically 2.5 - 6 mm",
            "unit": "mm",
            "affectsOutput": "BOM data and potential drilling operations."
          },
          {
            "name": "dLen2",
            "technicalDefault": "40",
            "businessMeaning": "Length of the nails.",
            "validRange": "Typically 30 - 150 mm",
            "unit": "mm",
            "affectsOutput": "BOM data."
          },
          {
            "name": "nNail1",
            "technicalDefault": "0",
            "businessMeaning": "Quantity of nails per hardware piece. If 'sNum' is 'Two', the total count is doubled.",
            "validRange": "Integer > 0",
            "unit": "Count",
            "affectsOutput": "Hardware list/BOM quantity."
          },
          {
            "name": "sLayer",
            "technicalDefault": "I-Layer",
            "businessMeaning": "Assigns the hardware to a specific production layer (I, J, T, or Z) based on the parent element.",
            "validRange": "I-Layer, J-Layer, T-Layer, Z-Layer",
            "unit": "String (Enumeration)",
            "affectsOutput": "Organizes the generated body into specific element groups/zones for exporting or filtering."
          },
          {
            "name": "sNY",
            "technicalDefault": "Yes",
            "businessMeaning": "Toggles the visibility of the text label describing the hardware.",
            "validRange": "Yes, No",
            "unit": "String (Enumeration)",
            "affectsOutput": "Visual display of text in the model."
          },
          {
            "name": "nColor",
            "technicalDefault": "171",
            "businessMeaning": "Display color of the 3D hardware body.",
            "validRange": "0-255 (AutoCAD Color Index)",
            "unit": "Color Index",
            "affectsOutput": "Visual appearance of the generated solid."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sNum set to 'Two'",
            "effect": "Generates hardware on both sides of the beam and disables the 'Side' selection.",
            "cascade": [
              "sSide",
              "Body Generation",
              "nNail count (doubled)"
            ]
          },
          {
            "trigger": "sType selection",
            "effect": "Looks up specific geometry dimensions from internal arrays.",
            "cascade": [
              "dH",
              "dL",
              "dW",
              "dT",
              "sArType1",
              "sArType2"
            ]
          },
          {
            "trigger": "sSwitch set to 'Yes'",
            "effect": "Exchanges the Height and Length values used for body generation.",
            "cascade": [
              "Body Geometry"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (Solid Geometry)",
            "description": "Creates one or two 3D L-shaped solids representing the angle bracket at the beam intersection.",
            "appliedTo": "Model Space (associated with selected beams)"
          },
          {
            "type": "Hardware (Logical)",
            "description": "Creates logical fastener entries for nails/screws attached to the bracket.",
            "appliedTo": "The generated Body"
          },
          {
            "type": "Cut",
            "description": "Performs a cut operation (implied by addTool) on the primary beam to ensure it meets the secondary beam.",
            "appliedTo": "Beam[0]"
          },
          {
            "type": "Text Annotation",
            "description": "Displays the Hardware Type and Sub-type label near the connection.",
            "appliedTo": "Model Space (Leader/Flag location)"
          }
        ]
      },
      "tokens_used": 8504,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Execution Started",
          "2. Check Insertion Flag (_bOnInsert)",
          "3. [Insertion] Prompt user to select first Beam (Beam 0)",
          "4. [Insertion] Prompt user to select second Beam (Beam 1)",
          "5. [Insertion] Validate Right Angle (must be 90 degrees)",
          "6. [Insertion] Show Configuration Dialog (showDialog)",
          "7. [Recalculation/Post-Dialog] Validate Color Index (clamp to 0-255)",
          "8. Retrieve Beam references and calculate width",
          "9. Apply Cut Tool to Beam 0 to meet Beam 1 geometry",
          "10. Identify selected Hardware Type index from arrays",
          "11. Calculate Coordinate System based on beam intersection",
          "12. Check Switch Dimension flag (swap Height/Length if Yes)",
          "13. [Branch] Generate Geometry (Single vs Double hardware)",
          "14. Generate Model/Material/Hardware List data",
          "15. Set CompareKey for BOM filtering",
          "16. [Branch] Assign Body to specific Element Zone/Layer",
          "17. [Branch] Draw Annotation Text (if enabled)",
          "18. Render 3D Bodies and Coordinate System visualization"
        ],
        "conditionalBranches": [
          {
            "condition": "Right Angle Validation",
            "path1": {
              "name": "Valid Angle (90 deg)",
              "steps": [
                "Proceed to showDialog()",
                "Continue to geometry generation"
              ]
            },
            "path2": {
              "name": "Invalid Angle",
              "steps": [
                "Report Notice: 'No Right Angle'",
                "Execute eraseInstance()",
                "Abort Script"
              ]
            }
          },
          {
            "condition": "Parameter: sNum (Number of hardware pieces)",
            "path1": {
              "name": "Single ('One')",
              "steps": [
                "Check sSide parameter (Left/Right)",
                "Calculate offset based on side selection",
                "Generate one Body (bd1)"
              ]
            },
            "path2": {
              "name": "Double ('Two')",
              "steps": [
                "Set sSide property to Read-Only",
                "Generate two bodies (bd1 and bd2) on both sides",
                "Double the nail count (nNail)"
              ]
            }
          },
          {
            "condition": "Parameter: sSwitch (Switch Dimensions)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Swap Height (dH) and Length (dL) values in calculation array"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Use default Height and Length orientation"
              ]
            }
          },
          {
            "condition": "Parameter: sSide (Side)",
            "path1": {
              "name": "Left",
              "steps": [
                "Offset geometry by -dWidth/2 along _X1 axis"
              ]
            },
            "path2": {
              "name": "Right",
              "steps": [
                "Offset geometry by +dWidth/2 along _X1 axis"
              ]
            }
          },
          {
            "condition": "Parameter: sNY (Show Description)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Visualize Grip Point (_PtG)",
                "Draw Text: sArType1 (Hardware Category)",
                "Draw Text: sArType2 (Sub-type)",
                "Draw Leader Line (pl1)"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Skip text generation"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Angle between Beam 0 and Beam 1",
            "errorMessage": "\n No Right Angle",
            "recovery": "Script deletes itself. User must select beams that intersect at 90 degrees and run script again."
          },
          {
            "check": "Color Index (nColor) range",
            "errorMessage": "(Implicit warning/reset)",
            "recovery": "Script automatically resets nColor to 171 if value is outside -1 to 255 range."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Hardware Type",
            "how": "Properties Palette (sType)",
            "effect": "Updates dimensions (dH, dL, dW, dT), Text labels, and 3D Body geometry."
          },
          {
            "action": "Switch Quantity",
            "how": "Properties Palette (sNum)",
            "effect": "Toggles between one-sided and two-sided hardware. If set to 'Two', locks the Side parameter."
          },
          {
            "action": "Change Side",
            "how": "Properties Palette (sSide)",
            "effect": "Moves the hardware body from Left to Right side of the beam (only active if sNum is 'One')."
          },
          {
            "action": "Swap Orientation",
            "how": "Properties Palette (sSwitch)",
            "effect": "Rotates the bracket geometry 90 degrees by swapping Height and Length dimensions."
          },
          {
            "action": "Update Production Layer",
            "how": "Properties Palette (sLayer)",
            "effect": "Re-assigns the Body and Display to a specific Element Zone (I, J, T, Z) for exporting/processing."
          },
          {
            "action": "Modify Grip Point",
            "how": "CAD Grip Edit (_PtG)",
            "effect": "Relocates the Annotation Text and Leader Line location. (Properties dxFlag/dyFlag are read-only)."
          },
          {
            "action": "Change Visibility",
            "how": "Properties Palette (sNY)",
            "effect": "Toggles the visibility of the text label and leader line."
          }
        ]
      },
      "tokens_used": 10177,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# BMF-Winkelverbinder _ T\n\n## Overview\nGenerates and places steel angle connectors (L-plates) and tension ties at right-angle connections between two timber beams. It supports various manufacturer profiles (like BMF or Simpson Strong-Tie) and creates the necessary 3D geometry, cuts, and material lists for production.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script must be run in 3D model space. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | This is a detailing script, not a drawing generator. |\n\n## Prerequisites\n- **Required Entities**: Two timber beams (GenBeams) intersecting each other.\n- **Minimum Beam Count**: 2.\n- **Required Settings**: None (Internal parameter tables are used).\n- **Geometry Requirement**: The two selected beams **must** intersect at a **90-degree angle**. If the angle is not 90 degrees, the script will abort and delete the instance.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `BMF-Winkelverbinder _ T.mcr`\n\n### Step 2: Select Primary Beam\n```\nCommand Line: Select beam:\nAction: Click on the main timber beam (Beam 0) that will receive the cut and the hardware.\n```\n\n### Step 3: Select Secondary Beam\n```\nCommand Line: Select intersecting beam:\nAction: Click on the second timber beam (Beam 1) that intersects the first beam.\n```\n\n### Step 4: Configure Hardware\n```\nAction: A dialog window will appear automatically.\n1. Select the Type (sType) from the list (e.g., BMF-Winkel 100, Simpson HTT22).\n2. Set the Quantity (sNum) to \"One\" or \"Two\".\n3. If \"One\", select the Side (sSide) as \"Left\" or \"Right\".\n4. (Optional) Enable Switch (sSwitch) to rotate the bracket dimensions 90 degrees.\n5. Click OK to generate.\n```\n\n## Properties Panel Parameters\nAfter insertion, select the script instance in the model to edit these parameters in the AutoCAD Properties Palette.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **sType** | Dropdown | Selected | The specific hardware model (e.g., BMF, Simpson). Changing this automatically updates dimensions (Height, Length, Thickness). |\n| **sNum** | Dropdown | Two | Quantity of plates. Options: \"One\" or \"Two\". If set to \"Two\", plates are placed on both sides. |\n| **sSide** | Dropdown | Left | Side of the beam for the plate. Options: \"Left\" or \"Right\". Disabled if `sNum` is \"Two\". |\n| **sSwitch** | Dropdown | No | Swaps the Height and Length dimensions of the bracket (90-degree rotation). Options: \"Yes\", \"No\". |\n| **sArt1** | String | *Empty* | Commercial Article number for the bracket (appears in BOM). |\n| **sMat1** | String | Stahl... | Material description (e.g., \"Galvanized Steel\"). |\n| **sMod2** | String | Kammnagel | Model/Type of the fastener (nail) used. |\n| **dDia** | Number | 4 | Diameter of the nails (mm). |\n| **dLen2** | Number | 40 | Length of the nails (mm). |\n| **nNail1** | Integer | 0 | Quantity of nails per plate. Total count doubles if `sNum` is \"Two\". |\n| **sLayer** | Dropdown | I-Layer | Assigns the hardware to a specific element layer (I, J, T, Z) for exporting/filtering. |\n| **sNY** | Dropdown | Yes | Visibility of the text label/leader line. Options: \"Yes\", \"No\". |\n| **nColor** | Integer | 171 | Color index (0-255) for the 3D body display. |\n\n## Right-Click Menu Options\nThis script primarily uses standard TSL functionality. Context menu options may include:\n| Menu Item | Description |\n|-----------|-------------|\n| **Erase** | Removes the script instance and generated geometry from the drawing. |\n| **Re-calculate** | Forces the script to regenerate the geometry based on current properties (usually automatic). |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script uses internal arrays for hardware dimensions and does not require external XML settings files.\n\n## Tips\n- **90 Degree Constraint**: Ensure your beams are perfectly perpendicular. Use AutoCAD's ortho constraints or rotate commands if the script fails to insert.\n- **Double-Sided Connections**: When using `sNum` = \"Two\", you do not need to specify a Side; the script automatically mirrors the hardware.\n- **Visual Confirmation**: The script displays a text label (Type and Sub-type) connected by a leader line. You can move the text by dragging the grip point (`_PtG`) in the model.\n- **Dimension Switch**: If the bracket looks \"wrong\" (e.g., too tall but not wide enough), try changing `sSwitch` to \"Yes\" to swap the dimensions.\n\n## FAQ\n- **Q: The script disappeared immediately after I selected the second beam. Why?**\n  - A: The beams likely did not form a perfect 90-degree angle. Check the angle between your two beams and try again.\n\n- **Q: I cannot change the \"Side\" property in the list.**\n  - A: This happens when `sNum` (Number of plates) is set to \"Two\". Change `sNum` to \"One\" to unlock the Side selection.\n\n- **Q: How do I rotate the bracket 90 degrees?**\n  - A: Change the `sSwitch` property to \"Yes\". This swaps the Height and Length values defined for the hardware type."
      },
      "tokens_used": 6699,
      "error": null
    }
  }
}