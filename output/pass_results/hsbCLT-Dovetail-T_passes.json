{
  "filename": "hsbCLT-Dovetail-T.mcr",
  "status": "completed",
  "total_tokens": 55259,
  "processing_time": 389.7262763977051,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"This tsl defines a dove tail connection or a butterfly spline as T-Connection between at least two panels.\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.6\",\n      \"date\": \"18oct17\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"bugfix purging\"\n    },\n    {\n      \"version\": \"1.5\",\n      \"date\": \"11Sep17\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"copy and split behaviour enhanced\"\n    },\n    {\n      \"version\": \"1.4\",\n      \"date\": \"24may17\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n     "
      },
      "tokens_used": 9481,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses `_kModelSpace` in the `tslNew.dbCreate` method. It interacts with `Sip` entities using geometric tools (`Dove`, `BeamCut`) added via `addTool`, which are 3D modeling operations. There are no ShopDrawing patterns (`#Type E`, `sd_` prefixes, `_Viewport`)."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 7202,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select male panel(s)",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select female panel(s)",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "PropertyDialog",
            "trigger": "On Insert (if no catalog entry provided)",
            "title": null,
            "dataSource": "TSL Properties (OPM)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dXWidth",
            "type": "PropDouble",
            "displayName": "(A)   Width",
            "defaultValue": "50",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the depth of the lap joint seen from reference side 0 = 50% of thickness"
          },
          {
            "index": 1,
            "variable": "dZDepth",
            "type": "PropDouble",
            "displayName": "(B)   Depth",
            "defaultValue": "20",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the depth"
          },
          {
            "index": 2,
            "variable": "dAlfa",
            "type": "PropDouble",
            "displayName": "(C)  Angle",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the angle dovetail."
          },
          {
            "index": 3,
            "variable": "dGap",
            "type": "PropDouble",
            "displayName": "(D)   Gap",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the gap in depth of the joint"
          },
          {
            "index": 4,
            "variable": "dAxisOffset",
            "type": "PropDouble",
            "displayName": "(E)  Axis Offset X",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Alignment",
            "description": "Defines horizontal offset of the tool."
          },
          {
            "index": 5,
            "variable": "dBottomOffset",
            "type": "PropDouble",
            "displayName": "(F)  Bottom Offset",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Alignment",
            "description": "Defines bottom offset of the tool. 0 = complete through"
          },
          {
            "index": 0,
            "variable": "sTool",
            "type": "PropString",
            "displayName": "(G)  Open Tool Side",
            "defaultValue": "bottom",
            "inputType": "dropdown",
            "options": [
              "bottom",
              "top",
              "Both"
            ],
            "category": "Alignment",
            "description": "Defines the extension of the tool if panels have different extents."
          },
          {
            "index": 1,
            "variable": "sDoveMode",
            "type": "PropString",
            "displayName": "(H)  Connection Type",
            "defaultValue": "Dovetail",
            "inputType": "dropdown",
            "options": [
              "Dovetail",
              "Butterfly Spline"
            ],
            "category": null,
            "description": "Specifies if the dove is added to the male set or if two female doves are added"
          },
          {
            "index": 6,
            "variable": "dChamferRef",
            "type": "PropDouble",
            "displayName": "(I)  Chamfer",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Reference Side",
            "description": null
          },
          {
            "index": 7,
            "variable": "dChamferOpp",
            "type": "PropDouble",
            "displayName": "(J)  Chamfer",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "opposite side",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9722,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates dovetail or butterfly spline connections to join timber panels (CLT or solid timber) in a T-configuration.",
          "category": "Joinery/Machining",
          "typicalUseCase": "Creating a mechanical connection between intersecting wall or floor panels, often used for prefabricated timber construction where visible or hidden wood-to-wood connections are required."
        },
        "parameters": [
          {
            "name": "dXWidth",
            "technicalDefault": "U(50)",
            "businessMeaning": "The width of the dovetail or spline measured perpendicular to the panel surface. For dovetails, this is the lap depth; for splines, it is the width of the connector.",
            "validRange": "20mm to 150mm (typically 50mm-100mm)",
            "unit": "mm",
            "affectsOutput": "Determines the transverse size of the cut on the panels. If set to 0, it defaults to 50% of the panel thickness."
          },
          {
            "name": "dZDepth",
            "technicalDefault": "U(20)",
            "businessMeaning": "The depth of the connection into the thickness of the panels (tenon depth).",
            "validRange": "10mm to (Panel Thickness / 2)",
            "unit": "mm",
            "affectsOutput": "Controls how far the tool penetrates into the panel edge or surface. Critical for structural capacity and ensuring the cut does not exit the opposite side unintentionally."
          },
          {
            "name": "dAlfa",
            "technicalDefault": "U(0)",
            "businessMeaning": "The angle of the dovetail sides relative to the vertical axis. 0 creates a rectangular box spline; non-zero creates a trapezoidal dovetail.",
            "validRange": "0 to 15 degrees",
            "unit": "degrees",
            "affectsOutput": "Changes the geometry from a rectangular tenon (0) to a locking dovetail shape. Higher angles provide better mechanical interlock but are harder to assemble."
          },
          {
            "name": "dGap",
            "technicalDefault": "0",
            "businessMeaning": "Clearance allowance in the depth direction between the male and female parts to account for glue tolerance or swelling.",
            "validRange": "0mm to 2mm",
            "unit": "mm",
            "affectsOutput": "Increases the depth of the female cut (or decreases male) slightly to prevent binding during assembly."
          },
          {
            "name": "dAxisOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "Shifts the entire connection tool laterally along the intersection line.",
            "validRange": "-PanelWidth to +PanelWidth",
            "unit": "mm",
            "affectsOutput": "Moves the position of the dovetail/spline relative to the center of the intersection, used for aligning with specific structural needs or avoiding obstacles."
          },
          {
            "name": "dBottomOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "Truncates the connection at the bottom end. 0 means it cuts completely through; a value creates a stop short of the edge.",
            "validRange": "0mm to PanelLength",
            "unit": "mm",
            "affectsOutput": "Prevents the tool from cutting all the way through the panel bottom, creating a blind joint."
          },
          {
            "name": "sTool",
            "technicalDefault": "bottom",
            "businessMeaning": "Determines how the tool handles mismatches in panel lengths (vertical extents).",
            "validRange": "[bottom, top, Both]",
            "unit": "enum",
            "affectsOutput": "'bottom' extends the tool to match the lower extent; 'top' to the upper; 'Both' spans the full intersection. Ensures the joint is cut even if panels don't align perfectly."
          },
          {
            "name": "sDoveMode",
            "technicalDefault": "Dovetail",
            "businessMeaning": "Selects the type of joint geometry.",
            "validRange": "[Dovetail, Butterfly Spline]",
            "unit": "enum",
            "affectsOutput": "Switches between a standard dovetail lap (male on one side, female on other) and a butterfly spline (female pockets on both sides for a separate insert). Also triggers hardware generation for the spline."
          },
          {
            "name": "dChamferRef",
            "technicalDefault": "U(0)",
            "businessMeaning": "Chamfer size on the Reference Side of the panel (typically the 'good' face or exterior).",
            "validRange": "0mm to 20mm",
            "unit": "mm",
            "affectsOutput": "Adds a 45-degree chamfer cut to the edges of the machined joint on the specified side, easing assembly or aesthetics."
          },
          {
            "name": "dChamferOpp",
            "technicalDefault": "U(0)",
            "businessMeaning": "Chamfer size on the opposite side of the panel.",
            "validRange": "0mm to 20mm",
            "unit": "mm",
            "affectsOutput": "Adds a 45-degree chamfer cut to the edges of the machined joint on the opposite side."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dXWidth",
            "effect": "If set to 0, it calculates based on panel thickness (50%).",
            "cascade": [
              "dZDepth",
              "Panel Thickness"
            ]
          },
          {
            "trigger": "sDoveMode (Butterfly Spline)",
            "effect": "Enables hardware generation ('X-fix L') and calculates spline length.",
            "cascade": [
              "HardWrComp",
              "dTotalToolLength"
            ]
          },
          {
            "trigger": "dAlfa",
            "effect": "Determines if the joint is a locking dovetail or a simple tenon.",
            "cascade": [
              "Dove Shape"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Dove (Dovetail Cut)",
            "description": "A trapezoidal or rectangular recess cut into the panel edges to form a lap joint.",
            "appliedTo": "Selected Male and Female Sip panels"
          },
          {
            "type": "BeamCut (Chamfer)",
            "description": "A chamfered edge cut applied to the perimeter of the joint.",
            "appliedTo": "Selected Male panels"
          },
          {
            "type": "HardWrComp (Hardware Component)",
            "description": "A 'X-fix L' butterfly spline component (visible only in BOM/Hardware lists) automatically sized to the joint dimensions.",
            "appliedTo": "The TSL instance (when Butterfly Spline mode is active)"
          }
        ]
      },
      "tokens_used": 9980,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Execution Triggered",
          "2. Check Insertion Cycle (allow only first cycle)",
          "3. Determine Property Source (Catalog Entry vs. Default Dialog)",
          "4. Prompt User: Select Male Panel(s)",
          "5. Validate Male Selection (filter for valid Sip entities)",
          "6. Prompt User: Select Female Panel(s)",
          "7. Validate Female Selection (filter orthogonal to Males)",
          "8. Establish Coordinate System based on first Male panel",
          "9. Store Entity Map and create final TSL Instance in Model Space",
          "10. Calculate Intersection Geometry between Male and Female sets",
          "11. Determine Tool Vertical Extents (Top/Bottom/Both overlap)",
          "12. Apply Cuts (Dove or Butterfly Spline) based on Mode selection",
          "13. Apply Chamfers (BeamCut) if values > 0",
          "14. Generate Hardware Component (if Butterfly Spline mode)",
          "15. Draw Representation Symbols and finish"
        ],
        "conditionalBranches": [
          {
            "condition": "Catalog Entry Usage",
            "path1": {
              "name": "Catalog Entry Found",
              "steps": [
                "Read property values from specified catalog entry",
                "Skip interactive dialog"
              ]
            },
            "path2": {
              "name": "No Catalog Entry",
              "steps": [
                "Execute showDialog()",
                "Initialize with default properties"
              ]
            }
          },
          {
            "condition": "Connection Type (sDoveMode)",
            "path1": {
              "name": "Dovetail Mode",
              "steps": [
                "Create Male Dove tool (_kMaleEnd)",
                "Create Female Dove tool (_kFemaleSide)",
                "No hardware generated"
              ]
            },
            "path2": {
              "name": "Butterfly Spline Mode",
              "steps": [
                "Create Female pocket on Male panels",
                "Create Female pocket on Female panels",
                "Generate 'X-fix L' Hardware Component"
              ]
            }
          },
          {
            "condition": "Open Tool Side (sTool)",
            "path1": {
              "name": "Bottom",
              "steps": [
                "Align tool start to lowest Y-extent of intersection"
              ]
            },
            "path2": {
              "name": "Top",
              "steps": [
                "Align tool end to highest Y-extent of intersection"
              ]
            },
            "path3": {
              "name": "Both",
              "steps": [
                "Span tool across full vertical overlap height"
              ]
            }
          },
          {
            "condition": "Dimensional Validity (Width/Depth/Height)",
            "path1": {
              "name": "Valid Dimensions (> epsilon)",
              "steps": [
                "Generate Dove/Cut geometry"
              ]
            },
            "path2": {
              "name": "Invalid Dimensions (<= epsilon)",
              "steps": [
                "Skip geometry generation to prevent errors"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Panel Selection Count",
            "errorMessage": "Invalid selection set.",
            "recovery": "User must select at least one valid Male and one valid Female panel."
          },
          {
            "check": "Relative Orientation (Orthogonality)",
            "errorMessage": "Script filters out panels parallel to the initial set.",
            "recovery": "User must ensure Female panels are perpendicular (T-shape) to Male panels."
          },
          {
            "check": "Entity Type",
            "errorMessage": "Non-Sip entities selected",
            "recovery": "Script filters automatically; user must select valid Sip (Panel) entities."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry Parameters",
            "how": "Properties Palette (OPM)",
            "effect": "Updates the dimensions of the dovetail/spline immediately (Width, Depth, Angle, Gap)."
          },
          {
            "action": "Adjust Alignment",
            "how": "Properties Palette (Axis Offset, Bottom Offset, Open Tool Side)",
            "effect": "Moves the position or changes the vertical extent of the joint without recreating the instance."
          },
          {
            "action": "Switch Connection Type",
            "how": "Properties Palette (Connection Type dropdown)",
            "effect": "Toggles between Dovetail and Butterfly Spline, adding or removing the associated hardware component automatically."
          },
          {
            "action": "Modify Connected Panels",
            "how": "Grip Edit / Move / Split",
            "effect": "Script recalculates automatically to maintain the connection at the new intersection or purges if the intersection is lost."
          }
        ]
      },
      "tokens_used": 11486,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-Dovetail-T.mcr\n\n## Overview\nThis script creates a dovetail joint or butterfly spline connection between timber panels (CLT or solid timber) arranged in a T-configuration. It mechanically joins intersecting walls or floors by cutting corresponding male and female profiles or pockets for spline inserts.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script generates 3D geometry and cuts directly on the panels. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | Does not generate drawing views or dimensions. |\n\n## Prerequisites\n- **Required Entities**: At least two Panels (Sip entities).\n- **Minimum Count**: 1 Male panel and 1 Female panel (must intersect).\n- **Settings Files**: None required.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsbCLT-Dovetail-T.mcr`\n\n### Step 2: Select Male Panel(s)\n```\nCommand Line: |Select male panel(s)\nAction: Click on the panel(s) that will form the first part of the connection (typically the \"through\" or \"main\" part). Press Enter to confirm.\n```\n\n### Step 3: Select Female Panel(s)\n```\nCommand Line: |Select female panel(s)\nAction: Click on the intersecting panel(s) that will receive the connection (typically the \"stopped\" part). These must be perpendicular to the male panels.\n```\n\n### Step 4: Configure Properties\nAfter selection, the script inserts. Open the **Properties Palette** (Ctrl+1) to adjust dimensions, gaps, and connection type.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| (A) Width | Number | 50 | Defines the width of the connection (lap depth). Set to 0 for automatic 50% of panel thickness. |\n| (B) Depth | Number | 20 | Defines how deep the cut goes into the panel thickness. |\n| (C) Angle | Number | 0 | Defines the dovetail angle. 0° creates a rectangular spline; higher angles create a locking dovetail. |\n| (D) Gap | Number | 0 | Adds clearance in the depth direction (e.g., for glue tolerance). |\n| (E) Axis Offset X | Number | 0 | Shifts the connection horizontally along the intersection line. |\n| (F) Bottom Offset | Number | 0 | Stops the cut before the bottom edge (0 = cut all the way through). |\n| (G) Open Tool Side | Dropdown | bottom | Determines how the tool handles different panel heights: `bottom`, `top`, or `Both` (full overlap). |\n| (H) Connection Type | Dropdown | Dovetail | Switches between `Dovetail` (Male/Female cut) or `Butterfly Spline` (Pockets on both sides + hardware). |\n| (I) Chamfer (Ref) | Number | 0 | Adds a chamfer on the reference side of the joint. |\n| (J) Chamfer (Opp) | Number | 0 | Adds a chamfer on the opposite side of the joint. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not add specific custom items to the right-click context menu. Edit properties via the palette. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Automatic Width**: If you are unsure of the exact width needed, set **Width** to `0`. The script will automatically calculate 50% of the panel's thickness.\n- **Butterfly Spline**: When switching to **Butterfly Spline** mode, the script automatically generates an \"X-fix L\" hardware component in the BOM.\n- **Vertical Alignment**: If your intersecting panels have different heights, use the **Open Tool Side** property. Set to `Both` to ensure the cut spans the entire overlapping area.\n- **Angle**: Use a non-zero **Angle** (e.g., 5-10 degrees) if you want a mechanically interlocking dovetail that resists pull-out.\n\n## FAQ\n- **Q: Why did my joint not generate?**\n  - **A**: Ensure the selected panels are perpendicular (T-shape). Parallel panels or panels that do not physically intersect will be filtered out.\n- **Q: What is the difference between Dovetail and Butterfly Spline modes?**\n  - **A**: **Dovetail** mode cuts a tenon on the male panel and a mortise on the female panel. **Butterfly Spline** mode cuts a mortise (pocket) on *both* panels and generates a separate spline hardware piece for connection.\n- **Q: How do I prevent the cut from going all the way through the panel?**\n  - **A**: Increase the **Bottom Offset** value. This stops the tool the specified distance from the bottom edge of the panel."
      },
      "tokens_used": 7388,
      "error": null
    }
  }
}