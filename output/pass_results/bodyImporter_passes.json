{
  "filename": "bodyImporter.mcr",
  "status": "completed",
  "total_tokens": 54493,
  "processing_time": 299.62377738952637,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.5",
            "date": "09.12.2021",
            "author": "Thorsten Huck",
            "changes": "HSB-14123 supports plugInGroup extension and default import, new command to create basic panel"
          },
          {
            "version": "1.4",
            "date": "02oct18",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "alignment panel creation fixed"
          },
          {
            "version": "1.3",
            "date": "02oct18",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "MapX Export supports also area and volume"
          },
          {
            "version": "1.2",
            "date": "02oct18",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "MapX Export supported"
          },
          {
            "version": "1.1",
            "date": "14sep18",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "automatic conversion deactivated"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8719,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates 3D model entities (Beam, Sheet, 3dSolid, MassElement) using dbCreate methods. Uses Display(-1) for 3D visualization. No usage of _Viewport, sd_ prefixes, or detail drawing APIs."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (Insertion triggers IFC import)",
          "requiredSettings": [
            "_kPathHsbInstall\\\\Utilities\\\\hsbCloudStorage\\\\hsbIFCtoMapConfigurator.exe",
            "hsbSolid2PanelConversion (TSL)"
          ]
        }
      },
      "tokens_used": 7323,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [],\n  \"contextMenu\": [\n    {\n      \"menuItem\": \"|set map from beam solid|\",\n      \"handler\": \"|set map from beam solid|\",\n      \"action\": \"Updates the internal source map body with the real body of a user-selected beam.\",\n      \"condition\": \"Debug Mode\"\n    },\n    {\n      \"menuItem\": \"|reset map|\",\n      \"handler\": \"|reset map|\",\n      \"action\": \"Clears the internal source map body.\",\n      \"condition\": \"Debug Mode\"\n    },\n    {\n      \"menuItem\": \"|show map (in debug only)|\",\n      \"handler\": \"|show map (in debug only)|\",\n      \"action\": \"Displays the instance map data.\",\n      \"condition\": \"Debug Mode\"\n    },\n    {\n      \"menuItem\": \"|Convert into acis solid|\",\n      \"handler\": \"|Convert into acis solid|\",\n      \"action\": \"Creates an ACIS 3D solid from the imported body and erases the script instance.\",\n      \"condition\": \"Body exists\"\n    },\n    {\n      \"menuItem\": \"|Convert into mass element|\",\n      \"handler\": \"|Convert into mass element|\",\n      \"action\":"
      },
      "tokens_used": 10210,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Imports IFC building geometry and manages its conversion into native hsbCAD structural elements (Beams, Sheets, Panels) with metadata mapping.",
          "category": "Data Import / Model Preparation",
          "typicalUseCase": "An engineer receives an architectural model in IFC format, imports it using this script, and converts generic walls/floors into parametric timber panels or beams for detailing and manufacturing."
        },
        "parameters": [
          {
            "name": "HsbType",
            "technicalDefault": "Derived from IFC Map",
            "businessMeaning": "Defines the intended construction classification of the imported geometry (e.g., is this a structural timber beam, a sheathing sheet, or a complete SIP panel?). This determines the specific hsbCAD entity created during conversion.",
            "validRange": "BEAM, SHEET, SIP",
            "unit": "String",
            "affectsOutput": "Selects which creation logic to run (GenBeam, Sheet, or external Panel converter). Affects dimension mapping (Width vs Height vs Thickness)."
          },
          {
            "name": "Create Beam",
            "technicalDefault": "N/A (Command)",
            "businessMeaning": "Converts the imported geometry into a parametric Timber Beam entity.",
            "validRange": "N/A",
            "unit": "Action",
            "affectsOutput": "Replaces the raw import body with a GenBeam. Orientates the beam based on the longest axis. Erases the script instance upon success."
          },
          {
            "name": "Create Sheet",
            "technicalDefault": "N/A (Command)",
            "businessMeaning": "Converts the imported geometry into a parametric Sheet entity (e.g., OSB, Plywood).",
            "validRange": "N/A",
            "unit": "Action",
            "affectsOutput": "Replaces the raw import body with a Sheet entity. Erases the script instance upon success."
          },
          {
            "name": "Create panel",
            "technicalDefault": "N/A (Command)",
            "businessMeaning": "Converts the imported geometry into a complex hsbCAD Panel (Wall/Floor) using the 'hsbSolid2PanelConversion' engine.",
            "validRange": "N/A",
            "unit": "Action",
            "affectsOutput": "Replaces the raw import body with a Panel instance. Allows for further panel detailing and layer composition."
          },
          {
            "name": "Convert into acis solid",
            "technicalDefault": "N/A (Command)",
            "businessMeaning": "Drops all parametric timber intelligence and converts the geometry into a standard AutoCAD 3D Solid.",
            "validRange": "N/A",
            "unit": "Action",
            "affectsOutput": "Creates a static 'dumb' solid. Useful for reference or collision checking where manufacturing data is not needed. Erases the script instance."
          },
          {
            "name": "Convert into mass element",
            "technicalDefault": "N/A (Command)",
            "businessMeaning": "Converts the geometry into a generic Mass Element, often used for conceptual volumetric studies or as a base for manual modeling.",
            "validRange": "N/A",
            "unit": "Action",
            "affectsOutput": "Creates an AutoCAD Mass Element. Erases the script instance."
          },
          {
            "name": "Visualize bad faces",
            "technicalDefault": "N/A (Command)",
            "businessMeaning": "Quality Assurance tool. Highlights areas of the imported geometry that are non-planar, self-intersecting, or otherwise invalid for timber conversion.",
            "validRange": "N/A",
            "unit": "Action",
            "affectsOutput": "Visual feedback only (red lines/planes). Does not change geometry. Helps user decide if manual repair of the IFC source is needed."
          },
          {
            "name": "Metadata Mapping (Name, Material, Grade)",
            "technicalDefault": "From IFC PropertySets",
            "businessMeaning": "Transfers descriptive data from the original IFC object to the new hsbCAD entity properties (BOM labels, material codes, grades).",
            "validRange": "N/A",
            "unit": "Strings",
            "affectsOutput": "Populates the Properties Palette and Production Reports of the resulting Beam/Sheet/Panel."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Import Process (IFCtoMapConfigurator)",
            "effect": "Populates the internal Map with 'HsbType' and 'Body'.",
            "cascade": [
              "HsbType",
              "Geometry Body"
            ]
          },
          {
            "trigger": "HsbType Selection",
            "effect": "Enables or highlights the relevant 'Create...' context menu option based on the type.",
            "cascade": [
              "Create Beam",
              "Create Sheet",
              "Create panel"
            ]
          },
          {
            "trigger": "Successful Conversion (Create Beam/Sheet/Panel)",
            "effect": "Automatically erases the intermediate 'bodyImporter' script instance.",
            "cascade": [
              "Script Instance"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam",
            "description": "A parametric timber beam derived from the imported solid geometry.",
            "appliedTo": "Imported geometry classified as 'BEAM'."
          },
          {
            "type": "Sheet",
            "description": "A planar material component (e.g., particle board) derived from the imported solid.",
            "appliedTo": "Imported geometry classified as 'SHEET'."
          },
          {
            "type": "Element (Panel)",
            "description": "A complex structural panel instance created via the external hsbSolid2PanelConversion engine.",
            "appliedTo": "Imported geometry classified as 'SIP' or selected via 'Create panel'."
          },
          {
            "type": "3dSolid",
            "description": "A generic AutoCAD ACIS solid with no parametric timber data.",
            "appliedTo": "Geometry converted via 'Convert into acis solid'."
          }
        ]
      },
      "tokens_used": 9785,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Launch Script: User inserts 'bodyImporter' script.\",\n    \"2. External Configurator: 'hsbIFCtoMapConfigurator.exe' opens automatically.\",\n    \"3. User Selection: User selects IFC file and maps IFC entities to hsbCAD types (Beam, Sheet, SIP).\",\n    \"4. Import Processing: Script receives Map data, runs 'ModelMap.dbInterpretMap' to generate geometry and new script instances.\",\n    \"5. Self-Cleanup: The initial 'launcher' instance erases itself.\",\n    \"6. Instance Generation: New 'bodyImporter' instances are created for every imported entity.\",\n    \"7. Geometry Processing: Each instance reads its 'source' Map, extracts the Body, and calculates orientation (CoordSys).\",\n    \"8. Visualization: The instance displays the body dimensions and metadata in the 3D model.\",\n    \"9. User Action: User Right-Clicks the instance and selects a conversion method (e.g., 'Create Beam', 'Create panel').\",\n    \"10. Conversion: Script generates the target entity (GenBeam, Sheet, Panel, or 3dSolid) and assigns IFC metadata.\",\n    \"11. Validation: Script compares the generated solid's vertices with the original import body.\",\n    \"12. Termination: If valid, the script erases itself. If invalid, it turns Red and stays in the model.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Execution Context (Insert vs. Recalc)\",\n      \"path1\": {\n        \"name\": \"Insert Phase\",\n        \"steps\": [\n          \"Check insertCycleCount\",\n          \"Launch Configurator\",\n          \"Interpret ModelMap\",\n          \"Erase Instance\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Instance Phase\",\n        \"steps\": [\n          \"Read Source Map\",\n          \"Fix CoordSys\",\n          \"Display Data\",\n          \"Wait for Context Menu Trigger\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Body Availability and Validity\",\n      \"path1\": {\n        \"name\": \"Valid Body\",\n        \"steps\": [\n          \"Extract Body from Map\",\n          \"Calculate Dimensions (L/W/H)\",\n          \"Draw Visualization\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Invalid/Missing Body\",\n        \"steps\": [\n          \"Report Error Message\",\n          \"Draw Warning Line (Red)\",\n          \"Display GUID for traceability\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Entity Type (HsbType)\",\n      \"path1\": {\n        \"name\": \"Panel/SIP Type\",\n        \"steps\": [\n          \"Determine Smallest Dimension for Z-axis\",\n          \"Align Z to vertical if possible\",\n          \"Update CoordSys\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Beam/Sheet Type\",\n        \"steps\": [\n          \"Use standard Beam Solid bounding box logic\",\n          \"Update CoordSys\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Beam Orientation (Create Beam)\",\n      \"path1\": {\n        \"name\": \"Width < Height\",\n        \"steps\": [\n          \"Create initial Beam\",\n          \"Rotate Body 90 deg (Swap Y/Z vectors)\",\n          \"Re-create Beam\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Width >= Height\",\n        \"steps\": [\n          \"Create Beam with standard vectors\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Conversion Result Validation\",\n      \"path1\": {\n        \"name\": \"Vertex Match Success\",\n        \"steps\": [\n          \"Report 'successful'\",\n          \"Erase Script Instance\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Vertex Mismatch\",\n        \"steps\": [\n          \"Report 'Conversion has mismatches'\",\n          \"Set Script Color to Red (1)\",\n          \"Keep Script Instance in Model\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Body Existence in Map\",\n      \"errorMessage\": \"<GUID> failed to get body, entry <Key> not found or invalid.\",\n      \"recovery\": \"Re-run IFC import or use Debug 'set map from beam solid' to manually assign geometry.\"\n    },\n    {\n      \"check\": \"Solid Volume\",\n      \"errorMessage\": \"Implicitly handled by volume < epsilon check.\",\n      \"recovery\": \"Check source IFC file for empty objects.\"\n    },\n    {\n      \"check\": \"Geometry Fidelity (Vertex Count)\",\n      \"errorMessage\": \"Conversion has mismatches (Vertex count differs between original and generated solid).\",\n      \"recovery\": \"Script turns Red. User must inspect geometry complexity or try different conversion method (e.g., Convert to ACIS vs Create Beam).\"\n    },\n    {\n      \"check\": \"Panel Style Availability\",\n      \"errorMessage\": \"Could not find any matching panel style.\",\n      \"recovery\": \"User must ensure correct panel catalogs/styles are loaded in the hsbCAD environment.\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Set map from beam solid\",\n      \"how\": \"Context Menu (Debug Mode Only)\",\n      \"effect\": \"Updates the internal source map with the geometry of a user-selected beam.\"\n    },\n    {\n      \"action\": \"Reset map\",\n      \"how\": \"Context Menu (Debug Mode Only)\",\n      \"effect\": \"Clears the internal source map data.\"\n    },\n    {\n      \"action\": \"Convert into acis solid\",\n      \"how\": \"Context Menu\",\n      \"effect\": \"Replaces script with a static AutoCAD 3dSolid and erases the script instance.\"\n    },\n    {\n      \"action\": \"Convert into mass element\",\n      \"how\": \"Context Menu\",\n      \"effect\": \"Replaces script with an AutoCAD Mass Element and erases the script instance.\"\n    },\n    {\n      \"action\": \"Create Beam\",\n      \"how\": \"Context Menu\",\n      \"effect\": \"Generates a parametric GenBeam. If successful (geometry matches), script erases. If not, script turns Red"
      },
      "tokens_used": 11444,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# bodyImporter.mcr\n\n## Overview\nImports IFC building geometry and manages its conversion into native hsbCAD structural elements (Beams, Sheets, or Panels). It serves as an intermediate step to validate and convert architectural models into parametric timber components.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script creates 3D model entities (Beams, Sheets, Solids). |\n| Paper Space | No | Not applicable for detail views. |\n| Shop Drawing | No | This is a model preparation/import tool. |\n\n## Prerequisites\n- **Required Entities:** None. The script triggers the import process upon insertion.\n- **Minimum Beam Count:** 0.\n- **Required Settings:**\n  - `hsbIFCtoMapConfigurator.exe` (Must be located in `_kPathHsbInstall\\Utilities\\hsbCloudStorage\\`).\n  - `hsbSolid2PanelConversion` (TSL script required for panel creation).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command:** `TSLINSERT`\n**Action:** Select `bodyImporter.mcr` from the list and insert it into the Model Space.\n\n### Step 2: Configure Import\n**External Dialog:** The **hsbIFCtoMapConfigurator** will launch automatically.\n**Action:**\n1. Select the source IFC file.\n2. Map IFC entities (e.g., `IfcWall`) to target hsbCAD types (e.g., `BEAM`, `SHEET`, `SIP`).\n3. Click **Import**.\n\n### Step 3: Review Imported Geometry\n**Action:** The script will generate `bodyImporter` instances in the model representing the imported objects.\n- **Green/Normal:** Geometry successfully imported.\n- **Red:** Geometry import failed or is invalid.\n\n### Step 4: Convert Geometry\n**Action:** Select one or more imported instances.\n1. **Right-Click** to open the context menu.\n2. Select a conversion option (e.g., \"Create Beam\", \"Create panel\").\n3. The script will replace the instance with the specific hsbCAD entity.\n\n### Step 5: Validation\n**Action:**\n- If the conversion geometry matches the import perfectly, the script instance erases itself automatically.\n- If there is a mismatch (vertex count difference), the script instance turns **Red** and stays in the model.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| (None) | N/A | N/A | This script does not expose standard user-editable properties in the Properties Palette. All configuration is handled via the IFC Configurator or Context Menu. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Create Beam** | Converts the imported geometry into a parametric Timber Beam (GenBeam). The script calculates orientation based on the longest axis. |\n| **Create Sheet** | Converts the imported geometry into a parametric Sheet (e.g., OSB, Plywood). |\n| **Create panel** | Converts the geometry into a complex hsbCAD Panel (Wall/Floor) using the external panel conversion engine. |\n| **Convert into acis solid** | Replaces the script instance with a static AutoCAD 3D Solid. Useful for reference or collision checking where manufacturing data is not needed. |\n| **Convert into mass element** | Replaces the script instance with an AutoCAD Mass Element for conceptual volumetric studies. |\n| **Visualize bad faces** | Runs a Quality Assurance check and highlights areas of the geometry that are non-planar or invalid (debugging tool). |\n| **set map from beam solid** | (Debug Mode) Updates the internal source map with the geometry of a user-selected beam. |\n| **reset map** | (Debug Mode) Clears the internal source map data. |\n\n## Settings Files\n- **External Tool:** `hsbIFCtoMapConfigurator.exe`\n- **Location:** `%hsbInstall%\\Utilities\\hsbCloudStorage\\`\n- **Purpose:** Handles the file selection, IFC parsing, and mapping of IFC types to hsbCAD types before the script logic runs.\n\n## Tips\n- **Troubleshooting Red Instances:** If an instance turns red after conversion, use the **Visualize bad faces** option to see if the original IFC geometry has topology errors (like non-planar faces).\n- **Panel Orientation:** When creating panels, the script attempts to align the Z-axis to vertical. If the result is upside down, check the source IFC orientation.\n- **Batch Processing:** You can select multiple `bodyImporter` instances and convert them simultaneously via the right-click menu.\n\n## FAQ\n- **Q: Why did the script instance disappear after I right-clicked?**\n  **A:** This is expected behavior. If the conversion is successful and the geometry is valid, the script self-destructs, leaving only the new Beam, Sheet, or Panel.\n- **Q: What does it mean if the instance turns Red?**\n  **A:** It means the script detected a mismatch between the imported body and the generated hsbCAD solid (usually due to complex geometry). The script remains in the model so you can inspect the error or try a different conversion method (like converting to a generic ACIS solid).\n- **Q: Can I edit the dimensions in the properties palette?**\n  **A:** No, the dimensions are locked to the imported IFC geometry. You must convert the object to a Beam or Panel first to gain access to parametric dimensions."
      },
      "tokens_used": 7012,
      "error": null
    }
  }
}