{
  "filename": "sd_DisplayMetalPartCollectionHandle.mcr",
  "status": "completed",
  "total_tokens": 19339,
  "processing_time": 174.20295763015747,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 2437,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ShopDrawing",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getShopDrawView() and iterates _Entity[] for ShopDrawView. It retrieves ViewData via _Map and _kOnGenerateShopDrawing, processes it to find specific entities (MetalPartCollectionEnt) within a fabrication context, and draws text based on that data."
        },
        "prerequisites": {
          "requiredEntities": [
            "ShopDrawView",
            "MetalPartCollectionEnt"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Requires execution within a Shop Drawing generation context (onGenerate) or insertion associated with a ShopDrawView.",
          "requiredSettings": []
        }
      },
      "tokens_used": 1551,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getShopDrawView",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "Insertion",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "|Color| |-1 = byBlock|",
            "defaultValue": 164,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2502,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Displays the Handle and Entry Name of the first Metal Part Collection found in the selected Shop Drawing View as a text label in the drawing layout.",
          "category": "ShopDrawing",
          "typicalUseCase": "Labeling or debugging metalwork assemblies in production drawings to verify that the correct MetalPartCollection definition is applied to a specific view."
        },
        "parameters": [
          {
            "name": "nColor",
            "technicalDefault": "164",
            "businessMeaning": "Controls the color of the text label displayed in the CAD layout. Used to distinguish the label from standard dimensions or notes.",
            "validRange": "Standard AutoCAD Color Index (1-255) or -1 for ByBlock",
            "unit": "ACI (AutoCAD Color Index)",
            "affectsOutput": "Changes the visual appearance (color) of the generated text in the shop drawing."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "\"\"",
            "businessMeaning": "Determines the specific text style (font, height, etc.) used to display the label, ensuring consistency with drafting standards.",
            "validRange": "Any valid Dimension Style defined in the current hsbCAD/AutoCAD template",
            "unit": "Style Name (String)",
            "affectsOutput": "Changes the font, size, and formatting properties of the generated text."
          },
          {
            "name": "_Pt0",
            "technicalDefault": "User Input",
            "businessMeaning": "The insertion point coordinate where the label text will be placed in the layout (Paper Space or Model Space within the view).",
            "validRange": "Any 2D/3D coordinate within the drawing limits",
            "unit": "Coordinates (mm)",
            "affectsOutput": "Determines the location of the text label on the drawing."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "_Pt0 selection",
            "effect": "Determines the spatial position of the text label.",
            "cascade": []
          },
          {
            "trigger": "sDimStyle selection",
            "effect": "Overrides default text properties with those defined in the selected DimStyle.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Text/Annotation",
            "description": "A text string containing the Handle and Entry Name of the detected MetalPartCollectionDef (e.g., '12345 Bracket_A'), or 'HANX' if no collection is found.",
            "appliedTo": "Shop Drawing View (Layout)"
          }
        ]
      },
      "tokens_used": 2869,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Start: Initialize properties (Color, DimStyle).",
          "2. Check Execution Context: Is this an insertion event (_bOnInsert)?",
          "3. [Insertion Branch] Check insertCycleCount.",
          "4. [Insertion Branch] Prompt user to select a ShopDrawView.",
          "5. [Insertion Branch] Prompt user for insertion point (_Pt0).",
          "6. [Insertion Branch] Show Properties Dialog and exit.",
          "7. [Calculation Branch] Iterate through _Entity list to locate ShopDrawView.",
          "8. [Calculation Branch] Validate ShopDrawView object.",
          "9. [Calculation Branch] Retrieve ViewData from internal Map (_kOnGenerateShopDrawing).",
          "10. [Calculation Branch] Extract Entities from the ViewData definition set.",
          "11. [Calculation Branch] Loop through extracted Entities to find MetalPartCollectionEnt.",
          "12. [Calculation Branch] Generate text string (Handle + Entry Name) if found.",
          "13. [Calculation Branch] Draw final text at insertion point using Display properties."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution State (_bOnInsert)",
            "path1": {
              "name": "Insertion Mode",
              "steps": [
                "Check insertCycleCount (Abort if > 1)",
                "Execute getShopDrawView()",
                "Execute getPoint() for _Pt0",
                "Show Dialog",
                "Return"
              ]
            },
            "path2": {
              "name": "Calculation/Regen Mode",
              "steps": [
                "Parse _Entity for ShopDrawView",
                "Process ViewData",
                "Generate Geometry"
              ]
            }
          },
          {
            "condition": "ViewData Availability",
            "path1": {
              "name": "Data Found",
              "steps": [
                "Retrieve Transformation CoordSys",
                "Populate Entity array (ents)",
                "Proceed to Entity Loop"
              ]
            },
            "path2": {
              "name": "Data Missing/Invalid View",
              "steps": [
                "Set bError flag",
                "Keep Entity array empty",
                "Proceed to Draw Phase"
              ]
            }
          },
          {
            "condition": "Entity Content in ViewData",
            "path1": {
              "name": "MetalPartCollectionEnt Found",
              "steps": [
                "Cast to MetalPartCollectionEnt",
                "Get Definition (Handle, EntryName)",
                "Format String sTxt",
                "Break Loop"
              ]
            },
            "path2": {
              "name": "Collection Not Found",
              "steps": [
                "sTxt remains empty",
                "Loop finishes naturally"
              ]
            }
          },
          {
            "condition": "Final Output Decision",
            "path1": {
              "name": "Error or Empty Entities (ents.length < 1)",
              "steps": [
                "Draw text 'HANX' at _Pt0"
              ]
            },
            "path2": {
              "name": "Entities Present (ents.length >= 1)",
              "steps": [
                "Draw sTxt at _Pt0 (Note: If loop found nothing, sTxt is empty/blank)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Silent failure)",
            "recovery": "Script erases instance automatically if cycle > 1."
          },
          {
            "check": "ShopDrawView Validity",
            "errorMessage": "None (Visual feedback only)",
            "recovery": "Script draws 'HANX' at insertion point indicating error state. User must ensure script is associated with a valid ShopDrawView."
          },
          {
            "check": "ViewData in Map",
            "errorMessage": "None (Visual feedback only)",
            "recovery": "Script draws 'HANX'. Indicates the script is likely running outside the Shop Drawing generation context or the specific view lacks data."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Label",
            "how": "Grip Edit (Point)",
            "effect": "Updates _Pt0, moving the text label to the new location."
          },
          {
            "action": "Change Color",
            "how": "OPM (Properties Palette)",
            "effect": "Updates nColor; regenerates script with new text color."
          },
          {
            "action": "Change DimStyle",
            "how": "OPM (Properties Palette)",
            "effect": "Updates sDimStyle; regenerates script with new text style/font settings."
          }
        ]
      },
      "tokens_used": 5257,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# sd_DisplayMetalPartCollectionHandle.mcr\n\n## Overview\nDisplays the Handle and Entry Name of the first Metal Part Collection found in the selected Shop Drawing View as a text label. This tool is useful for labeling or debugging metalwork assemblies in production drawings to verify the correct MetalPartCollection definition is applied.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is intended for detailing views. |\n| Paper Space | Yes | Can be inserted directly into layout sheets. |\n| Shop Drawing | Yes | Primary usage context for generating view labels. |\n\n## Prerequisites\n- **Required Entities**: A `ShopDrawView` and at least one `MetalPartCollectionEnt` associated with that view.\n- **Minimum Beam Count**: 0 (Independent of structural beams).\n- **Required Settings Files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `sd_DisplayMetalPartCollectionHandle.mcr` from the file dialog.\n\n### Step 2: Select Shop Draw View\n```\nCommand Line: Select ShopDrawView:\nAction: Click on the boundary of the Shop Drawing View (viewport) you wish to label.\n```\n\n### Step 3: Specify Insertion Point\n```\nCommand Line: Specify insertion point:\nAction: Click in the drawing layout where you want the text label to appear.\n```\n\n### Step 4: Configure Properties (Optional)\nAfter insertion, the Properties Palette will open. You can adjust the text appearance if needed.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Color | number | 164 | Sets the color of the text label (AutoCAD Color Index). Use -1 for \"ByBlock\". |\n| Dimstyle | dropdown | \"\" | Selects the Dimension Style to control text font, height, and formatting. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | No custom context menu options are defined for this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Moving the Label**: After insertion, select the label and use the grip point to drag it to a new location without deleting it.\n- **Error Indicator**: If the label displays the text **\"HANX\"**, it means the script could not find the required Metal Part Collection data within the selected Shop Drawing View. Ensure the view actually contains metal parts.\n- **Text Styling**: For the text to look correct, ensure the selected DimStyle exists in your current drawing template.\n\n## FAQ\n- **Q: Why is my text blank?**\n  A: This usually means the script found the Shop Drawing View, but no Metal Part Collection entities were found inside it.\n- **Q: Can I change the font size?**\n  A: Yes. The font size is controlled by the text height defined in the DimStyle selected in the Properties Palette. Change the \"Dimstyle\" property to a style with your desired text height."
      },
      "tokens_used": 4723,
      "error": null
    }
  }
}