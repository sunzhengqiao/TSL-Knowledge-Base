{
  "filename": "hsb_AssignBeamsToGroup.mcr",
  "status": "completed",
  "total_tokens": 29630,
  "processing_time": 178.3490068912506,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "08.11.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "02.09.2011",
            "author": null,
            "changes": "Add sequence number"
          },
          {
            "version": "1.2",
            "date": "05.09.2011",
            "author": null,
            "changes": "Add sequence number"
          },
          {
            "version": "1.3",
            "date": "28.06.2012",
            "author": null,
            "changes": "It will remove the entities that were link to the same wall"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4757,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses Element() and Beam() objects without ShopDrawing-specific prefixes (sd_*). It references '_kModel' in 'gpToAssign.collectEntities' which indicates Model Space operation. No #Type E or viewport logic found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Elements with Beams to be assigned to a Group.",
          "requiredSettings": []
        }
      },
      "tokens_used": 2362,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialogOnce",
            "trigger": "Insertion if _kExecuteKey is empty",
            "title": null,
            "dataSource": "Properties of the script instance",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sBeamCodeFloor",
            "type": "PropString",
            "displayName": "Beams with beamcode to Group(; - separated list)",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Fill the Code of the beams that need to be added to the Group describe below, use ; to separate them"
          },
          {
            "index": 1,
            "variable": "sGrpNm1",
            "type": "PropString",
            "displayName": "House Level group name",
            "defaultValue": "00_GF-Soleplates",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "House group or empty will select the house level of the element that is selected"
          },
          {
            "index": 2,
            "variable": "sGrpNm2",
            "type": "PropString",
            "displayName": "Floor Level group name",
            "defaultValue": "GF-Loose",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": ""
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3523,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Filters specific beams from a wall or floor element based on their beam code and reorganizes them into a designated group structure, typically used to separate loose materials or specific structural components.",
          "category": "Organization",
          "typicalUseCase": "Extracting 'Sole Plates' or 'Loose Joists' from a wall element into a separate 'Loose Material' group for independent numbering, scheduling, or manufacturing output."
        },
        "parameters": [
          {
            "name": "sBeamCodeFloor",
            "technicalDefault": "",
            "businessMeaning": "The filter criteria used to identify which beams within the selected element should be moved to the new group. It matches the 'Beam Code' property defined in the catalog.",
            "validRange": "Semi-colon separated string (e.g., 'PL200;ST100'). Valid codes depend on the hsbCAD catalog loaded.",
            "unit": "String",
            "affectsOutput": "Determines which specific entities are moved. Beams matching the codes are removed from their current context and placed in the target group; others remain in the original element."
          },
          {
            "name": "sGrpNm1",
            "technicalDefault": "00_GF-Soleplates",
            "businessMeaning": "The first part of the destination group path, usually representing the Project Level or House Level.",
            "validRange": "String. If left empty, the script automatically defaults to the group of the selected Element.",
            "unit": "String",
            "affectsOutput": "Sets the primary directory location in the hsbCAD project tree where the beams will be organized."
          },
          {
            "name": "sGrpNm2",
            "technicalDefault": "GF-Loose",
            "businessMeaning": "The second part of the destination group path, usually representing the Floor Level or a specific category (like 'Loose').",
            "validRange": "String. Must be defined to ensure a valid group path.",
            "unit": "String",
            "affectsOutput": "Sets the sub-directory or final group name where the beams are stored."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sGrpNm1 is empty",
            "effect": "The script attempts to read the group name from the Element selected during insertion, making the assignment relative to the element's location rather than a fixed path.",
            "cascade": [
              "sGrpNm1"
            ]
          },
          {
            "trigger": "Execution on Insert",
            "effect": "The script prompts the user to select Elements (PrEntity) and spawns a new instance of the script for each Element found, linking the parameters to those specific elements.",
            "cascade": [
              "_Element"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Group",
            "description": "Creates or updates an organizational group in the model tree to contain the filtered beams. The path is defined by sGrpNm1 and sGrpNm2.",
            "appliedTo": "Project Structure Tree."
          },
          {
            "type": "Beam",
            "description": "Modifies the group assignment of existing beams. Beams matching the criteria are moved to the new group. A SubMap 'Assign' is added to the beam to track its origin ElementHandle, allowing for synchronization if the element is updated.",
            "appliedTo": "Beams within the selected Element whose BeamCode matches sBeamCodeFloor."
          }
        ]
      },
      "tokens_used": 6093,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch: User executes 'hsb_AssignBeamsToGroup'.",
          "2. Initialization: Set sequence number and load property values from the catalog if on Insert.",
          "3. Parsing: Parse the 'sBeamCodeFloor' string into an array of beam codes using ';' as delimiter.",
          "4. Insertion Check (_bOnInsert):",
          "   - Prevents re-entry if insertCycleCount > 1.",
          "   - Shows Property Dialog (_kExecuteKey check).",
          "   - Prompts user to select a set of Elements (PrEntity).",
          "5. Instance Spawning: If Elements are selected, the script creates a new child instance of itself for each selected Element, passing the current properties to the child.",
          "6. Parent Cleanup: The original 'Manager' instance erases itself from the database.",
          "7. Child Execution (Per Element):",
          "   - Retrieve the linked Element (_Element[0]).",
          "   - Determine Target Group: If 'sGrpNm1' is empty, inherit the Group Name from the selected Element.",
          "   - Validation: If both Group Name properties are empty, report error and erase child instance.",
          "   - Define Target Group object using 'sGrpNm1' and 'sGrpNm2'.",
          "   - Synchronization/Cleanup: Collect entities in the Target Group. If they have a SubMap 'Assign' linking them to the current Element, erase them.",
          "   - Beam Processing: Iterate through all beams in the Element.",
          "   - Filter: Check if the Beam's Code exists in the parsed 'sBeamCodeFloor' list.",
          "   - Assignment: If matched, add the Beam to the Target Group and tag the Beam with the Element's Handle via SubMap 'Assign'.",
          "8. Child Cleanup: The child instance erases itself."
        ],
        "conditionalBranches": [
          {
            "condition": "House Level Group Name (sGrpNm1) is empty",
            "path1": {
              "name": "Automatic Group Inheritance",
              "steps": [
                "Read the Group of the selected Element.",
                "Extract the first part of the Element's Group name.",
                "Use this extracted name as 'sGrpNm1'."
              ]
            },
            "path2": {
              "name": "Manual Group Specification",
              "steps": [
                "Use the value provided in the 'sGrpNm1' property by the user."
              ]
            }
          },
          {
            "condition": "Beam Code matches parsed list",
            "path1": {
              "name": "Assign to Group",
              "steps": [
                "Move Beam to Target Group.",
                "Add SubMap 'Assign' with ElementHandle to Beam.",
                "Set 'nErase' flag (currently unused in logic but defined)."
              ]
            },
            "path2": {
              "name": "Ignore Beam",
              "steps": [
                "Beam remains in original Element.",
                "No changes made to the Beam."
              ]
            }
          },
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "Cycle Count > 1",
              "steps": [
                "Erase Instance immediately.",
                "Stop execution."
              ]
            },
            "path2": {
              "name": "First Cycle",
              "steps": [
                "Proceed with dialog and entity selection."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Group Name availability",
            "errorMessage": "Group Name not valid to assign the beams",
            "recovery": "User must ensure at least one of the Group Name properties ('sGrpNm1' or 'sGrpNm2') contains a valid string, or the selected Element belongs to a valid group if 'sGrpNm1' is left blank."
          },
          {
            "check": "Element Selection",
            "errorMessage": "(None - Script exits silently)",
            "recovery": "User must select at least one Element when prompted via the command line."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None (Instance Self-Destructs)",
            "how": "N/A",
            "effect": "The script instance automatically erases itself after executing. To make changes, the user must re-run the script and select the elements again. The changes (Beam Group assignments) persist in the model, but the script link does not."
          }
        ]
      },
      "tokens_used": 7480,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_AssignBeamsToGroup\n\n## Overview\nThis script filters specific beams from a selected wall or floor element based on their Beam Code and moves them into a designated project group. It is typically used to organize loose materials (like sole plates or joists) into separate groups for independent scheduling and manufacturing.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in the model where the Elements are located. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | This is an organizational script for model entities. |\n\n## Prerequisites\n- **Required Entities:** At least one Element (Wall or Floor) containing beams must exist in the model.\n- **Minimum Beams:** 0.\n- **Required Settings:** None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nExecute the `TSLINSERT` command in the AutoCAD command line.\n1.  Type `TSLINSERT` and press Enter.\n2.  Browse to the location of `hsb_AssignBeamsToGroup.mcr`.\n3.  Select the file and click **Open**.\n\n### Step 2: Configure Properties\nUpon insertion, a properties dialog will appear automatically.\n1.  **Beams with beamcode to Group:** Enter the Beam Codes (e.g., `PL200;ST100`) that you want to move. Separate multiple codes with a semi-colon `;`.\n2.  **House Level group name:** Enter the main project group (e.g., `00_GF-Soleplates`). If left empty, the script will use the group of the element you select.\n3.  **Floor Level group name:** Enter the sub-group name (e.g., `GF-Loose`).\n4.  Click **OK** to confirm.\n\n### Step 3: Select Elements\nThe command line will prompt for selection.\n```\nCommand Line: \nSelect a set of elements\n```\n1.  Click on the Wall or Floor elements containing the beams you wish to reorganize.\n2.  Press **Enter** to finish selection.\n\n**Result:** The script will move the matching beams to the specified group. The script instance will then automatically remove itself from the drawing. To make changes, you must run the script again.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Beams with beamcode to Group | Text | \"\" | The list of Beam Codes to filter. Use a semi-colon `;` to separate multiple codes (e.g., `CodeA;CodeB`). |\n| House Level group name | Text | \"00_GF-Soleplates\" | The primary (root) group where the beams will be moved. If left empty, the group of the selected element is used. |\n| Floor Level group name | Text | \"GF-Loose\" | The secondary (sub) group name where the beams will be stored. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script instance erases itself immediately after execution. No right-click options are available on the script object. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Multiple Codes:** You can target several different beam types at once by separating them with a semi-colon in the *Beams with beamcode* field (e.g., `200x50;150x50`).\n- **Relative Grouping:** If you want the loose materials to stay in the same general folder as the wall they came from, leave the *House Level group name* empty. The script will automatically \"inherit\" the group from the selected element.\n- **Re-running:** Since the script deletes itself after running, do not look for it in the model to edit it. Simply insert `hsb_AssignBeamsToGroup` again to apply different rules or correct mistakes.\n- **Synchronization:** The script attempts to clean up previously assigned beams if the element is updated/processed again, ensuring duplicate links are not created.\n\n## FAQ\n- **Q: I ran the script, but I can't find it in the model to edit it.**\n  - A: This is normal behavior. The script is a \"fire and forget\" tool that erases itself after moving the beams. Re-insert the script to make changes.\n- **Q: What happens if I leave the House Level group name blank?**\n  - A: The script will look at the group of the wall or floor you selected and use that as the destination for the loose materials.\n- **Q: How do I separate multiple beam codes?**\n  - A: Use a semi-colon (`;`) without spaces (e.g., `SP200;JP100`)."
      },
      "tokens_used": 5415,
      "error": null
    }
  }
}