{
  "filename": "hsb_FloorDimension.mcr",
  "status": "completed",
  "total_tokens": 54381,
  "processing_time": 902.3636019229889,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "24.06.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "26.09.2011",
            "author": null,
            "changes": "Add option to dimension the studs on both sides"
          },
          {
            "version": "1.2",
            "date": "23.05.2012",
            "author": null,
            "changes": "Add beams types for joist and floor beam"
          },
          {
            "version": "1.3",
            "date": "08.08.2012",
            "author": null,
            "changes": "Changed primary code to use plane profile to accomodate for dimensioning trusses"
          },
          {
            "version": "1.4",
            "date": "05.04.2013",
            "author": null,
            "changes": "Add the option to dimension joist with delta or cummulative options."
          },
          {
            "version": "1.5",
            "date": "07.04.2018",
            "author": null,
            "changes": "Improve so the TSL will look only for beams in zone 0."
          },
          {
            "version": "1.7",
            "date": "07.04.2018",
            "author": null,
            "changes": "Add tolerance of 2 for ppBeams plane profile."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8944,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script prompts for Viewport selection using getViewport() on insert. Calculates ms2ps (Model to Paper Space) coordinate system transformation using vp.coordSys(). Dimensions are transformed by ms2ps before being drawn via Display dp, indicating output is intended for the 2D layout."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "GenBeam",
            "TrussEntity"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space (Layout) to select the target Viewport",
          "requiredSettings": []
        }
      },
      "tokens_used": 8219,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select the viewport from which the element is taken",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension Style",
            "defaultValue": "_DimStyles",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffsetFromEl",
            "type": "PropDouble",
            "displayName": "Offset From Element",
            "defaultValue": "U(150, 8)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dOffsetBt",
            "type": "PropDouble",
            "displayName": "Offset Between Lines",
            "defaultValue": "U(150, 8)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "strYNOverAll",
            "type": "PropString",
            "displayName": "Show OverAll Dimension",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strYNShape",
            "type": "PropString",
            "displayName": "Show OverAll Shape Dimension",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "strYNBeam",
            "type": "PropString",
            "displayName": "Show Beams Dimension",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "strBeamDimType",
            "type": "PropString",
            "displayName": "Beams Dimension Type",
            "defaultValue": "Delta",
            "inputType": "dropdown",
            "options": [
              "Delta",
              "Cumulative"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sSide",
            "type": "PropString",
            "displayName": "Joist Dimension Side",
            "defaultValue": "Left",
            "inputType": "dropdown",
            "options": [
              "Left",
              "Center",
              "Right",
              "Both"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9411,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the generation of 2D architectural dimensions for floor layouts (joists, floor beams, trusses) in Paper Space, calculating dimensions based on the selected Viewport's projection.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used during the detailing phase to quickly generate accurate center-to-center or overall dimensions for floor framing elements on a layout sheet."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "_DimStyles",
            "businessMeaning": "Selects the visual appearance (arrowheads, text size, scale) for the generated dimensions from the pre-defined list in the drawing template.",
            "validRange": "Standard AutoCAD/hsbCAD dimension styles available in the drawing.",
            "unit": "N/A",
            "affectsOutput": "Determines the visual representation of the dimension lines and text in Paper Space."
          },
          {
            "name": "dOffsetFromEl",
            "technicalDefault": "U(150, 8)",
            "businessMeaning": "The gap distance between the outer edge of the floor element outline and the first line of dimensions.",
            "validRange": "100mm - 500mm (depends on drawing scale and clutter)",
            "unit": "mm",
            "affectsOutput": "Moves the entire dimension chain closer to or further from the element boundary."
          },
          {
            "name": "dOffsetBt",
            "technicalDefault": "U(150, 8)",
            "businessMeaning": "The vertical spacing between parallel dimension lines (e.g., between overall dimensions and joist spacing dimensions).",
            "validRange": "100mm - 300mm",
            "unit": "mm",
            "affectsOutput": "Increases or decreases the stacking distance for multiple dimension layers."
          },
          {
            "name": "strYNOverAll",
            "technicalDefault": "No",
            "businessMeaning": "Toggles the display of the total width/length dimension of the floor element.",
            "validRange": "Yes/No",
            "unit": "Boolean",
            "affectsOutput": "Adds or removes the outermost dimension line indicating the overall extents of the floor."
          },
          {
            "name": "strYNShape",
            "technicalDefault": "No",
            "businessMeaning": "Toggles the display of dimensions for the internal shape or steps of the floor element (excluding individual joists).",
            "validRange": "Yes/No",
            "unit": "Boolean",
            "affectsOutput": "Adds dimensions to the vertices of the floor outline (e.g., setbacks, cutouts)."
          },
          {
            "name": "strYNBeam",
            "technicalDefault": "No",
            "businessMeaning": "Toggles the dimensioning of individual structural members (joists, floor beams, trusses).",
            "validRange": "Yes/No",
            "unit": "Boolean",
            "affectsOutput": "Adds dimension lines indicating the position of beams relative to the element edge or each other."
          },
          {
            "name": "strBeamDimType",
            "technicalDefault": "Delta",
            "businessMeaning": "Specifies how individual joists/beams are measured: 'Delta' measures center-to-center spacing, while 'Cumulative' measures the distance from the start edge.",
            "validRange": "Delta/Cumulative",
            "unit": "N/A",
            "affectsOutput": "Changes the dimension text values (e.g., 600mm vs 1200mm) and sometimes the placement of dimension ticks."
          },
          {
            "name": "sSide",
            "technicalDefault": "Left",
            "businessMeaning": "Determines which side of a beam the dimension extension line is drawn from, relative to the beam's local coordinate system (often Start/End).",
            "validRange": "Left/Center/Right/Both",
            "unit": "N/A",
            "affectsOutput": "Aligns the dimension leaders to the start, end, middle, or both sides of the beams."
          },
          {
            "name": "nColor",
            "technicalDefault": "1",
            "businessMeaning": "Sets the AutoCAD Color Index (ACI) for the dimension entities.",
            "validRange": "0 - 255 (Standard CAD colors)",
            "unit": "ACI",
            "affectsOutput": "Changes the color of the dimension lines and text for visibility or layer sorting."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "strYNBeam is set to 'No'",
            "effect": "strBeamDimType and sSide become irrelevant as no beams will be dimensioned.",
            "cascade": [
              "strBeamDimType",
              "sSide"
            ]
          },
          {
            "trigger": "strYNBeam is set to 'Yes'",
            "effect": "strBeamDimType is activated to define the calculation method, and sSide determines the leader origin.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Dimension",
            "description": "2D dimension lines, extension lines, and text representing the geometry of the floor element and its components.",
            "appliedTo": "Paper Space (Layout) via Viewport transformation."
          }
        ]
      },
      "tokens_used": 9264,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script: User executes hsb_FloorDimension.mcr.",
          "2. Initial Configuration: Dialog appears (via showDialogOnce) allowing user to set initial properties (Style, Offsets, toggles).",
          "3. Viewport Selection: Command line prompts 'Select the viewport from which the element is taken'. User clicks a viewport in Paper Space.",
          "4. Data Extraction: Script retrieves the Element linked to the Viewport and initializes Model-to-Paper Space coordinate transformations.",
          "5. Geometry Calculation: Script aggregates geometry (Joists, Floor Beams, Trusses) to generate a clean floor outline profile.",
          "6. Dimension Processing (Loop per Edge): For each edge of the floor outline:",
          "   6.1. Determine dimensioning normal vector (direction away from element).",
          "   6.2. Identify intersecting beams/studs.",
          "   6.3. Check 'Show Beams Dimension' flag: If Yes, generate joist/stud dimensions based on 'Beams Dimension Type' (Delta/Cumulative).",
          "   6.4. Check 'Show OverAll Shape Dimension' flag: If Yes, generate dimensions for edge vertices/vertices.",
          "   6.5. Check 'Show OverAll Dimension' flag: If Yes, generate total length dimension.",
          "7. Cleanup/Secondary Pass: Iterate through all beams found. Identify any beams not yet dimensioned and attempt to append them to the closest appropriate dimension line.",
          "8. Rendering: Transform all generated dimension entities to Paper Space and draw them using the specified Color and Dimension Style."
        ],
        "conditionalBranches": [
          {
            "condition": "Color Property Input",
            "path1": {
              "name": "Valid Range (0-255)",
              "steps": [
                "Value accepted.",
                "Dimensions drawn in specified color."
              ]
            },
            "path2": {
              "name": "Invalid Range (<0 or >255)",
              "steps": [
                "Script auto-corrects value to 0.",
                "Dimensions drawn in default color (0)."
              ]
            }
          },
          {
            "condition": "Viewport Selection (Insertion)",
            "path1": {
              "name": "Valid hsb Viewport",
              "steps": [
                "Viewport stored.",
                "Script proceeds to extraction."
              ]
            },
            "path2": {
              "name": "Invalid/Canceled",
              "steps": [
                "Script terminates immediately.",
                "No entities created."
              ]
            }
          },
          {
            "condition": "strYNBeam (Show Beams Dimension)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Script calculates intersections with beams.",
                "Dimensions created based on 'strBeamDimType' (Delta or Cumulative)."
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Beam intersection logic skipped.",
                "No individual joist/stud dimensions generated."
              ]
            }
          },
          {
            "condition": "strBeamDimType (Beams Dimension Type)",
            "path1": {
              "name": "Delta",
              "steps": [
                "Display Mode Middle set to Parallel.",
                "Display Mode End set to None.",
                "Shows center-to-center spacing."
              ]
            },
            "path2": {
              "name": "Cumulative",
              "steps": [
                "Display Mode Middle set to None.",
                "Display Mode End set to Parallel.",
                "Shows running distance from start."
              ]
            }
          },
          {
            "condition": "sSide (Joist Dimension Side)",
            "path1": {
              "name": "Left/Center/Right",
              "steps": [
                "Dimension extension line originates from Start, Mid, or End of beam profile."
              ]
            },
            "path2": {
              "name": "Both",
              "steps": [
                "Dimension lines generated for both sides of the beam.",
                "Effectively doubles the dimension ticks for that beam."
              ]
            }
          },
          {
            "condition": "Geometry Generation Method",
            "path1": {
              "name": "Standard Beams",
              "steps": [
                "Iterate GenBeams.",
                "Filter for types: Joist, FloorBeam, Blocking, CenterJoist."
              ]
            },
            "path2": {
              "name": "Trusses",
              "steps": [
                "Collect TrussEntities.",
                "Explode Truss Definition.",
                "Combine component bodies to find shadow profile."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Element Association",
            "errorMessage": "None (Silent exit)",
            "recovery": "User must select a viewport that contains a valid hsbCAD Element with data. Script returns null if empty."
          },
          {
            "check": "Color Index (nColor)",
            "errorMessage": "None (Auto-correct)",
            "recovery": "Script automatically resets values < 0 or > 255 to 0 within the code logic."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimension Layout",
            "how": "OPM (Object Properties Manager)",
            "effect": "Changing 'Offset From Element' or 'Offset Between Lines' moves the dimension chain closer/further from the floor outline or spaces stacked lines."
          },
          {
            "action": "Toggle Dimension Content",
            "how": "OPM Dropdowns ('Show OverAll Dimension', 'Show Beams Dimension', etc.)",
            "effect": "Instantly adds or removes specific dimension layers (e.g., turning on Overall dims adds an outer dimension line)."
          },
          {
            "action": "Change Dimension Appearance",
            "how": "OPM ('Dimension Style', 'Color')",
            "effect": "Updates the CAD style (arrows, text size) and color of the dimension entities."
          },
          {
            "action": "Adjust Joist Dimensioning Logic",
            "how": "OPM ('Beams Dimension Type', 'Joist Dimension Side')",
            "effect": "Switches measurements between center-to-center vs cumulative, or moves the dimension leader to the start/end/center of the joist."
          }
        ]
      },
      "tokens_used": 11488,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_FloorDimension.mcr\n\n## Overview\nThis script automates the generation of 2D architectural dimensions for floor layouts in Paper Space. It calculates and draws dimensions for joists, floor beams, and trusses based on the projection of a selected Viewport.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | Dimensions are created specifically for Layout views. |\n| Paper Space | Yes | Script must be run in a Layout tab containing a Viewport. |\n| Shop Drawing | No | This is a detailing tool for layout plans. |\n\n## Prerequisites\n- **Required Entities**: A Layout (Paper Space) with an active Viewport displaying a hsbCAD Floor Element.\n- **Beams**: The element must contain structural members (Joists, Floor Beams, or Trusses) to dimension.\n- **Minimum Beam Count**: 0 (Script handles empty layouts gracefully).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_FloorDimension.mcr` from the list.\n\n### Step 2: Configure Initial Settings (Optional)\nA dialog may appear allowing you to pre-configure the dimension style and offsets.\nAction: Adjust settings if necessary and click **OK**.\n\n### Step 3: Select Viewport\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click on the Viewport in Paper Space that displays the floor plan you wish to dimension.\n```\n\n### Step 4: Review Results\nThe script automatically processes the visible beams and draws dimension lines in Paper Space.\n\n### Step 5: Adjust (Optional)\nSelect the generated dimension entity and open the **Properties Palette** (Ctrl+1) to fine-tune offsets or toggle specific dimension layers (e.g., turning on Overall dimensions).\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Dimension Style | dropdown | _DimStyles | Selects the visual style (arrows, text size, scale) for dimensions. |\n| Offset From Element | number | U(150, 8) | The gap distance between the floor element outline and the first dimension line. |\n| Offset Between Lines | number | U(150, 8) | The vertical spacing between parallel dimension lines (e.g., between joists and overall dims). |\n| Show OverAll Dimension | dropdown | No | Toggles the display of the total width/length dimension of the floor. |\n| Show OverAll Shape Dimension | dropdown | No | Toggles dimensions for the internal shape or steps of the floor (vertices, setbacks). |\n| Show Beams Dimension | dropdown | No | Toggles the dimensioning of individual joists, floor beams, or trusses. |\n| Beams Dimension Type | dropdown | Delta | **Delta**: Shows center-to-center spacing. <br> **Cumulative**: Shows running distance from the start. |\n| Joist Dimension Side | dropdown | Left | Determines where the dimension extension line originates: Start, End, Center, or Both sides of the beam. |\n| Color | number | 1 | Sets the AutoCAD Color Index (ACI) for the dimension entities. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None defined* | Standard hsbCAD context options apply. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: This script relies on standard AutoCAD/hsbCAD Dimension Styles present in the drawing rather than external XML files.\n\n## Tips\n- **Layout Clarity**: If your floor plan is complex, increase the \"Offset Between Lines\" value to prevent text overlap.\n- **Truss Handling**: This script detects Trusses and calculates their shadow profile for accurate dimensioning, treating them as solid elements for the overall boundary.\n- **Delta vs. Cumulative**: Use \"Delta\" for manufacturing or spacing checks (e.g., \"600mm o.c.\") and \"Cumulative\" for installation positioning (e.g., \"600\", \"1200\", \"1800\").\n\n## FAQ\n- **Q: I selected the viewport, but no dimensions appeared.**\n  A: Ensure the Viewport is linked to a valid hsbCAD Element that contains beams (Joists, Floor Beams). If the element is empty or the script cannot find the coordinate system, it will exit silently.\n- **Q: How do I change the arrow style or text height of the dimensions?**\n  A: Do not change this in the script properties. Instead, select the desired \"Dimension Style\" in the properties palette that matches your CAD standards (e.g., \"_DimStyles\" or a custom style defined in your template).\n- **Q: The dimensions are appearing on top of my drawing.**\n  A: Increase the \"Offset From Element\" property to push the dimension chain further away from the floor outline."
      },
      "tokens_used": 7055,
      "error": null
    }
  }
}