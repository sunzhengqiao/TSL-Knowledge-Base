{
  "filename": "HSB_G-Hatching.mcr",
  "status": "completed",
  "total_tokens": 47125,
  "processing_time": 268.2685532569885,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": 2,\n    \"minorVersion\": 10,\n    \"dxaOut\": 0,\n    \"implInsert\": 0\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.00\",\n      \"date\": \"25.11.2011\",\n      \"author\": \"AS\",\n      \"changes\": \"Pilot version\"\n    },\n    {\n      \"version\": \"1.01\",\n      \"date\": \"07.12.2011\",\n      \"author\": \"AS\",\n      \"changes\": \"No hatch at text location\"\n    },\n    {\n      \"version\": \"1.02\",\n      \"date\": \"08.12.2011\",\n      \"author\": \"AS\",\n      \"changes\": \"Align hatch with beam\"\n    },\n    {\n      \"version\": \"1.03\",\n      \"date\": \"26.03.2012\",\n      \"author\": \"AS\",\n      \"changes\": \"Add filters\"\n    },\n    {\n      \"version\": \"1.04\",\n      \"date\": \"03.05.2012\",\n      \"author\": \"AS\",\n      \"changes\": \"Hatch specific beams\"\n    },\n    {\n      \"version\": \"1.05\",\n      \"date\": \"06.06.2013\",\n      \"author\": \"AS\",\n      \"changes\": \"Add options for hatching beams which are"
      },
      "tokens_used": 8325,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _Viewport variable and getViewport() command during insertion. Retrieves Element from the selected Viewport. Transforms geometry from Model Space to Paper Space using vp.coordSys(). Script summary states it 'hatches specified beams on a layout'."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Paper Space layout containing a Viewport linked to an Element.",
          "requiredSettings": [
            "HSB_G-FilterGenBeams (TSL script)"
          ]
        }
      },
      "tokens_used": 6324,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 9418,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates 2D hatching patterns on layout drawings to visually differentiate or highlight specific timber beams, such as columns or wall layers, based on filters or location.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used in production drawings (layouts) to visually separate structural elements (e.g., hatching all columns) or indicate specific wall zones (arrow/non-arrow side) for clarity on the shop floor."
        },
        "parameters": [
          {
            "name": "filterDefinition",
            "technicalDefault": "First catalog entry",
            "businessMeaning": "Selects the specific configuration of rules (defined in a separate TSL) to identify which beams should be hatched (e.g., 'Columns only', 'Beams longer than 3m').",
            "validRange": "Available catalog entries for HSB_G-FilterGenBeams",
            "unit": "String",
            "affectsOutput": "Determines the subset of beams that receive the hatch pattern when 'Hatch objects' is set to 'Result from filter'."
          },
          {
            "name": "sHatchObject",
            "technicalDefault": "\"|Result from filter|\"",
            "businessMeaning": "Defines the method of selecting beams: either using the complex rules defined in the filter, or simply selecting all beams physically located on the arrow side (front) or non-arrow side (back) of the wall element.",
            "validRange": "Result from filter, GenBeams at arrow side, GenBeams at non-arrow side",
            "unit": "Enum",
            "affectsOutput": "Changes which beams are processed. 'Arrow side' selection relies on the element's local coordinate system orientation."
          },
          {
            "name": "sHatchPattern",
            "technicalDefault": "\"HSB-|Single diagonal line|\"",
            "businessMeaning": "The visual style of the shading applied to the beams (e.g., solid fill, diagonal lines, stippling).",
            "validRange": "Standard CAD hatch patterns loaded in the drawing",
            "unit": "String",
            "affectsOutput": "Controls the visual texture of the hatching in the 2D layout."
          },
          {
            "name": "sHatchMode",
            "technicalDefault": "\"|Body|\"",
            "businessMeaning": "Specifies the part of the beam to hatch: the main timber body (excluding cutouts), the tool voids (holes/cutouts only), or the face outline.",
            "validRange": "Body, Tools, Face",
            "unit": "Enum",
            "affectsOutput": "Alters the calculated area to be hatched. 'Body' hatches the solid timber, 'Tools' hatches only the machining/void areas."
          },
          {
            "name": "sFaceType",
            "technicalDefault": "\"|Front|\"",
            "businessMeaning": "Determines which side of the beam to hatch when 'Hatch mode' is set to 'Face' (e.g., hatching only the front elevation face).",
            "validRange": "Front, Back, Both",
            "unit": "Enum",
            "affectsOutput": "Selects the specific 2D profile face to be hatched."
          },
          {
            "name": "dHatchScale",
            "technicalDefault": "1",
            "businessMeaning": "Controls the density or spacing of the hatch pattern lines.",
            "validRange": "0.1 (dense) to 5.0 (sparse)",
            "unit": "Factor",
            "affectsOutput": "Makes the hatch pattern appear larger or smaller without changing the beam geometry."
          },
          {
            "name": "nHatchColor",
            "technicalDefault": "-1",
            "businessMeaning": "Sets the color of the hatch pattern (often used to match layer colors or highlight specific elements).",
            "validRange": "0-255 (CAD Color Index) or -1 (ByLayer)",
            "unit": "Color Index",
            "affectsOutput": "Visual color of the hatching."
          },
          {
            "name": "sDimStyleName",
            "technicalDefault": "Current DimStyle",
            "businessMeaning": "The text style used for the label displaying the script name or filter status.",
            "validRange": "Available dimension styles in the drawing",
            "unit": "String",
            "affectsOutput": "Font and formatting of the text label placed in the layout."
          },
          {
            "name": "nNameColor",
            "technicalDefault": "1",
            "businessMeaning": "Color of the text label indicating the script name or active filter status.",
            "validRange": "0-255",
            "unit": "Color Index",
            "affectsOutput": "Visual visibility of the status label."
          },
          {
            "name": "dNameHeight",
            "technicalDefault": "5.0",
            "businessMeaning": "The size of the text label for the script name or status.",
            "validRange": "2.0 mm to 10.0 mm",
            "unit": "mm (Paper Space)",
            "affectsOutput": "Readability of the text label on the printed drawing."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sHatchObject = \"|Result from filter|\"",
            "effect": "The script will use the logic defined in the selected 'filterDefinition' to find beams.",
            "cascade": [
              "filterDefinition"
            ]
          },
          {
            "trigger": "sHatchMode = \"|Face|\"",
            "effect": "The 'sFaceType' parameter becomes active to determine which specific face(s) to hatch.",
            "cascade": [
              "sFaceType"
            ]
          },
          {
            "trigger": "Right-click -> Filter this element",
            "effect": "Disables hatching for this specific element instance and instead displays an 'Active filter' text label.",
            "cascade": [
              "dNameHeight",
              "nNameColor"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "2D Hatch",
            "description": "A planar geometric pattern applied to the projection of beams in the viewport.",
            "appliedTo": "GenBeams matching the filter or location criteria, displayed in Paper Space."
          },
          {
            "type": "Text Label",
            "description": "A text string showing the script name or 'Active filter' status.",
            "appliedTo": "Paper Space at the user-defined insertion point."
          }
        ]
      },
      "tokens_used": 7731,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script executed via Insert command or Recalculate",
          "System checks 'On Insert' flag (_bOnInsert)",
          "If Inserting: Prompt user to 'Select a viewport' and store reference in _Viewport",
          "Prompt user to 'Select a point' for text label location (_Pt0)",
          "Show configuration dialog (Properties Palette) to set filter, hatch pattern, mode, etc.",
          "System retrieves Viewport and associated Element",
          "System checks internal Map for 'Filter this element' status",
          "System checks 'Hatch objects' property to determine beam selection method",
          "System processes GenBeams from Element (Filtering or Coordinate check)",
          "System calculates 2D profiles based on Hatch Mode (Body, Tools, or Face)",
          "System transforms geometry from Model Space to Paper Space",
          "System generates and draws Hatch entities in Paper Space",
          "System draws Script Name or Active Filter status text at selected point"
        ],
        "conditionalBranches": [
          {
            "condition": "Check 'Filter this element' Map status",
            "path1": {
              "name": "Element Filtered",
              "steps": [
                "Draw text 'Script Name' in Red (Color 1)",
                "Draw text 'Active filter' below name",
                "Skip all hatching logic",
                "Exit script"
              ]
            },
            "path2": {
              "name": "Element Not Filtered",
              "steps": [
                "Proceed to beam selection logic",
                "Draw text 'Script Name' in Orange (Color 30)",
                "Draw text 'Active filter' (if global filter exists)",
                "Continue to generate hatching"
              ]
            }
          },
          {
            "condition": "Selection Method (sHatchObject)",
            "path1": {
              "name": "Result from filter",
              "steps": [
                "Call external script 'HSB_G-FilterGenBeams'",
                "Pass all GenBeams through filter rules",
                "Use filtered list of GenBeams for hatching"
              ]
            },
            "path2": {
              "name": "Side Selection (Arrow/Non-Arrow)",
              "steps": [
                "Iterate through all GenBeams in Element",
                "Calculate vector distance to Element Arrow/Non-Arrow side",
                "Include beam if it geometrically lies on the specified side",
                "Exclude beam if it is not on the specified side"
              ]
            }
          },
          {
            "condition": "Hatch Mode (sHatchMode)",
            "path1": {
              "name": "Body",
              "steps": [
                "Get RealBody of GenBeam",
                "Calculate shadow profile of body",
                "Hatch the solid timber projection"
              ]
            },
            "path2": {
              "name": "Tools",
              "steps": [
                "Get RealBody and EnvelopeBody",
                "Subtract RealBody from EnvelopeBody to get voids",
                "Hatch the resulting void area"
              ]
            },
            "path3": {
              "name": "Face",
              "steps": [
                "Determine face side (Front, Back, or Both)",
                "Extract contact face from EnvelopeBody",
                "Subtract RealBody face profile from EnvelopeBody profile (if Tools/Voids exist on face)",
                "Hatch the resulting face outline"
              ]
            }
          },
          {
            "condition": "Hatch Pattern Type",
            "path1": {
              "name": "HSB-Single diagonal line (Special Pattern)",
              "steps": [
                "Calculate bounding box of the beam profile",
                "Draw a line segment representing the extent of the beam",
                "Do not use standard hatch filling"
              ]
            },
            "path2": {
              "name": "Standard CAD Pattern",
              "steps": [
                "Use calculated PlaneProfile",
                "Apply standard AutoCAD hatch pattern and scale"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport validity",
            "errorMessage": "Script instance is erased automatically if _Viewport is empty.",
            "recovery": "Ensure a valid viewport is selected during insertion."
          },
          {
            "check": "Element validity (bIsValid)",
            "errorMessage": "None (Silent exit)",
            "recovery": "Select a viewport that contains a valid hsbCAD Element."
          },
          {
            "check": "External Filter Script Execution",
            "errorMessage": "Warning: 'Beams could not be filtered! Make sure that the tsl HSB_G-FilterGenBeams is loaded in the drawing.'",
            "recovery": "Load the 'HSB_G-FilterGenBeams' TSL script into the drawing or change 'Hatch objects' property to 'GenBeams at arrow side'."
          },
          {
            "check": "Beam Geometry Alignment (Vertical check)",
            "errorMessage": "None (Internal logic adjusts Coordinate System)",
            "recovery": "Script automatically corrects coordinate system alignment if standard axes are not vertical."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Hatch Settings",
            "how": "Properties Palette (OPM)",
            "effect": "Changes pattern, scale, color, mode, or selection criteria immediately upon recalculation."
          },
          {
            "action": "Filter this Element",
            "how": "Right-click context menu -> Filter this element",
            "effect": "Disables hatching for this specific layout instance and displays 'Active filter' in red."
          },
          {
            "action": "Remove Filter for this Element",
            "how": "Right-click context menu -> Remove filter for this element",
            "effect": "Re-enables hatching for this specific instance (if a global filter was previously blocking it)."
          },
          {
            "action": "Remove Filter for All Elements",
            "how": "Right-click context menu -> Remove filter for all elements",
            "effect": "Clears the internal map of filtered elements, allowing all instances to hatch normally."
          },
          {
            "action": "Move Text Label",
            "how": "Grip Edit",
            "effect": "Relocates the Script Name/Status text."
          }
        ]
      },
      "tokens_used": 8980,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-Hatching\n\n## Overview\nApplies 2D hatching patterns to specific timber beams in Paper Space layouts to visually highlight structural elements (e.g., columns) or differentiate wall layers based on filters or location.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script generates 2D output only. |\n| Paper Space | Yes | This is the primary environment for this script. |\n| Shop Drawing | Yes | Used to enhance production drawings. |\n\n## Prerequisites\n- **Required Entities:** A Layout Viewport containing a valid hsbCAD Element.\n- **Minimum Beam Count:** 0 (The element itself is the primary target).\n- **Required Settings:** The script `HSB_G-FilterGenBeams.mcr` must be loaded in the drawing if you intend to use the \"Result from filter\" selection method.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_G-Hatching.mcr`\n\n### Step 2: Select Viewport\n```\nCommand Line: Select a viewport\nAction: Click on the viewport in the layout that displays the element you wish to hatch.\n```\n\n### Step 3: Place Label\n```\nCommand Line: Select a point\nAction: Click in the Paper Space to define the location for the script name/status label.\n```\n\n### Step 4: Configure Properties\nAfter insertion, select the script instance and open the **Properties Palette** (Ctrl+1) to configure the hatching criteria, pattern, and style. Press **Esc** or click elsewhere to recalc and generate the hatch.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Filter definition | Catalog | First entry | Selects the rule set (from HSB_G-FilterGenBeams) used to identify which beams to hatch. |\n| Hatch objects | Enum | Result from filter | Determines selection method: <br>- *Result from filter*: Uses the selected filter definition.<br>- *GenBeams at arrow side*: Hatches beams on the element's arrow side.<br>- *GenBeams at non-arrow side*: Hatches beams on the opposite side. |\n| Hatch pattern | String | HSB- Single diagonal line | The visual style of the shading (e.g., ANSI31, SOLID). |\n| Hatch mode | Enum | Body | Defines what part of the beam to hatch:<br>- *Body*: The solid timber profile.<br>- *Tools*: Only the machining/void areas.<br>- *Face*: The elevation outline. |\n| Face type | Enum | Front | If Hatch mode is *Face*, selects which side to hatch (Front, Back, or Both). |\n| Hatch scale | Number | 1.0 | Adjusts the density/spacing of the hatch pattern. |\n| Hatch color | Number | -1 (ByLayer) | Sets the color of the hatch pattern (AutoCAD Color Index). |\n| DimStyle name | String | Current DimStyle | The text style used for the label. |\n| Name color | Number | 1 (Red) | Color of the script name text label. |\n| Name height | Number | 5.0 mm | Height of the text label in Paper Space. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Filter this element | Disables hatching for the current element instance and displays \"Active filter\" text in red. |\n| Remove filter for this element | Re-enables hatching for the current element instance if it was previously filtered. |\n| Remove filter for all elements | Clears the filter status for all layout instances associated with this script. |\n| Recalculate | Updates the hatching based on current geometry or property changes. |\n\n## Settings Files\n- **Dependency**: `HSB_G-FilterGenBeams.mcr`\n- **Purpose**: This external script provides the logic required when \"Hatch objects\" is set to \"Result from filter\". Ensure it is loaded in the drawing to avoid errors.\n\n## Tips\n- **Text Label Position:** You can move the script name/text label by clicking and dragging its grip point after insertion.\n- **Filtering:** If the hatching does not appear but the text does, check if \"Filter this element\" was accidentally activated via the right-click menu.\n- **Void Hatching:** Use the \"Tools\" mode in Hatch properties to graphically highlight where machining or cutouts occur within the beams.\n- **Arrow Side:** Ensure your element's local coordinate system (arrow direction) is correct before using the \"GenBeams at arrow side\" option.\n\n## FAQ\n- **Q: I see a warning \"Beams could not be filtered!\"**\n- **A: The script `HSB_G-FilterGenBeams` is not loaded. Load it using `TSLLOAD` or change the \"Hatch objects\" property to a side-based selection (e.g., \"GenBeams at arrow side\").\n\n- **Q: The hatch pattern is too dense or too sparse.**\n- **A: Adjust the \"Hatch scale\" property in the Properties Palette. Lower values make it denser; higher values make it sparser.\n\n- **Q: Can I hatch only the cutouts and holes?**\n- **A: Yes. Set \"Hatch mode\" to \"Tools\" in the Properties Palette. This will hatch only the void areas created by machining."
      },
      "tokens_used": 6347,
      "error": null
    }
  }
}