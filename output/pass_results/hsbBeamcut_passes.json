{
  "filename": "hsbBeamcut.mcr",
  "status": "completed",
  "total_tokens": 55284,
  "processing_time": 300.69165444374084,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": \"\",\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"This tsl creates a beamcut on one face of a beam.\",\n  \"versionHistory\": [\n    {\n      \"version\": \"2.6\",\n      \"date\": \"04/03/2025\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\":"
      },
      "tokens_used": 9606,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script creates Body and BeamCut objects, calculates intersections in 3D space using addMeToGenBeamsIntersect, and allows 3D point input via getPoint. No PaperSpace specific API calls like _Viewport, sd_ prefix, or #Type E declarations found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "ElementWallSF",
            "OpeningSF",
            "TslInst"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 7381,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select reference item (Beam, Walls, E-Installations or Doors)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrPoint",
              "promptOriginal": "|Pick point to specify length by points|, |<Enter> to insert full length|",
              "condition": "_bOnInsert && dLength <= 0",
              "required": false
            },
            {
              "step": 2,
              "function": "PrPoint",
              "promptOriginal": "|Insertion Point|",
              "condition": "_bOnInsert && dLength > 0",
              "required": false
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "|Specify direction|, |<Enter> to insert at center|",
              "condition": "_bOnInsert && dLength > 0",
              "required": false
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "|Pick second point|",
              "condition": "_bOnInsert && dLength <= 0",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Standard Catalog Dialog",
            "trigger": "_bOnInsert && no execute key provided",
            "title": null,
            "dataSource": "TslInst().getListOfCatalogNames(scriptName())",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dLength",
            "type": "PropDouble",
            "displayName": "|Length|",
            "defaultValue": "U(300)",
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the Length| |0 = full length| |If dependent from an installation or opening the location is fixed if length <=0|"
          },
          {
            "index": 1,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": "U(30)",
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the Width| |0 = complete|"
          },
          {
            "index": 2,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "|Depth|",
            "defaultValue": "U(30)",
            "inputType": "number",
            "options": [],
            "category": "|Geometry|",
            "description": "|Defines the Depth|"
          },
          {
            "index": 3,
            "variable": "dAxisOffset",
            "type": "PropDouble",
            "displayName": "|Offset|",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Alignment|",
            "description": "|Defines the Offset| |Use '+' or '-' to align to an edge, enter a value to specify offset from axis|"
          },
          {
            "index": 0,
            "variable": "sReferenceSide",
            "type": "PropString",
            "displayName": "|Reference Side|",
            "defaultValue": "|ECS| Y",
            "inputType": "dropdown",
            "options": [
              "|ECS| Y",
              "|ECS| Z",
              "|ECS| -Y",
              "|ECS| -Z"
            ],
            "category": "|Alignment|",
            "description": "|Defines the Reference Side| |This option is irrelevant if not linked to a beam.|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Add Beam|",
            "handler": "|Add Beam|",
            "action": "Recalculates script with add beam logic",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Remove Beam|",
            "handler": "|Remove Beam|",
            "action": "Recalculates script with remove beam logic",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 10268,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a configurable volumetric cut (notch, slot, or recess) on a specific face of a timber beam, wall, or element.",
          "category": "Machining/CAM",
          "typicalUseCase": "Creating housings for joists, clearance cuts for installations, or notches for connections within a timber element."
        },
        "parameters": [
          {
            "name": "dLength",
            "technicalDefault": "U(300)",
            "businessMeaning": "The longitudinal dimension of the cut along the primary axis of the beam (X-axis). If set to 0, it defaults to the full length of the attached element or installation.",
            "validRange": "0 to Beam Length (0 = Automatic/Full)",
            "unit": "mm",
            "affectsOutput": "Defines the length of the `BeamCut` body along the beam's axis."
          },
          {
            "name": "dWidth",
            "technicalDefault": "U(30)",
            "businessMeaning": "The lateral dimension of the cut across the face of the beam (perpendicular to length). If set to 0, the cut extends across the entire width/height of the selected face.",
            "validRange": "0 to Beam Width/Height (0 = Full Face)",
            "unit": "mm",
            "affectsOutput": "Defines the width of the `BeamCut` body on the reference plane."
          },
          {
            "name": "dDepth",
            "technicalDefault": "U(30)",
            "businessMeaning": "The depth of penetration into the timber from the reference face.",
            "validRange": "0 to Beam Depth/Thickness",
            "unit": "mm",
            "affectsOutput": "Determines how deep the `BeamCut` volume removes material into the beam."
          },
          {
            "name": "dAxisOffset",
            "technicalDefault": "U(0)",
            "businessMeaning": "Shifts the center of the cut laterally away from the beam's central axis. Special values '+' or '-' align the cut flush to the top/bottom or side edges.",
            "validRange": "Negative Beam Width/2 to Positive Beam Width/2",
            "unit": "mm",
            "affectsOutput": "Repositions the cut laterally on the beam face without changing its dimensions."
          },
          {
            "name": "sReferenceSide",
            "technicalDefault": "|ECS| Y",
            "businessMeaning": "Selects the specific face of the beam on which the cut is applied (e.g., Top, Bottom, Left, Right relative to the Element Coordinate System).",
            "validRange": "[|ECS| Y, |ECS| Z, |ECS| -Y, |ECS| -Z]",
            "unit": "enum",
            "affectsOutput": "Rotates the coordinate system of the cut to align with the selected beam face."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User moves Grip Points (_PtG)",
            "effect": "Updates Length, Width, and Axis Offset properties dynamically based on the new grip positions.",
            "cascade": [
              "dLength",
              "dWidth",
              "dAxisOffset"
            ]
          },
          {
            "trigger": "dWidth property is changed",
            "effect": "Recalculates the position of Grip Points to maintain the center position or edge alignment based on the Axis Offset.",
            "cascade": [
              "_PtG"
            ]
          },
          {
            "trigger": "_Pt0 (Center Point) property is moved",
            "effect": "Updates the Axis Offset to reflect the new center position relative to the beam axis.",
            "cascade": [
              "dAxisOffset"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "BeamCut",
            "description": "A volumetric subtraction operation that removes material from the target beam/element based on the defined length, width, depth, and position. Includes a small tolerance (HSB-23612) if the cut face aligns exactly with the beam face to ensure valid geometry.",
            "appliedTo": "Selected GenBeam, ElementWallSF, or parent element of selected Openings/Installations."
          }
        ]
      },
      "tokens_used": 9975,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Execution: User launches hsbBeamcut.mcr.\",\n    \"2. Initialization: Check for Execute Key (_kExecuteKey). If present, load catalog values; otherwise, show properties dialog.\",\n    \"3. Entity Selection: Prompt user to select reference item (GenBeam, ElementWallSF, OpeningSF, or TslInst).\",\n    \"4. Entity Classification: Iterate through selection to determine primary entity type (Beam/Wall vs. Opening/Installation).\",\n    \"5. Coordinate System Setup: Establish local coordinate system (ptCen, vecX/Y/Z) based on the selected entity type.\",\n    \"6. Conditional Point Input (if bGetPoint is true):\",\n    \"   - Prompt 1: Get insertion point or start point for length.\",\n    \"   - Prompt 2: Get direction (if length > 0) or second point (if length <= 0).\",\n    \"7. Dimension Calculation: Calculate length, width, depth, and offset based on property inputs or picked points.\",\n    \"8. Modification Handling: If triggered by Grip change or Property change, update internal variables (dLength, dWidth, dAxisOffset) and reposition grips.\",\n    \"9. Tolerance Check (HSB-23612): Analyze if beamcut faces align exactly with GenBeam faces. If so, add extra tolerance (U(1)).\",\n    \"10. Geometry Creation: Generate BeamCut body using calculated dimensions and reference point.\",\n    \"11. Application: Perform boolean subtraction (addMeToGenBeamsIntersect) on linked GenBeams.\",\n    \"12. Visualization: Draw reference lines and coordinate axes.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Selected Entity Type\",\n      \"path1\": {\n        \"name\": \"GenBeam or ElementWallSF\",\n        \"steps\": [\n          \"Set bGetPoint = true.\",\n          \"Extract coordinate system directly from the beam/wall element.\",\n          \"Force single entity selection (break loop after first valid find).\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"OpeningSF or TslInst\",\n        \"steps\": [\n          \"Check specific conditions (e.g., Opening count > 0, TslInst map validity).\",\n          \"If (Single Opening AND dLength > 0), set bGetPoint = true and derive coords from opening.\",\n          \"If (Installations), set bGetPoint = false and derive coords from 'ptsConduitExtremes' map.\",\n          \"If (Length <= 0), location is fixed to the entity location.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"dLength Value during Insertion\",\n      \"path1\": {\n        \"name\": \"Fixed Length (dLength > 0)\",\n        \"steps\": [\n          \"Prompt: 'Insertion Point'.\",\n          \"Prompt: 'Specify direction' (allows Enter to center).\",\n          \"Use defined dLength property.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Dynamic Length (dLength <= 0)\",\n        \"steps\": [\n          \"Prompt: 'Pick point to specify length by points'.\",\n          \"Prompt: 'Pick second point'.\",\n          \"Calculate dLength as the distance between the two picked points.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Modification Trigger Source\",\n      \"path1\": {\n        \"name\": \"Grip Edit (_PtG changed)\",\n        \"steps\": [\n          \"Calculate new dimensions from grip positions.\",\n          \"Update dLength, dWidth, dAxisOffset properties.\",\n          \"Re-run execution loop (setExecutionLoops(2)).\"\n"
      },
      "tokens_used": 11901,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbBeamcut.mcr\n\n## Overview\nThis script creates a configurable volumetric cut (such as a notch, slot, or recess) on a specific face of a timber beam, wall, or element. It allows for precise material removal using either fixed property dimensions or dynamic on-screen point input.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script creates 3D geometry and modifies beam bodies. |\n| Paper Space | No | Not intended for 2D drawing generation. |\n| Shop Drawing | No | This is a modeling/CAM script. |\n\n## Prerequisites\n- **Required entities**: GenBeam, ElementWallSF, OpeningSF, or TslInst (Electrical Installations/Doors).\n- **Minimum beam count**: 0 (Can be attached to walls or installations).\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT` â†’ Select `hsbBeamcut.mcr` from the list.\n\n### Step 2: Select Reference Item\n```\nCommand Line: Select reference item (Beam, Walls, E-Installations or Doors)\nAction: Click on the beam, wall, or installation object where you want to apply the cut.\n```\n\n### Step 3: Define Dimensions and Position\n*The prompts depend on the **Length** property setting (default is 300mm).*\n\n**Scenario A: If Length is set to a specific value (> 0)**\n```\nCommand Line: Insertion Point\nAction: Click on the face of the beam to place the center of the cut.\n\nCommand Line: Specify direction <Enter> to insert at center\nAction: Move your mouse to rotate the cut, then click to set direction, or press Enter to align it to the center axis.\n```\n\n**Scenario B: If Length is set to 0 or dynamic**\n```\nCommand Line: Pick point to specify length by points, <Enter> to insert full length\nAction: Click the start point for the cut on the beam face.\n\nCommand Line: Pick second point\nAction: Click the end point to define the exact length visually.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Length** | Number | 300 mm | Defines the longitudinal size of the cut along the beam axis. Set to `0` to cut the full length of the beam or installation. |\n| **Width** | Number | 30 mm | Defines the lateral size across the beam face. Set to `0` to cut the complete width/height of the face. |\n| **Depth** | Number | 30 mm | Defines how deep the cut penetrates into the material from the reference face. |\n| **Offset** | Number | 0 mm | Shifts the cut laterally from the beam's center axis. Enter `+` or `-` to quickly align the cut flush to the top/bottom or side edges. |\n| **Reference Side** | Dropdown | ECS Y | Selects which face of the beam the cut is applied to relative to the Element Coordinate System (Options: ECS Y, ECS Z, ECS -Y, ECS -Z). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Add Beam** | Recalculates the script and adds the selected beam to the list of elements affected by this cut. |\n| **Remove Beam** | Recalculates the script and removes the selected beam from the list of affected elements. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on standard Properties and Catalog inputs; no external settings file is required.\n\n## Tips\n- **Quick Alignment**: Instead of calculating the exact offset distance, type `+` or `-` in the Offset field to instantly align the cut to the outer edges of the beam.\n- **Full Face Cuts**: Setting Width or Length to `0` is useful for creating dado slots that span the entire available dimension of the material.\n- **Graphical Editing**: After insertion, you can select the cut in the model and drag the blue **Grip Points** to visually adjust the Length, Width, and Offset without opening the Properties panel.\n\n## FAQ\n- **Q: Why is my cut not going through the entire beam?**\n  **A**: Ensure the **Width** or **Length** properties are set to `0`, or check that the **Depth** is sufficient to penetrate the material thickness.\n- **Q: Can I use this to cut a hole for a pipe?**\n  **A**: This script creates a rectangular cut (notch/slot). For circular holes, you would need a different script (e.g., `hsbCylinder`).\n- **Q: How do I flip the cut to the other side of the beam?**\n  **A**: Change the **Reference Side** property in the dropdown menu (e.g., from \"ECS Y\" to \"ECS -Y\")."
      },
      "tokens_used": 6153,
      "error": null
    }
  }
}