{
  "filename": "Rothoblaas XYLOFON.mcr",
  "status": "completed",
  "total_tokens": 47739,
  "processing_time": 275.5819034576416,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 1,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "20oct17",
            "author": "florian.wuermseer@hsbcad.com",
            "changes": "Bugfix edge stretching during insert, option for 100mm stripes (reference, opposite and centered position) added"
          },
          {
            "version": "1.0",
            "date": "22sept17",
            "author": "florian.wuermseer@hsbcad.com",
            "changes": "initial version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8988,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses 'tslNew.dbCreate(..., _kModelSpace, ...)' to create instances. It manipulates 3D geometry (Sip bodies, PLine, PlaneProfile) and uses GenBeam/Sip entities without #Type E definitions or sd_ drawing functions."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 7399,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select Panel(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrPoint",
              "promptOriginal": "|Select point(s) on edges that get the XYLOFON absorber|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDialog",
            "trigger": "During Insert",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sArticle",
            "type": "PropString",
            "displayName": "|Type|",
            "defaultValue": "XYLOFON 35",
            "inputType": "dropdown",
            "options": [
              "XYLOFON 35",
              "XYLOFON 50",
              "XYLOFON 70",
              "XYLOFON 80",
              "XYLOFON 90"
            ],
            "category": null,
            "description": "|Defines the XYLOFON type (the hardness))|"
          },
          {
            "index": 1,
            "variable": "sPosition",
            "type": "PropString",
            "displayName": "|Absorber Position|",
            "defaultValue": "100mm reference face",
            "inputType": "dropdown",
            "options": [
              "100mm reference face",
              "100mm opposite face",
              "100mm centered",
              "full width"
            ],
            "category": null,
            "description": "|Defines the Position and width of the XYLOFON absorber|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Add|",
            "handler": "|Add|",
            "action": "Recalculates hardware and stretches edges",
            "alsoTriggeredBy": "Double-click"
          },
          {
            "menuItem": "|Subtract|",
            "handler": "|Subtract|",
            "action": "Recalculates hardware and stretches edges",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7346,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts Rothoblaas XYLOFON noise absorbers onto panel edges and through-cuts to dampen vibration and sound transmission.",
          "category": "Hardware",
          "typicalUseCase": "Used in timber construction buildings (especially CLT or panel structures) to reduce noise transmission between floors or walls by applying polyurethane strips to exposed edges."
        },
        "parameters": [
          {
            "name": "sArticle",
            "technicalDefault": "XYLOFON 35",
            "businessMeaning": "Specifies the type (hardness/density) of the XYLOFON noise absorber profile. Higher numbers generally indicate different hardness or density properties required for specific acoustic loads.",
            "validRange": "XYLOFON 35, XYLOFON 50, XYLOFON 70, XYLOFON 80, XYLOFON 90",
            "unit": "Catalog Entry",
            "affectsOutput": "Determines the Article Number (for BOM/Hardware list), the Color of the 3D representation, and the material properties implied. It indirectly affects the physical compression characteristics (though the geometry remains 10mm thick)."
          },
          {
            "name": "sPosition",
            "technicalDefault": "100mm reference face",
            "businessMeaning": "Defines where the absorber is placed on the panel edge thickness (width) and how deep it cuts into or covers the panel. It controls whether the absorber is a 100mm strip on the top, bottom, middle, or covers the full panel height.",
            "validRange": "100mm reference face, 100mm opposite face, 100mm centered, full width",
            "unit": "Positioning Mode",
            "affectsOutput": "Controls the geometry of the cut/representation. If '100mm...', it creates a 100mm wide strip. If 'full width', it covers the entire solid height. It also triggers the switch between 'Small Sizes' and 'Big Sizes' article numbers in the BOM. It determines where the panel edge is stretched (if applicable)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User changes 'sArticle' (Type)",
            "effect": "Updates the internal hardware Article Number and Color code.",
            "cascade": [
              "nArticle"
            ]
          },
          {
            "trigger": "User changes 'sPosition' to 'full width' (options index > 2)",
            "effect": "Switches the Article Number lookup table from 'Small Sizes' to 'Big Sizes' and calculates the absorber width based on the total panel height instead of a fixed 100mm.",
            "cascade": [
              "sArticleNumbers",
              "dWidth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "BodyRepresentation",
            "description": "A 3D visual representation of the polyurethane strip. It is calculated by intersecting a strip body with the panel geometry, respecting corner intersections (convex/concave) and through-cuts.",
            "appliedTo": "The selected Sip (Structural Insulated Panel) or CLT Panel."
          },
          {
            "type": "Stretch",
            "description": "Modifies the panel's geometry by stretching the edge outward by the thickness of the absorber (10mm) to accommodate the material.",
            "appliedTo": "Edges of the selected Sip where the absorber is placed (excluding edges resulting from beamcuts)."
          },
          {
            "type": "BeamCut",
            "description": "Adds a machining operation to cut the panel volume where the absorber sits, specifically for edges created by beam cuts (e.g., openings).",
            "appliedTo": "The selected Sip (specifically at beam cut edges)."
          },
          {
            "type": "HardWrComp",
            "description": "Generates a hardware entry in the BOM/list, reporting the total length and width of absorber used. Selects the correct Rothoblaas article number based on type and position.",
            "appliedTo": "The script instance (aggregated total)."
          }
        ]
      },
      "tokens_used": 8175,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launch: Verify insert cycle count; if >1, erase instance and exit",
          "Check _bOnInsert flag",
          "Show OPM properties dialog to user",
          "Prompt for Panel selection (Entity Sip)",
          "Prompt for Point selection on edges (multiple points allowed)",
          "Prepare TSL instance data (script name, vectors, selected entities, points, properties, and map)",
          "Loop through selected panels: Create new script instance in ModelSpace using 'dbCreate' for each panel with the selected points",
          "Erase the temporary insert instance",
          "Instance Initialization: Validate attached Sip entity",
          "Property Resolution: Determine Article Number (Small vs Big sizes) and Color based on 'sPosition' and 'sArticle'",
          "Geometry Analysis: Extract Sip Coordinate System, Outline Edges, and BeamCut Edges",
          "Edge Filtering: Identify edges near pre-selected points; store relevant vectors and types (Outline vs Opening)",
          "Loop through filtered edges to generate absorbers",
          "Corner Logic: Check distance to neighbor edges to determine intersections (convex/concave) and modify endpoints",
          "Body Creation: Create Body for absorber strip, intersect with panel plane, and apply cuts at corners",
          "Modification: Apply Stretch to outline edges or BeamCut to opening edges based on edge type",
          "Hardware Generation: Calculate total length/width, create HardWrComp, and set color/hyperlink",
          "Visualization: Draw 3D representation in CAD"
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count",
            "path1": {
              "name": "Cycle > 1",
              "steps": [
                "Erase Instance",
                "Return (Exit)"
              ]
            },
            "path2": {
              "name": "Cycle == 1",
              "steps": [
                "Execute standard input prompts and logic"
              ]
            }
          },
          {
            "condition": "Panel Validity (Sip)",
            "path1": {
              "name": "Invalid Sip",
              "steps": [
                "Report Error: 'No valid panel selected'",
                "Erase Instance",
                "Return"
              ]
            },
            "path2": {
              "name": "Valid Sip",
              "steps": [
                "Proceed to Geometry Analysis"
              ]
            }
          },
          {
            "condition": "Absorber Position (sPosition)",
            "path1": {
              "name": "100mm Strips (Index 0-2)",
              "steps": [
                "Use 'Small Sizes' Article Numbers (D82411...)",
                "Set Absorber Width to 100mm",
                "Position Reference Plane at Reference/Opposite/Center based on specific index"
              ]
            },
            "path2": {
              "name": "Full Width (Index > 2)",
              "steps": [
                "Use 'Big Sizes' Article Numbers (D82421...)",
                "Set Absorber Width to Panel Solid Height (or max width)",
                "Position Reference Plane accordingly"
              ]
            }
          },
          {
            "condition": "Edge Processing Type",
            "path1": {
              "name": "Outline Edge (Type != 2)",
              "steps": [
                "Calculate Stretch Plane (offset by 10mm thickness)",
                "Execute 'sip.stretchEdgeTo()'"
              ]
            },
            "path2": {
              "name": "BeamCut Edge (Type == 2)",
              "steps": [
                "Calculate BeamCut geometry and orientation",
                "Execute 'sip.addTool()' with BeamCut"
              ]
            }
          },
          {
            "condition": "Corner Geometry (Convexity)",
            "path1": {
              "name": "Convex Corner",
              "steps": [
                "Modify start/end points to intersect neighbor planes",
                "Apply Cut to remove/miter the overlap material"
              ]
            },
            "path2": {
              "name": "Concave Corner",
              "steps": [
                "Modify start/end points to intersect neighbor planes",
                "Ensure material fills the internal gap"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Sip Entity Validity",
            "errorMessage": "|No valid panel selected|   -->   |Tool will be deleted|",
            "recovery": "User must select a valid Structural Insulated Panel (Sip) entity."
          },
          {
            "check": "Panel Outline Vertices",
            "errorMessage": "|Panel's' outline vertices weren't properly detected|   -->   |Tool will be deleted|",
            "recovery": "Check the geometry of the selected panel for corruption or zero-length edges."
          },
          {
            "check": "Panel Outline Detection",
            "errorMessage": "|Panel outline not properly detected|   -->   |Tool will be deleted|",
            "recovery": "Ensure the panel has a valid, closed outer contour."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Type (Hardness)",
            "how": "OPM Properties Palette (Property: 'Type')",
            "effect": "Updates Article Number (D824xx) and Color. Recalculates Hardware list."
          },
          {
            "action": "Modify Position/Width",
            "how": "OPM Properties Palette (Property: 'Absorber Position')",
            "effect": "Switches between 100mm strip modes (Ref/Opp/Ctr) and Full Width mode. Updates Article Number series (Small vs Big) and geometry. Recalculates Hardware."
          },
          {
            "action": "Add / Update Absorber",
            "how": "Context Menu ('Add') OR Double-Click",
            "effect": "Triggers recalculation. Executes edge stretching or beamcut application again to ensure consistency with current properties."
          },
          {
            "action": "Subtract Absorber",
            "how": "Context Menu ('Subtract')",
            "effect": "Triggers recalculation. Intended to remove the absorber effect (logic handles 'Subtract' key)."
          }
        ]
      },
      "tokens_used": 9846,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Rothoblaas XYLOFON.mcr\n\n## Overview\nThis script inserts Rothoblaas XYLOFON noise absorbers onto panel edges and through-cuts. It is designed to dampen vibration and sound transmission in timber construction projects by applying polyurethane strips to Structural Insulated Panels (SIPs).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script creates 3D geometry and modifies panels in the model. |\n| Paper Space | No | Not applicable for 2D drawing layouts. |\n| Shop Drawing | No | This is a model detailing script. |\n\n## Prerequisites\n- **Required entities**: Sip (Structural Insulated Panel).\n- **Minimum beam count**: 1 Panel.\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Rothoblaas XYLOFON.mcr`\n\n### Step 2: Select Panel\n```\nCommand Line: Select Panel(s)\nAction: Click on the panel(s) where the absorber will be applied. Press Enter to confirm selection.\n```\n\n### Step 3: Select Edges\n```\nCommand Line: Select point(s) on edges that get the XYLOFON absorber\nAction: Click on the specific edges of the selected panel(s) where the noise absorber strip should be placed. You can select multiple points. Press Enter to finish.\n```\n\n### Step 4: Configure Properties\nAfter insertion, select the script instance and open the **Properties Palette** (OPM) to adjust the Type and Position as needed.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | dropdown | XYLOFON 35 | Defines the XYLOFON type (hardness/density). Options include XYLOFON 35, 50, 70, 80, and 90. |\n| Absorber Position | dropdown | 100mm reference face | Defines the position and width of the absorber. Options: 100mm reference face, 100mm opposite face, 100mm centered, or full width. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add | Recalculates hardware and stretches edges. This updates the absorber geometry to match current properties or panel changes. |\n| Subtract | Recalculates hardware and stretches edges. Used to modify or remove the absorber effect. |\n\n## Settings Files\nNone\n\n## Tips\n- **Double-Click Shortcut**: You can double-click the script instance in the model to trigger the \"Add\" command, which refreshes the geometry and hardware list.\n- **Full Width Option**: Selecting \"full width\" in the Absorber Position property will cover the entire panel height and automatically switch the article numbering to \"Big Sizes\".\n- **Openings**: The script automatically detects and handles edges around beam cuts (openings), ensuring the absorber fits correctly around windows or doors.\n- **Multiple Edges**: During insertion, you can click on multiple edges across the selected panels to apply the absorber to several sides simultaneously.\n\n## FAQ\n- **Q: What happens if my panel geometry changes?**\n- **A:** Use the \"Add\" command (or double-click the instance) to recalculate the absorber dimensions and positions to fit the new panel geometry.\n\n- **Q: Can I use this on regular beams?**\n- **A:** No, this script is specifically designed for Sip (Structural Insulated Panel) entities.\n\n- **Q: How does the script handle corners?**\n- **A:** The script automatically calculates intersections for both convex and concave corners, mitering the absorber material appropriately.\n\n- **Q: Where does the length information appear?**\n- **A:** The script generates a hardware component (HardWrComp) that lists the total length and article number in your BOM/Material list."
      },
      "tokens_used": 5985,
      "error": null
    }
  }
}