{
  "filename": "hsbCLT-CNC-Drill.mcr",
  "status": "completed",
  "total_tokens": 48051,
  "processing_time": 297.0303285121918,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "17Apr2018",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "translation issue fixed"
          },
          {
            "version": "1.0",
            "date": "23Oct2017",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8398,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses `tslNew.dbCreate(..., _kModelSpace, ...)` explicitly for creating instances and interacts with `MasterPanel` entities (3D objects). It does not check for `_Viewport`, use `sd_*` prefixes, or interact with 2D drawing generation."
        },
        "prerequisites": {
          "requiredEntities": [
            "MasterPanel"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D Model)",
          "requiredSettings": []
        }
      },
      "tokens_used": 4900,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": null,\n        \"condition\": \"_bOnInsert && !executeKey\",\n        \"required\": false\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getMasterPanel\",\n        \"promptOriginal\": \"Select MasterPanel\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Select polyline(s) and/or circle(s) <Enter> to pick points\",\n        \"condition\": \"_bOnInsert && (dDiameter<=0 || nDistributionMode!=0)\",\n        \"required\": false\n      },\n      {\n        \"step\": 4,\n        \"function\": \"getDouble\",\n        \"promptOriginal\": \"Enter diameter\",\n        \"condition\": \"_bOnInsert && dDiameter<=0 && _Entity.length() < 2\",\n        \"required\": true\n      },\n      {\n        \"step\": 5,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"Select start point\",\n        \"condition\": \"_bOnInsert && dDiameter>0 && dInterdistance>0 && nDistributionMode>0 && _Entity.length() < 2\",\n        \"required\": true\n      },\n      {\n        \"step\": 6,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"Pick point\",\n        \"condition\": \"_bOnInsert && !(dInterdistance>0 && nDistributionMode>0) && _Entity.length() < 2\",\n        \"required\": true\n      },\n      {\n        \"step\": 7,\n        \"function\": \"PrPoint\",\n        \"promptOriginal\": \"Select next point\",\n        \"condition\": \"while(1) loop inside _bOnInsert\",\n        \"required\": false\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"showDialog\",\n      \"trigger\": \"On Insert (unless catalog key is used)\",\n      \"title\": \"Properties\",\n      \"dataSource\": \"OPM Properties defined in script\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"dDiameter\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"(A) Diameter\",\n      \"defaultValue\": \"10\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry\",\n      \"description\": \"Defines the Diameter of the drill(s) 0 = select circles\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dDepth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"(B) Depth\",\n      \"defaultValue\": \"10\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry\",\n      \"description\": \"Defines the Depth 0 = complete through\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"nToolindex\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"(C) Toolindex\",\n      \"defaultValue\": \"0\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry\",\n      \"description\": \"Defines the Toolindex\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"sFace\",\n      \"type\": \"PropString\",\n      \"displayName\": \"(D) Alignment\",\n      \"defaultValue\": \"Top\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Top\",\n        \"Bottom\"\n      ],\n      \"category\": \"Alignment\",\n      \"description\": \"Defines the Face\"\n    },\n   "
      },
      "tokens_used": 9283,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates CNC drilling operations (holes) on MasterPanel elements, typically for CLT panels, using fixed diameters or selected geometry, with options for single holes or patterned distributions.",
          "category": "Machining / CAM",
          "typicalUseCase": "Adding ventilation holes, routing holes for cabling, or bolt holes through structural timber panels where the location and spacing need to be defined relative to the panel geometry."
        },
        "parameters": [
          {
            "name": "dDiameter",
            "technicalDefault": "10",
            "businessMeaning": "The diameter of the drill bit/hole. If set to 0, the script requires the user to select circles in the CAD model to determine the diameter for each specific hole.",
            "validRange": "> 0 (Standard drill bit sizes); 0 (to select circles dynamically)",
            "unit": "mm",
            "affectsOutput": "Defines the physical width of the hole in the panel."
          },
          {
            "name": "dDepth",
            "technicalDefault": "10",
            "businessMeaning": "The depth of the hole penetration. A value of 0 indicates a 'through' operation (drilling completely through the panel thickness).",
            "validRange": "0 (Through hole) to Panel Thickness (Blind hole)",
            "unit": "mm",
            "affectsOutput": "Determines if the hole goes all the way through the panel or stops at a specific depth (blind hole)."
          },
          {
            "name": "nToolindex",
            "technicalDefault": "0",
            "businessMeaning": "The identifier for the specific CNC tool to be used in the machine library. This ensures the machine uses the correct drill bit for the operation.",
            "validRange": "Positive Integers (Machine tool IDs)",
            "unit": "count",
            "affectsOutput": "Controls the tool selection code in the CNC output files (e.g., BTL)."
          },
          {
            "name": "sFace",
            "technicalDefault": "Top",
            "businessMeaning": "Specifies which side of the panel the drilling operation originates from.",
            "validRange": "Top, Bottom",
            "unit": "N/A",
            "affectsOutput": "Determines the approach direction of the drill and the visual orientation of the tool."
          },
          {
            "name": "dInterdistance",
            "technicalDefault": "0",
            "businessMeaning": "The spacing between drill holes when creating a pattern or row of holes.",
            "validRange": "> 0 (Pattern mode); 0 (Single point mode)",
            "unit": "mm",
            "affectsOutput": "Calculates the positions of intermediate drill points based on the selected distribution mode."
          },
          {
            "name": "sDistributionMode",
            "technicalDefault": "Disabled",
            "businessMeaning": "Defines the logic used to space multiple drill holes along a path or line.",
            "validRange": "Disabled, Even Distribution, Fixed Distribution",
            "unit": "N/A",
            "affectsOutput": "Controls whether holes are placed only at picked points, distributed evenly along a path, or placed at fixed intervals from a start point."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sDistributionMode changes to 'Disabled'",
            "effect": "Disables spacing functionality.",
            "cascade": [
              "dInterdistance"
            ]
          },
          {
            "trigger": "User selects a Circle entity during insertion",
            "effect": "Reads geometry from the circle and locks parameters.",
            "cascade": [
              "dDiameter",
              "dInterdistance",
              "sDistributionMode"
            ]
          },
          {
            "trigger": "User selects a Polyline entity during insertion",
            "effect": "Reads path from polyline, creates holes at vertices unless distribution is active.",
            "cascade": [
              "dInterdistance",
              "sDistributionMode"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "ElemDrill",
            "description": "A CNC drilling operation (hole) added to the panel's machining list.",
            "appliedTo": "MasterPanel (Structural Panel/CLT)"
          }
        ]
      },
      "tokens_used": 8478,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched/Inserted",
          "Properties Dialog displayed (unless loaded from Catalog)",
          "User selects MasterPanel entity",
          "Conditional Check: Is Diameter=0 OR is Distribution Mode active?",
          "If YES: Prompt user to select Polylines/Circles",
          "Conditional Check: Did user select Geometry Entities?",
          "Path A (Geometry Selected): Loop through selected entities -> Create new TSL instance for each valid entity -> Erase caller script -> End Insertion",
          "Path B (No Geometry Selected): Enter Point Picking Mode",
          "Path B: Validate Diameter (prompt user if <=0)",
          "Conditional Check: Is Distribution Mode active (Interdistance > 0)?",
          "Path B1 (Single Mode): Get Point -> Create separate TSL instance immediately -> Repeat for subsequent points -> Erase caller script -> End Insertion",
          "Path B2 (Distribution Mode): Get Start Point -> Loop to collect subsequent points -> Visualize path (jig) -> Store all points in caller instance -> End Insertion",
          "Post-Insertion: Script recalculates geometry based on dependencies",
          "Post-Insertion: Generate Drill tools at calculated coordinates",
          "Post-Insertion: Update visualization"
        ],
        "conditionalBranches": [
          {
            "condition": "User input method during insertion (Geometry vs Points)",
            "path1": {
              "name": "Entity Selection Mode",
              "steps": [
                "User selects Polylines/Circles",
                "Script validates geometry (planar, parallel to Z)",
                "Script creates a dedicated TSL instance for each selected entity",
                "Original 'caller' script is erased"
              ]
            },
            "path2": {
              "name": "Point Picking Mode",
              "steps": [
                "User enters or confirms Diameter",
                "User picks points in model space",
                "If Single Mode: Instances created dynamically per click",
                "If Distribution Mode: Points collected to define a path pattern controlled by one instance"
              ]
            }
          },
          {
            "condition": "Distribution Logic during Recalculation",
            "path1": {
              "name": "Patterned Distribution",
              "steps": [
                "Check if Interdistance > 0 and Path exists",
                "Calculate total path length",
                "Calculate offset based on 'Even' or 'Fixed' mode",
                "Generate drill points along the path at calculated intervals"
              ]
            },
            "path2": {
              "name": "Explicit / Vertex Placement",
              "steps": [
                "Interdistance is 0 or Mode is Disabled",
                "Use vertices of the selected Polyline as drill locations",
                "OR use the single Grip Point (_Pt0) if no path defined"
              ]
            }
          },
          {
            "condition": "Geometry Source Definition",
            "path1": {
              "name": "Dependent on Entity",
              "steps": [
                "Reads geometry from linked Polyline/Circle entity",
                "Updates drill positions if source geometry changes",
                "Enables 'Release Dependency' trigger"
              ]
            },
            "path2": {
              "name": "Independent (Grip Points)",
              "steps": [
                "Uses internal Grip Points (_PtG)",
                "User can drag grips to resize/move the drilling pattern",
                "No external entity dependency"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Diameter input validation",
            "errorMessage": "invalid diameter Tool will be deleted.",
            "recovery": "User must enter a positive diameter value. Script erases itself if invalid."
          },
          {
            "check": "MasterPanel selection",
            "errorMessage": "Implicit failure (script waits or requires selection)",
            "recovery": "User must select a valid MasterPanel entity to proceed."
          },
          {
            "check": "Geometry validity (Parallel to Z)",
            "errorMessage": "None reported to user, but entity is skipped",
            "recovery": "Ensure selected Polylines/Circles are parallel to the construction plane (Z-axis)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Flip Face",
            "how": "Right-click Context Menu",
            "effect": "Inverts the drilling direction (Top <-> Bottom) and updates the visual color of the script instance."
          },
          {
            "action": "Release Dependency",
            "how": "Right-click Context Menu (Only available if geometry entities are linked)",
            "effect": "Breaks the link to the selected Polyline/Circle. Converts the pattern into independent Grip Points (or explodes into multiple instances if it was a single-point dependency)."
          },
          {
            "action": "Modify Parameters",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Diameter, Depth, Toolindex, Interdistance, and Distribution Mode can be changed. Changing Interdistance/Mode triggers recalculation of hole positions."
          },
          {
            "action": "Grip Edit",
            "how": "Click and drag grips in CAD model",
            "effect": "Moves the drill hole or deforms the distribution path. The tool updates immediately upon drag release."
          }
        ]
      },
      "tokens_used": 10333,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-CNC-Drill.mcr\n\n## Overview\nThis script creates CNC drilling operations (holes) on MasterPanel elements, such as CLT panels. It supports single-point drilling, patterned drilling along a path, or defining holes based on existing selected geometry (circles/polylines).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required. The script interacts with 3D panel geometry. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | This is a 3D model tool for manufacturing data. |\n\n## Prerequisites\n- **Required Entities:** A single MasterPanel (CLT or structural timber panel).\n- **Minimum Beam Count:** N/A (Requires a MasterPanel, not a beam).\n- **Required Settings:** None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Browse and select `hsbCLT-CNC-Drill.mcr`.\n\n### Step 2: Configure Initial Properties\nA dialog box appears upon insertion.\n- **Action:** Set initial parameters like **Diameter**, **Depth**, or **Toolindex** if known. Click OK to proceed.\n\n### Step 3: Select Target Panel\n```\nCommand Line: Select MasterPanel\nAction: Click on the CLT panel or MasterPanel you wish to machine.\n```\n\n### Step 4: Choose Input Method\n```\nCommand Line: Select polyline(s) and/or circle(s) <Enter> to pick points\nAction: You have two choices here:\n```\n- **Option A (Use Geometry):** Select existing circles or polylines in the drawing that represent the hole locations or path, then press Enter. The script will automatically create holes based on these entities.\n- **Option B (Manual Input):** Press Enter without selecting anything to define points manually.\n\n### Step 5: Define Drill Locations\n*The prompts here depend on your Property settings:*\n\n**If Diameter is 0:**\n```\nCommand Line: Enter diameter\nAction: Type the drill hole diameter (e.g., 12) and press Enter.\n```\n\n**If Distributing Holes (Interdistance > 0):**\n```\nCommand Line: Select start point\nCommand Line: Select next point\nAction: Click points to define the path/line. The script will fill in holes between points based on your spacing settings.\n```\n\n**If Placing Single Holes (Interdistance = 0):**\n```\nCommand Line: Pick point\nAction: Click the location for the hole. The script creates the instance and immediately asks for the next point.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| (A) Diameter | Number | 10 | Defines the drill diameter. Set to `0` to detect diameter from selected circles. |\n| (B) Depth | Number | 10 | Defines how deep the hole goes. Set to `0` for a through-hole (complete penetration). |\n| (C) Toolindex | Number | 0 | The CNC tool ID number from your machine library. |\n| (D) Alignment | Dropdown | Top | Specifies the drilling side: **Top** or **Bottom**. |\n| Interdistance | Number | 0 | The spacing between holes when creating a row/pattern. `0` means single-point mode. |\n| Distribution Mode | Dropdown | Disabled | Logic for spacing: **Disabled**, **Even Distribution** (between endpoints), or **Fixed Distribution**. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip Face | Inverts the drilling direction. Swaps the operation between the Top and Bottom faces of the panel. |\n| Release Dependency | Breaks the link to the original Polyline/Circle used to create the drill. This allows you to edit the drill position independently using grip points. |\n| Recalculate | Refreshes the script geometry if parameters were changed manually. |\n\n## Settings Files\n- **Filename:** None\n- **Location:** N/A\n- **Purpose:** This script operates entirely on manual inputs and direct entity selection.\n\n## Tips\n- **Through Holes:** Always set **Depth** to `0` if you want the hole to go completely through the panel, regardless of the panel thickness.\n- **Using Circles:** If you have a CAD drawing with circles representing where holes go, set **Diameter** to `0` and select those circles in Step 4. The script will adopt the circle's exact diameter and position.\n- **Pattern Drilling:** To create a vent or a row of holes, set the **Interdistance** (e.g., 100mm) and **Distribution Mode** to \"Fixed\". Pick the start and end points, and the script will calculate the intermediate holes.\n- **Visualizing Depth:** The script usually provides a visual cue (color/geometry) to indicate which side of the panel (Top vs. Bottom) is being drilled.\n\n## FAQ\n- **Q: What happens if I enter a negative diameter?**\n  - **A:** The script will detect this as invalid, display an error \"invalid diameter Tool will be deleted,\" and remove the instance from the model.\n- **Q: Can I move the holes after I place them?**\n  - **A:** Yes. If you created them using manual point picking, select the script instance and drag the blue grip points. If you created them from a polyline, right-click and select **Release Dependency** first to unlock the grips.\n- **Q: Why is the \"Select polyline\" prompt skipped?**\n  - **A:** This prompt is skipped if **Diameter** is already set to a value greater than 0 **and** the Distribution Mode is disabled. The script assumes you want to pick single points immediately."
      },
      "tokens_used": 6659,
      "error": null
    }
  }
}