{
  "filename": "instaConduit.mcr",
  "status": "completed",
  "total_tokens": 55615,
  "processing_time": 437.04391503334045,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": \"\",\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"4.2\",\n      \"date\": \"06.09.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"centered anchoring of combination supported, new property to toggle available anchor node\"\n    },\n    {\n      \"version\": \"4.1\",\n      \"date\": \"06.09.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"new command to list all available commands in report dialog\"\n    },\n    {\n      \"version\": \"4.0\",\n      \"date\": \"04.08.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"snapping to center of combinations improved\"\n    },\n    {\n      \"version\": \"3.9\",\n      \"date\": \"29.07.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"snapping accepts also center of combination\"\n    },\n    {\n      \"version\": \"3.8\",\n      \"date\": \"26.07.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"segemented drills fixed when based on strategy and not connected to bottom or top side\"\n    },\n    {\n      \"version\": \"3.7\",\n      \"date\": \"18.03.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"bugfix default strategy, drill support when conduits connects straight to edge in grip mode\"\n    },\n    {\n      \"version\": \"3.6\",\n      \"date\": \"21.01.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"bugfix support drill tools in floor elements\"\n    },\n    {\n      \"version\": \"3.5\",\n      \"date\": \"15.12.2021\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"hardware supports strategies with multiple components\"\n    },\n    {\n      \"version\": \"3.4\",\n      \"date\": \"15.12.2021\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"bugfixes flip direction, jig on loose conduits\"\n    },\n    {\n      \"version\": \"3.3\",\n      \"date\": \"10.12.2021\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"bugfix selection loose genbeams\"\n    },\n    {\n      \"version\": \"3.2\",\n      \"date\": \"06.12.2021\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"multiple hardware entries, adding and deleting of entries supported through standard hardware dialog\"\n    },\n    {\n      \"version\": \"3.1\",\n      \"date\": \"01.12.2021\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"new settings to control genbeam and combination offsets, solids not facetted\"\n    },\n    {\n      \"version\": \"3.0\",\n      \"date\": \"29.11.2021\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"strategies extended\"\n    },\n    {\n      \"version\": \"2.9\",\n      \""
      },
      "tokens_used": 9113,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses 3D geometry primitives (PLine, PlaneProfile, createCircle), interactive Jigging (_bOnJig), and Grip Points (_PtG). There are no 'sd_' prefixes, '_Viewport' references, or '#Type E' declarations typical of Paper Space scripts. The functionality describes creating conduits and tools for installation cells, which are 3D Model Space entities."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "TSL set: instaCombination, instaCell, instaConduit"
          ]
        }
      },
      "tokens_used": 8283,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "no a panel and an insertion point, select properties or catalog entry and press OK",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "nDialogMode == 2 (Add Strategy) or nDialogMode == 3 (Edit Strategy)",
            "title": "Strategy Dialog",
            "dataSource": "Internal Map Variables",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          },
          {
            "type": "ShowNotice/Report",
            "trigger": "nDialogMode == 4 (List Commands)",
            "title": "Command List Report",
            "dataSource": "Internal String Construction",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sName",
            "type": "PropString",
            "displayName": "|New Strategy|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Settings",
            "description": null
          },
          {
            "index": 1,
            "variable": "sName",
            "type": "PropString",
            "displayName": "|Edit Strategy|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Settings",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Flip Direction|",
            "handler": "|Flip Direction|",
            "action": "Reverts the direction of the conduit",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Flip Face|",
            "handler": "|Flip Face|",
            "action": "Flips the face of the conduit",
            "alsoTriggeredBy": "Double Click"
          },
          {
            "menuItem": "|Hide Tools|",
            "handler": "|Hide Tools|",
            "action": "Hides potential CNC tools",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Show Tools|",
            "handler": "|Show Tools|",
            "action": "Shows potential CNC tools",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Reset Path|",
            "handler": "|Reset Path|",
            "action": "Resets the path of the conduit (only if FreePath and cells > 1)",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Connect to Center|",
            "handler": "|Connect to Center|",
            "action": "Connects the conduit centered",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Add Vertex|",
            "handler": "|Add Vertex|",
            "action": "Adds a vertex to the path of the conduit",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Delete Vertex|",
            "handler": "|Delete Vertex|",
            "action": "Deletes a vertex from the path",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Add Strategy|",
            "handler": "|Add Strategy|",
            "action": "Opens dialog to add a new strategy",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Edit Strategy|",
            "handler": "|Edit Strategy|",
            "action": "Opens dialog to edit an existing strategy",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Set Strategy Hardware|",
            "handler": "|Set Strategy Hardware|",
            "action": "Opens hardware dialog to specify strategy hardware",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Delete Strategy|",
            "handler": "|Delete Strategy|",
            "action": "Deletes an existing strategy",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Import Settings|",
            "handler": "|Import Settings|",
            "action": "Imports settings from a file",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Export Settings|",
            "handler": "|Export Settings|",
            "action": "Exports settings to a file",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "|Show all Commands for UI Creation|",
            "handler": "|Show all Commands for UI Creation|",
            "action": "Displays a list of all available commands in a report dialog",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8706,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automates the creation and routing of installation conduits (holes/drills) through timber elements (walls/floors), connecting installation cells or loose points, and managing associated hardware.\",\n    \"category\": \"Machining/Installation\",\n    \"typicalUseCase\": \"When designing timber frame structures, this tool is used to define paths for electrical wiring, plumbing, or HVAC ducts, ensuring holes are correctly placed through studs, joists, or CLT panels and that necessary hardware (sleeves/boxes) is assigned.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"Strategy\",\n      \"technicalDefault\": \"<Default>\",\n      \"businessMeaning\": \"A named configuration preset that bundles Diameter, Radius Contour, Anchoring, and Hardware settings into a single selection (e.g., 'Electrical 20mm', 'Water 50mm').\",\n      \"validRange\": \"Predefined list of strings\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Updates all geometric and hardware properties (diameter, offsets, tooling) associated with the selected strategy instantly.\"\n    },\n    {\n      \"name\": \"Diameter\",\n      \"technicalDefault\": \"Depends on Strategy\",\n      \"businessMeaning\": \"The physical size of the hole or conduit to be drilled/machined into the timber elements.\",\n      \"validRange\": \"10mm - 300mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Changes the diameter of the cylindrical drill holes and the visual representation of the conduit.\"\n    },\n    {\n      \"name\": \"AnchorMode\",\n      \"technicalDefault\": \"0 (<Default>)\",\n      \"businessMeaning\": \"Determines the snapping behavior and reference point for the conduit relative to the timber elements (e.g., center of the element, specific cell, or combination of elements).\",\n      \"validRange\": \"0 (Default), 1 (Cells), 2 (Combination)\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Alters the insertion position and alignment of the tool path relative to the structural geometry.\"\n    },\n    {\n      \"name\": \"ConnectionType\",\n      \"technicalDefault\": \"Depends on selection\",\n      \"businessMeaning\": \"Defines the routing logic; either a direct straight connection between points or a 'Free Path' allowing user-defined vertices (polyline).\",\n      \"validRange\": \"Straight, FreePath\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Switches the geometric generation logic from a simple line to a segmented polyline, enabling vertex editing.\"\n    },\n    {\n      \"name\": \"Radius Contour\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"The radius of the corners used in polygonal (Free Path) conduit routing. Determines if corners are sharp or rounded.\",\n      \"validRange\": \"0mm (Sharp corners) - 500mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Smoothes the corners of the tool path in 3D space and the resulting machining.\"\n    },\n    {\n      \"name\": \"Reference Side / Face\",\n      \"technicalDefault\": \"Reference Side\",\n      \"businessMeaning\": \"Specifies which side of the wall/element (Reference Side vs Opposite Side) the conduit originates from or aligns to.\",\n      \"validRange\": \"Reference Side, Opposite Side\",\n      \"unit\": \"Enumeration\",\n      \"affectsOutput\": \"Flips the direction of the tool path normal relative to the element's coordinate system.\"\n    },\n    {\n      \"name\": \"Transparency\",\n      \"technicalDefault\": \"50\",\n      \"businessMeaning\": \"Controls the visual opacity of the conduit preview solid in the CAD model.\",\n      \"validRange\": \"0 (Solid) - 90 (Ghosted)\",\n      \"unit\": \"Percentage\",\n      \"affectsOutput\": \"Visual only; does not affect CNC data or geometry.\"\n    },\n    {\n      \"name\": \"ShowElementTool\",\n      \"technicalDefault\": \"True\",\n      \"businessMeaning\": \"Toggle to show or hide the generated CNC machining (drills/cuts) in the model view.\",\n      \"validRange\": \"True/False\",\n      \"unit\": \"Boolean\",\n      \"affectsOutput\": \"Visibility of machining entities in the CAD interface.\"\n    },\n    {\n      \"name\": \"SplitSegmentGap\",\n      \"technicalDefault\": \"0\",\n      \"businessMeaning\": \"The distance left between segments if a long drill is split into smaller machining operations (e.g., for drill length limitations).\",\n      \"validRange\": \"0mm - 50mm\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Creates gaps in the drill path instead of one continuous hole.\"\n    },\n    {\n      \"name\": \"sName (New/Edit Strategy)\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"The name assigned to a new or modified user-defined strategy configuration.\",\n      \"validRange\": \"Alphanumeric string\",\n      \"unit\": \"String\",\n      \"a"
      },
      "tokens_used": 11315,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script: User runs the script (e.g., via toolbar or command line 'hsb_ScriptInsert').",
          "2. Initialization: Constants and debug settings are loaded. The script checks for 'DialogMode' in the instance map.",
          "3. Strategy Management (Conditional): If 'DialogMode' is 2 (Add) or 3 (Edit), a dynamic dialog opens to configure or modify a strategy (naming, diameter, hardware).",
          "4. Property Palette Exposure: If not in Strategy Dialog mode, properties (Strategy, Diameter, AnchorMode, Radius, etc.) are exposed in the Object Property Manager (OPM).",
          "5. User Insertion Interaction: If '_bOnInsert' is true, the script prompts for a panel and insertion point ('getPoint').",
          "6. Dynamic Jigging: The script enters a loop ('_bOnJig') to dynamically draw the conduit based on cursor position and current settings.",
          "7. Selection & Snapping: The script identifies anchor points based on 'AnchorMode' (Default, Cells, or Combination).",
          "8. Grip Point Loop (Vertex Editing): If in FreePath mode, users can add/move/delete vertices via Grip Points or context menu commands.",
          "9. Geometry Calculation: The script calculates the final polyline path, applies radius contours, and generates the visual solid.",
          "10. Tooling Generation: The script generates CNC drills/slots based on the path and 'ShowElementTool' setting.",
          "11. Finalize: The instance is saved, and execution loops are set."
        ],
        "conditionalBranches": [
          {
            "condition": "DialogMode Value",
            "path1": {
              "name": "Standard Insert/Edit (DialogMode 0/1)",
              "steps": [
                "Skip Strategy Dialog.",
                "Load default settings.",
                "Wait for user input (Point/Grip)."
              ]
            },
            "path2": {
              "name": "Strategy Configuration (DialogMode 2/3)",
              "steps": [
                "ShowDynamicDialog for inputs.",
                "Update internal Strategy Map.",
                "Return to previous state."
              ]
            }
          },
          {
            "condition": "ConnectionType (Straight vs FreePath)",
            "path1": {
              "name": "Straight Connection",
              "steps": [
                "Path defined by Start and End points only.",
                "'Reset Path' command disabled."
              ]
            },
            "path2": {
              "name": "Free Path (Polygonal)",
              "steps": [
                "Path defined by multiple vertices (_PtG).",
                "Vertex grips active.",
                "'Add Vertex', 'Delete Vertex', and 'Reset Path' commands enabled."
              ]
            }
          },
          {
            "condition": "Context Menu / Trigger Execution",
            "path1": {
              "name": "Flip Face",
              "steps": [
                "Trigger: 'Flip Face' or Double Click.",
                "Toggle 'sFace' (Reference Side vs Opposite Side).",
                "Recalculate orientation."
              ]
            },
            "path2": {
              "name": "Flip Direction",
              "steps": [
                "Trigger: 'Flip Direction'.",
                "Reverse the order of path points.",
                "Recalculate geometry."
              ]
            },
            "path3": {
              "name": "Toggle Tools Visibility",
              "steps": [
                "Trigger: 'Hide Tools' or 'Show Tools'.",
                "Toggle 'bShowElementTool' boolean.",
                "Update '_ThisInst' tool visibility."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Reset Path Prerequisites",
            "errorMessage": "Command is only available if 'FreePath' is active and cells > 1.",
            "recovery": "User must switch to FreePath mode or ensure multiple cells are connected."
          },
          {
            "check": "Vertex Deletion",
            "errorMessage": "Cannot delete vertices if count <= 2 (must maintain a line).",
            "recovery": "User must ensure path has more than 2 points to delete a vertex."
          },
          {
            "check": "Strategy Existence",
            "errorMessage": "Attempting to edit/delete a non-existent strategy.",
            "recovery": "Handled by strategy dialog logic (User selects from existing list)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Geometry Path",
            "how": "Drag Grip Points (Cyan handles for vertices, Start/End points)",
            "effect": "Updates the 3D path of the conduit and regenerates the drill holes."
          },
          {
            "action": "Change Strategy",
            "how": "Object Property Manager (OPM) -> Strategy Property",
            "effect": "Instantly updates Diameter, Offset, Hardware, and other parameters defined in that strategy."
          },
          {
            "action": "Add/Edit/Delete Custom Strategies",
            "how": "Context Menu -> Add/Edit/Delete Strategy",
            "effect": "Modifies the internal Map of strategies available to the project/instance."
          },
          {
            "action": "Assign Hardware",
            "how": "Context Menu -> Set Strategy Hardware",
            "effect": "Opens the standard hardware catalog dialog to link specific sleeves/boxes to the conduit strategy."
          },
          {
            "action": "Import/Export Settings",
            "how": "Context Menu -> Import/Export Settings",
            "effect": "Saves or loads strategy configurations to/from an external file for project consistency."
          }
        ]
      },
      "tokens_used": 10598,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# instaConduit.mcr\n\n## Overview\nThis script automates the creation and routing of installation conduits (holes and drills) through timber elements. It connects installation cells or loose points with flexible routing options (straight or polygonal) and manages associated hardware assignments.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Designed for 3D modeling and machining. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: Panels (GenBeams) or timber elements to drill through.\n- **Minimum Beam Count**: 0 (Can be used loosely or between specific elements).\n- **Required Settings**: TSL set including `instaCombination`, `instaCell`, and `instaConduit`.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `instaConduit.mcr` from the list.\n\n### Step 2: Select Configuration\nUpon launching, you may be prompted to select a Strategy or catalog entry. This defines the default diameter and hardware settings for the conduit. Press OK to confirm.\n\n### Step 3: Define Insertion Point\n```\nCommand Line: Select a panel and an insertion point, select properties or catalog entry and press OK\nAction: Click on a panel or element in the model where the conduit should start.\n```\n\n### Step 4: Define Path\nThe script will enter \"Jig\" mode.\n- **Straight Connection**: Click the destination point.\n- **Free Path**: Click multiple points to create a polyline route. Right-click or press Enter to finish the path.\n\n### Step 5: Finalize\nAfter placing the points, the script generates the visual conduit and calculates the drill holes.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Strategy | String | \\<Default\\> | Selects a preset configuration that bundles Diameter, Radius, Anchoring, and Hardware settings. |\n| Diameter | Number | Strategy Dependent | Sets the physical size of the hole (mm). |\n| AnchorMode | Integer | 0 | 0 = Default, 1 = Cells, 2 = Combination. Controls how the conduit snaps to elements. |\n| ConnectionType | String | Straight | Switches between 'Straight' (direct line) and 'FreePath' (polygonal with vertices). |\n| Radius Contour | Number | 0 | Adds a radius to corners in a FreePath (mm). 0 creates sharp corners. |\n| Reference Side | String | Reference Side | Toggles between 'Reference Side' and 'Opposite Side' for alignment. |\n| Transparency | Number | 50 | Visual opacity of the conduit solid (0-90%). |\n| ShowElementTool | Boolean | True | Toggles the visibility of the generated CNC tools/drills in the model. |\n| SplitSegmentGap | Number | 0 | Distance between segments if a long drill is split (mm). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip Direction | Reverses the start and end points of the conduit. |\n| Flip Face | Flips the conduit to the opposite side of the reference plane. (Can also be triggered by Double Click). |\n| Hide Tools / Show Tools | Toggles the visibility of the calculated CNC drill holes. |\n| Reset Path | Resets the path to the default straight line (Only available in FreePath mode with >1 cell). |\n| Connect to Center | Snaps the conduit connection to the center of the target element/combination. |\n| Add Vertex | Adds a new grip point/vertex to the path. |\n| Delete Vertex | Removes the selected vertex from the path. |\n| Add Strategy | Opens a dialog to create a new named configuration strategy. |\n| Edit Strategy | Opens a dialog to modify the selected strategy. |\n| Set Strategy Hardware | Opens the hardware catalog to link specific sleeves or boxes to the strategy. |\n| Delete Strategy | Removes the currently selected strategy. |\n| Import Settings | Loads strategy configurations from an external file. |\n| Export Settings | Saves current strategy configurations to an external file. |\n| Show all Commands for UI Creation | Displays a list of all script commands in a report dialog. |\n\n## Settings Files\n- **Filename**: User-defined (via Export Settings)\n- **Location**: User selected path\n- **Purpose**: Stores strategy configurations (Diameter, Hardware, Offsets) so they can be shared between projects or users.\n\n## Tips\n- **Vertex Editing**: After insertion, select the conduit and drag the **Cyan Grip Points** to adjust the path in 3D space.\n- **Rounded Corners**: For a smoother conduit path in \"FreePath\" mode, increase the **Radius Contour** property to round sharp turns.\n- **Strategies**: Create strategies for repetitive tasks (e.g., \"20mm Electrical\", \"50mm Plumbing\") to quickly switch hardware and dimensions without entering individual values.\n- **Visuals**: If the model becomes too cluttered, set **Transparency** to 80 or use **Hide Tools** to see only the structural timber.\n\n## FAQ\n- **Q: How do I change the diameter of the hole after placing it?**\n  A: Select the conduit, open the Properties palette (Ctrl+1), and change the **Diameter** value or select a different **Strategy**.\n- **Q: The conduit isn't snapping to the center of the beam.**\n  A: Right-click and select **Connect to Center**, or change the **AnchorMode** property in the properties panel.\n- **Q: Can I hide the solid tube and only see the hole?**\n  A: Yes, but this script generates a solid body to represent the conduit. You can lower the **Transparency** to 90 to make it almost invisible, or use standard AutoCAD layer freezing to hide the visual representation while keeping the machining tools visible."
      },
      "tokens_used": 7600,
      "error": null
    }
  }
}