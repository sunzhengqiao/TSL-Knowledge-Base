{
  "filename": "HSB_G-ColorBeamsCatalogueProps.mcr",
  "status": "completed",
  "total_tokens": 25378,
  "processing_time": 960.0830810070038,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "18.06.2013",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.1",
            "date": "22/11/2023",
            "author": "Robert Pol",
            "changes": "Make sure props are not only declared in if statements"
          }
        ],
        "settingsFiles": [
          "HSB-ColorBeamsCatalogue.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 2933,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script executes 'eraseInstance()' on insert, indicating it is a command/utility script rather than a spatial entity. It contains no Paper Space logic (_Viewport, _kPaperSpace) or Shop Drawing functions (sd_*). The logic manipulates beam codes and catalogues, which are Model Space (3D) concepts."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "None specific (Utility/Command script)",
          "requiredSettings": [
            "_kPathHsbCompany\\Abbund\\HSB-ColorBeamsCatalogue.xml"
          ]
        }
      },
      "tokens_used": 3450,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sEntryName",
            "type": "PropString",
            "displayName": "Beam code",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "In 'Select' mode (2), becomes a dropdown populated by XML keys. In 'Edit' mode (3), becomes read-only."
          },
          {
            "index": 0,
            "variable": "nZoneIndex",
            "type": "PropInt",
            "displayName": "Zone index",
            "defaultValue": "0",
            "inputType": "dropdown",
            "options": [
              "0",
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "10"
            ],
            "category": null,
            "description": "Dropdown options available in 'Add' (1) and 'Edit' (3) modes."
          },
          {
            "index": 1,
            "variable": "nColorIndex",
            "type": "PropInt",
            "displayName": "Color index",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "HSB-ColorBeamsCatalogue.xml",
            "searchPaths": [
              "_kPathHsbCompany\\Abbund"
            ],
            "purpose": "Stores the catalogue entries. Read in 'Select' mode (2) to populate the Beam code dropdown list.",
            "required": true
          }
        ]
      },
      "tokens_used": 5421,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Manages a catalogue of beam definitions to assign specific visual colors and construction zones to beams via XML configuration.",
          "category": "Utility/Catalogue",
          "typicalUseCase": "Used to standardize beam appearance and grouping by selecting from a pre-defined list (catalogue) or manually adding/editing color and zone attributes."
        },
        "parameters": [
          {
            "name": "sEntryName",
            "technicalDefault": "\"\"",
            "businessMeaning": "The unique identifier (name) for a specific beam type within the color catalogue. It acts as a lookup key for predefined settings.",
            "validRange": "Any text string matching keys in 'HSB-ColorBeamsCatalogue.xml'",
            "unit": "String",
            "affectsOutput": "Determines which catalogue entry is loaded. In 'Select' mode, changing this retrieves the specific Zone and Color settings associated with that name."
          },
          {
            "name": "nZoneIndex",
            "technicalDefault": "0",
            "businessMeaning": "Categorizes the beam into a specific construction zone, production phase, or logical group for filtering and reporting.",
            "validRange": "0 to 10",
            "unit": "Index",
            "affectsOutput": "Updates the beam's zone property, which may be used for material take-offs, sorting lists, or applying specific machining instructions."
          },
          {
            "name": "nColorIndex",
            "technicalDefault": "-1",
            "businessMeaning": "The visual display color (AutoCAD Color Index) assigned to the beam to distinguish it in the 3D model or drawings.",
            "validRange": "-1 to 255 (where -1 usually defaults to ByLayer)",
            "unit": "AutoCAD Color Index",
            "affectsOutput": "Changes the graphical representation color of the beam in the CAD viewport."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Mode = 2 (Select)",
            "effect": "Populates the 'sEntryName' dropdown with keys from the XML file. This selection determines the values for nZoneIndex and nColorIndex.",
            "cascade": [
              "sEntryName",
              "nZoneIndex",
              "nColorIndex"
            ]
          },
          {
            "trigger": "Mode = 3 (Edit)",
            "effect": "Locks 'sEntryName' to prevent renaming the catalogue entry, but allows 'nZoneIndex' and 'nColorIndex' to be modified.",
            "cascade": [
              "sEntryName"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "XML Catalogue Entry",
            "description": "Updates or creates entries in 'HSB-ColorBeamsCatalogue.xml' with the specified Code, Zone, and Color.",
            "appliedTo": "The external XML configuration file."
          },
          {
            "type": "Beam Properties",
            "description": "Assigns the specified Color Index and Zone Index to a target beam.",
            "appliedTo": "Selected GenBeams."
          }
        ]
      },
      "tokens_used": 3245,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Initiated",
          "[Conditional] Check _bOnInsert flag",
          "Path A: Flag is TRUE -> Execute eraseInstance() and Exit (Script is a command/utility wrapper)",
          "Path B: Flag is FALSE -> Proceed to Property Initialization",
          "Define file path for XML catalogue: _kPathHsbCompany\\Abbund\\HSB-ColorBeamsCatalogue.xml",
          "Retrieve 'Mode' from _Map (Defaults to 0 if missing)",
          "[Conditional] Branch based on Mode variable",
          "Path 1: Mode == 1 (Add) -> Configure properties for new entry (Editable Code, Dropdown Zone, Input Color)",
          "Path 2: Mode == 2 (Select) -> Read XML, parse keys, Configure properties for selection (Dropdown Code)",
          "Path 3: Mode == 3 (Edit) -> Configure properties for update (Read-only Code, Dropdown Zone, Input Color)",
          "Path 4: Default/Else -> Configure properties with basic defaults (Editable Code, Number Zone, Input Color)",
          "Display Properties in Object Properties Palette (OPM)",
          "Await user input and subsequent script recalculation"
        ],
        "conditionalBranches": [
          {
            "condition": "State of _bOnInsert",
            "path1": {
              "name": "Insertion Sequence",
              "steps": [
                "Detect _bOnInsert is true",
                "Run eraseInstance()",
                "Terminate script execution"
              ]
            },
            "path2": {
              "name": "Execution Sequence",
              "steps": [
                "Detect _bOnInsert is false",
                "Continue to property declaration logic"
              ]
            }
          },
          {
            "condition": "Value of 'Mode' integer",
            "path1": {
              "name": "Add (1)",
              "steps": [
                "Re-declare sEntryName as Editable Text",
                "Re-declare nZoneIndex as Dropdown (0-10)",
                "Re-declare nColorIndex as Number Input"
              ]
            },
            "path2": {
              "name": "Select (2)",
              "steps": [
                "Read XML from file path",
                "Iterate _Map to find keys",
                "Populate string array with XML keys",
                "Re-declare sEntryName as Dropdown (populated by array)"
              ]
            },
            "path3": {
              "name": "Edit (3)",
              "steps": [
                "Re-declare sEntryName as Read-Only Text",
                "Re-declare nZoneIndex as Dropdown (0-10)",
                "Re-declare nColorIndex as Number Input"
              ]
            },
            "path4": {
              "name": "Default (0/None)",
              "steps": [
                "Skip specific Mode blocks",
                "Use initial property declarations",
                "sEntryName: Editable Text, nZoneIndex: Integer, nColorIndex: Integer"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "XML File Existence",
            "errorMessage": "None explicitly in code snippet, though readFromXmlFile returns a status",
            "recovery": "User must ensure 'HSB-ColorBeamsCatalogue.xml' exists in the company folder structure"
          },
          {
            "check": "Mode Initialization",
            "errorMessage": "None",
            "recovery": "Script defaults to Mode 0 if 'Mode' is not present in _Map"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Select Catalogue Entry",
            "how": "OPM Dropdown (Mode 2)",
            "effect": "Selects a key from the XML catalogue to define the beam parameters"
          },
          {
            "action": "Create New Entry",
            "how": "OPM Inputs (Mode 1)",
            "effect": "Allows defining a new Beam Code, Zone, and Color"
          },
          {
            "action": "Update Existing Entry",
            "how": "OPM Inputs (Mode 3)",
            "effect": "Allows modifying Zone and Color for a specific, locked Beam Code"
          }
        ]
      },
      "tokens_used": 4380,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-ColorBeamsCatalogueProps.mcr\n\n## Overview\nThis utility script manages a catalogue of beam definitions, associating specific Beam Codes with construction Zones and visual Colors. It allows you to Add, Select, or Edit these catalogue entries via the AutoCAD Properties Palette, saving the data to an external XML file.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates as a utility command within the 3D model environment. |\n| Paper Space | No | Not intended for layout or detailing views. |\n| Shop Drawing | No | Not intended for manufacturing outputs. |\n\n## Prerequisites\n- **Required Entities:** None (This is a command/utility script).\n- **Minimum Beam Count:** 0.\n- **Required Settings:** The file `HSB-ColorBeamsCatalogue.xml` must exist in your company folder structure (`...\\Abbund\\`).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Select `HSB_G-ColorBeamsCatalogueProps.mcr` from the file dialog and click **Open**.\n\n### Step 2: Configure Properties\nThe script will run immediately upon insertion (the visual insertion marker will disappear, acting as a background command).\nAction: Press `Ctrl+1` to open the **Properties Palette** if not already open. The script's parameters will be displayed here.\n\n### Step 3: Define or Select Entry\nDepending on the current mode (determined by the script context), you will see different input options:\n- **Select Mode:** Choose a \"Beam code\" from the dropdown list to view its assigned Zone and Color.\n- **Add Mode:** Type a new \"Beam code\", then select the Zone index and Color index to create a new catalogue entry.\n- **Edit Mode:** The \"Beam code\" is locked. Modify the \"Zone index\" or \"Color index\" to update the existing catalogue entry.\n\n### Step 4: Apply Changes\nAction: Modify values in the Properties Palette. The script will automatically update the XML file with the new data upon recalculation.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Beam code** | Dropdown / Text | Blank | The unique identifier for the beam entry. In Select mode, this is a dropdown list of existing XML keys. In Add/Edit mode, this is a text input. |\n| **Zone index** | Dropdown | 0 | Assigns the beam to a specific construction zone (values 0 through 10). |\n| **Color index** | Number | -1 | The AutoCAD Color Index (ACI) assigned to the beam (e.g., 1=Red, 5=Blue, -1=ByLayer). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not define custom right-click context menu items. All interaction is via the Properties Palette. |\n\n## Settings Files\n- **Filename**: `HSB-ColorBeamsCatalogue.xml`\n- **Location**: `_kPathHsbCompany\\Abbund\\`\n- **Purpose**: Stores the database of Beam Codes and their corresponding Zone and Color Index settings.\n\n## Tips\n- **Identifying Mode:** If you cannot type in the \"Beam code\" field, you are in **Select** mode. If you can type a name, you are in **Add** or **Edit** mode.\n- **Color Index:** Use standard AutoCAD color numbers (1-255). Enter `-1` to set the color to \"ByLayer\".\n- **Zone Grouping:** Use the \"Zone index\" to logically group beams for reports or filtering, even if they share the same visual color.\n\n## FAQ\n- **Q: The script disappeared immediately after I inserted it. Is it working?**\n  - A: Yes. This is a utility script that erases its graphical representation (`eraseInstance`) after insertion to act as a background command. Configure settings using the Properties Palette (`Ctrl+1`).\n- **Q: Where is the catalogue data saved?**\n  - A: Data is saved to `HSB-ColorBeamsCatalogue.xml` located in your company `Abbund` folder.\n- **Q: How do I add a new color definition?**\n  - A: Ensure the script is in \"Add\" mode (often set by a calling script). Enter a new unique name in \"Beam code\" and define the Zone and Color."
      },
      "tokens_used": 5949,
      "error": null
    }
  }
}