{
  "filename": "hsbCLT-Opening.mcr",
  "status": "completed",
  "total_tokens": 55250,
  "processing_time": 627.4169614315033,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": null,\n  \"versionHistory\": [\n    {\n      \"version\": \"2.9\",\n      \"date\": \"30/04/2025\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"Fix when radius is applied\"\n    },\n    {\n      \"version\": \"2.8\",\n      \"date\": \"11/04/2025\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"Fix when closing door openings (make sure they get closed); Fix when freeprofiling the door openings (make sure nothing remains at the outter edge; Use the envelopBody with cuts when investigating outter contour for openings\"\n    },\n    {\n      \"version\": \"2.7\",\n      \"date\": \"01/04/2025\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"Fix when getting rings of openings\"\n    },\n    {\n      \"version\": \"2.6\",\n      \"date\": \"27.02.2024\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"new strategies 'House Tool' and 'Mortise Tool' have been added for rectangular opening shapes.\"\n    },\n    {\n      \"version\": \"2.5\",\n      \"date\": \"01.08.2023\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"bugfix strategy 1 on doors\"\n    },\n    {\n      \"version\": \"2.4\",\n      \"date\": \"09.09.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"batch insert support added\"\n    },\n    {\n      \"version\": \"2.3\",\n      \"date\": \"08.09.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"new commands to show UI commands and to clone tool, new corner tool behaviour and options\"\n    },\n    {\n      \"version\": \"2.2\",\n      \"date\": \"30.06.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"new command flip side toggles reference and opposite side, doubleclick action changed to 'Flip Side'\"\n    },\n    {\n      \"version\": \"2.1\",\n      \"date\": \"28.06.2022\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"corner tool fixed when support used for door alike openings\"\n    },\n    {\n      \"version\": \"2.0\",\n      \"date\": \"16.11.2021\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"Tool image updated\"\n    },\n    {\n      \"version\": \"1.10\",\n      \"date\": \"06.10.2021\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"recalcNow the tsl\"\n    },\n    {\n      \"version\": \"1.9\",\n      \"date\": \"09.09.2021\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"new custom command to add tool dimensions to shopdrawing (requires sd_Opening to be part of ruleset definition)\"\n    },\n    {\n      \"version\": \"1.8\",\n      \"date\": \"28.07.2021\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"ra"
      },
      "tokens_used": 9363,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Uses _kModelSpace in tslDialog.dbCreate(). Calculates 3D geometry (PLine, PlaneProfile) and interacts with panels (GenBeam/Element). The script creates 'surrounding tools' in the 3D model. Comments reference 'sd_Opening' only as a prerequisite for Shopdrawing generation of the tools created by this script, not as the execution space of the script itself."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "ModelSpace",
          "requiredSettings": []
        }
      },
      "tokens_used": 8131,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 10946,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Replaces raw voids in CLT panels with defined machining tools (surroundings, pockets, or through cuts) for fabrication and shop drawing annotation.",
          "category": "Framing/Machining",
          "typicalUseCase": "Used when detailing CLT panels to ensure window and door openings are fabricated with specific corner radii, surrounding splines, or pocket depths rather than raw rectangular cuts."
        },
        "parameters": [
          {
            "name": "Strategy (sStrategyKeys)",
            "technicalDefault": "\"Midpoint Tool\"",
            "businessMeaning": "The manufacturing method for the opening. 'Midpoint Tool' and 'Corner Tool' create a surrounding spline (timber piece), 'Opening' is a through cut, 'Extrusion' is a recess/pocket, 'House'/'Mortise' are specific tooling strategies.",
            "validRange": "Midpoint Tool, Corner Tool, Opening, Extrusion, House, Mortise",
            "unit": "Enumeration",
            "affectsOutput": "Determines the geometry generation: adds a surrounding body, modifies panel contour, or creates a pocket."
          },
          {
            "name": "Opening Type (bIsDoor)",
            "technicalDefault": "Opening",
            "businessMeaning": "Specifies if the opening is a door or a standard window/service cut.",
            "validRange": "Door, Opening",
            "unit": "Boolean/Type",
            "affectsOutput": "Alters handling of the vertical edge (e.g., closing the opening flush with the panel edge) and specific tool behaviors."
          },
          {
            "name": "Radius",
            "technicalDefault": "U(0)",
            "businessMeaning": "Corner radius of the opening or tool.",
            "validRange": "0 mm to 500 mm",
            "unit": "mm",
            "affectsOutput": "Rounds the corners of the cut or the surrounding tool geometry."
          },
          {
            "name": "Display Settings (Color, LineType, Transparency)",
            "technicalDefault": "Blue, DASHED",
            "businessMeaning": "Visual properties of the tool representation in the CAD model.",
            "validRange": "CAD standard colors/linetypes",
            "unit": "Index/String",
            "affectsOutput": "Only visual representation in ModelSpace; does not affect CNC."
          },
          {
            "name": "Text Height (dTextHeight)",
            "technicalDefault": "U(2.5)",
            "businessMeaning": "Size of the annotation text label (e.g., Opening ID) in the model.",
            "validRange": "1.0 mm - 10.0 mm",
            "unit": "mm",
            "affectsOutput": "Visual size of text labels."
          },
          {
            "name": "Dimensioning (Stereotype, bAddDim)",
            "technicalDefault": "Yes",
            "businessMeaning": "Controls the generation of dimensions and points for shop drawings.",
            "validRange": "Yes/No, User Strings",
            "unit": "Boolean/String",
            "affectsOutput": "Adds or removes smart dimensioning points linked to the shopdrawing ruleset."
          },
          {
            "name": "Side (Reference vs Opposite)",
            "technicalDefault": "Reference Side",
            "businessMeaning": "Defines which face of the panel is the reference for the tool logic.",
            "validRange": "Reference Side, Opposite Side",
            "unit": "Toggle",
            "affectsOutput": "Flips the tool's reference direction."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Strategy = 'Extrusion'",
            "effect": "The opening is treated as a pocket (blind hole) rather than a through cut.",
            "cascade": []
          },
          {
            "trigger": "Strategy = 'House' or 'Mortise'",
            "effect": "Specific rectangular tooling strategies are applied.",
            "cascade": []
          },
          {
            "trigger": "bIsDoor = true",
            "effect": "Logic runs to 'close' the opening at the outer edge of the panel.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Surrounding Tool (GenBeam/Body)",
            "description": "A physical representation of the material forming the boundary of the opening (spline).",
            "appliedTo": "Model Space (associated with the host panel)"
          },
          {
            "type": "Panel Cut/Contour Modification",
            "description": "Direct modification of the host panel's shape to create the hole.",
            "appliedTo": "Selected CLT Panel (GenBeam/Element)"
          },
          {
            "type": "Pocket/Extrusion",
            "description": "A recessed area machined into the panel face.",
            "appliedTo": "Selected CLT Panel surface"
          },
          {
            "type": "Dimension Points",
            "description": "Logical points used to generate dimensions in the shop drawing module.",
            "appliedTo": "Shopdrawing ruleset (sd_Opening)"
          }
        ]
      },
      "tokens_used": 8931,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution initiated.",
          "System checks execution state (Jig, Insert, or Recalc/Trigger).",
          "If Insert Mode: Display Configuration Dialog (tslDialog).",
          "User selects a 'Rule' (Strategy + Opening Type combination) from the list.",
          "User configures visual properties (Color, LineType, Transparency) and dimensioning settings (DimStyle, Stereotype).",
          "User confirms selection (OK).",
          "Script writes configuration to the Setting Map.",
          "Script triggers a recalculation (setExecutionLoops(2)).",
          "Script executes geometry processing: Detects openings in selected CLT panels.",
          "Script applies the selected strategy (e.g., creates surrounding tool, modifies contour, or creates pocket).",
          "Script renders final geometry and annotations in ModelSpace."
        ],
        "conditionalBranches": [
          {
            "condition": "User Interaction with Configuration Dialog",
            "path1": {
              "name": "Cancel",
              "steps": [
                "Dialog closes.",
                "Script execution terminates without changes."
              ]
            },
            "path2": {
              "name": "OK",
              "steps": [
                "Configuration parameters are stored.",
                "Script proceeds to geometry generation."
              ]
            }
          },
          {
            "condition": "Selected Strategy Type",
            "path1": {
              "name": "Tooling Strategies (Midpoint, Corner, Housing, Mortise)",
              "steps": [
                "Script generates a 'Surrounding Tool' (GenBeam/Body).",
                "Panel contour is modified to integrate the tool."
              ]
            },
            "path2": {
              "name": "Cut/Extrusion Strategies (Opening, Extrusion)",
              "steps": [
                "Script directly modifies the panel contour (Opening) or creates a pocket (Extrusion).",
                "No separate surrounding tool body is created."
              ]
            }
          },
          {
            "condition": "Opening Type (Door vs Standard)",
            "path1": {
              "name": "Door",
              "steps": [
                "Logic executes to close the opening at the panel outer edge.",
                "Helper function extendPlOutsidePp is invoked to shape the boundary."
              ]
            },
            "path2": {
              "name": "Standard Opening",
              "steps": [
                "Standard contour processing is applied.",
                "No specific edge-closing logic is run."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Valid Selection in Dialog",
            "errorMessage": "Implicit (Dialog restricts input to predefined list items).",
            "recovery": "User must select a valid Rule (Strategy) from the provided dropdown list."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Flip Side",
            "how": "Double Click or Context Menu",
            "effect": "Toggles the tool reference between Reference Side and Opposite Side."
          },
          {
            "action": "Clone Tool",
            "how": "Context Menu",
            "effect": "Creates a duplicate instance of the tool to allow for parameter variation."
          },
          {
            "action": "Reset + Erase",
            "how": "Context Menu",
            "effect": "Removes the tool geometry and restores the original raw opening state."
          },
          {
            "action": "Edit Shape",
            "how": "Context Menu",
            "effect": "Initiates a jig/edit mode to modify the opening's boundary geometry."
          },
          {
            "action": "Configure Display",
            "how": "Context Menu",
            "effect": "Re-opens the configuration dialog to adjust colors, linetypes, and dimension settings."
          },
          {
            "action": "Add/Remove Tool Dimpoints",
            "how": "Context Menu",
            "effect": "Updates the shopdrawing ruleset to either include or exclude dimensioning points for this tool."
          }
        ]
      },
      "tokens_used": 11337,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbCLT-Opening.mcr\n\n## Overview\nThis script automates the detailing of openings in CLT (Cross Laminated Timber) panels by replacing raw voids with manufacturing-ready machining tools. It supports various strategies for creating window and door openings, including adding surrounding splines, pocketing (extrusions), and applying specific corner radii.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script runs in the 3D model and modifies CLT panels (GenBeam/Element). |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | Generates dimension points for shop drawings but does not run inside the drawing view itself. |\n\n## Prerequisites\n- **Required Entities**: At least one CLT Panel (`GenBeam` or `Element`) must exist in the model.\n- **Minimum Beam Count**: 1\n- **Required Settings**: None required for basic functionality, but relies on standard hsbCAD TSL utilities.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbCLT-Opening.mcr`\n\n### Step 2: Select Host Panel\n```\nCommand Line: Select Element/GenBeam\nAction: Click on the CLT panel that contains the opening you wish to detail.\n```\n\n### Step 3: Configure Opening Strategy\n```\nAction: A configuration dialog appears automatically.\n```\n1.  Select a **Rule** (Strategy) from the list (e.g., \"Midpoint Tool\", \"Corner Tool\", \"Extrusion\").\n2.  Define the **Opening Type** (Door or standard Opening).\n3.  Set the **Radius** for corner rounding.\n4.  Adjust visual settings (Color, LineType) if desired.\n5.  Click **OK** to generate the tool.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Strategy | Dropdown | Midpoint Tool | Determines the manufacturing method: <br>- *Midpoint/Corner Tool*: Creates a surrounding timber spline.<br>- *Opening*: Standard through cut.<br>- *Extrusion*: Creates a recess/pocket.<br>- *House/Mortise*: Specific rectangular tooling strategies. |\n| Is Door | Boolean | No | If set to Yes, the script ensures the opening closes correctly at the outer edge of the panel. |\n| Radius | Number | 0 mm | Sets the corner radius for the opening or the surrounding tool. |\n| Text Height | Number | 2.5 mm | Height of the annotation text (e.g., Opening ID) displayed in the model. |\n| Add Dimensions | Boolean | Yes | If Yes, generates dimension points for the shop drawing ruleset (requires `sd_Opening`). |\n| Stereotype | String | - | Defines the stereotype used for shop drawing processing. |\n| Color | Index | Blue | Visual color of the tool elements in the CAD model. |\n| LineType | String | DASHED | Visual linetype of the tool elements. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip Side | Toggles the reference face of the tool between the Reference Side and the Opposite Side of the panel. |\n| Clone Tool | Creates a duplicate instance of the current tool, allowing for different parameters on the same panel. |\n| Reset + Erase | Removes the tool geometry and restores the panel to its raw opening state. |\n| Edit Shape | Activates a jig/edit mode, allowing you to graphically modify the boundary of the opening. |\n| Configure Display | Re-opens the configuration dialog to adjust colors, linetypes, and text settings. |\n| Add/Remove Tool Dimpoints | Toggles the generation of smart dimensioning points for shop drawings. |\n\n## Settings Files\n- **Filename**: Standard internal settings or `TslUtilities` configuration.\n- **Location**: hsbCAD Application folder.\n- **Purpose**: Stores the visual configuration (colors, layers) and default dialog options.\n\n## Tips\n- **Strategy Selection**: Use \"Midpoint Tool\" or \"Corner Tool\" when you need a physical surrounding piece (spline) for the opening. Use \"Extrusion\" if you only need a blind pocket (recess) without cutting through the panel.\n- **Door Handling**: If a door opening does not appear to close correctly at the panel edge, ensure the **Is Door** property is set to **Yes**.\n- **Batch Processing**: You can insert this script on multiple panels at once using the standard hsbCAD batch insert functionality.\n\n## FAQ\n- **Q: How do I change the corner radius after insertion?**\n  A: Select the tool in the model, open the **Properties Palette**, and modify the **Radius** value.\n- **Q: Why is my opening not showing dimensions in the shop drawing?**\n  A: Ensure **Add Dimensions** is set to **Yes** in the properties and that your shopdrawing ruleset includes the `sd_Opening` component.\n- **Q: What is the difference between \"Midpoint Tool\" and \"Corner Tool\"?**\n  A: Both create surrounding splines, but they use different calculation strategies for placing the tool geometry relative to the opening edges. Choose the one that fits your specific manufacturing connection best."
      },
      "tokens_used": 6542,
      "error": null
    }
  }
}