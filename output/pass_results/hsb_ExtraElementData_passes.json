{
  "filename": "hsb_ExtraElementData.mcr",
  "status": "completed",
  "total_tokens": 35842,
  "processing_time": 531.3851113319397,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "01.02.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "09.02.2010",
            "author": "",
            "changes": "Add an index on the information to export"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5906,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses _Element[] and ElementWallSF for calculation and attaches ElemItem via el.addTool(). It uses insertCycleCount and showDialogOnce, which are insertion phase behaviors. It lacks any viewport handling (_Viewport), sd_* prefixes, or shopdrawing entity references (_Entity[]). The Display object is used to draw text in the model environment."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing valid Wall Elements (ElementWallSF).",
          "requiredSettings": []
        }
      },
      "tokens_used": 3987,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialogOnce",
            "trigger": "On Insert (if _kExecuteKey is empty)",
            "title": null,
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "DimStyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDispRep",
            "type": "PropString",
            "displayName": "Show In Display Rep",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Set the Text Color",
            "defaultValue": "171",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Offset Between Lines",
            "defaultValue": "100",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5132,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Calculates and labels geometric metadata for wall elements, such as corner connections, junction locations, and opening dimensions, attaching this data invisibly to the element for export purposes.",
          "category": "Data Management / Reporting",
          "typicalUseCase": "Used to generate a visual report of wall connection data and opening properties in the 3D model while simultaneously populating element attributes (e.g., for BIM export or production lists) with specific values like 'L/R' corners or 'Header Description'."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "\"\"",
            "businessMeaning": "Specifies the dimension style (font, text size) to be used for the on-screen labels displaying the calculated data.",
            "validRange": "Any Dimension Style name currently loaded in the hsbCAD drawing.",
            "unit": "String",
            "affectsOutput": "Alters the appearance (font and scale) of the text drawn in the model view (e.g., 'Extra Data', 'Corner Type')."
          },
          {
            "name": "sDispRep",
            "technicalDefault": "\"\"",
            "businessMeaning": "Filters the visibility of the data labels to specific Display Representations (e.g., Plan, Section, 3D) rather than showing them everywhere.",
            "validRange": "Any valid hsbCAD Display Representation name (leave empty to show in all views).",
            "unit": "String",
            "affectsOutput": "Determines in which view types the generated text labels are visible. If empty, labels are always visible."
          },
          {
            "name": "nColor",
            "technicalDefault": "171",
            "businessMeaning": "Sets the color of the generated data labels to distinguish them from other model geometry.",
            "validRange": "0 to 255 (AutoCAD Color Index), or -1 for 'ByBlock'.",
            "unit": "Index",
            "affectsOutput": "Changes the color of the text drawn in the model. Clamped to 171 if the user inputs an invalid value."
          },
          {
            "name": "dOffset",
            "technicalDefault": "100",
            "businessMeaning": "The vertical spacing (line height) between consecutive lines of data displayed on the wall.",
            "validRange": "50mm to 500mm (Typical architectural text spacing).",
            "unit": "mm",
            "affectsOutput": "Adjusts the vertical distance between the 'Extra Data' header, 'Corner Type', and subsequent opening information labels. Prevents text overlap."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sDimStyle value changes",
            "effect": "The 'dOffset' may need adjustment to match the text height defined in the selected Dimension Style.",
            "cascade": [
              "dOffset"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "ElemItem (Invisible Tool)",
            "description": "Data attributes attached to the wall element containing calculated values (e.g., JUNCTION1, OPWIDTH1, CORNER) used for export or reporting.",
            "appliedTo": "The selected Wall Element (ElementWallSF)."
          },
          {
            "type": "Display Text",
            "description": "Visual labels drawn in 3D space listing the calculated corner types, junction distances, and opening dimensions.",
            "appliedTo": "The immediate vicinity of the selected Wall Element."
          }
        ]
      },
      "tokens_used": 6724,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch: Check 'insertCycleCount'. If > 1, erase instance and exit to prevent recursion.",
          "2. Insertion Phase: If '_kExecuteKey' is empty, display the Properties dialog (showDialogOnce).",
          "3. User Input: Prompt user to select a set of elements (PrEntity).",
          "4. Spawning: Loop through selected elements and create a new script instance for each using 'dbCreate', passing current properties.",
          "5. Manager Cleanup: The original instance erases itself.",
          "6. Worker Initialization: Verify a valid 'ElementWallSF' is assigned. If not, erase instance.",
          "7. Housekeeping: Search for and erase any older instances of this script attached to the same element.",
          "8. Geometry Calc: Determine wall length, thickness, and coordinate system.",
          "9. Connection Analysis: Iterate through connected elements to identify corners (L/R) or intermediate junctions.",
          "10. Opening Analysis: Iterate through openings, calculate dimensions, and match header descriptions from associated ElemText.",
          "11. Data Export: Create invisible 'ElemItem' entities attached to the wall containing the calculated data (e.g., CORNER, JUNCTION1).",
          "12. Visualization: Configure Display object (Color, DimStyle) and draw text labels in 3D space based on the calculated data and 'dOffset'.",
          "13. Assignment: Assign the script instance to the element group."
        ],
        "conditionalBranches": [
          {
            "condition": "Connection Location relative to Wall Ends",
            "path1": {
              "name": "Corner Connection",
              "steps": [
                "Check if connection is within 20mm of Left or Right wall ends.",
                "Set 'sCorner' to 'L' or 'R'.",
                "Increment 'nCon' counter."
              ]
            },
            "path2": {
              "name": "Intermediate Junction",
              "steps": [
                "Calculate distance from wall origin to the connection point.",
                "Format distance string.",
                "Add to 'sJunction' array."
              ]
            }
          },
          {
            "condition": "Number of Corner Connections",
            "path1": {
              "name": "Single Corner",
              "steps": [
                "If 'nCon' <= 1, keep 'sCorner' as 'L' or 'R'."
              ]
            },
            "path2": {
              "name": "Multiple Corners / Ambiguity",
              "steps": [
                "If 'nCon' > 1, set 'sCorner' to 'L/R'."
              ]
            }
          },
          {
            "condition": "Opening Header Description Match",
            "path1": {
              "name": "Match Found",
              "steps": [
                "Iterate through 'ElemText' objects looking for code='WINDOW' and subCode='HEADER'.",
                "Find text closest to opening start location (within 10m).",
                "Assign text content to 'sOPLintelDesc'."
              ]
            },
            "path2": {
              "name": "No Match",
              "steps": [
                "If no matching text found nearby.",
                "Assign empty string to 'sOPLintelDesc'."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Color Index Range",
            "errorMessage": "None (Silent correction)",
            "recovery": "If 'nColor' < -1 or > 255, the script automatically resets 'nColor' to the default value 171 before drawing."
          },
          {
            "check": "Element Validity",
            "errorMessage": "None (Silent failure)",
            "recovery": "If the attached element is not a valid 'ElementWallSF' (bIsValid() returns false), the script erases itself to prevent errors."
          },
          {
            "check": "Selection Cancellation",
            "errorMessage": "None",
            "recovery": "If user cancels the 'PrEntity' selection (go() returns false), the script erases the manager instance without spawning workers."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Visual Properties",
            "how": "OPM (Object Properties Palette)",
            "effect": "Changing 'sDimStyle', 'nColor', or 'sDispRep' triggers a recalc. The visual labels update immediately with new font, color, or visibility settings. Changing 'dOffset' moves the labels vertically."
          },
          {
            "action": "Update Geometry",
            "how": "Modify Wall (e.g., Stretch, Add Opening)",
            "effect": "hsbCAD triggers the script automatically. Connection logic re-evaluates corners/junctions. Opening lists update (new openings added, old removed) and labels redraw."
          },
          {
            "action": "Update Header Text",
            "how": "Modify 'ElemText' associated with the window (Header description)",
            "effect": "The script re-scans for text codes 'WINDOW'/'HEADER' and updates the 'Header Desc' label and the corresponding 'OPLINTELDESC' export data."
          }
        ]
      },
      "tokens_used": 7997,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ExtraElementData.mcr\n\n## Overview\nThis script analyzes wall elements to calculate geometric metadata such as corner types (Left/Right), junction locations, and opening dimensions. It labels this information visually in the model and attaches invisible data attributes to the element for use in exports or production lists.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be inserted in the model where Wall Elements exist. |\n| Paper Space | No | Not designed for Paper Space or layout views. |\n| Shop Drawing | No | Not applicable for shop drawing generation. |\n\n## Prerequisites\n- **Required entities**: Wall Elements (`ElementWallSF`).\n- **Minimum beam count**: 0 (Script operates on Wall Elements, not individual beams).\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_ExtraElementData.mcr`\n\n### Step 2: Configure Properties\nA Properties dialog appears automatically upon insertion.\n**Action**: Set the desired Dimension Style, Text Color, and Line Offset. Click OK to proceed.\n\n### Step 3: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the Wall Elements you wish to analyze and press Enter.\n```\n\n### Step 4: Processing\nThe script will automatically attach to the selected walls, draw the text labels displaying the calculated data, and populate the element attributes.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| DimStyle | dropdown | \"\" | Selects the dimension style (font, text size) for the labels. Choose an available style from the list or leave blank for the default style. |\n| Show In Display Rep | text | \"\" | Limits the visibility of the labels to specific Display Representations (e.g., \"Plan\", \"Section\"). Leave empty to show labels in all views. |\n| Set the Text Color | number | 171 | Determines the color of the text labels. Valid values are 0-255 (AutoCAD Color Index). |\n| Offset Between Lines | number | 100 | Sets the vertical spacing between lines of text. Increase this value if the labels overlap. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are added by this script. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Overlapping Text**: If your wall has many openings or junctions, the text labels might overlap. Increase the **Offset Between Lines** property to space them out vertically.\n- **View Clutter**: If the labels are too distracting in 3D views, type a Display Representation name (like \"Plan\") in the **Show In Display Rep** property. This will hide the labels unless you are viewing that specific representation.\n- **Updating Data**: If you modify the wall geometry (e.g., stretch the wall or add an opening), the script will automatically recalculate the data and update the labels.\n- **Export Data**: The script attaches specific attribute codes (like `CORNER`, `JUNCTION1`, `OPWIDTH1`) to the element. These can be used in lists or BIM exports even if you hide the visual text labels.\n\n## FAQ\n- Q: Why can't I see the text labels?\n- A: Check the **Show In Display Rep** property. If it is set to a specific view type (e.g., \"Plan\"), you will only see the text when that display representation is active. If it is empty, check that the **Set the Text Color** is not set to the background color or that the wall is not on a frozen layer.\n- Q: How do I change the font size?\n- A: The text height is controlled by the **DimStyle** setting. Change the `sDimStyle` to a Dimension Style that has your preferred text height settings configured in AutoCAD/hsbCAD.\n- Q: What does \"L/R\" mean in the Corner Type label?\n- A: This indicates the wall has connections at both the Left and Right ends. If it shows \"L\", it is only connected on the Left."
      },
      "tokens_used": 6096,
      "error": null
    }
  }
}