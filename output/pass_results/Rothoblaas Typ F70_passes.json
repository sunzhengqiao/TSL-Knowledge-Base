{
  "filename": "Rothoblaas Typ F70.mcr",
  "status": "completed",
  "total_tokens": 36732,
  "processing_time": 194.03158235549927,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 7710,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly uses `_kModelSpace` in the `dbCreate` function call. No calls to `_Viewport`, `sd_*` functions, or multipage logic are present. The script interacts directly with `GenBeam` entities (via `Beam` casting) and creates `Body` geometry within the model."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Beam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 4023,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity (Beam)",
              "promptOriginal": "|Select Beam(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "|Select Point| |or <Enter> to put post base on bottom end of the beam|",
              "condition": "_bOnInsert",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "Insertion (_bOnInsert)",
            "title": null,
            "dataSource": "Internal TSL Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSize",
            "type": "PropString",
            "displayName": "A - |Size|",
            "defaultValue": "F70_1",
            "inputType": "dropdown",
            "options": [
              "F70_1",
              "F70_2",
              "F70_3"
            ],
            "category": "|Mounting|",
            "description": null
          },
          {
            "index": 0,
            "variable": "dCuttingHeight",
            "type": "PropDouble",
            "displayName": "B - |Cutting height|",
            "defaultValue": "30",
            "inputType": "number",
            "options": [],
            "category": "|Mounting|",
            "description": "|Defines the starting height of the post over the bottom plate of the post base|"
          },
          {
            "index": 1,
            "variable": "dSlotExtraWidth",
            "type": "PropDouble",
            "displayName": "C - |Slot extra width|",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": "|Tooling|",
            "description": "|Extra width of the slot|"
          },
          {
            "index": 2,
            "variable": "dSlotExtraDepth",
            "type": "PropDouble",
            "displayName": "D - |Slot extra depth|",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": "|Tooling|",
            "description": "|Extra depth of the slot|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5548,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "This script inserts and configures Rothoblaas F70 post bases onto timber beams, including the necessary geometric cuts and slots for installation.",
          "category": "Hardware",
          "typicalUseCase": "A user needs to attach a timber post to a concrete foundation or floor using a specific Rothoblaas F70 adjustable column base."
        },
        "parameters": [
          {
            "name": "sSize",
            "technicalDefault": "\"F70_1\"",
            "businessMeaning": "Selects the specific model variant of the Rothoblaas F70 post base, which determines the physical dimensions of the hardware (plate sizes, thickness, and thread diameter).",
            "validRange": "F70_1, F70_2, F70_3",
            "unit": "Enum",
            "affectsOutput": "Updates the geometric dimensions of the 3D body representation, adjusts the size of the cut and slot in the timber, and modifies the Bill of Materials (hardware list) to reflect the correct article number and screw size."
          },
          {
            "name": "dCuttingHeight",
            "technicalDefault": "30",
            "businessMeaning": "Defines the vertical offset from the bottom of the post base where the timber beam is cut (or trimmed). This effectively controls how much the timber overlaps the vertical 'sword' of the base plate.",
            "validRange": "1 mm to (TopPlateLength / 2)",
            "unit": "mm",
            "affectsOutput": "Moves the point where the timber beam is severed. A lower value means the beam sits closer to the bottom plate, while a higher value means it sits higher up on the vertical sword. It is clamped to a maximum of half the sword length to ensure structural integrity."
          },
          {
            "name": "dSlotExtraWidth",
            "technicalDefault": "1",
            "businessMeaning": "Adds a tolerance (play) to the width of the slot machined into the timber. This allows for easier assembly of the post base onto the timber beam.",
            "validRange": "0 mm to 5 mm",
            "unit": "mm",
            "affectsOutput": "Widens the slot cut into the timber beam."
          },
          {
            "name": "dSlotExtraDepth",
            "technicalDefault": "1",
            "businessMeaning": "Adds a tolerance (play) to the depth (length along the beam) of the slot machined into the timber. This ensures the slot is deep enough to accommodate the base plate and mounting mechanism without obstruction.",
            "validRange": "0 mm to 10 mm",
            "unit": "mm",
            "affectsOutput": "Lengthens the slot cut into the timber beam along its X-axis."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sSize changes",
            "effect": "Changes the maximum allowed value for dCuttingHeight (half the new TopPlateLength).",
            "cascade": [
              "dCuttingHeight"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Cut",
            "description": "A planar cut perpendicular to the beam axis to shorten the timber to the specified height.",
            "appliedTo": "Selected Beam(s)"
          },
          {
            "type": "Slot",
            "description": "A rectangular slot in the timber to accommodate the vertical sword and mounting plate of the hardware.",
            "appliedTo": "Selected Beam(s)"
          },
          {
            "type": "Body (Visual)",
            "description": "A 3D representation of the Rothoblaas F70 steel post base (bottom plate and vertical sword) for visualization and clash detection.",
            "appliedTo": "Model Space"
          },
          {
            "type": "Hardware",
            "description": "BOM entries for the Post Base bracket and the required anchoring screws.",
            "appliedTo": "Script Instance"
          }
        ]
      },
      "tokens_used": 6218,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch script via command or catalog insertion.",
          "2. Check for execution key; if exists, load properties from catalog, otherwise show 'showDialog' to configure properties (Size, Cutting Height, Slot Extras).",
          "3. Prompt user to select Beam(s) (PrEntity).",
          "4. Prompt user to select an Insertion Point (PrPoint). User can press Enter to skip point selection.",
          "5. Validate selected beams based on Point selection mode:",
          "   - If NO Point selected: Filter out any beams that are NOT vertical.",
          "   - If Point selected: Filter out any beams that ARE horizontal.",
          "6. Iterate through remaining valid beams to determine insertion coordinates:",
          "   - If NO Point selected: Calculate insertion point at the bottom center of the beam.",
          "   - If Point selected: Project the selected point onto the X-axis of the beam.",
          "7. Create a new TSL instance on each valid beam at the calculated coordinates.",
          "8. The original temporary instance is erased.",
          "9. Script executes logic for new instances: Validate 'Cutting Height' (clamp to max 50% of TopPlateLength).",
          "10. Generate geometry: Create Cut (perpendicular to beam), Create Slot (for the 'sword'), Create Body (visual steel).",
          "11. Generate Hardware entries (BOM) for the post base and screws."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Key present during Insertion",
            "path1": {
              "name": "Catalog Load",
              "steps": [
                "Read properties from matching catalog entry.",
                "Proceed to Beam Selection."
              ]
            },
            "path2": {
              "name": "Manual Input",
              "steps": [
                "Open 'showDialog' for user to select properties.",
                "Proceed to Beam Selection."
              ]
            }
          },
          {
            "condition": "Insertion Point Selected",
            "path1": {
              "name": "No Point (Enter pressed)",
              "steps": [
                "Set flag 'nNoPoint = 1'.",
                "Filter selection to keep only Vertical beams.",
                "Calculate insertion point at bottom of beam (-0.5 * Length in Z-World).",
                "Post Base always points downwards."
              ]
            },
            "path2": {
              "name": "Point Selected",
              "steps": [
                "Store 'ptSelect'.",
                "Filter selection to remove Horizontal beams.",
                "Project 'ptSelect' onto beam X-axis to find insertion point.",
                "Allows sloped beams or upside-down installation."
              ]
            }
          },
          {
            "condition": "Property 'sSize' change",
            "path1": {
              "name": "Default/Existing",
              "steps": [
                "Use current dimension arrays (Thickness, Length, Diameter)."
              ]
            },
            "path2": {
              "name": "Updated",
              "steps": [
                "Select new array indices based on size string.",
                "Update max Cutting Height limit.",
                "Regenerate Body and Hardware (if _kNameLastChangedProp triggers)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "dCuttingHeight value vs. Hardware Geometry",
            "errorMessage": "'Cutting height out of range (> Sword length / 2) --> Value corrected to [MaxValue]mm'",
            "recovery": "Script automatically resets the value to the maximum allowed (50% of TopPlateLength) and continues execution."
          },
          {
            "check": "Beam Orientation (No Point Mode)",
            "errorMessage": "'Only vertical beams possible --> N Beams filtered out'",
            "recovery": "Script removes non-vertical beams from the selection set and continues with the remaining valid beams."
          },
          {
            "check": "Beam Orientation (Point Mode)",
            "errorMessage": "'Horizontal beams not possible --> N Beams filtered out'",
            "recovery": "Script removes horizontal beams from the selection set and continues with the remaining valid beams."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Size (A - Size)",
            "how": "OPM Properties Palette",
            "effect": "Updates the 3D Body dimensions, Slot geometry, Cut position (if constrained), and Hardware BOM details."
          },
          {
            "action": "Adjust Cutting Height (B - Cutting height)",
            "how": "OPM Properties Palette",
            "effect": "Moves the Cut plane along the beam axis, effectively changing the remaining length of the timber post. Value is clamped if too high."
          },
          {
            "action": "Modify Tolerances (C & D - Slot extra width/depth)",
            "how": "OPM Properties Palette",
            "effect": "Adjusts the size of the Slot operation in the timber to increase clearance for the steel hardware."
          },
          {
            "action": "Move Instance",
            "how": "Grip Edit (Entity Handles)",
            "effect": "Moving the script origin (_Pt0) along the beam shifts the location of the cut and the base body."
          }
        ]
      },
      "tokens_used": 7562,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Rothoblaas Typ F70.mcr\n\n## Overview\nThis script inserts and configures Rothoblaas F70 post bases onto timber beams, including the necessary geometric cuts and slots for installation. It is used to attach timber posts to foundations using the specific F70 adjustable column base hardware.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the 3D model. |\n| Paper Space | No | Not supported for layout views. |\n| Shop Drawing | No | Not a drawing generation script. |\n\n## Prerequisites\n- **Required Entities**: Timber Beams (GenBeam).\n- **Minimum Beam Count**: 1.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Rothoblaas Typ F70.mcr`\n\n### Step 2: Configure Parameters (If prompted)\n```\nAction: A dialog may appear to select the Size.\nOptions: Select from F70_1, F70_2, or F70_3.\nAction: Click OK to confirm.\n```\n*(Note: If loaded from a catalog with predefined settings, this step may be skipped.)*\n\n### Step 3: Select Beams\n```\nCommand Line: Select Beam(s)\nAction: Click on the timber beam(s) where you want to install the post base.\nAction: Press Enter to finish selection.\n```\n\n### Step 4: Define Insertion Point\n```\nCommand Line: Select Point |or <Enter> to put post base on bottom end of the beam|\nAction:\nOption A (Automatic): Press Enter. The script will place the base at the bottom center of the beam. (Note: Only vertical beams are accepted in this mode).\nOption B (Manual): Click a point in the model to define the exact location of the post base along the beam.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| A - Size | dropdown | F70_1 | Selects the model variant of the Rothoblaas F70 post base (determines dimensions and hardware list). Options: F70_1, F70_2, F70_3. |\n| B - Cutting height | number | 30 | Defines the starting height of the post over the bottom plate of the post base. (Unit: mm) |\n| C - Slot extra width | number | 1 | Adds tolerance (extra width) to the slot cut into the timber. (Unit: mm) |\n| D - Slot extra depth | number | 1 | Adds tolerance (extra depth) to the slot cut into the timber. (Unit: mm) |\n\n## Right-Click Menu Options\nNone specified.\n\n## Settings Files\nNone required.\n\n## Tips\n- **Vertical Beams**: If you press **Enter** instead of selecting a point, the script will automatically filter out and ignore any beams that are not perfectly vertical.\n- **Sloped Beams**: If you need to attach a post base to a sloped or rafter beam, you must manually select a point on the beam (Step 4, Option B).\n- **Cutting Height Limit**: The script automatically limits the \"Cutting height\" to a maximum of 50% of the hardware's top plate length. If you enter a value that is too high, the script will automatically correct it to the maximum allowed value.\n\n## FAQ\n- **Q: Why did the script ignore some of the beams I selected?**\n  **A:** The script automatically filters beams based on your input method. If you pressed \"Enter\" (Automatic mode), it removes non-vertical beams. If you selected a point (Manual mode), it removes horizontal beams.\n- **Q: Why did my \"Cutting height\" value change after I entered it?**\n  **A:** The value you entered likely exceeded the maximum structural limit (50% of the hardware length). The script automatically corrected this to the maximum safe value to prevent errors."
      },
      "tokens_used": 5671,
      "error": null
    }
  }
}