{
  "filename": "hsbBeam-HalfCut.mcr",
  "status": "completed",
  "total_tokens": 48004,
  "processing_time": 187.71073818206787,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9334,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of _kModelSpace in tslNew.dbCreate(), manipulation of Beam objects (getBeam), and 3D geometric operations (Body, HalfCut). No sd_ prefix, _Viewport usage, or #Type E logic found."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D environment)",
          "requiredSettings": []
        }
      },
      "tokens_used": 6514,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && _kExecuteKey empty",
              "required": false
            },
            {
              "step": 2,
              "function": "getBeam",
              "promptOriginal": "|Select the Beam|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "|Select first point|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 4,
              "function": "getPoint",
              "promptOriginal": "|Select second point|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dDepthCut",
            "type": "PropDouble",
            "displayName": "Depth",
            "defaultValue": "U(70)",
            "inputType": "number",
            "options": [],
            "category": "Cut",
            "description": "Defines the cut Depth"
          },
          {
            "index": 1,
            "variable": "dAngleCut",
            "type": "PropDouble",
            "displayName": "Angle",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "Cut",
            "description": "Defines the cut angle"
          },
          {
            "index": 0,
            "variable": "sSideOfCut",
            "type": "PropString",
            "displayName": "Side",
            "defaultValue": "middle",
            "inputType": "dropdown",
            "options": [
              "middle",
              "left",
              "right"
            ],
            "category": "Cut",
            "description": "Defines the side Of Cut"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "change direction of cut depth",
            "handler": "|change direction of cut depth|",
            "action": "Flips the orientation of the cut depth vector and updates the grip point position.",
            "alsoTriggeredBy": "Double-click"
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9174,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a custom angled slot or trench (HalfCut) on a beam face, defined by a user-picked segment, with controls for depth, bevel angle, and saw blade kerf alignment.",
          "category": "Machining/Processing",
          "typicalUseCase": "Creating housing slots for perpendicular beams, notching for connection plates, or angled cuts on the top/bottom/side faces of timber elements where standard end cuts are insufficient."
        },
        "parameters": [
          {
            "name": "dDepthCut",
            "technicalDefault": "U(70)",
            "businessMeaning": "The perpendicular depth of the cut measured from the beam face into the material.",
            "validRange": "1mm to full section depth of the beam",
            "unit": "mm",
            "affectsOutput": "Controls how far the saw cuts into the beam. Increasing this value deepens the slot/trench."
          },
          {
            "name": "dAngleCut",
            "technicalDefault": "U(0)",
            "businessMeaning": "The tilt or bevel angle of the cut along the axis of the cut line (the line defined by the two picked points).",
            "validRange": "-80 to 80 degrees",
            "unit": "degrees",
            "affectsOutput": "Rotates the cut plane around the cut axis. 0 degrees creates a vertical cut (perpendicular to the surface if not angled), while non-zero values create a sloped or chamfered cut profile."
          },
          {
            "name": "sSideOfCut",
            "technicalDefault": "middle",
            "businessMeaning": "Determines the alignment of the saw blade thickness (kerf) relative to the line drawn by the user.",
            "validRange": "middle, left, right",
            "unit": "enum",
            "affectsOutput": "'Middle' centers the 6mm saw cut on the drawn line. 'Left' or 'Right' offsets the cut so the drawn line represents the edge of the blade cut. Essential for precise fitting of adjoining parts."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing the Angle (dAngleCut)",
            "effect": "Rotates the depth vector, effectively moving the bottom of the cut. The depth point (Grip 2) shifts position to maintain the set depth at the new angle.",
            "cascade": [
              "PtG[2]"
            ]
          },
          {
            "trigger": "Dragging Depth Grip (PtG[2])",
            "effect": "Recalculates the Depth (dDepthCut) property based on the new distance of the grip from the surface line. Also flips the cut orientation if dragged past the surface plane.",
            "cascade": [
              "dDepthCut",
              "vecOrientation"
            ]
          },
          {
            "trigger": "Moving Start/End Points (PtG[0]/PtG[1])",
            "effect": "Updates the cut axis and recenters the reference point (Pt0). The geometry vectors are recalculated.",
            "cascade": [
              "Pt0",
              "vecXCut",
              "vecYCut",
              "vecZCut"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "HalfCut",
            "description": "A machining operation that removes material from the beam. It is defined by a start point, direction vectors (normal and depth), and length.",
            "appliedTo": "The single GenBeam selected during insertion (_Beam[0])."
          }
        ]
      },
      "tokens_used": 8692,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script initiated via command or catalog",
          "Check if insertion cycle count > 1 (prevent duplicate insertions)",
          "[Insertion Only] Check for Execute Key (Catalog Entry)",
          "If Key exists: Load properties from Catalog",
          "If Key missing: Show Properties Dialog (silent/dialog)",
          "Prompt user to Select a Beam",
          "Validate Beam selection (Abort if invalid)",
          "Prompt user to Select first point (Start of cut)",
          "Prompt user to Select second point (End of cut)",
          "Calculate Beam geometry (Width, Height, Length, Planes)",
          "Identify the Beam face aligned with the UCS Z-axis",
          "Project user points onto the selected Beam face",
          "Store Geometry and Properties into new TSL Instance",
          "Erase temporary script instance",
          "Calculate Cut Geometry (Vectors, Origin, Depth)",
          "Apply Saw Blade Width offset (Middle/Left/Right)",
          "Generate HalfCut tool on Beam",
          "Draw visual feedback lines"
        ],
        "conditionalBranches": [
          {
            "condition": "Property 'Angle' modified",
            "path1": {
              "name": "Angle within +/- 80 degrees",
              "steps": [
                "Accept new Angle",
                "Recalculate cut vectors (Y and Z rotated)",
                "Update Grip Point 2 (Depth point) position",
                "Regenerate HalfCut"
              ]
            },
            "path2": {
              "name": "Angle exceeds +/- 80 degrees",
              "steps": [
                "Reset Angle to 80.0",
                "Display error: 'angles larger then (+-)80 degrees not accepted'",
                "Abort angle change"
              ]
            }
          },
          {
            "condition": "Start/End Points (PtG[0]/PtG[1]) modified",
            "path1": {
              "name": "Standard Move",
              "steps": [
                "Project points to current cut plane",
                "Recalculate Cut Axis (vecX)",
                "Update Origin Point (Pt0)",
                "Recalculate Depth Vector (vecZ) with current Angle",
                "Update Depth Grip (PtG[2]) position"
              ]
            }
          },
          {
            "condition": "Depth Grip (PtG[2]) dragged",
            "path1": {
              "name": "Standard Drag",
              "steps": [
                "Project grip to cut line",
                "Update 'Depth' property based on distance from Origin",
                "Regenerate HalfCut"
              ]
            },
            "path2": {
              "name": "Drag past surface (Flip orientation)",
              "steps": [
                "Project grip to cut line",
                "Update 'Depth' property",
                "Toggle 'vecOrientation' flag",
                "Flip Cut Normal vector",
                "Regenerate HalfCut"
              ]
            }
          },
          {
            "condition": "Context Menu 'change direction of cut depth' or Double-click",
            "path1": {
              "name": "Execute Flip",
              "steps": [
                "Toggle 'vecOrientation' flag",
                "Move Depth Grip (PtG[2]) to opposite side of cut plane",
                "Trigger recalculation loop"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection",
            "errorMessage": "select first a beam",
            "recovery": "User must select a valid GenBeam object"
          },
          {
            "check": "Beam Plane Detection",
            "errorMessage": "unexpected error",
            "recovery": "Script erases instance; user must restart insertion and ensure UCS Z-axis aligns with a beam face"
          },
          {
            "check": "Angle Property",
            "errorMessage": "angles larger then (+-)80 degrees not accepted",
            "recovery": "Property is automatically reset to 80.0"
          },
          {
            "check": "Post-insertion Beam Existence",
            "errorMessage": "no beam selected",
            "recovery": "Script erases instance if associated beam is missing"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Cut Depth",
            "how": "Drag Grip Point 2 (Depth Handle) or Edit 'Depth' Property (OPM)",
            "effect": "Deepens or shallows the cut. Dragging past the surface flips the cut direction."
          },
          {
            "action": "Change Cut Length/Position",
            "how": "Drag Grip Point 0 or 1 (Start/End)",
            "effect": "Moves the start or end of the cut along the beam face plane."
          },
          {
            "action": "Change Cut Angle",
            "how": "Edit 'Angle' Property (OPM)",
            "effect": "Rotates the cut plane around the cut axis (bevel)."
          },
          {
            "action": "Flip Cut Direction",
            "how": "Double-click entity or Context Menu > 'change direction of cut depth'",
            "effect": "Flips the cut to the opposite side of the surface plane."
          },
          {
            "action": "Adjust Saw Kerf Alignment",
            "how": "Edit 'Side' Property (OPM) [middle, left, right]",
            "effect": "Offsets the cut laterally relative to the drawn line to account for saw blade thickness (6mm)."
          }
        ]
      },
      "tokens_used": 9063,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbBeam-HalfCut\n\n## Overview\nCreates a custom angled slot or trench (HalfCut) on a beam face based on user-picked points. It allows precise control over the cut depth, bevel angle, and saw blade thickness alignment (kerf).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates in the 3D environment. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | This is a model generation tool. |\n\n## Prerequisites\n- **Required Entities**: A single existing timber beam (GenBeam).\n- **Minimum Beam Count**: 1\n- **Required Settings**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsbBeam-HalfCut.mcr`\n\n### Step 2: Select the Beam\n```\nCommand Line: Select the Beam\nAction: Click on the beam in the model where you want to apply the cut.\n```\n\n### Step 3: Define Start Point\n```\nCommand Line: Select first point\nAction: Click on the beam face to define the start position of the cut.\n```\n\n### Step 4: Define End Point\n```\nCommand Line: Select second point\nAction: Click on the beam face to define the end position of the cut.\n```\n\n*Note: The UCS Z-axis should generally align with the face you are working on for best results.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Depth | number | 70 mm | Defines how deep the cut goes into the material (perpendicular to the face). |\n| Angle | number | 0° | Defines the bevel/tilt angle of the cut along its axis. Valid range is -80° to 80°. |\n| Side | dropdown | middle | Determines how the 6mm saw blade thickness aligns with the drawn line. Options: `middle` (centered on line), `left`, or `right` (offset to edge of line). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| change direction of cut depth | Flips the cut to the opposite side of the surface plane. This also updates the position of the depth grip. (Can also be triggered by double-clicking the element). |\n\n## Settings Files\n- **Filename**: None detected.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Grip Editing**: After insertion, use the visual grips to adjust the cut. Drag the Start/End points to resize the slot, and drag the Depth Handle (Grip 2) to change the depth.\n- **Flipping the Cut**: You can quickly flip the cut direction by double-clicking the script entity or using the right-click context menu.\n- **Saw Kerf**: If you need the cut to align perfectly with an adjacent part, change the \"Side\" property to `left` or `right` to offset the 6mm saw blade thickness.\n- **Angle Limits**: The system prevents angles greater than +/- 80 degrees to maintain geometric validity. If you enter a larger value, it will automatically reset to 80 degrees.\n\n## FAQ\n- **Q: Can I change the cut angle after insertion?**\n  - A: Yes, select the element and change the \"Angle\" property in the Properties Palette (OPM).\n- **Q: What happens if I drag the depth grip too far?**\n  - A: If you drag the depth grip past the surface plane (through the beam), the cut orientation will automatically flip to the other side.\n- **Q: Why did my angle change to 80?**\n  - A: The script restricts angles to a maximum of +/- 80 degrees. Any value entered outside this range is automatically clamped."
      },
      "tokens_used": 5227,
      "error": null
    }
  }
}