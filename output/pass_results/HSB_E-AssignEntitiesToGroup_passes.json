{
  "filename": "HSB_E-AssignEntitiesToGroup.mcr",
  "status": "completed",
  "total_tokens": 34366,
  "processing_time": 701.6779670715332,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 2,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "07-06-2018",
            "author": "RP",
            "changes": "Pilot version."
          },
          {
            "version": "1.01",
            "date": "07-06-2018",
            "author": "RP",
            "changes": "set catolog from executekey"
          },
          {
            "version": "1.02",
            "date": "06-09-2018",
            "author": "RP",
            "changes": "Add entity selection"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "HSB_G-FilterEntities",
          "HSB_G-ContentFormat"
        ]
      },
      "tokens_used": 4695,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of '_kModelSpace' in collectEntities call; usage of Element object and assignToElementGroup; Group creation and management via Group().dbCreate(); No Shop Drawing specific prefixes (sd_) or properties (#Type E) found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Entity"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "HSB_G-FilterEntities",
            "HSB_G-ContentFormat"
          ]
        }
      },
      "tokens_used": 5591,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select a set of elements| |or <ENTER> to select entities|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select entities|",
              "condition": "_bOnInsert && (selection.length() == 0)",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "_bOnInsert && (_kExecuteKey is empty)",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "filterEntitiesCatalog",
            "type": "PropString",
            "displayName": "|Entity filter catalog|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "Catalogs from TSL: HSB_G-FilterEntities"
            ],
            "category": "|General|",
            "description": "|Select the catalog to filter the entities from the element|"
          },
          {
            "index": 1,
            "variable": "groupFormat",
            "type": "PropString",
            "displayName": "|Group format|",
            "defaultValue": "@(GroupLevel1)\\@(GroupLevel2)",
            "inputType": "text",
            "options": [],
            "category": "|General|",
            "description": "|Specify the format of the group to where the entities should be added||Please make sure to use \\ between the different group name parts|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6871,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically assigns selected entities or element contents to specific drawing groups based on configurable naming formats and filter criteria, facilitating model organization and data extraction.",
          "category": "Organization",
          "typicalUseCase": "Grouping specific sub-assemblies (like studs or purlins) of a wall or roof element into named groups for export, BIM coordination, or scheduling."
        },
        "parameters": [
          {
            "name": "filterEntitiesCatalog",
            "technicalDefault": "",
            "businessMeaning": "Defines the specific set of rules or criteria used to select which entities within the selected element should be processed.",
            "validRange": "Any catalog name defined in the TSL dependency 'HSB_G-FilterEntities'",
            "unit": "text",
            "affectsOutput": "Determines which entities are included in the group assignment. Only entities matching the catalog criteria are moved to the target group."
          },
          {
            "name": "groupFormat",
            "technicalDefault": "@(GroupLevel1)\\@(GroupLevel2)",
            "businessMeaning": "The template string used to dynamically generate the name of the destination group based on entity or element properties.",
            "validRange": "String values compatible with the 'HSB_G-ContentFormat' TSL (typically containing property tokens like @(Name) or @(Elevation) separated by \\).",
            "unit": "text",
            "affectsOutput": "Determines the exact name of the group entities are added to. If a group with this name does not exist, it is created."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing 'filterEntitiesCatalog'",
            "effect": "Changes the subset of entities available for grouping.",
            "cascade": [
              "Group Membership"
            ]
          },
          {
            "trigger": "Changing 'groupFormat'",
            "effect": "Recalculates the target Group name for every filtered entity.",
            "cascade": [
              "Group Name"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Group",
            "description": "Creates new Groups or updates existing Groups by adding the filtered entities to them.",
            "appliedTo": "Selected Entities or Entities contained within selected Elements in Model Space."
          }
        ]
      },
      "tokens_used": 4307,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Inserted or Executed",
          "[Conditional] Load Properties from ExecuteKey (if present) OR Show Properties Dialog",
          "Prompt User for Selection (Elements or <ENTER> for Entities)",
          "[Conditional] Branch based on User Input",
          "If Elements Selected: Clone script to each Element, Erase Launcher Instance",
          "If Entities Selected: Proceed with current instance",
          "Validate Entity Input (Abort if empty)",
          "[Conditional] If instance attached to Element: Collect all entities from Element's Group",
          "Execute 'HSB_G-FilterEntities' TSL to filter entities based on Catalog",
          "[Validation] Abort if Filtering TSL fails or is missing",
          "Loop through Filtered Entities",
          "Calculate Group Name using 'HSB_G-ContentFormat' TSL based on Group Format property",
          "Search for existing Group by Name",
          "If found: Add Entity to Existing Group",
          "If not found: Create New Group and Add Entity",
          "Loop until all entities processed",
          "[Conditional] Erase Script Instance (if ManualInsert or ElementConstructed)"
        ],
        "conditionalBranches": [
          {
            "condition": "Launch Method (ExecuteKey vs Manual)",
            "path1": {
              "name": "Catalog Insert",
              "steps": [
                "Read '_kExecuteKey'",
                "Load property values from specified Catalog"
              ]
            },
            "path2": {
              "name": "Manual/Dialog Insert",
              "steps": [
                "Execute 'showDialog()'",
                "User inputs settings manually"
              ]
            }
          },
          {
            "condition": "User Selection Type",
            "path1": {
              "name": "Element Selection",
              "steps": [
                "User picks Element(s)",
                "Script creates clones attached to selected Elements",
                "Launcher script erases itself",
                "Clones execute logic on their respective Elements"
              ]
            },
            "path2": {
              "name": "Entity Selection",
              "steps": [
                "User presses <ENTER> at Element prompt",
                "User picks Entities",
                "Script executes logic directly on selected Entities"
              ]
            }
          },
          {
            "condition": "Group Existence",
            "path1": {
              "name": "Group Exists",
              "steps": [
                "Find Group object by name",
                "Add entity to this Group"
              ]
            },
            "path2": {
              "name": "Group Missing",
              "steps": [
                "Create new Group instance",
                "Set Group Name",
                "dbCreate() the Group",
                "Add entity to new Group"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insert Cycle Count",
            "errorMessage": null,
            "recovery": "Script automatically erases itself if insertCycleCount > 1 to prevent duplication."
          },
          {
            "check": "User Selection",
            "errorMessage": "No Entities found.",
            "recovery": "Script erases itself; user must restart and select valid objects."
          },
          {
            "check": "TSL Dependency: HSB_G-FilterEntities",
            "errorMessage": "Beams could not be filtered! Make sure that the tsl HSB_G-FilterEntities is loaded in the drawing.",
            "recovery": "Load the required TSL dependency into the drawing and retry."
          },
          {
            "check": "TSL Dependency: HSB_G-ContentFormat",
            "errorMessage": "Please make sure that the tsl HSB_G-ContentFormat is loaded in the drawing",
            "recovery": "Load the required TSL dependency; otherwise Group Name will be empty and entity skipped."
          },
          {
            "check": "Generated Group Name",
            "errorMessage": null,
            "recovery": "If Group Name is empty string, the entity is silently skipped (not assigned to any group)."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties (OPM)",
            "how": "Select the script instance (if persistent) or re-execute command to change 'Entity filter catalog' or 'Group format'.",
            "effect": "Triggers recalculation of the filter set and target group names, reorganizing entities into different groups."
          }
        ]
      },
      "tokens_used": 7802,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-AssignEntitiesToGroup.mcr\n\n## Overview\nThis script automates the organization of your model by assigning selected entities (or the contents of an entire element) to specific drawing groups. It uses configurable naming formats and filter criteria to sort items into groups for exporting, scheduling, or BIM coordination.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in Model Space. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not intended for use within shop drawings. |\n\n## Prerequisites\n- **Required Entities:** Existing Elements (Walls/Roofs) or specific Entities (Beams/Plates) in the model.\n- **Minimum Beams:** 0.\n- **Required Settings/Dependencies:** The following TSL scripts must be loaded in your drawing:\n  - `HSB_G-FilterEntities` (Used to define which entities to select).\n  - `HSB_G-ContentFormat` (Used to format the group names).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_E-AssignEntitiesToGroup.mcr`\n\n### Step 2: Configure Properties\nOnce inserted, the **Properties Palette** will open. You must configure the following before proceeding:\n1. **Entity filter catalog:** Select a catalog from the dropdown. This determines *which* entities inside the element will be assigned (e.g., only studs, or only top plates).\n2. **Group format:** Enter a string defining the group name structure (e.g., `@(GroupLevel1)\\@(GroupLevel2)`). Use `\\` to create sub-groups.\n\n### Step 3: Select Input Method\nThe command line will prompt:\n```\nSelect a set of elements | or <ENTER> to select entities\n```\n- **Option A (Element Mode):** Click on an Element (like a wall). The script will attach to that element and process all entities inside it that match your filter.\n- **Option B (Entity Mode):** Press `<ENTER>` on your keyboard. The command line changes to:\n  ```\n  Select entities\n  ```\n  Click specifically on the beams or bodies you want to organize.\n\n### Step 4: Execution\nThe script will automatically filter the selected items, calculate the group names based on your format, and move the entities into the specified groups. If a group does not exist, it will be created.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Entity filter catalog | Dropdown | *Empty* | Select the predefined rule set (from `HSB_G-FilterEntities`) that determines which entities are processed. |\n| Group format | Text | @(GroupLevel1)\\@(GroupLevel2) | Defines the name of the group the entities will be added to. Use tokens like `@(Name)` and separate levels with a backslash `\\`. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add custom items to the right-click menu. Modify settings via the Properties Palette. |\n\n## Settings Files\n- **Filename:** None specified.\n- **Location:** N/A\n- **Purpose:** This script relies on the logic within the dependency TSLs (`HSB_G-FilterEntities` and `HSB_G-ContentFormat`) rather than external XML settings files.\n\n## Tips\n- **Creating Sub-groups:** Always use the backslash symbol `\\` in your **Group format** string (e.g., `Floor1\\Walls`) to create a nested group structure in the tree.\n- **Troubleshooting:** If the script reports that it \"could not filter entities,\" ensure that the `HSB_G-FilterEntities` TSL is loaded into your drawing via the TSL Script Load Manager.\n- **Manual Selection:** If you only want to organize specific parts of a wall (e.g., just the opening trim), use the **Entity Mode** (Press `<ENTER>` at the first prompt) and pick the items manually.\n\n## FAQ\n- **Q: I ran the script but nothing happened. Why?**\n  A: Check the command line for error messages. The most common cause is missing dependencies. Ensure `HSB_G-FilterEntities` and `HSB_G-ContentFormat` are loaded. Also, verify that your filter catalog actually returns results (e.g., if the filter looks for \"Steel\" but your element is \"Wood\", nothing will be selected).\n- **Q: Can I use this to group entities from different elements into one group?**\n  A: Yes. Use the Entity Mode (press `<ENTER>` at the prompt) and select entities from multiple different elements. They will all be assigned to the group name defined in your properties.\n- **Q: What happens if the group already exists?**\n  A: The script will find the existing group and simply add the new entities to it. It will not overwrite or delete the existing group."
      },
      "tokens_used": 5100,
      "error": null
    }
  }
}