{
  "filename": "HSB_E-EdgeDetailInformation.mcr",
  "status": "completed",
  "total_tokens": 51423,
  "processing_time": 628.0636744499207,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": 1,
          "minorVersion": 1,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl displays edge detail information",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "07.09.2018",
            "author": "AS",
            "changes": "First revision"
          },
          {
            "version": "1.01",
            "date": "31.10.2018",
            "author": "AS",
            "changes": "Improve insert. Automatically insert multiple instances if no edge is selected."
          }
        ],
        "settingsFiles": [
          "EdgeInformationConfigurations.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 7890,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script operates on _Element[0] and uses assignToElementGroup(..., 'E'). Uses Display object with elemZone() and addViewDirection() to filter visibility. No usage of _Viewport, sd_ prefixes, or #Type E macro definitions typical of ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Point3d (Grippoints)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space attached to an Element",
          "requiredSettings": [
            "EdgeInformationConfigurations.xml"
          ]
        }
      },
      "tokens_used": 6634,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "selectedEdgeConfiguration",
            "type": "PropString",
            "displayName": "Configuration name",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "Dynamically loaded from XML",
            "category": "Edge configuration",
            "description": null
          },
          {
            "index": 0,
            "variable": "offsetFromEdge",
            "type": "PropDouble",
            "displayName": "Offset from edge",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Position and Style",
            "description": null
          },
          {
            "index": 1,
            "variable": "horizontalOffset",
            "type": "PropDouble",
            "displayName": "Horizontal text offset",
            "defaultValue": "0",
            "inputType": "number",
            "options": [],
            "category": "Position and Style",
            "description": null
          },
          {
            "index": 2,
            "variable": "textSize",
            "type": "PropDouble",
            "displayName": "Text size",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": "Position and Style",
            "description": null
          },
          {
            "index": 0,
            "variable": "textColor",
            "type": "PropInt",
            "displayName": "Text color",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": "Position and Style",
            "description": null
          },
          {
            "index": 4,
            "variable": "onlyViewInElementElevationViewProp",
            "type": "PropString",
            "displayName": "Only show in elevation view",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Position and Style",
            "description": null
          },
          {
            "index": 1,
            "variable": "detailName",
            "type": "PropString",
            "displayName": "Detail name",
            "defaultValue": "@(VAR60)",
            "inputType": "text",
            "options": [],
            "category": "Detail",
            "description": null
          },
          {
            "index": 3,
            "variable": "dimStyleDetailName",
            "type": "PropString",
            "displayName": "Dimension style detail name",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "Sorted list of available dimension styles",
            "category": "Detail",
            "description": null
          },
          {
            "index": 3,
            "variable": "textSizeDetail",
            "type": "PropDouble",
            "displayName": "Text size detail",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": "Detail",
            "description": null
          },
          {
            "index": 1,
            "variable": "detailColor",
            "type": "PropInt",
            "displayName": "Detail color",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": "Detail",
            "description": null
          },
          {
            "index": 2,
            "variable": "detailLeader",
            "type": "PropString",
            "displayName": "Detail leader",
            "defaultValue": "No leader",
            "inputType": "dropdown",
            "options": [
              "No leader",
              "Line",
              "Circle",
              "Line with circle"
            ],
            "category": "Detail",
            "description": null
          },
          {
            "index": 4,
            "variable": "lineLength",
            "type": "PropDouble",
            "displayName": "Line length",
            "defaultValue": "300",
            "inputType": "number",
            "options": [],
            "category": "Detail",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Reload edge information configurations",
            "handler": "reloadEdgeInformationConfigurationsCommand",
            "action": "Reloads the XML configuration file from disk and updates the drawing dictionary. Backs up the existing configuration to AppData.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "EdgeInformationConfigurations.xml",
            "searchPaths": [
              "_kPathHsbCompany\\Tsl\\Settings"
            ],
            "purpose": "Stores the definitions for text configurations, including text content, alignment, zone indices, and row indices.",
            "required": true
          }
        ]
      },
      "tokens_used": 8839,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "An annotation script that displays text labels and detail markers on the edges of timber elements based on configurations defined in an external XML file.",
          "category": "ShopDrawing / Annotation",
          "typicalUseCase": "Adding edge-specific manufacturing notes (e.g., 'sawn finish', 'fire rating') or detail references (e.g., 'Detail A') to walls or floors directly in the 3D model or layout views."
        },
        "parameters": [
          {
            "name": "selectedEdgeConfiguration",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific set of pre-defined text notes to display along the edge (loaded from XML).",
            "validRange": "List of configurations defined in EdgeInformationConfigurations.xml",
            "unit": "Selection",
            "affectsOutput": "Determines the content, alignment, and number of text rows displayed near the element edge."
          },
          {
            "name": "offsetFromEdge",
            "technicalDefault": "0",
            "businessMeaning": "The distance between the physical edge of the timber element and the start of the text information.",
            "validRange": "0 to 500 mm",
            "unit": "mm",
            "affectsOutput": "Moves the block of text closer to or further away from the element."
          },
          {
            "name": "horizontalOffset",
            "technicalDefault": "0",
            "businessMeaning": "Shifts the text annotation parallel to the edge direction.",
            "validRange": "-1000 to 1000 mm",
            "unit": "mm",
            "affectsOutput": "Moves the text left or right along the edge relative to the insertion point."
          },
          {
            "name": "textSize",
            "technicalDefault": "-1",
            "businessMeaning": "The height of the edge information text characters. A value of -1 uses the default style height.",
            "validRange": "-1 (Default) or 1.5 to 10.0 mm",
            "unit": "mm",
            "affectsOutput": "Scale of the multi-line text block notes."
          },
          {
            "name": "textColor",
            "technicalDefault": "-1",
            "businessMeaning": "The CAD color index used for the edge information text. -1 typically defaults to ByLayer.",
            "validRange": "-1 (ByLayer) or 0-255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Visual color of the notes in the drawing."
          },
          {
            "name": "onlyViewInElementElevationViewProp",
            "technicalDefault": "Yes",
            "businessMeaning": "Restricts the visibility of the annotations to specific plan views (looking down/up the element Z-axis) rather than all views.",
            "validRange": "No, Yes",
            "unit": "Boolean",
            "affectsOutput": "Controls if the text disappears in 3D views or cross-sections where the edge logic doesn't apply."
          },
          {
            "name": "detailName",
            "technicalDefault": "@(VAR60)",
            "businessMeaning": "The label text inside the detail marker (e.g., '1', 'A', 'DET-01'). Often linked to a drawing variable.",
            "validRange": "Alphanumeric string",
            "unit": "String",
            "affectsOutput": "Content of the specific detail tag."
          },
          {
            "name": "dimStyleDetailName",
            "technicalDefault": "",
            "businessMeaning": "Selects the text style (font) used for the detail name from the available CAD dimension styles.",
            "validRange": "List of styles in current drawing",
            "unit": "Selection",
            "affectsOutput": "Font appearance of the detail tag."
          },
          {
            "name": "textSizeDetail",
            "technicalDefault": "-1",
            "businessMeaning": "The height of the detail marker text. -1 uses the dimension style default.",
            "validRange": "-1 (Default) or 2.5 to 10.0 mm",
            "unit": "mm",
            "affectsOutput": "Size of the detail tag and the circle surrounding it."
          },
          {
            "name": "detailColor",
            "technicalDefault": "-1",
            "businessMeaning": "The CAD color index for the detail marker (tag, leader line, and circle).",
            "validRange": "-1 (ByLayer) or 0-255",
            "unit": "Index",
            "affectsOutput": "Visual color of the detail marker components."
          },
          {
            "name": "detailLeader",
            "technicalDefault": "No leader",
            "businessMeaning": "The graphic style used to point to the edge.",
            "validRange": "No leader, Line, Circle, Line with circle",
            "unit": "Selection",
            "affectsOutput": "Draws a line, a circle, or both connecting the detail name to the anchor point."
          },
          {
            "name": "lineLength",
            "technicalDefault": "300",
            "businessMeaning": "The length of the leader line extending from the edge or circle.",
            "validRange": "0 to 1000 mm",
            "unit": "mm",
            "affectsOutput": "Length of the graphical line leader."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing detailLeader to 'No leader'",
            "effect": "The lineLength parameter is ignored visually as no line is drawn.",
            "cascade": [
              "lineLength"
            ]
          },
          {
            "trigger": "Setting textSize or textSizeDetail to -1",
            "effect": "The script uses the text height defined by the selected DimStyle rather than a fixed value.",
            "cascade": [
              "dimStyleDetailName"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Annotation (Text/PLine/Circle)",
            "description": "Generates 2D graphical entities (text strings, lines, and circles) in Model Space that represent edge notes and detail markers.",
            "appliedTo": "Element (Model Space)"
          }
        ]
      },
      "tokens_used": 9484,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Initialization\",\n    \"2. Define Constants and Context Menu Triggers (Reload Config)\",\n    \"3. Configuration Management (Check for XML file, Load/Create Dictionary)\",\n    \"4. Define OPM Properties (Text size, offsets, colors, configuration selection)\",\n    \"5. Insertion Phase Check\",\n    \"6. Input Acquisition (Retrieve Grippoints, Map Data, or DSP links)\",\n    \"7. Geometry Validation (Check for valid Grippoints)\",\n    \"8. Element Association (Link to _Element[0])\",\n    \"9. Coordinate System Calculation (Setup vectors based on edge and element orientation)\",\n    \"10. Configuration Selection (Lookup selected name in loaded configs)\",\n    \"11. Detail Marker Generation (Draw Line/Circle based on leader settings)\",\n    \"12. Text Generation (Loop through config texts, apply offsets and visibility filters)\",\n    \"13. Render to Display\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Configuration File Existence on Startup\",\n      \"path1\": {\n        \"name\": \"File Missing\",\n        \"steps\": [\n          \"Check if Settings folder exists (create if not)\",\n          \"Generate default 'Example Config' XML file\",\n          \"Load generated XML into Drawing Dictionary\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"File Exists\",\n        \"steps\": [\n          \"Check if Drawing Dictionary entry exists\",\n          \"If Dictionary empty: Load XML into Dictionary\",\n          \"If Dictionary valid: Use existing Dictionary data\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Execute Key / Context Menu Command\",\n      \"path1\": {\n        \"name\": \"Reload Configurations Command\",\n        \"steps\": [\n          \"Backup current Dictionary to AppData\",\n          \"Overwrite Dictionary with fresh XML data\",\n          \"Report success\",\n          \"Exit Script (Recalc)\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Normal Execution\",\n        \"steps\": [\n          \"Proceed to Property definitions and Geometry generation\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Insert Cycle Count\",\n      \"path1\": {\n        \"name\": \"Cycle 1 (Initial Insert)\",\n        \"steps\": [\n          \"Show Properties Dialog\",\n          \"Wait for user input\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Cycle > 1 (After Dialog Close)\",\n        \"steps\": [\n          \"Show Warning ('Only allow insert to create and edit catalog entries')\",\n          \"Erase Instance\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Detail Leader Setting\",\n      \"path1\": {\n        \"name\": \"Line (Index 1)\",\n        \"steps\": [\n          \"Calculate start offset based on text height\",\n          \"Draw leader line of specified length\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Circle (Index 2)\",\n        \"steps\": [\n          \"Calculate center and radius based on text size\",\n          \"Draw circle\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"Line with Circle (Index 3)\",\n        \"steps\": [\n          \"Calculate start offset (adjusted for radius)\",\n          \"Draw Circle\",\n          \"Draw leader line\"\n        ]\n      },\n      \"path4\": {\n        \"name\": \"No Leader (Index 0)\",\n        \"steps\": [\n          \"Skip line and circle generation\",\n          \"Draw only the detail name text\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Grippoint Availability\",\n      \"path1\": {\n        \"name\": \"Points Valid\",\n        \"steps\": [\n          \"Calculate Edge Vectors\",\n          \"Re-organize points to Detail Line vs Text Anchor\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No Points Found\",\n        \"steps\": [\n          \"Report Error ('No grippoints found')\",\n          \"Erase"
      },
      "tokens_used": 11251,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-EdgeDetailInformation.mcr\n\n## Overview\nThis script displays custom text annotations and detail markers on the edges of timber elements. It allows you to attach manufacturing notes, edge treatments, or drawing references (e.g., \"Detail A\") directly to an element in Model Space, based on configurations defined in an external XML file.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Attaches to Elements and uses Grippoints to position text on edges. |\n| Paper Space | No | Not designed for direct insertion in Layouts. |\n| Shop Drawing | No | This is a Model Space annotation tool. |\n\n## Prerequisites\n- **Required Entities**: An existing Timber Element (Wall, Floor, Roof).\n- **Minimum Beam Count**: 0 (Operates on Elements).\n- **Required Settings**: `EdgeInformationConfigurations.xml` (Located in the Company or Install `Tsl\\Settings` folder. A default file is generated automatically if missing).\n\n## Usage Steps\n\n### Step 1: Launch Script\n**Command**: `TSLINSERT`\n**Action**: Browse and select `HSB_E-EdgeDetailInformation.mcr`.\n\n### Step 2: Select Element\n```\nCommand Line: Select element:\nAction: Click on the timber element (wall/beam) you wish to annotate.\n```\n\n### Step 3: Select Edge Position\n```\nCommand Line: Specify point on element (Grippoint):\nAction: Click on the specific edge of the element where the information should appear. This serves as the anchor point for the text and leader.\n```\n\n### Step 4: Configure Properties\n**Action**: Press `Esc` to end the insertion command (if applicable) or select the newly created instance. Open the **Properties Palette** (Ctrl+1) to select a configuration and adjust the style settings.\n\n## Properties Panel Parameters\n\n### Edge Configuration\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Configuration name | dropdown | *Empty* | Selects the predefined text block to display (loaded from the XML configuration file). |\n\n### Position and Style (Text Block)\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Offset from edge | number | 0 | Distance between the element edge and the start of the text block (mm). |\n| Horizontal text offset | number | 0 | Shifts the text block parallel to the edge direction (mm). |\n| Text size | number | -1 | Height of the annotation text. Use `-1` to adopt the default text style height. |\n| Text color | number | -1 | Color index for the text. Use `-1` for \"ByLayer\". |\n| Only show in elevation view | dropdown | Yes | Controls visibility. If \"Yes\", text only appears in views looking along the element's Z-axis (plan/elevation) and hides in 3D isometric views. |\n\n### Detail Marker (Specific Tag)\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Detail name | text | @(VAR60) | The text label inside the detail marker (e.g., \"1\", \"A\", \"S1\"). Can use variable codes. |\n| Dimension style detail name | dropdown | *Current* | Selects the CAD Text/Dim Style for the detail tag. |\n| Text size detail | number | -1 | Height of the detail tag text. Use `-1` to match the selected Dimension Style. |\n| Detail color | number | -1 | Color index for the detail marker (text and leader). Use `-1` for \"ByLayer\". |\n| Detail leader | dropdown | No leader | Graphic style: \"No leader\", \"Line\", \"Circle\", or \"Line with circle\". |\n| Line length | number | 300 | Length of the leader line extending from the edge (mm). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Reload edge information configurations | Reloads the `EdgeInformationConfigurations.xml` file from disk. This is useful if you have manually edited the XML file to add new text presets while hsbCAD is running. |\n\n## Settings Files\n- **Filename**: `EdgeInformationConfigurations.xml`\n- **Location**: `..\\Tsl\\Settings` (Company or Install folder).\n- **Purpose**: Stores the library of text configurations. Each configuration defines the text content, alignment, and row structure for the edge labels.\n\n## Tips\n- **Default Text Size**: Leaving `Text size` or `Text size detail` as `-1` ensures the annotation automatically scales with your drawing's dimension styles.\n- **Visibility Control**: If you cannot see the annotation in a 3D view, check the \"Only show in elevation view\" property. Setting this to \"No\" makes the annotation visible in all views.\n- **Batch Insertion**: The script can automatically handle multiple edges if configured correctly, or you can insert multiple instances manually, one for each specific edge note.\n- **Creating Presets**: To add new text presets, edit the `EdgeInformationConfigurations.xml` file in a text editor and use the \"Reload\" context menu option to see them in hsbCAD.\n\n## FAQ\n- **Q: Why is my annotation not showing up?**\n  **A**: Check the \"Only show in elevation view\" property. If set to \"Yes\", switch to a Plan or Elevation view. Also, verify the \"Configuration name\" is actually selected in the properties palette.\n\n- **Q: How do I add custom text labels (e.g., \"Sawn Finish\")?**\n  **A**: You cannot type multi-line text directly into the properties. You must add a new entry to the `EdgeInformationConfigurations.xml` file defining that text, then select it from the dropdown.\n\n- **Q: What does the default \"@(VAR60)\" in the Detail name mean?**\n  **A**: This is a token that links to hsbCAD variable 60. It allows the detail name to be dynamically generated by the system (e.g., based on a sheet number) rather than being static text. You can overwrite this with static text like \"Detail 1\"."
      },
      "tokens_used": 7325,
      "error": null
    }
  }
}