{
  "filename": "GE_AB_DIMS.mcr",
  "status": "completed",
  "total_tokens": 46904,
  "processing_time": 208.2569179534912,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 4,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "Description",
        "versionHistory": [
          {
            "version": "1.04",
            "date": "02apr2020",
            "author": "david.rueda@hsbcad.com",
            "changes": " Renamed from GE_ANCHOR_DIMS  "
          },
          {
            "version": "1.03",
            "date": "09mar2020",
            "author": "david.rueda@hsbcad.com",
            "changes": " Adapted to better cashing of elements with their anchor sets + sending them as siblings groups to GE_ANCHOR_DIMS in order to aligning or staggering triggers "
          },
          {
            "version": "1.02",
            "date": "04mar2020",
            "author": "david.rueda@hsbcad.com",
            "changes": " Implemented work with XRefs. Search for anchors TSL now based on search for \"ANCHOR\" key instead of whole scriptNames  "
          },
          {
            "version": "1.01",
            "date": "03mar2020",
            "author": "david.rueda@hsbcad.com",
            "changes": " Allows use of XRefs  "
          },
          {
            "version": "1.00",
            "date": "03mar2020",
            "author": "david.rueda@hsbcad.com",
            "changes": " initial "
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "GE_AB_DIM"
        ]
      },
      "tokens_used": 8280,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getPoint() prompts for start/end points and inserts child TSL instances using tslNew.dbCreate() with the _kModelSpace constant. It interacts with GenBeam/Element entities in the model. No #Type E, sd_ prefixes, or _Viewport usage found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "ElementWall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "GE_AB_DIM"
          ]
        }
      },
      "tokens_used": 5933,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select walls|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "\nSelect start point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "\nSelect end point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 4,
              "function": "PrEntity",
              "promptOriginal": "|Select element(s) or just hit ENTER to continue (this operation will load new anchors from previous and new selected elements)|",
              "condition": "_bOnRecalc && _kExecuteKey == '|../Reload|'",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sAlignment",
            "type": "PropString",
            "displayName": "Alignment",
            "defaultValue": "Horizontal",
            "inputType": "dropdown",
            "options": [
              "Horizontal",
              "Vertical"
            ],
            "category": "General",
            "description": "Defines the Alignment"
          },
          {
            "index": 1,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": "General",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "../Reload",
            "handler": "|../Reload|",
            "action": "Prompts user to select elements to reload anchors from.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "../Hide Missing Anchors",
            "handler": "|../Hide Missing Anchors|",
            "action": "Toggles the visibility of missing anchors to hidden.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "../Show Missing Anchors",
            "handler": "|../Show Missing Anchors|",
            "action": "Toggles the visibility of missing anchors to shown.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "../Reset",
            "handler": "|../Reset|",
            "action": "Sets the reset flag.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "../Delete",
            "handler": "|../Delete|",
            "action": "Sets the delete flag.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9995,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A manager script that detects anchor points (hardware) within a user-defined rectangular area on selected walls and generates dimension markers for them.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used to automatically visualize and dimension the positions of anchor bolts or other hardware attached to wall panels within a specific layout zone or elevation."
        },
        "parameters": [
          {
            "name": "sAlignment",
            "technicalDefault": "Horizontal",
            "businessMeaning": "Specifies the primary orientation of the dimension line or the axis along which anchors are aligned/measured.",
            "validRange": "Horizontal, Vertical",
            "unit": "Option",
            "affectsOutput": "Determines the direction vector used to sort and align the anchor markers (Horizontal uses World X, Vertical uses World Y). It also sets the script layer (SNAP HOR vs SNAP VER)."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "Selects the CAD dimension style to be applied to the generated indicators and dimension lines.",
            "validRange": "Available DimStyles in the current drawing",
            "unit": "StyleName",
            "affectsOutput": "Changes the visual appearance (text size, arrow style, units) of the graphical elements drawn by the script and its child instances."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sAlignment changes",
            "effect": "Updates the layer assignment and calculation vector for anchor alignment.",
            "cascade": [
              "Layer",
              "Vector3d vDirection"
            ]
          },
          {
            "trigger": "sDimStyle changes",
            "effect": "Updates the dimension style property on existing child anchor markers.",
            "cascade": [
              "Child Map(sMapKeyDimStyle)"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TslInst (GE_AB_DIM)",
            "description": "Creates instances of the child script 'GE_AB_DIM' which act as individual dimension markers for each detected anchor point.",
            "appliedTo": "Model Space (relative to the detected anchor points on selected Element/Wall entities)."
          },
          {
            "type": "PLine/Hatch (Graphics)",
            "description": "Draws a visual representation of the selection region (rectangle with cross and circle) to indicate the active area.",
            "appliedTo": "Model Space."
          }
        ]
      },
      "tokens_used": 7508,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script start: Unit check and debug flag initialization.",
          "Check Insert State: Is the script being inserted (_bOnInsert)?",
          "Insertion Branch: Select catalog entry or show dialog.",
          "Insertion Branch: Prompt for wall elements (PrEntity).",
          "Insertion Branch: Prompt for Start Point (getPoint).",
          "Insertion Branch: Loop for End Point input (PrPoint).",
          "Insertion End: Store initial map and exit.",
          "Check Trigger: Is '../Reload' active?",
          "Reload Branch: Prompt for additional elements and append to internal list.",
          "Check Trigger: Is '../Hide Missing Anchors' or '../Show Missing Anchors' active?",
          "Toggle Visibility Branch: Flip boolean in map, set loop count to 2, exit.",
          "Check Trigger: Is '../Reset' or '../Delete' active?",
          "Reset/Delete Branch: Set flag.",
          "Property Resolution: Read OPM properties (Alignment, DimStyle).",
          "Geometry Validation: Check if 2 points exist (_PtG.length < 2).",
          "Validation Failure: Erase instance and exit if points missing.",
          "Setup: Assign layer, calculate Origin/Direction vectors based on Alignment.",
          "Loop Elements: Iterate through internal list of Elements.",
          "Anchor Detection: Scan element for TSLs containing 'ANCHOR'.",
          "Filtering: Check if anchor is inside the defined rectangle region.",
          "Filtering: Check if anchor is below a mid-height threshold.",
          "Cache Check: Compare found anchors against cached Map data.",
          "Synchronization: Create new child TSLs (GE_AB_DIM) for new anchors.",
          "Synchronization: Update maps for existing anchors found in region.",
          "Cleanup: Iterate cached map list for anchors not found in current scan.",
          "Cleanup: Update 'Orphan' status and Visibility for missing anchors.",
          "Finalization: Draw visual representation (Rectangle, Cross, Circle, Arrow).",
          "Script End."
        ],
        "conditionalBranches": [
          {
            "condition": "Script invoked via Insert command (_bOnInsert).",
            "path1": {
              "name": "Insertion Path",
              "steps": [
                "Check for execute key (catalog entry).",
                "Show properties dialog if no key.",
                "Prompt user for Walls.",
                "Prompt user for Start Point.",
                "Prompt user for End Point.",
                "Initialize map storage.",
                "Return immediately."
              ]
            },
            "path2": {
              "name": "Recalculation Path",
              "steps": [
                "Skip insertion prompts.",
                "Check for right-click triggers (Reload, Hide/Show).",
                "Resolve Alignment and Layer.",
                "Process anchors on stored elements.",
                "Draw graphics."
              ]
            }
          },
          {
            "condition": "Anchor location status relative to scan.",
            "path1": {
              "name": "Anchor Found",
              "steps": [
                "Check if TSL instance already exists via Handle.",
                "Update reference point, style, and direction.",
                "Mark as 'InRegion' and not 'Orphan'."
              ]
            },
            "path2": {
              "name": "Anchor Missing",
              "steps": [
                "Mark cached anchor as 'Orphan'.",
                "Check 'Hide Missing Anchors' preference.",
                "Update 'HideMe' status on child TSL."
              ]
            }
          },
          {
            "condition": "User selects '../Reload' from context menu.",
            "path1": {
              "name": "User Selects Elements",
              "steps": [
                "PrEntity prompt displays.",
                "New elements appended to _Element list.",
                "Script continues to full anchor scan."
              ]
            },
            "path2": {
              "name": "User Hits ENTER",
              "steps": [
                "No new elements added.",
                "Script continues to full anchor scan (refreshes existing)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of 2 definition points.",
            "errorMessage": "None (Internal Logic).",
            "recovery": "If _PtG.length < 2, the script calls eraseInstance() and returns, removing itself."
          },
          {
            "check": "Anchor TSL script name.",
            "errorMessage": "None (Internal Logic).",
            "recovery": "Anchors are filtered out if script name does not contain 'ANCHOR' or matches the parent/child script names."
          },
          {
            "check": "Anchor position relative to rectangle.",
            "errorMessage": "None (Internal Logic).",
            "recovery": "Anchors falling outside the projected rectangle formed by Start/End points are ignored during the creation/update phase."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Reload Anchors",
            "how": "Right-click menu -> '../Reload'",
            "effect": "Prompts user to select more elements. Adds new anchors to the set and refreshes the dimension markers."
          },
          {
            "action": "Toggle Missing Anchor Visibility",
            "how": "Right-click menu -> '../Hide Missing Anchors' / '../Show Missing Anchors'",
            "effect": "Toggles the visibility of anchors that were previously found but are no longer detected in the current model scan (Orphans)."
          },
          {
            "action": "Change Alignment",
            "how": "OPM Properties -> 'Alignment' dropdown",
            "effect": "Switches the dimension axis between Horizontal (World X) and Vertical (World Y). Updates the layer (SNAP HOR vs SNAP VER) and redraws the indicator arrow."
          },
          {
            "action": "Change DimStyle",
            "how": "OPM Properties -> 'Dimstyle' dropdown",
            "effect": "Updates the 'DimStyle' property passed to all child TSL instances, changing the text size and arrow style globally."
          },
          {
            "action": "Reset / Delete",
            "how": "Right-click menu -> '../Reset' or '../Delete'",
            "effect": "Sets internal flags intended to clear data or remove the instance (logic handled by flags bReset/bDelete)."
          }
        ]
      },
      "tokens_used": 9608,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_AB_DIMS\n\n## Overview\nThis script automates the creation and management of dimension markers for anchor bolts or hardware on wall panels. It allows you to define a rectangular layout zone and automatically detects, dimensions, and aligns anchors found within that area on selected elements.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be used in the 3D model. |\n| Paper Space | No | Not designed for 2D drawings or layouts. |\n| Shop Drawing | No | Not a shop drawing generation script. |\n\n## Prerequisites\n- **Required Entities**: Walls or Elements (`Element`, `ElementWall`).\n- **Minimum Beam Count**: None (Script operates on Elements).\n- **Required Scripts**: `GE_AB_DIM` (This child script must be present in the search path to generate the actual markers).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `GE_AB_DIMS.mcr` from the catalog.\n\n### Step 2: Select Walls\n```\nCommand Line: |Select walls|\nAction: Select the wall elements in the model that contain the anchors you wish to dimension. Press ENTER to confirm selection.\n```\n\n### Step 3: Define Start Point\n```\nCommand Line: Select start point\nAction: Click in the model to set the first corner of the rectangular dimension area.\n```\n\n### Step 4: Define End Point\n```\nCommand Line: Select end point\nAction: Click to set the opposite corner of the rectangular area. The script will now scan the selected walls for anchors inside this box.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Alignment | Dropdown | Horizontal | Sets the orientation of the dimension lines. <br>• **Horizontal**: Measures along the World X-axis (Layer: SNAP HOR).<br>• **Vertical**: Measures along the World Y-axis (Layer: SNAP VER). |\n| Dimstyle | Dropdown | *Project Default* | Selects the specific CAD dimension style (text size, arrows, units) to apply to all generated anchor markers. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| ../Reload | Prompts you to select additional elements. Use this to add new walls to the current dimension group without deleting the script. |\n| ../Hide Missing Anchors | Hides dimension markers for anchors that were previously found but are no longer detected in the model (e.g., deleted or moved outside the zone). |\n| ../Show Missing Anchors | Makes dimension markers visible for \"missing\" anchors, allowing you to see which hardware has been moved or deleted. |\n| ../Reset | Resets the internal state of the script. |\n| ../Delete | Removes the script instance and all associated generated markers from the model. |\n\n## Settings Files\nNone. This script relies on standard CAD properties and the `GE_AB_DIM` dependency script.\n\n## Tips\n- **Defining the Zone**: Ensure the rectangle created by your Start and End points fully encompasses the anchors you want to dimension. Anchors outside this box are ignored.\n- **Workflow**: If you add new walls to your design after inserting the script, simply right-click the script instance and select `../Reload` to include the new walls in the scan.\n- **Troubleshooting**: If anchors are not appearing, verify that the specific TSL script used for the anchor has the word \"ANCHOR\" in its filename, as the script searches for this keyword.\n\n## FAQ\n- **Q: Why are some of my anchors not being dimensioned?**\n  **A**: Check if they fall within the rectangular area defined by your start and end points. Also, ensure the anchor elements are selected during the initial wall selection or added via the `../Reload` command.\n- **Q: What happens if I move a wall?**\n  **A**: The script will recalculate on the next model update. It will update the position of the anchor markers. If an anchor moves outside the defined rectangle, it will be marked as \"Missing\" (depending on your visibility settings).\n- **Q: Can I change the arrow size or text style?**\n  **A**: Yes. Change the **Dimstyle** property in the Properties Palette to any dimension style defined in your current CAD drawing."
      },
      "tokens_used": 5580,
      "error": null
    }
  }
}