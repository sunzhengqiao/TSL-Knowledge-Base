{
  "filename": "GE_HDWR_HANGER_STP.mcr",
  "status": "completed",
  "total_tokens": 40949,
  "processing_time": 747.1045753955841,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 4,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.4",
            "date": "02.jun.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Added features to make possible reset TXT source file using GE_HDWR_RESET_CATALOG_ENTRY tsl"
          },
          {
            "version": "1.3",
            "date": "07.jul.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Description updated"
          },
          {
            "version": "1.2",
            "date": "05.mar.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Avoided printing map to DXX file"
          },
          {
            "version": "1.1",
            "date": "08.nov.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Bugix solved: dimensions were swaped on sides of hanger"
          },
          {
            "version": "1.0",
            "date": "01.oct.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6655,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses Beam(), getPoint(), and constructs 3D Body objects. It lacks 'sd_' prefixes, 'Multipage' prefixes, '#Type E' constructs, and references to _Viewport or ShopDrawing APIs."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam (optional)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": [
            "\\Utilities\\TslCustomSettings\\TSL_Read_Metalpart_Family_Props.dll",
            "TSL\\Catalog\\TSL_HARDWARE_FAMILY_LIST.dxx"
          ]
        }
      },
      "tokens_used": 4097,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select members or hit enter to insert at specific location|",
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select insertion point|",
              "condition": "_bOnInsert && nBeams==0",
              "required": true
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "|Select reference point|: |direction of hanger|",
              "condition": "_bOnInsert && nBeams==0",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select reference point|: |hangers will be inserted at closest end of members|",
              "condition": "_bOnInsert && nBeams>0",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "External/DotNet",
            "trigger": "_bOnInsert or _kExecuteKey == 'Change type'",
            "title": null,
            "dataSource": "TSL_Read_Metalpart_Family_Props.dll (fnReadFamilyPropsFromTXT)",
            "features": {
              "searchable": null,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "|Type|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOverallDepth",
            "type": "PropDouble",
            "displayName": "|Overall depth|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dClearWidth",
            "type": "PropDouble",
            "displayName": "|Clear width|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dOverallHeight",
            "type": "PropDouble",
            "displayName": "|Overall height|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dFlangeWidth",
            "type": "PropDouble",
            "displayName": "|Flange width|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Change type",
            "handler": "sChangeType",
            "action": "Reloads the metalpart type selection dialog to change the instance parameters.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Help",
            "handler": "sHelp",
            "action": "Displays a reportNotice with usage instructions for the STP Family.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "TSL_HARDWARE_FAMILY_LIST.dxx",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Catalog\\"
            ],
            "purpose": "Catalog configuration file used by the DotNet assembly to populate the type selection list.",
            "required": true
          }
        ]
      },
      "tokens_used": 7207,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts an STP family metal joist hanger into the 3D model to support timber beams, either attached to specific beams or placed freely in space.",
          "category": "Hardware / Connection",
          "typicalUseCase": "Connecting a joist or beam to a supporting structure using a standardized metal hanger (STP type), often in floor or roof framing."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "\"\"",
            "businessMeaning": "The specific catalog model code of the hanger (e.g., 'STP200/100') which loads all predefined dimensions from the database.",
            "validRange": "Catalog dependent (Any string defined in TSL_HARDWARE_FAMILY_LIST.dxx)",
            "unit": "Text",
            "affectsOutput": "Determines the values for Overall Depth, Clear Width, and Height. Changing this reloads the entire geometry and property set."
          },
          {
            "name": "dOverallDepth",
            "technicalDefault": "0",
            "businessMeaning": "The longitudinal length of the hanger base plate (the part parallel to the beam's length).",
            "validRange": "Typically 50mm to 400mm (Based on standard hardware sizes)",
            "unit": "mm",
            "affectsOutput": "Scales the length of the base plate and the front/rear faces of the hanger."
          },
          {
            "name": "dClearWidth",
            "technicalDefault": "0",
            "businessMeaning": "The internal width between the two side plates of the hanger. This must be slightly larger than the width of the timber beam it supports.",
            "validRange": "Typically 40mm to 250mm (Must exceed the beam width for successful attachment)",
            "unit": "mm",
            "affectsOutput": "Determines the spacing between the left and right side plates. If the beam is wider than this, the script will delete the hanger."
          },
          {
            "name": "dOverallHeight",
            "technicalDefault": "0",
            "businessMeaning": "The vertical height of the side plates, determining how much of the timber beam is enclosed or supported.",
            "validRange": "Typically 100mm to 500mm",
            "unit": "mm",
            "affectsOutput": "Scales the vertical dimension of the side walls and front faces."
          },
          {
            "name": "dFlangeWidth",
            "technicalDefault": "1",
            "businessMeaning": "The width of the horizontal return/flange at the top of the side/front plates. Note: Script sets this to 1 (mm) by default.",
            "validRange": "Fixed at 1 (in current script logic)",
            "unit": "mm",
            "affectsOutput": "Controls the horizontal extension of the top flange geometry in the front face loops."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing 'sType' via 'Change type' command or initial insert",
            "effect": "Updates 'dOverallDepth', 'dClearWidth', and 'dOverallHeight' based on the TXT catalog entry.",
            "cascade": [
              "sType",
              "dOverallDepth",
              "dClearWidth",
              "dOverallHeight"
            ]
          },
          {
            "trigger": "Attaching to a GenBeam",
            "effect": "Validates that the beam width (vz) is smaller than 'dClearWidth'. If not, the hanger instance is erased.",
            "cascade": [
              "dClearWidth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "3D MetalPart Body",
            "description": "A composite parametric solid consisting of a base plate, two side plates, and two front faces with flanges, representing a metal joist hanger.",
            "appliedTo": "Model Space (floating) or associated GenBeam entities."
          }
        ]
      },
      "tokens_used": 7652,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched via command or insert.",
          "Check if insertCycleCount() > 1; if true, erase instance and exit (prevents multi-insert loops).",
          "Load catalog configuration (Map assembly path and 'STP' family name).",
          "Invoke DotNet dialog (TSL_Read_Metalpart_Family_Props.dll) to select hardware type.",
          "Validate dialog selection: if empty on insert, erase instance and exit.",
          "Prompt user for entity selection (PrEntity) to choose beams, or allow hitting Enter for free insertion.",
          "[Branch] Determine insertion logic based on whether beams were selected.",
          "If free insertion: Prompt for insertion point (_Pt0) and reference point (direction).",
          "If beam attachment: Prompt for reference point to determine closest beam end.",
          "Loop through target count (1 for free, N for beams) to generate new TslInst entities.",
          "Pass selected Map (catalog data) to new instances.",
          "Erase the original 'launcher' instance.",
          "[New Instance Calculation] Check if _Map contains data; if not, erase.",
          "Extract dimensions (Depth, Clear Width, Height) from _Map.",
          "[Branch] Determine coordinate system (vectors) based on floating or attached state.",
          "[Branch Floating] Calculate vectors based on point grip locations (_Pt0 and _PtG).",
          "[Branch Attached] Align vectors to selected beam; validate beam width against Clear Width.",
          "Construct 3D geometry (Base plate, Left/Right sides, Front faces).",
          "Draw geometry in Model Space."
        ],
        "conditionalBranches": [
          {
            "condition": "User input during PrEntity step (Select members or hit Enter)",
            "path1": {
              "name": "Free Insertion (Floating)",
              "steps": [
                "Prompt for insertion point (_Pt0).",
                "Prompt for reference point to define direction (rotation).",
                "Set nInstances = 1.",
                "Create instance with 2 point grips (_Pt0, _PtG) and 0 beams."
              ]
            },
            "path2": {
              "name": "Beam Attachment",
              "steps": [
                "User selects one or more Beams.",
                "Prompt for reference point to determine end placement.",
                "Set nInstances = number of selected beams.",
                "Loop through beams: Create instance with 0 point grips (uses _Pt0 logic internally) and 1 beam per instance."
              ]
            }
          },
          {
            "condition": "State of _Beam and _PtG arrays during Recalc (Geometry generation)",
            "path1": {
              "name": "Floating Geometry",
              "steps": [
                "Check: _Beam.length() == 0 && _PtG.length() == 1",
                "Calculate vx (depth) from vector between _Pt0 and _PtG.",
                "Set vy (height) to World Z (_ZW).",
                "Calculate vz (width) via cross product.",
                "Update _PtG to maintain correct depth offset."
              ]
            },
            "path2": {
              "name": "Attached Geometry",
              "steps": [
                "Check: _Beam.length() == 1 && _PtG.length() == 0",
                "Align vx to Beam.vecX().",
                "Align vy to Beam.vecD().",
                "Align vz via cross product.",
                "Reposition _Pt0 to the closest end of the beam center line.",
                "Validate beam width fits within dClearWidth."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "insertCycleCount()",
            "errorMessage": "None (Silent failure)",
            "recovery": "System automatically erases the instance to prevent infinite loops or multi-insertion errors."
          },
          {
            "check": "Map content from DotNet Dialog (mapOut)",
            "errorMessage": "None (Silent failure)",
            "recovery": "If the user cancels the dialog or map is empty during insert, the instance is erased."
          },
          {
            "check": "_Map presence on Recalc",
            "errorMessage": "None (Silent failure)",
            "recovery": "If the instance somehow loses its property map (_Map.length()==0), it erases itself."
          },
          {
            "check": "Beam Width vs Clear Width (Attached mode only)",
            "errorMessage": "|This type can't hold this size of beam|",
            "recovery": "Script erases the specific hanger instance. User must select a larger type (via 'Change type') or use a different beam."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Type",
            "how": "Context Menu (Right-click) -> 'Change type'",
            "effect": "Re-invokes the DotNet dialog. Upon selection, updates _Map with new dimensions (Depth, Width, Height) and rebuilds the 3D Body."
          },
          {
            "action": "Move / Rotate (Floating)",
            "how": "Grip Edit",
            "effect": "Moving the main grip repositions the hanger. Moving the secondary grip rotates the hanger around the main grip."
          },
          {
            "action": "Reposition (Attached)",
            "how": "Grip Edit",
            "effect": "Moving the single grip calculates the new closest end of the beam and snaps the hanger to that end."
          },
          {
            "action": "Help",
            "how": "Context Menu (Right-click) -> 'Help'",
            "effect": "Displays a reportNotice explaining the difference between floating and attached modes and usage instructions."
          }
        ]
      },
      "tokens_used": 8783,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_HANGER_STP.mcr\n\n## Overview\nInserts an STP family metal joist hanger into the 3D model to support timber beams. The script allows placement either attached to specific structural beams or floating freely in space at a defined location and rotation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Generates 3D metal part bodies. |\n| Paper Space | No | Not applicable for 2D drawings. |\n| Shop Drawing | No | This is a model detailing script. |\n\n## Prerequisites\n- **Required Entities**: GenBeam (optional, only required if attaching to timber).\n- **Minimum Beam Count**: 0 (Supports floating insertion).\n- **Required Settings Files**:\n  - `TSL_Read_Metalpart_Family_Props.dll` (Required for the selection dialog).\n  - `TSL_HARDWARE_FAMILY_LIST.dxx` (Catalog database located in `_kPathHsbCompany\\TSL\\Catalog\\`).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_HDWR_HANGER_STP.mcr`\n\n### Step 2: Select Hanger Type\n```\nDialog Window: [Metalpart Selection]\nAction: Search or browse the list for the desired STP hanger model. \nClick OK to confirm selection.\n```\n*Note: If you cancel this dialog, the script will exit without creating an object.*\n\n### Step 3: Select Placement Method\n```\nCommand Line: Select members or hit enter to insert at specific location\nAction: \nOption A: Select one or more timber beams (GenBeams) and press Enter.\nOption B: Press Enter without selecting anything to place the hanger freely in space.\n```\n\n### Step 4a: Define Location (Free Insertion)\n*Only appears if you pressed Enter in Step 3.*\n```\nCommand Line: Select insertion point\nAction: Click in the 3D model to place the base of the hanger.\n\nCommand Line: Select reference point: direction of hanger\nAction: Click a second point to define the rotation/alignment of the hanger.\n```\n\n### Step 4b: Define Reference (Beam Attachment)\n*Only appears if you selected beams in Step 3.*\n```\nCommand Line: Select reference point: hangers will be inserted at closest end of members\nAction: Click anywhere in the model. The hanger will automatically snap to the end of the selected beam that is closest to your click.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | Text | \"\" | The specific catalog code of the hanger (e.g., 'STP200/100'). Changing this reloads dimensions from the database. |\n| Overall depth | Number | 0 | The longitudinal length of the hanger base plate (parallel to the beam). |\n| Clear width | Number | 0 | The internal width between the side plates. Must be larger than the timber beam width. |\n| Overall height | Number | 0 | The vertical height of the side plates. |\n| Flange width | Number | 1 | The width of the horizontal return/flange at the top of the plates. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change type | Opens the hardware catalog dialog again, allowing you to swap the current hanger for a different model/size. |\n| Help | Displays a message box with instructions on using the STP Family hanger script. |\n\n## Settings Files\n- **Filename**: `TSL_HARDWARE_FAMILY_LIST.dxx`\n- **Location**: `\\\\Utilities\\\\TslCustomSettings\\\\` or `TSL\\\\Catalog\\\\`\n- **Purpose**: Defines the list of available STP hardware types and their associated dimensions (Depth, Width, Height) used by the selection dialog.\n\n## Tips\n- **Automatic Deletion**: If you attach a hanger to a beam that is wider than the hanger's \"Clear width,\" the hanger will automatically delete itself to prevent geometric errors. Select a larger type using \"Change type.\"\n- **Grip Editing**: \n  - In **Free mode**, use the two grips to move the hanger or rotate it by moving the direction grip.\n  - In **Attached mode**, moving the single grip will slide the hanger to the nearest end of the beam.\n- **Batch Insert**: You can select multiple beams in Step 3 to insert a hanger on each beam simultaneously.\n\n## FAQ\n- **Q: Why did my hanger disappear immediately after insertion?**\n  - **A**: This usually happens if the Clear Width of the hanger is too small for the beam you selected. The script deletes the hanger if it detects a size mismatch. Use the \"Change type\" context menu to select a wider hanger.\n  \n- **Q: Can I rotate the hanger after inserting it on a beam?**\n  - **A**: When attached to a beam, the hanger aligns automatically to the beam's axis. You cannot freely rotate it, but moving the grip will snap it to the opposite end of the beam. For free rotation, use the \"Free Insert\" method (hitting Enter at the beam selection prompt)."
      },
      "tokens_used": 6555,
      "error": null
    }
  }
}