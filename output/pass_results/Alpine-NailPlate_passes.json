{
  "filename": "Alpine-NailPlate.mcr",
  "status": "completed",
  "total_tokens": 28659,
  "processing_time": 256.7176022529602,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.8",
            "date": "26.nov.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Version control"
          },
          {
            "version": "1.7",
            "date": "26.nov.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Plate drawn once only per instance. Bill Malcolm added Alpine code to have multi plates on multi plies - Cleaned code, performance hit reduced"
          },
          {
            "version": "1.6",
            "date": "15.ago.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Thumbnail updated"
          },
          {
            "version": "1.5",
            "date": "12.may.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Copyright added - Thumbnail added - Description added - Set to store state in DWG (not recalc at dwgin)"
          },
          {
            "version": "1.4",
            "date": "04.oct.2011",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Validations on values to create body (avoid error message when vectors become null)"
          },
          {
            "version": "1.3",
            "date": "June 18 2010",
            "author": "no author",
            "changes": "Adapted for the new model map import"
          },
          {
            "version": "1.1",
            "date": "",
            "author": "Bill Malcom",
            "changes": "Initial Coding."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4553,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script creates 3D geometry using the Body class and draws it with Display dp(-1), indicating it operates in the 3D environment. There is no usage of 'sd_' prefixes, _Viewport, #Type E, or _Entity arrays which are characteristic of ShopDrawing or Paper Space scripts. The script relies on _Map data to define size and orientation, functioning as a visualization for imported model map data."
        },
        "prerequisites": {
          "requiredEntities": [
            "None (Data driven by _Map)"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 4127,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 1,
            "variable": "strPlateGauge",
            "type": "PropString",
            "displayName": "Plate Gauge",
            "defaultValue": "Value from _Map",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strPlateLabel",
            "type": "PropString",
            "displayName": "Plate Label",
            "defaultValue": "Value from _Map",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "nPlateLength",
            "type": "PropInt",
            "displayName": "Plate Length",
            "defaultValue": "Value from _Map",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "nPlateHeight",
            "type": "PropInt",
            "displayName": "Plate Height",
            "defaultValue": "Value from _Map",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5070,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Visualizes nail plates imported from an external structural design tool (Model Map) within the 3D model.",
          "category": "Hardware/Import Visualization",
          "typicalUseCase": "Used when importing engineering data (e.g., from Alpine) to represent the physical size, location, and orientation of specified nail plates on timber elements."
        },
        "parameters": [
          {
            "name": "strPlateGauge",
            "technicalDefault": "Value from _Map",
            "businessMeaning": "The gauge or thickness specification of the nail plate, often corresponding to manufacturer part codes (e.g., 20ga).",
            "validRange": "Manufacturer specific strings (e.g., '20Ga', '0.9mm', 'S20')",
            "unit": "String/Text",
            "affectsOutput": "Informational property; does not alter the geometric thickness of the plate in this specific script implementation (thickness is hardcoded to 2mm), but stores critical design data for reports or BOM."
          },
          {
            "name": "strPlateLabel",
            "technicalDefault": "Value from _Map",
            "businessMeaning": "The descriptive name, ID, or catalog number of the nail plate used for identification in schedules and production.",
            "validRange": "Manufacturer part numbers or descriptive text",
            "unit": "String/Text",
            "affectsOutput": "Informational property; labels the plate in the OPM for identification but does not change geometry."
          },
          {
            "name": "nPlateLength",
            "technicalDefault": "Value from _Map",
            "businessMeaning": "The physical length of the nail plate along the primary axis (X-axis of the plate's local coordinate system).",
            "validRange": "50mm to 600mm (typical nail plate sizes)",
            "unit": "mm",
            "affectsOutput": "Determines the length of the 3D body representing the plate."
          },
          {
            "name": "nPlateHeight",
            "technicalDefault": "Value from _Map",
            "businessMeaning": "The physical height (width) of the nail plate along the secondary axis (Y-axis of the plate's local coordinate system).",
            "validRange": "50mm to 300mm (typical nail plate sizes)",
            "unit": "mm",
            "affectsOutput": "Determines the width/height of the 3D body representing the plate."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Script Insertion / Import",
            "effect": "All properties are initialized from the Model Map (_Map) data and set to Read-Only.",
            "cascade": [
              "strPlateGauge",
              "strPlateLabel",
              "nPlateLength",
              "nPlateHeight"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (3D Representation)",
            "description": "A rectangular 3D solid body representing the nail plate. The thickness is hardcoded to 2mm regardless of the 'Gauge' property. The position and orientation are defined by the coordinate system or vectors from the Model Map.",
            "appliedTo": "Model Space (Placed at coordinates defined in the import data)"
          }
        ]
      },
      "tokens_used": 3897,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script execution triggered (insertion or recalculation).",
          "Read 'Length' from Model Map data.",
          "[Conditional] Check if instance was just created (_bOnDbCreated). If true, set color index to 8.",
          "[Gatekeeper] Check if nLength > 0.",
          "Read Orientation Vectors (VecX, VecY, VecZ) from Model Map.",
          "[Conditional] Determine Coordinate System source: Explicit Vectors vs Instance CS.",
          "Read Dimensions (Width/Depth) and Metadata (Gauge, Label) from Model Map.",
          "Initialize OPM Properties (Plate Gauge, Label, Length, Height) and set to Read-Only.",
          "Normalize orientation vectors.",
          "[Conditional] Check Z-Offset value.",
          "[Branch] Construct Body geometry based on Z-Offset logic.",
          "Draw Body to 3D Display."
        ],
        "conditionalBranches": [
          {
            "condition": "Presence of explicit orientation vectors in Model Map",
            "path1": {
              "name": "Old Model Map Format",
              "steps": [
                "Detect explicit X, Y, Z vector values in Map (Non-zero).",
                "Use provided vectors for orientation.",
                "Set vecZOffset to 0.0."
              ]
            },
            "path2": {
              "name": "New Model Map Format",
              "steps": [
                "Detect zero vectors in Map.",
                "Retrieve vectors from _ThisInst.coordSys().",
                "Read vecZOffset from Map data."
              ]
            }
          },
          {
            "condition": "Z-Offset value greater than 0",
            "path1": {
              "name": "Offset Geometry",
              "steps": [
                "Check dimensions validity (Length>0, Depth>0, Thickness>0).",
                "Calculate Origin: _Pt0 - (vecZOffset * VecBZ).",
                "Construct Body: Length along X, Depth along Y, Thickness along Z."
              ]
            },
            "path2": {
              "name": "Standard Geometry",
              "steps": [
                "Calculate Origin: _Pt0.",
                "Construct Body: Length along X, Thickness along Y, Depth along Z (Note axis swap)."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Plate Length from Map",
            "errorMessage": "None (Silent Exit)",
            "recovery": "Ensure Model Map data contains a valid 'Length' > 0."
          },
          {
            "check": "Dimensions (Length, Depth, Thickness)",
            "errorMessage": "None (Prevents body creation if invalid)",
            "recovery": "Ensure Map data contains positive values for Width and internal Thickness (2mm)."
          },
          {
            "check": "Vector Validity",
            "errorMessage": "Prevents Null Vector errors (v1.4 fix)",
            "recovery": "If explicit vectors are invalid (zero), script automatically falls back to Instance Coordinate System."
          }
        ],
        "postInsertionActions": [
          {
            "action": "View Properties",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "User can view Gauge, Label, Length, and Height, but cannot edit them (Read-Only)."
          },
          {
            "action": "Move/Rotate",
            "how": "Standard CAD Grips/Commands",
            "effect": "Moves the insertion point (_Pt0) or rotates the instance coordinate system. Geometry will recalculate to maintain relative offsets defined in Map."
          }
        ]
      },
      "tokens_used": 5707,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Alpine-NailPlate.mcr\n\n## Overview\nVisualizes nail plates in the 3D model based on data imported from external structural engineering software (Model Map). It generates a 3D representation of the plate using size and orientation data provided by the import file.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script creates 3D bodies in the model. |\n| Paper Space | No | Not designed for 2D layout or detailing. |\n| Shop Drawing | No | Does not generate shop drawings directly. |\n\n## Prerequisites\n- **Required Entities**: None (This script is data-driven via Model Map import).\n- **Minimum Beam Count**: 0\n- **Required Settings**: None\n\n## Usage Steps\n\n### Step 1: Launch Import\nThis script is typically executed automatically during a data import.\n- **Action**: Run the standard **Model Map Import** function in hsbCAD.\n- **Input**: Select the import file (e.g., from Alpine or other structural software) that contains the nail plate definitions.\n\n### Step 2: Visualization\n- **Action**: The script reads the Map data and generates 3D rectangular bodies at the calculated coordinates.\n- **Result**: The plates appear in the model with the dimensions and labels specified in the import file.\n\n*(Note: If inserted manually via `TSLINSERT` without import data, the script may not generate visible geometry as it relies on specific Map length vectors to define size.)*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Plate Gauge | String | Value from _Map | The gauge or thickness specification of the nail plate (e.g., \"20Ga\"). Note: This is for information/reporting; the visual thickness is fixed. |\n| Plate Label | String | Value from _Map | The manufacturer part number or descriptive ID for the plate. |\n| Plate Length | Integer | Value from _Map | The physical length of the plate (mm). |\n| Plate Height | Integer | Value from _Map | The physical height/width of the plate (mm). |\n\n*Note: These properties are typically set to Read-Only to preserve the integrity of the imported engineering data.*\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None Specific* | This script does not add custom items to the right-click menu. Standard hsbCAD options (Erase, Move, Rotate, etc.) apply. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not use external settings files; all configuration comes from the Model Map import data.\n\n## Tips\n- **Visual Thickness**: The 3D body of the plate is drawn with a fixed thickness of 2mm for performance and visualization consistency, regardless of the \"Plate Gauge\" value displayed in the properties.\n- **Missing Plates**: If a plate is missing from the view, check the source data to ensure the Length value is greater than 0. The script suppresses creation if dimensions are invalid.\n- **Moving Plates**: You can use standard AutoCAD grips or commands (Move/Rotate) to adjust the plate position. The geometry will recalculate to maintain the correct orientation relative to the insertion point.\n\n## FAQ\n- **Q: Can I edit the size of the plate directly in the properties palette?**\n  A: No, the dimensions are imported from engineering data and are usually Read-Only to prevent mismatching the structural design.\n- **Q: Why does the plate look thin even if the Gauge indicates a thicker material?**\n  A: The script uses a fixed 2mm visual thickness for the 3D model. The \"Plate Gauge\" property stores the correct specification for bills of materials and labels.\n- **Q: The plate appears rotated incorrectly compared to the beam.**\n  A: The script calculates orientation based on the import data. If the vectors in the import file are zero, it defaults to the Instance Coordinate System. Check the orientation of the instance or the source data vectors."
      },
      "tokens_used": 5305,
      "error": null
    }
  }
}