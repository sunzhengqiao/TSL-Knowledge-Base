{
  "filename": "hsb_ReduceBlockingLength.mcr",
  "status": "completed",
  "total_tokens": 44444,
  "processing_time": 361.65764260292053,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": [],\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.14\",\n      \"date\": \"24.03.2023\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"HSB-14096: Improve code for truss entities; use bodyExtents for the quader\"\n    },\n    {\n      \"version\": \"1.13\",\n      \"date\": \"20.03.2023\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"HSB-18369: Dont consider parallel beams as stretchTo beams\"\n    },\n    {\n      \"version\": \"1.12\",\n      \"date\": \"20.03.2023\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"HSB-18369: Stetch the beam only if the \\\"distance\\\" larger then the existing gap\"\n    },\n    {\n      \"version\": \"1.11\",\n      \"date\": \"10.05.2022\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"HSB-15431: support stretching at truss entities\"\n    },\n    {\n      \"version\": \"1.10\",\n      \"date\": \"09.05.2022\",\n      \"author\": \"Marsel Nakuci\",\n      \"changes\": \"HSB-15431: fix bug\"\n    },\n    {\n      \"version\": \"1.9\",\n      \"date\": \"25.03.2021\",\n      \"author\": \"Alberto Jena\",\n      \"changes\": \"bugfix when the X vector of the beam was not recognized to be parallel to X of the element\"\n    },\n    {\n      \"version\": \"1.8\",\n      \"date\": \"11.02.2021\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-10726 bugfix blockings in element Y-direction also supported\"\n    },\n    {\n      \"version\": \"1.7\",\n      \"date\": \"15may2020\",\n      \"author\": \"thorsten.huck@hsbcad.com\",\n      \"changes\": \"out of range error fixed\"\n    },\n    {\n      \"version\": \"1.6\",\n      \"date\": \"17.01.2020\",\n      \"author\": \"AS\",\n      \"changes\": \"Add stretchOnInsert when adding the cuts to the beam.\"\n    },\n    {\n      \"version\": \"1.5\",\n      \"date\": \"25.04.2019\",\n      \"author\": \"RP\",\n      \"changes\": \"change vector for angled blocking\"\n    },\n    {\n      \"version\": \"1.3\",\n      \"date\": \"02.02.2012\",\n      \"author\": \"Alberto Jena\",\n      \"changes\": \"Add a property so the beams can be reduce multiple times\"\n    },\n    {\n      \"version\": \"1."
      },
      "tokens_used": 8803,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select Element() and references _kModelSpace within the Group.collectEntities method. It iterates through Element beams to generate cuts (addToolStatic), which are 3D operations. There are no 'sd_' prefixes, '_Viewport' checks, or '#Type E' declarations typical of ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Beams (Blocking/ShortFrame)",
            "TrussEntity (Optional)"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (requires an existing Element with structural members)",
          "requiredSettings": []
        }
      },
      "tokens_used": 5934,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert (via showDialogOnce)",
            "title": "Properties",
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dReduceDist",
            "type": "PropDouble",
            "displayName": "Gap to beams",
            "defaultValue": "U(1)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "This value will be the gap between the blocking and any studs on each side."
          },
          {
            "index": 1,
            "variable": "dReduceDistTruss",
            "type": "PropDouble",
            "displayName": "Gap to truss entities",
            "defaultValue": "U(1)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "This value will be the gap between the blocking and any truss entity on each side."
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6889,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically reduces the length of blocking and short frame beams within a timber element to create clearance gaps around adjacent structural members.",
          "category": "Framing",
          "typicalUseCase": "Used during wall or floor element processing to ensure blocking pieces (fire blocking, stiffeners) do not collide with studs, plates, or truss chords, allowing for proper installation tolerances or material expansion."
        },
        "parameters": [
          {
            "name": "dReduceDist",
            "technicalDefault": "U(1)",
            "businessMeaning": "The clearance gap maintained between the blocking beam and intersecting structural timber beams (like studs or plates). This ensures the blocking is slightly shorter than the theoretical opening to prevent hard contacts during assembly.",
            "validRange": "0 mm to 50 mm",
            "unit": "mm",
            "affectsOutput": "Determines how much length is removed from the ends of the blocking beams relative to standard timber members. Larger values result in shorter blocking pieces."
          },
          {
            "name": "dReduceDistTruss",
            "technicalDefault": "U(1)",
            "businessMeaning": "The clearance gap maintained between the blocking beam and intersecting truss entities (like top/bottom chords or webs). Truss geometry can vary, so a separate gap allows for specific tolerances when interacting with engineered truss systems.",
            "validRange": "0 mm to 50 mm",
            "unit": "mm",
            "affectsOutput": "Determines how much length is removed from the ends of the blocking beams specifically when they intersect with truss components. Larger values result in shorter blocking pieces near trusses."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "Cut (Saw Cut)",
            "description": "End cuts are applied to the selected blocking/short frame beams to shorten them. These cuts are applied as 'StretchOnInsert' operations, meaning they adjust the effective length of the beam.",
            "appliedTo": "Beams of type '_kSFBlocking' or '_kBlocking' found within the selected Element(s)."
          }
        ]
      },
      "tokens_used": 7064,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"Script starts and initializes properties (dReduceDist, dReduceDistTruss).\",\n    \"Check _bOnInsert: If insertCycleCount > 1, script erases itself immediately.\",\n    \"Check _bOnInsert: If true, show Dynamic Dialog (properties) once.\",\n    \"Prompt user to select Elements (PrEntity).\",\n    \"Validation: If no elements selected or selection cancelled, erase instance and exit.\",\n    \"Load property values if triggered from catalog (_bOnDbCreated).\",\n    \"Iterate through each selected Element.\",\n    \"Collect all Beams and TrussEntities within the element.\",\n    \"Identify target beams: Filter for types '_kSFBlocking' or '_kBlocking'.\",\n    \"For each target beam, cast rays in both X directions (+X and -X) to find obstacles.\",\n    \"Obstacle Filtering: Loop through collected entities (Beams/Trusses).\",\n    \"Check Orientation: Ignore entities that are parallel to the target beam.\",\n    \"Find Intersection: Use rayIntersection to find contact point with obstacle volume (Body/Quader).\",\n    \"Determine Closest: Track the intersection point with the minimum distance.\",\n    \"Determine Obstacle Type: Check if closest obstacle is a Beam or TrussEntity.\",\n    \"Select Gap Parameter: Use 'dReduceDist' for Beams or 'dReduceDistTruss' for Trusses.\",\n    \"Calculate Cut Plane: Offset the intersection point by the selected gap distance.\",\n    \"Apply Tool: Add Saw Cut (Cut) to the target beam using addToolStatic with _kStretchOnInsert.\",\n    \"Cleanup: Erase script instance after processing all elements.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Insert Cycle Check\",\n      \"path1\": {\n        \"name\": \"Cycle Count > 1\",\n        \"steps\": [\n          \"Erase Instance\",\n          \"Exit\"\n        ]\n      },\n      \""
      },
      "tokens_used": 10655,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ReduceBlockingLength.mcr\n\n## Overview\nThis script automatically shortens blocking and short frame beams within selected timber elements. It creates specific clearance gaps around adjacent structural members, such as studs, plates, or roof trusses.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in the 3D model where the timber elements exist. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | This script modifies the physical 3D model geometry, not 2D drawings. |\n\n## Prerequisites\n- **Required Entities**: An existing Element (Wall or Floor) containing Beams.\n- **Beam Types**: The element must contain beams classified as \"Blocking\" (`_kBlocking`) or \"ShortFrame\" (`_kSFBlocking`).\n- **Minimum Beam Count**: At least one blocking beam must be present in the selection.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `hsb_ReduceBlockingLength.mcr`.\n\n### Step 2: Configure Properties\nAction: Upon insertion, a \"Properties\" dialog will appear automatically.\n- Set the **Gap to beams** (standard timber members).\n- Set the **Gap to truss entities** (truss chords/webs).\n- Click OK to confirm.\n\n### Step 3: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the timber elements (walls/floors) containing the blocking you wish to modify. You can select multiple elements at once using a window selection.\n```\n\n### Step 4: Processing\nAction: Press **Enter** to confirm the selection. The script will process the elements, cut the blocking beams to the calculated lengths, and then automatically remove itself from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Gap to beams | Number | U(1) | The clearance distance maintained between the blocking beam and intersecting standard timber members (studs, plates). |\n| Gap to truss entities | Number | U(1) | The clearance distance maintained between the blocking beam and intersecting truss components (chords, webs). |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| None | This is a command script that erases itself after execution. It does not remain in the model for right-click interactions. |\n\n## Settings Files\nNo specific external settings files are required for this script.\n\n## Tips\n- **Unit Awareness**: The default value `U(1)` refers to 1 current drawing unit (usually 1 mm). Ensure you input values consistent with your project's unit settings.\n- **Truss Support**: This script recognizes Truss Entities separately from standard beams, allowing you to apply a larger gap for trusses if necessary.\n- **Beam Orientation**: The script calculates gaps based on the blocking's principal X-axis. Ensure your blocking beams are modeled correctly relative to the element.\n- **Batch Processing**: You can select multiple elements (e.g., an entire floor plan) in one go to process all blocking simultaneously.\n\n## FAQ\n- **Q: The script ran, but the blocking lengths didn't change.**\n  A: Ensure the beams you are trying to modify are defined as type \"Blocking\" or \"ShortFrame\" in the element catalog. Standard studs or joists will be ignored.\n- **Q: Why are my blocking beams shorter than expected?**\n  A: Check both \"Gap to beams\" and \"Gap to truss entities\" properties. If the blocking intersects with both a stud and a truss chord, the script applies the respective gap for each intersection.\n- **Q: Can I undo the changes?**\n  A: Yes, use the standard AutoCAD `UNDO` command immediately after running the script if the results are not as desired."
      },
      "tokens_used": 5099,
      "error": null
    }
  }
}