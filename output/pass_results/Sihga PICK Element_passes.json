{
  "filename": "Sihga PICK Element.mcr",
  "status": "completed",
  "total_tokens": 41148,
  "processing_time": 1845.1193344593048,
  "passes": {
    "1": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "Request timeout after retries"
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly passes `_kModelSpace` to `dbCreate` for instance creation. Selection is restricted to `ElementRoof` entities. Adds 3D tools (Drill, ElemNoNail, ElemDrill) to beams and sheets. No `sd_` prefix, `_kPaperSpace` keywords, or Viewport handling logic detected."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementRoof",
            "Beam",
            "Sheet"
          ],
          "minimumBeams": 1,
          "requiredSpace": "ModelSpace",
          "requiredSettings": [
            "hsbCenterOfGravity TSL script (must be available in the DWG or search path)"
          ]
        }
      },
      "tokens_used": 7578,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select element(s)|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "Insertion (if not executed from catalog entry)",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nQuant",
            "type": "PropInt",
            "displayName": "(A) - |Quantity|",
            "defaultValue": 1,
            "inputType": "dropdown",
            "options": [
              "3",
              "4"
            ],
            "category": "|Distribution|",
            "description": null
          },
          {
            "index": 1,
            "variable": "dBeltLength",
            "type": "PropDouble",
            "displayName": "(B) - |Lifting Belt Length|",
            "defaultValue": "2000",
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": null
          },
          {
            "index": 2,
            "variable": "dInterdistance",
            "type": "PropDouble",
            "displayName": "(C) - |Distance Lifting points|",
            "defaultValue": "1000",
            "inputType": "number",
            "options": [],
            "category": "|Distribution|",
            "description": null
          },
          {
            "index": 0,
            "variable": "sWeinmannTools",
            "type": "PropString",
            "displayName": "(D) - |Apply Weinmann Tools|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Tooling|",
            "description": null
          },
          {
            "index": 1,
            "variable": "sWeight",
            "type": "PropString",
            "displayName": "|Element weight|",
            "defaultValue": "0",
            "inputType": "text",
            "options": [],
            "category": "|Information|",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 7325,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates SIHGA PICK lifting anchors and CNC machining data for timber roof/floor elements, calculating positions based on the element's center of gravity to ensure safe lifting.",
          "category": "Hardware/Machining",
          "typicalUseCase": "Used during the detailing phase to prepare pre-fabricated timber roof or floor elements for safe transport and installation by defining lifting points and machinery data."
        },
        "parameters": [
          {
            "name": "nQuant",
            "technicalDefault": 1,
            "businessMeaning": "Number of SIHGA PICK lifting devices to distribute across the element (3 or 4 points). This determines the lifting configuration.",
            "validRange": "3, 4",
            "unit": "count",
            "affectsOutput": "Changes the quantity of anchors drilled, the belt geometry calculation, and the total load capacity."
          },
          {
            "name": "dBeltLength",
            "technicalDefault": 2000,
            "businessMeaning": "The length of the lifting belts/slings used during installation.",
            "validRange": "1000 - 10000",
            "unit": "mm",
            "affectsOutput": "Determines the maximum allowable distance between lifting points (interdistance) to maintain a minimum 45° lifting angle. Influences the visual representation of the lifting gear."
          },
          {
            "name": "dInterdistance",
            "technicalDefault": 1000,
            "businessMeaning": "The target spacing distance between the lifting points along the element.",
            "validRange": "Dependent on belt length (calculated max)",
            "unit": "mm",
            "affectsOutput": "Directly controls the spacing of the drilled anchors on the element. If set too wide relative to the belt length, it auto-corrects to maintain safety angles."
          },
          {
            "name": "sWeinmannTools",
            "technicalDefault": null,
            "businessMeaning": "Option to generate specific CNC machining data (No-nail areas and surface drills) required for Weinmann manufacturing machinery.",
            "validRange": "Yes, No",
            "unit": "boolean",
            "affectsOutput": "If 'Yes', creates 'ElemNoNail' zones (to prevent nailing/screwing in anchor areas) and 'ElemDrill' operations through the top sheeting layers into the beam."
          },
          {
            "name": "sWeight",
            "technicalDefault": "0",
            "businessMeaning": "The calculated total weight of the timber element, used for load verification against the SIHGA PICK system's capacity.",
            "validRange": "Calculated automatically",
            "unit": "kg",
            "affectsOutput": "Does not control geometry, but triggers visual warnings (Red text/Alerts) if the calculated weight exceeds the safe lifting limit of the configured setup."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User sets dBeltLength",
            "effect": "Calculates the maximum allowed dInterdistance to ensure a minimum lifting angle of 45°.",
            "cascade": [
              "dInterdistance"
            ]
          },
          {
            "trigger": "User sets dInterdistance > MaxCalculation",
            "effect": "Script automatically resets dInterdistance to the maximum safe distance and reports a correction.",
            "cascade": [
              "dInterdistance"
            ]
          },
          {
            "trigger": "User sets nQuant",
            "effect": "Updates the formula for Max Load Capacity (dMaxLoad) and Max Interdistance.",
            "cascade": [
              "dMaxLoad",
              "dInterdistance"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Drill",
            "description": "Cylindrical holes drilled into the main timber beams to anchor the SIHGA PICK hardware.",
            "appliedTo": "Structural beams (min 80x120mm) within the element, positioned relative to the center of gravity."
          },
          {
            "type": "ElemNoNail",
            "description": "Protected zones on the top surface of the element where nails or screws must not be applied.",
            "appliedTo": "Element sheeting layers (zones 1-5), located around the lifting anchors."
          },
          {
            "type": "ElemDrill",
            "description": "Vertical drilling operations through the top sheeting layers into the beam below.",
            "appliedTo": "Element sheeting, aligning with the beam drill hole (only if sWeinmannTools = Yes)."
          },
          {
            "type": "Body (Visual)",
            "description": "3D representation of the SIHGA PICK lifting device and the lifting belts for verification in the model.",
            "appliedTo": "Model Space visualization attached to the element."
          }
        ]
      },
      "tokens_used": 8480,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. User executes script (drag-and-drop or command line).\",\n    \"2. Script checks 'insertCycleCount'; if greater than 1, script terminates to prevent duplicate execution.\",\n    \"3. Check for Catalog Entry usage:\",\n    \"   [If Catalog Entry]: Load properties (Quantity, Belt Length, etc.) from the entry silently.\",\n    \"   [If Manual Launch]: Open 'ShowDynamicDialog' prompting user to input properties.\",\n    \"4. Validate 'Interdistance' property:\",\n    \"   Calculate maximum allowed distance based on 'Belt Length' and 'Quantity'.\",\n    \"   If input > max allowed, reset property to max allowed and report message.\",\n    \"5. Prompt user to select ElementRoof entities ('PrEntity' command line prompt).\",\n    \"6. Iterate through all selected elements and attach a new script instance to each using 'dbCreate'.\",\n    \"7. Script instance initialization for specific Element:\",\n    \"   Validate Element is of type 'ElementRoof'. If not, delete instance.\",\n    \"   Calculate total thickness of top sheeting zones (1-5).\",\n    \"   Validate Sheet Thickness: If > 22mm, display error message and delete instance.\",\n    \"   Filter Element Beams: Identify structural beams (Height >= 120mm, Width >= 80mm, Length > 500mm).\",\n    \"   Check for duplicates: Ensure no other instance of this script is already attached to the element. If yes, delete instance.\",\n    \"   Calculate Center of Gravity (CoG): Call external script 'hsbCenterOfGravity'.\",\n    \"   If CoG script fails/missing: Display error and delete instance.\",\n    \"   [Code Truncated]: Calculate lifting point coordinates based on CoG, Quantity, and Interdistance.\",\n    \"   Loop for each Lifting Point (Quantity 3 or 4):\",\n    \"     Find nearest structural beam.\",\n    \"     Validate Beam Dimensions at specific point: Check Height >= 120mm and Width (80/100/120mm thresholds).\",\n    \"     Determine 'Case' (0-4) based on dimensions and sheeting presence to select Load Table.\",\n    \"     If beam is too small: Display error and delete instance.\",\n    \"     Generate Drill tools (Main drill in beam, intersect drill in sheets).\",\n    \"     Check 'Apply Weinmann Tools' property:\",\n    \"       If 'Yes': Generate 'ElemNoNail' zones and 'ElemDrill' through sheets.\",\n    \"     Calculate actual lifting belt angle relative to the device hook.\",\n    \"     Load Validation:\",\n    \"       Look up Max Load from table based on Angle and 'Case'.\",\n    \"       Check if Element Weight > Calculated Max Load.\",\n    \"       Check if Lifting Angle < 45 degrees.\",\n    \"       If unsafe: Trigger visual warning flag.\",\n    \"   Draw Visualization:\",\n    \"     Draw 3D Bodies for the lifting devices.\",\n    \"     Draw Lines representing lifting belts.\",\n    \"     If warnings triggered: Draw 'Attention' text and red error visuals.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Script Execution Source (Catalog vs Manual)\",\n      \"path1\": {\n        \"name\": \"Catalog Entry\",\n        \"steps\": [\n          \"Detect _kExecuteKey matches catalog name.\",\n          \"Execute setPropValuesFromCatalog(sEntry).\",\n          \"Skip dialog, proceed to selection.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Manual Launch\",\n        \"steps\": [\n          \"Catalog entry not found.\",\n          \"Execute showDialog().\",\n          \"User confirms properties in dialog.\",\n          \"Proceed to selection.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Distance Lifting points (Interdistance) Input Validation\",\n      \"path1\": {\n        \"name\": \"Safe Distance\",\n        \"steps\": [\n          \"User input <= Calculated Max Distance (based on Belt Length).\",\n          \"Property remains unchanged.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Unsafe Distance\",\n        \"steps\": [\n          \"User input > Calculated Max Distance.\",\n          \"ReportMessage: 'Distance corrected to [Max]...'.\",\n          \"Property automatically set to Calculated Max Distance.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Load Capacity Determination (Case Selection)\",\n      \"path1\": {\n        \"name\": \"Case 0, 1, 2 (No Sheeting)\",\n        \"steps\": [\n          \"Top zone thickness == 0.\",\n          \"Check Beam Width: >=120 (Case 2), >=100 (Case 1), >=80 (Case 0).\",\n          \"Use 'dMaxLoadsCase' 0, 1, or 2 arrays.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Case 3, 4 (With Sheeting)\",\n        \"steps\": [\n          \"Top zone thickness > 0 and <= 22mm.\",\n          \"Check Beam Width: >=100 (Case 4), >=80 (Case 3).\",\n          \"Use 'dMaxLoadsCase' 3 or 4 arrays.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Weinmann Tooling Application\",\n      \"path1\": {\n        \"name\": \"Tools Applied\",\n        \"steps\": [\n          \"Property 'Apply Weinmann Tools' is 'Yes'.\",\n          \"Create ElemNoNail objects on zones 1-5.\",\n          \"Create ElemDrill object through top"
      },
      "tokens_used": 11455,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Sihga PICK Element\n\n## Overview\nGenerates SIHGA PICK lifting anchors and CNC machining data for timber roof or floor elements. It automatically calculates lifting point positions based on the Center of Gravity to ensure safe handling during transport and installation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in 3D model context. |\n| Paper Space | No | Not supported for 2D layouts. |\n| Shop Drawing | No | Generates model data, not 2D drawings directly. |\n\n## Prerequisites\n- **Required Entities**: `ElementRoof`, `Beam`, `Sheet`.\n- **Minimum Requirements**: At least one structural beam (min 80x120mm) within the element.\n- **Required Settings**: The script `hsbCenterOfGravity.tsl` must be available in the DWG or search path.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `Sihga PICK Element.mcr`\n*Alternatively, drag and drop the script into the AutoCAD model space.*\n\n### Step 2: Configure Settings (Manual Launch Only)\nIf run manually (not from a catalog), a dialog appears.\n```\nDialog: Select Options\nAction:\n1. Set (A) Quantity to 3 or 4 points.\n2. Set (B) Lifting Belt Length (default 2000mm).\n3. Set (C) Distance Lifting points (default 1000mm).\n4. Toggle (D) Apply Weinmann Tools to Yes/No.\n5. Click OK.\n```\n\n### Step 3: Select Element\n```\nCommand Line: Select element(s)\nAction: Click on the target ElementRoof in the model.\n```\n\n### Step 4: Review Results\nThe script will automatically attach to the element.\n- **Success**: 3D bodies (anchors and belts) are visualized; drills are added to beams.\n- **Failure**: The script instance will delete itself if beams are too small, sheeting is too thick (>22mm), or the Center of Gravity cannot be calculated.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| (A) - Quantity | dropdown | 1 | Select 3 or 4 lifting points distribution. |\n| (B) - Lifting Belt Length | number | 2000 | Length of the lifting slings used (in mm). Determines the max distance between points. |\n| (C) - Distance Lifting points | number | 1000 | Spacing between lifting points. Note: If this value exceeds the safe limit for the belt length, it auto-corrects. |\n| (D) - Apply Weinmann Tools | dropdown | No | If Yes, adds CNC `ElemNoNail` zones and `ElemDrill` operations for Weinmann machinery. |\n| Element weight | text | 0 | Calculated weight of the element. If this exceeds the safe load limit, a visual warning appears. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are defined. Modify properties via the Properties Palette (Ctrl+1). |\n\n## Settings Files\n- **Filename**: None used.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Safety Auto-Correction**: If you set the \"Distance Lifting points\" too wide for the specified \"Lifting Belt Length\", the script will automatically reduce the distance to maintain a minimum 45° lifting angle.\n- **Visual Warnings**: Watch for Red text or \"Attention\" graphics in the model. This indicates the element weight exceeds the load capacity of the lifting configuration or the angle is too shallow.\n- **Beam Size**: Ensure your structural beams are at least 120mm in height and 80mm in width. The script will fail on smaller beams.\n- **Sheeting Limit**: If using Weinmann tools, the top sheeting layer must not exceed 22mm thickness.\n\n## FAQ\n- **Q: Why did the script disappear after I selected the element?**\n  **A:** The script likely failed validation. Check that your beams are at least 80x120mm, the top sheeting is under 22mm thick, and that the `hsbCenterOfGravity` script is loaded.\n- **Q: Why did my \"Distance Lifting points\" value change after I ran the script?**\n  **A:** The input value violated the safety requirements for the specified belt length (lifting angle < 45°). The script automatically corrected it to the maximum safe distance.\n- **Q: What do the \"No-Nail\" zones do?**\n  **A:** If \"Apply Weinmann Tools\" is set to Yes, these zones prevent the CNC machine from applying nails or screws in the critical areas where the lifting anchors are installed."
      },
      "tokens_used": 6310,
      "error": null
    }
  }
}