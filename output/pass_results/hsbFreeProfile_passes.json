{
  "filename": "hsbFreeProfile.mcr",
  "status": "completed",
  "total_tokens": 38254,
  "processing_time": 924.4579439163208,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 2,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tool creates a free profile tool. The tool can be placed anywhere on a Beam/Sheet/Panel/Sip/Clt.",
        "versionHistory": [
          {
            "version": "1.2",
            "date": "11March2021",
            "author": "",
            "changes": "initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5136,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No sd_* or Multipage* prefix found. No #Type E or _Viewport usage detected. Script operates on _GenBeam and _Entity in a 3D modeling context (uses GenBeam, Point3d, PLine, FreeProfile)."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "EntPLine (Polyline)"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space context where a GenBeam and a Polyline can be selected.",
          "requiredSettings": []
        }
      },
      "tokens_used": 3263,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"showDialog\",\n        \"promptOriginal\": \"Standard Property Dialog\",\n        \"condition\": \"_bOnInsert && _kExecuteKey.length() == 0\",\n        \"required\": false\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getGenBeam\",\n        \"promptOriginal\": \"Select beam\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 3,\n        \"function\": \"getEntPLine\",\n        \"promptOriginal\": \"Select polyline\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 4,\n        \"function\": \"getPoint\",\n        \"promptOriginal\": \"Select point to close free profile or to define part to cut\",\n        \"condition\": \"_bOnInsert && pMillSide == '|auto side|'\",\n        \"required\": false\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"showDialog\",\n      \"trigger\": \"_bOnInsert (if not executed via key)\",\n      \"title\": \"hsbFreeProfile Properties\",\n      \"dataSource\": \"OPM Properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"pDepth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Depth\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"General\",\n      \"description\": \"Depth of the free profile. 0 means all the way through\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"pDiam\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Diameter\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"General\",\n      \"description\": \"Diameter of the free profile. This is used whenever an offsetted tool path is needed. 0 means value is retrieved from Hsb_Settings depending on tool index.\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"pToolIndex\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"Tool index\",\n      \"defaultValue\": 0,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"General\",\n      \"description\": \"Tool index aka cncMode. A number of predefined cnc modes exist, but it is actually a value which can be set arbitrarily, and mapped during export to the tool on the machine.\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"pSolidPathOnly\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Solid path only\",\n      \"defaultValue\": \"|No|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No|\",\n        \"|Yes|\"\n      ],\n      \"category\": \"General\",\n      \"description\": \"As solid operation, process the pline path only, as opposed to the complete enclosed area.\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"pMachinePathOnly\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Machine path only\",\n      \"defaultValue\": \"|Yes|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|No|\",\n        \"|Yes|\"\n      ],\n      \"category\": \"General\",\n      \"description\": \"As machining operation, process the pline path only, as opposed to the complete enclosed area.\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"pMillSide"
      },
      "tokens_used": 7636,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a custom-shaped cut or machining operation on timber elements based on a selected 2D polyline.",
          "category": "Machining/CNC",
          "typicalUseCase": "Creating non-rectangular cutouts, decorative trims, or complex connection geometries that cannot be defined by standard rectangular or circular tools."
        },
        "parameters": [
          {
            "name": "pDepth",
            "technicalDefault": 0,
            "businessMeaning": "The depth of the cut into the material. A value of 0 indicates a through cut (perforating the entire element), while a positive value indicates a blind pocket depth.",
            "validRange": "0 (Through cut) to [Element Thickness/Height]",
            "unit": "mm",
            "affectsOutput": "Determines if the tool cuts all the way through the beam or stops at a specific depth."
          },
          {
            "name": "pDiam",
            "technicalDefault": 0,
            "businessMeaning": "The diameter of the cutting tool. Used to calculate the tool path offset so the cut edge matches the drawn line exactly. A value of 0 retrieves the default tool diameter from the Hsb_Settings database based on the Tool Index.",
            "validRange": "0 (Auto/Default) or [Typical Tool Diameters, e.g., 6mm to 30mm]",
            "unit": "mm",
            "affectsOutput": "Offsets the generated CNC path to account for tool radius, ensuring the final physical cut matches the drawn geometry."
          },
          {
            "name": "pToolIndex",
            "technicalDefault": 0,
            "businessMeaning": "The CNC operation code (Mode) assigned to this profile. This maps the operation to a specific machine tool or strategy during the export process.",
            "validRange": "Integers defined in the Machine Post-Processor configuration",
            "unit": "Integer (ID)",
            "affectsOutput": "Selects which physical tool and machining strategy are used in the factory."
          },
          {
            "name": "pSolidPathOnly",
            "technicalDefault": "|No|",
            "businessMeaning": "Controls the 3D model representation. If 'No', the operation is modeled as a volumetric pocket (removing material). If 'Yes', it is modeled as a surface line or groove (visual only), often used for engravings or surface treatments.",
            "validRange": "|No|, |Yes|",
            "unit": "Enum",
            "affectsOutput": "Switches the 3D CAD visualization between a removed volume (pocket) and a surface path."
          },
          {
            "name": "pMachinePathOnly",
            "technicalDefault": "|Yes|",
            "businessMeaning": "Controls the CNC output strategy. If 'Yes', the machine follows the path contour (routing). If 'No', the machine treats the enclosed area as a pocket to be milled out.",
            "validRange": "|No|, |Yes|",
            "unit": "Enum",
            "affectsOutput": "Determines if the CNC machine performs a contour cut or an area clearance (pocketing) operation."
          },
          {
            "name": "pMillSide",
            "technicalDefault": "|auto side|",
            "businessMeaning": "Defines the orientation of the cut relative to the drawn polyline. 'Left', 'Right', or 'Center' determines which side of the line the material is removed (or where the tool center runs).",
            "validRange": "|auto side|, |left|, |center|, |right|",
            "unit": "Enum/Direction",
            "affectsOutput": "Offsets the tool path to the left, right, or center of the defining geometry."
          },
          {
            "name": "pCutDefAsOne",
            "technicalDefault": "|No|",
            "businessMeaning": "Optimization for CNC data generation. If 'No', the script trims the defining polyline to the beam's bounding box to create efficient, localized machine code. If 'Yes', the full original polyline is exported, potentially causing unnecessary air-cutting.",
            "validRange": "|No|, |Yes|",
            "unit": "Enum",
            "affectsOutput": "Optimizes the CNC G-code by limiting operations to the immediate area of the beam."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User sets 'pMillSide' to '|auto side|' during insertion",
            "effect": "The script prompts the user to select a point on screen to define which side of the polyline is the cut side.",
            "cascade": [
              "_PtG (Grip Points)"
            ]
          },
          {
            "trigger": "User sets 'pDiam' to 0",
            "effect": "The system automatically attempts to retrieve the tool diameter from global settings using the 'pToolIndex' value.",
            "cascade": [
              "pToolIndex"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "FreeProfile (Machining)",
            "description": "A custom 3D cut or 2D machining path applied to the surface of the element.",
            "appliedTo": "The selected GenBeam (Beam, Sheet, Panel, SIP, or CLT)."
          }
        ]
      },
      "tokens_used": 7294,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch script (hsbFreeProfile.mcr)",
          "2. Determine Input Mode: Check if executed via Console Key (_kExecuteKey)",
          "3. [Branch] If Key present: Load properties from Catalog; If No Key: Show Properties Dialog (OPM)",
          "4. Prompt user to select a GenBeam (Beam/Sheet/Panel/Sip/Clt)",
          "5. Prompt user to select a Polyline (PLine)",
          "6. Check MillSide property setting",
          "7. [Conditional] If MillSide is '|auto side|': Prompt user to select a point to define cut side/closure",
          "8. Calculate and generate FreeProfile machining operation",
          "9. Apply tool to GenBeam and draw visual representation",
          "10. [Optional] Right-click trigger: Add Ecs (Coordinate System Marker) to define custom orientation"
        ],
        "conditionalBranches": [
          {
            "condition": "Script initialization method",
            "path1": {
              "name": "Catalog/Console Insertion",
              "steps": [
                "Detects _kExecuteKey",
                "Checks if key exists in TSL Catalog names",
                "Loads property values from specific catalog entry (or '_LastInserted' if not found)",
                "Skips Properties Dialog"
              ]
            },
            "path2": {
              "name": "Standard Manual Insertion",
              "steps": [
                "Detects empty _kExecuteKey",
                "Executes showDialog()",
                "User enters values via Object Properties Palette (OPM)",
                "Proceeds to entity selection"
              ]
            }
          },
          {
            "condition": "MillSide property value",
            "path1": {
              "name": "Auto Side Definition",
              "steps": [
                "Detects pMillSide == '|auto side|'",
                "Prompts user: 'Select point to close free profile or to define part to cut'",
                "Stores point in _PtG array to determine cut orientation"
              ]
            },
            "path2": {
              "name": "Explicit Side Definition",
              "steps": [
                "Detects pMillSide is Left, Right, or Center",
                "Skips point selection prompt",
                "Uses explicit property value for offset calculation"
              ]
            }
          },
          {
            "condition": "Post-Insertion Orientation (Ecs)",
            "path1": {
              "name": "Ecs Alignment Active",
              "steps": [
                "User executes 'Add Ecs' context menu command",
                "Creates EcsMarker at polyline start",
                "Script monitors EcsMarker for movement/rotation",
                "Transforms Polyline to match EcsMarker orientation on every update"
              ]
            },
            "path2": {
              "name": "Standard PLine Dependency",
              "steps": [
                "No EcsMarker present",
                "Script relies solely on the geometry of the selected Polyline",
                "Updates only if the original Polyline is modified"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "GenBeam Validity",
            "errorMessage": "State invalid: missing genbeam (Debug message only)",
            "recovery": "Script erases itself (eraseInstance) if the attached beam is missing or invalid. User must re-insert the script."
          },
          {
            "check": "Insertion Cycle Count",
            "errorMessage": "None (Silent)",
            "recovery": "If insertCycleCount() > 1, the script erases itself to prevent infinite loops during insertion."
          },
          {
            "check": "Polyline Selection",
            "errorMessage": "None (AutoCAD default prompt)",
            "recovery": "User must select a valid EntPLine to proceed."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties",
            "how": "Select element -> Properties Palette (OPM)",
            "effect": "Updating pDepth, pDiam, or pMachinePathOnly immediately recalculates the FreeProfile geometry and CNC output."
          },
          {
            "action": "Edit Geometry",
            "how": "Grip edit the original Polyline in CAD",
            "effect": "The FreeProfile updates to match the new shape of the Polyline."
          },
          {
            "action": "Reorient Profile",
            "how": "Right-click -> 'Add Ecs' (if not already added) -> Move/Rotate the EcsMarker",
            "effect": "The defining Polyline transforms relative to the EcsMarker, allowing complex 3D orientation of the 2D profile path."
          },
          {
            "action": "Initialize from Map",
            "how": "Programmatic (Console Tools -> Convert)",
            "effect": "Script can receive data via 'InitializeFrom' map to create a profile based on existing calculations, setting all properties and geometry automatically."
          }
        ]
      },
      "tokens_used": 8037,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbFreeProfile.mcr\n\n## Overview\nThis tool allows you to create custom-shaped cutouts, pockets, or decorative profiles on timber elements (beams, panels, CLT, etc.) by selecting an existing 2D polyline. It supports both visual modeling for drawings and CNC output for manufacturing.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates in 3D model context. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | This is a modeling/cam script, not a detailing script. |\n\n## Prerequisites\n- **Required Entities**:\n  - A GenBeam (Beam, Sheet, Panel, SIP, or CLT element).\n  - A 2D Polyline (EntPLine) defining the shape of the cut.\n- **Minimum Beam Count**: 1\n- **Required Settings**: None strictly required, but `Hsb_Settings` is referenced if Tool Diameter is set to 0 (Auto).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbFreeProfile.mcr` from the list.\n\n### Step 2: Configure Properties (Optional)\n- **Action**: The Properties Palette will appear automatically upon insertion (unless run from a specific catalog configuration).\n- **Action**: Adjust default parameters like Depth, Diameter, or Tool Index if needed before selecting geometry.\n\n### Step 3: Select Element\n```\nCommand Line: Select beam\nAction: Click on the timber element (Beam, Panel, CLT) you wish to modify.\n```\n\n### Step 4: Select Profile Shape\n```\nCommand Line: Select polyline\nAction: Click on the 2D Polyline that defines the shape of the profile or cutout.\n```\n\n### Step 5: Define Cut Side (Conditional)\n```\nCommand Line: Select point to close free profile or to define part to cut\nAction: Only appears if the 'Mill Side' property is set to |auto side|. Click on the side of the polyline where you want the material removed.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Depth | Number | 0 | The depth of the cut. A value of 0 means the cut goes all the way through the material (perforation). |\n| Diameter | Number | 0 | The diameter of the cutting tool. Enter 0 to automatically look up the tool diameter from Hsb_Settings based on the Tool Index. |\n| Tool index | Integer | 0 | The CNC mode or tool ID assigned to this operation. Maps the operation to a specific machine tool during export. |\n| Solid path only | Dropdown | \\|No\\| | If \"No\", models as a volumetric pocket (removed material). If \"Yes\", models as a surface path (visual line/groove). |\n| Machine path only | Dropdown | \\|Yes\\| | If \"Yes\", the machine follows the path contour (routing). If \"No\", the machine treats the enclosed area as a pocket to be milled out. |\n| Mill side | Dropdown | \\|auto side\\| | Defines the cut orientation relative to the polyline: Left, Right, Center, or Auto (prompts for point selection). |\n| Cut Def As One | Dropdown | \\|No\\| | Optimization setting. If \"No\", trims the polyline to the beam boundary for efficient code. If \"Yes\", exports the full original polyline path. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Add Ecs | Adds an Entity Coordinate System (ECS) marker. This allows you to rotate and move the 2D profile in 3D space independent of the original polyline's orientation. |\n\n## Settings Files\n- **Filename**: `Hsb_Settings` (Referenced)\n- **Location**: Database/Company Standards\n- **Purpose**: Provides default tool diameters when the `Diameter` property is set to 0.\n\n## Tips\n- **Editing the Shape**: You can grip-edit the original Polyline in AutoCAD after insertion, and the FreeProfile will automatically update to match the new geometry.\n- **3D Orientation**: Use the \"Add Ecs\" right-click option if your profile needs to be cut at an angle or projected onto a complex face. Move the Ecs marker to reorient the tool path.\n- **Through Cuts**: Leave `Depth` as 0 for a cut that penetrates the entire beam or panel thickness.\n\n## FAQ\n- **Q: The script disappeared after I deleted the beam.**\n- A: This is normal behavior. The script is linked to the beam; if the beam is erased, the script erases itself to prevent errors.\n- **Q: What is the difference between Solid path only and Machine path only?**\n- A: *Solid path only* controls what you see in the 3D model (Volume vs. Line). *Machine path only* controls how the CNC machine cuts (Contour vs. Pocket Area).\n- **Q: How do I change the size of the cutter bit without measuring?**\n- A: Set the `Diameter` property to 0 and ensure the correct `Tool index` is selected. The system will pull the correct size from your standard settings."
      },
      "tokens_used": 6888,
      "error": null
    }
  }
}