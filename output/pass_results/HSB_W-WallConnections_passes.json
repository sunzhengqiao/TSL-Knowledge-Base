{
  "filename": "HSB_W-WallConnections.mcr",
  "status": "completed",
  "total_tokens": 48809,
  "processing_time": 377.10034680366516,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 3,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "06.03.2014",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "01.03.2015",
            "author": "AS",
            "changes": "Do vector comparison with a tolerance.Check width of intersecting body (FogBugzId 868)."
          },
          {
            "version": "1.02",
            "date": "08.02.2017",
            "author": "AS",
            "changes": "Base connection profile on frame thickness of male element."
          },
          {
            "version": "1.03",
            "date": "15.05.2018",
            "author": "AS",
            "changes": "Add fallback for frame thickness for sip elements."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8266,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script explicitly passes _kModelSpace to the dbCreate function. It uses ElementWall and modifies 3D geometry using Drill and GenBeam interactions. No ShopDrawing (sd_) prefixes, Viewport handling, or 2D drawing generation logic is present."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space with connected ElementWall entities",
          "requiredSettings": []
        }
      },
      "tokens_used": 7193,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "_bOnInsert && (_kExecuteKey == \"\" || catalogKeyNotFound)",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeperator01",
            "type": "PropString",
            "displayName": "|Drill pattern|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dOffsetFromBottom",
            "type": "PropDouble",
            "displayName": "     |Offset from bottom|",
            "defaultValue": "U(50)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dOffsetFromTop",
            "type": "PropDouble",
            "displayName": "     |Offset from top|",
            "defaultValue": "U(50)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dMaximumSpacing",
            "type": "PropDouble",
            "displayName": "     |Maximum spacing|",
            "defaultValue": "U(300)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sSeperator02",
            "type": "PropString",
            "displayName": "|Drills|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dDrillDiameter",
            "type": "PropDouble",
            "displayName": "     |Diameter|",
            "defaultValue": "U(10)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sArticle",
            "type": "PropString",
            "displayName": "     |Fixing|",
            "defaultValue": "Fix90",
            "inputType": "dropdown",
            "options": [
              "Fix90",
              "Fix80",
              "Fix70"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8967,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically calculates and applies a vertical pattern of drill holes to connect two intersecting wall elements, ensuring the layout fits within the connection height.",
          "category": "Hardware/Connection",
          "typicalUseCase": "Used when connecting prefabricated timber walls (e.g., corner or T-junctions) where fixings (like Fix90/80/70 connectors) need to be installed at regular vertical intervals."
        },
        "parameters": [
          {
            "name": "dOffsetFromBottom",
            "technicalDefault": "U(50)",
            "businessMeaning": "The safety margin or clearance distance from the bottom of the wall connection to the center of the lowest drill hole.",
            "validRange": "0 mm to Wall Height/2",
            "unit": "mm",
            "affectsOutput": "Shifts the start of the drilling pattern upwards. Too large a value combined with the top offset might prevent any holes from being generated."
          },
          {
            "name": "dOffsetFromTop",
            "technicalDefault": "U(50)",
            "businessMeaning": "The safety margin or clearance distance from the top of the wall connection to the center of the highest drill hole.",
            "validRange": "0 mm to Wall Height/2",
            "unit": "mm",
            "affectsOutput": "Shifts the end of the drilling pattern downwards."
          },
          {
            "name": "dMaximumSpacing",
            "technicalDefault": "U(300)",
            "businessMeaning": "The maximum allowable distance between the centers of drill holes. The script calculates the actual spacing to be less than or equal to this value while filling the available height evenly.",
            "validRange": "Typically 200mm - 600mm",
            "unit": "mm",
            "affectsOutput": "Determines the quantity of drill holes. A smaller spacing results in more holes; a larger spacing results in fewer holes."
          },
          {
            "name": "dDrillDiameter",
            "technicalDefault": "U(10)",
            "businessMeaning": "The diameter of the hole to be drilled through the wall material for the fixing.",
            "validRange": "Typically 8mm - 20mm depending on the screw/bolt used",
            "unit": "mm",
            "affectsOutput": "Defines the physical size of the cylindrical void machined into the timber elements."
          },
          {
            "name": "sArticle",
            "technicalDefault": "Fix90",
            "businessMeaning": "The commercial name of the connecting hardware (Wall connector). This maps to a description for reports (e.g., 'Wall connector 90mm wall').",
            "validRange": "Fix90, Fix80, Fix70",
            "unit": "N/A",
            "affectsOutput": "Updates the Element/BOM data attached to the wall with the correct article number and description. Does not alter geometry directly."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dOffsetFromBottom + dOffsetFromTop > Available Wall Height",
            "effect": "Script will fail and report 'No possible drill positions found', resulting in no holes being drilled.",
            "cascade": []
          },
          {
            "trigger": "dMaximumSpacing",
            "effect": "Interacts with the Available Wall Height (minus offsets) to determine the exact spacing (dSpacing) and the number of holes (nNrOfSpacings + 1).",
            "cascade": []
          },
          {
            "trigger": "dDrillDiameter",
            "effect": "Validated against the calculated connection width (dConnectionWidth). If width is less than 2 * diameter, the script fails with 'Connecting surface is too small'.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Drill",
            "description": "Through-holes in the 'female' wall element, positioned vertically according to the spacing calculation.",
            "appliedTo": "The wall element identified as the 'female' part of the intersection (the one being drilled into)."
          },
          {
            "type": "ElemItem",
            "description": "An item attached to the element containing the BOM data (Article Number, Description, Amount).",
            "appliedTo": "The 'female' wall element."
          },
          {
            "type": "Visualization",
            "description": "Circles and lines drawn in the model to visualize the drill positions and diameters.",
            "appliedTo": "Screen display (non-physical)."
          }
        ]
      },
      "tokens_used": 7831,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Master Script Instance",
          "2. Check for Execute Key (_kExecuteKey) in Catalog names",
          "3. [Branch] Show Dialog OR Load Properties from Catalog",
          "4. Prompt User to Select a set of ElementWalls (PrEntity)",
          "5. Iterate through selected elements and find connected neighbors",
          "6. [Loop] For each unique pair of intersecting walls:",
          "7.   Check if connection script already exists between pair",
          "8.   Identify 'MasterToSatellite' map properties",
          "9.   dbCreate Satellite Instance for the specific pair",
          "10. Erase Master Instance",
          "11. Satellite Instance Start: Load properties from Map",
          "12. Validate exactly 2 Elements assigned",
          "13. Determine Connection Geometry (Male vs Female, Corner vs T-junction)",
          "14. Extract Contact Profile using Male wall frame thickness",
          "15. Calculate Vertical Drill Layout based on Offsets and Max Spacing",
          "16. Create Drill and Visualization entities",
          "17. Apply Drills to Female Wall GenBeams",
          "18. Assign Element Group and attach BOM Item (Article)"
        ],
        "conditionalBranches": [
          {
            "condition": "Execute Key presence during insertion",
            "path1": {
              "name": "Catalog/Key Mode",
              "steps": [
                "Check if key exists in catalog list",
                "Load properties using setPropValuesFromCatalog",
                "Skip Dialog display"
              ]
            },
            "path2": {
              "name": "Manual Mode",
              "steps": [
                "If invalid key passed, report error",
                "Execute showDialog()",
                "User inputs values manually"
              ]
            }
          },
          {
            "condition": "Wall orientation relative to each other",
            "path1": {
              "name": "Inline Connection",
              "steps": [
                "Detect Z-vectors are parallel (dot product approx 1)",
                "Report 'Elements are in line'",
                "Erase instance (Not supported)"
              ]
            },
            "path2": {
              "name": "Intersecting Connection",
              "steps": [
                "Proceed to determine Male/Female based on outline points",
                "Calculate connection profile"
              ]
            }
          },
          {
            "condition": "Available space for drill distribution",
            "path1": {
              "name": "Insufficient Space",
              "steps": [
                "Calculate (Wall Height - Bottom Offset - Top Offset)",
                "If Result < Maximum Spacing (or zero)",
                "Report 'No possible drill positions found'",
                "Erase instance"
              ]
            },
            "path2": {
              "name": "Valid Space",
              "steps": [
                "Calculate exact spacing (Distribution Length / Integer Spacing Count)",
                "Generate drill loop"
              ]
            }
          },
          {
            "condition": "Connection surface width",
            "path1": {
              "name": "Surface Too Small",
              "steps": [
                "Compare Connection Width to 2 * Drill Diameter",
                "If Width is smaller",
                "Report 'Connecting surface is too small'",
                "Erase instance"
              ]
            },
            "path2": {
              "name": "Valid Width",
              "steps": [
                "Proceed with drill calculations"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Number of Elements attached to script instance",
            "errorMessage": "Invalid number of elements!",
            "recovery": "Script deletes self; ensure selection runs from Master script correctly."
          },
          {
            "check": "Element Validity (bIsValid)",
            "errorMessage": "Invalid element found!",
            "recovery": "Script deletes self; ensure valid ElementWall types selected."
          },
          {
            "check": "Geometric Intersection (Surfaces connecting)",
            "errorMessage": "Surfaces are not connecting!",
            "recovery": "Script deletes self; ensure walls physically touch or overlap."
          },
          {
            "check": "Connection Width vs Drill Diameter",
            "errorMessage": "Connecting surface is too small!",
            "recovery": "Reduce Drill Diameter or increase wall overlap/connection width."
          },
          {
            "check": "Vertical Space (Offsets vs Spacing)",
            "errorMessage": "No possible drill positions found!",
            "recovery": "Reduce OffsetFromBottom/Top or reduce MaximumSpacing."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Drill Parameters",
            "how": "OPM Properties (AutoCAD Properties Palette)",
            "effect": "Updating 'Offset', 'Spacing', or 'Diameter' triggers script recalculation to adjust hole positions/sizes dynamically."
          },
          {
            "action": "Change Fixing Article",
            "how": "OPM Property 'Fixing' dropdown",
            "effect": "Updates the BOM data (ElemItem) associated with the connection; changes Description (e.g., 'Wall connector 90mm')."
          },
          {
            "action": "Move or Resize Walls",
            "how": "CAD Grips or Move commands on the ElementWall entities",
            "effect": "Script detects geometric change, recalculates intersection profile, and repositions/drills holes based on new connection geometry."
          }
        ]
      },
      "tokens_used": 10220,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_W-WallConnections.mcr\n\n## Overview\nThis script automates the creation of wall-to-wall connections by calculating and drilling a vertical pattern of holes for mechanical fixings (such as Fix90 connectors). It ensures holes are evenly spaced within the intersecting area of two ElementWalls and updates the BOM data accordingly.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script runs in 3D environment and generates physical drill holes. |\n| Paper Space | No | Not applicable for layout generation. |\n| Shop Drawing | No | Does not generate 2D views or dimensions. |\n\n## Prerequisites\n- **Required Entities**: At least two `ElementWall` entities that physically intersect (touch or overlap).\n- **Minimum Beam Count**: 0 (Works on ElementWall entities, not individual beams).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_W-WallConnections.mcr`\n\n### Step 2: Select Walls\n```\nCommand Line: Select a set of elements\nAction: Click on the main wall and the intersecting wall(s) you wish to connect.\n```\n*Note: You can select multiple walls at once. The script will detect intersections between the selected elements and create individual connection instances for every valid junction found.*\n\n### Step 3: Configure Parameters (Optional)\nAfter insertion, the connection instances are created. Select a specific connection instance (or the group) and open the **Properties Palette (OPM)** to adjust settings like offsets or drill diameter.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| \\|Drill pattern\\| | Separator | | Section header for layout settings. |\n| Offset from bottom | Number | 50 mm | The vertical distance from the bottom of the intersection to the center of the first drill hole. |\n| Offset from top | Number | 50 mm | The vertical distance from the top of the intersection to the center of the last drill hole. |\n| Maximum spacing | Number | 300 mm | The maximum allowed distance between the centers of drill holes. The script will automatically calculate a spacing equal to or less than this value to fit the holes evenly. |\n| \\|Drills\\| | Separator | | Section header for drilling hardware settings. |\n| Diameter | Number | 10 mm | The diameter of the drill hole to be created. |\n| Fixing | Dropdown | Fix90 | The article number for the wall connector (e.g., Fix90, Fix80, Fix70). This updates the BOM description (e.g., \"Wall connector 90mm wall\"). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | No custom context menu items are defined for this script. |\n\n## Settings Files\n- **Filename**: *None*\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Dynamic Updates**: If you move the walls or change their heights, the script automatically recalculates the drill positions to stay within the new intersection bounds.\n- **Spacing Logic**: The `Maximum spacing` is a ceiling value. If you have a wall height of 1000mm with 0 offsets, and set max spacing to 600mm, the script will calculate the exact spacing to fill the height evenly (e.g., dividing the height into sections), rather than strictly leaving a large gap.\n- **Visualizing Errors**: If the script instance disappears after insertion, check the command line. It likely reported \"No possible drill positions found\" (if offsets are too large) or \"Surfaces are not connecting!\" (if walls do not touch).\n\n## FAQ\n- **Q: Why did the script instance disappear immediately after I selected the walls?**\n  **A:** This usually happens if the script detects an error. Common causes include:\n  1. The walls are in a straight line (inline) rather than intersecting at a corner or T-junction.\n  2. The walls do not physically touch or overlap in 3D space.\n  3. The calculated connection width is smaller than twice the drill diameter.\n\n- **Q: Can I use this to connect beams?**\n  **A:** No, this script is designed specifically for `ElementWall` entities. For beam-to-beam connections, use a different TSL script.\n\n- **Q: How do I change the connector type after the holes are drilled?**\n  **A:** Select the connection instance in the model, open the Properties Palette, and change the **Fixing** dropdown. This updates the report/BOM data without altering the geometry."
      },
      "tokens_used": 6332,
      "error": null
    }
  }
}