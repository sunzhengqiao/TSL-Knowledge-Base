{
  "filename": "Hsb-LooseMaterials.mcr",
  "status": "completed",
  "total_tokens": 53226,
  "processing_time": 267.20399355888367,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 17,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "v1.01",
            "date": "051209",
            "author": "Anno Sportel",
            "changes": "First revision"
          },
          {
            "version": "v1.02",
            "date": "051212",
            "author": "Anno Sportel",
            "changes": "Add read-write function of map file"
          },
          {
            "version": "v1.03",
            "date": "051214",
            "author": "Anno Sportel",
            "changes": "Allow multiple dxi's"
          },
          {
            "version": "v1.04",
            "date": "060116",
            "author": "Anno Sportel",
            "changes": "Add number of columns"
          },
          {
            "version": "v1.05",
            "date": "060126",
            "author": "Anno Sportel",
            "changes": "Correct database output"
          },
          {
            "version": "v1.06",
            "date": "060428",
            "author": "Anno Sportel",
            "changes": "Extend number of columns: label, function, units"
          },
          {
            "version": "v1.07",
            "date": "060522",
            "author": "Anno Sportel",
            "changes": "Increase quantity, add category to group, correct error while connecting 2 tables to same floorgroup"
          },
          {
            "version": "v1.08",
            "date": "060620",
            "author": "Anno Sportel",
            "changes": "Add housename to xml name."
          },
          {
            "version": "v1.09",
            "date": "060620",
            "author": "Anno Sportel",
            "changes": "Correct error on grouping items."
          },
          {
            "version": "v1.10",
            "date": "060710",
            "author": "Anno Sportel",
            "changes": "Only allow editing if floor group where the tsl belongs to is set current."
          },
          {
            "version": "v1.11",
            "date": "061019",
            "author": "Anno Sportel",
            "changes": "Quantity as double."
          },
          {
            "version": "v1.12",
            "date": "061101",
            "author": "Anno Sportel",
            "changes": "Assign to original group. _ not allowed in group names."
          },
          {
            "version": "v1.13",
            "date": "070328",
            "author": "Anno Sportel",
            "changes": "Assign to original group exlusively."
          },
          {
            "version": "v1.14",
            "date": "26.06.2009",
            "author": "Anno Sportel",
            "changes": "Current floorgroup not needed anymore on update."
          },
          {
            "version": "v1.15",
            "date": "05.02.2015",
            "author": "GJ Brandriet",
            "changes": "Change or Update are now on rightmouseclick"
          },
          {
            "version": "v1.16",
            "date": "25.09.2017",
            "author": "Anno Sportel",
            "changes": "Fix translation issue with catalogs."
          },
          {
            "version": "v1.17",
            "date": "13/10/2021",
            "author": "Robert Pol",
            "changes": "Add DWeight to table"
          }
        ],
        "settingsFiles": [
          ".xml"
        ],
        "dependencies": []
      },
      "tokens_used": 9016,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly collects entities from Model Space using `Entity arEnt[] = grpCurrent.collectEntities(FALSE, TslInst(), _kModelSpace);`. It utilizes `Display` objects to draw 2D geometry (a table) relative to a point in the model but lacks `sd_` prefixes, `_Viewport` usage, or ShopDrawing specific entity types."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "A valid Floor Group (House\\Floor hierarchy) must be set as the current group.",
          "requiredSettings": [
            "hsbCadLooseMaterial.exe (external utility found in hsbCAD install path)",
            "FloorGroup-specific XML file for material data"
          ]
        }
      },
      "tokens_used": 8266,
      "error": null
    },
    "3": {
      "success": true,
      "data": {},
      "tokens_used": 11016,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Generates a customizable 2D Bill of Materials (BOM) table for non-modeled 'loose' materials (fasteners, plates, etc.) linked to a specific floor group, based on data imported from an external XML file.\",\n    \"category\": \"Documentation / Scheduling\",\n    \"typicalUseCase\": \"Creating a material take-off report for a specific house floor, displaying items like nails and screws that are not physically modeled in 3D but are required for production.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"sDimStyle\",\n      \"technicalDefault\": \"Standard\",\n      \"businessMeaning\": \"Selects the text style (font, height, etc.) used for all text inside the table to ensure it matches the drawing's CAD standards.\",\n      \"validRange\": \"Any existing Dimension Style in the drawing\",\n      \"unit"
      },
      "tokens_used": 10596,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Start / Parameter Initialization: Load properties (Styles, Colors, Columns, Sort options).",
          "2. Insertion Check: Verify if this is the first cycle of an insert operation (_bOnInsert).",
          "3. User Input: Prompt user to select the upper left corner of the table.",
          "4. Group Validation: Check if the current group is a Floor group (House\\Floor hierarchy) and valid (no underscores).",
          "5. Duplicate Check: Scan current floor group for existing 'Hsb-LooseMaterials' instances to prevent duplicates.",
          "6. Attachment: Attach the TSL instance to the Floor group.",
          "7. Data Import (Triggered on Insert or Right-Click Update): Locate specific XML file based on Floor Group name.",
          "8. External Application: Launch 'hsbCadLooseMaterial.exe' to allow user editing of material data.",
          "9. Data Reload: Read updated data from XML into the script's Map structure.",
          "10. Data Processing: Parse Map data into arrays (Articles, Dimensions, Quantities, etc.).",
          "11. Sorting: Sort items based on the selected sort key and order.",
          "12. Visualization: Calculate column widths and generate 2D geometry (Lines and Text) for the table.",
          "13. Completion: Finish execution (if Insert, return; if Update, redraw table)."
        ],
        "conditionalBranches": [
          {
            "condition": "Is the script being inserted (_bOnInsert) and is it the first cycle?",
            "path1": {
              "name": "Insert Path",
              "steps": [
                "Prompt for insertion point",
                "Validate Current Group",
                "Check for duplicates in current group",
                "Assign to Floor Group",
                "Launch external editor (.exe)",
                "Reload data from XML",
                "Exit script (return) to wait for next recalculation"
              ]
            },
            "path2": {
              "name": "Update/Recalc Path",
              "steps": [
                "Read properties from OPM",
                "Read XML Data",
                "Sort and Redraw Table"
              ]
            }
          },
          {
            "condition": "Right-Click Menu 'Change or Update materials' selected",
            "path1": {
              "name": "Update Execution",
              "steps": [
                "Locate XML file based on stored Floor Group property",
                "Launch external editor",
                "Reload data",
                "Redraw table with new data"
              ]
            }
          },
          {
            "condition": "Does Current Group name meet criteria (House/Floor structure)?",
            "path1": {
              "name": "Valid Group",
              "steps": [
                "Proceed to attach TSL"
              ]
            },
            "path2": {
              "name": "Invalid Group",
              "steps": [
                "Show Warning (No group or incorrect level)",
                "Erase TSL instance",
                "Abort"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Current Group must be set to a Floor level (House\\Floor).",
            "errorMessage": "'No current group selected!\\nSet group current at floor level.' OR 'Set group current at floor level.'",
            "recovery": "User must set the correct Floor group current in CAD before running script."
          },
          {
            "check": "Group name must not contain an underscore '_'.",
            "errorMessage": "'Groupname cannot contain a _'",
            "recovery": "User must rename the group to remove underscores."
          },
          {
            "check": "No duplicate 'Hsb-LooseMaterials' TSL allowed in the same Floor Group.",
            "errorMessage": "'There is already a tsl called Hsb-LooseMaterials attached to this floorgroup!'",
            "recovery": "User must delete the existing instance or select a different Floor Group."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Materials Data",
            "how": "Right-click context menu -> 'Change or Update materials'",
            "effect": "Opens external .exe editor to modify quantities/items. On save/close, the TSL recalculates and updates the drawing table."
          },
          {
            "action": "Modify Visual Style",
            "how": "Properties Palette (OPM)",
            "effect": "Changes dimension style, line colors, text colors, and column visibility immediately on recalculation."
          },
          {
            "action": "Modify Sorting",
            "how": "Properties Palette (OPM) -> Sort Column / Sort Mode",
            "effect": "Reorders the rows in the table based on the selected criteria."
          },
          {
            "action": "Move Table",
            "how": "Grip Edit",
            "effect": "Relocates the upper left corner (_Pt0) of the table in the drawing."
          }
        ]
      },
      "tokens_used": 8811,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Hsb-LooseMaterials\n\n## Overview\nGenerates a customizable 2D Bill of Materials (BOM) table for non-modeled \"loose\" materials (such as nails, screws, and metal plates) associated with a specific floor group, using data imported from an external XML file.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script creates 2D geometry (lines and text) in the model space. |\n| Paper Space | No | Not designed for layout tabs. |\n| Shop Drawing | No | This is a model space documentation tool. |\n\n## Prerequisites\n- **Required Entities**: None.\n- **Minimum Beam Count**: 0.\n- **Required Settings**:\n  - **Floor Group**: You must have a Floor Group (e.g., `House\\Ground Floor`) selected as the current group in the hsbCAD organizer.\n  - **External Tool**: The script relies on `hsbCadLooseMaterial.exe` (found in your hsbCAD installation folder) to edit material data.\n  - **Group Naming**: The Floor Group name must **not** contain an underscore `_`.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Browse and select `Hsb-LooseMaterials.mcr`.\n\n### Step 2: Set Current Group\nAction: Before inserting the script, right-click your desired Floor Group (e.g., `House\\Ground Floor`) in the hsbCAD Organizer tree and select **Set Current**.\n*Note: The script will fail if you are at the House level or if the group name contains an underscore `_`.*\n\n### Step 3: Pick Insertion Point\n```\nCommand Line: Pick insertion point:\nAction: Click in the Model Space where you want the top-left corner of the table to appear.\n```\n\n### Step 4: Edit Materials (Automatic)\nAction: Upon the first insertion, the `hsbCadLooseMaterial` application will automatically launch.\n- Use this external tool to add loose materials (e.g., \"Nail 3.1x90\"), set quantities, dimensions, and units.\n- Save and close the application.\n- The TSL will recalculate and draw the table in your drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **sDimStyle** | String | Standard | The text style used for the table content. |\n| **_Pt0** | Point | (0,0,0) | The insertion point (top-left corner) of the table. Use the grip to move this in the drawing. |\n| **dTextHeight** | Double | 2.5 | The height of the text within the table rows. |\n| **dRowHeight** | Double | 6.0 | The height of each table row. |\n| **dColWidth0** to **dColWidth7** | Double | Various | Width of specific columns in the table. Adjust these to fit your text content. |\n| **colorLine** | Integer | Various | Color index for the table grid lines. |\n| **colorText** | Integer | Various | Color index for the text inside the table. |\n| **colorHeader** | Integer | Various | Color index for the header row background/text. |\n| **bShowLabel**, **bShowFunction**, etc. | Boolean | 1 (True) | Toggles the visibility of specific columns (Label, Function, Units, etc.). |\n| **nSortColumn** | Integer | 0 | Determines which column number to sort the table by (0 = first column). |\n| **nSortMode** | Integer | 1 | Sorting order (e.g., Ascending/Descending). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Change or Update materials** | Opens the external `hsbCadLooseMaterial` editor. You can modify the material list, quantities, or descriptions here. Upon saving and closing, the table in the drawing will automatically update to reflect the changes. |\n\n## Settings Files\n- **Filename**: `[HouseName]_[FloorName].xml`\n- **Location**: The script looks for an XML file matching the name of your current Floor Group in the project directory.\n- **Purpose**: Stores the list of loose materials, their quantities, units, and descriptions. This file acts as the database for the table.\n\n## Tips\n- **Avoid Underscores**: Ensure your Floor Group names in the hsbCAD Organizer do not use underscores (e.g., use `Ground Floor` instead of `Ground_Floor`), or the script will abort.\n- **Moving the Table**: You can drag the table using the grip point at the top-left corner (_Pt0) without triggering a recalculation of the material data.\n- **Column Widths**: If text looks cut off, increase the `dColWidth...` properties in the Properties Palette to make specific columns wider.\n- **One Table Per Floor**: You can only have one instance of this script attached to a specific Floor Group. If you need to replace it, delete the old instance first.\n\n## FAQ\n- **Q: I get an error \"Set group current at floor level.\"**\n  A: You have selected the \"House\" group or a different entity. Right-click the specific floor (e.g., \"1st Floor\") in the Organizer and choose \"Set Current\" before inserting the script.\n\n- **Q: I get an error \"Groupname cannot contain a _\".**\n  A: Rename your Floor Group in the hsbCAD Organizer to remove any underscore characters.\n\n- **Q: How do I add a new item like \"Spackle\" to the list?**\n  A: Right-click the table in the drawing, select \"Change or Update materials,\" add the item in the window that pops up, and save/close.\n\n- **Q: The table is empty after insertion.**\n  A: This usually means the associated XML file was created but contains no data. Use the \"Change or Update materials\" right-click option to populate it."
      },
      "tokens_used": 5521,
      "error": null
    }
  }
}