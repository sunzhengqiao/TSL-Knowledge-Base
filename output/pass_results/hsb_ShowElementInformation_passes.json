{
  "filename": "hsb_ShowElementInformation.mcr",
  "status": "completed",
  "total_tokens": 49884,
  "processing_time": 206.86216378211975,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": null,
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.12",
            "date": "05.09.2022",
            "author": "Marsel Nakuci",
            "changes": "HSB-16425: Add filter for wall comments"
          },
          {
            "version": "1.0",
            "date": "14.03.2012",
            "author": null,
            "changes": "Release version"
          },
          {
            "version": "1.1",
            "date": "21.05.2012",
            "author": null,
            "changes": "Add floorplan numbers for viewport"
          },
          {
            "version": "1.2",
            "date": "01.05.2013",
            "author": null,
            "changes": "Add wall height base on timbers"
          },
          {
            "version": "1.10",
            "date": "17.04.2020",
            "author": null,
            "changes": "Add support for new comment format"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8412,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "Both",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script features a 'Drawing space' property allowing selection between 'Model space' and 'Paper space'. In Model Space, it uses PrEntity to select Elements. In Paper Space, it uses getViewport() to select a viewport and _Viewport[] to store it. It implements logic to transform coordinates between spaces (ms2ps) and draw text using dp.draw() in either context."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (requires selected Element) or Paper Space (requires selected Viewport linked to an Element).",
          "requiredSettings": []
        }
      },
      "tokens_used": 6730,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select Elements",
              "condition": "sSpace == \"|Model space|\"",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Pick a point where the the information is going to be shown",
              "condition": "sSpace == \"|Paper space|\"",
              "required": true
            },
            {
              "step": 3,
              "function": "getViewport",
              "promptOriginal": "Select the viewport from which the element is taken",
              "condition": "sSpace == \"|Paper space|\"",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "On insert (_bOnInsert) when _kExecuteKey is empty",
            "title": null,
            "dataSource": "PropVariables",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 2,
            "variable": "sSpace",
            "type": "PropString",
            "displayName": "Drawing space",
            "defaultValue": "|Paper space|",
            "inputType": "dropdown",
            "options": [
              "|Paper space|",
              "|Model space|"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimLayout",
            "type": "PropString",
            "displayName": "Dim Style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "_DimStyles (Global List)"
            ],
            "category": null,
            "description": "Select dimstyle with proper viewport scaling and dimension format."
          },
          {
            "index": 0,
            "variable": "pdTextHeight",
            "type": "PropDouble",
            "displayName": "Text Height",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "pType",
            "type": "PropString",
            "displayName": "Type of data",
            "defaultValue": "Wall Description",
            "inputType": "dropdown",
            "options": [
              "Wall Description",
              "Information",
              "Subtype",
              "Wall Stud Spacing",
              "Wall Base Height",
              "Wall Frame Thickness",
              "Wall Stud Length",
              "Wall Code",
              "Length of supporting beam in Walls",
              "Multiwall Number",
              "Floorplan Element Numbers",
              "Wall Height",
              "Wall Number",
              "Wall Extra Info by TSL",
              "Wall Comments",
              "Wall Area Gross",
              "Group Level 1",
              "Group Level 2"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sDisplayFilter",
            "type": "PropString",
            "displayName": "Show",
            "defaultValue": "|All|",
            "inputType": "dropdown",
            "options": [
              "|All|",
              "|No location|"
            ],
            "category": "|Display filters for wall comments|",
            "description": "|Defines the Display Filter|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8584,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A tool to extract and display specific metadata (dimensions, codes, comments, or properties) from timber elements as text labels in either Model Space or Paper Space.",
          "category": "ShopDrawing/Annotation",
          "typicalUseCase": "Labeling wall elements on drawings with specific information such as stud spacing, height, wall numbers, or engineering comments for manufacturing or assembly."
        },
        "parameters": [
          {
            "name": "sSpace",
            "technicalDefault": "|Paper space|",
            "businessMeaning": "Determines the context where the label is placed: directly on the 3D model (Model Space) or on a 2D drawing layout (Paper Space).",
            "validRange": "|Paper space|, |Model space|",
            "unit": "enum",
            "affectsOutput": "Switches the insertion method between selecting an Element (Model) and selecting a Viewport/Point (Paper). It also controls coordinate transformation logic."
          },
          {
            "name": "sDimLayout",
            "technicalDefault": "null (from _DimStyles)",
            "businessMeaning": "Selects the CAD dimension style to define the visual appearance (font, scaling, arrow style) of the generated text.",
            "validRange": "Available Dimension Styles in the drawing",
            "unit": "style_name",
            "affectsOutput": "Controls the text style used for the label, ensuring it matches the viewport scale or project standards."
          },
          {
            "name": "pdTextHeight",
            "technicalDefault": "0",
            "businessMeaning": "Explicitly overrides the text height defined in the Dimension Style.",
            "validRange": "0 (Use Dim Style height) or > 0",
            "unit": "mm",
            "affectsOutput": "If set greater than 0, forces the text to be the specific size; otherwise, defaults to the Dim Style's text height."
          },
          {
            "name": "pType",
            "technicalDefault": "Wall Description",
            "businessMeaning": "Selects the specific data attribute of the element to extract and display (e.g., physical dimensions, administrative data, or user comments).",
            "validRange": "Wall Description, Information, Subtype, Wall Stud Spacing, Wall Base Height, Wall Frame Thickness, Wall Stud Length, Wall Code, Length of supporting beam in Walls, Multiwall Number, Floorplan Element Numbers, Wall Height, Wall Number, Wall Extra Info by TSL, Wall Comments, Wall Area Gross, Group Level 1, Group Level 2",
            "unit": "enum",
            "affectsOutput": "Determines the content of the text label (e.g., calculates physical height vs. retrieving the 'Number' string vs. listing comments)."
          },
          {
            "name": "sDisplayFilter",
            "technicalDefault": "|All|",
            "businessMeaning": "Filters which comments are displayed based on whether they have a specific 'Location' attribute attached to them.",
            "validRange": "|All|, |No location|",
            "unit": "enum",
            "affectsOutput": "When 'Wall Comments' is selected, choosing '|No location|' hides comments that are tagged with a specific location in the element data."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "pType changes",
            "effect": "Controls the visibility and read-only state of sDisplayFilter.",
            "cascade": [
              "sDisplayFilter"
            ]
          },
          {
            "trigger": "pdTextHeight is set to 0",
            "effect": "Text height reverts to the default defined in sDimLayout.",
            "cascade": [
              "Text Display"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Annotation/Text",
            "description": "Generates single-line or multi-line text entities displaying the requested property.",
            "appliedTo": "Element (In Model Space) or Viewport Layout (In Paper Space)"
          }
        ]
      },
      "tokens_used": 8565,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Initialization: Set units (mm) and define properties (Space, Dim Style, Text Height, Data Type, Filters).\",\n    \"2. Insertion Phase Check: Detect if the script is being inserted or recalculated.\",\n    \"3. Property Input: If inserted without a catalog key, display the Properties Dialog for user configuration.\",\n    \"4. [Conditional Branch] Drawing Space Selection:\",\n    \"   - Path A (Model Space): Prompt user to select Elements.\",\n    \"   - Path B (Paper Space): Prompt user to pick a point, then select a Viewport.\",\n    \"5. [Model Space Specific] Batch Processing: For each selected Element, spawn a new script instance, attach to the element, and erase the original 'launcher' instance.\",\n    \"6. Execution Phase: Retrieve the Element object (either from the viewport in Paper Space or the attached entity in Model Space).\",\n    \"7. Data Extraction: Based on 'Type of data' property, query the Element for specific attributes (Geometry, TSL attachments, Maps, or Group data).\",\n    \"8. [Conditional Branch] Data Formatting:\",\n    \"   - Path A (Standard): Retrieve single string value (e.g., Wall Number, Height).\",\n    \"   - Path B (Multi-line/Array): Retrieve collection of strings (e.g., Comments, Extra Info lines).\",\n    \"   - Path C (Batch/Floorplan): Iterate through all Elements in the group and calculate positions for multiple labels.\",\n    \"9. Filtering (If Comments): Apply 'Show' filter (All vs No Location) to the comment list.\",\n    \"10. Visualization: Configure Display object (Text height, Dim Style) and draw the text at the calculated location.\",\n    \"11. Finalization: In Model Space, assign the script instance to the Element's group structure for hierarchical updates.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Value of 'Drawing space' property (sSpace)\",\n      \"path1\": {\n        \"name\": \"Model Space\",\n        \"steps\": [\n          \"Prompt 'Select Elements' using PrEntity.\",\n          \"Loop through selection.\",\n          \"Create new script instance via dbCreate attached to each Element.\",\n          \"Erase the temporary host instance.\",\n          \"Child instances retrieve Element directly from _Entity[0].\",\n          \"Assign to ElementGroup for hierarchical updates.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Paper Space\",\n        \"steps\": [\n          \"Prompt 'Pick a point' for text location (sets _Pt0).\",\n          \"Prompt 'Select Viewport' (sets _Viewport).\",\n          \"Retrieve Element from the selected Viewport.\",\n          \"Transform coordinates using ms2ps (Model to Paper Space transformation).\",\n          \"Draw text using Viewport's scaling.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Value of 'Type of data' property (pType)\",\n      \"path1\": {\n        \"name\": \"Floorplan Element Numbers\",\n        \"steps\": [\n          \"Identify the Element's Group.\",\n          \"Collect all Elements within that group.\",\n          \"Calculate envelope center for each member.\",\n          \"Loop and draw a label for every Element in the group.\",\n          \"Skip the standard single-label draw command.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Standard Data (Wall Number, Height, etc.)\",\n        \"steps\": [\n          \"Query specific property or calculate geometry for the single selected Element.\",\n          \"Format string with units.\",\n          \"Execute standard draw command at _Pt0.\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"Multi-line Data (Comments, Extra Info)\",\n        \"steps\": [\n          \"Iterate through Map or TSL attachments.\",\n          \"Populate a string array (sLines).\",\n          \"Draw first line at _Pt0.\",\n          \"Subsequent lines are drawn with a vertical offset based on text height.\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Insert Cycle Count\",\n      \"errorMessage\": \"N/A (Internal)\",\n      \"recovery\": \"If insertCycleCount > 1, the script immediately erases itself to prevent infinite recursion during batch spawning.\"\n    },\n    {\n      \"check\": \"Element Validity\",\n      \"errorMessage\": \"N/A (Internal)\",\n      \"recovery\": \"If the retrieved Element (from Viewport or Model Space selection) is invalid (!bIsValid), the script erases the instance.\"\n    },\n    {\n      \"check\": \"Viewport Selection (Paper Space)\",\n      \"errorMessage\": \"N/A (Internal)\",\n      \"recovery\": \"If _Viewport array is empty, the script erases the instance.\"\n    },\n    {\n      \"check\": \"Specific Casting (Wall vs Element)\",\n      \"errorMessage\": \"N/A (Internal Fail-safe)\",\n      \"recovery\": \"If requesting 'Wall Base Height' but the element is not a valid Wall, the specific query fails, and the text remains empty (soft fail).\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Update Content (Type of Data)\",\n      \"how\": \"Change 'Type of data' property via Object Properties Palette (OPM)\",\n      \"effect\": \"Script recalculates and displays the new information (e.g., switching from Wall Number to Stud Spacing).\"\n    },\n    {\n      \"action\": \"Update Visual Style\",\n      \"how\": \"Change 'Dim Style' or 'Text Height' via OPM\",\n      \"effect\": \"The text font, size, and orientation update immediately to match the new style settings.\"\n    },\n    {\n      \"action\": \"Move Label (Model Space)\",\n      \"how\": \"Grip edit the insertion point or move the parent Element\",\n      \"effect\": \"If moving the parent Element, the label moves with it due to 'assignToElementGroup'. If moving the label itself (via grips), only the text position changes.\"\n    },\n    {\n      \"action\": \"Filter Comments\",\n      \"how\": \"Change 'Show'"
      },
      "tokens_used": 10962,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_ShowElementInformation.mcr\n\n## Overview\nA tool to generate text labels displaying specific data (dimensions, codes, comments, or properties) from timber elements. It supports labeling directly on 3D models (Model Space) or on 2D drawing layouts (Paper Space).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Select elements to attach labels directly to them. |\n| Paper Space | Yes | Select a viewport and pick a point to place a label derived from the view. |\n| Shop Drawing | No | Used for annotation within drawings. |\n\n## Prerequisites\n- **Required entities**: Timber Element (e.g., Wall).\n- **Minimum beam count**: 0 (Script attaches to Element structure).\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_ShowElementInformation.mcr`\n\n### Step 2: Configure Properties\nUpon insertion, the Properties Palette (or a dialog) will appear.\n1.  Set **Drawing space** to either `|Model space|` or `|Paper space|`.\n2.  Select the **Type of data** you wish to display (e.g., Wall Height, Wall Number, Comments).\n3.  (Optional) Adjust **Dim Style** or **Text Height**.\n\n### Step 3: Select Elements / Viewport\n*Depending on your selection in Step 2, follow the relevant flow below:*\n\n**Option A: Model Space**\n```\nCommand Line: Select Elements\nAction: Click on the timber elements (walls) you want to label.\n```\n*Note: The script will automatically attach a separate label instance to each selected element.*\n\n**Option B: Paper Space**\n```\nCommand Line: Pick a point where the information is going to be shown\nAction: Click on the drawing layout to place the text.\n```\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click the boundary of the viewport that displays the element.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Drawing space | dropdown | \\|Paper space\\| | Determines if the label is placed in Model Space (3D) or Paper Space (2D Layout). |\n| Type of data | dropdown | Wall Description | Selects the specific attribute to display (e.g., Wall Stud Spacing, Wall Code, Comments, Group Level). |\n| Dim Style | dropdown | *Current* | Selects the dimension style to control text font and arrow appearance. |\n| Text Height | number | 0 | Overrides the text height defined in the Dim Style. Set to 0 to use the Dim Style default. |\n| Show | dropdown | \\|All\\| | Filters \"Wall Comments\". Use \\|All\\| to show everything, or \\|No location\\| to hide comments tagged with a specific location. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | No custom context menu items are defined. Use the Properties Palette (Ctrl+1) to modify parameters. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Batch Labeling**: In Model Space, you can window-select multiple walls at once. The script will process the selection and attach a label to every wall picked.\n- **Floorplan Numbering**: Use the **\"Floorplan Element Numbers\"** option in the Type of data dropdown. This automatically calculates and labels all elements within a specific group without needing to select them individually.\n- **Quick Editing**: Select an existing label in the drawing and open the Properties Palette (Ctrl+1). You can change the \"Type of data\" to instantly update the text content (e.g., switch from \"Wall Number\" to \"Wall Height\") without deleting and re-inserting the script.\n- **Viewport Scaling**: In Paper Space, ensure your selected **Dim Style** is configured for the correct scale (e.g., 1:50 or 1:100) so the text appears readable relative to your viewport.\n\n## FAQ\n- **Q: Can I label multiple walls at once in Model Space?**\n  - A: Yes. When prompted to \"Select Elements\", you can drag a window to select multiple walls. The script will spawn an instance for each one.\n- **Q: Why did the script disappear after I selected elements in Model Space?**\n  - A: This is normal behavior. The original \"launcher\" script erases itself after spawning child instances attached to the selected elements. Look at the elements themselves to see the new labels.\n- **Q: How do I filter out specific wall comments?**\n  - A: Set **Type of data** to \"Wall Comments\". Then change the **Show** property to `\\|No location\\|` to hide comments that have specific location data assigned to them."
      },
      "tokens_used": 6631,
      "error": null
    }
  }
}