{
  "filename": "HSB_T-Anchor.mcr",
  "status": "completed",
  "total_tokens": 33201,
  "processing_time": 396.7319152355194,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 5897,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses getBeam() and getPoint() for 3D interaction, manipulates GenBeam geometry (_Beam0.envelopeBody()), creates 3D visual representations using Block and Display(), and generates HardWrComp (Hardware) data. No 'sd_' prefix, Viewport checks, or ShopDrawing specific types (#Type E) are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3249,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getBeam",
              "promptOriginal": "|Select a beam|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select a position|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeperator01",
            "type": "PropString",
            "displayName": "|Anchor|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sBlockNameAnchor",
            "type": "PropString",
            "displayName": "     |Blockname anchor|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_BlockNames (Dynamic list from drawing)"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sFastenerArticle",
            "type": "PropString",
            "displayName": "     |Fastener article|",
            "defaultValue": "|None|",
            "inputType": "dropdown",
            "options": [
              "|None|",
              "1",
              "2",
              "3",
              "4",
              "5"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sSubtype",
            "type": "PropString",
            "displayName": "     |Subtype|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dxOffset",
            "type": "PropDouble",
            "displayName": "     X-|Offset|",
            "defaultValue": "0.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dzOffset",
            "type": "PropDouble",
            "displayName": "     Z-|Offset|",
            "defaultValue": "-125.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Assign to beam|",
            "handler": "arSTrigger[0]",
            "action": "Prompts user to select a new beam and re-assigns the script instance to that beam.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 5993,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts and manages connection anchors (ties, brackets, or hold-downs) on timber beams, generating visual 3D block representations and associated hardware data for production lists.",
          "category": "Hardware / Connection",
          "typicalUseCase": "Used when adding wall ties, angle brackets, or generic anchors to timber elements in a 3D model to ensure correct positioning for export to BOMs and shop drawings."
        },
        "parameters": [
          {
            "name": "sBlockNameAnchor",
            "technicalDefault": "",
            "businessMeaning": "Selects the specific geometric type or model of the anchor (e.g., specific brand or shape) from the available block definitions in the drawing.",
            "validRange": "Any string matching a block name defined in the drawing's block table.",
            "unit": "string",
            "affectsOutput": "Changes the 3D visual representation displayed in the model and sets the base prefix for the Hardware Article Number."
          },
          {
            "name": "sFastenerArticle",
            "technicalDefault": "|None|",
            "businessMeaning": "Specifies the type of screw, nail, or bolt required to install the selected anchor.",
            "validRange": "Predefined list (|None|, 1, 2, 3, 4, 5)",
            "unit": "string",
            "affectsOutput": "Appends a suffix to the Hardware Article Number (e.g., 'BlockName_1') to differentiate assembly variants in BOMs."
          },
          {
            "name": "sSubtype",
            "technicalDefault": "",
            "businessMeaning": "A classification label used by dimensioning scripts to determine how the anchor should be annotated or tagged in drawings.",
            "validRange": "Alphanumeric string (e.g., 'TypeA', 'HeavyDuty').",
            "unit": "string",
            "affectsOutput": "Updates the 'DimInfo' map, which controls text labels or markers in automated detailing views."
          },
          {
            "name": "dxOffset",
            "technicalDefault": "0.0",
            "businessMeaning": "Adjusts the lateral position of the anchor along the beam's width (local Y-axis in standard beam coords, mapped to X here).",
            "validRange": "Typically -500mm to 500mm (constrained by beam width).",
            "unit": "mm",
            "affectsOutput": "Moves the anchor block horizontally relative to the beam's centerline."
          },
          {
            "name": "dzOffset",
            "technicalDefault": "-125.0",
            "businessMeaning": "Adjusts the vertical position of the anchor along the beam's height/depth.",
            "validRange": "Typically -500mm to 500mm (constrained by beam height).",
            "unit": "mm",
            "affectsOutput": "Moves the anchor block vertically relative to the beam's centerline."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing sBlockNameAnchor or sFastenerArticle",
            "effect": "Triggers a hardware regeneration event.",
            "cascade": [
              "HardWrComp Article Number"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Block (Visual)",
            "description": "A 3D AutoCAD block representing the physical anchor geometry, positioned and oriented relative to the selected beam.",
            "appliedTo": "ModelSpace (associated with the selected Beam)"
          },
          {
            "type": "HardWrComp (Data)",
            "description": "Hardware component data for production lists, combining the Block Name and Fastener Article into a unique Article Number.",
            "appliedTo": "Script Instance (for BOM export)"
          },
          {
            "type": "Map (Metadata)",
            "description": "Contains 'DimInfo' with the insertion point and Subtype for downstream dimensioning processes.",
            "appliedTo": "Script Instance"
          }
        ]
      },
      "tokens_used": 5421,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. User launches script insertion.",
          "2. Properties Dialog (showDialog) is displayed for initial configuration.",
          "3. Command line prompts user to '|Select a beam|'.",
          "4. Command line prompts user to '|Select a position|' on or near the beam.",
          "5. Script projects the selected position to the beam's centerline (handling offset beams).",
          "6. Script calculates final anchor coordinates using X-Offset and Z-Offset properties.",
          "7. Script generates visual representation (3D Block) at calculated location.",
          "8. Script generates Hardware Component data (Article Number) for BOM export.",
          "9. Script writes Dimensioning Info (Insertion Point + Subtype) to Instance Map.",
          "10. Instance is assigned to the construction group of the beam."
        ],
        "conditionalBranches": [
          {
            "condition": "Hardware Regeneration Check",
            "path1": {
              "name": "Update Hardware",
              "steps": [
                "User changes 'Blockname anchor' or 'Fastener article' property.",
                "Script detects change via _kNameLastChangedProp.",
                "Script rebuilds HardWrComp entry (appends fastener suffix if not '|None|')."
              ]
            },
            "path2": {
              "name": "Skip Hardware Update",
              "steps": [
                "User changes Offsets or Subtype properties.",
                "Script updates geometry and Map data, but keeps existing Hardware Component."
              ]
            }
          },
          {
            "condition": "Beam Reassignment Trigger",
            "path1": {
              "name": "Context Menu Action",
              "steps": [
                "User right-clicks instance and selects '|Assign to beam|'.",
                "Script sets _kExecuteKey to trigger value.",
                "Command line prompts to '|Select a new beam|'.",
                "_Beam[0] is updated to the new selection."
              ]
            },
            "path2": {
              "name": "External Map Action",
              "steps": [
                "External script writes 'AssignToBeam' entity to the instance Map.",
                "Script reads entity and casts it to a Beam.",
                "_Beam[0] is updated, Map entry is removed."
              ]
            }
          },
          {
            "condition": "Beam Integrity Check",
            "path1": {
              "name": "Valid Beam",
              "steps": [
                "_Beam array contains a valid element.",
                "Script proceeds to calculate geometry and draw."
              ]
            },
            "path2": {
              "name": "Missing/Invalid Beam",
              "steps": [
                "_Beam.length() is 0 (e.g., beam was deleted).",
                "Script calls eraseInstance().",
                "Script execution stops."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection",
            "errorMessage": "Intrinsic to getBeam() - user must select a valid GenBeam.",
            "recovery": "User must select a valid beam object or Esc to cancel command."
          },
          {
            "check": "Point Selection",
            "errorMessage": "Intrinsic to getPoint() - user must select a valid 3D coordinate.",
            "recovery": "User must click in ModelSpace or enter coordinates."
          },
          {
            "check": "Block Existence",
            "errorMessage": "If sBlockNameAnchor does not exist in drawing, Block() constructor fails.",
            "recovery": "User must select a valid block name from the dropdown list in properties."
          },
          {
            "check": "Parent Beam Deletion",
            "errorMessage": "None (Silent). Script detects beam is gone.",
            "recovery": "Instance automatically deletes itself to prevent errors."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Position",
            "how": "OPM (Object Properties Model) - Edit 'X-Offset' and 'Z-Offset' numeric fields.",
            "effect": "Anchor moves relative to the beam's centerline. Visuals update immediately. Hardware remains unchanged."
          },
          {
            "action": "Change Anchor Type",
            "how": "OPM - Select different 'Blockname anchor' or 'Fastener article'.",
            "effect": "Visual 3D block changes. Hardware Article Number is regenerated (e.g., 'Bracket_1')."
          },
          {
            "action": "Reassign to Beam",
            "how": "Right-click context menu -> '|Assign to beam|'.",
            "effect": "Script prompts for a new beam. The anchor instance detaches from the old beam and attaches to the new one, recalculating position based on the new beam's orientation."
          },
          {
            "action": "Update Dimensioning Metadata",
            "how": "OPM - Edit 'Subtype' field.",
            "effect": "Updates the 'DimInfo' map used by detail scripts to change labels/tags in drawings, without changing geometry."
          }
        ]
      },
      "tokens_used": 6946,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_T-Anchor.mcr\n\n## Overview\nThis script inserts and manages connection anchors (such as ties, brackets, or hold-downs) on timber beams. It automatically generates 3D visual representations and compiles hardware data for production lists and shop drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in 3D Model Space. |\n| Paper Space | No | Not supported in layout views. |\n| Shop Drawing | No | This is a modeling tool, not a detailing script. |\n\n## Prerequisites\n- **Required Entities**: At least one timber beam (`GenBeam`) must exist in the model.\n- **Minimum Beam Count**: 1\n- **Required Settings Files**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_T-Anchor.mcr` from the list.\n\n### Step 2: Select a Beam\n```\nCommand Line: Select a beam\nAction: Click on the timber beam in the model where you want to place the anchor.\n```\n\n### Step 3: Select a Position\n```\nCommand Line: Select a position\nAction: Click a point on or near the selected beam. This sets the initial reference location along the beam's length.\n```\n\n### Step 4: Configure Anchor\n```\nAction: After insertion, the anchor is created. You can immediately adjust its type and position using the Properties Palette (Ctrl+1).\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Anchor** | Header | - | Category header for anchor properties. |\n| Blockname anchor | Dropdown | *(Dynamic)* | Selects the specific 3D block (geometry) to represent the anchor (e.g., specific brand or shape). |\n| Fastener article | Dropdown | \\|None\\| | Selects the screw, nail, or bolt type. This updates the Hardware Article Number (e.g., appends \"_1\" to the block name). |\n| Subtype | Text | *(Empty)* | A classification label used by dimensioning scripts to determine how the anchor is tagged or labeled in drawings. |\n| X-Offset | Number | 0.0 mm | Adjusts the lateral position of the anchor relative to the beam's centerline (along the beam width). |\n| Z-Offset | Number | -125.0 mm | Adjusts the vertical position of the anchor relative to the beam's centerline (along the beam height). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Assign to beam** | Allows you to move the anchor to a different beam. Selecting this option prompts you to pick a new beam, and the script re-attaches the anchor instance to the new selection. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Fine-tuning Position**: Use the **X-Offset** and **Z-Offset** properties in the Properties Palette to slide the anchor along the face of the beam without needing to re-insert it.\n- **Beam Deletion**: If you delete the parent beam, the anchor instance will automatically delete itself to prevent errors.\n- **BOM Export**: Changing the \"Fastener article\" will create a new entry in your Hardware/Part list (e.g., changing from \"None\" to \"1\" changes the article number from `BlockName` to `BlockName_1`).\n\n## FAQ\n- **Q: Why is my anchor not visible after insertion?**\n- **A:** Check the **Blockname anchor** property. If it is empty or points to a block definition that does not exist in the current drawing, nothing will be displayed. Select a valid block from the dropdown list.\n  \n- **Q: Can I rotate the anchor?**\n- **A:** The script automatically aligns the anchor based on the selected beam's coordinate system. Manual rotation is handled by the block definition orientation relative to the beam.\n\n- **Q: How do I change the label for this anchor in drawings?**\n- **A:** Edit the **Subtype** property in the Properties Palette. This field is read by dimensioning scripts to apply specific text tags or markers."
      },
      "tokens_used": 5695,
      "error": null
    }
  }
}