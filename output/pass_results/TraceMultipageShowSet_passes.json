{
  "filename": "TraceMultipageShowSet.mcr",
  "status": "completed",
  "total_tokens": 28844,
  "processing_time": 262.0089466571808,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4329,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ShopDrawing",
          "supportsPaperSpace": true,
          "isShopDrawingScript": true,
          "isMultipageScript": true,
          "detectionEvidence": "Script filename contains 'Multipage', uses getMultiPage() for entity selection, handles MultiPage and MultiPageView objects, iterates through page.defineSet() and page.showSet()."
        },
        "prerequisites": {
          "requiredEntities": [
            "MultiPage"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Script requires selection of a valid hsbCAD MultiPage object.",
          "requiredSettings": []
        }
      },
      "tokens_used": 5520,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getMultiPage",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "OnInsert",
            "title": "---",
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": null,
            "variable": "_Entity",
            "type": "PropEntity (Inferred)",
            "displayName": "Entity",
            "defaultValue": "",
            "inputType": "selection",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": null,
            "variable": "_Pt0",
            "type": "PropPoint3d (Inferred)",
            "displayName": "Pt0",
            "defaultValue": "",
            "inputType": "point",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "TslUtilities.dll",
            "searchPaths": [
              "_kPathHsbInstall + \\Utilities\\DialogService\\"
            ],
            "purpose": "Standard dialog services",
            "required": false
          }
        ]
      },
      "tokens_used": 3984,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A diagnostic tool that lists the entities contained within a MultiPage drawing (DefineSet, ShowSet, and Views) and draws graphical leader lines connecting the text list to the actual elements in the model.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used to debug or audit a production drawing layout to understand which scripts and entities are generating specific views, annotations, or geometry."
        },
        "parameters": [
          {
            "name": "_Entity",
            "technicalDefault": "Empty",
            "businessMeaning": "The specific MultiPage drawing object (e.g., a wall or floor layout) that the user wants to analyze.",
            "validRange": "Any valid hsbCAD MultiPage entity currently loaded in the drawing.",
            "unit": "Entity",
            "affectsOutput": "Determines the source data for the report. Changing this changes which DefineSet and ShowSet entities are listed and traced."
          },
          {
            "name": "_Pt0",
            "technicalDefault": "0,0,0 (or user clicked point)",
            "businessMeaning": "The screen location where the top of the diagnostic text report should be placed.",
            "validRange": "Any point within the paper space or model space coordinate system.",
            "unit": "mm (or current drawing unit)",
            "affectsOutput": "Controls the position of the text block and the origin of the leader lines connecting the text to the drawing elements."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "Diagnostic Graphics",
            "description": "Generates a text list of all entities in the Page Define Set, Page Show Set, and individual View Show Sets. Draws polylines connecting this text to the graphical representation of those entities in the drawing views.",
            "appliedTo": "Current Drawing View (Model/Paper Space)"
          }
        ]
      },
      "tokens_used": 5159,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Execution Initiated",
          "Check if Inserting (_bOnInsert)",
          "[Insert Flow] Check Execution Key (_kExecuteKey)",
          "[Insert Flow] If Key exists, load properties from catalog",
          "[Insert Flow] Else, display standard Dialog (---) for user input",
          "[Insert Flow] User selects MultiPage entity via getMultiPage()",
          "[Insert Flow] User selects Insertion Point via getPoint()",
          "[Script Continues] Retrieve MultiPage object from _Entity property",
          "Validate MultiPage object",
          "Initialize Display (dp) and formatting settings",
          "Draw header 'Page Define Set' at _Pt0",
          "Iterate and list all entities in page.defineSet()",
          "Draw header 'Page Show Set'",
          "Iterate and list all entities in page.showSet()",
          "Iterate through all Views in page.views()",
          "For each View: Draw 'View [n]' header and leader line to View Profile",
          "For each View: Iterate through View Show Set",
          "For View 0 only: Calculate graphical extents in Model and Paper Space",
          "For View 0 only: Draw leader lines connecting text to entity profiles",
          "Draw formatted text for each entity in Show Sets"
        ],
        "conditionalBranches": [
          {
            "condition": "_bOnInsert is True (Script Insertion)",
            "path1": {
              "name": "Catalog Execution",
              "steps": [
                "Check if _kExecuteKey matches a catalog name",
                "Set properties from catalog",
                "Skip interactive Dialog"
              ]
            },
            "path2": {
              "name": "Standard Insertion",
              "steps": [
                "Set properties from 'LastInserted' catalog",
                "Show interactive Dialog",
                "Update properties until user accepts (_kUpdate loop)",
                "Prompt for MultiPage selection",
                "Prompt for Insertion Point"
              ]
            }
          },
          {
            "condition": "MultiPage Entity Validation",
            "path1": {
              "name": "Valid MultiPage",
              "steps": [
                "Proceed to Display Logic",
                "Generate Trace Report and Graphics"
              ]
            },
            "path2": {
              "name": "Invalid/No MultiPage",
              "steps": [
                "Show Error Message",
                "Erase Script Instance",
                "Stop Execution"
              ]
            }
          },
          {
            "condition": "Processing Show Sets in Views",
            "path1": {
              "name": "First View (v==0)",
              "steps": [
                "Extract Body Extents (Quader)",
                "Transform Body to View Space",
                "Create Shadow Profiles (Model & Paper Space)",
                "Draw complex leader lines (DrawGuideLine)"
              ]
            },
            "path2": {
              "name": "Subsequent Views (v>0)",
              "steps": [
                "Format Entity Text",
                "Draw Text Only (No graphical leader lines drawn)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Valid MultiPage Entity Selected",
            "errorMessage": "TraceMultipageShowSet: invalid selection set",
            "recovery": "Select a valid hsbCAD MultiPage object during insertion or via OPM properties."
          },
          {
            "check": "Duplicate Insertion Cycle",
            "errorMessage": "None (Silent)",
            "recovery": "N/A - Script automatically erases itself if insertCycleCount > 1"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Traced Entity",
            "how": "OPM Properties Palette (Property '_Entity')",
            "effect": "Script recalculates to display the DefineSet and ShowSet of the newly selected MultiPage object. Text list and graphics update to reflect the new data."
          },
          {
            "action": "Move Report Location",
            "how": "OPM Properties Palette (Property '_Pt0') or Grip Edit",
            "effect": "The entire text report shifts to the new start location. Leader lines redraw based on the new text position relative to the target views."
          }
        ]
      },
      "tokens_used": 5345,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# TraceMultipageShowSet\n\n## Overview\nThis script creates a diagnostic report for a selected hsbCAD MultiPage drawing. It lists all entities contained in the DefineSet and ShowSets and draws graphical leader lines connecting the text list to the actual elements in the model views.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed for Shop Drawing environments. |\n| Paper Space | Yes | The script functions correctly within Paper Space layouts. |\n| Shop Drawing | Yes | This is the primary environment intended for use. |\n\n## Prerequisites\n- **Required Entities**: A valid hsbCAD MultiPage object (e.g., a wall or floor layout) must exist in the drawing.\n- **Minimum beam count**: 0\n- **Required settings files**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `TraceMultipageShowSet.mcr`\n\n### Step 2: Select MultiPage Entity\n```\nCommand Line: Select MultiPage:\nAction: Click on the MultiPage drawing object you wish to analyze.\n```\n\n### Step 3: Specify Insertion Point\n```\nCommand Line: Insertion point:\nAction: Click in the drawing (Paper Space) to place the top-left corner of the diagnostic text list.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| _Entity | PropEntity | Empty | The specific MultiPage drawing object to analyze. Change this to switch the report to a different drawing layout. |\n| _Pt0 | Point3d | User Clicked | The screen location where the top of the diagnostic text report is placed. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not add custom context menu items. Standard TSL options (Recalculate, Erase) apply. |\n\n## Settings Files\n- **Filename**: None specific\n- **Location**: N/A\n- **Purpose**: N/A (Uses standard hsbCAD utilities only)\n\n## Tips\n- **Audit Tool**: Use this script when you need to understand which specific scripts or entities are generating a particular view or annotation on your production drawings.\n- **First View Detail**: Note that graphical leader lines (connectors) are only drawn for entities in the **first view** (View 0). Subsequent views will list the entities textually but will not have the connecting lines drawn to them.\n- **Moving the Report**: If the text covers your drawing, simply select the script instance and change the `_Pt0` property in the Properties Palette to move the entire report block.\n\n## FAQ\n- **Q: I get an error \"invalid selection set\" when inserting.**\n  A: Ensure you click on a valid hsbCAD MultiPage object during the selection prompt. This script cannot analyze standard AutoCAD entities or individual beams; it requires the parent MultiPage container.\n\n- **Q: Can I update the report if the drawing changes?**\n  A: Yes. Select the script instance and click \"Recalculate\" (or right-click and select Recalculate) to refresh the entity list based on the current state of the MultiPage.\n\n- **Q: Why are there lines pointing to objects in one view but not in others?**\n  A: By design, the script only calculates and draws graphical leader lines (extents and connectors) for the first view to maintain performance and drawing clarity. Other views are listed textually."
      },
      "tokens_used": 4507,
      "error": null
    }
  }
}