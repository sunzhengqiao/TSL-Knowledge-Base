{
  "filename": "GE_HDWR_STUD_PLATE_TIE_SPTD.mcr",
  "status": "completed",
  "total_tokens": 39838,
  "processing_time": 448.43345284461975,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.4",
            "date": "02.jun.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Added features to make possible reset TXT source file using GE_HDWR_RESET_CATALOG_ENTRY tsl"
          },
          {
            "version": "1.0",
            "date": "07.mar.2014",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": [
          "GE_HDWR_RESET_CATALOG_ENTRY"
        ]
      },
      "tokens_used": 6929,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script generates 3D geometry (Body/PLine) based on Beam objects selected in the model. It uses 'PrEntity' for selection and 'tsl.dbCreate' to insert instances into the 3D model. No usage of '_Viewport', 'sd_' prefixes, or 2D drawing view logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "TSL_Read_Metalpart_Family_Props.dll (located in installation folder\\Utilities\\TslCustomSettings)",
            "TXT file containing SPTD family details",
            "Catalog path at _kPathHsbCompany\\TSL\\Catalog\\"
          ]
        }
      },
      "tokens_used": 6251,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select stud(s) and plate(s)|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Pick a point to define on what face of studs place hardware|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "SelectFromList (Inferred from callDotNetFunction2)",
            "trigger": "_bOnInsert || _kExecuteKey == 'Change type'",
            "title": null,
            "dataSource": "callDotNetFunction2 (TSL_Read_Metalpart_Family_Props.dll)",
            "features": {
              "searchable": true,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "|Type|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dLength",
            "type": "PropDouble",
            "displayName": "|Lenght|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dWidth",
            "type": "PropDouble",
            "displayName": "|Width|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Change type",
            "handler": "sChangeType",
            "action": "Opens a dialog to select a new hardware type from the SPTD catalog.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Help",
            "handler": "sHelp",
            "action": "Displays a report notice describing the SPTD Stud Tie Hardware Family and usage instructions.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "TSL_HARDWARE_FAMILY_LIST.dxx",
            "searchPaths": [
              "_kPathHsbCompany\\TSL\\Catalog\\"
            ],
            "purpose": "Catalog list of available hardware families.",
            "required": true
          },
          {
            "filename": "TSL_Read_Metalpart_Family_Props.dll",
            "searchPaths": [
              "_kPathHsbInstall\\Utilities\\TslCustomSettings\\"
            ],
            "purpose": "DotNet assembly used to read family properties from TXT files.",
            "required": true
          }
        ]
      },
      "tokens_used": 6653,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 6544,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts execution.",
          "Check execution key: If 'Help', display notice and exit.",
          "Check recursion: If insertCycleCount > 1, erase instance and exit.",
          "Initialize Catalog Map and paths.",
          "Call DotNet Assembly to retrieve Hardware Properties from TXT file.",
          "[Insertion Branch] If _bOnInsert is true:",
          "   Prompt user to Select Stud(s) and Plate(s).",
          "   Prompt user to Pick a reference point on the stud face.",
          "   Categorize selected beams into Verticals, Bottom Plates, and Top Plates.",
          "   Validate selection (Must have at least 1 stud and 1 plate).",
          "   Identify the specific stud closest to the picked point.",
          "   Loop through all valid vertical studs:",
          "       Spawn a sub-instance of the script (tsl.dbCreate) for Stud+BottomPlate.",
          "       Spawn a sub-instance of the script (tsl.dbCreate) for Stud+TopPlate.",
          "   Erase the temporary parent instance.",
          "[Calculation Branch] If _bOnInsert is false (Sub-instance execution):",
          "   Retrieve 'bOnInsert' flag from Map.",
          "   Validate primary beam (_Beam[0]) exists.",
          "   [If bOnInsert == 1] Calculate plate intersections and local vectors (vx, vy, vz).",
          "   [If bOnInsert != 1] Retrieve vectors and origin directly from Map.",
          "   Set dependencies on Stud and Plate entities.",
          "   Assign to Element Group.",
          "   Set OPM properties (Length/Width) from Map or Defaults.",
          "   Check for duplicate instances on the stud and erase them.",
          "   Generate 3D Geometry (Front Plate and Base Plate).",
          "   Finish execution."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Context (Parent vs. Child)",
            "path1": {
              "name": "Parent Insertion",
              "steps": [
                "Handle User Input (Select/Pick).",
                "Filter and Sort Beams.",
                "Clone script for each stud/plate combination.",
                "Self-destruct."
              ]
            },
            "path2": {
              "name": "Child Instance",
              "steps": [
                "Read assigned beams and map data.",
                "Calculate or Retrieve geometric orientation.",
                "Draw hardware body."
              ]
            }
          },
          {
            "condition": "Data Source for Geometry (bOnInsert Flag)",
            "path1": {
              "name": "Calculated Mode (bOnInsert=1)",
              "steps": [
                "Analyze beam spatial relationships.",
                "Find closest intersecting plate.",
                "Compute vectors dynamically."
              ]
            },
            "path2": {
              "name": "Stored Mode (bOnInsert=0)",
              "steps": [
                "Read origin and vectors from internal _Map.",
                "Bypass geometric calculation."
              ]
            }
          },
          {
            "condition": "Catalog Data Integrity",
            "path1": {
              "name": "Data Valid",
              "steps": [
                "Use dimensions (Length/Width) from Map.",
                "Draw standard geometry."
              ]
            },
            "path2": {
              "name": "Data Missing/Invalid",
              "steps": [
                "Use hardcoded defaults (170mm / 35mm).",
                "Draw geometry in Red (Color 1) as warning."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection Validity",
            "errorMessage": "\"Not valid top or bottom plates provided\" OR \"Not valid vertical studs provided\"",
            "recovery": "User must select at least one vertical beam and one horizontal plate beam."
          },
          {
            "check": "Catalog File Availability",
            "errorMessage": "(Silent failure - Instance erases)",
            "recovery": "Ensure 'TSL_HARDWARE_FAMILY_LIST.dxx' and 'SPTD' TXT files exist in the Company TSL Catalog path."
          },
          {
            "check": "Geometric Intersection",
            "errorMessage": "(Silent failure - Instance erases)",
            "recovery": "Ensure the selected stud physically intersects with the selected plate."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Hardware Type",
            "how": "Right-click context menu -> 'Change type'",
            "effect": "Re-triggers the DotNet catalog selection dialog. Updates dimensions and type, then redraws geometry."
          },
          {
            "action": "Refresh Geometry",
            "how": "Model Update / Recalc",
            "effect": "Re-runs the child instance logic. If in Stored Mode, it maintains position. Dependencies ensure updates if beams move."
          },
          {
            "action": "View Documentation",
            "how": "Right-click context menu -> 'Help'",
            "effect": "Shows a report notice describing the SPTD family and usage."
          }
        ]
      },
      "tokens_used": 8295,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_HDWR_STUD_PLATE_TIE_SPTD.mcr\n\n## Overview\nThis script automatically inserts SPTD Stud Tie hardware to connect vertical studs with horizontal top and bottom plates. It detects intersections between selected elements and generates the corresponding 3D hardware geometry.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates entirely in the 3D model. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | This is a model generation script, not a detailing tool. |\n\n## Prerequisites\n- **Required Entities**: Structural GenBeams representing Vertical Studs, Bottom Plates, and Top Plates must exist in the model.\n- **Minimum Selection**: At least one vertical stud and one horizontal plate must be selected.\n- **Required Settings**:\n  - Catalog files (TXT format) for SPTD families must be present in `_kPathHsbCompany\\TSL\\Catalog\\`.\n  - `TSL_HARDWARE_FAMILY_LIST.dxx` must exist in the company catalog folder.\n  - `TSL_Read_Metalpart_Family_Props.dll` must be located in the hsbCAD installation `Utilities\\TslCustomSettings` folder.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1. Type `TSLINSERT` in the command line.\n2. Navigate to the script location and select `GE_HDWR_STUD_PLATE_TIE_SPTD.mcr`.\n\n### Step 2: Select Beams\n```\nCommand Line: Select stud(s) and plate(s)\nAction: Use a window or click selection to pick the vertical studs and the horizontal plates (both top and bottom) you wish to connect. Press Enter when finished.\n```\n\n### Step 3: Define Installation Side\n```\nCommand Line: Pick a point to define on what face of studs place hardware\nAction: Click on the specific face (side) of a stud. The script will place the hardware on this side of the wall for all valid intersections.\n```\n\n### Step 4: Select Hardware Type (If required)\n- If the script prompts, a dialog will appear allowing you to search and select the specific SPTD hardware type from the catalog list.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | String | (From Catalog) | The identifier for the specific SPTD hardware family selected. |\n| Lenght | Number | 0 | The length of the hardware piece (usually populated by catalog). |\n| Width | Number | 0 | The width of the hardware piece (usually populated by catalog). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Change type | Opens a dialog to select a different hardware configuration from the SPTD catalog. Updates dimensions and redraws the geometry. |\n| Help | Displays a report notice with instructions and details regarding the SPTD Stud Tie Hardware Family. |\n\n## Settings Files\n- **Filename**: `TSL_HARDWARE_FAMILY_LIST.dxx`\n  - **Location**: `_kPathHsbCompany\\TSL\\Catalog\\`\n  - **Purpose**: Defines the list of available hardware families.\n- **Filename**: `TSL_Read_Metalpart_Family_Props.dll`\n  - **Location**: `_kPathHsbInstall\\Utilities\\TslCustomSettings\\`\n  - **Purpose**: Reads the properties from the TXT catalog files.\n- **Filename**: `[SPTD_Family].txt`\n  - **Location**: `_kPathHsbCompany\\TSL\\Catalog\\`\n  - **Purpose**: Contains specific geometric dimensions for the hardware types.\n\n## Tips\n- Ensure your structural studs and plates physically intersect (touch) in the 3D model. The script uses these intersections to calculate placement.\n- You can select a large group of studs and plates at once; the script will filter them and generate hardware for every valid pair.\n- If the hardware is drawn in **Red**, it indicates that the specific catalog data could not be found or was invalid, and default dimensions were used instead.\n\n## FAQ\n- **Q: Why did the script not generate any hardware?**\n  - A: Ensure you selected at least one vertical stud and one horizontal plate. Also, verify that the beams actually intersect each other in the model.\n- **Q: Can I change the hardware size after inserting?**\n  - A: Yes, select the inserted hardware instance, right-click, and choose **Change type** to select a different size from the catalog.\n- **Q: What does the \"Reset TXT source file\" feature mentioned in the version history do?**\n  - A: It allows advanced users to reload catalog data if the TXT file has been modified externally, usually triggered by another utility script."
      },
      "tokens_used": 5166,
      "error": null
    }
  }
}