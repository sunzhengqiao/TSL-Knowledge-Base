{
  "filename": "HSB_P-Pocket.mcr",
  "status": "completed",
  "total_tokens": 29177,
  "processing_time": 584.0525305271149,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 5809,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates on 3D geometry using _GenBeam and Element entities to create a BeamCut. It does not contain 'sd_' prefix, _Viewport checks, or logic for generating 2D drawings/entities (#Type E)."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "ElementWall"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 3120,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getGenBeam",
              "promptOriginal": "|Select the beam or panel to create a pocket for.|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getElement",
              "promptOriginal": "|Select a wall|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "CatalogDialog",
            "trigger": "_bOnInsert && (_kExecuteKey == \"\" || arSCatalogNames.find(_kExecuteKey) == -1)",
            "title": null,
            "dataSource": "Catalog names 'HSB_P-Pocket'",
            "features": {
              "searchable": true,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dGapSide",
            "type": "PropDouble",
            "displayName": "|Gap at the side|",
            "defaultValue": "U(1)",
            "inputType": "number",
            "options": [],
            "category": "|General settings|",
            "description": "|Sets the gap which will be applied on each side.|"
          },
          {
            "index": 1,
            "variable": "dGapBottom",
            "type": "PropDouble",
            "displayName": "|Gap at the bottom|",
            "defaultValue": "U(1)",
            "inputType": "number",
            "options": [],
            "category": "|General settings|",
            "description": "|Sets the gap which will be applied on bottom.|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3212,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of a pocket or recess in a wall element to accommodate a specific beam, applying user-defined side and bottom clearances for tolerance.",
          "category": "Joinery/Framing",
          "typicalUseCase": "Creating a seat or housing for a floor joist, ledger beam, or purlin within a structural wall panel during the detailing phase."
        },
        "parameters": [
          {
            "name": "dGapSide",
            "technicalDefault": "U(1)",
            "businessMeaning": "Horizontal clearance applied to both sides of the pocket opening. This ensures the beam can be inserted without tight friction and accounts for timber swelling or manufacturing tolerances.",
            "validRange": "0 mm to 10 mm",
            "unit": "mm",
            "affectsOutput": "Modifies the width of the rectangular void cut into the wall (Beam Width + 2 * dGapSide)."
          },
          {
            "name": "dGapBottom",
            "technicalDefault": "U(1)",
            "businessMeaning": "Vertical clearance applied below the beam within the pocket. This prevents the beam from resting directly on the bottom surface of the cut.",
            "validRange": "0 mm to 20 mm",
            "unit": "mm",
            "affectsOutput": "Shifts the pocket downward and increases the vertical depth of the void to accommodate the gap."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Geometry of the selected GenBeam changes",
            "effect": "The cross-sectional dimensions of the pocket (Width and Height) update to match the new profile of the beam being inserted.",
            "cascade": [
              "Pocket Width",
              "Pocket Height"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "BeamCut",
            "description": "A rectangular recess cut into the wall geometry. The cut profile matches the cross-section of the selected beam plus the defined clearances. The depth of the cut is fixed at 1000mm (effectively cutting through standard wall thicknesses).",
            "appliedTo": "The selected Wall Element (ElementWall)"
          }
        ]
      },
      "tokens_used": 5977,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched via command or catalog",
          "Check for Execute Key: if valid, load presets; if invalid/empty, show Properties Dialog (Gap Side/Gap Bottom)",
          "Prompt user to select a GenBeam (the object to pocket)",
          "Prompt user to select an Element (the host wall)",
          "Validate selected Element: Check if type is ElementWall",
          "[Conditional] If valid, assign to script instance; if invalid, show warning and repeat selection prompt",
          "Calculate intersection point of Beam center line with Wall plane",
          "Determine Pocket orientation based on Beam projection relative to Wall",
          "Generate PLine helper geometry in 'T' zone",
          "Apply BeamCut to the Wall with calculated width, height, and clearances",
          "Assign script instance to Element group for updates"
        ],
        "conditionalBranches": [
          {
            "condition": "Presence of valid Execute Key (_kExecuteKey)",
            "path1": {
              "name": "Catalog Load",
              "steps": [
                "Retrieve properties from catalog entry",
                "Skip Properties Dialog",
                "Proceed to entity selection"
              ]
            },
            "path2": {
              "name": "Manual Input",
              "steps": [
                "Open Properties Dialog",
                "User inputs dGapSide and dGapBottom",
                "Confirm dialog",
                "Proceed to entity selection"
              ]
            }
          },
          {
            "condition": "Element Type Validation during Insert",
            "path1": {
              "name": "Valid Wall",
              "steps": [
                "Accept ElementWall",
                "Append to _Element array",
                "Finish insertion cycle"
              ]
            },
            "path2": {
              "name": "Invalid Element",
              "steps": [
                "Display Warning: 'Invalid element selected. A wall is required.'",
                "Trigger getElement() prompt again",
                "Wait for valid input"
              ]
            }
          },
          {
            "condition": "Beam Orientation vs Wall Plane (Geometric Mapping)",
            "path1": {
              "name": "Case 1: Parallel to Beam X",
              "steps": [
                "Pocket Vertical Axis = Beam Y",
                "Pocket Width = Beam Solid Width",
                "Pocket Height = Beam Solid Height"
              ]
            },
            "path2": {
              "name": "Case 2: Parallel to Beam Y",
              "steps": [
                "Pocket Vertical Axis = Beam Z",
                "Pocket Width = Beam Solid Height",
                "Pocket Height = Beam Solid Length"
              ]
            },
            "path3": {
              "name": "Case 3: Fallback",
              "steps": [
                "Pocket Vertical Axis = Beam X",
                "Pocket Width = Beam Solid Length",
                "Pocket Height = Beam Solid Width"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Type (Post-Insert Check)",
            "errorMessage": "|Invalid element selected.| |A wall is required.|",
            "recovery": "The script erases itself. User must re-insert the script and select a valid ElementWall."
          },
          {
            "check": "Element Existence",
            "errorMessage": "|No element selected|",
            "recovery": "The script erases itself. User must re-insert and select a wall."
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "(Silent failure)",
            "recovery": "If insertCycleCount > 1, the instance erases itself to prevent infinite loops during initialization."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Pocket Dimensions",
            "how": "OPM (Object Properties Model)",
            "effect": "Updating 'Gap at the side' or 'Gap at the bottom' recalculates the BeamCut geometry, widening the opening or shifting it vertically."
          },
          {
            "action": "Relocate Beam",
            "how": "Grip Edit / Move Command",
            "effect": "The script detects the change in the GenBeam position and recalculates the intersection point on the wall, moving the pocket accordingly."
          },
          {
            "action": "Resize Beam",
            "how": "Grip Edit / Properties",
            "effect": "The pocket width and height update to match the new beam profile dimensions (plus gaps)."
          },
          {
            "action": "Rotate Beam",
            "how": "Rotate Command",
            "effect": "The script re-evaluates the orientation branches to determine how the beam's width/height map to the wall pocket dimensions."
          }
        ]
      },
      "tokens_used": 6335,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_P-Pocket.mcr\n\n## Overview\nThis script creates a pocket or recess in a wall element to accommodate a specific beam. It automatically calculates the cut dimensions based on the beam profile and applies user-defined side and bottom gaps for tolerance.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D model entities. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities:** One GenBeam (the object to be pocketed) and one ElementWall (the host wall).\n- **Minimum Beam Count:** 1\n- **Required Settings:** None (uses defaults or Catalog presets).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_P-Pocket.mcr`\n\n### Step 2: Select Configuration (Optional)\nIf no specific execute key is preset, a Catalog dialog may appear allowing you to load pre-defined configurations for the pocket.\n\n### Step 3: Select the Beam\n```\nCommand Line: Select the beam or panel to create a pocket for.\nAction: Click on the GenBeam in the model that needs to be inserted into the wall.\n```\n\n### Step 4: Select the Wall\n```\nCommand Line: Select a wall\nAction: Click on the ElementWall where the pocket should be cut.\n```\n*Note: If you select a non-wall element, the script will warn you and prompt you to select again.*\n\n### Step 5: Adjust Properties (Optional)\nAfter insertion, select the script instance in the drawing to adjust gap settings via the Properties Palette if they were not set via the catalog.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Gap at the side | Number | 1 mm | Sets the horizontal clearance applied on each side of the pocket (Total width increase = 2 * Gap). |\n| Gap at the bottom | Number | 1 mm | Sets the vertical clearance applied below the beam within the pocket. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script does not add specific custom options to the right-click context menu. |\n\n## Settings Files\n- **Catalog**: `HSB_P-Pocket`\n- **Purpose**: Stores pre-defined configurations for gap sizes and other parameters, allowing for quick standardization of pocket details.\n\n## Tips\n- **Dynamic Updates:** If you move, rotate, or resize the beam after creating the pocket, the wall cut will update automatically to match the new position and profile.\n- **Tolerances:** Use the \"Gap at the side\" property to account for timber swelling or to ensure loose fits for on-site assembly.\n- **Orientation:** The script automatically detects the beam's orientation relative to the wall to determine the correct cut direction (using Beam X, Y, or Z axes as needed).\n\n## FAQ\n- **Q: Why did the script disappear after I selected an element?**\n  A: This usually happens if you selected an invalid element (e.g., another beam instead of a wall) or if no element was selected. The script erases itself to prevent errors. Simply run the command again and ensure you select an `ElementWall` for the second prompt.\n- **Q: Can I use this on a beam instead of a wall?**\n  A: No, this script is designed to cut pockets specifically into `ElementWall` entities. For beam-to-beam connections, a different TSL script should be used."
      },
      "tokens_used": 4724,
      "error": null
    }
  }
}