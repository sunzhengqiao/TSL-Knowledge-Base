{
  "filename": "hsb_MitekSapphireTrussImport.mcr",
  "status": "completed",
  "total_tokens": 20928,
  "processing_time": 228.20869135856628,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 2370,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script generates construction data using ModelMap.dbInterpretMap, which places geometry in Model Space. It lacks specific ShopDrawing patterns (sd_*, #Type E) or Paper Space references (_Viewport). It calls eraseInstance() immediately after processing, typical for import tools acting on Model Space."
        },
        "prerequisites": {
          "requiredEntities": [],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "hsbSteicoIO.dll located in the hsbCAD installation path under Utilities\\hsbCloudStorage\\",
            "External IFC source data (implied by 'ImportMitekIFC' function name)"
          ]
        }
      },
      "tokens_used": 2395,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 1,
            "variable": "pTrussGroupName",
            "type": "PropString",
            "displayName": "Truss Group Name",
            "defaultValue": "Trusses\\Ground_Floor",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "pBeamGroupName",
            "type": "PropString",
            "displayName": "Beam Group Name",
            "defaultValue": "Beams\\Ground_Floor",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "pTrussFilter",
            "type": "PropString",
            "displayName": "Truss Name Filter",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "hsbSteicoIO.dll",
            "searchPaths": [
              "%hsbInstallPath%\\Utilities\\hsbCloudStorage\\"
            ],
            "purpose": "Provides ImportMitekIFC function to parse external IFC data",
            "required": true
          }
        ]
      },
      "tokens_used": 2320,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Imports structural timber truss data from Mitek Sapphire software via IFC, converting it into hsbCAD entities and organizing them into the Project Manager.",
          "category": "Data Import",
          "typicalUseCase": "Used when transferring a roof truss layout designed in Mitek Sapphire into the hsbCAD model for detailing, manufacturing, or integration into a timber frame model."
        },
        "parameters": [
          {
            "name": "pTrussGroupName",
            "technicalDefault": "Trusses\\Ground_Floor",
            "businessMeaning": "Defines the destination folder path in the hsbCAD Project Manager (Tree) where the imported Truss Assemblies will be stored.",
            "validRange": "Any valid existing or new Group path string (e.g., 'Trusses\\Roof', '1st_Floor\\Trusses').",
            "unit": "String (Path)",
            "affectsOutput": "Organizational only. Changing this moves the generated truss entities to a different folder in the project browser but does not alter the geometry or dimensions of the trusses."
          },
          {
            "name": "pBeamGroupName",
            "technicalDefault": "Beams\\Ground_Floor",
            "businessMeaning": "Defines the destination folder path in the hsbCAD Project Manager where individual timber elements (chords, webs) associated with the trusses will be stored.",
            "validRange": "Any valid existing or new Group path string (e.g., 'Beams\\Roof').",
            "unit": "String (Path)",
            "affectsOutput": "Organizational only. Determines the location of individual beam elements within the project structure."
          },
          {
            "name": "pTrussFilter",
            "technicalDefault": "",
            "businessMeaning": "A text filter used to select specific trusses from the source IFC file for import, allowing the user to exclude certain trusses based on their names or properties.",
            "validRange": "Alphanumeric string corresponding to truss names in the source file (empty string implies 'Import All').",
            "unit": "String",
            "affectsOutput": "Controls the scope of the import. If the filter matches a truss name, it is imported; if it does not match, that specific truss geometry is skipped and not created in the model."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "GenBeam",
            "description": "Timber elements representing the truss chords and webs.",
            "appliedTo": "Individual timber members imported from the Mitek IFC file."
          },
          {
            "type": "Element/Assembly",
            "description": "Logical groupings representing the complete truss assemblies.",
            "appliedTo": "Collections of beams that form a single truss unit."
          },
          {
            "type": "MetalPart",
            "description": "Connector plates (gusset plates/nail plates) derived from the 'plateIdFormat' mapping in the source data.",
            "appliedTo": "Junctions between timber chords and webs where plates are specified in the engineering data."
          }
        ]
      },
      "tokens_used": 4040,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Insertion: User launches the script instance.",
          "2. Initialization: Properties (Truss Group Name, Beam Group Name, Filter) are set to default values or catalog values.",
          "3. Execution Check: System evaluates if the script is currently being inserted (_bOnInsert).",
          "4. [Conditional] Dialog Phase: If inserting via standard command (no specific Execute Key), the Properties Palette is forced to show.",
          "5. External Data Fetch: The script calls 'ImportMitekIFC' within hsbSteicoIO.dll, passing property values as arguments.",
          "6. Map Processing: The external function returns a ModelMap containing truss geometry, material, and assembly data.",
          "7. Interpretation: The script configures interpretation settings (resolve by handle/number) and executes dbInterpretMap to generate CAD entities.",
          "8. Cleanup: The script calls eraseInstance() to remove itself from the model, leaving only the imported geometry.",
          "9. Completion: Script terminates."
        ],
        "conditionalBranches": [
          {
            "condition": "Check for Execution Key (_kExecuteKey)",
            "path1": {
              "name": "Standard Insert",
              "steps": [
                "_kExecuteKey is empty string",
                "showDialogOnce() is executed",
                "Properties Palette is displayed for user input",
                "Proceeds to External Data Fetch"
              ]
            },
            "path2": {
              "name": "Silent/API Insert",
              "steps": [
                "_kExecuteKey contains a value",
                "showDialogOnce() is skipped",
                "Uses current property values without user interaction",
                "Proceeds to External Data Fetch"
              ]
            }
          },
          {
            "condition": "Script Execution State (_bOnInsert)",
            "path1": {
              "name": "Insertion Mode",
              "steps": [
                "_bOnInsert is TRUE",
                "Constructs input Map from Properties",
                "Calls ImportMitekIFC via DLL",
                "Populates ModelMap with returned data"
              ]
            },
            "path2": {
              "name": "Recalc/Recovery Mode",
              "steps": [
                "_bOnInsert is FALSE",
                "Loads ModelMap from internal entity data (_Map)",
                "Skips DLL call (data is already local)"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "DLL Availability",
            "errorMessage": "Runtime error likely if hsbSteicoIO.dll is missing or corrupt.",
            "recovery": "Ensure hsbSteicoIO.dll exists in %hsbInstallPath%\\Utilities\\hsbCloudStorage\\."
          },
          {
            "check": "External Data Validity",
            "errorMessage": "If the DLL returns an empty or invalid Map, dbInterpretMap will create no geometry.",
            "recovery": "Verify the source Mitek IFC file is valid and accessible. Check 'pTrussFilter' for typos."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None (Script Self-Destructs)",
            "how": "N/A",
            "effect": "The script instance is removed by eraseInstance(). The user cannot modify the script via OPM after execution. Any changes must be made by deleting the imported Beams/Elements and running the script again."
          }
        ]
      },
      "tokens_used": 4905,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_MitekSapphireTrussImport\n\n## Overview\nImports structural timber truss data from Mitek Sapphire software into the hsbCAD model via IFC, organizing elements into the Project Manager.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Geometry is generated here. |\n| Paper Space | No | Not intended for layout or detailing. |\n| Shop Drawing | No | Not a shop drawing script. |\n\n## Prerequisites\n- **Required Entities**: None. This is an import tool.\n- **Minimum Beam Count**: 0.\n- **Required Settings**:\n  - `hsbSteicoIO.dll` must be located in the `Utilities\\hsbCloudStorage\\` folder of your hsbCAD installation.\n  - Access to valid Mitek IFC export data.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_MitekSapphireTrussImport.mcr`\n\n### Step 2: Configure Properties\n```\nCommand Line: Properties Palette displays automatically\nAction: Set the destination folders and import filters.\n```\nThe script will immediately prompt you with the Properties Palette. Configure your import settings here.\n\n### Step 3: Execute Import\n```\nCommand Line: None\nAction: Close the Properties Palette or click in the drawing area.\n```\nThe script will call the external import function, generate the geometry, and then remove itself from the model.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Truss Group Name | Text | Trusses\\Ground_Floor | The destination folder path in the Project Manager where the Truss Assemblies will be created. |\n| Beam Group Name | Text | Beams\\Ground_Floor | The destination folder path in the Project Manager where individual timber members (chords/webs) will be stored. |\n| Truss Name Filter | Text | [Empty] | A specific text string to filter which trusses to import. Leave empty to import all trusses from the source file. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script executes once and deletes itself; it does not remain in the model for right-click interactions. |\n\n## Settings Files\n- **Filename**: `hsbSteicoIO.dll`\n- **Location**: `%hsbInstallPath%\\Utilities\\hsbCloudStorage\\`\n- **Purpose**: Provides the `ImportMitekIFC` function required to parse and convert Mitek Sapphire data into hsbCAD entities.\n\n## Tips\n- Use backslashes (`\\`) when typing folder paths in the Group Name properties (e.g., `Roof\\Trusses`).\n- If the script runs but creates no geometry, check your **Truss Name Filter**. You may have filtered out the specific trusses you are looking for.\n- Since the script deletes itself after running, ensure your properties are correct before closing the Properties Palette. To run again, simply re-insert the script.\n\n## FAQ\n- **Q: I ran the script, but I can't find it to edit the properties again.**\n  - A: This script is designed to \"self-destruct\" using `eraseInstance()` immediately after importing. To change settings, delete the imported beams/trusses and insert the script fresh.\n- **Q: How do I import trusses to a different floor?**\n  - A: Before running the script, change the **Truss Group Name** and **Beam Group Name** in the Properties Palette to reflect the desired floor (e.g., change `Ground_Floor` to `First_Floor`)."
      },
      "tokens_used": 4898,
      "error": null
    }
  }
}