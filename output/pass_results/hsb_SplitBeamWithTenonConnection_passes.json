{
  "filename": "hsb_SplitBeamWithTenonConnection.mcr",
  "status": "completed",
  "total_tokens": 35185,
  "processing_time": 197.94542860984802,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "03.03.2016",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5495,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script interacts directly with database geometry using dbSplit() and modifies beam entities with addTool(). Uses getBeam() for selection. No Shop Drawing specific API (sd_*) or Viewport access detected."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 4132,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialogOnce",
              "promptOriginal": null,
              "condition": "_kExecuteKey==\"\"",
              "required": false
            },
            {
              "step": 2,
              "function": "getBeam",
              "promptOriginal": "Pick a beam",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "Pick a point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert (if _kExecuteKey is empty)",
            "title": null,
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dTHeight",
            "type": "PropDouble",
            "displayName": "|Tenon height|",
            "defaultValue": 100.0,
            "inputType": "number",
            "options": [],
            "category": "|Tenon|",
            "description": null
          },
          {
            "index": 1,
            "variable": "dTWidth",
            "type": "PropDouble",
            "displayName": "|Tenon width|",
            "defaultValue": 50.0,
            "inputType": "number",
            "options": [],
            "category": "|Tenon|",
            "description": null
          },
          {
            "index": 11,
            "variable": "dOffsetTenon",
            "type": "PropDouble",
            "displayName": "Tenon Offset",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": "|Tenon|",
            "description": null
          },
          {
            "index": 3,
            "variable": "dMHeight",
            "type": "PropDouble",
            "displayName": "|Mortice height|",
            "defaultValue": 100.0,
            "inputType": "number",
            "options": [],
            "category": "|Mortice|",
            "description": null
          },
          {
            "index": 2,
            "variable": "dMWidth",
            "type": "PropDouble",
            "displayName": "|Mortice width|",
            "defaultValue": 50.0,
            "inputType": "number",
            "options": [],
            "category": "|Mortice|",
            "description": null
          },
          {
            "index": 4,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "|Offset|",
            "defaultValue": 30.0,
            "inputType": "number",
            "options": [],
            "category": "|Mortice|",
            "description": null
          },
          {
            "index": 5,
            "variable": "dCutAngle",
            "type": "PropDouble",
            "displayName": "|Angle|",
            "defaultValue": 10.0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "dPEdgeOffset",
            "type": "PropDouble",
            "displayName": "|Distance from edge|",
            "defaultValue": 72.0,
            "inputType": "number",
            "options": [],
            "category": "|Drill distribution|",
            "description": null
          },
          {
            "index": 8,
            "variable": "dPHorizontalDistance",
            "type": "PropDouble",
            "displayName": "|Horizontal distance between holes|",
            "defaultValue": 36.0,
            "inputType": "number",
            "options": [],
            "category": "|Drill distribution|",
            "description": null
          },
          {
            "index": 9,
            "variable": "dPVerticalDistance",
            "type": "PropDouble",
            "displayName": "|Vertical distance between holes|",
            "defaultValue": 36.0,
            "inputType": "number",
            "options": [],
            "category": "|Drill distribution|",
            "description": null
          },
          {
            "index": 10,
            "variable": "dPPressingDistance",
            "type": "PropDouble",
            "displayName": "|Pressing distance|",
            "defaultValue": 1.5,
            "inputType": "number",
            "options": [],
            "category": "|Drill distribution|",
            "description": null
          },
          {
            "index": 6,
            "variable": "dNewDiameter",
            "type": "PropDouble",
            "displayName": "|Diameter|",
            "defaultValue": 16.0,
            "inputType": "number",
            "options": [],
            "category": "|Drill distribution|",
            "description": null
          },
          {
            "index": 0,
            "variable": "sFlip",
            "type": "PropString",
            "displayName": "Flip side",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 5958,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 6023,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Start Script Instance",
          "2. [Check] Verify insertCycleCount is 1",
          "3. [Check] Verify _kExecuteKey (preset) is empty",
          "4. [Conditional] Show Property Dialog (ShowDynamicDialog) if no preset key",
          "5. [Input] Prompt user to select a single GenBeam (getBeam)",
          "6. [Input] Prompt user to pick a split point (getPoint)",
          "7. [Processing] Project picked point onto the Beam's Centerline X-axis",
          "8. [Check] Verify Beam list is not empty",
          "9. [Processing] Split selected beam at the projected point using dbSplit()",
          "10. [Processing] Append the newly created beam segment to the list",
          "11. [Conditional] Assign Male/Female roles based on 'sFlip' property",
          "12. [Calculation] Calculate coordinate system and offsets for Tenon/Mortice",
          "13. [Processing] Apply Angle Cut to Male and Female beams",
          "14. [Processing] Apply Mortice cut (BeamCut) to Female beam",
          "15. [Processing] Apply Tenon side cuts (BeamCut) to Male beam",
          "16. [Processing] Apply Base cuts to Male beam",
          "17. [Conditional] Check Drill Diameter (dNewDiameter) > 0",
          "18. [Conditional - True] Calculate Drill points and apply Drill tools to both Male and Female beams",
          "19. [Visualization] Draw XYZ axes at the split location",
          "20. End"
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Count > 1",
            "path1": {
              "name": "Subsequent Cycle",
              "steps": [
                "Erase current script instance",
                "Return (Stop)"
              ]
            },
            "path2": {
              "name": "First Cycle",
              "steps": [
                "Continue to input prompts"
              ]
            }
          },
          {
            "condition": "_kExecuteKey (Catalog Preset) is Empty",
            "path1": {
              "name": "Manual Launch",
              "steps": [
                "Execute showDialogOnce()",
                "Display Properties Dialog to user"
              ]
            },
            "path2": {
              "name": "Preset Launch",
              "steps": [
                "Skip Dialog",
                "Set property values from catalog entry"
              ]
            }
          },
          {
            "condition": "_Beam array length is 0",
            "path1": {
              "name": "No Beam Selected",
              "steps": [
                "Erase current script instance",
                "Return (Stop)"
              ]
            },
            "path2": {
              "name": "Beam Selected",
              "steps": [
                "Proceed to split logic"
              ]
            }
          },
          {
            "condition": "_Beam array length is 1 (Pre-Split)",
            "path1": {
              "name": "Single Beam",
              "steps": [
                "Execute dbSplit() at _Pt0",
                "Append resulting beam to _Beam array"
              ]
            },
            "path2": {
              "name": "Already Split (Post-Insertion Recalc)",
              "steps": [
                "Skip split logic",
                "Proceed to modification logic"
              ]
            }
          },
          {
            "condition": "Property 'sFlip' equals 'Yes'",
            "path1": {
              "name": "Flipped",
              "steps": [
                "Assign Beam[1] as Male (Tenon)",
                "Assign Beam[0] as Female (Mortice)"
              ]
            },
            "path2": {
              "name": "Standard",
              "steps": [
                "Assign Beam[0] as Male (Tenon)",
                "Assign Beam[1] as Female (Mortice)"
              ]
            }
          },
          {
            "condition": "Property 'dNewDiameter' greater than 0",
            "path1": {
              "name": "Drills Enabled",
              "steps": [
                "Calculate drill positions based on distribution settings",
                "Add Drill tools to Male beam",
                "Add Drill tools to Female beam"
              ]
            },
            "path2": {
              "name": "Drills Disabled",
              "steps": [
                "Skip drill generation"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection",
            "errorMessage": "(Implicit) Script instance is erased silently or fails if no beam is picked.",
            "recovery": "User must launch the script again and select a valid GenBeam."
          },
          {
            "check": "Split Validity",
            "errorMessage": "(Implicit) If dbSplit() fails (point outside beam), bm.bIsValid() returns false.",
            "recovery": "Ensure the pick point is within the length of the beam."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Dimensions (OPM)",
            "how": "Select script instance in AutoCAD and change properties in Properties Palette",
            "effect": "Updates Tenon height/width, Mortice depth, Cut angle, and Drill positions immediately. Recalculates geometry."
          },
          {
            "action": "Flip Connection",
            "how": "Change 'Flip side' property in OPM to 'Yes'",
            "effect": "Swaps the Tenon and Mortice connections to the opposite sides of the split."
          },
          {
            "action": "Toggle Drills",
            "how": "Set 'Diameter' property to 0 or greater value",
            "effect": "Adds or removes drill holes from both beam segments."
          }
        ]
      },
      "tokens_used": 7819,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SplitBeamWithTenonConnection.mcr\n\n## Overview\nThis script splits a selected beam into two segments and creates a Tenon and Mortice connection between them. It also configures angled cuts and automatically places drill holes for fasteners.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in the 3D model. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | This script modifies the physical beam model, not drawings. |\n\n## Prerequisites\n- **Required Entities**: At least one `GenBeam` (General Beam) must exist in the model.\n- **Minimum Beam Count**: 1.\n- **Required Settings**: None required (defaults are built-in).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_SplitBeamWithTenonConnection.mcr` from the list.\n\n### Step 2: Configure Parameters (Optional)\n*If a catalog preset is not selected, a dialog may appear allowing you to pre-configure dimensions before selecting the beam.*\n\n### Step 3: Select Beam\n```\nCommand Line: Pick a beam\nAction: Click on the beam you wish to split and connect.\n```\n\n### Step 4: Select Split Point\n```\nCommand Line: Pick a point\nAction: Click along the length of the selected beam where you want the split/Tenon connection to occur.\n```\n\n### Step 5: Modify Properties (Post-Insertion)\n*After insertion, select the script instance (usually visible as coordinate axes near the cut) to edit dimensions in the Properties Palette.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Tenon** | | | |\n| Tenon height | Number | 100.0 | Height of the tenon projection. |\n| Tenon width | Number | 50.0 | Width of the tenon projection. |\n| Tenon Offset | Number | 0.0 | Adjusts the position of the tenon. |\n| **Mortice** | | | |\n| Mortice height | Number | 100.0 | Height of the mortice slot. |\n| Mortice width | Number | 50.0 | Width of the mortice slot. |\n| Offset | Number | 30.0 | Depth offset of the mortice cut. |\n| **General** | | | |\n| Angle | Number | 10.0 | The angle of the cut on the beam ends. |\n| Flip side | Dropdown | No | Swaps the Tenon and Mortice to the opposite beam segments. |\n| **Drill distribution** | | | |\n| Diameter | Number | 16.0 | Diameter of the drill holes. Set to 0 to disable holes. |\n| Distance from edge | Number | 72.0 | Offset of the first drill row from the beam edge. |\n| Horizontal distance between holes | Number | 36.0 | Spacing between drill holes along the X-axis. |\n| Vertical distance between holes | Number | 36.0 | Spacing between drill holes along the Y-axis. |\n| Pressing distance | Number | 1.5 | Adjustment for pressing/fitting tolerance. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *Standard hsbCAD Options* | This script does not add specific custom items to the right-click menu. Use the Properties Palette for modifications. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script relies on built-in properties and does not require external settings files.\n\n## Tips\n- **Editing**: You can change the dimensions of the Tenon and Mortice at any time by selecting the inserted script element and modifying the numbers in the Properties Palette.\n- **Swapping Sides**: If the Tenon is on the wrong half of the beam, change the \"Flip side\" property to \"Yes\".\n- **Removing Drills**: If you do not want drill holes, simply set the \"Diameter\" property to `0`.\n- **Split Location**: Ensure you click exactly on the beam centerline or within its profile projection to ensure the split logic works correctly.\n\n## FAQ\n- **Q: The script disappeared after I ran it.**\n  A: This likely means you canceled the beam selection or the split point was invalid (outside the beam). Run the script again and ensure you select the beam properly.\n- **Q: Can I use this on curved beams?**\n  A: This script is designed for standard linear beams. Results on heavily curved beams may be unpredictable.\n- **Q: How do I reset the connection to the default?**\n  A: Delete the script instance and the split beams, then restore the original single beam from your backup or undo history."
      },
      "tokens_used": 5758,
      "error": null
    }
  }
}