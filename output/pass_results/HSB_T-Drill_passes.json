{
  "filename": "HSB_T-Drill.mcr",
  "status": "completed",
  "total_tokens": 35855,
  "processing_time": 243.84104108810425,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 6716,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit use of _kModelSpace in tsl.dbCreate. No ShopDrawing (#Type E) or Multipage constructs detected. The script adds physical tools (Drill/Mortise) to Beam entities."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "HSB_T-Drill catalog entry (optional, used if _kExecuteKey matches)"
          ]
        }
      },
      "tokens_used": 3036,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select a set of beams",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select a position",
              "condition": "_bOnInsert && after PrEntity selection",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "PropertyDialog",
            "trigger": "_bOnInsert (if no execute key match)",
            "title": "Properties",
            "dataSource": "Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeperator01",
            "type": "PropString",
            "displayName": "Position",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dxOffset",
            "type": "PropDouble",
            "displayName": "Offset X",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dyOffset",
            "type": "PropDouble",
            "displayName": "Offset Y",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sSeperator02",
            "type": "PropString",
            "displayName": "Size",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dToolDpth",
            "type": "PropDouble",
            "displayName": "Depth",
            "defaultValue": 10,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Drill depth, zero means completely through"
          },
          {
            "index": 3,
            "variable": "dToolWidth",
            "type": "PropDouble",
            "displayName": "Diamter/width",
            "defaultValue": 20,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "dToolLngth",
            "type": "PropDouble",
            "displayName": "Length",
            "defaultValue": 100,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sShape",
            "type": "PropString",
            "displayName": "Corners for slotted hole",
            "defaultValue": "Square",
            "inputType": "dropdown",
            "options": [
              "Square",
              "Rounded"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sSeperator04",
            "type": "PropString",
            "displayName": "Rotation",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "dRotAngle",
            "type": "PropDouble",
            "displayName": "Angle",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6904,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Adds a configurable drill hole or slotted mortise to timber beams for connections, services, or hardware mounting.",
          "category": "Machining",
          "typicalUseCase": "Creating round holes for bolts/dowels or slotted holes for adjustment/mechanical services on structural beams."
        },
        "parameters": [
          {
            "name": "dxOffset",
            "technicalDefault": 0,
            "businessMeaning": "Longitudinal shift of the hole center along the beam's length axis relative to the clicked point.",
            "validRange": "-2000 to 2000",
            "unit": "mm",
            "affectsOutput": "Translates the hole position along the beam (X-axis)."
          },
          {
            "name": "dyOffset",
            "technicalDefault": 0,
            "businessMeaning": "Lateral shift of the hole center across the beam's width relative to the clicked point.",
            "validRange": "-500 to 500",
            "unit": "mm",
            "affectsOutput": "Translates the hole position across the beam width (Y-axis)."
          },
          {
            "name": "dToolDpth",
            "technicalDefault": 10,
            "businessMeaning": "Penetration depth of the tool. Zero value implies drilling completely through the beam section.",
            "validRange": "0 (Through) to Beam Depth",
            "unit": "mm",
            "affectsOutput": "Determines the Z-depth of the machining. 0 adapts to beam thickness."
          },
          {
            "name": "dToolWidth",
            "technicalDefault": 20,
            "businessMeaning": "Diameter of the drill (if round) or width of the slot (perpendicular to length).",
            "validRange": "6 to 200",
            "unit": "mm",
            "affectsOutput": "Defines the thickness of the removed material."
          },
          {
            "name": "dToolLngth",
            "technicalDefault": 100,
            "businessMeaning": "Length of the slot along the beam's axis. If zero, it defaults to the Width value.",
            "validRange": "0 to 2000",
            "unit": "mm",
            "affectsOutput": "Defines the slot length. If equal to Width (with rounded corners), it creates a round hole."
          },
          {
            "name": "sShape",
            "technicalDefault": "Square",
            "businessMeaning": "Geometry of the slot ends: 'Square' for milled flats, 'Rounded' for half-circle ends.",
            "validRange": "Square, Rounded",
            "unit": "enum",
            "affectsOutput": "Switches between a rectangular mortise (Square) and a capped slot (Rounded)."
          },
          {
            "name": "dRotAngle",
            "technicalDefault": 0,
            "businessMeaning": "Rotation angle of the hole/slot on the beam surface plane.",
            "validRange": "0 to 360",
            "unit": "degrees",
            "affectsOutput": "Rotates the hole around the insertion point's normal vector."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dToolLngth == 0",
            "effect": "Length is treated as equal to Width, potentially creating a round hole.",
            "cascade": [
              "dToolLngth",
              "Output Geometry"
            ]
          },
          {
            "trigger": "dToolWidth == dToolLngth AND sShape == Rounded",
            "effect": "The tool switches from a Mortise (slot) entity to a Drill (cylinder) entity.",
            "cascade": [
              "Output Entity Type",
              "Geometry Generation Logic"
            ]
          },
          {
            "trigger": "dToolDpth <= 0",
            "effect": "Depth is automatically calculated to drill through the entire beam dimension.",
            "cascade": [
              "dToolDpth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Drill",
            "description": "A cylindrical hole generated when Width equals Length and Corners are Rounded.",
            "appliedTo": "Selected Beam Entities"
          },
          {
            "type": "Mortise",
            "description": "A prismatic slot generated for all other combinations (slots or square holes).",
            "appliedTo": "Selected Beam Entities"
          }
        ]
      },
      "tokens_used": 5781,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch: User executes HSB_T-Drill.",
          "2. Cycle Check: Script checks if insertCycleCount > 1. If true, instance is erased (prevents duplicates).",
          "3. Property Initialization: Checks if an Execute Key (catalog preset) was used.",
          "4. [Conditional] Dialog Display: If no valid Execute Key is found, the Properties Dialog appears for configuration.",
          "5. Entity Selection: User is prompted to select a set of beams (PrEntity).",
          "6. Position Selection: User is prompted to click a position point on the screen (getPoint).",
          "7. Master Loop: The script iterates through every beam selected in step 5.",
          "8. Satellite Creation: For each beam, the script spawns a new instance ('Satellite') of itself attached to that beam, passing the clicked point and properties.",
          "9. Master Cleanup: The original 'Master' script instance erases itself from the drawing.",
          "10. Satellite Calculation: Each Satellite instance calculates the tool position based on offsets and rotation.",
          "11. Tool Generation: Adds a Drill or Mortise tool to the respective beam and draws preview graphics."
        ],
        "conditionalBranches": [
          {
            "condition": "Execute Key / Catalog Usage",
            "path1": {
              "name": "Catalog Preset",
              "steps": [
                "Script detects a valid Execute Key matching 'HSB_T-Drill' catalog entry.",
                "Properties are loaded silently from the catalog.",
                "Properties Dialog is skipped."
              ]
            },
            "path2": {
              "name": "Manual Input",
              "steps": [
                "No valid Execute Key found.",
                "showDialog() displays the Properties Palette.",
                "User may modify dimensions/rotation before proceeding."
              ]
            }
          },
          {
            "condition": "Geometry Logic: Width vs Length & Shape",
            "path1": {
              "name": "Generate Drill (Round Hole)",
              "steps": [
                "Condition Met: (dToolWidth == dToolLength) AND (sShape == 'Rounded').",
                "Visuals: Draws start/end circles and depth lines.",
                "Action: Adds cylindrical Drill entity to beam."
              ]
            },
            "path2": {
              "name": "Generate Mortise (Slot)",
              "steps": [
                "Condition Met: (Width != Length) OR (sShape == 'Square').",
                "Sub-branch: Checks 'Square' vs 'Rounded' for end caps.",
                "Visuals: Draws slot outline (rectangular or rounded).",
                "Action: Adds prismatic Mortise entity to beam."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Tool Width (dToolWidth)",
            "errorMessage": "Invalid toolsize found HSB_T-Drill is removed.",
            "recovery": "User must set dToolWidth > 0 and recalculate (or re-insert). The script instance deletes itself if this occurs."
          },
          {
            "check": "Duplicate Insertion",
            "errorMessage": "None (Silent)",
            "recovery": "Script automatically erases if insertCycleCount > 1."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Parameters",
            "how": "Select the TSL instance and use the Object Properties Manager (OPM) / Properties Palette.",
            "effect": "Updates size (Depth, Width, Length), offsets, rotation, or shape. Updates the tool geometry on recalculation."
          },
          {
            "action": "Move Insertion Point",
            "how": "Grip edit the insertion point (_Pt0) representation on the beam.",
            "effect": "Relocates the origin of the hole/slot. Offsets (dxOffset/dyOffset) are applied relative to this new position."
          }
        ]
      },
      "tokens_used": 7358,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_T-Drill.mcr\n\n## Overview\nThis script allows you to add a configurable drill hole or slotted mortise to timber beams. It is used for creating connections (bolts/dowels), service penetrations, or hardware mounting points.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates in the 3D model. |\n| Paper Space | No | Cannot be inserted in Layout views. |\n| Shop Drawing | No | This is a model machining script, not a 2D drawing annotation tool. |\n\n## Prerequisites\n- **Required Entities**: At least one `GenBeam` (Timber Beam).\n- **Minimum Beam Count**: 1.\n- **Required Settings**: None strictly required, though a Catalog Entry for \"HSB_T-Drill\" can be used to save presets.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: Type `TSLINSERT` (or use the hsbCAD insert tool) and select `HSB_T-Drill.mcr`.\n\n### Step 2: Configure Properties (Optional)\n- If a specific catalog preset was not selected, the Properties dialog may appear automatically.\n- **Action**: Adjust the default dimensions (Diameter, Depth, Length) or Offsets if necessary, then click OK.\n- *Note: You can also change these later via the Properties Palette.*\n\n### Step 3: Select Beams\n```\nCommand Line: Select a set of beams\nAction: Click one or multiple timber beams to apply the tool to.\n```\n\n### Step 4: Select Position\n```\nCommand Line: Select a position\nAction: Click a point on the beam face where you want the center of the hole/slot to be located.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Position** | Group | - | Separator for location settings. |\n| Offset X | Number | 0 | Moves the hole along the length of the beam from the clicked point. |\n| Offset Y | Number | 0 | Moves the hole across the width of the beam from the clicked point. |\n| **Size** | Group | - | Separator for dimensions. |\n| Depth | Number | 10 | Depth of the hole. Set to **0** to drill completely through the beam. |\n| Diamter/width | Number | 20 | The diameter of a round hole or the width of a slot. |\n| Length | Number | 100 | The length of the slot (along the beam axis). |\n| Corners for slotted hole | Dropdown | Square | Shape of the slot ends: **Square** (milled) or **Rounded**. |\n| **Rotation** | Group | - | Separator for rotation settings. |\n| Angle | Number | 0 | Rotates the hole/slot on the beam surface plane (in degrees). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| (None) | This script uses standard AutoCAD/hsbCAD commands. Select the instance and use the Properties Palette to modify values. |\n\n## Settings Files\n- **Catalog Entry**: `HSB_T-Drill`\n- **Location**: hsbCAD Catalog (Company or Project specific).\n- **Purpose**: Allows you to pre-define common sizes (e.g., \"M10 Bolt Hole\" or \"Cable Slot\") to skip manual property entry.\n\n## Tips\n- **Creating a Round Hole**: Set the **Diamter/width** equal to the **Length** and ensure **Corners** is set to **Rounded**.\n- **Through Drilling**: To ensure the hole goes all the way through regardless of beam height changes, set the **Depth** to `0`.\n- **Moving the Hole**: After insertion, select the script instance (usually visible as a point or cross on the beam) and use the **Grip** point to drag it to a new location. The X/Y offsets will be applied relative to this new grip location.\n- **Slots**: If the Length is larger than the Width, the script automatically creates a slotted mortise instead of a simple drill hole.\n\n## FAQ\n- **Q: Why did my script disappear after I selected the position?**\n  - A: This is normal behavior. The \"Master\" script erases itself after spawning \"Satellite\" instances on the selected beams. You can select the individual holes on the beams to edit them.\n- **Q: How do I switch from a slot to a circle?**\n  - A: Select the hole, open Properties, and make sure the **Diamter/width** and **Length** are identical, then set **Corners** to \"Rounded\".\n- **Q: What happens if I set a negative depth?**\n  - A: The script treats values less than or equal to 0 as \"Through\" drilling."
      },
      "tokens_used": 6060,
      "error": null
    }
  }
}