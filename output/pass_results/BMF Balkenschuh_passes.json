{
  "filename": "BMF Balkenschuh.mcr",
  "status": "completed",
  "total_tokens": 51998,
  "processing_time": 308.262752532959,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9918,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script instantiates GenBeam objects (_Beam0, _Beam1) and manipulates 3D geometry using Body (bd). It utilizes display drawing (dp.draw) for 3D visualization and interacts with Element objects for data export and nail zones. There are no sd_ functions, #Type E definitions, or _Viewport references that would indicate Paper Space or Shop Drawing usage."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 6271,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "RS",
            "type": "PropDouble",
            "displayName": "Offset length",
            "defaultValue": "-2 mm",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "Ausblattung",
            "type": "PropString",
            "displayName": "Bottom milling",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "Markierung",
            "type": "PropString",
            "displayName": "Marking",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": [
              "Marking",
              "Marking + Text",
              "Marking + Number",
              "None"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "IA",
            "type": "PropString",
            "displayName": "Orientation",
            "defaultValue": "Outside",
            "inputType": "dropdown",
            "options": [
              "Outside",
              "Inside"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sLayer",
            "type": "PropString",
            "displayName": "Layer",
            "defaultValue": "'T' Tool",
            "inputType": "dropdown",
            "options": [
              "'T' Tool",
              "'I' Information",
              "'J' Autoinfo"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": "252",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sStereotype",
            "type": "PropString",
            "displayName": "|Stereotype|",
            "defaultValue": "Assembly",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "|Defines the stereotype for Shopdrawings.| * = all dimension chains"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Assign to|",
            "handler": "|Assign to|",
            "action": "Toggles assignment of the TSL instance between the male and female beams/elements.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7848,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates BMF brand beam hangers (metal shoes) to connect a supporting beam (male) and a supported beam (female), including geometry, hardware lists, and optional layout markings.",
          "category": "Hardware / Connection",
          "typicalUseCase": "Used in timber framing to create a standardized structural connection between a main beam and a joist or secondary beam using BMF-specific hardware profiles."
        },
        "parameters": [
          {
            "name": "RS",
            "technicalDefault": "-2 mm",
            "businessMeaning": "Connection Offset / Cut Adjustment. Adjusts the position of the hanger or the depth of the beam cut to ensure proper fit or clearance.",
            "validRange": "-20 mm to 20 mm",
            "unit": "mm",
            "affectsOutput": "Adjusts the geometric placement of the hanger body and potentially the length of the male beam cut."
          },
          {
            "name": "Ausblattung",
            "technicalDefault": "Yes",
            "businessMeaning": "Bottom Flush Milling. Determines if a recess (milling) is cut into the bottom of the supporting beam so that the hanger's base plate sits flush with the beam surface.",
            "validRange": "Yes, No",
            "unit": "Boolean/Enum",
            "affectsOutput": "If 'Yes', adds a milling operation to the male beam (_Beam0) with a depth equal to the plate thickness."
          },
          {
            "name": "Markierung",
            "technicalDefault": "None",
            "businessMeaning": "Layout Marking. Controls the type of visual guide drawn on the supported beam to indicate where the hanger attaches (e.g., scribe lines, part number, or text label).",
            "validRange": "Marking, Marking + Text, Marking + Number, None",
            "unit": "Enum",
            "affectsOutput": "Adds visual Mark entities to the female beam (_Beam1) for assembly purposes."
          },
          {
            "name": "IA",
            "technicalDefault": "Outside",
            "businessMeaning": "Mounting Orientation. Specifies if the hanger is mounted on the visible outer side ('Outside') or the inner side ('Inside') of the construction.",
            "validRange": "Outside, Inside",
            "unit": "Enum",
            "affectsOutput": "Selects the specific BMF Article Number and dimensions (Height HB) based on the chosen orientation and beam height."
          },
          {
            "name": "sLayer",
            "technicalDefault": "'T' Tool",
            "businessMeaning": "CAD Layer Assignment. Determines the layer on which the hanger geometry is drawn in the CAD model (Tool, Information, or Autoinfo).",
            "validRange": "'T' Tool, 'I' Information, 'J' Autoinfo",
            "unit": "Layer Name",
            "affectsOutput": "Changes the layer property of the generated TSL visualization."
          },
          {
            "name": "nColor",
            "technicalDefault": "252",
            "businessMeaning": "Visualization Color. Sets the display color of the hanger in the 3D model.",
            "validRange": "0 - 255 (AutoCAD Color Index)",
            "unit": "Index",
            "affectsOutput": "Changes the color of the 3D body representation."
          },
          {
            "name": "sStereotype",
            "technicalDefault": "Assembly",
            "businessMeaning": "Shop Drawing Behavior. Defines how the hanger is handled in production drawings, specifically regarding dimension chain generation.",
            "validRange": "Text (e.g., 'Assembly', '*')",
            "unit": "String",
            "affectsOutput": "Controls the display of dimension requests in shop drawings ('*' = all dimension chains)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change 'IA' (Orientation) or Beam Height",
            "effect": "Updates the internal article number array and shoe height (HB) to match the specific BMF product range.",
            "cascade": [
              "nArticles",
              "HB"
            ]
          },
          {
            "trigger": "Change 'Ausblattung' to Yes",
            "effect": "Enables the milling offset (EFO) equal to the plate thickness.",
            "cascade": [
              "EFO"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "MetalPart / Body",
            "description": "3D representation of the BMF hanger shoe.",
            "appliedTo": "Visualized at the intersection of Beam 0 and Beam 1."
          },
          {
            "type": "Milling / PlaneCut",
            "description": "Recess in the bottom of the supporting beam if 'Ausblattung' is Yes.",
            "appliedTo": "_Beam0 (Male/Main Beam)"
          },
          {
            "type": "Mark",
            "description": "Layout lines or text indicating hanger position.",
            "appliedTo": "_Beam1 (Female/Supported Beam)"
          },
          {
            "type": "Hardware/BOM",
            "description": "BMF Shoe and Kamman nails (BMF Kammnägel) added to the material list.",
            "appliedTo": "Project BOM / Element List"
          },
          {
            "type": "NoNailArea",
            "description": "Exclusion zone defined on the element to prevent nailing through the hanger area.",
            "appliedTo": "Element of _Beam0 (if perpendicular alignment)"
          }
        ]
      },
      "tokens_used": 10558,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Initialization: Define properties (RS, Ausblattung, Markierung, IA, sLayer, nColor, sStereotype) and local variables.",
          "Determine Milling Offset (EFO): If Ausblattung is 'Yes', EFO equals Plate thickness (2mm); otherwise 0.",
          "Select BMF Article Number: Check Orientation (IA) and compare Beam 0 height against predefined thresholds (200mm down to 36mm). Append matching article numbers (e.g., 3518, 4521) to nArticles array.",
          "Geometry Calculation: Calculate coordinates (P1-P4) for the hanger body and cutout planes based on Beam 0 and Beam 1 intersections.",
          "Generate Hanger Geometry: Create 3D Body (bd) using points and thickness. Apply RS (Offset length) adjustments.",
          "Apply Modifications to Beams: Add Milling/Cutout to Beam 0 if applicable. Add Layout Marks to Beam 1 if Markierung is not 'None'.",
          "Hardware & BOM Creation: Generate HardWrComp entries for the BMF Shoe and Kamman nails (4x40mm) based on quantity (AnzNagel).",
          "Assign Layer & Colors: Parse Beam 0 layer name and append sub-layer code (+T, +I, +J) based on sLayer property. Set visualization color.",
          "Handle Element Assignment: Check Map for 'assignTo' (0=Male/Beam0, 1=Female/Beam1) and assign TSL instance to the corresponding Element or Beam group.",
          "Export Data: Export dimensions to DXA (if linked to Element), write TSLBOM Map, and create specialized ElemItem on Element 0.",
          "No-Nail Zones: If Beam 0 is perpendicular to Element 0 Z-axis, calculate and add a rectangular NoNail zone (ElemNoNail) to the element.",
          "Final Visualization: Draw the generated Body (bd) using the Display object."
        ],
        "conditionalBranches": [
          {
            "condition": "User selection of Orientation (IA)",
            "path1": {
              "name": "Outside",
              "steps": [
                "Set variable I_A = 1",
                "Select Article Numbers from 3000-series range based on Beam Height (e.g., 3518, 3521)"
              ]
            },
            "path2": {
              "name": "Inside",
              "steps": [
                "Set variable I_A = -1",
                "Select Article Numbers from 4000-series range based on Beam Height (e.g., 4515, 4521)"
              ]
            }
          },
          {
            "condition": "Property 'Ausblattung' (Bottom Milling)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Set milling offset (EFO) equal to Plate thickness (2mm)",
                "Apply offset to Milling/Cutout geometry on Male Beam"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Set milling offset (EFO) to 0",
                "Standard cutout geometry applied (no recess for plate thickness)"
              ]
            }
          },
          {
            "condition": "Property 'Markierung' (Marking)",
            "path1": {
              "name": "Marking / Marking + Text / Marking + Number",
              "steps": [
                "Create Mark object on Female Beam",
                "Include layout lines, and optionally text or beam number index"
              ]
            },
            "path2": {
              "name": "None",
              "steps": [
                "Skip creation of Mark object",
                "No visual layout guides added to Female Beam"
              ]
            }
          },
          {
            "condition": "Context Menu Command 'Assign to'",
            "path1": {
              "name": "Assign to Male (Element 0 / Beam 0)",
              "steps": [
                "Check current assignment state in Map",
                "If currently Female, toggle 'assignTo' integer in Map",
                "Trigger re-execution (setExecutionLoops(2))",
                "Script binds to Element 0 or Beam 0 groups on next run"
              ]
            },
            "path2": {
              "name": "Assign to Female (Element 1 / Beam 1)",
              "steps": [
                "Check current assignment state in Map",
                "If currently Male, toggle 'assignTo' integer in Map",
                "Trigger re-execution",
                "Script binds to Element 1 or Beam 1 groups on next run"
              ]
            }
          },
          {
            "condition": "Element 0 Z-Axis Alignment",
            "path1": {
              "name": "Perpendicular (Codirectional)",
              "steps": [
                "Calculate PLine for NoNail zone based on Hanger Height (HB) and Plate thickness",
                "Loop through valid zones (nZn)",
                "Add ElemNoNail tool to Element 0"
              ]
            },
            "path2": {
              "name": "Parallel / Skewed",
              "steps": [
                "Skip NoNail zone creation",
                "No exclusion zone added to Element 0"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Existence of 2 Beams (_Beam0, _Beam1)",
            "errorMessage": "Script execution fails if beams are missing or undefined.",
            "recovery": "Ensure two valid beams are selected or linked before inserting the script."
          },
          {
            "check": "Beam 0 Height matching BMF catalog",
            "errorMessage": "Geometry may generate incorrectly if Beam 0 height falls outside the defined ranges (36mm - 200mm).",
            "recovery": "Adjust Beam 0 height to match standard BMF sizes or update script code for custom dimensions."
          },
          {
            "check": "Element Validity for Export",
            "errorMessage": "DXA Export and ElemItem creation skipped if Element 0 is invalid.",
            "recovery": "Ensure beams are assigned to valid Elements for production data export."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Parameters (OPM)",
            "how": "Properties Palette (AutoCAD)",
            "effect": "Changing RS, Ausblattung, Markierung, IA, sLayer, or nColor immediately recalculates geometry, layer, and visualization."
          },
          {
            "action": "Toggle Assignment",
            "how": "Right-click Context Menu -> 'Assign to ...'",
            "effect": "Reassigns the TSL instance's logical ownership between the supporting (Male) and supported (Female) beams/elements, affecting grouping and export behavior."
          },
          {
            "action": "Modify Beams",
            "how": "Grip Edit / hsbCAD Commands",
            "effect": "Changing beam dimensions or position triggers recalculation; the hanger updates its size, article number, and placement to fit the new geometry."
          }
        ]
      },
      "tokens_used": 11004,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# BMF Balkenschuh.mcr\n\n## Overview\nGenerates BMF brand metal beam hangers (shoes) to connect a supporting beam and a supported beam. The script creates the 3D geometry, handles hardware listings (BOM), manages layout markings, and adds specific milling for base plate recesses.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script works exclusively in the 3D model. |\n| Paper Space | No | Not intended for 2D detailing views. |\n| Shop Drawing | No | Does not generate 2D views directly, but links to production data. |\n\n## Prerequisites\n- **Required entities**: Two `GenBeam` objects (Supporting Beam and Supported Beam).\n- **Minimum beam count**: 2\n- **Required settings files**: None\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `BMF Balkenschuh.mcr` from the file browser.\n\n### Step 2: Select Supporting Beam (Male)\n```\nCommand Line: Select supporting beam:\nAction: Click on the main beam (typically the beam carrying the load vertically).\n```\n\n### Step 3: Select Supported Beam (Female)\n```\nCommand Line: Select supported beam:\nAction: Click on the joist or secondary beam that will rest inside the hanger.\n```\n\n### Step 4: Configure Properties (Optional)\n```\nAction: Select the inserted script instance and open the Properties Palette (Ctrl+1) to adjust settings like Orientation, Milling, or Markings.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Offset length (RS)** | number | -2 mm | Adjusts the geometric offset of the connection relative to the beam intersection. |\n| **Bottom milling (Ausblattung)** | dropdown | Yes | If \"Yes\", creates a recess in the bottom of the supporting beam so the hanger base plate sits flush. |\n| **Marking (Markierung)** | dropdown | None | Adds layout lines or text on the supported beam to assist with assembly. Options: Marking, Marking + Text, Marking + Number, None. |\n| **Orientation (IA)** | dropdown | Outside | Sets the mounting side. \"Outside\" typically selects 3000-series articles; \"Inside\" selects 4000-series articles. |\n| **Layer (sLayer)** | dropdown | 'T' Tool | Assigns the 3D body to a specific CAD layer ('T' Tool, 'I' Information, 'J' Autoinfo). |\n| **Color (nColor)** | number | 252 | Sets the AutoCAD color index for the hanger visualization. |\n| **|Stereotype| (sStereotype)** | text | Assembly | Defines shop drawing behavior (e.g., `*` shows all dimension chains). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Assign to** | Toggles the logical assignment of the script instance between the Supporting Beam (Male) and the Supported Beam (Female). This affects how the connection is grouped and exported. |\n\n## Settings Files\nNo external settings files are required for this script.\n\n## Tips\n- **Beam Heights**: The script automatically selects the correct BMF Article Number based on the height of the supporting beam (Male beam). Ensure your beam heights correspond to standard BMF sizes (ranges approx 36mm - 200mm).\n- **Flush Mounting**: If the metal base plate should be visible (sitting under the beam), set **Bottom milling (Ausblattung)** to \"No\". If it should be recessed into the beam, set it to \"Yes\".\n- **Assembly Marks**: Use the **Marking** property to draw scribe lines on the female beam. This is very helpful on the construction site to know exactly where to place the beam relative to the hanger.\n\n## FAQ\n- **Q: How do I switch between the different BMF hanger series (e.g., for inside/outside corners)?**\n  A: Change the **Orientation (IA)** property in the Properties Palette. The script will automatically update the internal Article Number based on this setting and the beam height.\n- **Q: Why does my hanger look too small or too large?**\n  A: The script sizes the hanger based on the height of the *Supporting Beam* (the first beam you selected). Check that this beam has the correct cross-section height.\n- **Q: Can I use this for beams that are not perpendicular?**\n  A: The script is designed for perpendicular connections. Using it on skewed beams may result in geometric inaccuracies."
      },
      "tokens_used": 6399,
      "error": null
    }
  }
}