{
  "filename": "HSB_CLT-DoveTail.mcr",
  "status": "completed",
  "total_tokens": 27807,
  "processing_time": 215.74393010139465,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 5167,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script performs geometric modifications on 3D entities (Beam and Sip) using addTool. It does not contain any 'sd_' prefixes, Multipage logic, '#Type E' declarations, or Viewport interactions typical of Paper Space or Shop Drawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam",
            "Sip"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 1479,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getBeam",
              "promptOriginal": "|Select beam|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getGenBeam",
              "promptOriginal": "|Select panel|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sSeperator01",
            "type": "PropString",
            "displayName": "|Dovetail|",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dXWidth",
            "type": "PropDouble",
            "displayName": "     |Width|",
            "defaultValue": "U(40)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dYHeight",
            "type": "PropDouble",
            "displayName": "     |Height|",
            "defaultValue": "U(80)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "dZDepth",
            "type": "PropDouble",
            "displayName": "     |Depth|",
            "defaultValue": "U(20)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "dAlfa",
            "type": "PropDouble",
            "displayName": "     |Angle|",
            "defaultValue": 20,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4331,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of a structural dovetail connection (mortise and tenon) between a standard timber beam and a CLT panel.",
          "category": "Joinery",
          "typicalUseCase": "Used in timber frame construction to connect a floor or roof beam into a CLT wall or floor panel where a strong, interlocking mechanical connection is required without additional metal fasteners."
        },
        "parameters": [
          {
            "name": "sSeperator01",
            "technicalDefault": "\"\"",
            "businessMeaning": "UI category header used to organize the Properties Palette.",
            "validRange": "N/A",
            "unit": "N/A",
            "affectsOutput": "None (visual only)."
          },
          {
            "name": "dXWidth",
            "technicalDefault": "U(40)",
            "businessMeaning": "The length of the dovetail connection measured along the longitudinal axis of the beam.",
            "validRange": "30mm - 300mm (depends on beam width)",
            "unit": "mm",
            "affectsOutput": "Determines how long the slot in the panel and the tenon on the beam are along the beam's length."
          },
          {
            "name": "dYHeight",
            "technicalDefault": "U(80)",
            "businessMeaning": "The height (vertical width) of the dovetail connection measured across the face of the beam.",
            "validRange": "20mm - Beam Height",
            "unit": "mm",
            "affectsOutput": "Determines the vertical dimension of the dovetail tails; must fit within the beam's height."
          },
          {
            "name": "dZDepth",
            "technicalDefault": "U(20)",
            "businessMeaning": "The depth of the cut, i.e., how far the dovetail penetrates into the thickness of the CLT panel.",
            "validRange": "10mm - Panel Thickness",
            "unit": "mm",
            "affectsOutput": "Controls the thickness of the male tenon; a deeper cut creates a thicker tenon."
          },
          {
            "name": "dAlfa",
            "technicalDefault": "20",
            "businessMeaning": "The angle of the dovetail sides relative to the vertical axis.",
            "validRange": "5° - 30° (Standard is typically 10°-15° for wood)",
            "unit": "degrees",
            "affectsOutput": "Controls the taper of the connection; steeper angles hold tighter but are harder to assemble; shallower angles assemble easier but may slide easier."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "None (Script Independent)",
            "effect": "Parameters are geometrically independent, but physically constrained by selected material sizes.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Dovetail (Pocket)",
            "description": "A female void cut into the CLT panel to accept the beam tenon.",
            "appliedTo": "CLT Panel (Second selection)"
          },
          {
            "type": "Dovetail (Tenon)",
            "description": "A male protrusion shaped on the end of the beam, designed to stretch on insert.",
            "appliedTo": "Beam (First selection)"
          }
        ]
      },
      "tokens_used": 5752,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script initialized",
          "Check execution state: Insert Mode vs. Recalculation Mode",
          "[Insert Mode] Prompt user to 'Select beam'",
          "[Insert Mode] Prompt user to 'Select panel'",
          "Store selections and pause execution",
          "[Recalculation Mode] Validate that at least 2 entities are selected",
          "Cast first entity to Beam and validate validity",
          "Cast second entity to Sip (Panel) and validate validity",
          "Calculate intersection points and coordinate system based on relative positions",
          "Define Dovetail geometry (Pocket) using calculated coordinates and OPM parameters",
          "Add Pocket tool to the CLT Panel",
          "Define Dovetail geometry (Tenon) using same coordinates but Male type",
          "Add Tenon tool to the Beam with 'Stretch on Insert' behavior",
          "Set visualization marble size and finish"
        ],
        "conditionalBranches": [
          {
            "condition": "Is the script running during insertion (_bOnInsert)?",
            "path1": {
              "name": "Insertion Flow",
              "steps": [
                "Prompt for Beam selection",
                "Prompt for Panel selection",
                "Save references to _GenBeam array",
                "Exit function (return)"
              ]
            },
            "path2": {
              "name": "Calculation Flow",
              "steps": [
                "Validate selection count and types",
                "Perform geometric calculations",
                "Apply tools to entities"
              ]
            }
          },
          {
            "condition": "Does the selection array contain at least 2 elements?",
            "path1": {
              "name": "Sufficient Selections",
              "steps": [
                "Proceed to check validity of the first entity"
              ]
            },
            "path2": {
              "name": "Insufficient Selections",
              "steps": [
                "Report message: '|Invalid number of genbeams selected|!'",
                "Execute eraseInstance()",
                "Exit function"
              ]
            }
          },
          {
            "condition": "Is the first entity a valid Beam?",
            "path1": {
              "name": "Valid Beam",
              "steps": [
                "Proceed to check validity of the second entity"
              ]
            },
            "path2": {
              "name": "Invalid Beam",
              "steps": [
                "Report message: '|The selected beam is not valid|!'",
                "Execute eraseInstance()",
                "Exit function"
              ]
            }
          },
          {
            "condition": "Is the second entity a valid Sip (Panel)?",
            "path1": {
              "name": "Valid Panel",
              "steps": [
                "Calculate connection vectors",
                "Generate Dovetail geometry"
              ]
            },
            "path2": {
              "name": "Invalid Panel",
              "steps": [
                "Report message: '|The selected panel is not valid|!'",
                "Execute eraseInstance()",
                "Exit function"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Count of selected entities in _GenBeam array",
            "errorMessage": "|Invalid number of genbeams selected|!",
            "recovery": "Script self-destructs (eraseInstance). User must re-insert and select exactly one Beam and one Panel."
          },
          {
            "check": "Validity of the first selected entity (Beam)",
            "errorMessage": "|The selected beam is not valid|!",
            "recovery": "Script self-destructs. User must ensure the first selection is a valid, existing Beam entity."
          },
          {
            "check": "Validity of the second selected entity (Sip)",
            "errorMessage": "|The selected panel is not valid|!",
            "recovery": "Script self-destructs. User must ensure the second selection is a valid, existing Sip (CLT Panel) entity."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Connection Dimensions",
            "how": "Edit 'Width' (dXWidth), 'Height' (dYHeight), 'Depth' (dZDepth), or 'Angle' (dAlfa) in the Properties Palette",
            "effect": "Script recalculates the dovetail geometry on both the Beam and Panel to match new parameters."
          },
          {
            "action": "Adjust Assembly Position",
            "how": "Move the Beam or Panel using standard CAD grips/move commands",
            "effect": "Script recalculates the relative vectors and updates the position of the dovetail cut/tenon to maintain the connection logic."
          },
          {
            "action": "Resize Elements",
            "how": "Change the width/height of the Beam or dimensions of the Panel",
            "effect": "Script updates tool geometry, though parameters might need manual adjustment if the resize causes the dovetail to fall outside the new bounds."
          }
        ]
      },
      "tokens_used": 5906,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_CLT-DoveTail.mcr\n\n## Overview\nAutomates the creation of a structural dovetail connection (mortise and tenon) between a standard timber beam and a CLT panel. This script creates an interlocking mechanical joint designed for strong assembly without additional metal fasteners.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates on 3D model elements. |\n| Paper Space | No | Not applicable for layout views. |\n| Shop Drawing | No | Does not generate 2D annotations or views directly. |\n\n## Prerequisites\n- **Required Entities:**\n  - 1 Timber Beam (Standard structural element).\n  - 1 CLT Panel (Sip entity).\n- **Minimum Entity Count:** 2 (One Beam and One Panel).\n- **Required Settings:** None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `HSB_CLT-DoveTail.mcr` from the file dialog.\n\n### Step 2: Select the Main Beam\n```\nCommand Line: Select beam\nAction: Click on the timber beam that will form the male \"tenon\" part of the connection.\n```\n\n### Step 3: Select the CLT Panel\n```\nCommand Line: Select panel\nAction: Click on the CLT panel that will receive the \"pocket\" or slot for the connection.\n```\n\n## Properties Panel Parameters\n\nOnce the script is inserted, select the script instance in the model to edit these parameters in the Properties Palette.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Dovetail** | Header | N/A | Visual separator for the connection settings. |\n| **Width** | Number | 40 mm | The length of the dovetail along the longitudinal axis of the beam. |\n| **Height** | Number | 80 mm | The vertical height of the dovetail across the face of the beam. Ensure this fits within the beam height. |\n| **Depth** | Number | 20 mm | How deep the dovetail penetrates into the CLT panel (determines tenon thickness). Ensure this is less than the panel thickness. |\n| **Angle** | Number | 20° | The taper angle of the dovetail sides. A steeper angle holds tighter; a shallower angle is easier to assemble. |\n\n## Right-Click Menu Options\n\nThere are no custom context menu options for this script. Use the Properties Palette to modify parameters.\n\n## Settings Files\n- **Filename:** None required.\n- **Location:** N/A\n- **Purpose:** N/A\n\n## Tips\n- **Visual Feedback:** If the joint looks incorrect, move the Beam or Panel using standard CAD Move commands. The script will automatically recalculate the connection geometry based on the new positions.\n- **Assembly Clearance:** If you require clearance for glue or easier assembly, slightly reduce the **Depth** parameter relative to the panel thickness.\n- **Validation:** The script will automatically delete itself if you select an invalid beam or panel during insertion. Ensure you select a valid Beam first and a valid Sip (Panel) second.\n\n## FAQ\n- **Q: Why did the script disappear immediately after I selected the elements?**\n  - A: The script performs validity checks. If the first selection was not a valid Beam or the second selection was not a valid CLT Panel (Sip), the script self-destructs. Re-insert and ensure you select the correct entity types.\n\n- **Q: Can I use this to connect two regular beams together?**\n  - A: No, this script is specifically designed to connect a Timber Beam to a CLT Panel (Sip entity).\n\n- **Q: What happens if I resize the beam after inserting the connection?**\n  - A: The connection parameters (Width/Height) do not automatically update to match the new beam size. You must manually check the Properties Palette to ensure the dovetail dimensions still fit within the resized beam."
      },
      "tokens_used": 5172,
      "error": null
    }
  }
}