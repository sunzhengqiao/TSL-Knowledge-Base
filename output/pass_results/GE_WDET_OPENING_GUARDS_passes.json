{
  "filename": "GE_WDET_OPENING_GUARDS.mcr",
  "status": "completed",
  "total_tokens": 54594,
  "processing_time": 481.507541179657,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "v0.7",
            "date": "03.nov.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Stickframe path added to mapIn when calling dll"
          },
          {
            "version": "v0.6",
            "date": "21.jul.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Description added Thumbnail added"
          },
          {
            "version": "v0.5",
            "date": "13.ago.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Set type kSupportingCrossBeam to created beams Module property of blocks set from opening module Information property of blocks will be filled only if user specifically defines it (manually)"
          },
          {
            "version": "v0.4",
            "date": "14.mar.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Lumber item info pulled from inventory Set dependency of tsl to element Assigned tsl to element group Display added Tsl now can be added as plugin to wall definition Beam color set by custom or assembly values"
          },
          {
            "version": "v0.3",
            "date": "",
            "author": "",
            "changes": "Will erase existing beam if manually inserted. hsbIds are 776, 777 and 778."
          },
          {
            "version": "v0.2",
            "date": "",
            "author": "",
            "changes": "Small elevation change"
          },
          {
            "version": "v0.1",
            "date": "",
            "author": "",
            "changes": "Puts guard rails in opes"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8555,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script generates 3D construction elements (GenBeams) using `Beam.dbCreate()` and manipulates 3D geometry (Body, PlaneProfile, Vector3d). It retrieves data from `Element` and `Opening` objects within the model context. There are no references to `_Viewport`, `Sheet`, `sd_` functions, or 2D detailing operations typical of ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Wall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing a Wall element with openings.",
          "requiredSettings": [
            "hsbFramingDefaults.Inventory.dll",
            "Valid Inventory entries for lumber items",
            "Company and Installation environment variables (_kPathHsbCompany, _kPathHsbWallDetail, _kPathHsbInstall)"
          ]
        }
      },
      "tokens_used": 7548,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Properties Dialog (OPM)",
            "trigger": "showDialogOnce() during insert",
            "title": null,
            "dataSource": "Script Properties and hsbFramingDefaults.Inventory.dll",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sEmpty",
            "type": "PropString",
            "displayName": "Blocking info",
            "defaultValue": " ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Read-only header"
          },
          {
            "index": 1,
            "variable": "sEmpty1",
            "type": "PropString",
            "displayName": "Auto",
            "defaultValue": "     |Auto|",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Read-only header"
          },
          {
            "index": 2,
            "variable": "sBlockLumberItem",
            "type": "PropString",
            "displayName": "Lumber item",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": "Populated dynamically from hsbFramingDefaults.Inventory.dll",
            "category": null,
            "description": "Select lumber item from inventory"
          },
          {
            "index": 3,
            "variable": "sEmpty2",
            "type": "PropString",
            "displayName": "Manual",
            "defaultValue": "If no value is set, values are taken from inventory (one or many). ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Read-only instruction"
          },
          {
            "index": 4,
            "variable": "sBlockSizeOPM",
            "type": "PropString",
            "displayName": "Beam size",
            "defaultValue": "From inventory",
            "inputType": "dropdown",
            "options": [
              "2x1",
              "2x2",
              "2x3",
              "2x4",
              "2x6",
              "2x8",
              "2x10",
              "2x12",
              "2x14",
              "2x16",
              "From inventory"
            ],
            "category": null,
            "description": "Select nominal size or use inventory"
          },
          {
            "index": 5,
            "variable": "sBmColorOption",
            "type": "PropString",
            "displayName": "Blocking color",
            "defaultValue": "Copy from assembly",
            "inputType": "dropdown",
            "options": [
              "Copy from assembly",
              "Custom"
            ],
            "category": null,
            "description": "Determines how the block color is set"
          },
          {
            "index": 0,
            "variable": "nBlockColorOPM",
            "type": "PropInt",
            "displayName": "Custom color",
            "defaultValue": 2,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": "Custom color index (applies if Blocking color is Custom)"
          },
          {
            "index": 6,
            "variable": "sBlockNameOPM",
            "type": "PropString",
            "displayName": "Name",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Name property for the generated beam"
          },
          {
            "index": 7,
            "variable": "sBlockMaterialOPM",
            "type": "PropString",
            "displayName": "Material",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Material property for the generated beam"
          },
          {
            "index": 8,
            "variable": "sBlockGradeOPM",
            "type": "PropString",
            "displayName": "Grade",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Grade property for the generated beam"
          },
          {
            "index": 9,
            "variable": "sBlockInformationOPM",
            "type": "PropString",
            "displayName": "Information",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Information property for the generated beam"
          },
          {
            "index": 10,
            "variable": "sBlockLabelOPM",
            "type": "PropString",
            "displayName": "Label",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Label property for the generated beam"
          },
          {
            "index": 11,
            "variable": "sBlockSubLabelOPM",
            "type": "PropString",
            "displayName": "Sublabel",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Sublabel property for the generated beam"
          },
          {
            "index": 12,
            "variable": "sBlockSubLabel2OPM",
            "type": "PropString",
            "displayName": "Sublabel2",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Sublabel2 property for the generated beam"
          },
          {
            "index": 13,
            "variable": "sBlockBeamCodeOPM",
            "type": "PropString",
            "displayName": "Beam code",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": "Beam code property for the generated beam"
          }
        ],
        "contextMenu": [],
        "settingsFiles": [
          {
            "filename": "hsbFramingDefaults.Inventory.dll",
            "searchPaths": [
              "%_kPathHsbInstall%\\Utilities\\hsbFramingDefaultsEditor"
            ],
            "purpose": "Provides lumber item list (names, keys, dimensions, material, grade) for the 'Lumber item' property.",
            "required": true
          }
        ]
      },
      "tokens_used": 9773,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 11549,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script: Script initializes, calling Inventory.dll to populate lumber item lists.",
          "2. Element Selection: User prompted to select Wall elements via command line.",
          "3. Configuration: OPM Properties dialog appears once (if not running via command key).",
          "4. Cloning: Script clones itself onto all selected Wall elements, then erases the original instance.",
          "5. Initialization (Cloned Instance): Instance validates host element and sets dependency.",
          "6. Data Retrieval: Extracts beams and openings from the wall element.",
          "7. Property Resolution: Determines beam dimensions/material (Inventory vs Manual OPM values).",
          "8. Opening Loop: Iterates through every opening in the wall.",
          "9. Filtering: Skips Medical Cabins (names containing 'CAB' or 'AP').",
          "10. Condition Checks: Determines if opening is a Door (height <= 2\") or Wide (> 42.875\").",
          "11. Geometry Calculation: Identifies side studs to calculate guard rail position and length.",
          "12. Generation: Creates GenBeams (hsbId 777, 776, 778) based on the specific opening requirements.",
          "13. Display: Draws 2D preview of the generated beams."
        ],
        "conditionalBranches": [
          {
            "condition": "Insertion Cycle Count",
            "path1": {
              "name": "First Cycle",
              "steps": [
                "Select Elements.",
                "Show Dialog.",
                "Clone self to elements.",
                "Erase self."
              ]
            },
            "path2": {
              "name": "Subsequent Cycle",
              "steps": [
                "Erase self immediately.",
                "Exit."
              ]
            }
          },
          {
            "condition": "Execution Mode / Recalculation",
            "path1": {
              "name": "First Run",
              "steps": [
                "Execute beam generation logic.",
                "Set ExecutionMode map flag to 1."
              ]
            },
            "path2": {
              "name": "Recalculation",
              "steps": [
                "Skip generation logic (prevents duplicate beams).",
                "Display existing beams."
              ]
            }
          },
          {
            "condition": "Beam Size Source",
            "path1": {
              "name": "From Inventory",
              "steps": [
                "Use Width/Height from Inventory.",
                "Override Material/Grade if OPM values exist."
              ]
            },
            "path2": {
              "name": "Manual/Nominal",
              "steps": [
                "Use fixed Width (1.5\") and selected Nominal Height.",
                "Use Material/Grade strictly from OPM."
              ]
            }
          },
          {
            "condition": "Opening Height",
            "path1": {
              "name": "Door (Height <= 2\")",
              "steps": [
                "Create bottom rail (777).",
                "Create specific blocking at 3.25\" and 21\" (776).",
                "Add mid-stiffener if width > 57.125\"."
              ]
            },
            "path2": {
              "name": "Window/Other",
              "steps": [
                "Create rail at 42\" height.",
                "Add doubler if width > 42.875\"."
              ]
            }
          },
          {
            "condition": "Blocking Color Option",
            "path1": {
              "name": "Custom",
              "steps": [
                "Apply color index from 'Custom color' OPM property."
              ]
            },
            "path2": {
              "name": "Copy from assembly",
              "steps": [
                "Copy color from the nearest left side stud.",
                "Fallback to 'Custom color' if stud invalid."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Validity",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases self if host element is invalid."
          },
          {
            "check": "Side Studs Found",
            "errorMessage": "TSL... could not find side studs for an opening on wall [number]",
            "recovery": "Check wall construction/properties; ensure opening has framing members on sides."
          },
          {
            "check": "Opening Module Name",
            "errorMessage": "TSL... could not find an opening module name on wall [number]",
            "recovery": "Ensure the opening entity has a valid module name assigned."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Update Dimensions/Material",
            "how": "Properties Palette (OPM)",
            "effect": "Changing 'Lumber item', 'Beam size', or 'Material' triggers a rebuild of the guard beams with new properties."
          },
          {
            "action": "Update Geometry",
            "how": "Stretch/Grip edit Wall",
            "effect": "Because script sets dependency, changing wall geometry triggers a recalculation, adjusting beam lengths and positions."
          }
        ]
      },
      "tokens_used": 9954,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_WDET_OPENING_GUARDS.mcr\n\n## Overview\nThis script automatically generates guard rails and blocking for wall openings, such as doors and windows. It creates dimensional lumber elements based on the opening's dimensions and assigns properties (material, grade, etc.) from user settings or the project inventory.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script runs in the 3D model. |\n| Paper Space | No | Not applicable for layouts. |\n| Shop Drawing | No | Generates 3D model elements only. |\n\n## Prerequisites\n- **Required Entities**: Wall elements containing Openings.\n- **Minimum Beam Count**: 0 (The script creates the beams).\n- **Required Settings**:\n  - `hsbFramingDefaults.Inventory.dll` (Must be present in the `Utilities\\hsbFramingDefaultsEditor` folder).\n  - Valid Inventory entries for lumber items.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_WDET_OPENING_GUARDS.mcr`\n\n### Step 2: Select Elements\n```\nCommand Line: Select a set of elements\nAction: Click on the Wall elements (or window/floor containing walls) where you want to add opening guards. Press Enter to confirm.\n```\n\n### Step 3: Configure Properties\nAfter selection, the Properties Palette (OPM) will open.\n1.  **Lumber Item**: Select the desired lumber profile from the inventory (e.g., \"Stud 2x4\").\n2.  **Beam Size**: Choose a specific nominal size (e.g., 2x4, 2x6) or select \"From inventory\" to use the size defined in the Lumber Item.\n3.  **Blocking Color**: Choose \"Copy from assembly\" to match the wall studs or \"Custom\" to use a specific color.\n4.  **Manual Properties**: Optionally override Name, Material, Grade, or Label information.\n\n### Step 4: Generation\nThe script will automatically calculate the geometry for each opening and generate the guard rails.\n- **Doors**: Adds a bottom rail and specific blocking heights.\n- **Windows**: Adds a rail at 42\" height.\n- **Wide Openings**: Adds additional stiffeners or doublers if width exceeds thresholds.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Blocking info** | Text | (Header) | Section header. |\n| **Auto** | Text | (Header) | Section header for automatic settings. |\n| **Lumber item** | Dropdown | *Empty* | Select a lumber item from the Inventory to define dimensions/material. |\n| **Manual** | Text | (Instructions) | Section header for manual overrides. |\n| **Beam size** | Dropdown | From inventory | Select a nominal size (e.g., 2x4, 2x6). If \"From inventory\" is selected, it uses the Lumber Item's size. |\n| **Blocking color** | Dropdown | Copy from assembly | Determines the color of the generated beams. |\n| **Custom color** | Number | 2 | Sets the color index if \"Blocking color\" is set to \"Custom\". |\n| **Name** | Text | *Empty* | Sets the \"Name\" property of the generated beams. |\n| **Material** | Text | *Empty* | Overrides the \"Material\" property of the generated beams. |\n| **Grade** | Text | *Empty* | Overrides the \"Grade\" property of the generated beams. |\n| **Information** | Text | *Empty* | Sets the \"Information\" property for CAM/Production data. |\n| **Label** | Text | *Empty* | Sets the \"Label\" property of the generated beams. |\n| **Sublabel** | Text | *Empty* | Sets the \"Sublabel\" property of the generated beams. |\n| **Sublabel2** | Text | *Empty* | Sets the \"Sublabel2\" property of the generated beams. |\n| **Beam code** | Text | *Empty* | Sets the \"Beam code\" property of the generated beams. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *(None)* | This script does not add custom items to the right-click context menu. Modify parameters using the Properties Palette (OPM). |\n\n## Settings Files\n- **Filename**: `hsbFramingDefaults.Inventory.dll`\n- **Location**: `%_kPathHsbInstall%\\Utilities\\hsbFramingDefaultsEditor`\n- **Purpose**: Provides the list of available Lumber Items (Names, Dimensions, Material) used by the \"Auto\" section of the properties.\n\n## Tips\n- **Dependency**: The script sets a dependency on the wall. If you modify the wall geometry (stretch or move an opening), the guard rails will update automatically.\n- **Medical Cabins**: The script is designed to skip openings that contain 'CAB' or 'AP' in their module name (typically Medical Cabins).\n- **Color Matching**: Use \"Copy from assembly\" for the Blocking Color to ensure the guards visually blend with the surrounding studs.\n- **Updating**: If you manually change a guard beam in the model and want to regenerate it, delete the beam and run a recalculation on the wall.\n\n## FAQ\n- **Q: Why did the script not create a beam for a specific opening?**\n  - A: Check if the opening is identified as a \"Medical Cabin\" (Name contains CAB or AP). Also, ensure the wall has valid side studs for the script to calculate the position.\n- **Q: How do I change the height of the window guard?**\n  - A: The script currently uses a fixed height logic (e.g., 42\" for windows). To change this, you would need to modify the script code.\n- **Q: Can I use this on curved walls?**\n  - A: The script retrieves openings from the element. While it may work on some curved walls, it is primarily designed for standard straight wall applications."
      },
      "tokens_used": 7215,
      "error": null
    }
  }
}