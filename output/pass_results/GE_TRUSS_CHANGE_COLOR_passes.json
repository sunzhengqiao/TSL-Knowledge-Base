{
  "filename": "GE_TRUSS_CHANGE_COLOR.mcr",
  "status": "completed",
  "total_tokens": 20278,
  "processing_time": 338.796174287796,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "v1.0",
            "date": "01.jul.2013",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3803,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "No sd_ or Multipage prefixes found. Uses PrEntity with TrussEntity() and iterates through _Entity[]. Logic modifies Truss definition and calls eraseInstance(), typical of a Model Space utility script."
        },
        "prerequisites": {
          "requiredEntities": [
            "TrussEntity"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (Layout/Model)",
          "requiredSettings": []
        }
      },
      "tokens_used": 1379,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect truss(es)",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowNotice",
            "trigger": "After processing trusses",
            "title": null,
            "dataSource": "Static string",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sColor",
            "type": "PropString",
            "displayName": "New color|",
            "defaultValue": "|Beam|",
            "inputType": "dropdown",
            "options": [
              "|Beam|",
              "|Steel|"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2156,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A utility script to batch-update the display color of all beams within selected trusses, switching between a standard timber color and a steel color.",
          "category": "Utility/Visualization",
          "typicalUseCase": "Used to visually differentiate specific trusses (e.g., indicating steel reinforcement or different material zones) for presentation or drafting purposes without manually editing each truss."
        },
        "parameters": [
          {
            "name": "sColor",
            "technicalDefault": "|Beam|",
            "businessMeaning": "Determines the target display color for the beams inside the selected trusses. It allows a switch between a standard 'Beam' appearance (typically timber color) and a 'Steel' appearance (typically grey).",
            "validRange": "|Beam|, |Steel|",
            "unit": "AutoCAD Color Index (ACI) mapped via selection",
            "affectsOutput": "Modifies the graphical color property of the constituent beams within the Truss entity, altering their appearance in the Model Space and potentially in generated views until recalculated."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "TrussEntity (Modified)",
            "description": "The color attribute of beams within the Truss Definition is updated to the selected ACI value.",
            "appliedTo": "Truss entities selected by the user during the script execution."
          }
        ]
      },
      "tokens_used": 4512,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script launched via command or palette.",
          "Prompt user to select Truss entities using PrEntity.",
          "User confirms selection (or presses Enter).",
          "Script checks if any entities were selected.",
          "Script triggers 'showDialogOnce' to display Properties Palette for color selection.",
          "User selects 'New color' (|Beam| or |Steel|) from the dropdown list.",
          "Script maps the string selection to an integer AutoCAD Color Index (ACI).",
          "Script iterates through the list of selected entities.",
          "For each entity, script attempts to cast it to a TrussEntity and checks validity.",
          "For valid trusses, script retrieves the TrussDefinition.",
          "Script retrieves all beams contained within the TrussDefinition.",
          "Script applies the mapped ACI color to each beam using setColor().",
          "Script displays a reportNotice advising the user to recalculate.",
          "Script executes eraseInstance() to remove itself from the drawing."
        ],
        "conditionalBranches": [
          {
            "condition": "User selection after PrEntity prompt",
            "path1": {
              "name": "No Selection",
              "steps": [
                "Check fails: _Entity.length() == 0",
                "Execute eraseInstance()",
                "Terminate script"
              ]
            },
            "path2": {
              "name": "Valid Selection",
              "steps": [
                "Entities stored in _Entity array",
                "Proceed to display Dialog/Properties"
              ]
            }
          },
          {
            "condition": "Validity of entity in processing loop",
            "path1": {
              "name": "Invalid Entity",
              "steps": [
                "Check fails: teTruss.bIsValid() is false",
                "Execute continue statement",
                "Skip to next entity in list"
              ]
            },
            "path2": {
              "name": "Valid Truss",
              "steps": [
                "Access TrussDefinition",
                "Retrieve and modify beam colors"
              ]
            }
          },
          {
            "condition": "Color Property Selection (sColor)",
            "path1": {
              "name": "|Beam|",
              "steps": [
                "sColors.find returns 0",
                "nColor set to 32",
                "Beams colored ACI 32"
              ]
            },
            "path2": {
              "name": "|Steel|",
              "steps": [
                "sColors.find returns 1",
                "nColor set to 254",
                "Beams colored ACI 254"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Count",
            "errorMessage": "No specific error message is logged to the command line.",
            "recovery": "User must run the script again and select at least one Truss entity."
          },
          {
            "check": "Entity Type Validity",
            "errorMessage": "None (handled silently via continue loop).",
            "recovery": "User must ensure selected objects are valid hsbCAD Truss entities."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Run Recalculation",
            "how": "Manual command execution (HSB_RECALC) on the modified trusses.",
            "effect": "Updates the graphical display of the truss beams to reflect the newly assigned color."
          }
        ]
      },
      "tokens_used": 4227,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_TRUSS_CHANGE_COLOR.mcr\n\n## Overview\nThis utility script allows you to batch-update the display color of all beams within selected trusses. It provides a quick method to switch the visual appearance of trusses between a standard timber color and a steel color (typically grey) for presentation or drafting purposes.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in Model Space. |\n| Paper Space | No | Not supported in Layouts. |\n| Shop Drawing | No | Not applicable for shop drawings. |\n\n## Prerequisites\n- **Required Entities**: At least one valid hsbCAD Truss entity must exist in the drawing.\n- **Minimum Beam Count**: 1 (via Truss selection).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nExecute the command `TSLINSERT` in the AutoCAD command line. Browse to the location of `GE_TRUSS_CHANGE_COLOR.mcr`, select the file, and click **Open**.\n\n### Step 2: Select Trusses\n```\nCommand Line: Select truss(es)\nAction: Click on the truss entities you wish to modify. You can select multiple trusses.\n```\nPress **Enter** to confirm your selection.\n\n### Step 3: Select New Color\nAfter selecting the trusses, the AutoCAD Properties Palette (OPM) will appear automatically.\n1. Locate the parameter labeled **New color**.\n2. Click the dropdown menu.\n3. Select either `|Beam|` (standard timber color) or `|Steel|` (grey color).\n\n### Step 4: Apply Changes\nClose the Properties Palette or simply click elsewhere in the drawing. The script will process the selection, update the colors in the truss definition, and automatically remove itself from the drawing.\n\n### Step 5: Recalculate\n**Important:** To see the color changes visually in the Model Space and views, you must manually recalculate the trusses.\n- Type `HSB_RECALC` in the command line and press Enter.\n- Select the modified trusses and press Enter.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| New color | Dropdown | \\|Beam\\| | Select the display color for the beams inside the selected trusses. Options are \\|Beam\\| (ACI 32 - typically timber color) or \\|Steel\\| (ACI 254 - typically grey). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific items to the right-click context menu. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Visual Updates**: The script modifies the underlying definition of the truss, but the screen display will not update until you run `HSB_RECALC` on the selected trusses.\n- **Batch Processing**: You can select as many trusses as needed in a single run to ensure consistency across a project.\n- **Color Codes**: This script maps the selection to specific AutoCAD Color Index (ACI) values: 32 for `|Beam|` and 254 for `|Steel||`.\n\n## FAQ\n- **Q: Why didn't the trusses change color immediately after running the script?**\n  A: The script updates the definition data but does not force a graphical refresh. You must run `HSB_RECALC` on the modified trusses to update the display.\n- **Q: Can I use this on individual beams that are not part of a truss?**\n  A: No, this script is designed specifically for hsbCAD Truss entities and will not function on standard GenBeams or single elements.\n- **Q: What happens if I select non-truss objects?**\n  A: The script will ignore them and only process valid Truss entities found in your selection."
      },
      "tokens_used": 4201,
      "error": null
    }
  }
}