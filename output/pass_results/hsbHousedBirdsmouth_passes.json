{
  "filename": "hsbHousedBirdsmouth.mcr",
  "status": "completed",
  "total_tokens": 46431,
  "processing_time": 376.1083130836487,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.2",
            "date": "22feb2021",
            "author": "nils.gregor@hsbcad.com",
            "changes": "HSB-10134 Added property for end cut and image"
          },
          {
            "version": "1.1",
            "date": "28jan2021",
            "author": "nils.gregor@hsbcad.com",
            "changes": "HSB-10134 Changed behavior of property (C), renamed properties"
          },
          {
            "version": "1.0",
            "date": "26jan2021",
            "author": "nils.gregor@hsbcad.com",
            "changes": "HSB-10134 initial version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7319,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses `tslNew.dbCreate(..., _kModelSpace, ...)` to insert new instances. It performs 3D geometry modifications using `Cut` and `BeamCut` objects added to beams. There are no references to `_Viewport`, `_kPaperSpace`, or `sd_` prefixes typical of Paper Space or ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 6293,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity.go()",
              "promptOriginal": "|Select roofplane or beams|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity.go()",
              "promptOriginal": "|Select female beams as purlin|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "On Insert (unless _kExecuteKey matches a catalog name)",
            "title": null,
            "dataSource": "Properties Palette",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "dHouseDepthTop",
            "type": "PropDouble",
            "displayName": "|Vertical Depth| (A)",
            "defaultValue": "U(20)",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the depth of the house at the top of the purlin|"
          },
          {
            "index": 1,
            "variable": "dHouseDepthSide",
            "type": "PropDouble",
            "displayName": "|Horizontal Depth| (B)",
            "defaultValue": "U(20)",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the depth of the house at the side of the purlin|"
          },
          {
            "index": 2,
            "variable": "dVertOffsetHouse",
            "type": "PropDouble",
            "displayName": "|Offset Horizontal Cut| (C)",
            "defaultValue": "U(5)",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Defines the horizontal distance to the edge where the bottom cut starts|"
          },
          {
            "index": 3,
            "variable": "dGapAtSide",
            "type": "PropDouble",
            "displayName": "|Side| (D)",
            "defaultValue": "U(0.5)",
            "inputType": "number",
            "options": [],
            "category": "|Gaps|",
            "description": "|Defines the gap for the housing at the sides in the purlin. The value is taken at each side|"
          },
          {
            "index": 4,
            "variable": "dGapAtBottom",
            "type": "PropDouble",
            "displayName": "|Bottom| (E)",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "|Gaps|",
            "description": "|Defines the gap at the bottom of the housing at the side|"
          },
          {
            "index": 0,
            "variable": "sCutMaleBeam",
            "type": "PropString",
            "displayName": "|Cut male beam|",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|End cut|",
            "description": "|Defines an end cut at the male beam at the opposite side of the female beam|"
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6978,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a housed birdsmouth joint between a rafter (male) and purlin (female), including vertical and horizontal seats with optional gaps and end cuts.",
          "category": "Framing",
          "typicalUseCase": "Connecting rafters to purlins in timber roof construction where a load-bearing seated joint is required."
        },
        "parameters": [
          {
            "name": "dHouseDepthTop",
            "technicalDefault": "U(20)",
            "businessMeaning": "The depth of the vertical seat (notch) cut into the top surface of the purlin to support the rafter.",
            "validRange": "10mm - 50mm (typically 1/3 to 1/2 of purlin depth)",
            "unit": "mm",
            "affectsOutput": "Determines the vertical penetration of the rafter into the purlin. Modifies the 'seat' of the birdsmouth. Automatically resets to 0 if beams are not vertically perpendicular."
          },
          {
            "name": "dHouseDepthSide",
            "technicalDefault": "U(20)",
            "businessMeaning": "The depth of the horizontal notch cut into the side face of the purlin.",
            "validRange": "10mm - 50mm",
            "unit": "mm",
            "affectsOutput": "Determines how far the rafter extends into the side of the purlin. Automatically resets to 0 if the beams are not at a perfect 90° angle in plan view."
          },
          {
            "name": "dVertOffsetHouse",
            "technicalDefault": "U(5)",
            "businessMeaning": "The vertical distance from the bottom of the birdsmouth tail up to the horizontal cut line. This sets the height of the 'heel' of the cut.",
            "validRange": "0mm - 30mm",
            "unit": "mm",
            "affectsOutput": "Changes the vertical position of the horizontal cut on the rafter, effectively adjusting the vertical plumb cut length."
          },
          {
            "name": "dGapAtSide",
            "technicalDefault": "U(0.5)",
            "businessMeaning": "Clearance allowance on the sides of the tenon (rafter) relative to the mortise (purlin) to ensure easy assembly.",
            "validRange": "0mm - 3mm",
            "unit": "mm",
            "affectsOutput": "Widens the horizontal cut on the female beam (purlin) so the male beam is not tight against the sides."
          },
          {
            "name": "dGapAtBottom",
            "technicalDefault": "U(0)",
            "businessMeaning": "Clearance gap at the very bottom of the side housing cut.",
            "validRange": "0mm - 5mm",
            "unit": "mm",
            "affectsOutput": "Lowers the bottom limit of the side housing cut in the purlin."
          },
          {
            "name": "sCutMaleBeam",
            "technicalDefault": "|No|",
            "businessMeaning": "Option to trim the end of the rafter flush with the face of the purlin opposite the entry point.",
            "validRange": "|No|, |Yes|",
            "unit": "enum",
            "affectsOutput": "If Yes, applies a vertical saw cut to the male beam at the exit point of the joint."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Plan angle between beams != 90°",
            "effect": "dHouseDepthSide is forced to 0 to prevent unmachinable geometry.",
            "cascade": [
              "dHouseDepthSide"
            ]
          },
          {
            "trigger": "Vertical angle between beams != 90°",
            "effect": "dHouseDepthTop is forced to 0 because the vertical seat cannot be cut.",
            "cascade": [
              "dHouseDepthTop"
            ]
          },
          {
            "trigger": "Beam angle < 1° or > 89°",
            "effect": "Script deletes itself and reports an error.",
            "cascade": [
              "Instance"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "BeamCut",
            "description": "A 3-axis CNC cut on the purlin creating the housing (mortise) to accept the rafter.",
            "appliedTo": "Female Beam (Purlin)"
          },
          {
            "type": "BeamCut",
            "description": "A 3-axis CNC cut on the rafter forming the birdsmouth tail (tenon).",
            "appliedTo": "Male Beam (Rafter)"
          },
          {
            "type": "Cut",
            "description": "A simple vertical saw cut, optionally applied to the rafter end.",
            "appliedTo": "Male Beam (Rafter)"
          },
          {
            "type": "PLine (Visualization)",
            "description": "A graphic symbol representing the geometry of the cut.",
            "appliedTo": "Model Space"
          }
        ]
      },
      "tokens_used": 8047,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Launch Script via Command or Catalog.\",\n    \"2. Check Execution Key: If Catalog Name exists, load properties; else, open Properties Palette (Dialog) for user input.\",\n    \"3. Prompt User to select Male Beams (Rafters) or RoofPlane.\",\n    \"4. Prompt User to select Female Beams (Purlins).\",\n    \"5. Process Selections: Extract beams from RoofPlanes if selected. Remove dummy beams.\",\n    \"6. Filter Intersections: Remove Male beams parallel to Females or not intersecting.\",\n    \"7. Batch Generate: For each valid Male/Female pair, create a new script instance inheriting current properties.\",\n    \"8. Delete Seed Instance: The original instance used for selection is removed.\",\n    \"9. Instance Initialization (Per Joint): Validate attached beams (must be 2 valid beams).\",\n    \"10. Intersection Check: Verify beams still intersect. If not, delete instance.\",\n    \"11. Global Angle Validation: Calculate angle to World XY. If outside 1°-89°, delete instance with error.\",\n    \"12. Local Angle Adjustment (Plan): If beams are not perpendicular in Plan view, force 'Horizontal Depth (B)' to 0.\",\n    \"13. Local Angle Adjustment (Vertical): If beams are not vertically plumb to each other, force 'Vertical Depth (A)' to 0.\",\n    \"14. Apply Cuts: Generate BeamCuts and Cuts on Male and Female beams based on calculated depths and gaps.\",\n    \"15. Draw Symbol: Display graphic representation of the joint.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Execution Key (Catalog vs Manual)\",\n      \"path1\": {\n        \"name\": \"Catalog Mode\",\n        \"steps\": [\n          \"Check if _kExecuteKey matches a catalog name.\",\n          \"Load properties from that catalog.\",\n          \"Skip dialog.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Manual Mode\",\n        \"steps\": [\n          \"Execute showDialog().\",\n          \"User manually adjusts properties in OPM before proceeding.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Male Entity Type\",\n      \"path1\": {\n        \"name\": \"RoofPlane Selected\",\n        \"steps\": [\n          \"Cast Entity to ToolEnt.\",\n          \"Extract all beams belonging to the element.\",\n          \"Add beams to Male list.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Individual Beams Selected\",\n        \"steps\": [\n          \"Add entities directly to Male list.\",\n          \"Filter out dummy beams.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Plan Angle (Male vs Female)\",\n      \"path1\": {\n        \"name\": \"Perpendicular (90°)\",\n        \"steps\": [\n          \"Keep user value for dHouseDepthSide.\",\n          \"Generate Side Housing on Female Beam.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Skewed / Not 90°\",\n        \"steps\": [\n          \"Report warning: 'The housing at the side cannot be created...'\",\n          \"Set dHouseDepthSide to 0.\",\n          \"Skip Side Housing on Female Beam.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Vertical Angle (Male vs Female)\",\n      \"path1\": {\n        \"name\": \"Vertical Plumb\",\n        \"steps\": [\n          \"Keep user value for dHouseDepthTop.\",\n          \"Generate Top Housing on Female Beam.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Skewed Vertically\",\n        \"steps\": [\n          \"Report warning: 'The housing at the top cannot be created...'\",\n          \"Set dHouseDepthTop to 0.\",\n          \"Skip Top Housing on Female Beam.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Cut Male Beam Property (sCutMaleBeam)\",\n      \"path1\": {\n        \"name\": \"Yes\",\n        \"steps\": [\n          \"Create Cut object at Female beam width.\",\n          \"Add to Male beam.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No\",\n        \"steps\": [\n          \"Do not add end cut.\",\n          \"Only add birdsmouth cuts.\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Beam Attachment Integrity\",\n      \"errorMessage\": \"|Beams are invalid. Instace deleted|\",\n      \"recovery\": \"Ensure the script instance is attached to exactly 2 valid GenBeams. Re-insert if necessary.\"\n    },\n    {\n      \"check\": \"Physical Intersection\",\n      \"errorMessage\": \"|Lost connection. Instance deleted|\",\n      \"recovery\": \"Ensure the Male beam physically passes through the volume of the Female beam. Move beams back together.\"\n    },\n    {\n      \"check\": \"Global Beam Angle (1° - 89°)\",\n      \"errorMessage\": \"|Beams should be in an angle of 1°-89°. Tool will be deleted|\",\n      \"recovery\": \"Rotate beams so they are not parallel (0°) or perpendicular (90°) to the ground plane within valid limits.\"\n    },\n    {\n      \"check\": \"Selection Count\",\n      \"errorMessage\": \"Internal filtering (No user error message, but beams ignored)\",\n      \"recovery\": \"Select at least one set of intersecting Male and Female beams. Parallel beams are automatically ignored.\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Modify Dimensions\",\n      \"how\": \"Properties Palette (OPM)\",\n      \"effect\": \"Updating Vertical Depth (A), Horizontal Depth (B), or Offset (C) recalculates the birdsmouth geometry immediately.\"\n    },\n    {\n      \"action\": \"Adjust Gaps\",\n      \"how\": \"Properties Palette (OPM)\",\n      \"effect\": \"Changing Side (D) or Bottom (E) gaps expands or contracts the cut volume in the Female beam.\"\n    },\n    {\n      \"action\": \"Toggle End Cut\",\n      \"how\": \"Properties Palette (OPM) -> Cut male beam dropdown\",\n      \"effect\": \"Switches between 'Yes' (adds vertical cut to rafter tail) and"
      },
      "tokens_used": 10941,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbHousedBirdsmouth\n\n## Overview\nCreates a housed birdsmouth joint between rafters (male beams) and purlins (female beams). It generates vertical and horizontal seats with configurable gaps and includes an option to trim the rafter end.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required for 3D geometry modification and beam cuts. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required entities**: Two intersecting `GenBeams` (one rafter, one purlin).\n- **Minimum beam count**: 2 beams that intersect physically.\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `hsbHousedBirdsmouth.mcr` from the file dialog.\n\n### Step 2: Select Rafters (Male Beams)\n```\nCommand Line: Select roofplane or beams\nAction: Select the rafters (male beams). You can also select a RoofPlane to extract all rafters automatically.\n```\n\n### Step 3: Select Purlins (Female Beams)\n```\nCommand Line: Select female beams as purlin\nAction: Select the purlins (female beams) that intersect the rafters.\n```\n\n### Step 4: Configure Properties\nAfter selection, the **Properties Palette** opens. Adjust dimensions and gaps as needed. The script automatically generates a joint instance for every valid intersection found.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Vertical Depth (A) | Number | 20 mm | Defines the depth of the vertical seat cut into the top of the purlin. Resets to 0 if beams are not vertically perpendicular. |\n| Horizontal Depth (B) | Number | 20 mm | Defines the depth of the horizontal notch cut into the side face of the purlin. Resets to 0 if beams are not at 90° in plan view. |\n| Offset Horizontal Cut (C) | Number | 5 mm | Vertical distance from the bottom of the birdsmouth tail up to the horizontal cut line. |\n| Side (D) | Number | 0.5 mm | Defines the gap for the housing at the sides of the purlin to allow for easier assembly. |\n| Bottom (E) | Number | 0 mm | Defines the gap at the bottom of the side housing cut. |\n| Cut male beam | Dropdown | No | If \"Yes\", adds a vertical saw cut to the rafter end at the opposite side of the female beam. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu options are available for this script. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Batch Processing**: To save time, select a RoofPlane in Step 2 instead of picking individual rafters.\n- **Perpendicular Requirements**: Ensure rafters and purlins are perpendicular (90°) in the plan view to enable the \"Horizontal Depth (B)\" side housing.\n- **Vertical Alignment**: If the \"Vertical Depth (A)\" is forcing itself to 0, check that the rafter and purlin are correctly aligned vertically.\n- **Global Angle**: The script will delete itself if the beams are nearly horizontal (0°) or vertical (90°) relative to the World XY plane. Ensure beams are angled between 1° and 89°.\n\n## FAQ\n- Q: Why is the \"Horizontal Depth (B)\" zero even though I entered a value?\n- A: The script automatically sets this to 0 if the rafters and purlins are not exactly perpendicular in the plan view.\n- Q: What happens if the script disappears immediately after insertion?\n- A: This usually means the beam intersection angle is outside the valid range (1° - 89° relative to the ground) or the beams are no longer intersecting. Check your geometry and try again."
      },
      "tokens_used": 6853,
      "error": null
    }
  }
}