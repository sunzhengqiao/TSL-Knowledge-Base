{
  "filename": "GE_WALL_CREATE_SLOPED_PLANES.mcr",
  "status": "completed",
  "total_tokens": 21077,
  "processing_time": 273.9332003593445,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "v1.2",
            "date": "15.ago.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Description added\n\t- Thumbnail added"
          },
          {
            "version": "v1.1",
            "date": "10.may.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Set red color to roof planes\n\t- Roof planes assigned to element group"
          },
          {
            "version": "v1.0",
            "date": "10.may.2012",
            "author": "David Rueda (dr@hsb-cad.com)",
            "changes": "Release"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4422,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates on Element entities using el.plEnvelope() and creates ERoofPlane geometry. There are no references to _Viewport, sd_ prefixes, or #Type E constructs typical of Paper Space or ShopDrawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space with at least one valid Element selected",
          "requiredSettings": []
        }
      },
      "tokens_used": 1881,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\n|Select elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "DimStyle",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2530,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates Roof Plane entities (ERoofPlane) based on the top surface envelope of selected wall elements.",
          "category": "Geometry/Envelope",
          "typicalUseCase": "Used when the user needs to convert the top face of a wall element into a specific 'Roof Plane' object for calculations, export, or visualization purposes, particularly when the wall represents a sloped roof structure."
        },
        "parameters": [
          {
            "name": "sDimStyle",
            "technicalDefault": "null",
            "businessMeaning": "Defines the visual style (text size, arrows, units) for dimensions. In this specific script, the parameter is defined in the properties but is not utilized in the geometric generation logic.",
            "validRange": "Any valid Dimension Style name present in the drawing",
            "unit": "String (Enumeration)",
            "affectsOutput": "None. The parameter is declared but not referenced in the calculation or creation of roof planes."
          }
        ],
        "parameterDependencies": [],
        "outputEntities": [
          {
            "type": "ERoofPlane",
            "description": "A planar geometric entity created by extruding the top edge of the element's envelope downwards by the element's width. It is colored red and assigned to Element Group 1.",
            "appliedTo": "Selected Wall Elements (Element)"
          }
        ]
      },
      "tokens_used": 4002,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts and checks _bOnInsert flag",
          "Verify insertion cycle count (insertCycleCount)",
          "Prompt user to select Elements (PrEntity)",
          "Store selected Elements in internal array",
          "Iterate through each selected Element",
          "Clone script instance for each Element (dbCreate)",
          "Erase the original 'manager' instance",
          "Cloned instance validates the assigned Element",
          "Extract Element geometric properties (Origin, Vectors, Width, Envelope)",
          "Iterate through vertices of the Element's envelope polyline",
          "Filter vertical faces using dot product with Element X-vector",
          "Filter horizontal faces using dot product with Element Y-vector",
          "Identify and skip the base face (bottom) of the Element",
          "Identify the top face to generate geometry",
          "Construct PLine for the Roof Plane by extruding top edge downwards by Element Width",
          "Create ERoofPlane entity (dbCreate)",
          "Set Roof Plane color to Red (Index 1)",
          "Assign Roof Plane to Element Group 1",
          "Erase script instance and finish"
        ],
        "conditionalBranches": [
          {
            "condition": "Is insertion cycle count > 1?",
            "path1": {
              "name": "Subsequent Cycle",
              "steps": [
                "Erase Instance",
                "Return (Exit)"
              ]
            },
            "path2": {
              "name": "First Cycle",
              "steps": [
                "Prompt for Entity Selection",
                "Process Element Set",
                "Clone Instances"
              ]
            }
          },
          {
            "condition": "Is the assigned Element valid?",
            "path1": {
              "name": "Invalid Element",
              "steps": [
                "Erase Instance",
                "Return (Exit)"
              ]
            },
            "path2": {
              "name": "Valid Element",
              "steps": [
                "Extract Geometry",
                "Generate Roof Planes"
              ]
            }
          },
          {
            "condition": "Is the envelope edge vertical? (Check X-vector dot product)",
            "path1": {
              "name": "Vertical Face",
              "steps": [
                "Skip edge (Continue loop)"
              ]
            },
            "path2": {
              "name": "Non-Vertical Edge",
              "steps": [
                "Proceed to check horizontal alignment"
              ]
            }
          },
          {
            "condition": "Is the face horizontal? (Check Y-vector dot product)",
            "path1": {
              "name": "Non-Horizontal",
              "steps": [
                "Skip edge (Implicit logic flow)"
              ]
            },
            "path2": {
              "name": "Horizontal Face",
              "steps": [
                "Check if Base or Top face"
              ]
            }
          },
          {
            "condition": "Is the horizontal face at the bottom (Base)?",
            "path1": {
              "name": "Base Face",
              "steps": [
                "Skip edge (Continue loop)"
              ]
            },
            "path2": {
              "name": "Top Face",
              "steps": [
                "Create ERoofPlane geometry"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Insertion cycle count",
            "errorMessage": "None (Silent)",
            "recovery": "N/A (Internal mechanism to prevent duplicate processing)"
          },
          {
            "check": "Element selection",
            "errorMessage": "None (Loop terminates if empty)",
            "recovery": "User must select at least one valid Element when prompted"
          },
          {
            "check": "Element validity (_Element[0].bIsValid())",
            "errorMessage": "None (Silent instance erase)",
            "recovery": "Ensure the linked Element entity exists in the drawing"
          },
          {
            "check": "Envelope geometry existence",
            "errorMessage": "Runtime error if envelope cannot be calculated",
            "recovery": "Ensure Element has valid 3D geometry (not degenerate)"
          }
        ],
        "postInsertionActions": [
          {
            "action": "None",
            "how": "N/A",
            "effect": "The script instance self-destructs (erases) immediately after generating the ERoofPlane entities. The resulting Roof Planes are static entities; they do not maintain a parametric link back to the script for modification via grips or properties."
          }
        ]
      },
      "tokens_used": 3995,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_WALL_CREATE_SLOPED_PLANES.mcr\n\n## Overview\nThis script generates Roof Plane entities (ERoofPlane) based on the top surface envelope of selected wall elements. It is typically used to define roof geometry for calculations or visualization when a wall element represents a sloped roof structure.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in Model Space where Element entities exist. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Not designed for manufacturing drawings. |\n\n## Prerequisites\n- **Required entities**: At least one valid Element (wall) entity in the drawing.\n- **Minimum beam count**: 0 (Beams are not processed, only Element envelopes).\n- **Required settings files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `GE_WALL_CREATE_SLOPED_PLANES.mcr` from the file dialog.\n\n### Step 2: Select Elements\n```\nCommand Line: |Select elements|\nAction: Click on one or more wall elements in the model and press Enter.\n```\n**Note**: The script will automatically process the selection and generate roof planes for each valid element.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| DimStyle | Dropdown | (None) | Defines the dimension style. **Note:** This parameter is currently defined but not used by the script logic. Changing this value will not affect the output. |\n\n## Right-Click Menu Options\nThis script does not add specific options to the right-click context menu.\n\n## Settings Files\nNo external settings files are required or used by this script.\n\n## Tips\n- **Visual Identification**: The generated Roof Planes are automatically colored **Red** and assigned to **Element Group 1** for easy filtering or selection later.\n- **Script Behavior**: The script instance will automatically erase itself from the drawing immediately after generating the roof planes. The resulting planes are static geometry and are not linked back to the script for future updates.\n- **Sloped Walls**: This tool is ideal for converting complex wall shapes (like gable ends or dormer cheeks) into roof planes for further processing.\n\n## FAQ\n- **Q: Why did the script disappear after I ran it?**\n  A: The script is designed to \"self-destruct\" after creating the geometry. The Roof Plane entities created are the intended output, and the script instance is no longer needed.\n- **Q: Why does changing the DimStyle property do nothing?**\n  A: While the DimStyle property appears in the properties palette, the current version of the script does not utilize it to generate dimensions or alter geometry. It can be safely ignored."
      },
      "tokens_used": 4247,
      "error": null
    }
  }
}