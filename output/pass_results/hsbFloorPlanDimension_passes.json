{
  "filename": "hsbFloorPlanDimension.mcr",
  "status": "completed",
  "total_tokens": 50688,
  "processing_time": 808.9851720333099,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "This tsl creates a floor plan dimensioning",
        "versionHistory": [
          {
            "version": "1.8",
            "date": "08dec2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-10023 bugfix log wall detection"
          },
          {
            "version": "1.7",
            "date": "07dec2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-9969 wall split references fixed"
          },
          {
            "version": "1.6",
            "date": "07dec2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-10023 log wall support added"
          },
          {
            "version": "1.5",
            "date": "20nov2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-9952 new strategies for inner and outer extreme wall connections"
          },
          {
            "version": "1.4",
            "date": "20nov2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-9664 strictly painter based, painter strategy stored in subMapX of painter"
          },
          {
            "version": "1.3",
            "date": "16nov2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-9664 group insertion support"
          },
          {
            "version": "1.2",
            "date": "13nov2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-9664 full painter support"
          },
          {
            "version": "1.1",
            "date": "12nov2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-9664 painter based definitions extended, new grouping of parallel connected walls"
          },
          {
            "version": "1.0",
            "date": "11nov2020",
            "author": "thorsten.huck@hsbcad.com",
            "changes": "HSB-9664 initial"
          }
        ],
        "settingsFiles": [
          "hsbFloorPlanDimension.xml"
        ],
        "dependencies": []
      },
      "tokens_used": 8623,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of _kModelSpace in tslDialog.dbCreate. Script operates on Element context (Wall) for floor plan dimensioning. No references to _kPaperSpace, _Viewport, sd_ prefixes, or ShopDrawing entities (#Type E)."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space containing Wall/Element objects",
          "requiredSettings": [
            "hsbFloorPlanDimension.xml",
            "PainterDefinition collection named 'PlanDimension'"
          ]
        }
      },
      "tokens_used": 7193,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"|Select additional floorplan dimensions|\",\n        \"condition\": \"_bOnRecalc && _kExecuteKey==sTriggerSetupDimensionGroup\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"getString\",\n        \"promptOriginal\": \"|Overwrite existing rule?| [|No|]/[|Yes|]\",\n        \"condition\": \"_bOnRecalc && _kExecuteKey==sTriggerSetupDimensionGroup && mapRule.length()>0\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"DynamicDialog\",\n      \"trigger\": \"Context Menu: Setup Dimension Group\",\n      \"title\": null,\n      \"dataSource\": \"Script Properties (Configuration, Association)\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    },\n    {\n      \"type\": \"DynamicDialog\",\n      \"trigger\": \"Context Menu: Set Strategy of Painter\",\n      \"title\": null,\n      \"dataSource\": \"Script Properties (Strategy)\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": \"nStringIndex++\",\n      \"variable\": \"sConfiguration\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Configuration|\",\n      \"defaultValue\": \"sConfigurationsDialog[0] (or |Default|)\",\n      \"inputType\": \"dropdown\",\n      \"options\": \"sConfigurationsDialog\",\n      \"category\": null,\n      \"description\": \"|Defines the name of a configuration|\"\n    },\n    {\n      \"index\": \"nStringIndex++\",\n      \"variable\": \"sAssociation\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Association|\",\n      \"defaultValue\": null,\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"|Interior Walls|\",\n        \"|Exterior Walls|\",\n        \"|Exterior and Interior Walls|\"\n      ],\n      \"category\": null,\n      \"description\": \"|Defines the name of a configuration|\"\n    },\n    {\n      \"index\": \"nStringIndex++\",\n      \"variable\": \"sStrategy\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Strategy|\",\n      \"defaultValue\": \"sNone or current strategy\",\n      \"inputType\": \"dropdown\",\n      \"options\": \"sStrategies (List of strategies including <|None|>)\",\n      \"category\": \"|General|\",\n      \"description\": \"|Defines the Strategy|\"\n    }\n  ],\n  \"contextMenu\": [\n    {\n      \"menuItem\": \"|Setup Dimension Group|\",\n      \"handler\": \"sTriggerSetupDimensionGroup\",\n      \"action\": \"Opens dialog to group and save dimension configurations\",\n      \"alsoTriggeredBy\": null\n    },\n    {\n      \"menuItem\": \"|Set Strategy of Painter| [Dynamic Name]\",\n      \"handler\": \"s"
      },
      "tokens_used": 10114,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 10483,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script initializes, reads constants, and loads persistent settings from 'hsbFloorPlanDimension.xml' via MapObject.",
          "Script checks for a specific execution trigger key (_kExecuteKey) to determine if a Context Menu action was requested.",
          "If _kExecuteKey matches 'Setup Dimension Group':",
          "User is prompted to select existing floorplan dimension instances (TslInst) via PrEntity.",
          "Selected instances are filtered and sorted by their perpendicular offset from the wall.",
          "A dynamic dialog is created (DialogMode=1) asking for a Configuration Name and Association (Interior/Exterior).",
          "Script checks if the specified Association already exists within the Configuration.",
          "If it exists, user is prompted via command line: 'Overwrite existing rule? [No]/[Yes]'.",
          "If confirmed (or new), the script saves the properties and offsets of the selected instances as a new Rule in the settings MapObject.",
          "If _kExecuteKey matches 'Set Strategy of Painter':",
          "A dynamic dialog is created (DialogMode=2) asking for a Strategy (e.g., 'Frame', 'Openings', 'Wall Connections').",
          "The selected strategy is saved into the 'subMapX' of the relevant PainterDefinition.",
          "If neither context menu trigger is active (Normal Insert/Recalc):",
          "Script validates/creates the 'PlanDimension' PainterDefinition collection, applying Log Wall filters if necessary.",
          "Script attempts to locate a host Wall (Element) or operate in Floor Detection mode.",
          "Script retrieves the active configuration and association rules from the loaded settings.",
          "Geometry (lines, markers, text) is generated based on the filtered entities and calculated positions.",
          "If _bOnJig is true, the visual representation updates dynamically as the user moves the cursor."
        ],
        "conditionalBranches": [
          {
            "condition": "Overwrite Existing Rule (During Setup Dimension Group)",
            "path1": {
              "name": "User declines overwrite (Input != Yes)",
              "steps": [
                "Script reports a cancellation message.",
                "Operation terminates without saving changes.",
                "Script triggers a second execution loop and returns."
              ]
            },
            "path2": {
              "name": "User accepts overwrite (Input == Yes) or Rule is new",
              "steps": [
                "Script constructs a Map containing the 'Request[]' of selected instances.",
                "Script updates the global settings MapObject with the new/updated Rule.",
                "Changes are persisted to the XML file.",
                "Script triggers a second execution loop and returns."
              ]
            }
          },
          {
            "condition": "Painter Definition Existence",
            "path1": {
              "name": "Painter collection 'PlanDimension' missing",
              "steps": [
                "Script detects missing collection.",
                "Script creates default PainterDefinitions in the TSL settings folder.",
                "Script updates filters to support Log Walls if detected."
              ]
            },
            "path2": {
              "name": "Painter collection exists",
              "steps": [
                "Script verifies version.",
                "Script may update filters if Log Wall support is required and missing."
              ]
            }
          },
          {
            "condition": "Execution Mode (DialogMode)",
            "path1": {
              "name": "DialogMode > 0",
              "steps": [
                "Script defines PropString properties for the OPM (Object Properties Manager).",
                "Script exits immediately to allow the OPM dialog to display."
              ]
            },
            "path2": {
              "name": "DialogMode == 0 (Normal execution)",
              "steps": [
                "Script proceeds to geometric calculation and generation."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Settings File Existence",
            "errorMessage": "Notice reported if installation XML version differs from current MapObject version.",
            "recovery": "Script automatically reads from installation path or company path. No specific user action required unless files are corrupted."
          },
          {
            "check": "Entity Selection (Setup Dimension Group)",
            "errorMessage": "None (User cancels PrEntity prompt).",
            "recovery": "Workflow terminates; script continues to next execution loop."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Save Dimension Configuration",
            "how": "Right-click Context Menu -> 'Setup Dimension Group'",
            "effect": "Allows grouping multiple dimension lines into a reusable named configuration (e.g., 'My House Exterior') with specific offsets and settings."
          },
          {
            "action": "Set Dimensioning Strategy",
            "how": "Right-click Context Menu -> 'Set Strategy of Painter'",
            "effect": "Changes the algorithm/filter used to determine what is dimensioned (e.g., switching between measuring wall frames vs. wall openings)."
          },
          {
            "action": "Modify Properties",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Change Configuration, Association, or Strategy settings directly via dropdowns if the script exposes them (dynamic properties)."
          }
        ]
      },
      "tokens_used": 8517,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbFloorPlanDimension.mcr\n\n## Overview\nThis script automates the creation of floor plan dimensions for timber construction. It supports intelligent detection of wall types (including log walls), allows grouping of dimension lines into reusable configurations, and offers various strategies for dimensioning frames, openings, and wall connections.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Dimensions are generated in the 3D model environment. |\n| Paper Space | No | Not designed for use in Layouts/Viewports. |\n| Shop Drawing | No | Not for use with hsbCAD Shop Drawing entities. |\n\n## Prerequisites\n- **Required Entities**: Wall Elements (`Element`) or Beams (`GenBeam`) must be present in the drawing.\n- **Required Settings**:\n  - `hsbFloorPlanDimension.xml` (Loaded automatically from Company or Install path).\n  - PainterDefinition collection named `PlanDimension` (Auto-generated if missing).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT`\nAction: Select `hsbFloorPlanDimension.mcr` from the file dialog and click **Open**.\n\n### Step 2: Insert and Position\nAction: Click in the drawing area to place the dimension lines, or select a Wall Element if prompted. The script will automatically detect surrounding walls and generate dimensions based on the default settings.\n\n### Step 3: Adjust Configuration (Optional)\nAction: Select the newly inserted dimension instance. Open the **Properties Palette** (Ctrl+1).\n- Change the **Configuration** to select a predefined setup (e.g., \"Exterior Walls\").\n- Change the **Association** to filter for Interior, Exterior, or Both.\n\n### Step 4: Create a Custom Configuration Group\n1.  Right-click on the script instance in the drawing.\n2.  Select **Setup Dimension Group** from the context menu.\n3.  **Command Line**: `Select additional floorplan dimensions`\n    Action: Click on existing dimension lines in the drawing to add them to the group. Press **Enter** to finish selection.\n4.  **Dialog**: Enter a name for the new **Configuration** (e.g., \"Ground Floor Ext\").\n5.  **Dialog**: Select an **Association** type (Interior, Exterior, or Both).\n6.  **Command Line**: If the configuration name already exists, `Overwrite existing rule? [No]/[Yes]`. Type `Y` and press **Enter** to overwrite, or `N` to cancel.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Options | Description |\n|-----------|------|---------|-------------|\n| Configuration | Dropdown | *Loaded from XML* | Selects a predefined dimension setup (e.g., specific wall offsets). |\n| Association | Dropdown | Interior Walls / Exterior Walls / Exterior and Interior Walls | Filters which walls are included in the dimension calculation. |\n| Strategy | Dropdown | *List of strategies (e.g., Frame, Openings, Wall Connections)* | Defines the logic used to generate dimensions (e.g., measure the frame vs measure the openings). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Setup Dimension Group** | Allows you to select existing dimension lines and save their current settings as a named Configuration in the XML file for future reuse. |\n| **Set Strategy of Painter** | Opens a dialog to change the dimensioning algorithm strategy for the current painter definition. |\n\n## Settings Files\n- **Filename**: `hsbFloorPlanDimension.xml`\n- **Location**: `hsbCompany` or `hsbInstall` directory.\n- **Purpose**: Stores user-defined Configurations, Associations, and offset rules. It also manages the PainterDefinitions used to filter walls.\n\n## Tips\n- **Log Wall Support**: The script automatically detects log walls (Version 1.6+) and adjusts filters accordingly.\n- **Grouping**: Use the **Setup Dimension Group** feature if you have multiple dimension lines at specific offsets (e.g., inner, outer, and opening dimensions) that you use repeatedly on different floors.\n- **Visual Feedback**: During insertion (`_bOnJig`), the dimensions will update dynamically as you move your cursor, allowing you to preview placement.\n\n## FAQ\n- **Q: The dimensions are not appearing on my walls.**\n  **A:** Check the **Association** property in the palette. Ensure it is set to \"Exterior and Interior Walls\" or matches the specific wall type you are trying to dimension. Also, verify the **Strategy** is not set to \"None\".\n- **Q: How do I change how far the dimension lines are from the wall?**\n  **A:** You must use the **Setup Dimension Group** feature. Select a dimension line at the desired distance, group it, and save it as a new Configuration.\n- **Q: Can I use this on log walls?**\n  **A:** Yes, the script includes support for log walls automatically (updated in v1.6). Ensure your `PlanDimension` painter filters are up to date."
      },
      "tokens_used": 5758,
      "error": null
    }
  }
}