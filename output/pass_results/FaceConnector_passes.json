{
  "filename": "FaceConnector.mcr",
  "status": "completed",
  "total_tokens": 54474,
  "processing_time": 294.10531401634216,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 1,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.1",
            "date": "06/09/2024",
            "author": "Marsel Nakuci",
            "changes": "HSB-20922: Fix when getting pt0Edge at \"getWallConnectionType\""
          },
          {
            "version": "1.0",
            "date": "26/06/2024",
            "author": "Marsel Nakuci",
            "changes": "HSB-20922: Initial"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8552,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses ElementWallSF entities and creates HardWrComp (Hardware Components) via _ThisInst.setHardWrComps(). It performs 3D geometric calculations (PlaneProfile intersections, PLine projections) on the element geometry. It does not contain sd_ prefixed functions, _Viewport checks, or #Type E entity iteration typical of Paper Space or Shop Drawing scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space containing two connected walls",
          "requiredSettings": [
            "TFPC Block located in _kPathHsbCompany\\Block"
          ]
        }
      },
      "tokens_used": 7594,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": -1,
            "variable": "sConnectionType",
            "type": "PropString",
            "displayName": "Unknown",
            "defaultValue": "Unknown",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": -1,
            "variable": "sDistribution",
            "type": "PropString",
            "displayName": "Unknown",
            "defaultValue": "Unknown",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": -1,
            "variable": "dOffsetBottom",
            "type": "PropDouble",
            "displayName": "Unknown",
            "defaultValue": "Unknown",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": -1,
            "variable": "dOffsetTop",
            "type": "PropDouble",
            "displayName": "Unknown",
            "defaultValue": "Unknown",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": -1,
            "variable": "dOffsetBetween",
            "type": "PropDouble",
            "displayName": "Unknown",
            "defaultValue": "Unknown",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": -1,
            "variable": "sSideParallelWalls",
            "type": "PropString",
            "displayName": "Unknown",
            "defaultValue": "Unknown",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": -1,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Unknown",
            "defaultValue": "Unknown",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": -1,
            "variable": "dTextHeight",
            "type": "PropDouble",
            "displayName": "Unknown",
            "defaultValue": "Unknown",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Swap Walls|",
            "handler": "|Swap Walls|",
            "action": "Swaps the two connected wall elements (_Element array indices 0 and 1) and recalculates.",
            "alsoTriggeredBy": null,
            "condition": "Visible only when walls are parallel (bParallel is true)."
          },
          {
            "menuItem": "|Flip Side|",
            "handler": "|Flip Side|",
            "action": "Inverts the 'vecSide' vector in the instance Map, effectively flipping the connection side, and recalculates.",
            "alsoTriggeredBy": null,
            "condition": "Visible only when walls are parallel (bParallel is true)."
          }
        ],
        "settingsFiles": [
          {
            "filename": "TFPC (Block)",
            "searchPaths": [
              "_kPathHsbCompany\\Block"
            ],
            "purpose": "Lookup for the hardware symbol block used for visualization.",
            "required": false
          }
        ]
      },
      "tokens_used": 10099,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically detects connections between two walls (Parallel or Corner) and distributes face connector hardware (TFPC) along the intersecting edge.",
          "category": "Hardware",
          "typicalUseCase": "Specifying and visualizing face connectors (like angle brackets or nails plates) where two walls meet, ensuring proper spacing and offsets from top/bottom plates."
        },
        "parameters": [
          {
            "name": "sConnectionType",
            "technicalDefault": "Unknown",
            "businessMeaning": "Specifies the geometric configuration of the connection (Parallel or Corner). The script attempts to auto-detect this based on wall orientation.",
            "validRange": "Parallel, Corner",
            "unit": "enum",
            "affectsOutput": "Determines the calculation logic for the intersection profile and valid insertion points for the hardware."
          },
          {
            "name": "sDistribution",
            "technicalDefault": "Unknown",
            "businessMeaning": "The strategy used to space multiple connectors along the vertical height of the wall.",
            "validRange": "Evenly, Start+End, MaxSpacing",
            "unit": "enum",
            "affectsOutput": "Calculates the specific Y-coordinates (vertical positions) for each connector instance."
          },
          {
            "name": "dOffsetBottom",
            "technicalDefault": "Unknown",
            "businessMeaning": "The required clearance distance from the bottom of the overlapping wall area to the center of the first connector.",
            "validRange": "0 - 500 mm",
            "unit": "mm",
            "affectsOutput": "Raises or lowers the bottom-most connector in the distribution array."
          },
          {
            "name": "dOffsetTop",
            "technicalDefault": "Unknown",
            "businessMeaning": "The required clearance distance from the top of the overlapping wall area to the center of the last connector.",
            "validRange": "0 - 500 mm",
            "unit": "mm",
            "affectsOutput": "Lowers the top-most connector in the distribution array."
          },
          {
            "name": "dOffsetBetween",
            "technicalDefault": "Unknown",
            "businessMeaning": "The vertical distance between the centers of two adjacent connectors.",
            "validRange": "300 - 1200 mm",
            "unit": "mm",
            "affectsOutput": "Controls the density of connectors; smaller values result in more hardware."
          },
          {
            "name": "sSideParallelWalls",
            "technicalDefault": "Unknown",
            "businessMeaning": "Selects which face of the parallel wall is used as the reference for the connector side (Reference vs Opposite).",
            "validRange": "Reference Side, Opposite Side",
            "unit": "enum",
            "affectsOutput": "Flips the connector vector to the other side of the wall sheathing line."
          },
          {
            "name": "dOffset",
            "technicalDefault": "Unknown",
            "businessMeaning": "Lateral offset of the connector symbol and hardware from the detected wall edge.",
            "validRange": "0 - 100 mm",
            "unit": "mm",
            "affectsOutput": "Moves the insertion point of the hardware away from or towards the wall edge."
          },
          {
            "name": "dTextHeight",
            "technicalDefault": "Unknown",
            "businessMeaning": "The height of the text annotation displaying the connector type and quantity (e.g., 'TFPC x 5').",
            "validRange": "2.5 - 10 mm",
            "unit": "mm",
            "affectsOutput": "Scales the text label in the plan view."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sSideParallelWalls",
            "effect": "Only applicable if the script detects the walls are Parallel. In Corner mode, the side is determined geometrically.",
            "cascade": [
              "sSideParallelWalls",
              "FlipSide context menu"
            ]
          },
          {
            "trigger": "sDistribution",
            "effect": "Determines which of the Offset parameters are active (e.g., MaxSpacing might ignore OffsetBetween).",
            "cascade": [
              "dOffsetBottom",
              "dOffsetTop",
              "dOffsetBetween"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "HardWrComp",
            "description": "Creates 'TFPC' hardware components representing the face connectors.",
            "appliedTo": "The two selected Wall elements."
          },
          {
            "type": "Text",
            "description": "Adds a label in plan view indicating the connector type and total quantity.",
            "appliedTo": "ModelSpace (annotation near the connection)."
          },
          {
            "type": "Block/VisualSymbol",
            "description": "Inserts a visual block (from _kPathHsbCompany\\Block) to represent the connector location in 3D.",
            "appliedTo": "The intersection point of the walls."
          }
        ]
      },
      "tokens_used": 9877,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script (Command: TSLCONTENT)",
          "2. Prompt User to Select 2 Wall Entities (ElementWallSF)",
          "3. Validate Entity Selection (Check for 2 valid walls)",
          "4. Analyze Geometric Relationship (Call getWallConnectionType)",
          "5. Branch: Detect Connection Type (Parallel vs Corner vs Error)",
          "6. Validate Geometry (Check distance < 100mm and Z-overlap area)",
          "7. [Parallel Path] Determine Side Vector (Reference/Opposite) and Add Context Menu Triggers",
          "8. [Corner Path] Determine Intersection Edge Points",
          "9. Calculate Distribution Points (Call distributePoints based on sDistribution strategy)",
          "10. Iterate through Calculated Points",
          "11. Generate Visual Representation (Insert TFPC Block/Draw Symbol)",
          "12. Create Hardware Component (HardWrComp via applyHardware)",
          "13. Create Annotation Text (Plan view label)",
          "14. Finish / Recalculate on Property Change"
        ],
        "conditionalBranches": [
          {
            "condition": "Geometric relationship between selected walls (getWallConnectionType)",
            "path1": {
              "name": "Parallel Walls",
              "steps": [
                "Check if wall vectors are parallel (vx0 // vx1)",
                "Verify distance between walls is < 100mm",
                "Verify Z-overlap area exists (> 1mm^2)",
                "Determine 'vecSide' based on 'sSideParallelWalls' property (Reference vs Opposite)",
                "Add context menu items: 'Swap Walls' and 'Flip Side'",
                "Calculate insertion points along common Z-range"
              ]
            },
            "path2": {
              "name": "Corner Walls",
              "steps": [
                "Check if wall vectors are perpendicular (vx0 // vz1)",
                "Identify Male/Female relationship (using findMaleFemaleAt2Walls logic implicitly or explicitly)",
                "Determine intersection edge point (pt0Edge)",
                "Calculate insertion points along edge"
              ]
            },
            "path3": {
              "name": "Invalid Configuration",
              "steps": [
                "Set Error flag in Map",
                "Report specific error message (e.g., 'Only parallel and corner connected walls supported')",
                "Erase Instance",
                "Abort"
              ]
            }
          },
          {
            "condition": "Distribution Strategy (sDistribution property)",
            "path1": {
              "name": "Evenly",
              "steps": [
                "Calculate N points based on fixed quantity logic",
                "Space points equally between Top and Bottom offsets"
              ]
            },
            "path2": {
              "name": "Start+End",
              "steps": [
                "Place first point at dOffsetBottom",
                "Place last point at dOffsetTop",
                "Distribute remaining points in between"
              ]
            },
            "path3": {
              "name": "MaxSpacing",
              "steps": [
                "Start at dOffsetBottom",
                "Add points at intervals of dOffsetBetween until reaching dOffsetTop"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Count and Type",
            "errorMessage": "findMaleFemaleAt2Walls: 2 walls needed",
            "recovery": "User must select exactly two valid ElementWallSF entities."
          },
          {
            "check": "Wall Alignment",
            "errorMessage": "getWallConnectionType: Only parallel and corner connected walls supported",
            "recovery": "User must ensure walls are either Parallel or Perpendicular (Corner)."
          },
          {
            "check": "Wall Proximity (Parallel)",
            "errorMessage": "getWallConnectionType: Walls too far apart, connection not possible",
            "recovery": "Move walls closer together (must be within 100mm)."
          },
          {
            "check": "Vertical Overlap",
            "errorMessage": "getWallConnectionType: no common area in height",
            "recovery": "Adjust wall heights so they share a common Z-range."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties",
            "how": "OPM (AutoCAD Properties Palette)",
            "effect": "Changing offsets (Bottom/Top/Between), Distribution strategy, or Side triggers a recalculation, moving hardware and updating quantity."
          },
          {
            "action": "Swap Walls",
            "how": "Right-click Context Menu (Parallel only)",
            "effect": "Swaps the index of the two selected walls in the internal array and recalculates."
          },
          {
            "action": "Flip Side",
            "how": "Right-click Context Menu (Parallel only)",
            "effect": "Inverts the 'vecSide' vector, moving the connectors from the Reference side to the Opposite side (or vice versa)."
          }
        ]
      },
      "tokens_used": 11814,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# FaceConnector.mcr\n\n## Overview\nAutomatically detects connections between two walls (Parallel or Corner) and distributes face connector hardware (TFPC) along the intersecting edge.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used in 3D model to place hardware on walls. |\n| Paper Space | No | Not designed for layout views. |\n| Shop Drawing | No | Not designed for manufacturing details. |\n\n## Prerequisites\n- **Required Entities**: Two `ElementWallSF` (Wall) entities.\n- **Minimum Beam Count**: 2 Walls.\n- **Required Settings**: `TFPC` Block located in `_kPathHsbCompany\\Block`.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `FaceConnector.mcr` from the list.\n\n### Step 2: Select Walls\n```\nCommand Line: Select entities:\nAction: Select the two walls you wish to connect and press Enter.\n```\n*Note: The script automatically detects if the walls are Parallel or Corner connected.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| sConnectionType | dropdown | Unknown | Sets the geometric configuration (Parallel or Corner). Usually auto-detected. |\n| sDistribution | dropdown | Unknown | Strategy for spacing connectors: Evenly, Start+End, or MaxSpacing. |\n| dOffsetBottom | number | Unknown | Clearance from the bottom of the wall overlap to the first connector center (mm). |\n| dOffsetTop | number | Unknown | Clearance from the top of the wall overlap to the last connector center (mm). |\n| dOffsetBetween | number | Unknown | Vertical distance between centers of adjacent connectors (mm). |\n| sSideParallelWalls | dropdown | Unknown | Selects the face of the wall for connectors: Reference Side or Opposite Side (Parallel only). |\n| dOffset | number | Unknown | Lateral offset of the connector from the wall edge (mm). |\n| dTextHeight | number | Unknown | Height of the annotation text label (mm). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Swap Walls | Swaps the two selected wall elements (Available only for Parallel connections). |\n| Flip Side | Flips the connection side to the opposite face of the wall (Available only for Parallel connections). |\n\n## Settings Files\n- **Filename**: `TFPC` (Block)\n- **Location**: `_kPathHsbCompany\\Block`\n- **Purpose**: Provides the visual symbol block for the connector in the model.\n\n## Tips\n- Ensure the two walls have a common vertical (Z) overlap, or the script will fail with \"no common area in height\".\n- For parallel walls, ensure they are close enough (distance < 100mm) to be recognized as connected.\n- Use the **Swap Walls** context menu item if the script detects the connection but applies it to the wrong side of the geometry.\n\n## FAQ\n- **Q: Why does the script report \"Only parallel and corner connected walls supported\"?**\n  A: The script only works if walls are perfectly Parallel or Perpendicular (Corner). Check your wall alignments.\n- **Q: Why are no connectors appearing?**\n  A: Check that the vertical overlap between walls is sufficient and that the `dOffsetBottom` and `dOffsetTop` values do not exceed the wall height.\n- **Q: How do I change the spacing of the connectors?**\n  A: Select the script instance in the model, open the Properties Palette, and change the `sDistribution` strategy or modify the `dOffsetBetween` value."
      },
      "tokens_used": 6538,
      "error": null
    }
  }
}