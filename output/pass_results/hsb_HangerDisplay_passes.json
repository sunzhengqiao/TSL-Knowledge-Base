{
  "filename": "hsb_HangerDisplay.mcr",
  "status": "completed",
  "total_tokens": 49073,
  "processing_time": 868.472571849823,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9191,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script starts with 'hsb_' prefix (not sd_ or Multipage). Uses getBeam and PrEntity for user input during _bOnInsert, which is characteristic of Model Space insertion. Manipulates 3D entities (Beam, TrussEntity) directly using methods like .quader(), .coordSys(), and transforms 3D Body objects. Uses assignToElementGroup and exportToDxi, which are typical for model/production scripts."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam",
            "TrussEntity"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": [
            "Map structure 'HANGER' within _Map (usually injected by parent script hsb_Hanger.mcr)",
            "HsbBOM configuration"
          ]
        }
      },
      "tokens_used": 6827,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect male beams",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getBeam",
              "promptOriginal": "\nSelect female beam",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sModel",
            "type": "PropString",
            "displayName": "Model",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "Populated from sModels array (HANGER map)"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDimLayout",
            "type": "PropString",
            "displayName": "Dim Style",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "Populated from _DimStyles"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strDisplay",
            "type": "PropString",
            "displayName": "Display Model",
            "defaultValue": "Short Model",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes",
              "Short Model"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "strAltModel",
            "type": "PropString",
            "displayName": "Draw alt solid",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dTextHeight",
            "type": "PropDouble",
            "displayName": "Text Height",
            "defaultValue": "-1",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Invert Hanger",
            "handler": "strInvertHanger",
            "action": "Toggles the 'IsInverted' map entry boolean value.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7028,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Displays a parametric metal hanger plate at a T-connection between beams, manages its representation in the model, and exports hardware/BOM data.",
          "category": "Hardware/Connection",
          "typicalUseCase": "Used to visualize a specific hanger model (defined in a parent script or imported from IFC) that connects a male beam to a female beam, ensuring correct labeling and data export for production."
        },
        "parameters": [
          {
            "name": "sModel",
            "technicalDefault": "First entry in sModels array",
            "businessMeaning": "Selects the specific hanger part number or configuration to display. This determines the geometry, size, and article number used for BOMs.",
            "validRange": "List of available hanger models (strings) populated by the parent script.",
            "unit": "String",
            "affectsOutput": "Determines the 3D geometry of the plate, the text label, and the Article Number in Hardware/BOM exports."
          },
          {
            "name": "sDimLayout",
            "technicalDefault": "Current DimStyle",
            "businessMeaning": "Sets the CAD dimension style used for the hanger's visual representation and text labels.",
            "validRange": "Available AutoCAD/hsbCAD dimension styles",
            "unit": "String",
            "affectsOutput": "Changes the appearance (font, arrow size, etc.) of dimensions and text associated with the hanger."
          },
          {
            "name": "strDisplay",
            "technicalDefault": "Short Model",
            "businessMeaning": "Controls what text label is displayed next to the hanger in the model.",
            "validRange": "No, Yes, Short Model",
            "unit": "Enumeration",
            "affectsOutput": "If 'Yes', displays the full Model Name. If 'Short Model', displays the Type/Category. If 'No', hides the text label."
          },
          {
            "name": "dTextHeight",
            "technicalDefault": "-1",
            "businessMeaning": "Overrides the default text height for the hanger label.",
            "validRange": "Positive numbers (mm) or -1 (use style default).",
            "unit": "mm",
            "affectsOutput": "Scales the size of the text label. Also influences the vertical offset of the text position."
          },
          {
            "name": "strAltModel",
            "technicalDefault": "Depends on import validity (Yes if invalid body)",
            "businessMeaning": "Toggles the drawing of an alternative solid representation.",
            "validRange": "No, Yes",
            "unit": "Boolean",
            "affectsOutput": "Forces the display of a simplified or alternative geometry instead of (or in addition to) the standard detailed body. Often used when detailed geometry fails or for performance."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing 'sModel'",
            "effect": "Updates the internal 'mpHanger' map data, which triggers a regeneration of the 3D body and updates the Hardware Component and BOM data.",
            "cascade": [
              "Geometry",
              "Hardware/BOM"
            ]
          },
          {
            "trigger": "Context Menu 'Invert Hanger'",
            "effect": "Toggles the 'IsInverted' boolean in the map.",
            "cascade": [
              "Geometry Orientation"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Body (3D Model)",
            "description": "A solid 3D representation of the metal hanger plate, constructed from faces defined in the HANGER map or imported geometry.",
            "appliedTo": "Model Space (at the connection point between Male and Female beams)."
          },
          {
            "type": "HardWrComp",
            "description": "Hardware component entry defining the Article Number (Model), Description, Quantity, and Material for exports.",
            "appliedTo": "TSL Instance (for BOMs/CNC)."
          },
          {
            "type": "ElemItem",
            "description": "Element item linking the hanger to the structural element for production reports (labels, list outputs).",
            "appliedTo": "The Element containing the connected beams."
          },
          {
            "type": "Text Label",
            "description": "Annotation text displaying the Model Name or Type, positioned relative to the hanger.",
            "appliedTo": "Model Space."
          }
        ]
      },
      "tokens_used": 9335,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Initialization: Check for 'HANGER' map structure within _Map.\",\n    \"2. [Branch] If 'HANGER' map is missing, check for Import Data (source\\\\body).\",\n    \"3. [Branch] If no Import Data found, Erase Instance and Exit.\",\n    \"4. [Branch] If Import Data found, Reconstruct Hanger Map from source properties and geometry.\",\n    \"5. Define Properties: Populate Model list, DimStyles, and Display options (Text Height, Alt Solid).\",\n    \"6. [If _bOnInsert] Prompt User: Select Male Beams (PrEntity).\",\n    \"7. [If _bOnInsert] Prompt User: Select Female Beam (getBeam).\",\n    \"8. [If _bOnInsert & Invalid Female] Erase Instance and Exit.\",\n    \"9. [If _bOnRecalc] Check Context Menu: Handle 'Invert Hanger' command.\",\n    \"10. Entity Retrieval: Get Male and Female entities from _Map (Handle Beams and Trusses separately).\",\n    \"11. Geometry Calculation: Compute bounding quaders and connection coordinate system.\",\n    \"12. [Branch] Geometry Generation: Select between 'SimpleBody', Extruded 'Faces', or Alternative Solid.\",\n    \"13. Visualization: Draw 3D Body and Text Label (Model Name or Type).\",\n    \"14. Data Export: Update Hardware Components (HardWrComp), Element Items (ElemItem), and DXI.\",\n    \"15. Script Finish: Set instance properties (disable grips, set compare key).\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Data Source on Startup\",\n      \"path1\": {\n        \"name\": \"Standard Parent Script\",\n        \"steps\": [\n          \"Retrieve 'HANGER' map directly from _Map.\",\n          \"Populate property lists from map keys.\",\n          \"Proceed to display.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"IFC / Import Scenario\",\n        \"steps\": [\n          \"Detect missing 'HANGER' map but presence of 'source\\\\body'.\",\n          \"Set External flag to 2.\",\n          \"Extract Model, Supplier, and Type from Instance Description fields.\",\n          \"Validate 'SimpleBody' or fallback to 'csgitems' BREP loops.\",\n          \"Construct 'HANGER' map manually.\",\n          \"Proceed to display.\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"Orphaned Instance\",\n        \"steps\": [\n          \"Detect no Map and no Import Data.\",\n          \"Execute eraseInstance().\",\n          \"Stop execution.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Entity Type Processing\",\n      \"path1\": {\n        \"name\": \"Standard Beam\",\n        \"steps\": [\n          \"Cast entity to Beam.\",\n          \"Retrieve standard Quader and CoordSys.\",\n          \"Add to geometry calculation arrays.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Truss Entity\",\n        \"steps\": [\n          \"Cast entity to TrussEntity.\",\n          \"Retrieve or Generate Truss Definition.\",\n          \"Calculate Bounding Quader from Definition Entities (complex logic: collect vertices, order them, calc dimensions).\",\n          \"Transform Quader to Truss CoordSys.\",\n          \"Add to geometry calculation arrays.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Geometry Construction Method\",\n      \"path1\": {\n        \"name\": \"SimpleBody\",\n        \"steps\": [\n          \"Check map for 'SimpleBody'.\",\n          \"Transform Body to local coordinate system.\",\n          \"Draw Body.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Constructed Faces\",\n        \"steps\": [\n          \"Iterate through 'Faces' map entries.\",\n          \"Generate Polylines (PLines) from face data.\",\n          \"Create PlaneProfiles.\",\n          \"Extrude profiles to create Body Parts.\",\n          \"Combine parts into final Body.\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Map Existence\",\n      \"errorMessage\": \"None (Silent exit)\",\n      \"recovery\": \"Ensure script is inserted by parent hsb_Hanger.mcr or valid Import data exists in _Map.\"\n    },\n    {\n      \"check\": \"Female Beam Validity (during Insert)\",\n      \"errorMessage\": \"None (Silent exit)\",\n      \"recovery\": \"User must select a valid beam entity during the 'Select female beam' prompt.\"\n    },\n    {\n      \"check\": \"Imported Body Validity\",\n      \"errorMessage\": \"None ("
      },
      "tokens_used": 11049,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_HangerDisplay.mcr\n\n## Overview\nDisplays a parametric metal hanger plate at a T-connection between beams. This script manages the 3D visualization, text labeling, and exports hardware data (BOM) for production.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used to place and visualize hangers in the 3D model. |\n| Paper Space | No | Not intended for 2D layouts. |\n| Shop Drawing | No | Not used for generating shop drawings directly. |\n\n## Prerequisites\n- **Required Entities:** At least 2 Beams or TrussEntities (typically intersecting).\n- **Minimum Beams:** 2 (One \"female\" support beam and one or more \"male\" intersecting beams).\n- **Required Settings:** The script usually requires a \"HANGER\" map structure injected by a parent script (e.g., `hsb_Hanger.mcr`) or valid IFC import data to function correctly.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_HangerDisplay.mcr`\n*(Note: This script is typically launched automatically by a parent script, but can be run manually if data is pre-configured).*\n\n### Step 2: Select Male Beams\n```\nCommand Line: Select male beams\nAction: Click on the beams that are resting on or intersecting the main support beam. Press Enter when finished.\n```\n\n### Step 3: Select Female Beam\n```\nCommand Line: Select female beam\nAction: Click on the main beam that supports the hanger.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Model | dropdown | (From Map) | Selects the specific hanger part number or configuration (geometry and BOM data). |\n| Dim Style | dropdown | Current Style | Sets the dimension style used for the hanger's visual labels. |\n| Display Model | dropdown | Short Model | Controls the text label next to the hanger: \"No\", \"Yes\" (Full Name), or \"Short Model\" (Type only). |\n| Draw alt solid | dropdown | No | If \"Yes\", draws a simplified solid geometry. Useful if the detailed geometry fails to generate. |\n| Text Height | number | -1 | Overrides the text height for the label. Set to -1 to use the default style height. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Invert Hanger | Flips the orientation of the hanger 180 degrees. Use this if the plate is facing the wrong direction relative to the beam. |\n\n## Settings Files\n- **Dependency**: `hsb_Hanger.mcr` (Parent Script)\n- **Location**: TSL Catalog\n- **Purpose**: This display script typically relies on the parent script `hsb_Hanger.mcr` to calculate the connection details and inject the \"HANGER\" map (containing geometry and product data) into this script. It does not usually use a standalone XML configuration file.\n\n## Tips\n- **Manual Insertion:** If inserting manually, ensure the \"HANGER\" map data exists or the script may erase itself immediately.\n- **Geometry Issues:** If the hanger looks incorrect or missing, try setting **Draw alt solid** to \"Yes\" in the properties to force a simplified representation.\n- **Text Visibility:** Set **Display Model** to \"Short Model\" to keep the drawing clean while still identifying the part type.\n\n## FAQ\n- **Q: Why does the script disappear immediately after I select the beams?**\n  **A:** The script requires specific configuration data (a \"HANGER\" map) to generate the geometry. If run manually without this data (usually provided by a parent script), it will automatically erase itself.\n- **Q: How do I change the hanger size or type?**\n  **A:** Select the hanger in the model, open the Properties palette (Ctrl+1), and change the **Model** dropdown to a different part number.\n- **Q: The text label is too large/small. How do I fix it?**\n  **A:** Change the **Text Height** property to a specific value (in mm) or ensure it is set to -1 to respect your current CAD text style settings."
      },
      "tokens_used": 5643,
      "error": null
    }
  }
}