{
  "filename": "HSB_E-EdgeInformation.mcr",
  "status": "completed",
  "total_tokens": 49758,
  "processing_time": 512.3360481262207,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "20.06.2017",
            "author": "AS",
            "changes": "Pilot version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8292,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicitly creates instances using dbCreate(..., _kModelSpace, ...). Interacts directly with Element types (ElementWallSF, ElementRoof). Uses Display dp() with elemZone() for 3D model drawing. No _Viewport or sd_ prefixes found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (Must be attached to an Element)",
          "requiredSettings": []
        }
      },
      "tokens_used": 6636,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getElement",
              "promptOriginal": "Select an element",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrPoint",
              "promptOriginal": "Select edge<optional>",
              "condition": "_bOnInsert",
              "required": false
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnInsert (if _kExecuteKey is empty or invalid)",
            "title": null,
            "dataSource": "Properties defined in script (showDialog)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "detailName",
            "type": "PropString",
            "displayName": "Detail name",
            "defaultValue": "@(VAR60)",
            "inputType": "text",
            "options": [],
            "category": "Edge Information",
            "description": null
          },
          {
            "index": 1,
            "variable": "sDescription",
            "type": "PropString",
            "displayName": "Description",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Edge Information",
            "description": null
          },
          {
            "index": 2,
            "variable": "sExtraDescription",
            "type": "PropString",
            "displayName": "Extra description",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Edge Information",
            "description": null
          },
          {
            "index": 3,
            "variable": "sExtraDescription2",
            "type": "PropString",
            "displayName": "Extra description 2",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Edge Information",
            "description": null
          },
          {
            "index": 4,
            "variable": "sExtraDescription3",
            "type": "PropString",
            "displayName": "Extra description 3",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Edge Information",
            "description": null
          },
          {
            "index": 5,
            "variable": "sExtraDescription4",
            "type": "PropString",
            "displayName": "Extra description 4",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Edge Information",
            "description": null
          },
          {
            "index": 2,
            "variable": "offsetFromEdge",
            "type": "PropDouble",
            "displayName": "Offset from edge",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "Position and Style",
            "description": null
          },
          {
            "index": 1,
            "variable": "horizontalOffset",
            "type": "PropDouble",
            "displayName": "Horizontal text offset",
            "defaultValue": "U(0)",
            "inputType": "number",
            "options": [],
            "category": "Position and Style",
            "description": null
          },
          {
            "index": 0,
            "variable": "textSize",
            "type": "PropDouble",
            "displayName": "Text size",
            "defaultValue": "U(-1)",
            "inputType": "number",
            "options": [],
            "category": "Position and Style",
            "description": null
          },
          {
            "index": 0,
            "variable": "textColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": -1,
            "inputType": "number",
            "options": [],
            "category": "Position and Style",
            "description": null
          },
          {
            "index": 6,
            "variable": "sHorizontalTextAlignment",
            "type": "PropString",
            "displayName": "Horizontal text alignment",
            "defaultValue": "Left",
            "inputType": "dropdown",
            "options": [
              "Left",
              "Right",
              "Center"
            ],
            "category": "Position and Style",
            "description": null
          },
          {
            "index": 7,
            "variable": "onlyVisibleInTopViewProp",
            "type": "PropString",
            "displayName": "Visible on top view only",
            "defaultValue": "Yes",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Position and Style",
            "description": null
          },
          {
            "index": 8,
            "variable": "sZoneLayer",
            "type": "PropString",
            "displayName": "Assign to layer",
            "defaultValue": "Tooling",
            "inputType": "dropdown",
            "options": [
              "Tooling",
              "Information",
              "Zone",
              "Element"
            ],
            "category": "Position and Style",
            "description": null
          },
          {
            "index": 1,
            "variable": "nZnIndex",
            "type": "PropInt",
            "displayName": "Zone index",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              "0",
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9"
            ],
            "category": "Position and Style",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 8224,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Annotates timber element edges (walls/roofs) with customizable text labels, such as connection types or construction notes, directly in the 3D model.\",\n    \"category\": \"ShopDrawing / Annotation\",\n    \"typicalUseCase\": \"Labeling specific wall edges with construction detail names (e.g., 'Corner Type A') or instructions to ensure clarity in production drawings and floor plans.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"detailName\",\n      \"technicalDefault\": \"@(VAR60)\",\n      \"businessMeaning\": \"The primary label or tag for the edge detail. It can be a static text string or a dynamic variable token (e.g., @(VAR60)) that reads data from the element's edge construction attributes.\",\n      \"validRange\": \"String or Variable Token (e.g., @(VAR1-99))\",\n      \"unit\": \"text\",\n      \"affectsOutput\": \"Updates the text displayed on the edge and writes to the Element's MapX 'Details' list.\"\n    },\n    {\n      \"name\": \"sDescription\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Additional descriptive text to provide more context about the edge detail.\",\n      \"validRange\": \"String\",\n      \"unit\": \"text\",\n      \"affectsOutput\": \"Adds a second line of text below the detail name.\"\n    },\n    {\n      \"name\": \"sExtraDescription\",\n      \"technicalDefault\": \"\",\n      \"businessMeaning\": \"Supplementary text line for further specifications.\",\n      \"validRange\": \"String\",\n      \"unit\": \"text\",\n      \"affectsOutput\": \"Adds a third line of text.\"\n    },\n    {\n      \"name\": \"sExtraDescription2\",\n      \"technicalDefault\":"
      },
      "tokens_used": 10631,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script starts.",
          "Check if Element is deleted; if yes, erase instance.",
          "Define Properties (Text strings, offsets, style settings).",
          "Check Insert State (_bOnInsert):",
          "  Check Cycle Count: If > 1, erase instance and exit (Prevent re-entry).",
          "  Check Execute Key (_kExecuteKey):",
          "    If Execute Key is invalid/empty: Show Dynamic Dialog (User inputs settings).",
          "  Save current properties as catalog '_LastInserted'.",
          "  User prompts: Select an Element.",
          "  Analyze Element Geometry (Wall or Roof) to extract edges and construction details.",
          "  User prompt: Select Edge <Optional> (Determines placement position).",
          "  Calculate insertion geometry (Lines, Grip points) based on selection.",
          "  Create new TSL instance(s) using dbCreate (The 'real' script instances).",
          "  Resolve 'Detail Name' if it contains a variable token (e.g., @(VAR60)) using the edge's construction detail map.",
          "  Erase the temporary 'Insert Helper' instance and exit.",
          "Else (Running on the created instance):",
          "  Validate Input: If no Element attached, report warning and erase.",
          "  Check Map for 'ManualInserted' flag to load properties from '_LastInserted' catalog.",
          "  Validate Grip Points: If none found, report warning and erase.",
          "  Coordinate Management: Calculate/Restore Grip points and Text anchor point (_Pt0) from Map or input geometry.",
          "  Check DSP Integration: If 'DspToTsl' argument exists in Map, extract Detail info and update properties accordingly.",
          "  Final Coordinate Setup: Determine coordinate system (vX, vY, vZ) for text display.",
          "  Build Text List: Compile description strings and detail name.",
          "  Draw Geometry: Display text in 3D model using calculated position and style (elemZone).",
          "  Publish Data: Store position, normal, and text info in the TSL's internal Map.",
          "  Update Element Data: Append current detail name to Element's MapX 'Details' list."
        ],
        "conditionalBranches": [
          {
            "condition": "Element Type (Wall vs. Roof)",
            "path1": {
              "name": "Element is Wall (ElementWallSF)",
              "steps": [
                "Get element envelope (outline).",
                "Iterate through outline vertices to create edge segments.",
                "Construction details are initially empty strings for walls."
              ]
            },
            "path2": {
              "name": "Element is Roof (ElementRoof)",
              "steps": [
                "Get specific roof edges (ElemRoofEdge).",
                "Extract geometry (nodes) and construction detail string directly from the roof edge object."
              ]
            }
          },
          {
            "condition": "Detail Name Content (Static vs. Variable Token)",
            "path1": {
              "name": "Static Text",
              "steps": [
                "Use the string value directly from properties.",
                "Display text and write to Element MapX."
              ]
            },
            "path2": {
              "name": "Variable Token (e.g., @(VAR60))",
              "steps": [
                "Parse index from token.",
                "Lookup corresponding DVAR or STRVAR in the Edge's Construction Detail Map.",
                "If found, replace token with resolved value.",
                "Display resolved value.",
                "If not found, leave token unresolved."
              ]
            }
          },
          {
            "condition": "Horizontal Text Alignment",
            "path1": {
              "name": "Left or Right",
              "steps": [
                "Calculate text alignment offset (dxFlag = 1 or -1).",
                "Check Element vector direction to ensure text readability (flip if upside down)."
              ]
            },
            "path2": {
              "name": "Center",
              "steps": [
                "Set alignment offset to 0.",
                "Center text relative to the anchor point."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": "Invalid or no element selected.",
            "recovery": "Script erases itself. User must re-run script and select a valid timber element."
          },
          {
            "check": "Cycle Count during Insert",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases itself immediately to prevent recursive insertion loops."
          },
          {
            "check": "Detail Map Conversion",
            "errorMessage": "Could not convert detail string to map.",
            "recovery": "Script reports warning, erases instance. User should check the edge's construction detail definition in the hsbCAD catalogs."
          },
          {
            "check": "DSP Variable Resolution",
            "errorMessage": "Catalog specified in [Detail Description] at VAR[X] not found at element [Number].",
            "recovery": "Script erases instance. User must ensure the specific variable index exists in the element's edge detail mapping."
          },
          {
            "check": "Grip Points Availability",
            "errorMessage": "No grippoints found. TSL Will be erased",
            "recovery": "Script erases instance. Indicates a geometry processing failure during the initial insertion phase."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Text Content",
            "how": "OPM (Object Properties Palette) / Properties",
            "effect": "Updates the displayed text lines immediately. If 'Detail Name' is changed, it also updates the Element's MapX 'Details' list."
          },
          {
            "action": "Adjust Position",
            "how": "Grip Edit (Drag Grips)",
            "effect": "Moving the Text Anchor (_Pt0) moves the label. Moving the Edge Grip points (_PtG) redefines the reference edge line."
          },
          {
            "action": "Offset from Edge",
            "how": "OPM Property 'Offset from edge'",
            "effect": "Moves the text label perpendicularly away or towards the selected edge line."
          },
          {
            "action": "Change Style",
            "how": "OPM Properties (Text size, Color, Alignment, Layer)",
            "effect": "Updates the visual appearance of the label in the model and shop drawings. Changing Layer/Zone affects export filters."
          }
        ]
      },
      "tokens_used": 9707,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-EdgeInformation\n\n## Overview\nThis script annotates the edges of timber elements (walls or roofs) with customizable text labels directly in the 3D model. It is typically used to display construction details, connection types, or notes that are linked to the element's edge properties.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script attaches to elements in the 3D model. |\n| Paper Space | No | Not intended for use in Paper Space layouts. |\n| Shop Drawing | No | Displays in the model; visibility depends on view settings. |\n\n## Prerequisites\n- **Required Entities**: An existing Wall (`ElementWallSF`) or Roof (`ElementRoof`) element.\n- **Minimum Beams**: N/A (Script works on Elements, not individual beams).\n- **Required Settings**: None required (Standard hsbCAD catalogs for Element Details are used if variables are referenced).\n\n## Usage Steps\n\n### Step 1: Launch Script\n```\nCommand: TSLINSERT\nAction: Browse and select HSB_E-EdgeInformation.mcr\n```\n\n### Step 2: Configure Settings (Dialog)\n```\nDialog: Dynamic Properties Dialog\nAction:\n1. Enter the primary label text (e.g., \"Connection A\" or a variable like @(VAR60)).\n2. Add optional descriptions in the provided fields.\n3. Adjust text size, layer, and offset settings as needed.\n4. Click OK to confirm.\n```\n\n### Step 3: Select Element\n```\nCommand Line: Select an element\nAction: Click on the Wall or Roof element you wish to annotate.\n```\n\n### Step 4: Select Edge\n```\nCommand Line: Select edge<optional>\nAction: Click on the specific edge line where the label should appear. \nNote: If you press Enter without selecting, the script will attempt to calculate a default position.\n```\n\n## Properties Panel Parameters\n\n### Edge Information\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Detail name | Text | @(VAR60) | The main label text. Can be static text or a dynamic variable token (e.g., @(VAR60)) that reads data from the element's edge attributes. |\n| Description | Text | (Empty) | Additional descriptive text appearing below the detail name. |\n| Extra description | Text | (Empty) | Supplementary text line (3rd line). |\n| Extra description 2 | Text | (Empty) | Supplementary text line (4th line). |\n| Extra description 3 | Text | (Empty) | Supplementary text line (5th line). |\n| Extra description 4 | Text | (Empty) | Supplementary text line (6th line). |\n\n### Position and Style\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Assign to layer | Dropdown | Tooling | Specifies the layer the text entity is assigned to (Options: Tooling, Information, Zone, Element). |\n| Zone index | Dropdown | 0 | Determines the zone index for export/filtering purposes (0-9). |\n| Offset from edge | Number | 0 | Distance perpendicular from the selected edge line to the text anchor. |\n| Horizontal text offset | Number | 0 | Distance along the edge direction to shift the text. |\n| Text size | Number | -1 | Height of the text. (-1 typically uses a default or project setting). |\n| Color | Number | -1 | Color index of the text (-1 usually defaults to \"ByLayer\"). |\n| Horizontal text alignment | Dropdown | Left | Aligns text relative to the insertion point (Left, Center, Right). |\n| Visible on top view only | Dropdown | Yes | If \"Yes\", the text may be hidden in 3D views depending on display settings. If \"No\", it is generally visible. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| (Standard TSL Menu) | No specific custom options added by this script. Use the Properties Palette to edit values. |\n\n## Settings Files\n- **Filename**: N/A\n- **Location**: N/A\n- **Purpose**: This script does not use external settings files. It relies on standard Element Construction Details (MapX) for variable resolution.\n\n## Tips\n- **Using Variables**: To automatically display edge construction data (e.g., specific notch types or codes defined in your catalogs), use variables like `@(VAR60)`, `@(VAR1)`, etc., in the **Detail name** field.\n- **Moving Labels**: After insertion, select the text label in the model. You can drag the **Grip Point** (Text Anchor) to reposition the label freely.\n- **Visibility**: If you cannot see the label in 3D views, check the **Visible on top view only** property in the palette and set it to \"No\".\n\n## FAQ\n- **Q: The text shows \"@(VAR60)\" instead of actual data. Why?**\n  A: This means the variable index (60) is either empty or not defined in the selected element's Edge Construction Detail Map. Check the element's edge properties or use static text instead.\n- **Q: Can I attach this to a single beam?**\n  A: No, this script is designed for Wall or Roof elements only.\n- **Q: How do I change the text size after insertion?**\n  A: Select the label, open the **Properties Palette** (OPM), and modify the **Text size** value.\n- **Q: Why did the script disappear after I selected the element?**\n  A: This can happen if the script encounters invalid geometry or no valid edges are found. Ensure you are selecting a valid Wall or Roof element. Check the AutoCAD command line for specific error warnings."
      },
      "tokens_used": 6268,
      "error": null
    }
  }
}