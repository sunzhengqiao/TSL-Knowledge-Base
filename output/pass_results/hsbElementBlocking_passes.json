{
  "filename": "hsbElementBlocking.mcr",
  "status": "completed",
  "total_tokens": 52758,
  "processing_time": 771.1890943050385,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9050,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses geometric manipulation functions like GenBeam, Body, Vector3d, and Element. It operates on 3D construction entities (blocking beams, elements, posts). No usage of sd_*, Multipage, _Viewport, #Type E, or 2D drawing entities."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "GenBeam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model Space containing elements or beams",
          "requiredSettings": []
        }
      },
      "tokens_used": 5361,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Select elements, <Enter> to select a set of beams of one element\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"Property Dialog (showDialog)\",\n      \"trigger\": \"Script Insertion or MapIO\",\n      \"title\": null,\n      \"dataSource\": \"Defined Properties\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"dHeight\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Height\",\n      \"defaultValue\": \"0\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry\",\n      \"description\": \"Defines the Height |0 = by zone|\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"dWidth\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"Width\",\n      \"defaultValue\": \"0\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Geometry\",\n      \"description\": \"Defines the Width| |0 = by zone|\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"sMaterial\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Material\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Beam Properties\",\n      \"description\": \"Defines the Material\"\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"sGrade\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Grade\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Beam Properties\",\n      \"description\": \"Defines the Grade\"\n    },\n    {\n      \"index\": 2,\n      \"variable\": \"sName\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Name\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Beam Properties\",\n      \"description\": \"Defines the Name\"\n    },\n    {\n      \"index\": 0,\n      \"variable\": \"nColor\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"Color\",\n      \"defaultValue\": \"4\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"Beam Properties\",\n      \"description\": \"Defines the Color\"\n    },\n    {\n      \"index\": 7,\n      \"variable\": \"sNailing\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Nailing\",\n      \"defaultValue\": \"Disabled\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Disabled\",\n        \"Enabled\"\n      ],\n      \"category\": \"Beam Properties\",\n      \"description\": \"Defines the Nailing\"\n    },\n    {\n      \"index\": 8,\n      \"variable\": \"sClearance\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Bottom Clearance\",\n      \"defaultValue\": \"25\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Alignment\",\n      \"description\": \"Defines the clearance between the bottom rail or lower blocking and the next blocking.|Separate multiple entries by semicolon| ';' |You can specify absolute values like| 400;400;300 |or a fraction of the maximum inner height i.e.| 1/3;1/3;1/5\"\n    },\n    {\n      \"index\": 3,\n      \"variable\": \"sPostFilter\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Post Filter\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Alignment\",\n      \"description\": \"Defines the criteria to identify a post, |Color and/or beamtypes are supported, separate entries by semikolon|\"\n    },\n    {\n      \"index\": 4,\n      \"variable\": \"sSplitFilter\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Split Filter\",\n      \"defaultValue\": \"\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"Alignment\",\n      \"description\": \"Defines the criteria to identify splitting studs, |Color and/or beamtypes are supported, separate entries by semikolon|\"\n    },\n    {\n      \"index\": 5,\n      \"variable\": \"sAlignment\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Alignment\",\n      \"defaultValue\": \"Icon Side\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Icon Side\",\n        \"Center\",\n        \"Opposite Side\"\n      ],\n      \"category\": \"Alignment\",\n      \"description\": \"Defines the Alignment\"\n    },\n    {\n      \"index\": 6,\n      \"variable"
      },
      "tokens_used": 9739,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates and distributes blocking beams (noggins/firestops) within timber wall elements, adjusting surrounding studs and diagonal bracing to fit.",
          "category": "Framing",
          "typicalUseCase": "Used during element generation to insert structural blocking, bridging, or nailing backers between studs in wall panels."
        },
        "parameters": [
          {
            "name": "dHeight",
            "technicalDefault": "0",
            "businessMeaning": "Sets the height (depth) of the blocking beam. If 0, it inherits the height from the element's structural zone.",
            "validRange": "0 (Auto) or 30-300mm",
            "unit": "mm",
            "affectsOutput": "Defines the vertical size of the blocking cross-section."
          },
          {
            "name": "dWidth",
            "technicalDefault": "0",
            "businessMeaning": "Sets the width (thickness) of the blocking beam. If 0, it inherits the width from the element's structural zone.",
            "validRange": "0 (Auto) or 30-200mm",
            "unit": "mm",
            "affectsOutput": "Defines the thickness of the blocking relative to the wall plane."
          },
          {
            "name": "sMaterial",
            "technicalDefault": "",
            "businessMeaning": "Specifies the material code (e.g., C24, GL24h) for the blocking beams.",
            "validRange": "Standard timber material codes",
            "unit": "String",
            "affectsOutput": "Updates material properties in reports and BOM."
          },
          {
            "name": "sGrade",
            "technicalDefault": "",
            "businessMeaning": "Specifies the timber grade for the blocking beams.",
            "validRange": "Standard timber grades",
            "unit": "String",
            "affectsOutput": "Updates grade properties for production data."
          },
          {
            "name": "sName",
            "technicalDefault": "",
            "businessMeaning": "Assigns a specific name label to the blocking entities.",
            "validRange": "Alphanumeric text",
            "unit": "String",
            "affectsOutput": "Displays in drawing lists and element properties."
          },
          {
            "name": "nColor",
            "technicalDefault": "4",
            "businessMeaning": "Sets the CAD display color of the blocking beams for visual distinction.",
            "validRange": "0-255 (CAD Index)",
            "unit": "Integer",
            "affectsOutput": "Visual appearance in the 3D model and drawings."
          },
          {
            "name": "sNailing",
            "technicalDefault": "Disabled",
            "businessMeaning": "Determines if the blocking acts as a nailing strip (receiving nail layout data) or is purely structural.",
            "validRange": "Disabled, Enabled",
            "unit": "Enum",
            "affectsOutput": "If Disabled, sets beam code to exclude from nailing operations."
          },
          {
            "name": "sClearance",
            "technicalDefault": "25",
            "businessMeaning": "Defines the vertical spacing for rows of blocking. Supports absolute values (e.g., '600;1200') or fractions of the bay height (e.g., '1/3;1/3').",
            "validRange": "e.g. '400', '600;1200', '1/2;1/2'",
            "unit": "mm or Fraction",
            "affectsOutput": "Calculates the Z-axis positions where blocking rows are inserted."
          },
          {
            "name": "sPostFilter",
            "technicalDefault": "",
            "businessMeaning": "Identifies which vertical members should be treated as 'posts' (studs) that are stretched to meet the blocking, based on Color or Type.",
            "validRange": "e.g. 'Post;Stud' or color indices '1;2'",
            "unit": "String",
            "affectsOutput": "Filters which studs are dynamically adjusted to the blocking height."
          },
          {
            "name": "sSplitFilter",
            "technicalDefault": "",
            "businessMeaning": "Identifies members (like diagonal bracing) that should cut completely through the blocking, rather than being stopped by it.",
            "validRange": "e.g. 'Bracing;Diagonal'",
            "unit": "String",
            "affectsOutput": "Creates cutouts in the blocking geometry for these members."
          },
          {
            "name": "sAlignment",
            "technicalDefault": "Icon Side",
            "businessMeaning": "Controls the horizontal alignment of the blocking relative to the wall centerline (Left/Center/Right based on insertion side).",
            "validRange": "Icon Side, Center, Opposite Side",
            "unit": "Enum",
            "affectsOutput": "Shifts the blocking along the wall's Y-axis."
          },
          {
            "name": "sStaggered",
            "technicalDefault": "No",
            "businessMeaning": "Offsets alternating rows of blocking to allow for continuous nailing or ventilation.",
            "validRange": "No, Yes",
            "unit": "Enum",
            "affectsOutput": "Every second row of blocking is shifted by its width."
          },
          {
            "name": "sJustification",
            "technicalDefault": "Bottom",
            "businessMeaning": "When using fractional clearance, determines if the fraction is measured from the Top, Middle, or Bottom of the opening.",
            "validRange": "Top, Middle, Bottom",
            "unit": "Enum",
            "affectsOutput": "Affects the vertical placement when sClearance uses fractions."
          },
          {
            "name": "dGap",
            "technicalDefault": "0",
            "businessMeaning": "Sets a clearance tolerance around intersecting diagonal members. Negative values exclude intersection; positive values create a gap.",
            "validRange": "-10 to 20",
            "unit": "mm",
            "affectsOutput": "Controls the size of notches or gaps around non-vertical intersecting beams."
          },
          {
            "name": "nSequence",
            "technicalDefault": "70",
            "businessMeaning": "Prioritizes the script execution order during element construction. Lower numbers run earlier.",
            "validRange": "-999 to 999",
            "unit": "Integer",
            "affectsOutput": "Ensures blocking is created after main framing but before finishing operations."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sClearance contains '/' (fraction)",
            "effect": "sJustification determines the reference point (Top/Middle/Bottom) for the vertical placement.",
            "cascade": [
              "sJustification"
            ]
          },
          {
            "trigger": "dHeight or dWidth is 0",
            "effect": "Dimensions are automatically read from the Element's structural zone or associated beams.",
            "cascade": []
          },
          {
            "trigger": "sStaggered is 'Yes'",
            "effect": "Rows of blocking are offset by their width.",
            "cascade": [
              "dWidth"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "GenBeam",
            "description": "Timber blocking beams inserted horizontally between studs.",
            "appliedTo": "Selected Elements or Beam groups."
          },
          {
            "type": "BeamStretch/BeamCut",
            "description": "Existing studs and diagonal braces are modified to terminate against or pass through the new blocking.",
            "appliedTo": "Studs (filtered by sPostFilter) and Diagonals."
          }
        ]
      },
      "tokens_used": 9912,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Execution Started",
          "Check Execution Context (MapIO, Delete, Insert)",
          "[MapIO] Read Properties from Input Map",
          "[MapIO] Update Output Map and Return",
          "[Delete] Erase Script Instance and Return",
          "[Insert] Check for Duplicate Insert (insertCycleCount)",
          "[Insert] Check for ExecuteKey (Silent/Catalog Mode)",
          "[Insert] If ExecuteKey Exists: Load Properties from Catalog",
          "[Insert] If No ExecuteKey: Show Property Dialog (showDialog)",
          "[Insert] Prompt User for Entity Selection (Element or Beam Set)",
          "Process Selection: Extract Element or Group of Beams",
          "Establish Coordinate System (Element UCS or Beams UCS)",
          "Identify Vertical Posts (Filter by sPostFilter)",
          "Identify Splitting Members (Filter by sSplitFilter)",
          "Determine Blocking Dimensions (Auto from Zone or Explicit dHeight/dWidth)",
          "Parse Clearances (Absolute values or Fractions based on sJustification)",
          "Loop: For each Calculated Row Position",
          "Generate Blocking Solid Geometry",
          "Perform Subtractions for Splitting Members (Apply dGap)",
          "Decompose Solid into Individual Blocking Beams",
          "Filter out blocks shorter than Min Length",
          "[Conditional] Apply Staggered Offset (if sStaggered=Yes)",
          "Create GenBeam Entities (Assign Material, Grade, Name, Color)",
          "Assign Beams to Element or Group",
          "Stretch Vertical Posts to Blocking Faces",
          "Stretch/Tool Diagonal Bracing against Blocking",
          "Set Nailing Beam Code (If sNailing=Disabled)",
          "Repeat for Next Row",
          "Finalize: Erase Script Instance (unless Debug Mode)"
        ],
        "conditionalBranches": [
          {
            "condition": "Selection Input Type",
            "path1": {
              "name": "Element Selected",
              "steps": [
                "Extract Element reference",
                "Use Element coordinate system",
                "Auto-detect structural zone dimensions"
              ]
            },
            "path2": {
              "name": "Set of Beams Selected (<Enter>)",
              "steps": [
                "Calculate UCS from beam averages",
                "Infer wall boundaries from beam extents",
                "Use first beam for group assignment"
              ]
            }
          },
          {
            "condition": "Dimension Input (dHeight / dWidth)",
            "path1": {
              "name": "0 (Auto)",
              "steps": [
                "Read dimensions from Element.zSize() or Zone",
                "Dynamically adapt to wall changes"
              ]
            },
            "path2": {
              "name": "Fixed Value (>0)",
              "steps": [
                "Use explicit user-defined dimensions",
                "Ignore zone size changes"
              ]
            }
          },
          {
            "condition": "Clearance String Format (sClearance)",
            "path1": {
              "name": "Absolute Value (e.g., '400')",
              "steps": [
                "Place blocking at specific distance from reference",
                "Unit: mm"
              ]
            },
            "path2": {
              "name": "Fraction (e.g., '1/3')",
              "steps": [
                "Calculate max inner height of bay",
                "Multiply height by fraction",
                "Apply sJustification (Top/Middle/Bottom) for offset"
              ]
            }
          },
          {
            "condition": "Intersection Type (Vertical vs Diagonal)",
            "path1": {
              "name": "Vertical Post/Stud",
              "steps": [
                "Identify intersection face",
                "StretchDynamicTo(Blocking)"
              ]
            },
            "path2": {
              "name": "Diagonal / Splitting Member",
              "steps": [
                "Check if fully splitting or partial",
                "If partial: Add Tool with dGap tolerance",
                "If full: Create notch in blocking body"
              ]
            }
          },
          {
            "condition": "Staggered Distribution (sStaggered)",
            "path1": {
              "name": "Yes",
              "steps": [
                "Check Row Index (i % 2)",
                "If Odd: Transform by vecY * Width"
              ]
            },
            "path2": {
              "name": "No",
              "steps": [
                "Maintain consistent alignment for all rows"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Minimum Length (dMinBlockingLength)",
            "errorMessage": "None (Internal Suppression)",
            "recovery": "Generated blocking segments shorter than 50mm are automatically discarded (not created)."
          },
          {
            "check": "Valid Entity Selection",
            "errorMessage": "Script requires valid selection to proceed",
            "recovery": "User must select at least one Element or a valid group of coplanar beams."
          },
          {
            "check": "Decomposition Result",
            "errorMessage": "None (Internal Suppression)",
            "recovery": "If subtracting splitters results in no valid bodies, that row is skipped."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Property Modification (OPM)",
            "how": "AutoCAD Properties Palette",
            "effect": "Changing dHeight, dWidth, sClearance, etc., allows for immediate regeneration of the blocking layout."
          },
          {
            "action": "Filter Adjustment",
            "how": "OPM (Edit sPostFilter or sSplitFilter)",
            "effect": "Alters which existing studs are stretched and which beams cut holes in the blocking."
          },
          {
            "action": "Recalculate / Update",
            "how": "Right-click Context Menu on Script Instance",
            "effect": "Re-executes the generation logic to apply property changes or adapt to wall geometry changes."
          },
          {
            "action": "Move / Grip Edit",
            "how": "CAD Grips on the Script Instance or Element",
            "effect": "Moving the script instance icon moves the generated blocking; moving the element triggers recalculation (if linked)."
          }
        ]
      },
      "tokens_used": 10807,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbElementBlocking.mcr\n\n## Overview\nAutomatically generates horizontal blocking beams (noggins or firestops) within timber wall elements. It intelligently adjusts surrounding vertical studs and diagonal bracing to fit the new blocking layout.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D construction entities. |\n| Paper Space | No | Not designed for 2D drawing generation. |\n| Shop Drawing | No | This is a model generation script. |\n\n## Prerequisites\n- **Required Entities**: At least one Timber Element or a group of coplanar GenBeams (studs/plates).\n- **Minimum Beam Count**: 0 if an Element is selected; multiple beams if selecting a set manually.\n- **Required Settings**: None. Uses internal defaults or Element structural zone data.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line or browse the TSL Catalog.\n2.  Select `hsbElementBlocking.mcr` and click OK.\n\n### Step 2: Select Elements or Beams\n```\nCommand Line: Select elements, <Enter> to select a set of beams of one element\nAction: \n- Click on a Timber Element to generate blocking inside it.\nOR\n- Press <Enter> and then window-select a group of beams (studs/plates) that form a wall.\n```\n\n### Step 3: Configure Properties\n1.  The Property Dialog will appear automatically upon insertion.\n2.  Adjust parameters such as **Height**, **Width**, and **Clearance** as needed.\n3.  Click OK to generate the blocking.\n\n## Properties Panel Parameters\n\n### Geometry\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Height | Number | 0 | Defines the height of the blocking beam. Set to `0` to use the Element's structural zone height. |\n| Width | Number | 0 | Defines the width of the blocking beam. Set to `0` to use the Element's structural zone width. |\n\n### Beam Properties\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Material | Text | (Empty) | Specifies the material code (e.g., C24) for the blocking beams. |\n| Grade | Text | (Empty) | Specifies the timber grade (e.g., GL24h). |\n| Name | Text | (Empty) | Assigns a specific name label to the blocking entities. |\n| Color | Number | 4 | Sets the CAD display color (Index 0-255). |\n| Nailing | Dropdown | Disabled | Determines if the blocking acts as a nailing strip (`Enabled`) or purely structural (`Disabled`). |\n\n### Alignment & Layout\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Clearance | Text | 25 | Defines vertical spacing between rows. <br>- **Absolute**: e.g., `400;600` (mm). <br>- **Fraction**: e.g., `1/3;1/3` (Relative to bay height). <br>Separate multiple entries with a semicolon `;`. |\n| Bottom Clearance | Text | 25 | (Legacy/Specific) Defines clearance from the bottom rail. See `Clearance` for main spacing logic. |\n| Post Filter | Text | (Empty) | Criteria to identify vertical studs that should be stretched to meet the blocking. Use colors or beamtypes separated by semicolons (e.g., `Stud;Post`). |\n| Split Filter | Text | (Empty) | Criteria to identify members (e.g., diagonals) that should cut through the blocking rather than stop against it. |\n| Alignment | Dropdown | Icon Side | Sets horizontal alignment relative to the wall centerline (`Icon Side`, `Center`, or `Opposite Side`). |\n| Staggered | Dropdown | No | If `Yes`, offsets every second row of blocking to allow for continuous nailing or ventilation. |\n| Justification | Dropdown | Bottom | When using fractional clearance, determines if the fraction is calculated from the `Top`, `Middle`, or `Bottom` of the opening. |\n| Gap | Number | 0 | Sets a clearance tolerance around intersecting diagonal members (mm). Use negative values to exclude intersections. |\n\n### Configuration\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Sequence | Number | 70 | Determines the execution order during element generation. Lower numbers run earlier. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Recalculate | Re-runs the script to apply property changes or adapt to geometry changes in the wall. |\n| Show Dialog | Opens the properties dialog to edit blocking parameters. |\n| MapIO | Opens the MapIO dialog for advanced input/output mapping. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: This script relies on internal logic and Element properties; no external XML configuration file is mandatory for basic operation.\n\n## Tips\n- **Auto-Dimensions**: Leave `Height` and `Width` as `0` to ensure blocking automatically matches the wall's structural zone thickness if the wall design changes.\n- **Fractional Spacing**: Use the `Clearance` field with fractions (e.g., `1/2`) to place blocking exactly in the middle of a tall opening, regardless of the opening height.\n- **Filtering**: If your studs are not being cut/stretched correctly, check your `Post Filter`. You can filter by beam name (e.g., \"Stud\") or Color Index.\n- **Splitting Diagonals**: If you have diagonal bracing that needs to pass *through* the blocking without notching it heavily, add the bracing type to the `Split Filter`.\n\n## FAQ\n- **Q: Why is my blocking appearing in the wrong place vertically?**\n- **A: Check the `Clearance` string. Ensure you are using semicolons `;` to separate values if you have multiple rows. If using fractions, verify the `Justification` setting (Top/Middle/Bottom) to see where the reference point is.\n\n- **Q: The blocking is not cutting a hole for my diagonal brace.**\n- **A: Add the diagonal beam's Name or Type to the `Split Filter` property. This tells the script to treat that member as a \"splitter\" that passes through.\n\n- **Q: The studs are not stretching up to touch the blocking.**\n- **A: Verify the `Post Filter` property. The studs must match the criteria defined there (e.g., if your filter is \"Stud\" but the beam is named \"VerticalStud\", it won't match).\n\n- **Q: How do I offset every other row?**\n- **A: Set the `Staggered` property to `Yes`. This is useful for nailing strips so joints don't line up vertically."
      },
      "tokens_used": 7889,
      "error": null
    }
  }
}