{
  "filename": "Rothoblaas Titan V.mcr",
  "status": "completed",
  "total_tokens": 48911,
  "processing_time": 403.0786418914795,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "Rothoblaas TITAN V angle bracket for panels.",
        "versionHistory": [
          {
            "version": "1.01",
            "date": "24.oct.2018\"",
            "author": "david.rueda@hsbcad.com",
            "changes": " Thimbnail updated  "
          },
          {
            "version": "1.0",
            "date": "\"22oct2018\"",
            "author": "david.rueda@hsbcad.com",
            "changes": " initial "
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8800,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script explicitly targets `_kModelSpace` in the `dbCreate` function. It manipulates 3D geometry using `Body`, `PLine`, and `Drill` entities, and calculates 3D intersections and spatial relationships between panels (`Sip`). It does not use `sd_` prefixes, `Multipage` logic, or ShopDrawing specific patterns like `#Type E` with `_Entity[]`."
        },
        "prerequisites": {
          "requiredEntities": [
            "Sip"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space (with at least 2 perpendicular panels)",
          "requiredSettings": []
        }
      },
      "tokens_used": 5863,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "|Select 2 panels for insertion at specified point|\n",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": null,
              "condition": "if (nSips == 2) within _bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialogOnce",
            "trigger": "During insertion if no execute key is provided",
            "title": null,
            "dataSource": "Internal Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "|Type|",
            "defaultValue": "F1-|Full nailing|",
            "inputType": "dropdown",
            "options": [
              "F1-|Full nailing|",
              "F1-|Partial nailing|",
              "F2/3-|Full nailing|",
              "F2/3-|Partial nailing|"
            ],
            "category": "|General|",
            "description": "F1-|Full nailing|: 36 Anker nails Ø4x60 (vertical plate) + 5 VGS screws Ø11x200 + 30 Anker nails Ø4x60 (base plate)\nF1-|Partial nailing|: 24 Anker nails Ø4x60 (vertical plate) + 5 VGS screws Ø11x200 + 24 Anker nails Ø4x60 (base plate)\nF2/3|Full nailing|: 36 Anker nails Ø4x60 (vertical plate) + 2 VGS screws Ø11x200 + 30 Anker nails Ø4x60 (base plate)\nF2/3-|Partial nailing|: 24 Anker nails Ø4x60 (vertical plate) + 2 VGS screws Ø11x200 + 24 Anker nails Ø4x60 (base plate)"
          },
          {
            "index": 1,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "|Offset|",
            "defaultValue": "50",
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|Minimal distance from edge to metal part|."
          },
          {
            "index": 2,
            "variable": "sDisplay",
            "type": "PropString",
            "displayName": "|Display|",
            "defaultValue": "|Text|",
            "inputType": "dropdown",
            "options": [
              "|No nail info|",
              "|Text|",
              "|Graphical|",
              "|Realistic|"
            ],
            "category": "|Display|",
            "description": "|Defines the Display|"
          },
          {
            "index": 3,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [],
            "category": "|Display|",
            "description": null
          },
          {
            "index": 4,
            "variable": "dScale",
            "type": "PropDouble",
            "displayName": "|Scale|",
            "defaultValue": "1",
            "inputType": "number",
            "options": [],
            "category": "|Display|",
            "description": "|Defines the Height Scale| (|height is defined by metal part dimensions|)."
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Catalog Entries (Execute Key)",
            "handler": "_kExecuteKey",
            "action": "Sets property values from the catalog entry matching the execute key, or last inserted if no match.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 7957,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Inserts a Rothoblaas TITAN V angle bracket to connect two perpendicular timber panels (Sip), generating the metal plate visualization and associating specific fasteners (nails/screws).",
          "category": "Hardware",
          "typicalUseCase": "Connecting a wall to a floor, or two walls, at a right angle using the specific heavy-duty Titan V bracket system where structural hold-down is required."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "F1-|Full nailing|",
            "businessMeaning": "Selects the structural configuration of the connector, determining the specific fastener pattern (nails and screws). 'F1' and 'F2/3' refer to different load capacities or geometry variants, while 'Full' vs 'Partial' defines the density of the nailing pattern.",
            "validRange": [
              "F1-Full nailing",
              "F1-Partial nailing",
              "F2/3-Full nailing",
              "F2/3-Partial nailing"
            ],
            "unit": "enum",
            "affectsOutput": "Updates the Bill of Materials (BOM) quantities for VGS screws and Anker nails. Controls the graphical representation of holes (omitting holes for partial nailing patterns)."
          },
          {
            "name": "dOffset",
            "technicalDefault": "50",
            "businessMeaning": "The edge distance, defining the minimum distance from the panel edge to the center of the metal bracket.",
            "validRange": "40mm to 300mm (Dependent on panel width)",
            "unit": "mm",
            "affectsOutput": "Sliding the entire connector assembly (metal plate and holes) along the panel edge relative to the insertion point."
          },
          {
            "name": "sDisplay",
            "technicalDefault": "|Text|",
            "businessMeaning": "Controls the level of detail shown in the model and production drawings. 'Realistic' creates physical drill entities, while 'Text' or 'Graphical' only provide 2D representations.",
            "validRange": [
              "|No nail info|",
              "|Text|",
              "|Graphical|",
              "|Realistic|"
            ],
            "unit": "enum",
            "affectsOutput": "In 'Realistic' mode, it adds cylindrical Drill entities to the panel for CNC machining. In other modes, it only draws overlay graphics or text."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": null,
            "businessMeaning": "Selects the CAD dimension style used for any labeling or dimensioning associated with the connector.",
            "validRange": "Available dimension styles in the current drawing.",
            "unit": "string",
            "affectsOutput": "Visual style of text labels if dimensions are generated (used primarily for labels in this script)."
          },
          {
            "name": "dScale",
            "technicalDefault": "1",
            "businessMeaning": "A scaling factor for the visual representation (text height or symbol size), not the physical metal part.",
            "validRange": "0.1 to 5.0",
            "unit": "factor",
            "affectsOutput": "Adjusts the size of the text labels and graphical markers for nails/screws."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change sType",
            "effect": "Recalculates the number of nail and screw objects added to the BOM and the graphical pattern drawn.",
            "cascade": [
              "nNailsFemale",
              "nNailsMale",
              "nScrewsFemale"
            ]
          },
          {
            "trigger": "Change sDisplay to 'Realistic'",
            "effect": "Switches from drawing 2D symbols to creating 3D Drill entities in the timber panels.",
            "cascade": [
              "Drill entities"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Visual Representation (PLine/Body)",
            "description": "3D lines representing the vertical and base plates of the Titan V bracket.",
            "appliedTo": "Model Space (referenced against selected Panels)"
          },
          {
            "type": "Drill",
            "description": "Cylindrical holes representing the nail/screw positions. Only created if sDisplay is 'Realistic'.",
            "appliedTo": "The selected Sip panels (Female and Male sides)"
          },
          {
            "type": "Hardware Component (BOM)",
            "description": "Adds 'TTV240', 'LBA 460', and selected 'VGS' screws to the element's bill of materials.",
            "appliedTo": "Element associated with the first selected panel"
          }
        ]
      },
      "tokens_used": 9281,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script via hsbCAD command.",
          "2. Check for Catalog Execute Key (silent insertion) or default to interactive mode.",
          "3. If interactive, show Property Dialog (Type, Offset, Display settings).",
          "4. Prompt user to Select 2 Panels (Sip entities).",
          "5. Validate Selection Count.",
          "6. Prompt user to click Insertion Point (defines edge location).",
          "7. Create new script instance linked to selected panels and point.",
          "8. [Calculation Phase] Validate panel geometry (Perpendicularity).",
          "9. Determine 'Female' (Base) and 'Male' (Vertical) panels based on intersection.",
          "10. Generate Metal Plate geometry (PLine outlines) based on Offset.",
          "11. Calculate Fastener pattern based on Type property.",
          "12. Generate Visuals (Text/Graphical symbols or Realistic Drills).",
          "13. Create and attach Hardware Components (BOM).",
          "14. Finalize instance."
        ],
        "conditionalBranches": [
          {
            "condition": "Number of selected Panels (Entity Selection)",
            "path1": {
              "name": "Exactly 2 Panels",
              "steps": [
                "Prompt for Insertion Point.",
                "Proceed to Geometry Calculation.",
                "Generate Connector."
              ]
            },
            "path2": {
              "name": "0, 1, or >2 Panels",
              "steps": [
                "Report Error: '2 panels are needed'.",
                "Erase temporary instance.",
                "Exit."
              ]
            }
          },
          {
            "condition": "Panel Perpendicularity",
            "path1": {
              "name": "Panels are Perpendicular",
              "steps": [
                "Define Female/Male roles.",
                "Calculate Intersection Point.",
                "Proceed."
              ]
            },
            "path2": {
              "name": "Panels not Perpendicular",
              "steps": [
                "Report Error: 'Panels are not perpendicular'.",
                "Erase instance.",
                "Exit."
              ]
            }
          },
          {
            "condition": "Display Mode Property",
            "path1": {
              "name": "Realistic",
              "steps": [
                "Create 3D Drill entities in panels.",
                "Apply tools to MapObject."
              ]
            },
            "path2": {
              "name": "Text or Graphical",
              "steps": [
                "Draw 2D Lines/Circles (PLine).",
                "Draw Text Labels.",
                "Do not modify panel solid."
              ]
            }
          },
          {
            "condition": "Execute Key (Catalog)",
            "path1": {
              "name": "Key provided",
              "steps": [
                "Load properties from specific catalog entry.",
                "Skip Dialog."
              ]
            },
            "path2": {
              "name": "No Key provided",
              "steps": [
                "Show Dialog.",
                "Load 'LastInserted' defaults after creation."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Count",
            "errorMessage": "2 panels are needed",
            "recovery": "Select exactly 2 Sip panels and restart command."
          },
          {
            "check": "Panel Orientation",
            "errorMessage": "Panels are not perpendicular",
            "recovery": "Ensure the two selected panels form a 90-degree corner."
          },
          {
            "check": "Reference Validity",
            "errorMessage": "Invalid reference",
            "recovery": "Ensure panels are valid Sip entities and not deleted/locked."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Adjust Position",
            "how": "OPM Property (dOffset)",
            "effect": "Slides the bracket along the panel edge relative to the insertion point."
          },
          {
            "action": "Change Fastener Type",
            "how": "OPM Property (sType)",
            "effect": "Updates the BOM quantities (screws/nails) and redraws the hole pattern (omitting nails for 'Partial' configurations)."
          },
          {
            "action": "Toggle Realistic Mode",
            "how": "OPM Property (sDisplay)",
            "effect": "Switches between 2D representation and 3D drilling (Drill entities added to panel)."
          },
          {
            "action": "Change Visual Scale",
            "how": "OPM Property (dScale)",
            "effect": "Resizes text labels and graphical markers without changing physical geometry."
          }
        ]
      },
      "tokens_used": 10706,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Rothoblaas Titan V.mcr\n\n## Overview\nInserts the Rothoblaas TITAN V angle bracket to connect two perpendicular timber panels (Sip). It generates the metal plate visualization and automatically associates the correct fasteners (nails and screws) based on the selected structural configuration.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required. 3D context is necessary to detect panel intersections. |\n| Paper Space | No | Not designed for 2D layout views. |\n| Shop Drawing | No | Not a shop drawing generation script. |\n\n## Prerequisites\n- **Required Entities:** Two `Sip` (timber panel) entities.\n- **Geometry:** The two panels must be perpendicular (90 degrees) to each other.\n- **Minimum Count:** Exactly 2 panels must be selected.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `Rothoblaas Titan V.mcr` from the list.\n\n### Step 2: Select Panels\n```\nCommand Line: Select 2 panels for insertion at specified point\nAction: Click on the first panel, then click on the second panel that forms the corner.\n```\n\n### Step 3: Specify Insertion Point\n```\nCommand Line: [Click to specify insertion point]\nAction: Click near the edge where the bracket should be placed. This point defines the location along the joint.\n```\n\n### Step 4: Configure Properties (If applicable)\nIf a catalog entry (Execute Key) was not used, a property dialog will appear. Adjust the Type, Offset, or Display settings as needed and click OK.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | Dropdown | F1 - Full nailing | Selects the structural configuration. Options include F1/F2/3 variants and Full/Partial nailing patterns. This determines the number of VGS screws and Anker nails added to the BOM. |\n| Offset | Number | 50 | The distance in mm from the panel edge to the center of the metal bracket. You can slide the bracket along the edge by changing this value. |\n| Display | Dropdown | Text | Controls the level of detail.<br>- **No nail info:** Hides fasteners.<br>- **Text:** Shows labels only.<br>- **Graphical:** Shows 2D symbols.<br>- **Realistic:** Creates actual 3D drill holes in the panels for CNC. |\n| Dimstyle | Dropdown | *Current* | The dimension style used for text labels associated with the connector. |\n| Scale | Number | 1 | A visual scaling factor for text height and graphical symbols. Does not change the physical size of the metal part. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Catalog Entries (Execute Key) | Allows you to load a pre-defined configuration from the catalog. If a specific key is active, it sets properties automatically; otherwise, it loads the last used settings. |\n\n## Settings Files\nNo specific external settings files (XML) are required for this script.\n\n## Tips\n- **Perpendicularity Check:** Ensure your panels meet at a perfect 90-degree angle. If they are skewed, the script will display an error \"Panels are not perpendicular\" and exit.\n- **CNC Preparation:** Only use the **Display: Realistic** mode if you need to see the physical drill holes in the model for machining or export. For general modeling, **Text** or **Graphical** modes improve performance.\n- **Adjusting Position:** After insertion, you do not need to delete the script to move it. Simply select the script instance and change the **Offset** property in the Properties Palette to slide it along the wall.\n\n## FAQ\n- **Q: Why does the script disappear immediately after I select the point?**\n  A: This usually happens if the selected panels are not exactly perpendicular. Check your geometry and try again.\n- **Q: How do I reduce the number of nails shown in the BOM?**\n  A: Change the **Type** property from \"Full nailing\" to \"Partial nailing\".\n- **Q: What is the difference between F1 and F2/3 types?**\n  A: These refer to different load capacities or geometric variants of the Titan V bracket. F2/3 typically uses fewer heavy-duty screws (VGS) compared to F1. Consult Rothoblaas technical documentation for structural implications."
      },
      "tokens_used": 6304,
      "error": null
    }
  }
}