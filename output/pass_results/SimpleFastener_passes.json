{
  "filename": "SimpleFastener.mcr",
  "status": "completed",
  "total_tokens": 42142,
  "processing_time": 1319.462059020996,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"header\": {\n    \"type\": null,\n    \"numBeamsReq\": null,\n    \"keywords\": null,\n    \"majorVersion\": null,\n    \"minorVersion\": null,\n    \"dxaOut\": null,\n    \"implInsert\": null\n  },\n  \"description\": \"This tsl creates a drill in a set of intersecting genbeams\\nIt provides methods to maintain or create fastener assembly definitions\",\n  \"versionHistory\": [\n    {\n      \"version\": \"1.3\",\n      \"date\": \"28.10.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-24838 sequence of fastener article data entries ordered by length\"\n    },\n    {\n      \"version\": \"1.2\",\n      \"date\": \"21.10.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-24585 automatic replacement invalid characters of style name (comma, slash, backslash)\"\n    },\n    {\n      \"version\": \"1.1\",\n      \"date\": \"20.05.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-24054 accepting filter as input when creating styles\"\n    },\n    {\n      \"version\": \"1.0\",\n      \"date\": \"19.05.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-24055 report layout improved\"\n    },\n    {\n      \"version\": \"0.44\",\n      \"date\": \"11.04.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-22816 commas refused\"\n    },\n    {\n      \"version\": \"0.43\",\n      \"date\": \"08.04.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-22859 copy behaviour improved\"\n    },\n    {\n      \"version\": \"0.42\",\n      \"date\": \"17.03.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-23716 supporting simple wireframe and thread display\"\n    },\n    {\n      \"version\": \"0.41\",\n      \"date\": \"12.02.2025\",\n      \"author\": \"Thorsten Huck\",\n      \"changes\": \"HSB-23512 adopted to new behaviour"
      },
      "tokens_used": 8946,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script implements interactive 3D Jigs (goJig) for rotation and axis selection, manipulating 3D geometry (CoordSys, Vector3d, PLine) directly in the model. The description explicitly states it creates drills in 'intersecting genbeams'. There is no usage of _Viewport, sd_ prefixes, or SD_Entity generation logic. It uses Display dp(-1) which targets the generic model view."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 1,
          "requiredSpace": "3D Model Space",
          "requiredSettings": [
            "Utilities\\DialogService\\TslUtilities.dll",
            "Utilities\\FastenerManager\\FastenerManager.dll",
            "Fastener Database file",
            "Fastener Assembly Definition styles (XML)"
          ]
        }
      },
      "tokens_used": 7552,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "|Pick point to rotate [Angle/Basepoint/ReferenceLine]|",
              "condition": "_bOnJig && _kExecuteKey==kJigRotation",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select base point|",
              "condition": "Keyword 'Basepoint' selected during rotation jig",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "|Select point on reference line|",
              "condition": "Keyword 'ReferenceLine' selected during rotation jig",
              "required": true
            }
          ],
          "keywordOptions": [
            {
              "prompt": "|Pick point to rotate [Angle/Basepoint/ReferenceLine]|",
              "options": [
                "Angle",
                "Basepoint",
                "ReferenceLine"
              ]
            }
          ]
        },
        "dialogs": [
          {
            "type": "SelectFromList",
            "trigger": "Invoked via TslUtilities.dll methods (SelectFromList) for selecting Manufacturers, Families, etc.",
            "title": "Not specified in script",
            "dataSource": "FastenerManager.dll (GetManufacturers, GetScrewListWithFilter, etc.)",
            "features": {
              "searchable": true,
              "multiSelect": false
            }
          },
          {
            "type": "ShowDynamicDialog",
            "trigger": "Invoked via TslUtilities.dll for complex user interactions.",
            "title": "Not specified in script",
            "dataSource": "TslUtilities.dll",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [],
        "contextMenu": [
          {
            "menuItem": "Flip Face",
            "handler": "|Flip Face|",
            "action": "Rotates the instance 180 degrees around the Y-axis at the insertion point.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Show StyleManager",
            "handler": "|Show StyleManager|",
            "action": "Pushes the '_AecStyleManager' command to the command stack.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Load Graphical Ruleset",
            "handler": "|Load Graphical Ruleset|",
            "action": "Pushes the 'hsb_fa_importgraphicsruleset' command to the command stack.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Change Database",
            "handler": "|Change Database|",
            "action": "Calls the FastenerManager to display the Database Manager dialog.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": [
          {
            "filename": "TslUtilities.dll",
            "searchPaths": [
              "_kPathHsbInstall + \"\\\\Utilities\\\\DialogService\\\\\""
            ],
            "purpose": "Provides UI services (SelectFromList, SelectOption, GetText, etc.)",
            "required": true
          },
          {
            "filename": "FastenerManager.dll",
            "searchPaths": [
              "_kPathHsbInstall + \"\\\\Utilities\\\\FastenerManager\\\\\""
            ],
            "purpose": "Manages fastener data, manufacturers, and database connections.",
            "required": true
          },
          {
            "filename": "Fastener Database",
            "searchPaths": [
              "Retrieved dynamically via FastenerManager (GetLastDatabasePathMethod)"
            ],
            "purpose": "Stores the fastener article data used by the script.",
            "required": true
          }
        ]
      },
      "tokens_used": 7740,
      "error": null
    },
    "4": {
      "success": false,
      "data": {},
      "tokens_used": 0,
      "error": "API error 429: {\"error\":{\"code\":\"1302\",\"message\":\"您的账户已达到速率限制，请您控制请求频率\"}}"
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. Script Initiation: User executes the script (insertion) or modifies an existing instance.\",\n    \"2. Axis Selection Jig (kJigSelectAxis): User picks a point near one of three displayed circles (X, Y, or Z) to define the rotation plane.\",\n    \"3. Rotation Jig Setup: The coordinate system is aligned to the view and the selected axis (X, Y, or Z).\",\n    \"4. Rotation Jig (kJigRotation): User dynamically drags the cursor to set the rotation angle or selects a keyword option.\",\n    \"5. Keyword Interaction (Conditional): If 'Angle', 'Basepoint', or 'ReferenceLine' is selected, sub-routines execute to modify the coordinate system or input specific values.\",\n    \"6. Apply Transformation: The calculated rotation is applied to the TSL instance.\",\n    \"7. Recalculation: The script updates geometry (drills, graphics) based on the new position.\",\n    \"8. Completion: Instance is updated in the model.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"User Interaction in Rotation Jig\",\n      \"path1\": {\n        \"name\": \"Cursor Drag (Default)\",\n        \"steps\": [\n          \"User moves cursor.\",\n          \"Angle is calculated relative to origin.\",\n          \"Grid snapping is applied based on cursor distance (45 deg to 1 deg precision).\",\n          \"Click confirms angle.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Keyword 'Angle'\",\n        \"steps\": [\n          \"User selects 'Angle' option.\",\n          \"Script prompts for manual numerical input.\",\n          \"Rotation applies directly from input.\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"Keyword 'Basepoint'\",\n        \"steps\": [\n          \"User selects 'Basepoint' option.\",\n          \"Script prompts for a new point location.\",\n          \"Rotation origin shifts to new point.\",\n          \"Jig restarts for angle input.\"\n        ]\n      },\n      \"path4\": {\n        \"name\": \"Keyword 'ReferenceLine'\",\n        \"steps\": [\n          \"User selects 'ReferenceLine' option.\",\n          \"Sub-Jig starts to define X-axis direction.\",\n          \"User picks point to align X-axis.\",\n          \"Coordinate system re-orients to match reference.\",\n          \"Jig restarts for angle input.\"\n        ]\n      },\n      \"path5\": {\n        \"name\": \"Cancel Operation\",\n        \"steps\": [\n          \"User hits Esc or Cancel.\",\n          \"bCancel flag set to true.\",\n          \"Loop terminates, changes discarded.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Selection in Axis Jig\",\n      \"path1\": {\n        \"name\": \"Rotate X-Axis\",\n        \"steps\": [\n          \"User clicks near circle perpendicular to local X.\",\n          \"Rotation plane set to Y-Z.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Rotate Y-Axis\",\n        \"steps\": [\n          \"User clicks near circle perpendicular to local Y.\",\n          \"Rotation plane set to X-Z.\"\n        ]\n      },\n      \"path3\": {\n        \"name\": \"Rotate Z-Axis\",\n        \"steps\": [\n          \"User clicks near circle perpendicular to local Z.\",\n          \"Rotation plane set to X-Y.\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Database Availability\",\n      \"errorMessage\": \"Implied failure if FastenerManager cannot locate the database file.\",\n      \"recovery\": \"User must select 'Change Database' from the context menu to point to a valid database.\"\n    },\n    {\n      \"check\": \"Input Cancellation\",\n      \"errorMessage\": \"None\",\n      \"recovery\": \"User restarts the insertion or grip edit.\"\n    }\n  ],\n  \"postInsertionActions\": [\n    {\n      \"action\": \"Flip Face\",\n      \"how\": \"Context Menu (Right-click)\",\n      \"effect\": \"Rotates the instance 180 degrees around the Y-axis.\"\n"
      },
      "tokens_used": 10664,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# SimpleFastener.mcr\n\n## Overview\nThis script creates fasteners (drills/screws) in a set of intersecting beams (GenBeams). It provides an interactive 3D rotation system for precise placement and includes tools to manage fastener assembly definitions and select hardware from a database.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script is designed for 3D modeling. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: At least one `GenBeam` (Structural Beam).\n- **Minimum Beam Count**: 1 (designed for intersecting beams).\n- **Required Settings**:\n  - `FastenerManager.dll` (must be present in the hsbCAD Utilities folder).\n  - `TslUtilities.dll` (must be present in the hsbCAD Utilities folder).\n  - A valid **Fastener Database** file (configured in the FastenerManager).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Select `SimpleFastener.mcr`\n\n### Step 2: Select Rotation Axis\n**Visual Prompt:** Three circles will appear near the insertion point representing the X, Y, and Z axes.\n**Action:** Click near the circle perpendicular to the axis you want to rotate around. \n- Click the circle on the **X-axis** to rotate in the Y-Z plane.\n- Click the circle on the **Y-axis** to rotate in the X-Z plane.\n- Click the circle on the **Z-axis** to rotate in the X-Y plane.\n\n### Step 3: Set Rotation Angle\n```\nCommand Line: |Pick point to rotate [Angle/Basepoint/ReferenceLine]|\nAction: Move your cursor to dynamically rotate the fastener. Click to set the angle.\n```\n**Keyword Options:**\n- **Angle**: Type `Angle` and press Enter to input a specific numerical value for the rotation.\n- **Basepoint**: Type `Basepoint` and press Enter to select a new center point for the rotation.\n- **ReferenceLine**: Type `ReferenceLine` and press Enter to align the fastener's X-axis with a specific line in your drawing.\n\n### Step 4: Select Fastener\nOnce positioned, the script will invoke the FastenerManager dialogs.\n**Action:** Select the Manufacturer, Family, and specific Screw article from the filtered lists provided.\n\n## Properties Panel Parameters\n*Note: The script scan did not detect static user-editable properties (OPM). Configuration is primarily handled via the interactive dialogs and Context Menu options described below.*\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Flip Face** | Rotates the fastener 180 degrees around the local Y-axis. Useful for mirroring the fastener orientation. |\n| **Show StyleManager** | Opens the Style Manager to create or modify fastener assembly definitions (styles). |\n| **Load Graphical Ruleset** | Imports a graphical ruleset for the fastener display. |\n| **Change Database** | Opens the Database Manager dialog to switch to a different fastener database file. |\n\n## Settings Files\n- **Filename**: `TslUtilities.dll`\n- **Location**: `_kPathHsbInstall + \"\\Utilities\\DialogService\\\"`\n- **Purpose**: Provides the user interface dialogs (Selection lists, Input boxes).\n\n- **Filename**: `FastenerManager.dll`\n- **Location**: `_kPathHsbInstall + \"\\Utilities\\FastenerManager\\\"`\n- **Purpose**: Manages connection to the fastener database and filters available articles.\n\n- **Filename**: `Fastener Database` (e.g., .mdb or .xlsx)\n- **Location**: Defined dynamically via the FastenerManager settings.\n- **Purpose**: Contains the technical data (dimensions, material, codes) for the screws and fasteners.\n\n## Tips\n- **Precise Alignment**: Use the **ReferenceLine** option during the rotation jig to align your fastener perfectly with the edge of a beam or a construction line.\n- **Quick Re-orientation**: If you insert a fastener and it is facing the wrong way, use the **Flip Face** context menu option instead of re-inserting.\n- **Grid Snapping**: The rotation jig automatically adjusts snapping precision (from 45 degrees down to 1 degree) based on how close your cursor is to the insertion point. Move the cursor closer for fine-tuning.\n\n## FAQ\n- **Q: Why don't I see any screws to select?**\n  - A: The script relies on the Fastener Database. Ensure the database path is correct by right-clicking the script and selecting **Change Database**.\n  \n- **Q: How do I rotate the fastener after I have inserted it?**\n  - A: Use the AutoCAD `PROPERTIES` palette (if available) or delete and re-insert to use the interactive rotation jig. Alternatively, check if the specific style you are using has parameters that allow angle adjustment. For 180-degree flips, use the **Flip Face** context menu option.\n\n- **Q: What does the \"StyleManager\" do?**\n  - A: It allows you to group specific fastener configurations (e.g., \"M12 x 100mm with Washer\") into a named Style. This allows for quick reuse without manually selecting parameters every time."
      },
      "tokens_used": 7240,
      "error": null
    }
  }
}