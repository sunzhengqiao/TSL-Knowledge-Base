{
  "filename": "HSB_G-OptimizeBeams.mcr",
  "status": "completed",
  "total_tokens": 43525,
  "processing_time": 358.5873050689697,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 2,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "22.05.2012",
            "author": "AS",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "17.10.2012",
            "author": "AS",
            "changes": "Extend to a set of 6 lengths"
          },
          {
            "version": "1.02",
            "date": "23.12.2015",
            "author": "AS",
            "changes": "Add categories, set properties if tsl is attached to the element definition."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6186,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit use of `_kModelSpace` in `tsl.dbCreate`, use of 3D beam modification methods (`bm.dbSplit`), and absence of drawing/shopdrawing identifiers (sd_, _Viewport, #Type E)."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 5331,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && _kExecuteKey not in Catalog",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "|Select one or more elements|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "Script Insertion (if not run via execute key)",
            "title": "Properties",
            "dataSource": "Internal Properties (Catalogs)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sequenceNumber",
            "type": "PropInt",
            "displayName": "|Sequence number|",
            "defaultValue": 0,
            "inputType": "number",
            "options": [],
            "category": "|General|",
            "description": "|The sequence number is used to sort the list of tsl's during generate construction|"
          },
          {
            "index": 0,
            "variable": "dLength01",
            "type": "PropDouble",
            "displayName": "     |Length| 1",
            "defaultValue": "2440",
            "inputType": "number",
            "options": [],
            "category": "|Length 1|",
            "description": null
          },
          {
            "index": 0,
            "variable": "sBeamCodes01",
            "type": "PropString",
            "displayName": "     |Beamcodes| 1",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Length 1|",
            "description": null
          },
          {
            "index": 1,
            "variable": "dLength02",
            "type": "PropDouble",
            "displayName": "     |Length| 2",
            "defaultValue": "5400",
            "inputType": "number",
            "options": [],
            "category": "|Length 2|",
            "description": null
          },
          {
            "index": 1,
            "variable": "sBeamCodes02",
            "type": "PropString",
            "displayName": "     |Beamcodes| 2",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Length 2|",
            "description": null
          },
          {
            "index": 2,
            "variable": "dLength03",
            "type": "PropDouble",
            "displayName": "     |Length| 3",
            "defaultValue": "5400",
            "inputType": "number",
            "options": [],
            "category": "|Length 3|",
            "description": null
          },
          {
            "index": 2,
            "variable": "sBeamCodes03",
            "type": "PropString",
            "displayName": "     |Beamcodes| 3",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Length 3|",
            "description": null
          },
          {
            "index": 3,
            "variable": "dLength04",
            "type": "PropDouble",
            "displayName": "     |Length| 4",
            "defaultValue": "5400",
            "inputType": "number",
            "options": [],
            "category": "|Length 4|",
            "description": null
          },
          {
            "index": 3,
            "variable": "sBeamCodes04",
            "type": "PropString",
            "displayName": "     |Beamcodes| 4",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Length 4|",
            "description": null
          },
          {
            "index": 4,
            "variable": "dLength05",
            "type": "PropDouble",
            "displayName": "     |Length| 5",
            "defaultValue": "5400",
            "inputType": "number",
            "options": [],
            "category": "|Length 5|",
            "description": null
          },
          {
            "index": 4,
            "variable": "sBeamCodes05",
            "type": "PropString",
            "displayName": "     |Beamcodes| 5",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Length 5|",
            "description": null
          },
          {
            "index": 5,
            "variable": "dLength06",
            "type": "PropDouble",
            "displayName": "     |Length| 6",
            "defaultValue": "5400",
            "inputType": "number",
            "options": [],
            "category": "|Length 6|",
            "description": null
          },
          {
            "index": 5,
            "variable": "sBeamCodes06",
            "type": "PropString",
            "displayName": "     |Beamcodes| 6",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "|Length 6|",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6740,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically splits long timber beams into specific maximum stock lengths based on their beam codes, optimizing them for transport or raw material constraints.",
          "category": "Modeling/Optimization",
          "typicalUseCase": "Ensuring that specific structural members (like wall plates or ribs) do not exceed available timber lengths (e.g., cutting 6m beams down to 5.4m stock) before production."
        },
        "parameters": [
          {
            "name": "sequenceNumber",
            "technicalDefault": "0",
            "businessMeaning": "Controls the execution order of this script relative to other scripts assigned to the element during the construction generation phase.",
            "validRange": "0 - 9999",
            "unit": "Integer",
            "affectsOutput": "Determines priority; if multiple scripts modify the same beams, a lower sequence number usually runs first."
          },
          {
            "name": "dLength01",
            "technicalDefault": "2440",
            "businessMeaning": "The target maximum length for beams associated with the first set of beam codes. Beams longer than this will be split.",
            "validRange": "500 - 20000",
            "unit": "mm",
            "affectsOutput": "Triggers a saw cut operation on matching beams if their length exceeds this value."
          },
          {
            "name": "sBeamCodes01",
            "technicalDefault": "",
            "businessMeaning": "A semicolon-separated list of beam codes (e.g., 'PL;R;S') that identify which beams are subject to the Length 1 restriction.",
            "validRange": "Alphanumeric text codes",
            "unit": "Text",
            "affectsOutput": "Acts as a filter; only beams whose code matches this list will be checked and potentially split."
          },
          {
            "name": "dLength02",
            "technicalDefault": "5400",
            "businessMeaning": "The target maximum length for beams associated with the second set of beam codes.",
            "validRange": "500 - 20000",
            "unit": "mm",
            "affectsOutput": "Triggers a saw cut operation on matching beams if their length exceeds this value."
          },
          {
            "name": "sBeamCodes02",
            "technicalDefault": "",
            "businessMeaning": "A semicolon-separated list of beam codes that identify which beams are subject to the Length 2 restriction.",
            "validRange": "Alphanumeric text codes",
            "unit": "Text",
            "affectsOutput": "Acts as a filter; only beams whose code matches this list will be checked and potentially split."
          },
          {
            "name": "dLength03",
            "technicalDefault": "5400",
            "businessMeaning": "The target maximum length for beams associated with the third set of beam codes.",
            "validRange": "500 - 20000",
            "unit": "mm",
            "affectsOutput": "Triggers a saw cut operation on matching beams if their length exceeds this value."
          },
          {
            "name": "sBeamCodes03",
            "technicalDefault": "",
            "businessMeaning": "A semicolon-separated list of beam codes that identify which beams are subject to the Length 3 restriction.",
            "validRange": "Alphanumeric text codes",
            "unit": "Text",
            "affectsOutput": "Acts as a filter; only beams whose code matches this list will be checked and potentially split."
          },
          {
            "name": "dLength04",
            "technicalDefault": "5400",
            "businessMeaning": "The target maximum length for beams associated with the fourth set of beam codes.",
            "validRange": "500 - 20000",
            "unit": "mm",
            "affectsOutput": "Triggers a saw cut operation on matching beams if their length exceeds this value."
          },
          {
            "name": "sBeamCodes04",
            "technicalDefault": "",
            "businessMeaning": "A semicolon-separated list of beam codes that identify which beams are subject to the Length 4 restriction.",
            "validRange": "Alphanumeric text codes",
            "unit": "Text",
            "affectsOutput": "Acts as a filter; only beams whose code matches this list will be checked and potentially split."
          },
          {
            "name": "dLength05",
            "technicalDefault": "5400",
            "businessMeaning": "The target maximum length for beams associated with the fifth set of beam codes.",
            "validRange": "500 - 20000",
            "unit": "mm",
            "affectsOutput": "Triggers a saw cut operation on matching beams if their length exceeds this value."
          },
          {
            "name": "sBeamCodes05",
            "technicalDefault": "",
            "businessMeaning": "A semicolon-separated list of beam codes that identify which beams are subject to the Length 5 restriction.",
            "validRange": "Alphanumeric text codes",
            "unit": "Text",
            "affectsOutput": "Acts as a filter; only beams whose code matches this list will be checked and potentially split."
          },
          {
            "name": "dLength06",
            "technicalDefault": "5400",
            "businessMeaning": "The target maximum length for beams associated with the sixth set of beam codes.",
            "validRange": "500 - 20000",
            "unit": "mm",
            "affectsOutput": "Triggers a saw cut operation on matching beams if their length exceeds this value."
          },
          {
            "name": "sBeamCodes06",
            "technicalDefault": "",
            "businessMeaning": "A semicolon-separated list of beam codes that identify which beams are subject to the Length 6 restriction.",
            "validRange": "Alphanumeric text codes",
            "unit": "Text",
            "affectsOutput": "Acts as a filter; only beams whose code matches this list will be checked and potentially split."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sBeamCodes01 contains a beam code",
            "effect": "The corresponding dLength01 is used to determine if a split is required for beams with that code.",
            "cascade": [
              "dLength01"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Saw Cut / Split",
            "description": "Modifies the geometry of existing beams by splitting them into smaller segments. The split occurs iteratively: it cuts off a piece of the specified length from the center, then checks the remainder.",
            "appliedTo": "Beams within the selected Element whose BeamCode matches one of the six categories and whose length exceeds the specified threshold."
          }
        ]
      },
      "tokens_used": 7964,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"Script launched from TslCatalog or Execute Key\",\n    \"[Check] Determine if properties should be loaded from Catalog (_kExecuteKey) or User Input\",\n    \"[Conditional] If no Execute Key found: Show Properties Dialog to user\",\n    \"User selects one or more Elements via command line prompt\",\n    \"Script erases existing instances of itself on selected elements (cleanup)\",\n    \"Script attaches new instance to selected Elements\",\n    \"[Conditional] Execution Trigger: Wait for Element Constructed, Debug, or Manual Insert flag\",\n    \"[Check] Verify Element is valid (length > 0)\",\n    \"Parse Beam Code properties (sBeamCodes01-06) into arrays\",\n    \"Iterate through all Beams in the Element\",\n    \"[Conditional] Check Beam Code against defined categories (Priority: Length 1 -> 6)\",\n    \"[Conditional] If code matches AND current length > defined max length: Enter Split Loop\",\n    \"[Loop] Calculate cut point (distance = Max Length from start)\",\n    \"Execute dbSplit to separate beam segment\",\n    \"Update beam reference to the remainder segment\",\n    \"[Loop] Repeat until remainder length <= Max Length or loop limit (5) reached\",\n    \"Script erases itself from the Element (Self-destruct after optimization)\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Determine property source on Insertion\",\n      \"path1\": {\n        \"name\": \"Catalog Execution\",\n        \"steps\": [\n          \"_kExecuteKey is valid and found in catalogs\",\n          \"Load properties directly from catalog\",\n          \"Skip user dialog\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Manual Execution\",\n        \"steps\": [\n          \"_kExecuteKey is empty or invalid\",\n          \"Open Properties Dialog\",\n          \"User inputs lengths and beam codes\",\n          \"Save catalog '_LastInserted'\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Beam Code Matching\",\n      \"path1\": {\n        \"name\": \"Match Found\",\n        \"steps\": [\n          \"Beam code found in one of the 6 categories\",\n          \"Compare beam length against category limit\",\n          \"Proceed to Split Logic if too long\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"No Match\",\n        \"steps\": [\n          \"Beam code not found in any category\",\n          \"Beam is ignored and skipped\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Split Loop Evaluation\",\n      \"path1\": {\n        \"name\": \"Beam Too Long\",\n        \"steps\": [\n          \"Current beam length > Max Category Length\",\n          \"Calculate split point\",\n          \"Perform split operation\",\n          \"Remainder becomes the new target beam\",\n          \"Re-evaluate loop condition\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Beam Within Limits\",\n        \"steps\": [\n          \"Current beam length <= Max Category Length\",\n         "
      },
      "tokens_used": 10661,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-OptimizeBeams.mcr\n\n## Overview\nThis script automatically splits long timber beams into specific maximum stock lengths based on their beam codes. It is primarily used to optimize beams for raw material availability or transport constraints (e.g., cutting 6m beams down to 5.4m stock).\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates on 3D Elements and GenBeams. |\n| Paper Space | No | Not designed for 2D drawings or layouts. |\n| Shop Drawing | No | Does not generate drawing views. |\n\n## Prerequisites\n- **Required Entities:** Elements (with assigned GenBeams).\n- **Minimum Beam Count:** 0.\n- **Required Settings:** None (properties are configured manually or via catalogs).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_G-OptimizeBeams.mcr`\n\n### Step 2: Configure Properties\n```\nCommand Line: (Dialog Appears)\nAction: A properties dialog will open automatically upon insertion if not run via an execute key. \n        Set the \"Length\" and \"Beamcodes\" for the 6 available categories here.\n```\n\n### Step 3: Select Elements\n```\nCommand Line: Select one or more elements\nAction: Click on the Elements in the Model Space that contain the beams you wish to optimize.\n        Press Enter to confirm selection.\n```\n\n### Step 4: Automatic Processing\n```\nCommand Line: (Processing...)\nAction: The script automatically scans the selected elements, identifies beams matching the \n        codes, splits them if they exceed the defined lengths, and then removes itself from the \n        element to keep the project clean.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **General** | | | |\n| Sequence number | Integer | 0 | Determines the execution order if multiple TSLs are assigned to the same element. |\n| **Length 1** | | | |\n| Length 1 | Number | 2440 | The maximum allowed length (mm) for beams matching \"Beamcodes 1\". |\n| Beamcodes 1 | Text | \"\" | Semicolon-separated list of beam codes (e.g., \"PL;R\") to apply Length 1 restriction to. |\n| **Length 2** | | | |\n| Length 2 | Number | 5400 | The maximum allowed length (mm) for beams matching \"Beamcodes 2\". |\n| Beamcodes 2 | Text | \"\" | Semicolon-separated list of beam codes to apply Length 2 restriction to. |\n| **Length 3** | | | |\n| Length 3 | Number | 5400 | The maximum allowed length (mm) for beams matching \"Beamcodes 3\". |\n| Beamcodes 3 | Text | \"\" | Semicolon-separated list of beam codes to apply Length 3 restriction to. |\n| **Length 4** | | | |\n| Length 4 | Number | 5400 | The maximum allowed length (mm) for beams matching \"Beamcodes 4\". |\n| Beamcodes 4 | Text | \"\" | Semicolon-separated list of beam codes to apply Length 4 restriction to. |\n| **Length 5** | | | |\n| Length 5 | Number | 5400 | The maximum allowed length (mm) for beams matching \"Beamcodes 5\". |\n| Beamcodes 5 | Text | \"\" | Semicolon-separated list of beam codes to apply Length 5 restriction to. |\n| **Length 6** | | | |\n| Length 6 | Number | 5400 | The maximum allowed length (mm) for beams matching \"Beamcodes 6\". |\n| Beamcodes 6 | Text | \"\" | Semicolon-separated list of beam codes to apply Length 6 restriction to. |\n\n## Right-Click Menu Options\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script performs its action immediately upon insertion or element construction and self-destructs, leaving no persistent menu options on the element. |\n\n## Settings Files\nNone required. All settings are managed through the Properties Palette (OPM).\n\n## Tips\n- **Beam Code Syntax:** When entering beam codes, use a semicolon `;` to separate multiple codes if you want the same length limit applied to different beam types (e.g., `FL;PL`).\n- **Self-Cleaning:** This script automatically deletes itself from the element after it has finished optimizing the beams. You will not see it listed in the element's TSL list afterwards.\n- **Iterative Splitting:** If a beam is significantly longer than the limit (e.g., 12m with a 5.4m limit), the script will split it multiple times until all segments are within the limit.\n\n## FAQ\n- **Q: Why did the script disappear after I ran it?**\n  A: The script is designed to \"self-destruct\" after optimizing the beams. This prevents duplicate optimization and keeps the element properties clean.\n- **Q: How do I apply different lengths to different wall parts?**\n  A: Use the \"Length 1\" through \"Length 6\" categories. Assign the specific beam codes used in your wall layers to the corresponding \"Beamcodes\" field.\n- **Q: Can I use this on a single beam instead of a whole wall?**\n  A: The script operates at the Element level. If you need to optimize a single beam, ensure that beam has a unique Beam Code and apply that code to one of the script categories."
      },
      "tokens_used": 6643,
      "error": null
    }
  }
}