{
  "filename": "Offsetted_Parallel_Housing.mcr",
  "status": "completed",
  "total_tokens": 53095,
  "processing_time": 783.7863261699677,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9493,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script filename does not use 'sd_' or 'Multipage' prefix. Code logic focuses on 3D geometry modification: creating 'House' tools, 'Body' objects, 'FreeProfile', 'Cut' tools, and applying them to beams using 'bm0.addTool()'. It uses 'PrEntity' to select physical beams during insertion. No usage of '_Viewport', 'DrawList', or '#Type E' with '_Entity[]'."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "Element"
          ],
          "minimumBeams": 2,
          "requiredSpace": "3D Model Space containing intersecting beams",
          "requiredSettings": []
        }
      },
      "tokens_used": 7136,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert && !(_kExecuteKey.length()>0 && TslInst().getListOfCatalogNames(scriptName()).findNoCase(_kExecuteKey,-1)>-1)",
              "required": false
            },
            {
              "step": 2,
              "function": "PrEntity.go",
              "promptOriginal": "Select male beams",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrEntity.go",
              "promptOriginal": "Select female beams",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "showDialog",
            "trigger": "On Insert (standard execution)",
            "title": null,
            "dataSource": "Properties defined in script",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sMillToTop",
            "type": "PropString",
            "displayName": "A - Extend mortise",
            "defaultValue": "|No|",
            "inputType": "dropdown",
            "options": [
              "|No|",
              "|Yes|"
            ],
            "category": "|Tool shape|",
            "description": "|Extend mortise to the top edge of female beam|"
          },
          {
            "index": 1,
            "variable": "sMortiseType",
            "type": "PropString",
            "displayName": "B - Mortise shape",
            "defaultValue": "|Minimum|",
            "inputType": "dropdown",
            "options": [
              "|Minimum|",
              "|Normal|",
              "|Maximum|"
            ],
            "category": "|Tool shape|",
            "description": "|Shape of the mortise tool|\n\n|Minimal = All four sides of the beam will be milled|\n|Normal = At the 'inner' side of the angled connection, the pocket will get a chamferd edge.|\n|Maximal = The pocket will get maximum size, so that no air gap results --> maximum two sides of the male beam will be milled.|"
          },
          {
            "index": 2,
            "variable": "sToolShape",
            "type": "PropString",
            "displayName": "C - Round Type",
            "defaultValue": "|not rounded|",
            "inputType": "dropdown",
            "options": [
              "|not rounded|",
              "|round|",
              "|relief|",
              "|rounded with small diameter|",
              "|relief with small diameter|"
            ],
            "category": "|Tool shape|",
            "description": "|Defines the rounding type of the mortise.| (|Shape 'Normal' is always 'not rounded'|)"
          },
          {
            "index": 1,
            "variable": "dDepth",
            "type": "PropDouble",
            "displayName": "D - Mortise depth",
            "defaultValue": "20mm",
            "inputType": "number",
            "options": [],
            "category": "|Tool shape|",
            "description": "|Defines the depth of the mortise.|"
          },
          {
            "index": 0,
            "variable": "dZOff",
            "type": "PropDouble",
            "displayName": "E - Offset vertical",
            "defaultValue": "30mm",
            "inputType": "number",
            "options": [],
            "category": "|Tool offsets|",
            "description": "|Defines the vertical offset of the connection.|"
          },
          {
            "index": 5,
            "variable": "dROff",
            "type": "PropDouble",
            "displayName": "F - Offset right",
            "defaultValue": "0mm",
            "inputType": "number",
            "options": [],
            "category": "|Tool offsets|",
            "description": "|Defines the offset from the right side of the connection.|"
          },
          {
            "index": 6,
            "variable": "dLOff",
            "type": "PropDouble",
            "displayName": "G - Offset left",
            "defaultValue": "0mm",
            "inputType": "number",
            "options": [],
            "category": "|Tool offsets|",
            "description": "|Defines the offset from the left side of the connection.|"
          },
          {
            "index": 2,
            "variable": "dAddDepth",
            "type": "PropDouble",
            "displayName": "H - Gap in depth",
            "defaultValue": "5mm",
            "inputType": "number",
            "options": [],
            "category": "|Tool gaps|",
            "description": "|Defines the gap in depth of the mortise.|"
          },
          {
            "index": 3,
            "variable": "dGapRight",
            "type": "PropDouble",
            "displayName": "I - Gap right",
            "defaultValue": "0mm",
            "inputType": "number",
            "options": [],
            "category": "|Tool gaps|",
            "description": "|Defines the gap at the right side of the mortise.|"
          },
          {
            "index": 4,
            "variable": "dGapLeft",
            "type": "PropDouble",
            "displayName": "J - Gap left",
            "defaultValue": "0mm",
            "inputType": "number",
            "options": [],
            "category": "|Tool gaps|",
            "description": "|Defines the gap at the left side of the mortise.|"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Swap Mortise Extension|",
            "handler": "sTriggerSwapMortiseExtension",
            "action": "Toggles the direction of mortise extension (bSwapMortiseExtension)",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 8795,
      "error": null
    },
    "4": {
      "success": true,
      "data": {},
      "tokens_used": 11129,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"Script Start\",\n    \"Check Execution Mode (Catalog Key present?)\",\n    \"[Branch] If Yes: Load Properties from Catalog\",\n    \"[Branch] If No: Show Standard Dialog\",\n    \"Prompt User: Select Male Beams\",\n    \"Prompt User: Select Female Beams\",\n    \"Filter Selections (Remove duplicates)\",\n    \"Loop through Male Beams\",\n    \"Loop through Female Beams\",\n    \"[Conditional] Check Geometric Compatibility (Parallel? Intersection within bounds?)\",\n    \"[Branch] If Invalid: Skip intersection\",\n    \"[Branch] If Valid: Calculate Intersection Point & Offsets\",\n    \"Create new TSL Instance (Connector)\",\n    \"Erase Placer Instance\",\n    \"Calculate Connector Geometry (Widths, Heights, Offsets based on Properties)\",\n    \"Determine Tool Logic (Mortise Type, Relief Status)\",\n    \"Generate Tools on Male Beam (House, FreeProfile, or Cut)\",\n    \"Generate BeamCuts based on Offsets (Top, Bottom, Left, Right)\",\n    \"Generate Visual Representation\",\n    \"Finish\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Execution Mode Detection\",\n      \"path1\": {\n        \"name\": \"Catalog Execution\",\n        \"steps\": [\n          \"Check _kExecuteKey\",\n          \"Set properties from catalog values\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Standard Execution\",\n        \"steps\": [\n          \"Run showDialog()\",\n          \"User enters values manually\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Intersection Compatibility (during loop)\",\n      \"path1\": {\n        \"name\": \"Incompatible Pair\",\n        \"steps\": [\n          \"Check if Male and Female vectors are parallel\",\n          \"Check if intersection point is within Female beam length\",\n          \"Skip to next iteration (continue)\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Compatible Pair\",\n        \"steps\": [\n          \"Calculate intersection point (LineBeamIntersect)\",\n          \"Create TSL instance\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Tool Generation Strategy (nMortiseType & bHasRelief)\",\n      \"path1\": {\n        \"name\": \"Complex Geometry (House/FreeProfile)\",\n        \"steps\": [\n          \"Check alignment of local Y-axis to Female beam Y-axis\",\n          \"If aligned: Create House tool with rounding\",\n          \"If not"
      },
      "tokens_used": 11101,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Offsetted Parallel Housing\n\n## Overview\nThis script creates a parallel housing (mortise) connection between intersecting timber beams. It calculates and applies cuts to \"male\" beams based on their intersection with \"female\" beams, with detailed controls for offsets, gaps, and tool geometry.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script operates within the 3D model. |\n| Paper Space | No | Not applicable for 2D layouts. |\n| Shop Drawing | No | This is a model generation script. |\n\n## Prerequisites\n- **Required Entities**: GenBeam or Element entities must exist in the drawing.\n- **Minimum Beam Count**: 2 (At least one male beam and one female beam).\n- **Required Settings**: None. The script uses internal logic to determine geometry based on user inputs.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Offsetted_Parallel_Housing.mcr`\n\n### Step 2: Configure Parameters\nUpon insertion, a configuration dialog appears allowing you to set default values for depth, offsets, and gaps before selecting beams.\n\n### Step 3: Select Male Beams\n```\nCommand Line: Select male beams\nAction: Click on the beams that will be cut (the tenons). Press Enter when finished.\n```\n\n### Step 4: Select Female Beams\n```\nCommand Line: Select female beams\nAction: Click on the beams that define the intersection path (the mortises). Press Enter when finished.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| A - Extend mortise | dropdown | No | Extend mortise to the top edge of female beam. |\n| B - Mortise shape | dropdown | Minimum | Shape of the mortise tool. <br> *Minimum: All four sides of the beam will be milled.* <br> *Normal: At the 'inner' side of the angled connection, the pocket will get a chamfered edge.* <br> *Maximum: The pocket will get maximum size, so that no air gap results (maximum two sides of the male beam will be milled).* |\n| C - Round Type | dropdown | not rounded | Defines the rounding type of the mortise. (Shape 'Normal' is always 'not rounded'). |\n| D - Mortise depth | number | 20mm | Defines the depth of the mortise. |\n| E - Offset vertical | number | 30mm | Defines the vertical offset of the connection. |\n| F - Offset right | number | 0mm | Defines the offset from the right side of the connection. |\n| G - Offset left | number | 0mm | Defines the offset from the left side of the connection. |\n| H - Gap in depth | number | 5mm | Defines the gap in depth of the mortise. |\n| I - Gap right | number | 0mm | Defines the gap at the right side of the mortise. |\n| J - Gap left | number | 0mm | Defines the gap at the left side of the mortise. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Swap Mortise Extension | Toggles the direction of the mortise extension. |\n\n## Settings Files\n- No external settings files are required for this script.\n\n## Tips\n- Ensure the selected male and female beams are parallel and actually intersect within their lengths; the script automatically filters out incompatible pairs.\n- Use the **Offsets** (E, F, G) to shift the housing center vertically or laterally if the intersection point does not represent the desired center of the joint.\n- Use the **Gaps** (H, I, J) to create clearance for glue or easier assembly.\n\n## FAQ\n- **Q: Why didn't the script create a tool for one of the beams I selected?**\n  **A:** The script checks geometric compatibility. If the beams are not parallel or do not physically intersect within their bounding boxes, the script will skip that pair.\n- **Q: What is the difference between \"Minimum\" and \"Maximum\" mortise shape?**\n  **A:** \"Minimum\" creates a tighter fit milling all four sides of the male beam. \"Maximum\" creates a larger pocket to prevent air gaps, usually resulting in only two sides of the male beam being milled."
      },
      "tokens_used": 5441,
      "error": null
    }
  }
}