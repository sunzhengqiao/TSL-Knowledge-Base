{
  "filename": "HSB_G-SectionScheme.mcr",
  "status": "completed",
  "total_tokens": 47462,
  "processing_time": 317.6528310775757,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "28.10.2013",
            "author": "AS",
            "changes": "First revision"
          },
          {
            "version": "1.01",
            "date": "07.11.2013",
            "author": "AS",
            "changes": "Send map through memory."
          },
          {
            "version": "1.02",
            "date": "07.11.2013",
            "author": "AS",
            "changes": "Show recalc warning if points are moved."
          },
          {
            "version": "1.03",
            "date": "11.11.2013",
            "author": "AS",
            "changes": "Project plines to plane before adding them to the plane profile."
          },
          {
            "version": "1.04",
            "date": "11.11.2013",
            "author": "AS",
            "changes": "Only move to grip if transform is set to 'yes'."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7444,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Collects entities using _kModelSpace. Uses Display objects for drawing geometry directly without Viewport context. No #Type E or sd_* prefixes found."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementRoof",
            "ERoofPlane"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "HsbDogExe.exe or HsbDog.dll (must exist in hsbCAD Utilities path)"
          ]
        }
      },
      "tokens_used": 5348,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": null,
              "condition": "_bOnInsert",
              "required": false
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "|Select start point of section|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "PrPoint",
              "promptOriginal": "|Select end point of section|",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 4,
              "function": "getPoint",
              "promptOriginal": "|Select a position|",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "seperator01",
            "type": "PropString",
            "displayName": "Scheme",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Scheme",
            "description": null
          },
          {
            "index": 0,
            "variable": "nameTextHeight",
            "type": "PropDouble",
            "displayName": "Text height",
            "defaultValue": 150.0,
            "inputType": "number",
            "options": [],
            "category": "Scheme",
            "description": null
          },
          {
            "index": 1,
            "variable": "nameOffset",
            "type": "PropDouble",
            "displayName": "Offset name",
            "defaultValue": 500.0,
            "inputType": "number",
            "options": [],
            "category": "Scheme",
            "description": null
          },
          {
            "index": 3,
            "variable": "sectionName",
            "type": "PropString",
            "displayName": "Section name",
            "defaultValue": "A-A",
            "inputType": "text",
            "options": [],
            "category": "Scheme",
            "description": null
          },
          {
            "index": 4,
            "variable": "transformSection",
            "type": "PropString",
            "displayName": "Transform section",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Scheme",
            "description": null
          },
          {
            "index": 5,
            "variable": "showMilling",
            "type": "PropString",
            "displayName": "Show milling",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "No",
              "Yes"
            ],
            "category": "Scheme",
            "description": null
          },
          {
            "index": 1,
            "variable": "seperator02",
            "type": "PropString",
            "displayName": "Dimension",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Dimension",
            "description": null
          },
          {
            "index": 2,
            "variable": "defaultDimensionStyle",
            "type": "PropString",
            "displayName": "Default dimension style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "_DimStyles (System List)"
            ],
            "category": "Dimension",
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "|Reload Section Scheme|",
            "handler": "|Reload Section Scheme|",
            "action": "Recalculates the section scheme geometry and details",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9075,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates 2D sectional views and schemes of the roof structure by cutting through roof elements and planes based on a user-defined cutting line, using an external utility (HsbDog) for detail generation.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used during the detailing phase to create cross-section drawings (e.g., A-A, B-B) of roof assemblies for manufacturing or architectural approval."
        },
        "parameters": [
          {
            "name": "nameTextHeight",
            "technicalDefault": "150.0",
            "businessMeaning": "Sets the text size for labels and annotations within the section drawing.",
            "validRange": "50 - 300",
            "unit": "mm",
            "affectsOutput": "Alters the visual size of the section name tag and any text generated by the section scheme."
          },
          {
            "name": "nameOffset",
            "technicalDefault": "500.0",
            "businessMeaning": "Defines the distance the section label is offset from the start point of the section cut line.",
            "validRange": "100 - 2000",
            "unit": "mm",
            "affectsOutput": "Moves the section name marker closer to or further from the section grip point."
          },
          {
            "name": "sectionName",
            "technicalDefault": "A-A",
            "businessMeaning": "The alphanumeric identifier used to label the specific section cut on the drawing.",
            "validRange": "A-Z / 1-99",
            "unit": "string",
            "affectsOutput": "Updates the text displayed on the section marker (e.g., changing 'A-A' to 'Section 1')."
          },
          {
            "name": "transformSection",
            "technicalDefault": "No",
            "businessMeaning": "Controls whether the generated 2D section geometry automatically updates its position when the section's grip points are moved in the model.",
            "validRange": "Yes/No",
            "unit": "bool",
            "affectsOutput": "If 'Yes', the entire generated section moves with the grips. If 'No', the geometry remains static while the grips move, triggering a recalculation warning."
          },
          {
            "name": "showMilling",
            "technicalDefault": "No",
            "businessMeaning": "Specifies whether machining details (e.g., tenons, notches, drill holes) should be calculated and displayed in the 2D section.",
            "validRange": "Yes/No",
            "unit": "bool",
            "affectsOutput": "If 'Yes', the external calculation includes tooling info, resulting in lines representing cuts/holes in the output."
          },
          {
            "name": "defaultDimensionStyle",
            "technicalDefault": "_DimStyles (System List)",
            "businessMeaning": "Selects the specific CAD dimension style (text size, arrowheads, ticks) to apply to all dimensions in the generated section.",
            "validRange": "System defined dimension styles",
            "unit": "style",
            "affectsOutput": "Changes the appearance of all dimension lines in the section to match the selected style."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing 'transformSection' to 'Yes'",
            "effect": "Enables the logic that moves the generated 2D geometry when the script's grip points are dragged.",
            "cascade": [
              "SectionLocation",
              "_Map"
            ]
          },
          {
            "trigger": "Changing 'showMilling'",
            "effect": "Forces a regeneration of the ModelMap data sent to the external calculator to include or exclude tooling data.",
            "cascade": [
              "mmComposeFlags",
              "mapIn",
              "SectionScheme"
            ]
          },
          {
            "trigger": "Changing 'defaultDimensionStyle'",
            "effect": "Updates the display object responsible for drawing dimensions before rendering.",
            "cascade": [
              "dimensionDisplay"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "PLine",
            "description": "2D Polylines representing the geometry of cut roof elements, materials, and outlines.",
            "appliedTo": "Model Space (via Display objects)"
          },
          {
            "type": "DimLine",
            "description": "Dimension lines indicating measurements of the cut components (heights, widths, spacing).",
            "appliedTo": "Model Space (via Display objects)"
          },
          {
            "type": "Text",
            "description": "Annotations including the section name, material labels, and notes.",
            "appliedTo": "Model Space (via Display objects)"
          },
          {
            "type": "Block",
            "description": "Standard CAD blocks (symbols) inserted by the section scheme (e.g., connection hardware symbols).",
            "appliedTo": "Model Space (via Display objects)"
          }
        ]
      },
      "tokens_used": 8095,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"Script Start / Triggered\",\n    \"Check Execution Context (Insert, Debug, Recalc, or Property Change)\",\n    \"[Conditional] If Inserting: Show Dialog -> Get Start Point -> Get End Point -> Get Position Point -> Save Points -> Return\",\n    \"Project Points to World Z-Plane\",\n    \"Collect Roof Elements and Planes from Model Space\",\n    \"Filter Entities: Calculate Envelope Intersection with Section Plane\",\n    \"Compose ModelMap: Prepare Data (Solids, Tools, Hardware) for External Calculator\",\n    \"[Conditional] Check hsbCAD Version (>= 19 uses .hmm/DLL, < 19 uses .dxx/EXE)\",\n    \"Execute External Utility (HsbDog) to Generate Section Geometry\",\n    \"Store Result Map in Internal Memory (_Map)\",\n    \"Initialize Display Objects (Layers, Styles, Text Heights)\",\n    \"Check Point Validity (Auto-generate defaults if missing)\",\n    \"[Conditional] Check 'Transform Section' Property\",\n    \"Render Geometry: Iterate Map to Draw Polylines, Dimensions, Blocks, and Text\",\n    \"[Conditional] Draw 'Recalc Required' Warning if points drifted and transform is disabled\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Execution Mode (_bOnInsert)\",\n      \"path1\": {\n        \"name\": \"Insertion Flow\",\n        \"steps\": [\n          \"Execute showDialog()\",\n          \"Prompt user for Section Start Point (_Pt0)\",\n          \"Prompt user for Section End Point (_PtG[0])\",\n          \"Prompt user for Section Position/Label Point (_PtG[1])\",\n          \"Store points and exit script (wait for update trigger)\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Calculation/Update Flow\",\n        \"steps\": [\n          \"Collect and filter entities\",\n          \"Run external calculation engine\",\n          \"Update internal drawing data\",\n          \"Render visual output\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"hsbCAD Version Check (hsbOEVersion)\",\n      \"path1\": {\n        \"name\": \"Modern Interface (> v18)\",\n        \"steps\": [\n          \"Use .hmm file format\",\n          \"Load HsbDog.dll\",\n          \"Execute via callDotNetFunction2\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Legacy Interface (<= v18)\",\n        \"steps\": [\n          \"Use .dxx file format\",\n          \"Spawn HsbDogExe.exe process\",\n          \"Read output file from disk\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Property 'Transform Section' (Yes/No)\",\n      \"path1\": {\n        \"name\": \"Dynamic Transform (Yes)\",\n        \"steps\": [\n          \"Calculate delta between current grip position and stored 'SectionLocation'\",\n          \"Apply transformation matrix to internal Map geometry\",\n          \"Update 'SectionLocation' in map\",\n          \"Geometry moves visually with the grips\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Static Reference (No)\",\n        \"steps\": [\n          \"Skip transformation of internal Map\",\n          \"Check if Start/End points have moved from stored values\",\n          \"If moved, display 'Recalc Required' warning at grip location\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Detail Type in Map\",\n     "
      },
      "tokens_used": 11185,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_G-SectionScheme\n\n## Overview\nGenerates 2D sectional views and schemes of the roof structure by cutting through roof elements and planes based on a user-defined cutting line. It creates detailed cross-section geometry, dimensions, and annotations directly in Model Space using an external calculation engine.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates here to generate geometry and collect roof entities. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | This is a Model Space generation tool, not a single-component detailing script. |\n\n## Prerequisites\n- **Required Entities**: `ElementRoof` and `ERoofPlane` must exist in the model to generate the section.\n- **Minimum Beam Count**: 0 (Script relies on roof planes and elements rather than a specific count of beams).\n- **Required Settings**: `HsbDogExe.exe` (legacy) or `HsbDog.dll` (modern) must be present in the hsbCAD Utilities path.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `HSB_G-SectionScheme.mcr`\n\n### Step 2: Configure Settings\n```\nCommand Line: [Dialog appears]\nAction: Configure any initial settings in the dialog and click OK.\n```\n\n### Step 3: Define Start Point\n```\nCommand Line: |Select start point of section|\nAction: Click in the Model Space to set the start of the section cut line.\n```\n\n### Step 4: Define End Point\n```\nCommand Line: |Select end point of section|\nAction: Click to set the end of the section cut line. This defines the cut direction through the roof.\n```\n\n### Step 5: Define Position\n```\nCommand Line: |Select a position|\nAction: Click to place the section marker/label and determine the initial location of the generated geometry.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Scheme** | | | |\n| Text height | Number | 150.0 | Sets the height for text labels and annotations in the generated section (in mm). |\n| Offset name | Number | 500.0 | Sets the distance (in mm) the section name label is offset from the section start point. |\n| Section name | Text | A-A | The alphanumeric identifier for the section (e.g., \"A-A\", \"Section 1\"). |\n| Transform section | Dropdown | No | If \"Yes\", the generated 2D geometry moves when you drag the script grips. If \"No\", the geometry stays put and requires a reload if grips are moved. |\n| Show milling | Dropdown | No | If \"Yes\", includes machining details (tenons, holes) in the 2D section view. |\n| **Dimension** | | | |\n| Default dimension style | Dropdown | [System List] | Selects the CAD dimension style (arrows, text size) to apply to all dimensions in the section. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Reload Section Scheme | Recalculates the section geometry. Use this if the roof model changes or if you moved the grip points while \"Transform section\" was set to \"No\". |\n\n## Settings Files\n- **Filename**: `HsbDogExe.exe` or `HsbDog.dll`\n- **Location**: hsbCAD Utilities path (defined in your hsbCAD configuration)\n- **Purpose**: External calculation engine used to process the roof cut and generate the detailed map of polylines, dimensions, and blocks.\n\n## Tips\n- **Moving the Section**: If you plan to move the section cut line frequently, set the **Transform section** property to \"Yes\". This allows the drawing to update dynamically as you drag the grips.\n- **Recalc Warning**: If you see a \"Recalc Required\" warning near your section, it means the cut line moved but the drawing did not update. Right-click the section and choose **Reload Section Scheme**.\n- **Milling Details**: Enable **Show milling** only if you need to see tooling details in the 2D section; this may increase calculation time slightly.\n\n## FAQ\n- **Q: I moved the section grips, but the drawing stayed in the old place.**\n- **A: Your **Transform section** property is likely set to \"No\". Change it to \"Yes\" in the Properties palette to allow dynamic movement, or right-click and select **Reload Section Scheme** to update the geometry at the new location.\n\n- **Q: The script crashes or does nothing when I insert it.**\n- **A: Ensure `HsbDog.exe` or `HsbDog.dll` is installed in your hsbCAD Utilities folder. Also, verify that you have valid Roof Planes (`ERoofPlane`) in your model."
      },
      "tokens_used": 6315,
      "error": null
    }
  }
}