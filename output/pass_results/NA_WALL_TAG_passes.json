{
  "filename": "NA_WALL_TAG.mcr",
  "status": "completed",
  "total_tokens": 38659,
  "processing_time": 423.9232397079468,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 6064,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates on ElementWall objects in the 3D model, generating geometry using Display dp(1) (Model Space index). No 'sd_' prefix, '#Type E', or _Viewport references found. The script explicitly attaches to elements using assignToElementGroup."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "DimStyle 'ARIAL' (optional, used if available)"
          ]
        }
      },
      "tokens_used": 4585,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog (Implied)",
            "trigger": "Insertion (triggered by showDialogOnce)",
            "title": null,
            "dataSource": "Internal Script Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "stDimStyle",
            "type": "PropString",
            "displayName": "DimStyle",
            "defaultValue": "ARIAL",
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": "Display",
            "description": null
          },
          {
            "index": 1,
            "variable": "dTH",
            "type": "PropDouble",
            "displayName": "Text Height. If 0 uses DimStyle",
            "defaultValue": 3.75,
            "inputType": "number",
            "options": [],
            "category": "Display",
            "description": null
          },
          {
            "index": 2,
            "variable": "iStyleToUse",
            "type": "PropInt",
            "displayName": "Style",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              "1",
              "2"
            ],
            "category": "Display",
            "description": null
          },
          {
            "index": 3,
            "variable": "strDispCod",
            "type": "PropString",
            "displayName": "Info Left",
            "defaultValue": "Code",
            "inputType": "dropdown",
            "options": [
              "Nothing",
              "Code",
              "Number",
              "Description",
              "SubType",
              "Information"
            ],
            "category": "Info",
            "description": null
          },
          {
            "index": 4,
            "variable": "strDispNumber",
            "type": "PropString",
            "displayName": "Info Right",
            "defaultValue": "Number",
            "inputType": "dropdown",
            "options": [
              "Nothing",
              "Code",
              "Number",
              "Description",
              "SubType",
              "Information"
            ],
            "category": "Info",
            "description": null
          },
          {
            "index": 5,
            "variable": "stSeperator",
            "type": "PropString",
            "displayName": "Seperator",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Info",
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6204,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically generates and places 3D annotation tags on walls in the model to display user-selected wall properties (Code, Number, Description, etc.), along with a visual projection of the wall outline.",
          "category": "Annotation/ModelTagging",
          "typicalUseCase": "Used during design or coordination to label walls in 3D views for identification, verifying wall types and locations directly in the model without needing to switch to 2D drawings."
        },
        "parameters": [
          {
            "name": "stDimStyle",
            "technicalDefault": "ARIAL",
            "businessMeaning": "Selects the CAD DimStyle (which defines the font) used for the label text.",
            "validRange": "Any DimStyle defined in the current drawing (e.g., STANDARD, ARIAL)",
            "unit": "String",
            "affectsOutput": "Changes the font typeface of the wall tag and the 'Zone 1' text."
          },
          {
            "name": "dTH",
            "technicalDefault": 3.75,
            "businessMeaning": "The specific height of the text in the tag. Allows manual sizing independent of the DimStyle settings.",
            "validRange": "2.0 to 10.0 (inches) depending on model scale",
            "unit": "Inches",
            "affectsOutput": "Scales the text size up or down. If set to 0, the script defaults to the DimStyle's text height."
          },
          {
            "name": "iStyleToUse",
            "technicalDefault": 0,
            "businessMeaning": "Selects the visual style of the tag frame and the arrow pointer geometry.",
            "validRange": "1 or 2",
            "unit": "Count",
            "affectsOutput": "Switches between different geometric border styles for the text and different arrow configurations."
          },
          {
            "name": "strDispCod",
            "technicalDefault": "Code",
            "businessMeaning": "Selects the primary wall attribute to display (Left side).",
            "validRange": "Nothing, Code, Number, Description, SubType, Information",
            "unit": "String",
            "affectsOutput": "Updates the text content on the tag to show the selected wall property (e.g., the Wall Code)."
          },
          {
            "name": "strDispNumber",
            "technicalDefault": "Number",
            "businessMeaning": "Selects the secondary wall attribute to display (Right side).",
            "validRange": "Nothing, Code, Number, Description, SubType, Information",
            "unit": "String",
            "affectsOutput": "Adds a second piece of data to the tag (e.g., the Wall Number) beside the primary attribute."
          },
          {
            "name": "stSeperator",
            "technicalDefault": "",
            "businessMeaning": "The character or string placed between the primary and secondary attributes.",
            "validRange": "Any text string (e.g., ' - ', '/', ' ')",
            "unit": "String",
            "affectsOutput": "Visually separates the two pieces of information in the text label."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "dTH is set to 0",
            "effect": "The text height is determined by the stDimStyle setting instead of the dTH value.",
            "cascade": [
              "stDimStyle"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Text Entity",
            "description": "The label containing the wall information (Code, Number, etc.).",
            "appliedTo": "Model Space (linked to ElementWall)"
          },
          {
            "type": "PLine (Polyline)",
            "description": "A geometric border surrounding the text label, plus an arrow indicator pointing toward the wall.",
            "appliedTo": "Model Space (linked to ElementWall)"
          },
          {
            "type": "PLine (Wall Projection)",
            "description": "A projection of the wall's physical outline, drawn near the label to represent wall thickness and height.",
            "appliedTo": "Model Space (linked to ElementWall)"
          },
          {
            "type": "Text (Zone)",
            "description": "A secondary label indicating 'Zone 1' relative to the wall geometry.",
            "appliedTo": "Model Space (linked to ElementWall)"
          }
        ]
      },
      "tokens_used": 7175,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Launch: Initialize properties (DimStyle, Text Height, Style, Info fields).",
          "Check Trigger: Determine if script is running for Insertion (_bOnInsert) or Modification (_bOnElementListModified).",
          "Insertion Workflow: Show Dialog (Once). Store property values in internal Map.",
          "User Input: Prompt user to 'Select a set of elements' (ElementWall type).",
          "Validation: Verify selected entities are valid ElementWalls. Compile array of walls.",
          "Cloning Process: Iterate through selected walls. Calculate insertion point (ptArrow offset by Z).",
          "Instance Creation: 'dbCreate' new instances of the script for each wall, passing the property Map.",
          "Cleanup: Erase the original 'command' instance. Exit script execution.",
          "Execution Phase (Cloned Instance): Retrieve properties from Map (if present) or use defaults.",
          "Element Safety: Check if linked ElementWall exists and is valid. Erase instance if invalid.",
          "Xref Check: Detect if wall is part of an Xref. Assign script to specific Xref Group or Main Element Group.",
          "Text Composition: Extract Code/Number/Desc from wall based on 'Info Left'/'Info Right' settings. Concatenate with Separator.",
          "Coordinate Calculation: Determine optimal text orientation (UcsX/UcsY) based on current View to ensure readability.",
          "Projection Calculation: Define 'Zone 1' and 'Zone 6' projection lines to calculate label placement relative to the wall.",
          "Snap Logic: Determine if Grip Point (_PtG[0]) is closer to Zone 1 or Zone 6. Snap point to the nearest line. If not on line, snap to nearest endpoint.",
          "Style Branching: Execute Style 1 or Style 2 geometry generation (Text + Border + Arrow).",
          "Final Drawing: Draw 'Zone 1' label, Wall Outline projection, and Start indicator."
        ],
        "conditionalBranches": [
          {
            "condition": "Is _bOnInsert or _bOnElementListModified true?",
            "path1": {
              "name": "Insertion Flow",
              "steps": [
                "Show Dialog",
                "Prompt Selection",
                "Collect Elements",
                "Clone Instances",
                "Erase Self"
              ]
            },
            "path2": {
              "name": "Calculation/Draw Flow",
              "steps": [
                "Load Properties",
                "Validate Element",
                "Populate Text",
                "Draw Geometry"
              ]
            }
          },
          {
            "condition": "Is the Wall inside an Xref?",
            "path1": {
              "name": "Xref Wall",
              "steps": [
                "Get Xref Definition Name",
                "Create/Find Group 'Wall_labels\\<DefinitionName>'",
                "Add script instance to this Group"
              ]
            },
            "path2": {
              "name": "Model Space Wall",
              "steps": [
                "Set Dependency on Element",
                "Assign to Element Group"
              ]
            }
          },
          {
            "condition": "What is the value of 'iStyleToUse'?",
            "path1": {
              "name": "Style 1 (Default)",
              "steps": [
                "Calculate Label Length",
                "Snap Point to closest Zone line",
                "Draw Text (Color 100 or 101)",
                "Draw Polygon Border around Text",
                "No Arrow geometry drawn"
              ]
            },
            "path2": {
              "name": "Style 2",
              "steps": [
                "Calculate Label Length",
                "Snap Point to closest Zone line",
                "Draw Text (Color 201 or 203)",
                "Draw Rectangle Border around Text",
                "Draw Chevron Arrow geometry on right side"
              ]
            }
          },
          {
            "condition": "Is dTH (Text Height) == 0?",
            "path1": {
              "name": "Default Height",
              "steps": [
                "Set Display textHeight to U(3.75)"
              ]
            },
            "path2": {
              "name": "Custom Height",
              "steps": [
                "Set Display textHeight to dTH property value"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Check if DimStyle 'ARIAL' exists in drawing.",
            "errorMessage": "'\\n <ScriptName> ARIAL dimstyle not found'",
            "recovery": "Script defaults to the first available DimStyle in the list (index 0)."
          },
          {
            "check": "Verify selected entities during PrEntity are ElementWall types.",
            "errorMessage": "None (Implicit failure to add to array).",
            "recovery": "User must re-run command and select valid Wall elements."
          },
          {
            "check": "Check if linked Element (_Element[0]) is valid during execution.",
            "errorMessage": "None (Silent erase).",
            "recovery": "If wall is deleted, script instance erases itself automatically."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Move Label",
            "how": "Grip Edit (_PtG[0])",
            "effect": "The text label and border move. The 'Zone' indicator and wall projection lines update their connection points to the new label location. The label snaps to the pre-calculated Zone 1 or Zone 6 lines based on proximity."
          },
          {
            "action": "Change Content/Style",
            "how": "OPM Properties Palette",
            "effect": "Updating 'Info Left/Right' or 'Style' immediately regenerates the text content and border geometry."
          },
          {
            "action": "Update Text Height",
            "how": "OPM Property 'Text Height' or changing the DimStyle.",
            "effect": "Resizes the text and scales the border/arrow geometry proportionally."
          }
        ]
      },
      "tokens_used": 8585,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# NA_WALL_TAG.mcr\n\n## Overview\nThis script automatically creates 3D annotation tags for selected walls in the model. It displays user-configurable wall information (such as Code, Number, or Description) and draws a visual projection of the wall outline directly in the 3D view.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates in the 3D model environment and attaches to ElementWall objects. |\n| Paper Space | No | Not intended for 2D drawings or layouts. |\n| Shop Drawing | No | This is a modeling tool, not a manufacturing detailing script. |\n\n## Prerequisites\n- **Required Entities:** `ElementWall` entities must exist in the model.\n- **Minimum Beam Count:** 0 (This script is not beam-dependent).\n- **Required Settings:** A DimStyle named 'ARIAL' is recommended by default, though any available DimStyle can be selected.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `NA_WALL_TAG.mcr`\n\n### Step 2: Configure Tag Settings\n```\nDialog: Dynamic Properties Dialog\nAction: A dialog will appear automatically. Configure the visual style, text content (Info Left/Right), and DimStyle.\n```\n*Note: You can change these settings later via the Properties Palette.*\n\n### Step 3: Select Walls\n```\nCommand Line: Select a set of elements\nAction: Click on the walls in the model you wish to tag. Press Enter to confirm selection.\n```\n*The script will automatically generate a tag for each selected wall and erase the original command instance.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| DimStyle | dropdown | ARIAL | Selects the CAD text style (font) used for the label. |\n| Text Height. If 0 uses DimStyle | number | 3.75 | Sets the height of the text in inches. If set to 0, the height is defined by the selected DimStyle. |\n| Style | dropdown | 1 | Selects the visual appearance of the tag (border shape and arrow type). Options are `1` or `2`. |\n| Info Left | dropdown | Code | Selects the wall property to display on the left side of the tag (e.g., Code, Number, Description). |\n| Info Right | dropdown | Number | Selects the wall property to display on the right side of the tag. |\n| Seperator | text | [empty] | Enter a character or string to separate the Left and Right information (e.g., \" - \", \"/\"). |\n\n## Right-Click Menu Options\n*Note: This script does not add custom items to the right-click context menu. All modifications are handled via the Properties Palette and Grip Points.*\n\n## Settings Files\n- **Filename:** None\n- **Location:** N/A\n- **Purpose:** This script does not rely on external settings files; all configuration is stored in the script instance properties.\n\n## Tips\n- **Moving Tags:** Click the tag to select it. Use the blue **Grip Point** to drag the label. The label will automatically snap to the nearest \"Zone\" projection line relative to the wall.\n- **Xref Handling:** If you tag a wall inside an Xref, the script automatically manages the group assignment to ensure the tag displays correctly with the external reference.\n- **Quick Updates:** To change the label content (e.g., switch from displaying \"Code\" to \"Description\"), select the tag and change the **Info Left** or **Info Right** properties in the Properties Palette. The text updates immediately.\n- **Visual Styles:** Use **Style 1** for a polygon border or **Style 2** for a rectangular border with a chevron arrow.\n\n## FAQ\n- **Q: What happens if I delete the wall?**\n  - **A:** The tag is linked to the wall. If the wall is deleted, the script instance will automatically erase itself.\n- **Q: Why is my text too small or too large?**\n  - **A:** Check the **Text Height** property. If it is set to 0, the script uses the text height defined in the selected **DimStyle**. Adjust either the property value or the DimStyle settings in the CAD standard manager.\n- **Q: Can I tag multiple walls at once?**\n  - **A:** Yes. During the insertion step, you can window-select or click multiple walls. The script generates a separate tag instance for each selected wall."
      },
      "tokens_used": 6046,
      "error": null
    }
  }
}