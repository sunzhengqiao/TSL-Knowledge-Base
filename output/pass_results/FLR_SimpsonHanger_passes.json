{
  "filename": "FLR_SimpsonHanger.mcr",
  "status": "completed",
  "total_tokens": 50333,
  "processing_time": 283.90893721580505,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9397,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Documentation explicitly states 'Inserted by user in Model Space'. Script uses PrEntity to select Joists and Carrying Beams (3D entities). Creates 3D geometry (Body, GenBeam) and attaches to groups. No 'sd_' prefix or '_Viewport' references found."
        },
        "prerequisites": {
          "requiredEntities": [
            "Beam (Joists)",
            "Beam (Carrying Beams)"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": [
            ".NET .dll located at <hsb install>\\Excel\\ExcelReader\\ExcelData.dll",
            "Excel file located at <hsb Company>\\Excel\\HangerList.xls",
            "Script FLR_HangerList.mcr (used to import Excel data into Map)"
          ]
        }
      },
      "tokens_used": 7260,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Select Joists, all must be parallel\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      },\n      {\n        \"step\": 2,\n        \"function\": \"PrEntity\",\n        \"promptOriginal\": \"Select Carrying Beams\",\n        \"condition\": \"_bOnInsert\",\n        \"required\": true\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [],\n  \"opmProperties\": [\n    {\n      \"index\": 0,\n      \"variable\": \"psRunMode\",\n      \"type\": \"PropString\",\n      \"displayName\": \"Execution Mode\",\n      \"defaultValue\": \"Standard\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\n        \"Standard\",\n        \"Manual\"\n      ],\n      \"category\": null,\n      \"description\": null\n    },\n    {\n      \"index\": 1,\n      \"variable\": \"psNotes\",\n      \"type\": \"PropString\",\n"
      },
      "tokens_used": 10152,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automates the insertion"
      },
      "tokens_used": 10024,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Execution Start",
          "Check MapObject for Hanger Library ('Hangers:Simpson')",
          "[Branch] Is Map Valid & Drawing Path Match?",
          "[Branch No] Execute FLR_HangerList.mcr to Import/Update Library",
          "Declare Properties (RunMode, Nails, Stiffeners, Backers, etc.)",
          "Set Context Menu Trigger ('Update Hanger List')",
          "[Check] Is Insertion (_bOnInsert)?",
          "[Yes] Start Input Loop (While True)",
          "Prompt: Select Joists (PrEntity - Beams/Trusses)",
          "Filter: Check Joists are perpendicular to Header",
          "Prompt: Select Carrying Beams (PrEntity - Beams/Trusses)",
          "Filter & Sort Joists by position along Header vector",
          "Create Slave TSL Instance (dbCreate) passing filtered arrays",
          "Loop continues until selection breaks",
          "[No / Slave Instance] Retrieve Entities from _Map",
          "Calculate Joist Geometry (Width, Height, Depth, Holes)",
          "[Branch] Execution Mode: Standard vs Manual",
          "Lookup Hanger Model in Library (Map match) or Use Custom Name",
          "Validate Joist Width vs Library Tolerance",
          "Generate/Update 3D Hanger Body",
          "Process Web Stiffeners (If Enabled & TJI Joist)",
          "Process Backer Blocks (If Enabled)",
          "Apply Cuts/Tools to Joists (End gap, Holes)",
          "Update Export Data (_Map, DXA, Hardware)",
          "Script End"
        ],
        "conditionalBranches": [
          {
            "condition": "MapObject Validity / Context Menu Trigger",
            "path1": {
              "name": "Update Library",
              "steps": [
                "Execute FLR_HangerList.mcr",
                "Read Excel File via .NET",
                "Populate 'Hangers:Simpson' Map",
                "Report success/failure"
              ]
            },
            "path2": {
              "name": "Use Cached Data",
              "steps": [
                "Verify stLastDwgRun matches current path",
                "Load existing mpHangerLibrary"
              ]
            }
          },
          {
            "condition": "_bOnInsert Flag",
            "path1": {
              "name": "Master / Insertion Mode",
              "steps": [
                "Prompt user for selections",
                "Filter geometry",
                "Clone script for each valid joist/header pair"
              ]
            },
            "path2": {
              "name": "Slave / Recalc Mode",
              "steps": [
                "Restore Joist/Header from _Map",
                "Re-evaluate geometry and properties",
                "Update model"
              ]
            }
          },
          {
            "condition": "Execution Mode Property",
            "path1": {
              "name": "Standard",
              "steps": [
                "Calculate geometry key (e.g., '2x8_Face')",
                "Lookup mpHangerLibrary for parameters",
                "Auto-fill Nail/Model properties"
              ]
            },
            "path2": {
              "name": "Manual",
              "steps": [
                "Skip library lookup",
                "Use OPM values explicitly for Model/Nails"
              ]
            }
          },
          {
            "condition": "Web Stiffener Property ('Yes' vs 'No')",
            "path1": {
              "name": "Enabled",
              "steps": [
                "Check Joist type (TJI/Standard)",
                "Create stiffener beam",
                "Assign to groups and _Map"
              ]
            },
            "path2": {
              "name": "Disabled",
              "steps": [
                "Erase existing stiffener beam from database",
                "Remove from _Map"
              ]
            }
          },
          {
            "condition": "Backer Block Property",
            "path1": {
              "name": "Single / Double",
              "steps": [
                "Calculate backer dimensions based on Joist depth",
                "Create Front/Back beams",
                "Assign Extrusion Profile"
              ]
            },
            "path2": {
              "name": "None",
              "steps": [
                "Erase existing Backer beams (bmBackF, bmBackB)",
                "Remove from _Map"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "MapObject 'Hangers:Simpson' Existence",
            "errorMessage": "Implicit failure if map length is 0",
            "recovery": "Right-click 'Update Hanger List' to re-import Excel data"
          },
          {
            "check": "Joist Selection Orientation",
            "errorMessage": "Non-perpendicular joists are filtered silently",
            "recovery": "User must select joists perpendicular to carrying beam"
          },
          {
            "check": "Element Assignment during Insert",
            "errorMessage": "Script erases instance if Header has no valid Element",
            "recovery": "Select valid structural entities"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Hanger Type/Nails",
            "how": "OPM Properties (Execution Mode, Nail dropdowns)",
            "effect": "Script recalculates geometry; updates Hardware BOM list"
          },
          {
            "action": "Toggle Accessories",
            "how": "OPM Properties (Web Stiffener, Backer Block)",
            "effect": "Adds or removes 3D accessory beams; updates Joist tools"
          },
          {
            "action": "Update Hanger Library",
            "how": "Right-click Context Menu > Update Hanger List",
            "effect": "Re-runs Excel import script; refreshes available hangers database"
          },
          {
            "action": "Geometric Update",
            "how": "Moving Joists or Header Beams",
            "effect": "TSL recalcs position and size based on new beam locations"
          }
        ]
      },
      "tokens_used": 8652,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# FLR_SimpsonHanger.mcr\n\n## Overview\nAutomates the insertion and sizing of Simpson Strong-Tie joist hangers based on the geometry of selected joists and carrying beams. It also supports the automatic generation of web stiffeners and backer blocks based on configuration rules.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be inserted in 3D model context. |\n| Paper Space | No | Not supported for detail views. |\n| Shop Drawing | No | Not a shop drawing script. |\n\n## Prerequisites\n- **Required Entities**:\n  - Joist Beams or Trusses (must be parallel to each other).\n  - Carrying Beams (Headers).\n- **Minimum Beam Count**: At least one Joist and one Carrying Beam.\n- **Required Settings**:\n  - `.NET` DLL: `ExcelData.dll` located in `<hsb install>\\Excel\\ExcelReader\\`.\n  - Excel Database: `HangerList.xls` located in `<hsb Company>\\Excel\\`.\n  - Dependent Script: `FLR_HangerList.mcr` (used to import Excel data).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `FLR_SimpsonHanger.mcr` from the file dialog.\n\n### Step 2: Select Joists\n```\nCommand Line: Select Joists, all must be parallel\nAction: Click to select the joist beams that require hangers. Press Enter to confirm selection.\n```\n*Note: All selected joists must be parallel to each other. Non-perpendicular joists relative to the header will be filtered out automatically.*\n\n### Step 3: Select Carrying Beams\n```\nCommand Line: Select Carrying Beams\nAction: Click to select the beam(s) that the joists bear onto (the rim beam or header). Press Enter to confirm.\n```\n*Note: The script will automatically calculate the placement for each joist against the selected carrying beam.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Options | Description |\n|-----------|------|---------|-------------|\n| Execution Mode | Dropdown | Standard / Manual | **Standard**: Automatically selects hanger model based on Excel library lookup.<br>**Manual**: Allows user to specify hanger model and nails manually. |\n| Notes | String | - | User-defined text notes for the instance. |\n| Web Stiffener | Dropdown | Yes / No | (If available) Toggles the creation of a stiffener beam inside TJI joist webs. |\n| Backer Block | Dropdown | None / Single / Double | (If available) Toggles the creation of backer blocks between joists. |\n| Nails / Model | Text / Dropdown | Varied | In **Manual** mode, allows direct input of hanger model name and nail patterns. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Update Hanger List | Executes the import routine to refresh the hanger library from the Excel file. Use this if you have added new hangers to `HangerList.xls`. |\n\n## Settings Files\n- **Filename**: `HangerList.xls`\n- **Location**: `<hsb Company>\\Excel\\`\n- **Purpose**: Acts as the database for Simpson hanger properties. It contains dimensions, model names, and nail patterns that the script queries to match the joist geometry.\n\n## Tips\n- **Standard vs Manual Mode**: Use \"Standard\" mode for automatic efficiency. Only switch to \"Manual\" if you need to force a specific hanger that the automatic lookup missed.\n- **Orientation**: Ensure your joists are modeled perpendicular to the carrying beam. The script filters out joists that are not perpendicular.\n- **Library Updates**: If you change the Excel file, you must right-click the script instance and select \"Update Hanger List\" to see the changes in the current drawing session.\n- **Grouping**: The script creates slave instances attached to specific joists. Modifying the master instance properties usually updates all slaves, or you can modify individual slaves via the Properties palette.\n\n## FAQ\n- **Q: Why did the hanger not appear on one of my joists?**\n- **A**: The script filters for joists that are perpendicular to the carrying beam. If the joist is skewed or not parallel to the others selected, it may be ignored.\n- **Q: How do I fix \"Implicit failure if map length is 0\"?**\n- **A**: This means the hanger library is empty. Ensure `HangerList.xls` exists in your Company folder and run the \"Update Hanger List\" command from the right-click menu.\n- **Q: Can I use this for I-Joists (TJI)?**\n- **A**: Yes, the script has specific logic for TJI joists, including options for web stiffeners. Ensure the joist type is defined correctly in your hsbCAD settings."
      },
      "tokens_used": 4848,
      "error": null
    }
  }
}