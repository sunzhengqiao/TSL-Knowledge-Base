{
  "filename": "hsbScarfJoint.mcr",
  "status": "completed",
  "total_tokens": 50553,
  "processing_time": 439.6094410419464,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.7",
            "date": "05mar20",
            "author": "david.delombaerde@hsbcad.com",
            "changes": "setting boundaries when moving the grippoint. And resetting the value when grip is out of bounds."
          },
          {
            "version": "1.6",
            "date": "05dec17",
            "author": "th@hsbCAD.de",
            "changes": "bugfix, offset from axis"
          },
          {
            "version": "1.5",
            "date": "19jan15",
            "author": "th@hsbCAD.de",
            "changes": "drill offset now supports relative value to tool length, 0 = one centered drill"
          },
          {
            "version": "1.4",
            "date": "19jan15",
            "author": "th@hsbCAD.de",
            "changes": "properties revised and extended, relative properties supported, catalog based insertion supported"
          },
          {
            "version": "1.3",
            "date": "08aug13",
            "author": "th@hsbCAD.de",
            "changes": "new type lap added"
          },
          {
            "version": "1.2",
            "date": "07mai13",
            "author": "th@hsbCAD.de",
            "changes": "Simple Scarf optimized using Simple Scarf instead of a Double Cut, new property offset for simple scarf"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 8192,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script manipulates 3D geometry using Beam.dbSplit and adds 3D tools (ScarfJoint, Drill, Cut). It uses PrEntity to select Beams and accesses the _Beam array. There are no 'sd_' prefixes, no 'Entity' arrays, no _Viewport references, and no drawing generation logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam"
          ],
          "minimumBeams": 2,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 7230,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select a set of beams",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Select insertion point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Standard Properties Dialog",
            "trigger": "Insertion (unless executed with catalog key)",
            "title": "hsbScarfJoint Properties",
            "dataSource": "OPM Properties",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "sType",
            "type": "PropString",
            "displayName": "Type",
            "defaultValue": "Simple Scarf Joint",
            "inputType": "dropdown",
            "options": [
              "Simple Scarf Joint",
              "Double Scarf Joint",
              "Lap"
            ],
            "category": "Tooling",
            "description": "Select the type of scarf joinery."
          },
          {
            "index": 1,
            "variable": "sLength",
            "type": "PropString",
            "displayName": "Length",
            "defaultValue": "*2",
            "inputType": "text",
            "options": [],
            "category": "Geometry",
            "description": "The length of the tool Absolute values or relative values to beam dimension supported, i.e. *0.25 for the value of 25% of the beam dimension"
          },
          {
            "index": 2,
            "variable": "sDepth",
            "type": "PropString",
            "displayName": "Depth",
            "defaultValue": "*0.15",
            "inputType": "text",
            "options": [],
            "category": "Geometry",
            "description": "The depth of the tool Absolute values or relative values to beam dimension supported, i.e. *0.25 for the value of 25% of the beam dimension"
          },
          {
            "index": 0,
            "variable": "dDiameter",
            "type": "PropDouble",
            "displayName": "Diameter",
            "defaultValue": 18.0,
            "inputType": "number",
            "options": [],
            "category": "Drill",
            "description": "The diameter of the connecting drill"
          },
          {
            "index": 3,
            "variable": "sDrillOffset",
            "type": "PropString",
            "displayName": "X-Offset",
            "defaultValue": "0",
            "inputType": "text",
            "options": [],
            "category": "Drill",
            "description": "The offset of the drill in length Absolute value or relative value to length of tool supported, i.e. *0.5 to place the drills with an offset of 50% of the tool length"
          },
          {
            "index": 1,
            "variable": "dOffset",
            "type": "PropDouble",
            "displayName": "Offset from Axis",
            "defaultValue": 0.0,
            "inputType": "number",
            "options": [],
            "category": "Geometry",
            "description": "Defines the vertical offset of the tool. (Simple Scarf only)"
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Flip X",
            "handler": "|Flip X|",
            "action": "Flips the scarf joint orientation along the local X-axis.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9826,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the creation of structural scarf joints (splicing) between two timber beams, including cutting the geometry and placing connection drills.",
          "category": "Joinery/Framing",
          "typicalUseCase": "Connecting two shorter timber beams to create a longer continuous member (e.g., extending a wall plate or a rafter)."
        },
        "parameters": [
          {
            "name": "sType",
            "technicalDefault": "\"Simple Scarf Joint\"",
            "businessMeaning": "Selects the specific joinery geometry: Simple Scarf (single slope), Double Scarf (two slopes meeting at a peak), or Lap.",
            "validRange": "N/A (List selection: Simple Scarf Joint, Double Scarf Joint, Lap)",
            "unit": "N/A",
            "affectsOutput": "Changes the 3D shape of the cut applied to the beam ends."
          },
          {
            "name": "sLength",
            "technicalDefault": "\"*2\"",
            "businessMeaning": "The longitudinal length of the joint (slope length). Controls how long the taper is along the beam.",
            "validRange": "Typically *1.5 to *3 (relative to beam height) or 300mm to 1000mm absolute.",
            "unit": "mm (or multiplier)",
            "affectsOutput": "A longer length increases the gluing/nailing surface area for better structural integrity."
          },
          {
            "name": "sDepth",
            "technicalDefault": "\"*0.15\"",
            "businessMeaning": "The vertical depth of the cut from the top/bottom face towards the center.",
            "validRange": "Typically *0.1 to *0.25 (10% to 25% of beam height).",
            "unit": "mm (or multiplier)",
            "affectsOutput": "Controls the thickness of the remaining material at the thinnest point of the joint."
          },
          {
            "name": "dDiameter",
            "technicalDefault": "18.0",
            "businessMeaning": "The diameter of the bolts/dowels used to secure the splice.",
            "validRange": "12mm to 24mm (Standard timber bolt sizes).",
            "unit": "mm",
            "affectsOutput": "Determines the size of the drilled holes."
          },
          {
            "name": "sDrillOffset",
            "technicalDefault": "\"0\"",
            "businessMeaning": "The distance of the bolt holes from the center point along the joint length.",
            "validRange": "0 (single centered hole) to 200mm (two symmetric holes), or *0.5 (50% of tool length).",
            "unit": "mm (or multiplier)",
            "affectsOutput": "If 0, creates one centered drill. If >0, creates two drills symmetrically placed."
          },
          {
            "name": "dOffset",
            "technicalDefault": "0.0",
            "businessMeaning": "Vertical offset of the joint center from the beam's central axis.",
            "validRange": "0 to sDepth value.",
            "unit": "mm",
            "affectsOutput": "Shifts the scarf cut up or down. Only effective for Simple Scarf type."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sType changes to 'Double Scarf Joint' or 'Lap'",
            "effect": "The 'Offset from Axis' (dOffset) is forced to 0 (disabled) as these types are symmetric.",
            "cascade": [
              "dOffset"
            ]
          },
          {
            "trigger": "sType changes to 'Lap'",
            "effect": "The 'Depth' (sDepth) is ignored and internally forced to 50% of beam height.",
            "cascade": [
              "sDepth"
            ]
          },
          {
            "trigger": "sDrillOffset is 0",
            "effect": "Only a single centered Drill is created.",
            "cascade": []
          },
          {
            "trigger": "sDrillOffset > 0",
            "effect": "Two Drills are created based on the offset value.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "ScarfJoint / SimpleScarf / BeamCut",
            "description": "The 3D volume subtracted from the beams to create the splice geometry.",
            "appliedTo": "The two beams selected by the user."
          },
          {
            "type": "Drill",
            "description": "Cylindrical holes for mechanical fasteners (bolts/dowels).",
            "appliedTo": "Both selected beams."
          },
          {
            "type": "Cut",
            "description": "Internal utility used to align the beam ends exactly at the joint center.",
            "appliedTo": "Both selected beams."
          }
        ]
      },
      "tokens_used": 8598,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "User launches script (hsbScarfJoint.mcr)",
          "Check if executing from catalog key (_kExecuteKey)",
          "[Conditional] Display Properties Dialog (showDialog) if no catalog key or invalid key provided",
          "[Conditional] Load properties from Catalog if valid key found",
          "Validate and default string properties (Length/Depth/DrillOffset) for numeric/relative values",
          "User selects a set of beams (PrEntity)",
          "User selects insertion point (getPoint)",
          "Script creates temporary instance on each selected beam at insertion point",
          "Original script instance erases itself (eraseInstance)",
          "New instances run logic: Validate Beam count (must be 2)",
          "Calculate Length/Depth/Offset values (handling relative values with '*')",
          "Determine Joint Type (Simple, Double, Lap) and configure geometry",
          "Add Tools to Beams: ScarfJoint/SimpleScarf/BeamCut, Cuts, and Drills",
          "Draw visual representation (Display)",
          "Script enters 'Recalc' state waiting for user modifications"
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Method (Insert)",
            "path1": {
              "name": "Catalog Execution",
              "steps": [
                "Check if _kExecuteKey matches a catalog entry",
                "If match found: Load properties from catalog",
                "Skip dialog display",
                "Proceed to entity selection"
              ]
            },
            "path2": {
              "name": "Standard/Interactive Execution",
              "steps": [
                "Check if _kExecuteKey is empty or invalid",
                "Display Properties Dialog (showDialog)",
                "User confirms inputs",
                "Proceed to entity selection"
              ]
            }
          },
          {
            "condition": "Initial Property Values (Length/Depth)",
            "path1": {
              "name": "Valid/Absolute Value",
              "steps": [
                "Property parsed to double > 0",
                "Value used directly"
              ]
            },
            "path2": {
              "name": "Relative Value",
              "steps": [
                "Property string starts with '*'",
                "Multiplier extracted",
                "Calculated as (Multiplier * Beam Dimension)",
                "Value used"
              ]
            },
            "path3": {
              "name": "Invalid/Empty Value",
              "steps": [
                "Value <= 0 or format error",
                "Replaced with hardcoded default (e.g., 500mm for Length)",
                "Report message shown to user"
              ]
            }
          },
          {
            "condition": "Joint Type (sType)",
            "path1": {
              "name": "Simple Scarf (Type 0)",
              "steps": [
                "Use SimpleScarf tool",
                "Apply 'Offset from Axis' (clamped to max Depth)",
                "Apply specified Depth"
              ]
            },
            "path2": {
              "name": "Double Scarf (Type 1)",
              "steps": [
                "Use ScarfJoint tool",
                "Force 'Offset from Axis' to 0 (disable property)",
                "Apply specified Depth"
              ]
            },
            "path3": {
              "name": "Lap (Type 2)",
              "steps": [
                "Use BeamCut tool",
                "Force Depth to 50% of Beam Height",
                "Ignore 'Offset from Axis'"
              ]
            }
          },
          {
            "condition": "Drill Offset (sDrillOffset)",
            "path1": {
              "name": "Centered Drill",
              "steps": [
                "Offset is 0 or not > 0",
                "Create 1 Drill at center point (or 25% length for Double Scarf default)"
              ]
            },
            "path2": {
              "name": "Offset Drills",
              "steps": [
                "Offset > 0",
                "Create 2 Drills symmetrically around center based on Offset value"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Count",
            "errorMessage": "Missing beam. Tool will be deleted.",
            "recovery": "Ensure exactly two beams are selected or generated by the split process. Script auto-deletes if count < 2."
          },
          {
            "check": "Insertion Point Bounds (Grip Edit)",
            "errorMessage": "None (Silent reset)",
            "recovery": "If the user drags the insertion point past the end of either beam, the script detects the out-of-bounds condition and resets the point to the valid position before the drag started."
          },
          {
            "check": "Simple Scarf Offset vs Depth",
            "errorMessage": "None (Auto-correct)",
            "recovery": "If 'Offset from Axis' is greater than 'Depth', the script clamps the Offset value to match the Depth."
          },
          {
            "check": "Drill Offset vs Tool Length",
            "errorMessage": "None (Auto-correct)",
            "recovery": "If calculated drill offset is greater than the tool length, it is clamped to the tool length."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Edit Geometry Parameters",
            "how": "OPM (Object Properties Palette)",
            "effect": "Modifying Length, Depth, or Diameter immediately recalculates the geometry. Changing Type switches the joinery logic completely."
          },
          {
            "action": "Flip Orientation",
            "how": "Context Menu -> 'Flip X'",
            "effect": "Toggles the slope direction of the scarf joint (up/down or left/right) by multiplying the Z-vector by -1."
          },
          {
            "action": "Move Joint Location",
            "how": "Grip Edit (Drag the insertion point)",
            "effect": "Moves the split point along the beams. Includes boundary checks to prevent moving past the beam ends."
          }
        ]
      },
      "tokens_used": 10028,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbScarfJoint\n\n## Overview\nAutomates the creation of structural scarf joints to splice two timber beams together, including the angled cuts and connection drill holes.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates in 3D to modify beam geometry. |\n| Paper Space | No | Not designed for 2D drawing views. |\n| Shop Drawing | No | Geometry is created in the model, not directly on layouts. |\n\n## Prerequisites\n- **Required entities**: 2 Timber Beams (`GenBeam`).\n- **Minimum beam count**: 2.\n- **Required settings files**: None (Catalogs supported but optional).\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbScarfJoint.mcr`\n\n### Step 2: Configure Properties (If prompted)\n```\nCommand Line: None\nAction: If the Properties Dialog appears, select the Joint Type and dimensions. \nNote: This step is skipped if the script is executed using a predefined Catalog key.\n```\n\n### Step 3: Select Beams\n```\nCommand Line: Select a set of beams\nAction: Click on the two beams you want to join together.\n```\n\n### Step 4: Select Insertion Point\n```\nCommand Line: Select insertion point\nAction: Click on the location in 3D space where you want the two beams to meet (the center of the splice).\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Type | dropdown | Simple Scarf Joint | Select the geometry style: Simple Scarf, Double Scarf, or Lap. |\n| Length | text | *2 | The length of the joint slope. Use `*` for relative values (e.g., `*0.25` = 25% of beam height). |\n| Depth | text | *0.15 | The depth of the cut. Use `*` for relative values (e.g., `*0.15` = 15% of beam height). |\n| Diameter | number | 18.0 | The diameter of the bolt/drill holes. |\n| X-Offset | text | 0 | The offset of the drills from the center along the length. Use `0` for one centered drill. |\n| Offset from Axis | number | 0.0 | Vertical offset of the joint from the beam center line (Only for Simple Scarf). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Flip X | Reverses the orientation of the scarf slope (e.g., slopes up instead of down). |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not require external settings files, though it can load configurations from hsbCAD Catalogs.\n\n## Tips\n- **Relative Values**: Use the `*` symbol for dimensions to make the joint scalable. For example, setting Length to `*2` automatically adjusts the cut length if the beam height changes.\n- **Drill Placement**: To create two drills instead of one centered hole, set the **X-Offset** property to a value greater than 0 (e.g., `100` or `*0.1`).\n- **Lap Joints**: When Type is set to **Lap**, the Depth property is ignored; the joint automatically cuts to 50% of the beam height.\n- **Moving the Joint**: You can click and drag the script's insertion point (grip) to slide the joint along the beams. The script prevents you from dragging it past the ends of the beams.\n\n## FAQ\n- **Q: Why is my \"Offset from Axis\" property not changing the beam?**\n  A: The \"Offset from Axis\" only works for the \"Simple Scarf Joint\" type. If you are using \"Double Scarf\" or \"Lap\", this value is forced to zero.\n- **Q: Can I use this on beams of different sizes?**\n  A: Yes, the script calculates the cuts individually for each selected beam.\n- **Q: What happens if I drag the grip point too far?**\n  A: The script includes boundary checks. If you try to drag the joint past the end of a beam, it will snap back to the previous valid position."
      },
      "tokens_used": 6679,
      "error": null
    }
  }
}