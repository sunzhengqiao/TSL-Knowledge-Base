{
  "filename": "Remove Project Group Data.mcr",
  "status": "completed",
  "total_tokens": 17670,
  "processing_time": 175.09775114059448,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 0,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [
          {
            "version": "1.0",
            "date": "22-11-2022",
            "author": "",
            "changes": "Tsl to remove project grouping data with format Hsb_<grouping type>Child"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 2189,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Explicit usage of `_kModelSpace` in `Group().collectEntities` to locate TSL instances. The script modifies `Element` subMapX data and uses `PrEntity` for selection. No `_Viewport`, `_kPaperSpace`, `sd_` prefixes, or `Sheet` entities are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element",
            "TslInst"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space",
          "requiredSettings": []
        }
      },
      "tokens_used": 2326,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getGenBeam",
              "promptOriginal": "|Select elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 2851,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "A utility script to clean specific project grouping metadata (keys matching the format 'HSB_<type>Child') from selected elements and refresh grouping visualizations.",
          "category": "Data Management / Maintenance",
          "typicalUseCase": "Used to reset or remove corrupted project grouping data from specific elements without deleting the elements themselves."
        },
        "parameters": [
          {
            "name": "_Element",
            "technicalDefault": "Empty Array",
            "businessMeaning": "The collection of structural elements (walls, floors, roofs) selected by the user to be processed for data removal.",
            "validRange": "1 or more Elements",
            "unit": "Count",
            "affectsOutput": "Determines which elements will have their internal grouping properties (SubMapX keys starting with 'HSB_' and ending with 'CHILD') permanently deleted."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "User selects Elements via the command line prompt",
            "effect": "The script iterates through the selection to remove specific data keys and triggers a refresh of relevant visualization scripts.",
            "cascade": [
              "Element.subMapXKeys",
              "TslInst.recalc"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Metadata Removal",
            "description": "Deletes specific internal attributes (keys formatted as Hsb_...Child) from the Element's property map.",
            "appliedTo": "User-selected Elements"
          },
          {
            "type": "Script Recalculation",
            "description": "Forces an update of grouping visualization scripts (e.g., 'HSB_I-ShowGroupingInformation', 'Batch & Stack Info') to reflect the removal of data.",
            "appliedTo": "TslInst entities found in ModelSpace"
          }
        ]
      },
      "tokens_used": 2031,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script instance is inserted into the drawing.",
          "2. System checks the insert cycle count.",
          "3. Command line prompts user to 'Select elements'.",
          "4. User selects one or more Elements (Walls/Floors/Roofs).",
          "5. Script stores the selection in the internal _Element property and pauses (returns).",
          "6. System triggers a recalculation of the script instance.",
          "7. Script iterates through the selected Elements.",
          "8. For each Element, script retrieves all SubMapX keys.",
          "9. Script checks every key to see if it starts with 'HSB_' and ends with 'CHILD' (case-insensitive).",
          "10. Keys matching the criteria are removed from the Element's SubMapX data.",
          "11. Script scans the entire Model Space for TSLInst entities.",
          "12. Script checks if found TSLInsts are specific grouping visualization scripts ('HSB_I-ShowGroupingInformation', 'Batch & Stack Info').",
          "13. Matching visualization scripts are recalculated to reflect the data removal.",
          "14. Script erases its own instance from the drawing."
        ],
        "conditionalBranches": [
          {
            "condition": "Check insert cycle count (insertCycleCount > 1)",
            "path1": {
              "name": "Recursive Execution Detected",
              "steps": [
                "Script calls eraseInstance()",
                "Script execution stops immediately"
              ]
            },
            "path2": {
              "name": "First Execution",
              "steps": [
                "Proceed to prompt user for element selection"
              ]
            }
          },
          {
            "condition": "User Selection Input (elementSet.go())",
            "path1": {
              "name": "Selection Successful",
              "steps": [
                "Selected Elements are appended to _Element array",
                "Script proceeds to processing loop"
              ]
            },
            "path2": {
              "name": "Selection Cancelled/Empty",
              "steps": [
                "Script returns without populating array",
                "Processing loop is skipped (0 iterations)",
                "Visualization TSLs are still refreshed",
                "Script erases self"
              ]
            }
          },
          {
            "condition": "SubMapX Key Pattern Match (starts with 'HSB_' AND ends with 'CHILD')",
            "path1": {
              "name": "Match Found",
              "steps": [
                "Key is identified as Project Grouping Data",
                "el.removeSubMapX() is called for that specific key"
              ]
            },
            "path2": {
              "name": "No Match",
              "steps": [
                "Key is ignored",
                "Script moves to the next key"
              ]
            }
          },
          {
            "condition": "TSLInst Script Name Match",
            "path1": {
              "name": "Target Visualization Script Found",
              "steps": [
                "tsl.recalc() is triggered to update graphics"
              ]
            },
            "path2": {
              "name": "Other Script",
              "steps": [
                "Instance is ignored",
                "Loop continues"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Type Selection",
            "errorMessage": "Implicit: PrEntity filter only allows valid Element entities to be selected.",
            "recovery": "User must select valid structural elements (Walls, Floors, Roofs) as prompted."
          },
          {
            "check": "Selection Availability",
            "errorMessage": "None (Silent fail). If selection is cancelled, script simply cleans up and exits.",
            "recovery": "User must re-insert the script to try again."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None",
            "how": "N/A",
            "effect": "The script executes its logic immediately and calls eraseInstance(). Therefore, the instance does not persist in the model, and no post-insertion editing (OPM, grips, etc.) is possible."
          }
        ]
      },
      "tokens_used": 4250,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Remove Project Group Data\n\n## Overview\nThis script is a maintenance tool used to clean up specific project grouping metadata from selected structural elements. It removes internal data tags that start with \"HSB_\" and end with \"Child\" and updates any visualization scripts to reflect these changes.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | This script must be run in the 3D model. |\n| Paper Space | No | Not supported in layout views. |\n| Shop Drawing | No | Not intended for shop drawing generation. |\n\n## Prerequisites\n- **Required entities**: Structural Elements (Walls, Floors, or Roofs).\n- **Minimum beam count**: 0 (The script can run without selections, though no data will be removed).\n- **Required settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Remove Project Group Data.mcr`\n\n### Step 2: Select Elements\n```\nCommand Line: Select elements\nAction: Click on the Walls, Floors, or Roofs from which you want to remove the grouping data. Press Enter when finished.\n```\n\n### Step 3: Processing\nThe script will automatically process the selected elements, delete the specific grouping metadata, refresh grouping visualizations (such as \"HSB_I-ShowGroupingInformation\" or \"Batch & Stack Info\"), and then delete its own instance from the drawing.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| N/A | N/A | N/A | This script has no editable properties in the Properties Palette. It runs immediately upon insertion and selection. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| N/A | This script does not add custom options to the right-click context menu. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Automatic Cleanup**: You do not need to manually delete the script instance after use; it removes itself from the drawing automatically after finishing the task.\n- **Visual Updates**: If you have scripts active that show grouping information (like \"Batch & Stack Info\"), they will automatically refresh to show that the data has been removed.\n- **Safe to Use**: This script only removes internal metadata tags (keys formatted as `HSB_...CHILD`). It does not delete or modify the physical geometry of your elements.\n\n## FAQ\n- **Q: What exactly does this script delete?**\n  A: It deletes specific internal property keys that start with \"HSB_\" and end with \"CHILD\" (case-insensitive) within the element's data. It does not affect the element's dimensions or material.\n- **Q: Why did the script disappear after I used it?**\n  A: This is a \"single-use\" utility script. It is designed to execute its cleaning function and then automatically erase itself to keep your drawing clean.\n- **Q: Can I undo the changes?**\n  A: Yes, you can use the standard AutoCAD `UNDO` command to restore the metadata and the script instance if you ran it by mistake."
      },
      "tokens_used": 4023,
      "error": null
    }
  }
}