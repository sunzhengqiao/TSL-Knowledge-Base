{
  "filename": "hsb_GlueArea.mcr",
  "status": "completed",
  "total_tokens": 28906,
  "processing_time": 442.9312252998352,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": null,
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3034,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses PrEntity to select an Element, retrieves coordinate systems via Element.coordSys(), creates 3D geometry using Plane and PLine, and uses assignToElementGroup. No 'sd_' functions, '_Viewport' usage, or '_Entity' arrays for drawing views are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 3050,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one element",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getPoint",
              "promptOriginal": "Pick star point",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 3,
              "function": "getPoint",
              "promptOriginal": "Pick end point",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "On Insert if _kExecuteKey is empty",
            "title": null,
            "dataSource": "Script properties (nZones, nToolingIndex, dToolSize, sLineType, sDisplayTypes)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nZones",
            "type": "PropInt",
            "displayName": "Zone to be glued",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10
            ],
            "category": null,
            "description": null
          },
          {
            "index": 51,
            "variable": "nToolingIndex",
            "type": "PropInt",
            "displayName": "Tool index",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 50,
            "variable": "dToolSize",
            "type": "PropDouble",
            "displayName": "Tool size",
            "defaultValue": "50",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sLineType",
            "type": "PropString",
            "displayName": "Line Type",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": null,
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sDisplayTypes",
            "type": "PropString",
            "displayName": "Display type",
            "defaultValue": "Line",
            "inputType": "dropdown",
            "options": [
              "Line",
              "Area"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3578,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Defines a path or area on a timber element surface to indicate where adhesive should be applied during manufacturing.",
          "category": "Processing/Hardware",
          "typicalUseCase": "Used to mark gluing lines (e.g., for laminating, CLT, or veneer application) that are interpreted by CNC machines or used for shop drawings to show glue application zones."
        },
        "parameters": [
          {
            "name": "nZones",
            "technicalDefault": "0 (Mapped to 1)",
            "businessMeaning": "The specific face or side of the timber element where the glue area is applied. Zones typically correspond to element surfaces (Top, Bottom, Left, Right, Front, Back).",
            "validRange": "1 to 10",
            "unit": "Index",
            "affectsOutput": "Determines the 3D orientation and plane on which the gluing geometry is drawn and projected. Changing this moves the mark to a different side of the beam."
          },
          {
            "name": "nToolingIndex",
            "technicalDefault": "1",
            "businessMeaning": "Identifier for the specific glue nozzle, tool head, or process number to be used at the CNC workstation.",
            "validRange": "Positive Integers (e.g., 1-99)",
            "unit": "count",
            "affectsOutput": "Updates the 'ToolIndex' in the export map data. Does not change the visual geometry, but changes the machine instruction."
          },
          {
            "name": "dToolSize",
            "technicalDefault": "50",
            "businessMeaning": "The width of the glue strip or the spacing between multiple glue lines if applied as an area.",
            "validRange": "10mm to 200mm",
            "unit": "mm",
            "affectsOutput": "Controls the visual width of the rectangle when 'Display type' is set to 'Area'. Defines the geometric width in the export data."
          },
          {
            "name": "sLineType",
            "technicalDefault": "System Default (Continuous)",
            "businessMeaning": "The visual style (linetype) used to draw the gluing indication in the CAD model (e.g., Continuous, Dashed, Phantom).",
            "validRange": "Standard AutoCAD linetypes",
            "unit": "N/A",
            "affectsOutput": "Changes only the visual appearance of the line in the 3D model; does not affect manufacturing data."
          },
          {
            "name": "sDisplayTypes",
            "technicalDefault": "Line",
            "businessMeaning": "Determines if the glue indication is represented as a single centerline or as a specific width area.",
            "validRange": "\"Line\", \"Area\"",
            "unit": "Selection",
            "affectsOutput": "In 'Line' mode, draws a simple line and exports a nominal geometry. In 'Area' mode, draws a rectangle defined by the Tool Size and exports the full area shape."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sDisplayTypes set to 'Area'",
            "effect": "Activates the dToolSize parameter to determine the width of the drawn rectangle.",
            "cascade": [
              "dToolSize"
            ]
          },
          {
            "trigger": "sDisplayTypes set to 'Line'",
            "effect": "Ignores dToolSize for visual representation (width is nominal), effectively hiding the width configuration.",
            "cascade": [
              "dToolSize"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Visual Geometry (PLine)",
            "description": "Draws either a single line or a rectangular area on the selected element zone to visualize the gluing path.",
            "appliedTo": "The selected Element (_Element[0])."
          },
          {
            "type": "Manufacturing Map Data",
            "description": "Exports data including 'Shape', 'ToolIndex', 'Zone', 'StartPoint', and 'EndPoint' to be read by CAM software for automated gluing.",
            "appliedTo": "Element Group mapping."
          }
        ]
      },
      "tokens_used": 5929,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script starts and sets units to mm.",
          "2. System detects if the script is being inserted (_bOnInsert).",
          "3. If inserted via command (no catalog key), display the Dynamic Dialog for user input.",
          "4. Prompt user to select a single element ('Select one element').",
          "5. Prompt user to pick a start point ('Pick star point').",
          "6. Prompt user to pick an end point ('Pick end point').",
          "7. Script validates that an element was actually selected.",
          "8. Script retrieves the element's coordinate system and the specific surface zone defined in properties.",
          "9. The picked points are mathematically projected onto the surface plane of the selected zone.",
          "10. Script evaluates the 'Display type' property to determine geometry generation mode.",
          "11. Visual geometry is drawn (either a line or a rectangle) and mapped to the element.",
          "12. Manufacturing data (Tool Index, Zone, Shape) is written to the Element Map for CNC export."
        ],
        "conditionalBranches": [
          {
            "condition": "Execution Context (Catalog Key presence)",
            "path1": {
              "name": "Manual Command Launch",
              "steps": [
                "Check if _kExecuteKey is empty",
                "Execute showDialog()",
                "User manually sets properties in dialog",
                "Proceed to element selection"
              ]
            },
            "path2": {
              "name": "Catalog/Drawing Style Launch",
              "steps": [
                "Check if _kExecuteKey is populated",
                "Load property values from setPropValuesFromCatalog()",
                "Skip dialog",
                "Proceed to element selection"
              ]
            }
          },
          {
            "condition": "Display Type (sDisplayTypes)",
            "path1": {
              "name": "Line Mode",
              "steps": [
                "Set nDisplayType to 0",
                "Create a simple PLine between start and end points",
                "Create a small export rectangle (fixed 4mm width) perpendicular to the line",
                "Join export rectangle to PlaneProfile"
              ]
            },
            "path2": {
              "name": "Area Mode",
              "steps": [
                "Set nDisplayType to 1",
                "Calculate vector perpendicular to the line",
                "Create a rectangle using dToolSize as the width",
                "Draw rectangle visually",
                "Join rectangle to PlaneProfile for export"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Element Selection",
            "errorMessage": null,
            "recovery": "Script self-terminates (eraseInstance) if no element is selected during the PrEntity prompt."
          },
          {
            "check": "Element Validity",
            "errorMessage": null,
            "recovery": "Script checks if the element object is valid (bIsValid). If not (e.g., deleted), the script instance is erased."
          },
          {
            "check": "Insertion Cycle",
            "errorMessage": null,
            "recovery": "Script checks insertCycleCount(). If greater than 1 (e.g., during copy/paste loop), the instance is immediately erased to prevent errors."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Glue Zone Face",
            "how": "OPM Properties (nZones dropdown)",
            "effect": "The script recalculates the coordinate system and plane, projecting the existing start/end points onto the new zone surface."
          },
          {
            "action": "Adjust Glue Area Width",
            "how": "OPM Properties (dToolSize)",
            "effect": "If 'Display type' is 'Area', the width of the rectangle updates visually and in the export map."
          },
          {
            "action": "Toggle Visual Style",
            "how": "OPM Properties (sDisplayTypes)",
            "effect": "Switches between drawing a single line ('Line') and a dimensional rectangle ('Area')."
          },
          {
            "action": "Update Manufacturing Attributes",
            "how": "OPM Properties (nToolingIndex)",
            "effect": "Updates the 'ToolIndex' value in the element map for CNC production without changing geometry."
          }
        ]
      },
      "tokens_used": 6956,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_GlueArea.mcr\n\n## Overview\nThis script defines a specific path or area on a timber element surface to indicate where adhesive should be applied during manufacturing. It generates visual geometry in the model and exports manufacturing data (such as tool index and zone) for CNC machines or shop drawings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script operates in 3D model space to project geometry onto element surfaces. |\n| Paper Space | No | |\n| Shop Drawing | No | |\n\n## Prerequisites\n- **Required Entities**: One existing Timber Element.\n- **Minimum Beam Count**: 1.\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_GlueArea.mcr` from the list.\n\n### Step 2: Configuration (Manual Launch Only)\nIf you run this script manually (not from a catalog style), a configuration dialog will appear first.\n- Adjust properties like **Zone**, **Tool Index**, and **Display Type** as needed.\n- Click OK to proceed.\n\n### Step 3: Select Element\n```\nCommand Line: Select one element\nAction: Click on the timber element (beam/panel) you want to apply the glue area to.\n```\n\n### Step 4: Pick Start Point\n```\nCommand Line: Pick star point\nAction: Click on the element surface to define the start location of the glue path.\n```\n\n### Step 5: Pick End Point\n```\nCommand Line: Pick end point\nAction: Click on the element surface to define the end location of the glue path.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Zone to be glued | dropdown | 1 | Selects the specific face or side of the element where the glue area is applied (e.g., Top, Bottom, Left, Right). |\n| Tool index | number | 1 | Identifier for the specific glue nozzle or tool head to be used at the CNC workstation. |\n| Tool size | number | 50 | The width of the glue strip (in mm). This is visually represented when \"Display type\" is set to \"Area\". |\n| Line Type | dropdown | System Default | The visual style (linetype) used to draw the glue indication in the CAD model (e.g., Continuous, Dashed). |\n| Display type | dropdown | Line | Determines visual representation: **Line** (single centerline) or **Area** (rectangular shape showing width). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Standard TSL Options | The script uses standard context options like Erase, Move, and Rotate. No custom menu items are defined. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: This script does not rely on external settings files.\n\n## Tips\n- **Visualizing Width**: If you need to see the exact width of the glue strip defined in \"Tool size,\" change the \"Display type\" property to **Area**.\n- **Changing Faces**: You can move the glue area to a different side of the beam after insertion by simply changing the \"Zone to be glued\" dropdown in the Properties Palette. You do not need to re-insert the script.\n- **CNC Data**: While changing \"Line type\" affects how it looks in AutoCAD, it does not change the manufacturing data sent to the machine. Ensure \"Tool index\" and \"Zone\" are correct for production.\n\n## FAQ\n- **Q: Why does the glue line look like a thin line even though I set a Tool Size of 50mm?**\n  - A: Check the **Display type** property. If it is set to \"Line\", it only draws a centerline. Switch it to \"Area\" to see the full rectangular width.\n- **Q: Can I use this to mark multiple discontinuous glue lines on one beam?**\n  - A: No, a single script instance creates one continuous line or rectangle between a start and end point. You must insert the script multiple times for separate segments.\n- **Q: What happens if I delete the beam I attached the glue area to?**\n  - A: The script includes a validity check. If the associated element is deleted or becomes invalid, the script instance will erase itself automatically."
      },
      "tokens_used": 6359,
      "error": null
    }
  }
}