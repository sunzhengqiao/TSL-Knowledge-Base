{
  "filename": "hsbRP_Analysis.mcr",
  "status": "completed",
  "total_tokens": 59627,
  "processing_time": 286.69302892684937,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 9669,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script uses PrEntity to select ERoofPlane entities and performs 3D geometric calculations. It generates satellite instances (hsbRP_Roofline, hsbRP_EaveArea) and draws a report table anchored at Pt3d(0,0,0). No 'sd_' prefixes, '_Viewport' usage, or Paper Space APIs are detected. The script acts as a generator/utility rather than an element detailing script."
        },
        "prerequisites": {
          "requiredEntities": [
            "ERoofPlane"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space with defined Roofplanes",
          "requiredSettings": [
            "_DimStyles",
            "_HatchPatterns"
          ]
        }
      },
      "tokens_used": 9015,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select roofplanes and (optional) hsbRPxx-Tsl's to delete",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 9,
            "variable": "sGroupMain",
            "type": "PropString",
            "displayName": "Group analysis BOM (seperate Level by '\\')",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "sUnit",
            "type": "PropString",
            "displayName": "Unit",
            "defaultValue": "   ",
            "inputType": "dropdown",
            "options": [
              "mm",
              "cm",
              "m",
              "inch",
              "feet"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nDecimals",
            "type": "PropInt",
            "displayName": "Decimals",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              0,
              1,
              2,
              3,
              4
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "nDecimalsArea",
            "type": "PropInt",
            "displayName": "Decimals Area",
            "defaultValue": 0,
            "inputType": "dropdown",
            "options": [
              0,
              1,
              2,
              3,
              4
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "nColorTable",
            "type": "PropInt",
            "displayName": "Color of table",
            "defaultValue": 143,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimstyle",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 7,
            "variable": "sDimStyleShop",
            "type": "PropString",
            "displayName": "Dimstyle Shopdrawing",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sGroup0",
            "type": "PropString",
            "displayName": "Group Roofline (seperate Level by '\\')",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 9,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sGroup1",
            "type": "PropString",
            "displayName": "Group Eave Area (seperate Level by '\\')",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "nColor1",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 93,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sMat",
            "type": "PropString",
            "displayName": "Material",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "sHatch",
            "type": "PropString",
            "displayName": "Hatch pattern",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dHatchScale",
            "type": "PropDouble",
            "displayName": "Hatch scale",
            "defaultValue": 30,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "sGroup2",
            "type": "PropString",
            "displayName": "Group Roof area (seperate Level by '\\')",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "nColor2",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 7,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 8,
            "variable": "sHatch2",
            "type": "PropString",
            "displayName": "Hatch pattern",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "dHatchScale2",
            "type": "PropDouble",
            "displayName": "Hatch scale",
            "defaultValue": 30,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 9163,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Analyzes roof planes to generate 3D geometry for rooflines, eave areas, and roof surfaces, producing a detailed graphical report table with quantities and previews.",
          "category": "Analysis & Layout",
          "typicalUseCase": "Used by designers to calculate roof surface areas for material ordering, visualize roof geometry (hips, valleys, ridges), and generate a schedule of roof components."
        },
        "parameters": [
          {
            "name": "sGroupMain",
            "technicalDefault": "",
            "businessMeaning": "Organizes the generated analysis report table within the BOM or project browser using the specified folder structure.",
            "validRange": "Text string (e.g., '5. Reporting\\Roof')",
            "unit": "string",
            "affectsOutput": "Groups the report instance in the BOM tree for filtering and scheduling."
          },
          {
            "name": "sUnit",
            "technicalDefault": "   ",
            "businessMeaning": "Controls the unit of measurement (metric or imperial) displayed in the report table.",
            "validRange": "mm, cm, m, inch, feet",
            "unit": "unit type",
            "affectsOutput": "Scales all numerical values (lengths and areas) in the output table."
          },
          {
            "name": "nDecimals",
            "technicalDefault": 0,
            "businessMeaning": "Sets the precision for linear dimensions (e.g., rafter lengths) shown in the table.",
            "validRange": "0 to 4",
            "unit": "decimal places",
            "affectsOutput": "Rounds length values in the report to the specified precision."
          },
          {
            "name": "nDecimalsArea",
            "technicalDefault": 0,
            "businessMeaning": "Sets the precision for surface areas (e.g., roof tiles, sheathing) shown in the table.",
            "validRange": "0 to 4",
            "unit": "decimal places",
            "affectsOutput": "Rounds area values in the report to the specified precision."
          },
          {
            "name": "nColorTable",
            "technicalDefault": 143,
            "businessMeaning": "Defines the AutoCAD color index for the lines and text of the generated report table.",
            "validRange": "0 to 255",
            "unit": "color index",
            "affectsOutput": "Visual appearance of the report table in the CAD model."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "Specifies the dimension style to use for annotating the roof previews in the table.",
            "validRange": "Existing DimStyle names in drawing",
            "unit": "string",
            "affectsOutput": "Style of arrows, text, and offsets for dimensions in the graphical column."
          },
          {
            "name": "sDimStyleShop",
            "technicalDefault": "",
            "businessMeaning": "Specifies the dimension style for specific detail views (e.g., rafter profiles) within the table.",
            "validRange": "Existing DimStyle names in drawing",
            "unit": "string",
            "affectsOutput": "Style of dimensions for cut-section details in the table."
          },
          {
            "name": "sGroup0",
            "technicalDefault": "",
            "businessMeaning": "Assigns the generated 'Roofline' entities to a specific group/layer in the project structure.",
            "validRange": "Text string",
            "unit": "string",
            "affectsOutput": "Organization of roofline geometry (hips, valleys, ridges) in the model."
          },
          {
            "name": "nColor",
            "technicalDefault": 9,
            "businessMeaning": "Sets the display color of the generated Roofline entities.",
            "validRange": "0 to 255",
            "unit": "color index",
            "affectsOutput": "Visual color of rooflines in 3D model and previews."
          },
          {
            "name": "sGroup1",
            "technicalDefault": "",
            "businessMeaning": "Assigns the generated 'Eave Area' entities to a specific group/layer in the project structure.",
            "validRange": "Text string",
            "unit": "string",
            "affectsOutput": "Organization of eave/overhang geometry in the model."
          },
          {
            "name": "nColor1",
            "technicalDefault": 93,
            "businessMeaning": "Sets the display color of the generated Eave Area entities.",
            "validRange": "0 to 255",
            "unit": "color index",
            "affectsOutput": "Visual color of eave areas in 3D model and previews."
          },
          {
            "name": "sMat",
            "technicalDefault": "",
            "businessMeaning": "Assigns a material name to the generated elements for costing or rendering.",
            "validRange": "Material name strings",
            "unit": "string",
            "affectsOutput": "Material property linked to the generated TSL instances."
          },
          {
            "name": "sHatch",
            "technicalDefault": "None",
            "businessMeaning": "Selects the hatch pattern to fill the Eave Areas in the table and model.",
            "validRange": "Loaded hatch patterns (e.g., ANSI31, SOLID)",
            "unit": "string",
            "affectsOutput": "Graphical fill pattern for eave surfaces."
          },
          {
            "name": "dHatchScale",
            "technicalDefault": 30,
            "businessMeaning": "Adjusts the density or size of the hatch pattern for Eave Areas.",
            "validRange": "> 0 (depends on unit system)",
            "unit": "drawing units",
            "affectsOutput": "Scale of the hatch pattern lines for Eave Areas."
          },
          {
            "name": "sGroup2",
            "technicalDefault": "",
            "businessMeaning": "Assigns the generated 'Roof Area' (main surface) entities to a specific group/layer.",
            "validRange": "Text string",
            "unit": "string",
            "affectsOutput": "Organization of main roof plane geometry in the model."
          },
          {
            "name": "nColor2",
            "technicalDefault": 7,
            "businessMeaning": "Sets the display color of the generated Roof Area entities.",
            "validRange": "0 to 255",
            "unit": "color index",
            "affectsOutput": "Visual color of main roof surfaces in 3D model and previews."
          },
          {
            "name": "sHatch2",
            "technicalDefault": "None",
            "businessMeaning": "Selects the hatch pattern to fill the Roof Areas in the table and model.",
            "validRange": "Loaded hatch patterns",
            "unit": "string",
            "affectsOutput": "Graphical fill pattern for main roof surfaces."
          },
          {
            "name": "dHatchScale2",
            "technicalDefault": 30,
            "businessMeaning": "Adjusts the density or size of the hatch pattern for Roof Areas.",
            "validRange": "> 0",
            "unit": "drawing units",
            "affectsOutput": "Scale of the hatch pattern lines for Roof Areas."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "sUnit",
            "effect": "Alters the interpretation of input lengths and the formatting of output values in the table.",
            "cascade": [
              "nDecimals",
              "nDecimalsArea",
              "dHatchScale",
              "dHatchScale2"
            ]
          },
          {
            "trigger": "sHatch",
            "effect": "Activates the visual filling of eave areas.",
            "cascade": [
              "dHatchScale"
            ]
          },
          {
            "trigger": "sHatch2",
            "effect": "Activates the visual filling of roof areas.",
            "cascade": [
              "dHatchScale2"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "TSL Instance (hsbRP_Roofline)",
            "description": "3D polylines representing the intersection of roof planes (ridges, hips, valleys) and eave edges.",
            "appliedTo": "Model Space (generated from selected ERoofPlane entities)"
          },
          {
            "type": "TSL Instance (hsbRP_EaveArea)",
            "description": "Hatched 3D surfaces representing the overhang/eave areas of the roof.",
            "appliedTo": "Model Space"
          },
          {
            "type": "TSL Instance (hsbRP_EaveArea - Roof Type)",
            "description": "Hatched 3D surfaces representing the main roof planes.",
            "appliedTo": "Model Space"
          },
          {
            "type": "Report Table (Drawing Primitives)",
            "description": "A 2D schedule containing a list of components, lengths, areas, angles, and graphical previews of the roof geometry.",
            "appliedTo": "Model Space (origin 0,0,0)"
          }
        ]
      },
      "tokens_used": 11138,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Launch: Check insertCycleCount. If > 1, erase instance and exit (ensures singleton).",
          "2. Configuration: Execute showDialog() to allow user to set Units, Decimals, Groups, and Display options.",
          "3. Selection: Initiate PrEntity selection prompt 'Select roofplanes and (optional) hsbRPxx-Tsl's to delete'.",
          "4. Entity Filtering: Iterate through selected entities.",
          "5. Processing Logic:",
          "   - If ERoofPlane: Store entity in internal map for analysis.",
          "   - If TslInst: Identify as legacy instance to delete/remove.",
          "6. Geometry Calculation: Analyze stored roof planes to determine intersections (rooflines), eave areas, and roof areas.",
          "7. Satellite Generation: Create/Update TSL instances (hsbRP_Roofline, hsbRP_EaveArea) based on analysis.",
          "8. Data Aggregation: Calculate totals for lengths and areas; format strings based on Unit and Decimal properties.",
          "9. Table Rendering: Construct and draw the report table at _Pt0 (origin).",
          "   - Loop through calculated rows.",
          "   - Draw Column 1-6 (Text data).",
          "   - Draw Column 7 (Graphical preview with hatching).",
          "10. Dependency Management: Link script entity to all source roof planes for automatic updates."
        ],
        "conditionalBranches": [
          {
            "condition": "Script Execution Mode",
            "path1": {
              "name": "Insert Mode",
              "steps": [
                "Check insertCycleCount",
                "Show Dialog",
                "Prompt for Entity Selection",
                "Process Entities"
              ]
            },
            "path2": {
              "name": "Recalc/Update Mode",
              "steps": [
                "Skip Dialog and Selection",
                "Read entities from internal map or dependencies",
                "Recalculate Geometry and Table",
                "Redraw"
              ]
            }
          },
          {
            "condition": "Entity Type in Selection Set",
            "path1": {
              "name": "ERoofPlane",
              "steps": [
                "Cast to ERoofPlane",
                "Store in Map (_Map.setEntity)",
                "Increment Roof Plane Counter"
              ]
            },
            "path2": {
              "name": "TslInst",
              "steps": [
                "Cast to TslInst",
                "Check TSL name",
                "Mark for deletion/replacement"
              ]
            }
          },
          {
            "condition": "Row Type during Table Generation",
            "path1": {
              "name": "Header Row",
              "steps": [
                "Set specific text alignment/height",
                "Draw Label Text (e.g., 'Nr', 'Length')",
                "Skip graphical preview"
              ]
            },
            "path2": {
              "name": "Data Row",
              "steps": [
                "Draw formatted values (Length, Area, Angle)",
                "Generate graphical preview in Column 7",
                "Apply Hatch patterns"
              ]
            }
          },
          {
            "condition": "Area Type in Graphical Preview (tslCol[i] property 6)",
            "path1": {
              "name": "Roof Area",
              "steps": [
                "Extract single roof plane profile from BOM Map",
                "Subtract openings (plSub profiles)",
                "Set color to nColor2",
                "Draw Filled Profile"
              ]
            },
            "path2": {
              "name": "Eave Area",
              "steps": [
                "Extract total eave profile",
                "Subtract outside line (plOl)",
                "Set color to nColor1",
                "Draw Filled Profile"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Valid Selection Set",
            "errorMessage": "Implicit: Script terminates if selection set is empty or user cancels (ssRP.go() returns false).",
            "recovery": "User must re-run script and select valid entities."
          },
          {
            "check": "Insert Cycle Count",
            "errorMessage": "None (Automatic)",
            "recovery": "Script automatically erases duplicate instances immediately upon insert."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Properties",
            "how": "AutoCAD Properties Palette (OPM)",
            "effect": "Updating Units, Decimals, Colors, or Groups triggers a full recalculation and redraw of the report table and satellite instances."
          },
          {
            "action": "Modify Roof Geometry",
            "how": "Grip edit or Modify ERoofPlane entities",
            "effect": "Dependencies trigger the script to recalculate rooflines, areas, and update the table values automatically."
          }
        ]
      },
      "tokens_used": 12822,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsbRP_Analysis.mcr\n\n## Overview\nAnalyzes ERoofPlane entities to calculate roof geometry, including rooflines (hips, valleys, ridges), eave areas, and main roof surfaces. It generates a detailed graphical report table with quantities and previews, while also creating 3D visualization geometry.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Primary working environment. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | This is a model analysis tool. |\n\n## Prerequisites\n- **Required entities**: `ERoofPlane` (Roofplanes) must exist in the model.\n- **Minimum beam count**: 0.\n- **Required settings**: Valid `_DimStyles` and `_HatchPatterns` must be loaded in the drawing.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsbRP_Analysis.mcr`\n\n### Step 2: Configuration\nA dialog will appear allowing you to configure units, decimals, colors, and grouping for the analysis. Adjust these settings to match your project standards and click OK.\n\n### Step 3: Select Roof Geometry\n```\nCommand Line: Select roofplanes and (optional) hsbRPxx-Tsl's to delete\nAction: Click on the Roofplane entities you wish to analyze. You may also select existing hsbRP analysis instances to delete and replace them. Press Enter to confirm.\n```\n\n### Step 4: View Results\nThe script will generate 3D geometry for rooflines and areas, place a report table at the origin (0,0,0), and group the elements in the BOM according to your settings.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Group analysis BOM** | Text | | Organizes the report table in the BOM/Project browser. Use `\\` to separate levels (e.g., `Reporting\\Roof`). |\n| **Unit** | Dropdown | | Sets the measurement unit for the report (mm, cm, m, inch, feet). |\n| **Decimals** | Dropdown | 0 | Precision for linear dimensions (lengths). |\n| **Decimals Area** | Dropdown | 0 | Precision for surface areas. |\n| **Color of table** | Number | 143 | AutoCAD color index for the report table lines and text. |\n| **Dimstyle** | Dropdown | | Dimension style used for the main graphical previews. |\n| **Dimstyle Shopdrawing** | Dropdown | | Dimension style used for detail views in the table. |\n| **Group Roofline** | Text | | Group path for the generated 3D roofline entities. |\n| **Color** (Roofline) | Number | 9 | Color for 3D roofline geometry. |\n| **Group Eave Area** | Text | | Group path for the generated 3D eave area entities. |\n| **Color** (Eave) | Number | 93 | Color for 3D eave area geometry. |\n| **Material** | Text | | Material name assigned to the generated elements. |\n| **Hatch pattern** (Eave) | Dropdown | None | Hatch pattern for eave areas in the table and 3D model. |\n| **Hatch scale** (Eave) | Number | 30 | Scale factor for the eave hatch pattern. |\n| **Group Roof area** | Text | | Group path for the generated 3D main roof surface entities. |\n| **Color** (Roof) | Number | 7 | Color for 3D roof surface geometry. |\n| **Hatch pattern** (Roof) | Dropdown | None | Hatch pattern for main roof areas. |\n| **Hatch scale** (Roof) | Number | 30 | Scale factor for the roof hatch pattern. |\n\n## Right-Click Menu Options\n*Standard context menu options apply. This script does not add specific custom right-click commands; updates are handled via properties or geometry dependencies.*\n\n## Settings Files\n- **Filename**: `_DimStyles`, `_HatchPatterns`\n- **Location**: Defined in your hsbCAD configuration (Company or Install path).\n- **Purpose**: Provides the visual styles and patterns required for the report table and hatched surfaces.\n\n## Tips\n- **Organization**: Use the Group properties (e.g., `5. Reporting\\Roof`) to keep the generated analysis separate from your structural elements in the Project Browser.\n- **Updating Analysis**: If you modify the slope or shape of your Roofplanes using grips, the script will automatically detect the change and update the report and geometry.\n- **Cleanup**: You can select previous analysis instances (hsbRPxx-Tsl's) during the selection prompt to automatically remove them before generating the new analysis.\n\n## FAQ\n- **Q: Where does the report table appear?**\n  A: The report table is generated at the absolute model coordinate origin (0,0,0). You may need to zoom extents or pan to find it.\n- **Q: How do I change the units after insertion?**\n  A: Select the script instance in the model, open the Properties Palette (Ctrl+1), and change the \"Unit\" property. The table will update automatically.\n- **Q: Why are my hatches not displaying?**\n  A: Ensure the \"Hatch pattern\" is set to something other than \"None\" and that the pattern is actually loaded in your current drawing."
      },
      "tokens_used": 7820,
      "error": null
    }
  }
}