{
  "filename": "GE_FLOOR_CASSETTE_SHEATHING.mcr",
  "status": "completed",
  "total_tokens": 54409,
  "processing_time": 671.0041723251343,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7298,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script operates on ElementRoof entities and generates Sheet objects using dbCreate. It utilizes 3D geometric calculations (PlaneProfile, Body, Plane) and collects internal beams using collectEntities(..., Beam(), _kModelSpace). There are no references to Paper Space (_Viewport, _kPaperSpace) or Shop Drawing generation patterns (sd_, #Type E)."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementRoof"
          ],
          "minimumBeams": 0,
          "requiredSpace": "3D Model with Floor Cassettes (ElementRoof)",
          "requiredSettings": []
        }
      },
      "tokens_used": 7483,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "showDialog",
              "promptOriginal": "Shows property dialog for configuration",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of cassettes",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": [],
          "dynamicPrompts": [
            {
              "trigger": "Context Menu: Set sheathed area from polyline",
              "function": "getEntPLine",
              "promptOriginal": "\nSelect a closed polyline that defines the sheathed area",
              "condition": "_kExecuteKey == stAddPL"
            }
          ]
        },
        "dialogs": [
          {
            "type": "InsertionDialog",
            "trigger": "_bOnInsert",
            "title": "Insert Properties",
            "dataSource": "Prop definitions (stMat, psDistrib, etc.)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strEmpty0",
            "type": "PropString",
            "displayName": "SHEATHING PROPERTIES",
            "defaultValue": " ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null,
            "readOnly": true
          },
          {
            "index": 1,
            "variable": "stMat",
            "type": "PropString",
            "displayName": "Material",
            "defaultValue": "4x8 T&G",
            "inputType": "dropdown",
            "options": [
              "4x8 T&G",
              "4x10 T&G",
              "4x12 T&G",
              "3/4 4x8 TG USG S1"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "psDistrib",
            "type": "PropString",
            "displayName": "Distribution from",
            "defaultValue": "Bottom Left",
            "inputType": "dropdown",
            "options": [
              "Bottom Left",
              "Bottom Right",
              "Top Left",
              "Top Right"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "dMinStagger",
            "type": "PropDouble",
            "displayName": "Minimum Staggered Offset",
            "defaultValue": "12.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "strEmpty1",
            "type": "PropString",
            "displayName": "LEFT EDGE PROPERTIES",
            "defaultValue": " ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null,
            "readOnly": true
          },
          {
            "index": 1,
            "variable": "dLeftHold",
            "type": "PropDouble",
            "displayName": "Min. Hold Value",
            "defaultValue": "0.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "stLeftHold",
            "type": "PropString",
            "displayName": "Rows to Hold",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": [
              "None",
              "Even Rows",
              "Odd Rows",
              "All Rows"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "strEmpty2",
            "type": "PropString",
            "displayName": "RIGHT EDGE PROPERTIES",
            "defaultValue": " ",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null,
            "readOnly": true
          },
          {
            "index": 2,
            "variable": "dRightHold",
            "type": "PropDouble",
            "displayName": "Min. Hold Value",
            "defaultValue": "0.0",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 6,
            "variable": "stRightHold",
            "type": "PropString",
            "displayName": "Rows to Hold",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": [
              "None",
              "Even Rows",
              "Odd Rows",
              "All Rows"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [
          {
            "menuItem": "Set sheathed area from polyline",
            "handler": "stAddPL",
            "action": "Prompts user to select a closed polyline to define a custom sheathing area on the roof element.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Remove polyline area",
            "handler": "stRemovePL",
            "action": "Removes the custom sheathing area definition, reverting to the element's brutto profile.",
            "alsoTriggeredBy": null
          },
          {
            "menuItem": "Re-distribute sheathing on floor",
            "handler": "strRecalcSheet",
            "action": "Forces a recalculation and redistribution of all sheathing sheets based on current properties and geometry.",
            "alsoTriggeredBy": null
          }
        ],
        "settingsFiles": []
      },
      "tokens_used": 9628,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Generates structural sheathing (decking) for floor cassettes, automating the layout, splitting, and staggering of sheet materials like OSB or Plywood.",
          "category": "Prefab/Sheathing",
          "typicalUseCase": "Applying floor decking to a prefabricated floor cassette (ElementRoof) to create a structural diaphragm, ensuring joints are staggered and sheets align with edges or openings."
        },
        "parameters": [
          {
            "name": "stMat",
            "technicalDefault": "4x8 T&G",
            "businessMeaning": "Specifies the size, thickness, and profile (Tongue & Groove) of the sheathing material to be used.",
            "validRange": "Defined by script list (e.g., 4x8, 4x10, 4x12 sheets).",
            "unit": "Selection (inches)",
            "affectsOutput": "Determines the width, height, thickness, and machining allowance (T&G gap) of the generated Sheet objects."
          },
          {
            "name": "psDistrib",
            "technicalDefault": "Bottom Left",
            "businessMeaning": "Sets the origin point and direction of the sheathing layout relative to the floor cassette.",
            "validRange": "Bottom Left, Bottom Right, Top Left, Top Right",
            "unit": "Selection",
            "affectsOutput": "Changes the starting corner of the sheathing grid and flips the direction in which sheets are laid out (X and Y vectors)."
          },
          {
            "name": "dMinStagger",
            "technicalDefault": "12.0",
            "businessMeaning": "The minimum distance between end joints of sheathing sheets in adjacent rows. Critical for structural diaphragm performance to ensure seams don't line up.",
            "validRange": "4.0\" to 24.0\" (Standard is 12\" to 24\")",
            "unit": "Inches",
            "affectsOutput": "Forces split lines to shift so that the butt end of a sheet in one row does not align with the butt end in the next row within this distance."
          },
          {
            "name": "dLeftHold",
            "technicalDefault": "0.0",
            "businessMeaning": "The required distance to hold back the sheathing from the left edge of the floor cassette.",
            "validRange": "0.0\" to Half Sheet Width",
            "unit": "Inches",
            "affectsOutput": "Trims the first column of sheets or shifts the entire layout to respect the edge boundary."
          },
          {
            "name": "stLeftHold",
            "technicalDefault": "None",
            "businessMeaning": "Filters which rows are affected by the 'Min. Hold Value' on the left edge.",
            "validRange": "None, Even Rows, Odd Rows, All Rows",
            "unit": "Selection",
            "affectsOutput": "Determines if the left edge hold value is applied to every row, alternating rows, or not at all."
          },
          {
            "name": "dRightHold",
            "technicalDefault": "0.0",
            "businessMeaning": "The required distance to hold back the sheathing from the right edge of the floor cassette.",
            "validRange": "0.0\" to Half Sheet Width",
            "unit": "Inches",
            "affectsOutput": "Trims the last column of sheets to ensure they do not overhang the right boundary."
          },
          {
            "name": "stRightHold",
            "technicalDefault": "None",
            "businessMeaning": "Filters which rows are affected by the 'Min. Hold Value' on the right edge.",
            "validRange": "None, Even Rows, Odd Rows, All Rows",
            "unit": "Selection",
            "affectsOutput": "Determines if the right edge hold value is applied to every row, alternating rows, or not at all."
          },
          {
            "name": "plSheetArea",
            "technicalDefault": "None",
            "businessMeaning": "User-defined polyline boundary that overrides the default cassette shape for sheathing area.",
            "validRange": "Closed PLine within element bounds",
            "unit": "Geometry",
            "affectsOutput": "Restricts sheathing generation to the specific profile defined by the polyline, effectively creating holes or custom shapes."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "stMat (Material) change",
            "effect": "Recalculates sheet dimensions and layout origin based on new width/height.",
            "cascade": [
              "dMinStagger",
              "psDistrib"
            ]
          },
          {
            "trigger": "psDistrib (Distribution) change",
            "effect": "Resets the layout origin to the newly selected corner and inverts axes.",
            "cascade": [
              "dLeftHold",
              "dRightHold",
              "stLeftHold",
              "stRightHold"
            ]
          },
          {
            "trigger": "Context Menu: 'Set sheathed area from polyline'",
            "effect": "Replaces the geometric profile used for sheathing generation, forcing a full recalculation of all sheets.",
            "cascade": [
              "All Geometry"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Sheet",
            "description": "Structural sheathing panels (e.g., OSB, Plywood) sized to fit the cassette layout, split at internal beam locations, and trimmed for edge conditions.",
            "appliedTo": "ElementRoof (Floor Cassettes)"
          },
          {
            "type": "CncExport (Tool)",
            "description": "Metadata embedded in the sheets identifying 'Groove' and 'Tongue' edges for manufacturing machinery.",
            "appliedTo": "Generated Sheets"
          }
        ]
      },
      "tokens_used": 10480,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script Initialization",
          "Set Unit System to Inches",
          "Define Material Arrays (Width, Height, Thickness, Tongue & Groove allowance, Color)",
          "Define Properties (Material, Distribution, Stagger, Edge Holds)",
          "Check Insertion/Modification Status (_bOnInsert || _bOnElementListModified)",
          "[Branch] If Inserting/Copying:",
          "Show Insertion Dialog",
          "Prompt User to Select Set of Cassettes (ElementRoof)",
          "Filter Selected Entities for ElementRoof type",
          "Clone Script Instance to each Selected Element",
          "Erase Master Script Instance",
          "Exit Script",
          "End Branch",
          "Load Properties from Map if available",
          "Safety Check: Erase instance if no Element attached",
          "Assign to Element Group and Set Dependency",
          "Get or Create SubMap (mpX)",
          "Register Context Menu Triggers (Add/Remove Polyline)",
          "[Branch] Context Menu: Add Polyline",
          "Prompt User to Select Closed Polyline",
          "Project Polyline to Element Plane",
          "Store Polyline in SubMap ('plSheetArea')",
          "Erase Selected Polyline Entity",
          "[Branch] Context Menu: Remove Polyline",
          "Remove 'plSheetArea' from SubMap",
          "Determine Sheathing Profile (PlaneProfile ppZ1)",
          "  [Logic] Use Stored Polyline if exists, else Brutto Profile (1 or 0), else Envelope",
          "Validate Polyline Intersection with Element Envelope",
          "  [Error] Report 'Sheathing area off element' if no intersection",
          "Calculate Coordinate System based on Distribution Property (vx, vy, ptRef)",
          "Reset Origin Point (_Pt0) if Distribution/Geometry changed",
          "Adjust Origin Point to align within first sheet width",
          "Draw Visualization Graphics (Reference Arrows)",
          "Store Reference Data in _Map",
          "Register 'Re-distribute sheathing' Trigger",
          "[Branch] Execution Trigger (Recalc, Property Change, Construction, Insertion, Polyline Change)",
          "Validate Main Profile (Must have exactly 1 ring)",
          "  [Error] Report 'Ring count incorrect' and exit if invalid",
          "Calculate Element Dimensions (dElL, dElW)",
          "Collect and Intersect OpeningRoof entities",
          "Delete existing Sheets attached to Element",
          "Collect internal Beams (Splitting candidates) from Element Group",
          "Initialize Sheathing Loop (Iterate Y-rows)",
          "Create Row Profile (Intersect Main Profile with Y-slice)",
          "Filter splitting beams that intersect current Row Profile",
          "Sort Row Profile Vertices along X-axis",
          "Initialize Sheet Loop (Iterate X-sheets)",
          "Create Candidate Sheet Profile (Standard Sheet Size)",
          "Apply Edge Hold Logic (Left/Right based on Even/Odd/All Rows)",
          "Trim Sheet to fit inside Row Profile",
          "Validate Sheet Area (Skip if too small)",
          "Create Sheet Entity (dbCreate)",
          "Apply Material, Name, Color, and Element Group assignment",
          "Subtract Openings from Sheet Profile (Join Ring)",
          "Split Sheet at Beams",
          "Find ideal split point (Standard Length)",
          "Identify crossing beams",
          "Filter beams based on Stagger Distance (dMinStagger) to avoid aligned joints",
          "Split Sheet using Plane at Beam location",
          "Update 'Last Split' tracking for next row stagger",
          "Advance to Next Row",
          "Sort generated Sheets by position",
          "Label Edges (Groove/Tongue) based on full width vs rip cut",
          "Apply CNC Tool Info ('OutlineEdgeInfo') to Sheet edges",
          "End Branch"
        ],
        "conditionalBranches": [
          {
            "condition": "_bOnInsert || _bOnElementListModified",
            "path1": {
              "name": "Insertion Flow",
              "steps": [
                "Show Dialog",
                "Select ElementRoof",
                "Clone to Elements",
                "Erase Instance"
              ]
            },
            "path2": {
              "name": "Update Flow",
              "steps": [
                "Load Props",
                "Validate Element",
                "Handle Context Menus",
                "Calculate Geometry",
                "Generate Sheets"
              ]
            }
          },
          {
            "condition": "Polyline Area Definition (mpX.hasPLine('plSheetArea'))",
            "path1": {
              "name": "Custom Area",
              "steps": [
                "Get Polyline from Map",
                "Project to Plane",
                "Validate Intersection"
              ]
            },
            "path2": {
              "name": "Default Area",
              "steps": [
                "Get Element Brutto Profile",
                "Fallback to Envelope"
              ]
            }
          },
          {
            "condition": "Edge Hold Logic (Left/Right)",
            "path1": {
              "name": "Apply Hold",
              "steps": [
                "Check Row Index (Even/Odd)",
                "Check Property ('None', 'Even', 'Odd', 'All')",
                "Shift Sheet Start/End point"
              ]
            },
            "path2": {
              "name": "No Hold",
              "steps": [
                "Use full Brutto boundary for that row/edge"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Selected Entity Type during Insert",
            "errorMessage": "N/A (Internal filter)",
            "recovery": "Script filters for ElementRoof automatically"
          },
          {
            "check": "Element Validity",
            "errorMessage": "N/A (Silent Erase)",
            "recovery": "Script erases self if element invalid"
          },
          {
            "check": "Polyline Intersection with Element",
            "errorMessage": "Sheathing area off element [ElementNumber]",
            "recovery": "Select a polyline that overlaps the floor cassette"
          },
          {
            "check": "Profile Ring Count",
            "errorMessage": "Ring count incorrect",
            "recovery": "Check geometry of cassette or polyline area"
          },
          {
            "check": "Sheet Splitting Logic",
            "errorMessage": "A sheet cannot be split on panel [ElementNumber]",
            "recovery": "Adjust beam locations or minimum stagger distance"
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Material",
            "how": "OPM Property Palette (Dropdown)",
            "effect": "Updates Sheet dimensions and recalculates layout"
          },
          {
            "action": "Change Distribution Origin",
            "how": "OPM Property Palette (Dropdown)",
            "effect": "Resets grid origin (BL, BR, TL, TR) and recalculates all sheets"
          },
          {
            "action": "Adjust Stagger Distance",
            "how": "OPM Property Palette (Number)",
            "effect": "Increases/Decreases minimum offset for joints between rows"
          },
          {
            "action": "Set Edge Hold (Left/Right)",
            "how": "OPM Property Palette (Number + Dropdown)",
            "effect": "Holds back sheets from edges based on value and Row filter"
          },
          {
            "action": "Set Custom Sheathing Area",
            "how": "Context Menu -> 'Set sheathed area from polyline'",
            "effect": "Restricts sheathing generation to selected polyline boundary"
          },
          {
            "action": "Remove Custom Area",
            "how": "Context Menu -> 'Remove polyline area'",
            "effect": "Reverts sheathing to full ElementBrutto shape"
          },
          {
            "action": "Force Recalculation",
            "how": "Context Menu -> 'Re-distribute sheathing on floor'",
            "effect": "Runs full generation loop again without changing properties"
          },
          {
            "action": "Element Modification",
            "how": "Modify Cassette Geometry or add Openings",
            "effect": "Script dependency triggers recalculation automatically"
          }
        ]
      },
      "tokens_used": 12013,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# GE_FLOOR_CASSETTE_SHEATHING.mcr\n\n## Overview\nGenerates structural floor sheathing (decking) for prefabricated floor cassettes. It automates the layout, cutting, and staggering of sheet materials like OSB or Plywood, splitting them at internal beam locations and applying edge hold-backs.\n\n## Usage Environment\n\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Required. Operates on Floor Cassette entities (`ElementRoof`). |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | Not supported. |\n\n## Prerequisites\n- **Required Entities**: `ElementRoof` (Floor Cassette).\n- **Minimum Beams**: 0 (Internal beams are used for splitting but not strictly required for insertion).\n- **Required Settings**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Select `GE_FLOOR_CASSETTE_SHEATHING.mcr` from the list.\n\n### Step 2: Configure Properties\n1.  The **Insert Properties** dialog appears automatically.\n2.  Select the **Material** (e.g., 4x8 T&G), **Distribution** origin, and **Stagger** settings.\n3.  Click OK to confirm.\n\n### Step 3: Select Cassettes\n```\nCommand Line: Select a set of cassettes\nAction: Click on the Floor Cassette (ElementRoof) entities you wish to sheath.\n```\n*   The script will automatically clone itself to the selected cassettes and generate the sheets.\n\n## Properties Panel Parameters\n\n### Sheathing Properties\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Material | dropdown | 4x8 T&G | Select the size, thickness, and profile of the sheathing material (e.g., 4x8, 4x10). |\n| Distribution from | dropdown | Bottom Left | Sets the origin corner for the sheathing layout (Bottom Left, Bottom Right, Top Left, Top Right). |\n| Minimum Staggered Offset | number | 12.0 | The minimum distance in inches between end joints of adjacent rows to ensure structural strength. |\n\n### Left Edge Properties\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Min. Hold Value | number | 0.0 | The distance in inches to hold back the sheathing from the left edge of the cassette. |\n| Rows to Hold | dropdown | None | Applies the hold value to specific rows: None, Even Rows, Odd Rows, or All Rows. |\n\n### Right Edge Properties\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Min. Hold Value | number | 0.0 | The distance in inches to hold back the sheathing from the right edge of the cassette. |\n| Rows to Hold | dropdown | None | Applies the hold value to specific rows: None, Even Rows, Odd Rows, or All Rows. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| Set sheathed area from polyline | Prompts you to select a closed polyline to define a custom sheathing boundary (e.g., to create a complex shape or cutout). |\n| Remove polyline area | Removes the custom polyline boundary and reverts the sheathing area to the full cassette shape. |\n| Re-distribute sheathing on floor | Forces the script to recalculate and regenerate all sheets based on current properties without needing to change a value. |\n\n## Settings Files\nNone. This script relies entirely on Properties and entity geometry.\n\n## Tips\n- **Beam Splitting**: The script automatically detects internal beams and splits the sheathing sheets at those locations.\n- **Openings**: Ensure `OpeningRoof` entities are present in the cassette; the script will automatically cut holes in the sheathing to match them.\n- **Staggering**: If joints are aligning too closely vertically, increase the \"Minimum Staggered Offset\" value.\n- **Edge Conditions**: Use the \"Rows to Hold\" feature to create specific patterns where the sheathing stops short of the edge only on alternating rows (e.g., for ledger connections).\n\n## FAQ\n- **Q: Why did the sheets not generate?**\n  - A: Ensure you selected an `ElementRoof` (Floor Cassette). The script filters out other element types.\n- **Q: How do I handle a floor shape that isn't a simple rectangle?**\n  - A: Use the \"Set sheathed area from polyline\" context menu option. Draw a closed polyline representing the exact area you want sheathed, and run the command.\n- **Q: What happens if I change the material size?**\n  - A: The script will automatically recalculate the layout grid to accommodate the new sheet dimensions (width/height).\n- **Q: I see an error \"Sheathing area off element\".**\n  - A: This occurs if you selected a polyline for the sheathing area that does not physically overlap the floor cassette element. Select a polyline within the cassette bounds."
      },
      "tokens_used": 7507,
      "error": null
    }
  }
}