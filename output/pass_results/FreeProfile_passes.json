{
  "filename": "FreeProfile.mcr",
  "status": "completed",
  "total_tokens": 51828,
  "processing_time": 256.61646461486816,
  "passes": {
    "1": {
      "success": true,
      "data": {},
      "tokens_used": 8931,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses _kModelSpace explicitly in tslDialog.dbCreate(). It operates on GenBeam, PLine, and Element (3D Body) entities. There are no sd_ prefixes, _Viewport checks, or PaperSpace specific logic (#Type E). The script defines 3D geometry (FreeProfile tool) on construction elements."
        },
        "prerequisites": {
          "requiredEntities": [
            "GenBeam",
            "PLine"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Model Space",
          "requiredSettings": [
            "FreeProfile.xml"
          ]
        }
      },
      "tokens_used": 6395,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"commandLine\": {\n    \"insertionFlow\": [\n      {\n        \"step\": 1,\n        \"function\": \"getString\",\n        \"promptOriginal\": \"|Are you sure to overwrite existing settings?| [|No|]/|Yes|]\",\n        \"condition\": \"_bOnRecalc && _kExecuteKey == sTriggerExportSettings && findFile(sFullPath).length()>0\",\n        \"required\": false\n      }\n    ],\n    \"keywordOptions\": []\n  },\n  \"dialogs\": [\n    {\n      \"type\": \"TslInst Dialog\",\n      \"trigger\": \"Context Menu Item: Configure Tool\",\n      \"title\": \"Configure Tool\",\n      \"dataSource\": \"Internal Properties (DialogMode 1)\",\n      \"features\": {\n        \"searchable\": false,\n        \"multiSelect\": false\n      }\n    }\n  ],\n  \"opmProperties\": [\n    {\n      \"index\": null,\n      \"variable\": \"dDiameter\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Diameter|\",\n      \"defaultValue\": \"U(20)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Tool|\",\n      \"description\": \"Defines the tool diameter\"\n    },\n    {\n      \"index\": null,\n      \"variable\": \"dLength\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Length|\",\n      \"defaultValue\": \"U(0)\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Tool|\",\n      \"description\": \"Defines the tool length\"\n    },\n    {\n      \"index\": null,\n      \"variable\": \"nToolIndex\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|ToolIndex|\",\n      \"defaultValue\": 4,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Tool|\",\n      \"description\": \"Defines the ToolIndex\"\n    },\n    {\n      \"index\": null,\n      \"variable\": \"sName\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Name|\",\n      \"defaultValue\": \"Millhead\",\n      \"inputType\": \"text\",\n      \"options\": [],\n      \"category\": \"|Tool|\",\n      \"description\": \"Defines the name of the tool\"\n    },\n    {\n      \"index\": null,\n      \"variable\": \"sIsVertical\",\n      \"type\": \"PropString\",\n      \"displayName\": \"|Vertical Milling Head|\",\n      \"defaultValue\": \"|No|\",\n      \"inputType\": \"dropdown\",\n      \"options\": [\"|No|\", \"|Yes|\"],\n      \"category\": \"|Tool|\",\n      \"description\": \"Defines if the tool is a vertical milling head.\"\n    },\n    {\n      \"index\": null,\n      \"variable\": \"dAccuracy\",\n      \"type\": \"PropDouble\",\n      \"displayName\": \"|Accuracy|\",\n      \"defaultValue\": \"dEps\",\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Arc Approximation|\",\n      \"description\": \"Defines the accuracy of arc to line segment approximation.|Accuracy = 0 means no line approximation|\"\n    },\n    {\n      \"index\": null,\n      \"variable\": \"nColor\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Color Reference Side|\",\n      \"defaultValue\": 40,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Display|\",\n      \"description\": \"Defines the Color\"\n    },\n    {\n      \"index\": null,\n      \"variable\": \"nColor2\",\n      \"type\": \"PropInt\",\n      \"displayName\": \"|Color Top Side|\",\n      \"defaultValue\": 40,\n      \"inputType\": \"number\",\n      \"options\": [],\n      \"category\": \"|Display|\",\n      \"description\": \"Defines the Color\"\n    },\n    {\n      \"index\": null,\n      \""
      },
      "tokens_used": 9633,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Creates a custom free-form milling or cutting operation (groove, slot, contour) on timber beams based on a user-defined polyline, circle, or grip points.",
          "category": "Hardware / Machining",
          "typicalUseCase": "Used when standard rectangular or circular cuts are insufficient, such as creating complex tenons, custom slots for connection plates, or artistic contours on beam faces."
        },
        "parameters": [
          {
            "name": "dDiameter",
            "technicalDefault": "U(20)",
            "businessMeaning": "The diameter of the milling cutter or saw blade used to create the profile. This defines the width of the material removed.",
            "validRange": "6mm to 50mm (typical milling cutter sizes)",
            "unit": "mm",
            "affectsOutput": "Determines the width of the groove or slot cut into the beam geometry."
          },
          {
            "name": "dLength",
            "technicalDefault": "U(0)",
            "businessMeaning": "The working length or reach of the tool. A value of 0 typically implies the tool reaches infinitely or uses the machine's default maximum depth.",
            "validRange": "0mm to 500mm",
            "unit": "mm",
            "affectsOutput": "Limits the penetration depth of the tool or defines the length of the cutting body generated for CNC simulation."
          },
          {
            "name": "nToolIndex",
            "technicalDefault": 4,
            "businessMeaning": "The CNC machine identifier (Tool Number) that tells the machine which specific tool to load for this operation (e.g., Tool 4 = 20mm Mill).",
            "validRange": "1 to 999",
            "unit": "Integer",
            "affectsOutput": "Does not change the visual geometry but is critical for correct CAM data export (e.g., BTL, WUP)."
          },
          {
            "name": "sName",
            "technicalDefault": "Millhead",
            "businessMeaning": "The descriptive name for this tool configuration (e.g., 'Groover 20mm'), used to identify the operation in the Properties Palette and settings.",
            "validRange": "Alphanumeric String",
            "unit": "Text",
            "affectsOutput": "Identifies the tool instance in the UI; used to load settings from the XML configuration."
          },
          {
            "name": "sIsVertical",
            "technicalDefault": "|No|",
            "businessMeaning": "Defines the orientation of the tool axis relative to the beam surface. 'Yes' means the tool approaches perpendicular to the surface (vertical milling), 'No' means it approaches parallel or along the beam axis.",
            "validRange": "Yes/No",
            "unit": "Boolean/String",
            "affectsOutput": "Alters the 3D generation of the cutting body and the CNC path direction."
          },
          {
            "name": "dAccuracy",
            "technicalDefault": "dEps (0.1mm)",
            "businessMeaning": "The tolerance for converting curved segments (arcs) in the profile into straight line segments (polylines) for CNC machines that do not support continuous arc commands.",
            "validRange": "0.0mm to 5.0mm",
            "unit": "mm",
            "affectsOutput": "0.0 keeps true curves; higher values create faceted approximations of curves."
          },
          {
            "name": "nColor",
            "technicalDefault": 40,
            "businessMeaning": "The display color used to draw the path on the reference face of the beam in the CAD model.",
            "validRange": "0 to 255 (AutoCAD Color Index)",
            "unit": "ACI",
            "affectsOutput": "Visual representation only; helps distinguish different machining operations."
          },
          {
            "name": "nColor2",
            "technicalDefault": 40,
            "businessMeaning": "The display color used to draw the path on the opposite or top face of the beam in the CAD model.",
            "validRange": "0 to 255 (AutoCAD Color Index)",
            "unit": "ACI",
            "affectsOutput": "Visual representation only."
          },
          {
            "name": "nTransparency",
            "technicalDefault": 90,
            "businessMeaning": "The transparency level of the tool body or path visualization, allowing the user to see the beam material underneath.",
            "validRange": "0 (Opaque) to 100 (Fully Transparent)",
            "unit": "Percent",
            "affectsOutput": "Visual representation only."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Changing 'sName' (if it matches a preset in settings)",
            "effect": "Loads predefined Diameter, Length, CNC Index, and Accuracy values from the configuration map.",
            "cascade": [
              "dDiameter",
              "dLength",
              "nToolIndex",
              "dAccuracy"
            ]
          },
          {
            "trigger": "Setting 'sIsVertical' to Yes",
            "effect": "May change the required clearance or tool length checks internally.",
            "cascade": [
              "dLength"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "FreeProfile / Machining",
            "description": "A complex material removal operation based on the defined path.",
            "appliedTo": "Selected GenBeam (Timber Beam)"
          },
          {
            "type": "PLine (Polyline)",
            "description": "Visual representation of the tool path on the beam surface.",
            "appliedTo": "Model Space (associated with the beam)"
          },
          {
            "type": "Element (3D Body)",
            "description": "A visual 3D body representing the volume of material to be removed or the tool itself.",
            "appliedTo": "Model Space"
          }
        ]
      },
      "tokens_used": 9606,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Execution Start: Initialize settings and load XML configuration.",
          "2. User Interaction: Select primary GenBeam.",
          "3. User Interaction: Select secondary GenBeam (Optional) or press Enter to proceed with single beam.",
          "4. User Interaction: Select Reference Face using dynamic Jig preview.",
          "5. User Interaction: Define the profile path via one of three methods (Pick Points, Select Circle, Select Opening).",
          "6. System Processing: Calculate geometry based on tool parameters (Diameter, Length, Accuracy).",
          "7. Visual Output: Generate PLine (path) and Element (3D Body) on the beam.",
          "8. Completion: Insert TSL instance into Model Space."
        ],
        "conditionalBranches": [
          {
            "condition": "Secondary Beam Selection",
            "path1": {
              "name": "Single Beam Mode",
              "steps": [
                "User presses Enter at the second beam prompt.",
                "Script proceeds using only the primary beam geometry.",
                "Calculations are based solely on the reference beam's coordinate system."
              ]
            },
            "path2": {
              "name": "Two Beam Mode",
              "steps": [
                "User selects a second intersecting or adjacent beam.",
                "Script calculates common ranges or intersection geometry between beams.",
                "Profile may be adjusted to fit the intersection volume."
              ]
            }
          },
          {
            "condition": "Profile Path Definition Method",
            "path1": {
              "name": "Polyline Path (Points)",
              "steps": [
                "User clicks points in 3D space or on the beam face.",
                "Script connects points to form a PLine.",
                "Supports arc segments if defined."
              ]
            },
            "path2": {
              "name": "Circle Selection",
              "steps": [
                "User selects an existing Circle entity.",
                "Script extracts radius and center point.",
                "Generates a circular profile path."
              ]
            },
            "path3": {
              "name": "Opening/Element Selection",
              "steps": [
                "User selects an existing Opening or Element entity.",
                "Script uses the contours of the selected entity.",
                "Useful for aligning new cuts with existing geometry."
              ]
            }
          },
          {
            "condition": "Export Settings File Status",
            "path1": {
              "name": "Overwrite Existing",
              "steps": [
                "Script detects file exists at target path.",
                "Prompts user: 'Are you sure to overwrite existing settings? [No/Yes]'.",
                "If Yes, overwrites file; otherwise cancels."
              ]
            },
            "path2": {
              "name": "Create New",
              "steps": [
                "Script detects no file exists.",
                "Writes settings file directly without confirmation prompt."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Beam Selection",
            "errorMessage": "Implicit failure (getPoint returns false).",
            "recovery": "User must select a valid GenBeam entity to proceed."
          },
          {
            "check": "Reference Face",
            "errorMessage": "None explicitly in code, but getPoint fails if face not selected.",
            "recovery": "User must pick a face on the beam during the Jig operation."
          },
          {
            "check": "Tool Configuration Name",
            "errorMessage": "Invalid Tool Name",
            "recovery": "User must provide a non-empty name in the 'Configure Tool' dialog."
          },
          {
            "check": "Settings File Path",
            "errorMessage": "File not found (during Import)",
            "recovery": "User must ensure the XML file exists in the configured Company or Install path."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Modify Geometry",
            "how": "Grip Edit",
            "effect": "Dragging the profile grips updates the shape of the cut/tool path dynamically."
          },
          {
            "action": "Change Tool Parameters",
            "how": "OPM Properties (Properties Palette)",
            "effect": "Changing Diameter, Length, or Colors updates the visualization and CNC attributes immediately."
          },
          {
            "action": "Flip Side",
            "how": "Context Menu (Right-click)",
            "effect": "Moves the tool profile from the current reference face to the opposite face."
          },
          {
            "action": "Lock Path",
            "how": "Context Menu: 'Create defining polyline'",
            "effect": "Converts the dynamic grip-based path into a static polyline entity. Removes grips."
          },
          {
            "action": "Unlock Path",
            "how": "Context Menu: 'Create defining grips'",
            "effect": "Converts a static polyline back into a dynamic, editable grip path."
          },
          {
            "action": "Manage Presets",
            "how": "Context Menu: 'Configure Tool' / 'Import Settings' / 'Export Settings'",
            "effect": "Opens dialogs to save current settings to XML, load saved presets, or update the tool library."
          }
        ]
      },
      "tokens_used": 10474,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# FreeProfile.mcr\n\n## Overview\nCreates custom free-form milling or cutting operations (grooves, slots, contours) on timber beams based on a user-defined path. This tool is ideal for complex geometries where standard rectangular or circular cuts are insufficient, allowing for tool path definition via points, circles, or existing openings.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Operates on 3D GenBeam entities. |\n| Paper Space | No | Not applicable for 3D machining operations. |\n| Shop Drawing | No | This is a 3D model generation script. |\n\n## Prerequisites\n- **Required Entities:** At least one `GenBeam` (Timber Beam).\n- **Optional Entities:** `PLine`, `Circle`, or `Element` (for defining path geometry).\n- **Minimum Beam Count:** 1 (Second beam is optional).\n- **Required Settings:** `FreeProfile.xml` (Required only for using presets or saving configurations).\n\n## Usage Steps\n\n### Step 1: Launch Script\n1.  Type `TSLINSERT` in the command line.\n2.  Select `FreeProfile.mcr` from the list.\n\n### Step 2: Select Primary Beam\n```\nCommand Line: Select beam:\nAction: Click on the timber beam you wish to machine.\n```\n\n### Step 3: Select Secondary Beam (Optional)\n```\nCommand Line: Select second beam (or press Enter to skip):\nAction: \n- If the cut involves an intersection with another beam, select the second beam.\n- Otherwise, press Enter to proceed with the single beam.\n```\n\n### Step 4: Select Reference Face\n```\nCommand Line: Select face:\nAction: Move your cursor over the beam. A dynamic preview of the profile will appear on different faces.\nClick to select the desired face (e.g., Top, Bottom, Left, Right) where the machining should start.\n```\n\n### Step 5: Define Profile Path\nThe script offers multiple ways to define the shape of the cut.\n```\nCommand Line: [Pick Point / Select Circle / Select Opening]:\nAction: Choose one of the following methods:\n```\n- **Option A (Pick Point):** Click points on the face to draw a custom polyline. Press Enter to finish the shape.\n- **Option B (Select Circle):** Type `S` (if mapped) or select the circle option, then click an existing Circle entity in the drawing to use its shape.\n- **Option C (Select Opening):** Type `O` (if mapped) or select the opening option, then click an existing Opening or Element to trace its contour.\n\n### Step 6: Finalize\nThe script generates the 3D representation of the tool path and applies the machining operation to the beam.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| **Diameter** | Number | 20 mm | The diameter of the milling cutter or saw blade. Defines the width of the cut. |\n| **Length** | Number | 0 mm | The working length/reach of the tool. A value of 0 typically implies infinite or maximum depth. |\n| **ToolIndex** | Integer | 4 | The CNC machine tool number (e.g., T4) assigned to this operation for manufacturing data. |\n| **Name** | Text | Millhead | The descriptive name of the tool configuration. Changing this can trigger preset loading if it matches an XML entry. |\n| **Vertical Milling Head** | Dropdown | No | Determines tool orientation. \"Yes\" = perpendicular to surface; \"No\" = parallel to beam axis. |\n| **Accuracy** | Number | dEps | Tolerance for converting curves to straight lines (0 = true curves, higher value = faceted). |\n| **Color Reference Side** | Integer | 40 | AutoCAD color index for the tool path on the selected face. |\n| **Color Top Side** | Integer | 40 | AutoCAD color index for the tool path on the opposite face. |\n| **Transparency** | Integer | 90 | Transparency level of the tool body visualization (0 = Opaque, 100 = Invisible). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| **Configure Tool** | Opens a dialog box to edit Tool Name, Diameter, Length, Index, and other parameters in a centralized form. |\n| **Flip Side** | Moves the profile path from the current reference face to the opposite face of the beam. |\n| **Create defining polyline** | Locks the profile by converting the dynamic grip path into a static polyline entity. Removes editing grips. |\n| **Create defining grips** | Unlocks the profile by converting a static polyline back into dynamic grips, allowing geometric edits. |\n| **Import Settings** | Loads tool parameters (Diameter, Index, etc.) from an external `FreeProfile.xml` file. |\n| **Export Settings** | Saves the current tool parameters to `FreeProfile.xml` for future reuse. |\n\n## Settings Files\n- **Filename**: `FreeProfile.xml`\n- **Location**: Company or Install path (configured in hsbCAD settings).\n- **Purpose**: Stores predefined tool configurations (presets). This allows you to save specific tool diameters and CNC indices and load them later via the \"Name\" property or Import function.\n\n## Tips\n- **Previewing Faces:** Use the \"Select Face\" step carefully; the visual preview shows exactly where the material will be removed.\n- **Complex Shapes:** Use the \"Pick Point\" option to draw custom slots or tenons that aren't simple rectangles.\n- **CNC Export:** Always check the **ToolIndex** property. If this number does not match a tool in your CNC machine's database, the manufacturing output may fail or default to a generic tool.\n- **Locking Geometry:** Once a profile is exactly where you want it, use the **Create defining polyline** context menu option. This prevents accidental shifts if the beam geometry changes slightly.\n\n## FAQ\n- **Q: Can I use this to cut a hole all the way through the beam?**\n  A: Yes. Define the path and ensure the **Length** parameter is sufficient to penetrate through the beam, or ensure the depth/height of the path geometry exceeds the beam's dimensions relative to the start face.\n- **Q: What does \"Accuracy = 0\" do?**\n  A: It tells the CAM system to export the path as true mathematical curves (Arcs). If you set a value > 0, curves are broken into small straight line segments.\n- **Q: Why can't I edit the shape anymore?**\n  A: The profile might be locked as a static polyline. Right-click the script instance and select **Create defining grips** to restore the edit handles."
      },
      "tokens_used": 6789,
      "error": null
    }
  }
}