{
  "filename": "HSB_E-DuplicateBeamsBehindSheet.mcr",
  "status": "completed",
  "total_tokens": 38806,
  "processing_time": 644.6224360466003,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 1,
          "minorVersion": 7,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "This tsl duplicates beams",
        "versionHistory": [
          {
            "version": "1.00",
            "date": "06.04.2017",
            "author": "YB",
            "changes": "Pilot version"
          },
          {
            "version": "1.01",
            "date": "07.04.2017",
            "author": "YB",
            "changes": "Added support for angled beams at lower end, improved filter"
          },
          {
            "version": "1.02",
            "date": "07.04.2017",
            "author": "YB",
            "changes": "Fixed a bug where beams would go through an opening"
          },
          {
            "version": "1.03",
            "date": "10.04.2017",
            "author": "YB",
            "changes": "Fixed angled beams at lower end"
          },
          {
            "version": "1.04",
            "date": "10.04.2017",
            "author": "YB",
            "changes": "Added an include / exlude option for the filter"
          },
          {
            "version": "1.05",
            "date": "21.04.2017",
            "author": "YB",
            "changes": "Fixed a bug with mirroring the wall, TSL will now be deleted after placing."
          },
          {
            "version": "1.06",
            "date": "24.04.2017",
            "author": "YB",
            "changes": "TSL now cuts a beam properly when intersecting a second roofplane."
          },
          {
            "version": "1.07",
            "date": "24.04.2017",
            "author": "YB",
            "changes": "Bug fix."
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7555,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script interacts directly with 3D model entities using `getElement(T('Select wall'))` to select a `Wall` object. It retrieves physical data via `el.beam()` and `el.sheet(zoneIndex)`, modifies geometry using `transformBy()`, and creates new database entities with `dbCopy()`. It does not use ShopDrawing specific functions (`sd_`), viewports, or 2D drawing generation logic."
        },
        "prerequisites": {
          "requiredEntities": [
            "Wall"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space (3D)",
          "requiredSettings": []
        }
      },
      "tokens_used": 5971,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getElement",
              "promptOriginal": "Select wall",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "ShowDynamicDialog",
            "trigger": "_bOnInsert",
            "title": null,
            "dataSource": "OPM Properties (filterType, beamcodeFilter, propZoneIndex)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "filterType",
            "type": "PropString",
            "displayName": "Filter type",
            "defaultValue": "Include",
            "inputType": "dropdown",
            "options": [
              "Include",
              "Exclude"
            ],
            "category": "Filter",
            "description": "Include: The TSL will only duplicate the beams with the beamcode entered in the property 'Beamcode filter'.\nExclude: The TSL will filter out the beams with the beamcode entered in the property 'Beamcode filter'."
          },
          {
            "index": 1,
            "variable": "beamcodeFilter",
            "type": "PropString",
            "displayName": "Beamcode filter",
            "defaultValue": "",
            "inputType": "text",
            "options": [],
            "category": "Filter",
            "description": "Beamcode used for filtering the beams. Use the property 'Filter type' to include or excluse beams with this beamcode."
          },
          {
            "index": 1,
            "variable": "propZoneIndex",
            "type": "PropInt",
            "displayName": "Zone index",
            "defaultValue": "1",
            "inputType": "dropdown",
            "options": [
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10
            ],
            "category": "Sheeting",
            "description": "The zone index for the sheeting."
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6025,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically duplicates vertical studs (studs/jacks) to align directly behind sheeting joints to provide nailing support.",
          "category": "Framing",
          "typicalUseCase": "Used during wall detailing to ensure that the edges of structural sheeting (OSB, Plywood) have adequate backing material for fasteners, preventing weak joints."
        },
        "parameters": [
          {
            "name": "filterType",
            "technicalDefault": "Include",
            "businessMeaning": "Defines whether the 'Beamcode filter' acts as a whitelist (Include) or blacklist (Exclude) for selecting studs to duplicate.",
            "validRange": "Include, Exclude",
            "unit": "enum",
            "affectsOutput": "Determines which studs in the wall are candidates for duplication based on their codes."
          },
          {
            "name": "beamcodeFilter",
            "technicalDefault": "",
            "businessMeaning": "Specific beam code(s) (e.g., 'Stud', 'Cripple') used to identify which studs should be processed. Supports multiple codes separated by semicolons.",
            "validRange": "Any string matching project beamcodes",
            "unit": "string",
            "affectsOutput": "Filters the selection of vertical beams. Only those matching (or not matching, based on filterType) this list will be checked for placement behind sheet joints."
          },
          {
            "name": "propZoneIndex",
            "technicalDefault": "1",
            "businessMeaning": "Specifies which sheeting layer on the wall to analyze for joints.",
            "validRange": "1 - 10 (Integer)",
            "unit": "index",
            "affectsOutput": "The script calculates the geometry of the sheeting in this specific zone to determine where the joints (edges) are located, and thus where to place the duplicated backing beams."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "filterType is set to 'Include'",
            "effect": "Only studs with a beam code found in 'beamcodeFilter' will be duplicated.",
            "cascade": [
              "beamcodeFilter"
            ]
          },
          {
            "trigger": "filterType is set to 'Exclude'",
            "effect": "All studs will be considered for duplication except those with a beam code found in 'beamcodeFilter'.",
            "cascade": [
              "beamcodeFilter"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Beam (Copy)",
            "description": "Creates a new beam instance that is a copy of an existing vertical stud. The original stud and the new copy are shifted left and right respectively to sandwich the sheet joint. Both are then cut/shortened to fit between intersecting roof or floor beams.",
            "appliedTo": "Vertical beams (studs) in the selected Wall that are geometrically aligned with sheeting edges."
          }
        ]
      },
      "tokens_used": 6379,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Launch Script",
          "Check Insertion Cycle (Prevent double-run on recalc)",
          "Show Properties Dialog (Filter/Zone settings)",
          "Prompt User to Select Wall",
          "Validate Selection (Count == 1)",
          "Validate Element Type (Is Wall)",
          "Clean Up Previous Map Entities (Remove 'Beam', 'Sheet', 'BeamOriginal')",
          "Parse Beamcode Filter String (Split by ';')",
          "Fetch All Beams from Wall",
          "Apply Filter Logic (Include vs Exclude)",
          "Fetch Sheets from Specified Zone Index",
          "Calculate Sheet Edge Midpoints (Vertical edges only)",
          "Sort and Deduplicate Edges",
          "Validate Edge Count (Min 2)",
          "Identify Vertical Beams aligned with Sheet Joints",
          "Separate Angled Beams (for intersection logic) and Blocking Beams",
          "Loop Through Target Beams",
          "Create Copy of Beam",
          "Transform Original and Copy (Shift Left/Right)",
          "Calculate Intersections with Angled Beams",
          "Stretch Beams to Intersections",
          "Apply Cuts if Intersections differ (Roofplane logic)",
          "Stretch Blocking Beams around new duplicates",
          "Erase Script Instance and Exit"
        ],
        "conditionalBranches": [
          {
            "condition": "Filter Type Property ('filterType')",
            "path1": {
              "name": "Include",
              "steps": [
                "Iterate through all wall beams",
                "Add beam to list ONLY if beamcode matches 'beamcodeFilter'",
                "Process filtered list"
              ]
            },
            "path2": {
              "name": "Exclude",
              "steps": [
                "Iterate through all wall beams",
                "Add beam to list if beamcode DOES NOT match 'beamcodeFilter'",
                "Process filtered list"
              ]
            }
          },
          {
            "condition": "Intersection Logic (Angled Beams)",
            "path1": {
              "name": "Same Intersection Beam",
              "steps": [
                "Both original and copy intersect the same angled beam",
                "Stretch both original and copy to that single intersecting beam"
              ]
            },
            "path2": {
              "name": "Different Intersection Beams",
              "steps": [
                "Original and copy intersect different angled beams (e.g., dual pitch roof)",
                "Stretch original to its intersection",
                "Stretch copy to its intersection",
                "Apply Cut Plane based on the specific intersecting beam's geometry"
              ]
            }
          },
          {
            "condition": "Valid Data Availability",
            "path1": {
              "name": "Data Valid",
              "steps": [
                "Sheet edges found",
                "Vertical beams found at joints",
                "Execute duplication"
              ]
            },
            "path2": {
              "name": "Data Invalid",
              "steps": [
                "No sheet edges OR no target beams found",
                "Erase script instance",
                "Exit without changes"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Selection Count",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases self if user cancels or selects wrong number of elements."
          },
          {
            "check": "Element Type",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases self if selected element is not a Wall."
          },
          {
            "check": "Sheet Geometry",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases self if specified zone has fewer than 2 sheet edges (likely no sheets)."
          },
          {
            "check": "Target Beams",
            "errorMessage": "None (Silent)",
            "recovery": "Script erases self if no beams are found behind the sheet joints after filtering."
          }
        ],
        "postInsertionActions": []
      },
      "tokens_used": 7462,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# HSB_E-DuplicateBeamsBehindSheet\n\n## Overview\nThis script automatically duplicates vertical studs behind sheeting joints to provide backing for nailing. It detects the edges of structural sheeting on a wall and generates extra backing beams (studs) to sandwich the sheet joint, ensuring strong connections.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | The script operates directly on 3D Wall elements. |\n| Paper Space | No | Not applicable for 2D views. |\n| Shop Drawing | No | This is a detailing/modification script, not a drawing generator. |\n\n## Prerequisites\n- **Required Entities**: A Wall element containing both beams (studs) and sheeting.\n- **Minimum Beam Count**: None specific, but vertical beams must exist to be duplicated.\n- **Required Settings Files**: None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Browse and select `HSB_E-DuplicateBeamsBehindSheet.mcr`\n\n### Step 2: Configure Properties\nA dynamic dialog will appear upon insertion. Adjust the following settings to define which studs to duplicate and which sheeting layer to analyze.\n\n### Step 3: Select Wall\n```\nCommand Line: Select wall\nAction: Click on the desired Wall element in the 3D model that contains the sheeting and studs you wish to process.\n```\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Filter type | dropdown | Include | Determines if the Beamcode filter acts as a whitelist (**Include**) or blacklist (**Exclude**). |\n| Beamcode filter | text | (empty) | The beam code(s) to identify studs (e.g., \"Stud\"). Separate multiple codes with a semicolon (;). |\n| Zone index | number | 1 | The index of the sheeting layer on the wall to analyze for joints (Range: 1-10). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific context menu options. It runs once upon insertion and deletes itself. |\n\n## Settings Files\n- **Filename**: None required.\n- **Location**: N/A\n- **Purpose**: N/A\n\n## Tips\n- **Script Behavior**: This script is a \"run-once\" tool. It will automatically delete itself from the drawing after processing the wall. If you need to undo the changes, use the standard AutoCAD `UNDO` command.\n- **Beam Codes**: Ensure the `Beamcode filter` matches the codes used in your project (e.g., \"Stud\", \"Cripple\"). If the filter is empty, the script may process all or none depending on the `Filter type` logic.\n- **Dual Pitch Roofs**: The script is smart enough to handle studs that intersect with different roof planes on either side (e.g., in a valley or dual-pitch situation), applying the correct cut angles to the new backing beams.\n- **Mirroring**: If you have mirrored the wall, run this script again to ensure the backing studs are correctly generated for the mirrored geometry.\n\n## FAQ\n- **Q: Why did the script disappear after I selected the wall?**\n  - A: The script is designed to erase itself after executing. Check your model to see if the new backing beams have been created behind the sheet joints.\n- **Q: No beams were created. Why?**\n  - A: This usually happens for three reasons: 1) The selected wall does not have sheeting in the specified `Zone index`. 2) No vertical studs were found that match the `Beamcode filter`. 3) The vertical studs are not aligned with any sheeting joints.\n- **Q: What is the difference between Include and Exclude?**\n  - A: **Include** only duplicates studs that match the code you type (e.g., only duplicate \"Stud\"). **Exclude** duplicates all studs *except* the ones matching the code (e.g., duplicate everything except \"Trim\")."
      },
      "tokens_used": 5414,
      "error": null
    }
  }
}