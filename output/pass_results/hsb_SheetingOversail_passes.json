{
  "filename": "hsb_SheetingOversail.mcr",
  "status": "completed",
  "total_tokens": 44846,
  "processing_time": 215.43993020057678,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "02.02.2011",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "16.02.2011",
            "author": null,
            "changes": "Bugfix with plane profile on sheets"
          },
          {
            "version": "1.2",
            "date": "05.04.2011",
            "author": null,
            "changes": "Add properties so the customer can change the display of the setback and overhang"
          },
          {
            "version": "1.3",
            "date": "12.03.2012",
            "author": null,
            "changes": "Altered display so that it works for cassettes looked at from underneath"
          },
          {
            "version": "1.4",
            "date": "18.05.2012",
            "author": null,
            "changes": "Bugfix, return when no sheets found."
          },
          {
            "version": "1.5",
            "date": "22.11.2012",
            "author": null,
            "changes": "Bugfix on vector directions for vz and re-oriented text"
          },
          {
            "version": "1.5",
            "date": "14.09.2015",
            "author": null,
            "changes": "Improved calculation of shy/oversail as it was using closest point to and was failing by finding an edge which is in line with the segment"
          },
          {
            "version": "1.7",
            "date": "31.03.2016",
            "author": null,
            "changes": "Changed capsule intersect line segment to start go across the sheet segment, rather than start from the sheet segment"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 7013,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script prompts the user to 'Select the viewport from which the element is taken' using getViewport and stores it in the internal array _Viewport. It retrieves the Element via vp.element() and uses the Viewport's coordinate system (ms2ps = vp.coordSys()) to transform geometry for display (transformBy(ms2ps)). The script calculates shadow profiles of Sheets and Beams from the Element and dimensions their offsets relative to each other, specifically designed for annotation in a viewport context."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element containing Sheets and Beams"
          ],
          "minimumBeams": 1,
          "requiredSpace": "Must be run in Paper Space with a Viewport selected or implicitly handled during insert to establish the link to the Model Space element.",
          "requiredSettings": []
        }
      },
      "tokens_used": 4727,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getViewport",
              "promptOriginal": "Select the viewport from which the element is taken",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "nZone",
            "type": "PropInt",
            "displayName": "Zone index",
            "defaultValue": 5,
            "inputType": "dropdown",
            "options": [
              "-5",
              "-4",
              "-3",
              "-2",
              "-1",
              "1",
              "2",
              "3",
              "4",
              "5"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "Dimension Style",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": "_DimStyles",
            "category": null,
            "description": "Used to set the dimensioning layout."
          },
          {
            "index": 1,
            "variable": "sDeltaOnTop",
            "type": "PropString",
            "displayName": "Side of delta dimensioning",
            "defaultValue": "Above",
            "inputType": "dropdown",
            "options": [
              "Above",
              "Below"
            ],
            "category": null,
            "description": "Used to set the side of the text."
          },
          {
            "index": 0,
            "variable": "dOffsetFromEl",
            "type": "PropDouble",
            "displayName": "Offset From Element",
            "defaultValue": "U(150, 8)",
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "strTextDirD",
            "type": "PropString",
            "displayName": "Delta text direction",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "None",
              "Parallel",
              "Perpendicular"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "sSetBack",
            "type": "PropString",
            "displayName": "Setback sufix",
            "defaultValue": "Setback",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "sOverhang",
            "type": "PropString",
            "displayName": "Overhang sufix",
            "defaultValue": "Overhang",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "nDimColor",
            "type": "PropInt",
            "displayName": "Color",
            "defaultValue": 1,
            "inputType": "number",
            "options": [],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 6448,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automatically annotates the oversail (overhang) or setback distance of sheeting material relative to the structural timber frame in a 2D drawing view.\",\n    \"category\": \"ShopDrawing / Annotation\",\n    \"typicalUseCase\": \"Used during the creation of layout drawings to verify and document the positioning of roof or floor sheathing relative to the underlying beams, ensuring compliance with structural requirements or erection tolerances.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"nZone\",\n      \"technicalDefault\": \"5\",\n      \"businessMeaning\": \"Selects the specific construction layer (zone) of sheets to analyze (e.g., structural sheathing vs. decking).\",\n      \"validRange\": \"-5 to 5 (Integer, excluding 0)\",\n      \"unit\": \"Index\",\n      \"affectsOutput\": \"Determines which set of sheeting components are measured against the beams. An incorrect zone may result in no annotations or annotations for the wrong material layer.\"\n    },\n    {\n      \"name\": \"sDimStyle\",\n      \"technicalDefault\": \"null (Current Standard)\",\n      \"businessMeaning\": \"Specifies the AutoCAD Dimension Style to use for the text appearance (font, height, arrow style).\",\n      \"validRange\": \"Any existing Dimension Style name in the drawing\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Controls the visual formatting (text size, font) of the generated annotations to match drawing standards.\"\n    },\n    {\n      \"name\": \"sDeltaOnTop\",\n      \"technicalDefault\": \"Above\",\n      \"businessMeaning\": \"Intended to control the vertical placement of the text label relative to the measurement point.\",\n      \"validRange\": \"Above, Below\",\n      \"unit\": \"Option\",\n      \"affectsOutput\": \"Positions the text label either above or below the dimension line/end point.\"\n    },\n    {\n      \"name\": \"dOffsetFromEl\",\n      \"technicalDefault\": \"U(150, 8)\",\n      \"businessMeaning\": \"The distance in model space millimeters to offset the text label away from the sheet edge to prevent overlap with geometry.\",\n      \"validRange\": \"50mm to 500mm (depending on drawing scale)\",\n      \"unit\": \"mm\",\n      \"affectsOutput\": \"Moves the generated annotation further away or closer to the sheet edge. Too small a value may cause text to clash with drawing lines.\"\n    },\n    {\n      \"name\": \"strTextDirD\",\n      \"technicalDefault\": \"None\",\n      \"businessMeaning\": \"Intended to define the orientation of the text (e.g., horizontal, parallel to the sheet edge).\",\n      \"validRange\": \"None, Parallel, Perpendicular\",\n      \"unit\": \"Option\",\n      \"affectsOutput\": \"Controls the rotation angle of the text label.\"\n    },\n    {\n      \"name\": \"sSetBack\",\n      \"technicalDefault\": \"Setback\",\n      \"businessMeaning\": \"The text suffix displayed when the sheet edge is recessed inside the beam envelope (negative overhang).\",\n      \"validRange\": \"Text String (e.g., 'Setback', 'Recess', '-')\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Appends this label to the measured dimension when the sheet does not reach the beam (e.g., '50mm Setback').\"\n    },\n    {\n      \"name\": \"sOverhang\",\n      \"technicalDefault\": \"Overhang\",\n      \"businessMeaning\": \"The text suffix displayed when the sheet edge extends past the beam envelope.\",\n      \"validRange\": \"Text String (e.g., 'Overhang', 'Proj', '+')\",\n      \"unit\": \"String\",\n      \"affectsOutput\": \"Appends this label to the measured dimension when the sheet sticks out past the beam (e.g., '50mm Overhang').\"\n    },\n    {\n      \"name\": \"nDimColor\",\n      \"technicalDefault\": \"1\",\n      \"businessMeaning\": \"The AutoCAD Color Index (ACI) used for the annotation text.\",\n      \"validRange\": \"1 to 255\",\n      \"unit\": \"Color Index\",\n      \"affectsOutput\": \"Changes the color of the generated text to distinguish annotations (e.g., Red for highlighting clashes or specific layers).\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"Element Properties\",\n      \"effect\": \"The 'nZone' parameter relies on the element having valid sheets assigned to the specified zone index.\",\n      \"cascade\":"
      },
      "tokens_used": 9369,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"workflowDiagram\": [\n    \"1. User initiates script insertion via command or catalog.\",\n    \"2. Properties Dialog displays (triggered by showDialogOnce) allowing initial configuration of Zone, DimStyle, and Offset.\",\n    \"3. Command line prompts: 'Select the viewport from which the element is taken'.\",\n    \"4. User selects a Viewport in Paper Space.\",\n    \"5. Script retrieves the linked hsbCAD Element from the Viewport.\",\n    \"6. Script gathers all Beams and Sheets (from specified Zone) from the Element.\",\n    \"7. Script calculates Shadow Profiles of Sheets and Beams on the Element's Z-plane.\",\n    \"8. Script identifies the largest outer ring (outline) for both the combined Sheets and combined Beams.\",\n    \"9. Script iterates through every edge segment of the Sheet Outline:\",\n    \"   9a. Calculates the outward normal vector from the sheet edge.\",\n    \"   9b. [Branch] Checks if the edge midpoint lies within an Opening profile. If yes, skip edge.\",\n    \"   9c. Casts a ray perpendicular to the sheet edge towards the beam outline.\",\n    \"   9d. [Branch] Checks for intersections with Beam edges. If none found, skip edge.\",\n    \"   9e. Identifies the closest intersecting Beam edge.\",\n    \"   9f. Calculates the distance and direction (Overhang vs Setback).\",\n    \"   9g. [Branch] If distance is less than 1mm, skip drawing to avoid clutter.\",\n    \"   9h. Determines text orientation based on the view quadrant (Top/Bottom/Horizontal/Vertical).\",\n    \"   9i. Transforms coordinates from Model Space to Paper Space.\",\n    \"   9j. Draws the dimension text at the calculated offset.\"\n  ],\n  \"conditionalBranches\": [\n    {\n      \"condition\": \"Sheet Edge vs Opening Profile\",\n      \"path1\": {\n        \"name\": \"Edge inside Opening\",\n        \"steps\": [\n          \"Script detects edge midpoint (offset slightly outward) is inside the 'ppOpenings' profile.\",\n          \"Script executes 'continue' statement.\",\n          \"No dimension is drawn for this edge.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Edge outside Opening\",\n        \"steps\": [\n          \"Script proceeds to cast ray towards beams.\",\n          \"Calculation of overhang/setback continues.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Ray-Beam Intersection\",\n      \"path1\": {\n        \"name\": \"No Intersections Found\",\n        \"steps\": [\n          \"findCapsuleIntersections returns empty array for beam edges.\",\n          \"Script executes 'continue' statement.\",\n          \"No dimension is drawn (Assumes sheet extends infinitely or no beam present).\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Intersections Found\",\n        \"steps\": [\n          \"Script filters results to find the segment physically closest to the sheet edge.\",\n          \"Calculates distance and specific point on beam.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"View Orientation (Top vs Bottom)\",\n      \"path1\": {\n        \"name\": \"Viewed from Top (Standard)\",\n        \"steps\": [\n          \"_ZW (View Z) and Element Z vectors align positively.\",\n          \"Text vectors calculated normally based on screen quadrants.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Viewed from Underneath\",\n        \"steps\": [\n          \"Dot product of _ZW and transformed Element Z is negative.\",\n          \"vXDisp vector is inverted (-vXDisp).\",\n          \"Ensures text remains readable and correctly oriented relative to the 'underside' view.\"\n        ]\n      }\n    },\n    {\n      \"condition\": \"Text Alignment (Screen Quadrant)\",\n      \"path1\": {\n        \"name\": \"Horizontal/Vertical Edges\",\n        \"steps\": [\n          \"Segment dot product with World X or Y is ~0.\",\n          \"Text forced to align with _YW or _XW respectively for consistency.\"\n        ]\n      },\n      \"path2\": {\n        \"name\": \"Angled Edges\",\n        \"steps\": [\n          \"Text aligned parallel to the projected segment vector.\",\n          \"Ensures text follows the angle of the sheet edge on screen.\"\n        ]\n      }\n    }\n  ],\n  \"validationRules\": [\n    {\n      \"check\": \"Viewport Selection\",\n      \"errorMessage\": \"Implicit (Script exits"
      },
      "tokens_used": 10426,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SheetingOversail\n\n## Overview\nThis script automatically annotates the oversail (overhang) or setback distance of sheeting material relative to the structural timber frame in a 2D drawing view. It is used to verify and document the positioning of roof or floor sheathing relative to the underlying beams.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | This script is designed to annotate views. |\n| Paper Space | Yes | This script must be run in Paper Space. |\n| Shop Drawing | Yes | Specifically designed for production layout drawings. |\n\n## Prerequisites\n- **Required Entities**: A drawing layout containing a Viewport that displays an hsbCAD Element.\n- **Minimum Content**: The Element must contain both Structural Beams and Sheeting ( Sheets ) assigned to a specific construction layer.\n- **Zone Setup**: The sheeting materials must be assigned to a valid Zone index (e.g., Zone 5) for the script to detect them.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` (or select from your hsbCAD script toolbar)\nAction: Browse and select `hsb_SheetingOversail.mcr`.\n\n### Step 2: Select Viewport\n```\nCommand Line: Select the viewport from which the element is taken\nAction: Click on the viewport in Paper Space that shows the element you wish to annotate.\n```\n*Note: Once selected, the script will automatically calculate the offsets and draw the dimensions.*\n\n## Properties Panel Parameters\nAfter insertion, select the script instance in AutoCAD to modify these parameters in the Properties Palette.\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Zone index | dropdown | 5 | Selects the construction layer (Zone) of the sheets to analyze. Range is -5 to 5. |\n| Dimension Style | dropdown | *Current Standard* | Selects the AutoCAD Dimension Style to control text font and size. |\n| Side of delta dimensioning | dropdown | Above | Places the dimension text either \"Above\" or \"Below\" the measurement line. |\n| Offset From Element | number | 150 mm | The distance the text label is offset from the sheet edge to prevent overlap. |\n| Delta text direction | dropdown | None | Controls text rotation: \"None\", \"Parallel\", or \"Perpendicular\" to the sheet edge. |\n| Setback sufix | text | Setback | The text label added when the sheet is recessed (e.g., \"50mm Setback\"). |\n| Overhang sufix | text | Overhang | The text label added when the sheet extends past the beam (e.g., \"50mm Overhang\"). |\n| Color | number | 1 (Red) | The AutoCAD Color Index (ACI) for the generated dimension text. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | No custom right-click menu options are defined for this script. Use the Properties Palette to change settings. |\n\n## Settings Files\n- **Filename**: *None*\n- **Location**: N/A\n- **Purpose**: This script does not rely on external settings files.\n\n## Tips\n- **Wrong Zone?** If the script runs but no dimensions appear, check the **Zone index** property. The sheets may be assigned to a different zone number (e.g., Zone 1 vs Zone 5).\n- **Text Clashing:** If the dimension text overlaps with your drawing lines, increase the **Offset From Element** value.\n- **View Orientation:** The script works best when viewing the element from \"Top\". If viewing a ceiling from underneath, the script automatically adjusts text orientation to remain readable.\n- **Clean Drawings:** The script automatically skips small gaps (less than 1mm) and edges within openings to keep the drawing uncluttered.\n\n## FAQ\n- **Q: Why does the text say \"Setback\" instead of \"Overhang\"?**\n  A: The script calculates the relative position of the sheet to the beam. If the sheet edge is inside the beam outline, it is a \"Setback\". If it is outside, it is an \"Overhang\". You can change these labels in the Properties panel.\n- **Q: Can I change the color of the dimensions?**\n  A: Yes, use the **Color** property in the Properties Palette to match your layer standards.\n- **Q: Does this work on curved walls?**\n  A: Yes, the script analyzes the outline profile regardless of complexity, calculating the perpendicular distance to the nearest beam edge."
      },
      "tokens_used": 6863,
      "error": null
    }
  }
}