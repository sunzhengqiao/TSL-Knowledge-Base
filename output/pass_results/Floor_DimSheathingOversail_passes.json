{
  "filename": "Floor_DimSheathingOversail.mcr",
  "status": "completed",
  "total_tokens": 29597,
  "processing_time": 203.51568698883057,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": "",
          "numBeamsReq": 0,
          "keywords": [],
          "majorVersion": 0,
          "minorVersion": 0,
          "dxaOut": 0,
          "implInsert": 0
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 4030,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script prompts for Viewport selection via getViewport() and stores it in _Viewport. Calculates transformation matrices (ms2ps, ps2ms) to convert geometry between Model Space and Paper Space. Retrieves Element, Beam, and Sheet data from the Viewport to draw dimensions in Paper Space."
        },
        "prerequisites": {
          "requiredEntities": [
            "Viewport",
            "Element",
            "Sheet",
            "Beam"
          ],
          "minimumBeams": 0,
          "requiredSpace": "AutoCAD Layout containing a Viewport linked to an hsbCAD Element.",
          "requiredSettings": [
            "Dimension Style referenced by sDimStyle property"
          ]
        }
      },
      "tokens_used": 3926,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "getPoint",
              "promptOriginal": "",
              "condition": "_bOnInsert",
              "required": true
            },
            {
              "step": 2,
              "function": "getViewport",
              "promptOriginal": "Select a viewport, you can add others later on with the HSB_LINKTOOLS command.",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [
          {
            "index": 0,
            "variable": "strDir",
            "type": "PropString",
            "displayName": "Direction",
            "defaultValue": "Horizontal",
            "inputType": "dropdown",
            "options": [
              "Horizontal",
              "Vertical"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 0,
            "variable": "nZone",
            "type": "PropInt",
            "displayName": "Zone index",
            "defaultValue": 5,
            "inputType": "dropdown",
            "options": [
              -5,
              -4,
              -3,
              -2,
              -1,
              1,
              2,
              3,
              4,
              5
            ],
            "category": null,
            "description": null
          },
          {
            "index": 3,
            "variable": "strTextDirD",
            "type": "PropString",
            "displayName": "Delta text direction",
            "defaultValue": "None",
            "inputType": "dropdown",
            "options": [
              "None",
              "Parallel",
              "Perpendicular"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 4,
            "variable": "strTextDirC",
            "type": "PropString",
            "displayName": "Cumm text direction",
            "defaultValue": "Parallel",
            "inputType": "dropdown",
            "options": [
              "None",
              "Parallel",
              "Perpendicular"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 5,
            "variable": "sDimStyle",
            "type": "PropString",
            "displayName": "|Dimstyle|",
            "defaultValue": "",
            "inputType": "dropdown",
            "options": [
              "_DimStyles"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4772,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the dimensioning of sheathing oversails (overhangs) in 2D shop drawings, specifically measuring the distance the floor sheeting extends beyond the structural timber beams.",
          "category": "ShopDrawing",
          "typicalUseCase": "Used in Paper Space layouts to document and verify sheathing layout details, ensuring the floor decking extends the required amount beyond the outer wall or floor joists."
        },
        "parameters": [
          {
            "name": "strDir",
            "technicalDefault": "Horizontal",
            "businessMeaning": "Sets the orientation of the dimension line, which determines which set of perpendicular beams are used as the reference boundary for the sheathing.",
            "validRange": "Horizontal, Vertical",
            "unit": "Orientation",
            "affectsOutput": "Swaps the calculation logic between the X-axis (Horizontal) and Y-axis (Vertical). This changes which beams are detected as the 'start' and 'end' references for measuring the sheathing overhang."
          },
          {
            "name": "nZone",
            "technicalDefault": 5,
            "businessMeaning": "Identifies the specific construction layer (Zone) within the element from which to extract the sheathing panels.",
            "validRange": "-5 to 5 (Integer indices corresponding to the specific project's layer/zone setup)",
            "unit": "Index",
            "affectsOutput": "Filters the 'Sheet' entities used for dimensioning. Selecting the wrong zone will result in dimensioning the wrong layer (or nothing at all if sheets aren't found in that zone)."
          },
          {
            "name": "strTextDirD",
            "technicalDefault": "None",
            "businessMeaning": "Controls the rotation of the dimension text for the specific oversail measurement relative to the dimension line.",
            "validRange": "None, Parallel, Perpendicular",
            "unit": "Alignment",
            "affectsOutput": "Changes the rotation of the text label for the oversail distance. 'Parallel' aligns text with the dimension line, 'Perpendicular' rotates it 90 degrees, 'None' uses standard CAD defaults."
          },
          {
            "name": "strTextDirC",
            "technicalDefault": "Parallel",
            "businessMeaning": "Controls the rotation of the text for cumulative dimensions (passed to the dimension object, though primarily used here for the individual dimension formatting).",
            "validRange": "None, Parallel, Perpendicular",
            "unit": "Alignment",
            "affectsOutput": "Modifies the text orientation within the generated dimension entity to adhere to drafting office standards."
          },
          {
            "name": "sDimStyle",
            "technicalDefault": "",
            "businessMeaning": "Specifies the AutoCAD Dimension Style to apply, governing text height, arrow style, precision, and color.",
            "validRange": "Any valid DimStyle name present in the current AutoCAD drawing",
            "unit": "String (Style Name)",
            "affectsOutput": "Updates the visual appearance of the dimension to match the selected style (e.g., text height, arrows, units)."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "strDir changes",
            "effect": "Recalculates which beams are considered perpendicular references for the start and end of the dimension run.",
            "cascade": []
          },
          {
            "trigger": "nZone changes",
            "effect": "Queries a different subset of Sheeting entities from the model.",
            "cascade": []
          }
        ],
        "outputEntities": [
          {
            "type": "Dimension",
            "description": "A linear dimension drawn in Paper Space representing the gap or overhang between the sheathing edge and the beam reference. Only drawn if an oversail actually exists (distance > tolerance).",
            "appliedTo": "Viewport (Paper Space) - overlays geometry but does not alter physical timber or sheeting."
          }
        ]
      },
      "tokens_used": 4435,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "Script initiated via Insert command.",
          "User prompted to select insertion point for dimension line origin (_Pt0).",
          "User prompted to select a Viewport linked to the hsbCAD model.",
          "Script terminates insertion sequence and stores Viewport link.",
          "On recalculation, script determines dimension orientation based on 'Direction' property (Horizontal/Vertical).",
          "Script transforms dimension line coordinates from Paper Space to Model Space.",
          "Script collects all Beams from the Element and filters for those perpendicular to the dimension direction.",
          "Script calculates the extremity points (Start/End) of the filtered Beams to establish the reference boundary.",
          "Script collects all Sheets from the specified 'Zone index' and calculates their extremity points.",
          "Script calculates vectors representing the offset (oversail) between Sheet edges and Beam edges.",
          "[Conditional] If Start oversail exists (Sheet extends beyond Beam in negative direction), dimension is created and drawn.",
          "[Conditional] If End oversail exists (Sheet extends beyond Beam in positive direction), dimension is created and drawn."
        ],
        "conditionalBranches": [
          {
            "condition": "Value of 'Direction' property (strDir)",
            "path1": {
              "name": "Horizontal",
              "steps": [
                "Sets Dimension Line parallel to _XW.",
                "Filters beams perpendicular to _XW.",
                "Measures oversail along the X-axis."
              ]
            },
            "path2": {
              "name": "Vertical",
              "steps": [
                "Sets Dimension Line parallel to _YW.",
                "Filters beams perpendicular to _YW.",
                "Measures oversail along the Y-axis."
              ]
            }
          },
          {
            "condition": "Comparison of Sheet Start vs Beam Start (vecStartBS)",
            "path1": {
              "name": "Oversail Detected",
              "steps": [
                "Check if distance > 1mm tolerance.",
                "Check if Sheet is 'behind' the Beam (dot product < 0).",
                "Construct dimension points from Beam Start to Sheet Start.",
                "Draw dimension in Paper Space."
              ]
            },
            "path2": {
              "name": "No Oversail",
              "steps": [
                "Skip drawing dimension at start."
              ]
            }
          },
          {
            "condition": "Comparison of Sheet End vs Beam End (vecEndBS)",
            "path1": {
              "name": "Oversail Detected",
              "steps": [
                "Check if distance > 1mm tolerance.",
                "Check if Sheet is 'beyond' the Beam (dot product > 0).",
                "Construct dimension points from Beam End to Sheet End.",
                "Draw dimension in Paper Space."
              ]
            },
            "path2": {
              "name": "No Oversail",
              "steps": [
                "Skip drawing dimension at end."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Viewport Array Existence",
            "errorMessage": "No error message (Silent Exit).",
            "recovery": "Ensure the script instance has a linked viewport (handled by initial insertion prompt)."
          },
          {
            "check": "Viewport Element Validity",
            "errorMessage": "No error message (Silent Exit).",
            "recovery": "Ensure the selected viewport is linked to a valid hsbCAD Element."
          },
          {
            "check": "Reference Beams Found",
            "errorMessage": "No error message (Silent Exit).",
            "recovery": "Ensure there are structural beams in the model perpendicular to the selected dimension direction."
          },
          {
            "check": "Sheets Found in Zone",
            "errorMessage": "No error message (Silent Exit).",
            "recovery": "Ensure the 'Zone index' property matches a zone containing sheathing/panels."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Change Orientation",
            "how": "OPM (Object Properties Palette) -> 'Direction' dropdown",
            "effect": "Swaps axis logic from Horizontal to Vertical, filtering different beams and redrawing dimensions."
          },
          {
            "action": "Change Target Layer",
            "how": "OPM -> 'Zone index' dropdown",
            "effect": "Queries a different set of Sheet entities, allowing dimensioning of alternative floor layers."
          },
          {
            "action": "Adjust Appearance",
            "how": "OPM -> 'Delta text direction', 'Cumm text direction', or '|Dimstyle|'",
            "effect": "Updates text rotation or dimension style (arrows, text height, color)."
          },
          {
            "action": "Move Script",
            "how": "Grip edit or AutoCAD Move command",
            "effect": "Updates the base point (_Pt0) and shifts the dimension line location relative to the viewport."
          }
        ]
      },
      "tokens_used": 7018,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# Floor_DimSheathingOversail.mcr\n\n## Overview\nThis script automates the dimensioning of floor sheathing oversails (overhangs) in Paper Space layouts. It calculates and draws linear dimensions indicating how much the floor sheeting extends beyond the structural timber beams.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | No | The script is designed for Paper Space annotation. |\n| Paper Space | Yes | This is the primary environment; the script transforms model coordinates to the 2D view. |\n| Shop Drawing | Yes | Specifically used to document sheathing details in production drawings. |\n\n## Prerequisites\n- **Required Entities**: An hsbCAD Element with both structural beams and sheathing sheets.\n- **Minimum Beam Count**: The script requires beams to establish a reference boundary.\n- **Required Settings**: None, but a valid AutoCAD Dimension Style must exist in the drawing.\n- **Setup**: You must be on an AutoCAD Layout containing a Viewport linked to the model.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `Floor_DimSheathingOversail.mcr` from the list.\n\n### Step 2: Select Insertion Point\n```\nCommand Line: (Point prompt)\nAction: Click in the Paper Space layout to set the origin point for the dimension line.\n```\n\n### Step 3: Select Viewport\n```\nCommand Line: Select a viewport, you can add others later on with the HSB_LINKTOOLS command.\nAction: Click the border of the viewport that displays the floor/element you wish to dimension.\n```\n\n### Step 4: Configure Properties\nPress `Ctrl+1` to open the Properties Palette and adjust the **Direction** or **Zone index** if the dimensions do not appear as expected.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| Direction | dropdown | Horizontal | Sets the orientation of the dimension line. **Horizontal** measures along the X-axis, **Vertical** measures along the Y-axis. |\n| Zone index | dropdown | 5 | Selects the construction layer (Zone) containing the sheathing panels. (-5 to 5). |\n| Delta text direction | dropdown | None | Controls the rotation of the dimension text for the oversail measurement (None, Parallel, or Perpendicular). |\n| Cumm text direction | dropdown | Parallel | Controls the rotation of text for cumulative dimensions (if applicable). |\n| \\|Dimstyle\\| | dropdown | (Empty) | Select the AutoCAD Dimension Style to use for visual appearance (arrows, text size, color). |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | No custom context menu items are defined for this script. Use the Properties palette to modify settings. |\n\n## Settings Files\n- None used.\n\n## Tips\n- **No Dimensions Showing?**: If the dimension does not appear, the sheathing might not extend far enough past the beam. The script ignores oversails smaller than approximately 1mm.\n- **Wrong Layer?**: Ensure the **Zone index** matches the specific layer in your hsbCAD model where the floor sheets are located.\n- **Switching Orientation**: If you need to dimension the side walls instead of the front/back, change the **Direction** property from \"Horizontal\" to \"Vertical\" in the properties palette.\n- **Moving the Dimension**: You can move the script using the AutoCAD `MOVE` command or grip edit the insertion point to reposition the dimension line.\n\n## FAQ\n- **Q: Why does the dimension appear but shows zero or very small length?**\n  A: The sheeting edge might be flush with or only slightly overlapping the beam edge. The script only draws visible dimensions for significant overhangs.\n- **Q: Can I dimension multiple zones at once?**\n  A: No, each script instance dimensions only one Zone index. Insert the script multiple times with different Zone settings to document multiple layers.\n- **Q: The text is upside down. How do I fix it?**\n  A: Change the **Delta text direction** property to \"Parallel\" or \"Perpendicular\" to adjust the text rotation."
      },
      "tokens_used": 5416,
      "error": null
    }
  }
}