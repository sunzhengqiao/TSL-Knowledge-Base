{
  "filename": "NA_BATCHPLOT_ELEMENTS.mcr",
  "status": "completed",
  "total_tokens": 26743,
  "processing_time": 323.4765884876251,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3835,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "PaperSpace",
          "supportsPaperSpace": true,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script uses Layout().getAllEntryNames() to select tabs, uses pushCommandOnCommandStack with setvar \"ctab\" to switch to Paper Space, and calls (Hsb_PlotLayoutNt ...) to generate PDFs from the current layout. It does not define #Type E or generate geometry, but orchestrates plotting of existing Elements."
        },
        "prerequisites": {
          "requiredEntities": [
            "Element"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Requires an existing Paper Space Layout tab to be selected for the plotting process.",
          "requiredSettings": []
        }
      },
      "tokens_used": 3993,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity.go",
              "promptOriginal": "\n Select walls to print:",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [
          {
            "type": "Standard Property Dialog",
            "trigger": "if (_bOnInsert) -> showDialog()",
            "title": "Script Properties",
            "dataSource": "PropString variables (psNameFormat, psLayoutName, psFilterForOpenings)",
            "features": {
              "searchable": false,
              "multiSelect": false
            }
          }
        ],
        "opmProperties": [
          {
            "index": 0,
            "variable": "psNameFormat",
            "type": "PropString",
            "displayName": "PDF Name Format",
            "defaultValue": "@(ElementNumber)",
            "inputType": "text",
            "options": [],
            "category": null,
            "description": null
          },
          {
            "index": 1,
            "variable": "psLayoutName",
            "type": "PropString",
            "displayName": "Layout Tab Name",
            "defaultValue": null,
            "inputType": "dropdown",
            "options": [
              "<Dynamic: Layout().getAllEntryNames()>"
            ],
            "category": null,
            "description": null
          },
          {
            "index": 2,
            "variable": "psFilterForOpenings",
            "type": "PropString",
            "displayName": "Take only walls with openings",
            "defaultValue": "No",
            "inputType": "dropdown",
            "options": [
              "Yes",
              "No"
            ],
            "category": null,
            "description": null
          }
        ],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4757,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automates the batch creation of PDF shop drawings for selected wall elements by cycling through them on a specified Paper Space layout.",
          "category": "ShopDrawing / Documentation",
          "typicalUseCase": "Generating a complete set of individual wall sheets for fabrication or approval without manually plotting each wall."
        },
        "parameters": [
          {
            "name": "psNameFormat",
            "technicalDefault": "@(ElementNumber)",
            "businessMeaning": "Defines the naming convention for the output PDF files using the element's property data (e.g., element number, length, or wall name).",
            "validRange": "Any string combination, typically including \"@(ElementNumber)\", \"@(Name)\", or \"@(Length)\" to ensure unique filenames.",
            "unit": "string",
            "affectsOutput": "Determines the exact filename of the generated PDF in the destination folder."
          },
          {
            "name": "psLayoutName",
            "technicalDefault": "First available Layout tab",
            "businessMeaning": "Selects the specific Paper Space template (layout tab) to use as the viewport frame, title block, and border for the plot.",
            "validRange": "List of Layout tab names currently existing in the active drawing.",
            "unit": "string",
            "affectsOutput": "Controls the visual appearance, scale, and borders of the generated PDF drawings."
          },
          {
            "name": "psFilterForOpenings",
            "technicalDefault": "No",
            "businessMeaning": "Filters the selection to exclude walls that do not contain any openings (windows/doors).",
            "validRange": "\"Yes\", \"No\"",
            "unit": "enum",
            "affectsOutput": "If set to \"Yes\", the script skips plotting any wall that is a solid panel without openings."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Script Execution",
            "effect": "Populates the dropdown options for Layout Tab Name based on the current drawing's Paper Space tabs.",
            "cascade": [
              "psLayoutName"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "PDF File",
            "description": "A plotted representation of the element based on the selected Layout configuration, saved to the project folder.",
            "appliedTo": "Selected Elements (Walls) that pass the filter criteria."
          }
        ]
      },
      "tokens_used": 4094,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script execution starts.",
          "2. Script checks 'insertCycleCount'. If > 1, the script instance is immediately erased and execution stops.",
          "3. 'Script Properties' dialog appears (OPM) allowing configuration of PDF Name Format, Layout Tab, and Opening Filter.",
          "4. Command line prompt requests user to select walls (Elements or TslInsts).",
          "5. User selects entities and confirms (Enter/Space).",
          "6. Script iterates through selected entities to filter valid candidates based on Entity type and Opening Filter settings.",
          "7. Script generates LISP commands to switch AutoCAD to the specified Layout Tab.",
          "8. Script enters plotting loop for each filtered element:",
          "   a. Determines Element Number and Xref status.",
          "   b. Generates PDF filename using the Name Format.",
          "   c. Executes 'Hsb_Lisp_setViewport' to zoom to the element.",
          "   d. Executes 'Hsb_PlotLayoutNt' to plot to a temporary folder.",
          "9. After loop finishes, script generates LISP commands to copy PDFs from the temporary folder to the current DWG folder.",
          "10. Script erases its own instance from the drawing.",
          "11. Execution ends."
        ],
        "conditionalBranches": [
          {
            "condition": "Insert Cycle Check",
            "path1": {
              "name": "Re-insertion Detected",
              "steps": [
                "Script detects insertCycleCount > 1",
                "eraseInstance() is called",
                "Script terminates"
              ]
            },
            "path2": {
              "name": "First Run",
              "steps": [
                "Script detects insertCycleCount == 1",
                "Proceeds to showDialog()"
              ]
            }
          },
          {
            "condition": "Entity Type during Selection Processing",
            "path1": {
              "name": "Element Selected",
              "steps": [
                "Cast entity to Element",
                "Check if Element is valid",
                "Apply 'Take only walls with openings' filter logic",
                "If passed, add to plotting list"
              ]
            },
            "path2": {
              "name": "TslInst (Script Instance) Selected",
              "steps": [
                "Cast entity to TslInst",
                "Check for specific Map 'mpStackChildPanel'",
                "Extract Element from Map",
                "If Element is valid, add to plotting list"
              ]
            }
          },
          {
            "condition": "Opening Filter ('Take only walls with openings')",
            "path1": {
              "name": "Set to 'Yes'",
              "steps": [
                "Script checks element openings array",
                "If openings.length() > 0, Element is added",
                "If no openings, Element is skipped"
              ]
            },
            "path2": {
              "name": "Set to 'No'",
              "steps": [
                "Element is added to list regardless of openings"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Validity",
            "errorMessage": "No explicit error message shown, but invalid entities are skipped via continue statements.",
            "recovery": "User must ensure selected objects are valid hsbCAD Elements or compatible TslInsts."
          },
          {
            "check": "TslInst Map Content",
            "errorMessage": "None",
            "recovery": "If a TslInst is selected but does not contain the map 'mpStackChildPanel', it is ignored."
          },
          {
            "check": "Layout Tab Availability",
            "errorMessage": "None (handled by Property Dropdown)",
            "recovery": "User must select a valid layout tab from the properties list before running."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None",
            "how": "N/A",
            "effect": "The script calls 'eraseInstance()' at the end of its execution, removing itself from the drawing completely. To run again with different settings, the user must re-insert the script."
          }
        ]
      },
      "tokens_used": 5292,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# NA_BATCHPLOT_ELEMENTS\n\n## Overview\nAutomates the batch creation of PDF shop drawings for selected wall elements by cycling through them on a specified Paper Space layout. This allows users to generate a complete set of fabrication drawings with custom naming conventions without manually plotting each wall.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used to select the wall elements to be plotted. |\n| Paper Space | Yes | The script automatically switches to this space to perform the plotting using the specified layout tab. |\n| Shop Drawing | Yes | The primary output is PDF files intended for fabrication or documentation. |\n\n## Prerequisites\n- **Required entities**: hsbCAD Elements (Walls) must exist in the drawing.\n- **Minimum beam count**: 0.\n- **Required settings**: At least one Paper Space Layout tab (e.g., a template with a title block) must exist in the drawing.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `NA_BATCHPLOT_ELEMENTS.mcr` from the file browser.\n\n### Step 2: Configure Properties\nUpon insertion, the **Properties** palette (OPM) will display the script settings.\n- Set the **PDF Name Format** (e.g., `@(ElementNumber)`).\n- Select the **Layout Tab Name** from the dropdown (this chooses the border/title block style).\n- Set the **Take only walls with openings** filter if needed.\n\n### Step 3: Select Walls\n```\nCommand Line: Select walls to print:\nAction: Click on the desired wall elements in Model Space. Press Enter or Space to confirm selection.\n```\n\n### Step 4: Automatic Processing\nThe script will now automatically:\n1. Switch to the selected Layout tab.\n2. Zoom to each selected wall.\n3. Plot the view to a PDF.\n4. Save the PDF to the current drawing's folder.\n\n### Step 5: Completion\nOnce processing is finished, the script instance erases itself from the drawing. Check the folder where your DWG is saved to find the generated PDF files.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| PDF Name Format | Text | `@(ElementNumber)` | Defines the filename for the output PDF. You can use tokens like `@(ElementNumber)`, `@(Name)`, or `@(Length)` to ensure unique names. |\n| Layout Tab Name | Dropdown | *First available* | Selects the specific Paper Space Layout tab to use as the drawing frame/template. The list is populated automatically from your drawing's tabs. |\n| Take only walls with openings | Dropdown | No | If set to \"Yes\", the script will skip plotting any wall that does not contain windows or doors. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| *None* | This script does not install a persistent command instance. It runs once and erases itself. |\n\n## Settings Files\n- **Filename**: *None*\n- **Location**: *N/A*\n- **Purpose**: *N/A* (Script relies on standard drawing Layouts).\n\n## Tips\n- **Unique Filenames**: Always use dynamic tokens like `@(ElementNumber)` in the PDF Name Format to prevent files from overwriting each other.\n- **Re-running**: Since the script deletes itself after running, simply execute `TSLINSERT` again if you need to plot another batch with different settings.\n- **Layout Setup**: Ensure your chosen Layout tab has a viewport setup that is compatible with `Hsb_Lisp_setViewport` (usually a standard hsbCAD viewport configuration).\n- **Filtering**: Use the \"Take only walls with openings\" option to quickly generate drawings only for complex wall panels that require manufacturing details, skipping solid sections.\n\n## FAQ\n- **Q: Where are the PDF files saved?**\n  A: They are saved in the same directory as the current DWG file.\n- **Q: Why did the script object disappear after I ran it?**\n  A: This is intended behavior. The script acts as a \"command\" tool that erases itself (`eraseInstance`) immediately after generating the plots to keep your drawing clean.\n- **Q: What happens if two walls have the same Element Number?**\n  A: If your naming format relies only on Element Number and they are identical, the second PDF will overwrite the first one. Include additional tokens like `@(Length)` or `@(Name)` to ensure unique filenames."
      },
      "tokens_used": 4772,
      "error": null
    }
  }
}