{
  "filename": "hsb_SetDynamicCustomDetail.mcr",
  "status": "completed",
  "total_tokens": 29729,
  "processing_time": 222.0201232433319,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "30.08.2010",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          },
          {
            "version": "1.1",
            "date": "15.09.2010",
            "author": "",
            "changes": "BugFix with wrong setting on the right custom detail"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 5321,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "The script selects elements using PrEntity and casts them to ElementWallSF to manipulate construction details in the 3D model. It does not use shop drawing prefixes (sd_), multipage logic, or viewports."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF"
          ],
          "minimumBeams": 0,
          "requiredSpace": "Model Space with Wall elements present to calculate junctions and sheet thicknesses.",
          "requiredSettings": []
        }
      },
      "tokens_used": 2842,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "\nSelect a set of elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 3332,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "scriptPurpose": {
          "summary": "Automatically assigns custom construction details to wall ends based on the calculated sheet thickness of intersecting walls.",
          "category": "Automation/Construction Logic",
          "typicalUseCase": "Used to ensure the correct wall junction detail (e.g., for sheeting overlap or recesses) is applied when multiple walls meet, based on the cladding depth of the connecting wall."
        },
        "parameters": [
          {
            "name": "ssE",
            "technicalDefault": "null (User Selection)",
            "businessMeaning": "The set of wall elements (ElementWallSF) to be analyzed for junctions and updated with construction details.",
            "validRange": "Any valid ElementWallSF entities in Model Space.",
            "unit": "Entity",
            "affectsOutput": "Determines which walls receive the updated detail codes."
          },
          {
            "name": "nSize",
            "technicalDefault": "[9, 12, 15, 18, 19, 22, 28, 30, 35, 60, 92]",
            "businessMeaning": "The lookup table of sheeting thicknesses (in mm) used to identify the correct construction detail code. Represents the sum of specific zones (1-5 or -1 to -5) of the connected wall.",
            "validRange": "Positive integers representing cladding thickness (typically 9mm - 150mm depending on construction type).",
            "unit": "mm",
            "affectsOutput": "Determines which detail suffix is selected based on the measured thickness of the connected wall's zones."
          },
          {
            "name": "sDetail",
            "technicalDefault": "[\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\"]",
            "businessMeaning": "The suffix codes appended to the wall's base code to create the specific construction detail identifier.",
            "validRange": "String codes corresponding to the catalog of available hsbCAD custom details.",
            "unit": "String",
            "affectsOutput": "The final string value set in the element's Left or Right Construction Detail property (e.g., 'WallCodeO12')."
          }
        ],
        "parameterDependencies": [
          {
            "trigger": "Change in connected wall cladding thickness (Zones 1 to 5)",
            "effect": "Recalculates the index for the detail code lookup.",
            "cascade": [
              "sDetail",
              "setConstrDetailLeft/Right"
            ]
          }
        ],
        "outputEntities": [
          {
            "type": "Construction Detail Assignment",
            "description": "Updates the 'ConstrDetailLeft' or 'ConstrDetailRight' property of the wall element with a code calculated as [WallCode] + 'O' + [DetailSuffix].",
            "appliedTo": "Selected ElementWallSF entities."
          }
        ]
      },
      "tokens_used": 6214,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Script Insertion triggered.",
          "2. Check insertCycleCount; if greater than 1, erase instance and exit (prevention of duplicate runs).",
          "3. Prompt user to select a set of elements (Walls) via PrEntity.",
          "4. Iterate through the selected elements:",
          "   a. Create a new instance of the script attached specifically to that element using dbCreate.",
          "5. Erase the original 'Manager' script instance.",
          "6. [Worker Instance Start] Validate that the assigned element is a valid ElementWallSF; if not, erase.",
          "7. [Worker Instance Start] Scan for other instances of this script on the same element and erase them (singleton enforcement).",
          "8. Retrieve all connected elements for the current wall.",
          "9. Loop through each connected element:",
          "   a. Validate the connected element is a valid ElementWallSF.",
          "   b. Calculate geometric proximity to determine if the connection is at the Left or Right end of the wall.",
          "   c. If connection is at an end (Left or Right), determine the sheet thickness of the connecting wall (sum of specific zones based on Front/Back orientation).",
          "   d. Look up the calculated thickness in the internal 'nSize' table.",
          "   e. If a match is found, construct the Custom Detail string (WallCode + 'O' + DetailSuffix).",
          "   f. Apply the new string to the wall's ConstrDetailLeft or ConstrDetailRight property."
        ],
        "conditionalBranches": [
          {
            "condition": "Location of Junction on Wall",
            "path1": {
              "name": "Left Side Junction",
              "steps": [
                "Check if distance to wall Start (Left) < 5mm.",
                "Calculate thickness of connecting wall.",
                "Update 'ConstrDetailLeft' property."
              ]
            },
            "path2": {
              "name": "Right Side Junction",
              "steps": [
                "Check if distance to wall End (Right) < 5mm.",
                "Calculate thickness of connecting wall.",
                "Update 'ConstrDetailRight' property."
              ]
            },
            "path3": {
              "name": "No Junction / Mid-Span",
              "steps": [
                "Connection is ignored if it is not within 5mm of Start or End points."
              ]
            }
          },
          {
            "condition": "Connecting Wall Orientation (for thickness calc)",
            "path1": {
              "name": "Back Side Connection",
              "steps": [
                "Vector dot product check > 0.",
                "Sum thickness of zones -1 to -5 of the connecting wall."
              ]
            },
            "path2": {
              "name": "Front Side Connection",
              "steps": [
                "Vector dot product check <= 0.",
                "Sum thickness of zones 1 to 5 of the connecting wall."
              ]
            }
          },
          {
            "condition": "Thickness Lookup Result",
            "path1": {
              "name": "Match Found",
              "steps": [
                "Retrieve index from 'nSize' array.",
                "Map index to 'sDetail' array.",
                "Set property."
              ]
            },
            "path2": {
              "name": "No Match",
              "steps": [
                "Do not modify the construction detail for this specific junction."
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Entity Validity",
            "errorMessage": "(None explicit, but script erases itself)",
            "recovery": "Ensure selected entities are valid ElementWallSF (Wall) entities."
          },
          {
            "check": "Junction Proximity",
            "errorMessage": "None",
            "recovery": "Connected walls must physically touch or be within 5mm of the Left or Right endpoints of the main wall to be recognized."
          },
          {
            "check": "Thickness Range",
            "errorMessage": "None",
            "recovery": "The total sheet thickness of the connecting wall must match a value in the predefined table [9, 12, 15, 18, 19, 22, 28, 30, 35, 60, 92] mm."
          }
        ],
        "postInsertionActions": [
          {
            "action": "Dynamic Update",
            "how": "Recalculation (hsbUpdate) or Geometry Change",
            "effect": "The script remains attached to the element. If the connected wall changes geometry (thickness/position), the script recalculates and updates the detail codes automatically."
          },
          {
            "action": "Script Removal",
            "how": "Entity Properties / TSL List",
            "effect": "User can delete the script instance from the element's list of attached scripts to stop automatic updates."
          }
        ]
      },
      "tokens_used": 7363,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SetDynamicCustomDetail.mcr\n\n## Overview\nThis script automatically assigns specific construction details to the left and right ends of wall elements based on the sheet thickness (cladding depth) of intersecting walls. It ensures that the correct junction detail codes (e.g., for sheeting overlap or recesses) are applied dynamically without manual calculation.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Used for 3D model modification and detailing. |\n| Paper Space | No | Not designed for layout views or 2D drawings. |\n| Shop Drawing | No | Does not generate shop drawing views. |\n\n## Prerequisites\n- **Required entities:** Wall elements (`ElementWallSF`).\n- **Minimum beam count:** 0 (User selects a set of elements).\n- **Required settings:** None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` â†’ Select `hsb_SetDynamicCustomDetail.mcr` from the file dialog.\n\n### Step 2: Select Walls\n```\nCommand Line: Select a set of elements\nAction: Click on the wall elements in the model that require their end details to be updated. Press Enter to confirm selection.\n```\n\n*Note: Upon confirmation, the script attaches itself to the selected walls and immediately calculates the required details based on current connections. The initial script instance will disappear, but the logic remains active on the selected walls.*\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| N/A | N/A | N/A | This script does not expose user-editable properties in the Properties Palette. It uses a predefined internal lookup table for thicknesses and detail codes. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| None | This script does not add specific items to the context menu. |\n\n## Settings Files\n- **Filename**: None\n- **Location**: N/A\n- **Purpose**: The script relies on hardcoded lookup tables for thicknesses (9, 12, 15... 92mm) and detail suffixes (\"6\" through \"16\").\n\n## Tips\n- **Thickness Matching:** The script only recognizes specific sheet thicknesses: **9, 12, 15, 18, 19, 22, 28, 30, 35, 60, and 92 mm**. If your connecting wall cladding falls outside these values, the detail will not be set.\n- **Junction Location:** The connection must be physically located within **5mm** of the wall's Start (Left) or End (Right) point. Mid-span connections are ignored.\n- **Dynamic Updates:** If you modify the geometry or material thickness of a *connected* wall, this script will automatically recalculate and update the detail code on the main wall the next time the model updates.\n- **Removing the Script:** To stop the walls from updating automatically, select the wall, open the TSL Instance list (element properties), and delete this script instance.\n\n## FAQ\n- **Q: Why did the detail not update on my wall?**\n  **A:** Check two things: 1) Ensure the connecting wall's total sheet thickness matches one of the supported values (e.g., 12mm, 15mm). 2) Ensure the intersecting wall is actually touching the very end of the main wall (within 5mm).\n- **Q: How does it calculate the thickness?**\n  **A:** It sums up the thickness of Construction Zones 1 through 5 (Front side) or Zones -1 through -5 (Back side) of the *connecting* wall.\n- **Q: Can I change the detail codes it assigns?**\n  **A:** Not through the interface. The mapping codes (O6, O7, etc.) and thickness values are defined inside the script code."
      },
      "tokens_used": 4657,
      "error": null
    }
  }
}