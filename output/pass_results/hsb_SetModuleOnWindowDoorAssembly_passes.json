{
  "filename": "hsb_SetModuleOnWindowDoorAssembly.mcr",
  "status": "completed",
  "total_tokens": 28295,
  "processing_time": 187.575457572937,
  "passes": {
    "1": {
      "success": true,
      "data": {
        "header": {
          "type": null,
          "numBeamsReq": null,
          "keywords": [],
          "majorVersion": null,
          "minorVersion": null,
          "dxaOut": null,
          "implInsert": null
        },
        "description": "",
        "versionHistory": [
          {
            "version": "1.0",
            "date": "28.08.2012",
            "author": "Alberto Jena (aj@hsb-cad.com)",
            "changes": "Release Version"
          }
        ],
        "settingsFiles": [],
        "dependencies": []
      },
      "tokens_used": 3482,
      "error": null
    },
    "2": {
      "success": true,
      "data": {
        "usageEnvironment": {
          "primarySpace": "ModelSpace",
          "supportsPaperSpace": false,
          "isShopDrawingScript": false,
          "isMultipageScript": false,
          "detectionEvidence": "Script operates on '_Element' (specifically ElementWallSF), 'Beam', and 'Opening' objects to perform 3D geometric logic (PlaneProfile, intersection, unions). It modifies properties ('setModule') on construction entities and uses 'eraseInstance()' to terminate after execution. No '_Viewport', 'sd_*' functions, or '#Type E' patterns associated with Shop Drawings or Paper Space are present."
        },
        "prerequisites": {
          "requiredEntities": [
            "ElementWallSF"
          ],
          "minimumBeams": null,
          "requiredSpace": "Model Space containing Wall Elements with Openings and Beams",
          "requiredSettings": []
        }
      },
      "tokens_used": 3617,
      "error": null
    },
    "3": {
      "success": true,
      "data": {
        "commandLine": {
          "insertionFlow": [
            {
              "step": 1,
              "function": "PrEntity",
              "promptOriginal": "Select one or More Elements",
              "condition": "_bOnInsert",
              "required": true
            }
          ],
          "keywordOptions": []
        },
        "dialogs": [],
        "opmProperties": [],
        "contextMenu": [],
        "settingsFiles": []
      },
      "tokens_used": 4361,
      "error": null
    },
    "4": {
      "success": true,
      "data": {
        "raw_content": "```json\n{\n  \"scriptPurpose\": {\n    \"summary\": \"Automatically detects adjacent window and door openings (assemblies) based on proximity and assigns a unified 'Module' name to all framing beams surrounding the group.\",\n    \"category\": \"Data Management / Production Planning\",\n    \"typicalUseCase\": \"When a series of windows or a door-and-window combo are installed close together (e.g., a 10mm gap), this script groups them so the timber elements are treated as a single pre-fabricated unit for production lists.\"\n  },\n  \"parameters\": [\n    {\n      \"name\": \"ssE\",\n      \"technicalDefault\": \"Prompt Required (User Selection)\",\n      \"businessMeaning\": \"The target Wall Elements that contain the window/door assemblies requiring module standardization.\",\n      \"validRange\": \"1 or more valid ElementWallSF objects containing Openings and Beams\",\n      \"unit\": \"Selection Set (Count)\",\n      \"affectsOutput\": \"Defines the scope of the search. The script will only scan and modify beam properties within the selected wall elements.\"\n    }\n  ],\n  \"parameterDependencies\": [\n    {\n      \"trigger\": \"User selects elements via ssE\",\n      \"effect\": \"Script compiles lists of Openings (opAll) and Beams (bmAll) from the selected"
      },
      "tokens_used": 6365,
      "error": null
    },
    "5": {
      "success": true,
      "data": {
        "workflowDiagram": [
          "1. Launch Script: Script starts, sets sequence number and units (mm).",
          "2. Insertion Cycle Check: If insertionCycleCount > 1, the script immediately erases the instance and exits to prevent re-triggering.",
          "3. User Input: If '_bOnInsert' is true (first run), prompt user 'Select one or More Elements' using PrEntity.",
          "4. Selection Processing: Append selected ElementWallSF entities to the script's internal list (_Element) and exit/return.",
          "5. Post-Insertion Execution: The script reloads (_bOnDbCreated) for the selected elements.",
          "6. Element Iteration: Loop through each selected Wall Element.",
          "7. Data Collection: Extract Coordinate System, all Openings (opAll), and all Beams (bmAll) from the current Element.",
          "8. Skip Check: If no beams exist in the element, skip to the next element.",
          "9. Sorting: Sort all Openings in the current element from left to right based on their X-axis projection.",
          "10. Assembly Detection Loop: Iterate through sorted Openings to find adjacent/intersecting groups (Assemblies).",
          "11. Opening Processing: Create a PlaneProfile of the current Opening shape, shrink it by 40mm (to check proximity in the gap).",
          "12. Proximity Search (Do-While Loop): Compare current Opening profile with subsequent Openings.",
          "13. Intersection Check: If the shrunk profiles of adjacent openings intersect (Area > 25mm²), they are part of the same Assembly.",
          "14. Assembly Union: If intersecting, merge the profiles and mark both openings as 'Used' to prevent re-processing.",
          "15. Module Extraction: If an Assembly contains >1 opening, identify all Beams framing these openings (Beam Profile intersects Assembly Profile).",
          "16. Module Name Collection: Collect all existing 'Module' names from the identified framing beams.",
          "17. Module Standardization: If any Module names were found, update the 'setModule' property of all framing beams associated with that Assembly to match the first Module name found.",
          "18. Completion: Once all elements are processed, the script instance is erased."
        ],
        "conditionalBranches": [
          {
            "condition": "Check for re-insertion loop",
            "path1": {
              "name": "Valid Single Insertion",
              "steps": [
                "Proceed to User Input Prompt"
              ]
            },
            "path2": {
              "name": "Multiple Insertion Cycles",
              "steps": [
                "eraseInstance()",
                "Exit Script"
              ]
            }
          },
          {
            "condition": "Check for Beams in Element",
            "path1": {
              "name": "Beams Present",
              "steps": [
                "Proceed to Opening Sorting and Assembly Logic"
              ]
            },
            "path2": {
              "name": "No Beams Found",
              "steps": [
                "Set nErase flag (remains false)",
                "Continue to next Element or Finish"
              ]
            }
          },
          {
            "condition": "Opening Assembly Detection",
            "path1": {
              "name": "Adjacent/Intersecting Openings Found",
              "steps": [
                "Merge profiles",
                "Group beams",
                "Synchronize Module names"
              ]
            },
            "path2": {
              "name": "Isolated Opening (No Neighbor)",
              "steps": [
                "Skip Module Synchronization",
                "Continue to next Opening"
              ]
            }
          },
          {
            "condition": "Existing Module Names",
            "path1": {
              "name": "Module Names Found",
              "steps": [
                "Update all beams in assembly to match the first found Module name"
              ]
            },
            "path2": {
              "name": "No Module Names Found",
              "steps": [
                "Do not modify beam properties"
              ]
            }
          }
        ],
        "validationRules": [
          {
            "check": "Valid Element Selection",
            "errorMessage": "(Implicit via PrEntity behavior) User cancels selection or selects invalid entity type.",
            "recovery": "User must retry and select valid 'ElementWallSF' objects."
          },
          {
            "check": "Element contains Beams",
            "errorMessage": "None (Silent skip)",
            "recovery": "Script ignores elements without beams. No user action needed."
          },
          {
            "check": "Opening Proximity",
            "errorMessage": "None (Geometric Logic)",
            "recovery": "Openings must be closer than the shrink distance logic (effectively < 80mm gap combined) to be grouped. User adjusts drawing geometry if grouping is incorrect."
          }
        ],
        "postInsertionActions": [
          {
            "action": "None (Script Self-Deleting)",
            "how": "Script automatically executes 'eraseInstance()' upon completion.",
            "effect": "The script instance is removed from the drawing, leaving only the modified Beam properties (setModule). No persistent OPM properties or context menu items are added by this script."
          }
        ]
      },
      "tokens_used": 4735,
      "error": null
    },
    "6": {
      "success": true,
      "data": {
        "markdown": "# hsb_SetModuleOnWindowDoorAssembly.mcr\n\n## Overview\nThis script automatically detects adjacent window and door openings based on their proximity within wall elements. It assigns a unified \"Module\" name to all framing beams surrounding these groups, ensuring they are treated as a single pre-fabricated unit for production lists.\n\n## Usage Environment\n| Space | Supported | Notes |\n|-------|-----------|-------|\n| Model Space | Yes | Script must be run in the model where the wall elements are located. |\n| Paper Space | No | Not supported. |\n| Shop Drawing | No | This is a model-space data management script. |\n\n## Prerequisites\n- **Required Entities:** Wall Elements (`ElementWallSF`) containing Openings and Beams.\n- **Minimum Beam Count:** No strict limit, but the element must contain beams for the script to process data.\n- **Required Settings:** None.\n\n## Usage Steps\n\n### Step 1: Launch Script\nCommand: `TSLINSERT` → Browse to and select `hsb_SetModuleOnWindowDoorAssembly.mcr`\n\n### Step 2: Select Elements\n```\nCommand Line: Select one or More Elements\nAction: Click on the Wall Elements that contain the window/door assemblies you wish to group. Press Enter or Right-Click to confirm selection.\n```\n\n### Step 3: Automatic Processing\nThe script will automatically analyze the selected walls, identify openings close to each other (e.g., window triplets), and update the `Module` property on the surrounding beams. The script instance will delete itself upon completion.\n\n## Properties Panel Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| N/A | N/A | N/A | This script does not expose any editable properties in the Properties Palette. |\n\n## Right-Click Menu Options\n\n| Menu Item | Description |\n|-----------|-------------|\n| N/A | This script does not add any items to the Right-Click context menu. |\n\n## Settings Files\n- **Filename:** None\n- **Location:** N/A\n- **Purpose:** This script does not rely on external settings files.\n\n## Tips\n- **Proximity Logic:** The script groups openings that are close together. Openings with a gap larger than approximately 80mm will likely be treated as separate units.\n- **Pre-existing Names:** The script looks for an existing \"Module\" name on the beams surrounding the openings. Ensure at least one beam in the group already has the correct Module name before running this script, so it can propagate that name to the rest of the group.\n- **Single Execution:** The script is designed to run once and then remove itself from the drawing. You do not need to manually delete the script instance.\n\n## FAQ\n- **Q: Why did my windows not group into a single module?**\n  - **A:** The script groups openings based on geometric intersection after shrinking their profiles. If the gap between your windows is too wide (typically >80mm), they will not be recognized as a single assembly. Move the openings closer in the drawing and run the script again.\n- **Q: What happens if none of the beams have a Module name?**\n  - **A:** The script requires at least one beam in the assembly to already have a \"Module\" name assigned. If no names are found, the script will not modify the properties for that assembly.\n- **Q: Can I use this on curved walls?**\n  - **A:** The script works on standard `ElementWallSF` objects. As long as the geometry can be processed, it should function, though it is primarily designed for standard planar wall assemblies."
      },
      "tokens_used": 5735,
      "error": null
    }
  }
}